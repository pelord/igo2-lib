{"version":3,"mappings":"2FAAA,cAGA,yCACA,8CACA,gCACAA,IAGAC,kBAA6C,UAC7CA,YACAA,WACAC,mCCZA,OACA,uBACA,yBACA,0BACA,uBACA,sBACA,8BACA,kBACA,sBACA,yBACA,0BACA,sBACA,sBACA,8BACA,mBAIA,cACA,WACA,YAEA,cACA,cACA,8CACA,gCACAC,EAEA,YAEAC,kBACA,uBAEAA,YACAF,YACAE,kXC9BaC,gBAAMC,eAIMC,EAAWC,GAEhC,OADUD,EAAEE,WAAWD,oBAIAD,EAAWC,GAElC,OADYE,KAAKC,MAAMC,QAAQL,EAAEM,OAAOL,kBAIrBD,GACnB,IACEO,EACAC,EAFEP,EAAO,EAGTQ,EAAOT,EAAEU,OACTC,EAAI,GAIN,GAFAX,EAAIY,OAAOZ,GAEE,IAATS,EACF,OAAOT,EAWT,IARIA,EAAEM,OAAOG,EAAO,KAAON,KAAKU,UAC9BZ,EAAO,EACHD,EAAEM,OAAOG,EAAO,KAAON,KAAKU,UAC9BZ,EAAO,GAETQ,GAAQ,GAGLF,EAAI,EAAGA,EAAIE,EAAMF,GAAK,EACzBC,EACGL,KAAKW,UAAUd,EAAGO,IAAM,GACxBJ,KAAKW,UAAUd,EAAGO,EAAI,IAAM,GAC5BJ,KAAKW,UAAUd,EAAGO,EAAI,IAAM,EAC7BJ,KAAKW,UAAUd,EAAGO,EAAI,GACxBI,EAAEI,KAAKH,OAAOI,aAAaR,GAAO,GAAKA,GAAO,EAAK,IAAW,IAANA,IAG1D,OAAQP,QACD,EACHO,EACGL,KAAKW,UAAUd,EAAGO,IAAM,GACxBJ,KAAKW,UAAUd,EAAGO,EAAI,IAAM,GAC5BJ,KAAKW,UAAUd,EAAGO,EAAI,IAAM,EAC/BI,EAAEI,KAAKH,OAAOI,aAAaR,GAAO,GAAKA,GAAO,EAAK,MACnD,WACG,EACHA,EAAOL,KAAKW,UAAUd,EAAGO,IAAM,GAAOJ,KAAKW,UAAUd,EAAGO,EAAI,IAAM,GAClEI,EAAEI,KAAKH,OAAOI,aAAaR,GAAO,KAItC,OAAOG,EAAEM,KAAK,kBAGKjB,GAGnB,IAAIC,EACFM,EACAC,EAAI,GACJC,GALFT,EAAIY,OAAOZ,IAKAU,OAASV,EAAEU,OAAS,EAE/B,GAAiB,IAAbV,EAAEU,OACJ,OAAOV,EAGT,IAAKC,EAAI,EAAGA,EAAIQ,EAAMR,GAAK,EACzBM,EACGJ,KAAKJ,QAAQC,EAAGC,IAAM,GACtBE,KAAKJ,QAAQC,EAAGC,EAAI,IAAM,EAC3BE,KAAKJ,QAAQC,EAAGC,EAAI,GACtBO,EAAEO,KAAKZ,KAAKC,MAAME,OAAOC,GAAO,KAChCC,EAAEO,KAAKZ,KAAKC,MAAME,OAAQC,GAAO,GAAM,KACvCC,EAAEO,KAAKZ,KAAKC,MAAME,OAAQC,GAAO,EAAK,KACtCC,EAAEO,KAAKZ,KAAKC,MAAME,OAAa,GAANC,IAG3B,OAAQP,EAAEU,OAASD,QACZ,EACHF,EAAMJ,KAAKJ,QAAQC,EAAGC,IAAM,GAC5BO,EAAEO,KACAZ,KAAKC,MAAME,OAAOC,GAAO,IACvBJ,KAAKC,MAAME,OAAQC,GAAO,GAAM,IAChCJ,KAAKU,QACLV,KAAKU,SAET,WACG,EACHN,EAAOJ,KAAKJ,QAAQC,EAAGC,IAAM,GAAOE,KAAKJ,QAAQC,EAAGC,EAAI,IAAM,EAC9DO,EAAEO,KACAZ,KAAKC,MAAME,OAAOC,GAAO,IACvBJ,KAAKC,MAAME,OAAQC,GAAO,GAAM,IAChCJ,KAAKC,MAAME,OAAQC,GAAO,EAAK,IAC/BJ,KAAKU,SAKb,OAAOL,EAAES,KAAK,KAxGD,iBAAkB,IAClBC,QAJf,mEAEWA,YCCAC,EAAYC,YACvBC,OAAOC,UAAUC,mBCLGC,YACRC,GACV,IAAIzB,GAAa,EACjB,GAAuB,iBAAZyB,EAAsB,CAC/B,MAAMxB,EAAWyB,EAAUC,eAAeF,GAC1CC,EAAUE,WAAW3B,GACrBD,EAAa0B,EAAUG,sBACvBH,EAAUI,gBAAgB7B,QAE1ByB,EAAUE,WAAWH,GACrBzB,EAAa0B,EAAUG,sBAEzB,OAAO7B,wBAGqByB,GAC5B,MAAMzB,EAAW+B,SAASC,cAAc,YACxC,SAASC,MAAQR,EACjBM,SAASG,KAAKC,YAAYnC,GACnBA,yBAGsByB,GAC7BM,SAASG,KAAKE,YAAYX,qBAGFA,GACxB,GAA8B,QAA1BN,EAAUkB,YAAuB,CACnC,MAAMrC,EAAqByB,EAASa,gBAC9BrC,EAAcwB,EAASc,SACvBhC,EAAQwB,SAASS,cACjBhC,EAAYa,OAAOoB,eAEzBhB,EAASiB,iBAAkB,EAC3BjB,EAASkB,UAAW,EACpBpC,EAAMqC,mBAAmBnB,GACzBjB,EAAUqC,kBACVrC,EAAUsC,SAASvC,GACnBkB,EAASsB,kBAAkB,EAAG,QAC9BtB,EAASa,gBAAkBtC,EAC3ByB,EAASc,SAAWtC,OAEpBwB,EAASuB,sCAKX,OAAgC,QAA1B7B,EAAUkB,cAAyBlB,EAAU8B,eAAe,SACzDlB,SAASmB,YAAY,iBClDVC,YACV1B,EAAYzB,EAAYC,EAAI,GACtC,IAAKwB,IAAOzB,EACV,MAAO,GAET,IAAKyB,EACH,MAAO,0BAA4BzB,EAAK,UAE1C,IAAKA,EACH,MAAO,yBAA2ByB,EAAK,UAEzCA,EAAKA,EAAG2B,WACRpD,EAAKA,EAAGoD,WACR,MAAM7C,EAAa8C,EAAYC,WAAW7B,EAAIzB,EAAI,GAAIC,GAChDO,EAAQR,EAAGuD,MACfhD,EAAWiD,IAAI9C,OAASH,EAAWkD,IAAI/C,OAASH,EAAWmD,IAAIhD,QAE3DD,EAAWgB,EAAG8B,MAClBhD,EAAWiD,IAAI9C,OAASH,EAAWoD,IAAIjD,OAASH,EAAWmD,IAAIhD,QAEjE,IAAIC,EAAS,GACb,OAAIJ,EAAWoD,IAAIjD,OAAS,IAC1BH,EAAWoD,IAAM,yBAA2BpD,EAAWoD,IAAM,WAE3DpD,EAAWkD,IAAI/C,OAAS,IAC1BH,EAAWkD,IAAM,0BAA4BlD,EAAWkD,IAAM,WAEhE9C,EAASJ,EAAWiD,IAAMjD,EAAWoD,IAAMpD,EAAWkD,IAAMlD,EAAWmD,IACvE/C,GACe,KAAbF,GAA6B,KAAVD,EACf6C,EAAYF,KAAK1C,EAAUD,EAAOP,GAClC,GACCU,8BAG2Bc,EAAGzB,EAAGC,GAExC,IAAIM,EAAI,EACJC,GAAQ,EACZ,MAAMC,EAAOgB,EAAEf,OACTC,EAAI,CAAEiD,IAAKnD,EAAM+C,IAAKvD,EAAGyD,IAAK,IAEpC,KAAOnD,EAAIE,GACTT,EAAEO,KAAOkB,EAAElB,GACPC,EACGG,EAAE+C,KAAOjC,EAAElB,IACVC,GAAQ,EAAQG,EAAEiD,IAAMrD,EAAKI,EAAE+C,IAAMjC,EAAElB,IAExCA,EADHC,EACOC,EACAF,IACTA,EAEJ,OAAOI,oBAGiBc,EAAIzB,EAAIC,EAAGM,GACnC,MAAMC,EAAeiB,EAAGf,QAAUe,EAAGf,OACrC,IAAKD,EAAQE,GAAWH,EAAe,CAACiB,EAAIzB,GAAM,CAACA,EAAIyB,GACnDoC,EAAK,EAET,KAAOlD,EAAQkD,KAAQpD,EAAOoD,IAAOA,EAAKlD,EAAQD,UAC9CmD,EAEJpD,EAASA,EAAOqD,MAAM,IAAIP,MAAMM,GAChClD,EAAUA,EAAQ4C,MAAMM,GAExB,MAAME,EAAMtD,EAAOC,OACnB,IAAIsD,EAAU,CACZJ,IAAKjD,EAAQD,OACbuD,IAAKF,EACLL,IAAK,GACLF,IAAKvD,EAAID,EAAGuD,MAAM,EAAGM,IAEnBK,EAAW,CAAER,IAAK,IAEtB,GAAgB,KAAZ/C,EACF,QAASwD,EAAK,EAAGA,EAAKJ,GAAOG,EAAIR,IAAIhD,OAASH,EAAG4D,IAE/CD,EAAMb,EAAYe,qBAChBzD,EACA0C,EAAYgB,YAAY5D,EAAQ0D,GAChCH,EAAGR,KAELU,EAAID,IACFE,EAAKJ,EAAMG,EAAIN,IACXM,EAAIN,IAAMO,EACVD,EAAIN,IAAMG,EAAMI,EAClBD,EAAIR,IAAIhD,OAASsD,EAAGN,IAAIhD,SAC1BsD,EAAKE,GAKX,OAACF,EAAGL,IAAKK,EAAGP,KAAOjD,EACf,CAACC,EAAO8C,MAAM,EAAGS,EAAGC,KAAKhD,KAAK,IAAKN,EAAQ4C,MAAM,EAAGS,EAAGJ,MACvD,CAACjD,EAAQ4C,MAAM,EAAGS,EAAGJ,KAAMnD,EAAO8C,MAAM,EAAGS,EAAGC,KAAKhD,KAAK,MAC7B,IAAxB+C,EAAGL,IAAItD,QAAQ,OACI,IAAxB2D,EAAGP,IAAIpD,QAAQ,MACJ,KAAX2D,EAAGL,KACQ,KAAXK,EAAGP,KACQ,KAAXO,EAAGN,IACDM,EACAX,EAAYC,WAAWU,EAAGL,IAAKK,EAAGP,IAAKO,EAAGR,IAAKjD,sBAG1BkB,EAAOzB,GAChC,MAAMC,EAAMwB,EAAMf,OACZH,EAAM,IAAI+D,MAAM7C,EAAMf,QAC5B,GAAIV,EAAIC,GAAQ,EACd,OAAOwB,EAAM8B,QAEb,QAAS/C,EAAI,EAAGA,EAAIP,EAAKO,IACvBD,EAAIC,GAAKiB,GAAOjB,GAAKP,EAAOD,EAAIC,IAASA,GAG7C,OAAOM,OCnHCgE,QAAZ,OAAYrD,QAAU,KACpBsD,cACAtD,oBACAA,sBAHUqD,EAAZ,IAAYrD,cCGYuD,mBAEpBhD,EACAzB,EACAC,EAAuB,IAEvB,MAAMM,EAAyB,CAC7BmE,MAAO,GACPC,QAAS,GACTC,SAAU,IAGZ,IAAKnD,IAASzB,EACZ,OAAOO,EAGT,MAAMC,EAAiB,IAAIiB,GACrBhB,EAAiB,IAAIT,GAE3B,UAAWW,KAAYH,EAAW,CAChC,MAAMqD,EAAQpD,EAAUoE,UAAUC,GAAKA,EAAEC,KAAOpE,EAASoE,IAEzD,IAAc,IAAVlB,EAAc,CAChBtD,EAAMoE,QAAQ5D,KAAK,CACjBiE,OAAQ,CAAEC,KAAMV,EAAWW,SAC3BjD,MAAOtB,IAET,SAGF,MAAMoD,EAAStD,EAAU0E,OAAOtB,EAAO,GAAG,GACpCG,EAAgBoB,KAAKC,MAAMD,KAAKE,UAAU3E,IAC1CuD,EAAckB,KAAKC,MAAMD,KAAKE,UAAUvB,IAExCI,EAAcoB,EAAYC,cAC9BxB,EACAE,OACA,EACAjE,GAGEkE,EAAYzD,QACdH,EAAMqE,SAAS7D,KAAK,CAClBiE,OAAQ,CACNC,KAAMV,EAAWkB,SACjBC,eAEFzD,MAAO+B,EACP2B,SAAUhF,EACViF,SAAU7B,IAKhB,SAAMW,MAAQjE,EAAUoF,IAAIlF,KAExBqE,OAAQ,CAAEC,KAAMV,EAAWC,OAC3BvC,MAAOtB,KAIJJ,uBAGoBkB,EAAUzB,EAAQC,EAAUM,EAAa,IACpE,MAAMC,EAAgB4E,KAAKC,MAAMD,KAAKE,UAAU7D,IAC1ChB,EAAc2E,KAAKC,MAAMD,KAAKE,UAAUtF,IAExCW,EAAY,IAAImF,IAAI,IACrBC,OAAOC,KAAKvE,MACZsE,OAAOC,KAAKhG,KAEjB,IAAI6D,EAAc,GAClB,SAAKoC,QAAQlC,IACX,MAAMC,EAAY/D,EAAU,GAAGA,KAAW8D,IAAQA,GACZ,IAAlCxD,EAAWF,QAAQ2D,KAInBM,MAAM4B,QAAQzE,EAASsC,MACzBtC,EAASsC,GAAOtC,EAASsC,GAAK9C,KAAK,UAEjCqD,MAAM4B,QAAQlG,EAAO+D,MACvB/D,EAAO+D,GAAO/D,EAAO+D,GAAK9C,KAAK,UAIN,iBAAlBQ,EAASsC,IACO,iBAAhB/D,EAAO+D,IACI,OAAlBtC,EAASsC,IACO,OAAhB/D,EAAO+D,GAEPF,EAAcA,EAAYsC,OACxBhG,KAAKqF,cAAc/D,EAASsC,GAAM/D,EAAO+D,GAAMC,IAG7CvC,EAASsC,KAAS/D,EAAO+D,KAC3BF,EAAY9C,KAAK,CACfqF,IAAKpC,EACL2B,SAAUnF,EAAcuD,GACxB6B,SAAUnF,EAAYsD,KAExBtC,EAASsC,GAAOV,EAAYF,KAAK1B,EAASsC,GAAM/D,EAAO+D,QAKtDF,WC9GawC,eACP5E,EAAazB,GAC1B,MAAMC,EAAYD,EACfsG,QAAQ,MAAO,KACfA,QAAQ,MAAO,IACfxC,MAAM,KACT,IAAIvD,EAAUkB,EACd,KAAOxB,EAAUS,QAAQ,CACvB,GAAuB,iBAAZH,EACT,OAEFA,EAAUA,EAAQN,EAAUsG,SAG9B,OAAOhG,kBAGOkB,GACd,OACEA,GACgB,iBAATA,IACN6C,MAAM4B,QAAQzE,IACN,OAATA,KACEA,aAAgB+E,uBAKpB/E,EACAzB,EACAC,GAAkB,GAElB,MAAMM,EAASwF,OAAOU,OAAO,GAAIhF,GACjC,OAAIiF,EAAYC,SAASlF,IAAWiF,EAAYC,SAAS3G,IACvD+F,OAAOC,KAAKhG,GACT4G,OAAOpG,IAAQP,QAAmC,IAAhBD,EAAOQ,IACzCyF,QAAQzF,IACHkG,EAAYC,SAAS3G,EAAOQ,IAC9BA,KAAaiB,EAGXlB,EAAOC,GAAOkG,EAAYG,UACxBpF,EAAOjB,GACPR,EAAOQ,GACPP,GALF8F,OAAOU,OAAOlG,EAAQ,EAAGC,GAAMR,EAAOQ,KASxCuF,OAAOU,OAAOlG,EAAQ,EAAGC,GAAMR,EAAOQ,OAIvCD,kBAGOkB,GACd,MAAMzB,EAASsE,MAAM4B,QAAQzE,GAAO,GAAK,GACzC,UAAWxB,KAAQwB,EACjB,GAAIA,EAAIqF,eAAe7G,GAAO,CAC5B,MAAMM,EAAQkB,EAAIxB,GAEhBD,EAAOC,GADLM,GAA0B,iBAAVA,EACHJ,KAAK4G,SAASxG,GAEdA,EAIrB,OAAOP,wCAG6ByB,GACpC,MAAMzB,EAA0B,GAC1BC,EAAmB,GACnBM,EAAiB,GAEvB,UAAWC,KAAYiB,EACrB,GAAIA,EAAIqF,eAAetG,GAAW,CAChC,MAAMC,EAAoBD,EAASwG,cAC9BhH,EAAwB8G,eAAerG,GAK1CT,EAAwBS,GAAmBM,KAAK,EAC7CP,GAAWiB,EAAIjB,KALlBR,EAAwBS,GAAqB,CAC3C,EAAGD,GAAWiB,EAAIjB,KAQtBD,EAAeQ,KAAK,CAClBqF,IAAK5F,EACLyG,MAAOzG,EAAS8F,QAAQ,UAAW,IAAI5F,SAI7C,UAAWF,KAAuBR,EAChC,GAAIA,EAAwB8G,eAAetG,IACrCR,EAAwB8G,eAAetG,GAAsB,CAC/D,MAAMC,EACJT,EAAwBQ,GAC1B,GAAyC,IAArCC,EAA0BC,OAAc,CAE1C,MAAMC,EAAoBF,EAA0B,GACpDR,EAAiBO,GACfG,EAAkBoF,OAAOC,KAAKrF,GAAmB,YAC1CF,EAA0BC,OAAS,EAAG,CAE/C,MAAMC,EAA0BJ,EAC7BqG,OACC/C,GAAKA,EAAEuC,IAAIc,gBAAkB1G,EAAoB0G,eAElDC,OAAO,CAACtD,EAAME,IACNF,EAAKuD,EAAIrD,EAAQqD,EAAIvD,EAAOE,GAEvC9D,EAAiBU,EAAwByF,IAAIY,eAC3CvF,EAAId,EAAwByF,MAKtC,UAAW5F,KAAYiB,EACjBA,EAAIqF,eAAetG,WACdiB,EAAIjB,GAIf,UAAWA,KAAYP,EACjBA,EAAiB6G,eAAetG,KAClCiB,EAAIjB,GAAYP,EAAiBO,2BAKhBiB,GACrB,MAAMzB,EAAS,GACf,OAAI0G,EAAYC,SAASlF,IACvBsE,OAAOC,KAAKvE,GACTmF,OAAO3G,QAAoB,IAAbwB,EAAIxB,IAClBgG,QAAQhG,IAELD,EAAOC,GADLyG,EAAYC,SAASlF,EAAIxB,KAASqE,MAAM4B,QAAQzE,EAAIxB,IACxCyG,EAAYW,gBAAgB5F,EAAIxB,IAEhCwB,EAAIxB,KAIjBD,GAGLsE,MAAM4B,QAAQzE,GACTA,EAAIoE,IAAI5F,GAAKyG,EAAYW,gBAAgBpH,IAG3CwB,oBAGSA,GAChB,MAAMzB,EAAS,GACf,OAAI0G,EAAYC,SAASlF,IACvBsE,OAAOC,KAAKvE,GACTmF,OAAO3G,GAAoB,OAAbwB,EAAIxB,IAClBgG,QAAQhG,IAELD,EAAOC,GADLyG,EAAYC,SAASlF,EAAIxB,KAASqE,MAAM4B,QAAQzE,EAAIxB,IACxCyG,EAAYY,WAAW7F,EAAIxB,IAE3BwB,EAAIxB,KAIjBD,GAGLsE,MAAM4B,QAAQzE,GACTA,EAAIoE,IAAI5F,GAAKyG,EAAYY,WAAWrH,IAGtCwB,wBAGaA,EAAGzB,EAAGC,EAAY,MAAOM,GAQ7C,GAPkB,SAAdN,IACFD,EAAI,CAACyB,EAAIA,EAAIzB,GAAI,IAOX,OAANyB,GACM,KAANA,QACM,IAANA,GACM,OAANzB,GACM,KAANA,QACM,IAANA,EACA,CACA,MAAMW,EACJc,IAAMzB,EACF,OACM,IAANyB,EACA,OACM,IAANzB,GACA,EACM,OAANyB,EACA,EACM,OAANzB,GACA,EACM,KAANyB,EACA,GACA,EACN,MAAkB,SAAdxB,GACoB,IAAfM,EAAuBI,GAAwB,EAAZA,GAEtB,IAAfJ,GAAkC,EAAZI,EAAiBA,EAGhD,MAAMH,EAAK,GACLC,EAAK,GAYX,IAVAT,EAAI,GAAKA,GADTyB,EAAI,GAAKA,GAGP6E,QAAQ,eAAgB,CAAC3F,EAAGkD,EAAIE,KAChCvD,EAAGO,KAAK,CAAC8C,GAAM,IAAUE,GAAM,OAGjC/D,EAAEsG,QAAQ,eAAgB,CAAC3F,EAAGkD,EAAIE,KAChCtD,EAAGM,KAAK,CAAC8C,GAAM,IAAUE,GAAM,OAG1BvD,EAAGE,QAAUD,EAAGC,QAAQ,CAC7B,MAAMC,EAAKH,EAAG+F,QACR1C,EAAKpD,EAAG8F,QACRxC,EAAKpD,EAAG,GAAKkD,EAAG,IAAMlD,EAAG,GAAG4G,cAAc1D,EAAG,IACnD,GAAIE,EACF,OAAOA,EAIX,OAAOvD,EAAGE,OAASD,EAAGC,mCAWIe,EAAczB,GACxC,GAAIyB,IAASzB,EACX,OAAO,EAGT,MAAMC,EAAY8F,OAAOyB,oBAAoB/F,GACvClB,EAAYwF,OAAOyB,oBAAoBxH,GAC7C,GAAIC,EAAUS,SAAWH,EAAUG,OACjC,OAAO,EAGT,UAAWF,KAAQP,EACjB,GAAIwB,EAAKjB,KAAUR,EAAKQ,GACtB,OAAO,EAIX,OAAO,oBASSiB,EAAazB,GAQ7B,OAPe+F,OAAOC,KAAKvE,GACxBmF,OAAOrG,GAAOP,EAAKK,QAAQE,GAAO,GAClC4G,OAAO,CAAC5G,EAAMC,KACbD,EAAKC,GAAOiB,EAAIjB,GACTD,GACN,aCvRekH,uBACGhG,EAAazB,EAAkB,GAClD,MAAMC,EAAcyH,KAAKC,IAAI,GAAI3H,GACjC,OAAO0H,KAAKE,MAAOnG,EAAOxB,GAAeA,cCFPiB,GACxC,OAAOA,EAAEiG,OAAO,CAAC1F,EAAKzB,KACpByB,EAAIzB,GAAOA,EACJyB,GACNsE,OAAO8B,OAAO,oBCHjB,OAA+B,OAArB,EAAIH,KAAKI,UAAuB,GAAG1E,SAAS,IAAI2E,UAAU,gBAKpE,MADW,GAAGC,MAAOA,OAAQA,OAAQA,OAAQA,OAAQA,MAAOA,MAAOA,MACzDd,kBCJAe,QAAZ,OAAY/G,QAAa,KACvBA,mBACAA,mBACAA,yBACAA,yBAJU+G,EAAZ,IAAY/G,cAOZgH,cACS/H,aAAU,IAAIgI,kBAInB,OAAOhI,KAAKiI,mBAEH3G,GACTtB,KAAKiI,QAAU3G,EACftB,KAAKkI,QAAQC,KAAK7G,GASpB8G,UAAU9G,EAAoBzB,GAC5BG,KAAKqI,QAELrI,KAAKsI,SAAWtI,KAAKkI,QAClBK,MAAK,UACLH,UAAWtI,IACVE,KAAKwI,mBAAmB1I,GACxBwB,EAASmH,KAAK5I,EAAOG,QAI3B0I,cACE1I,KAAK2I,eACiB,IAAlB3I,KAAKsI,WACPtI,KAAKsI,SAASI,cACd1I,KAAKsI,cAAW,GAElBtI,KAAK4I,OAASd,EAAce,QAGpBL,mBAAmBlH,wDCvClBwH,gBAKXf,cAJO/H,cAAW,IAAI+I,IAAwB,GAEtC/I,SAAgB,GAIxBgJ,WACE,MAAMnJ,EAAKoJ,IACX,YAAKC,IAAItI,KAAKf,GACdG,KAAKmJ,SAAShB,KAAKnI,KAAKkJ,IAAI3I,QAErBV,EAGTuJ,WAAWvJ,GACT,MAAMC,EAAQE,KAAKkJ,IAAIhJ,QAAQL,IACjB,IAAVC,IAGJE,KAAKkJ,IAAIlE,OAAOlF,EAAO,GAEvBE,KAAKmJ,SAAShB,KAAKnI,KAAKkJ,IAAI3I,uDAtBnBQ,gCAAesI,QAAftI,EAAe,qBAFd,SAEDA,MCKAuI,gBACXvB,YAAoBlI,0BAEpB0J,UACE1J,EACAC,GAEA,MAAMM,EAAWP,EAAI2J,QAAQC,IAAI,uBACjC,GAAIrJ,EAAU,CACZ,MAAME,EAAST,EAAI6J,MAAM,CACvBF,QAAS3J,EAAI2J,QAAQG,OAAO,yBAE9B,GAAiB,UAAbvJ,EACF,OAAON,EAAK8J,OAAOtJ,GAIvB,MAAMD,EAAKL,KAAK6J,gBAAgBb,WAEhC,OAAOlJ,EAAK8J,OAAO/J,GAAK0I,MACtB,OAAS,KACPvI,KAAK6J,gBAAgBT,WAAW/I,oDArB3BU,GAAmBrB,qCAAnBqB,EAAmBsI,QAAnBtI,EAAmB,YAAnBA,MCJA+I,gBAAiBC,iBAE1B,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,CACT,CACEC,QAASC,KACTC,SAAUd,EACVe,OAAO,mDARJtJ,4DAJF,MAIEA,YCLAuJ,EAAmB,CAC9BC,IAAK,SACLC,YAAa,mBCMFC,gBAGX1C,YAAoBlI,mBAFZG,YAAiB,GAOlB0K,UAAU7K,GACf,OAAO0G,UAAoBvG,KAAK2K,OAAQ9K,GAMnC+K,KAAK/K,GACV,MAAMC,EAAaD,EAAQgL,SAAW,GACtC,IAAKhL,EAAQiL,KACX,YAAKH,OAAS7K,GACP,EAGT,MAAMM,EAAOJ,KAAK+K,SAAStB,IAAIU,MAE/B,OAAO,IAAIa,QAAQ,CAAC3K,EAASC,KAC3BF,EACGqJ,IAAI5J,EAAQiL,MACZvC,QACC0C,KAAYzK,IACV0K,QAAQC,IAAI,sBAAsBtL,EAAQiL,0BAC1CzK,GAAQ,MACD+K,KAAW5K,EAAM6K,OAAS,mBAGpCjD,UAAW5H,IACVR,KAAK2K,OAASpE,YACZA,YAAsB,CAAE+E,WAAWxL,GACnCU,GAEFH,GAAQ,qDAvCLU,GAAarB,yCAAbqB,EAAasI,QAAbtI,EAAa,qBAFZ,SAEDA,MCRFwK,GAAiB,IAAI7L,MAA8B,6BAEzBqB,GACnC,MAAO,CACLmJ,QAASqB,GACTC,SAAUzK,eAKZA,EACAO,GAEA,MAAO,IAAMP,EAAc6J,KAAKtJ,OCVrBmK,iBAAe1B,iBAExB,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,CAACyB,GAAqB,IDU9B,CACLxB,QAASxK,MACTiM,WAAYC,GACZvB,OAAO,EACPwB,KAAM,CAACpB,EAAec,qDClBbxK,4DAJF,MAIEA,eCMXgH,YACUzG,EACAzB,EACAC,EAAiB,QACjBM,GAHAJ,YACAA,cACAA,cACAA,cAGH8L,eAAexK,GACpB,MAAMzB,EAAckM,SAAQ,KAAazK,UACnCxB,KAAakM,MAAGnM,GAEtB,GAAIG,KAAK2K,SAAW3K,KAAKiM,OAAQ,CAC/B,MAAM3L,EAASN,KAAK2K,OAAOD,UAAU,mBACrC1K,KAAKiM,QAAU3L,GAAU6D,MAAM4B,QAAQzF,GAAUA,EAAS,CAACA,GAG7D,IAAKN,KAAKiM,QAAiC,IAAvBjM,KAAKiM,OAAO1L,OAC9B,OAAOT,EAGT,MAAMM,EAAcJ,KAAKiM,OAAoBvG,IAAKpF,GAChDN,KAAKkM,KAAKzC,IAAI,GAAGnJ,IAASgB,IAAOtB,KAAKmM,WAKxC,OAFgB,QAAc,CAACrM,KAAeM,IAE/BmI,MACb,OAAKjI,GACIA,EAAa0G,OAClB,CAACxG,EAAKkD,IAAY6C,YAAsB/F,EAAKkD,GAC7C,mBCrCR3C,EACAO,GAEA,OAAO,IAAI8K,GAAerL,OAAM,OAAW,EAAWO,eAWXP,GAC3C,MAAO,CACLmJ,QAASmC,KACTV,WAAY5K,GAAUuL,GACtBT,KAAM,CAAC1B,KAAYM,aCnBrBb,OAAOtI,GACL,IAAKA,EAAOiL,iBAAiBC,MAAMjM,OAIjC,MAAM,IAAIkM,MAFR,yFAKJ,GAAgC,SAA5BnL,EAAO2E,IAAIyG,OAAO,EAAG,GACvB,MAAM,IAAID,MAAM,YAAYnL,EAAO2E,mCAEnC,OAAO3E,EAAO2E,SCIP0G,iBAAiB5C,iBAE1B,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,CAAC2C,qDAJL7L,4DAXF,CACPsL,aAAwB,CACtBQ,0BAA2B,CACzB3C,QAASmC,KACTjC,SAAU0C,OAKNT,QAECtL,MCIAgM,iBAAgBhD,iBAEzB,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,kDAJJlJ,4DAnBF,CAACiM,KACRC,aAAqB,CACnBC,cAAe,qBACfC,QAAS,IACTC,gBAAiB,IACjBC,aAAc,+BACdC,aAAa,EACbC,aAAa,EACbC,YAAY,EACZC,cAAc,EACdC,UAAW,EACXC,mBAAmB,EACnBC,yBAAyB,EACzBC,iBAAiB,EACjBC,wBAAwB,QAKjB/M,MCnBAgN,iBAGXhG,YAAmBlI,oBAFXG,cAAmBA,KAAKgO,UAAUC,iBAGxC,MAAMnO,EAAOE,KAAKkO,cAClBlO,KAAKgO,UAAUG,eAAerO,GAGzBoO,cACL,OAAOlO,KAAKoO,SAASC,MAAM,SAAWrO,KAAKoO,SAAW,KAGjDE,YAAYzO,GACjBG,KAAKoO,SAAWvO,EAASwO,MAAM,SAAWxO,EAAW,KACrDG,KAAKgO,UAAUO,IAAIvO,KAAKoO,UACxBpO,KAAKgO,UAAUQ,WAAWxO,KAAKoO,wDAftBrN,GAAerB,wCAAfqB,EAAesI,QAAftI,EAAe,qBAFd,SAEDA,UCND0N,SAAZ,OAAY1N,UAAW,KACrB2N,cACA3N,kBACAA,oBACAA,cACAA,oBALU0N,GAAZ,IAAY1N,UCeC4N,iBAIX5G,YAC4BlI,EAClBC,EACAM,GAFkBJ,gBAClBA,qBACAA,uBANHA,eAAY,IAAI+I,IAA2B,IAQhD/I,KAAK4O,QAAU5O,KAAK6O,cAAcnE,UAAU,YAAc,gBAI1D,OAAO1K,KAAK+K,SAAStB,IAAIwD,MAG3B6B,UAAUjP,GACR,SAAUwL,MAAM0D,QAAS,EAClB/O,KAAKqL,MAAMxL,EAAUwL,MAAM2D,QAASnP,EAAUwL,MAAM4D,OAG7DD,QAAQnP,GACNG,KAAKkP,UAAU/G,KAAKnI,KAAKkP,UAAUpN,MAAMkE,OAAO,CAACnG,KAEjDA,EAAQ+O,QAAU/O,EAAQ+O,SAAW,GACrC,MAAM9O,EAAc,IAAIuG,KAUxB,GARAxG,EAAQ+O,QAAQO,KAAOtP,EAAQ+O,QAAQO,KAAOtP,EAAQ+O,QAAQO,KAAO,IAAI9I,KAAK,cAC9ExG,EAAQ+O,QAAQQ,GAAKvP,EAAQ+O,QAAQQ,GAAKvP,EAAQ+O,QAAQQ,GAAK,IAAI/I,KAAK,cACpC,iBAAzBxG,EAAQ+O,QAAQO,OACzBtP,EAAQ+O,QAAQO,KAAO,IAAI9I,KAAKA,KAAKnB,MAAMrF,EAAQ+O,QAAQO,KAAKhJ,QAAQ,KAAM,QAE9C,iBAAvBtG,EAAQ+O,QAAQQ,KACzBvP,EAAQ+O,QAAQQ,GAAK,IAAI/I,KAAKA,KAAKnB,MAAMrF,EAAQ+O,QAAQQ,GAAGjJ,QAAQ,KAAM,QAG1ErG,EAAcD,EAAQ+O,QAAQO,MAAQrP,EAAcD,EAAQ+O,QAAQQ,KAEpEvP,EAAUG,KAAKqP,eAAexP,IAElByP,KAAM,CAChB,IAAIlP,EACJ,OAAQP,EAAQiF,WACT2J,GAAYc,QACfnP,EAAeJ,KAAKwP,QAAQ3P,EAAQyP,KAAMzP,EAAQoP,MAAOpP,EAAQ+O,SACjE,WACGH,GAAYC,MACftO,EAAeJ,KAAKqL,MAAMxL,EAAQyP,KAAMzP,EAAQoP,MAAOpP,EAAQ+O,SAC/D,WACGH,GAAYgB,KACfrP,EAAeJ,KAAK0P,KAAK7P,EAAQyP,KAAMzP,EAAQoP,MAAOpP,EAAQ+O,SAC9D,WACGH,GAAYkB,WACZlB,GAAYmB,QACfxP,EAAeJ,KAAK6P,MAAMhQ,EAAQyP,KAAMzP,EAAQoP,MAAOpP,EAAQ+O,SAC/D,cAEAxO,EAAeJ,KAAK0P,KAAK7P,EAAQyP,KAAMzP,EAAQoP,MAAOpP,EAAQ+O,SAGlE/O,EAAQ+O,QAAQhK,GAAKxE,EAAa0P,SAKxCN,QAAQ3P,EAAcC,EAAgB,2BAA4BM,EAAqC,IACrG,MAAMC,EAAUL,KAAK+P,gBAAgB/B,UAAUgC,QAAQnQ,GACjDS,EAAkBN,KAAK+P,gBAAgB/B,UAAUgC,QAAQlQ,GAC/D,OAAOE,KAAKiQ,OAAOT,QAAQnP,EAASC,EAAiBF,GAGvDiL,MAAMxL,EAAcC,EAAgB,yBAA0BM,EAAqC,IACjG,MAAMC,EAAUL,KAAK+P,gBAAgB/B,UAAUgC,QAAQnQ,GACjDS,EAAkBN,KAAK+P,gBAAgB/B,UAAUgC,QAAQlQ,GAC/D,OAAOE,KAAKiQ,OAAO5E,MAAMhL,EAASC,EAAiBF,GAGrDsP,KAAK7P,EAAcC,EAAgB,wBAAyBM,EAAqC,IAC/F,MAAMC,EAAUL,KAAK+P,gBAAgB/B,UAAUgC,QAAQnQ,GACjDS,EAAkBN,KAAK+P,gBAAgB/B,UAAUgC,QAAQlQ,GAC/D,OAAOE,KAAKiQ,OAAOP,KAAKrP,EAASC,EAAiBF,GAGpDyP,MAAMhQ,EAAcC,EAAgB,yBAA0BM,EAAqC,IACjG,MAAMC,EAAUL,KAAK+P,gBAAgB/B,UAAUgC,QAAQnQ,GACjDS,EAAkBN,KAAK+P,gBAAgB/B,UAAUgC,QAAQlQ,GAC/D,OAAOE,KAAKiQ,OAAOC,QAAQ7P,EAASC,EAAiBF,GAGvD+P,OAAOtQ,GACLG,KAAKiQ,OAAOE,OAAOtQ,GAGrBuQ,uBACE,UAAWvQ,KAAQG,KAAKkP,UAAUpN,MAC5BjC,EAAKiF,OAAS2J,GAAYC,OAC5B1O,KAAKmQ,OAAOtQ,EAAK+O,QAAQhK,IAKvByK,eAAexP,GACrB,IAAKG,KAAK4O,QAAQyB,UAAYxQ,EAAQyQ,KACpC,OAAOzQ,EAGT,IAAIC,EAAOE,KAAK4O,QAAQyB,SACxB,SAAOvQ,EAAKqG,QAAQ,UAAWtG,EAAQyP,MACvCxP,EAAOA,EAAKqG,QAAQ,WAAYtG,EAAQoP,OAExCpP,EAAQyQ,UAAO,EACfzQ,EAAQyP,KAAOxP,EACfD,EAAQoP,WAAQ,EACTpP,gDAjHEkB,GAAcrB,MAKfA,OAAQA,+CALPqB,EAAcsI,QAAdtI,EAAc,qBAFb,SAEDA,MCGAwP,iBACXxI,YACUlI,EACAC,GADAE,sBACAA,gBAGVuJ,UACE1J,EACAC,GAEA,MAAMM,EAAiB,CAAEoQ,eAAW,GACpC,OAAO1Q,EAAK8J,OAAO/J,GAAK0I,MACtB,OAAWlI,GAASL,KAAKyQ,YAAYpQ,EAAOD,KAC5C,OAAS,KACPJ,KAAK0Q,kBAAkBtQ,GACvBJ,KAAK2Q,oBAAoBvQ,MAKvBqQ,YACN5Q,EACAC,GAEA,GAAID,aAAqBsK,KAAmB,CAC1C,MAAM/J,EAA+B,WAApBP,EAAUwL,MAAqBxL,EAAUwL,MAAQ,GAClEjL,EAAS4O,QAAUnP,EAAUwL,MAAM2D,SAAWnP,EAAU+Q,WACxDxQ,EAAS2O,QAAS,EAElBlP,EAAY,IAAIsK,KAAkB,CAChCkB,MAAOjL,EACPoJ,QAAS3J,EAAU2J,QACnBZ,OAAQ/I,EAAU+I,OAClBgI,WAAY/Q,EAAU+Q,WACtBC,IAAKhR,EAAUgR,MAInB,SAAeL,UAAY3Q,KACpBuL,KAAWvL,GAGZ6Q,kBAAkB7Q,GACxB,MAAMC,EAAYD,EAAe2Q,UAC7B1Q,GAAaA,EAAUuL,MAAMyF,YAC/BhR,EAAUuL,MAAM0D,QAAS,EACzB/O,KAAK+Q,eAAe1F,MAAMvL,EAAUuL,MAAM2D,QAASlP,EAAUuL,MAAM4D,QAI/D0B,oBAAoB9Q,GAG1B,MAAMC,EAAYD,EAAe2Q,UACjC,GAAI1Q,IAAcA,EAAUuL,MAAM0D,OAAQ,CACxC,MAAM3O,EAAYJ,KAAK+K,SAAStB,IAAIsE,IAAiBC,UAC/C3N,EAAUD,EAAU4P,QAAQ,oCAC5B1P,EAAQF,EAAU4P,QAAQ,kCAChClQ,EAAUuL,MAAM0D,QAAS,EACzB/O,KAAK+Q,eAAe1F,MAAMhL,EAASC,kDA3D5BS,GAAgBrB,mDAAhBqB,EAAgBsI,QAAhBtI,EAAgB,qBAFf,SAEDA,MCHAiQ,iBAcXjJ,YAAoClI,GAClC,GAAIA,EACF,MAAM,IAAI4M,MACR,sFAfJ,MAAO,CACLzC,SAAUjJ,EACVkJ,UAAW,CACT,CACEC,QAASC,KACTC,SAAUmG,GACVlG,OAAO,mDARJtJ,GAAcrB,MAcyBqB,EAAc,8BAdrDA,gCAJF,MAIEA,MCFb,MAAMkQ,GAAqB,CACzBC,KAAM,SACN5F,QAAS,EACT6F,iBAAkB,CAAC,CACjBC,MAAO,UACPC,YAAa,CAAEC,QAAS,MAAOC,eAAe,GAC9CC,YAAa,CACX,CAAEN,KAAM,WAAYO,QAAS,WAAY7C,QAAS,CAAE8C,QAAQ,YAwBrDC,iBAQX5J,YAAYlI,EAAkCC,GAC5CD,EAAgB+R,cACd9R,EAAa+R,+BACX,sDATJ,MAAO,CACL7H,SAAUjJ,EACVkJ,UAAW,kDAJJlJ,GAAarB,kDAAbqB,gCAnBF,CACPiM,KACA7C,KACAL,EAAkBC,UAClB0B,GAAgB1B,UAChBiH,GAAejH,UACf4C,GAAkB5C,UAClBgD,GAAiBhD,UACjB+H,aAA2Bb,KAI3BnH,EACA2B,GACAuF,GACArE,GACAI,MAGShM,MCtCFgR,GAAwB,IAAIrS,MACrC,uBAaWsS,iBAGXjK,YACUlI,EACDC,EAGPM,GAJQJ,cACDA,aA4BPA,KAAK4O,QAAUhJ,OAAOU,OAAO,GAvBN,CACrB2L,UAAW,SACXC,QAAS,OACTC,cAAe,aACfC,WAAY,UACZC,UAAW,SACXC,mBAAoB,gBACpBC,oBAAqB,kBACrBC,mBAAoB,UACpBC,qBAAsB,iBACtBC,QAAS,OACTC,UAAW,SACXC,aAAe,YACfC,WAAY,UACZC,cAAgB,aAChBC,aAAc,YACdC,gBAAkB,eAClBC,cAAe,aACfC,iBAAmB,gBACnBC,cAAe,aACfC,iBAAmB,gBACnBC,UAAW,UAEoCjT,qBAIjD,IAAIP,EAAMyT,mBAAmBC,SAASC,QACtC,GAAI3T,EAAI4T,SAAS,WAAS,CACxB5T,EAAMA,EAAIsG,QAAQ,SAAO,WACzB,MAAMrG,EAAmBD,EACxBuD,MAAM,GACNO,MAAM,KACN+B,IAAItF,GAAKA,EAAEuD,MAAM,MACjBqD,OAAO,CAAC5G,EAAKC,KACZ,MAAOC,EAAKE,GAASH,EAAKqF,IAAI4N,oBAC9B,SAAIhT,GAAOE,EACJJ,GACN,IACHJ,KAAK0T,OAAOC,SAAS,GAAI,CAAEC,gBAE7B,OAAO5T,KAAK6T,MAAMD,0DAnDT7S,GAAYrB,8BAMbqS,GAAqB,+BANpBhR,EAAYsI,QAAZtI,EAAY,qBAFX,SAEDA,UCpBD+S,SAAZ,OAAY/S,UAAK,KACfgT,gBACAhT,kBACAA,oBAHU+S,GAAZ,IAAY/S,MAMAiT,SAAZ,OAAYjT,UAAgB,KAC1BkT,oBACAlT,wBAFUiT,GAAZ,IAAYjT,UCICmT,iBAIXnM,YAAYlI,GAHLG,YAAS,IAAI+I,SAAuB,GACpC/I,kBAAe,IAAI+I,SAAkC,GAG1DlJ,EACGsU,QAAQ,CAACC,wBACThM,UAAUtI,IACLA,EAAIuU,UACNrU,KAAKsU,OAAOnM,KAAK2L,GAAMC,QACvB/T,KAAKuU,aAAapM,KAAK6L,GAAiBQ,cAI9C3U,EAAmBsU,QAAQ,CAACC,uBAA8BhM,UAAUtI,IAC9DA,EAAIuU,UACNrU,KAAKsU,OAAOnM,KAAK2L,GAAMC,QACvB/T,KAAKuU,aAAapM,KAAK6L,GAAiBC,aAI5CpU,EAAmBsU,QAAQ,CAACC,uBAA8BhM,UAAUtI,IAC9DA,EAAIuU,UACNrU,KAAKsU,OAAOnM,KAAK2L,GAAMW,QACvBzU,KAAKuU,aAAapM,KAAK6L,GAAiBQ,cAI5C3U,EAAmBsU,QAAQ,CAACC,sBAA6BhM,UAAUtI,IAC7DA,EAAIuU,UACNrU,KAAKsU,OAAOnM,KAAK2L,GAAMW,QACvBzU,KAAKuU,aAAapM,KAAK6L,GAAiBC,aAI5CpU,EAAmBsU,QAAQ,CAACC,oBAA2BhM,UAAUtI,IAC3DA,EAAIuU,UACNrU,KAAKsU,OAAOnM,KAAK2L,GAAMY,SACvB1U,KAAKuU,aAAapM,KAAK6L,GAAiBQ,cAI5C3U,EAAmBsU,QAAQ,CAACC,mBAA0BhM,UAAUtI,IAC1DA,EAAIuU,UACNrU,KAAKsU,OAAOnM,KAAK2L,GAAMY,SACvB1U,KAAKuU,aAAapM,KAAK6L,GAAiBC,aAK9CU,WACE,OAAO3U,KAAKsU,OAAOxS,MAGrB8S,iBACE,OAAO5U,KAAKuU,aAAazS,MAG3B+S,gBACE,MAAO,iBAAkBjT,SAASkT,gBAGpCC,WAEE,MAAiB,WADH/U,KAAK2U,WAIrBK,YAEE,MAAiB,YADHhV,KAAK2U,yDApEV5T,GAAYrB,wCAAZqB,EAAYsI,QAAZtI,EAAY,qBAFX,SAEDA,UCVDkU,SAAZ,OAAYlU,UAAY,KACtBmU,kBACAnU,gBAFUkU,GAAZ,IAAYlU,MAiBAoU,SAAZ,OAAYpU,UAAuB,KACjCsD,cACAtD,sBACAA,oBACAA,oBAJUoU,GAAZ,IAAYpU,UCRCqU,iBAKXrN,YAAoBlI,iBAFbG,oBAAuD,IAAI+I,SAAgB,GAGhF/I,KAAK4O,QAAU5O,KAAK2K,OAAOD,UAAU,YAAc,CAAEzE,IAAK,OAK5DwD,IAAI5J,EAAaC,GACf,IAAIM,EAUJ,KARKN,GAASA,IAAUmV,GAAaC,WACnC9U,EAAQiV,eAAeC,QAAQ,GAAGtV,KAAK4O,QAAQ3I,OAAOpG,OAGpDC,IAAUmV,GAAaM,QAAWnV,IAAUN,KAC9CM,EAAQoV,aAAaF,QAAQ,GAAGtV,KAAK4O,QAAQ3I,OAAOpG,MAGlDO,EACF,IACEA,EAAQ6E,KAAKC,MAAM9E,SACnBC,GACAD,EAAQA,EAIZ,OAAOA,EAGTqV,IACE5V,EACAC,EACAM,EAAsB6U,GAAaM,OAEnC,MAAMlV,EAAgBL,KAAKyJ,IAAI5J,EAAKO,GAChCA,IAAU6U,GAAaC,QACzBG,eAAeK,QACb,GAAG1V,KAAK4O,QAAQ3I,OAAOpG,IACvBoF,KAAKE,UAAUrF,IAGjB0V,aAAaE,QAAQ,GAAG1V,KAAK4O,QAAQ3I,OAAOpG,IAAOoF,KAAKE,UAAUrF,IAEpE,MAAMQ,EAAeN,KAAKyJ,IAAI5J,EAAKO,GAE/BE,IAAiBD,GACnBL,KAAK2V,eAAexN,KAAK,CACvBlC,MAAK2P,QACLC,WAAyB,IAAlBxV,EAA8B8U,GAAwB7P,SAAW6P,GAAwB9Q,MAChGyR,gBACAC,iBAKN5F,OAAOtQ,EAAaC,EAAsBmV,GAAaM,OACrD,MAAMnV,EAAgBJ,KAAKyJ,IAAI5J,EAAKC,GAChCA,IAAUmV,GAAaC,QACzBG,eAAeW,WAAW,GAAGhW,KAAK4O,QAAQ3I,OAAOpG,KAEjD2V,aAAaQ,WAAW,GAAGhW,KAAK4O,QAAQ3I,OAAOpG,KAEjDG,KAAK2V,eAAexN,KAAK,CAAClC,MAAK2P,QAAOC,MAAOV,GAAwBc,QAASH,kBAGhFI,MAAMrW,EAAsBoV,GAAaM,OACnC1V,IAAUoV,GAAaC,QACzBG,eAAea,QAEfV,aAAaU,QAEflW,KAAK2V,eAAexN,KAAK,CAACyN,QAAOC,MAAOV,GAAwBgB,wDA3EvDpV,GAAcrB,qCAAdqB,EAAcsI,QAAdtI,EAAc,qBAFb,SAEDA,MCLb,YAAmBA,EAAWO,EAAqBzB,GAGjD,OAAQkB,GAAKO,GADE,GAAKzB,GAAU,MAQnBuW,iBAIXrO,cAHQ/H,iBAAc,IAAIqW,IAClBrW,iBAAc,IAAIqW,IAGxBrW,KAAKsW,sBAGCA,sBAGN,QAASzW,EAAI,EAAGA,EAAI,GAAIA,IACtBG,KAAKuW,YAAYd,IAAIhV,OAAOI,aAAa,IAAId,WAAW,GAAKF,GAAIA,GACjEG,KAAKwW,YAAYf,IAAI5V,EAAGY,OAAOI,aAAa,IAAId,WAAW,GAAKF,IAGlE,QAASA,EAAI,EAAGA,EAAI,GAAIA,IACtBG,KAAKuW,YAAYd,IAAIhV,OAAOI,aAAa,IAAId,WAAW,GAAKF,GAAIA,EAAI,IACrEG,KAAKwW,YAAYf,IAAI5V,EAAI,GAAIY,OAAOI,aAAa,IAAId,WAAW,GAAKF,IAGvE,QAASA,EAAI,EAAGA,EAAI,GAAIA,IACtBG,KAAKuW,YAAYd,IAAIhV,OAAOI,aAAa,IAAId,WAAW,GAAKF,GAAIA,EAAI,IACrEG,KAAKwW,YAAYf,IAAI5V,EAAI,GAAIY,OAAOI,aAAa,IAAId,WAAW,GAAKF,IAGvEG,KAAKuW,YAAYd,IAAI,IAAK,IAC1BzV,KAAKuW,YAAYd,IAAI,IAAK,IAC1BzV,KAAKwW,YAAYf,IAAI,GAAI,KACzBzV,KAAKwW,YAAYf,IAAI,GAAI,KAG3BgB,aAAa5W,GACX,OAAKA,EAIc,IAAI6W,IAAYtW,IACjC,MAAMC,EAAS,IAAIsW,WACnBtW,EAAOuW,cAAc/W,GACrBQ,EAAOwW,OAAS,KACd,MAAMvW,EAASD,EAAOyW,OAAOC,UACvBvW,EAASF,EAAOoM,OAAOpM,EAAOJ,QAAQ,KAAO,GAC7CwD,EAAa1D,KAAKgX,qBAAqBxW,GAI7CJ,EAAS+H,KAH8B,CAAE5H,OAAQC,EAAOD,OACfuE,KAAMjF,EAAKiF,KACXmS,OAAQvT,YAZnD,EAmBJwT,eAAerX,GAEb,MAEMQ,EAAuBL,KAAKmX,uBAFnBtX,EAAeoX,OACfpX,EAAeU,QAExBD,EAAiB8W,KAAK/W,GACtBG,EAAc,IAAI2D,MAAM7D,EAAeC,QAC7C,QAASsD,EAAI,EAAGA,EAAIvD,EAAeC,OAAQsD,IACvCrD,EAAYqD,GAAKvD,EAAeP,WAAW8D,GAE/C,MAAMH,EAAY,IAAI2T,WAAW7W,GAGjC,OAFa,IAAI8W,KAAK,CAAC5T,GAAY,CAACoB,KAAMjF,EAAeiF,OAKnDkS,qBAAqBnX,GAE3B,IAAIC,EAAM,GACNM,EAAO,GACPC,EAAM,EACNC,EAAM,EACV,UAAWE,KAAKX,EAAG,CACjB,MAAM6D,EAAQ1D,KAAKuW,YAAY9M,IAAIjJ,GAC/BJ,EAAO,GACTA,GAAQ,EACRC,GAAOqD,GAAStD,IAEhBE,EAAM,EAAIF,EACVC,GAAOqD,GAASpD,EAChBR,GAAOW,OAAOI,aAAaR,GAC3BA,EAAOqD,GAAW,GAAKpD,EACvBF,EAAO,GAAKE,GAGhB,OAAIT,EAAEU,OAAS,GAAM,IACnBT,GAAOW,OAAOI,aAAaR,IAGtBI,OAAOI,aAAa,MAAQf,EAG7BqX,uBAAuBtX,EAAWC,GAExC,IAAKD,EACH,OAGF,GAAwB,OAApBA,EAAEE,WAAW,GACf,OAAOF,EAGT,IAAIO,EAAM,EACNC,EAAM,EACNC,EAAO,GACPE,EAAM,GACNkD,EAAI,EACJE,EAAQ/D,EAAEE,WAAW2D,GACzB,QAASG,EAAI,EAAGA,EAAI/D,EAAQ+D,IACtBvD,EAAO,GACTA,GAAQ,EACRF,EAAMmX,GAAU3T,EAAOtD,EAAM,GAC7BE,GAAOR,KAAKwW,YAAY/M,IAAIrJ,KAE5BC,EAAM,EAAIC,EACVF,EAAMmX,GAAU3T,EAAO,EAAGtD,IAASD,EACnCuD,EAAQ/D,EAAEE,aAAa2D,GACvBtD,GAAOmX,GAAU3T,EAAO,GAAKvD,EAAKA,GAClCG,GAAOR,KAAKwW,YAAY/M,IAAIrJ,GAC5BE,EAAO,GAAKD,GAGhB,OAAOG,gDA7HEO,gCAAkBsI,QAAlBtI,EAAkB,qBAFjB,SAEDA,MCHAyW,iBAUXzP,YACUlI,EACAC,GADAE,sBACAA,gBAXFA,6BAA0B,IAAIN,MAK9BM,WAAyB,CAC/ByX,WAAYvW,OAAOC,UAAUuW,QAO3B1X,KAAK2X,oBAGDA,oBACN3X,KAAK4X,oBAAqB,OAAU1W,OAAQ,UAAUkH,UAAU,KAC1DpI,KAAK6X,mBACP7X,KAAK+Q,eAAeZ,OAAOnQ,KAAK6X,mBAElC,MAAMhY,EAAYG,KAAK+K,SAAStB,IAAIsE,IAAiBC,UAC/ClO,EAAUD,EAAUmQ,QAAQ,mCAC5B5P,EAAQP,EAAUmQ,QAAQ,iCAC1B3P,EAAaL,KAAK+Q,eAAerB,KAAK5P,EAASM,GACrDJ,KAAK6X,kBAAoBxX,EAAWyP,QACpC9P,KAAK8X,MAAML,YAAa,EACxBzX,KAAK+X,cAGP/X,KAAKgY,qBAAsB,OAAU9W,OAAQ,WAAWkH,UAAU,KAC5DpI,KAAK6X,mBACP7X,KAAK+Q,eAAeZ,OAAOnQ,KAAK6X,mBAElC,MAAMhY,EAAYG,KAAK+K,SAAStB,IAAIsE,IAAiBC,UAC/ClO,EAAUD,EAAUmQ,QAAQ,oCAC5B5P,EAAQP,EAAUmQ,QAAQ,kCAC1B3P,EAAaL,KAAK+Q,eAAerB,KAAK5P,EAASM,GACrDJ,KAAK6X,kBAAoBxX,EAAWyP,QACpC9P,KAAK8X,MAAML,YAAa,EACxBzX,KAAK+X,cAIDA,YACN/X,KAAKiY,wBAAwBC,KAAKlY,KAAK8X,OAGzCK,cACE,IACEnY,KAAKgY,oBAAoBtP,cACzB1I,KAAK4X,mBAAmBlP,oBACjB7I,KAGXuY,aAAavY,GAAc,GACzB,OAAOA,EACHG,KAAKiY,wBAAwB1P,MAC3B,OAAa,MACb,OAAUvI,KAAK8X,QAEjB9X,KAAKiY,wBAAwB1P,QAAK8P,KAAa,oDA9D1CtX,GAAcrB,mDAAdqB,EAAcsI,QAAdtI,EAAc,qBAFb,SAEDA,oYCLDuX,SAAZ,OAAYvX,UAAyB,KACnCwX,kBACAxX,cACAA,oCACAA,sBACAA,cACAA,4BANUuX,GAAZ,IAAYvX,MASAyX,SAAZ,OAAYzX,UAAyB,KACnC0X,YACA1X,oBACAA,kBAHUyX,GAAZ,IAAYzX,MAMA2X,SAAZ,OAAY3X,UAAyB,KACnC4X,YACA5X,YACAA,cAHU2X,GAAZ,IAAY3X,kBCNsBA,EAAgBO,GAChD,OAAO,SAAEP,EAAQO,GAAUsX,uBAWD7X,GAC1B,MAAMO,EAAQP,EAAe8X,MAAQ,GACrC,OAAOvX,EAAKsD,GAAKtD,EAAKsD,GAAKkU,GAAkB/X,EAAQO,EAAKyX,YAAc,kBAS3ChY,GAC7B,MAAMO,EAAQP,EAAe8X,MAAQ,GACrC,OAAOvX,EAAK2N,MAAQ3N,EAAK2N,MAAQ6J,GAAkB/X,EAAQO,EAAK0X,eAAiB,qBAoBrDjY,GAC5B,MAAMO,EAAQP,EAAe8X,MAAQ,GACrC,OAAOvX,EAAK2X,KAAO3X,EAAK2X,KAAOH,GAAkB/X,EAAQO,EAAK4X,cAAgB,iBClC9EnR,YAAYzG,EAAqC,IAdxCtB,WAAQ,IAAIqW,IAKZrW,aAAU,IAAImZ,KAAoB,GAUzCnZ,KAAKoR,MAAQ9P,EAAQ8P,MAAQ9P,EAAQ8P,WAAQ,EAC7CpR,KAAKoZ,OAAS9X,EAAQ8X,OAClB9X,EAAQ8X,OACPpZ,KAAKoR,MAAQpR,KAAKoR,MAAMgI,OAASC,GACtCrZ,KAAKmI,OAMP+N,QACMlW,KAAKsZ,MAAMC,KAAO,IACpBvZ,KAAKsZ,MAAMpD,QACXlW,KAAKmI,QASTsB,IAAInI,GACF,OAAQtB,KAAKsZ,MAAM7P,IAAIzJ,KAAKoZ,OAAO9X,KAAY,GAQjDmU,IAAInU,EAAWzB,GACbG,KAAKwZ,QAAQ,CAAClY,GAASzB,GAQzB2Z,QAAQlY,EAAezB,GACrByB,EAASwE,QAAShG,IAChBE,KAAKsZ,MAAM7D,IAAIzV,KAAKoZ,OAAOtZ,GAAS8F,OAAOU,OAAO,GAAIzG,MAExDG,KAAKmI,OAQPsR,OAAOnY,GACL6C,MAAMgL,KAAKnP,KAAKsZ,MAAMzT,QAAQC,QAASjG,IACrCG,KAAKsZ,MAAM7D,IAAI5V,EAAK+F,OAAOU,OAAO,GAAIhF,MAExCtB,KAAKmI,OAQPuR,OAAOpY,EAAWzB,EAAqBC,GAAY,GACjDE,KAAK2Z,WAAW,CAACrY,GAASzB,EAASC,GAQrC6Z,WAAWrY,EAAezB,EAAqBC,GAAY,GACzD,IAAkB,IAAdA,EACF,OAAOE,KAAK4Z,oBAAoBtY,EAAUzB,GAG5CyB,EAASwE,QAAS1F,IAChB,MAAMC,EAAQuF,OAAOU,OAAO,GAAItG,KAAKyJ,IAAIrJ,GAASP,GAClDG,KAAKsZ,MAAM7D,IAAIzV,KAAKoZ,OAAOhZ,GAASC,KAEtCL,KAAKmI,OAQP0R,QAAQvY,EAAWzB,GACjBG,KAAK8Z,YAAY,CAACxY,GAASzB,GAQ7Bia,YAAYxY,EAAezB,GACzByB,EAASwE,QAAShG,IAChB,MAAMM,EAAeJ,KAAKyJ,IAAI3J,GACxBO,EAAUR,EAAKmH,OAAO,CAACtD,EAA+BE,KAC1DF,EAAIE,GAAOxD,EAAawD,KAAQ,EACzBF,GACN,IACGpD,EAAkBN,KAAK+Z,eAAe1Z,GACtCG,EAAQoF,OAAOU,OAAO,GAAIlG,EAAcE,GAC9CN,KAAKsZ,MAAM7D,IAAIzV,KAAKoZ,OAAOtZ,GAASU,KAEtCR,KAAKmI,OAQP6R,UAAU1Y,GACR,MAAMzB,EAAUG,KAAKia,aACrB9V,MAAMgL,KAAKtP,GAASiG,QAAShG,IAC3B,MAAMM,EAAQwF,OAAOU,OAAO,GAAItG,KAAKsZ,MAAM7P,IAAI3J,GAAMwB,GACrDtB,KAAKsZ,MAAM7D,IAAI3V,EAAKM,KAEtBJ,KAAKmI,OAUCyR,oBAAoBtY,EAAezB,GACzC,MAAMC,EAAiBE,KAAK+Z,eAAela,GAErCO,EAAOkB,EAASoE,IAAKpF,GAAcN,KAAKoZ,OAAO9Y,IACrC,IAAIqF,IAAIvF,EAAK4F,OAAO7B,MAAMgL,KAAKnP,KAAKia,gBAC5CnU,QAASxF,IACf,MAAME,EAAQR,KAAKsZ,MAAM7P,IAAInJ,IAAQ,GAEjCF,EAAKF,QAAQI,IAAQ,EACvBN,KAAKsZ,MAAM7D,IAAInV,EAAKsF,OAAOU,OAAO,GAAI9F,EAAOX,KAQxB,IAAjB+F,OAJwBC,KAAK/F,GAAgBoa,KAAMtW,QACzB,IAArBpD,EAAMoD,IACXpD,EAAMoD,KAAe9D,EAAe8D,KAGtC5D,KAAKsZ,MAAM7D,IAAInV,EAAKsF,OAAOU,OAAO,GAAI9F,EAAOV,MAKnDE,KAAKmI,OASC4R,eAAezY,GACrB,OAAOsE,OAAOuU,QAAQ7Y,GAAS0F,OAAO,CAACnH,EAA4BC,KACjE,MAAOM,EAAWC,GAASP,EAC3B,MAAqB,kBAAVO,IACRR,EAA0BO,IAAcC,GAEpCR,GACN,IAOGoa,aACN,MAAM3Y,EAAYtB,KAAKoR,MAAQjN,MAAMgL,KAAKnP,KAAKoR,MAAMkI,MAAMzT,QAAU,GACrE,OAAO,IAAIF,IAAIxB,MAAMgL,KAAKnP,KAAKsZ,MAAMzT,QAAQG,OAAO1E,IAM9C6G,OACNnI,KAAKoa,QAAQjS,iBCxIfJ,YAAoBzG,kBA7DXtB,aAAU,IAAI+I,IAAqB,IAUpC/I,aAAS,EAKTA,WAA4B,GAK5BA,aAAU,IAAI+I,SAAgB,GAK9B/I,cAAkD,IAAI+I,IAAgB,IAKtE/I,iBAA+C,IAAIqW,IAKnDrW,WAAQ,IAAI+I,SAAgB,GAM5B/I,aAA6C,IAAI+I,SAAgB,GAKhE/I,YAAS,IAAI+I,IAAwB,GAMrC/I,YAAS,IAAI+I,KAAyB,gBAZd,OAAO/I,KAAKqa,QAAQvY,kBAO/B,OAAO9B,KAAKsa,OAAOxY,kBAMlB,OAAO9B,KAAKua,OAAOzY,kBAKT,OAAO9B,KAAKwa,OAU7C/Q,IAAInI,GACF,QAAoB,IAAhBtB,KAAKwa,OACP,MAAM,IAAI/N,MAAM,kEAElB,OAAOzM,KAAKsZ,MAAM7P,IAAInI,GAOxBmZ,MACE,OAAOza,KAAK0a,QAAQ5Y,MAOtB6Y,OACE,OAAO3a,KAAK0a,QAOdE,QAAQtZ,GACN,OAAOtB,KAAK0a,QAAQ5Y,MAAM+Y,KAAKvZ,GAOjCwZ,SAASxZ,GACP,OAAOtB,KAAK0a,QAAQnS,MAAK,OAAK1I,GAAgBA,EAAOgb,KAAKvZ,KAO5DyZ,OAAOzZ,GACL,OAAOtB,KAAK0a,QAAQ5Y,MAAM2E,OAAOnF,GAOnC0Z,QAAQ1Z,GACN,OAAOtB,KAAK0a,QAAQnS,MAAK,OAAK1I,GAAgBA,EAAO4G,OAAOnF,KAM9D4U,QACElW,KAAKyG,YAAO,GACZzG,KAAKib,UAAK,GAGZC,eACwB,IAAlBlb,KAAKmb,UACPnb,KAAKmb,SAASzS,cAEhB1I,KAAKkW,QAQPkF,YAAY9Z,GACV,YAAKkZ,OAAS,IAAInE,IAClBrW,KAAKqa,QAAQlS,KAAK7G,GACXtB,KAQTc,KAAKQ,GACH,IAAoB,IAAhBtB,KAAKqb,OACP,MAAM,IAAI5O,MAAM,qEAElB,YAAK6O,MAAM1a,KAAKU,GACTtB,KAQTyG,OAAOnF,GACL,YAAKia,QAAQpT,KAAK7G,GACXtB,KAOTwb,UAAUla,GACR,MAAMzB,EAAKoJ,IACX,YAAKwS,YAAYhG,IAAI5V,EAAIyB,GACzBtB,KAAK0b,SAASvT,KAAKhE,MAAMgL,KAAKnP,KAAKyb,YAAYE,WACxC9b,EAOT+b,aAAata,GACXtB,KAAKyb,YAAY9R,OAAOrI,GACxBtB,KAAK0b,SAASvT,KAAKhE,MAAMgL,KAAKnP,KAAKyb,YAAYE,WAQjDV,KAAK3Z,GACH,YAAKua,MAAM1T,KAAK7G,GACTtB,KAOT8b,OACE9b,KAAKqb,QAAS,EAEd,MAAMxb,EAAe,CADLG,KAAKsb,MAAM/a,OAAS,EAAIP,KAAK+b,mBAAqB/b,KAAKgc,aAGrEhc,KAAK0b,SACL1b,KAAKub,QACLvb,KAAK6b,MACL7b,KAAKqa,SAGPra,KAAKmb,UAAW,QAActb,GAC3B0I,QAAK0T,MAAK,IAAI,OAAa,IAC3B7T,UAAWtI,IACV,MAAOM,EAASC,EAASC,EAAQE,EAAMkD,GAAU5D,EAC3C8D,EAAS5D,KAAKkc,cAAc9b,EAASC,EAASC,EAAQE,GAE5DR,KAAKmc,UAAUvY,OADkB,IAAXF,KASpBsY,aACN,OAAOhc,KAAKoc,QAONL,mBACN,MAAMza,EAAW,CAACtB,KAAKoc,WAASC,MAC9Brc,KAAKsb,MAAM5V,IAAK7F,GAA2BA,EAAKyc,UAGlD,SAAOD,MAAc/a,GAClBiH,MACC,OAAK1I,IACH,MAAOC,EAAUM,GAAYP,EAC7B,OAAOC,EAASkH,OAAO,CAAC3G,EAAaC,KACnC,MAAME,EAAQR,KAAKuc,mBAAmBjc,EAAQF,GAC9C,YAAc,IAAVI,GACFH,EAAOO,KAAKJ,GAEPH,GACN,OASHkc,mBAAmBjb,EAAWzB,GACpC,IAAIC,EAAQwB,EACRlB,EAAY,EAChB,UAAiB,IAAVN,GAAuBM,EAAYJ,KAAKsb,MAAM/a,QACnDT,EAAQE,KAAKsb,MAAMlb,GAAW4G,OAAOlH,EAAOD,EAASO,IACrDA,GAAa,EAEf,OAAON,EAWDoc,cACN5a,EAAazB,EAA+BC,EAA4BM,GAExE,SAASkB,EAAO8B,MAAM,GACtB9B,EAAStB,KAAKwc,aAAalb,EAAQzB,EAAQmG,OAAO,CAAClG,KAC1CE,KAAKyc,WAAWnb,EAAQlB,GAU3Boc,aAAalb,EAAazB,GAChC,OAAuB,IAAnBA,EAAQU,OAAuBe,EAE5BA,EACJmF,OAAQ3G,GACAD,EACJ4G,OAAQrG,QAA0C,IAAXA,GACvCsc,MAAOtc,GAA+BA,EAAON,KAU9C2c,WAAWnb,EAAazB,GAC9B,YAAe,IAAXA,EAA+ByB,EAC5BA,EAAO2Z,KAAK,CAACnb,EAAOM,IAClBmG,iBACL1G,EAAO8c,cAAc7c,GACrBD,EAAO8c,cAAcvc,GACrBP,EAAO+c,UACP/c,EAAOgd,aAULV,UAAU7a,EAAazB,IACP,IAAlBA,IACFG,KAAKwa,OAASxa,KAAK8c,cAAcxb,IAGnCtB,KAAK0a,QAAQvS,KAAK7G,GAElB,MAAMxB,EAAQwB,EAAOf,OACfH,EAAkB,IAAVN,EACdE,KAAKsa,OAAOnS,KAAKrI,GACjBE,KAAKua,OAAOpS,KAAK/H,GAQX0c,cAAcxb,GACpB,MAAMzB,EAAUyB,EAAOoE,IAAK5F,GAAa,CAACE,KAAKoZ,OAAOtZ,GAAQA,IAC9D,OAAO,IAAIuW,IAAIxW,aCzSjBkI,YAAYzG,EAAezB,EAA8B,IAxDhDG,eAAY,IAAI+I,IAAqB,IAKrC/I,YAAS,IAAI+I,IAAwB,GAMrC/I,YAAS,IAAI+I,KAAyB,GAsCvC/I,gBAAqB,EAKrBA,gBAAoC,GAG1CA,KAAKoZ,OAASvZ,EAAQuZ,OAASvZ,EAAQuZ,OAASC,GAChDrZ,KAAK+c,YAAcld,EAAQkd,YAAcld,EAAQkd,YAAcjE,GAE/D9Y,KAAK8X,MAAQ9X,KAAKgd,qBAClBhd,KAAKid,KAAOjd,KAAKkd,iBACjBld,KAAKmd,UAAYnd,KAAKod,kBAEtBpd,KAAKid,KAAKnB,OACV9b,KAAKmd,UAAUrB,OAEXxa,EAASf,OAAS,EACpBP,KAAK4K,KAAKtJ,GAEVtB,KAAKwa,OAASxa,KAAK8c,cAAcxb,eAhEf,OAAOtB,KAAKsa,OAAOxY,kBAMlB,OAAO9B,KAAKua,OAAOzY,kBA8BT,OAAO9B,KAAKwa,sBAMnB,OAAOxa,KAAKqd,UA+BtC5T,IAAInI,GACF,OAAOtB,KAAKsZ,MAAM7P,IAAInI,GAOxBmZ,MACE,OAAOza,KAAKsd,UAAUxb,MAOxB8I,KAAKtJ,EAAezB,GAAoB,GACtCG,KAAKwa,OAASxa,KAAK8c,cAAcxb,GACjCtB,KAAKqd,UAAYxd,EACjBG,KAAKmI,OAQPoV,YACMvd,KAAKsZ,OAAStZ,KAAKsZ,MAAMC,KAAO,GAClCvZ,KAAKsZ,MAAMpD,QACXlW,KAAKqd,WAAY,EACjBrd,KAAKmI,QACInI,KAAKsZ,OACdtZ,KAAKwd,cAOTtH,QACElW,KAAKmd,UAAUjH,QACflW,KAAKid,KAAK/G,QACVlW,KAAK8X,MAAM5B,QACXlW,KAAKud,YAGPrC,UACElb,KAAKmd,UAAUjC,UACflb,KAAKid,KAAK/B,UACVlb,KAAKkW,QAOPuH,OAAOnc,GACLtB,KAAK0d,WAAW,CAACpc,IAOnBoc,WAAWpc,GACTA,EAASwE,QAASjG,GAAcG,KAAKsZ,MAAM7D,IAAIzV,KAAKoZ,OAAOvZ,GAASA,IACpEG,KAAKqd,WAAY,EACjBrd,KAAKmI,OAOPuR,OAAOpY,GACLtB,KAAK2Z,WAAW,CAACrY,IAOnBqY,WAAWrY,GACTA,EAASwE,QAASjG,GAAcG,KAAKsZ,MAAM7D,IAAIzV,KAAKoZ,OAAOvZ,GAASA,IACpEG,KAAKqd,WAAY,EACjBrd,KAAKmI,OAOPwB,OAAOrI,GACLtB,KAAK2d,WAAW,CAACrc,IAOnBqc,WAAWrc,GACTA,EAASwE,QAASjG,GAAcG,KAAKsZ,MAAM3P,OAAO3J,KAAKoZ,OAAOvZ,KAC9DG,KAAKqd,WAAY,EACjBrd,KAAKmI,OAQPyV,YAAYtc,EAA+BzB,GAAoB,GAI7D,QAAyB,IAHAG,KAAK6d,WAAWhD,KAAMza,GACtCkB,EAASyG,cAAgB3H,EAAU2H,aAG1C,MAAM,IAAI0E,MAAM,+DAGlB,YAAKoR,WAAWjd,KAAKU,GACrBA,EAASwc,UAAU9d,OAEF,IAAbH,GACFyB,EAASyc,WAGJ/d,KAQTge,eAAe1c,GACb,MAAMzB,EAAQG,KAAK6d,WAAW3d,QAAQoB,GACtC,OAAIzB,GAAS,IACXG,KAAK6d,WAAW7Y,OAAOnF,EAAO,GAC9ByB,EAAS2c,YAAYje,OAEhBA,KAQTke,kBAAkB5c,GAChB,OAAOtB,KAAK6d,WAAWhD,KAAMhb,GACpBA,aAAoByB,GAQ/B6c,uBAAuB7c,GACrB,MAAMzB,EAAWG,KAAKke,kBAAkB5c,QACvB,IAAbzB,GACFA,EAASke,WAQbK,yBAAyB9c,GACvB,MAAMzB,EAAWG,KAAKke,kBAAkB5c,QACvB,IAAbzB,GACFA,EAASwe,aASLvB,cAAcxb,GACpB,MAAMzB,EAAUyB,EAASoE,IAAK5F,GAAc,CAACE,KAAKoZ,OAAOtZ,GAASA,IAClE,OAAO,IAAIuW,IAAIxW,GAMTsI,OACNnI,KAAKsd,UAAUnV,KAAKhE,MAAMgL,KAAKnP,KAAKsZ,MAAMqC,WAC1C3b,KAAKwd,cAMCA,cACN,MAAMlc,EAAQtB,KAAKsZ,MAAMC,KACnB1Z,EAAkB,IAAVyB,EACdtB,KAAKsa,OAAOnS,KAAK7G,GACjBtB,KAAKua,OAAOpS,KAAKtI,GAOXmd,qBACN,OAAO,IAAIsB,GAAyB,CAAClN,MAAOpR,OAOtCkd,iBACN,OAAO,IAAIqB,GAAcve,KAAKsd,WAOxBF,kBACN,OAAO,IAAImB,GAAkCve,KAAKid,KAAKtC,QACpD7Z,KAAK,CACJwb,OAAQtc,KAAK8X,MAAMsC,QACnBpT,OAAS1F,IACP,MAAMzB,EAAMG,KAAKoZ,OAAO9X,GAClBxB,EAAQE,KAAK8X,MAAMrO,IAAInI,GACvBlB,EAAgBJ,KAAKmd,UAAU1T,IAAI5J,GAEzC,QACoB,IAAlBO,GACAA,EAAcoe,SAAWld,GACzBtB,KAAKye,iBAAiBre,EAAc0X,MAAOhY,GAE3C,OAAOM,EAGT,MAAMC,EAAWD,EAAgBA,EAAcse,SAAW,EAAI,EAE9D,MAAO,CAACF,SAAQ1G,QAAO4G,WAAUC,IADrB,GAAG9e,KAAOQ,QAIzB+a,YAAa9Z,GAA+BtB,KAAKoZ,OAAO9X,EAAOkd,SAG5DC,iBAAiBnd,EAAiBzB,GACxC,GAAIyB,IAAiBzB,EACnB,OAAO,EAGT,MAAMC,EAA2D,IAArC8F,OAAOC,KAAKvE,GAAcf,OAChDH,EAAmD,IAAjCwF,OAAOC,KAAKhG,GAAUU,OAC9C,OAAOT,GAAuBM,YChThC2H,YAAYzG,EAAwBzB,GAZ5BG,qBAAkB,IAAIqW,IAa5BrW,KAAK4e,kBAAkB/e,GACvBG,KAAK6e,SAASvd,GAGhB4Z,UACElb,KAAK4e,uBAAkB,GACvB5e,KAAK6e,cAAS,GAOhBA,SAASvd,GACP,QAAc,IAAVA,EAIF,OAHAtB,KAAK8e,oBACL9e,KAAK+e,gBAAgB7I,aACrBlW,KAAKoR,WAAQ,GAIfpR,KAAK6e,cAAS,GACd7e,KAAKoR,MAAQ9P,EACbtB,KAAKgf,iBACLhf,KAAKif,gBAOPL,kBAAkBtd,GAChBtB,KAAKkf,MAAQ5d,EAOP0d,iBACNhf,KAAK8e,oBAEL9e,KAAKmf,WAAanf,KAAKoR,MAAMkM,UAC1BlV,UAAW9G,GAAkBtB,KAAKof,iBAAiB9d,IAEtDtB,KAAKqf,QAAUrf,KAAKoR,MAAM0G,MAAMsC,QAC7B7R,MAAK,QAAK,IACVH,UAAU,IAAMpI,KAAKsf,iBAMlBR,yBACkB,IAApB9e,KAAKmf,YACPnf,KAAKmf,WAAWzW,mBAEG,IAAjB1I,KAAKqf,SACPrf,KAAKqf,QAAQ3W,cAEf1I,KAAKmf,gBAAa,EAClBnf,KAAKqf,aAAU,EAMTD,iBAAiB9d,GACvBtB,KAAKif,gBAQCK,gBACN,IAAIhe,GAAkB,EACtB,MAAMzB,EAAaG,KAAKoR,MAAM0G,MAAMwB,MAC9BxZ,EAAaE,KAAK+e,gBAEpBlf,EAAW0Z,OAASzZ,EAAWyZ,OACjCjY,EAAkBtB,KAAKif,iBAGzB,MAAM7e,EAAY+D,MAAMgL,KAAKtP,EAAWgG,QACxC,UAAWxF,KAAOD,EAAW,CAC3B,MAAME,EAAaT,EAAW4J,IAAIpJ,GAC5BG,EAAaV,EAAW2J,IAAIpJ,IACV,IAApBiB,SACiB,IAAfd,EACFc,EAAkBtB,KAAKif,gBACb1Y,uBAAiCjG,EAAYE,KACvDc,EAAkBtB,KAAKif,kBAI3Bjf,KAAK+e,gBAAgBtJ,IAAIpV,EAAKuF,OAAOU,OAAO,GAAIhG,KAO5C2e,gBACN,YAAmB,IAAfjf,KAAKkf,OACPlf,KAAKkf,MAAMD,iBAEN,YCnITlX,YAAsBzG,EAAsC,IAAtCtB,eATZA,YAAwB,GAOzBA,aAAoC,IAAI+I,KAAgB,GAG/D/I,KAAK4O,QAAUtN,eAJO,OAAOtB,KAAKuf,QAAQzd,MAW5Cic,YACsB,IAAhB/d,KAAKwf,QACPxf,KAAKyf,eAEPzf,KAAKuf,QAAQpX,MAAK,GAClBnI,KAAK0f,aAOPrB,aACEre,KAAKuf,QAAQpX,MAAK,GAClBnI,KAAKyf,eAOP3B,UAAUxc,GACJtB,KAAK2f,OAAOzf,QAAQoB,GAAS,GAC/BtB,KAAK2f,OAAO/e,KAAKU,GAQrB2c,YAAY3c,GACV,MAAMzB,EAAQG,KAAK2f,OAAOzf,QAAQoB,GAC9BzB,GAAS,GACXG,KAAK2f,OAAO3a,OAAOnF,EAAO,GAQpB6f,cAMAD,kCC5E6CG,GAEvD7X,YAAsBzG,GACpBue,MAAMve,GADctB,eAOdA,aAAoC,IAAIqW,IAMhDyH,UAAUxc,GACRue,MAAM/B,UAAUxc,IACI,IAAhBtB,KAAKwf,QACPxf,KAAK8f,YAAYxe,GAQrB2c,YAAY3c,GACVue,MAAM5B,YAAY3c,IACE,IAAhBtB,KAAKwf,QACPxf,KAAK+f,cAAcze,GAQboe,aACR1f,KAAKggB,YAOGP,eACRzf,KAAKigB,cAMCD,YACNhgB,KAAK2f,OAAO7Z,QAASxE,GAAuBtB,KAAK8f,YAAYxe,IAMvD2e,cACNjgB,KAAK2f,OAAO7Z,QAASxE,GAAuBtB,KAAK+f,cAAcze,IAMzDwe,YAAYxe,GAClBtB,KAAKkgB,QAAQzK,IAAInU,EAAOA,EAAM6b,UAAU3B,UAAUxb,KAAK4O,QAAQuR,mBAMzDJ,cAAcze,GACpB,MAAMzB,EAAWG,KAAKkgB,QAAQzW,IAAInI,QACjB,IAAbzB,IAIJyB,EAAM6b,UAAUvB,aAAa/b,GAC7BG,KAAKkgB,QAAQvW,OAAOrI,sBChFgCse,GAAxD7X,kCAKU/H,aAAoC,IAAIqW,IAMhDyH,UAAUxc,GACRue,MAAM/B,UAAUxc,IACI,IAAhBtB,KAAKwf,QACPxf,KAAK8f,YAAYxe,GAQrB2c,YAAY3c,GACVue,MAAM5B,YAAY3c,IACE,IAAhBtB,KAAKwf,QACPxf,KAAK+f,cAAcze,GAQboe,aACR1f,KAAKggB,YAOGP,eACRzf,KAAKigB,cAMCD,YACNhgB,KAAK2f,OAAO7Z,QAASxE,GAAuBtB,KAAK8f,YAAYxe,IAMvD2e,cACNjgB,KAAK2f,OAAO7Z,QAASxE,GAAuBtB,KAAK+f,cAAcze,IAMzDwe,YAAYxe,GACdtB,KAAKkgB,QAAQE,IAAI9e,IAOrBtB,KAAKkgB,QAAQzK,IAAInU,EAAOA,EAAM6b,UAAU3B,UAHxB1b,IACmB,IAA1BA,EAAOgY,MAAMuI,WAQhBN,cAAcze,GACpB,MAAMzB,EAAWG,KAAKkgB,QAAQzW,IAAInI,QACjB,IAAbzB,IAIJyB,EAAM6b,UAAUvB,aAAa/b,GAC7BG,KAAKkgB,QAAQvW,OAAOrI,+BCpFpB5B,wBAAoFA,SAAaA,8BAAlCA,4BAAqBA,uDACpFA,wBAA8DA,0BAAsBA,8BAAjDA,kCAA2BA,mEAE5DA,wBACEA,SACFA,4CAFYA,wBACVA,uDCaK4gB,iBA4EXvY,YAAoBlI,gBAtEXG,eAAY,IAAI+I,SAAwB,GAMxC/I,gBAAa,IAAI+I,SAAwB,GAEzC/I,sBAAmB,CAAC4E,GAAI,oBAExB5E,gBAAa,CAAC4E,GAAI,oBAoBlB5E,mBAAoCugB,GAKpCvgB,oBAAoB,EAKpBA,YAAiB,EAKjBA,kBAAuB,MAKvBA,mBAAwB,OAUxBA,eAAoB,EAKnBA,oBAAiB,IAAIN,MAW/B8gB,WACExgB,KAAKygB,QAAU,IAAIC,GAAmB1gB,KAAKoR,MAAOpR,KAAKkf,OAEvDlf,KAAK2gB,WAAa3gB,KAAKoR,MAAM+L,UAC1BnC,QAASnb,IAA2D,IAA1BA,EAAOiY,MAAMuI,UACvDjY,UAAWvI,IACV,MAAMC,EAAWD,EAAQ6F,IAAKtF,GAAiCA,EAAOoe,QACtExe,KAAK4gB,kBAAkB9gB,KAQ7BqY,cACEnY,KAAKygB,QAAQvF,UACblb,KAAK2gB,WAAWjY,cAOlBmY,kBAAkBhhB,GAChB,MAAMC,EAASD,EAAMiC,iBAAiBqC,MAAQtE,EAAMiC,MAAQ,CAACjC,EAAMiC,OAE7D1B,EAAcN,EAAO+a,KAAMra,GAAmBA,IAAWR,KAAK8gB,kBACpE,IAAIzgB,EAAWP,EAAO2G,OAAQjG,GAAmBA,IAAWR,KAAK8gB,uBAC7C,IAAhB1gB,IACEC,EAASE,SAAWP,KAAKoR,MAAMtK,MACjCzG,EAAW,GACFA,EAASE,OAASP,KAAKoR,MAAMtK,QACtCzG,EAAWL,KAAKoR,MAAMqJ,QAI1Bpa,EAAWA,EAASoG,OAAQjG,GAAmBA,IAAWR,KAAK+gB,YACvC,IAAxB1gB,EAAaE,OACXP,KAAKoR,MAAM0G,MAAMkC,UAAU,CAACqG,UAAU,IAEtCrgB,KAAKoR,MAAM0G,MAAM6B,WAAWtZ,EAAU,CAACggB,UAAU,IAAO,GAI1DrgB,KAAKghB,eAAe9I,KAAK,CAACmI,UAAU,EAAMve,MAD5B9B,KAAKqK,MAAQhK,EAAWR,EAAMiC,QAItC8e,kBAAkB/gB,GAEtBG,KAAKihB,UAAU9Y,MADE,IAAfnI,KAAKqK,MACaxK,EAELA,EAASU,OAAS,EAAIV,EAAS,QAAK,GAIrDG,KAAKkhB,8BAA8BrhB,GAG7BqhB,8BAA8BrhB,GAChCA,EAASU,SAAWP,KAAKoR,MAAMtK,OAAS9G,KAAKmhB,WAAWrf,QAAU9B,KAAKohB,cACzEphB,KAAKmhB,WAAWhZ,KAAKnI,KAAKohB,eACjBvhB,EAASU,OAASP,KAAKoR,MAAMtK,OAAS9G,KAAKmhB,WAAWrf,QAAU9B,KAAKqhB,cAC9ErhB,KAAKmhB,WAAWhZ,KAAKnI,KAAKqhB,4DAjJnBtgB,GAAuBrB,uCAAvBqB,EAAuBugB,2dDxBpC5hB,4BACEA,wBAKEA,2CAAmBI,0CACnBJ,+BACAA,+BACAA,iDAKFA,QACFA,eAbIA,sCAAqB,+BAArBA,CAAqB,mBAArBA,CAAqB,6BAKRA,0DACAA,oCACiBA,mMCerBqB,MCnBAwgB,iBAEJC,QAAQ3hB,GACbA,EAAM4hB,gEAHG1gB,8BAAwBugB,0GAAxBxhB,wBCeA4hB,iBAoEX3Z,YAAoBlI,EAA6BC,GAA7BE,gBAA6BA,UArDxCA,gBAAY,EAKZA,oBAAyB,EAKzBA,yBAA8B,EAgB/BA,gBAAY,EAMpBA,oBAA4CwY,GAA0BC,KAK5DzY,YAAS,IAAIN,mBArBVG,IACY,IAAnBG,KAAK2hB,WACL9hB,IAAUG,KAAK4hB,YAEnB5hB,KAAK6hB,eAAehiB,GACpBG,KAAK8hB,yBAGL,OAAO9hB,KAAK4hB,UAoBdJ,WACyB,IAAnBxhB,KAAK2hB,YAA8C,IAAvB3hB,KAAK+hB,gBAIrC/hB,KAAK6hB,gBAAe,GACpB7hB,KAAK6C,OAAOqV,KAAKlY,OASX6hB,eAAehiB,GACrBG,KAAK4hB,UAAY/hB,GACA,IAAbA,GACFG,KAAKgiB,OAAOjhB,EAAwBkhB,cACJ,IAA5BjiB,KAAKkiB,oBACPliB,KAAKgiB,OAAOjhB,EAAwBohB,kBAGtCniB,KAAKoiB,UAAUrhB,EAAwBkhB,aACvCjiB,KAAKoiB,UAAUrhB,EAAwBohB,iBAOnCL,UACiB,IAAnB9hB,KAAK4hB,YACP,QAAe5hB,KAAKqiB,GAAGC,cAAe,CACpCC,WAAY,YACZC,SAAU,SACVC,MAAO,MACPC,OAAQ,YAQNV,OAAOniB,GACbG,KAAK2iB,SAASC,SAAS5iB,KAAKqiB,GAAGC,cAAeziB,GAMxCuiB,UAAUviB,GAChBG,KAAK2iB,SAASE,YAAY7iB,KAAKqiB,GAAGC,cAAeziB,IA3G5C,qBAAc,gCAKdkB,iBAAiB,yEAVbA,GAAuBrB,oDAAvBqB,EAAuBugB,wGAAvBxhB,0MCKAgjB,iBAoCX/a,YAAoBlI,EAA0CC,GAA1CE,uBAA0CA,oBAlCvDA,eAAoB,EACpBA,mBAAwB,EACxBA,eAAoB,EACpBA,cAAmB,GACnBA,qBAA4B,CAAC,EAAG,GAAI,GAAI,GAAI,IAAK,KACjDA,2BAAgC,EAG/BA,kCAA+C,GAE9CA,uBAA8C,IAAI+I,KAAgB,GAiBpE/I,YAAiB,EAKdA,qBAA8C,IAAIN,MA8D5DM,gBAAa,CAACI,EAAcC,EAAkBC,KAC5C,MAAME,EAA8B,IAAIuI,IAAgB,IAMxD,GAJA/I,KAAK+iB,6BAA6BniB,KAChCZ,KAAK+P,gBAAgB/B,UAAUvE,IAAI,2BAA2BrB,UAAWvE,IACvErD,EAAG2H,KAAKtE,MAEG,IAAXvD,GAA6B,IAAbD,EAAkB,MAAO,KAAKG,EAAGsB,SAASxB,IAE9D,MAAMoD,EAAatD,EAAOC,EAI1B,MAAO,GAAGqD,EAAa,OAHNA,GAFjBpD,EAASiH,KAAKyb,IAAI1iB,EAAQ,IAGtBiH,KAAK0b,IAAIvf,EAAarD,EAAUC,GAChCoD,EAAarD,KACyBG,EAAGsB,SAASxB,KArExD4iB,cACEljB,KAAKmjB,iBACLnjB,KAAKojB,QAAUpjB,KAAKoR,MAAM+L,UAAU7C,OAAOlS,UAAWvI,IACpDG,KAAKO,OAASV,EACdG,KAAKqjB,kBAEPrjB,KAAKsjB,mBAAqBtjB,KAAKujB,kBAAkBnb,UAAU,KACrDpI,KAAKwjB,WACPxjB,KAAKwjB,UAAUC,cAGnBzjB,KAAK0jB,uBACL1jB,KAAK2jB,kBAGPD,uCACE1jB,KAAK4jB,UAAgC,QAArB/jB,OAAKgkB,wBAAgB,eAAED,WAAY5jB,KAAK4jB,SACxD5jB,KAAK8jB,WAAiC,QAArBhkB,OAAK+jB,wBAAgB,eAAEC,YAAa9jB,KAAK8jB,UAC1D9jB,KAAK+jB,UAAgC,QAArB3jB,OAAKyjB,wBAAgB,eAAEE,WAAY/jB,KAAK+jB,SACxD/jB,KAAKgkB,iBAAuC,QAArB3jB,OAAKwjB,wBAAgB,eAAEG,kBAAmBhkB,KAAKgkB,gBACtEhkB,KAASikB,aAAalP,YACpB/U,KAAKkkB,sBAAuB,EAC5BlkB,KAAKmkB,cAAe,IAEpBnkB,KAAKkkB,sBAA4C,QAArB5jB,OAAKujB,wBAAgB,eAAEK,uBAAwBlkB,KAAKkkB,qBAChFlkB,KAAKmkB,cAAoC,QAArB3jB,OAAKqjB,wBAAgB,eAAEM,eAAgBnkB,KAAKmkB,cAIpER,kBAEE3jB,KAAK+iB,6BAA6BniB,KAChCZ,KAAK+P,gBAAgB/B,UAAUvE,IAAI,uCAAuCrB,UAAWvI,IACnFG,KAAKwjB,UAAUY,MAAMC,eAAiBxkB,KAG1CG,KAAKwjB,UAAUY,MAAME,cAAgBtkB,KAAKukB,WAE1CvkB,KAAK+iB,6BAA6BniB,KAChCZ,KAAK+P,gBAAgB/B,UAAUvE,IAAI,0CAA0CrB,UAAWvI,IACtFG,KAAKwjB,UAAUY,MAAMI,kBAAoB3kB,KAE7CG,KAAK+iB,6BAA6BniB,KAChCZ,KAAK+P,gBAAgB/B,UAAUvE,IAAI,sCAAsCrB,UAAWvI,IAClFG,KAAKwjB,UAAUY,MAAMK,cAAgB5kB,KAEzCG,KAAK+iB,6BAA6BniB,KAChCZ,KAAK+P,gBAAgB/B,UAAUvE,IAAI,sCAAsCrB,UAAWvI,IAClFG,KAAKwjB,UAAUY,MAAMM,cAAgB7kB,KAEzCG,KAAK+iB,6BAA6BniB,KAChCZ,KAAK+P,gBAAgB/B,UAAUvE,IAAI,0CAA0CrB,UAAWvI,IACtFG,KAAKwjB,UAAUY,MAAMO,kBAAoB9kB,KAoBvCsjB,iBACNnjB,KAAK+iB,6BAA6Brd,IAAI7F,GAAOA,EAAI6I,eAC7C1I,KAAKojB,SAAWpjB,KAAKojB,QAAQ1a,cAC7B1I,KAAKsjB,oBAAsBtjB,KAAKsjB,mBAAmB5a,cAGzDyP,cACEnY,KAAKmjB,iBAGPE,gBACErjB,KAAK4kB,gBAAgB1M,KAAKlY,KAAKwjB,yDA3HtBziB,GAA6BrB,8CAA7BqB,EAA6BugB,gFAsC7BuD,MAAY,qYC/DzBnlB,2BAQEA,+BAAQI,oBACVJ,cAREA,6BAAqB,8BAArBA,CAAqB,kBAArBA,CAAqB,wBAArBA,CAAqB,sBAArBA,CAAqB,oCAArBA,CAAqB,6UDwBVqB,MEdA+jB,iBACX/c,YACUlI,EACAC,GADAE,YACAA,qBAKV+kB,UAAUllB,SACR,MAAMO,EAAU,IAAI+J,KAAY,CAC9B,eAAgB,aAChB6a,oBAAqB,UAGjB3kB,EAAa,IAAI4kB,QAAyB,QAAlBnlB,OAAK+O,qBAAa,eAAEnE,UAAU,cAAe,cAC3E,OAAIrK,EAAW6kB,KAAKrlB,KAClBA,EAAMA,EAAIwO,MAAMhO,GAAY,IAGvBL,KAAKkM,KACTzC,IAAI5J,EAAK,CACR2J,UACA2b,aAAc,SAEf5c,QACC6c,MAAW9kB,GACF,IAAIoW,IAAYlW,IACrB,MAAMkD,EAAS,IAAIiT,WACnBjT,EAAOkT,cAActW,GACrBoD,EAAO2hB,UAAY,KACjB7kB,EAAS2H,KAAKzE,EAAOoT,QACrBtW,EAAS8kB,8DA/BVvkB,GAAerB,yEAAfqB,EAAewkB,aAQ1BC,WAHCC,MAAU,CACTC,cAAe,MAEjB3kB,wBA4BC,MApCUA,MCPA4kB,iBACX5d,YAAoBlI,qBAEpBklB,UAAUllB,GACR,OAAOG,KAAK4lB,WAAWC,wBAAwBhmB,iDAJtCkB,GAAgBrB,8DAAhBqB,EAAgBwkB,UAAhBxkB,+CCCKrB,SACIA,2BAAcA,8EAEdA,QACJA,0CAH0DA,8DAA4D,iFAF1HA,SACIA,mDAKJA,+BALmBA,+EAFvBA,gBACIA,kCAOJA,8BAPmBA,8EAQnBA,iBACIA,2BAAcA,gDAA+BU,mBAA0B,MAAzDV,CAA8D,uHACjBU,qBAD7CV,CAA8D,0FAG5EA,QACJA,8CAFIA,wEAOAA,iBACIA,SACJA,yCAFsDA,+CAClDA,wDAFRA,SACIA,wBAGJA,mCAGIA,iBACIA,SACJA,yCAFsCA,+CAClCA,wDAFRA,SACIA,wBAGJA,mCAKYA,iBACIA,SACJA,uEAFgGA,qCAC5FA,mEAKQA,0HAAyDA,iFACpCA,gBAAMA,8BAE3CA,eAF2CA,qGAHnCA,iBACIA,gBAAiFA,iCAASI,sBACtFJ,yBACAA,4CAGJA,QACJA,kFAPmCA,qCAC5BA,6CACOA,gDAAsC,yCAP5DA,SACIA,wBAGAA,4CAUJA,4EAbwCA,iDAAuC,sCAFnFA,SACIA,kCAeJA,kCAGQA,+EAA6FA,qCAAwC,8DAMzHA,0HAAyDA,iFACpCA,gBAAMA,8BAC5BA,eAD4BA,qFAHnCA,iBACIA,gBAAiFA,iCAASI,sBACtFJ,yBACAA,4CAEJA,QACJA,kFANmCA,qCAC5BA,6CACOA,gDAAsC,yCAP5DA,SACIA,wBAGAA,4CASJA,4EAZwCA,iDAAuC,sCAFnFA,SACIA,kCAcJA,kDAKYA,kBACIA,oCACAA,oBACAA,kIADAA,QAEAA,kCACJA,qFAJqCA,wBACwCA,wCAAzDA,yBAAwB,oEAI5CA,oBAAsGA,0CAASA,EAATomB,iBAASC,YAATrmB,CAAgC,uCAC1HA,EAD0HomB,iBAC1HE,aAD0FtmB,CAAgC,mCACzFA,EADyFomB,iBACzFG,YAD7CvmB,2CAA2DA,0EAE3DA,oBACoCA,8HADpCA,0EAA4HA,qBAC5HA,+BACAA,8DAA+DA,+DAC/DA,yDAA0DA,yDAHkCA,0EAI5FA,oBACqCA,8HADrCA,0EACAA,+BACAA,8DAA+DA,+DAFaA,0EAG5EA,2BACAA,sIAA4DA,0EADZA,gCAA+B,sDAK3EA,yBACIA,SACJA,kCAFuDA,oBAAmB,uBACtEA,0EAJRA,yBAC6DA,8IAEzDA,gCAGJA,0EAN2CA,+DAC3CA,gCAA+B,sBAA/BA,CAA+B,yBAEIA,mEAInCA,qGACyBA,+DAAgEA,+BAD7DA,gCAA+B,gDAInDA,yBACIA,SACJA,kCAF2DA,oBACvDA,0EA/BhBA,iBAEIA,yBAMAA,2BAEAA,2BAIAA,2BAGAA,kCAEAA,gCAOAA,2BAEIA,kCAA0CA,kJAEtCA,mDAGJA,QACRA,yEAlC2CA,+BAAuB,+BAEpCA,uCAMGA,uCAE+BA,yCAI/BA,kDAGdA,0CAEFA,uCAOgDA,+CAItBA,oFAMvCA,yGAAwGA,qCAAwC,yEAMpIA,0HAAyDA,iFACpCA,gBAAMA,8BAA0CA,eAA1CA,qFAHnCA,iBACIA,gBAAiFA,iCAASI,sBACtFJ,yBACAA,4CACJA,QACJA,mFALmCA,qCAC5BA,6CACOA,gDAAsC,yCANxDA,wBAGAA,sHAHoCA,wCAAuC,yCArCnFA,SACIA,0BAmCAA,4CAaJA,wDAhDwEA,sCAAwB,sCAFpGA,SACIA,kCAkDJA,kDAEIA,iBACIA,uBAA+DA,0CAASA,EAATomB,iBAAStE,aAAwB9hB,QACpGA,mEAF4DA,qCAC9CA,0EAFlBA,SACIA,wBAGJA,kDAMoBA,qBAC2BA,gIACvBA,uBACJA,2CAFIA,uBAAsB,uBACZA,2EAEdA,qBAC2BA,gIACvBA,uBACJA,2CAFIA,uBAAsB,uBACZA,4DAPlBA,SACIA,4BAIAA,4BAIJA,wCARaA,mDAIAA,8EANjBA,gBACIA,kCAUJA,iEAVmBA,8EAH3BA,SACIA,iBACIA,0BAYJA,QACJA,iEAduCA,8CACNA,kEAHrCA,SACIA,kCAgBJA,mCA5GJA,SACIA,kCAiBAA,kCAgBAA,kCAoDAA,kCAKAA,kCAkBJA,wCA5GmBA,+DAiBAA,4DAgBAA,uEAoDAA,4DAKAA,8FAxGvBA,YACIA,kCAMAA,kCAMAA,kCA8GJA,4CA3HcA,6BACKA,6CAMAA,8CAMAA,wEAgHnBA,sCAAoEA,8EAEpEA,iBAAsMA,qFAA8B,6EACpOA,8CADyEA,yCAAiC,2BAAjCA,CAAiC,wBAAjCA,CAAiC,yEAG9GA,yCAAgJA,iFAChJA,gCADkDA,uBAAe,sCAAfA,CAAe,0CChHnE,MAAMwmB,GAASC,OASFC,iBAyJXre,YAAoBlI,EACVC,EACEM,EACAC,EACiBC,EACLE,EACAkD,EACZE,EACFC,GARU7D,aACVA,mBACEA,qBACAA,mBACiBA,iBACLA,mBACAA,oBACZA,iCACFA,mBA/JVA,uBAA8C,IAAI+I,KAAgB,GAE3D/I,eAAuB,IAAIqmB,MAAU,IAQ5CrmB,+BAA4BsY,GAM5BtY,+BAA4B0Y,GAMnB1Y,qBAA8D,IAAI+I,SAAgB,GA8C3F/I,oBAA4CwY,GAA0BC,KAMtEzY,qBAA0B,EAM1BA,oBAAyB,EAWfA,iBAAc,IAAIN,MAKlBM,wBAAqB,IAAIN,MAOzBM,sBAAiF,IAAIN,WAAa,GAsB5GM,gBAAa,IAAIsmB,MAoCftmB,KAAKumB,YAAYC,UAAU,uBAhHN3mB,GACrBG,KAAKymB,WAAa5mB,EAClBG,KAAK0mB,WAAWlD,UAAY3jB,kBAI5B,OAAOG,KAAKymB,yBAuDZ,IAAI5mB,EAAUG,KAAKqQ,SAASsW,QACzBlgB,OAAQ3G,IAAiD,IAAnBA,EAAO8mB,SAC7ClhB,IAAK5F,GAA8BA,EAAOoR,MAE7C,OAA+B,IAA3BlR,KAAK6mB,oBACPhnB,EAAU,CAAC,qBAAqBmG,OAAOnG,IAGlCA,kBAakB,OAAOG,KAAKqQ,SAASsR,YAAa,0BAM1B,OAAO3hB,KAAKqQ,SAASwW,oBAAqB,mBAMjD,OAAO7mB,KAAKqQ,SAASyW,aAAc,oBAMlC,YAAqC,IAA9B9mB,KAAKqQ,SAAS0W,aAAmC/mB,KAAKqQ,SAAS0W,YAmBnGvG,WACExgB,KAAKgnB,mBACLhnB,KAAK0mB,WAAWlD,UAAYxjB,KAAKwjB,UAMnCN,YAAYrjB,GACV,MAAMC,EAAQD,EAAQuR,MAClBtR,GAASA,EAAMiW,eAAiBjW,EAAMgW,eACxC9V,KAAKgnB,mBAOTC,cAAcpnB,EAAgBC,EAA2BM,GACvD,MAAMC,EAAML,KAAKknB,iCAAiCrnB,GAClDC,EAAO0e,OAAO2I,WAAW9mB,GAAOD,EAAMgnB,OAAOtlB,MAM/CulB,qBAAqBxnB,EAAgBC,EAA2BM,GAC9D,MAAMC,EAAML,KAAKknB,iCAAiCrnB,GAClDC,EAAO0e,OAAO2I,WAAW9mB,GAAOD,EAAMknB,QAMxCC,oBAAoB1nB,EAAgBC,EAA2BM,GAC7D,MAAMC,EAAML,KAAKknB,iCAAiCrnB,GAClDC,EAAO0e,OAAO2I,WAAW9mB,GAAOD,EAAM0B,MAMxC0lB,0BAA0B3nB,EAAgBC,EAA2BM,GACnEJ,KAAKynB,UAAUC,SAAS7nB,GAAQ8nB,SAASvnB,EAAMwnB,OAAOC,WACtD,MAAMxnB,EAAML,KAAKknB,iCAAiCrnB,GAClDC,EAAO0e,OAAO2I,WAAW9mB,GAAOD,EAAMwnB,OAAO9lB,MAM/CgmB,aAAajoB,EAAgBC,EAA2BM,GACtD,MACME,EAAQ4lB,GAAO9lB,EAAM0B,OAAOimB,OADnB,cAETvnB,EAAMR,KAAKknB,iCAAiCrnB,GAClDC,EAAO0e,OAAO2I,WAAW3mB,GAAOF,EAO1B0nB,WAAWnoB,GACjB,MAAMC,EAAOD,EAAO2e,OAAO2I,YAActnB,EAAO2e,OAChDxe,KAAKqQ,SAASsW,QAAQ7gB,QAAQ1F,UAC5BA,EAAO6O,OAAyB,QAAjB5O,IAAO4nB,kBAAU,eAAEC,aAAc9nB,EAAO6O,MAAMwE,SAAS,KAAOrT,EAAO6O,MAAQ,KAAO7O,EAAO6O,MAE1G,MAAM3O,EAAMN,KAAKknB,iCAAiC9mB,EAAO8Q,MACzD,GAAoB,YAAhB9Q,EAAO0E,KACJhF,EAAKQ,IAAsB,OAAdR,EAAKQ,GAES,iBAAdR,EAAKQ,KACrBR,EAAKQ,GAAO2E,KAAKC,MAAMpF,EAAKQ,GAAKyG,gBAFjCjH,EAAKQ,IAAO,EAIdN,KAAKynB,UAAUU,WAAW/nB,EAAO8Q,KAAMlR,KAAKooB,YAAYC,QACtDvoB,EAAKQ,aAEkB,SAAhBF,EAAO0E,KACZ1E,EAAOkoB,SACTtoB,KAAKynB,UAAUU,WAAW/nB,EAAO8Q,KAAMlR,KAAKooB,YAAYC,QACtD,CAACvoB,EAAKQ,OAGRN,KAAKynB,UAAUU,WAAW/nB,EAAO8Q,KAAMlR,KAAKooB,YAAYC,QACtDvoB,EAAKQ,KAILN,KAAKynB,UAAUC,SAAStnB,EAAO8Q,MAAMyW,SADlB,iBAAd7nB,EAAKQ,GACoCioB,SAASzoB,EAAKQ,IACdR,EAAKQ,aAE9B,iBAAhBF,EAAO0E,KAAyB,CACzC9E,KAAKynB,UAAUU,WAAW/nB,EAAO8Q,KAAMlR,KAAKooB,YAAYC,QACtDvoB,EAAKQ,KAGPN,KAAKwoB,gBAAkBxoB,KAAKynB,UAAUC,SAAStnB,EAAO8Q,MAAMuX,aAAalgB,MACvE,OAAI7E,IACF,GAAIA,EAAMnD,OACR,OAAOH,EAAOsoB,aAAajiB,OAAQ7C,IACjC,MAAMC,EAAmBH,EAAQA,EAAMqD,cAAc4hB,UAAU,OAAOxiB,QAAQ,mBAAoB,IAAM,GAExG,OAD8BvC,EAAO9B,MAAMiF,cAAc4hB,UAAU,OAAOxiB,QAAQ,mBAAoB,IACzEsN,SAAS5P,QAM9C,IAAIrD,EAAmBV,EAAKQ,GAW5B,GAVAF,EAAOsoB,aAAa5iB,QAAQpC,IACM,iBAArBlD,GAAiC,QAAQ0kB,KAAK1kB,KACvDA,EAAmB+nB,SAAS/nB,KAE1BkD,EAAO5B,QAAUtB,GAAoBkD,EAAOkB,KAAOpE,KACrDA,EAAmBkD,EAAO5B,SAI9B9B,KAAKynB,UAAUC,SAAStnB,EAAO8Q,MAAMyW,SAASnnB,GAC1CR,KAAK4oB,UAAU/oB,IAAWO,EAAOyoB,gBAAiB,CACpD,MAAMnlB,EAAS7D,EAAO2e,OACtBxe,KAAKynB,UAAUC,SAAStnB,EAAO8Q,MAAMyW,SAC7B,MAANjkB,OAAM,EAANA,EAAQyjB,WAAWnnB,KAAKknB,iCAAiC9mB,EAAOyoB,4BAG3C,SAAhBzoB,EAAO0E,MAChB,GAAI1E,EAAOwmB,QACT,GAAI9mB,EAAKQ,GAAM,CACb,IAAIE,EAAO0lB,GAAOpmB,EAAKQ,IACvBR,EAAKQ,GAAOE,EAAKsoB,MAAMf,OAAO,cAC9B/nB,KAAKynB,UAAUU,WAAW/nB,EAAO8Q,KAAMlR,KAAKooB,YAAYC,QACtDvoB,EAAKQ,SAEF,CACL,MAAME,EAASR,KAAKknB,iCAAiC9mB,EAAO8Q,MAC5DrR,EAAO2e,OAAO2I,WAAW3mB,GAAU,KACnCR,KAAKynB,UAAUU,WAAW/nB,EAAO8Q,KAAMlR,KAAKooB,YAAYC,QACtD,aAKNroB,KAAKynB,UAAUU,WAAW/nB,EAAO8Q,KAAMlR,KAAKooB,YAAYC,QACtDvoB,EAAKQ,KAILN,KAAKynB,UAAUC,SAAStnB,EAAO8Q,OAASlR,KAAK+oB,4BAA4B3oB,EAAQ,aACnFJ,KAAKynB,UAAUC,SAAStnB,EAAO8Q,MAAM8X,YAKnChC,mBACNhnB,KAAKipB,mBACLjpB,KAAKkpB,YAAclpB,KAAKoR,MAAM+L,UAC3BnC,QAASnb,IAA2D,IAA1BA,EAAOiY,MAAMuI,UACvDjY,UAAWvI,IACV,MAAMC,EAAgBD,EAAQ,GACxBO,EAAiCJ,KAAKoR,MAAM+L,UAAU1C,MAAMva,QAAQJ,GACpEO,EAAUL,KAAKwjB,UAAYxjB,KAAKwjB,UAAUO,UAAY/jB,KAAKwjB,UAAUM,UAAY,GAAK,EAG5F,GACE9jB,KAAKwjB,YACJpjB,GAJaJ,KAAKwjB,UAAYnjB,EAAUL,KAAKwjB,UAAUO,SAAW,IAKnE3jB,GAAkCC,GAAU,CAC5C,MAAMG,EAAc+G,KAAK4hB,MAAM/oB,EAAiCJ,KAAKwjB,UAAUO,UAC/E/jB,KAAK0mB,WAAWlD,UAAUM,UAAYtjB,EAExCR,KAAKopB,gBAAgBjhB,KAAKnI,KAAKqpB,sBAAsBxpB,MAEzDG,KAAKspB,aAAetpB,KAAKoR,MAAM+L,UAAUxC,OAAOvS,UAAWvI,IACrDA,EAAI,IACNG,KAAKgoB,WAAWnoB,EAAI,IAEtBG,KAAK0mB,WAAW6C,KAAO1pB,IAS3BsY,cACEnY,KAAKipB,mBAGCA,mBACFjpB,KAAKkpB,aACPlpB,KAAKkpB,YAAYxgB,cAEf1I,KAAKspB,cACPtpB,KAAKspB,aAAa5gB,cAUtB8gB,qBACE,MAAO,CAAC3pB,EAAeC,IACdA,EAAO6e,IAUlB8K,UACEzpB,KAAKkf,MAAMD,gBAGb2F,gBAAgB/kB,GACdG,KAAKwjB,UAAY3jB,EAQnB6pB,OAAO7pB,GACL,MAAMC,EAAYD,EAAM+c,UAClBxc,EAASJ,KAAKqQ,SAASsW,QAC1B9L,KAAMxa,GAAyBA,EAAE6Q,OAASrR,EAAM2f,QAEjC,QAAd1f,GAAqC,SAAdA,GACzBE,KAAKoR,MAAM+L,UAAUlC,KAAK,CACxB0B,cAAgBtc,GAAiCL,KAAK2pB,SAAStpB,EAAQD,GACvEwc,YACAC,WAAY7c,KAAK4pB,iBAEnB5pB,KAAK6pB,iBAAiB3R,KAAK,CAAC4R,SAAQlN,cACpC5c,KAAKujB,kBAAkBpb,MAAK,IAE5BnI,KAAKoR,MAAM+L,UAAUlC,UAAK,GAS9B8O,WAAWlqB,GACTG,KAAKgqB,qBAAuBhqB,KAAKoR,MAAM+L,UAAU/D,OAAOvZ,GACxDG,KAAKiqB,YAAY/R,KAAKrY,EAAO2e,QAU/B0L,YAAYrqB,GACV,IAAuB,IAAnBG,KAAK2hB,UAAuB,OAEhC,MAAM7hB,EAASD,EAAO2e,OACtBxe,KAAKoR,MAAM0G,MAAM4B,OAAO5Z,EAAQ,CAACugB,UAAU,IAAO,GAClDrgB,KAAKmqB,mBAAmBjS,KAAK,CAAC3T,MAAO,CAACzE,KAQxCsqB,aAAavqB,GACX,IAAuB,IAAnBG,KAAK2hB,YAET3hB,KAAKoR,MAAM0G,MAAMkC,UAAU,CAACqG,SAAUxgB,KACvB,IAAXA,GAAiB,CACnB,MAAMC,EAAWE,KAAKoR,MAAM+L,UACzB1C,MACA/U,IAAKtF,GAAiCA,EAAOoe,QAChDxe,KAAKmqB,mBAAmBjS,KAAK,CAAC3T,MAAO,CAACzE,MAW1CuqB,YAAYxqB,EAAiBC,GAC3B,IAAuB,IAAnBE,KAAK2hB,UAAuB,OAEhC,MAAMvhB,EAASN,EAAO0e,OAEtBxe,KAAKoR,MAAM0G,MAAM4B,OAAOtZ,EAAQ,CAACigB,SAAUxgB,IADd,IAAXA,IAAoBG,KAAK8mB,aAE5B,IAAXjnB,GACFG,KAAKmqB,mBAAmBjS,KAAK,CAAC3T,MAAO,CAACnE,KAExCJ,KAAKgqB,qBAAuBhqB,KAAKoR,MAAM+L,UAAU/D,OAAOtZ,GAU1DwqB,iBAAiBzqB,EAAiBC,EAA8BM,GAC9D,IAAuB,IAAnBJ,KAAK2hB,UAAuB,OAEhC,IAAwB,IAApB3hB,KAAK8mB,iBAAsD,IAA9B9mB,KAAKgqB,qBAEpC,YADAhqB,KAAKqqB,YAAYxqB,EAAQC,GAO3B,MAAMO,EAAQa,OAAOU,SAASS,cAC9BhC,EAAMkqB,WAAWnqB,EAAMgnB,QACvBlmB,OAAOoB,eAAeI,kBACtBxB,OAAOoB,eAAeK,SAAStC,GAC/BD,EAAMoqB,2BAEN,MAAMlqB,EAAUN,KAAKoR,MAAM+L,UAAU1C,MAC/Bja,EAAcF,EAAQJ,QAAQJ,GAC9B4D,EAAoB1D,KAAKoR,MAAM+L,UAAU1T,IAAIzJ,KAAKgqB,sBAElDnmB,EAAU,CAACrD,EADOF,EAAQJ,QAAQwD,IAIlCM,EAAW1D,EAFa8C,MAAMmE,KAAK0b,OAAOpf,GAAU0D,KAAKyb,OAAOnf,GAAW,GAElD6B,IAAKf,GAAkCA,EAAQ6Z,QAC9Exe,KAAKoR,MAAM0G,MAAM6B,WAAW3V,EAAU,CAACqc,SAAUxgB,KAClC,IAAXA,GACFG,KAAKmqB,mBAAmBjS,KAAK,CAAC3T,MAAOP,IAEvChE,KAAKgqB,qBAAuBhqB,KAAKoR,MAAM+L,UAAU/D,OAAOtZ,GAQlDupB,sBAAsBxpB,GAC5B,MACMO,EAAiBP,EAAgBU,OACvC,OAA0B,IAAnBH,EAFQsY,GAGNC,KACNvY,IAAmBJ,KAAKoR,MAAM+L,UAAUrW,MAJ5B4R,GAI2C+R,IAJ3C/R,GAIwDgS,KASzEC,iBAAiB9qB,GACf,IAAIC,EAAWD,EAAOob,KACtB,YAAiB,IAAbnb,IACFA,OAAkC,IAAvBE,KAAKqQ,SAAS4K,MAA6Bjb,KAAKqQ,SAAS4K,MAE/Dnb,EAST8qB,cAAc/qB,GACZ,MAAMC,EAAQD,EAAOiY,MACrB,QAAOhY,EAAMugB,UAAWvgB,EAAMugB,SAGhCwK,MAAMhrB,GACJ,QAAIG,KAAK8qB,MAAMjrB,KAE6D,IAAxE,CAAC,MAAO,MAAO,OAAOK,QAAQL,EAAM8D,MAAM,KAAKonB,MAAMhkB,eAO3D+jB,MAAMjrB,GACJ,MAAqB,iBAAVA,IAEe,aAAtBA,EAAMuD,MAAM,EAAG,IAA2C,YAAtBvD,EAAMuD,MAAM,EAAG,IAczDumB,SAAS9pB,EAA8BC,GACrC,MAAMM,EAASP,EAAO2e,OACtB,IAAIne,EACJ,QAA6B,IAAzBP,EAAO6c,cACT,OAAO7c,EAAO6c,cAAcvc,EAAQP,GAEtC,QAAoC,IAAhCG,KAAKqQ,SAASsM,cAChB,OAAO3c,KAAKqQ,SAASsM,cAAcvc,EAAQN,EAAOoR,KAAMrR,GAI1D,GAFAQ,EAAQL,KAAKoR,MAAM2L,YAAY3c,EAAQN,EAAOoR,MAE1B,YAAhBpR,EAAOgF,KAC4B,MAAjCzE,GAAmD,KAAVA,EAC3CA,GAAQ,EACkB,kBAAVA,QAAiC,IAAVA,IAErCA,EADmB,iBAAVA,EACD2qB,QAAQ3qB,GAER4E,KAAKC,MAAM7E,EAAM0G,gBAGxB/G,KAAK4oB,UAAU/oB,KAClBQ,EAAQA,EAAQ,WAAa,YAEN,SAAhBP,EAAOgF,MAAmBzE,GAASP,EAAO4oB,aAAc,CACjE,MAAMpoB,EAAST,EAAO2e,OACtB,GAAI1e,EAAOwoB,SAAU,CACnB,IAAI9nB,EACwBA,EAAX,iBAAVH,EAA+BA,EAAMgO,MAAM,YAAY3I,IAAIulB,QAAoB5qB,EACtF,IAAIqD,EAAc,GAElB5D,EAAO4oB,aAAa5iB,QAAQlC,IACtBpD,EAAQiT,SAAS7P,EAAOgB,KAExBlB,EAAY9C,KADVf,EAAOqrB,QACQtnB,EAAOgB,GAEPhB,EAAO9B,SAKLzB,EAAzBL,KAAK4oB,UAAU/oB,GAAkBW,EAAkBkD,OAE9C1D,KAAK4oB,UAAU/oB,IAAWC,EAAO+oB,gBACpCxoB,EAAc,MAANC,OAAM,EAANA,EAAQ6mB,WAAWnnB,KAAKknB,iCAAiCpnB,EAAO+oB,kBAExE/oB,EAAO4oB,aAAa5iB,QAAQtF,IACL,iBAAVH,GAAsB,QAAQ6kB,KAAK7kB,KAC5CA,EAAQkoB,SAASloB,KAEfG,EAAOsB,QAAUzB,GAASG,EAAOoE,KAAOvE,KACjBA,EAAzBL,KAAK4oB,UAAU/oB,GAAkBW,EAAOoE,GAAapE,EAAOsB,iBAK3C,iBAAhBhC,EAAOgF,MAA2BzE,GAASP,EAAO4oB,aAAc,CACzE,MAAMpoB,EAAST,EAAO2e,QACjBxe,KAAK4oB,UAAU/oB,IAAWC,EAAO+oB,gBACpCxoB,EAAc,MAANC,OAAM,EAANA,EAAQ6mB,WAAWnnB,KAAKknB,iCAAiCpnB,EAAO+oB,kBAExE/oB,EAAO4oB,aAAa5iB,QAAQtF,IACL,iBAAVH,GAAsB,QAAQ6kB,KAAK7kB,KAC5CA,EAAQkoB,SAASloB,KAEfG,EAAOsB,QAAUzB,GAASG,EAAOoE,KAAOvE,KAC1CA,EAAQG,EAAOsB,aAII,SAAhBhC,EAAOgF,OACZ9E,KAAK4oB,UAAU/oB,GACbQ,IAEFA,EAAQ6lB,GADU7lB,GACL0nB,SACb/nB,KAAKynB,UAAUC,SAAS5nB,EAAOoR,MAAMyW,SAAStnB,KAEtCL,KAAK4oB,UAAU/oB,IAAqB,OAAVQ,IACpCA,EAAQ,KAIZ,YAAc,IAAVA,IACFA,EAAQ,IAGHA,EAUT0oB,4BAA4BlpB,EAA2BC,GACrD,YAA0B,IAAtBD,EAAOooB,iBAAkE,IAAtCpoB,EAAOooB,WAAWnoB,IAChDD,EAAOooB,WAAWnoB,GAMtB8oB,UAAU/oB,GACf,QAAOA,EAAO2e,OAAO0M,QASvBC,kBAAkBtrB,GAChB,YAAwB,IAApBA,EAAO8iB,SACF9iB,EAAO8iB,SAETrK,GAA0BC,QAQnC6S,gBACE,MAAO,CACL,kCAAmCprB,KAAK2hB,WAS5C0J,iBACE,MAAMxrB,EAAOG,KAAKqQ,SAASib,gBAC3B,OAAIzrB,aAAgB0rB,SACX1rB,IAEF,GAST2rB,YAAY3rB,GACV,MACMO,EAAOJ,KAAKqQ,SAASob,aAC3B,OAAIrrB,aAAgBmrB,SACXnrB,EAHMP,EAAO2e,OAGA3e,GAEf,GAUT6rB,aAAa7rB,EAA8BC,GACzC,MAAMM,EAASP,EAAO2e,OAChBne,EAAM,GAENC,EAAYN,KAAKqQ,SAASsb,cAC5BrrB,aAAqBirB,UACvB3lB,OAAOU,OAAOjG,EAAKC,EAAUF,EAAQN,EAAQD,IAG/C,MAAMW,EAAaV,EAAO6rB,cAC1B,OAAInrB,aAAsB+qB,UACxB3lB,OAAOU,OAAOjG,EAAKG,EAAWJ,EAAQP,IAGjCQ,EASTurB,cACE/rB,EACAC,GAEAE,KAAKgoB,WAAWloB,GACS,mBAAdD,GACTA,EAAUC,EAAO0e,OAAQ1e,GAOtBonB,iCAAiCrnB,GACtC,OAAIA,EAAO4T,SAAS,eACX5T,EAAO8D,MAAM,KAAK,GAEpB9D,gDArxBEkB,GAAoBrB,oJAApBqB,EAAoBugB,oWAFpB,CAAC,CAAEpX,QAAS2hB,MAAqBC,YAAa/qB,KAAuBrB,wuHD7ClFA,iBACEA,mBAAgHA,yCAAiBI,cAC7HJ,WACIA,uBASAA,uBAMJA,QAEAA,iCA6HAA,uBAEAA,uBAEJA,QACAA,+CAEFA,eAvJ2BA,4CAA2B,0BAA3BA,CAA2B,kCAmBcA,6CA6H1CA,4CAA0B,uCAEQA,6CAG7BA,mtDCvGlBqB,UC/CDgrB,SAAZ,OAAYhrB,UAAa,KACvBirB,YACAjrB,oBACAA,oBAHUgrB,GAAZ,IAAYhrB,gCCWRrB,8DAA2BA,+DAL7BA,qCAKEA,6BACFA,+BAHEA,uBAAe,mCAEJA,6DAEbA,gBAA8BA,8BAAqBA,+BAArBA,6EAbhCA,2BAKEA,oHACAA,2BAOAA,uBACFA,gCAXEA,+EAA2E,iCAGlEA,kCAOJA,6EAQLA,2BACIA,0CAAUA,EAAVomB,OAAUmG,oCAEVvsB,8BACJA,iCAFIA,8CACAA,sEARNA,kFAKEA,kCAKFA,8BAPEA,+EAA2E,iCAE5DA,wCCEJwsB,iBA+EXnkB,cA7ES/H,eAAsC,IAAI+I,KAAgB,GAE1D/I,qBAA4C,IAAI+I,SAAgB,GAEhE/I,WAAiC,IAAI+I,SAAgB,GAErD/I,cAAoC,IAAI+I,SAAgB,GAExD/I,gBAAuC,IAAI+I,KAAgB,GAE3D/I,cAAsD,IAAI+I,IAAgB,IA0B1E/I,WAAQ,UAKRA,gBAAY,EAKZA,eAAW,EAKXA,kBAAc,EAmBbA,aAAgC,IAAIN,mBAbjCG,GAAkBG,KAAKmsB,UAAUhkB,KAAKtI,kBACzB,OAAOG,KAAKmsB,UAAUrqB,oBAMlCjC,GAAkBG,KAAKosB,WAAWjkB,KAAKtI,mBAC1B,OAAOG,KAAKosB,WAAWtqB,kBAU5B,OAAO9B,KAAKisB,OAAOhd,MAIzCuR,WACE,MAAM3gB,EAAOG,KAAKisB,OAAOI,MAAQ,QAEL,IAAxBrsB,KAAKisB,OAAOK,UACdtsB,KAAKusB,UAAYvsB,KAAKisB,OAAOK,WAAWzsB,GACrCuI,UAAWtI,GAAsCE,KAAKwsB,cAAc1sB,MAGrE,QAAaE,KAAKisB,OAAOhT,MAC3BjZ,KAAKysB,OAASzsB,KAAKisB,OAAOhT,KACvB7Q,UAAWtI,GAAiBE,KAAK0sB,WAAW5sB,IAE/CE,KAAK0sB,WAAW1sB,KAAKisB,OAAOhT,SAG1B0T,MAAa3sB,KAAKisB,OAAOW,gBAC3B5sB,KAAK6sB,iBAAmB7sB,KAAKisB,OAAOW,eACjCxkB,UAAWtI,GAA4BE,KAAK8sB,qBAAqBhtB,IAEpEE,KAAK8sB,qBAAqB9sB,KAAKisB,OAAOW,iBAGpC,QAAa5sB,KAAKisB,OAAOc,SAC3B/sB,KAAKgtB,UAAYhtB,KAAKisB,OAAOc,QAC1B3kB,UAAWtI,GAAoBE,KAAKitB,cAAcntB,IAErDE,KAAKitB,cAAcjtB,KAAKisB,OAAOc,cAGA,IAA7B/sB,KAAKisB,OAAOiB,eACdltB,KAAKmtB,eAAiBntB,KAAKisB,OAAOiB,gBAAgBrtB,GAC/CuI,UAAWtI,GAAuBE,KAAK4jB,UAAY9jB,IAGxDE,KAAKotB,WAAaptB,KAAKmsB,UACpB/jB,UAAWtI,GAAsBE,KAAKwsB,cAAc,CAAC,8BAA+B1sB,UAE3D,IAAxBE,KAAKisB,OAAOoB,UACdrtB,KAAKstB,UAAYttB,KAAKisB,OAAOoB,WAAWxtB,GACrCuI,UAAWtI,GAAqBE,KAAKutB,WAAaztB,IAGvDE,KAAKwtB,YAAcxtB,KAAKosB,WACrBhkB,UAAWtI,GAAuBE,KAAKwsB,cAAc,CAAC,gCAAiC1sB,KAG5FqY,mBACyB,IAAnBnY,KAAKusB,YACPvsB,KAAKusB,UAAU7jB,cACf1I,KAAKusB,eAAY,QAGS,IAAxBvsB,KAAKmtB,iBACPntB,KAAKmtB,eAAezkB,cACpB1I,KAAKmtB,oBAAiB,QAGD,IAAnBntB,KAAKstB,YACPttB,KAAKstB,UAAU5kB,cACf1I,KAAKstB,eAAY,QAGW,IAA1BttB,KAAK6sB,mBACP7sB,KAAK6sB,iBAAiBnkB,cACtB1I,KAAK6sB,sBAAmB,QAGN,IAAhB7sB,KAAKysB,SACPzsB,KAAKysB,OAAO/jB,cACZ1I,KAAKysB,YAAS,QAGO,IAAnBzsB,KAAKgtB,YACPhtB,KAAKgtB,UAAUtkB,cACf1I,KAAKgtB,eAAY,GAGnBhtB,KAAKotB,WAAW1kB,cAChB1I,KAAKwtB,YAAY9kB,cAQnB8Y,WACwB,IAAlBxhB,KAAK4jB,UAGT5jB,KAAKytB,QAAQvV,KAAKlY,KAAKisB,QAGjBO,cAAc3sB,GACpBG,KAAK0tB,SAASvlB,KAAKvC,OAAOU,OAAO,GAAItG,KAAK0tB,SAAS5rB,MAAOjC,IAGpDotB,cAAcptB,GACpBG,KAAK2tB,SAASxlB,KAAKtI,GAGbitB,qBAAqBjtB,GAC3BG,KAAK4tB,gBAAgBzlB,KAAKtI,GAGpB6sB,WAAW7sB,GACjBG,KAAK6tB,MAAM1lB,KAAKtI,iDA3LPkB,8BAAsBugB,m+BDvBnC5hB,mCAgBAA,yCAhBgBA,iCAgBsBA,gfCOzBqB,+CCrBTrB,iBAEEA,oBAKEA,oFACAA,sBACFA,QACFA,cAJIA,kHAMJA,gCAQEA,wGACFA,iCANEA,sBAAmB,cAAnBA,CAAmB,gBAAnBA,CAAmB,8BAAnBA,CAAmB,2EASnBA,iCAQEA,2FACFA,+CAPEA,+BAAuB,sBAAvBA,CAAuB,4BAAvBA,CAAuB,gBAAvBA,CAAuB,yCAAvBA,CAAuB,uCAH3BA,iFAAgEA,0FAahEA,kBAEEA,oBAKEA,sFACAA,uBACFA,QACFA,cAJIA,qGA5CRA,oBAEIA,wBAYAA,uCAWAA,yBAaAA,wBAYJA,8BAhDUA,8EAaHA,0CAU0BA,oCAavBA,wHAoCFA,iCAMEA,2FACFA,+CALEA,+BAAuB,sBAAvBA,CAAuB,gBAAvBA,CAAuB,uCAxBjCA,eACEA,0CAQEA,uBACFA,QAEAA,0BAQEA,oBACEA,iDAUFA,QACFA,QACFA,yCA5BIA,qEAAsD,sBAAtDA,CAAsD,8BAAtDA,CAAsD,qBAI5CA,iCASVA,+BAFAA,+BAAuB,yBAKSA,oGAgB1BA,iCAMEA,2FACFA,QACFA,qDANIA,+BAAuB,sBAAvBA,CAAuB,gBAAvBA,CAAuB,uCALnCA,uBACEA,oBACIA,iDAWJA,QACFA,8BAZoCA,8DC1DvBouB,iBAiLX/lB,YACSlI,EACCC,EACAM,EACDC,GAHAL,eACCA,aACAA,aACDA,oBA/KTA,mBAAgB+rB,GAMhB/rB,gBAAY,EAMZA,0BAAuB,CACrB4E,GAAI,mBACJqU,KAAM,gBACN8U,QAAS,KACP/tB,KAAKguB,WAAahuB,KAAKguB,YAa3BhuB,sBAA6C,IAAI+I,KAAyB,GAK1E/I,2BAAkD,IAAI+I,KAAyB,GAK/E/I,2BAAkD,IAAI+I,KAAyB,GAUtE/I,UAAsB+rB,GAAcC,KAKpChsB,uBAAmB,EAKnBA,iBAAa,EAKbA,WAAQ,UAKRA,eAAY,UAKZA,gBAAY,EAKZA,kBAAc,EAKdA,mBAAe,EAKfA,eAAW,EAKXA,UAAO,kBAKPA,eAAY,SAKZA,eAAY,QAYbA,mBAAgB,oBANPH,GACfG,KAAKiuB,cAAgBpuB,qBAGrB,MAAO,CAACG,KAAKiuB,cAAe,yBAAyBntB,KAAK,0BAS1D,OAAOd,KAAKkuB,8BAQZ,OAAOluB,KAAKmuB,+BAQZ,OAAOnuB,KAAKouB,iCAIZ,MAAMvuB,EAAKG,KAAKquB,MAAM/L,cACtB,OAA0B,IAAtBtiB,KAAKsuB,cACHzuB,EAAG0uB,aAAe1uB,EAAG2uB,wCAQ3B,OAA2C,IAAvCxuB,KAAKquB,MAAM/L,cAAcmM,UAAcC,2BAO3C,MAAM7uB,EAAKG,KAAKquB,MAAM/L,cACtB,QAAIziB,EAAG4uB,WAAc5uB,EAAG2uB,aAAe3uB,EAAG0uB,8BAO1C,OAAOvuB,KAAKikB,aAAatP,aAAeb,WAY1CoP,YAAYrjB,GACV,MAAMC,EAAQD,EAAQuR,MAClBtR,GAASA,EAAMiW,eAAiBjW,EAAMgW,qBACnB,IAAjB9V,KAAKygB,SACPzgB,KAAKygB,QAAQvF,UAEflb,KAAKygB,QAAU,IAAIC,GAAmB1gB,KAAKoR,MAAOpR,KAAKkf,QAO3D/G,cACEnY,KAAKygB,QAAQvF,UAOfyT,gBAAgB9uB,GAEdA,EAAOkuB,WADMluB,EAAOwsB,MAAQ,IAI9BuC,aACE5uB,KAAKquB,MAAM/L,cAAcuM,SAAS,EAAG,IAGvCC,WACE9uB,KAAKquB,MAAM/L,cAAcuM,SAAS,GAAG,kDAzN5B9tB,GAAkBrB,2EAAlBqB,EAAkBugB,qjDD9B/B5hB,6BAoDAA,yBAkCAA,oCAtFWA,4CAoDLA,wDAkCKA,gyDCxDEqB,MCIAguB,2HAdF,CACP/hB,KACAL,GACAqiB,KACAvvB,KACAwvB,KACAC,KACAC,KACAC,KACAC,SAKStuB,MClBAuuB,4HAFA,GAAEC,SARJ,CACPviB,KACA+hB,IAGAA,MAKShuB,MCJAyuB,iBA4CXznB,YACUlI,EACAC,GADAE,UACAA,uBA/BFA,aAAS,EAOTA,eAAW,EAOXA,mBAAe,EAOfA,mBAAe,sBAlCHH,GAClBG,KAAKyvB,gBAAgBC,gBAAgB7vB,GAAOuI,UAAWtI,IACrDE,KAAK2vB,IAAM7vB,EACXE,KAAK4vB,iCAMU/vB,GACjBG,KAAK6vB,OAAShwB,EACdG,KAAK8vB,oCAKcjwB,GACnBG,KAAK4jB,SAAW/jB,EAChBG,KAAK+vB,6CAKqBlwB,GAC1BG,KAAKgwB,aAAenwB,EACpBG,KAAKiwB,0CAKqBpwB,GAC1BG,KAAKkwB,aAAerwB,EACpBG,KAAKiwB,0BAKL,OAAOjwB,KAAKqiB,GAAGC,cAAc6N,cAAc,sBAU7C3P,WACExgB,KAAKowB,MAAMC,MAAMC,WAAa,SAC9BtwB,KAAKowB,MAAMC,MAAME,eAAiB,SAElCvwB,KAAK8vB,eACL9vB,KAAKiwB,cACLjwB,KAAK4vB,YAGCA,aACD5vB,KAAKowB,QAGVpwB,KAAKowB,MAAMI,UAAY,GACnBxwB,KAAK2vB,KACP3vB,KAAKowB,MAAMpuB,YAAYhC,KAAK2vB,MAGxBM,eACDjwB,KAAKowB,QAINpwB,KAAKkwB,aACHlwB,KAAKgwB,cACPhwB,KAAKowB,MAAMC,MAAMI,MAAQ,eACzBzwB,KAAKowB,MAAMC,MAAMK,WAAa,SAE9B1wB,KAAKowB,MAAMC,MAAMI,MAAQ,GACzBzwB,KAAKowB,MAAMC,MAAMK,WAAa,gBAGhC1wB,KAASgwB,cACPhwB,KAAKowB,MAAMC,MAAMI,MAAQvvB,OACtByvB,iBAAiB3wB,KAAKowB,MAAO,MAC7BQ,iBAAiB,oBACpB5wB,KAAKowB,MAAMC,MAAMK,WAAa,SAE9B1wB,KAAKowB,MAAMC,MAAMI,MAAQ,GACzBzwB,KAAKowB,MAAMC,MAAMK,WAAa,IAGlC1wB,KAAK6wB,cAAgB7wB,KAAKowB,MAAMC,MAAMI,MACtCzwB,KAAK+vB,kBAGCD,gBACD9vB,KAAKowB,QAGVpwB,KAAKowB,MAAMC,MAAMhD,QAAUrtB,KAAK6vB,OAAS,OAAS,QAG5CE,kBACD/vB,KAAKowB,QAAUpwB,KAAKgwB,eAGrBhwB,KAAK4jB,UACP5jB,KAAK6wB,cAAgB7wB,KAAKowB,MAAMC,MAAMI,MACtCzwB,KAAKowB,MAAMC,MAAMI,MAAQ,WAEzBzwB,KAAKowB,MAAMC,MAAMI,MAAQzwB,KAAK6wB,6DA9GvB9vB,GAAqBrB,mDAArBqB,EAAqBugB,2PAArBvgB,MCFA+vB,iBAAqB/mB,iBAE9B,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,kDAJJlJ,4DAJF,CAACgwB,KAAgBtxB,MAEhBsxB,QAEChwB,MCCAiwB,iBAcXjpB,YAAoBlI,aAbVG,cAAW,IAAIN,MAGzBuxB,iBAAiBpxB,EAAmBC,IAC7BA,GAIAE,KAAKqiB,GAAGC,cAAc4O,SAASpxB,IAClCE,KAAKmxB,SAASjZ,KAAKrY,iDAVZkB,GAAiBrB,uCAAjBqB,EAAiBugB,mGAAjBxhB,iCACK,0CADLiB,MCHAqwB,iBAAiBrnB,iBAE1B,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,kDAJJlJ,4DAJF,MAIEA,MCKAswB,iBA4BXtpB,YAAoBlI,EAA6BC,GAA7BE,gBAA6BA,UATzCA,iBAAa,EAEXA,YAAgC,IAAIN,mBAlB5C,OAAOM,KAAKsxB,mBAEHzxB,GACTG,KAAKsxB,QAAUzxB,kBAMf,OAAOG,KAAKuxB,yBAEA1xB,GACZA,EAAYG,KAAKwxB,iBAAmBxxB,KAAKyxB,eACzCzxB,KAAKuxB,WAAa1xB,EAClBG,KAAK0xB,OAAOxZ,KAAKrY,GAOnB8xB,QACE3xB,KAAKguB,WAAahuB,KAAKguB,UAKjBwD,iBACNxxB,KAAK2iB,SAASC,SAAS5iB,KAAKonB,OAAQ,iBACpCpnB,KAAK2iB,SAASC,SAAS5iB,KAAKqiB,GAAGC,cAAe,aAGxCmP,eACNzxB,KAAK2iB,SAASE,YAAY7iB,KAAKonB,OAAQ,iBACvCpnB,KAAK2iB,SAASE,YAAY7iB,KAAKqiB,GAAGC,cAAe,2DArCxCvhB,GAAiBrB,oDAAjBqB,EAAiBugB,kGAAjBxhB,iHCNA8xB,iBALb7pB,cAaU/H,YAAS,GAUTA,iBAAa,EAEXA,YAAgC,IAAIN,kBAjB5C,OAAOM,KAAK6xB,iBAEJhyB,GACRG,KAAK6xB,OAAShyB,kBAMd,OAAOG,KAAKuxB,yBAEA1xB,GACZG,KAAKuxB,WAAa1xB,EAClBG,KAAK0xB,OAAOxZ,KAAKrY,iDAhBRkB,8BAAoBugB,0UCPjC5hB,yBACEA,sBAOEA,kDACFA,QACAA,gBAAYA,SAASA,QACvBA,QAEAA,sBACEA,SACFA,+BATIA,2BAAkB,yBAIRA,6NDHDqB,MEKA+wB,iBAAoB/nB,iBAE7B,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,kDAJJlJ,4DAJF,CAACtB,KAAe0vB,SAIdpuB,MCJAgxB,iBAGXhqB,YAAmBlI,kEAHRkB,GAAsBrB,uCAAtBqB,EAAsBugB,sRCRnC5hB,gBAA4CA,8BAAgDA,QAC5FA,iBAA+CA,SAAkBA,QACjEA,iBACEA,oBAAmCA,gCAASI,mBAAgB,KAAOJ,8BAAqDA,QACxHA,oBAAmBA,gCAASI,mBAAgB,KAAQJ,gCAAoDA,QAC1GA,eAL4CA,4DACGA,iCAEsBA,iEACfA,gSDIzCqB,MEAAixB,iBACXjqB,YAAoBlI,iBAEboyB,KAAKpyB,GACV,MAAMC,EAAYE,KAAKkyB,OAAOD,KAAKF,GAAwB,CACzDI,cAAc,IAEhB,SAAUC,kBAAkBC,eAAiBxyB,EAEtCC,EAAUwyB,4DATRvxB,GAAoBrB,yCAApBqB,EAAoBsI,QAApBtI,EAAoB,YAApBA,MCOAwxB,iBAAsBxoB,iBAE/B,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,kDAJJlJ,6DAFA,CAACixB,IAAqBzC,SAHxB,CAACP,KAAiBwD,MAAiB7lB,OAKjC5L,MCIA0xB,iBAOX1qB,YACSlI,EACAC,EACCM,GAFDJ,eACAA,wBACCA,kBALAA,kBAAe,IAAIN,MAStBgzB,cAAc7yB,GACnB,MAAOkM,IAAG9E,KAAKpH,EACfG,KAAK2yB,QACL9yB,EAAE+yB,iBACF5yB,KAAK6yB,aAAa3a,KAAK,CAAEnM,IAAG9E,MAC5BjH,KAAK8yB,WAAa,KAClB,MAAMzyB,EAAmBL,KAAK+yB,QAC3BC,WACAC,oBAAoB,CAAElnB,IAAG9E,MACzBisB,cAAc,CACb,CACEC,QAAS,MACTC,QAAS,SACTC,SAAU,QACVC,SAAU,SAGhBtzB,KAAK8yB,WAAa9yB,KAAK+yB,QAAQrrB,OAAO,CACpC6rB,mBACAC,eAAgBxzB,KAAK+yB,QAAQU,iBAAiBd,UAEhD3yB,KAAK8yB,WAAWY,OACd,IAAIC,MAAe3zB,KAAK4zB,YAAa5zB,KAAK6zB,iBAAkB,CAC1DC,eAAW,KAIf9zB,KAAK+zB,OAAMC,KAAsBpyB,SAAU,SACxC2G,MACC,QAAOjI,IACL,MAAME,EAAcF,EAAM8mB,OAC1B,YAAKuL,UAED3yB,KAAK8yB,aACN9yB,KAAK8yB,WAAWmB,eAAe/C,SAAS1wB,QAG7C0zB,MAAK,IAEN9rB,UAAU,IAAMpI,KAAK2yB,SAExB3yB,KAAK+zB,OAAMC,KAAsBpyB,SAAU,eACxC2G,MACC,QAAOjI,IACL,MAAME,EAAcF,EAAM8mB,OAC1B,GACE5mB,IACCR,KAAKm0B,WAAW7R,cAAc4O,SAAS1wB,KACvCR,KAAK8yB,WAAWmB,eAAe/C,SAAS1wB,GAEzC,OAAO,EAEPF,EAAMsyB,oBAGV,QAAK,IAENxqB,UAAU,IAAMpI,KAAK2yB,SAG1BA,QACM3yB,KAAK8yB,aACP9yB,KAAK8yB,WAAWsB,UAChBp0B,KAAK8yB,WAAa,MAEhB9yB,KAAK+zB,KACP/zB,KAAK+zB,IAAIrrB,4DAhFF3H,GAAoBrB,iEAApBqB,EAAoBugB,4GAApBxhB,0HCXAu0B,iBAAoBtqB,iBAE7B,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,kDAJJlJ,4DAJF,MAIEA,MCgBAuzB,iBAAmBvqB,iBAE5B,MAAO,CACLC,SAAUjJ,iDAHHA,4DAXF,CACPiM,KACAvN,KACAwvB,KACAsF,KACAvF,KACAriB,OAKS5L,MCdAyzB,iBAEXzsB,YAAoBlI,eAEd40B,OAAO50B,kDACX,MAAMC,EAAMD,EAAIgR,IAChB,IAAIzQ,EAEJ,aAAMJ,KAAKkM,KAAKzC,IAAS3J,GAAKyI,MAC5B,OAAIlI,IACFD,EAASC,EACFA,OAET4K,KAAY5K,IACH,OAAWA,KAEpBq0B,YAEKt0B,kDAlBEW,GAAUrB,wCAAVqB,EAAUsI,QAAVtI,EAAU,qBAFT,SAEDA,MCHA4zB,iBAAY5qB,iBAErB,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,CACTuqB,mDALKzzB,6DAFA,CAACyzB,MAEDzzB,MCCA6zB,iBAAiB7qB,iBAE1B,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,kDAJJlJ,4DAJF,MAIEA,eCuCXgH,YAAoBzG,2BAtBZtB,mBAAgC,GAUhCA,YAA+B,GAK/BA,cAA0C,GAK1CA,iBAAqD,GAS7D60B,UAAUvzB,GACRtB,KAAKonB,OAAS9lB,EACdtB,KAAK80B,aAAexzB,EAAOyzB,gBAAgB/0B,KAAKg1B,kBAChDh1B,KAAKi1B,aAAaj1B,KAAKk1B,QACvBl1B,KAAKm1B,kBAAkBn1B,KAAKo1B,aAO9Bla,eACsB,IAAhBlb,KAAKonB,QACPpnB,KAAKonB,OAAOlR,aAEY,IAAtBlW,KAAK80B,eACP90B,KAAK80B,aAAa5Z,UAClBlb,KAAK80B,kBAAe,GAEtB90B,KAAKq1B,qBACLr1B,KAAKmjB,iBAOP8R,aAAa3zB,GAEX,GADAtB,KAAKk1B,OAAS5zB,OACY,IAAtBtB,KAAK80B,aACP,OAGF,MAAMj1B,EAAWG,KAAK80B,aAAaQ,SACbt1B,KAAKg1B,iBAAiBE,OAC9BpvB,QAAS1F,IACrB,MAAMC,EAAMD,EAAMm1B,SAElBv1B,KAAKw1B,eAAen1B,GAEpB,MAAMC,EAAagB,EAAOjB,GACtBiB,EAAOqF,eAAetG,KACpBC,aAAsBoW,IACxB1W,KAAKy1B,aAAap1B,EAAKC,GAEvBN,KAAK01B,cAAc71B,EAAUQ,EAAKC,MAKQ,mBAApCT,EAAiB81B,gBAC1B91B,EAAiB81B,iBAUdD,cAAcp0B,EAAazB,EAAaC,GAE9C,GAAIA,IADiBwB,EAASzB,GAE5B,OAGF,MAAMQ,EAAYuF,OAAOgwB,eAAet0B,GAClChB,EAAasF,OAAOiwB,yBAAyBx1B,EAAWR,QAC3C,IAAfS,QAA+C,IAAnBA,EAAWmV,IACzCnV,EAAWmV,IAAIhN,KAAKnH,EAAUxB,GAE9BwB,EAASzB,GAAOC,EAQpBq1B,kBAAkB7zB,GAEhB,GADAtB,KAAKo1B,YAAc9zB,OACO,IAAtBtB,KAAK80B,aACP,OAGF,MAAMj1B,EAAWG,KAAK80B,aAAaQ,SACRt1B,KAAKg1B,iBAAiBc,QAC9BhwB,QAAS1F,IAC1B,MAAMC,EAAMD,EAAMm1B,SAClB,GAAIj0B,EAAYqF,eAAetG,GAAM,CACnC,MAAMC,EAAUT,EAASQ,GACnBG,EAAac,EAAYjB,GAC3B8D,MAAM4B,QAAQvF,GAChBA,EAAWsF,QAASpC,IAClB1D,KAAK+1B,cAAcn1B,KAAKN,EAAQ8H,UAAU1E,MAG5C1D,KAAK+1B,cAAcn1B,KAAKN,EAAQ8H,UAAU5H,OAY1Ci1B,aAAan0B,EAAazB,GAChCG,KAAKg2B,SAAS10B,GAAOzB,EAAWuI,UAAWtI,IACzC,MAAMM,EAAWJ,KAAK80B,aAAaQ,SACnCt1B,KAAK01B,cAAct1B,EAAUkB,EAAKxB,GAEc,mBAApCM,EAAiBu1B,gBAC1Bv1B,EAAiBu1B,mBAShBH,eAAel0B,QACM,IAAvBtB,KAAKg2B,SAAS10B,KAChBtB,KAAKg2B,SAAS10B,GAAKoH,cACnB1I,KAAKg2B,SAAS10B,QAAO,GAOjB+zB,qBACNzvB,OAAO+V,OAAO3b,KAAKg2B,UAAUlwB,QAASxE,SAC1B,IAANA,GACFA,EAAEoH,gBAGN1I,KAAKg2B,SAAW,GAMV7S,iBACNnjB,KAAK+1B,cAAcjwB,QAASxE,GAAoBA,EAAEoH,eAClD1I,KAAK+1B,cAAgB,QC9LZE,iBAEXluB,YAAoBlI,mBAOpB6H,OAAO7H,GACL,MAAMC,EAAUE,KAAKk2B,SAASC,wBAAwBt2B,GACtD,OAAO,IAAIu2B,GAAsCt2B,iDAXxCiB,GAAuBrB,yCAAvBqB,EAAuBsI,QAAvBtI,EAAuB,qBAFtB,SAEDA,gDCUAs1B,iBA4BXtuB,YACUlI,EACAC,GADAE,+BACAA,aArBDA,YAAiC,GAKjCA,iBAAuD,GAyBhEkjB,YAAYrjB,GACV,MAAMC,EAAYD,EAAQy2B,UACpBl2B,EAASP,EAAQq1B,OACjB70B,EAAcR,EAAQu1B,YACtB90B,EAAKiG,uBAEX,GAAKzG,GAAcA,EAAUiW,aAI7B,IAAIjW,EAAUiW,eAAiBjW,EAAUgW,cACvC9V,KAAK+0B,gBAAgBj1B,EAAUiW,kBAC1B,CACL,MAAMvV,EACJJ,GAAUE,EAAGF,EAAO2V,cAAgB,GAAI3V,EAAO0V,eAAiB,IAC5DpS,EACJrD,GACAC,EAAGD,EAAY0V,cAAgB,GAAI1V,EAAYyV,eAAiB,KAErC,IAAzBtV,GACFR,KAAKi1B,gBAG2B,IAA9BvxB,GACF1D,KAAKm1B,oBAGTn1B,KAAKkf,MAAMD,iBAOb9G,cACMnY,KAAKu2B,kBACPv2B,KAAKu2B,iBAAiBrb,UAQlB6Z,gBAAgBl1B,QACQ,IAA1BG,KAAKu2B,kBACPv2B,KAAKu2B,iBAAiBrb,UAExBlb,KAAKu2B,iBACH12B,aAAqBu2B,GACjBv2B,EACAG,KAAKw2B,wBAAwB9uB,OAAO7H,GAC1CG,KAAKy2B,kBAOCA,kBACNz2B,KAAKi1B,eACLj1B,KAAKm1B,oBACLn1B,KAAKu2B,iBAAiB1B,UAAU70B,KAAKonB,QAQ/B6N,eACNj1B,KAAKu2B,iBAAiBtB,aAAaj1B,KAAKk1B,QAQlCC,oBACNn1B,KAAKu2B,iBAAiBpB,kBAAkBn1B,KAAKo1B,2DAvHpCr0B,GAAsBrB,iDAAtBqB,EAAsBugB,6EAyBJ5hB,qNChD/BA,kIDuBaqB,MEJA21B,2HAVF,CACP1pB,SASSjM,MCDA41B,4HAJA,CACTV,IACD1G,SATQ,CACPviB,KACA0pB,IAGAA,MAMS31B,MCVA61B,iBAAiB7sB,iBAE1B,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,kDAJJlJ,4DAJF,MAIEA,gJCkBA81B,iBA4BX9uB,cAbS/H,kBAAuB,MAKtBA,gBAAa,IAAIN,uBAKzB,OAAsD,IAA/CM,KAAK82B,QAAQxU,cAAcyU,SAASx2B,OAS7C2iB,YAAYrjB,GACV,MAAMC,EAAWD,EAAQm3B,SACrBl3B,GAAYA,EAASiW,eAAiBjW,EAASgW,qBACnB,IAA1BhW,EAASiW,aACX/V,KAAKkW,QAELlW,KAAKi3B,QAAQn3B,EAASiW,eAU5BmhB,WACEl3B,KAAKm3B,WAAWjf,KAAKlY,KAAKo3B,WAG5BA,UACE,MAAMv3B,EAAO,GACb,gBC7C6BkB,GAC/B,OAAOA,EAAKs2B,OAAOrwB,OAAO,CAAC1F,EAAkBzB,IACpCyB,EAAI0E,OAAOnG,EAAMy3B,QACvB,GAAGtxB,OAAOjF,EAAKu2B,SD0ChB,CAAiBt3B,KAAKu3B,MAAMzxB,QAAShG,IACnCE,KAAKw3B,wBAAwB33B,EAAMC,KAE9BD,EAGDo3B,QAAQp3B,GACdG,KAAKu3B,KAAKD,OAAOxxB,QAAShG,IACxBA,EAAMuoB,QAAQV,UAAS,SAAE9nB,EAAMC,EAAMoR,MAAM0H,cAG7C5Y,KAAKu3B,KAAKF,OAAOvxB,QAAShG,IACxBA,EAAMw3B,OAAOxxB,QAAS1F,IACpBA,EAAMioB,QAAQV,UAAS,SAAE9nB,EAAMO,EAAM8Q,MAAM0H,gBAKzC4e,wBAAwB33B,EAA6BC,GAC3D,MAAMM,EAAUN,EAAMuoB,QACjBjoB,EAAQwjB,WACX/jB,EAAKC,EAAMoR,MAAQ9Q,EAAQ0B,OAOvBoU,QACNlW,KAAKu3B,KAAKlP,QAAQoP,sDArFT12B,8BAAaugB,2cEzB1B5hB,kBAGEA,mCAAYI,eACZJ,iBACEA,iBACEA,SACFA,QACAA,mBACEA,WACFA,QACFA,QACFA,eAXEA,qCAA6B,4BAGFA,4bFqBhBqB,MGFA22B,2HAdF,CACP1qB,KACAqZ,MACAA,OAIAA,MACAA,SAMStlB,MCVA42B,iBAEX5vB,YAAoBlI,sBAEpB03B,KAAK13B,EAAqBC,GACxB,MAAMM,EAAUJ,KAAKooB,YAAYwP,MAAM,IACvC,SAAO9xB,QAASzF,IACdD,EAAQy3B,WAAWx3B,EAAM6Q,KAAM7Q,EAAMgoB,WAEvCvoB,EAAOgG,QAASzF,IACdD,EAAQy3B,WAAWx3B,EAAM6Q,KAAM7Q,EAAMgoB,WAGhC,CAACiP,SAAQD,SAAQhP,WAG1BuP,MAAM/3B,EAA8BC,GAClC,MAAMM,EAAUP,EAAO+O,SAAW,GAC5BvO,EAAUL,KAAKooB,YAAYwP,MAAM,IAKvC,GAJA93B,EAAOgG,QAASxF,IACdD,EAAQw3B,WAAWv3B,EAAM4Q,KAAM5Q,EAAM+nB,WAGnCjoB,EAAQ03B,UAAW,CACrB,MAAMx3B,EAAaN,KAAK+3B,cAAc33B,EAAQ03B,WAC9Cz3B,EAAQ23B,cAAc13B,GAGxB,OAAOsF,OAAOU,OAAO,GAAIzG,EAAQ,CAACy3B,SAAQjP,YAG5C4P,MAAMp4B,GACJ,MAAMC,EAAUD,EAAO+O,SAAW,GAK5BvO,EAAUL,KAAKooB,YAAYC,QAJnB,CACZvmB,MAAO,GACP8hB,SAAU9jB,EAAQ8jB,WAIpB,GAAI9jB,EAAQg4B,UAAW,CACrB,MAAMx3B,EAAaN,KAAK+3B,cAAcj4B,EAAQg4B,WAC9Cz3B,EAAQ23B,cAAc13B,GAGxB,OAAOsF,OAAOU,OAAO,CAACxB,KAAM,QAASjF,EAAQ,CAACwoB,YAGhD6P,kBAAkBr4B,EAAyBC,GACzC,MAAMM,EAAUwF,OAAOU,OAAO,GAAIzG,EAAO+O,SAAW,GAAI9O,EAAQ8O,SAAW,IACrEvO,EAASuF,OAAOU,OAAO,GAAIzG,EAAOq1B,QAAU,GAAIp1B,EAAQo1B,QAAU,IAClE50B,EAAcsF,OAAOU,OAAO,GAAIzG,EAAOu1B,aAAe,GAAIt1B,EAAQs1B,aAAe,IACvF,OAAOxvB,OAAOU,OAAO,GAAIzG,EAAQ,CAAC+O,UAASsmB,SAAQE,gBAG7C2C,cAAcl4B,GACpB,OAAIsE,MAAM4B,QAAQlG,GACTA,EAAgB6F,IAAK5F,GACnBE,KAAKm4B,aAAar4B,IAItBE,KAAKm4B,aAAat4B,GAGnBs4B,aAAat4B,GACnB,GAA4B,iBAAjBA,EACT,OAAOA,EAIT,MACMO,EAAQP,EAAawO,MADhB,mCAGX,OAAKjO,EAMEimB,MAFMjmB,EAAM,IACNA,EAAM,IAJVimB,MAAWxmB,iDA1EXkB,GAAWrB,yCAAXqB,EAAWsI,QAAXtI,EAAW,qBAFV,SAEDA,MCNAq3B,iBAQXrwB,+BAJgBlI,EAAcC,GAC5BiB,EAAiBu2B,OAAOz3B,GAAQC,EAUlCu4B,eAAex4B,GACb,OAAOkB,EAAiBu2B,OAAOz3B,IAd1B,gBAA+B,yCAF3BkB,gCAAgBsI,QAAhBtI,EAAgB,qBAFf,SAEDA,gCCNbrB,SACEA,gCAKFA,8BAJIA,kDAAiC,4BAAjCA,CAAiC,4CCgBxB44B,iBAqBXvwB,YAAoBlI,2BAXZG,sBAA+B,EAK/BA,2BAAyF,qBAG/F,OAAOA,KAAKi4B,MAAMrpB,SAAW,GAK/B2pB,oBACE,OAAOv4B,KAAKw4B,iBAAiBH,eAAer4B,KAAKi4B,MAAMnzB,MAAQ,QAGjE2zB,iBACE,QAAyB,IAArBz4B,KAAK04B,YACP,OAAO14B,KAAK04B,YAGd,MAAM74B,EAASG,KAAK24B,aAAaC,QAAU,GAC3C,YAAKF,YAAc9yB,OAAOU,OACxB,CACEuyB,YAAa74B,KAAKi4B,MAAMhpB,MACxB6pB,cAAe94B,KAAK24B,aAAaG,gBAAiB,GAEpDlzB,OAAOU,OAAO,GAAItG,KAAKi4B,MAAM/C,QAAU,IACvC,CACE6D,YAAa/4B,KAAKi4B,MAAM5P,QACxBuQ,OAAQhzB,OAAOU,OAAO,GNtCrB,CACL0yB,SAAU,mCMqC+Cn5B,KAGlDG,KAAK04B,YAGdO,sBACE,YAA8B,IAA1Bj5B,KAAKk5B,mBAITl5B,KAAKk5B,iBAAmBtzB,OAAOU,OAAO,GAAItG,KAAKi4B,MAAM7C,aAAe,KAH3Dp1B,KAAKk5B,+DAjDLn4B,GAAkBrB,oCAAlBqB,EAAkBugB,4JDlB/B5hB,sCAAeA,2JCkBFqB,MCwBAo4B,2HAxBF,CACPnsB,KACAqZ,MACAA,MACA5mB,KACAosB,MACA0I,KACA6E,MACAzsB,GACA+pB,OAeS31B,gCCzCXrB,iBAIEA,4BACFA,6CAFEA,sCACgBA,qDAPpBA,iBAGEA,wBAMFA,8BALsBA,oEAWtBA,qBAAsCA,8BAAiCA,8BAAjCA,mECMzB25B,iBAiBXtxB,iCAF+B,OAAO/H,KAAK43B,MAAMvP,QAWjDiR,gBAAgBz5B,GACd,IAAIC,EAAU,EACd,MAAMM,EAAUP,EAAM+O,SAAW,GACjC,OAAIxO,EAAQm5B,MAAQn5B,EAAQm5B,KAAO,IACjCz5B,EAAUyH,KAAK0b,IAAI7iB,EAAQm5B,KAAM,IAG5Bz5B,EAUT05B,gBAAgB35B,GAEd,MAAO,EAAE,0BADOG,KAAKs5B,gBAAgBz5B,OACU,GAMjD45B,kBAEE,gBT9CmC14B,EAA0BO,GAC/D,MAEMlB,EADYwF,OAAOC,KADV9E,EAAQ63B,QAAU,IAG9BlzB,IAAKrF,GAAgBiB,EAASjB,IAC9BoG,OAAQpG,QAAgC,IAAZA,GAC/B,OAAOD,EAAcG,OAAS,EAAIH,EAAc,GAAK,GSwCnD,CAA8BJ,KAAK+4B,aADnB/4B,KAAK43B,MAAMhpB,SAAW,IACkBgqB,QAAU,kDArDzD73B,8BAAkBugB,sYDrB/B5hB,wBAWAA,iBACEA,SACFA,QAEAA,qCAdGA,+CAcSA,kZCMCqB,MCKA24B,2HAbF,CACP1sB,KACA6e,MACAlf,GACAwsB,OASSp4B,MCGA44B,4HALA,CACThC,GACAS,IACD7I,SAdQ,CACPviB,KACA0sB,GACAP,IAGAzB,GACAgC,GACAP,MAQSp4B,MCTA64B,2HARF,CACP5sB,KACAqZ,MACA+S,UAKSr4B,MCXA84B,iBAAwB9vB,iBAEjC,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,kDAJJlJ,4DAJF,MAIEA,MCSA+4B,2HAVF,CACPjV,UASS9jB,MCVAg5B,iBAAchwB,iBAEvB,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,kDAJJlJ,4DAJF,MAIEA,MCgDAi5B,2HA7BF,CACPhtB,KACAsZ,MACA2T,MACAC,MACAz6B,KACAuvB,KACAK,KACAxK,MACAuU,MACAS,GACAvF,GACAwF,GACAC,GACAptB,GACA0Z,MACAA,MACAkO,KACA4F,MACAlL,SAUSluB,MCtCAq5B,2HAVF,CACPptB,MAGA4sB,GACAI,GACAF,MAIS/4B,MCVAs5B,iBAIXtyB,YAAoBlI,EAA0BC,GAA1BE,YAA0BA,qBAC5CA,KAAKs6B,QAAUt6B,KAAKu6B,sBAGdC,iBACJx6B,KAAKy6B,UACFryB,UACEvI,IACCG,KAAK06B,gBAAkB76B,GAExBA,IACC,MAAM,IAAI4M,MAAM,sIAKnB8tB,sBACL,OACEv6B,KAAK6O,cAAcnE,UAAU,qCAC7B,gCAIG+vB,UACL,OAAOz6B,KAAKkM,KAAKzC,IAAIzJ,KAAKs6B,SAAS/xB,MACjC,OAAY1I,IACV,QAAEwL,MAAM0D,QAAS,EACXlP,KAKL86B,kBAAkB96B,GACvB,QAA6B,IAAzBG,KAAK06B,gBACP,OAEF,IAAI56B,EAAmBD,EACvB,SAAmBC,EAAiBqG,QAAQ,MAAO,IAC5CnG,KAAK06B,gBAAgB56B,iDA1CnBiB,GAAqBrB,iDAArBqB,EAAqBsI,QAArBtI,EAAqB,YAArBA,MCMA65B,iBAIX7yB,YACUlI,EACAC,EACAM,EACAC,EACAC,GAJAN,qBACAA,oBACAA,uBACAA,6BACAA,uBAPFA,eAAY,EASdA,KAAK66B,iBACP76B,KAAK86B,sBAAsBN,iBAIxBK,gBACL,MAAMh7B,EAAWG,KAAK6O,cAAcnE,UAAU,2CAC9C,YAAiB,IAAb7K,GAGKA,EAIJk7B,qBAAqBl7B,GAI1B,YAA+B,IAA3BG,KAHgC86B,sBAAsBH,kBACxD96B,GASGm7B,mBAAmBn7B,GACxB,MAAMC,EAAqCE,KAAK86B,sBAAsBH,kBACpE96B,GAGF,GAAc,MAAVC,OAAU,EAAVA,EAAYm7B,WACd,UAAW76B,KAAuB,MAAVN,OAAU,EAAVA,EAAYm7B,WAClC,GAA0C,OAAtCr5B,SAASuuB,cAAc/vB,GACzB,OAAO,EAIb,OAAO,EAGF2U,WACL,OAAO/U,KAAKikB,aAAalP,WAGpBmmB,wBAIL,YAAqB,IAAjBl7B,KAHsB6O,cAAcnE,UACtC,iCAKK1K,KAAK6O,cAAcnE,UAAU,gCAG9BywB,WAAWt7B,GACjB,MAAmB,iBAAfA,EACK,CACL,CACEu7B,QAAS,0BACT9rB,KAAMtP,KAAK+P,gBAAgB/B,UAAUgC,QACnC,yCAEFlL,KAAM,SAIO,UAAfjF,EACK,CACL,CACEu7B,QAAS,4BACT9rB,KAAMtP,KAAK+P,gBAAgB/B,UAAUgC,QACnC,yCAEFlL,KAAM,UAER,CACEs2B,QAAS,0BACT9rB,KAAMtP,KAAK+P,gBAAgB/B,UAAUgC,QACnC,yCAEFlL,KAAM,SAKO,SAAfjF,EACK,CACL,CACEu7B,QAAS,4BACT9rB,KAAMtP,KAAK+P,gBAAgB/B,UAAUgC,QACnC,yCAEFlL,KAAM,QAER,CACEs2B,QAAS,0BACT9rB,KAAMtP,KAAK+P,gBAAgB/B,UAAUgC,QACnC,yCAEFlL,KAAM,WAKL,CACL,CACEs2B,QAAS,4BACT9rB,KAAMtP,KAAK+P,gBAAgB/B,UAAUgC,QACnC,yCAEFlL,KAAM,QAER,CACEs2B,QAAS,0BACT9rB,KAAMtP,KAAK+P,gBAAgB/B,UAAUgC,QACnC,yCAEFlL,KAAM,SAKJu2B,UAAUx7B,GAIhB,MAAO,CAFL8xB,MAAO,SAEK9xB,EAAWkH,eAGnBu0B,cACN,MAAMz7B,EAAOG,KACb,IAAIF,EAAQ,EACZ,MACMO,EAAak7B,YAAY,KAC7B,GAAI17B,EAAK27B,iBACP,IAAI37B,EAAK27B,iBAAiB5sB,QAAQ6sB,SAASC,UAAY95B,SAASuuB,cAActwB,EAAK27B,iBAAiB5sB,QAAQ6sB,SAASC,SAGnH,OAFA77B,EAAK87B,cACLC,cAAcv7B,GAET,CACL,MAAMC,EAAqBT,EAAK27B,iBAAiBK,aAC7Cv7B,GAEFA,EADwCw7B,iBAAiB,qCAC5Ch2B,QAAQlC,IACnBA,EAAQm4B,UAAUC,IAAI,oBAG1B,MAAMx7B,EAASF,EACXA,EAAmB6vB,cAAc,yBACjC,EAOJ,GALArwB,KACIU,GAAUV,EApBL,KAqBP87B,cAAcv7B,GAGZG,EAAQ,CACV,MAAMkD,EAAa7D,EAAKo8B,MAClBr4B,EAAWhC,SAASC,cAAc,QACxC+B,EAASs4B,UAAY,oBACrBt4B,EAASu4B,UAAY,GACnBz4B,EAAWxD,QAAQL,EAAK27B,kBAAoB,KAC1C93B,EAAWnD,SACfC,EAAO47B,aACLx4B,EACAtD,EAAmB6vB,cAAc,8BAKxC,KAGGkM,UAAUx8B,EAAOC,EAAMM,GAC7B,GAAIN,EAAK07B,iBAAkB,CACzB,GAAI17B,EAAK07B,iBAAiB5sB,QAAQ6sB,SAASC,SAAW95B,SAASuuB,cAAcrwB,EAAK07B,iBAAiB5sB,QAAQ6sB,SAASC,SAElH,YADA57B,EAAKwlB,WAIP,GAAIzlB,EAAMyZ,QAAUxZ,EAAKm8B,MAAM17B,OAAS,EAEtC,YADAT,EAAKwlB,WAIPxlB,EAAKm8B,MAAMj3B,OAAOnF,EAAMyZ,MAAO,GAC/B,MAAMjZ,EAAWP,EAAKm8B,MAAMp8B,EAAMyZ,OAC9BjZ,EAASuO,QAAQ6sB,SAASC,UAAY95B,SAASuuB,cAAc9vB,EAASuO,QAAQ6sB,SAASC,SACzFt7B,EAAQi8B,UAAUx8B,EAAOC,EAAMM,IAE/BN,EAAKw8B,cACLx8B,EAAKy8B,KAAKl8B,EAASuE,MAKjB43B,cACN38B,EACAC,GAMA,IAJKA,GAKHA,EAAa28B,YAC0B,MAArC38B,EAAa28B,UAAUt8B,OAAO,IAC9ByB,SAASuuB,cAAcrwB,EAAa28B,UAAUr5B,MAAM,KACd,MAArCtD,EAAa28B,UAAUt8B,OAAO,KAC5ByB,SAASuuB,cAAcrwB,EAAa28B,YAEzC,OAGF,MAAMr8B,EAAuBwB,SAASuuB,cACpCrwB,EAAa47B,SAAW77B,EAAK67B,SAEzBr7B,EAASL,KAAKq7B,UAAUv7B,EAAamsB,QACvC7rB,GAAWC,GACbD,EAAQC,KAIJq8B,qBACN78B,EACAC,GAEA,OAAO,IAAIkL,QAAe5K,IAExB,GADAJ,KAAKw8B,cAAc38B,EAAMC,IACpBA,IAAiBA,EAAa68B,QAEjC,YADAv8B,IAGF,IAAIC,EAAQ,EACZ,MAAMC,EAASR,EAAa88B,QAAU98B,EAAa88B,QAAU,IAAM,GAC7Dp8B,EAAa+6B,YAAY,KAC7Bl7B,KACIA,EAAQC,GAAUsB,SAASuuB,cAAcrwB,EAAa68B,YACxDf,cAAcp7B,GACdJ,MAED,OAICy8B,iBAAiBh9B,GACvB,MAAMC,EAAgB,GAEtB,IAAIM,EAAI,EACR,UAAWC,KAAQR,EAAWo8B,MAC5Bn8B,EAAcc,KAAK,CACjB66B,SAAU,CACRC,QAASr7B,EAAKq7B,QACd5yB,GAAIzI,EAAK2yB,UAAYnzB,EAAWmzB,UAElC8J,cAAe,CACbC,UAAW,CAAC,CAAE7rB,KAAM,SAAUtC,QAAS,CAAEouB,OAAQ,CAAC,EAAG,QAEvDC,kBAAmB,IACVjyB,QAAQyP,IAAI,CACjBza,KAAK08B,qBACH18B,KAAKk9B,aACLl9B,KAAKk9B,aAAel9B,KAAKk9B,aAAaC,kBAAe,GAEvDn9B,KAAK08B,qBAAqBr8B,EAAMA,EAAK+8B,cAGzCtG,QAAS92B,KAAKm7B,WACN,IAAN/6B,EACI,QACAA,EAAI,IAAMP,EAAWo8B,MAAM17B,OAC3B,OACAV,EAAWo8B,MAAM77B,GAAGi9B,aACpB,oBACA,GAENjC,QAAS/6B,EAAKi9B,MACdC,eAAgBl9B,EAAKk9B,eACrBC,SAAUn9B,EAAKo9B,iBAAmB59B,EAAW49B,kBAAmB,EAChEC,eAAgBr9B,EAAKs9B,oBAChBt9B,EAAKs9B,wBACN,EACJ1uB,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QACpC3P,EAAK4O,OAASpP,EAAWoP,OAE3BK,KAAM,CAACtP,KAAK+P,gBAAgB/B,UAAUgC,QAAQ3P,EAAKiP,OACnDsuB,KAAM,CACJrB,KAAM,KACJv8B,KAAKw8B,cAAcn8B,EAAMA,EAAKw9B,SAEhCC,KAAM,KACJ99B,KAAKk9B,aAAe78B,EACpBL,KAAKw8B,cAAcn8B,EAAMA,EAAK09B,YAIpC39B,IAGF,OAAON,EAGFk+B,UAAUn+B,GACf,MAAMC,EAAqCE,KAAK86B,sBAAsBH,kBACpE96B,GAGFG,KAAKi+B,gBAAgBC,mBAAqB,CACxC9C,QAASt7B,EAAWw9B,MACpBC,eAAgBz9B,EAAWy9B,eAC3BG,gBAAgB59B,EAAW69B,qBACtB79B,EAAW69B,mBAEhBQ,WAAY,CACVC,SAAS,IAIb,MAAMh+B,EAAgBJ,KAAK68B,iBAAiB/8B,GAE5CE,KAAKi+B,gBAAgBI,OAAQ,EAC7Br+B,KAAKi+B,gBAAgBK,eAAgB,EACrCt+B,KAAKi+B,gBAAgBM,SAASn+B,GAE9BJ,KAAKi+B,gBAAgBO,WAAW11B,GAAG,OAAQ9I,KAAKs7B,aAChDt7B,KAAKi+B,gBAAgBO,WAAW11B,GAAG,SAAWzI,IAC5CL,KAAKq8B,UAAUh8B,EAAOL,KAAKi+B,gBAAgBO,WAAYx+B,QAGzDA,KAAKi+B,gBAAgBQ,sDApVZ19B,GAAsBrB,+EAAtBqB,EAAsBsI,QAAtBtI,EAAsB,qBAFrB,SAEDA,eCyBXgH,YAAoBzG,EAA0B,IAA1BtB,eA5BpBA,iBAAqC,IAAI+I,SAAgB,GAKzD/I,cAAsC,IAAI+I,IAAgB,IAUlD/I,uBAA8B,GAK9BA,WAAQ,IAAI0+B,GAAkB,GAAI,CACxCtlB,OAASvZ,GAAeA,EAAKqR,OAQ7BlR,KAAK2+B,WAAWr9B,EAAQs9B,SACxB5+B,KAAK6+B,yBALL,OAAO7+B,KAAKoR,MAAMkM,UAWpBpC,UACElb,KAAK8+B,aAAap2B,cAClB1I,KAAKoR,MAAM8J,UAQb6jB,QAAQz9B,GACN,OAAOtB,KAAKoR,MAAM3H,IAAInI,GAOxB09B,WACE,OAAOh/B,KAAKoR,MAAMqJ,MAOpBwkB,SAAS39B,GACPtB,KAAKoR,MAAMxG,KAAKtJ,GAOlB49B,aACE,OAAOl/B,KAAKm/B,SAASxV,WAOvBgV,WAAWr9B,GACTtB,KAAKm/B,SAASh3B,KAAK7G,GAAW,IAQhC89B,aAAa99B,EAAczB,EAAkC,IAC3D,MAAMC,EAAOE,KAAK++B,QAAQz9B,QACb,IAATxB,GAIJE,KAAKoR,MAAM0G,MAAM4B,OAAO5Z,EAAM,CAAE0f,QAAQ,EAAM5Q,YAAW,GAM3DywB,uBACE,GAAIr/B,KAAKs/B,kBAAkB/+B,QAAU,EAEnC,YADAP,KAAKu/B,iBAGP,MAAOj+B,EAAUzB,GAAWG,KAAKs/B,kBAAkBt6B,QAAO,EAAI,GAC9DhF,KAAKo/B,aAAa99B,GAwCpBi+B,iBACEv/B,KAAKw/B,yBACLx/B,KAAKoR,MAAM0G,MAAMkC,UAAU,CAAEwF,QAAQ,IAM/Bqf,YACN7+B,KAAKoR,MAAQ,IAAIstB,GAAkB,GAAI,CACrCtlB,OAAS9X,GAAiBA,EAAO4P,OAGnClR,KAAK8+B,aAAe9+B,KAAKoR,MAAM+L,UAC5BrC,SAAUxZ,IAAuD,IAAxBA,EAAOwW,MAAM0H,QACtDpX,UAAW9G,IACV,QAAe,IAAXA,EAEF,YADAtB,KAAKy/B,mBAAc,GAIrB,MAAM5/B,EAAOyB,EAAOkd,OACd1e,EAAU8F,OAAOU,OACrB,GACAzG,EAAK+O,SAAW,GAChBtN,EAAOwW,MAAMlJ,SAAW,IAE1B5O,KAAKy/B,cAAc75B,OAAOU,OAAO,GAAIzG,EAAM,CAAE+O,eAQ3C6wB,cAAcn+B,GACpBtB,KAAK0/B,YAAYv3B,KAAK7G,QACT,IAATA,EACFtB,KAAKw/B,yBAELx/B,KAAKs/B,kBAAoBt/B,KAAKs/B,kBAC3B74B,OAAQ5G,GAAiBA,IAASyB,EAAK4P,MACvClL,OAAO,CAAC1E,EAAK4P,OAOZsuB,yBACNx/B,KAAKs/B,kBAAoB,QCnMhBK,iBAYX53B,cANO/H,aAAmB,IAAI4/B,GAO5B5/B,KAAK6/B,QAAQZ,SAASj/B,KAAKg/B,4BALbn/B,GACdkB,EAAY++B,MAAMjgC,EAAKqR,MAAQrR,EAYjCk/B,QAAQl/B,GACN,OAAOkB,EAAY++B,MAAMjgC,GAO3Bm/B,WACE,OAAOp5B,OAAO+V,OAAO5a,EAAY++B,QA7B5B,eAAiC,yCAD7B/+B,gCAAWsI,QAAXtI,EAAW,qBAFV,SAEDA,+CCXbrB,oBACEA,0EAMAA,kBAA4CA,oEAAyGA,QACrJA,gEAMFA,gCAZEA,8BAAsB,iCAKsBA,6HAG1CA,4LCCSqgC,iBAkFXh4B,YACUlI,EACAC,GADAE,8BACAA,mBAhFDA,iBAAsB,GAEtBA,+BAA6CgM,MAAG,OAEzDg0B,WACE,MAAO,CACL,wBAA8C,SAArBhgC,KAAKigC,YAC9B,mBAAyC,WAArBjgC,KAAKigC,aAAgBJ,cAK3C,OAAO7/B,KAAKkgC,YAAYL,QAG1BM,iBACE,OAAIngC,KAAKogC,YACApgC,KAAKogC,YAELpgC,KAAKqgC,oCAKd,GAAIrgC,KAAK6/B,QACP,OAAI7/B,KAAKsgC,aACAtgC,KAAK6/B,QAAQH,YAAY/V,WAAWzY,KAEpC,4BAQX,GAAIlR,KAAK6/B,QACP,YAA+C,IAAxC7/B,KAAK6/B,QAAQH,YAAY/V,WAAe4W,qBAOjD,QAA4B,UAAxBvgC,KAAKqgC,iBAA+BrgC,KAAKogC,cAGtCpgC,KAAKwgC,uBAAuBzF,qBACjC/6B,KAAKmgC,uCAMP,IAAItgC,EAMAC,EAJJ,OADAD,EAAWG,KAAKugC,gBACC,IAAb1gC,KAKAG,KAAKwgC,uBAAuBzrB,aAC9BjV,EAAkBE,KAAKk7B,uBACC,IAApBp7B,IAAoBo7B,4BAQ1B,OAAOl7B,KAAKwgC,uBAAuBtF,iDAInC,OAAOl7B,KAAKwgC,uBAAuBxF,mBAAmBh7B,KAAKqgC,gBAQ7DI,uBACE,MAAM5gC,EAAOG,KAAKmgC,iBACdtgC,GACFG,KAAKwgC,uBAAuBxC,UAAUn+B,iDA1F/BkB,GAAwBrB,8CAAxBqB,EAAwBugB,ggBDXrC5hB,iCAASA,kbCWIqB,MCYA2/B,4HAHA,CAAC9F,GAAwBP,IAAsB9K,SAPjD,CACPviB,KACAvN,KACAuvB,KACAC,KACAtiB,OAKS5L,MClBA4/B,iBACX5b,UAAUllB,EAAYC,GACpB,MAAMM,EAAY,GAClB,cAAOiH,oBAAoBxH,GAAOiG,QAASzF,GACzCD,EAAUQ,KAAK,CAAEqF,MAAKnE,MAAOjC,EAAMQ,MAG9BD,gDAPEW,+CAAYwkB,UAAZxkB,MCGA6/B,iBAAiB72B,iBAE1B,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,kDAJJlJ,4DAJF,MAIEA,MCKA8/B,iBAoGX94B,YAAmBlI,EAA4BC,GAA5BE,gBAA4BA,UAvFvCA,YAAS,UAuBTA,eAAW,EAsBXA,gBAAY,EAsBZA,gBAAY,EAEVA,kBAAe,IAAIN,MACnBM,iBAAc,IAAIN,MAClBM,oBAAiB,IAAIN,MACrBM,mBAAgB,IAAIN,MACpBM,mBAAgB,IAAIN,MACpBM,kBAAe,IAAIN,MACnBM,WAAQ,IAAIN,MACZM,aAAU,IAAIN,MACdM,YAAS,IAAIN,MACbM,cAAW,IAAIN,MACfM,aAAU,IAAIN,MACdM,YAAS,IAAIN,kBArFrB,OAAOM,KAAK8gC,iBAEJjhC,GACRG,KAAK8gC,OAASjhC,gBAMd,OAAOG,KAAK+gC,qBAEFlhC,GACNA,IAAUG,KAAK+gC,WAGf/gC,KAAK4jB,WAIT/jB,EAAQG,KAAKghC,YAAY9oB,KAAKlY,MAAQA,KAAKihC,cAAc/oB,KAAKlY,MAE9DA,KAAK+gC,SAAWlhC,GACM,IAAlBG,KAAKqgB,UACPrgB,KAAKkhC,qBAGPrhC,EAAQG,KAAKmhC,MAAMjpB,KAAKlY,MAAQA,KAAKohC,QAAQlpB,KAAKlY,uBAMlD,OAAOA,KAAK4hB,uBAED/hB,GACPA,IAAUG,KAAK4hB,YAGf5hB,KAAK4jB,WAIT/jB,EAAQG,KAAKqhC,aAAanpB,KAAKlY,MAAQA,KAAKshC,eAAeppB,KAAKlY,MAEhEA,KAAK4hB,UAAY/hB,EACjBG,KAAK+gC,SAAWlhC,EAChBG,KAAKuhC,sBAEL1hC,EAAQG,KAAK6C,OAAOqV,KAAKlY,MAAQA,KAAKwhC,SAAStpB,KAAKlY,uBAMpD,OAAOA,KAAKyhC,uBAED5hC,GACPA,IAAUG,KAAKyhC,aAIL,IAAV5hC,IACFG,KAAKqgB,UAAW,GAGlBxgB,EAAQG,KAAK0hC,cAAcxpB,KAAKlY,MAAQA,KAAK2hC,aAAazpB,KAAKlY,MAE/DA,KAAKyhC,UAAY5hC,EACjBG,KAAK4hC,sBAEL/hC,EAAQG,KAAKgpB,QAAQ9Q,KAAKlY,MAAQA,KAAK6hC,OAAO3pB,KAAKlY,OAkBrDwhB,UACExhB,KAAKqgB,UAAW,EAKlByhB,eAGE,OAAO9hC,KAAKqiB,GAAGC,cAAcyf,UAFb,EAKVb,qBACFlhC,KAAKgiC,QACPhiC,KAAKgiB,OAAOjhB,EAAkBkhC,YAE9BjiC,KAAKoiB,UAAUrhB,EAAkBkhC,YAI7BV,sBACFvhC,KAAKqgB,UACPrgB,KAAKgiB,OAAOjhB,EAAkBkhB,aAC9BjiB,KAAKoiB,UAAUrhB,EAAkBkhC,aAEjCjiC,KAAKoiB,UAAUrhB,EAAkBkhB,aAI7B2f,sBACF5hC,KAAK4jB,SACP5jB,KAAKgiB,OAAOjhB,EAAkBmhC,aAE9BliC,KAAKoiB,UAAUrhB,EAAkBmhC,aAI7BlgB,OAAOniB,GACbG,KAAK2iB,SAASC,SAAS5iB,KAAKqiB,GAAGC,cAAeziB,GAGxCuiB,UAAUviB,GAChBG,KAAK2iB,SAASE,YAAY7iB,KAAKqiB,GAAGC,cAAeziB,IAxI5C,oBAAa,wBACbkB,cAAc,yBACdA,cAAc,+DAJVA,GAAiBrB,oDAAjBqB,EAAiBugB,kGAAjBxhB,8bCQAqiC,iBA2DXp6B,YAAoBlI,aAnDZG,kBAAc,EASdA,iBAAa,EAqBbA,mBAAgC,oBAnCtC,OAAOA,KAAKoiC,2BAECviC,GACbG,KAAKoiC,YAAcviC,kBAMnB,OAAOG,KAAKqiC,yBAEAxiC,GACZG,KAAKqiC,WAAaxiC,qBAKlB,OAAOG,KAAKsiC,+BAEGziC,GACfG,KAAKuiC,YAAc1iC,EACnBG,KAAKsiC,cAAgBziC,oBAKrB,OAAOG,KAAKwiC,6BAEE3iC,GACdG,KAAKwiC,aAAe3iC,EAatB4iC,oBAAoB5iC,GAIdG,KAAK0iC,oBACW,YAAd7iC,EAAMoG,KAAmC,cAAdpG,EAAMoG,KACnCpG,EAAM+yB,iBACN5yB,KAAK2T,SAAS9T,EAAMoG,MACG,UAAdpG,EAAMoG,KACfjG,KAAK6C,OAAO7C,KAAKuiC,cAOvB/hB,WACExgB,KAAK2iC,mBAGPC,kBACM5iC,KAAK6iC,UAAUtiC,QACjBP,KAAK8iC,OAGP9iC,KAAK+iC,YAAc/iC,KAAK6iC,UAAUG,QAAQ56B,UACvCvI,GAA+BG,KAAK8iC,QAIzC3qB,cACEnY,KAAK+iC,YAAYr6B,cAGnBy4B,MAAMthC,IACCG,KAAK2hB,YAIV3hB,KAAKohC,eAIQ,IAATvhC,IACFA,EAAKmiC,SAAU,IAInBZ,eAC2B,IAArBphC,KAAKuiC,cACPviC,KAAKuiC,YAAYP,SAAU,GAG7BhiC,KAAKuiC,iBAAc,EAGrBU,YACE,MAAMpjC,EAAQG,KAAK6iC,UAAUK,UAC7B,IAAIpjC,EACJ,MAAMM,EAAUJ,KAAKqiB,GAAGC,cACxB,IAAIjiB,GAAW,EACXC,EAAQN,KAAKmjC,kBAKjB,SAJc,IAAV7iC,IACFA,GAAQ,GAGHD,GAAYC,EAAQT,EAAMU,OAAS,GACxCD,GAAS,EACTR,EAAOD,EAAMS,GACbD,EAAWP,EAAK8jB,cAGL,IAAT9jB,GACFE,KAAKmhC,MAAMrhC,GAGRD,EAAMS,EAAQ,QAKN,IAATR,IAAuBE,KAAKojC,mBAAmBtjC,EAAKuiB,GAAGC,iBACzDliB,EAAQquB,UACN3uB,EAAKuiB,GAAGC,cAAcyf,UACtBjiC,EAAKuiB,GAAGC,cAAcyU,SAAS,GAAGsM,aAClCjjC,EAAQmuB,cARVnuB,EAAQquB,UAAYruB,EAAQouB,aAAepuB,EAAQmuB,aAYvD+U,gBACE,MAAMzjC,EAAQG,KAAK6iC,UAAUK,UAC7B,IAAIpjC,EACJ,MAAMM,EAAUJ,KAAKqiB,GAAGC,cACxB,IAAIjiB,GAAW,EACXC,EAAQN,KAAKmjC,kBAEjB,KAAO9iC,GAAYC,EAAQ,GACzBA,GAAS,EACTR,EAAOD,EAAMS,GACbD,EAAWP,EAAK8jB,cAGL,IAAT9jB,GACFE,KAAKmhC,MAAMrhC,GAGRD,EAAMS,EAAQ,QAKN,IAATR,GAAuBE,KAAKojC,mBAAmBtjC,EAAKuiB,GAAGC,iBAEzDliB,EAAQquB,UAAY3uB,EAAKuiB,GAAGC,cAAcyf,UAD1B,GALhB3hC,EAAQquB,UAAY,EAUxB5rB,OAAOhD,IACAG,KAAK2hB,YAIV3hB,KAAKwhC,gBAEQ,IAAT3hC,IACFA,EAAKwgB,UAAW,IAIpBmhB,WACExhC,KAAKohC,eAEqB,IAAtBphC,KAAKujC,eACPvjC,KAAKujC,aAAaljB,UAAW,GAG/BrgB,KAAKujC,kBAAe,EAGtBZ,mBACM3iC,KAAKwjC,aACPxjC,KAAK0iC,mBAAoB,GAI7Be,oBACEzjC,KAAK0iC,mBAAoB,EAG3BgB,aAAa7jC,GACXG,KAAKqiB,GAAGC,cAAcmM,UAAY5uB,EAAKiiC,eAGzCsB,mBAAmBvjC,GACjB,MAAMC,EACJE,KAAKqiB,GAAGC,cAAcmM,UAAYzuB,KAAKqiB,GAAGC,cAAcyf,UAGpD1hC,EAAUR,EAAKkiC,UAErB,OAAO1hC,EADsBR,EAAKk3B,SAAS,GAAGsM,cAHxBvjC,EAAaE,KAAKqiB,GAAGC,cAAciM,cAInBluB,GAAWP,EAG3CgjC,OACN9iC,KAAKoI,YAELpI,KAAKujC,aAAevjC,KAAK2jC,mBACzB3jC,KAAKuiC,YAAcviC,KAAK4jC,kBAExB5jC,KAAK2iC,mBAGCv6B,YACNpI,KAAK0I,cAEL1I,KAAK6iC,UAAUK,UAAUp9B,QAAQjG,IAC/BG,KAAK+1B,cAAcn1B,KACjBf,EAAKwhC,aAAaj5B,UAAWtI,GAC3BE,KAAK6jC,uBAAuB/jC,KAIhCE,KAAK+1B,cAAcn1B,KACjBf,EAAKgD,OAAOuF,UAAWtI,GACrBE,KAAK8jC,iBAAiBhkC,KAI1BE,KAAK+1B,cAAcn1B,KACjBf,EAAKmhC,YAAY54B,UAAWtI,GAC1BE,KAAK+jC,sBAAsBjkC,KAI/BE,KAAK+1B,cAAcn1B,KACjBf,EAAKshC,MAAM/4B,UAAWtI,GACpBE,KAAKgkC,gBAAgBlkC,MAGxBE,MAGG0I,cACN1I,KAAK+1B,cAAcjwB,QAASjG,GAAsBA,EAAI6I,eACtD1I,KAAK+1B,cAAgB,GAGfgO,sBAAsBlkC,GACxBA,IAASG,KAAKuiC,aAChBviC,KAAKohC,UAID4C,gBAAgBnkC,GACtBG,KAAKuiC,YAAc1iC,EAGbgkC,uBAAuBhkC,GACzBA,IAASG,KAAKuiC,aAChBviC,KAAKwhC,WAIDsC,iBAAiBjkC,GACvBG,KAAKujC,aAAe1jC,EAGd8jC,mBACN,OAAO3jC,KAAK6iC,UAAUK,UAAUroB,KAAKhb,GAAQA,EAAKwgB,UAG5CujB,kBACN,OAAO5jC,KAAK6iC,UAAUK,UAAUroB,KAAKhb,GAAQA,EAAKmiC,SAG5CmB,kBACN,OAAOnjC,KAAK6iC,UACTK,UACAx+B,UAAU7E,GAAQA,IAASG,KAAKuiC,aAG7B5uB,SAAS9T,GACf,OAAQA,OACD,UACHG,KAAKsjC,gBACL,UACG,YACHtjC,KAAKijC,2DApSAliC,GAAarB,uCAAbqB,EAAaugB,wEAwCPuf,GAAiB,qHAxCvB/gC,2BAA2B,QAwCJJ,CAxCI,2BAA3BI,2BAA2B,sMCrBxCJ,sBAGEA,mCAAYI,uBAAZJ,CAAgC,0BACvBI,uBACTJ,SACFA,cAJEA,orCDmBWqB,MENAkjC,iBAAal6B,iBAEtB,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,kDAJJlJ,4DAJF,CAACiM,KAAcvN,KAAe0vB,KAAeiC,OAI3CrwB,gCCfbrB,iBACEA,cACEA,WACAA,iBACEA,SACAA,WACFA,QACAA,WACFA,QACFA,8BALMA,uMCSOwkC,iBANbn8B,cAwBU/H,kBAAc,cAfpB,OAAOA,KAAK6xB,iBAEJhyB,GACRG,KAAK6xB,OAAShyB,mBAOd,OAAOG,KAAKmkC,2BAECtkC,GACbG,KAAKmkC,YAActkC,gDAhBVkB,8BAAcugB,kaDb3B5hB,wBAUAA,iBACEA,SACFA,cAZMA,24BCaOqB,MCJAqjC,2HAJF,CAACp3B,SAICjM,yFCAAsjC,iBAQXt8B,cANO/H,YAAmC,IAAI+I,KAAgB,aAGpDlJ,GAAkBG,KAAKskC,OAAOn8B,KAAKtI,eACtB,OAAOG,KAAKskC,OAAOxiC,MAI1Cy6B,OACEv8B,KAAKukC,OAAQ,EAGfzG,OACE99B,KAAKukC,OAAQ,gDAfJxjC,8BAAgBugB,4LCT7B5hB,kCAEEA,iBACAA,kCACFA,cAHEA,2dDQWqB,MEOAyjC,iBAMXz8B,YACkBlI,EACRC,GADQE,eACRA,uBAQVwgB,WACExgB,KAAKykC,UAAYzkC,KAAK6J,gBAAgBV,SACnCZ,MAAK,OAAa,KAClBH,UAAWvI,IACVA,EAAQ,EAAIG,KAAK0kC,QAAQnI,OAASv8B,KAAK0kC,QAAQ5G,SAQrD3lB,cACEnY,KAAKykC,UAAU/7B,4DA7BN3H,GAAwBrB,+CAAxBqB,EAAwBugB,2CAAxBvgB,MCJA4jC,2HAJF,CAAC33B,KAAc43B,UAIb7jC,uBCFwB8jC,MASnC98B,YACUzG,EACAzB,EACAC,GAER+f,QAJQ7f,iBACAA,cACAA,aALFA,mBAAgB,IAAI+I,IAAgB,iBAL1C,OAAO/I,KAAK8kC,cAAchjC,iBAEjBR,GACTtB,KAAK8kC,cAAc38B,KAAK7G,GAc1ByjC,UACE,OAAK/kC,KAAKglC,aASHC,MALLjlC,KAAKglC,UAAUE,WACfllC,KAAK8kC,cACL9kC,KAAKmlC,MAAMC,YAGuB78B,MAClC,OAAI,IACKvI,KAAKqlC,gBAAgBrlC,KAAKglC,UAAUzb,QAE7C,OAAI1pB,GACKG,KAAKslC,cAAczlC,QAbrBolC,MAAM,IAkBjBM,cAEAF,gBAAgB/jC,GACd,OAAKtB,KAAKyG,OAGHnF,EAAK8B,QAAQqD,OAAQ5G,IAO8B,IAN9BG,KAAKwlC,OAAO7e,QACnClgB,OAAOrG,GAAKA,EAAEqlC,YACd//B,IAAItF,GAAKmG,UAAoB1G,EAAMO,EAAE8Q,OACrCpQ,KAAK,KACLiG,cAEc7G,QAAQF,KAAKyG,OAAOM,gBAT9BzF,EAaXgkC,cAAchkC,GACZ,OAAKtB,KAAKmlC,MAAM3lB,QAAmC,KAAzBxf,KAAKmlC,MAAMvoB,UAI9Btb,EAAK2Z,KAAK,CAACpb,EAAGC,KACnB,MAAMM,EAA6BmG,UACjC1G,EACAG,KAAKmlC,MAAM3lB,QAEPnf,EAA6BkG,UACjCzG,EACAE,KAAKmlC,MAAM3lB,QAGb,OAAOjZ,iBACLlG,EACAD,EACAJ,KAAKmlC,MAAMvoB,aAhBNtb,OCpEDokC,SAAZ,OAAY3kC,UAAgB,KAC1BA,uBACAA,uBACAA,mBAHU2kC,GAAZ,IAAY3kC,iDCCVrB,kBACEA,6BACEA,4CACFA,QACFA,eAF4BA,6GAStBA,iBACEA,2BAAcA,8EAAoC,OAGlDA,QACFA,gCAHgBA,oEAAmD,sGAInEA,iBACEA,2BAAcA,iCAASU,qBAATV,CAAkC,mEACfc,sBAAwB,OAEzDd,QACFA,8CAFgBA,+EAOdA,iBAAuDA,SAAiBA,yCAAjBA,wDADzDA,SACEA,wBACFA,mCAGEA,iBAAuCA,SAAiBA,yCAAjBA,wDADzCA,SACEA,uBACFA,iEAGEA,iBAEEA,SACFA,iEAFEA,8EACAA,qEAHJA,SACEA,wBAIFA,kCAGEA,yEACEA,8EAAuE,+DADzEA,kDAjBJA,YACEA,kCAIAA,kCAIAA,kCAOAA,4CAMFA,6CAtBcA,6BACGA,kCAIAA,mCAIAA,+BAAoB,qCAiBnCA,0DAEEA,qBAGAA,mHACEA,uBACFA,+CAHAA,yCAEYA,4DALdA,iBACEA,4BAMFA,8BAN6BA,iEAS/BA,0DACAA,iBAGEA,2DAASA,EAATomB,MAASnE,sBACXjiB,8CAFEA,+ECrCKimC,iBALb59B,cA+BU/H,sBAAkB,EAInBA,eAAY,IAAI6kC,OAAoB,EAAM,IAGjD7kC,YAAS,IAAIN,qBA9BX,OAAOM,KAAKglC,uBAEDnlC,GACXG,KAAKglC,UAAYnlC,cAMjB,OAAOG,KAAKwlC,iBAEJ3lC,GACRG,KAAKwlC,OAAS3lC,uBAMd,OAAOG,KAAK4lC,mCAEK/lC,GACjBG,KAAK4lC,gBAAkB/lC,EAkBzB2gB,WACExgB,KAAK0mB,WAAa,IAAImf,GAAgB7lC,KAAK8lC,SAAU9lC,KAAK+lC,MAAO/lC,KAAKib,MAElEjb,KAAK+lC,QACP/lC,KAAKgmC,iBAAmBhmC,KAAK+lC,MAAMpf,QAChClgB,OAAO5G,IAAqB,IAAhBA,EAAEomC,WACdvgC,IAAI7F,GAAKA,EAAEqR,MAEVlR,KAAK+lC,MAAMlf,mBACb7mB,KAAKgmC,iBAAiBE,QAAQ,qBAE5BlmC,KAAK+lC,MAAMI,SAAWnmC,KAAK+lC,MAAMI,QAAQ5lC,QAC3CP,KAAKgmC,iBAAiBplC,KAAK,WAI/BZ,KAAK2hB,UAAUykB,QAAQh+B,UAAUvI,GAAKG,KAAK6C,OAAOqV,KAAKrY,IAGzD+iC,kBACM5iC,KAAKyG,SACP,OAAUzG,KAAKyG,OAAO6b,cAAe,SAClC/Z,QACC8P,KAAa,MACb,UAEDjQ,UAAU,MACJpI,KAAK0mB,aAGV1mB,KAAK0mB,WAAWjgB,OAASzG,KAAKyG,OAAO6b,cAAcxgB,SAK3DohB,YAAYrjB,GACNA,EAAOimC,WACT9lC,KAAK0mB,WAAa,IAAImf,GACpB7lC,KAAK8lC,SACL9lC,KAAK+lC,MACL/lC,KAAKib,MAEPjb,KAAK2hB,UAAUzL,SAInBmwB,eAAexmC,GACb,OAAO6lC,GAAiB7lC,GAG1B8pB,SAAS9pB,EAAKC,GACZ,OAAOyG,UAAoB1G,EAAKC,GAIlCwmC,gBAGE,OAFoBtmC,KAAK2hB,UAAUtB,SAAS9f,SAC5BP,KAAK8lC,SAASvc,KAAKhpB,OAKrCgmC,eACEvmC,KAAKsmC,gBACDtmC,KAAK2hB,UAAUzL,QACflW,KAAK8lC,SAASvc,KAAKzjB,QAAQjG,GAAOG,KAAK2hB,UAAU9e,OAAOhD,IAG9D2mC,kBAAkB3mC,EAAOC,EAAQM,GAC/BP,EAAM4hB,kBACN3hB,EAAO6xB,MAAMvxB,iDAhHJW,8BAAcugB,2EAwCd4Y,MAAO,m8CDrEpBx6B,iBACEA,wBAMAA,iBACEA,qBAGEA,WACEA,uBAMAA,uBAMFA,QAEAA,iCAyBAA,WACEA,wBACAA,wBAQFA,QAEAA,yBACAA,yBAMFA,QACFA,QAEFA,eAxE6BA,wCAODA,0CAkBwCA,0CAqC1CA,qDAEGA,q6BCpChBqB,MCIA0lC,iBAAc18B,iBAEvB,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,kDAJJlJ,4DAhBF,CACPiM,KACAqZ,MACAqgB,MACAjnC,KACAuvB,KACA1I,MACAuF,MACA0I,KACA2F,MACA7K,KACA1iB,OAKS5L,uBC1BoB29B,QCPrBiI,SAAZ,OAAY5lC,UAAY,KACtB6lC,cACA7lC,cACAA,oBAHU4lC,GAAZ,IAAY5lC,kBCUVA,EAAQ,QACRO,EAAO,eAEP,OAAO,SAAQ,iBAAkB,IAC/BulC,OACE,WACAA,OAAM,CACJ9hB,UAAW,6BAGf8hB,OAAW,iBAAiB,SAAQ9lC,EAAQ,IAAMO,gCCpBtD5B,oGAEEA,6BAAqB,cAArBA,CAAqB,2CAArBA,CAAqB,kDAArBA,CAAqB,+CAArBA,CAAqB,qKAQvBA,iBAKEA,sFAA4C,mGAG5CA,gCAKFA,yCAVEA,4DAAiH,2CAM/GA,wCAA4B,kCCMnBonC,iBAPb/+B,cAWE/H,iBAAqC,IAAI+I,SAAgB,GAKzD/I,iBAA2B,IAAI+mC,GAAY,IAK3C/mC,gBAAsC,IAAI+I,IAAgB,QAK1D/I,cAAsC,IAAI+I,IAAgB,IAK1D/I,uBAAyCA,KAAK0/B,YAAYn3B,MACxD,OAAK1I,QAAoC,IAATA,IAkB1BG,gBAAa,IAAI+I,KAAyB,GAezC/I,cAAmB,EAKnBA,WAAsB2mC,GAAaC,2BAO1C,OAAO5mC,KAAKywB,QAAUkW,GAAaK,6BAQnC,OAAOhnC,KAAKywB,QAAUkW,GAAaM,QAOrCzmB,WACExgB,KAAKknC,UAAYlnC,KAAK6/B,QAAQV,SAAS/2B,UAAWvI,GAChDG,KAAKmnC,gBAAgBtnC,IAEvBG,KAAK8+B,aAAe9+B,KAAK6/B,QAAQH,YAAYt3B,UAAWvI,GACtDG,KAAKonC,mBAAmBvnC,IAQ5BsY,cACEnY,KAAKknC,UAAUx+B,cACf1I,KAAK8+B,aAAap2B,cAClB1I,KAAKqnC,YAAYnsB,UAOnBosB,mBACEtnC,KAAKunC,WAAWp/B,MAAK,GAOvBq/B,sBACExnC,KAAKunC,WAAWp/B,MAAK,GASvBs/B,cAAc5nC,GACZ,OAAOA,EAAK+O,SAAW,GAOjBu4B,gBAAgBtnC,GACtBG,KAAK2+B,WAAW9+B,GAOVunC,mBAAmBvnC,GACpBG,KAAK0nC,QAIV1nC,KAAK2nC,UAAU,IAAM3nC,KAAKy/B,cAAc5/B,IAHtCG,KAAKy/B,cAAc5/B,GAUf4/B,cAAc5/B,GACpB,QAAa,IAATA,EACFG,KAAKqnC,YAAYvvB,MAAMkC,UAAU,CAAEwF,QAAQ,QACtC,CACL,MAAM1f,EAASE,KAAKqnC,YAAY59B,IAAI5J,EAAKqR,WAC1B,IAAXpR,GACFE,KAAKqnC,YAAYvvB,MAAM4B,OAAO5Z,EAAQ,CAAE0f,QAAQ,IAAQ,GAI5Dxf,KAAK0/B,YAAYv3B,KAAKtI,GAClBG,KAAK0nC,SACP1nC,KAAK4nC,WAAWz/B,KAAK,SAOjBw2B,WAAW9+B,GACjB,MAAMC,EAAUD,EAAQmH,OAAO,CAAC5G,EAAeC,KAC7C,MAAMC,EAAON,KAAK6/B,QAAQd,QAAQ1+B,GAClC,YAAa,IAATC,GAIJF,EAAIQ,KAAK,CACPgE,GAAItE,EAAK4Q,KACTjC,MAAO3O,EAAK2O,MACZgK,KAAM3Y,EAAK2Y,KAEX8T,QAASzsB,EAAKysB,QACdV,KAAM,CAAC/rB,EAAMN,KAAK6/B,SAClB9R,QAAS,CAACvtB,EAAakD,KACrBA,EAAS07B,aAAa5+B,EAAM0Q,OAE9Bob,QAAS,CAAC9rB,EAAakD,IACd1D,KAAK6/B,QAAQH,YAAYn3B,MAC9B,OAAK3E,IACH,IAAIC,GAAgB,OACD,IAAfD,GAA4BpD,EAAM0Q,OAAStN,EAAWsN,OACxDrN,GAAgB,GAGlB,IAAIE,GAAwB,EAC5B,YACiB,IAAfH,GACApD,EAAM0Q,OAAStN,EAAWikC,SAE1B9jC,GAAwB,GAGnB,CACL,iBAAkBF,EAClB,0BAA2BE,QAM9B3D,GACN,IACHJ,KAAKqnC,YAAYz8B,KAAK9K,GACtBE,KAAKm/B,SAASh3B,KAAKtI,GAQb8nC,UAAU9nC,GAChBG,KAAK8nC,YACL9nC,KAAK+nC,YAAc/nC,KAAKunC,WAAWn/B,UAAWtI,IACvCA,IACHD,EAAS4I,KAAKzI,MACdA,KAAK8nC,eAQHA,YACF9nC,KAAK+nC,aACP/nC,KAAK+nC,YAAYr/B,4DAhPV3H,8BAAgBugB,uhBDzB7B5hB,oDAUAA,gDATGA,6CAUAA,66BCWW,CAACsoC,OAAiBC,oBAGnBlnC,MCCAmnC,2HAZF,CACPl7B,KACAsiB,GACAqH,OASS51B,MCXAonC,iBAAap+B,iBAEtB,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,CACT01B,mDALK5+B,4DARF,CACPiM,MAGAk7B,MAISnnC,+BCfbrB,qDAEEA,4BAAoB,kBAApBA,CAAoB,gDCsBT0oC,iBAoCXrgC,cA9BQ/H,qBAAkB,CACxB27B,OAAS97B,GAAeG,KAAKqoC,SAASxoC,GACtCylB,SAAWzlB,GAAeG,KAAKsoC,WAAWzoC,IAgBnCG,iBAAqD,GAKpDA,cAAW,IAAIN,MAKfM,YAAS,IAAIN,MAQvByY,cACEnY,KAAKuoC,gBASPC,0BACE,MAAM3oC,EAAc+F,OAAOU,OAAO,GAAItG,KAAKo1B,aAG3C,cAAOvvB,KAAK7F,KAAKyoC,iBAAiB3iC,QAAShG,IACzC,MAAMM,EAAaP,EAAYC,GACzBO,EAAiBL,KAAKyoC,gBAAgB3oC,GAE1CD,EAAYC,QADK,IAAfM,EACkBE,IAClBF,EAAWE,GACXD,EAAeC,IAGED,IAIhBR,EAODwoC,SAASxoC,GACfG,KAAK27B,OAAOzjB,KAAKrY,GACjBG,KAAKuoC,gBAOCD,WAAWzoC,GACjBG,KAAKslB,SAASpN,KAAKrY,GACnBG,KAAKuoC,gBAMCA,qBACc,IAAhBvoC,KAAK0oC,QACP1oC,KAAK0oC,OAAOxtB,UAEdlb,KAAK0oC,YAAS,gDAjGL3nC,8BAAqBugB,8RDxBlC5hB,4CACGA,+HCuBUqB,MCAA4nC,2HAXF,CACP37B,KACA2pB,OASS51B,MCdA6nC,iBAEX7gC,YAAoBlI,kCAEpB6H,OAAO7H,GACL,OAAOG,KAAKw2B,wBAAwB9uB,OAAO7H,iDALlCkB,GAAarB,sCAAbqB,EAAasI,QAAbtI,EAAa,qBAFZ,SAEDA,MCSA8nC,4HAJA,CACTD,IACDrZ,SAVQ,CACPviB,KACA27B,IAGAA,MAOS5nC,MCEA+nC,iBANb/gC,cAqBY/H,oBAAiB,IAAIN,MAQ/BqpC,kBAAkBlpC,GAChB,OAAO0gB,GAAe1gB,GASxBmpC,iBAAiBnpC,GACf,MAAMC,EAAYD,EAAMiC,MACxB9B,KAAKoR,MAAM63B,kBAAkBnpC,GAC7BE,KAAKghB,eAAe9I,KAAK,CAACmI,UAAU,EAAMve,MAAOhC,kDApCxCiB,8BAA0BugB,iPCrBvC5hB,iCAKEA,0CAAkBI,wBACpBJ,cALEA,uBAAe,WAAfA,CAAe,oCAAfA,CAAe,0QDoBJqB,MEAAmoC,2HAXF,CACPl8B,KACA4sB,OASS74B,+CCrBbrB,SACEA,+BAIEA,mFAAiC,mHAEnCA,QACFA,yCANIA,2BAAiB,oCAAjBA,CAAiB,oDCsBRypC,iBAmCXphC,cAxBU/H,sBAAmB,IAAIN,oBAMQ,OAAOM,KAAKopC,UAAUC,4BAO7D,OAAOrpC,KAAKopC,UAAUE,uCAQtB,OAAOtpC,KAAKopC,UAAUG,mBAWxBC,eAAe3pC,GACbG,KAAKopC,UAAUK,mBACfzpC,KAAKypC,iBAAiBvxB,KAAKrY,GAS7B6pC,iBAAiB7pC,GACfG,KAAKopC,UAAUK,mBACfzpC,KAAKypC,iBAAiBvxB,KAAKrY,iDAxDlBkB,8BAA8BugB,iPDxB3C5hB,wDAAeA,uJCwBFqB,MCFA4oC,2HAXF,CACP38B,KACA27B,OASS5nC,MCNA6oC,2HATF,CACP58B,MAGAk8B,GACAS,MAIS5oC,eCPXgH,YAAYzG,GALZtB,gBAAqC,IAAI+I,IAAuB,IAM1DzH,GACFtB,KAAKklC,WAAW/8B,KAAK7G,cALvB,OAAOtB,KAAKklC,WAAWpjC,MASzB2T,IAAInU,GACFtB,KAAKklC,WAAW/8B,KAAK7G,GAGvB06B,IAAI16B,GACF,MAAMzB,EAAaG,KAAKupB,KAAKnmB,QAC7BvD,EAAWe,KAAKU,GAChBtB,KAAKyV,IAAI5V,GAGXsQ,OAAO7O,GACL,MAAMzB,EAAaG,KAAKupB,KAAKnmB,QACvBtD,EAAQD,EAAWK,QAAQoB,GACjCzB,EAAWmF,OAAOlF,EAAO,GACzBE,KAAKyV,IAAI5V,gBC1BiBkB,GAC5B,OAAQO,IACNq+B,GAAY32B,SAASpD,OAAOU,OAAO,GAAIvF,EAAM,CAC3Cu1B,UAAWh1B,uBCEmBo9B,GAApC32B,kCAEE/H,sBAA+C,IAAI+I,SAAgB,GAMnEkgC,kBAAkB3nC,GAChB,MAAMzB,EAASG,KAAK6pC,iBAAiB/nC,WACtB,IAAXjC,GACFA,EAAOwe,aAGTre,KAAK8pC,2BACa,IAAdxoC,IACFtB,KAAK8X,MAAM4B,OAAOpY,EAAW,CAACke,QAAQ,EAAMa,UAAU,IAAO,GAC7DrgB,KAAK6pC,iBAAiB1hC,KAAK7G,GAC3BA,EAAUyc,YAQd+rB,sBACE,MAAMxoC,EAAStB,KAAK6pC,iBAAiB/nC,WACtB,IAAXR,IACFA,EAAO+c,aACPre,KAAK6pC,iBAAiB1hC,UAAK,cC0C/BJ,YAAsBzG,kBA9DbtB,aAAU,IAAI+I,SAAwB,GAKtC/I,mBAAgB,IAAI+I,IAAsC,IAK1D/I,wBAAqB,IAAI+I,IAAuD,IAUjF/I,YAAwB,IAAIgI,KAiD3BhI,aAAoC,IAAI+I,KAAgB,YAvC9C,OAAO/I,KAAK4O,QAAQhK,eAKjB,OAAO5E,KAAK4O,QAAQK,iBAKP,OAAOjP,KAAK4O,QAAQiK,MAAQ,qBAK3B,OAAO7Y,KAAK4O,QAAQm7B,8BAKvB,OAAO/pC,KAAK4O,QAAQy4B,yBAK9B,OAAOrnC,KAAKqpC,QAAQvnC,sBAKhB,YAAuB,IAAhB9B,KAAK0oC,OAAWlpB,aAQ1B,OAAOxf,KAAKuf,QAAQzd,MAQ5Cic,YACsB,IAAhB/d,KAAKwf,QACPxf,KAAKqe,aAEPre,KAAKuf,QAAQpX,MAAK,QAEO,IAArBnI,KAAK+pC,cACP/pC,KAAKmf,WAAanf,KAAK+pC,YAAY5sB,UAAUxC,OAC1CvS,UAAU,IAAMpI,KAAKsf,kBAG1Btf,KAAK6E,OAAOsD,OAMdkW,aACEre,KAAKuf,QAAQpX,MAAK,GAClBnI,KAAKypC,wBAEmB,IAApBzpC,KAAKmf,YACPnf,KAAKmf,WAAWzW,mBAEG,IAAjB1I,KAAKoa,SACPpa,KAAKoa,QAAQ1R,cAWjBshC,eACE1oC,EACAzB,EAA+B,GAC/BC,EAAqD,IAErDE,KAAKqpC,QAAQlhC,KAAK7G,GAClBtB,KAAKspC,cAAcnhC,KAAKtI,GACxBG,KAAKupC,mBAAmBphC,KAAKrI,GAC7BE,KAAK6E,OAAOsD,OAMdshC,mBACEzpC,KAAKqpC,QAAQlhC,UAAK,GAClBnI,KAAK6E,OAAOsD,OAMNmX,gBACNtf,KAAK6E,OAAOsD,QCpJhB,MAOa8hC,GAAuBC,cAPb,CACrB,CACEp/B,KAAM,OACNwrB,UCAJ,MAAM,QACJvuB,YAAoBlI,iCAEpBm+B,YACEh+B,KAAKwgC,uBAAuBxC,UAAU,wDAJ7Bj9B,GAAgBrB,oCAAhBqB,EAAgBugB,ycCR7B5hB,iBACEA,gBACEA,4BACFA,QACAA,iBACFA,QAEAA,aACEA,kCAKFA,QAEAA,aACEA,sGAAyFA,cACzFA,kGACFA,QAEAA,eAAIA,4DAA+CA,QACnDA,eACEA,eAAIA,cAAGA,wBAAWA,QAAKA,8EAAgEA,QACvFA,eAAIA,cAAGA,uBAAUA,QAAKA,6GAA+FA,QACrHA,eAAIA,cAAGA,yBAAYA,QAAKA,6GAA+FA,QACvHA,eAAIA,cAAGA,uBAAUA,QAAKA,uEAAyDA,QAC/EA,eAAIA,cAAGA,sBAASA,QAAKA,kFAAoEA,QACzFA,eAAIA,cAAGA,0BAAaA,QAAKA,sEAAwDA,QACjFA,eAAIA,cAAGA,8BAAiBA,QAAKA,kDAAoCA,QACnEA,QAEAA,eAAIA,oDAAuCA,QAC3CA,eACEA,eACEA,eAAIA,gBAA+HA,yBAAYA,QAAIA,QACrJA,QACAA,eACEA,eAAIA,gBAAiEA,kCAAqBA,QAAIA,QAChGA,QACFA,QAEAA,6BAAeA,iBAAMA,uBAAUA,QAAQA,0EDjC1BqB,GAAb,MEYO,IAAMopC,GAAb,MAAM,sDAAOppC,4DATF,CACPkpC,GACAvJ,GACAzR,KACAxvB,KACAuvB,SAISjuB,GAAb,GChBA,MAOaqpC,GAA2BF,cAPjB,CACrB,CACEp/B,KAAM,WACNwrB,UCEJ,MAAM,QAGJvuB,YAAoBlI,0BAFZG,iBAAwB,GAIhCgJ,WACEhJ,KAAKqqC,YAAYzpC,KAAKZ,KAAK6J,gBAAgBb,YAG7CI,aACEpJ,KAAK6J,gBAAgBT,WAAWpJ,KAAKqqC,YAAYtf,qBAIjD,OAAO/qB,KAAK6J,gBAAgBV,SAASrH,oDAd5Bf,GAAoBrB,mCAApBqB,EAAoBugB,gPCTjC5hB,oBACEA,6BAAmBA,gBAAIA,QACvBA,0BAAgBA,oBAAQA,QACxBA,4BACEA,aAAGA,yEAA6DA,QAEhEA,cAAIA,mBAAOA,iBAAMA,8BAAiBA,QAAQA,kDAAoCA,QAC9EA,eAAIA,oBAAOA,iBAAMA,8BAAiBA,QAAQA,uBAASA,QAEnDA,eACAA,sBAAQA,gBAAgGA,kCAAoBA,QAC5HA,eACFA,QAEAA,6BACEA,qBAA0BA,gCAASI,eAAYJ,qBAAQA,QACvDA,qBAA0BA,gCAASI,iBAAcJ,uBAAUA,QAC7DA,QACAA,cAAGA,UAAoBA,QAEvBA,0BAEFA,eAJKA,2GDTQqB,GAAb,MEYO,IAAMupC,GAAb,MAAM,sDAAOvpC,4DATF,CACPqpC,GACAhb,KACAJ,KACAllB,YACA66B,OAIS5jC,GAAb,GChBO,MAAMwpC,GAA2B,CACtCC,YAAY,EACZC,IAAK,CACHC,YAAa,CACX,CACEC,KAAM,aACNC,MAAO,iBACPC,IACE,iHACFC,OAAQ,EAAC,YAAc,YAAa,YAAa,gBAGrDC,KAAM,CACJC,OAAQ,CACN5M,SAAS,GAEX6M,gBAAgB,GAElBC,gBAAiB,CACfC,cAAc,GAEhBC,aAAc,CACZv6B,IAAK,2CAEPzC,SAAU,CACRnC,OAAQ,aAEVo/B,QAAS,CACPC,QAAS,CACP,CACE1mC,GAAI,YACJqK,MAAO,aACP4B,IAAK,6DAEP,CACEjM,GAAI,qBACJqK,MAAO,uBACP4B,IAAK,kDACL06B,YAAa,CACXj7B,KAAM,IACN,mBAAoB,CAClB,0BACA,kCAGJk7B,gBAAiB,SACjB1kC,MAAO,IAET,CACElC,GAAI,mBACJqK,MAAO,4BACP4B,IAAK,kDACL46B,WAAY,CAAC,UAEf,CACE7mC,GAAI,4BACJqK,MAAO,4BACP4B,IAAK,4DACL66B,YAAa,cAInBC,cAAe,CACbC,UAAW,CACTxN,SAAS,GAEXyN,SAAU,CACRC,UAAW,8CACXC,MAAO,EACP3N,SAAS,EACT4N,OAAQ,CACNC,MAAO,MAGXC,mBAAoB,CAClBC,sBAAsB,GAExBC,gBAAiB,CACfD,sBAAsB,EACtBL,UAAW,6CACXC,MAAO,EACP3N,SAAS,GAEXiO,OAAQ,CACNP,UAAW,mDACXC,MAAO,EACP3N,SAAS,EACT4N,OAAQ,CACNC,MAAO,SCjFJK,GAAyBpC,cAPf,CACrB,CACEp/B,KAAM,SACNwrB,UCAJ,MAAM,QAGJvuB,YAAoBlI,wBAClBG,KAAKusC,eAAiBvsC,KAAK6O,cAAcnE,UAAU,0DAJ1C3J,GAAkBrB,mCAAlBqB,EAAkBugB,0QCR/B5hB,oBACEA,6BAAmBA,gBAAIA,QACvBA,0BAAgBA,kBAAMA,QACtBA,4BACEA,aAAGA,mDAAuCA,QAE1CA,cAAIA,mBAAOA,iBAAMA,4BAAeA,QAAQA,uBAASA,QAEjDA,eACAA,sBAAQA,gBAA8FA,kCAAoBA,QAAKA,eAC/HA,sBAAQA,gBAA2FA,gCAAkBA,QACrHA,eACFA,QAEAA,cAAGA,2BAAHA,QAA8CA,cAEhDA,eAFKA,mIDNQqB,GAAb,MEmBO,IAAMyrC,GAAb,MAAM,sDAAOzrC,6DANA,CACT2K,GAAqB,CACnBb,QAAS0/B,UAEZhb,SAZQ,CACP+c,GACAt/B,KACAoiB,KACAJ,KACAvjB,iBASS1K,GAAb,GCtBA,MAOa0rC,GAA2BvC,cAPjB,CACrB,CACEp/B,KAAM,WACNwrB,UCAJ,MAAM,QAIJvuB,YAAoBlI,0BAHbG,SAAM,CACXiP,MAAO,OAITy9B,eAAe7sC,GACbG,KAAK+P,gBAAgBzB,YAAYzO,GACjCqL,QAAQC,IAAInL,KAAK+P,+DARRhP,GAAoBrB,oCAApBqB,EAAoBugB,sYCRjC5hB,oBACEA,6BAAmBA,gBAAIA,QACvBA,0BAAgBA,oBAAQA,QACxBA,4BACEA,aAAGA,8CAAkCA,QAErCA,cAAIA,mBAAOA,iBAAMA,8BAAiBA,QAAQA,uBAASA,QAEnDA,eACAA,sBAAQA,gBAA+FA,iCAAoBA,QAAIA,eAC/HA,0CAA4BA,gBAA2FA,gCAAkBA,QAAIA,eAC7IA,kBAAIA,gBAAoFA,yBAAYA,QACpGA,eACFA,QAEAA,6BACEA,qBAA0BA,gCAASI,iBAAe,QAAOJ,oBAAOA,QAChEA,qBAA0BA,gCAASI,iBAAe,QAAOJ,wBAAQA,QACnEA,QAEAA,cAAGA,gCAAHA,QAAiCA,cAEnCA,eAFKA,qHDZQqB,GAAb,MEWO,IAAM4rC,GAAb,MAAM,sDAAO5rC,4DARF,CACP0rC,GACArd,KACAJ,KACAriB,iBAIS5L,GAAb,GCdA,MAOa6rC,GAAwB1C,cAPd,CACrB,CACEp/B,KAAM,QACNwrB,UCCJ,MAAM,QACJvuB,YAAoBlI,mCAGlB,OAAOG,KAAKikB,aAAatP,6BAIzB,OAAO3U,KAAKikB,aAAarP,qCAIzB,OAAO5U,KAAKikB,aAAapP,8DAZhB9T,GAAiBrB,oCAAjBqB,EAAiBugB,6KCT9B5hB,oBACEA,6BAAmBA,gBAAIA,QACvBA,0BAAgBA,iBAAKA,QACrBA,4BACEA,aAAGA,0DAA8CA,QAEjDA,cACAA,qBAAQA,gBAA4FA,iCAAoBA,QACxHA,eACFA,QAEAA,cAAGA,UAAwBA,QAC3BA,cAAGA,UAAoCA,QACvCA,cAAGA,UAAwEA,QAC7EA,eAHKA,8CACAA,yDACAA,yIDJQqB,GAAb,MEEO,IAAM8rC,GAAb,MAAM,sDAAO9rC,4DAHF,CAAC6rC,GAAuBxd,SAGtBruB,GAAb,GCNA,MAOa+rC,GAA0B5C,cAPhB,CACrB,CACEp/B,KAAM,UACNwrB,UCCJ,MAAM,QACJvuB,YAAoBlI,yBAEpB2P,UACExP,KAAK+Q,eAAevB,QAAQ,kBAAmB,WAGjDE,OACE1P,KAAK+Q,eAAerB,KAAK,iBAAkB,QAG7CG,QACE7P,KAAK+Q,eAAelB,MAAM,UAAW,SAEvCxE,QACErL,KAAK+Q,eAAe1F,MAAM,iBAAkB,uDAfnCtK,GAAmBrB,oCAAnBqB,EAAmBugB,+WCThC5hB,oBACEA,6BAAmBA,gBAAIA,QACvBA,0BAAgBA,mBAAOA,QACvBA,4BACEA,aAAGA,iCAAqBA,QAExBA,cAAIA,mBAAOA,iBAAMA,6BAAgBA,QAAQA,uBAASA,QAClDA,eAAIA,mDAAsCA,QAE1CA,eACAA,sBAAQA,gBAA8FA,iCAAoBA,QAC1HA,eACFA,QAEAA,6BACEA,qBAA0BA,gCAASI,cAAWJ,4BAAeA,QAC7DA,qBAA0CA,gCAASI,WAAQJ,yBAAYA,QACvEA,qBAAyCA,gCAASI,YAASJ,0BAAaA,QACxEA,qBAAuCA,gCAASI,YAASJ,0BAAaA,QACxEA,QACFA,mEDXaqB,GAAb,MEUO,IAAMgsC,GAAb,MAAM,sDAAOhsC,4DARF,CACP+rC,GACA1d,KACAJ,KACAjiB,iBAIShM,GAAb,GCdA,MAOaisC,GAA0B9C,cAPhB,CACrB,CACEp/B,KAAM,UACNwrB,UCEJ,MAAM,QACJvuB,YACUlI,EACDC,GADCE,YACDA,uBAGTitC,WAEEjtC,KAAKkM,KAAKzC,IADE,oDACOrB,UAAUtI,IAC3BoL,QAAQC,IAAIrL,KAIhBotC,gBAEEltC,KAAKkM,KAAKzC,IADE,OACOrB,UAAUtI,IAC3BoL,QAAQC,IAAIrL,mDAhBLiB,GAAmBrB,gDAAnBqB,EAAmBugB,oNCVhC5hB,oBACEA,6BAAmBA,gBAAIA,QACvBA,0BAAgBA,mBAAOA,QACvBA,4BACEA,aAAGA,0CAA8BA,QAEjCA,cAAIA,mBAAOA,iBAAMA,6BAAgBA,QAAQA,6DAA+CA,QACxFA,eAAIA,oBAAOA,iBAAMA,2BAAcA,QAAQA,wEAA0DA,QACjGA,eAAIA,qCAAwBA,QAE5BA,eACAA,sBAAQA,gBAA8FA,iCAAoBA,QAC1HA,eACFA,QAEAA,6BACEA,qBAA0BA,gCAASI,eAAYJ,gBAAGA,QAClDA,qBAA0BA,gCAASI,oBAAiBJ,kBAAKA,QAC3DA,QAEFA,mEDVaqB,GAAb,MEaO,IAAMosC,GAAb,MAAM,sDAAOpsC,4DAXF,CACPisC,GACA5d,KACAJ,KACA7kB,KACAwC,aACAqE,iBAKSjQ,GAAb,4BCIErB,gDACEA,uBAAe,cAAfA,CAAe,gBAAfA,CAAe,mBCvBnB,MAOa0tC,GAAyBlD,cAPf,CACrB,CACEp/B,KAAM,SACNwrB,UCUJ,MAAM,QAcJvuB,YACSlI,EACCC,EACAM,GAFDJ,eACCA,oBACAA,uBAhBHA,WAAQ,IAAI+mC,GAAY,IAEvB/mC,YAAS,IAAI+I,KAAgB,uBAKnC,OAFc/I,KAAKikB,aAAa3P,OAAOxS,QAEzBgS,YADM9T,KAAKikB,aAAa1P,aAAazS,QACJkS,aACtC+X,QAEFA,WASTvL,WACExgB,KAAKoR,MAAMxG,KAAK,CACd,CACEhG,GAAI,MACJqK,MAAO,MACPgK,KAAM,OACN8T,QAAS,cACTgB,QAAS,KACPle,MAAM,QACN7P,KAAKqtC,OAAOllC,MAAK,KAGrB,CACEvD,GAAI,OACJqK,MAAO,OACPgK,KAAM,SACN8T,QAAS,eACTV,KAAM,CAAC,KACP0B,QAAUluB,IACRgQ,MAAM,aAAahQ,OAErBqtB,aAAc,IAAMltB,KAAKqtC,QAE3B,CACEzoC,GAAI,SACJqK,MAAO,SACP8d,QAAS,iBACT9T,KAAM,SACN8U,QAAS,KACPle,MAAM,WACN7P,KAAKqtC,OAAOllC,MAAK,IAEnB+kB,aAAc,IAAMltB,KAAKqtC,UAK/Bl1B,cACEnY,KAAKoR,MAAM8J,wDA1DFna,GAAkBrB,2DAAlBqB,EAAkBugB,gUFlB/B5hB,oBACEA,6BAAmBA,kBAAMA,QACzBA,0BAAgBA,kBAAMA,QACtBA,4BACEA,qBAAQA,eAA+FA,gCAAoBA,QAC7HA,QAEAA,2BAQFA,QACAA,cAEAA,uBACEA,8BAAmBA,mBAAMA,QACzBA,2BAAgBA,gCAAmBA,QACnCA,gBACFA,QAIAA,oEAlBIA,gCAAe,cAAfA,CAAe,wCAAfA,CAAe,gBAAfA,CAAe,wBAUTA,4SEAGqB,GAAb,MCEO,IAAMusC,GAAb,MAAM,sDAAOvsC,4DATF,CACPqsC,GACApe,KACAI,KACAE,GACA+E,OAIStzB,GAAb,GCXawsC,GAAb,MAAM,QAIJxlC,YAAoBlI,gBAEpB81B,iBACE31B,KAAKkf,MAAMD,8DAPFle,GAAsBrB,uCAAtBqB,EAAsBugB,0GAHtB5hB,aAAGA,SAA2BA,eAA3BA,sFAGHqB,GAAb,GAiBaysC,GAAb,MAAM,QAEJzlC,YAAoBlI,gBAEpB81B,iBACE31B,KAAKkf,MAAMD,8DALFle,GAAuBrB,uCAAvBqB,EAAuBugB,sFAHvB5hB,aAAGA,wEAA4DA,8CAG/DqB,GAAb,GCrBA,MAOa0sC,GAAmCvD,cAPzB,CACrB,CACEp/B,KAAM,oBACNwrB,UDiCJ,MAAM,QALNvuB,cAOE/H,eAAiButC,GAEjBvtC,YAAS,CAACkR,KAAM,OAEhBw8B,kBACE1tC,KAAKs2B,UAAYt2B,KAAKs2B,YAAciX,GAClCC,GACAD,iDATOxsC,8BAA4BugB,mREzCzC5hB,oBACEA,6BAAmBA,kBAAMA,QACzBA,0BAAgBA,6BAAiBA,QACjCA,4BACEA,qBAAQA,eAA0GA,gCAAoBA,QACxIA,QAEAA,gCAKAA,qBAAwCA,gCAASI,sBAAmBJ,6BAAgBA,QACtFA,eALIA,wCAAuB,8RFiCdqB,GAAb,MGVO,IAAM4sC,GAAb,MAAM,sDAAO5sC,4DAZF,CACP0sC,GACAze,KACAI,KACAuH,OAQS51B,GAAb,GC1BA,MAOa6sC,GAA8B1D,cAPpB,CACrB,CACEp/B,KAAM,eACNwrB,UCUJ,MAAM,QA8DJvuB,YAAoBlI,0BA7DbG,WAAQ,IAAI0+B,GAAY,IAE/B1+B,uBAA8C,IAAI+I,KAAgB,GAE3D/I,sBAAgD,CAAC+jB,SAAU,IAE3D/jB,cAAW,CAChB2hB,WAAW,EACXkF,mBAAmB,EACnBC,YAAY,EACZ7L,MAAM,EACN0B,cAAe,CAAC7c,EAAgBM,IACvB0Y,GAAkBhZ,EAAQM,GAEnCumB,QAAS,CACP,CACEzV,KAAM,WACNjC,MAAO,WACP0N,cAAgB7c,GACPE,KAAKoR,MAAM0G,MAAMrO,IAAI3J,GAAQugB,SAChC,kBACA,iBAENsC,SAAUrK,SAEZ,CACEpH,KAAM,KACNjC,MAAO,MAET,CACEiC,KAAM,OACNjC,MAAO,QAET,CACEiC,KAAM,cACNjC,MAAO,cACP0T,SAAUrK,SAEZ,CACEpH,KAAM,MACNjC,MAAO,aAET,CACEiC,KAAM,QACNjC,MAAO,SAET,CACEiC,KAAM,SACNjC,MAAO,GACP0N,cAAgB7c,GACP,CAAC,CACNmZ,KAAM,OACNwX,MAAO,OACPkB,MAAQvxB,IAAU8K,QAAQC,IAAI/K,MAGlCuiB,SAAUrK,kBAOhBkI,WAGE,MAAM1gB,EAAW,CAFJ,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,IAE/B4F,IAAItF,KACdwE,KAAKsM,KAAM,QAAQ9Q,IAAMytC,YAAa,kBAAkBztC,QAAUyQ,IAAK,wBAAyBi9B,MAAO,2DAElH9tC,KAAKoR,MAAMxG,KAAK9K,GAGlB+pB,mBACE7pB,KAAKujB,kBAAkBpb,MAAK,GAG9Byc,gBAAgB/kB,GACdG,KAAKwjB,UAAY3jB,EAGnBsY,cACEnY,KAAKoR,MAAM8J,wDAlFFna,GAAuBrB,oCAAvBqB,EAAuBugB,0QClBpC5hB,oBACEA,6BAAmBA,kBAAMA,QACzBA,0BAAgBA,wBAAYA,QAC5BA,4BACEA,qBAAQA,eAAqGA,gCAAoBA,QACnIA,QACAA,8BAKEA,2CAAoBI,uBACtBJ,QACFA,eANIA,gCAAe,mBAAfA,CAAe,sCAAfA,CAAe,6RDWNqB,GAAb,MEAO,IAAMgtC,GAAb,MAAM,sDAAOhtC,4DARF,CACP6sC,GACAxe,KACA4K,GACAF,OAIS/4B,GAAb,6BCHErB,eACEA,aAAGA,SAAmBA,QACtBA,aAAGA,SAAuBA,QAC1BA,aAAGA,yBAAaA,kBAAgDA,QAClEA,6BAHKA,+BACAA,mCACmBA,iDCb1B,MAOasuC,GAAiC9D,cAPvB,CACrB,CACEp/B,KAAM,kBACNwrB,UCUJ,MAAM,QAMJvuB,YAAoBlI,0BAJbG,WAAQ,IAAI0+B,GAAY,IAExB1+B,eAAY,IAAI+I,SAA4B,GAInDyX,WACExgB,KAAKoR,MAAMxG,KAAK,CACd,CAAChG,GAAI,IAAKsM,KAAM,SAAU28B,YAAa,wBACvC,CAACjpC,GAAI,IAAKsM,KAAM,SAAU28B,YAAa,wBACvC,CAACjpC,GAAI,IAAKsM,KAAM,SAAU28B,YAAa,0BAI3C11B,cACEnY,KAAKoR,MAAM8J,UAGb+yB,SAASpuC,GACP,OAAOA,EAAOqR,KAGhB83B,iBAAiBnpC,GACfG,KAAKihB,UAAU9Y,KAAKtI,EAAM2e,sDAzBjBzd,GAA0BrB,oCAA1BqB,EAA0BugB,qSFlBvC5hB,oBACEA,6BAAmBA,kBAAMA,QACzBA,0BAAgBA,2BAAeA,QAC/BA,4BACEA,qBAAQA,eAAwGA,gCAAoBA,QACtIA,QAEAA,iCAKEA,0CAAkBI,wBACpBJ,QAEAA,2CAKFA,eAZIA,gCAAe,2BAAfA,CAAe,eAAfA,CAAe,kCAOXA,uUEGKqB,GAAb,MCCO,IAAMmtC,GAAb,MAAM,sDAAOntC,4DARF,CACPiM,KACAghC,GACA5e,KACAwK,OAIS74B,GAAb,4CCZErB,sBAIEA,sFAEAA,4BAEAA,iBACEA,oBAIEA,8DACAA,uBACFA,QACAA,oBAIEA,+DACAA,wBACFA,QACAA,oBAKEA,oBACFA,QACFA,QACFA,yCA7BEA,gBAAa,+BAIGA,oCAqBZA,6CC7BR,MAOayuC,GAAuBjE,cAPb,CACrB,CACEp/B,KAAM,OACNwrB,UCIJ,MAAM,QAUJvuB,YACUlI,EACAC,GADAE,mBACAA,uBAVVA,WAAQ,IAAI+I,SAAsB,GAElC/I,WAAQ,IAAI+I,SAAsC,GAElD/I,qBAAiB,EASjBwgB,WAkCE,MAAM1gB,EAAS,CAhCb,CACEoR,KAAM,KACNjC,MAAO,KACPL,QAAU,CACR2qB,KAAM,EACNzB,UAAWzR,iBAGf,CACEnV,KAAM,OACNjC,MAAO,OACPL,QAAU,CACR2qB,KAAM,EACNzB,UAAWzR,iBAGf,CACEnV,KAAM,SACNjC,MAAO,SACPnK,KAAM,SACN8J,QAAU,CACR2qB,KAAM,GAERrE,OAAQ,CACNkZ,QAAS,CACP,CAACtsC,MAAO,EAAGmN,MAAO,UAClB,CAACnN,MAAO,EAAGmN,MAAO,eAMEvJ,IAAKrF,GAAWL,KAAKquC,YAAYpW,MAAM53B,IAC7DD,EAAOJ,KAAKquC,YAAY9W,KAAK,GAAI,CAACv3B,KAAKquC,YAAYzW,MAAM,CAAC1mB,KAAM,QAASpR,KAE/EE,KAAKsuC,eAAiBluC,EAAKioB,QAAQI,aAAargB,UAAU,KACxDpI,KAAKuuC,gBAAkBnuC,EAAKioB,QAAQmmB,QAGtCxuC,KAAKyuC,MAAMtmC,KAAK/H,GAGlB+X,cACEnY,KAAKsuC,eAAe5lC,cAGtBgmC,WACE1uC,KAAK2uC,MAAMxmC,KAAK,CACdvD,GAAI,EACJsM,KAAM,MACNtI,OAAQ,IAIZgmC,YACE5uC,KAAKyuC,MAAM3sC,MAAMumB,QAAQoP,QAG3BP,SAASr3B,GACPgQ,MAAM5K,KAAKE,UAAUtF,kDA5EZkB,GAAgBrB,8CAAhBqB,EAAgBugB,uaFZ7B5hB,oBACEA,6BAAmBA,kBAAMA,QACzBA,0BAAgBA,gBAAIA,QACpBA,4BACEA,qBAAQA,eAA6FA,gCAAoBA,QAC3HA,QAEAA,gDAgCFA,eA/BKA,2UEIQqB,GAAb,MCSO,IAAM8tC,GAAb,MAAM,sDAAO9tC,4DATF,CACPiM,KACAmhC,GACAnf,KACAI,KACAuK,OAIS54B,GAAb,GChBA,MAOa+tC,GAAwB5E,cAPd,CACrB,CACEp/B,KAAM,QACNwrB,UCEJ,MAAM,QAkCJvuB,YAAoBlI,0BA/BbG,WAAQ,CACb2mB,QAAS,CACP,CACEzV,KAAM,KACNjC,MAAO,KACP8/B,UAAU,EACVtJ,YAAY,GAEd,CACEv0B,KAAM,OACNjC,MAAO,OACP8/B,UAAU,EACVtJ,YAAY,GAEd,CACEv0B,KAAM,cACNjC,MAAO,cACP8/B,UAAU,EACVtJ,YAAY,IAGhBU,QAAS,CACP,CACEltB,KAAM,gBACNwX,MAAOiV,WACP/T,MAAO7xB,GAAOE,KAAKgvC,SAASlvC,EAAIoR,QAGpC2V,mBAAmB,GAKrBrG,WACExgB,KAAK8lC,SAAW,IAAImJ,GAAc,CAChC,CAAErqC,GAAI,IAAKsM,KAAM,SAAU28B,YAAa,WACxC,CAAEjpC,GAAI,IAAKsM,KAAM,SAAU28B,YAAa,aACxC,CAAEjpC,GAAI,IAAKsM,KAAM,SAAU28B,YAAa,YAI5CmB,SAASnvC,GACPgQ,MAAMhQ,GAGRqvC,aAAarvC,GACXqL,QAAQC,IAAItL,iDAjDHkB,GAAiBrB,oCAAjBqB,EAAiBugB,gOCV9B5hB,oBACEA,6BAAmBA,kBAAMA,QACzBA,0BAAgBA,iBAAKA,QACrBA,4BACEA,qBAAQA,eAA8FA,gCAAoBA,QAC5HA,QAEAA,uBAIEA,kCAAUI,oBACZJ,QACFA,eALIA,sCAAqB,gBAArBA,CAAqB,2RDEZqB,GAAb,MEOO,IAAMouC,GAAb,MAAM,sDAAOpuC,4DAPF,CACP+tC,GACA1f,KACAqX,OAIS1lC,GAAb,4CCTIrB,oBAGEA,iDAASmgC,iCAETngC,sBACFA,kDAEAA,oBAGEA,iDAASmgC,2BAETngC,sBACFA,aCWS0vC,GAA0B,MAIrCrnC,YAAoBzG,gBAEpBq0B,iBACE31B,KAAKkf,MAAMD,yDAPFmwB,IAA0B1vC,wCAA1B0vC,GAA0B9tB,qGAJnC5hB,aAAGA,SAA2BA,eAA3BA,sFAIM0vC,IAA0B,UAbtCC,GAAc,CACbn+B,KAAM,kBACNjC,MAAO,aACPgK,KAAM,UACNrK,QAAS,CAACsC,KAAM,WASqB,8BAIVxR,SAJhB0vC,QAwBAE,GAAqB,+CAArBA,iCAAqBhuB,2EAJ9B5hB,aAAGA,wCAA4BA,8CAItB4vC,IAAqB,UAZjCD,GAAc,CACbn+B,KAAM,aACNjC,MAAO,QACPgK,KAAM,iBASKq2B,ICpDb,MAOaC,GAAuBrF,cAPb,CACrB,CACEp/B,KAAM,OACNwrB,UDwDJ,MAAM,QAYJvuB,YACUlI,EACAC,GADAE,mBACAA,uBAZVA,aAAU,IAAI4/B,qBAGZ,OAAO5/B,KAAK6/B,QAAQH,6BAIpB,OAAO1/B,KAAK0/B,YAAY59B,MAAQ9B,KAAK0/B,YAAY59B,MAAMmN,MAAQ,UAQjEuR,WACExgB,KAAK6/B,QAAQlB,WAAW,CAAC,kBAAmB,eAC5C3+B,KAAK6/B,QAAQZ,SAASj/B,KAAKkgC,YAAYlB,YAGzC7mB,cACEnY,KAAK6/B,QAAQ3kB,UAGfs0B,yBACExvC,KAAK6/B,QAAQT,aAAa,kBAAmB,CAACluB,KAAM,sDA3B3CnQ,GAAgBrB,8CAAhBqB,EAAgBugB,4iBDhE7B5hB,oBACEA,6BAAmBA,kBAAMA,QACzBA,0BAAgBA,gBAAIA,QACpBA,4BACEA,qBAAQA,eAA6FA,gCAAoBA,QAC3HA,QAEAA,uBACEA,8CAQAA,8CAQAA,0BACFA,QAEAA,qBAIEA,gCAASI,6BACTJ,uCACFA,QAEFA,eA5BaA,qCAKNA,iDAQAA,iDAIUA,oCAAmB,mTCwCvBqB,GAAb,ME1BO,IAAM0uC,GAAb,MAAM,sDAAO1uC,4DAhBF,CACPiM,KACAuiC,GACAvgB,KACAvvB,KACA2vB,KACAziB,GACAy3B,GACA+D,iBAQSpnC,GAAb,GClBa2uC,GAAb,MAAM,QAQJ3nC,YAAoBlI,gBAJVG,cAAW,IAAIN,MAEfM,YAAS,IAAIN,MAIvBi2B,iBACE31B,KAAKkf,MAAMD,8DAXFle,GAA4BrB,uCAA5BqB,EAA4BugB,+LANrC5hB,aAAGA,SAA2BA,QAC9BA,oBAAwBA,gCAASI,0BAAqBJ,4BAAgBA,QACtEA,oBAAwBA,gCAASI,wBAAmBJ,mBAAOA,eAFxDA,wGAMMqB,GAAb,GCfA,MAOa4uC,GAAyBzF,cAPf,CACrB,CACEp/B,KAAM,SACNwrB,UDiCJ,MAAM,QAMJvuB,YAAoBlI,wBAJpBG,YAA4CA,KAAK4vC,cAAcloC,OAAOgoC,IAEtE1vC,YAAS,CAACkR,KAAM,OAIhBw4B,iBAAiB7pC,GACfgQ,MAAM,GAAGhQ,gEAGX2pC,iBACE35B,MAAM,iHAbG9O,GAAkBrB,oCAAlBqB,EAAkBugB,2NEzC/B5hB,oBACEA,6BAAmBA,kBAAMA,QACzBA,0BAAgBA,kBAAMA,QACtBA,4BACEA,qBAAQA,eAA+FA,gCAAoBA,QAC7HA,QAEAA,+BAGEA,oCAAYI,uBAAZJ,CAAqC,2BAC3BI,qBACZJ,QAEFA,eANIA,kCAAiB,yRFiCRqB,GAAb,MGbO,IAAM8uC,GAAb,MAAM,sDAAO9uC,4DAXF,CACP4uC,GACA3gB,KACAI,KACAyZ,OAOS9nC,GAAb,6ICnBa+uC,iBAGX/nC,YAAoBlI,mBAEpB4V,IAAI5V,GACF2V,aAAaE,QAAQ1V,KAAK+vC,SAAUlwC,GAGtCsQ,SACEqF,aAAaQ,WAAWhW,KAAK+vC,UAG/BtmC,MACE,OAAO+L,aAAaF,QAAQtV,KAAK+vC,UAGnCC,SACE,MAAMnwC,EAAQG,KAAKyJ,MACnB,GAAK5J,EAGL,OAAOowC,KAAUpwC,GAGnBqwC,YACE,MAAMrwC,EAAMG,KAAKgwC,SACXlwC,OAAkBuG,MAAO8pC,UAAY,IAC3C,QAAItwC,GAAOC,EAAcD,EAAIuwC,oBAO7B,MAAMvwC,EAASG,KAAK+K,SAAStB,IAAmBgB,GAChD,YAAKmE,QAAU/O,EAAO6K,UAAU,SAAW,GACpC1K,KAAK4O,QAAQmhC,uDArCXhvC,GAAYrB,yCAAZqB,EAAYsI,QAAZtI,EAAY,qBAFX,SAEDA,MCQAsvC,iBAUXtoC,YACUlI,EACAC,EACAM,EACAC,EACAC,EACYE,GALZR,YACAA,oBACAA,cACAA,uBACAA,sBACYA,cAffA,mBAAgB,IAAI+I,SAAyB,GAC7C/I,aAAU,IAAI+I,SAAyB,GAEtC/I,gBAAY,EAclBA,KAAKswC,cAAcnoC,KAAKnI,KAAKuwC,eAC7BvwC,KAAKswC,cAAcloC,UAAW1E,IAC5B1D,KAAKwwC,QAAQroC,KAAKzE,GAClB+hB,mCAdF,YAA6C,IAAtCzlB,KAAK2K,OAAOD,UAAU,YAkB/B+lC,MAAM5wC,EAAkBC,GACtB,MAAMM,EAAW,IAAI+J,KAAY,CAAE,eAAgB,qBAE7C9J,EAAO,CACXqwC,WACAC,SAAU3wC,KAAK4wC,eAAe9wC,IAGhC,OAAOE,KAAK6wC,UAAUxwC,EAAMD,GAG9B0wC,eAAejxC,EAAeC,EAAcM,GAC1C,MAAMC,EAAW,IAAI8J,KAAY,CAAE,eAAgB,qBAQnD,OAAOnK,KAAK6wC,UANC,CACXE,QACAC,eAAgBlxC,EAChBmxC,aAG0B5wC,GAG9B6wC,iBACE,YAAKC,WAAY,EACjBnxC,KAAKwwC,QAAQroC,MAAK,MACX6D,OAAG,GAGZyd,UACE,MAAM5pB,EAAMG,KAAK2K,OAAOD,UAAU,YAClC,OAAO1K,KAAKkM,KAAKklC,KAAK,GAAGvxC,YAAe,IAAI0I,MAC1C,QAAKzI,IACHE,KAAKqxC,aAAa57B,IAAI3V,EAAKixC,UAE7B,OAAYjxC,IACV,QAAIuL,MAAM0D,QAAS,EACbjP,KAKZwxC,SACE,YAAKH,WAAY,EACjBnxC,KAAKqxC,aAAalhC,SAClBnQ,KAAKswC,cAAcnoC,MAAK,MACjB6D,OAAG,GAGZulC,kBACE,OAAQvxC,KAAKqxC,aAAanB,YAG5BsB,WACE,OAAOxxC,KAAKqxC,aAAa5nC,MAG3BgoC,cACE,QAAIzxC,KAAKuxC,mBACAvxC,KAAKqxC,aAAarB,SAK7B0B,kBACE,IAAK1xC,KAAK0T,OACR,OAEF,MAAM7T,EAAcG,KAAK2xC,aAAe3xC,KAAK0T,OAAO7C,IAE9C/Q,EAAUE,KAAK2K,OAAOD,UAAU,SAAW,GAC7C7K,IAAgBC,EAAQ8xC,WAE1B5xC,KAAK0T,OAAOm+B,cADM/xC,EAAQgyC,WAAa,KAE9BjyC,GACTG,KAAK0T,OAAOm+B,cAAchyC,GAI9BkyC,cACE,MAAMlyC,EAAMG,KAAK2K,OAAOD,UAAU,YAAc,QAChD,OAAO1K,KAAKkM,KAAKzC,IAAU5J,GAG7BmyC,aACE,MAAMnyC,EAAMG,KAAK2K,OAAOD,UAAU,YAClC,OAAO1K,KAAKkM,KAAKzC,IAA2B,GAAG5J,aAGjDoyC,WAAWpyC,GACT,MAAMC,EAAME,KAAK2K,OAAOD,UAAU,YAClC,OAAO1K,KAAKkM,KAAKgmC,MAAYpyC,EAAKD,GAG5B+wC,eAAe/wC,GACrB,OAAOF,SAAcE,gBAKrB,OAAOG,KAAKuwC,eAAiBvwC,KAAKmyC,8BAIlC,OAAOnyC,KAAKmxC,8BAIZ,OAAOnxC,KAAKuxC,gCAIZ,MAAM1xC,EAAQG,KAAKyxC,cACnB,SAAI5xC,GAASA,EAAMuyC,MAAQvyC,EAAMuyC,KAAKC,SAMhCxB,UAAUhxC,EAAMC,GACtB,MAAMM,EAAMJ,KAAK2K,OAAOD,UAAU,YAClC,OAAO1K,KAAKkM,KAAKklC,KAAK,GAAGhxC,UAAaP,EAAM,CAAE2J,YAAWjB,MACvD,QAAKlI,IACHL,KAAKqxC,aAAa57B,IAAIpV,EAAK0wC,OAC3B,MAAMzwC,EAAeN,KAAKyxC,cACtBnxC,GAAgBA,EAAa8xC,OAC3B9xC,EAAa8xC,KAAKE,QACpBtyC,KAAK+P,gBAAgBzB,YAAYhO,EAAa8xC,KAAKE,QAEjDhyC,EAAa8xC,KAAKlC,WACpBlwC,KAAK+P,gBAAgB/B,UAClBvE,IAAI,mCACJrB,UAAW5H,GACVR,KAAK+Q,eAAelB,MAAMrP,KAIlCR,KAAKswC,cAAcnoC,MAAK,MAE1B,OAAY9H,IACV,QAAIgL,MAAM0D,QAAS,EACb1O,mDAtKDU,GAAWrB,6FAAXqB,EAAWsI,QAAXtI,EAAW,qBAFV,SAEDA,MCCAwxC,iBAKXxqC,YACUlI,EACAC,EACAM,EACAC,GAHAL,mBACAA,cACAA,uBACAA,cANAA,WAA+B,IAAIN,MAQ3CM,KAAK4O,QAAU5O,KAAK2K,OAAOD,UAAU,gBAAkB,GAEvD1K,KAAS4O,QAAQ4jC,QAAUxyC,KAAK4O,QAAQ6jC,UACtCzyC,KAAK0yC,gBACL1yC,KAAK2yC,gBAELznC,QAAQ0nC,KAAK,iEAIVC,oBACJ3xC,OAAe4xC,KAAKC,MAAMC,kBAAkBC,SAGxCC,qBACJhyC,OAAe4xC,KAAKC,MAAMC,kBAAkBG,UAGvCC,mBACLlyC,OAAe4xC,KAAKloC,KAAK,eAAgB,IAAM5K,KAAKqzC,cAG/CA,aACLnyC,OAAe4xC,KAAKQ,OAClBxQ,KAAK,CACJ0P,OAAQxyC,KAAK4O,QAAQ4jC,OACrBC,SAAUzyC,KAAK4O,QAAQ6jC,SACvBc,cAAe,CACb,4DAEF39B,MAAO,YAER49B,KAAK,KACJxzC,KAAKkzC,qBACLlzC,KAAKyzC,mBACJvyC,OAAe4xC,KAAKC,MAAMC,kBAAkBU,WAAWC,OAAO9zC,IAC7DG,KAAK4zC,mBAAmB/zC,OAKxB+zC,mBAAmB/zC,GACzBG,KAAKyzC,mBACD5zC,GACFG,KAAK6zC,YAAa3yC,OAAe4xC,KAAKQ,OAAO9B,WAAWsC,cAIpDL,mBACN,MAAM5zC,EAAM+B,SAASuuB,cAAc,2BAC/BtwB,GAA8C,OAAvCG,KAAK+P,gBAAgB7B,gBACR,wBAAlBrO,EAAI2wB,UACN3wB,EAAI2wB,UAAYxwB,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,yBAC5B,0BAAlBnQ,EAAI2wB,YACb3wB,EAAI2wB,UAAYxwB,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,4BAKrD6jC,YAAYh0C,GAClBG,KAAK+zC,YAAYjD,eAAejxC,EAAO,UAAUuI,UAAU,KACzDpI,KAAKg0C,OAAOC,OACZj0C,KAAKywC,MAAMv4B,MAAK,KAIZw6B,gBACN,MAAM7yC,EAAM+B,SAASsyC,qBAAqB,UAAU,GAC9Cp0C,EAAK8B,SAASC,cAAc,UAClC/B,EAAG8E,GAAK,eACR9E,EAAGq0C,IAAM,oCACTr0C,EAAG+W,OAAS,KACV7W,KAAKozC,oBAEPvzC,EAAIu0C,WAAWhY,aAAat8B,EAAID,GAG1B8yC,eACN,MAAM9yC,EAAM+B,SAASsyC,qBAAqB,UAAU,GAC9Cp0C,EAAK8B,SAASC,cAAc,UAClC/B,EAAG8E,GAAK,kBACR9E,EAAGq0C,IAAM,yCACTt0C,EAAIu0C,WAAWhY,aAAat8B,EAAID,iDA7FvBkB,GAAmBrB,oEAAnBqB,EAAmBugB,gNClBhC5hB,2LDkBaqB,MEWAszC,iBAMXtsC,YACUlI,EACAC,EACAM,EACAC,EAC2BC,GAJ3BN,mBACAA,cACAA,cACAA,mBAC2BA,uBATpBA,kBAAe,IAAIgI,KAC1BhI,WAA+B,IAAIN,MAU3CM,KAAK4O,QAAU5O,KAAK2K,OAAOD,UAAU,mBAAqB,GAE1D1K,KAAKs0C,YAAYhf,SAAW,IAAIif,KAAwB,CACtDxJ,KAAM/qC,KAAK4O,QACX4lC,MAAO,CACLC,cAAe,oBAInBz0C,KAAK00C,iBAAmB,IAAIC,MAAqB30C,KAAKs0C,YAAYhf,SAAUt1B,KAAKs0C,aAE7Et0C,KAAK4O,QAAQ6jC,SACfzyC,KAAK00C,iBAAiBE,YACrBrsC,MACC,QAAQ/H,GAA8BA,IAAWq0C,aACjD,QAAU70C,KAAK80C,eAEhB1sC,UAAU,KACTpI,KAAK+0C,iBAIP7pC,QAAQ0nC,KAAK,sDAIVoC,iBACLh1C,KAAKs0C,YAAYW,WAAWrvC,iBAAI5F,KAAKk1C,UAAUC,cAC9C/sC,UAAWvI,IACVG,KAAKs0C,YAAYhf,SAAS8f,iBAAiBv1C,EAASw1C,SACpDr1C,KAAK+0C,iBAIDA,eACN/0C,KAAKs0C,YAAYhf,SACdggB,mBAAmBt1C,KAAKk1C,UAAUC,aAClC3B,KAAM3zC,IAGLG,KAAK+zC,YAAYjD,eAFGjxC,EAAS01C,YAEgB,YAAa,CAAEC,QAD5C31C,EAAS41C,UAC+CrtC,UAAU,KAChFpI,KAAKg0C,OAAOC,OACZj0C,KAAKywC,MAAMv4B,MAAK,OAGnBw9B,MAAa71C,IAAK,wCACjB,GAAIA,aAAiB81C,MAEnB,OAAO31C,KAAKs0C,YAAYsB,kBAAkB51C,KAAKk1C,UAAUC,aAE3DjqC,QAAQC,IAAItL,MACX61C,MAAM71C,IACPqL,QAAQC,IAAI,wBAIV+pC,UACN,OAAOl1C,KAAK61C,gBAAgBpvC,OAAO5G,GAAsB,QAAdA,EAAKiF,MAAgB,iDAtEvD/D,GAAsBrB,mDAWvBi1C,iCAXC5zC,EAAsBugB,sMC7BnC5hB,oBAAyDA,gCAASI,qBAChEJ,sBACAA,8BACFA,eADEA,kWD2BWqB,MELA+0C,iBAKT/tC,YACkClI,EACtBC,GADsBE,gBACtBA,gBAJJA,UAAO,sBACPA,aAAU,eAKd,MAAMI,EAAOJ,KAAKuT,SAASzI,MAAK,GAAMnH,MAAM,KAAKonB,MAC7C3qB,IACAJ,KAAK+1C,aAAe,IAAI31C,KAE5BJ,KAAKs1B,SAAS0gB,yBAAyBnB,cAAoB70C,KAAKsL,SAGpEsqC,kBAAkB/1C,GACd,OAAO,QAAKG,KAAKs1B,SAASsgB,kBAAkB/1C,IAEhDo2C,qBAAqBp2C,GACjB,OAAO,QAAKG,KAAKs1B,SAAS2gB,qBAAqBp2C,IAEnDy1C,mBAAmBz1C,GACf,OAAO,QAAKG,KAAKs1B,SAASggB,mBAAmBz1C,IAEjDq2C,yBAAyBr2C,GACrB,SAAOs2C,MAAKn2C,KAAKs1B,SAAS8gB,sBAAsBv2C,GAAQG,KAAK+1C,eAEjEd,WAAWp1C,GACP,OAAO,QAAKG,KAAKs1B,SAAS2f,WAAWp1C,IAEzCw2C,cAAcx2C,GACV,OAAO,QAAKG,KAAKs1B,SAAS+gB,cAAcx2C,IAE5CyxC,OAAOzxC,GACH,OAAO,QAAKG,KAAKs1B,SAASgc,OAAOzxC,IAErCy2C,eAAez2C,GACX,OAAO,QAAKG,KAAKs1B,SAASghB,eAAez2C,IAE7C02C,YAAY12C,GACR,OAAO,QAAKG,KAAKs1B,SAASihB,YAAY12C,IAE1C22C,UAAU32C,GACN,OAAO,QAAKG,KAAKs1B,SAASkhB,UAAU32C,IAMxC42C,YACI,OAAKz2C,KAAK02C,SACN12C,KAAK02C,OAAS12C,KAAKs1B,SAASmhB,YAAY/sC,MAAM1J,KAAKkR,KAAMlR,KAAKsL,UAE3DtL,KAAK02C,OAGhBC,UAAU92C,GACNG,KAAK02C,OAAS72C,EAAO6J,MAAM1J,KAAKkR,KAAMlR,KAAKsL,SAC3CtL,KAAKs1B,SAASqhB,UAAU92C,iDA3DnBkB,GAAcrB,MAMXi1C,OAAaj1C,wCANhBqB,EAAcsI,QAAdtI,EAAc,YAAdA,MCZA61C,iBAMT7uC,YACmClI,EACvBC,GADuBE,oBACvBA,mBAERA,KAAK62C,aAAe,IAAI7uC,KACxBhI,KAAK82C,aAAe92C,KAAK62C,aAAaE,eAGtC/2C,KAAKg3C,YAAc,IAAIjuC,IAAmC8rC,eAC1D70C,KAAK40C,YAAc50C,KAAKg3C,YAAYD,eAEpC/2C,KAAKi3C,aAAaC,iBAAkB92C,IAChCJ,KAAK62C,aAAa1uC,KAAK/H,GACvB,MAAMC,EAAS82C,mCAAgD/2C,GAChD,OAAXC,IACAL,KAAK+zC,YAAY0C,YAAYW,QAAQ,sBAAsBh3C,EAAQi3C,8CAA8Ch3C,KACjHL,KAAKg3C,YAAY7uC,KAAK9H,oDAtBzBU,GAAuBrB,MAOpBi1C,OAAaj1C,sCAPhBqB,EAAuBsI,QAAvBtI,EAAuB,YAAvBA,MCoBAu2C,iBAMXvvC,YACUlI,EACAC,EACAM,EACAC,EAC2BC,GAJ3BN,mBACAA,cACAA,cACAA,mBAC2BA,uBATpBA,kBAAe,IAAIgI,KAC1BhI,WAA+B,IAAIN,MAW3CM,KAAK4O,QAAU5O,KAAK2K,OAAOD,UAAU,sBAAwB,GAE7D1K,KAAKs0C,YAAYhf,SAAW,IAAIif,KAAwB,CACtDxJ,KAAM/qC,KAAK4O,QAAQ2oC,mBACnB/C,MAAO,CACLC,cAAe,oBAInBz0C,KAAK00C,iBAAmB,IAAIkC,GAAwB52C,KAAKs0C,YAAYhf,SAAUt1B,KAAKs0C,aAEhFt0C,KAAK4O,QAAQ2oC,mBAAmB9E,SAClCzyC,KAAK00C,iBAAiBE,YACrBrsC,MACC,QAAQ/H,GAA8BA,IAAWq0C,aACjD,QAAU70C,KAAK80C,eAEhB1sC,UAAU,KACTpI,KAAK+0C,iBAIP7pC,QAAQ0nC,KAAK,sDAIV4E,oBACLx3C,KAAKs0C,YAAYW,WAAWrvC,iBAAI5F,KAAKk1C,UAAUC,cAC9C/sC,UAAWvI,IACVG,KAAKs0C,YAAYhf,SAAS8f,iBAAiBv1C,EAASw1C,SACpDr1C,KAAK+0C,iBAIDA,eACN/0C,KAAKs0C,YAAYhf,SACdggB,mBAAmBt1C,KAAKk1C,UAAUC,aAClC3B,KAAM3zC,IAELG,KAAK+zC,YAAYjD,eADHjxC,EAAS41C,QACgB,gBAAgBrtC,UAAU,KAC/DpI,KAAKg0C,OAAOC,OACZj0C,KAAKywC,MAAMv4B,MAAK,OAGnBw9B,MAAa71C,IAAK,wCACjB,GAAIA,aAAiB81C,MAEnB,OAAO31C,KAAKs0C,YAAYsB,kBAAkB51C,KAAKk1C,UAAUC,gBAExDO,MAAM71C,IACPqL,QAAQC,IAAI,wBAIZ+pC,UACN,OAAOl1C,KAAK61C,gBAAgBpvC,OAAO5G,GAAsB,QAAdA,EAAKiF,MAAgB,iDArEvD/D,GAAyBrB,gDAW1Bi1C,iCAXC5zC,EAAyBugB,yMChCtC5hB,oBAAyDA,gCAASI,wBAChEJ,sBACAA,8BACFA,eADEA,qWD8BWqB,MEdA02C,iBAKX1vC,YACUlI,EACAC,EACAM,GAFAJ,mBACAA,cACAA,cALAA,WAA+B,IAAIN,MAO3CM,KAAK4O,QAAU5O,KAAK2K,OAAOD,UAAU,kBAAoB,GAEzD1K,KAAS4O,QAAQ8oC,MACf13C,KAAK23C,kBAELzsC,QAAQ0nC,KAAK,kDAITgF,kBACL12C,OAAe22C,GAAGC,MAAM1vC,UAAU,oBAAqBvI,IACtDG,KAAK+3C,qBAAqBl4C,KAItBk4C,qBAAqBl4C,GACH,cAApBA,EAAS+I,QAEX5I,KAAKg4C,cADen4C,EAASo4C,aAAa1C,aAKtCyC,cAAcn4C,GACpBG,KAAK+zC,YAAYjD,eAAejxC,EAAO,YAAYuI,UAAU,KAC3DpI,KAAKg0C,OAAOC,OACZj0C,KAAKywC,MAAMv4B,MAAK,KAIZy/B,kBACN,GAAI/1C,SAASs2C,eAAe,kBAC1B,OAGF,MAGMp4C,EAAM8B,SAASsyC,qBAAqB,UAAU,GAC9C9zC,EAAKwB,SAASC,cAAc,UAClCzB,EAAGwE,GAAK,iBACRxE,EAAG+zC,IAAM,wEAAmBn0C,KAAK4O,QAAQ8oC,QACzCt3C,EAAGyW,OAAS,KACV7W,KAAK43C,mBAEP93C,EAAIs0C,WAAWhY,aAAah8B,EAAIN,iDAtDvBiB,GAAqBrB,0DAArBqB,EAAqBugB,oUClBlC5hB,4IDkBaqB,+CEJXrB,oBAAsGA,oEACpGA,8BACFA,gCAFiFA,4BAC/EA,yFAEFA,eACEA,cACAA,kBAA2BA,SAASA,QACtCA,8BAD6BA,6BCDlBy4C,iBAgBXpwC,YACSlI,EACCC,EACRM,GAFOJ,YACCA,uBAVFA,sBAAkB,EAEnBA,WAAQ,GAERA,cAAU,EAEPA,WAA+B,IAAIN,MAO3CM,KAAKu3B,KAAOn3B,EAAGw3B,MAAM,CACnB8Y,SAAU,CAAC,GAAIrqB,gBACfsqB,SAAU,CAAC,GAAItqB,uCApBjB,OAAOrmB,KAAKo4C,mCAEKv4C,GACjBG,KAAKo4C,gBAAkBv4C,EAqBzBw4C,UAAUx4C,GACR,YAAKy4C,SAAU,EACft4C,KAAK+qC,KAAK0F,MAAM5wC,EAAO6wC,SAAU7wC,EAAO8wC,UAAUvoC,UAChD,KACEpI,KAAKywC,MAAMv4B,MAAK,GAChBlY,KAAKs4C,SAAU,GAEhBx4C,IACC,IACEE,KAAK+P,gBAAgB/B,UAClBvE,IAAI,kBAAoB3J,EAAMuL,MAAM2D,SACpC5G,UAAUhI,GAAaJ,KAAKqL,MAAQjL,SAChCA,GACPJ,KAAKqL,MAAQvL,EAAMuL,MAAM2D,QAE3BhP,KAAKs4C,SAAU,KAGZ,EAGTpH,iBACElxC,KAAK+qC,KAAKmG,iBAAiB9oC,UAAU,KACnCpI,KAAKywC,MAAMv4B,MAAK,mDAlDTnX,GAAmBrB,2DAAnBqB,EAAmBugB,gnBDlBhC5hB,kBAAqCA,mCAAYI,4BAC/CJ,eACEA,4BACEA,wCACFA,QACFA,QAEAA,eACEA,4BACEA,wCACFA,QACFA,QAEAA,oBAAwCA,gCAAgCA,QACxEA,4BAGAA,yBAIFA,eArBMA,0BAGyBA,yDAMgBA,6DAILA,8CAC/BA,wCAGHA,iOCCKqB,4BCjBXrB,0DAKEA,6BAEEA,8DACFA,kDACAA,gCAEEA,8DACFA,kDACAA,mCAEEA,8DACFA,kDACAA,+BAEEA,8DACFA,kDACAA,6BAGEA,8DACFA,iCAFEA,4EArBJA,iBACEA,cAAIA,8BAAqCA,QAEzCA,oCAIAA,uCAIAA,0CAIAA,sCAIAA,oCAKFA,+BAvBMA,iDAGDA,uEAIAA,6EAIAA,mFAIAA,2EAIAA,kHAMLA,iBACEA,aAAGA,8BAAwCA,QAC3CA,oBAAwCA,6DAAmBA,8BAAkCA,QAC/FA,iCAFKA,qDACwDA,wFAK3DA,oBAAkEA,2DAAiBA,8BAA+BA,cAA/BA,sEAFrFA,iBACEA,aAAGA,8BAAuCA,QAC1CA,4BACFA,+BAFKA,mDACMA,sEApCbA,eACEA,wBAEAA,wBA0BAA,wBAKAA,wBAKFA,8BAtCQA,2DAEAA,sDA0BAA,gEAKAA,4CCZK64C,iBAuEXxwC,YACSlI,EACCC,EACYM,GAFbJ,YACCA,cACYA,cA/DdA,yBAAqB,EASrBA,8BAA0B,EAS1BA,oBAAgB,EAYhBA,+BAA2B,EAY3BA,qBAAiB,EAQfA,WAA+B,IAAIN,MAKtCM,cAAU,EAUfA,KAAK4O,QAAU5O,KAAK2K,OAAOD,UAAU,SAAW,GAChD1K,KAAK4mB,QAA8D,IAApDhhB,OAAOyB,oBAAoBrH,KAAK4O,SAASrO,OAAWi4C,wBA1EnE,OAAIx4C,KAAKy4C,gBAAiBz4C,KAAKy4C,eAGxBz4C,KAAK04C,yCAEQ74C,GACpBG,KAAK04C,mBAA0C,SAArB74C,EAAMoD,WAAe01C,6BAM/C,OAAO34C,KAAK44C,mDAEa/4C,GACzBG,KAAK44C,wBAA+C,SAArB/4C,EAAMoD,WAAe41C,mBAMpD,OAAO74C,KAAK84C,+BAEGj5C,GACfG,KAAK84C,cAAqC,SAArBj5C,EAAMoD,WAAe81C,8BAM1C,OAAI/4C,KAAKy4C,cACAz4C,KAAK24C,uBAEP34C,KAAKg5C,qDAEcn5C,GAC1BG,KAAKg5C,yBAAgD,SAArBn5C,EAAMoD,WAAeg2C,oBAMrD,OAAIj5C,KAAKy4C,cACAz4C,KAAK64C,aAEP74C,KAAKk5C,iCAEIr5C,GAChBG,KAAKk5C,eAAsC,SAArBr5C,EAAMoD,WAAek2C,mBAK3C,IAAKn5C,KAAKy4C,cACR,OAAO,EAuBJj4B,WACLxgB,KAAKo5C,eACLp5C,KAAKq5C,UAGAC,UACLt5C,KAAK+qC,KAAK2G,kBACV1xC,KAAKq5C,UACLr5C,KAAKywC,MAAMv4B,MAAK,GAGXo5B,SACLtxC,KAAK+qC,KAAKuG,SAASlpC,UAAU,KAC3BpI,KAAKoyC,UAAO,EACRpyC,KAAK0T,SACH1T,KAAK4O,QAAQ2qC,YACfv5C,KAAK0T,OAAOC,SAAS,CAAC3T,KAAK4O,QAAQ2qC,cAC1Bv5C,KAAK4O,QAAQkjC,WACtB9xC,KAAK0T,OAAOC,SAAS,CAAC3T,KAAK4O,QAAQkjC,eAMpC0H,OACDx5C,KAAK0T,QAAU1T,KAAK4O,QAAQkjC,WAC9B9xC,KAAK0T,OAAOC,SAAS,CAAC3T,KAAK4O,QAAQkjC,YAI/BuH,UACN,MAAMx5C,EAAeG,KAAK+qC,KAAK0G,cAC3B5xC,IACFG,KAAKoyC,KAAO,CACVlhC,KAAMrR,EAAauyC,KAAKqH,WAAa55C,EAAauyC,KAAKsH,WAKrDN,gBACDp5C,KAAK0T,QAIV1T,KAAK0T,OAAOimC,OACTpxC,QAAKqxC,MAAQ/5C,GAAUA,aAAiBqqC,OACxC9hC,UAAWvI,IACV,GAAIA,EAAYgR,IAAK,CACnB,MAAM/Q,EAAeD,EAAYgR,IAE3BxQ,EAAaL,KAAK4O,QAAQgjC,WAEhC5xC,KAAKy4C,cAAgB34C,IAHDE,KAAK4O,QAAQ2qC,YAIjCv5C,KAAK65C,aAAe/5C,IAAiBO,EAEjCL,KAAKy4C,eACPz4C,KAAK+qC,KAAKuG,0DAxITvwC,GAAiBrB,2DAAjBqB,EAAiBugB,qpBDtB9B5hB,6BAAMA,gfCsBOqB,MCJA+4C,iBAiBX/xC,YACUlI,EACAC,EACAM,GAFAJ,cACAA,oBACAA,YAnBFA,wBAAoB,mBAG1B,MAAMH,EAAaG,KAAK2K,OAAOD,UAAU,oBAAsB,GAC/D,SAAW9J,KAAKM,OAAOqS,SAASwmC,UACzBl6C,6BAIP,OAAOG,KAAK2K,OAAOD,UAAU,8BAAgC,4BAI7D,OAAO1K,KAAK2K,OAAOD,UAAU,oBAAsB,GASrDnB,UACE1J,EACAC,GAEA,MAAMM,EAAkBJ,KAAKg6C,2BAA2Bn6C,EAAYgR,KACpE,IAAIxQ,EAAMR,EAAY6J,QACtB,MAAMpJ,EAAcN,KAAKi6C,qBAAqBp6C,EAAYgR,KACtDvQ,IACFD,EAAMA,EAAIqJ,MAAM,CACdsiC,OAAQ3rC,EAAI2rC,OAAOv2B,IAAInV,EAAY2F,IAAK3F,EAAYwB,UAGpD1B,IACFC,EAAMR,EAAY6J,MAAM,CACtBwwC,qBAGJl6C,KAAKm6C,eACL,MAAM35C,EAAQR,KAAKqxC,aAAa5nC,MAC1B/F,EAAU9B,SAASC,cAAc,KAMvC,GALA6B,EAAQ02C,KAAO/5C,EAAIwQ,IACE,KAAjBnN,EAAQ22C,OACV32C,EAAQ02C,KAAO12C,EAAQ02C,OAGpB55C,IAAuD,IAA9CR,KAAKs6C,WAAWp6C,QAAQwD,EAAQq2C,UAC5C,OAAOj6C,EAAK8J,OAAOvJ,GAIrB,IAAIwD,EAAUxD,EAAIqJ,MAAM,CACtBF,QAASnJ,EAAImJ,QAAQiM,IAAI,gBAFR,UAAUjV,OAK7B,MAAMuD,EAAoB/D,KAAKqxC,aAAarB,SAC5C,GAC+B,SAA7BnsC,EAAQmoC,OAAOviC,IAAI,OACnB1F,GACAA,EAAaquC,MACbruC,EAAaquC,KAAKsH,SAClB,CACA,MAAM11C,EAAWu2C,aAAYx2C,EAAaquC,KAAKsH,UAC/C71C,EAAUA,EAAQ6F,MAAM,CACtBsiC,OAAQnoC,EAAQmoC,OAAOv2B,IAAI,KAAMzR,SAEG,SAA7BH,EAAQmoC,OAAOviC,IAAI,QAC5B5F,EAAUA,EAAQ6F,MAAM,CACtBsiC,OAAQnoC,EAAQmoC,OAAOriC,OAAO,SAIlC,OAAO7J,EAAK8J,OAAO/F,GAGrB22C,aAAa36C,EAAKC,GAChB,MAAMM,EAAkBJ,KAAKg6C,2BAA2Bl6C,GACxD,GAAIM,EACD,SAAI85C,gBAAkB95C,GACf,EAGVJ,KAAKm6C,eACL,MAAM95C,EAAUuB,SAASC,cAAc,KACvCxB,EAAQ+5C,KAAOt6C,EAEf,MAAMQ,EAAQN,KAAKqxC,aAAa5nC,MAChC,SAAKnJ,IAAuD,IAA9CN,KAAKs6C,WAAWp6C,QAAQG,EAAQ05C,YAG9Cl6C,EAAI46C,iBAAiB,gBAAiB,UAAYn6C,GAC3C,IAGTo6C,oBAAoB76C,GAClB,MAAMC,EAAcE,KAAKi6C,qBAAqBp6C,GAE9C,GAAIC,EAAa,CACf,MAAMO,EAFaR,EAEkB8D,MAAM,QAC3C,IAAIrD,EAAkBD,EAAc+F,QACpC,MAAM5F,EAAeH,EAAcoG,OAAO/C,GAAkB,IAAbA,EAAEnD,QACjD,SAAaK,KAAK,GAAGd,EAAYmG,OAAOnG,EAAYgC,SAChDtB,EAAaD,SACfD,GAAmB,IAAME,EAAaM,KAAK,MAEtCR,GAKH05C,2BAA2Bn6C,GACjC,IAAIC,GAAkB,EACtB,UAAWM,KAAuBJ,KAAK26C,qBAErC,GAAI,IADoB11B,OAAO7kB,EAAoBw6C,kBACnC11B,KAAKrlB,GAAS,CAC5BC,OAA0D,IAAxCM,EAAoB85C,gBAAgC95C,EAAoB85C,qBAAkB,EAC5G,MAGJ,OAAOp6C,EAGDm6C,qBAAqBp6C,GAC3B,IAAIC,EACJ,UAAWQ,KAAqBN,KAAK66C,mBAEnC,GAAI,IADoB51B,OAAO3kB,EAAkBs6C,kBACjC11B,KAAKrlB,KAEJ,IAAIolB,OADL,GAAG3kB,EAAkBw6C,eAAex6C,EAAkBy6C,WAClC,MACpB71B,KAAKrlB,GAAS,CAC1BC,EAAc,CAACmG,IAAM3F,EAAkBw6C,YAAah5C,MAAOxB,EAAkBy6C,UAC7E,MAIN,OAAOj7C,EAGTq6C,eACE,MAAMt6C,EAAMG,KAAKqxC,aAAarB,SACxBlwC,OAAkBuG,MAAO8pC,UAAY,IAE3C,IACGnwC,KAAKg7C,mBACNn7C,GACAC,EAAcD,EAAIuwC,KAClBtwC,EAAcD,EAAIuwC,IAAM,KACxB,CACApwC,KAAKg7C,mBAAoB,EAEzB,MAAM56C,EAAMJ,KAAK2K,OAAOD,UAAU,YAClC,OAAO1K,KAAKkM,KAAKklC,KAAK,GAAGhxC,YAAe,IAAIgI,UACzC/H,IACCL,KAAKqxC,aAAa57B,IAAIpV,EAAK0wC,OAC3B/wC,KAAKg7C,mBAAoB,GAE3B36C,IACEA,EAAIgL,MAAM0D,QAAS,EACZ1O,mDAhKJU,GAAerB,2DAAfqB,EAAesI,QAAftI,EAAe,qBAFd,SAEDA,kBCCqBA,GAEhC,MAAMO,EAA6BP,EAAO2J,UAAU,mBAAqB,GAEzE,SAAOuwC,YAAc35C,EAAO25C,aAAe/5C,OAAOqS,SAAS6mC,KAC3D94C,EAAO45C,UAAY55C,EAAO45C,WAAa,kDAErB,IAAI3G,KAAwB,CAC5CxJ,KAAMzpC,EACNkzC,MAAO,CACLC,cAAe,gCAOgB1zC,GAEnC,MAAMO,EAA6BP,EAAO2J,UAAU,yCAA2C,GAC/F,SAAOuwC,YAAc35C,EAAO25C,aAAe/5C,OAAOqS,SAAS6mC,KAC3D94C,EAAO45C,UAAY55C,EAAO45C,WAAa,kDAErB,IAAI3G,KAAwB,CAC5CxJ,KAAMzpC,EACNkzC,MAAO,CACLC,cAAe,gCAOoB1zC,GAIvC,OAFqCA,EAAO2J,UAAU,kBAE/C,CACLywC,gBAAiBtG,YACjBM,YAAa,CACXiG,OAAQ,CAAC,aACTC,UAAW,QAEbv2C,KAAM,mBAIkC/D,GAE1C,MAAMO,EAA6BP,EAAO2J,UAAU,yCAA2C,GAE/F,MAAO,CACLywC,gBAAiBtG,YACjBM,YAAa,CACXiG,OAAQ,CAAC95C,EAAOmxC,WAElB3tC,KAAM,mBAI2B/D,GACnC,MAAa,QAATA,EACK,CACL,CACEmJ,QAASyqC,MACThpC,WAAY2vC,GACZzvC,KAAM,CAACpB,IAET,CACEP,QAASyqC,MACThpC,WAAY4vC,GACZ1vC,KAAM,CAACpB,GACPJ,OAAO,GAETyrC,IAGK,CACL,CACE5rC,QAASyqC,MACThpC,WAAY6vC,GACZ3vC,KAAM,CAACpB,IAET,CACEP,QAASyqC,MACThpC,WAAY8vC,GACZ5vC,KAAM,CAACpB,GACPJ,OAAO,GAETsqC,WCjGO+G,yBAA2BtmC,GAGtCrN,YACElI,EACQC,EACAM,EACAC,GAERwf,MAAMhgB,GAJEG,YACAA,mBACAA,oBAIRA,KAAK+zC,YAAYzD,cAAcloC,UAAU9H,IACnCA,GAAmBN,KAAK4O,QAAQiC,KAClC7Q,KAAKkM,KACFzC,IAAIzJ,KAAK4O,QAAQiC,KACjBzI,UAAW5H,IACV,GAAIA,GAAWA,EAAQm7C,WACrB,UAAWj4C,KAAOkC,OAAOC,KAAKrF,EAAQm7C,YAEpC97B,MAAMpK,IAAI/R,EADIlD,EAAQm7C,WAAWj4C,QAS/C+R,IACE5V,EACAC,EACAM,EAAsB6U,UAEtB,GACE7U,IAAU6U,UACVjV,KAAK+zC,YAAYxD,eACjBvwC,KAAK4O,QAAQiC,IACb,CACA,MAAMxQ,EAAa,GACnBA,EAAWR,GAAOC,EAClBE,KAAKkM,KAAKgmC,MAAMlyC,KAAK4O,QAAQiC,IAAK,CAAE8qC,eAAcvzC,YAEpDyX,MAAMpK,IAAI5V,EAAKC,EAAOM,GAGxB+P,OAAOtQ,EAAaC,EAAsBmV,UACxC,GACEnV,IAAUmV,UACVjV,KAAK+zC,YAAYxD,eACjBvwC,KAAK4O,QAAQiC,IACb,CACA,MAAMzQ,EAAa,GACnBA,EAAWP,QAAO,EAClBG,KAAKkM,KAAKgmC,MAAMlyC,KAAK4O,QAAQiC,IAAK,CAAE8qC,eAAcvzC,YAEpDyX,MAAM1P,OAAOtQ,EAAKC,GAGpBoW,MAAMrW,EAAsBoV,UAa1B,IAAInV,EAXFD,IAAUoV,UACVjV,KAAK+zC,YAAYxD,eACjBvwC,KAAK4O,QAAQiC,KAEb7Q,KAAKkM,KAAKgmC,MAAMlyC,KAAK4O,QAAQiC,IAAK,CAAE8qC,WAAY,IAAK,CACnD3P,OAAQ,CACN4P,gBAAiB,WAElBxzC,YAIDvI,IAAUoV,WACZnV,EAAQE,KAAKqxC,aAAa5nC,OAG5BoW,MAAM3J,MAAMrW,GAERC,GACFE,KAAKqxC,aAAa57B,IAAI3V,GAItBD,IAAUoV,UACVjV,KAAK+zC,YAAYxD,eACjBvwC,KAAK4O,QAAQiC,KAEb7Q,KAAKkM,KACFzC,IAAIzJ,KAAK4O,QAAQiC,KACjBzI,UAAWhI,IACV,GAAIA,GAAWA,EAAQu7C,WACrB,UAAWt7C,KAAOuF,OAAOC,KAAKzF,EAAQu7C,YAEpC97B,MAAMpK,IAAIpV,EADID,EAAQu7C,WAAWt7C,oDA3FlCU,GAAkBrB,qEAAlBqB,EAAkBsI,QAAlBtI,EAAkB,qBAFjB,SAEDA,MCmCA86C,iBAAa9xC,iBAEtB,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,CACT,CACEC,QAASC,KACTC,SAAU0vC,GACVzvC,OAAO,GAET,CACEH,QAASkL,GACThL,SAAUsxC,OAETI,GAAqB,UACrBA,GAAqB,uDAfnB/6C,4DArBF,CACPiM,KACAqZ,MACAwF,MACA0I,KACA90B,KACAuvB,KACAriB,GACAgoC,UAaS5zC,MC1Cb,MAOag7C,GAA2B7R,cAPjB,CACrB,CACEp/B,KAAM,YACNwrB,UCEJ,MAAM,QAGJvuB,YAAoBlI,0BAFZG,iBAAwB,iDADrBe,GAAoBrB,oCAApBqB,EAAoBugB,gRCTjC5hB,oBACEA,6BAAmBA,gBAAIA,QACvBA,0BAAgBA,4BAAgBA,QAChCA,4BACEA,cAAIA,wDAA4CA,QAEhDA,cACAA,qBAAQA,gBAAgGA,iCAAoBA,QAAIA,eAChIA,sCAAwBA,gBAA2FA,gCAAkBA,QACvIA,QACFA,QAEAA,gSDHaqB,GAAb,MEIO,IAAMi7C,GAAb,MAAM,sDAAOj7C,4DAHF,CAACg7C,GAA0B3sB,KAAeysB,iBAGxC96C,GAAb,q1CCNak7C,iBACXl0C,eAEAkqB,KAAKpyB,GACCA,EAASq8C,QACXh7C,OAAO+wB,KAAKpyB,EAASgR,IAAK,wDALnB9P,gCAAesI,QAAftI,EAAe,qBAFd,SAEDA,+CCPbrB,oBAOEA,mHACAA,sBACFA,gCAJEA,uDAAkD,4CCHpDA,gCACEA,cAAIA,SAAmBA,QACzBA,8BADMA,2DAENA,gCACEA,gBACFA,8BADMA,uDCWOy8C,iBAmBXp0C,YACUlI,EACAC,GADAE,uBACAA,cAJFA,YAAS,sBAdf,OAAOA,KAAKo8C,iBAEJv8C,GACRG,KAAKo8C,OAASv8C,cAMd,OAAOG,KAAK8gC,iBAEJjhC,GACRG,KAAK8gC,OAASjhC,EAQhBw8C,aAAax8C,GACPA,EAASq8C,QACNr8C,EAASgR,KAAOhR,EAASy8C,SAC5Bt8C,KAAKkyB,OAAOD,KAAKsqB,GAA2B,CAC1ChzB,KAAM,CACJizB,WAAYx8C,KAAKy8C,MAAMxtC,MACvBqtC,SAAUz8C,EAASy8C,SACnBx3C,KAAMjF,EAASiF,QAGVjF,EAASgR,KAClB7Q,KAAK08C,gBAAgBzqB,KAAKpyB,IAElBA,EAASq8C,QAAUr8C,EAASy8C,UACtCt8C,KAAKkyB,OAAOD,KAAKsqB,GAA2B,CAC1ChzB,KAAM,CACJizB,WAAYx8C,KAAKy8C,MAAMxtC,MACvBqtC,SAAUz8C,EAASy8C,SACnBx3C,KAAMjF,EAASiF,sBAOrB,GAAK9E,KAAKy8C,MAGV,OAAOz8C,KAAKy8C,MAAM7tC,sDAnDT7N,GAAuBrB,iDAAvBqB,EAAuBugB,kYFjBpC5hB,gCACGA,+MEgBUqB,MA6DAw7C,iBACXx0C,YAA4ClI,6DADjCkB,GAAyBrB,MAChB8yB,iCADTzxB,EAAyBugB,qPD9EtC5hB,gBAAqBA,SAAqBA,QAC1CA,oBAAyDA,aAACA,QAC1DA,uCAGAA,8CALqBA,kCAEAA,kDAGAA,4QCyERqB,MClDA47C,iBAAiB5yC,iBAE1B,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,kDAJJlJ,4DAfF,CACPiM,KACAvN,KACAuvB,KACAC,KACAtiB,GACA6lB,UASSzxB,YC5BA67C,GAAU,cAEXC,SAAZ,OAAY97C,UAAa,KACvBA,iBACAA,mBACAA,mBACAA,yBAJU87C,GAAZ,IAAY97C,uBCIsB+7C,EAUhC/0C,YAAYzG,EAAmBzB,EAAgCC,GAC7D+f,QATQ7f,YAAS,EACTA,aAAU,EASlBA,KAAKsc,OAAShb,EAAMsN,QAAQ0N,OAAOygC,GACnC/8C,KAAK4E,GAAKqE,IACVjJ,KAAK+Q,eAAiBlR,EACtBG,KAAK+P,gBAAkBjQ,EAGfuI,QACRrI,KAAKsc,OAAOxT,GAAG,iBAAkBxH,GAAKtB,KAAKg9C,gBAAgB17C,IAC3DtB,KAAKsc,OAAOxT,GAAG,eAAgBxH,GAAKtB,KAAKi9C,cAAc37C,IACvDtB,KAAKsc,OAAOxT,GAAG,iBAAkBxH,GAAKtB,KAAKi9C,cAAc37C,IACzDtB,KAAKsc,OAAOxT,GAAG,iBAAkBxH,GAAKtB,KAAKk9C,gBAAgB57C,IAGnDqH,UACR3I,KAAKsc,OAAOqd,GAAG,iBAAkBr4B,GAAKtB,KAAKg9C,gBAAgB17C,IAC3DtB,KAAKsc,OAAOqd,GAAG,eAAgBr4B,GAAKtB,KAAKi9C,cAAc37C,IACvDtB,KAAKsc,OAAOqd,GAAG,iBAAkBr4B,GAAKtB,KAAKi9C,cAAc37C,IACzDtB,KAAKsc,OAAOqd,GAAG,iBAAkBr4B,GAAKtB,KAAKk9C,gBAAgB57C,IAGrD07C,gBAAgB17C,GACjBA,EAAMwsC,MAAMqP,eACf77C,EAAMwsC,MAAMqP,aAAe,IAE7B77C,EAAMwsC,MAAMqP,aAAav8C,KAAKZ,KAAK4E,IAEnC5E,KAAKs4C,SAAW,EAChBt4C,KAAK4I,OAASd,UAGRm1C,cAAc37C,GACpB,IAAKA,EAAMwsC,MAAMqP,aACf,OAGF,MAAMt9C,EAAeyB,EAAMwsC,MAAMqP,aAAaj9C,QAAQF,KAAK4E,IAC3D,GAAI/E,EAAe,EACjB,OAGFyB,EAAMwsC,MAAMqP,aAAan4C,OAAOnF,EAAc,GAE9CG,KAAKo9C,QAAU,EAEf,MAAMt9C,EAAUE,KAAKs4C,QACjBt4C,KAAKo9C,QAAUt9C,GACbA,IAAYE,KAAKs4C,UACnBt4C,KAAK4I,OAASd,OACd9H,KAAKo9C,OAASp9C,KAAKs4C,QAAU,GAK3B4E,gBAAgB57C,GAEtB,IAAKA,EAAMwsC,MAAMqP,aACf,OAEF,MAAMt9C,EAAQG,KAAK+P,gBAAgB/B,UAAUgC,QAC3C,uCAEIlQ,EAAUE,KAAK+P,gBAAgB/B,UAAUgC,QAC7C,iCAAkC,CAAClO,MAAOR,EAAM8lB,OAAOi2B,QAAQC,SAGjEt9C,KAAK+Q,eAAe1F,MAAMvL,EAASD,GACnCG,KAAKo9C,QAAS,EACdp9C,KAAKs4C,QAAU,EACft4C,KAAK4I,OAASd,qBClFuB/G,WAQvC,MALiD,SAAX,QAApCO,EAF6BP,EAENw8C,qBAAa,eAAEz4C,SACE,QAAvCjF,EAH4BkB,EAGLy8C,wBAAgB,eAAEC,aAHb18C,EAGkD08C,cAHlD18C,EAKNw8C,cAAcG,aALR38C,EAIKw8C,cAAcG,cACc,WAEzD38C,MCoDG48C,SAAZ,OAAY58C,UAAgB,KAC1B68C,kBACA78C,oBACAA,0BACAA,gCACAA,gCACAA,kBACAA,0BAPU48C,GAAZ,IAAY58C,MAoBA88C,SAAZ,OAAY98C,UAAW,KACrB+8C,cACA/8C,sBACAA,kBAHU88C,GAAZ,IAAY98C,kBCpEgCA,GAc1C,OAbmB,CACjBg9C,IAAKC,GACLC,KAAMC,GACNC,IAAKC,GACLC,QAASC,GACTC,IAAKC,GACLC,WAAYC,GACZC,gBAAiBD,GACjBE,eAAgBF,GAChBG,IAAM/+C,GAAmC,MACzCg/C,UAAYh/C,GAAmC,aAEpBiB,EAAQ+D,OAASi6C,IAC7Bh+C,eAQ4BA,GAC7C,MAAMO,EAASP,EAAQirC,OAAOsR,OACxBz9C,EAAMm/C,GAAej+C,EAAQ8P,KAEnC,OAAO0pC,aADO,MAAQ16C,EAAMyB,eASkBP,GAC9C,MAAMO,EAAQP,EAAQ07C,MAChB58C,EAAMm/C,GAAej+C,EAAQ8P,KAEnC,OAAO0pC,aADO,OAAS16C,EAAMyB,eASgBP,GAC7C,MAAMO,EAAM09C,GAAej+C,EAAQ8P,KAEnC,OAAO0pC,aADO,MAAQj5C,eAS2BP,GACjD,IAAKA,EAAQ8P,IAAO,OAAOkuC,KAC3B,MAAMz9C,EAAM09C,GAAej+C,EAAQ8P,KAEnC,OAAO0pC,aADO,UAAYj5C,eASmBP,GAC7C,IAAKA,EAAQ8P,MAAQ9P,EAAQirC,OAAU,OAAO+S,KAC9C,MAAMz9C,EAAM09C,GAAej+C,EAAQ8P,KAEnC,OAAO0pC,aADO,MAAQj5C,EAAMP,EAAQirC,OAAOiT,0BAQSl+C,GACpD,MAAMO,EAASP,EAAQ07C,MACjB58C,EAAMm/C,GAAej+C,EAAQ8P,KAEnC,OAAO0pC,cADQx5C,EAAQ+D,MAAQ,UAAYjF,EAAMyB,eAQxBP,GACzB,OAAOkI,gBAGsBlI,GAE7B,MAAMlB,GAD2B,MAAlBkB,EAAIZ,OAAO,GAAae,OAAOqS,SAAS2rC,OAASn+C,EAAMA,GACzC4C,MAAM,QACnC,IAAI7D,EAAkBD,EAAcuG,QACpC,MAAMhG,EAAeP,EAAc4G,OAAOpG,GAAkB,IAAbA,EAAEE,QAAgC,MAAhBF,EAAEF,OAAO,IAC1E,OAAIC,EAAaG,SACfT,GAAmB,IAAMM,EAAaU,KAAK,MAEtChB,WCnGPiI,YACSzG,EAA6B,GAC1BzB,GADHG,eACGA,mBAEVA,KAAK4O,QAAUtN,EACftB,KAAK4E,GAAK5E,KAAK4O,QAAQhK,IAAM5E,KAAKm/C,aAClCn/C,KAAK+8C,GAAK/8C,KAAKo/C,iBAKPD,aACR,OAAOE,GAA4Br/C,KAAK4O,SAGnC0wC,UAAUh+C,EAAgBzB,GAC/B,OAAOG,KAAKu/C,OAASv/C,KAAKu/C,OAAS,GAG9BC,UAAUl+C,GACf,OACEtB,KAAKu/C,OADHj+C,EAAQuP,IACI,CAAC,CAAEA,IAAKvP,EAAQuP,MACzBvP,EAAYgP,KACH,CAAC,CAAEA,KAAMhP,EAAQgP,OAEjB,GAGTtQ,KAAKu/C,YChDJE,SAAZ,OAAY1+C,UAAqB,KAC7B2+C,4CACA3+C,gBACAA,oCACAA,oBACAA,YACAA,cANQ0+C,GAAZ,IAAY1+C,MASA4+C,SAAZ,OAAY5+C,UAAiB,KACzB6+C,YACA7+C,wCACAA,sBACAA,kBACAA,wCACAA,gDACAA,kEACAA,0BACAA,kCACAA,0CACAA,4DACAA,kCACAA,8CACAA,kBACAA,YACAA,UACAA,YAjBQ4+C,GAAZ,IAAY5+C,MCcZ,MAAM8+C,GAAS15B,YAEfpe,cACU/H,oBAA8C,GAC/CA,eAAY,EAChB2/C,GAAkBG,mBAA8B,CAC/CC,SAAS,EACTC,cAAe,KAEhBL,GAAkBM,sBAAiC,CAClDF,SAAS,EACTC,cAAe,KAEhBL,GAAkBO,gBAA2B,CAC5CH,SAAS,EACTC,cAAe,CAAC,YAEjBL,GAAkBQ,uBAAkC,CACnDJ,SAAS,EACTC,cAAe,CAAC,YAEjBL,GAAkBS,gCAA2C,CAC5DL,SAAS,EACTC,cAAe,CAAC,YAEjBL,GAAkBU,oBAA+B,CAChDN,SAAS,EACTC,cAAe,CAAC,YAEjBL,GAAkBW,6BAAwC,CACzDP,SAAS,EACTC,cAAe,CAAC,YAEjBL,GAAkBY,mBAA8B,CAC/CR,SAAS,EACTC,cAAe,CAAC,YAEjBL,GAAkBa,QAAmB,CAAET,SAAS,EAAOC,cAAe,KACtEL,GAAkBc,gBAA2B,CAC5CV,SAAS,EACTC,cAAe,KAEhBL,GAAkBe,YAAuB,CACxCX,SAAS,EACTC,cAAe,KAEhBL,GAAkBgB,QAAmB,CAAEZ,SAAS,EAAMC,cAAe,KACrEL,GAAkBiB,UAAqB,CAAEb,SAAS,EAAMC,cAAe,KAG1Ea,+BACEv/C,EACAzB,EACAC,GAEA,IAAIM,GAAyB,EAC7B,OAAIN,GAAuB,QAAZA,IACbM,GAAyB,IAG3BkB,EAAoBA,GAAqB,IACvB88B,aACc,IAA9B98B,EAAkB88B,QACdh+B,EACAkB,EAAkB88B,QACxB98B,EAAkBw/C,cACe,IAA/Bx/C,EAAkBw/C,SACd1gD,EACAkB,EAAkBw/C,SACxBx/C,EAAkBy/C,aAAelhD,EAEjCyB,EAAkB0/C,oBAAqB,EACnC1/C,EAAkB88B,UAAY98B,EAAkB2/C,aAAe3/C,EAAkB4/C,YAChF5/C,EAAkB6/C,cAAgB7/C,EAAkBuB,QAAUvB,EAAkB8/C,gBACnF9/C,EAAkB0/C,oBAAqB,GAElC1/C,EAGF+/C,YACL//C,EACAzB,EACAC,EACAM,EACAC,GAEA,IAAIC,EACAE,EAeAkD,EACJ,GAdElD,GADE,+BAA+B0kB,KAAKjgB,KAAKE,UAAU7D,IAKnDA,IACFlB,OACoC,IAAjCkB,EAAgBy/C,aACZz/C,EAAgBy/C,aACjB3gD,GAEJP,GAAUyB,IACZhB,EAAgBghD,MAAclhD,EAAmBP,EAAQC,EAAKyhD,aAG5DjgD,EAeF,MAAO,QAAUzB,EAAOiB,KAAK,KAAO,IAAMhB,EAAKyhD,UAd/CjgD,EAAUtB,KAAKwhD,0BACblgD,EACAlB,EACAN,GAGA4D,EADE7D,GAAUW,EACK8gD,MACfhhD,EACAN,KAAKyhD,aAAangD,EAASjB,IAGZL,KAAKyhD,aAAangD,EAASjB,GAMhD,MAAMuD,EAAqC,CACzC89C,QAAS,GACTC,UAAW,GACXC,cAAe,GACf3C,aAAc,CAAC,gBACfx4C,OAAQ/C,EACRm+C,aAAc,GACdd,aAAc3gD,GAGVyD,OAAYi+C,MAAcC,gBAAgBn+C,GAKhD,MAAO,eAJSo+C,eAAgBC,kBAAkBp+C,GAI3BF,MAHP,iDAGsB,GAAGA,MAFzB,6BAEwC,GAGlD89C,aACNngD,EACAzB,GAEA,GAAIyB,aAAwB6C,MAAO,CACjC,MAAMrE,EAAe,GACrB,SAAagG,QAAS1F,IACpBN,EAAac,KAAKZ,KAAKyhD,aAAarhD,EAASP,MAExCC,EAEP,OAAIwB,EAAaqF,eAAe,WACvB3G,KAAKkiD,aACV,CACEC,SAAU7gD,EAAa8gD,QACvBC,aAAcriD,KAAKyhD,aAAangD,EAAa4e,QAASrgB,IAExDA,GAEOyB,EAAaqF,eAAe,YAC9B3G,KAAKkiD,aACV5gD,EACAzB,QAHG,EASHqiD,aACN5gD,EACAzB,GAEA,MAAMC,EAAWwB,EAAc6gD,SACzB/hD,EAAekB,EAAc+gD,aAE7BhiD,EAAkBiB,EAAcghD,aAChChiD,EAAagB,EAAcihD,QAC3B/hD,GAAec,EAAckhD,WAC/BlhD,EAAckhD,UAEZ9+C,EAAcpC,EAAcmhD,SAAWnhD,EAAcmhD,SAAW,IAChE7+C,EAAgBtC,EAAcohD,WAChCphD,EAAcohD,WACd,IACE7+C,EAAgBvC,EAAcqhD,WAChCrhD,EAAcqhD,WACd,IAEE5+C,EAAmBzC,EAAcshD,cACjC5+C,EAAmB1C,EAAcuhD,cAEjCl+C,EAAkBrD,EAAcy/C,aAChC+B,EAAYxhD,EAAcwpC,OAC1B7jC,EAAiB3F,EAAcyhD,aAC/BC,EAAa1hD,EAAcogD,QAC7BpgD,EAAcogD,QACd,YAEEuB,EAAWjjD,KAAKkjD,sBACpB5hD,EAAc6hD,MACdtjD,EAAUA,EAAQujD,aAAU,GAExBC,EAASrjD,KAAKkjD,sBAClB5hD,EAAcgiD,IACdzjD,EAAUA,EAAQ0jD,aAAU,GAGxBC,EAAgBliD,EAAcmiD,WAEpC,IAAIC,EASJ,OARIz8C,IAEFy8C,OADgBC,MACDC,aAAa38C,EAAgB,CAC1C48C,eAAgBb,EAChBc,kBAAmBd,GAAc,eAI7BljD,EAASiH,oBACV44C,GAAkBC,KAAK74C,cAC1B,OAAOu6C,MAAc38C,EAAiBm+C,EAAWE,QAC9CrD,GAAkBY,kBAAkBx5C,cACvC,OAAOu6C,MACLjhD,EACA0D,IAAoB,KACpBC,GAAoB,WAEnB27C,GAAkBiB,SAAS75C,cAC9B,OAAOu6C,MAAkB38C,EAAiB++C,EAAUV,QACjDrD,GAAkBa,OAAOz5C,cAC5B,OAAOu6C,MAAgBjhD,EAAiB4iD,EAAUI,QAC/C1D,GAAkBG,kBAAkB/4C,cACvC,OAAOu6C,MAAiBjhD,EAAiBmjD,EAAehjD,QACrDm/C,GAAkBQ,sBAAsBp5C,cAC3C,OAAOu6C,MAAqBjhD,EAAiBmjD,QAC1C7D,GAAkBS,+BAA+Br5C,cACpD,OAAOu6C,MAA8BjhD,EAAiBmjD,QACnD7D,GAAkBe,WAAW35C,cAChC,OAAOu6C,MAAoB38C,EAAiB++C,EAAUV,QACnDrD,GAAkBc,eAAe15C,cACpC,OAAOu6C,MAAgBjhD,QACpBs/C,GAAkBU,mBAAmBt5C,cACxC,OAAOu6C,MAAkBjhD,EAAiBmjD,QACvC7D,GAAkBW,4BAA4Bv5C,cACjD,OAAOu6C,MAA2BjhD,EAAiBmjD,QAChD7D,GAAkBO,eAAen5C,cACpC,OAAOu6C,MACLjhD,EACAC,EAAaA,EAAW6F,QAAQ,UAAWvC,GAAgBF,EAC3DA,EACAE,EACAC,EACArD,QAECm/C,GAAkBM,qBAAqBl5C,cAC1C,OAAOu6C,MACLjhD,EACAmjD,EACAhjD,QAECm/C,GAAkBgB,OAAO55C,cAC5B,OAAOu6C,MAAgB38C,EAAiB++C,EAAUV,QAE/CrD,GAAkBoE,IAAIh9C,cACzB,OAAOu6C,YAAmB,KAAMlhD,QAC7Bu/C,GAAkBqE,GAAGj9C,cACxB,OAAOu6C,YAAkB,KAAMlhD,QAC5Bu/C,GAAkBsE,IAAIl9C,cACzB,OAAOu6C,YAAmB,KAAMlhD,WAGhC,QAIC8jD,8BACL5iD,EACAzB,EACAC,EAAU,GACVM,GAAQ,GAER,OAAIkB,aAAwB6C,MAC1B7C,EAAawE,QAASzF,IACpBL,KAAKmkD,eAAen+C,OAClBhG,KAAKkkD,8BACH7jD,EACAR,EACAC,EACAM,MAKNkB,EAAiBqF,eAAe,WAE9B3G,KAAKmkD,eAAen+C,OAClBhG,KAAKkkD,8BACH5iD,EAAa4e,QACbrgB,EACAyB,EAAa8gD,QALjBhiD,GAAgB,IASPkB,EAAaqF,eAAe,aACrC3G,KAAKmkD,eAAevjD,KAClBZ,KAAKokD,mBAAmB9iD,EAAczB,EAAcO,EAAON,IAI1DE,KAAKmkD,eAGPE,wBACL/iD,EACAzB,EACAC,GAEA,IACIO,EACAC,EACAE,EAHAJ,EAAyB,GAK7B,GAAIkB,GAAUzB,EAAc,CAC1B,MAAM6D,EAAWpC,EAAOuZ,KAAMjX,GAAUA,EAAMsN,OAASrR,GACvDQ,EACEqD,GAAYA,EAAS4gD,qBACjB5gD,EAAS4gD,qBACTxkD,EA8BR,OA3BIwB,GACFA,EAAOoE,IAAKhC,IACV,IAAKA,EAAM4gD,qBACT,OAEF,MAAM1gD,EAAuBF,EAAM4gD,qBAAqBv9C,eAEtDnD,IAAyB67C,GAAsBh1B,IAAI1jB,eACnDnD,IACE67C,GAAsB8E,QAAQx9C,eAChCnD,IACE67C,GAAsB+E,gBAAgBz9C,iBAExCzG,GAA2B,EAEzBsD,IAAyB67C,GAAsBh1B,IAAI1jB,gBAEnDvG,GAAkB,MAM1BH,EAAmBA,GAEfo/C,GAAsB+E,gBAElBnkD,EAAiB0G,oBAClB04C,GAAsBh1B,IACzBrqB,EAAqBJ,KAAKykD,UAC1B,WACGhF,GAAsB8E,QACzBnkD,EAAqB,EAClBu/C,GAAkBe,YAAa,CAAEX,SAAS,EAAMC,cAAe,KAC/DL,GAAkBgB,QAAS,CAAEZ,SAAS,EAAMC,cAAe,KAE9D,WACGP,GAAsB+E,gBACzBpkD,EAAqB,EAClBu/C,GAAkBG,mBAAoB,CACrCC,SAAS,EACTC,cAAe,KAEhBL,GAAkBM,sBAAuB,CACxCF,SAAS,EACTC,cAAe,KAEhBL,GAAkBe,YAAa,CAAEX,SAAS,EAAMC,cAAe,KAC/DL,GAAkBgB,QAAS,CAAEZ,SAAS,EAAMC,cAAe,KAE9D,WACGP,GAAsBiF,MACzBtkD,EAAqB,EAClBu/C,GAAkBG,mBAAoB,CACrCC,SAAS,EACTC,cAAe,KAEhBL,GAAkBM,sBAAuB,CACxCF,SAAS,EACTC,cAAe,KAGnB,WACGP,GAAsBkF,KACzBvkD,EAAqB,EAClBu/C,GAAkBa,QAAS,CAAET,SAAS,EAAOC,cAAe,KAE/D,WACGP,GAAsBC,qBACzBt/C,EAAqB,EAClBu/C,GAAkBG,mBAAoB,CACrCC,SAAS,EACTC,cAAe,KAEhBL,GAAkBM,sBAAuB,CACxCF,SAAS,EACTC,cAAe,KAEhBL,GAAkBQ,uBAAwB,CACzCJ,SAAS,EACTC,cAAe,CAAC,YAEjBL,GAAkBS,gCAAiC,CAClDL,SAAS,EACTC,cAAe,CAAC,YAEjBL,GAAkBU,oBAAqB,CACtCN,SAAS,EACTC,cAAe,CAAC,YAEjBL,GAAkBW,6BAA8B,CAC/CP,SAAS,EACTC,cAAe,CAAC,YAGpB,cAEA5/C,EAAqB,EAClBu/C,GAAkBG,mBAAoB,CACrCC,SAAS,EACTC,cAAe,KAEhBL,GAAkBM,sBAAuB,CACxCF,SAAS,EACTC,cAAe,KAEhBL,GAAkBe,YAAa,CAAEX,SAAS,EAAMC,cAAe,KAC/DL,GAAkBgB,QAAS,CAAEZ,SAAS,EAAMC,cAAe,KAIlE,OAAI1/C,IACDF,EAA2BsgD,WAAa,CACvCX,SAAS,EACTC,cAAe,IAEhB5/C,EAA2BugD,OAAS,CAAEZ,SAAS,EAAMC,cAAe,IACjEx/C,IACDJ,EAA2BwgD,SAAW,CACrCb,SAAS,EACTC,cAAe,MAKd5/C,EAGFgkD,mBACL9iD,EACAzB,EACAC,EAAQ,EACRM,EAAgB,MAEXkB,IACHA,EAAqB,CAAE6gD,SAAU,sBAEnC,MAAM9hD,EAAI,CACRiiD,aAAc,GACdH,SAAU,GACV3iC,OAAQ,GACRolC,SAAU37C,IACV47C,KAAM,GACN1B,MAAO,GACPG,IAAK,GACLwB,cAAe,GACflC,cAAe,GACfC,cAAe,GACfY,WAAY,GACZlB,QAAS,GACTE,SAAU,IACVC,WAAY,IACZC,WAAY,IACZH,WAAW,EACXuC,mBAAoB,GACpBC,QAAS,GACTjE,aAAc,GACdkE,SAAU,GACVlC,aAAc,GACdjY,OAAQ,GACR4W,QAAS,GACTwD,cAAe,GACfC,MAAO,GAGT,OAAOv/C,OAAOU,OACZjG,EACA,CACE6kD,gBACAC,QACApE,gBAEFz/C,GAIGkgD,0BACLlgD,EACAzB,EACAC,EACAM,GAAS,GAET,MAAMC,EAAc,GACpB,OAAIiB,aAAwB6C,OAC1B7C,EAAawE,QAASxF,IACpBD,EAAYO,KACVZ,KAAKwhD,0BACHlhD,EACAT,EACAC,EACAM,MAICC,GAEHiB,EAAaqF,eAAe,WACvBf,OAAOU,OACZ,GACA,CACE87C,QAAS9gD,EAAa8gD,QACtBliC,QAASlgB,KAAKwhD,0BACZlgD,EAAa4e,QACbrgB,EACAC,EACAM,KAIGkB,EAAaqF,eAAe,YAC9B3G,KAAKolD,oBACV9jD,EACAzB,EACAC,EACAM,QALG,EAWHglD,oBACN9jD,EACAzB,EACAC,EACAM,GAAS,GAET,MAAMC,EAAWiB,EAAmBqF,eAAe,YAC/CrF,EAAmBsjD,SACnB37C,IACE3I,EAASgB,EAAmBqF,eAAe,UAC7CrF,EAAmBke,OACnBpf,EAEEI,EAAUc,EAAmBqF,eAAe,WAC9CrF,EAAmBogD,QACnB5hD,EACAA,EAAKyhD,UACL,YAEJ,OAAO37C,OAAOU,OACZ,GACA,CACEs+C,WACAplC,OAAQlf,EACRykD,mBAAoB,cACpBrD,WAEFpgD,EACA,CAAEy/C,aAAclhD,IAIbwlD,sCACL/jD,GAEA,GAAIA,aAAoB6C,OAClB7C,EAASf,QAAU,EAAG,CACxB,IACIT,EAEAO,EAHAR,EAAoByB,EAAS,GAAG4jD,cAEhC9kD,EAAe,GAEnB,SAAS0F,QAASxF,IAChB,MAAME,EAAUoF,OAAOU,OAAO,GAAIhG,GAC5BoD,EAAQpC,EAASpB,QAAQI,GAE7BR,EADE4D,GAAS,GAAKA,EAAQpC,EAASf,OAAS,EAC5Be,EAASoC,EAAQ,GAEjBlD,SAETA,EAAQgf,cACRhf,EAAQokD,gBACRpkD,EAAQ0kD,cACf9kD,EAAaQ,KAAKJ,GAEM,IAAxBc,EAAaf,OACXF,EAAsBG,EACbX,IAAsBC,EAAYolD,gBACf,IAAxB9kD,EAAaG,OACf2K,QAAQC,IACN,oDAEEtL,EACA,MAGJQ,EAAsBuF,OAAOU,OAC3B,GACA,CAAE87C,QAASviD,EAAmBqgB,QAAS9f,IAEzCA,EAAe,CAACC,GAChBR,EAAoBC,EAAYolD,kBAI/B7kD,GASLilD,mBAAmBhkD,GACzB,GACEA,EAAU+1B,OAAO3a,MAAO5c,QAAsC,IAA5BA,EAAMylD,mBAExC,OAAOjkD,EAET,IAAIzB,EACJ,GAAIyB,EAAU+1B,QAAU/1B,EAAUkkD,QAAS,CACzC,IAAKlkD,EAAUkkD,QAAQ9oC,MAAO5c,QAAyB,IAAdA,EAAO8E,IAC9C,MAAM,IAAI6H,MACR,+CAGJ5M,EAAW0G,WAAqBjF,GAChCzB,EAASw3B,OAAOvxB,QAAShG,IACvBA,EAAMmP,MAAQnP,EAAMmP,MAAQnP,EAAMmP,MAAQnP,EAAMoR,KAChDpR,EAAMs+B,UAAUt+B,EAAMs+B,SAAUt+B,EAAMs+B,QACtCt+B,EAAMylD,kBAAoBh/C,WACxB1G,EAAS2lD,QAAQ/+C,OAAQrG,GAAMN,EAAMoJ,IAAIuK,SAASrT,EAAEwE,aAG9CtD,EAAU+1B,QAAU/1B,EAAUkkD,SACxC3lD,EAAW0G,WAAqBjF,GAChCzB,EAASw3B,OAAS,CAChB,CACEpoB,MAAO,SACPiC,KAAM,SACNq0C,kBAAmBh/C,WAAqB1G,EAAS2lD,YAIrD3lD,EAAW,CACT2lD,QAASlkD,EACT+1B,OAAQ,CACN,CACEpoB,MAAO,SACPiC,KAAM,SACNq0C,kBAAmBh/C,WACjBjF,KAINmkD,aAAc5lD,EAAS4lD,cAG3B,OAAK5lD,EAASw3B,OAAOxc,KAAM/a,GAAkBA,EAAcs+B,WACzDv+B,EAASw3B,OAAO,GAAG+G,SAAU,GAExBv+B,EAGF6lD,6BACLpkD,EACAzB,EACAC,EACAM,GAEA,MAAMC,EAAaiB,EAAQqkD,WAC3B,IAAKtlD,EACH,OAEF,MAAMC,EAAa,GACnB,IAAIE,EAA4B,GAC5BkD,EAAmC,GACvC,GAAIrD,EAAW+9B,UAAY/9B,EAAW4gD,aAAe5gD,EAAW6gD,YAAc7gD,EAAW8gD,cAAgB9gD,EAAWwC,QAC/GxC,EAAW+gD,cAAe,CAC7B,IAAIv9C,EACJ,GAAIxD,EAAW4gD,YAAa,CAC1Bp9C,EAAYxD,EAAW4gD,YACvB,MAAMl9C,EAAiB/D,KAAK4lD,qBAAqBvlD,EAAYwD,GAC7D,UAAWG,KAAaD,EACtBzD,EAAWM,KAAKoD,GAGpB,GAAI3D,EAAW6gD,WAAY,CACzBr9C,EAAYxD,EAAW6gD,WACvB,MAAMn9C,EAAqB/D,KAAK4lD,qBAAqBvlD,EAAYwD,GACjE,UAAWG,KAAaD,EACtBzD,EAAWM,KAAKoD,GAGpB,GAAI3D,EAAW8gD,aAAc,CAC3Bt9C,EAAYxD,EAAW8gD,aACvB,MAAMp9C,EAAgB/D,KAAK6lD,uBAAuBhiD,GAC5CG,EAAkBhE,KAAK4lD,qBAAqBvlD,EAAY0D,GAC9D,UAAWY,KAAaX,EACtB1D,EAAWM,KAAK+D,GAGpB,GAAItE,EAAWwC,OAAQ,CACrBgB,EAAYxD,EAAWwC,OACvB,MAAMkB,EAAgB/D,KAAK6lD,uBAAuBhiD,GAC5CG,EAAmBhE,KAAK4lD,qBAAqBvlD,EAAY0D,GAC/D,UAAWY,KAAaX,EACtB1D,EAAWM,KAAK+D,GAGpB,GAAItE,EAAW+gD,aAAc,CAC3Bv9C,EAAYxD,EAAW+gD,aACvB,MAAMr9C,EAAmB/D,KAAK4lD,qBAAqBvlD,EAAYwD,GAC/D,UAAWG,KAAaD,EACtBzD,EAAWM,KAAKoD,GAIhB1D,EAAWC,QAAU,IACvBC,EAA4BR,KAAKqhD,YACT,IAAtB/gD,EAAWC,OACPD,EAAW,GACX,CAAE8hD,QAAS,MAAOliC,QAAS5f,GAC/BR,EACAM,EACAC,EAAW0gD,eAIb1gD,EAAW+9B,SAAW/9B,EAAW6f,UACnC7f,EAAW0gD,aAAe1gD,EAAW0gD,cAAgBlhD,EAErD6D,EAAmC1D,KAAKqhD,YADrBhhD,EAAW6f,QAG5BpgB,EACAM,EACAC,EAAW0gD,aACXz/C,IAIJ,IAAIsC,EAAoBvD,EAAW2gD,mBAC/Bt9C,EACAlD,EACJ,MAAqB,QAAjBc,EAAQwD,OACVlB,EAAoB5D,KAAK8lD,yBACvBliD,EACCtC,EAAgB0qC,OAAOsR,SAGP,QAAjBh8C,EAAQwD,OACVlB,EAAoB5D,KAAK8lD,yBACvBliD,EACCtC,EAAgB0qC,OAAOiT,eAIrBr7C,EAGFiiD,uBAAuBvkD,GAC5B,SAAUkkD,QAAQ1/C,QAAQjG,IACxB,IAAKA,EAAOyoB,UAAYzoB,EAAOyhB,UAAW,CACxC,MAAMxhB,EAAWD,EAAOyhB,UAAUta,OAAO,CAAC5G,EAAMC,EAAQC,KAA+B,IAApBD,EAAO+9B,QAAoBh+B,EAAK4F,OAAO1F,GAASF,EAAM,IACrHN,EAASS,OAAS,IACpBT,EAASkF,OAAO,EAAG,GACnBlF,EAASgG,QAAQ1F,IACfP,EAAOyhB,UAAUlhB,GAAOg+B,SAAU,QAKnC98B,EAGFskD,qBAAqBtkD,EAA+BzB,GAIzD,MAAMC,GAHND,EAAYG,KAAKslD,mBACfzlD,IAE+Bw3B,OAAOxc,KACrCxa,GAAMA,EAAE+9B,SACTmnB,kBACInlD,EAAa,GACnB,SAAesF,IAAKrF,IAClB,MAAMC,EAAkB,GAClBE,EAAgBH,EAAOihB,WACxB9gB,IAGLA,EACGiG,OAAQ/C,IAAwC,IAAxBA,EAAY06B,SACpCt4B,QAASpC,GAAoBpD,EAAgBM,KAAK8C,EAAgBwc,UACtC,IAA3B5f,EAAgBC,OAClBH,EAAWQ,KAAKN,EAAgB,IACvBA,EAAgBC,OAAS,GAClCH,EAAWQ,KAAK,CACdwhD,QAAS/hD,EAAO+hD,QAChBliC,QAAS5f,OAKgB,eAA3BT,EAAU4lD,aACZnkD,EAAW2/C,YAAcphD,EACW,aAA/BA,EAAc4lD,aACnBnkD,EAAW4/C,WAAarhD,EACY,gBAA3BA,EAAU4lD,aACnBnkD,EAAW6/C,aAAethD,EACU,WAA/BA,EAAc4lD,aACnBnkD,EAAWuB,OAAShD,EACgB,iBAA3BA,EAAU4lD,eACnBnkD,EAAW8/C,aAAevhD,GAErBO,EAGF0lD,yBACLxkD,EACAzB,GAGA,IAAKyB,EAAkB,OACvB,IAAIxB,EAAgB,GACpB,OAA+B,IAA3BwB,EAAgBf,SAAmD,IAAnCV,EAAkBK,QAAQ,KAC5DJ,EAAgBwB,EAEhBzB,EAAkB8D,MAAM,KAAKmC,QAASzF,IACpCP,EAAgB,GAAGA,KAAiBwB,EAAgB6E,QAClD,UACA,SAINrG,EAAgBA,EAAcqG,QAAQ,QAAS,IAE7CrG,EAAcS,OAAS,EACnBT,EAAcqG,QAAQ,UAAW,SACjC,EAID+8C,sBAAsB5hD,EAAezB,GAC1C,OAAKyB,EAEgB,UAAVA,OACT,EACSu+C,GAAOv+C,GAAOykD,UAChBzkD,OAEP,EANOzB,OCr3BDmmD,SAAZ,OAAYjlD,UAAW,KACrBklD,YACAllD,cACAA,cACAA,oBACAA,sBACAA,sBACAA,cACAA,cACAA,sBATUilD,GAAZ,IAAYjlD,MAYAmlD,SAAZ,OAAYnlD,UAAmB,KAC7BklD,+BACAllD,uCACAA,0BACAA,gCACAA,qBACAA,8BACAA,oBACAA,mBACAA,uBATUmlD,GAAZ,IAAYnlD,MAYAolD,SAAZ,OAAYplD,UAAe,KACzBqlD,gBACArlD,iBAFUolD,GAAZ,IAAYplD,YCZCslD,GAAc,YACdC,GAAqB,IAErBC,GAA2B,WAC3BC,GAAW,IAAIvhC,OAAO,+BAajClkB,EACAO,EACAzB,EACAC,EACAM,GACA,MAAMC,EAAYU,EAAQ0lD,UACpBnmD,EAAoBomD,GAAqB3lD,OAAS,EAAWA,EAAQ0lD,UAAU/E,SACrF,IAAIlhD,EACAV,GAAcA,EAAWs+B,UAC3B59B,EAAaV,EAAWogB,SAE1B,MAAMxc,EAAkB,IAAIijD,GACtB/iD,EAAcF,EAAgB29C,YAAY7gD,EAAYc,EAAQzB,EAAMC,EAAWihD,aAAchgD,GACnG,IAAI8C,EAAeH,EAAgBgiD,6BAA6B3kD,EAASjB,EAAWihD,aAAcz/C,EAAQzB,GAEtGkE,EAAS,SACRF,IACHE,EAAS,OACTF,EAAevC,EAAOR,KAAK,KAAO,IAAMjB,EAAK0hD,WAG/ClhD,EAAUumD,UAAY9mD,EAAWkhD,mBAAqBp9C,EAAc,GAAGG,KAAUF,IACjF,IAAIG,EAAU1D,EAAkBua,KAAKioC,GAAgB,eAAXA,EAAE5xC,MAAuBpP,MAEnE,SAAU,qBAAcojB,KAAK7kB,EAAUumD,WAAa,GAAG5iD,KAAW3D,EAAUumD,YAAc5iD,EAC1FjD,EAAQ8lD,SAAWjhD,OAAOU,OAAO,GAAIvF,EAAQ8lD,SAAU,CAAEC,WAAY9iD,IACjE5D,IACF4D,GAAW,YAAWqC,MAAO8pC,aAExBnsC,EAAQmC,QAAQ,MAAO,iBAa9BpF,EACAO,EACAzB,EACAC,EACAM,EAAqB,EACrBC,GAAoC,GAEpC,MAAMC,EAAgB,QAChBE,EAAMO,EAAkBgmD,OACxBrjD,EAAY3C,EAAkB0lD,UAC9B7iD,EAAiBtC,GAASglD,GAC1BziD,EAAsBH,EAAU4H,UAAYhL,EAAgB,cAAcF,IAAe,GACzF2D,EAAWlE,GAAQwmD,GACzB,IAAIriD,EAAeN,EAAUm+C,aACzB,gBAAgBn+C,EAAUm+C,eAC1B,GACAl9C,EAAUjB,EAAU4H,QACpB,WAAW5H,EAAU4H,UACrB,gBAGJ,MAAMrE,EAAe,GADnBvD,EAAU4H,UAAYhL,EAAgB,YAAc,cACboD,EAAUu7C,eAC7C+D,EACJt/C,EAAU4H,UAAYhL,EAAgB,QAAU,cAClD,IAAI2iD,EAAM3hD,EACN,GAAG0hD,KAAoBp/C,IACvBF,EAAUsjD,YACV,GAAGhE,KAAoBt/C,EAAUsjD,cACjC,GAAGhE,KAAoBp/C,IACvBvD,IACA2D,EAAe,GACfW,EAAU,gBACVs+C,EAAMA,EAAI98C,QAAQ,QAAS,gBAG/B,MAAMk9C,EAAMxjD,EACR,WAAWkE,IACXL,EAAUg+C,QACV,WAAah+C,EAAUg+C,QACvB,WAAW39C,IAEf,IAAIy/C,EAAe,GACfE,EAAiB,GACjB5jD,IACF0jD,EAAe,gBAAgB1jD,IAC/B4jD,EAAiB,kBAAkB5jD,KAErC,MAAMmnD,EAAelmD,EAAkBmmD,aACvC,IAAK1D,GAAgByD,GAAgBA,EAAa1mD,OAAS,EAAG,CAC5D,MAAM4mD,EAAc,GACpBpmD,EAAkBmmD,aAAaphD,QAAQshD,IACrCD,EAAYvmD,KAAKwmD,EAAYl2C,QAE/BsyC,EAAe,gBAAgB2D,EAAYrmD,KAAK,QAC9C4C,EAAU2jD,oBAId,MAAMC,GAAiC,IAArB9mD,EAAIN,QAAQ,KAAc,IAAM,IAElD,IAAIqnD,EAAa,GAAG/mD,IAAM8mD,mCAA2C3iD,KAAWsC,KAChFsgD,GAAc,GAAGvjD,KAAgBq/C,KAAOJ,KAAOO,KAAgB3/C,IAE/D,IAAI2jD,EAAmB,GAAGhnD,kDAAoDF,KAAiB2G,KAC/F,UAAoB,IAAIg8C,KAAOS,IAExB,CACL,CAAExyC,KAAM,eAAgBpP,MAAOkC,GAC/B,CAAEkN,KAAM,UAAWpP,MAAO6C,GAC1B,CAAEuM,KAAM,WAAYpP,MAAOmF,GAC3B,CAAEiK,KAAM,QAASpP,MAAOmhD,GACxB,CAAE/xC,KAAM,UAAWpP,MAAOuhD,GAC1B,CAAEnyC,KAAM,eAAgBpP,MAAO0hD,GAC/B,CAAEtyC,KAAM,iBAAkBpP,MAAO4hD,GACjC,CAAExyC,KAAM,kBAAmBpP,MAfL,GAAGtB,IAAM8mD,wCAAgD3iD,IAe7BwB,QAAQ,MAAO,MACjE,CAAE+K,KAAM,aAAcpP,MAAOylD,EAAWphD,QAAQ,MAAO,MACvD,CAAE+K,KAAM,mBAAoBpP,MAAO0lD,EAAiBrhD,QAAQ,MAAO,mBAYxCpF,EAAsBO,GAC/CA,GAAuB,QAAZA,IAEbP,EAAqB0lD,UAAY1lD,EAAqBirC,QAGxD,MAAMnsC,EAAYkB,EAAqB0lD,UASvC,IAAI3mD,EACJ,OATAiB,EAAqBgmD,OACnBhmD,EAAqBgmD,QAAUhmD,EAAqB8P,IAEtDhR,EAAUyL,QAAUzL,EAAUyL,SA3JC,QA4J/BzL,EAAUwnD,kBACRxnD,EAAUwnD,mBAAqBd,GACjC1mD,EAAUmnD,YAAcnnD,EAAUmnD,aAAeV,GAG7CzmD,EAAUgiD,eACZ/hD,EAAeD,EAAUgiD,eAGvB2E,GAASthC,KAAKplB,KAAkBA,KAClCD,EAAUyL,QAAU,SAEf1F,OAAOU,OAAO,GAAIvF,eAIzBA,GAEA,MAAMO,EAAaP,EAEnB,IAAIlB,EACJ,MAAMC,EAAewB,EAAWmlD,UAAU5E,aACtCvgD,EAAWmlD,UAAU5E,kBACrB,EAEJ,OAAK/hD,EAKD2nD,GAAS3nD,IACXD,EAAc4nD,GAAS3nD,GAChB,IAAID,EAAYyB,EAAWomD,gBACzB5nD,EAAaiH,cAAcsH,MAAM,SAC1CxO,EAAc4nD,KACP,IAAI5nD,EAAW+F,+BAAMtE,EAAWomD,eAAmB,CAAEC,UAAWC,SAC9D9nD,EAAaiH,cAAcsH,MAAM,UAC1CxO,EAAc4nD,KACP,IAAI5nD,EAAW+F,+BAAMtE,EAAWomD,eAAmB,CAAEC,UAAWE,SAC9D/nD,EAAaiH,cAAcsH,MAAM,SAC1CxO,EAAc4nD,KACP,IAAI5nD,EAAW+F,+BAAMtE,EAAWomD,eAAmB,CAAEC,UAAWG,SAC9DhoD,EAAaiH,cAAcsH,MAAM,aAC1CxO,EAAc4nD,KACP,IAAI5nD,EAAYyB,EAAWomD,gBACzB5nD,EAAaiH,cAAcsH,MAAM,YAC1CxO,EAAc4nD,KACP,IAAI5nD,EAAYyB,EAAWomD,gBACzB5nD,EAAaiH,cAAcsH,MAAM,aAC1CxO,EAAc4nD,KACP,IAAI5nD,EAAYyB,EAAWomD,gBACzB5nD,EAAaiH,cAAcsH,MAAM,SAC1CxO,EAAc4nD,KACP,IAAI5nD,EAAYyB,EAAWomD,gBACzB5nD,EAAaiH,cAAcsH,MAAM,QAC1CxO,EAAc4nD,KACP,IAAI5nD,EAAYyB,EAAWomD,gBACzB5nD,EAAaiH,cAAcsH,MAAM,QAC1CxO,EAAc4nD,KACP,IAAI5nD,EAAYyB,EAAWomD,gBACzB5nD,EAAaiH,cAAcsH,MAAM,WAC1CxO,EAAckoD,KACP,IAAIloD,EAAYyB,EAAWomD,gBACzB5nD,EAAaiH,cAAcsH,MAAM,QAC1CxO,EAAc4nD,MACP,IAAI5nD,EAAYyB,EAAWomD,gBAG7B,IAAI7nD,GA1CTA,EAAc4nD,KACP,IAAI5nD,EAAYyB,EAAWomD,iCChLHM,GAwCjCjgD,YACSzG,EACGzB,GAEVggB,MAAMve,GAHCtB,eACGA,kBAZHA,iBAAkD,IAAI+I,SAAgB,GAQtE/I,iBAAkD,IAAI+I,SAAgB,GAO7E,MAAMjJ,EAAoBwB,EAAQ0qC,OAE5B5rC,EAAMN,EAAamoD,KAAO,GAChCnoD,EAAamoD,IAAM7nD,EACnBN,EAAaooD,eAAiB9nD,EAC9BN,EAAaqoD,eAAiB,OAAS/nD,EAEnCkB,EAAQ8mD,oBAAsB9mD,EAAQ8mD,mBAAqB,GAC7D7sB,YAAY,KACVv7B,KAAKypB,WACyB,IAA7BnoB,EAAQ8mD,oBAGb,IAAI/nD,EAAoBkmD,GAGxB,GAAIjlD,EAAQmlD,UAAW,CACrB,MAAM5iD,EAAawkD,GAAe/mD,EAAS,OAC3CiF,YAAsBjF,EAAQmlD,UAAW5iD,EAAW4iD,WAEpDpmD,EACEiB,EAAQmlD,UAAUY,mBAAqBhnD,EAEzCiB,EAAQulD,SAAWjhD,OAAOU,OAAO,GAAIhF,EAAQulD,SAAU,CACrDC,WAAY9mD,KAAKsoD,qCAAqChnD,KAIrDA,EAAQ4lD,cAAgD,IAAhC5lD,EAAQ4lD,aAAa3mD,OAGhDe,EAAQ4lD,aAAaphD,QAAQjC,IAC3BA,EAAY+mC,MAAQ/mC,EAAY+mC,MAC5B/mC,EAAY+mC,MACZ/mC,EAAYqN,OALlB5P,EAAQ4lD,aAAe,GASzB,MAAM5mD,EAAkBgB,EACrBqkD,WACGnlD,EAAkB,IAAImmD,GAEvBrmD,GAOHA,EAAe0gD,qBAAsB1gD,EAAe2gD,aAAe3gD,EAAe4gD,YAC7E5gD,EAAe6gD,cAAgB7gD,EAAeuC,QAAUvC,EAAe8gD,cAGxE9gD,EAAe0gD,oBAAsB1gD,EAAe4f,SAEjD5f,EADiC4f,QACpBqoC,mBACdjoD,EAAe0gD,oBAAqB,GAGtC1gD,EAAe2gD,cACjB3gD,EAAe2gD,YAAYwE,aAAe,cAExCnlD,EAAe4gD,aACjB5gD,EAAe4gD,WAAWuE,aAAe,YAEvCnlD,EAAe6gD,eACjB7gD,EAAe6gD,aAAasE,aAAe,eAEzCnlD,EAAeuC,SACjBvC,EAAeuC,OAAO4iD,aAAe,UAEnCnlD,EAAe8gD,eACjB9gD,EAAe8gD,aAAaqE,aAAe,iBA7B5CnkD,EAA2CqkD,WAAanlD,EAAgBqgD,+BACvEvgD,EACAD,EACA,OA+BFP,EAAaw9C,OAAO35C,MAAM,KAAKpD,OAAS,GACxCD,GACAA,EAAe89B,UAEflzB,QAAQC,IAAI,mCACZD,QAAQC,IACN,iCACErL,EAAaw9C,OACb,gEAEJpyC,QAAQC,IAAI,oCAIZ7J,EAAQmlD,WACRnmD,GACAA,EAAe89B,SACf99B,EAAewgD,WACdx/C,EAAQ4lD,cAAgB,IAAIzgD,OAAO5C,IAAOA,EAAG8X,QAAQpb,OAAS,GAC/DP,KAAKwoD,WAAWC,uBAAuBnnD,GAGzC,MAAMoC,EAAoBlD,EAAgBklD,6BACxCpkD,EACAjB,GAEFP,EAAa4oD,OAAShlD,EACtB1D,KAAK2oD,cAAcroD,GAAgB,IAIF,MAFQgB,OAER,EAFQA,EAENsnD,kBACF,MAHQtnD,OAGR,EAHQA,EAGNunD,aACjC7oD,KAAK8oD,cAJkCxnD,EAIYunD,YAAY,gBAvJjE,OAAO7oD,KAAK4O,QAAQo9B,wBAIpB,OAAQhsC,KAAK4O,QAAgBm6C,WACxB/oD,KAAK4O,QAAgBm6C,WACtB,uBAIJ,OAAQ/oD,KAAK4O,QAAgBo6C,+BAI7B,OAAQhpD,KAAK4O,QAAgB48B,gBACxBxrC,KAAK4O,QAAgB48B,gBACtB2a,GAAgB8C,qBAGP3nD,GACZtB,KAAK4O,QAA2C+2C,WAAarkD,mBAG9D,OAAQtB,KAAK4O,QAA2C+2C,0BAK3CrkD,GACZtB,KAAK4O,QAA4Ci6C,WAAavnD,mBAG/D,OAAQtB,KAAK4O,QAA4Ci6C,WA2H3Dp/B,UACEzpB,KAAK+8C,GAAGmM,aAAa,CAAEC,WAAY5hD,KAAKI,WAGlC2gD,qCAAqChnD,GAI3C,OAFoBolD,GAD2BplD,GACTuZ,KAAKza,GAAgB,eAAXA,EAAE8Q,MAC/CpP,MAIKs9C,iBACR,OAAO,IAAIgK,KAAiBxjD,OAAOU,OAAO,CAAC+iD,MAAO,GAAIrpD,KAAK4O,UAG7D+5C,cAAcrnD,EAA+BzB,GAAwB,GACnEG,KAAK2lD,WAAarkD,EACdzB,GACFG,KAAKspD,YAAYnhD,KAAKnI,KAAK2lD,YAI/BmD,cAAcxnD,EAA+BzB,GAAwB,GACnEG,KAAK6oD,WAAavnD,EACdzB,GACFG,KAAKupD,YAAYphD,KAAKnI,KAAK6oD,YAI/BvJ,UAAUh+C,EAAgBzB,GACxB,IAAIC,EAAS+f,MAAMy/B,YACnB,GAAIx/C,EAAOS,OAAS,QAAgB,IAAVe,KAA4B,MAAJzB,OAAI,EAAJA,EAAM2pD,OACtD,OAAO1pD,EAGT,IACIO,EADAD,GAAmB,GAGf,MAAJP,OAAI,EAAJA,EAAM0Z,QAAY,MAAJ1Z,OAAI,EAAJA,EAAMirC,UAAc,MAAJjrC,OAAI,EAAJA,EAAM4pD,aAAczpD,KAAK4O,QAAQ86C,yBACjErpD,EAAoC,UAAxBL,KAAKgsC,OAAO2d,cAA+C,IAAxB3pD,KAAKgsC,OAAO2d,QAAwB,MAAQ,MAC3FvpD,GAAmB,GAGrB,MAAME,EAAeN,KAAKgsC,OAE1B,IAAIxrC,EAAS,QACe,IAAxBF,EAAag9C,SACf98C,EAASF,EAAag9C,OAAO35C,MAAM,MAGrC,MAAMD,EAAU1D,KAAK4O,QAAQiC,IAAI1K,QAAQ,MAAO,IAC1CvC,EAAS,CACb,2BACA,cACA,mBACA,oBACA,WAAWtD,EAAaqpD,SAAW,WAErC,YAAc,IAAVroD,GACFsC,EAAOhD,KAAK,SAASU,UAEH,KAAZ,MAAJzB,OAAI,EAAJA,EAAM2pD,QACR5lD,EAAOhD,KAAK,SAASf,EAAK2pD,SAExBppD,IACFwD,EAAOhD,KAAK,SAASf,EAAK0Z,KAAK,MAC/B3V,EAAOhD,KAAK,UAAUf,EAAK0Z,KAAK,MAChC3V,EAAOhD,KAAK,QAAQf,EAAKirC,OAAOhqC,KAAK,QACrC8C,EAAOhD,KAAK,GAAGP,KAAaR,EAAK4pD,eAGnC3pD,EAASU,EAAOkF,IAAK7B,IACnB,MAAME,EAAYL,EAAQ2K,MAAM,MAAQ,IAAM,IAC9C,MAAO,CACLwC,IAAK,GAAGnN,IAAUK,IAAYH,EAAO9C,KAAK,cAAc+C,IACxDoL,MAAOzO,EAAOD,OAAS,EAAIsD,OAAQ,EACnC+lD,kBAAwB,IAAVtoD,OAAsB,EAAYA,KAI7CxB,EAGF+pD,+BCxP6B/M,EAUlC/0C,YAAYzG,EAAczB,GACtBggB,QACA7f,KAAK+8C,GAAKz7C,EAAMy7C,GAChB/8C,KAAKy8C,MAAQn7C,EACbtB,KAAK0mB,WAAaplB,EAAMsN,QAAQ0N,OAChCtc,KAAK0F,IAAM7F,EACXG,KAAK8pD,gBAAkB,IAAInD,GAGrBt+C,QAENrI,KAAK+8C,GAAGj0C,GAAG,iBAAkBxH,GAAOtB,KAAK+pD,yBAAyBzoD,IAC7DtB,KAAK0mB,WAAuC4iC,cAC7CtpD,KAAKgqD,aAAgBhqD,KAAK0mB,WAAuC4iC,YAC5DlhD,UAAU9G,GAActB,KAAKiqD,6BAA6B3oD,KAE9DtB,KAAK0mB,WAAwC6iC,cAC9CvpD,KAAKkqD,aAAgBlqD,KAAK0mB,WAAwC6iC,YAC7DnhD,UAAU9G,GAActB,KAAKmqD,6BAA6B7oD,KAEnEtB,KAAKoqD,kBAGCzhD,UACN3I,KAAK+8C,GAAGpjB,GAAG,iBAAkBr4B,GAAOtB,KAAK+pD,yBAAyBzoD,IAC9DtB,KAAKgqD,cAAgBhqD,KAAKgqD,aAAathD,cACvC1I,KAAKkqD,cAAgBlqD,KAAKkqD,aAAaxhD,cAIvC0hD,mBAECpqD,KAAK0F,KAGV1F,KAAK0F,IAAIwC,QACJK,MAAK,WACLH,UAAU,KACPpI,KAAK0F,IAAI2kD,OACJ5jD,OAAOnF,IAAK,MAAI,OAA0B,QAA1BzB,IAAM+O,QAAQ07C,oBAAY,eAAEC,QAC5C7kD,IAAIpE,IACDA,EAAMsN,QAAQ07C,aAAaC,MAAM7kD,IAAI7F,oBAMjC,IAL2D,KAAxC,QAAfC,IAAKqnB,kBAAU,eAAEjnB,QAAQy9C,GAAiB6M,YAC1ClpD,EAAMy7C,GAAGtnC,IAAI,WAAanU,EAAMslB,SAAU,GAC1CtlB,EAAMy7C,GAAGtnC,IAAI,WAAanU,EAAMslB,SAAU,GAC1CtlB,EAAMslB,QAAUtlB,EAAMslB,UAEiC,KAAxC,QAAfxmB,IAAK+mB,kBAAU,eAAEjnB,QAAQy9C,GAAiBC,UAAiB,CAC3D,MAAMh6C,EAActC,EAAMy7C,GAAGtzC,IAAI,WACjCnI,EAAMy7C,GAAGtnC,IAAI,UAAW,GAAG,GAC3BnU,EAAMy7C,GAAGtnC,IAAI,UAAW7R,GAAa,GACrCtC,EAAMmpD,QAAUnpD,EAAMmpD,QAE1B,IAAiE,KAA9C,QAAfpqD,IAAK8mB,kBAAU,eAAEjnB,QAAQy9C,GAAiB+M,gBAAuB,CACjE,MAAM9mD,EAAoBtC,EAAMy7C,GAAGtzC,IAAI,iBACvCnI,EAAMy7C,GAAGtnC,IAAI,gBAAiB,GAAG,GACjCnU,EAAMy7C,GAAGtnC,IAAI,gBAAiB7R,GAAmB,GACjDtC,EAAMqpD,cAAgBrpD,EAAMqpD,cAEhC,IAAiE,KAA9C,QAAfrqD,IAAK6mB,kBAAU,eAAEjnB,QAAQy9C,GAAiBiN,gBAAuB,CACjE,MAAMhnD,EAAoBtC,EAAMy7C,GAAGtzC,IAAI,iBACvCnI,EAAMy7C,GAAGtnC,IAAI,gBAAiB,GAAG,GACjCnU,EAAMy7C,GAAGtnC,IAAI,gBAAiB7R,GAAmB,GACjDtC,EAAMqpD,cAAgBrpD,EAAMqpD,cAEhC,IAA8D,KAA3C,QAAfnqD,IAAK2mB,kBAAU,eAAEjnB,QAAQy9C,GAAiBkN,aAAoB,CAC9D,MAAMjnD,EAAetC,EAAMolB,WAAuC4iC,YAClE1lD,EAAYuE,KAAKvE,EAAY9B,OAEjC,IAA8D,KAA3C,QAAf4B,IAAKyjB,kBAAU,eAAEjnB,QAAQy9C,GAAiBmN,aAAoB,CAC9D,MAAMlnD,EAAetC,EAAMolB,WAAwC6iC,YACnE3lD,EAAYuE,KAAKvE,EAAY9B,cAOjDioD,yBAAyBzoD,GAC7B,MAAMzB,EAAMyB,EAAY2E,IAClBnG,EAAwBwB,EAAY8lB,OAAO2jC,gBAC3C3qD,EAAWN,EAAsBD,GAEvC,IAA8E,IAA1E,CAAC,UAAW,UAAW,gBAAiB,iBAAiBK,QAAQL,GACjE,OAEJ,MAAMQ,EAAeP,EAAsBwqD,aAC3C,IAAKjqD,EACD,OAEJ,MAAMC,EAAkBD,EAAa2qD,OAC/BxqD,EAAeH,EAAakqD,MAGlC,GAFsB/pD,EAEH,CAEf,MAAMoD,GAAS,EACfpD,EAAakF,IAAI7B,KACRA,EAAKsjB,aAA+C,IAAjCtjB,EAAKsjB,WAAWjnB,QAAQL,IAGhDgE,EAAKonD,UAAUvlD,IAAI3B,IACf,MAAMC,EAAehE,KAAK0F,IAAI2kD,OAAOxvC,KAAKlW,IAAK,MAAI,OAA0B,QAA1Bm+C,IAAMl0C,QAAQ07C,oBAAY,eAAEU,UAAWjnD,IACtFC,IACAA,EAAa+4C,GAAGtnC,IAAI5V,EAAKO,EAAUwD,GACvB,YAAR/D,GACAmE,EAAaknD,SAAS/iD,KAAK/H,YAKxC,CAEH,MAAMwD,GAAS,EACf5D,KAAK0F,IAAI2kD,OAAO3kD,IAAI7B,WACc,QAA1BE,IAAM6K,QAAQ07C,oBAAY,eAAEC,QAC5B1mD,EAAM+K,QAAQ07C,aAAaC,MAAM7kD,IAAI1B,IAC7BA,EAAEmjB,aAA4C,IAA9BnjB,EAAEmjB,WAAWjnB,QAAQL,KAChB,IAArBmE,EAAEmnD,iBAAqE,IAAzCnnD,EAAEinD,UAAU/qD,QAAQI,KAClDuD,EAAMk5C,GAAGtnC,IAAI5V,EAAKO,EAAUwD,GAChB,YAAR/D,GACAgE,EAAMqnD,SAAS/iD,KAAK/H,SASxC6pD,6BAA6B3oD,GACjC,MAAMzB,EAAeG,KAAK+8C,GAAGgO,gBAAgBT,aAC7C,IAAKzqD,EACD,OAEJ,MAAMC,EAAkBD,EAAamrD,OAC/B5qD,EAAeP,EAAa0qD,MACZnqD,EAGlBA,EAAasF,IAAIpF,KACRA,EAAK6mB,aAAuE,IAAzD7mB,EAAK6mB,WAAWjnB,QAAQy9C,GAAiBkN,aAGjEvqD,EAAK2qD,UAAUvlD,IAAIlF,IACf,MAAMkD,EAAe1D,KAAK0F,IAAI2kD,OAAOxvC,KAAKjX,IAAK,MAAI,OAA0B,QAA1BC,IAAM+K,QAAQ07C,oBAAY,eAAEU,UAAWxqD,IAC1F,GAAIkD,EAAc,CACd,MAAME,EAAYF,EAAaq5C,GAAGgO,gBAAgBxN,cAAcz4C,KAKhE,GAJCpB,EAAagjB,WAAuCiiC,cAAcrnD,GAAY,GAC7D,QAAdsC,GACAF,EAAaq5C,GAAGqO,YAAY3hC,UAEd,QAAd7lB,EAAqB,CACrB,IAAIC,EAC+C,QAA/C7D,KAAK+8C,GAAGgO,gBAAgBxN,cAAcz4C,KACtCjB,EAAmB7D,KAAK8pD,gBAAgBpE,6BACpC1lD,KAAKy8C,MAAM/1B,WAAW9X,QACrB5O,KAAK0mB,WAAW9X,QAAgBy4C,uBACjC,EACArnD,KAAK0F,IAAI2lD,eAAeC,mBAE0B,QAA/CtrD,KAAK+8C,GAAGgO,gBAAgBxN,cAAcz4C,OAC7CjB,EAAoB7D,KAAK0mB,WAA6Bq2B,GAAGwO,YAAY7C,QAExEhlD,EAAagjB,WAA6Bq2B,GAAGmM,aAAa,CAAER,OAAQ7kD,UAOrF7D,KAAK0F,IAAI2kD,OAAO3kD,IAAIpF,WACc,QAA1BE,IAAMoO,QAAQ07C,oBAAY,eAAEC,QAC5BjqD,EAAMsO,QAAQ07C,aAAaC,MAAM7kD,IAAIhC,IACjC,GAAIA,EAAEyjB,aAAoE,IAAtDzjB,EAAEyjB,WAAWjnB,QAAQy9C,GAAiBkN,cACjC,IAArBnnD,EAAEynD,iBAAqE,IAAzCznD,EAAEunD,UAAU/qD,QAAQJ,GAAyB,CAC3E,MAAM8D,EAAYtD,EAAMy8C,GAAGgO,gBAAgBxN,cAAcz4C,KAKzD,GAJkB,QAAdlB,IACCtD,EAAMomB,WAAuCiiC,cAAcrnD,GAAY,GACxEhB,EAAMy8C,GAAGqO,YAAY3hC,WAEP,QAAd7lB,EAAqB,CACrB,IAAIC,EAC+C,QAA/C7D,KAAK+8C,GAAGgO,gBAAgBxN,cAAcz4C,KACtCjB,EAAmB7D,KAAK8pD,gBAAgBpE,6BACpCplD,EAAMomB,WAAW9X,QAChB5O,KAAK0mB,WAAW9X,QAAgBy4C,uBACjC,EACArnD,KAAK0F,IAAI2lD,eAAeC,mBAG0B,QAA/CtrD,KAAK+8C,GAAGgO,gBAAgBxN,cAAcz4C,OAC7CjB,EAAoB7D,KAAK0mB,WAA6Bq2B,GAAGwO,YAAY7C,QAExEpoD,EAAMomB,WAA6Bq2B,GAAGmM,aAAa,CAAER,OAAQ7kD,IAC7DvD,EAAMomB,WAAuCiiC,cAAcrnD,GAAY,SAS5F6oD,6BAA6B7oD,GACjC,MAAMzB,EAAeG,KAAK+8C,GAAGgO,gBAAgBT,aAC7C,IAAKzqD,EACD,OAEJ,MAAMC,EAAkBD,EAAamrD,OAC/B5qD,EAAeP,EAAa0qD,MACZnqD,EAGlBA,EAAasF,IAAIpF,KACRA,EAAK6mB,aAAuE,IAAzD7mB,EAAK6mB,WAAWjnB,QAAQy9C,GAAiBmN,aAGjExqD,EAAK2qD,UAAUvlD,IAAIlF,IACf,MAAMkD,EAAa1D,KAAK0F,IAAI2kD,OAAOxvC,KAAKjX,UACpC,SAAM8iB,sBAAsB8kC,KACF,QAA1B3nD,IAAM+K,QAAQ07C,oBAAY,eAAEU,UAAWxqD,IAC3C,GAAIkD,EAAY,CACXA,EAAWgjB,WAAwCoiC,cAAcxnD,GAAY,GAC9E,MAAMsC,EAAqB5D,KAAK+8C,GAAGqO,YAAiCG,YAAYE,KAC/E/nD,EAAWgjB,WAA6Bq2B,GAAGmM,aAAa,CAAEuC,KAAM7nD,SAM7E5D,KAAK0F,IAAI2kD,OACJ5jD,OAAOnG,GAASA,EAAMomB,sBAAsB8kC,IAC5C9lD,IAAIpF,WACmC,QAAhCE,IAAYoO,QAAQ07C,oBAAY,eAAEC,QAClCjqD,EAAYsO,QAAQ07C,aAAaC,MAAM7kD,IAAIhC,IACvC,GAAIA,EAAEyjB,aAAoE,IAAtDzjB,EAAEyjB,WAAWjnB,QAAQy9C,GAAiBmN,cACjC,IAArBpnD,EAAEynD,iBAAqE,IAAzCznD,EAAEunD,UAAU/qD,QAAQJ,GAAyB,CAC3E,MAAM8D,EAAqB5D,KAAK+8C,GAAGqO,YAAiCG,YAAYE,KAC/EnrD,EAAYomB,WAA6Bq2B,GAAGmM,aAAa,CAAEuC,KAAM7nD,IACjEtD,EAAYomB,WAAwCoiC,cAAcxnD,GAAY,0BCnQ9Ew7C,EAO/B/0C,YAAYzG,GACVue,QANM7f,YAAS,EACTA,aAAU,EAMhBA,KAAKsc,OAAShb,EAAMsN,QAAQ0N,OAAOygC,GACnC/8C,KAAK4E,GAAKqE,IAGFZ,QACRrI,KAAKsc,OAAOxT,GAAG,gBAAiBxH,GAAKtB,KAAKg9C,gBAAgB17C,IAC1DtB,KAAKsc,OAAOxT,GAAG,cAAexH,GAAKtB,KAAKi9C,cAAc37C,IACtDtB,KAAKsc,OAAOxT,GAAG,gBAAiBxH,GAAKtB,KAAKi9C,cAAc37C,IAGhDqH,UACR3I,KAAKsc,OAAOqd,GAAG,gBAAiBr4B,GAAKtB,KAAKg9C,gBAAgB17C,IAC1DtB,KAAKsc,OAAOqd,GAAG,cAAer4B,GAAKtB,KAAKi9C,cAAc37C,IACtDtB,KAAKsc,OAAOqd,GAAG,gBAAiBr4B,GAAKtB,KAAKi9C,cAAc37C,IAGlD07C,gBAAgB17C,GAIjBA,EAAMoqD,KAAKvO,eACd77C,EAAMoqD,KAAKvO,aAAe,IAE5B77C,EAAMoqD,KAAKvO,aAAav8C,KAAKZ,KAAK4E,IAElC5E,KAAKs4C,SAAW,EAChBt4C,KAAK4I,OAASd,UAGRm1C,cAAc37C,GACpB,IAAKA,EAAMoqD,KAAKvO,aACd,OAGF,MAAMt9C,EAAeyB,EAAMoqD,KAAKvO,aAAaj9C,QAAQF,KAAK4E,IAC1D,GAAI/E,EAAe,EACjB,OAGFyB,EAAMoqD,KAAKvO,aAAan4C,OAAOnF,EAAc,GAE7CG,KAAKo9C,QAAU,EAEf,MAAMt9C,EAAUE,KAAKs4C,QACjBt4C,KAAKo9C,QAAUt9C,GACbA,IAAYE,KAAKs4C,UACnBt4C,KAAK4I,OAASd,OACd9H,KAAKo9C,OAASp9C,KAAKs4C,QAAU,qBCvDE0P,GAG3B5I,iBACR,MAAM99C,EAAgB,CACpBymB,OAAQ/nB,KAAK2rD,2BAA2B3rD,KAAK4O,UAG/C,OAAO,IAAIg9C,KAAehmD,OAAOU,OAAOhF,EAAetB,KAAK4O,UAGpD+8C,2BAA2BrqD,GACnC,GAAIA,EAAQymB,OACV,OAAOzmB,EAAQymB,OAEjB,IAAIloB,EACJ,MAAMC,EAAawB,EAAQuqD,WAC3B,GAAK/rD,GACW,GAEdD,EAAcisD,GAAShsD,QACH,IAAhBD,EACF,MAAM,IAAI4M,MAAM,oDAJlB5M,EAAcksD,KAQhB,MAAM3rD,EAAgBkB,EAAQomD,cAC9B,IAAIrnD,EACJ,OACEA,EADED,EACO,IAAIP,EAAYO,GAEhB,IAAIP,EAGRQ,EAGFwpD,aAASd,iBAGd,OAAQ/oD,KAAK4O,QAAgBm6C,WACxB/oD,KAAK4O,QAAgBm6C,WACtB,0BC1C+BiD,GAI3B5M,iBACR,YAAKxwC,QAAQmZ,OAAS/nB,KAAK2rD,2BAA2B3rD,KAAK4O,SAC3D5O,KAAK4O,QAAQ0N,OAASuD,MAAMu/B,iBACrB,IAAI6M,KAAgBjsD,KAAK4O,SAGxBuwC,aACR,OAAOl2C,IAGF4gD,+BChB0B/M,EAOjC/0C,YAAYzG,GACVue,QANM7f,YAAS,EACTA,aAAU,EAMhBA,KAAKy8C,MAAQn7C,EACbtB,KAAK4E,GAAKqE,IAGFZ,QACR,IAAI/G,EAAWtB,KAAKy8C,MAAM7tC,QAAQ0N,OAAOygC,GACrC/8C,KAAKy8C,MAAM/1B,sBAAsBwlC,KACnC5qD,EAAYtB,KAAKy8C,MAAM7tC,QAAQ0N,OAAO1N,QAAgB0N,QAGpDhb,EAAS6qD,WACX7qD,EAASwH,GAAG,oBAAqBjJ,GAAKG,KAAKg9C,gBAAgBn9C,IAC3DyB,EAASwH,GAAG,kBAAmBjJ,GAAKG,KAAKi9C,cAAcp9C,IACvDyB,EAASwH,GAAG,oBAAqBjJ,GAAKG,KAAKi9C,cAAcp9C,KAKnD8I,UACR,IAAIrH,EAAWtB,KAAKy8C,MAAM7tC,QAAQ0N,OAAOygC,GACrC/8C,KAAKy8C,MAAM/1B,sBAAsBwlC,KACnC5qD,EAAYtB,KAAKy8C,MAAM7tC,QAAQ0N,OAAO1N,QAAgB0N,QAEpDhb,EAAS6qD,WACX7qD,EAASq4B,GAAG,oBAAqB95B,GAAKG,KAAKg9C,gBAAgBn9C,IAC3DyB,EAASq4B,GAAG,kBAAmB95B,GAAKG,KAAKi9C,cAAcp9C,IACvDyB,EAASq4B,GAAG,oBAAqB95B,GAAKG,KAAKi9C,cAAcp9C,KAIrDm9C,gBAAgB17C,GACtBtB,KAAKs4C,SAAW,EAChBt4C,KAAK4I,OAASd,UAGRm1C,cAAc37C,GACpBtB,KAAKo9C,QAAU,EAEf,MAAMv9C,EAAUG,KAAKs4C,QACjBt4C,KAAKo9C,QAAUv9C,GACbA,IAAYG,KAAKs4C,UACnBt4C,KAAK4I,OAASd,OACd9H,KAAKo9C,OAASp9C,KAAKs4C,QAAU,gBCnCnCv3C,EACAO,EACAzB,EAA8B,IAO9B,IAAIC,EACAM,EACAC,EACAC,EACAE,EACAkD,EACAE,EACAC,EACAE,EACAC,EACAW,EACAm+C,EACA77C,EACA+7C,EACAC,EACAI,EACAG,EACAE,EACAuD,EAIAM,EACJ,MAAMC,EAAkB,IAAIviC,OAHF,wBAG4B,KAEhDkiC,EAAc,mCACdC,EAAgB,GAAGD,WAAqBA,IACxCiF,EAAc,IAAInnC,OAAO,IAAImiC,KAAkB,KAE/CiF,EACJ,yHACIC,EAAkB,GAAGD,uBAA8BA,iBACnDE,EAAW,IAAItnC,OAAO,IAAIqnC,KAAoB,MAE9CE,EACJ,gEACIC,EAAW,IAAIxnC,OAAO,IAAIunC,IAAc,MAExCE,EACJ,gEACIC,EAAW,IAAI1nC,OAAO,IAAIynC,IAAc,MAExCE,EAAU,8BACVC,EAAY,GAAGD,gBAAsBA,IACrCE,EAAU,IAAI7nC,OAAO,IAAI4nC,IAAa,KAEtCE,EACJ,4EACIC,EAAa,GAAGD,iBAAwBA,IACxCE,EAAW,IAAIhoC,OAAO,IAAI+nC,IAAc,KAGxCE,EACJ,yQACIC,EAAY,IAAIloC,OAAO,IAAIioC,KAAgB,MAE3CE,EAAU,0BACVC,EAAY,GAAGD,WAAiBA,IAChCE,EAAU,IAAIroC,OAAO,IAAIooC,KAAc,KAE7C,IAAIE,GAAa,EAUjB,GARAxsD,EAAMA,EAAIysD,oBAAoBC,OAG9BjG,EAAoBtiC,KAAKnkB,IACtBX,EAAUmnD,GAAiBxmD,EAAI4C,MAAM,KAAK+B,IAAIgoD,GAAKA,EAAED,QAEtDrtD,EAAWW,EAETqrD,EAAYlnC,KAAK9kB,IACnB,CAEEC,EACAqjD,EAHF,CAKE7/C,EACAE,EACAkjD,EAPF,CASEjE,GACE5iD,EAASiO,MAAM+4C,GAEnB1D,EAAMiK,YAAYttD,GAA4B,IAAMqjD,EAAM,IAAM7/C,GAChEojD,EAAM0G,YAAY5pD,GAA4B,IAAMkjD,EAAM,IAAMjE,WACvDuJ,EAASrnC,KAAK9kB,IACvB,CAEEE,EACAE,EACAkD,EACAE,EACAI,EACAW,EACAm+C,EACA77C,GACE7G,EAASiO,MAAMi+C,IAEE,MAAjB1oD,GAAyC,MAAjBA,KAC1BtD,EAAa,CAAC0D,EAAaA,EAAa1D,GAAa,GACrDE,EAAa,CAACmE,EAAaA,EAAanE,GAAa,GACrDkD,EAAa,CAACo/C,EAAaA,EAAap/C,GAAa,GACrDE,EAAe,CAACqD,EAAeA,EAAerD,GAAe,IAG/D8/C,EAAMkK,GACJD,WAAWrtD,GACXqtD,WAAWntD,GACXmtD,WAAWjqD,GACXE,GAEFqjD,EAAM2G,GACJD,WAAW3pD,GACX2pD,WAAWhpD,GACXgpD,WAAW7K,GACX77C,WAEOwlD,EAASvnC,KAAK9kB,GAAW,CAClCmtD,GAAa,GACb,EAAKtK,EAAMS,EAAKuD,GAAO7mD,EAASiO,MAAMm+C,GACtC,MAAMkB,EAAUziC,OAAOg4B,GAAQ,GAAK,YAAYA,IAAS,WAAWA,KACnES,EAAKuD,GAAO4G,MACX,CAACF,WAAWjK,GAAMiK,WAAW1G,IAC7ByG,EACA,qBAEOf,EAASznC,KAAK9kB,GAAW,CAClCmtD,GAAa,GACb,EAAKtK,EAAMS,EAAKuD,GAAO7mD,EAASiO,MAAMq+C,GACtC,MAAMgB,EACJziC,OAAOg4B,GAAQ,GAAK,YAAYA,IAAS,WAAW,GAAKh4B,OAAOg4B,MACjES,EAAKuD,GAAO4G,MACX,CAACF,WAAWjK,GAAMiK,WAAW1G,IAC7ByG,EACA,qBAEOT,EAAS/nC,KAAK9kB,IACvB,CAEEC,EACAC,EACAE,EACAkD,EACAG,EACAE,EACAC,EACAW,EACAm+C,EACAE,GACE5iD,EAASiO,MAAM2+C,GAEnBtJ,EAAMkK,GACJD,YAAYttD,GAA4B,IAAMC,GAC9CqtD,WAAWntD,GACXmtD,WAAWjqD,GACXE,GAEFqjD,EAAM2G,GACJD,YAAY5pD,GAA4B,IAAMC,GAC9C2pD,WAAWhpD,GACXgpD,WAAW7K,GACX77C,WAEO6lD,EAAQ5nC,KAAK9kB,IACtB,CAEEC,EACAC,EACAuD,EACAE,EACAC,EACAg/C,GACE5iD,EAASiO,MAAMw+C,GAEnBnJ,EAAMkK,GACJD,YAAYttD,GAA4B,IAAMC,GAC9CqtD,WAAWntD,GACXmtD,WAAWjqD,GACXE,GAEFqjD,EAAM2G,GACJD,YAAY5pD,GAA4B,IAAMC,GAC9C2pD,WAAWhpD,GACXgpD,WAAW7K,GACX77C,WAEOkmD,EAAUjoC,KAAK9kB,IACxB,CAEE2D,EACAC,EACAW,EACAm+C,EALF,CAOE77C,EACA5G,EACAC,EACAE,EACAkD,EAXF,CAaEE,EACAy/C,EACAG,GACEpjD,EAASiO,MAAM6+C,GAGdtpD,IACHA,EAAe,KAKf8/C,EADFljD,GAAkBA,EAAWD,OAAS,EAC9BotD,YACHttD,GAA4B,IAAMC,EAAa,IAAME,GAGlDotD,GACJD,WAAWrtD,GACXqtD,WAAWntD,GACXmtD,WAAWjqD,GACXE,GAKFqjD,EADFtiD,GAAkBA,EAAWpE,OAAS,EAC9BotD,YACH5pD,GAA4B,IAAMC,EAAa,IAAMW,GAGlDipD,GACJD,WAAW3pD,GACX2pD,WAAWhpD,GACXgpD,WAAW7K,GACX77C,YAGKqmD,EAAQpoC,KAAK9kB,GAYtB,MAAO,CACL0tD,YAAQ,EACR9+C,QAAS,GACT++C,YAAQ,EACRC,UAAM,GAfRT,GAAa,GACb,CAAG7J,EAAK7/C,EAAYojD,EAAKjE,GAAc5iD,EAASiO,MAAMg/C,GAElDxpD,IACF6/C,EAAMiK,WAAWjK,EAAM,IAAM7/C,IAG3Bm/C,IACFiE,EAAM0G,WAAW1G,EAAM,IAAMjE,IA8BjC,GAnBInjD,EAAKouD,UAAYV,IAEf7J,EAAM,GAAKuD,EAAM,IACfvD,EAAMuD,EACRvD,GAAOA,EAEPuD,GAAOA,GAKPvD,EAAMuD,IACRvD,EAAM,CAACuD,EAAMA,EAAMvD,GAAM,KAI7B5jD,EAAS,CAACmrB,OAAOy4B,GAAMz4B,OAAOg8B,SAIT,IAAlBM,GA/PkB,SA+PaA,GAC/BznD,EAAO,GAAK,KAAOA,EAAO,IAAK,KAC/BA,EAAO,GAAK,IAAMA,EAAO,IAAK,GAC/B,CACA,MAAM4tD,EAASnG,EAAgB,QAAUA,EAAgBjmD,EACnD4sD,EAAO,YAEb,IACEpuD,EAAS+tD,MAAiB/tD,EAAQ4tD,EAAQQ,SACnCC,GACP,MAAO,CACLL,YAAQ,EACR9+C,QAAS,cAAgB0+C,EAAS,iBAClCK,YAAQ,EACRC,UAAM,IAIZ,OAAIzmD,KAAK6mD,IAAItuD,EAAO,KAAO,KAAOyH,KAAK6mD,IAAItuD,EAAO,KAAO,GAChD,CACLguD,SACA9+C,QAAS,GACT++C,OAAQ1K,EAAS96B,SAAS86B,EAAQ,SAAM,EACxC2K,KAAMxK,EAAOj7B,SAASi7B,EAAM,SAAM,GAG7B,CACLsK,YAAQ,EACR9+C,QAAS,8CACT++C,YAAQ,EACRC,UAAM,GAYZ,YACEjtD,EACAO,EACAzB,EACAC,GAEAwB,EAAUA,GAAW,EACrBzB,EAAUA,GAAW,EAErB,MAAMO,EAAMW,EAAU,EACtB,IAAIV,EAAKkH,KAAK6mD,IAAIrtD,GAAWO,EAAU,GAAKzB,EAAU,KAEtD,OAAIO,GAAqB,MAAdN,GAAmC,MAAdA,KAC9BO,GAAMA,GAEDA,cAsDmBU,GAE1B,OADAA,EAAQwG,KAAKE,MAAM1G,IACP,IACHA,EAAQ,IAGjBA,EAAQwG,KAAKE,MAAM1G,EAAQ,MACf,IACHA,EAAQ,KAGjBA,EAAQwG,KAAKE,MAAM1G,EAAQ,MACZ,gBAUfA,EACAO,EAAc,IAGd,OAAOP,GADgB,QACUO,eAsBPP,GAC1B,MAAMO,EAAgBP,EAAMstD,cAC5B,OACG/sD,EAAcgtD,SACdC,MAAMjtD,EAAcktD,QAAUltD,EAAcmtD,WAC5CntD,EAAcotD,qBAIU3tD,EAAyBO,EAAkB,GACtE,MAAO,CACLqtD,kBAA4B5tD,EAAM,GAAIO,GACtCqtD,kBAA4B5tD,EAAM,GAAIO,aC5UxCyG,YACSzG,EACGzB,EACAC,GAFHE,eACGA,sBACAA,uBAzHLA,sBAA2B,EAC3BA,yBAA8B,EAG9BA,uBAA4B,EAE5BA,qBAA4C,IAAI+I,SAAgB,GA2D9D/I,2BAEL,IAAI+I,KAAgB,GAmCf/I,cAAqC,IAAI+I,SAAgB,GAKzD/I,mBAAkCqc,MAAc,CACvDrc,KAAK4uD,sBACL5uD,KAAKkrD,WACJ3iD,QAAKsmD,KAAKzuD,GAA8BA,EAAM,IAAMA,EAAM,KAa3DJ,KAAK0mB,WAAaplB,EAAQgb,OAE1Btc,KAAK+8C,GAAK/8C,KAAK8uD,qBACQ,IAAnBxtD,EAAQytD,SACV/uD,KAAK+uD,OAASztD,EAAQytD,QAGpBztD,EAAQ0tD,gBAAiC,IAApB1tD,EAAQslB,UAC/BtlB,EAAQslB,SAAU,GAGpB5mB,KAAKivD,cAAgB3tD,EAAQ2tD,eAAiBC,GAAuBjkC,OAAO3pB,EAAQ6tD,gBACpFnvD,KAAK2qD,cAAgBrpD,EAAQqpD,eAAiBuE,GAAuBjkC,OAAO3pB,EAAQ8tD,gBAEpFpvD,KAAK4mB,aAA8B,IAApBtlB,EAAQslB,SAA+BtlB,EAAQslB,QAC9D5mB,KAAKyqD,aAA8B,IAApBnpD,EAAQmpD,QAAwB,EAAInpD,EAAQmpD,QAGzDnpD,EAAQ+tD,gBACP/tD,EAAQ+tD,cAAcx+C,KAAOvP,EAAQ+tD,cAAc/+C,QAEpDtQ,KAAKu/C,OAASv/C,KAAK0mB,WAAW84B,UAAUl+C,EAAQ+tD,gBAGlDrvD,KAAKsvD,iBAAkBhuD,EAAQ+tD,gBAC3B/tD,EAAQ+tD,cAAcrhC,WACpB1sB,EAAQ+tD,cAAcrhC,UAI5BhuB,KAAK+8C,GAAGtnC,IAAI,SAAUzV,MAAM,4BAzI5B,OAAOA,KAAK4O,QAAQ2gD,qBAAsB,WAI1C,OAAOvvD,KAAK4O,QAAQhK,IAAM5E,KAAK0mB,WAAW9hB,eAI1C,OAAO5E,KAAK4O,QAAQg8B,kBAIpB,OAAO5qC,KAAK4O,QAAQK,gBAGZ3N,GACRtB,KAAK4O,QAAQK,MAAQ3N,eAIrB,OAAOtB,KAAK+8C,GAAGyS,uBAGNluD,GACTtB,KAAK+8C,GAAG0S,UAAUnuD,mBAIlB,OAAOtB,KAAK4O,QAAQogD,wBAGR1tD,GACZtB,KAAK4O,QAAQogD,UAAY1tD,gBAIzB,OAAOtB,KAAK+8C,GAAGtzC,IAAI,uBAGTnI,GACVtB,KAAK+8C,GAAG2S,WAAWpuD,4BAGIA,GACvBtB,KAAK4uD,sBAAsBzmD,KAAK7G,8BAGhC,OAAOtB,KAAK4uD,sBAAsB9sD,wBAMlBR,GAChBtB,KAAK+8C,GAAG4S,iBAAiBruD,GAAS,KAClCtB,KAAK4vD,+CAGL,OAAO5vD,KAAK+8C,GAAG8S,qCAGCvuD,GAChBtB,KAAK+8C,GAAG+S,iBAAiBxuD,GAAS,GAClCtB,KAAK4vD,+CAGL,OAAO5vD,KAAK+8C,GAAGgT,+BAGLzuD,WACVtB,KAAK+8C,GAAGiT,WAAW1uD,GACnBtB,KAAKkrD,SAAS/iD,KAAK7G,IACdtB,KAAKiwD,gBAAgBnuD,OAASR,GACjCtB,KAAKiwD,gBAAgB9nD,KAAK7G,IAEZ,QAAZzB,OAAK+O,eAAO,eAAEshD,WAAY5uD,IAChB,QAAZxB,OAAK8O,eAAO,SAAEshD,SACXzpD,OAAOrG,IAAC,MAAI,OAAS,QAATC,IAAEuO,eAAO,eAAEuhD,4BACvBzqD,IAAItF,GACHJ,KAAKowD,YAAYhwD,mBAKvB,OAAOJ,KAAKkrD,SAASppD,sBAKrB,OAAO9B,KAAK4mB,SAAW5mB,KAAKqwD,2CAQ5B,OAAwC,IAAjCrwD,KAAK4O,QAAQ0hD,gBA6CtBC,OAAOjvD,GACLtB,KAAK0F,IAAMpE,EAEXtB,KAAKwwD,2BACU,IAAflvD,GACEtB,KAAKywD,oBACLzwD,KAAK0wD,iBAAmB,IAAIC,GAAiB3wD,KAAMA,KAAK0F,KACxD1F,KAAK0wD,iBAAiBtoD,UAAU,QAChCpI,KAAK4wD,iBAAmB5wD,KAAKiwD,gBAAgB7nD,UAAU,KACjDpI,KAAK4O,QAAQshD,UAAYlwD,KAAK4mB,SAChC5mB,KAAK4O,QAAQshD,SAASxqD,IAAI7F,IACxBG,KAAKowD,YAAYvwD,QAKvBG,KAAK0wD,iBAAiBhoD,cAIlB0nD,YAAY9uD,IACbtB,KAAK+Q,iBAGVzP,EAAQ2N,MAAQ3N,EAAQ2N,MACxB3N,EAAQgO,KAAOhO,EAAQgO,KACvBtP,KAAK+Q,eAAe/B,QAAQ1N,IAGtBmvD,oBACNzwD,KAAK6wD,aAAe7wD,KAAK0F,IAAI2lD,eAAeyF,YAAY1oD,UAAU,IAChEpI,KAAK4vD,4BAIDY,2BACoB,IAAtBxwD,KAAK6wD,eACP7wD,KAAK6wD,aAAanoD,cAClB1I,KAAK6wD,kBAAe,GAIhBjB,2BACN,QAAiB,IAAb5vD,KAAK0F,IAAmB,CAC1B,MAAMpE,EAAatB,KAAK0F,IAAI2lD,eAAe0F,gBAErCjxD,OAAuC,IAAvBE,KAAKivD,cAA8B,IAAWjvD,KAAKivD,cACzEjvD,KAAKqwD,qBAAuB/uD,GAFNtB,KAAK2qD,eAEgCrpD,GAAcxB,OAEzEE,KAAKqwD,sBAAuB,oBC3MDW,GAoB/BjpD,YACEzG,EACOzB,EACAC,EACCM,EACAC,GAERwf,MAAMve,EAASzB,EAAgBC,GALxBE,sBACAA,uBACCA,yBACAA,oBAGRA,KAAKygB,QAAU,IAAIwwC,GAAcjxD,MACjCA,KAAKkI,QAAUlI,KAAKygB,QAAQvY,wBAhB5B,OAAkC,IAA3BlI,KAAK4O,QAAQsiD,UAAcC,iBAIlC,OAAmC,IAA5BnxD,KAAK4O,QAAQuiD,WAeZrC,gBACR,MAAMxtD,EAAYsE,OAAOU,OAAO,GAAItG,KAAK4O,QAAS,CAChD0N,OAAQtc,KAAK4O,QAAQ0N,OAAOygC,KAG1B/8C,KAAK4O,QAAQwiD,WACfpxD,KAAK0mB,WAAWq2B,GAAGj0C,GACjB,cACA,SAASzI,GACPL,KAAKqxD,MAAMhxD,EAAEg+C,WACbiT,KAAKtxD,OAIPA,KAAK4O,QAAQ2iD,cACfvxD,KAAKwxD,mBAAmBxxD,KAAK4O,QAAQ2iD,cAGvC,MAAM1xD,EAAS,IAAI4xD,KAAcnwD,GAC3BxB,EAAeD,EAAOurD,YACtBhrD,EAAMN,EAAaqsD,SACzB,GAAI/rD,EAAK,CACP,IAAIC,EACJ,MAAMC,EAAagB,EAAUi8C,cAE3Bl9C,EADuB,SAAX,MAAVC,OAAU,EAAVA,EAAYwE,QAAmBxE,EAAW0rC,QAAU1rC,EAAWmmD,WACxD,CAACjmD,EAAQkD,EAAYE,EAAMC,EAASE,KAC3C/D,KAAK0xD,gBACH5xD,EACAQ,EACAN,KAAK2xD,gBACLnxD,EACAkD,EACAE,EACAC,EACAE,IAIK,CAACvD,EAAQkD,EAAYE,EAAMC,EAASE,KAC3C/D,KAAK4xD,aACH9xD,EACAM,EACAJ,KAAK2xD,gBACLnxD,EACAkD,EACAE,EACAC,EACAE,IAIF1D,GACFP,EAAa+xD,UAAUxxD,GAG3B,OAAOR,EAGCwxD,MAAM/vD,GACd,MAAMzB,OAAYwG,MAAO8pC,UACnBrwC,EAAcE,KAAK+8C,GAAGj0C,GAAG,cAE/B,SAAiBzI,GACf,MAAMC,GAAgB,SAAiBD,GACjCG,EAAaH,EAAMyxD,WACnBpuD,EAAYpC,EAAQywD,cAAcroD,QAClC9F,EAAUpD,EAAWwxD,KAAOnyD,EAC5BgE,EAAeD,EAAU5D,KAAK4O,QAAQwiD,UAAUa,SAChDluD,GAAU,SAAQ,EAAIF,GACtBG,GAAWkuD,SAAalyD,KAAK4O,QAAQwiD,UAAU3gC,OAAS,OAC9DzsB,EAAS,GAAKD,EACd,IAAIY,EAAQ3E,KAAK+8C,GACdoV,mBACA1pD,KAAKzI,KAAMsB,GACXuZ,KAAM5T,GACEA,EAAOmrD,YAEbztD,IACHA,EAAQ3E,KAAK+8C,GAAGoV,mBAAmB1pD,KAAKzI,KAAMsB,GAAS,IAEzD,MAAMwhD,EAAan+C,EAAM+E,QAEzB,OAAQpI,EAAQywD,cAAcM,eACvB,QACH,GAA6B,OAA1BvP,EAAWsP,YAC+B,mBAApCtP,EAAWsP,WAAWE,UAAyB,CACtD,MAAMrrD,GACN,SAAQpD,IAAqD,EAApCi/C,EAAWsP,WAAWE,aAC/CxP,EAAWsP,WAAWG,UAAUtrD,GAChC67C,EAAWsP,WAAW1C,WAAW3rD,GAGnC,UACG,aAEC++C,EAAWsP,aACbtP,EAAWsP,WAAWI,YAAYC,SAASzuD,GAC3C8+C,EACGsP,WACAI,YACAE,YACCC,OAAQ9uD,IAC0C,EAA/Ci/C,EAAWsP,WAAWI,YAAYI,cAGvC9P,EAAW0P,cACb1P,EAAW0P,YAAYC,SAASzuD,GAChC8+C,EACG0P,YACAE,UACC,SAAQ7uD,IAAqD,EAApCi/C,EAAW0P,YAAYI,cAGtD,UACG,UAEC9P,EAAWsP,YACbtP,EAAWsP,WAAWS,UAAUJ,SAASzuD,GAEvC8+C,EAAW+P,WACb/P,EAAW+P,UAAUJ,SAASzuD,GASpC,GAJA8+C,EAAWgQ,QAAQ,IACnBxyD,EAAcyyD,SAASjQ,GACvBxiD,EAAc0yD,aAAatvD,GAEvBE,EAAU5D,KAAK4O,QAAQwiD,UAAUa,SAKnC,OAJA,QAAQnyD,QAGRE,KAAK0F,IAAIq3C,GAAGkW,SAIdjzD,KAAK0F,IAAIq3C,GAAGkW,WA7EuC3B,KAAKtxD,OAiFrDuwD,OAAOjvD,QACA,IAARA,EACFtB,KAAKygB,QAAQ/X,cAEb1I,KAAKygB,QAAQrY,UAAU,QAEzByX,MAAM0wC,OAAOjvD,GAGRuoD,YACL7pD,KAAK0mB,WAAWmjC,YAChB7pD,KAAKkzD,gBAGAA,gBACLlzD,KAAK0mB,WAAWq2B,GAAGpjB,GACjB,cACA,SAASr4B,GACHtB,KAAK4mB,SACP5mB,KAAKqxD,MAAM/vD,EAAE+8C,WAEfiT,KAAKtxD,OAIJwxD,mBAAmBlwD,GACxBtB,KAAKmzD,uBAAyBnzD,KAAK0mB,WAAWq2B,GAAGj0C,GAC/C,aACA9I,KAAKuxD,aAAaD,KAAKtxD,KAAMsB,IAG1B8xD,mBAAmB9xD,GACxB,MAAMzB,EAAOG,KAAK0mB,WAAWq2B,GAAGsW,eAAe/xD,GAC3CzB,GACFG,KAAK0F,IAAIq3C,GAAGuW,UAAUC,UAAU1zD,EAAKkyD,cAAcyB,kBAIhDjC,aAAajwD,EAAIzB,GAClBA,EAAKw+C,QAAQoV,UAAYnyD,GAAMtB,KAAK4mB,SACtC5mB,KAAKozD,mBAAmB9xD,GAIrBoyD,oBAAoBpyD,IACzB,QAAQtB,KAAKmzD,wBAgBRzB,gBACLpwD,EACAzB,EACAC,EACAM,EACAC,EACAC,EACAE,EACAkD,EACAE,GAEA,CACE,MAAMC,EAAYhE,EAAQ4mD,UACpB1iD,EAAUF,EAAU69C,QAAU,IAAIiS,KAAa,CAAEhpB,KAAM9mC,EAAU69C,UAAaphD,EAC9E0D,EAAgB6pD,MAAuBztD,EAAQE,EAAMyD,GAC3DF,EAAU69C,QAAU79C,EAAU69C,SAAWphD,EAAKihD,UAC9C,MAAM58C,EAAMivD,GACV/zD,EACAmE,EACAD,EACClE,EAA2C8lD,WAC5C/hD,GACF,IAAIk/C,EAAa,EACjB,GAA0B,UAAtBj/C,EAAUyH,SAAuBzH,EAAUmjD,YAAcV,GAAoB,CAC/E,MAAMr/C,EAAc,IACpB,KAAO67C,EAAaj/C,EAAUmjD,aAAa,CACzC,IAAIhE,EAAar+C,EAAIwB,QAAQ,SAAWtC,EAAUmjD,YAAa,SAAW//C,GAC1E+7C,EAAaA,EAAW78C,QAAQ,eAAgB,KAChD68C,GAAc,eAAiBF,EAC/BE,EAAW78C,QAAQ,MAAO,KAC1BnG,KAAK6zD,YAAYvyD,EAAcxB,EAAakE,EAAeD,EAASzD,EAAM0iD,EAAY/7C,EAAazG,EAASkD,GAC5Go/C,GAAc77C,QAGhBjH,KAAK6zD,YAAYvyD,EAAcxB,EAAakE,EAAeD,EAASzD,EAAMqE,EAAKd,EAAUmjD,YAAaxmD,EAASkD,IAmB7GmwD,YACNvyD,EACAzB,EACAC,EACAM,EACAC,EACAC,EACAE,EACAkD,EAASE,GAET,MAAMC,EAAoB7D,KAAK0mB,WAA6BotC,0BACtD/vD,EAAM,IAAIgwD,eACV/vD,EAAwBnE,EAAY66C,oBAAoBp6C,GAC9D,IAAIqE,EAAcrE,EACd0D,IACFW,EAAcX,GAEhBD,EAAIkuB,KAAK,MAAOttB,GACZ9E,GACFA,EAAY26C,aAAaz2C,EAAKY,GAEhC,MAAMm+C,EAAU,KACdxhD,EAAa0yD,mBAAmBl0D,GAChC8D,KAEFG,EAAIkwD,QAAUnR,EACd/+C,EAAI8S,OAAS,KACX,GAAmB,MAAf9S,EAAI6E,QAAkB7E,EAAImwD,aAAa3zD,OAAS,EAAG,CACrD,MAAM0G,EACJ3F,EACG6yD,YACAC,aAAarwD,EAAImwD,aAAc,CAAErQ,iBAAgBC,sBAMlDjgD,IAAsB7D,KAAK0mB,WAA6BotC,2BAExDxyD,EAAa+yD,YAAYptD,GACzBvD,EAAQuD,IAGRvD,EAAQ,SAGZo/C,KAGJ/+C,EAAIuwD,OAaE1C,aACNtwD,EACAzB,EACAC,EACAM,EACAC,EACAC,EACAE,EACAkD,GAEA,MAAME,EAAM,IAAImwD,eAChB,IAAIlwD,EAAchE,EAClB,GAAmB,mBAARA,EAAoB,CAC7B,MAAMkE,EAAwBjE,EAAY46C,oBAAoB76C,GAC1DkE,IACFF,EAAcE,QAGhBF,EAAchE,EAAIO,EAAQC,EAAYC,GAGxC,GAAIN,KAAKu0D,mBAAoC,mBAAR10D,EAAoB,CAIvD,IAAI8E,EAHWrD,EAAa6yD,YACR9B,UAGpB,MAAMvP,EAAU,KACdxhD,EAAa0yD,mBAAmB5zD,GAChCsD,KAGIuD,EAA4B,CAAEke,gBACpCnlB,KAAKu0D,kBAAkBC,aAAa/qD,IAAI5J,GAAK0I,QAAKksD,MAAUzR,GAC1DA,GAAI,QAAGA,GAAKhjD,KAAKu0D,kBAAkB9qD,IAAI5F,EAAaoD,GACjDsB,QACCmsD,SACA,OAAYzR,IACV,UACMA,OAIb76C,UAAW46C,IACR,GAAIA,EAAS,CACX,MAAMC,EAAS3hD,EAAa6yD,YACtB9Q,EAAOJ,EAAOoP,UACpB,IAAI7O,EAcJ,GAbAH,IAAasR,WAAmBtR,IAASsR,UACvCnR,EAASR,EACAK,IAASsR,UAClBnR,EAASR,EACJQ,IACHA,OAAaoR,WAAYC,gBACvB7R,EACA,qBAGKK,IAASsR,oBAClBnR,EAASR,GAEPQ,EAAQ,CACV,MAAME,EAAWT,EAAOmR,aAAa5Q,EAAQ,CAAE1Y,SAAQgZ,kBAAmBxjD,IAC1EgB,EAAa+yD,YAAY3Q,EAAUT,EAAO6R,eAAetR,IACzDhjD,EAAQkjD,QAERZ,WAKH,CACPl/C,EAAIquB,KAAM,MAAOpuB,GACjB,MAAME,EAASzC,EAAa6yD,YACxBpwD,EAAOsuD,YAAcsC,oBACvB/wD,EAAIuhB,aAAe,eAEjBrlB,GACFA,EAAY06C,aAAa52C,EAAKC,GAGhC,MAAMG,EAAU,KACd1C,EAAa0yD,mBAAmB5zD,GAChCsD,KAEFE,EAAIqwD,QAAUjwD,EACdJ,EAAIiT,OAAS,KAEX,IAAKjT,EAAIgF,QAAWhF,EAAIgF,QAAU,KAAOhF,EAAIgF,OAAS,IAAM,CAC1D,MAAMjE,EAAOZ,EAAOsuD,UACpB,IAAIvP,EAcJ,GAbAn+C,IAAagwD,WAAmBhwD,IAASgwD,UACvC7R,EAASl/C,EAAIswD,aACJvvD,IAASgwD,UAClB7R,EAASl/C,EAAImxD,YACRjS,IACHA,OAAa8R,WAAYC,gBACvBjxD,EAAIswD,aACJ,qBAGKvvD,IAASgwD,oBAClB7R,EAASl/C,EAAIoxD,UAEXlS,EAAQ,CACV,MAAM77C,EAAWlD,EAAOqwD,aAAatR,EAAQ,CAAEhY,SAAQgZ,kBAAmBxjD,IAC1EgB,EAAa+yD,YAAYptD,EAAUlD,EAAO+wD,eAAehS,IACzDtiD,EAAQyG,QAERjD,SAGFA,KAGJJ,EAAI0wD,0BCze2BtM,GAIvB5I,iBACR,OAAKp/C,KAAK4O,QAAQiC,MAChB7Q,KAAK4O,QAAQiC,IAAM,kDAEd,IAAIokD,KAAYj1D,KAAK4O,SAGvBi7C,+BCX0B7B,GAIvB5I,iBACR,OAAO,IAAI8V,KAAYl1D,KAAK4O,SAGvBi7C,+BCQ0B7B,GAajCjgD,YACSzG,EACGzB,EACFC,GAER+f,MAAMwoC,GAAe/mD,EAAS,QAJvBtB,eACGA,kBACFA,uBAdHA,+BAAoC,EASlCA,iBAAkD,IAAI+I,SAAgB,GAS7E,MAAM3I,EAAcJ,KAAK4O,QAA2C+2C,WAC9DtlD,EAAoBL,KAAK4O,QAAQ63C,UAAUY,mBAAqBd,GAChEjmD,EAAkB,IAAIqmD,GAC3B3mD,KAAK4O,QAA2C+2C,WAC/CrlD,EAAgBugD,+BAA+BzgD,EAAYC,GAE1DL,KAAK4O,QAA2C+2C,WAAWvnB,SAC3Dp+B,KAAK4O,QAA2C+2C,WAAW7E,WAC3Dx/C,EAAQ4lD,cAAgB,IAAIzgD,OAAOjG,IAAOA,EAAGmb,QAAQpb,OAAS,GAE/DP,KAAKwoD,WAAWC,uBAAuBzoD,KAAK4O,UAGhC,MAAVxO,OAAU,EAAVA,EAAY6gD,eACd7gD,EAAW6gD,YAAYwE,aAAe,eAE1B,MAAVrlD,OAAU,EAAVA,EAAY8gD,cACd9gD,EAAW8gD,WAAWuE,aAAe,aAEzB,MAAVrlD,OAAU,EAAVA,EAAY+gD,gBACd/gD,EAAW+gD,aAAasE,aAAe,gBAE3B,MAAVrlD,OAAU,EAAVA,EAAYyC,UACdzC,EAAWyC,OAAO4iD,aAAe,WAErB,MAAVrlD,OAAU,EAAVA,EAAYghD,gBACdhhD,EAAWghD,aAAaqE,aAAe,gBAGzCzlD,KAAK2oD,cAAe3oD,KAAK4O,QAA2C+2C,YAAY,kBA7CnErkD,GACZtB,KAAK4O,QAA2C+2C,WAAarkD,mBAG9D,OAAQtB,KAAK4O,QAA2C+2C,WA4ChDvG,iBAaR,OAZqB,IAAIwM,KAAe,CACtC7jC,OAAQotC,GAAqBn1D,KAAK4O,SAClCiC,IAAK,CAAChR,EAAQC,EAAYM,KACxB,MAAMC,EAAYL,KAAK4O,QAAQ63C,UACzBnmD,EAAUD,EAAUqhD,QAAU,IAAIiS,KAAa,CAAEhpB,KAAMtqC,EAAUqhD,UAAathD,EAC9EI,EAAcR,KAAK4O,QAA2C+2C,WAC9DjiD,EAAgBmqD,MAAuBhuD,EAAQO,EAAME,GAC3D,SAAUohD,QAAUrhD,EAAUqhD,SAAWthD,EAAKmhD,UACvCqS,GAAS5zD,KAAK4O,QAASlL,EAAepD,EAASE,IAExD40D,SAAUC,QAKd1M,cAAcrnD,EAA+BzB,GAAwB,GACnEG,KAAK2lD,WAAarkD,EAClBtB,KAAK8zD,2BAA6B,EAC9Bj0D,GACFG,KAAKspD,YAAYnhD,KAAKnI,KAAK2lD,YAIxBkE,kBChFIyL,iCACXvtD,YAAoBlI,GAClBggB,QADkB7f,YAIpBo3B,UACE,eAAQjsB,IAAI,oCACL,mCAGFs9C,uBAAuB5oD,GACvBA,EAAkBqnD,cAA0D,IAA1CrnD,EAAkBqnD,aAAa3mD,OAOpEP,KAAKu1D,2BAA2B11D,GAAmBuI,UAAUtI,IAC3DD,EAAkBqnD,aAAaphD,QAAQ1F,SACX,IAAtBA,EAAYwqC,QACdxqC,EAAYwqC,MAAQxqC,EAAY8Q,YAEP,IAAvB9Q,EAAYub,QAAsD,IAA9Bvb,EAAYub,OAAOpb,UACzDH,EAAYub,OAAS7b,EAAsB+a,KAAKxa,GAAMA,EAAG6Q,OAAS9Q,EAAY8Q,MAAMyK,aAZ1F9b,EAAkBqnD,aAAe,GACjClnD,KAAKu1D,2BAA2B11D,GAAmBuI,UAAUtI,IAC3DD,EAAkBqnD,aAAepnD,KAiB/B01D,cACN31D,EACAC,EAAawmD,GACblmD,EAAmBimD,GACnBhmD,EACAC,EAAqB,EACrBE,GAAoC,GAGpC,MAAMoD,EAAU8iD,GAD+B7mD,EAAmBC,EAAIM,EAAUC,EAAcC,EAAYE,GACxEqa,KAAK9W,GAAgB,eAAXA,EAAEmN,MAAuBpP,MAC/D+B,EAAehE,EAAkB4mD,UAAU5E,aACjD,OAAIrhD,GAA4BgmD,GAASthC,KAAKrhB,KAAkBA,EACvD7D,KAAKkM,KAAKzC,IAAI7F,EAAS,CAAEuhB,aAAc,SAEvCnlB,KAAKkM,KAAKzC,IAAI7F,GAIzB2xD,2BACE11D,GAEA,OAAO,IAAI6W,IAAW5W,UACpB,MAAMO,EAAe,GACrB,IAAIC,EACAE,EACAkD,EACAE,EACAC,EAEJD,EAAYuxD,GAAqBt1D,GACjC,MAAMkE,EAAoEkB,KAAKC,MAC7ED,KAAKE,UAAUtF,WAEVkE,EAAqB0iD,UAAU5E,oBAC9B99C,EAA8C2jD,cAEtD7jD,EAAqBsxD,GAAqBpxD,GAC1C,IAAIC,EAA6D,QAA9B5D,IAAkB8mD,oBAAY,eAAEzgD,OAAO9B,IAAMA,EAAEgX,QAAQjW,IAAIf,GAAKA,EAAEuM,MAGrGlR,KAAKw1D,cAAc31D,EAAmB,OAAG,OAAW,EAAW,GAAG,GAAM0I,MACtE,QAAU5D,GAAOlE,OAAOkE,GAAKoC,cAAc0M,SAAS,gBAAezH,OAAG,IAAS,SAAG,KAClF,QAAUrH,GAED3E,KAAKw1D,cAAc31D,EAAmB,GAAG0I,MAC9C,QAAUu6C,IACR,MAAM77C,EAAWrD,EAAUwwD,aAAatR,GACxCxiD,EAAY2G,EAAS,GAAGwuD,WACpB51D,EAAkBqnD,cAA0D,IAA1CrnD,EAAkBqnD,aAAa3mD,UACnEyD,EAA+B1D,GAEjCE,EAAkBF,EAAUmG,OAC1B48C,GACEr/C,EAA6ByP,SAAS4vC,IACtCA,IAAUp8C,EAAS,GAAGyuD,oBACrBrS,EAAMh1C,MAAM,gBAEjB3K,EAAqBlD,EAAgBM,KAAK,KAC1C,MAAMkiD,EAAkB,GACxB,IAAIC,EAAa,EAGjB,IACGt+C,GAAoD,UAAxC9E,EAAkB4mD,UAAUn7C,SACzCzL,EAAkB4mD,UAAUO,YAAcV,GAAoB,CAC9D,MAAMjD,EAAY,IAClB,KAAOJ,EAAapjD,EAAkB4mD,UAAUO,aAC9ChE,EAAgBpiD,KAAKZ,KAAKw1D,cACxB31D,EACAwjD,EACAxjD,EAAkB4mD,UAAU/E,QAC5Bh+C,EACAu/C,IAEFA,GAAcI,EAEhBx/C,EAAqBD,OAErBo/C,EAAgBpiD,KAAKZ,KAAKw1D,cACxB31D,EACAA,EAAkB4mD,UAAUO,aAAeV,GAC3CzmD,EAAkB4mD,UAAU/E,QAC5Bh+C,EACA,GAAG,IAGP,SAAO2Y,MAAc2mC,QAGvB56C,UAAWzD,IACb,IAAIm+C,EAAqC,GACzCn+C,EAAQe,IAAKuB,IACX,MAAM+7C,EAAen/C,EAAmBuwD,aAAantD,GACrD67C,EAAYA,EAAU98C,OAAOg9C,KAE/BhjD,KAAK21D,uBAAuB7S,GAAWh9C,QAAQmB,IAC7C5G,EAAaO,KAAKqG,KAEpBnH,EAAEqI,KAAK9H,GACPP,EAAEwlB,eAKFqwC,uBAAuB91D,GAC7B,GAAwB,IAApBA,EAASU,OACX,MAAO,GAET,MAAMT,EAAK8F,OAAOU,OAAO,GAAIzG,EAAS,GAAGkrD,wBAClCjrD,EAAGD,EAAS,GAAG61D,0BACf51D,EAAG81D,UACV,MAAMx1D,EAAe,GACrB,UAAWC,KAAYP,EACrB,GAAIA,EAAG6G,eAAetG,GAAW,CAC/B,MAAMC,EACiC,iBAA9BT,EAAS,GAAG4J,IAAIpJ,QACnB,SACOR,EAAS,GAAG4J,IAAIpJ,GAC7BD,EAAaQ,KAAK,CAChBsQ,KAAM7Q,EACNuqC,MAAOvqC,EACPyE,KAAMxE,EACNqb,OAAQ,CAAC7b,EAAGO,MAIlB,SAASqc,MAAOrc,IACd,MAAMC,EAAoBD,EAAQ0qD,gBAClC,UAAWvqD,KAAOF,EACZA,EAAkBqG,eAAenG,IAAQA,KAAOV,GAClDM,EAAaqG,OAAO/C,GAAKA,EAAEwN,OAAS1Q,GAAKsF,QAAQpC,KACE,IAA7CA,EAAEiY,OAAOzb,QAAQI,EAAkBE,KACrCkD,EAAEiY,OAAO/a,KAAKN,EAAkBE,MAKxC,OAAO,IAEFJ,gDA1KEW,GAAUrB,wCAAVqB,EAAUsI,QAAVtI,EAAU,qBAFT,SAEDA,kBCVyBA,GAEpC,MAAMlB,EADoBguD,MAAP9sD,GAAqC,aACpB80D,YAC9B/1D,GAAOg2D,SAAej2D,GAAoB,IAC1CO,EAAc,IAAI+D,MAAM,IACxB9D,EAAY,IAAI8D,MAAM,IAC5B,QAAS7D,EAAI,EAAGA,EAAI,KAAMA,EACxBF,EAAYE,GAAKR,EAAOyH,KAAKC,IAAI,EAAGlH,GACpCD,EAAUC,GAAKA,EAGjB,OAAO,IAAIy1D,KAAe,CACxB7W,UAAQ8W,OAAiBn2D,GACzBo2D,cACAC,+BCdgClO,GAIlCjgD,YAAYzG,GACVue,MAAMve,GAGE89C,iBACR,MAAM99C,EAAgBsE,OAAOU,OAC3B,CACE6vD,SAAUC,GAAsBp2D,KAAK4O,QAAQ66C,aAE/CzpD,KAAK4O,SAGP,OAAO,IAAIynD,KAAa/0D,GAGnBuoD,+BCnB4B7B,GAAUhc,aAK3C,OAAOhsC,KAAK4O,QAAQo9B,wBAIpB,OAAQhsC,KAAK4O,QAAgBm6C,WACxB/oD,KAAK4O,QAAgBm6C,WACtB,uBAIJ,OAAQ/oD,KAAK4O,QAAgBo6C,+BAI7B,OAAQhpD,KAAK4O,QAAgB48B,gBACxBxrC,KAAK4O,QAAgB48B,gBACtB2a,GAAgB8C,MAGZ7J,iBACR,MAGMv/C,EAAgB+F,OAAOU,OAC3B,CACEgwD,YALgBt2D,KAAK4O,QAAQ0nD,YAC7Bt2D,KAAK4O,QAAQ0nD,YACb,aAKFt2D,KAAK4O,SAEP,OAAO,IAAI2nD,KAAc12D,GAG3By/C,YACE,MAAMh+C,EAASue,MAAMy/B,YACrB,GAAIh+C,EAAOf,OAAS,EAClB,OAAOe,EAGT,IAAIzB,EAAa,UACjB,GAA6C,OAAzCG,KAAK4O,QAAQjE,OAAO0/C,OAAO,GAAG9K,OAChC,YAAK3wC,QAAQjE,OAAO0/C,OAAO,GAAG9K,OAAOiX,MAAM1wD,QAAQhG,KAC/B,IAAdA,EAAE8mB,UACJ/mB,GACE,oCAEAC,EAAEgC,MACF,gCAEAhC,EAAEoR,KACF,gBAGNrR,GAAc,WACP,CAAC,CAAEyQ,KAAMzQ,IACX,CAEL,MAAMC,EAAeE,KAAK4O,QAAQjE,OAAO0/C,OAAO,GAAGz7C,QAE7CxO,EAAQ,CACZ,gBACA,eACA,eACA,iBACA,eAEF,UAAWC,KAAWD,EACpB,GAAIN,EAAa22D,SAAShjD,SAASpT,GAAU,CAC3C,MAAMC,EAAOR,EAAa22D,SAAS9yD,MAAMtD,GAAS0qB,MAC5CvqB,EAAQF,EAAKoM,OAAO,EAAGpM,EAAKJ,QAAQ,MAC1C,GAAIM,EAAMiT,SAAS,QAAS,CAC1B,MAAM/P,EAASlD,EAAMmD,MAAM,OAAO,GAAGA,MAAM,KACrCC,EAAOpD,EAAMmD,MAAM,OAAO,GAAGA,MAAM,KACzC,QAASE,EAAI,EAAGA,EAAIH,EAAOnD,OAAQsD,IACjCH,EAAOG,GAAKH,EAAOG,GAAGsC,QAAQ,UAAW,IACzCvC,EAAKC,GAAKD,EAAKC,GAAGsC,QAAQ,UAAW,IACD,MAAhCvC,EAAKC,GAAGsC,QAAQ,OAAQ,MAC1BvC,EAAKC,GAAK,UAEZhE,GACE,oCAEA6D,EAAOG,GACP,gCAEAD,EAAKC,GACL,aAEJ,MAKAhE,GACE,oCAEAW,EACA,iCAPYV,EAAa42D,WACvB52D,EAAa42D,WACb,IAQF,aACF,MAIN,UAAc,WACP,CAAC,CAAEpmD,KAAMzQ,KAIbgqD,+BChHiC7B,GAI9B5I,iBACR,MAAM99C,EAAiB,IAAIq1D,KAC3B,OAAO,IAAI/K,KAAe,CACxBgL,aAAc52D,KAAK4O,QAAQo9B,OAAO4qB,aAClCC,UAAU,EACV9uC,OAAQzmB,EACRuP,KAAK,SAAShR,EAAQC,EAAYM,GAChC,MAAMC,EAAUL,KAAK4O,QAAQiC,IAAM,IAAM7Q,KAAK4O,QAAQ6tC,MAAQ,UAYxDj8C,EAAS,CACb,SACA,YAbes2D,mBACf,WACEj3D,EAAO,GACP,WACAA,EAAO,GACP,WACAA,EAAO,GACP,WACAA,EAAO,GACP,0CAKF,oCACA,cACA,sCACA,cACA,sBACA,gBAMF,OAJIG,KAAK4O,QAAQo9B,OAAOgmB,MAEtBxxD,EAAOI,KADM,QAAQZ,KAAK4O,QAAQo9B,OAAOgmB,QAGvChyD,KAAK4O,QAAQo9B,OAAO+qB,cACtB/2D,KAAK4O,QAAQo9B,OAAO+qB,aAAajxD,QAAQpC,IACvClD,EAAOI,KAAK8C,KAGT,GAAGrD,KAAWG,EAAOM,KAAK,SACjCwwD,KAAKtxD,MACPo1D,SAAU4B,QAId1X,YACE,MAAMh+C,EAAatB,KAAK4O,QAAQqoD,WAC1Bp3D,EAASggB,MAAMy/B,YACrB,QAAmB,IAAfh+C,GAA4BzB,EAAOU,OAAS,EAC9C,OAAOV,EAET,IAAKyB,EACH,OAEF,IACIlB,EACAC,EACAC,EAHAR,EAAa,UAKjB,GAAIwB,EAAWi+C,OACb,UAAW/+C,KAAiBc,EAAWi+C,OACrCn/C,EAAMJ,KAAKk3D,WAAW12D,EAAc22D,YAAa32D,EAAc42D,WAC/D/2D,EAAQG,EAAc62D,MAAQ72D,EAAc62D,MAAMlxD,QAAQ,SAAU,QAAU,GAC9ErG,GACE,mCACAM,EACA,iDACAC,EACA,qBAEyB,gBAApBiB,EAAWwD,KACpB,UAAWtE,KAAiBc,EAAWg2D,iBACrCj3D,EAAQG,EAAc62D,MAAMlxD,QAAQ,SAAU,QACZ,YAAlC3F,EAAkB+2D,OAAOzyD,MACvB1E,EAAMJ,KAAKk3D,WAAW12D,EAAc+2D,OAAOJ,YAAa32D,EAAc+2D,OAAOH,WAC7Et3D,GACE,mCACAM,EACA,iDACAC,EACA,cACqC,YAA9BG,EAAc+2D,OAAOzyD,OAC9BxE,EAAMN,KAAKw3D,UAAUh3D,EAAc+2D,QACnCz3D,GAAc,wBAA0BQ,EAAM,mCAAqCD,EAAQ,kBAGlE,WAApBiB,EAAWwD,OACpBzE,EAAQiB,EAAW+1D,MAAQ/1D,EAAW+1D,MAAMlxD,QAAQ,SAAU,QAAU,GACzC,YAA/B7E,EAAei2D,OAAOzyD,MACpB1E,EAAMJ,KAAKk3D,WAAW51D,EAAWi2D,OAAOJ,YAAa71D,EAAWi2D,OAAOH,WACvEt3D,GACE,mCACAM,EACA,iDACAC,EACA,cACkC,YAA3BiB,EAAWi2D,OAAOzyD,OAC3BxE,EAAMN,KAAKw3D,UAAUl2D,EAAWi2D,QAChCz3D,GAAc,wBAA0BQ,EAAM,mCAAqCD,EAAQ,eAG/F,UAAc,WACP,CAAC,CAAEiQ,KAAMxQ,IAGlBo3D,WAAW51D,EAAqBzB,GAC9B,MAAO,QAAQyB,YAAsBzB,IAGvC23D,UAAUl2D,GACR,IAAIzB,EAAc,GAElB,MAAMC,EAAuBwB,EAAOmvB,MAAQnvB,EAAOmvB,MAAQ,CAAC,EAAG,EAAG,EAAG,GAErE,GAAoB,YAAhBnvB,EAAOwD,KAAoB,CAC7B,MAEMzE,EAAiB,eAAiBP,EAAM,GAAK,IAAMA,EAAM,GAAK,IAAMA,EAAM,GAAK,IAAMA,EAAM,GAAK,IAChGQ,EAAsB,iBAHNgB,EAAOm2D,MAAQn2D,EAAOm2D,MAAQ,GAK/B,iBAAjBn2D,EAAO+uB,MACTxwB,EAAM,2EAA6EQ,EAAS,IAAMC,EAAc,YACtF,gBAAjBgB,EAAO+uB,QAEhBxwB,EAAM,2EAA6EQ,EAAS,IAAMC,EAA5F,yCAAkI,GAEhH,kBAAjBgB,EAAO+uB,OAA8C,iBAAjB/uB,EAAO+uB,MAA0B,CAC9E,MAAMjwB,EAAekB,EAAOo2D,QAAQjnC,MAE9BnwB,EAAOgB,EAAOiY,KAEd/Y,EAAS,eAAiBJ,EAAa,GAAK,IAAMA,EAAa,GAAK,IAAMA,EAAa,GAAK,IAAMA,EAAa,GAAK,IACpHsD,EAAc,gBAJCpC,EAAOo2D,QAAQD,MAK9B7zD,EAAO,aAAe9D,EAAM,GAAK,IAAMA,EAAM,GAAK,IAAMA,EAAM,GAAK,IAAMA,EAAM,GAAK,IAGxFD,EADmB,kBAAjByB,EAAO+uB,MACH,0DAA4D/vB,EAAK,EAAI,YAAcE,EAAS,IAAMkD,EAAc,IAAME,EAAO,YAE7H,gFAAkFpD,EAAS,IAAMkD,EAAc,IAAME,EAAO,YAGtI,OAAO/D,EAGFgqD,+BCtJsC7B,GAAUhc,aAKrD,OAAOhsC,KAAK4O,QAAQo9B,wBAIpB,OAAQhsC,KAAK4O,QAAgBm6C,WACxB/oD,KAAK4O,QAAgBm6C,WACtB,uBAIJ,OAAQ/oD,KAAK4O,QAAgBo6C,+BAI7B,OAAQhpD,KAAK4O,QAAgB48B,gBACxBxrC,KAAK4O,QAAgB48B,gBACtB2a,GAAgB8C,MAGZ7J,iBACR,MAAM99C,OAAgC,IAAvBtB,KAAK4O,QAAQ6tC,MAAsBz8C,KAAK4O,QAAQo9B,OAASpmC,OAAOU,OAC7E,CAACg3C,OAAQ,QAAQt9C,KAAK4O,QAAQ6tC,SAC9Bz8C,KAAK4O,QAAQo9B,QAGf,MAAoC,iBAAzB1qC,EAAOq2D,gBAChBr2D,EAAOq2D,cAAgB1yD,KAAKE,UAAU7D,EAAOq2D,gBAGxC,IAAIC,KAAgB,CACzBvO,MAAO,EACPrd,SACAn7B,IAAK7Q,KAAK4O,QAAQiC,MAItByuC,YACE,MAAMh+C,EAAatB,KAAK4O,QAAQqoD,WAC1Bp3D,EAASggB,MAAMy/B,YACrB,QAAmB,IAAfh+C,QAAmD,IAAvBtB,KAAK4O,QAAQ6tC,OAAuB58C,EAAOU,OAAS,EAClF,OAAOV,EAGT,IAAKyB,EACH,OAEF,IAAIxB,EAAa,UAEjB,UAAWM,KAAiBkB,EAAWi+C,OAGrCz/C,GAFY,kCAAGE,KAAK4O,QAAQiC,OAAOvP,EAAWu2D,kBAAkBz3D,EAAcyQ,kDAChEzQ,EAAci3D,MAAMlxD,QAAQ,SAAU,QAMlD,aAEJ,UAAc,WACP,CAAC,CAAEmK,KAAMxQ,IAGX+pD,+BCjEqC7B,GAAUhc,aAKpD,OAAOhsC,KAAK4O,QAAQo9B,wBAIpB,OAAQhsC,KAAK4O,QAAgBm6C,WACxB/oD,KAAK4O,QAAgBm6C,WACtB,uBAIJ,OAAQ/oD,KAAK4O,QAAgBo6C,+BAI7B,OAAQhpD,KAAK4O,QAAgB48B,gBACxBxrC,KAAK4O,QAAgB48B,gBACtB2a,GAAgB8C,MAGZ7J,iBACR,OAAO,IAAI0Y,KAAuB93D,KAAK4O,SAGzC0wC,YACE,MAAMh+C,EAAatB,KAAK4O,QAAQqoD,WAC1Bp3D,EAASggB,MAAMy/B,YACrB,QAAmB,IAAfh+C,QAAmD,IAAvBtB,KAAK4O,QAAQ6tC,OAAuB58C,EAAOU,OAAS,EAClF,OAAOV,EAGT,IAAKyB,EACH,OAEF,IAAIxB,EAAa,UAEjB,UAAWM,KAAiBkB,EAAWi+C,OAGrCz/C,GAFY,kCAAGE,KAAK4O,QAAQiC,OAAOvP,EAAWu2D,kBAAkBz3D,EAAcyQ,kDAChEzQ,EAAci3D,MAAMlxD,QAAQ,SAAU,QAMlD,aAEJ,UAAc,WACP,CAAC,CAAEmK,KAAMxQ,IAGX+pD,+BCxDgC7B,GAI7B5I,iBACR,MAAM99C,EAAc2D,KAAKC,MAAMD,KAAKE,UAAUnF,KAAK4O,UACnD,OAAI5O,KAAK4O,QAAQunD,kBACR70D,EAAY60D,SACnB70D,EAAY60D,SAAW,IAAI4B,KAAS/3D,KAAK4O,QAAQunD,WAE5C,IAAI6B,KAAU12D,GAGhBuoD,+BCZgCmC,GAI7B5M,iBACR,YAAK6Y,kBACLj4D,KAAK4O,QAAQmZ,OAAS/nB,KAAK2rD,2BAA2B3rD,KAAK4O,SACpDiR,MAAMu/B,iBAGP6Y,kBACNj4D,KAAKm5B,GAAK,IAAI++B,UAAUl4D,KAAK4O,QAAQiC,KACrC7Q,KAAKm5B,GAAGg/B,UAAYn4D,KAAKo4D,UAAU9G,KAAKtxD,MAEpCA,KAAK4O,QAAQypD,UACfr4D,KAAKm5B,GAAGk/B,QAAUr4D,KAAKs4D,QAAQhH,KAAKtxD,OAGlCA,KAAK4O,QAAQqlD,UACfj0D,KAAKm5B,GAAG86B,QAAUj0D,KAAKu4D,QAAQjH,KAAKtxD,OAGlCA,KAAK4O,QAAQ4pD,SACfx4D,KAAKm5B,GAAGq/B,OAASx4D,KAAKy4D,OAAOnH,KAAKtxD,OAItCo4D,UAAU92D,GACR,MAAMzB,EAAeG,KAAK4O,QAAQmZ,OAAO2wC,YAAYp3D,EAAMioB,MAE3D,OAAQvpB,KAAK4O,QAAQupD,eACd,SAEH,MAAMr4D,EAAkBE,KAAK+8C,GAAGsW,eAAexzD,EAAa4zD,SACxD3zD,GACFE,KAAK+8C,GAAG4b,cAAc74D,GAExBE,KAAK+8C,GAAG6b,WAAW/4D,GACnB,UACG,SACHG,KAAK+8C,GAAG7mC,OAAM,GACdlW,KAAK+8C,GAAG6b,WAAW/4D,GACnB,UACG,cAEHG,KAAK+8C,GAAG6b,WAAW/4D,IAIzBy4D,QAAQh3D,IAIRi3D,QAAQj3D,IAIRm3D,OAAOn3D,IAIAuoD,YACL7pD,KAAKm5B,GAAGxG,0BC3DuBq1B,GAIvB5I,iBACR,IAAI99C,EACJ,OACEA,EADgC,YAA9BtB,KAAK4O,QAAQ8uC,aACH,IAAImb,KAAY,CAACnb,aAAcW,OAE/B,IAAIwa,KAElB74D,KAAK4O,QAAQmZ,OAASzmB,EACf,IAAIw3D,KAAmB94D,KAAK4O,SAG3BuwC,aACR,OAAKn/C,KAAK4O,QAAQiC,IAIX0pC,aADO,MAAQv6C,KAAK4O,QAAQiC,KAFxB5H,IAMN4gD,uBC1BP9hD,cACE/H,KAAK+4D,YAAc,GACnB/4D,KAAK+4D,YAAYC,QAAUC,GAAmBC,gBAC9Cl5D,KAAK+4D,YAAYI,QAAUF,GAAmBG,gBAC9Cp5D,KAAK+4D,YAAYM,QAAUJ,GAAmBK,gBAC9Ct5D,KAAK+4D,YAAYQ,QAAUN,GAAmBO,gBAC9Cx5D,KAAK+4D,YAAYU,OAASR,GAAmBS,eAC7C15D,KAAK25D,WAAa,GAClB35D,KAAK25D,WAAWC,YAAc55D,KAAK65D,mBACnC75D,KAAK25D,WAAWG,OAAS95D,KAAK+5D,cAC9B/5D,KAAK25D,WAAWK,YAAch6D,KAAKi6D,+CAET34D,GAC1B,OAAOA,EAAQ,2BAEMA,GAErB,MAAO,CAACA,EAAM,GAAIA,EAAM,GAAIA,EAAM,GAAIA,EAAM,GAAK,mCAGrBA,EAAOzB,GACnC,MACMO,EAAMytD,MAAuBhuD,GAEnC,OAAO8tD,WAAWrsD,IADK,QACKlB,EAHhB,IAGuCs5D,sBAI/Bp4D,GACpB,MAAMzB,EAAWo5D,GAAmBiB,gBAAgB54D,EAAO64D,OACrDr6D,OAAuB,IAAhBwB,EAAOgO,KAAqBhO,EAAOgO,UAAO,EACvD,OAAO,IAAI8qD,MAAc,CACvB9qD,KAAM,IAAI+qD,KAAa,CACrBC,KAAM,IAAIC,KAAa,CACrB9pC,MAAOwoC,GAAmBuB,gBAAgBl5D,EAAOmvB,SAEnDgqC,KACEn5D,EAAOm5D,KAAKpqC,MACZ,IACA/uB,EAAOm5D,KAAKC,OACZ,IACAp5D,EAAOm5D,KAAKlhD,KACZ,OACAjY,EAAOm5D,KAAKE,OACdC,aAAct5D,EAAOu5D,kBACrBC,UAAWx5D,EAAOy5D,oBAClBC,QAAS/B,GAAmBgC,qBAAqB35D,EAAO45D,SACxDC,QAASlC,GAAmBgC,qBAAqB35D,EAAO85D,SACxDC,WACA/rD,kCAKiBhO,GACrB,MAAMzB,EAAM,QAAUyB,EAAO61D,YAAc,YAAc71D,EAAO81D,UAC1Dt3D,EAAWm5D,GAAmBiB,gBAAgB54D,EAAO64D,OAE3D,OAAO,IAAIC,MAAc,CACvBtsB,MAAO,IAAIwtB,KAAa,CACtBnnB,MACAknB,sCAKiB/5D,GAErB,MAAMzB,EAAO,IAAI06D,KAAa,CAC5B9pC,MAAOwoC,GAAmBuB,gBAAgBl5D,EAAOmvB,SAE7C3wB,EAASwB,EAAOo2D,QAClBuB,GAAmBsC,gBAAgBj6D,EAAOo2D,cAC1C,EACJ,OAAO,IAAI0C,MAAc,CACvBE,OACAkB,kCAGmBl6D,GACrB,IAAIzB,EACJ,MAAMC,EAAQm5D,GAAmBuB,gBAAgBl5D,EAAQmvB,OACzD,MAAsB,gBAAlBnvB,EAAQ+uB,MACVxwB,EAAW,CAAC,GACe,mBAAlByB,EAAQ+uB,MACjBxwB,EAAW,CAAC,EAAG,EAAG,EAAG,GACM,sBAAlByB,EAAQ+uB,MACjBxwB,EAAW,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GACA,eAAlByB,EAAQ+uB,MACjBxwB,EAAW,CAAC,EAAG,GACY,gBAAlByB,EAAQ+uB,QAEjBvwB,EAAM,GAAK,GAEN,IAAI27D,KAAe,CACxBhrC,QACAirC,WACAjE,MAAOwB,GAAmBgC,qBAAqB35D,EAAQm2D,gCAIpCn2D,GACrB,OAAO,IAAI84D,MAAc,CACvBoB,OAAQvC,GAAmBsC,gBAAgBj6D,4BAGxBA,GACrB,GAAc,IAAVA,QAAyB,IAAVA,EACjB,OAGF,MAAMxB,GADawB,EAAQiG,KAAKo0D,GAAM,IACVp0D,KAAKo0D,GAAK,EACtC,OAAI77D,EAAS,EACJ,EAAIyH,KAAKo0D,GAAK77D,EAEdA,yBAIYwB,GACrB,MAAMzB,EAAO,IAAI06D,KAAa,CAC5B9pC,MAAOwoC,GAAmBuB,gBAAgBl5D,EAAOmvB,SAE7C3wB,EAASwB,EAAOo2D,QAClBuB,GAAmBsC,gBAAgBj6D,EAAOo2D,cAC1C,EACEt3D,EAAS64D,GAAmBgC,qBAAqB35D,EAAOiY,MAAQ,EAChElZ,EAAW44D,GAAmBiB,gBAAgB54D,EAAO64D,OAC3D,MAAqB,kBAAjB74D,EAAO+uB,MACF,IAAI+pC,MAAc,CACvBtsB,MAAO,IAAI8tB,KAAe,CACxB7N,SACAuM,OACAkB,aAGsB,iBAAjBl6D,EAAO+uB,MACT,IAAI+pC,MAAc,CACvBtsB,MAAO,IAAI+tB,KAAqB,CAC9BvB,OACAkB,SACAM,OAAQ,EACR/N,SACAgO,QAAS,EACT5B,MAAO,EACPkB,eAGsB,mBAAjB/5D,EAAO+uB,MACT,IAAI+pC,MAAc,CACvBtsB,MAAO,IAAI+tB,KAAqB,CAC9BvB,OACAkB,SACAM,OAAQ,EACR/N,SACAsN,eAGsB,kBAAjB/5D,EAAO+uB,MACT,IAAI+pC,MAAc,CACvBtsB,MAAO,IAAI+tB,KAAqB,CAC9BvB,OACAkB,SACAM,OAAQ,EACR/N,SACAoM,MAAO5yD,KAAKo0D,GAAK,EACjBN,eAGsB,aAAjB/5D,EAAO+uB,MACT,IAAI+pC,MAAc,CACvBtsB,MAAO,IAAI+tB,KAAqB,CAC9BvB,OACAkB,SACAM,OAAQ,EACR/N,SACAgO,QAAS,EACT5B,MAAO5yD,KAAKo0D,GAAK,EACjBN,eAGsB,oBAAjB/5D,EAAO+uB,MACT,IAAI+pC,MAAc,CACvBtsB,MAAO,IAAI+tB,KAAqB,CAC9BvB,OACAkB,SACAM,OAAQ,EACR/N,SACAoM,MAAO,EACPkB,oBARC,EAcTW,qBAAqB16D,EAAczB,GACjC,MAAMC,EAAS,GACf,QAASM,EAAI,EAAGC,EAAKiB,EAAaf,OAAQH,EAAIC,IAAMD,EAAG,CACrD,MAAME,EAAkBgB,EAAalB,GAAG67D,gBAElCz7D,EAAQF,EAAgBoM,OAC5BpM,EAAgBJ,QAAQ,KAAO,EAC/BI,EAAgBJ,QAAQ,KAAO,GAE3BwD,EAASpC,EAAalB,GAAGm3D,OACzB3zD,EAAWtC,EAAalB,GAAG87D,SAC3Br4D,EAAWvC,EAAalB,GAAG+7D,SACjC,IAAIp4D,EAAgB,KACH,IAAbH,IACFG,EAAgBk1D,GAAmBmD,uBACjCx4D,EACA/D,IAGJ,IAAImE,EAAgB,KACH,IAAbH,IACFG,EAAgBi1D,GAAmBmD,uBACjCv4D,EACAhE,IAGJ,MAAM8E,EAAQ3E,KAAK+4D,YAAYr1D,EAAOoB,MAAM2D,KAAKzI,KAAM0D,GACvD5D,EAAOc,MAEI,SAASkiD,EAAS77C,GACvB,IAAI+7C,GAAU,EAUd,GAT2B,OAAvBhjD,KAAK2qD,eAAiD,OAAvB3qD,KAAKivD,cACtCjM,EACE/7C,EAAajH,KAAKivD,eAClBhoD,GAAcjH,KAAK2qD,cACW,OAAvB3qD,KAAK2qD,cACd3H,EAAU/7C,GAAcjH,KAAK2qD,cACG,OAAvB3qD,KAAKivD,gBACdjM,EAAU/7C,EAAajH,KAAKivD,eAE1BjM,EAAS,CACX,MAAMC,EAAQH,EAAQr5C,IAAIzJ,KAAKi4B,OAC/B,YAAK5H,MAAMgsC,UAAUvJ,QAAQ7P,GACtB,CAACjjD,KAAKqwB,UAGdihC,KAAK,CACR3G,gBACAsE,gBACAh3B,QACA5H,WAIN,OAAOvwB,EAGTi6D,cAAcz4D,GACZ,MAAMzB,EAAQG,KAAK+4D,YAAYz3D,EAASi2D,OAAOzyD,MAAM2D,KACnDzI,KACAsB,EAASi2D,QAEX,MACS,IACE,CAAC13D,GAIdo6D,mBAAmB34D,GACjB,MAAMzB,EAAgByB,EAASg7D,cACzBx8D,EAAeE,KAAK+4D,YAAYl5D,EAAciF,MAAM2D,KACxDzI,KACAH,GAEIO,EAAQkB,EAAS22B,MACjB53B,EAAU,GAChB,QAASC,EAAI,EAAGE,EAAKc,EAASi7D,gBAAgBh8D,OAAQD,EAAIE,IAAMF,EAAG,CACjE,MAAMoD,EAAiBpC,EAASi7D,gBAAgBj8D,GAChD,IAAIsD,EAMAA,EAJFF,QAAe84D,cAGL,IAAVl8D,EACQgB,EAASm7D,SAETn7D,EAASi7D,gBAAgBj8D,EAAI,GAAGo8D,cAGlCh5D,EAAe84D,cAEvB,MAAM34D,EAAMH,EAAeg5D,cACrB34D,EAASL,EAAe6zD,OACxBvzD,EAAQhE,KAAK+4D,YAAYh1D,EAAOe,MAAM2D,KAAKzI,KAAM+D,GACvD1D,EAAQO,KAAK,CAAEqiB,MAAKD,MAAKqN,UAE3B,OACU/vB,IACN,MAAME,EAAQF,EAAQmJ,IAAIrJ,GAC1B,QAASsD,EAAI,EAAGE,EAAKvD,EAAQE,OAAQmD,EAAIE,IAAMF,EAAG,CAChD,IAAIG,EAMJ,GAJEA,EADQ,IAAVH,EACclD,GAASH,EAAQqD,GAAGuf,KAAOziB,GAASH,EAAQqD,GAAGsf,IAE/CxiB,EAAQH,EAAQqD,GAAGuf,KAAOziB,GAASH,EAAQqD,GAAGsf,IAExDnf,EACF,MAAO,CAACxD,EAAQqD,GAAG2sB,OAGvB,MAAO,CAACvwB,IAId+5D,mBAAmBv4D,GACjB,MAAMzB,EAAgByB,EAASg7D,cAC/B,IAAIx8D,EAAe,GACfD,IACFC,EAAe,CACbE,KAAK+4D,YAAYl5D,EAAciF,MAAM2D,KAAKzI,KAAMH,KAGpD,MAAMO,EAAQkB,EAASq7D,OACjBt8D,EAAQiB,EAASg2D,iBACjBh3D,EAAKN,KACX,MAAQ,MACN,MAAMQ,EAAO,GACb,QAASkD,EAAI,EAAGE,EAAKvD,EAAME,OAAQmD,EAAIE,IAAMF,EAAG,CAC9C,MAAMG,EAAOxD,EAAMqD,GACbK,EAASF,EAAK0zD,OACpB/2D,EAAKqD,EAAK/B,OAAS,CAACxB,EAAGy4D,YAAYh1D,EAAOe,MAAM2D,KAAKnI,EAAIyD,IAG3D,OAAQL,GACQlD,EAAKkD,EAAQ+F,IAAIrJ,KACRN,GAVnB,GAcV88D,cAAct7D,EAAWzB,GACvB,MAAMC,EAAcwB,EAAUu7D,YAC9B,IAAIz8D,EAAiB,GACrB,MAAMC,EAAmBL,KAAK25D,WAAW75D,EAAY6iB,SAAS7d,MAAM2D,KAClEzI,KACAF,EAAY6iB,UAKd,QAHyB,IAArBtiB,GACFD,EAAeQ,KAAKP,GAElBiB,EAAUw7D,aAAc,CAC1B,MAAMx8D,EAA6BN,KAAKg8D,qBACtC16D,EAAUw7D,aACVj9D,GAEFO,EAAiBA,EAAe4F,OAAO1F,GAEzC,OAA8B,IAA1BF,EAAeG,OACVH,EAAe,GAGb,CAACE,EAASE,KACf,IAAIkD,EAAS,GACb,QAASE,EAAI,EAAGC,EAAKzD,EAAeG,OAAQqD,EAAIC,IAAMD,EAAG,CACvD,MAAMG,EAAS3D,EAAewD,GAAG6E,KAAK,KAAMnI,EAASE,GACjDuD,IACFL,EAASA,EAAOsC,OAAOjC,IAG3B,OAAOL,QClXLq5D,SAAZ,OAAYh8D,UAAc,KACtBi8D,YACAj8D,cACAA,sBACAA,cAJQg8D,GAAZ,IAAYh8D,MAOAk8D,SAAZ,OAAYl8D,UAAe,KACvBm8D,oBACAn8D,kBAFQk8D,GAAZ,IAAYl8D,UCSCo8D,iBAGXp1D,eAEAq1D,SACE,OAAOp9D,KAAK0F,IAGd6qD,OAAO1wD,GACLG,KAAK0F,IAAM7F,gDAVFkB,gCAAUsI,QAAVtI,EAAU,qBAFT,SAEDA,UCwBDs8D,SAAZ,OAAYt8D,UAAgB,KAC1Bg9C,UACAh9C,cACAA,wBACAA,6BACAA,4BALUs8D,GAAZ,IAAYt8D,UAaCu8D,iBAOXv1D,YAAoBlI,EAA0BC,GAA1BE,YAA0BA,kBANtCA,aAAU,CAChB+9C,IAAK,IAAIwf,KACTtf,KAAM,IAAIuf,KACVC,SAAU,IAAI9G,MAKhB+G,cACE79D,GAKA,OAAOG,KAAK29D,gBAAgB,MAHhB99D,EAAYgR,IACPhR,EAAYmsC,OAAe2d,SAEKphD,QAC/CsmD,KAAKxuD,GACIA,EACHL,KAAK49D,gBAAgB/9D,EAAaQ,QAClC,IAKVw9D,eACEh+D,GAYA,OAPgBG,KAAK29D,gBAAgB,OAHzB99D,EAAYgR,IACRhR,EAAYyL,SAE+B/C,QACzDsmD,KAAKvuD,GACIA,EACHN,KAAK89D,iBAAiBj+D,EAAaS,QACnC,IAMVy9D,gBACEl+D,GASA,OAAOG,KAAKkM,KACT8xD,MAPD,WACAn+D,EAAYw1C,QACZ,yBACAx1C,EAAYo+D,MACZ,YAGgB,YACf11D,MACC,OAAKnI,GACHJ,KAAKk+D,kBAAkBr+D,EAAaO,KAK5C+9D,iBACEt+D,GAEA,MAAMC,EAAUD,EAAYgR,IAAM,IAAMhR,EAAY48C,MAAQ,UAEtDp8C,EAAYR,EADcgR,IAAI1K,QAAQ,gBAAiB,aAC7B,iBAC1B7F,EAAsBN,KAAK29D,gBAAgB,aAAc99D,EAAYgR,KACrErQ,EAAgBR,KAAKkM,KAAKzC,IAAI3J,GAC9B4D,EAAS1D,KAAKkM,KAAKzC,IAAIpJ,GAAWkI,MACtC,OAAK3E,GAAaA,MAClBqH,KAAYrH,IACVsH,QAAQC,IAAI,qDACLa,MAAGpI,MAGd,SAAOw6D,MAAS,CAAC59D,EAAekD,EAAQpD,IAAsBiI,MAC5D,OAAK3E,GACI5D,KAAKq+D,mBAAmBx+D,EAAa+D,EAAI,GAAIA,EAAI,GAAIA,EAAI,MAKtE06D,sBACEz+D,GAEA,MAAMC,EAAUD,EAAYgR,IAAM,IAAMhR,EAAY48C,MAAQ,UAEtDp8C,EAAYR,EADcgR,IAAI1K,QAAQ,gBAAiB,aAC7B,iBAC1B7F,EAAsBN,KAAK29D,gBAAgB,kBAAmB99D,EAAYgR,KAC1ErQ,EAAgBR,KAAKkM,KAAKzC,IAAI3J,GAC9B4D,EAAS1D,KAAKkM,KAAKzC,IAAIpJ,GAAWkI,MACtC,OAAK3E,GAAaA,MAClBqH,KAAYrH,IACVsH,QAAQC,IAAI,mDACLa,MAAGpI,MAGd,SAAOw6D,MAAS,CAAC59D,EAAekD,EAAQpD,IAAsBiI,MAC5D,OAAK3E,GACI5D,KAAKu+D,8BAA8B1+D,EAAa+D,EAAI,GAAIA,EAAI,GAAIA,EAAI,MAKjF46D,qBACE3+D,GAEA,MAAMC,EAAUD,EAAYgR,IAAM,IAAMhR,EAAY48C,MAAQ,UACtDr8C,EAAYP,EAAYgR,IAAM,iBAC9BxQ,EAAsBL,KAAK29D,gBAAgB,iBAAkB99D,EAAYgR,KACzEvQ,EAAgBN,KAAKkM,KAAKzC,IAAI3J,GAC9BU,EAAaR,KAAKkM,KAAKzC,IAAIrJ,GAAWmI,MAC1C,OAAK7E,GAAaA,MAClBuH,KAAYvH,IACVwH,QAAQC,IAAI,kDACLa,MAAGtI,MAGd,SAAO06D,MAAS,CAAC99D,EAAeE,EAAYH,IAAsBkI,MAChE,OAAK7E,GACH1D,KAAKu+D,8BAA8B1+D,EAAa6D,EAAI,GAAIA,EAAI,GAAIA,EAAI,MAQ1Ei6D,gBACE99D,EACAC,EACAM,GAEA,MAAMC,EAAS,IAAI8J,KAAW,CAC5Bs0D,WAAY,CACVC,QAAS,kBACTC,QAAS9+D,EAAQgH,cACjByE,QAASlL,GAAW,QACpB6b,GAAI,UAIR,IAAI3b,EACJ,OACEA,EADgC,aAA9B+8D,GAAiBx9D,GACTG,KAAKkM,KAAKzC,IAAI3J,EAAU,WAExBE,KAAKkM,KAAKzC,IAAI3J,EAAS,CAC/BksC,SACA7mB,aAAc,SAIX7kB,EAAQiI,MACb,OAAK/H,IACH,GAAkC,aAA9B68D,GAAiBx9D,GACnB,OAAOW,EAET,GACEC,OAAOD,GAAKuG,cAAc0M,SAAS,qBACnChT,OAAOD,GAAKuG,cAAc0M,SAAS,iBAEnC,KAAM,CACJpI,MAAO,CACL2D,QAAS,oDAIb,OAAOhP,KAAK4+D,QAAQ/+D,GAASg/D,KAAKr+D,MAGtC,OAAYA,IACV,WAAuB,IAAZA,EAAE6K,QACX7K,EAAE6K,MAAM0D,QAAS,GAEbvO,KAKJo9D,gBACN/9D,EACAC,GAEA,MACMO,EAAQL,KAAK8+D,6BACjBh/D,EAAai/D,WAAWC,MAFVn/D,EAAYmsC,OAAesR,QAM3C,IAAKj9C,EACH,KAAM,CACJgL,MAAO,CACL2D,QAAS,oBAIf,MAAM1O,EAAWD,EAAM4+D,QAAU5+D,EAAM4+D,QAAQ,QAAK,EAC9Cz+D,EAAWH,EAAM6+D,SAAW7+D,EAAM6+D,cAAW,EAC7Cx7D,EAAcrD,EAAM8+D,YAAc9+D,EAAM8+D,iBAAc,EAC5D,IAAIv7D,EAAYvD,EAAM++D,UACtB,MAAMv7D,EAAa7D,KAAKq/D,cAAch/D,GAChC0D,EAAiBF,GAAc+B,OAAOC,KAAKhC,GAAYtD,OAAS,EAChEyD,EAAgB3D,EAAMi/D,MAAQt/D,KAAKu/D,SAASl/D,EAAMi/D,YAAS,EACjE,IAAI36D,GAAuB,EACvBtE,EAAMm/D,yBACRn/D,EAAMm/D,yBAAyB15D,QAAQ,CAACu9C,EAAOG,KACzCA,EAAQ,IAAMH,EAAQ,KAAOA,GAAQ,OACvC1+C,GAAuB,GAErB6+C,GAAS,IAAMH,EAAQ,IAAMA,GAAQ,MACvC1+C,GAAuB,KAI3BA,GAAuB,EAGzB,MAAMm+C,EAASn+C,EACXkpD,MAAuBxtD,EAAMm/D,yBAA0B,YAAax/D,KAAKy/D,WAAWrC,SAAS3T,iBAC7F,EAEJ,IAAIxiD,EACJ,MAAM+7C,EAA8B,CAClCkD,GAAoBwZ,QACpBxZ,GAAoByZ,SACpBzZ,GAAoB0Z,KACpB1Z,GAAoBD,KACpBC,GAAoBjhD,KACpBihD,GAAoB2Z,MAGtB,UAAWxc,KAAYL,EACrB,IAGQ,IAFNljD,EAAai/D,WAAWe,QAAQC,eAAeC,OAAO9/D,QACpDmjD,GAEF,CACA,MAAMG,EAAU59C,OAAOC,KAAKqgD,IAAqBrrC,KAC9C6oC,GAAQwC,GAAoBxC,KAASL,GAExCp8C,EAAc++C,GAAYxC,GAC1B,MAGCv8C,IACHrD,GAAY,GAGd,MAAMq/C,EAAgC18C,kBAA4B,CAChE05D,wBAAyB,CACvBhxD,MAAO5O,EAAM6/D,MACbjR,cAAeC,GAAuB7uD,EAAM8/D,qBAC5CxV,cAAeuE,GAAuB7uD,EAAM+/D,qBAC5Ct1B,SACAu1B,SAAU,CACRxvD,IAAKvQ,EAAWA,EAASggE,oBAAiB,EAC1CpkB,SAAQ57C,QAAkB,EAC1Bg8C,WACAikB,eAEFlR,iBAEF+P,YACA7zB,cACAsd,WAAY9kD,EAAiBF,OAAa,EAC1C+kD,iBAAgB7kD,QAAwB,EACxCq/C,QAASr/C,EAAiBF,EAAWof,SAAM,EAC3CsgC,QAASx/C,EAAiBF,EAAWmf,SAAM,EAC3Cw9C,SAAUz8D,EAAiBF,EAAWghD,UAAO,IAG/C,OAAOt+C,YAAsB08C,EAASpjD,GAGhCi+D,iBACNj+D,EACAC,GAGA,MAAMM,EAAQN,EAAa2gE,SAASzB,MAAMnkD,KACvCnX,GAAOA,EAAGg9D,aAAe7gE,EAAY48C,OAGlCp8C,GAAU,QAAwBP,EAAcD,GAEhDS,EAAesF,OAAOU,OAAOjG,EAASR,GACtCW,EAAgB+F,kBAA4B,CAChD05D,wBAAyB,CACvBhxD,MAAO7O,EAAM8/D,SAIjB,OAAO35D,YAAsB/F,EAAeF,GAGtC49D,kBACNr+D,EACAC,GAEA,MAAMM,EAAS,GACTC,EAASP,EAAauqD,OAAO,GAAGz7C,QAAQ+xD,iBAC9CtgE,EAAOgqD,OAAOvkD,QAAStF,IACrBJ,EAAOQ,KAAK,CACVkE,KAAMtE,EAAQsE,KAAKiC,cACnB6H,QAASpO,EAAQoO,QACjB2wC,OAAQ/+C,EAAQ++C,WAGpB,MAAMj/C,EAAUiG,kBAA4B,CAC1CoE,OAAQ,CACNW,QAASjL,EAAOiL,QAChB++C,YAGJ,OAAO9jD,YAAsBjG,EAAST,GAGhCw+D,mBACNx+D,EACAC,EACAM,EACAC,SAEA,MAAMG,EAAQV,EAAcoR,KAC5B,IAAIxN,EAUAE,EAPFF,EADEtD,EAAOiqD,OACIjqD,EAAOiqD,OAAOxvC,KAAK5T,GAAKA,EAAE25D,YAAcpgE,IACnB,QAAzBF,IAAcu8D,mBAAW,eAAEl6C,UACvB7iB,EAAc+8D,YAAYl6C,cAE1B,EAIX7iB,EAAc+8D,cAGhBj5D,OAF2Bq1D,IAEJ2D,cAAc98D,EADC,eAAxBA,EAAc+gE,MAAyB,IAAM,YAG7D,MAAMh9D,EAAe,IAAIi9D,KAAc,CACrC15C,OAAQtnB,EAAcihE,gBAExB,IAAIh9D,EACAC,EACJ,GAAIlE,EAAckhE,SAAU,CAC1B,MAAM/5D,EAAOnH,EAAckhE,SAASC,WACpCl9D,EAAakD,EAAK,GAAK,IAAMA,EAAK,GAClC,MAAM+7C,EAAM,IAAI38C,KAChB28C,EAAIke,QAAQj6D,EAAK,IACjB,MAAMg8C,EAAM,IAAI58C,KAChB48C,EAAIie,QAAQj6D,EAAK,IACjBjD,EAAa,CACXif,IAAK+/B,EAAIme,cACTn+C,IAAKigC,EAAIke,cACTC,OAAO,EACPt8D,KAAMi4D,GAAesE,SACrBhxC,MAAO4sC,GAAgBC,UAG3B,MAAMv4D,EAASiB,OAAOU,OACpB,GACA,CACE+pB,QACAitB,OAAQz9C,EAAY48C,MAAQ,QAAU58C,EAAY48C,WAAQ,EAC1DuV,KAAMjuD,IAGJ++C,EAAUv8C,kBAA4B,CAC1CylC,SACAi0B,wBAAyB,CACvBhxD,QACA07C,cAAeuE,GAAuBpvD,EAAco8D,UACpDjN,cAAeC,GAAuBpvD,EAAcq8D,UACpDkE,SAAU,CACRnkB,QAAQ,EACRI,SAAUx8C,EAAc+tC,aAAextC,EAAoBihE,qBAG/DrK,aACApO,aACA3B,aAAcpnD,EAAcw3B,OAC5ByxB,WAAYjpD,EAAcyhE,eAE5B,SAAQ3K,aAAe/yD,EAChB0C,YAAsBu8C,EAASjjD,GAGhC0+D,8BACN1+D,EACAC,EACAM,EACAC,GAEA,MAAMC,EAAQR,EAAcoR,KACtB1Q,EAAaJ,EAAOiqD,OAASjqD,EAAOiqD,OAAOxvC,KAAKlW,GAAKA,EAAEi8D,YAActgE,QAAS,EAC9EoD,EAAe,IAAIo9D,KAAc,CACrC15C,OAAQtnB,EAAcihE,gBAExB,IAAIn9D,EACAC,EACJ,GAAI/D,EAAckhE,SAAU,CAC1B,MAAMr8D,EAAO7E,EAAckhE,SAASC,WACpCr9D,EAAae,EAAK,GAAK,IAAMA,EAAK,GAClC,MAAMm+C,EAAM,IAAIz8C,KAChBy8C,EAAIoe,QAAQv8D,EAAK,IACjB,MAAMsC,EAAM,IAAIZ,KAChBY,EAAIi6D,QAAQv8D,EAAK,IACjBd,EAAa,CACXof,IAAK6/B,EAAIqe,cACTn+C,IAAK/b,EAAIk6D,cACTC,OAAO,EACPt8D,KAAMi4D,GAAesE,SACrBhxC,MAAO4sC,GAAgBC,UAG3B,MAAMn5D,EAAS6B,OAAOU,OACpB,GACA,CACEg3C,OAAQz9C,EAAY48C,MAAQ,QAAU58C,EAAY48C,WAAQ,EAC1DuV,KAAMpuD,IAGJI,EAAUuC,kBAA4B,CAC1CylC,SACAi0B,wBAAyB,CACvBhxD,QACA07C,cAAeuE,GAAuBpvD,EAAco8D,UACpDjN,cAAeC,GAAuBpvD,EAAcq8D,UACpDkE,SAAU,CACRnkB,QAAQ,EACRI,SAAUx8C,EAAc+tC,aAAextC,EAAoBihE,qBAG/DrK,aACApO,aACA3B,aAAcpnD,EAAcw3B,OAC5ByxB,WAAYjpD,EAAcyhE,eAE5B,SAAQ3K,aAAelzD,EAChB6C,YAAsBvC,EAASnE,GAGhCi/D,6BAA6Bj/D,EAAYC,GAC/C,GAAIqE,MAAM4B,QAAQlG,GAAa,CAC7B,IAAIO,EACJ,SAAWya,KAAMxa,IACfD,EAAQJ,KAAK8+D,6BAA6Bz+D,EAAOP,QAChC,IAAVM,GACNJ,MAEII,EACF,OAAIP,EAAWm/D,MACbh/D,KAAK8+D,6BAA6Bj/D,EAAWm/D,MAAOl/D,GAEvDD,EAAW2hE,MAAQ3hE,EAAW2hE,OAAS1hE,EAClCD,OAET,EAIJw/D,cAAcx/D,GACZ,IAAIC,EAEJ,GAAID,EAAM4hE,UAAW,CACnB,MAAMrhE,EAAkB,GAGxB,GAFAN,EAAYD,EAAM4hE,UAAU,GAExB3hE,EAAU6b,OAAQ,CACpB,MAAMtb,EAAYP,EAAU6b,OAAOhY,MAAM,KACzCvD,EAAW6iB,SAAuB,IAAjB5iB,EAAU,GAAmBA,EAAU,QAAK,EAC7DD,EAAW4iB,SAAuB,IAAjB3iB,EAAU,GAAmBA,EAAU,QAAK,EAC7DD,EAAWykD,UAAwB,IAAjBxkD,EAAU,GAAmBA,EAAU,QAAK,EAGhE,OAAIP,EAAU+K,UACZzK,EAAW0B,MAAQhC,EAAU+K,SAExBzK,GAIXm/D,SAAS1/D,GAkBP,MAJqC,CACnC6hE,gBAduC7hE,EAAM6F,IAAKrF,KAEhD6Q,KAAM7Q,EAAMmhE,KACZvyD,MAAO5O,EAAM6/D,SAIdz5D,OACC,CAACpG,EAAMC,EAAOE,IACZA,EAAKkE,UAAWhB,GAAwBA,EAAEwN,OAAS7Q,EAAK6Q,QACxD5Q,kDA7eGS,GAAmBrB,kDAAnBqB,EAAmBsI,QAAnBtI,EAAmB,qBAFlB,YAiIZykB,WAHCC,MAAU,CACTC,cAAe,MAEjB3kB,8BAiDC,MAhLUA,oBCnCA4gE,iBAEX55D,YAAoBlI,kBACEG,KAAK2K,OAAOD,UAAU,gBAAkB,IAChD5E,QAAS1F,IACnBA,EAAWwqC,MAAQxqC,EAAWwqC,MAAQxqC,EAAWwqC,MAAQxqC,EAAWuqC,KACpE3qC,KAAK4hE,mBAAmBxhE,KAI1B,QAASA,EAAU,EAAGA,EAAU,GAAIA,IAIlCJ,KAAK4hE,mBADoB,CAAEj3B,KAFdvqC,EAAU,GAAK,YAAYA,IAAY,WAAWA,IAE9ByqC,IADrB,mBAAmBzqC,mCACO0qC,YAAS,IAKjD,QAAS1qC,EAAU,EAAGA,EAAU,GAAIA,IAAW,CAC7C,MAAMC,EAAOD,EAAU,GAAK,YAAYA,IAAY,WAAW,GAAKA,IACpE,IAAIE,EAEFA,EADE2qB,OAAO7qB,IAAY,GACd,GAAwB,EAAlB6qB,OAAO7qB,GACX6qB,OAAO7qB,IAAY,IACrB,GAA+B,GAAxB6qB,OAAO7qB,GAAW,KAEzB,KAA0B,EAAlB6qB,OAAO7qB,GAIxBJ,KAAK4hE,mBADoB,CAAEj3B,OAAME,IADrB,+BAA+BvqC,wFACLwqC,YAAS,KASnD82B,mBAAmB/hE,GACjBgiE,UAAWhiE,EAAW8qC,KAAM9qC,EAAWgrC,KACvCi3B,KAAiBD,MACbhiE,EAAWirC,QACb+iB,MAAWhuD,EAAW8qC,MAAMo3B,UAAUliE,EAAWirC,sDA1C1C/pC,GAAiBrB,qCAAjBqB,EAAiBsI,QAAjBtI,EAAiB,qBAFhB,SAEDA,MC4BAihE,iBAGXj6D,YACUlI,EACYC,EACZM,EACAC,EACAC,EACAE,EACAkD,GANA1D,2BACYA,sBACZA,4BACAA,uBACAA,sBACAA,yBACAA,uBATHA,kBAAe,IAAI+I,IAA8B,IAYxDk5D,sBAAsBpiE,EAA+BC,GACnD,IAAKD,EAAQiF,KACX,cAAQuG,MAAMxL,GACR,IAAI4M,MAAM,2BAElB,IAAIrM,EACJ,OAAQP,EAAQiF,KAAKiC,mBACd,MACH3G,EAAaJ,KAAKkiE,oBAAoBriE,GACtC,UACG,SACHO,EAAaJ,KAAKmiE,wBAChBtiE,GAEF,UACG,MACHO,EAAaJ,KAAKoiE,oBAAoBviE,GACtC,UACG,MACH,MAAMQ,EAAaR,EACnB0G,iCAA2ClG,EAAW2rC,QACtD5rC,EAAaJ,KAAKqiE,oBAAoBhiE,EAAYP,GAClD,UACG,OACHM,EAAaJ,KAAKsiE,qBAChBziE,GAEF,UACG,MACHO,EAAaJ,KAAKuiE,oBAAoB1iE,GACtC,UACG,YACHO,EAAaJ,KAAKwiE,0BAA0B3iE,GAC5C,UACG,QACHO,EAAaJ,KAAKyiE,sBAChB5iE,GAEF,UACG,aACHO,EAAaJ,KAAK0iE,2BAChB7iE,EAAwCC,GAE1C,UACG,kBACHM,EAAaJ,KAAK2iE,gCAChB9iE,EAA6CC,GAE/C,UACG,YACHM,EAAaJ,KAAK4iE,0BAChB/iE,GAEF,UACG,MACHO,EAAaJ,KAAK6iE,oBAAoBhjE,GACtC,UACG,iBACHO,EAAaJ,KAAK8iE,+BAChBjjE,EAA4CC,GAE9C,UACG,UACHM,EAAaJ,KAAK+iE,wBAChBljE,GAEF,cAEA,cAAQwL,MAAMxL,GACR,IAAI4M,MAAM,2BAGpB,YAAKu2D,aAAa76D,KAAKnI,KAAKgjE,aAAalhE,MAAMkE,OAAO,CAAC5F,KAEhDA,EAGD8hE,oBACNriE,GAEA,OAAO,IAAI6W,IAAW5W,GAAKA,EAAEqI,KAAK,IAAI86D,GAAcpjE,KAG9CsiE,wBACNtiE,GAEA,OAAO,IAAI6W,IAAW5W,GAAKA,EAAEqI,KAAK,IAAI6jD,GAAkBnsD,KAGlD+iE,0BACN/iE,GAEA,OAAO,IAAI6W,IAAW5W,GAAKA,EAAEqI,KAAK,IAAI+6D,GAAoBrjE,KAGpDuiE,oBACNviE,GAEA,OAAO,IAAI6W,IAAW5W,GACpBA,EAAEqI,KAAK,IAAIg7D,GAActjE,EAASG,KAAKojE,qBAAsBpjE,KAAK2xD,mBAI9D0Q,oBAAoBxiE,EAA+BC,GACzD,MAAMM,EAAc,GACpB,OAAIP,EAAQwjE,yBACVjjE,EAAYQ,KACVZ,KAAKsjE,oBAAoB5F,cAAc79D,GAAS0I,MAC9C,OAAWlI,IACT,MAAMC,EAAQN,KAAK+P,gBAAgB/B,UAAUgC,QAC3C,uCAEIxP,EAAUR,KAAK+P,gBAAgB/B,UAAUgC,QAC7C,iCACA,CAAElO,MAAOjC,EAAQmsC,OAAOsR,SAG1B,WAAKvsC,eAAe1F,MAAM7K,EAASF,GAC7BD,MAMVL,KAAKujE,iBAA6C,IAA3B1jE,EAAQ2jE,gBACjCpjE,EAAYQ,KACVZ,KAAKujE,eAAe7F,cAAc79D,EAASC,GAAoByI,QAC7D0C,KAAW5K,IACTA,EAAEgL,MAAMyF,WAAY,EACpBzQ,EAAEgL,MAAM4D,MAAQjP,KAAK+P,gBAAgB/B,UAAUgC,QAC7C,uCAEF3P,EAAEgL,MAAM2D,QAAUhP,KAAK+P,gBAAgB/B,UAAUgC,QAC/C,+CAEKhE,MAAG,QAMlB5L,EAAYQ,MAAK,QAAGf,OAEbu+D,MAASh+D,GAAamI,MAC3B,OAAKlI,IACH,MAAMC,EAAgBD,EAAQ2G,OAAO,CAACxG,EAAGkD,IACvC6C,YAAsB/F,EAAGkD,IAE3B,OAAO,IAAI8nD,GAAclrD,EAAeN,KAAKojE,2BAE/Cn4D,KAAW,OACFe,WAAG,KAKRs2D,qBACNziE,GAEA,OAAIA,EAAQwjE,wBACHrjE,KAAKsjE,oBAAoBzF,eAAeh+D,GAAS0I,MACtD,OAAKzI,GACIA,EAAU,IAAI2jE,GAAe3jE,QAAW,IAEjD,OAAW,KACT,MAAMA,EAAQE,KAAK+P,gBAAgB/B,UAAUgC,QAC3C,uCAEI5P,EAAUJ,KAAK+P,gBAAgB/B,UAAUgC,QAC7C,iCACA,CAAElO,MAAOjC,EAAQ48C,QAGnB,YAAK1rC,eAAe1F,MAAMjL,EAASN,MAC5BkM,WAAG,MAKT,IAAI0K,IAAW5W,GAAKA,EAAEqI,KAAK,IAAIs7D,GAAe5jE,KAG/C0iE,oBACN1iE,GAEA,OAAO,IAAI6W,IAAW5W,GAAKA,EAAEqI,KAAK,IAAIu7D,GAAc7jE,KAG9C2iE,0BACN3iE,GAEA,OAAO,IAAI6W,IAAW5W,GAAKA,EAAEqI,KAAK,IAAIw7D,GAAoB9jE,KAGpD4iE,sBACN5iE,GAEA,OAAIA,EAAQo+D,MACHj+D,KAAKsjE,oBACTvF,gBAAgBl+D,GAChB0I,MACC,OAAKzI,GAAoC,IAAI8jE,GAAgB9jE,KAG5D,IAAI4W,IAAW5W,GAAKA,EAAEqI,KAAK,IAAIy7D,GAAgB/jE,KAGhD6iE,2BACN7iE,EACAC,GAEA,MAAMM,EAAc,GACpB,SAAYQ,KAAKZ,KAAKsjE,oBAAoBnF,iBAAiBt+D,GAAS0I,MAClE,OAAWlI,IACT,MAAMC,EAAQN,KAAK+P,gBAAgB/B,UAAUgC,QAC3C,uCAEIxP,EAAUR,KAAK+P,gBAAgB/B,UAAUgC,QAC7C,iCACA,CAAElO,MAAOjC,EAAQ48C,QAGnB,WAAK1rC,eAAe1F,MAAM7K,EAASF,GAC7BD,MAGNL,KAAKujE,iBAA6C,IAA3B1jE,EAAQ2jE,gBACjCpjE,EAAYQ,KACVZ,KAAKujE,eAAeM,qBAAqBhkE,EAASC,GAAoByI,QACpE0C,KAAW5K,IACTA,EAAEgL,MAAMyF,WAAY,EACpBzQ,EAAEgL,MAAM4D,MAAQjP,KAAK+P,gBAAgB/B,UAAUgC,QAC7C,uCAEF3P,EAAEgL,MAAM2D,QAAUhP,KAAK+P,gBAAgB/B,UAAUgC,QAC/C,+CAEKhE,MAAG,QAKlB5L,EAAYQ,MAAK,QAAGf,OACbu+D,MAASh+D,GAAamI,MAC3B,OAAKlI,IACH,MAAMC,EAAgBD,EAAQ2G,OAAO,CAACxG,EAAGkD,IACvC6C,YAAsB/F,EAAGkD,IAE3B,OAAO,IAAIogE,GAAqBxjE,QAElC2K,KAAW,OACFe,WAAG,KAKR22D,gCACN9iE,EACAC,GAEA,MAAMM,EAAc,GAEpB,SAAYQ,KAAKZ,KAAKsjE,oBAAoBhF,sBAAsBz+D,GAAS0I,MACvE,OAAWlI,IACT,MAAMC,EAAQN,KAAK+P,gBAAgB/B,UAAUgC,QAC3C,uCAEIxP,EAAUR,KAAK+P,gBAAgB/B,UAAUgC,QAC7C,iCACA,CAAElO,MAAOjC,EAAQmsC,OAAOsR,SAG1B,WAAKvsC,eAAe1F,MAAM7K,EAASF,GAC7BD,MAGNL,KAAKujE,iBAA6C,IAA3B1jE,EAAQ2jE,gBACjCpjE,EAAYQ,KACVZ,KAAKujE,eAAeM,qBAAqBhkE,EAASC,GAAoByI,QACpE0C,KAAW5K,IACTA,EAAEgL,MAAMyF,WAAY,EACpBzQ,EAAEgL,MAAM4D,MAAQjP,KAAK+P,gBAAgB/B,UAAUgC,QAC7C,uCAEF3P,EAAEgL,MAAM2D,QAAUhP,KAAK+P,gBAAgB/B,UAAUgC,QAC/C,+CAEKhE,MAAG,QAKlB5L,EAAYQ,MAAK,QAAGf,OACbu+D,MAASh+D,GAAamI,MAC3B,OAAKlI,IACH,MAAMC,EAAgBD,EAAQ2G,OAAO,CAACxG,EAAGkD,IACvC6C,YAAsB/F,EAAGkD,IAE3B,OAAO,IAAIqgE,GAA0BzjE,QAEvC2K,KAAW,OACFe,WAAG,KAKR82D,+BACNjjE,EACAC,GAEA,MAAMM,EAAc,GACpB,SAAYQ,KAAKZ,KAAKsjE,oBAAoBhF,sBAAsBz+D,GAAS0I,MACvE,OAAWlI,IACT,MAAMC,EAAQN,KAAK+P,gBAAgB/B,UAAUgC,QAC3C,uCAEIxP,EAAUR,KAAK+P,gBAAgB/B,UAAUgC,QAC7C,iCACA,CAAElO,MAAOjC,EAAQmsC,OAAOsR,SAG1B,WAAKvsC,eAAe1F,MAAM7K,EAASF,GAC7BD,MAGNL,KAAKujE,iBAA6C,IAA3B1jE,EAAQ2jE,gBACjCpjE,EAAYQ,KACVZ,KAAKujE,eAAeM,qBAAqBhkE,EAASC,GAAoByI,QACpE0C,KAAW5K,IACTA,EAAEgL,MAAMyF,WAAY,EACpBzQ,EAAEgL,MAAM4D,MAAQjP,KAAK+P,gBAAgB/B,UAAUgC,QAC7C,uCAEF3P,EAAEgL,MAAM2D,QAAUhP,KAAK+P,gBAAgB/B,UAAUgC,QAC/C,+CAEKhE,MAAG,QAKlB5L,EAAYQ,MAAK,QAAGf,OACbu+D,MAASh+D,GAAamI,MAC3B,OAAKlI,IACH,MAAMC,EAAgBD,EAAQ2G,OAAO,CAACxG,EAAGkD,IACvC6C,YAAsB/F,EAAGkD,IAE3B,OAAO,IAAIsgE,GAAyB1jE,QAEtC2K,KAAW,OACFe,WAAG,KAKR62D,oBACNhjE,GAEA,OAAO,IAAI6W,IAAW5W,GAAKA,EAAEqI,KAAK,IAAI87D,GAAcpkE,KAG9CkjE,wBACNljE,GAEA,OAAO,IAAI6W,IAAW5W,GAAKA,EAAEqI,KAAK,IAAI+jD,GAAkBrsD,mDAzX/CkB,GAAiBrB,oGAAjBqB,EAAiBsI,QAAjBtI,EAAiB,qBAFhB,SAEDA,kBCPXA,EACAO,EACAzB,GAEAA,EAAQA,GAAgBwZ,GAGxB,MAAMjZ,OADe8jE,MACMxL,YAAY33D,EAAS,CAC9C8iD,eAAgB9iD,EAAQ0oD,WACxB3F,kBAAmBxiD,IAGrBlB,EAAU+jE,MAAMtkE,EAAMkB,IAEtB,MAAMV,EAAQkgB,GAAexf,QACf,IAAVV,GACFD,EAAUqV,IAAI,SAAUpV,GAAO,QAGV,IAAnBU,EAAQ+pC,QACV1qC,EAAUqV,IAAI,UAAW1U,EAAQ+pC,QAAQ,QAGhB,IAAvB/pC,EAAQ0oD,YACVrpD,EAAUqV,IAAI,cAAe1U,EAAQ0oD,YAAY,GAGnD,MAAMnpD,EAAWwY,GAAkB/X,EAAS,sBAC3B,IAAbT,GACFF,EAAUqV,IAAI,YAAanV,GAAU,GAGvCF,EAAUqV,IAAI,2BrPDkB1U,GAEhC,OADcA,EAAe8X,MAAQ,IACzB6F,UAAY,EqPDV,CAAqC3d,IAAU,GAE7D,MAAMP,EAAO4jE,GAAcrjE,GAC3B,YAAa,IAATP,GACFJ,EAAUqV,IAAI,QAASjV,GAAM,GAG3BO,EAAQ8X,MAAQ9X,EAAQ8X,KAAKwX,OAC/BjwB,EAAUqV,IAAI,SAAU1U,EAAQ8X,KAAKwX,OAAO,GAG1CtvB,EAAQ24C,UACVt5C,EAAUqV,IAAI,YAAa1U,EAAQ24C,UAAU,GAGxCt5C,cA8EPW,EACAO,EACAzB,EACAC,EAAgB,aAEhB,IAAIM,EACAC,EACAC,EACAE,EACJ,MAAMkD,EAAW,IAAIwgE,KAKfrgE,EAHO9C,EAAU00D,UAAUhvD,OAAQQ,IAC/BA,EAAIo9D,WAAW,MAAgB,aAARp9D,GAETD,OAAO,CAACC,EAAa+7C,KAC3C/7C,EAAI+7C,GAAOjiD,EAAU0I,IAAIu5C,GAClB/7C,GACN,IAEGlD,EAAWL,EAAS4gE,oBAAoBvjE,EAAUgxD,cAAe,CACrElO,eAAgB/jD,EAChBgkD,kBAAmBxiD,IAGrB,GAAIzB,EAAS,CACXO,EAAQP,EAAQ4J,IAAI,SACpB,MAAMxC,EAAgBpH,EAAQ4J,IAAI,iBAC9BxC,IACF5G,EAAU4G,EAAcs9D,iBACxBjkE,EAAiB2G,EAAcu9D,wBAC/BhkE,EACEyG,EAAcw9D,WACW,eAAvBx9D,EAAcnC,MAAgD,mBAAvBmC,EAAcnC,KAA6B,gBAAa,SAGrG1E,EAAQW,EAAU0I,IAAI,UAExB,MAAMzF,EAAWjD,EAAU0I,IAAI,aACzB9E,EAAK5D,EAAU0yD,QAAU1yD,EAAU0yD,QAAU1yD,EAAU0I,IAAIjJ,GAAYO,EAAU0I,IAAIjJ,GAAYyI,IAGvG,OAFmBlI,EAAU0I,IAAI,eAE1B,CACL3E,KAAM83C,GACN6M,WAAY3pD,EACZgrC,OAAQ/pC,EAAU0I,IAAI,WACtBoP,KAAM,CACJjU,KACAqK,MAAO7O,GAAgB4D,GAAsBW,EAC7C+/D,WACAhmD,SAAU3d,EAAU4jE,cACpBt0C,MAAOtvB,EAAU0I,IAAI,UACrB86D,iBAAkBlkE,EAClBmkE,wBAAyBlkE,GAE3B6mB,aACA89B,WACAlI,GAAIh8C,eA6DNA,EACAO,GAEA,MAAOzB,EAAOC,GAAU8kE,MAAiB7jE,GACzC,MAAO,CACLO,EAAM,GAAKP,EAAO,GAAKlB,EAAQyB,EAAM,GAAKP,EAAO,GACjDO,EAAM,GAAKP,EAAO,GAAKjB,EAASwB,EAAM,GAAKP,EAAO,GAClDO,EAAM,GAAKP,EAAO,GAAKlB,EAAQyB,EAAM,GAAKP,EAAO,GACjDO,EAAM,GAAKP,EAAO,GAAKjB,EAASwB,EAAM,GAAKP,EAAO,gBAqEpDA,EACAO,EACAzB,EAAwBg9C,GAActkC,QACtCzY,EACAM,GAEA,MAAMC,WAvGNU,EACAO,GAEA,MAAMzB,EAAS+kE,QAEf,SAAW9+D,QAAShG,IAClB,MAAMM,WApCRW,EACAO,GAEA,IAAIzB,EAAW+kE,QAEf,MAAM9kE,EAAkBwB,EAAUmI,IAAI,WAChCrJ,EAAsBkB,EAAUmI,IAAI,eAC1C,QAAwB,IAApB3J,QAAyD,IAAxBM,EACnCP,EAAWguD,MACT/tD,EACAM,EACAW,EAAI0oD,gBAED,CACL,MAAMppD,EAAaiB,EAAUywD,cACV,OAAf1xD,IACFR,EAAWQ,EAAWw1D,aAI1B,OAAOh2D,EAgBCO,CAAuCW,EAAKjB,GAClD8kE,MAAgB/kE,EAAQO,KAGnBP,EA6FDQ,CAAyCU,EAAKO,GACpD,IAAIhB,EAAaD,OACH,IAAVP,IACFQ,EAAaukE,GAAYvkE,EAAYR,IAGvCD,IAAeg9C,GAAcioB,KAC3B/jE,EAAIsqD,eAAe0Z,aAAazkE,GACvBT,IAAWg9C,GAAcmoB,KAClCjkE,EAAIsqD,eAAe4Z,aAAa3kE,GACvBT,IAAWg9C,GAActkC,mBAxEpCxX,EACAO,GAEA,MAGMjB,EAAawkE,GAHD9jE,EAAIsqD,eAAewK,YAEvB,EAAC,GAAI,GAAI,GAAI,GAAInwD,IAAIpF,GADjB,IACsBA,IAQxC,OAAQskE,MAAwBvkE,EAAYiB,GA2DRiX,CAEXxX,EAAKV,aA/C9BU,EACAO,EACAzB,GAIAA,EAAYA,GAAwB,KACpC,MAAMC,EAAYiB,EAAIsqD,eAAewK,YAC/Bz1D,EAAgBwkE,MAAiB9kE,GACjCO,EAAqBukE,MAAiBtjE,GAE5C,QAA2B,IAAvBjB,GAA4BU,EAAIsqD,eAAe6Z,UAAY,KAKxD7kE,EAAqBD,EAAgBP,EA+BdQ,CACDU,EAAKV,EAAgBD,KAE9CW,EAAIsqD,eAAe0Z,aAAazkE,eAoBJS,EAAqBO,QACjC,IAAhBP,EAAM07C,OAOVn7C,EAAQA,GAEJ,IAAI6jE,GAAY,CACd7oD,OAAQ,IAAI0vC,KAElBjrD,EAAMqkE,UAAU9jE,QACQ,IAApBP,EAAM07C,MAAM/2C,KACd3E,EAAM2E,IAAI2/D,SAAStkE,EAAM07C,aAbD,IAApB17C,EAAM07C,MAAM/2C,KACd3E,EAAM2E,IAAI2/D,SAAStkE,EAAM07C,wBC5XgC/d,GAmB7D32B,YAAYzG,EAAezB,GACzBggB,MAAMve,EAAUzB,GAChBG,KAAK0F,IAAM7F,EAAQ6F,iBALnB,OAAO1F,KAAKy8C,MAAQz8C,KAAKy8C,MAAM/1B,gBAAkC,EAanE0+C,UAAU9jE,GACR,YAAKm7C,MAAQn7C,EACNtB,KASTslE,iBACEhkE,EACAzB,EAAwBg9C,GAActkC,QACtCzY,EACAM,EACAC,GAEAA,EAAQA,GAAgBgZ,GACxBrZ,KAAKulE,aAEL,MAAMjlE,EAAagB,EAChBoE,IAAKlF,GAAqBglE,GAAYhlE,EAASR,KAAK0F,IAAI+jD,WAAYppD,IACvEL,KAAKylE,mBAAmBnlE,EAAYT,EAAQC,EAAWM,GAOzDslE,mBAAmBpkE,GACjBtB,KAAKulE,aAEL,MAAM1lE,EAAWyB,EAAWoE,IAAK5F,IAC/BA,EAAU2V,IAAI,gBAAiBzV,MAAM,GAC9B2lE,GAAc7lE,EAAWE,KAAKy8C,MAAM/2C,IAAI+jD,cAEjDzpD,KAAK4K,KAAK/K,GAMZ+lE,aACE5lE,KAAKulE,aACLvlE,KAAKsc,OAAOygC,GAAG7mC,QAMTqvD,aACN,QAAmB,IAAfvlE,KAAKy8C,MACP,MAAM,IAAIhwC,MAAM,8CASbg5D,mBACLnkE,EACAzB,EAAwBg9C,GAActkC,QACtCzY,EACAM,GAEA,MACME,WDiTRS,EACAO,GAKA,MAAMzB,EAAgB,IAAIwW,IAC1B/U,EAAOwE,QAASxF,IACdT,EAAc4V,IAAInV,EAAUmzD,QAASnzD,KAGvC,MAAMR,EAAqB,GAC3BiB,EAAO+E,QAASxF,IACd,MAAME,EAAeX,EAAc4J,IAAInJ,EAAUmzD,cAC5B,IAAjBjzD,GAGFA,EAAaiJ,IAAI,qBAAuBnJ,EAAUmJ,IAAI,mBAFtD3J,EAAmBc,KAAKN,GAMxBT,EAAc8J,OAAOnJ,EAAaizD,WAItC,MAAMrzD,EAAqB+D,MAAMgL,KAAKtP,EAAcgG,QAKpD,MAAO,CACLm2B,IALsB16B,EAAOmF,OAAQnG,GAC9BF,EAAmBF,QAAQI,EAAUmzD,UAAY,GAKxDtjD,OAAQrQ,GCjVFQ,CADWN,KAAKy8C,MAAMM,GAAGqO,YACayI,cAAevyD,GACvDhB,EAAK6P,OAAO5P,OAAS,GACvBP,KAAK6lE,0BAA0BvlE,EAAK6P,QAGlC7P,EAAK07B,IAAIz7B,OAAS,GACpBP,KAAK8lE,qBAAqBxlE,EAAK07B,KAG7B17B,EAAK07B,IAAIz7B,OAAS,EAEpBwlE,GAAiB/lE,KAAK0F,IAAKpF,EAAK07B,IAAKn8B,EAAQC,EAAWM,GAC/CE,EAAK6P,OAAO5P,OAAS,GAE9BwlE,GAAiB/lE,KAAK0F,IAAKpE,EAAYzB,EAAQC,EAAWM,GAQtD0lE,qBAAqBxkE,GAC3BA,EAAWwE,QAASjG,IAClBA,EAAU4V,IAAI,gBAAiBzV,MAAM,KAEvCA,KAAKsc,OAAOygC,GAAGsX,YAAY/yD,GAOrBukE,0BAA0BvkE,GAChCA,EAAWwE,QAASjG,IAClBG,KAAKsc,OAAOygC,GAAG4b,cAAc94D,uBC9IkB+f,GASnD7X,YAAsBzG,GACpBue,MAAMve,GADctB,eAJdA,cAAW,IAAIqW,IACfrW,cAA2B,GAWnC8d,UAAUxc,GACRue,MAAM/B,UAAUxc,IACI,IAAhBtB,KAAKwf,QACPxf,KAAKgmE,WAAW1kE,GAElBtB,KAAKimE,QAAU3kE,EAAMiZ,OAClBhS,QAAK29D,MAAWrmE,IAAWA,IAC3BuI,UAAU,IAAMpI,KAAKmmE,uBAAuB7kE,IAOjD2c,YAAY3c,GACVue,MAAM5B,YAAY3c,IACE,IAAhBtB,KAAKwf,QACPxf,KAAKomE,aAAa9kE,GAQZoe,aACR1f,KAAK2f,OAAO7Z,QAASxE,GAAwBtB,KAAKgmE,WAAW1kE,IAOrDme,eACRzf,KAAKqmE,aAOCL,WAAW1kE,GACbtB,KAAKsmE,SAASlmD,IAAI9e,KAItBtB,KAAKmmE,uBAAuB7kE,GAC5BtB,KAAKumE,SAAS3lE,KAAKU,EAAMm7C,MAAM/2C,IAAI2lD,eAAemb,OAAOp+D,UAAU,KACjEpI,KAAKmmE,uBAAuB7kE,OAIxB6kE,uBAAuB7kE,WAC7B,GAAqB,QAAjBxB,EAAY,QAAZD,EAAK,MAALyB,OAAK,EAALA,EAAOm7C,aAAK,eAAE/2C,WAAG,eAAE2lD,eAAgB,CACrC/pD,EAAMwW,MAAMkC,UAAU,CAAEysD,aAAa,IACrC,MAAMrmE,EAAYkB,EAAMm7C,MAAM/2C,IAAI2lD,eAAewK,YACjD,IAAIx1D,EAAsB,GACtBC,EAAqB,GACzB,UAAWE,KAAUc,EAAMgc,UAAUxb,MAC/BtB,EAAOu8C,GACL6nB,MAAoBpkE,EAAOu8C,GAAGgV,cAAc8D,YAAaz1D,IAC3DC,EAAoBO,KAAKJ,GAG3BF,EAAmBM,KAAKJ,GAGxBH,EAAoBE,OAAS,GAC/Be,EAAMwW,MAAM6B,WAAWtZ,EAAqB,CAAEomE,aAAa,IAAQ,GAEjEnmE,EAAmBC,OAAS,GAC9Be,EAAMwW,MAAM6B,WAAWrZ,EAAoB,CAAEmmE,aAAa,IAAQ,IAShEL,aAAa9kE,QAEP,IAARtB,KADasmE,SAAS78D,IAAInI,IAE5BtB,KAAKsmE,SAAS38D,OAAOrI,GAOjB+kE,aACNrmE,KAAKsmE,SAASpwD,QACdlW,KAAKumE,SAAS7gE,IAAIpE,GAASA,EAAMoH,eAC7B1I,KAAKimE,SAAWjmE,KAAKimE,QAAQv9D,gCChHoBkX,GASvD7X,YAAsBzG,GACpBue,MAAMve,GADctB,eAJdA,cAAW,IAAIqW,IACfrW,kBAA+B,GAWvC8d,UAAUxc,GACRue,MAAM/B,UAAUxc,IACI,IAAhBtB,KAAKwf,QACPxf,KAAKgmE,WAAW1kE,GAElBtB,KAAKimE,QAAU3kE,EAAMiZ,OAClBnS,UAAU,IAAMpI,KAAK0mE,2BAA2BplE,EAAOA,EAAMm7C,MAAM/2C,IAAI2lD,eAAe0F,kBAO3F9yC,YAAY3c,GACVue,MAAM5B,YAAY3c,IACE,IAAhBtB,KAAKwf,QACPxf,KAAKomE,aAAa9kE,GAQZoe,aACR1f,KAAK2f,OAAO7Z,QAASxE,GAAwBtB,KAAKgmE,WAAW1kE,IAOrDme,eACRzf,KAAKqmE,aAOCL,WAAW1kE,GACbtB,KAAKsmE,SAASlmD,IAAI9e,KAItBtB,KAAK0mE,2BAA2BplE,EAAOA,EAAMm7C,MAAM/2C,IAAI2lD,eAAe0F,iBACtE/wD,KAAK6wD,aAAajwD,KAAKU,EAAMm7C,MAAM/2C,IAAI2lD,eAAeyF,YAAY1oD,UAAWvI,IAC3EG,KAAK0mE,2BAA2BplE,EAAOzB,OAInC6mE,2BAA2BplE,EAAOzB,GAEtCyB,EAAMwW,MAAMkC,UADVna,EAAgByB,EAAMm7C,MAAMkO,eAAiB9qD,EAAgByB,EAAMm7C,MAAMwS,cACrD,CAAE0X,iBAAiB,GAEnB,CAAEA,iBAAiB,IAQrCP,aAAa9kE,QAEP,IAARtB,KADasmE,SAAS78D,IAAInI,IAE5BtB,KAAKsmE,SAAS38D,OAAOrI,GAOjB+kE,aACNrmE,KAAKsmE,SAASpwD,QACdlW,KAAK6wD,aAAanrD,IAAIpE,GAASA,EAAMoH,eACjC1I,KAAKimE,SAAWjmE,KAAKimE,QAAQv9D,gCCxFYkX,GAS/C7X,YAAsBzG,GACpBue,MAAMve,GADctB,eAJdA,cAAW,IAAIqW,IAMrBrW,KAAK4mE,UAAUtlE,EAAQulE,QAOzB/oD,UAAUxc,GACRue,MAAM/B,UAAUxc,IACI,IAAhBtB,KAAKwf,QACPxf,KAAKgmE,WAAW1kE,GAQpB2c,YAAY3c,GACVue,MAAM5B,YAAY3c,IACE,IAAhBtB,KAAKwf,QACPxf,KAAKomE,aAAa9kE,GAQtBslE,UAAUtlE,GACRtB,KAAK6mE,OAASvlE,EAONoe,aACR1f,KAAK2f,OAAO7Z,QAASxE,GAAwBtB,KAAKgmE,WAAW1kE,IAOrDme,eACRzf,KAAKqmE,aAUCL,WAAW1kE,GACjB,GAAItB,KAAKsmE,SAASlmD,IAAI9e,GACpB,OAGF,MAAMzB,EAAeyB,EAAM2b,KAAKtC,OAC7BvS,UAAWtI,GAAwBE,KAAK8mE,iBAAiBhnE,EAAUwB,IACtEtB,KAAKsmE,SAAS7wD,IAAInU,EAAOzB,GAOnBumE,aAAa9kE,GACnB,MAAMzB,EAAeG,KAAKsmE,SAAS78D,IAAInI,QAClB,IAAjBzB,IACFA,EAAa6I,cACb1I,KAAKsmE,SAAS38D,OAAOrI,IAOjB+kE,aACNliE,MAAMgL,KAAKnP,KAAKsmE,SAASnsD,WAAWrU,QAASxE,IAC3CA,EAAQ,GAAGoH,gBAEb1I,KAAKsmE,SAASpwD,QAQR4wD,iBAAiBxlE,EAAqBzB,GACpB,IAApByB,EAASf,OACXV,EAAM+lE,aAEN/lE,EAAMylE,iBACJhkE,EACAtB,KAAK+mE,aAAalnE,GAClBG,KAAK4O,QAAQo4D,UACbhnE,KAAK4O,QAAQq4D,UACbjnE,KAAK4O,QAAQs4D,cAUXH,aAAazlE,GACnB,YAAoB,IAAhBtB,KAAK6mE,OAA+B7mE,KAAK6mE,QAEtB,IAAnBvlE,EAAM6lE,UAGC7lE,EAAMwF,MAAQxF,EAAM2b,KAAKnW,MAD3B+1C,GAActkC,QAMdskC,GAAclkC,uBCtI2BiH,GAOpD7X,YAAsBzG,GACpBue,MAAMve,GADctB,eAFdA,cAAW,IAAIqW,IAUvByH,UAAUxc,GACRue,MAAM/B,UAAUxc,IACI,IAAhBtB,KAAKwf,QACPxf,KAAKgmE,WAAW1kE,GAQpB2c,YAAY3c,GACVue,MAAM5B,YAAY3c,IACE,IAAhBtB,KAAKwf,QACPxf,KAAKomE,aAAa9kE,GAQZoe,aACR1f,KAAK2f,OAAO7Z,QAASxE,GAAwBtB,KAAKgmE,WAAW1kE,IAOrDme,eACRzf,KAAKqmE,aAOCL,WAAW1kE,GACbtB,KAAKsmE,SAASlmD,IAAI9e,KAItBtB,KAAKonE,gBAAgB9lE,GAErBA,EADuBm7C,MAAMM,GAAGqO,YACvBtiD,GAAG,SAAWhJ,IACrBE,KAAKonE,gBAAgB9lE,MAQjB8kE,aAAa9kE,QAEP,IAARtB,KADasmE,SAAS78D,IAAInI,IAE5BtB,KAAKsmE,SAAS38D,OAAOrI,GAOjB+kE,aACNliE,MAAMgL,KAAKnP,KAAKsmE,SAASnsD,WAAWrU,QAASxE,OAE7CtB,KAAKsmE,SAASpwD,QAQRkxD,gBAAgB9lE,GACtB,IAAIzB,EAAayB,EAAMm7C,MAAMM,GAAGqO,YAAYyI,cAExCvyD,EAAMm7C,MAAM/1B,sBAAsBwlC,KACpCrsD,EAAcA,EAAmBwnE,QAASvnE,GACxCA,EAAQ2J,IAAI,cAGU,IAAtB5J,EAAWU,OACbe,EAAM4U,QAEN5U,EAAMokE,mBAAmB7lE,qBC5FcynE,KAC3Cv/D,YAAYzG,GACVue,MAAMve,qBAcyCse,GAkCjD7X,YAAsBzG,GACpBue,MAAMve,GADctB,eAEpBA,KAAK4mE,UAAUtlE,EAAQulE,QACvB7mE,KAAKunE,cAAgBvnE,KAAKwnE,+BAf1B,OAAOxnE,KAAK4O,QAAQlJ,uBAQpB,OAAO1F,KAAKunE,cAedzpD,UAAUxc,GACRue,MAAM/B,UAAUxc,IACI,IAAhBtB,KAAKwf,QAEPxf,KAAK+d,WASTE,YAAY3c,GACVue,MAAM5B,YAAY3c,IACE,IAAhBtB,KAAKwf,QAEPxf,KAAK+d,WAQT6oD,UAAUtlE,GACRtB,KAAK6mE,OAASvlE,EAMhBmmE,cACEznE,KAAK2f,OAAO7Z,QAASxE,IACnBA,EAAMwW,MAAMkC,UAAU,CAAEqG,UAAU,MAOtCnK,QACElW,KAAK0nE,aAAaprD,OAAOygC,GAAG7mC,QAC5BlW,KAAK0nE,aAAaxxD,QAOpByxD,sBACE3nE,KAAK4nE,qBACL5nE,KAAK6nE,2BACL7nE,KAAKqmE,aAQG3mD,aACR1f,KAAK8nE,kBACL9nE,KAAK+nE,oBACwB,IAAzB/nE,KAAK4O,QAAQo5D,SACfhoE,KAAKioE,wBAEPjoE,KAAKkoE,WAQGzoD,eACRzf,KAAK2nE,sBACL3nE,KAAKmoE,qBASCD,WACNloE,KAAKqmE,aAEL,MAAM/kE,EAAUtB,KAAK2f,OAAOja,IAAK7F,GACxBA,EAAMsd,UACVnC,QAASlb,IACyB,IAA1BA,EAAOgY,MAAMuI,UAErB9X,QACCsmD,KAAK/uD,GACHA,EAAQ4F,IAAKtF,GAAWA,EAAOoe,WAIvCxe,KAAKsmE,UAAW,QAAchlE,GAC3BiH,QACC8P,KAAa,MACb4D,MAAK,IACL,OAAKpc,GACHA,EAASmH,OAAO,CAAClH,EAAGM,IAAMN,EAAEkG,OAAO5F,MAGtCgI,UAAWvI,GAAwBG,KAAK4gB,kBAAkB/gB,IAMvDwmE,kBACgB,IAAlBrmE,KAAKsmE,UACPtmE,KAAKsmE,SAAS59D,cASVq/D,mBACN/nE,KAAKooE,iBAAmBpoE,KAAK0F,IAAIq3C,GAAGj0C,GAClC,cACCxH,IACCtB,KAAKqoE,WAAW/mE,KAQdsmE,sBACN,QAAQ5nE,KAAKooE,kBAOPC,WAAW/mE,GACjB,MAAMzB,GAAayoE,GAAYhnE,GACzBxB,GAAWD,EACXO,EAAakB,EAAMoE,IAAI6iE,mBAAmBjnE,EAAMknE,MAAO,CAC3DC,aAAczoE,KAAK4O,QAAQ65D,cAAgB,EAC3CC,YAAaroE,QAIa,IAHHL,KAAK2f,OAAO9E,KAAMra,GAC9BA,EAAMi8C,MAAMM,KAAO18C,KAKhCL,KAAK2oE,gBAAgBvoE,EAAYP,EAAWC,GAMtCmoE,wBACN,IAAI3mE,EACJ,MAAMzB,EAAiBG,KAAK0F,IAAIq3C,GAAG6rB,kBAAkBC,WAKrD,UAAW/oE,KAAiBD,EAC1B,GAAIC,aAAyBgpE,GAAyB,CACpDxnE,EAA0BxB,EAC1B,WAI4B,IAA5BwB,IACFA,EAA0B,IAAIwnE,GAAwB,CACpDrsC,UAAW6rC,KAEbtoE,KAAK0F,IAAIq3C,GAAGgsB,eAAeznE,GAC3BtB,KAAKgpE,wBAA0B1nE,GAGjCtB,KAAKipE,8BAAgC3nE,EAAwBwH,GAC3D,SACChJ,GAAwBE,KAAKkpE,aAAappE,IAOvC+nE,gCACqC,IAAvC7nE,KAAKipE,gCACP,QAAQjpE,KAAKipE,oCAEsB,IAAjCjpE,KAAKgpE,yBACPhpE,KAAK0F,IAAIq3C,GAAGosB,kBAAkBnpE,KAAKgpE,yBAErChpE,KAAKgpE,6BAA0B,EAOzBE,aAAa5nE,GACnB,MAAMzB,GAAayoE,GAAYhnE,EAAM8nE,iBAE/BhpE,EADSkB,EAAM8lB,OACC2qC,cAAc8D,YAC9Bx1D,EAAaL,KAAK2f,OAAO3Y,OAC7B,CAAC1G,EAA8BE,KAC7B,MAAMkD,EAAWlD,EAAMi8C,MAAMM,GAAGqO,YAChC,SAAIxqD,QAAQ8C,EAAS2lE,oBAAoBjpE,IAClCE,GAET,IAEFN,KAAK2oE,gBAAgBtoE,EAAYR,GAAW,GAQtC+gB,kBAAkBtf,GACxB,MAAMzB,EAASG,KAAK6mE,OAIdzmE,EAAsBJ,KAHG0nE,aAAajrB,MAAMM,GAC/CqO,YACAyI,cAC2CnuD,IAAKlF,GACjDA,EAAUizD,SAENpzD,EAAeiB,EAASoE,IAAI1F,KAAK0nE,aAAatuD,QAEpD,IAAI9Y,EAEFA,EADsB,IAApBgB,EAASf,SAITH,EAAoBG,SAAWF,EAAaE,SAC3CH,EAAoBsc,MAClBlc,GAAmBH,EAAaH,QAAQM,IAAQ,IAIvDR,KAAK0nE,aAAapC,iBAChBhkE,EACAhB,EAAWT,EAASg9C,GAAclkC,KAClC3Y,KAAK4O,QAAQo4D,UACbhnE,KAAK4O,QAAQq4D,UACbjnE,KAAK4O,QAAQs4D,cASTyB,gBACNrnE,EACAzB,EACAC,GAEA,MAAMM,EAAkBJ,KAAKspE,qBAAqBhoE,GAElDtB,KAAK2f,OAAO7Z,QAASzF,IACnB,MAAMC,EAAWF,EAAgBqJ,IAAIpJ,QACpB,IAAbC,IAAwC,IAAdT,EAC5BG,KAAKupE,6BAA6BlpE,QACZ,IAAbC,IAAwC,IAAdT,GAGnCG,KAAKwpE,wBAAwBnpE,EAAOC,EAAUT,EAAWC,KAUvD0pE,wBACNloE,EACAzB,EACAC,EACAM,IAEgB,IAAZA,EACFkB,EAAMwW,MAAMgC,YAAYja,EAAU,CAAC,aAEnCyB,EAAMwW,MAAM6B,WAAW9Z,EAAU,CAAEwgB,UAAU,GAAQvgB,GAQjDypE,6BAA6BjoE,GACnCA,EAAMwW,MAAMkC,UAAU,CAAEqG,UAAU,IAU5BipD,qBACNhoE,GAEA,MAAMzB,EAAkB,IAAIwW,IAC5B,OAAmB,MAAf/U,GAIJA,EAAWwE,QAAShG,IAClB,MAAMM,EAAQN,EAAU2J,IAAI,iBAC5B,QAAc,IAAVrJ,EACF,OAGF,IAAIC,EAAWR,EAAgB4J,IAAIrJ,QAClB,IAAbC,IACFA,EAAW,GACXR,EAAgB4V,IAAIrV,EAAOC,IAG7B,MAAMC,EAAUF,EAAMqJ,IAAI3J,EAAU2zD,cACpB,IAAZnzD,GACFD,EAASO,KAAKN,KAIXT,EAOD2nE,qBACN,MAAMlmE,EAAetB,KAAK4O,QAAQ6tC,MAC9Bz8C,KAAK4O,QAAQ6tC,MACbz8C,KAAKypE,qBACT,OAAO,IAAIC,GAAa,GAAI,CAAEhkE,IAAK1F,KAAK0F,MAAO0/D,UAAU9jE,GAOnDmoE,qBACN,OAAO,IAAItE,GAAY,CACrBpW,OAAQ,IACRzyC,OAAQ,IAAI0vC,GACZ37B,WAAO,EACPigC,iBAAiB,EACjBa,YAAY,EACZD,WAAW,IAQP4W,uBAC8B,IAAhC9nE,KAAK0nE,aAAajrB,MAAM/2C,KAC1B1F,KAAK0F,IAAI2/D,SAASrlE,KAAK0nE,aAAajrB,OAOhC0rB,qBACNnoE,KAAK0nE,aAAaprD,OAAOygC,GAAG7mC,QAC5BlW,KAAK0F,IAAIikE,YAAY3pE,KAAK0nE,aAAajrB,oBC5czC17C,EACAO,QAE6D,IAAzDP,EAAMmd,kBAAkB0rD,KAK5BtoE,EAAWA,GAAsB,IAAIsoE,GAA4B,IACjE7oE,EAAM6c,YAAYtc,GAClBA,EAASyc,YANPhd,EAAMod,uBAAuByrD,gBAgB/B7oE,EACAO,QAE+D,IAA3DP,EAAMmd,kBAAkB2rD,KAI5BvoE,EAAWA,GAEP,IAAIuoE,GAA8B,CAChCnkE,IAAK3E,EAAM2E,MAEjB3E,EAAM6c,YAAYtc,GAClBA,EAASyc,YATPhd,EAAMod,uBAAuB0rD,iBC3B/Bv6D,OACAm7C,UAAU,EACVqf,cAAc,CAAC,EAAG,IAAK,KACvBC,qBAAqB,CAAC,IAAK,IAAK,MAM9B,IACF,IAAI3pE,EACAC,EACAC,EACAE,EAEJ,MAAMkD,EAAO,2BAA2BwhB,KAAKhkB,OAAOC,UAAUC,WAExDwC,GAAWsuD,SAAaryD,GAAauD,MAAM,GAC3CS,GAAkBquD,SAAapyD,GAAoBsD,MAAM,GAoB/D,IAAIW,EACJ,GAnBwB,IAApBH,EAASrD,SAAwC,iBAAhBV,GAA4B,kBAAkBqlB,KAAKrlB,MACtFyB,EAAUsC,EAAS,IAGrBvD,EAAe,SAASuD,EAAS,MAAMA,EAAS,MAAMA,EAAS,MAAMtC,MACrElB,EAAYP,EAEZS,EAAkB,QAAQuD,EAAgB,MAAMA,EAAgB,MAAMA,EAAgB,OAEtFrD,EACE,uIAEAH,EACA,WACAC,EACA,6tIAIEoD,EAAM,CACR,OAAQ7D,OACD,OACHO,EAAY,OACZ,UACG,MACHA,EAAY,MACZ,UACG,SACHA,EAAY,SACZ,UACG,QACHA,EAAY,QACZ,cAEAA,EAAY,OAGhB2D,EAAM,iCAAmC3D,EAAY,iBAErD2D,EAAMvD,EAGR,OAAO,IAAI45D,MAAc,CACvBtsB,MAAO,IAAIwtB,KAAa,CACtBnnB,IAAK3zC,EACLiqD,UACAuf,QAAS,CAAC,GAAI,IACdC,OAAQ,CAAC,GAAK,OAEhB36D,KAAM,IAAI+qD,KAAa,CACrB/qD,OACAmrD,KAAM,0BACNH,KAAM,IAAIC,KAAa,CAAE9pC,MAAO,SAChC+qC,OAAQ,IAAIC,KAAe,CAAEhrC,MAAO,OAAQgnC,MAAO,IACnDyS,UAAU,UCnEHC,iBAsCXC,YAAYvqE,EAAiCC,EAAiDM,eAE5F,IAAKP,EACH,OAAOwqE,KAET,GAAuB,mBAAZxqE,GAA0BA,aAAmBu6D,MACtD,OAAOv6D,EAET,MAAM+D,EAAc5D,KAAKsqE,WAAW,QAASzqE,GAC7C,GAAI+D,EAAYy4D,UAAW,CACzB,IAAIx4D,EAAqB,EACrBE,EAAqB,IACzB,GAAIlE,EAAQyP,KAAM,CAChB,MAAMtL,GACQ,QAAZ3D,IAAQiP,YAAI,eAAE8/C,eAAgBF,GAAuBjkC,OAAOprB,EAAQyP,KAAK8/C,qBAAkB,EACvFzqD,GACQ,QAAZrE,IAAQgP,YAAI,eAAE6/C,eAAgBD,GAAuBjkC,OAAOprB,EAAQyP,KAAK6/C,qBAAkB,EACvFrM,GAA4B,QAAZtiD,IAAQ8O,YAAI,eAAEq7C,eAAgB9qD,EAAQyP,KAAKq7C,cAAgB,EAC3E1jD,GAA4B,QAAZvD,IAAQ4L,YAAI,eAAE2/C,eAAgBpvD,EAAQyP,KAAK2/C,cAAgB,IAEjFprD,EAAqBG,GAA+B8+C,EACpD/+C,EAAqBY,GAA+BsC,EAElDnH,GAAWM,GAAcyD,GAAsBzD,GAAc2D,EAC3DjE,GAAWD,EAAQyP,KAAKi7D,WAC1B3mE,EAAYy4D,UAAUvJ,QAAQ9yD,KAAKwqE,SAAS1qE,EAASD,EAAQyP,KAAKi7D,YAGpE3mE,EAAYkvD,UAGhB,OAAOlvD,EAGD0mE,WAAWzqE,EAAaC,GAC9B,MAAMM,EAAe,GACfC,EAAQL,KAAKyqE,SAAS5qE,GAE5B,OAAIQ,GAASP,aAAiB8F,QAC5BA,OAAOC,KAAK/F,GAAOgG,QAAQxF,IACzB,MAAME,EAAQR,KAAK0qE,SAASpqE,GAC5BF,EAAaI,GAASR,KAAKsqE,WAAWhqE,EAAMR,EAAMQ,MAE7C,IAAID,EAAMD,IAEVN,EAIH4qE,SAAS7qE,GACf,IAAIC,EACJ,OAAQD,EAAIkH,mBACL,aACA,mBACA,OACHjH,EAAQ,QAMZ,OAAOA,GAASD,EAGV4qE,SAAS5qE,GACf,IAAIC,EAAQ6qE,GAAQ9qE,EAAIM,OAAO,GAAG0G,cAAgBhH,EAAIuD,MAAM,IAC5D,MAAY,iBAARvD,IACFC,EAAQ+7D,MAEE,mBAARh8D,IACFC,EAAQy6D,MAEE,qBAAR16D,IACFC,EAAQ27D,MAGH37D,EAGT8qE,uBAAuB/qE,EAAgDC,EAAoCM,iBAEzG,IAAIyD,EACJ,MAAME,EAAOjE,EAAiBgF,KAAOhF,EAAiBgF,KAAO9E,KAAK6qE,iBAAiBhrE,GAC7EmE,EAAYlE,EAAiByqE,UAC7B5lE,EAAO7E,EAAiBypB,KACxBu5B,EAAShjD,EAAiB07D,OAC1Bv0D,EAAQnH,EAAiB23D,MACzBzU,EAAOljD,EAAiBw6D,KACxBrX,EAASnjD,EAAiBmqE,OAC1B5mB,EAASvjD,EAAiBiuD,OAC1BvK,EAAO1jD,EAAiBmZ,KACxByqC,EAAQ5jD,EAAiB0pD,MACzBvC,EAAOtiD,EAAOA,EAAKpE,OAAS,EAC5B+mD,EAAQxnD,EAAiBu3D,MAAQv3D,EAAiBu3D,MAAMkT,eAAY,EACpEO,GACkB,QAAtBzqE,IAAiBg3D,aAAK,eAAEjI,eAAgBF,GAAuBjkC,OAAOnrB,EAAiBu3D,MAAMjI,qBAAkB,EAC3G7H,GACkB,QAAtBjnD,IAAiB+2D,aAAK,eAAElI,eAAgBD,GAAuBjkC,OAAOnrB,EAAiBu3D,MAAMlI,qBAAkB,EAC3G3H,GAAsC,QAAtBhnD,IAAiB62D,aAAK,eAAE1M,eAAgB7qD,EAAiBu3D,MAAM1M,cAAgB,EAC/FxD,GAAsC,QAAtBzjD,IAAiB2zD,aAAK,eAAEpI,eAAgBnvD,EAAiBu3D,MAAMpI,cAAgB,IAE/F7H,EAAqB0jB,GAA+BtjB,EACpD4E,EAAqB7E,GAA+BJ,EAE1D,IAAIkF,GAAmC,QAAtBzoD,IAAiByzD,aAAK,eAAEhnC,OAAQrwB,KAAKsqE,WAAW,OAAQxqE,EAAiBu3D,MAAMhnC,YAAS,GACpGg8B,GAAc/E,IACf+E,EAAa,IAAIgO,MAErB,MAAM/N,EAAYxsD,EAAiBirE,UAUnC,GARI1e,GAEAA,EAAWyG,QADT1yD,GAAcgnD,GAAsBhnD,GAAcgsD,EACjCpsD,KAAKwqE,SAAS3qE,EAASynD,GAEvB,IAIV,WAATvjD,EAAmB,CACrB,QAASwoD,EAAI,EAAGA,EAAItF,EAAMsF,IAAK,CAC7B,MAAMC,OAC8B,IAA3B3sD,EAAQ4J,IAAIzF,IAAyD,OAA3BnE,EAAQ4J,IAAIzF,GACzDnE,EAAQ4J,IAAIzF,GACZ,GACN,GAAIwoD,IAAQ7nD,EAAK4nD,IAAMC,EAAIvpD,WAAWoL,MAAM,IAAI4W,OAAOtgB,EAAK4nD,GAAI,QAC9D,OAAI/I,GACF3/C,EAAQ,CACN,IAAIu2D,MAAc,CAChBtsB,MAAO,IAAIwtB,KAAa,CACtB7qC,MAAOuyB,EAAOA,EAAKuJ,QAAK,EACxBpY,IAAKqP,EAAK+I,GACV/C,MAAO9F,EAAQA,EAAM6I,GAAK,EAC1B0d,OAAQhnB,EAASA,EAAOsJ,GAAK,CAAC,GAAK,MAErCj9C,KAAM+8C,aAAsBgO,KAAehO,OAAa,KAGrDxoD,IAETA,EAAQ,CACN,IAAIu2D,MAAc,CAChBtsB,MAAO,IAAI8tB,KAAe,CACxB7N,OAAQ1K,EAASA,EAAOkJ,GAAK,EAC7BiP,OAAQ,IAAIC,KAAe,CACzBhrC,MAAOqyB,EAASA,EAAOyJ,GAAK,QAC5BkL,MAAOxwD,EAAQA,EAAMslD,GAAK,IAE5B+N,KAAM,IAAIC,KAAa,CACrB9pC,MAAOuyB,EAAOA,EAAKuJ,GAAK,YAG5Bj9C,KAAM+8C,aAAsBgO,KAAehO,OAAa,KAGrDxoD,GAGX,IAAMhE,EAAkC0/D,WACtC,OAAIjT,GACFzoD,EAAQ7D,KAAKoqE,YAAY9d,EAAWzsD,EAASO,GACzCisD,GACFxoD,EAAMivD,QAAQzG,GAETxoD,IAETA,EAAQ,CACN,IAAIu2D,MAAc,CAChBtsB,MAAO,IAAI8tB,KAAe,CACxB7N,OAAQ,EACRyN,OAAQ,IAAIC,KAAe,CACzBhrC,MAAO,UAET6pC,KAAM,IAAIC,KAAa,CACrB9pC,MAAO,iBAKR5sB,WAES,YAATE,EAAoB,CAC7B,QAASwoD,EAAI,EAAGA,EAAItF,EAAMsF,IAAK,CAC7B,MAAMC,OAC4B,IAA3B3sD,EAAQ4J,IAAIzF,IAAyD,OAA3BnE,EAAQ4J,IAAIzF,GACvDnE,EAAQ4J,IAAIzF,GACZ,GACN,GAAIwoD,IAAQ7nD,EAAK4nD,IAAMC,EAAIvpD,WAAWoL,MAAM,IAAI4W,OAAOtgB,EAAK4nD,GAAI,QAC9D,SAAQ,CACN,IAAI6N,MAAc,CAChBoB,OAAQ,IAAIC,KAAe,CACzBhrC,MAAOqyB,EAASA,EAAOyJ,GAAK,QAC5BkL,MAAOxwD,EAAQA,EAAMslD,GAAK,IAE5B+N,KAAM,IAAIC,KAAa,CACrB9pC,MAAOuyB,EAAOA,EAAKuJ,GAAK,0BAE1Bj9C,KAAM+8C,aAAsBgO,KAAehO,OAAa,KAGrDxoD,EAGX,GAAIhE,aAAmBmrE,OAChBnrE,EAAQ0/D,WACX,OAAIjT,GACFzoD,EAAQ7D,KAAKoqE,YAAY9d,EAAWzsD,EAASO,GACzCisD,GACFxoD,EAAMivD,QAAQzG,GAETxoD,IAETA,EAAQ,CACN,IAAIu2D,MAAc,CAChBoB,OAAQ,IAAIC,KAAe,CACzBhrC,MAAO,UAET6pC,KAAM,IAAIC,KAAa,CACrB9pC,MAAO,eAIN5sB,IAMfonE,mBAAmBprE,EAAgDC,EAAoBM,EAA6B,GAAIC,GACtH,IAAIC,EACJ,MAAME,EAAOX,EAAQ4J,IAAI,YAAYlJ,OACrC,GAAa,IAATC,EAAY,CACd,GAAIJ,EAAa8qE,cACf,UAAWxnE,KAAKtD,EAAa8qE,cAC3B,KACIxnE,EAAEynE,WAAaznE,EAAEynE,WAAa3qE,MAC9BkD,EAAE0nE,WAAa1nE,EAAE0nE,WAAa5qE,GAChC,CAGA,GAFAF,EAAQN,KAAKoqE,YAAY1mE,EAAE2sB,OAEvB3sB,EAAE2nE,UAAW,CACf,MAAMznE,EAAO,IAAIy2D,KAAa,CAC5B/qD,KAAM9O,EAAKyC,WACXq3D,KAAM,IAAIC,KAAa,CACrB9pC,MAAO,WAGXnwB,EAAMwyD,QAAQlvD,GAGhB,GAAIF,EAAE4nE,cAAe,CACnB,IAAI1nE,EACJ,MAAMC,EAAYvD,EAAMgyD,YACxB1uD,EAAgB,EAAI2D,KAAK4D,IAAI3K,GACzBoD,EAAgBC,IAClBD,EAAgBC,GAElBvD,EAAMirE,OAAOhZ,UAAU3uD,GAEzB,MAKN,IAAKtD,EAAO,CACV,IAAIoD,EACJ,GAAItD,EAAaorE,WACf9nE,EAAgBtD,EAAaorE,WAAWhrE,OACnC,CACL,MAAMoD,EAAY,EAClBF,EAAgB,EAAI6D,KAAK4D,IAAI3K,GACzBkD,EAAgBE,IAClBF,EAAgBE,GAIpBtD,EAAQ,CACN,IAAI85D,MAAc,CAChBtsB,MAAO,IAAI8tB,KAAe,CACxB7N,OAAQrqD,EACR83D,OAAQ,IAAIC,KAAe,CACzBhrC,MAAO,UAET6pC,KAAM,IAAIC,KAAa,CACrB9pC,MAAO,6BAGXnhB,KAAM,IAAI+qD,KAAa,CACrB/qD,KAAM9O,EAAKyC,WACXq3D,KAAM,IAAIC,KAAa,CACrB9pC,MAAO,oBAOjBnwB,EAAQN,KAAKoqE,YAAY/pE,EAAYR,EAASC,GAEhD,OAAOQ,EAGTkqE,SAAS3qE,EAASC,GAChB,IAAIM,EAAQN,EACZ,IAAKM,EACH,OAEF,MAAMC,EAAa8D,MAAMgL,KAAKrP,EAAW2rE,SAAS,sBAElD,SAAW3lE,QAAQxF,IACjBF,EAAQA,EAAM+F,QAAQ7F,EAAE,GAAIT,EAAQ4J,IAAInJ,EAAE,OAIlB,IAAtBD,EAAWE,QAAgBH,IAAUN,IACvCM,EAAQP,EAAQ4J,IAAI3J,IAAeA,GAG9BM,EAGDyqE,iBAAiBhrE,GACvB,OAAQA,EAAQkyD,cAAcM,eACvB,YACA,iBACA,SACH,MAAO,iBAEP,MAAO,yDA7WFtxD,gCAAYsI,QAAZtI,EAAY,qBAFX,SAEDA,MCcb,cACE,MAAMA,EAAe2qE,KACfpqE,EAAc+oE,KAEpB,IAAIxqE,EAEJ,MAAO,CAACC,EAAkCM,KACxC,GAA0B,kBAAtBN,EAAU2zD,QACZ,SAkEN,SACE1yD,EAA+C,CAAC,EAAG,IAAK,IAAK,GAC7DO,EAAsB,EACtBzB,EAA6C,CAAC,EAAG,IAAK,IAAK,KAC3DC,GAEA,MAAMM,EAAS,IAAIq7D,KAAe,CAChChE,MAAOn2D,EACPmvB,MAAO1vB,IAGHV,EAAO,IAAIk6D,KAAa,CAC5B9pC,MAAO5wB,IAGT,OAAO,IAAIu6D,MAAc,CACvBoB,SACAlB,OACAxsB,MAAO,IAAI8tB,KAAe,CACxB7N,OAAQ,EACRyN,SACAlB,SAEFhrD,KAAM,IAAI+qD,KAAa,CACrBI,KAAM,0BACNnrD,KAAMxP,EACNw6D,KAAM,IAAIC,KAAa,CAAE9pC,MAAO,SAChC+qC,OAAQ,IAAIC,KAAe,CAAEhrC,MAAO,OAAQgnC,MAAO,IACnDyS,UAAU,MA5BhB,CAjEQpqE,EAAU2J,IAAI,gBACd,EACA3J,EAAU2J,IAAI,cACd3J,EAAU2J,IAAI,eAET5J,EACF,CACL,MAAMQ,EAAcP,EAAU2J,IAAI,UAClC,OAAIpJ,OACuB8pE,IACLC,YAAY/pE,EAAaP,EAAWM,IAG1DP,EAAyB,UADJC,EAAUiyD,cAAcM,UACV/wD,EAAcP,EACjDlB,EAAMw8D,UAAUvJ,QAAQhzD,EAAU2J,IAAI,cAC/B5J,kBAUXyP,OACAq8D,cAAc,EACdC,YAAY,CAAC,EAAG,IAAK,IAAK,IAC1BC,cAAc,CAAC,EAAG,IAAK,IAAK,KAM1B,IACF,MAAMzrE,GAAkB8xD,SAAaryD,GAAWuD,MAAM,GAChD/C,KAAoB6xD,OAAapyD,GAAasD,MAAM,GAEpD9C,EAAS,IAAIm7D,KAAe,CAChChE,MAAOn2D,EACPmvB,MAAOpwB,IAGHG,EAAO,IAAI+5D,KAAa,CAC5B9pC,MAAOrwB,IAGT,OAAO,IAAIg6D,MAAc,CACvBoB,SACAlB,OACAxsB,MAAO,IAAI8tB,KAAe,CACxB7N,OAAQ,EACRyN,SACAlB,SAEFhrD,KAAM,IAAI+qD,KAAa,CACrB/qD,OACAmrD,KAAM,0BACNH,KAAM,IAAIC,KAAa,CAAE9pC,MAAO,SAChC+qC,OAAQ,IAAIC,KAAe,CAAEhrC,MAAO,OAAQgnC,MAAO,IACnDyS,UAAU,eC3DdniE,YAAYzG,GACVtB,KAAKy8C,iBDzBP,MAAM17C,EAAoB,IAAIirD,GAC9B,OAAO,IAAImZ,GAAY,CACrBl2D,MAAO,UACP8/C,OAAQ,IACRzyC,OAAQvb,EACRsvB,MAAOy7C,OCoBFrvB,GACLz8C,KAAKuwD,OAAOjvD,oBALZ,OAAOtB,KAAKy8C,MAAM/1B,WAYpB6pC,OAAOjvD,QACO,IAARA,OACe,IAAbtB,KAAK0F,KACP1F,KAAK0F,IAAIq3C,GAAG4sB,YAAY3pE,KAAKy8C,MAAMM,IAGrCz7C,EAAIy7C,GAAGsoB,SAASrlE,KAAKy8C,MAAMM,IAE7B/8C,KAAK0F,IAAMpE,EASbyqE,YACEzqE,EACAzB,EAAwBg9C,GAActkC,QACtCzY,GAEA,GAAIA,EACF,UAAWM,KAAaJ,KAAK0mB,WAAWq2B,GAAG8W,cACrCzzD,EAAUqJ,IAAI,eAAiB3J,GACjCE,KAAKgsE,gBAAgB5rE,QAIzBJ,KAAKkW,QAEPlW,KAAKq0D,YAAY/yD,EAAUzB,GAQ7B+4D,WAAWt3D,EAAkBzB,EAAwBg9C,GAActkC,SACjEvY,KAAKq0D,YAAY,CAAC/yD,GAAUzB,GAQ9Bw0D,YACE/yD,EACAzB,EAAwBg9C,GAActkC,SAEtC,MAAMzY,EAAa,GACnBwB,EAASwE,QAAS1F,IAChB,MAAMC,EAAYmlE,GAAYplE,EAASJ,KAAK0F,IAAI+jD,YAE7B,OADAppD,EAAU0xD,eAI7BjyD,EAAWc,KAAKP,KAGlBL,KAAKisE,cAAcnsE,EAAYD,GAQjCqsE,aACE5qE,EACAzB,EAAwBg9C,GAActkC,SAEtCvY,KAAKisE,cAAc,CAAC3qE,GAAYzB,GAQlCosE,cACE3qE,EACAzB,EAAwBg9C,GAActkC,SAEtCvY,KAAK0mB,WAAWq2B,GAAGsX,YAAY/yD,GAC/BykE,GAAiB/lE,KAAK0F,IAAKpE,EAAYzB,GAOzC84D,cAAcr3D,GACZtB,KAAKmsE,eAAe,CAAC7qE,IAOvB6qE,eAAe7qE,GACbA,EAASwE,QAASjG,IACZA,EAAQgZ,MACN7Y,KAAK0mB,WAAWq2B,GAAGsW,eAAexzD,EAAQgZ,KAAKjU,KACjD5E,KAAKgsE,gBAAgBhsE,KAAK0mB,WAAWq2B,GAAGsW,eAAexzD,EAAQgZ,KAAKjU,OAU5EonE,gBAAgB1qE,GACdtB,KAAK0mB,WAAWq2B,GAAG4b,cAAcr3D,GAMnC4U,QACElW,KAAK0mB,WAAWq2B,GAAG7mC,0BCtKW4mC,EAMhC/0C,cACE8X,QANM7f,YAAS,EACTA,aAAU,EACVA,YAAkB,GAClBA,mBAAgC,GAMxCqI,SAEAM,UACE3I,KAAKqqD,OAAOvkD,QAAQxE,GAAStB,KAAKosE,aAAa9qE,GAAQtB,MAGzDqsE,WAAW/qE,GACT,QAAsB,IAAlBA,EAAM4G,QACR,OAGFlI,KAAKqqD,OAAOzpD,KAAKU,GAEjB,MAAMzB,EAAUyB,EAAM4G,QACnBK,MAAK,UACLH,UAAUtI,IACLA,IAAWgI,UACb9H,KAAKs4C,QAAU,EACft4C,KAAKo9C,QAAS,GAEhBt9C,IAAegI,UACb9H,KAAKs4C,SAAW,EACPx4C,IAAWgI,SACpB9H,KAAKo9C,QAAU,GAGjBp9C,KAASo9C,QAAUp9C,KAAKs4C,SACtBt4C,KAAKs4C,QAAUt4C,KAAKo9C,OAAS,EAC7Bp9C,KAAK4I,OAASd,QACL9H,KAAKs4C,QAAU,IACxBt4C,KAAK4I,OAASd,aAIpB9H,KAAK+1B,cAAcn1B,KAAKf,GAG1BusE,aAAa9qE,GACXA,EAAM4G,QAAQC,KAAKL,QACnB,MAAMjI,EAAQG,KAAKqqD,OAAOnqD,QAAQoB,GAC9BzB,GAAS,KAG0D,IAAnE,CAACiI,UAAuBA,WAAuB5H,QAFjCoB,EAAcmf,QAAQ7X,UAIpC5I,KAAKo9C,QAAU,GAEjBp9C,KAAK+1B,cAAcl2B,GAAO6I,cAC1B1I,KAAK+1B,cAAc/wB,OAAOnF,EAAO,GACjCG,KAAKqqD,OAAOrlD,OAAOnF,EAAO,GACzByB,EAAcmf,QAAQ9X,gBClEjB2jE,SAAZ,OAAYvrE,UAAa,KACvBA,iBACAA,mBAFUurE,GAAZ,IAAYvrE,eCOZgH,cAUY/H,kBAA4B,GAMtCusE,WACE,OAAOvsE,KAAKwsE,MAOdC,SAASnrE,GACP,QAAc,IAAVA,QAA2C,IAApBtB,KAAKusE,WAC9B,MAAM,IAAI9/D,MAAM,8CAGlB,QAAc,IAAVnL,EAGF,OAFAtB,KAAK8e,yBACL9e,KAAKwsE,MAAQlrE,GAIftB,KAAKwsE,MAAQlrE,EAMfwd,oBACE9e,KAAK0sE,aAAa5mE,QAASxE,IAAmB,QAAQA,IACtDtB,KAAK0sE,aAAe,qBC1BeC,GA6DrC5kE,YAAoBzG,GAClBue,QADkB7f,eAzDpBA,iBAAc,IAAI+I,SAAwB,GAK1C/I,YAAS,IAAI+I,SAA8B,GAM3C/I,aAAU,CAAC,EAAG,EAAG,EAAG,GAKpBA,qBAAkB,GAUVA,aAAU,IAAIgI,KAUdhI,YAAyB,GAKzBA,gBAAqB,qBAM3B,QAAOA,KAAK4O,UAAwC,IAA9B5O,KAAK4O,QAAQg+D,aAAwBC,aAO3D,OAAO7sE,KAAKwsE,MAAMlZ,UAOpBwZ,WAAWxrE,IAELA,EAAQyrE,KAAuB,IAAhBzrE,EAAQyrE,OACzB/sE,KAAKgtE,QAAQ,GAAK1rE,EAAQyrE,MAExBzrE,EAAQ2rE,OAA2B,IAAlB3rE,EAAQ2rE,SAC3BjtE,KAAKgtE,QAAQ,GAAK1rE,EAAQ2rE,QAExB3rE,EAAQ4rE,QAA6B,IAAnB5rE,EAAQ4rE,UAC5BltE,KAAKgtE,QAAQ,GAAK1rE,EAAQ4rE,SAExB5rE,EAAQ6rE,MAAyB,IAAjB7rE,EAAQ6rE,QAC1BntE,KAAKgtE,QAAQ,GAAK1rE,EAAQ6rE,MAQ9BV,SAASnrE,GACPue,MAAM4sD,SAASnrE,GACftB,KAAKgf,iBAMPA,kBAC4B,IAAtBhf,KAAK4sE,cACP5sE,KAAK0sE,aAAa9rE,KAChBZ,KAAKwsE,MAAM1jE,GAAG,UAAYxH,GAAsBtB,KAAKotE,UAAU9rE,KAInEtB,KAAKqtE,SAAWrtE,KAAKstE,QAClB/kE,MAAK,OAAa,KAClBH,UAAW9G,IACVtB,KAAK+hE,UAAUzgE,EAAMwpC,OAAQxpC,EAAM2qB,UAOzCnN,oBACEe,MAAMf,yBACgB,IAAlB9e,KAAKqtE,WACPrtE,KAAKqtE,SAAS3kE,cACd1I,KAAKqtE,cAAW,GAQpB/hB,kBACE,OAAOtrD,KAAK6sE,OAAOU,gBAQrBC,UAAUlsE,GACR,IAAIzB,EAASG,KAAK6sE,OAAOW,YACzB,OAAIlsE,GAAczB,IAChBA,EAASguD,MAAiBhuD,EAAQG,KAAKsrD,kBAAmBhqD,IAErDzB,EAQTg2D,UAAUv0D,GACR,IAAIzB,EAASG,KAAK6sE,OAAOY,gBAAgBztE,KAAKwsE,MAAMkB,WACpD,OAAIpsE,GAAczB,IAChBA,EAASguD,MACPhuD,EACAG,KAAKsrD,kBACLhqD,IAGGzB,EAQT8tE,SAASrsE,EAAM,IACb,gBrC0QFP,EACAO,EAAe,IACfzB,EAAc,IAGd,OAAOkB,EAAa8sD,MAAuBvsD,GADpB,QAC6CzB,EqC/QlE,CACEG,KAAK+wD,gBACL/wD,KAAKsrD,kBAAkBsiB,WACvBtsE,GAQJyvD,gBACE,OAAO/wD,KAAK6sE,OAAO9b,gBAOrBmU,UACE,OAAO39D,KAAKE,MAAMzH,KAAK6sE,OAAO3H,WAMhC2I,SACE7tE,KAAK8tE,OAAO9tE,KAAK6sE,OAAO3H,UAAY,GAMtC6I,UACE/tE,KAAK8tE,OAAO9tE,KAAK6sE,OAAO3H,UAAY,GAOtC4I,OAAOxsE,GACLtB,KAAK6sE,OAAOmB,mBACZhuE,KAAK6sE,OAAOnlC,QAAQ,CAClBumC,OACAhc,SAAU,IACVic,OAAQvb,QASZsS,aAAa3jE,GACXtB,KAAKstE,QAAQnlE,KAAK,CAAE2iC,SAAQ7e,OAAQqgD,GAActH,OAQpDD,aAAazjE,GACXtB,KAAKstE,QAAQnlE,KAAK,CAAE2iC,SAAQ7e,OAAQqgD,GAAcxH,OAOpDqJ,cACE,OAAOnuE,KAAK6sE,OAAOsB,cAMrBC,gBACEpuE,KAAK6sE,OAAOnlC,QAAQ,CAAE2zB,SAAU,IAOlCgT,mBACE,OAAOruE,KAAKsuE,OAAO/tE,OAAS,GAAKP,KAAKuuE,WAAa,EAOrDC,eACE,OAAOxuE,KAAKsuE,OAAO/tE,OAAS,GAAKP,KAAKuuE,WAAavuE,KAAKsuE,OAAO/tE,OAAS,EAM1EkuE,gBACMzuE,KAAKquE,oBACPruE,KAAK0uE,cAAc1uE,KAAKuuE,WAAa,GAOzCI,YACM3uE,KAAKwuE,gBACPxuE,KAAK0uE,cAAc1uE,KAAKuuE,WAAa,GAOzCK,oBACE5uE,KAAKsuE,OAAS,GACdtuE,KAAKuuE,WAAa,EAMpBM,kBACM7uE,KAAKsuE,OAAO/tE,OAAS,GACvBP,KAAK0uE,cAAc,GAUf3M,UACNzgE,EACAzB,EACAC,GAAqB,GAErB,MAAMM,EAASJ,KAAK6sE,OACpBzsE,EAAO4tE,mBACP,MAAM3tE,EAAWP,EAAY,IAAM,EAC7BQ,EAAOF,EAAO8kE,UAEd1kE,EAAaJ,EAAOotE,YACpB9pE,EAAW,CACfpC,EAAO,IAAMA,EAAO,GAAKA,EAAO,IAAM,EACtCA,EAAO,IAAMA,EAAO,GAAKA,EAAO,IAAM,GAElCsC,EAAa2D,KAAKunE,KACtBvnE,KAAKC,IAAIhH,EAAW,GAAKkD,EAAS,GAAI,GACpC6D,KAAKC,IAAIhH,EAAW,GAAKkD,EAAS,GAAI,IAEpCG,EAAazD,EAAOqtE,kBACpB1pE,EAAWwD,KAAKunE,KACpBvnE,KAAKC,IAAI3D,EAAW,GAAKA,EAAW,GAAI,GACtC0D,KAAKC,IAAI3D,EAAW,GAAKA,EAAW,GAAI,IAMtCi/C,EAAQl/C,IAJC2D,KAAKunE,KAClBvnE,KAAKC,IAAIlG,EAAO,GAAKA,EAAO,GAAI,GAAKiG,KAAKC,IAAIlG,EAAO,GAAKA,EAAO,GAAI,IAE7CyC,GAAY,GAGhCkD,EACJpH,IAAWysE,GAActH,MAAQ1kE,EAAON,KAAK+uE,gBACzCzuE,EACAN,KAAK+uE,gBAEX3uE,EAAO4uE,IAAI1tE,EAAQ,CACjBiY,KAAMvZ,KAAKwsE,MAAMkB,UACjBuB,UACAjC,QAAShtE,KAAKgtE,QACd/a,SAAUnP,EAAQ,EAAI,EAAIziD,EAC1B6uE,SAAWlsB,IACJA,GACH5iD,EAAO4uE,IAAI1tE,EAAQ,CACjBiY,KAAMvZ,KAAKwsE,MAAMkB,UACjBuB,UACAjC,QAAShtE,KAAKgtE,QACd/a,SAAUnP,EAAQ,EAAI,EAAIziD,OAW5BquE,cAAcptE,GACpBtB,KAAKuuE,WAAajtE,EAClBtB,KAAKmvE,SAASnvE,KAAKsuE,OAAOhtE,IAOpB6tE,SAAS7tE,GACftB,KAAK6sE,OAAOnlC,QAAQ,CAClB0nC,WAAY9tE,EAAM8tE,WAClBC,OAAQ/tE,EAAM+tE,OACdpd,SAAU,IAQNmb,UAAU9rE,GAChB,MAAMzB,EAAaG,KAAK+wD,gBACpB/wD,KAAK8wD,YAAYhvD,QAAUjC,GAC7BG,KAAK8wD,YAAY3oD,KAAKtI,GAGxB,MAAMC,EAAQ,CACZsvE,aACAC,OAAQrvE,KAAKwtE,YACbS,KAAMjuE,KAAKklE,WAGb,IAA0B,IAAtBllE,KAAK4sE,aAAuB,CAC9B,MAAMxsE,EAAaJ,KAAKuuE,qBrCtB5BxtE,EACAO,GAEA,QAAe,IAAXP,QAAmC,IAAXO,EAC1B,OAAO,EAGT,MAAMzB,EAAY,KAClB,OACEkB,EAAOktE,OAAS3sE,EAAO2sE,MACvB1mE,KAAK+nE,MAAMvuE,EAAOsuE,OAAO,GAAKxvE,KAC5B0H,KAAK+nE,MAAMhuE,EAAO+tE,OAAO,GAAKxvE,IAChC0H,KAAK+nE,MAAMvuE,EAAOsuE,OAAO,GAAKxvE,KAC5B0H,KAAK+nE,MAAMhuE,EAAO+tE,OAAO,GAAKxvE,IqCSN0uE,CAGAzuE,EADC,IAAvBE,KAAKsuE,OAAO/tE,YAAe,EAAYP,KAAKsuE,OAAOluE,MAEnDJ,KAAKsuE,OAAStuE,KAAKsuE,OAAOlrE,MAAM,EAAGhD,EAAa,GAAG4F,OAAO,CAAClG,IAC3DE,KAAKuuE,WAAavuE,KAAKsuE,OAAO/tE,OAAS,GAI3CP,KAAKwmE,OAAOr+D,KAAKrI,IC/XrB,IAAKyvE,GAIJ,MAJD,OAAKxuE,UAAsB,KACzByuE,oBACAzuE,sBACAA,kBAHGwuE,GAAL,IAAKxuE,GAIJ,oBAK6C4rE,GAqI5C5kE,YACUzG,EACAzB,EACAC,EACAM,GACRyf,QAJQ7f,WACAA,eACAA,sBACAA,qBAvIFA,qBAAkC,GAElCA,0BAAwD,IAAIo6D,MAAc,CAChFtsB,MAAO,IAAI8tB,KAAe,CACxB7N,OAAQ,EACRuM,KAAM,IAAIC,KAAa,CACrB9pC,MAAO,YAET+qC,OAAQ,IAAIC,KAAe,CACzBhrC,MAAO,OACPgnC,MAAO,QAILz3D,0BAAwD,IAAIo6D,MAAc,CAChFoB,OAAQ,IAAIC,KAAe,CACzBhrC,MAAO,2BACPgnC,MAAO,IAET6C,KAAM,IAAIC,KAAa,CACrB9pC,MAAO,+BASMzwB,8BAAoD,IAAI+I,IAAgB,GAKzE/I,eAAY,IAAI+I,SAAqC,GAIrD/I,eAAY,IAAI+I,SAAyB,GAIzC/I,qBAAkB,IAAI+I,SAAyB,GA+BvD/I,aAA6BA,KAAK4O,SAAW5O,KAAK4O,QAAQ6gE,OAASzvE,KAAK4O,QAAQ6gE,YAAS,EAazFzvE,wBAAqBA,KAAK4O,SAAW5O,KAAK4O,QAAQ8gE,kBAAoB1vE,KAAK4O,QAAQ8gE,kBAAoB,IA0CvG1vE,wBAAkBA,KAAK4O,UAAW5O,KAAK4O,QAAQ+gE,iBAAiB3vE,KAAK4O,QAAQ+gE,eASnF3vE,KAAK4vE,mBAAqB,IAAIC,GAAQ7vE,KAAK0F,gBAvEjCpE,GACVtB,KAAK8vE,QAAUxuE,EACftB,KAAK+vE,sBAAsB/vE,KAAKgwE,UAAUluE,oBAG1C,OAAO9B,KAAK8vE,8BAOQxuE,GACpBtB,KAAKiwE,mBAAqB3uE,EAC1BtB,KAAK+vE,sBAAsB/vE,KAAKgwE,UAAUluE,+BAI1C,OAAO9B,KAAKiwE,kCASZ,OAAOjwE,KAAKkwE,YAAYC,2BAGb7uE,GACXtB,KAAKkwE,YAAYE,YAAY9uE,IAAS,GACtCtB,KAAKqwE,UAAUloE,KAAK7G,GAChBtB,KAAKswE,qBAA4B,IAAVhvE,GACzBtB,KAAKswE,eAAe76D,IAAI,uBAAwBnU,GAE7CA,GACHtB,KAAKgwE,UAAU7nE,UAAK,sBAOL7G,SACjBtB,KAAKuwE,gBAAkBjvE,EACvBtB,KAAKwwE,gBAAgBroE,KAAK7G,IACwC,KAA5C,QAAlBzB,OAAKgP,qBAAa,eAAEnE,UAAU,+BAChC1K,KAAKuwE,iBAAkB,EACvBvwE,KAAKwwE,gBAAgBroE,MAAK,IAE5BnI,KAAK+vE,sBAAsB/vE,KAAKgwE,UAAUluE,OACtC9B,KAAKswE,qBAA4B,IAAVhvE,GACzBtB,KAAKswE,eAAe76D,IAAI,6BAA8BnU,wBAKxD,OAAOtB,KAAKuwE,gBAoBd9D,SAASnrE,GACPue,MAAM4sD,SAASnrE,GACftB,KAAKgf,iBAGCyxD,4BACNzwE,KAAK0wE,oBAAoBnB,GAAuBC,UAChDxvE,KAAK0wE,oBAAoBnB,GAAuBoB,UAChD3wE,KAAK0wE,oBAAoBnB,GAAuBqB,QAGlD5xD,iBACEhf,KAAKqwE,UAAUjoE,UAAUvI,IACnBA,EACFG,KAAK6wE,kBAAiB,GAAM,GAE5B7wE,KAAKywE,8BAITzwE,KAAKkwE,YAAc,IAAIY,KAAc,CAEnCC,gBAAiB,CACfC,oBAAoB,EACpBC,WAAY,IACZC,QAAS,KAEXznB,WAAYzpD,KAAK4O,QAAQ66C,aAE3B,IAAInoD,GAAW,EACftB,KAAKmxE,gBAAgBvwE,KAAKZ,KAAKoxE,yBAC5B7oE,MAAK,QAAU1I,IAAS,QAAiB,IAARA,KACjCuI,UAAU,KACL9G,IAAatB,KAAKqxE,SACpBrxE,KAAK6wE,kBAAiB,IAEtBvvE,EAAWtB,KAAKqxE,SAChBrxE,KAAK6wE,kBAAiB,GAAM,OAK7BS,yBAAyBhwE,GAC9B,IAAKA,EAAW,OAEhB,IAAIzB,EAAWyB,EAAQiwE,UACnBzxE,EAAiBwB,EAAQkwE,eAC7B,GAAIxxE,KAAKswE,eAAgB,CACvB,MAAMlwE,EAAiBJ,KAAKswE,eAAe7mE,IAAI,wBACxB,MAAnBrJ,IACFP,EAAWO,GAGb,MAAMC,EAAuBL,KAAKswE,eAAe7mE,IAAI,8BACxB,MAAzBpJ,IACFP,EAAiBO,GAGrBL,KAAKqxE,SAAWxxE,EAChBG,KAAK2vE,eAAiB7vE,EACtBE,KAAKyvE,OAASnuE,EAAQmuE,OAMxB3wD,oBACM9e,KAAKmxE,gBAAgB5wE,QACvBP,KAAKmxE,gBAAgBzrE,IAAIpE,GAAKA,EAAEoH,eAElCmX,MAAMf,oBAgBA+xD,iBAAiBvvE,GAAqB,EAAOzB,GAAkB,SACrE,IAAKG,KAAKqxE,SACR,OAEF,MAAMjxE,EAAsBJ,KAAKkwE,YAAYnlB,gBAE7C,GAAI3qD,EAAoBqxE,SAAWzxE,KAAK0vE,kBAGtC,OAFAxkE,QAAQ0nC,KAAK,gEACb5yC,KAAKgwE,UAAU7nE,UAAK,GAItB,MAAM9H,EAAgC,CACpC2yB,SAAU5yB,EAAoB4yB,SAC9By2B,WAAYzpD,KAAKkwE,YAAY3C,gBAAgBhsB,UAC7CkwB,SAAUrxE,EAAoBqxE,SAC9BC,SAAUtxE,EAAoBsxE,SAC9BC,iBAAkBvxE,EAAoBuxE,iBACtCC,QAASxxE,EAAoBwxE,QAC7BC,MAAOzxE,EAAoByxE,MAC3Bb,sBAAuD,QAAnClxE,IAAoBixE,uBAAe,eAAEC,oBACzDc,UAAW,IAAIzrE,MAEjBrG,KAAK+vE,sBAAsB1vE,EAAUR,GACjCyB,GACFtB,KAAKgwE,UAAU7nE,KAAK9H,GAQhBqwE,oBAAoBpvE,GAC1B,MAAMzB,EAAcG,KAAK4vE,mBAAmBlpD,WAAWq2B,GAAGsW,eAAe/xD,GACrEzB,GACFG,KAAK4vE,mBAAmBlpD,WAAWq2B,GAAG4b,cAAc94D,GAKhDkwE,sBAAsBzuE,EAA+BzB,GAAkB,GAC7E,IAAKyB,IAAaA,EAAS0xB,SACzB,OAEFhzB,KAAKywE,4BACL,MAAM3wE,EAAmB,IAAIiyE,KAAMzwE,EAAS0xB,UACtC5yB,GAAmB,SAAW,IAAI4xE,KAAS1wE,EAAS0xB,SAAU1xB,EAASmwE,UAAY,IAEnFpxE,EAAkB,IAAI4xE,KAAiB,CAAEhtB,SAAUnlD,IACnDQ,EAAkB,IAAI2xE,KAAmB,CAAEhtB,SAAU7kD,IAE3D,GAAIN,EAAkB,CACpB,IAAIU,EAASR,KAAK2vE,eAAiB9yB,GAAcmoB,KAAOnoB,GAAclkC,KAYtE,GAXI9Y,IACFW,EAASq8C,GAAcioB,MAEzBzkE,EAAgB8jE,MAAMoL,GAAuBC,UAC7CnvE,EAAgB0yD,SAAS/yD,KAAKkyE,sBAC9BlyE,KAAK4vE,mBAAmB1D,aAAa7rE,EAAiBG,GAClDJ,IACFE,EAAgB6jE,MAAMoL,GAAuBoB,UAC7CrwE,EAAgByyD,SAAS/yD,KAAKmyE,sBAC9BnyE,KAAK4vE,mBAAmB1D,aAAa5rE,EAAiBE,IAEpDR,KAAKyvE,OAAQ,CACf,MAAM/rE,EAAgB,IAAIuuE,KAAU,IAAID,KAAS1wE,EAAS0xB,SAAUhzB,KAAKyvE,OAAO2C,eAC1ExuE,EAAc,IAAIw2D,MAAc,CACpCoB,OAAQ,IAAIC,KAAe,CAAEhE,MAAO,EAAGhnC,MAAOzwB,KAAKyvE,OAAO4C,eAC1D/X,KAAM,IAAIC,KAAa,CAAE9pC,MAAOzwB,KAAKyvE,OAAO6C,aAC5ChjE,KAAM,IAAI+qD,KAAa,CACrBS,UAAW,OACXE,QAAS,GACTG,SAAS,GACTV,KAAM,0BACNnrD,KAAMtP,KAAKyvE,OAAO8C,iBAAmB,GAAGvyE,KAAKyvE,OAAO2C,gBAAkB,GACtE9X,KAAM,IAAIC,KAAa,CAAE9pC,MAAO,SAChC+qC,OAAQ,IAAIC,KAAe,CAAEhrC,MAAO,OAAQgnC,MAAO,QAGvD/zD,EAAcygE,MAAMoL,GAAuBqB,QAC3CltE,EAAcqvD,SAASnvD,GACvB5D,KAAK4vE,mBAAmB1D,aAAaxoE,EAAelD,eC7S1DuH,YACEzG,EACQzB,EACAC,GADAE,sBACAA,qBAjCHA,0BAAuB,IAAI+I,KAAyB,GACpD/I,aAAU,IAAI+I,IAAyB,IAOvC/I,mBAAgB,IAAI+I,KAAyB,GAC7C/I,gBAAa,IAAI+I,KAAyB,GAC1C/I,uBAAoB,IAAI+I,IAAyB,MAQhD/I,oBAAsC,CAC5C0nB,SAAU,CAAE8qD,aAAa,IAezBxyE,KAAK4O,QAAUhJ,OAAOU,OAAO,GAAItG,KAAKyyE,eAAgBnxE,GACtDtB,KAAK0yE,aAAe,IAAIC,GACxB3yE,KAAKkI,QAAUlI,KAAK0yE,aAAaxqE,QACjC45D,KAAiBD,MACjB7hE,KAAK8iC,oBAfL,OAAO9iC,KAAK4yE,QAAQ9wE,uBAIpB,OAAO9B,KAAKqrD,eAAeC,kBAAkB/J,UAc/Cze,OACE,MAAMxhC,EAAW,GACbtB,KAAK4O,QAAQ8Y,WACX1nB,KAAK4O,QAAQ8Y,SAAS8qD,aAIxBlxE,EAASV,KAAK,IAAIiyE,MAH4C,IAAtC7yE,KAAK4O,QAAQ8Y,SAAS8qD,YAC1C,GACAxyE,KAAK4O,QAAQ8Y,SAAS8qD,cAGxBxyE,KAAK4O,QAAQ8Y,SAASorD,WAIxBxxE,EAASV,KAAK,IAAImyE,MAHwC,IAApC/yE,KAAK4O,QAAQ8Y,SAASorD,UACxC,GACA9yE,KAAK4O,QAAQ8Y,SAASorD,aAI9B,IAAIjzE,EAAe,IACe,IAA9BG,KAAK4O,QAAQokE,eACfnzE,EAAe,CACbozE,oBAAoB,EACpBC,iBAAiB,EACjBC,UAAU,EACVC,gBAAgB,EAChBC,eAAe,EACfC,SAAS,EACTC,aAAa,EACbC,WAAW,IAIfxzE,KAAK+8C,GAAK,IAAI02B,KAAM,CAClBT,aAAcU,MAAuB7zE,GACrC6nB,aAGF1nB,KAAK2zE,QAAQ3zE,KAAK4O,QAAQqO,MAAQ,IAClCjd,KAAKqrD,eAAiB,IAAIuoB,GAAkB,CAC1ChH,cAAc,IAEhB5sE,KAAKqrD,eAAeohB,SAASzsE,KAAK+8C,IAClC/8C,KAAK+yB,QAAU,IAAI88C,GAAQ7vE,MAC3BA,KAAK6zE,oBAAsB,IAAIhE,GAAQ7vE,MACvCA,KAAK8zE,qBAAuB,IAAIjE,GAAQ7vE,MACxCA,KAAK+8C,GAAGg3B,KAAK,iBAAkB,KAC7B/zE,KAAKg0E,sBAAwB,IAAIC,GAC/Bj0E,KACA,CACEypD,WAAYzpD,KAAKqrD,eAAeC,mBAElCtrD,KAAKswE,eACLtwE,KAAK6O,eACP7O,KAAKg0E,sBAAsBvH,SAASzsE,KAAK+8C,IACrC/8C,KAAKg0E,uBACPh0E,KAAKg0E,sBAAsB1C,yBAAyBtxE,KAAKk0E,kBAK/Dr/C,UAAUvzB,GACRtB,KAAK+8C,GAAGloB,UAAUvzB,QACP,IAAPA,EACFtB,KAAK0yE,aAAatqE,UAAU,OAAW,MAEvCpI,KAAK0yE,aAAahqE,cAItByrE,WAAW7yE,GACT,MAAMzB,EAAcG,KAAK+8C,GAAGuW,UACtBxzD,EAAc8F,OAAOU,OACzB,CACE2nE,KAAMpuE,EAAYqlE,WAEpBrlE,EAAYkrD,iBAGd/qD,KAAK2zE,QAAQ/tE,OAAOU,OAAOxG,EAAawB,IACpCA,EAAQytE,kBACV/uE,KAAKqrD,eAAe0jB,gBAAkBztE,EAAQytE,iBAEhD/uE,KAAKk0E,eAAiB5yE,EAOxBqyE,QAAQryE,QACsB,IAAxBtB,KAAKqrD,gBACPrrD,KAAKqrD,eAAeujB,oBAGtBttE,EAAUsE,OAAOU,OAAO,CAAE8tE,qBAAqB,GAAQ9yE,GACvD,MAAMzB,EAAO,IAAIw0E,MAAO/yE,GAGxB,GAFAtB,KAAK+8C,GAAG42B,QAAQ9zE,GAEZyB,IACEA,EAAQgzE,qBACVt0E,KAAKqrD,eAAeipB,mBAAqBhzE,EAAQgzE,oBAG/ChzE,EAAQ+tE,QAAQ,CAClB,MAAMvvE,EAAaD,EAAK0tE,gBAAgBhsB,UAClCnhD,EAASytD,MAAkBvsD,EAAQ+tE,OAAQvvE,GACjDD,EAAK0zD,UAAUnzD,IAKrBm0E,eAAejzE,GACb,QAAc,IAAVA,EACF,OAGF,MAAMzB,EAAW,GACbyB,EAAMkxE,aAIR3yE,EAASe,KAAK,IAAIiyE,MAH4B,IAAtBvxE,EAAMkxE,YAC1B,GACAlxE,EAAMkxE,cAGRlxE,EAAMwxE,WAIRjzE,EAASe,KAAK,IAAImyE,MAHwB,IAApBzxE,EAAMwxE,UACxB,GACAxxE,EAAMwxE,YAIYltE,OAAOU,OAAO,GAAItG,KAAK+8C,GAAGy3B,cAAc3L,YAChD/iE,QAAQ1F,IACtBJ,KAAK+8C,GAAG03B,cAAcr0E,KAExBP,EAASiG,QAAQ1F,IACfJ,KAAK+8C,GAAGllB,WAAWz3B,KAQvBotE,UAAUlsE,GACR,OAAOtB,KAAKqrD,eAAemiB,UAAUlsE,GAOvCu0D,UAAUv0D,GACR,OAAOtB,KAAKqrD,eAAewK,UAAUv0D,GAIvC4jE,UACE,OAAOllE,KAAKqrD,eAAe6Z,UAG7BwP,gBAAgBpzE,GACd,GAAKA,EAIL,WAAWzB,KAAMG,KAAK20E,gBACpB90E,EAAG+mB,SAAU,EAGftlB,EAAUslB,SAAU,EAEpB5mB,KAAKqrD,eAAewhB,OAAO+H,WACzBtzE,EAAUolB,WAAW9X,QAAQimE,UAAY70E,KAAK4O,QAAQqO,MAAQ,IAAI43D,SAEpE70E,KAAKqrD,eAAewhB,OAAOiI,WACzBxzE,EAAUolB,WAAW9X,QAAQqgE,UAAYjvE,KAAK4O,QAAQqO,MAAQ,IAAIgyD,UAItE0F,gBACE,OAAO30E,KAAKqqD,OAAO5jD,OAAQnF,IAAqC,IAApBA,EAAM0tD,WAGpD+lB,aAAazzE,GACX,OAAOtB,KAAKqqD,OAAOxvC,KAAMhb,GAAiBA,EAAM+E,IAAM/E,EAAM+E,KAAOtD,GAGrE0zE,gBAAgB1zE,GACd,OAAOtB,KAAKqqD,OAAOxvC,KAChBhb,GAAiBA,EAAM+qC,OAAS/qC,EAAM+qC,QAAUtpC,GAIrD2zE,gBAAgB3zE,GACd,OAAOtB,KAAKqqD,OAAOxvC,KAChBhb,GAAkBA,EAAMk9C,GAAWm4B,QAAWr1E,EAAMk9C,GAAWm4B,SAAW5zE,GAS/E+jE,SAAS/jE,EAAczB,GAAO,GAC5BG,KAAKm1E,UAAU,CAAC7zE,IAQlB6zE,UAAU7zE,EAAiBzB,GAAO,GAChC,IAAIC,EAAe,EACfM,EAAwB,EAC5B,MAAMC,EAAciB,EACjBoE,IAAKpF,IACJ,IAAKA,EAAS,OACd,MAAME,EAASF,EAAMyuD,OACjB,EACAzuD,EAAM0uD,UACJ5uD,IACAN,IACN,OAAOE,KAAKo1E,WAAW90E,EAAOE,KAE/BiG,OAAQnG,QAAuC,IAAVA,GACxCN,KAAKq1E,UAAU,GAAGrvE,OAAOhG,KAAKqqD,OAAQhqD,IAOxCspE,YAAYroE,GACVtB,KAAKs1E,aAAa,CAACh0E,IAOrBg0E,aAAah0E,GACX,MAAMzB,EAAYG,KAAK4yE,QAAQ9wE,MAAMsB,MAAM,GACrCtD,EAAiB,GACvBwB,EAAOwE,QAAS1F,IACd,MAAMC,EAAQR,EAAUK,QAAQE,GAC5BC,GAAS,IACXP,EAAec,KAAKR,GACpBP,EAAUmF,OAAO3E,EAAO,GACxBL,KAAKu1E,2BAA2Bn1E,EAAON,GACvCA,EAAe4F,IAAIpF,IACjBR,EAAec,KAAKN,GACpB,MAAME,EAAcX,EAAUK,QAAQI,GAClCE,GAAe,GACjBX,EAAUmF,OAAOxE,EAAa,QAMtCV,EAAegG,QAAS1F,GAAiBJ,KAAKw1E,cAAcp1E,IAC5DJ,KAAKq1E,UAAUx1E,GAQjB01E,2BAA2Bj0E,EAAiBzB,GAC1C,MAAMC,EAAewB,EAASsN,QAAQ07C,aACtC,IAAKxqD,EACH,OAEF,MAAMM,EAAkBN,EAAakrD,OAC/B3qD,EAAeP,EAAayqD,MACZlqD,EAGpBA,EAAaqF,IAAIlF,KACVA,EAAKi1E,cAGVj1E,EAAKyqD,UAAUvlD,IAAIhC,IACjB,MAAME,EAAe5D,KAAKqqD,OAAOxvC,KAAKhX,IAAK,MAAI,OAA0B,QAA1BE,IAAM6K,QAAQ07C,oBAAY,eAAEU,UAAWtnD,IAClFE,GACF/D,EAAee,KAAKgD,OAM1B5D,KAAKqqD,OAAO3kD,IAAIlF,WACgB,QAA1BkD,IAAMkL,QAAQ07C,oBAAY,eAAEC,QAC9B/pD,EAAMoO,QAAQ07C,aAAaC,MAAM7kD,IAAI9B,IAEjCA,EAAE6xE,eAAqC,IAArB7xE,EAAEunD,iBACqB,IAAzCvnD,EAAEqnD,UAAU/qD,QAAQE,KACpBP,EAAee,KAAKJ,GACpBR,KAAKu1E,2BAA2B/0E,EAAOX,QAWnD61E,kBACE11E,KAAKqqD,OAAOvkD,QAASxE,GAAiBtB,KAAKw1E,cAAcl0E,IACzDtB,KAAK4yE,QAAQzqE,KAAK,IAGpBwtE,WAAWr0E,GACT,MAAMzB,EAAQG,KAAK41E,cAAct0E,GAC7BzB,EAAQ,GACVG,KAAK61E,UAAUv0E,EAAOzB,EAAOA,EAAQ,GAIzCi2E,YAAYx0E,GACV,UAAWzB,KAASyB,EAClBtB,KAAK21E,WAAW91E,GAIpBk2E,WAAWz0E,GACT,MAAMzB,EAAQG,KAAK41E,cAAct0E,GAC7BzB,EAAQG,KAAKqqD,OAAO9pD,OAAS,GAC/BP,KAAK61E,UAAUv0E,EAAOzB,EAAOA,EAAQ,GAIzCm2E,YAAY10E,GACV,MAAMzB,EAAgByB,EAAOuY,UAC7B,UAAW/Z,KAASD,EAClBG,KAAK+1E,WAAWj2E,GAIpB+1E,UAAUv0E,EAAczB,EAAcC,GACpC,MAAMM,EAAUJ,KAAKqqD,OAAOvqD,GAEtBQ,EAAagB,EAAMytD,OAErB3uD,EAAQ4uD,WAAa1tD,EAAM0tD,YAI/B1tD,EAAMytD,OAPW3uD,EAAQ2uD,OAQzB3uD,EAAQ2uD,OAASzuD,EAEjBN,KAAKqqD,OAAOvqD,GAAMwB,EAClBtB,KAAKqqD,OAAOxqD,GAAQO,EACpBJ,KAAK4yE,QAAQzqE,KAAKnI,KAAKqqD,OAAOjnD,MAAM,KAS9BgyE,WAAW9zE,EAAczB,GAC3ByB,EAAM0tD,WAAa1tD,EAAMslB,SAC3B5mB,KAAK00E,gBAAgBpzE,GAGvB,MAAMxB,EAAgBE,KAAK+0E,aAAazzE,EAAMsD,IAC9C,QAAsB,IAAlB9E,EAAJ,CASA,IAJKwB,EAAM0tD,WAAa1tD,EAAMytD,SAC5BztD,EAAMytD,QAAU,SAGG,IAAjBztD,EAAMytD,QAAyC,IAAjBztD,EAAMytD,OAAc,CACpD,MAAM3uD,EAAYmH,KAAKyb,IACrB1hB,EAAM0tD,UAAY,EAAI,MACnBhvD,KAAKqqD,OACL5jD,OACEpG,GAAMA,EAAE2uD,YAAc1tD,EAAM0tD,WAAa3uD,EAAE0uD,OAAS,KAEtDrpD,IAAKrF,GAAMA,EAAE0uD,SAElBztD,EAAMytD,OAAS3uD,EAAY,EAAIP,EAGjC,OAAIyB,EAAM0tD,WAAa1tD,EAAMytD,OAAS,IACpCztD,EAAMytD,OAAS,IAGjBztD,EAAMivD,OAAOvwD,MACbA,KAAK0yE,aAAarG,WAAW/qE,GAC7BtB,KAAK+8C,GAAGsoB,SAAS/jE,EAAMy7C,IAEhBz7C,EA5BLxB,EAAc8mB,SAAU,EAmCpB4uD,cAAcl0E,GACpBtB,KAAK0yE,aAAatG,aAAa9qE,GAC/BtB,KAAK+8C,GAAG4sB,YAAYroE,EAAMy7C,IAC1Bz7C,EAAMivD,YAAO,GAOP8kB,UAAU/zE,GAChBtB,KAAK4yE,QAAQzqE,KAAKnI,KAAKi2E,mBAAmB30E,GAAQ8B,MAAM,IAQlD6yE,mBAAmB30E,GAEzB,OAAOA,EAAO2Z,KACZ,CAACpb,EAAeC,IAAkBA,EAAOivD,OAASlvD,EAAOkvD,QASrD6mB,cAAct0E,GACpB,OAAOtB,KAAKqqD,OAAO3lD,UAAW7E,GAAkBA,IAAWyB,GAG7D40E,gBAAgB50E,GACdtB,KAAKm2E,qBAAqBhuE,KAAK7G,uBClftB80E,iBAgCXruE,YAAoBlI,0BAFbG,QAAK,uBAAsBqG,MAAO8pC,uBAtBvC,OAAOnwC,KAAKq2E,eAELx2E,GACPG,KAAKq2E,MAAQx2E,OACI,IAAbG,KAAK0F,KACP1F,KAAK0F,IAAIyuE,WAAWt0E,kBAMtB,OAAOG,KAAKs2E,uBAGDz2E,GACXG,KAAKs2E,UAAYz2E,OACA,IAAbG,KAAK0F,KACP1F,KAAK0F,IAAI6uE,eAAe10E,GAS5B2gB,WACExgB,KAAKsI,SAAWtI,KAAK0F,IAAIwC,QAAQE,UAAUvI,GACzCG,KAAKwI,mBAAmB3I,IAI5B+iC,kBACE5iC,KAAK0F,IAAImvB,UAAU70B,KAAK4E,IAG1BuT,cACEnY,KAAK0F,IAAImvB,eAAU,GACnB70B,KAAK6J,gBAAgBT,WAAWpJ,KAAKu2E,YACrCv2E,KAAKsI,SAASI,cAGRF,mBAAmB3I,GACrBA,IAAWiI,gBAA6C,IAApB9H,KAAKu2E,WAC3Cv2E,KAAKu2E,WAAav2E,KAAK6J,gBAAgBb,WAC9BnJ,IAAWiI,aAA0C,IAApB9H,KAAKu2E,aAC/Cv2E,KAAK6J,gBAAgBT,WAAWpJ,KAAKu2E,YACrCv2E,KAAKu2E,gBAAa,iDAvDXx1E,GAAmBrB,mCAAnBqB,EAAmBugB,sLCpBhC5hB,iBACAA,eADKA,s6GDoBQqB,MEMAy1E,iBAoCXzuE,YACkBlI,EACRC,GADQE,iBACRA,oBArBDA,0BAA+B,IAK9BA,0BAAuB,IAAIN,gBAOnC,OAAOM,KAAKs2B,UAAU5wB,wBAItB,OAAQ1F,KAAKs2B,UAAU5wB,IAAe+jD,WAYxCjpC,WACExgB,KAAKy2E,yBACLz2E,KAAK+nE,mBAOP5vD,cACEnY,KAAK02E,2BACL12E,KAAK4nE,qBAMC6O,yBACNz2E,KAAK22E,oBAAsB32E,KAAK0F,IAAIq3C,GAAGj0C,GACrC,cACCjJ,GAAuCG,KAAK42E,eAAe/2E,EAAOG,KAAK62E,uBAOpE9O,mBACN/nE,KAAKooE,iBAAmBpoE,KAAK0F,IAAIq3C,GAAGj0C,GAClC,cACCjJ,GAAuCG,KAAK42E,eAAe/2E,EAAO,IAO/D62E,4BACN,QAAQ12E,KAAK22E,qBACb32E,KAAK22E,yBAAsB,EAMrB/O,qBACN5nE,KAAKooE,sBAAmB,EAOlBwO,eAAe/2E,EAAoCC,GACzD,GAAID,EAAMi3E,UAAY92E,KAAKikB,aAAapP,gBAAkB,YACnB,IAA5B7U,KAAK+2E,oBACdC,aAAah3E,KAAK+2E,oBAGpB,MAAM32E,GAAS,SAAUP,EAAMo3E,WAAYj3E,KAAKk3E,cAAe,aAC/Dl3E,KAAK+2E,mBAAqBI,WAAW,KACnCn3E,KAAKo3E,qBAAqBl/D,KAAK9X,IAC9BN,iDA3GMiB,GAAwBrB,gDAAxBqB,EAAwBugB,sJAAxBvgB,uBCXmBiwD,GAO9BjpD,YACEzG,EACOzB,EACCC,EACDM,GAEPyf,MAAMve,EAASzB,EAAgBO,GAJxBJ,sBACCA,uBACDA,uBAGPA,KAAKygB,QAAU,IAAI42D,GAAar3E,KAAMA,KAAK+Q,eAAgB/Q,KAAK+P,iBAChE/P,KAAKkI,QAAUlI,KAAKygB,QAAQvY,QAC5BlI,KAAKkI,QAAQE,UAAU/H,IACH,IAAdA,IACFL,KAAKs3E,kBAAmB,KAKpBxoB,gBACR,MAAMxtD,EAAYsE,OAAOU,OAAO,GAAItG,KAAK4O,QAAS,CAChD0N,OAAQtc,KAAK4O,QAAQ0N,OAAOygC,KAGxBl9C,EAAQ,IAAI03E,KAAaj2E,GAC/B,OAAItB,KAAK2xD,iBACN9xD,EAAMurD,YAAoBosB,qBAAqB,CAAC13E,EAAMM,KACrDJ,KAAK4xD,aAAa9xD,EAAMM,EAAKJ,KAAK2xD,gBAAiB3xD,KAAK+Q,eAAgB/Q,KAAK+P,mBAI1ElQ,EAGF0wD,OAAOjvD,QACA,IAARA,EACFtB,KAAKygB,QAAQ/X,cAEb1I,KAAKygB,QAAQrY,UAAU,QAEzByX,MAAM0wC,OAAOjvD,GAGPswD,aAAatwD,EAAMzB,EAAaC,EAA8BM,EAAgCC,GACpG,MAAMC,EAAM,IAAIyzD,eAEVvzD,EAAwBV,EAAY46C,oBAAoB76C,GAC9D,IAAI6D,EAAM7D,EAMV,GALIW,IACFkD,EAAMlD,GAERF,EAAI2xB,KAAK,MAAOvuB,IACI5D,EAAY06C,aAAal6C,EAAKoD,GAIhD,OAFApD,EAAIm3E,aACJn2E,EAAK8wD,WAAWje,IAAMzwC,GAIxBpD,EAAI6kB,aAAe,cAEnB7kB,EAAIuW,OAAS,WACX,MAAMhT,EAAkB,IAAIwT,WAAYrX,KAAag1D,eAC1B0iB,aAAc1nC,OAAOnsC,GAC7B4P,SAAS,2BAC1BrT,EAAeiL,MAAMhL,EAAgB2N,UAAUgC,QAC7C,4CAEF3P,EAAgB2N,UAAUgC,QACxB,wCAGJ,MAAMhM,EAAO,IAAIsT,KAAK,CAACzT,GAAkB,CAAEiB,KAAM,cAE3Cg+C,EADa5hD,OAAOy2E,IACEC,gBAAgB5zE,GAC5C1C,EAAK8wD,WAAWje,IAAM2O,GAExBxiD,EAAIg0D,yBC7EuBtD,GAa7BjpD,YACEzG,EACOzB,EACAC,GACP+f,MAAMve,EAASzB,GAFRG,sBACAA,uBAGPA,KAAKygB,QAAU,IAAIo3D,GAAY73E,MAC/BA,KAAKkI,QAAUlI,KAAKygB,QAAQvY,QAGpB4mD,gBACR,MAAMxtD,EAAYsE,OAAOU,OAAO,GAAItG,KAAK4O,QAAS,CAChD0N,OAAQtc,KAAK4O,QAAQ0N,OAAOygC,KAExBl9C,EAAY,IAAIi4E,KAAYx2E,GAElC,OADmBzB,EAAUurD,YAClB2sB,oBAAoB,CAAC33E,EAAYC,KAC1CL,KAAK4xD,aAAaxxD,EAAMC,EAAKL,KAAK2xD,mBAG7B9xD,EAST+xD,aAAatwD,EAAMzB,EAAaC,GAE9B,MAAMM,EAAwBN,EAAY46C,oBAAoB76C,GAC9D,IAAIQ,EAAcR,EACdO,IACFC,EAAcD,GAEhBkB,EAAK8wD,WAAWje,IAAM9zC,EAGjBkwD,OAAOjvD,QACA,IAARA,EACFtB,KAAKygB,QAAQ/X,cAEb1I,KAAKygB,QAAQrY,UAAU,QAEzByX,MAAM0wC,OAAOjvD,qBChEoB0vD,GAOnCjpD,YACEzG,EACOzB,EACAC,GACP+f,MAAMve,EAASzB,EAAgBC,GAFxBE,sBACAA,uBAEPA,KAAKygB,QAAU,IAAIo3D,GAAY73E,MAC/BA,KAAKkI,QAAUlI,KAAKygB,QAAQvY,QAGpB4mD,gBACR,MAAMxtD,EAAYsE,OAAOU,OAAO,GAAItG,KAAK4O,QAAS,CAChD0N,OAAQtc,KAAK4O,QAAQ0N,OAAOygC,KAGxBl9C,EAAa,IAAIm4E,KAAkB12E,GAGzC,OAFyBzB,EAAWurD,YAEnB2sB,oBAAoB,CAAC33E,EAAkBC,KACtD,MAAMC,EAASN,KAAK4xD,aAAavxD,EAAKD,EAAK+zD,YAAan0D,KAAK2xD,gBAAiBvxD,EAAK63E,OAAO3mB,KAAKlxD,IAC3FE,GACFF,EAAKyxD,UAAUvxD,KAKZT,EAYT+xD,aAAatwD,EAAKzB,EAAQC,EAAaM,EAASC,GAC9C,MAAQ,CAACC,EAAQE,EAAYkD,KAC3B,MAAME,EAAM,IAAImwD,eAChB,IAAIlwD,EAAcvC,EAClB,GAAmB,mBAARA,EAAoB,CAC7B,MAAMyC,EAAwBjE,EAAY46C,oBAAoBp5C,GAC1DyC,IACFF,EAAcE,QAGhBF,EAAcvC,EAAIhB,EAAQE,EAAYkD,GAExCE,EAAIquB,KAAM,MAAOpuB,GACb/D,GACFA,EAAY06C,aAAa52C,EAAKC,GAGP,gBAArBhE,EAAOwyD,YACTzuD,EAAIuhB,aAAe,eAErBvhB,EAAIiT,OAAU9S,IACZ,IAAKH,EAAIgF,QAAUhF,EAAIgF,QAAU,KAAOhF,EAAIgF,OAAS,IAAK,CACxD,MAAM5E,EAAOnE,EAAOwyD,UACpB,IAAI1tD,EACS,SAATX,GAA4B,SAATA,EACrBW,EAASf,EAAIswD,aAEG,QAAblwD,GACHW,EAASf,EAAImxD,YACRpwD,IACHA,OAAaiwD,WAAYC,gBAAgBjxD,EAAIswD,aAAc,qBAG7C,gBAATlwD,IACPW,EAASf,EAAIoxD,UAEfrwD,EACEvE,EAAQqI,KAAKzI,KAAMH,EAAOu0D,aAAazvD,EAAQ,CAC7CmmC,SACAgZ,kBAAmBpgD,IACjB7D,EAAOi1D,eAAenwD,IAI1BtE,EAAQoI,KAAKzI,WAIfK,EAAQoI,KAAKzI,OAGjB4D,EAAIqwD,QAAU,KAEZ5zD,EAAQoI,KAAKzI,OAEf4D,EAAI0wD,QAID/D,OAAOjvD,QACA,IAARA,EACFtB,KAAKygB,QAAQ/X,cAEb1I,KAAKygB,QAAQrY,UAAU,QAEzByX,MAAM0wC,OAAOjvD,QC1EJ42E,iBAgDXnwE,YACkBlI,EACRC,EACAM,GAFQJ,iBACRA,oBACAA,oBAhDFA,8BAA+D,IAAI0+B,GAAmC,IAMtG1+B,kBAAe,GAUfA,oBAAyB,iBAIxBA,0BAA+B,IAK/BA,6BAAkC,EAG3Cm4E,WACEnB,aAAah3E,KAAK+2E,oBAClB/2E,KAAK4lE,uBAQL,OAAO5lE,KAAKs2B,UAAU5wB,wBAItB,OAAQ1F,KAAKs2B,UAAU5wB,IAAe+jD,WAaxCjpC,WACExgB,KAAKy2E,yBACLz2E,KAAKo4E,0BACLp4E,KAAK+nE,mBAEL/nE,KAAK0F,IAAIwC,QAAQK,MAAK,QAAK,IAAIH,UAAU,KACvCpI,KAAKoR,MAAQ,IAAIs4D,GAAsB,GAAI,CAAEhkE,IAAK1F,KAAK0F,MACvD1F,KAAK6+B,cAIP7+B,KAAKq4E,SAAWr4E,KAAK0F,IAAIktE,QAAQxqE,UAAWvI,IACtCG,KAAKoR,QAAUvR,EAAOgb,KAAK/a,GAAc,mBAATA,EAAE8E,KACpC5E,KAAK6+B,cAUHA,YAcNy5C,GAbct4E,KAAKoR,MAEL,IAAI+zD,GAAY,CAC5B5V,oBAAoB,EACpB3qD,GAAI,iBACJqK,MAAO,eACP8/C,OAAQ,IACRzyC,OAAQ,IAAI0vC,GACZsE,iBAAiB,EACjBa,YAAY,EACZD,WAAW,EACX7gC,MAAOkoD,MAITv4E,KAAKw4E,eAAiB,IAAIR,KAAkB,CAC1CtyE,IAAK1F,KAAK0F,IAAIq3C,GACdgS,OAAQ,IACR0pB,WAAY,SACZC,WAAW,EACXp8D,OAAQ,IAAIq8D,KAAmB,IAC/BtoD,MAAO,CAACjwB,EAASC,KACf,GAAIL,KAAK44E,iBAAmBx4E,EAAQqzD,UAAWzzD,KAAK64E,aAClD,OAAO74E,KAAK84E,iBAAiB14E,EAASJ,KAAK44E,gBAAiBv4E,MAMpEy4E,iBAAiBj5E,EAAgDC,EAA8BM,SAC7F,MAAME,EAAesF,iBAAQ9F,GAC7B,IAAIU,EAAQV,EAAWu3D,MAAQv3D,EAAWu3D,MAAMkT,eAAY,EACxD7mE,KAAgC,QAAhBrD,IAAWg3D,aAAK,eAAEhnC,OAEtC,GAAKxwB,EAAQ4J,IAAI,YAIV,CAEL,MAAM7F,EAAOtD,EAAgBipB,KAAOjpB,EAAgBipB,KAAKhpB,OAAS,EAC5DsD,EAAS,GACTE,EAAS,GACTC,EAAQ,GACRW,EAAO,GACb,QAASm+C,EAAI,EAAGA,EAAIl/C,EAAMk/C,IACxBj/C,EAAOjD,KAAK,GACZmD,EAAOnD,KAAK,0BACZoD,EAAMpD,KAAK,GACX+D,EAAK/D,KAAK,0BAEZN,EAAgBytD,OAASlqD,EACzBvD,EAAgBk7D,OAASz3D,EACzBzD,EAAgBm3D,MAAQzzD,EACxB1D,EAAgBg6D,KAAO31D,OAnBvBrE,EAAgB+2D,WAAQ,EACxB3zD,GAAgB,EAChBlD,OAAQ,EAmBV,OAAKkD,GAAiBlD,IACpBF,EAAgB+2D,MAAMhnC,MACtB,CACEyqC,UAAW,OACXF,aAAc,MACdH,KAAM,0BACNH,KAAM,CAAE7pC,MAAO,QACfsoD,eAAgB,CAAEtoD,MAAO,4BACzBuoD,iBAAkB,CAAEvoD,MAAO,4BAA6BgnC,MAAO,GAC/D+D,OAAQ,CAAE/qC,MAAO,OAAQgnC,MAAO,GAChCyS,UAAU,EACVlP,QAAS,GACTG,QAAS,GACT6R,QAAS,CAAC,IAAK,IAAK,IAAK,OAGtBhtE,KAAKi5E,aAAarO,uBAAuB/qE,EAASS,EAAiBF,GAO5E+X,cACEnY,KAAK02E,2BACL12E,KAAKk5E,4BACLl5E,KAAKm5E,2BACLn5E,KAAKq4E,SAAS3vE,cAOhB0vE,0BACEp4E,KAAKo5E,QAAUp5E,KAAKq5E,yBAAyB/7D,UAAUlV,UAAUvI,IAC/DG,KAAKs5E,yBAAyBz5E,KAQ1By5E,yBAAyBz5E,GAE/BG,KAAKu5E,kBAAkB15E,GAOjB42E,yBACNz2E,KAAK22E,oBAAsB32E,KAAK0F,IAAIq3C,GAAGj0C,GACrC,cACCjJ,GAAkCG,KAAKw5E,WAAW35E,IAO/CkoE,mBACN/nE,KAAKy5E,uBAAyBz5E,KAAK0F,IAAIq3C,GAAGj0C,GACxC,cACCjJ,GAAkCG,KAAK05E,sBAAsB75E,IAQlEq5E,4BACEl5E,KAAKo5E,QAAQ1wE,cAOPguE,4BACN,QAAQ12E,KAAK22E,qBACb32E,KAAK22E,yBAAsB,EAOrBwC,4BACN,QAAQn5E,KAAKy5E,wBACbz5E,KAAKy5E,4BAAyB,EAOxBC,sBAAsB75E,GAC5BG,KAAK4lE,aAOC4T,WAAW35E,GACjB,GACEA,EAAMi3E,WAAa92E,KAAK25E,wBACxB35E,KAAKikB,aAAapP,gBAElB,YADA7U,KAAK4lE,kBAGgC,IAA5B5lE,KAAK+2E,oBACdC,aAAah3E,KAAK+2E,oBAEpB/2E,KAAK4lE,aACL,IACIxlE,EADAN,GAAgB,IAEpB,MAAMO,EAAQL,KAAK0F,IAAIq3C,GAAG68B,uBAAuB/5E,EAAMo3E,YACvDj3E,KAAK+2E,mBAAqBI,WAAW,KAGnCn3E,KAAK0F,IAAIq3C,GAAG88B,sBAAsBx5E,EAAO,CAACC,EAAmDE,KAC3F,IAAKA,EACH,OAEF,MAAMkD,EAAW1D,KAAK0F,IAAIuvE,gBAAiBz0E,EAAgB00E,SACtDl1E,KAAK85E,gBAAgBp2E,IAGtBA,EAASqrD,QAAUjvD,IAGvBA,EAAgB4D,EAASqrD,OACzB3uD,EAAiBI,IAEhB,CACDioE,aAAc,GAAIC,YAAapoE,GAAWA,aAAmBmxD,MAAiBnxD,aAAmB03E,OAE9F53E,IAILJ,KAAK4lE,aACL5lE,KAAK0F,IAAIq3C,GAAG88B,sBAAsBx5E,EAAO,CAACC,EAAmDE,eAC3F,QAAuC,IAAnCF,EAAWmJ,IAAI,gBAA+B,CAChD,IAAI1F,EACJ,GAAIvD,aAAmBixD,KAAe,CAEpC,GADA1tD,EAAW/D,KAAK0F,IAAIuvE,gBAAiBz0E,EAAgB00E,SAChDl1E,KAAK85E,gBAAgB/1E,GACxB,OAEF,IAAIC,EAAiBhE,KAAK+5E,oBAAoBz5E,GAC9CN,KAAKg6E,yBAAyBj2E,EAAUC,GACxC,MAAMW,EAAiB,CAACX,GACxBA,EAAeyR,IAAI,YAAY,GAC/B,MAAMqtC,EAAmB,IAAIkoB,KAC7BloB,EAAiBm3B,cAAcj2E,EAAe+mD,iBAC9C,MAAM9jD,EACuC,UAA3CjD,EAAe+tD,cAAcM,UAAwBruD,EAAe+tD,cAAgB,IAAImoB,KAAar6E,EAAMo3E,YAC7G,SAAiBkD,YAAYlzE,GAC7B67C,EAAiBqhB,MAAMngE,EAAeyvD,SACtC3Q,EAAiBrtC,IAAI,YAAY,GACjCzV,KAAKg6E,yBAAyBj2E,EAAU++C,GACxCn+C,EAAe/D,KAAKkiD,GACpB9iD,KAAKq5E,yBAAyBzuE,KAAKjG,IAC5B,EAET,GAAInE,aAAmBw3E,KAAmB,CAExC,GADAj0E,EAAW/D,KAAK0F,IAAIuvE,gBAAiBz0E,EAAgB00E,SAChDl1E,KAAK85E,gBAAgB/1E,GACxB,QAEqC,QAAnCH,EAAiB,QAAjBF,EAAQ,MAARK,OAAQ,EAARA,EAAU6K,eAAO,eAAE4uC,wBAAgB,eAAEC,YACvCz9C,KAAK44E,gBAAkB70E,EAAS6K,QAAQ4uC,iBAAiBC,YAC/B,QAAjB55C,EAAQ,MAARE,OAAQ,EAARA,EAAU6K,eAAO,eAAE6uC,cAC5Bz9C,KAAK44E,gBAAkB70E,EAAS6K,QAAQ6uC,YAE1Cz9C,KAAKw4E,eAAe4B,UAAU55E,EAAQ4qD,aACtC5qD,EAAQqzD,YAAYh0D,EAAM2oE,OAAOh1B,KAAMxvC,IACrC,IAAKA,EAAYzD,OAIf,OAHAP,KAAK64E,aAAe,GACpB74E,KAAKw4E,eAAepyC,eACpBpmC,KAAK4lE,aAGP,MAAMjhE,EAAUX,EAAY,GAC5B,IAAKW,EAEH,YADA3E,KAAK4lE,aAGP,IAAI9iB,EAAiB9iD,KAAK+5E,oBAAoBp1E,GAC9Cm+C,EAAertC,IAAI,YAAY,GAC/B,MAAMxO,EAAmB,IAAI+jE,KAC7B/jE,EAAiBgzE,cAAcn3B,EAAeiI,iBAC9C,MAAM/H,EACqC,UAA3CF,EAAeiP,cAAcM,UAAwBvP,EAAeiP,cAAgB,IAAImoB,KAAar6E,EAAMo3E,YAC3GhwE,EAAiBkzE,YAAYn3B,GAC7B/7C,EAAiBk9D,MAAMrhB,EAAe2Q,SACtCxsD,EAAiBwO,IAAI,YAAY,GACjCzV,KAAKg6E,yBAAyBj2E,EAAUkD,GACxCjH,KAAKq5E,yBAAyBzuE,KAAK,CAAC3D,IACpCjH,KAAK64E,aAAal0E,EAAQ8uD,SAAW3Q,EACrC9iD,KAAKw4E,eAAepyC,aAI1B,OAAO,GACN,CACDqiC,aAAc,GAAIC,YAAapoE,GAAWA,IAAYF,MAEvDJ,KAAKq6E,sBAGVP,gBAAgBj6E,GAed,SAdKA,IAGAA,EAAS+mB,UAGT/mB,EAAS+O,UAIT/O,EAAS+O,QAAQ4uC,mBAAqB39C,EAAS+O,QAAQ6uC,YAKzD59C,EAAS+O,QAAQ4uC,mBAAqB39C,EAAS+O,QAAQ4uC,iBAAiBC,aACxE59C,EAAS+O,QAAQ6uC,YAMtBs8B,oBAAoBl6E,GAClB,IAAIC,EACJ,OAAID,aAAmBy6E,MACrBx6E,EAAe,IAAIkrE,KAAU,CAC3B/lB,SAAUjlD,KAAK+xD,YAAYlyD,KAE7BC,EAAaqkE,MAAMtkE,EAAQ4zD,UAClB5zD,aAAmBmrE,OAC5BlrE,EAAeD,GAEVC,EAODy5E,kBAAkB15E,GAExB,GAAIA,EAAYU,OAAS,EAAG,CAE1B,MAAMT,EAASD,EAAY,GAC3BG,KAAK4lE,aACL,MAAMxlE,EAAU,IAAI4qE,KAAU,CAC5B/lB,SAAUnlD,EAAOiyD,cACjBl5C,KAAM,CAAEjU,GAAI5E,KAAKu6E,gBACjBC,aAAcx6E,KAAKy6E,gBAAgB36E,EAAOirD,mBAG5C/qD,KAAKoR,MAAMq0D,mBAAmB,CAACrlE,GAAUy8C,GAAclkC,OAInDqhE,yBAAyBn6E,EAAyCC,aACxE,MAAMU,EAAaR,KAAKoR,MAAMqrC,MAAM/2C,IAAI2lD,eAAe0F,iBAChB,QAAnC1wD,EAAiB,QAAjBD,EAAQ,MAARP,OAAQ,EAARA,EAAU+O,eAAO,eAAE4uC,wBAAgB,eAAEC,YACvCz9C,KAAKoR,MAAMqrC,MAAMM,GAAGgW,SAAS/yD,KAAK84E,iBAAiBh5E,EAASD,EAAS+O,QAAQ4uC,iBAAiBC,WAAYj9C,KAGvF,QAAjBF,EAAQ,MAART,OAAQ,EAARA,EAAU+O,eAAO,eAAE6uC,aACrBz9C,KAAKoR,MAAMqrC,MAAMM,GAAGgW,SAAS/yD,KAAK84E,iBAAiBh5E,EAASD,EAAS+O,QAAQ6uC,WAAYj9C,IAIrFi6E,gBAAgB56E,GACtB,IAAIC,EAAU,GACd,UAAYM,EAAKC,KAAUuF,OAAOuU,QAAQta,IACnCO,EAAIikE,WAAW,MAAgB,aAARjkE,IAC1BN,GAAW,GAAGM,MAAQC,OAG1B,OAAOP,EAAQS,QAAU,EAAIT,EAAQsD,MAAM,GAAG,GAAMtD,EAG9CiyD,YAAYlyD,GAClB,IAAIC,EACJ,GAAKD,EAAQ66E,2BAEN,CAEL,MAAMt6E,EAASP,EAAQ66E,6BACjBr6E,EAAa,GASnB,OAPAD,EAAO0F,QAAQ,CAACxF,EAAGE,KACbA,EAAM,GAAM,GACdH,EAAWO,KAAK,CAAC+sD,WAAWvtD,EAAOI,IAAOmtD,WAAWvtD,EAAOI,EAAM,QAK9DX,EAAQwyD,eACT,QACHvyD,EAAO,IAAIo6E,KAAa75E,GACxB,UACG,UACHP,EAAO,IAAIo6E,MAAe,CAAC75E,IAC3B,UACG,aACHP,EAAO,IAAIo6E,KAAkB,CAAC75E,UArBlCP,EAAOD,EAAQkyD,cA0BjB,OAAOjyD,EAOD8lE,aACN5lE,KAAK64E,aAAe,GAChB74E,KAAKw4E,gBACPx4E,KAAKw4E,eAAepyC,UAElBpmC,KAAKoR,OACPpR,KAAKoR,MAAMw0D,2DA1dJ7kE,GAAqBrB,0DAArBqB,EAAqBugB,yGAArBxhB,yIAoesBiB,EAAqCO,GAmBtE,MAAMxB,EAAU,CAjBI,IAAI66E,MAAc,CACpCrrE,KAAM,IAAIqrE,KAAa,CACrBrrE,KAAMvO,EAAQ0I,IAAI,gBAClBqxD,UAAW,OACXF,aAAc,MACdH,KAAM,0BACNH,KAAM,IAAIqgB,KAAa,CAAElqD,MAAO,SAChCsoD,eAAgB,IAAI4B,KAAa,CAAElqD,MAAO,6BAC1CuoD,iBAAkB,IAAI2B,KAAe,CAAElqD,MAAO,4BAA6BgnC,MAAO,IAClF+D,OAAQ,IAAImf,KAAe,CAAElqD,MAAO,OAAQgnC,MAAO,IACnDyS,UAAU,EACVlP,QAAS,GACTG,QAAS,GACT6R,QAAS,CAAC,IAAK,IAAK,IAAK,UAK7B,OAAQjsE,EAAQgxD,cAAcM,eACvB,QACHvyD,EAAQc,KAAK,IAAI+5E,MAAc,CAC7B7sC,MAAO,IAAI6sC,KAAe,CACxB5sB,OAAQ,GACRyN,OAAQ,IAAImf,KAAe,CACzBlqD,MAAO,OACPgnC,MAAO,SAIb,cAEA33D,EAAQc,KAAK,IAAI+5E,MAAc,CAC7Bnf,OAAQ,IAAImf,KAAe,CACzBlqD,MAAO,QACPgnC,MAAO,OAGX33D,EAAQc,KAAK,IAAI+5E,MAAc,CAC7Bnf,OAAQ,IAAImf,KAAe,CACzBlqD,MAAO,OACPgnC,MAAO,OAKf,OAAO33D,2CC1jBI86E,iBAYX7yE,0BANqB,OAAO/H,KAAK0F,IAAI2lD,eAAe6Z,wBAE5B,OAAOllE,KAAK0F,IAAI2lD,eAAewhB,OAAOgO,cAAgB,gBAEtD,OAAO76E,KAAK0F,IAAI2lD,eAAewhB,OAAOiO,2DAVnD/5E,8BAAmBugB,2RCThC5hB,iBACEA,oBAMEA,gCAASI,qDACTJ,sBACFA,QAEAA,oBAMEA,gCAASI,sDACTJ,sBACFA,QACFA,eAjBIA,0FAAwE,gBAAxEA,CAAwE,8BAUxEA,2FAAyE,gBAAzEA,CAAyE,iiBDJhEqB,+CETbrB,iBACEA,oBAKEA,6FACAA,uCACFA,QACFA,gCANIA,uEAAyD,iBAI/CA,kDCGDq7E,iBAuBXhzE,cApBS/H,WAAiC,IAAI+I,IAAgB,4BAI5D,OAAO/I,KAAKg7E,aAENn7E,GACNG,KAAKg7E,KAAOn7E,cAMZ,OAAOG,KAAK8gC,iBAEJjhC,GACRG,KAAK8gC,OAASjhC,EAKhBo7E,qBACEj7E,KAAK0F,IAAIq3C,GAAGg3B,KAAK,iBAAkB,KACjC/zE,KAAKk7E,WAAYl7E,KAAK0F,IAAIsuE,sBAAsB3D,UAAUjoE,UAAUvI,IAEhEG,KAAK6tB,MAAM1lB,KADTtI,EACc,iBAEA,kBAMxBsY,cACMnY,KAAKk7E,YACPl7E,KAAKk7E,WAAWxyE,cAIpByyE,qBAEEn7E,KAAK0F,IAAIsuE,sBAAsB3C,UADdrxE,KAAK0F,IAAIsuE,sBAAsB3C,uDA3CvCtwE,8BAAwBugB,mTDVrC5hB,6BAA6CA,kXCUhCqB,MCGAq6E,iBAWZrzE,YAAmBlI,wBACdG,KAAKq7E,oBAGTA,oBACEr7E,KAAKs7E,uBAAyBt7E,KAAKu7E,gBAAkBv7E,KAAK6O,cAAcnE,UAAU,wCAClF1K,KAAKw7E,uBAAyBx7E,KAAKy7E,gBAAkBz7E,KAAK6O,cAAcnE,UAAU,wCAClF1K,KAAK07E,qBAAuB17E,KAAK27E,cAAgB37E,KAAK6O,cAAcnE,UAAU,sCAG1E1K,KAAKy7E,gBAAkBz7E,KAAK27E,eAC9B37E,KAAKs7E,4BAAyB,GAIlCM,gBAEE,GADA57E,KAAKq7E,oBACDr7E,KAAKs7E,uBACPt7E,KAAK0F,IAAI2lD,eAAe0Z,aAAa/kE,KAAKs7E,gCACjCt7E,KAAKw7E,wBAA0Bx7E,KAAK07E,qBAAsB,CACnE,MAAM77E,EAASguD,MAAkB7tD,KAAKw7E,uBAAwBx7E,KAAK0F,IAAI2lD,eAAewhB,OAAOU,gBAAgBhsB,WAC7GvhD,KAAK0F,IAAI2lD,eAAewhB,OAAOtZ,UAAU1zD,GACzCG,KAAK0F,IAAI2lD,eAAeyiB,OAAO9tE,KAAK07E,qEAjC7B36E,GAAyBrB,mCAAzBqB,EAAyBugB,gXCbtC5hB,iBAA8CA,oBAKxCA,gCAASI,yCAAiBJ,sBAAiDA,QAASA,eAHpFA,yEAA2D,+XDWpDqB,+CEbbrB,iBACEA,eACEA,oBAKEA,8GACAA,uCACFA,QACFA,QACFA,gCARMA,gCAAe,uHAKLA,kDCcHm8E,iBAgBX9zE,YACUlI,EACAC,GADAE,cACAA,sBAhBDA,WAAgB,UAWhBA,WAAiC,IAAI+I,IAAgB,SACvD/I,cAAU,EAMfA,KAAK4mB,UAAU5mB,KAAK2K,OAAOD,UAAU,qBACrC1K,KAAK87E,QAAU,IAAIC,MACW/6E,YAAoB,CAChDorD,GAAI,KACJ4vB,KAAM,MACNC,OAAQ,MACRC,QAAS,KACTC,MAAO,MACPC,OAAQ,SAGRp8E,KAAKq8E,kBACLr8E,KAAKo+B,SAAU,EACfl9B,OAAOo7E,OAAS,KACdt8E,KAAKq8E,kBACLr8E,KAAKo+B,SAAU,IAGnBp+B,KAAKo+B,QAAUp+B,KAAKu8E,iBAAmBv8E,KAAKq8E,gCAhC5C,OAAOr8E,KAAKswE,eAAe7mE,IAAI,+BAErB5J,GACVG,KAAKswE,eAAe76D,IAAI,kBAAmB5V,GAsCrC08E,iBACNv8E,KAAK87E,QAAQj6C,SACb7hC,KAAKo+B,SAAU,EACfp+B,KAAK6tB,MAAM1lB,KAAK,aAKVk0E,kBACNr8E,KAAK87E,QAAQ9yD,UACbhpB,KAAKo+B,SAAU,EACfp+B,KAAK6tB,MAAM1lB,KAAK,SAGlBq0E,iBACMx8E,KAAKo+B,QACPp+B,KAAKq8E,kBAELr8E,KAAKu8E,+DAjEEx7E,GAAuBrB,6CAAvBqB,EAAuBugB,qUDtBpC5hB,6BAAMA,gWCsBOqB,6BCdRrB,iBACEA,yCAKEA,sBACFA,QACFA,eALIA,0GAOJA,kGACEA,mBAAW,cAAXA,CAAW,+FAAXA,CAAW,4CAAXA,CAAW,0IAnBlBA,iBAIKA,qFAA4C,GAA5CA,CAAkD,8EACP,GAD3CA,CAAkD,gEAIlDA,wBAUAA,qCAQDA,iBACEA,sBACFA,QAEJA,gCA5BKA,sCAAwC,0FAMlCA,gEAUyDA,4CCJvD+8E,iBAUX10E,YAAoBlI,uBANbG,iBAAuB,GACvBA,aAAS,EACTA,iBAAa,EAKJA,KAAKikB,aAAa3P,OAAOxS,QACzBgS,gBAAuC,IAAvB9T,KAAK08E,gBACjC18E,KAAK08E,eAAgB,GAIzB95C,kBACE5iC,KAAKq4E,SAAWr4E,KAAK0F,IAAIktE,QAAQxqE,UAAUvI,IACzCG,KAAK28E,YAAc98E,EAAY4G,OAAO3G,GAAKA,EAAEkvD,aAIjD72C,cACEnY,KAAKq4E,SAAS3vE,cAGhBk0E,mBAEI58E,KAAK68E,UADH78E,KAAK88E,WAAWv8E,OAAS,GAAKP,KAAK08E,iBACtB18E,KAAK68E,OAENC,iBAKhB,MAAMj9E,EAAgBG,KAAK0F,IAAI2lD,eAAe0F,gBACxCjxD,EAAUE,KAAK0F,IAAI2lD,eAAe6Z,UAElC9kE,EAAKJ,KAAK28E,YAAYl2E,OAAOnG,KAE7BA,EAAEsO,QAAQqgD,eACVpvD,GAAiBS,EAAEsO,QAAQqgD,kBAC3B3uD,EAAEsO,QAAQ+7C,eAAiB9qD,GAAiBS,EAAEsO,QAAQ+7C,kBACtDrqD,EAAEsO,QAAQ0N,OAAO1N,QAAQqgE,SAAWnvE,GAAWQ,EAAEsO,QAAQ0N,OAAO1N,QAAQqgE,YACxE3uE,EAAEsO,QAAQ0N,OAAO1N,QAAQimE,SAAW/0E,GAAWQ,EAAEsO,QAAQ0N,OAAO1N,QAAQimE,UAIxEx0E,EAAWD,EAAGqG,OAAOnG,IAAMA,EAAEsmB,SACnC,OAAOvmB,EAASE,OAAS,IAAMH,EAAGG,OAASF,EAAWD,gDAlD7CW,GAA2BrB,oCAA3BqB,EAA2BugB,ywBDdxC5hB,6BAAMA,wqBCYQ,ECFL,SAAQ,yBAA0B,IACvCmnC,OACE,kBACAA,OAAM,CACJk2C,OAAQ,OACRtlB,MAAO,OACPyS,SAAU,eAGdrjC,OACE,iBACAA,OAAM,CACJk2C,OAAQ,OACR7S,SAAU,eAGdrjC,OACE,YACAA,OAAM,CACJqjC,SAAU,aAGd,SAAW,sBAAsB,SAAQ,aACzCrjC,OAAW,wBAAsBA,OAAQ,gBDnBhC9lC,MEHAi8E,iBAKXj1E,YACUlI,EACAC,GADAE,2BACAA,mBANDA,YAAiB,UACnBA,mBAAuC,IAAIqW,IAC3CrW,eAAoB,EAgB3B0Z,OAAO7Z,EAAaC,EAAkBM,EAAaC,EAAwCC,GACzF,IAAKF,EACH,OAEF,IAAII,GAAW,EAEf,MAAMkD,EAA8B,IAAIsE,KACxC,IAKInE,EALAD,KAA2BoI,MAAG5L,GAMlC,OALIA,aAAkBkX,OACpB1T,EAAU5D,KAAKi9E,YAAYxmE,aAAarW,GACxCI,GAAW,GAGboD,EAAQ2E,QACNmsD,SACA,QAAU3wD,IACRF,EAAY,CACVgN,MACAqsE,WACAjmE,OAAQlT,EACRo5E,WAAY38E,EACZ48E,eACAC,eAEKr9E,KAAKs9E,oBAAoBC,QAAQv9E,KAAKw9E,OAAQ39E,MAEvD,QAAWkE,IACT,GAAKA,EAGE,CACL,MAAMC,EAAkBD,EAASm5E,SACjC,GAAIl5E,IAAoBlE,EAAU,CAChC,MAAM6E,EAAa3E,KAAKy9E,cAAch0E,IAAIzF,QACvB,IAAfW,GACFA,EAAW/D,KAAKmD,EAAS8M,KACzB7Q,KAAKy9E,cAAchoE,IAAIzR,EAAiBW,IAExC3E,KAAKy9E,cAAchoE,IAAIzR,EAAiB,CAACD,EAAS8M,MAGtD,OAAO7Q,KAAK09E,aAAa75E,GAbzB,YAAK85E,YACE39E,KAAKs9E,oBAAoBthD,IAAIh8B,KAAKw9E,OAAQ35E,MAerDuE,UAAWrE,IACXL,EAAQyE,KAAKpE,GACbL,EAAQ4hB,aAEH5hB,EAGDg6E,aAAa79E,GACnB,MAAMC,EAA8B,IAAIkI,KAExC,OADsBhI,KAAKs9E,oBAAoBM,YAAY59E,KAAKw9E,OAAQ39E,EAAUgR,KACpEtI,MACZ,QAAUlI,GAAaA,EAAYL,KAAKs9E,oBAAoBthD,IAAIh8B,KAAKw9E,OAAQ39E,IAAa,aAAG,KAE9FuI,UAAU/H,IACLA,GACFP,EAAQqI,KAAK9H,GAEfP,EAAQwlB,aAEHxlB,EAGT2J,IAAI5J,GACF,OAAOG,KAAKs9E,oBAAoBC,QAAQv9E,KAAKw9E,OAAQ39E,GAAK0I,MACxD,OAAKzI,IACH,GAAIA,EAAM,CACR,MAAMM,EAASN,EAAKmX,OACpB,OAAKnX,EAAKq9E,WAGHn9E,KAAKi9E,YAAY/lE,eAAe9W,GAF9BA,MAQjBy9E,uBAAuBh+E,GACrB,MAAMC,EAA2B,IAAIkI,KAMrC,OALkBhI,KAAK89E,cAAcj+E,GAClCuI,UAAW/H,IACVP,EAAQqI,KAAK9H,EAAME,QACnBT,EAAQwlB,aAELxlB,EAGTg+E,cAAcj+E,GACZ,IAAKA,EACH,OAGF,MAAMC,EAAsBi+E,YAAYC,KAAKn+E,GAE7C,OADkBG,KAAKs9E,oBAAoBW,cAAcj+E,KAAKw9E,OAAQ,WAAY19E,GAIpFo+E,iBAAiBr+E,GACf,IAAKA,EACH,OAGF,MAAMC,EAAsBi+E,YAAYC,KAAKn+E,GACvCO,EAAYJ,KAAKs9E,oBAAoBW,cAAcj+E,KAAKw9E,OAAQ,WAAY19E,GAClF,SAAUsI,UAAW/H,IACnBA,EAAMyF,QAASxF,IACbN,KAAKs9E,oBAAoBM,YAAY59E,KAAKw9E,OAAQl9E,EAAKuQ,SAGpDzQ,EAGT+9E,WACEt+E,EAAwBk+E,YAAYK,WAAW,GAC/Ct+E,EAAegS,eAGf,OADgB9R,KAAKs9E,oBAAoBe,kBAAkBr+E,KAAKw9E,OAAQ,WAAY39E,EAAUC,GAIhGw+E,gBACEt+E,KAAKu+E,qBACLv+E,KAAK29E,UAAY,EAGnBY,qBACEv+E,KAAKy9E,cAAgB,IAAIpnE,IAG3BmoE,mBACE,UAAY3+E,EAAUC,KAAeE,KAAKy9E,cACxC,UAAWr9E,KAAON,EAChBE,KAAKs9E,oBAAoBmB,SAASz+E,KAAKw9E,OAAQp9E,GAC5CmI,MAAK,QAAK,IACVH,UAAW/H,IACYA,EACR68E,SAAWr9E,EACzBG,KAAK09E,aAAar9E,oBAO1B,OAAOL,KAAK29E,wDAtKH58E,GAAYrB,kDAAZqB,EAAYsI,QAAZtI,EAAY,qBAFX,SAEDA,MCQA29E,iBAEX32E,YACUlI,EACDC,EACCM,GAFAJ,YACDA,oBACCA,sBAJFA,oBAAyB,EAM/BA,KAAK2+E,eAAevmE,eAAehQ,UAAW/H,IAC5CL,KAAK4+E,cAAgBv+E,EAAMoX,aAI/BhO,IAAI5J,EAAaC,GACf,OAAIoB,OAAOC,UAAUuW,QAAU1X,KAAK4+E,cAC3B5+E,KAAK6+E,UAAUh/E,EAAKC,GAEtBE,KAAK8+E,WAAWj/E,GAGjBg/E,UAAUh/E,EAAaC,GAC7B,IAAIM,EACJ,OAAQN,EAAiBqlB,kBAElB,cACH/kB,EAAUJ,KAAKkM,KAAKzC,IAAI5J,EAAK,CAAEslB,aAAc,cAAe+0B,gBAAiBp6C,EAAiBo6C,kBAC9F,UACG,OACH95C,EAAUJ,KAAKkM,KAAKzC,IAAI5J,EAAK,CAAEslB,aAAc,OAAQ+0B,gBAAiBp6C,EAAiBo6C,kBACvF,UACG,OACH95C,EAAUJ,KAAKkM,KAAKzC,IAAI5J,EAAK,CAAEslB,aAAc,OAAQ+0B,gBAAiBp6C,EAAiBo6C,kBACrF,UACC,OACH95C,EAAUJ,KAAKkM,KAAKzC,IAAI5J,EAAK,CAAEslB,aAAc,OAAQ+0B,gBAAiBp6C,EAAiBo6C,kBACvF,cAEA95C,EAAUJ,KAAKkM,KAAKzC,IAAI5J,EAAK,CAAEslB,aAAc,OAAQ+0B,gBAAiBp6C,EAAiBo6C,kBAG3F,OAAO95C,EAGD0+E,WAAWj/E,GACjB,OAAOG,KAAKw0D,aAAa/qD,IAAI5J,GAGxBk/E,WACL,OAAO/+E,KAAK4+E,eAAiB19E,OAAOC,UAAUuW,qDA/CrC3W,GAAiBrB,4DAAjBqB,EAAiBsI,QAAjBtI,EAAiB,qBAFhB,SAEDA,MCgCAi+E,iBACXj3E,YACUlI,EACAC,EACAM,EACAC,EACAC,EACAE,EACYkD,GANZ1D,YACAA,oBACAA,yBACAA,kBACAA,sBACAA,uBACYA,uBAGtBi/E,YAAYp/E,GACV,IAAKA,EAAayc,OAChB,OAaF,IAAIxc,EACJ,OAVED,EAAayc,OAAO1N,SACpB/O,EAAayc,OAAO1N,QAAQqxD,0BAE5BpgE,EAAe0G,YACb1G,EAAayc,OAAO1N,QAAQqxD,wBAC5BpgE,GAAgB,KAKZA,EAAayc,OAAOvU,kBACrBk7D,QACAQ,QACAC,QACAC,QACAC,QACAI,GACHlkE,EAAQE,KAAKk/E,gBAAgBr/E,GAC7B,WACGmsD,QACAmX,QACAW,QACAZ,QACAhX,GACHpsD,EAAQE,KAAKm/E,kBAAkBt/E,GAC/B,WACGkkE,QACAvY,GACH1rD,EAAQE,KAAKo/E,iBAAiBv/E,GAC9B,WACGokE,GACH,MAAM7jE,EAAgBi/E,GAAyBx/E,GAC/CC,EAAQE,KAAKs/E,sBACXl/E,GAON,OAAON,EAGTy/E,iBAAiB1/E,EAAgCC,GAC/C,MAAMM,EAAei/E,GAAyBx/E,GAC9C,OAAIO,EAAakc,OACR,IAAI5F,IAAWrW,GAAKA,EAAE8H,KAAKnI,KAAKi/E,YAAY7+E,KAG9CJ,KAAKw/E,kBACTvd,sBAAsB7hE,EAAam9C,cAAez9C,GAClDyI,MACC,OAAIlI,IACF,QAAe,IAAXA,EAGJ,OAAOL,KAAKi/E,YAAYr5E,OAAOU,OAAOlG,EAAc,CAAEkc,eAKtD8iE,iBAAiBv/E,GACvB,OAAO,IAAI4/E,GAAW5/E,EAAcG,KAAK+Q,eAAgB/Q,KAAK+P,gBAAiB/P,KAAK2xD,iBAG9EutB,gBAAgBr/E,GACtB,OAAO,IAAI6/E,GAAU7/E,EAAcG,KAAK+Q,eAAgB/Q,KAAK2xD,iBAGvDwtB,kBAAkBt/E,GACxB,IAAIC,EACAM,EAKJ,QAJ2B,IAAvBP,EAAawwB,QACfvwB,EAAQ,CAACQ,EAASE,IAAeR,KAAKi5E,aAAa7O,YAAYvqE,EAAawwB,MAAO/vB,EAASE,IAG1FX,EAAayc,kBAAkBwnD,GAEjChkE,EAAQD,EADoByc,OACb1N,QAAQo9B,OAAO3b,cACrBxwB,EAAa29C,iBAAkB,CACxC,MAAMl9C,EAAeN,KAAKi5E,aAC1Bp5E,EAAawwB,MAAQ,CAAC7vB,EAASkD,IACtBpD,EAAasqE,uBAClBpqE,EACAX,EAAa29C,iBACb95C,GAGJtD,EAAW,IAAI+kE,GAAYtlE,EAAcG,KAAK+Q,eAAgB/Q,KAAK2xD,gBAAiB3xD,KAAK2/E,YAG3F,GAAI9/E,EAAayc,kBAAkB4vC,GAAmB,CACpD,MAAM5rD,EAAeN,KAAKi5E,aACpBz4E,EAAYX,EAAa+/E,iBAC/B//E,EAAawwB,MAAQ,CAAC3sB,EAASE,IACtBtD,EAAa2qE,mBAClBvnE,EACAE,EACA/D,EAAaggF,aACbr/E,GAGJJ,EAAW,IAAI+kE,GAAYtlE,EAAcG,KAAK+Q,eAAgB/Q,KAAK2xD,gBAAiB3xD,KAAK2/E,YAG3F,MAAMt/E,EAAiBuF,OAAOU,OAAO,GAAIzG,EAAc,CACrDwwB,UAGF,OAAKjwB,IACHA,EAAW,IAAI+kE,GAAY9kE,EAAgBL,KAAK+Q,eAAgB/Q,KAAK2xD,gBAAiB3xD,KAAK2/E,aAG7F3/E,KAAK8/E,iBAAiB1/E,EAAUC,GAEzBD,EAGDk/E,sBACNz/E,GAEA,IAAIC,EACAM,EAMJ,QAJ2B,IAAvBP,EAAawwB,QACfvwB,EAAQ,CAACQ,EAASE,IAAeR,KAAKi5E,aAAa7O,YAAYvqE,EAAawwB,MAAO/vB,EAASE,IAG1FX,EAAa29C,iBAAkB,CACjC,MAAMl9C,EAAeN,KAAKi5E,aAC1Bp5E,EAAawwB,MAAQ,CAAC7vB,EAASkD,IACtBpD,EAAasqE,uBAClBpqE,EACAX,EAAa29C,iBACb95C,GAGJtD,EAAW,IAAI2/E,GAAgBlgF,EAAcG,KAAK+Q,eAAgB/Q,KAAK2xD,iBAGzE,MAAMtxD,EAAiBuF,OAAOU,OAAO,GAAIzG,EAAc,CACrDwwB,UAGF,OAAKjwB,IACHA,EAAW,IAAI2/E,GAAgB1/E,EAAgBL,KAAK+Q,eAAgB/Q,KAAK2xD,kBAG3E3xD,KAAK8/E,iBAAiB1/E,EAAUC,GACzBD,EAGD0/E,iBAAiBjgF,EAAcC,GACjCA,EAAakgF,aACfhgF,KAAKigF,SAASngF,EAAakgF,YAAYnvE,KAAKzI,UAAUhI,IACpD,GAAIA,EAAI8/E,OAAO,CACb,MAAM7/E,EAAML,KAAKmgF,eAAergF,EAAakgF,YAAYnvE,IAAKzQ,EAAI8/E,QAClElgF,KAAKigF,SAAS5/E,EAAI,SAAS+H,UAAU9H,KACnC,SAAcT,EAAMk9C,GAAI38C,EAAKN,EAAakgF,YAAY1jE,YAAQ,EAAWhc,EACvED,EAAI,iBAGR+/E,OAAcvgF,EAAMk9C,GAAI38C,EAAKN,EAAakgF,YAAY1jE,UAMtD2jE,SAASpgF,GACf,OAAOG,KAAKkM,KAAKzC,IAAI5J,GAAK0I,MACxB,OAAKzI,GAAaA,MAClBmL,KAAWnL,IACToL,QAAQC,IAAI,yBACLa,MAAGlM,MAKRqgF,eAAetgF,EAAQC,GAE7B,OAAG,IADWmlB,OAAO,WAAc,KAC9BC,KAAKplB,GACDA,EAEkC,MAApCD,EAAO6M,OAAO7M,EAAOU,OAAQ,GACzBV,EAASC,EAETD,EAAS,IAAMC,gDA3MjBiB,GAAYrB,sGAAZqB,EAAYsI,QAAZtI,EAAY,qBAFX,SAEDA,gCC/CTrB,iBAAmDA,SAAUA,+BAAVA,0EAFrDA,iBAAqBA,0FACnBA,6BACAA,wBACFA,gCAFmBA,gCACXA,oCCgBG2gF,iBAsBXt4E,YACUlI,EACAC,GADAE,oBACAA,cAPHA,aAAU,IAAIsgF,GAAO,CAC1B54D,SAAU,GACVsrD,cAAc,oBAVd,OAAOhzE,KAAKugF,yBAEA1gF,GACZG,KAAKugF,WAAa1gF,EAClBG,KAAKwgF,uBAAuB3gF,GAc9B+iC,kBACE5iC,KAAKygF,wBAAwBzgF,KAAK0F,IAAIq3C,GAAGuW,WACzCtzD,KAAK0F,IAAI2lD,eAAewhB,OAAO/jE,GAAG,SAAUjJ,IAC1CG,KAAKygF,wBAAyB5gF,EAAOunB,UAEvCpnB,KAAK0F,IAAIq3C,GAAGj0C,GAAG,cAAejJ,IAC5BG,KAAKygF,wBAAyB5gF,EAAOunB,OAAiBksC,aAI1Dn7C,cACEnY,KAAK0F,IAAI2lD,eAAewhB,OAAOlzC,GAAG,SAAU95B,IAC1CG,KAAKygF,wBAAyB5gF,EAAOunB,UAEvCpnB,KAAK0F,IAAIq3C,GAAGpjB,GAAG,cAAe95B,IAC5BG,KAAKygF,wBAAyB5gF,EAAOunB,OAAiBksC,aAI1DohB,gBAAgB70E,GACVG,KAAK4jB,WAGT5jB,KAAK0F,IAAIgvE,gBAAgB70E,GACzBG,KAAKg0C,OAAOC,QAGNwsC,wBAAwB5gF,GAC9B,MAAMC,EAAwBD,EAAYkrD,gBAC1C/qD,KAAK0gF,QAAQr1B,eAAewhB,OAAO8T,cAAc7gF,EAAsBsvE,YACvEpvE,KAAK0gF,QAAQr1B,eAAewhB,OAAO+T,YAAY9gF,EAAsBu7D,UACrEr7D,KAAK0gF,QAAQr1B,eAAewhB,OAAOtZ,UAAUvzD,KAAK0F,IAAI2lD,eAAemiB,aAG/DgT,uBAAuB3gF,GAC7BG,KAAK0gF,QAAQhL,kBAEb,MAAM51E,EAAe8F,OAAOU,OAC1BV,OAAO8B,OAAO7H,EAAU+O,SACxB/O,EAAU+O,QACV,CACEgY,SAAS,EACTooC,WAAW,IAIT5uD,EAAQJ,KAAK6gF,aAAa5B,YAAYn/E,GAC5CE,KAAK0gF,QAAQrb,SAASjlE,GACtBJ,KAAK8gF,sBAAsB1gF,GAGrB0gF,sBAAsBjhF,GAC5B,MAAMC,EAAeD,EAAU+O,QAAQ07C,aACvC,IAAKxqD,EACH,OAEF,MACMO,EAAeP,EAAayqD,MACZlqD,GAFEP,EAAakrD,SAGInrD,EAAU+O,QAAQ07C,aAAaU,QAEtE3qD,EAAaqF,IAAIlF,IACfA,EAAKyqD,UAAUvlD,IAAIhC,IACjB,MAAME,EAAe5D,KAAK0F,IAAI2kD,OAAOxvC,KAAKhX,IAAC,MAAI,OAAsB,QAAtBE,IAAE6K,QAAQ07C,oBAAY,eAAEU,UAAWtnD,IAClF,GAAIE,EAAc,CAChB,MAAMC,EAA0B+B,OAAOU,OACrCV,OAAO8B,OAAO9D,EAAagL,SAC3BhL,EAAagL,QACb,CACEmgD,OAAQ,IACRnoC,SAAS,EACTooC,WAAW,IAGfhvD,KAAK0gF,QAAQrb,SAASrlE,KAAK6gF,aAAa5B,YAAYp7E,uDArGnD9C,GAAoBrB,iDAApBqB,EAAoBugB,wUDpBjC5hB,iBAEEA,wBAKFA,eALQA,utBCkBKqB,+CCpBbrB,2DAGEA,oBACEA,yCAASA,EAATomB,MAASpgB,qCACThG,sBAEFA,QACFA,gCAPEA,wHAEkDA,gCAAe,uBAErDA,wHAKdA,2DAGEA,oBACEA,yCAASA,EAATomB,MAASpgB,qCACThG,sBAEFA,QACFA,gCAPEA,wHAEkDA,gCAAe,uBAErDA,mFCNDqhF,iBAgCXh5E,yBA7BE,OAAO/H,KAAKg7E,aAENn7E,GACNG,KAAKg7E,KAAOn7E,yBAMZ,OAAOG,KAAKghF,uCAEOnhF,GACnBG,KAAKghF,kBAAoBnhF,cAMzB,OAAOG,KAAK8gC,iBAEJjhC,GACRG,KAAK8gC,OAASjhC,gBAKd,OAAiD,IAA1CG,KAAK0F,IAAI2lD,eAAe8iB,cAKjC8S,cAAcphF,GAEZ,MAAO,CACLklB,UAFe,UAAYllB,EAAU,sDAnC9BkB,8BAAuBugB,gcDTpC5hB,wBAUAA,+BAVMA,6CAUAA,qmBCDOqB,gCCTbrB,iBACIA,eAAKA,SAAeA,QACxBA,8BADSA,mCCMIwhF,iBAIXn5E,cAFS/H,iBAAsB,iDAFpBe,8BAAoBugB,2KDPjC5hB,6BAAMA,6eCOOqB,UCPDogF,SAAZ,OAAYpgF,UAAe,KACzBi+D,cACAj+D,gBAFUogF,GAAZ,IAAYpgF,MAKAqgF,SAAZ,OAAYrgF,UAAW,KACrBA,eAAKA,mBAAMA,+BAAYA,+BAAYA,uCAAgBA,yCAAiBA,6BAD1DqgF,GAAZ,IAAYrgF,eCqCRgH,YAAYzG,EAAkBzB,GAC1B+F,OAAOU,OAAOtG,KAAMsB,GACpBtB,KAAKqhF,eAAiBxhF,GAM9B,iBAAyByhF,GACrBv5E,YAAYzG,EAAkBzB,GAC1BggB,MAAMve,EAASzB,GAEfG,KAAK8E,KAAOs8E,GADUA,GAAYA,GAAYrjC,MAI3CwjC,sBACH,OAAOvhF,KAAKqhF,eAAeG,yBAAyBxhF,OAI5D,iBAA0BshF,GACtBv5E,YAAYzG,EAAkBzB,GAC1BggB,MAAMve,EAASzB,GAEfG,KAAK8E,KAAOs8E,GADUA,GAAYA,GAAYnjC,OAI3CsjC,sBACH,OAAOvhF,KAAKqhF,eAAeI,0BAA0BzhF,OAI7D,iBAAgCshF,GAC5Bv5E,YAAYzG,EAAkBzB,GAC1BggB,MAAMve,EAASzB,GAEfG,KAAK8E,KAAOs8E,GADUA,GAAYA,GAAYM,aAI3CH,sBACH,OAAOvhF,KAAKqhF,eAAeM,0BAA0B3hF,OAI7D,iBAAgCshF,GAC5Bv5E,YAAYzG,EAAkBzB,GAC1BggB,MAAMve,EAASzB,GAEfG,KAAK8E,KAAOs8E,GADUA,GAAYA,GAAY3iC,aAI3C8iC,sBACH,OAAOvhF,KAAKqhF,eAAeO,2BAA2B5hF,OAI9D,iBAA2CshF,GACvCv5E,YAAYzG,EAAkBzB,EAAyBC,GACnD+f,MAAMve,EAASzB,GACfG,KAAK8E,KAAOs8E,GAAYA,GAAYthF,IAGjCyhF,sBACH,OAAOvhF,KAAKqhF,eAAeO,2BAA2B5hF,wBAIxBshF,GAGlCv5E,YAAYzG,EAAkBzB,GAC1BggB,MAAMve,EAASzB,GAEfG,KAAK8E,KAAOs8E,GADUA,GAAYA,GAAYS,YAE9C7hF,KAAK6Q,IAAM,KAGR0wE,sBACH,OAAOvhF,KAAKqhF,eAAeS,+BAA+B9hF,gBAIvC+hF,6BAEazgF,EAAkBzB,GAElD,IAAIC,EACJ,OACIA,EADAwB,EAAQqF,eAAe,aACb,IAAIq7E,GAAiB1gF,EAASzB,GACrCyB,EAAYwD,OAASs8E,GAAYA,GAAYM,YACtC,IAAIO,GAAkB3gF,EAASzB,GAClCyB,EAAQwD,OAASs8E,GAAYA,GAAY3iC,YACtC,IAAIyjC,GAAkB5gF,EAASzB,GACtCyB,EAAYwD,OAASs8E,GAAYA,GAAYxiC,gBACtC,IAAIujC,GAA6B7gF,EAASzB,EAASuhF,GAAYxiC,gBACtEt9C,EAAYwD,OAASs8E,GAAYA,GAAYziC,iBACtC,IAAIwjC,GAA6B7gF,EAASzB,EAASuhF,GAAYziC,iBACtEr9C,EAAYwD,OAASs8E,GAAYA,GAAYnjC,MACtC,IAAImkC,GAAY9gF,EAASzB,GAEzB,IAAIwiF,GAAW/gF,EAASzB,GAG/BC,OCtGFwiF,iBAOXv6E,YACUlI,EACAC,EACAM,GAFAJ,YACAA,sBACAA,uBATHA,mBAAe,EACfA,yBAAsB,GACtBA,kBAAe,GAEdA,wBAAqB,GAO7BuiF,MAAM1iF,EAAiBC,GACrB,OAAIE,KAAKwiF,mBAAmBjiF,QAC1BP,KAAKwiF,mBAAmB18E,QAAQ1F,IAC9BJ,KAAK+Q,eAAeZ,OAAO/P,KAGxBP,EACJ4G,OAAQrG,GAAiBA,EAAMwmB,SAAWxmB,EAAMiwD,sBAChD3qD,IAAKtF,GAAiBJ,KAAKyiF,WAAWriF,EAAON,IAGlD2iF,WAAW5iF,EAAcC,GACvB,MAAMM,EAAMJ,KAAK0iF,YAAY7iF,EAAM6mB,WAAY5mB,GAAS,EAAOD,EAAM6F,IAAI2lD,eAAewK,aACxF,IAAKz1D,EACH,SAAO4L,MAAG,IAGZ,GACGnM,EAAM6mB,WAAmC9X,QAAQ28B,cAClDya,GAAY28B,SACZ,CACA,MAAMriF,EAASN,KAAK0iF,YAAY7iF,EAAM6mB,WAAY5mB,GAAS,GAC3D,OAAOE,KAAKkM,KAAKzC,IAAInJ,EAAQ,CAAE6kB,aAAc,SAAU5c,MACrD,SAAS/H,IACP,MAAMkD,EAAY1D,KAAK4iF,SAASpiF,EAAQJ,EAAKP,GACvC+D,EAAcF,EAAU,GACxBG,EAAoBH,EAAU,GACpC,OAAO1D,KAAKkM,KACTzC,IAAIrJ,EAAK,CAAE+kB,aAAc,SACzB5c,QACCsmD,KAAI9qD,GACF/D,KAAK6iF,YAAY9+E,EAAKlE,EAAOC,EAASM,EAAKwD,EAAaC,QAQpE,OAAO7D,KADckM,KAAKzC,IAAIrJ,EAAK,CAAE+kB,aAAc,SACpC5c,QAAKsmD,KAAIvuD,GAAON,KAAK6iF,YAAYviF,EAAKT,EAAOC,EAASM,KAG/DwiF,SAAS/iF,EAAQC,EAAKM,WAE5B,IAAIsD,OADekkD,MACGwM,aAAav0D,GAEX,IAApB6D,EAASnD,SAEXmD,OADsBo/E,MACD1uB,aAAav0D,IAEpC,MAAM+D,EAAU,IAAIm/E,KAAuB,IAC3C,IAAIl/E,EACJ,MAAME,EAAW,GACjB,IACIY,EADAX,EAAU,IAAIg/E,KAAoB,IAEtC,MAAMlgC,EAAap/C,EAASnD,OAMtB0iD,EADUjjD,KADeijF,eAAenjF,EAAIiH,eACrBm8E,KACRv/E,MAAM,KACrB0/C,EAAauhB,QAGnB,IAAIlhB,EACAuD,EAsDAK,EAaAwjB,EAlEJ,GAJAlG,MAAgBvhB,EAAYJ,GAIH,QAArB3iD,EAAa,QAAbD,IAAMuO,eAAO,eAAE0N,cAAM,eAAE1N,QAAS,CAClC,MAAM44C,EAAoBpnD,EAAMwO,QAAQ0N,OACrC1N,QACC44C,EAAkBuB,aACpB9B,EAAiBO,EAAkBuB,YA+DvC,OA5DArlD,EAASgC,IAAI8hD,IAEX,GAAIP,EAAgB,CAClB,IAAImF,EAAoB5E,EAAQuD,gBAAgB9D,GAC5CmF,IACF1I,EAAeA,EAAoC,GAAGA,KAAgB0I,IAAvCA,GAOnC,MAAMjF,EAA6BK,EAAQuK,cAAcyB,iBACnDpM,EAAsBI,EAAQuK,cAAcM,UAMhD,QAJG1tD,IACHA,EAAmByiD,GAGXA,OACD,QACgB,IAAftE,EACFj/C,EAAM,IAAIkuE,KAAa5qB,EAA4B,MAEnDpjD,EAASnD,KAAKumD,GAEhB,UACG,aACHvjD,EAAQu/E,iBACN,IAAIC,KAAkBj8B,EAA4B,OAEpD,UACG,UACHnjD,EAAQq/E,cACN,IAAIC,MAAen8B,EAA4B,OAEjD,UACG,eACHnjD,EAAU,IAAIg/E,KAAoB77B,EAA4B,MAC9D,cAEA,UAONG,EADsB,IAApBvjD,EAASxD,QAAgBsD,EAClB,CACPiB,KAAMjB,EAAIwuD,UACVkxB,YAAa1/E,EAAI2vD,kBAGV,CACP1uD,KAAM,UACNy+E,YAAa,CAACvjF,KAAKwjF,WAAWz/E,KAK1BY,OACD,aACHmmE,EAAiB,CACfhmE,KAAMlB,EAAQyuD,UACdkxB,YAAa3/E,EAAQ4vD,sBAEpB,QACHsX,EAAiBxjB,MACd,UACHwjB,EAAiB,CACfhmE,KAAMd,EAAQquD,UACdkxB,YAAav/E,EAAQwvD,sBAEpB,eACHsX,EAAiB,CACfhmE,KAAMd,EAAQquD,UACdkxB,YAAav/E,EAAQwvD,kBAG3B,MAAMjM,EAAoB,GAE1B,OAAIN,IACFM,EAAkBN,GAAkBvD,GAG/B,CAAEonB,EAAgBvjB,GAK3Bk8B,MAAM5jF,EAAGC,EAAGM,GACV,OAAQP,EAAE,GAAKO,EAAE,KAAON,EAAE,GAAKM,EAAE,KAAOP,EAAE,GAAKO,EAAE,KAAON,EAAE,GAAKM,EAAE,IAQnEojF,WAAW3jF,GACTA,EAAOob,KAAK,CAAC5a,EAAGC,IACPD,EAAE,KAAOC,EAAE,GAAKD,EAAE,GAAKC,EAAE,GAAKD,EAAE,GAAKC,EAAE,IAGhD,MAAMR,EAAQ,GACd,UAAWO,KAASR,EAAQ,CAC1B,KACEC,EAAMS,QAAU,GAChBP,KAAKyjF,MAAM3jF,EAAMA,EAAMS,OAAS,GAAIT,EAAMA,EAAMS,OAAS,GAAIF,IAAU,GAEvEP,EAAMirB,MAERjrB,EAAMc,KAAKP,GAGb,MAAMD,EAAQ,GACd,QAASC,EAAIR,EAAOU,OAAS,EAAGF,GAAK,EAAGA,IAAK,CAC3C,KACED,EAAMG,QAAU,GAChBP,KAAKyjF,MACHrjF,EAAMA,EAAMG,OAAS,GACrBH,EAAMA,EAAMG,OAAS,GACrBV,EAAOQ,KACJ,GAELD,EAAM2qB,MAER3qB,EAAMQ,KAAKf,EAAOQ,IAGpB,SAAM0qB,MACNjrB,EAAMirB,MACCjrB,EAAMkG,OAAO5F,GAGdyiF,YACNhjF,EACAC,EACAM,EACAC,EACAC,EACAE,aAEA,MAAMuD,EAAkBjE,EAAM4mB,WAExB1iB,EAAwBhE,KAAK0jF,yBAAyB5jF,GAC5D,IAAI6E,EAAW,GACf,OAAQZ,EAAgB6K,QAAQ28B,kBACzBya,GAAY4Z,KACfj7D,EAAW3E,KAAK2jF,gBACd9jF,EACAC,EAAMivD,OACN/qD,GAEF,WACGgiD,GAAY/gD,UACZ+gD,GAAY0Z,aACZ1Z,GAAY2Z,SACfh7D,EAAW3E,KAAK4jF,mBAAmB/jF,EAAKC,EAAMivD,OAAQ/qD,GACtD,WACGgiD,GAAY69B,SACfl/E,EAAW3E,KAAK8jF,oBAAoBjkF,EAAKC,EAAMivD,OAAQ/qD,GACvD,WACGgiD,GAAY+9B,KACfp/E,EAAW3E,KAAKgkF,gBAAgBnkF,GAChC,WACGmmD,GAAY6Z,KACfl7D,EAAW3E,KAAKikF,gBACdpkF,EACAkE,EAAgBynC,gBAChBnrC,GAEF,WACG2lD,GAAY28B,SACfh+E,EAAW3E,KAAKikF,gBACdpkF,EACAkE,EAAgBynC,gBAChBnrC,EACAC,EACAE,GAEF,WACGwlD,GAAYC,aAEfthD,EAAW3E,KAAKkkF,gBAAgBrkF,EAAKC,EAAOkE,GAIhD,GAAIW,EAASpE,OAAS,GAA8B,OAAzBoE,EAAS,GAAGsgD,SAAmB,CACxD,MAAMjC,EAAYhjD,KAAKmkF,2BAA2B9jF,GAElD,UAAW4iD,KAAWt+C,EACpBs+C,EAAQgC,SAAWjC,EAIvB,MAAMF,EAAgBhjD,EAAM4mB,WAK5B,QAJyC,QAApBhjB,IAAcsoC,cAAM,eAAEo4C,eACzC,IAAIn/D,OAAO,iBAAmBjlB,KAAKqkF,cACnC,IAAIp/D,OAAO,iBAAmBjlB,KAAKskF,sBAGtBp/D,KAAK7kB,MACI,QAApBuD,IAAcooC,cAAM,eAAEo4C,gBAAiBz/E,EAASpE,SAAWP,KAAKqkF,gBAC5C,QAApBxgF,IAAcmoC,cAAM,eAAEo4C,gBAAiBz/E,EAASpE,SAAWP,KAAKskF,sBAClEtkF,KAAK+P,gBAAgB/B,UAAUvE,IAAI,gCAAiC,CAAC3H,MAAOhC,EAAMmP,QAAQ7G,UAAU46C,IAClG,MAAMC,EAAajjD,KAAK+Q,eAAerB,KAAKszC,GAC5ChjD,KAAKwiF,mBAAmB5hF,KAAKqiD,EAAWnzC,WAIrCnL,EAASe,IAAI,CAACs9C,EAAkBC,WACrC,MAAMO,EAAWR,EAAQ77B,WAAWpjB,EAAgBilD,UAEpD,IAAItF,EACJ,GAA0C,SAAX,QAA3BL,IAAMz0C,QAAQ2uC,qBAAa,eAAEz4C,MAAgB,CAC/C,MAAMgmE,EAAgBhrE,EAAM8O,QACzB2uC,cACHmG,EAAUonB,EAAgBA,EAAcvG,sBAAmB,EAG7D,IAAItd,EAAQjnD,KAAKukF,cAAcvhC,EAASljD,IACnCmnD,GAAStiD,EAASpE,OAAS,EAC9B0mD,EAAQ,GAAGnnD,EAAMmP,UAAUg0C,EAAQ,KACzBgE,IACVA,EAAQnnD,EAAMmP,OAGhB,MAAMq4C,EAAO1hD,OAAOU,OAAO,GAAI08C,EAAQnqC,MAAQ,GAAI,CACjDjU,GAAIqE,IACJgG,QACAy1D,SAAUlhB,EACVghC,YAAa1kF,EAAMmP,MACnB88B,MAAO,IAAOjsC,EAAMivD,OACpBwV,iBAAkB7gB,IAGpB,OAAO99C,OAAOU,OAAO08C,EAAS,CAC5BnqC,OACA4wC,WACmC,UAAjC1lD,EAAgB6K,QAAQ9J,KACpB,YACA1E,EAAQqpD,eAKZ06B,2BAA2BtkF,GACjC,MAAMC,EAAoBE,KAAKijF,eAAepjF,EAAIkH,eAC5C3G,EAAUN,EAAaojF,KACvB7iF,EAAQkoB,SAASzoB,EAAa23D,MAAO,IACrCn3D,EAASioB,SAASzoB,EAAai9E,OAAQ,IACvCv8E,EAAY+nB,SAASzoB,EAAaiB,GAAKjB,EAAaiM,EAAG,IACvDrI,EAAY6kB,SAASzoB,EAAay6D,GAAKz6D,EAAamH,EAAG,IAEvDrD,EAAOxD,EAAQuD,MAAM,KAC3B,IAAIE,EACgE,KAAjE0D,KAAK6mD,IAAIT,WAAW/pD,EAAK,KAAO2D,KAAK6mD,IAAIT,WAAW/pD,EAAK,MAGxD2D,KAAK6mD,IAAIT,WAAW/pD,EAAK,KAAO,MAClCC,EAAY,MAEd,MAAME,EACJ4pD,WAAW/pD,EAAK,IACf2D,KAAK6mD,IAAIT,WAAW/pD,EAAK,IAAM+pD,WAAW/pD,EAAK,KAAOpD,EACrDH,EACFwD,EACIG,EACJ2pD,WAAW/pD,EAAK,IACf2D,KAAK6mD,IAAIT,WAAW/pD,EAAK,IAAM+pD,WAAW/pD,EAAK,KAAOF,EACrDpD,EACFuD,EACIc,EAAUZ,EAAqB,EAAZF,EACnBi/C,EAAU9+C,EAAqB,EAAZH,EAEnBoD,EACJ,YACAlD,EACA,IACAC,EACA,KACAD,EACA,IACA++C,EACA,KACAn+C,EACA,IACAm+C,EACA,KACAn+C,EACA,IACAX,EACA,KACAD,EACA,IACAC,EACA,KAIIq/C,OAFaohC,MACgB/rB,YAAYzxD,GACjB8qD,cAO9B,MALgB,CACdjtD,KAAMu+C,EAAEgP,UACRkxB,YAAalgC,EAAEmQ,kBAMX0wB,gBAAgBrkF,EAAKC,EAAQM,GAEnC,IAAIE,OADesnD,MACGwM,aAAav0D,GAEnC,GAAwB,IAApBS,EAASC,OAAc,CACzB,MAAMC,EAAY,IAAIsiF,KACtB,IACExiF,EAAWE,EAAU4zD,aAAav0D,SAC3B6D,GACPwH,QAAQ0nC,KACN,6FAKN,OAAOtyC,EAASoF,IAAIlF,GAClBR,KAAK0kF,gBAAgBlkF,EAASV,EAAQM,IAIlCujF,gBAAgB9jF,EAAKC,EAAQM,GACnC,MAAMC,EAAS,IAAIynD,KACnB,IAAIxnD,EAAW,GACf,IACEA,EAAWD,EAAO+zD,aAAav0D,SACxBW,GACP0K,QAAQ0nC,KAAK,6CAEf,OAAOtyC,EAASoF,IAAIlF,GAClBR,KAAK0kF,gBAAgBlkF,EAASV,EAAQM,IAIlCwjF,mBAAmB/jF,EAAKC,EAAQM,GACtC,IAAIC,EAAW,GACf,IACEA,EAAW4E,KAAKC,MAAMrF,EAAIsG,QAAQ,WAAY,MAAMw+E,eAC7CrkF,GACP4K,QAAQ0nC,KAAK,yCAA0C,KAAM/yC,GAE/D,SAAS6F,IAAIpF,GAAWA,EAAQuY,KAAO,CACrCjU,GAAIqE,IACJ8iC,MAAO,IAAOjsC,EACd8qC,MAAOxqC,IAEFC,EAGDyjF,oBAAoBjkF,EAAKC,EAAQM,GACvC,GAAIP,EACF,IACE,GAAIoF,KAAKC,MAAMrF,GAAKwL,MAClB,MAAO,SAEF7K,IAKX,WAHmBm2D,MACKvC,aAAav0D,GAErB6F,IAAIlF,GAAWR,KAAK0kF,gBAAgBlkF,EAASV,EAAQM,IAG/D4jF,gBAAgBnkF,GAEtB,MAAO,GAGDokF,gBACNpkF,EACAC,EACAM,EACAC,EACAC,GAEA,MAAME,EAAoBR,KAAKijF,eAAe7iF,EAAI2G,eAC5CrD,EAAalD,EAAaokF,KAAOpkF,EAAaqkF,KAAO,YACrDjhF,EAAY5D,KAAKmkF,2BAA2B/jF,GAGhDN,IAAeqmD,GAAgB8C,OAC/BnpD,IAAeqmD,GAAgBC,SAE/BtmD,EAAaqmD,GAAgBC,QAG/B,MAAMviD,EAAehE,EAAIkH,cAAc7G,QAAQ,UACzC6D,EAAalE,EAAIkH,cAAc+9E,YAAY,WAAa,EAI9D,MAAa,KADAC,GAAUllF,EAAIuD,MAAMS,EAAcE,GAAYoC,QAAQ,cAAe,MACvD,KAARtG,EACV,GAGF,CACL,CACEiF,KAAM83C,GACN6M,aACAtiC,WAAYvhB,OAAOU,OAAO,CAAE8gB,OAAQtnB,EAAYiC,KAAMlC,EAAKgR,OAAOvQ,GAClE2kD,SAAU5kD,GAAmBuD,IAK3Bq/E,eAAepjF,GACrB,MAAMC,EAAcD,EAAI8D,MAAM,KAC9B,IAAK7D,EAAY,GACf,OAEF,MAAMM,EAAQN,EAAY,GAAG6D,MAAM,KAE7BtD,EAAS,GACf,SAAMyF,QAAQxF,IACZA,EAAOA,EAAKqD,MAAM,KAClBtD,EAAOC,EAAK,IAAMgT,mBAAmBhT,EAAK,IAAM,MAE3CD,EAGFqkF,gBACL7kF,EACAC,EACAM,GAEA,MAAMC,EAAkBR,EAAUkyD,cAC5BzxD,EAAkBsF,OAAOU,OAAO,GAAIzG,EAAUkrD,iBASpD,IAAIvqD,EACJ,cATOF,EAAW2kD,gBACX3kD,EAAW0kF,iBACX1kF,EAAWs1D,iBACXt1D,EAAW2kF,aACX3kF,EAAW4kF,aACX5kF,EAAW6kF,gBACX7kF,EAAW8kF,KAGd/kF,IACFG,EAAW,CACTsE,KAAMzE,EAAgBgyD,UACtBkxB,YAAaljF,EAAgBmzD,mBAI1B,CACL1uD,KAAM83C,GACN6M,gBAAY,EACZtiC,aACA89B,WACApsC,KAAM,CACJjU,GAAIqE,IACJ8iC,MAAO,IAAOjsC,EACd8qC,MAAOxqC,IAKLsiF,YACN7iF,EACAC,EACAM,GAAY,EACZC,GAEA,IAAIC,EAEJ,GAAIT,EAAW+O,QAAQy2E,SACrB,OAAOrlF,KAAKslF,kBAAkBzlF,EAAYC,EAASO,GAGrD,OAAQR,EAAWkI,kBACZyjD,GACH,MAAMhrD,EAAgBX,EAEhB6D,EAA2B,CAC/B6hF,YACE/kF,EAAcwrC,OAAOu5C,aACrBvlF,KAAKwlF,kBAAkB3lF,EAAW+O,QAAQ28B,aAC5Ck6C,aAAcjlF,EAAcwrC,OAAOsR,OACnC8mC,cAAe5jF,EAAcwrC,OAAOo4C,eAAiBpkF,KAAKskF,qBAGxD9jF,EAAcwrC,OAAOo4C,gBACvBpkF,KAAKqkF,aAAe7jF,EAAcwrC,OAAOo4C,eAGvChkF,IACFsD,EAAyB6hF,YAAcvlF,KAAKwlF,kBAC1Cx/B,GAAYC,OAIhB3lD,EAAME,EAAcu8C,GAAG2oC,kBACrB5lF,EAAQyjF,YACRzjF,EAAQsvE,WACRtvE,EAAQ2pD,WACR/lD,GAUF,WACGkgE,GACH,MAAMhgE,EAAkB/D,EAqBxBS,EAAM,GAnBJ,WACAsD,EAAgBgL,QAAQymC,QACxB,yCAGA,MAAQzxC,EAAgBgL,QAAQjE,OAAO0/C,OAAO,GAAGz7C,QAAQ+2E,8EAOzD7lF,EAAQyjF,YAAY,GACpB,IACAzjF,EAAQyjF,YAAY,GACpB,YAPa3/E,EAAgBgL,QAAQg3E,eACnChiF,EAAgBgL,QAAQg3E,eACxB,QAOF,OAGF,WACG7hB,QACAC,GACH,MAAMhhB,EAA2BnjD,EAC3BojD,EAAS17C,KAAK6mD,IAAI/tD,EAAU,GAAKA,EAAU,IAC3CgjD,EAAS97C,KAAK6mD,IAAI/tD,EAAU,GAAKA,EAAU,IAE3CqjD,EAAyB,MADdT,EAASI,EAASJ,EAASI,GAEtC4D,EAAYjE,EAAyBp0C,QAAQg3E,eAAiB5iC,EAAyBp0C,QAAQg3E,eAAiBliC,EAChH4D,EAASsd,MACbA,MAAwB,CAAC9kE,EAAQyjF,cACjCt8B,GA4BF3mD,EAAM,GAzBJ0iD,EAAyBp0C,QAAQiC,IACjC,IACAmyC,EAAyBp0C,QAAQ6tC,MACjC,aAYa,CACb,SACA,YAbeqa,mBACf,WACExP,EAAO,GACP,WACAA,EAAO,GACP,WACAA,EAAO,GACP,WACAA,EAAO,GACP,0CAKF,oCACA,cACA,sCACA,cACA,sBACA,gBAE4BxmD,KAAK,OAMvC,OAAOR,EAGDklF,kBAAkB3lF,GACxB,IAAIC,EAAO,0BACX,MAAMM,EAAUwF,OAAOC,KAAKmgD,IAAanrC,KACvCxa,GAAO2lD,GAAY3lD,KAASR,GAE9B,OAAIO,IACFN,EAAOomD,GAAoB9lD,IAGtBN,EAGT4jF,yBAAyB7jF,aACvB,IAAIS,EACJ,OACgC,QAA9BD,EAAqB,QAArBD,EAAa,QAAbN,IAAM8O,eAAO,eAAE0N,cAAM,eAAE1N,eAAO,eAAEs4C,eAChCrnD,EAAM+O,QAAQ0N,OAAO1N,QAAQs4C,aAAa3mD,QAAU,IAEpDD,EAAwB,GACxBT,EAAM+O,QAAQ0N,OAAO1N,QAAQs4C,aAAaphD,QAAQtF,IAEhDF,EAAsBE,EAAY0Q,MADpB1Q,EAAYoqC,MAAQpqC,EAAYoqC,MAAQpqC,EAAY0Q,QAI/D5Q,EAGTikF,cAAc1kF,EAAkBC,WAC9B,IAAIQ,EACJ,GAAyB,QAArBD,EAAa,QAAbD,IAAMwO,eAAO,eAAE0N,cAAM,eAAE1N,QAAS,CAClC,MAAMpO,EAAoBV,EAAM8O,QAAQ0N,OACrC1N,QACCpO,EAAkBuoD,aACpBzoD,EAAQN,KAAK6lF,cAAchmF,EAASW,EAAkBuoD,aAI1D,OAAOzoD,EAGTulF,cAAchmF,EAAkBC,GAC9B,IAAIM,EAAQN,EACZ,MAAMO,EAAa8D,MAAMgL,KAAKrP,EAAW2rE,SAAS,sBAElD,SAAW3lE,QAAQxF,IACjBF,EAAQA,EAAM+F,QAAQ7F,EAAE,GAAIT,EAAQsnB,WAAW7mB,EAAE,OAIzB,IAAtBD,EAAWE,QAAgBH,IAAUN,IACvCM,EAAQP,EAAQsnB,WAAWrnB,IAAeA,GAGrCM,EAUTklF,kBACEzlF,EACAC,EACAM,GAWE,OATUP,EAAW+O,QAAQy2E,SAASl/E,QAAQ,YAAa/F,EAAU,GAAG6C,YACvEkD,QAAQ,YAAa/F,EAAU,GAAG6C,YAClCkD,QAAQ,YAAa/F,EAAU,GAAG6C,YAClCkD,QAAQ,YAAa/F,EAAU,GAAG6C,YAClCkD,QAAQ,SAAUrG,EAAQyjF,YAAY,GAAGtgF,YACzCkD,QAAQ,SAAUrG,EAAQyjF,YAAY,GAAGtgF,YACzCkD,QAAQ,kBAAmBrG,EAAQsvE,WAAWnsE,YAC9CkD,QAAQ,YAAarG,EAAQ2pD,WAAWtjD,QAAQ,QAAQ,mDA3uBlDpF,GAAYrB,4DAAZqB,EAAYsI,QAAZtI,EAAY,qBAFX,SAEDA,kBChCoBA,GAE/B,OAAwC,IAAjCA,EADkB2lB,WACP9X,QAAQwwD,sBA4Bcr+D,GACxC,MAAMO,EAAQP,EAAQ0I,IAAI,UAC1B,YAAiB,IAAVnI,GAA+BwkF,GAAiBxkF,aAZjBP,GACtC,MAAMO,EAAaP,EAAM2lB,WACzB,YAAiD,IAA1CplB,EAAWsN,QAAQm3E,qBAA8E,IAA1CzkF,EAAWsN,QAAQm3E,mBAU1BzkF,CAAkCA,OCA9E0kF,iBAyDXj+E,YACkBlI,EACRC,GADQE,iBACRA,oBAvDFA,eAA4B,GAoB3BA,oBAAyB,EAKzBA,+BAAoC,EAUpCA,wBAA6B,EAK5BA,WAAQ,IAAIN,gBAUpB,OAAQM,KAAKs2B,UAAU5wB,IAYzBk9B,kBACE5iC,KAAK+nE,mBACL/nE,KAAKioE,wBAOP9vD,cACEnY,KAAKimF,uBACLjmF,KAAK4nE,qBACL5nE,KAAK6nE,2BAMCE,mBACN/nE,KAAKooE,iBAAmBpoE,KAAK0F,IAAIq3C,GAAGj0C,GAClC,cACCjJ,GAAuCG,KAAKw5E,WAAW35E,IAOpD+nE,sBACN,QAAQ5nE,KAAKooE,kBACbpoE,KAAKooE,sBAAmB,EAOlBoR,WAAW35E,GAEjB,GADAG,KAAKimF,wBACAjmF,KAAKkmF,aAAaC,aACrB,OAGF,MAAMrmF,EAAW,GACbE,KAAKomF,eACPtmF,EAASc,KAAKZ,KAAKqmF,gBAAgBxmF,IAGrC,MAAMO,EAAaJ,KAAK0F,IAAIq3C,GAAGuW,UAAUvC,gBACnC1wD,EAAcL,KAAK0F,IAAI2kD,OAAO5jD,OAAOq/E,IAC3ChmF,EAASc,QACJZ,KAAKkmF,aAAa3D,MAAMliF,EAAa,CACtCkjF,YAAa1jF,EAAMo3E,WACnBxtB,WAAYzpD,KAAK0F,IAAI+jD,WACrB2lB,gBAIoB,IAApBtvE,EAASS,SAITP,KAAKsmF,kBACPtmF,KAAKumF,UAAU3lF,MACb,YAAOd,GAAUsI,UAAW9H,IAC1B,MAAME,EAAW,GAAGwF,UAAU1F,GAC9BN,KAAKuiF,MAAMrqE,KAAK,CAAEysE,WAAU9uE,aAIhC7V,KAAKumF,UAAYzmF,EAAS4F,IAAKpF,GACtBA,EAAO8H,UAAW5H,IACvBR,KAAKuiF,MAAMrqE,KAAK,CAAEysE,WAAU9uE,cAU5BwwE,gBACNxmF,GAEA,MAAMC,EAAkB,GAExB,GAAmB,gBAAfD,EAAMiF,KACR9E,KAAK0F,IAAIq3C,GAAG88B,sBACVh6E,EAAM2oE,MACN,CAACpoE,EAAkCC,KACjC,MAAMC,EAAQN,KAAK0F,IAAIqvE,aAAa10E,EAAQmmF,QAAQpqC,OAAOx3C,IAC3D,IAAKtE,EAAMomB,WAAW9X,QAAuC63E,kBAGzDrmF,EACF,GAAIA,EAAUqJ,IAAI,YAChB,UAAWjJ,KAAWJ,EAAUqJ,IAAI,YAAa,CAC/C,MAAM/F,EAAaiiE,GAAcnlE,EAASR,KAAK0F,IAAI+jD,YACnD/lD,EAAWmV,KAAO,CAChB5J,MAAOzO,EAAQgmF,QAAQE,IACvB9hF,GAAIvE,EAAQmmF,QAAQpqC,OAAOx3C,GAAK,IAAMpE,EAAQmmF,IAC9C1tE,KAAMzY,EAAQgmF,QAAQI,MACtBpC,YAAankF,EAAQmmF,QAAQv3E,MAC7B27B,MAAO5qC,KAAKkmF,aAAaxC,yBAAyBpjF,IAGpDR,EAAgBc,KAAK8C,WAEdtD,aAAqBymF,KAAiB,CAC/C,MAAMrmF,WjDjIlBO,EACAO,EACAzB,EACAC,EAAgB,aAEhB,IAAIM,EACAC,EACAC,EACAE,EAEAX,GACFQ,EAAQR,EAAQ4J,IAAI,SAChB5J,EAAQ4J,IAAI,mBACdnJ,EAAUT,EAAQ4J,IAAI,iBAAiB86D,iBACvC/jE,EAAiBX,EAAQ4J,IAAI,iBAAiB+6D,0BAGhDnkE,EAAQU,EAAgB0I,IAAI,UAG9B,MAAM/F,EAAW,IAAIwgE,KACftgE,EAAa7C,EAAgBgqD,gBAC7BlnD,EAAe9C,EAAgBsxD,UAErC,GAAqB,YAAjBxuD,EAA4B,CAC9B,MAAMoD,EAAOlG,EAAgB+lF,UAC7B1mF,EAAO,IAAIkjF,MACTviF,EAAgBgmF,qBAChBC,QACA//E,OAEwB,UAAjBpD,EACTzD,EAAO,IAAI2xE,KAAQhxE,EAAgBgmF,qBAAsBC,SAC/B,eAAjBnjF,IACTzD,EAAO,IAAIgjF,KACTriF,EAAgBgmF,qBAChBC,UAIJ,MAAMjjF,EAAWL,EAAS4gE,oBAAoBlkE,EAAM,CAClDyjD,eAAgB/jD,EAChBgkD,kBAAmBxiD,IAGf0C,EAAKjD,EAAgB0yD,QAAU1yD,EAAgB0yD,QAAUxqD,IACzDtE,EAAW5D,EAAgB0I,IAAI,aAC/Bq5C,EAAS+K,MAAuB9sD,EAAgB80D,YAAav0D,EAAcxB,GACjF,MAAO,CACLgF,KAAM83C,GACN6M,WAAY3pD,EACZgrC,SACAjyB,KAAM,CACJjU,KACAqK,MAAO5O,GAAgBsE,GAAsBX,EAC7C0gE,WACAH,iBAAkBjkE,EAClBkkE,wBAAyBhkE,GAE3B2mB,aACA89B,WACAlI,GAAIh8C,GiDoEYP,CACJJ,EACAJ,KAAK0F,IAAI+jD,WACTppD,GAEFG,EAAWqY,KAAO,CAChBjU,GAAIvE,EAAQmmF,QAAQpqC,OAAOx3C,GAAK,IAAMpE,EAAWqY,KAAKjU,GACtD4/E,YAAankF,EAAQmmF,QAAQv3E,MAC7B27B,MAAO5qC,KAAKkmF,aAAaxC,yBAAyBpjF,GAClD2O,MAAOjP,KAAKkmF,aAAa3B,cAAc/jF,EAAYF,IAAUE,EAAWqY,KAAK5J,OAE/EnP,EAAgBc,KAAKJ,OAChB,CACL,MAAMA,EAAamlE,GACjBvlE,EACAJ,KAAK0F,IAAI+jD,WACTppD,GAEFG,EAAWqY,KAAO,CAChBjU,GAAIvE,EAAQmmF,QAAQpqC,OAAOx3C,GAAK,IAAMpE,EAAWqY,KAAKjU,GACtD4/E,YAAankF,EAAQmmF,QAAQv3E,MAC7B27B,MAAO5qC,KAAKkmF,aAAaxC,yBAAyBpjF,GAClD2O,MAAOjP,KAAKkmF,aAAa3B,cAAc/jF,EAAYF,IAAUE,EAAWqY,KAAK5J,OAE/EnP,EAAgBc,KAAKJ,KAI3B,CACEioE,aAAczoE,KAAKinF,2BAA6B,EAChDve,YAAa1oE,KAAKknF,uBACdlnF,KAAKknF,uBACLC,aAGgB,WAAftnF,EAAMiF,KAAmB,CAElC,MAAMzE,EADSR,EAAMunB,OACK2qC,cAAc8D,YACxC71D,KAAK0F,IAAI2kD,OACN5jD,OAAOq/E,IACPr/E,OAAOnG,GAASA,aAAiB6kE,IAAe7kE,EAAMsmB,SACtDlhB,IAAIpF,IACgBA,EAAMomB,WAAWq2B,GACzBqqC,iCAAiC/mF,EAAaqD,IACvD,MAAME,EAAsB+hE,GAAcjiE,EAAW1D,KAAK0F,IAAI+jD,WAAYnpD,EAAMy8C,IAChFn5C,EAAWiV,KAAO,CAChBjU,GAAItE,EAAMsE,GAAK,IAAMlB,EAAU+vD,QAC/Bx6C,KAAMvV,EAAU8iF,QAAQI,MACxBpC,YAAalkF,EAAM2O,MACnB27B,MAAO5qC,KAAKkmF,aAAaxC,yBAAyBpjF,GAClD2O,MAAOjP,KAAKkmF,aAAa3B,cAAc3gF,EAAYtD,IAAUsD,EAAWiV,KAAK5J,OAE/EnP,EAAgBc,KAAKgD,OAM7B,SAAOoI,MAAGlM,GAMJmmF,uBACNjmF,KAAKumF,UAAUzgF,QAASjG,GAAsBA,EAAI6I,eAClD1I,KAAKumF,UAAY,GAMXte,wBACN,IAAIpoE,EACJ,MAAMC,EAAiBE,KAAK0F,IAAIq3C,GAAG6rB,kBAAkBC,WAKrD,UAAWzoE,KAAiBN,EAC1B,GAAIM,aAAyB0oE,GAAyB,CACpDjpE,EAAiCO,EACjC,WAImC,IAAnCP,IACFA,EAAiC,IAAIipE,GAAwB,CAC3DrsC,UAAW6rC,KAEbtoE,KAAK0F,IAAIq3C,GAAGgsB,eAAelpE,GAC3BG,KAAKgpE,wBAA0BnpE,GAGjCG,KAAKipE,8BAAgCppE,EAA+BiJ,GAClE,SACC1I,GAAuCJ,KAAKw5E,WAAWp5E,IAOpDynE,gCACqC,IAAvC7nE,KAAKipE,gCACP,QAAQjpE,KAAKipE,oCAEsB,IAAjCjpE,KAAKgpE,yBACPhpE,KAAK0F,IAAIq3C,GAAGosB,kBAAkBnpE,KAAKgpE,yBAErChpE,KAAKgpE,6BAA0B,gDA9RtBjoE,GAAcrB,gDAAdqB,EAAcugB,4OAAdvgB,MC5BAsmF,iBA8IXt/E,YAAYlI,EAAsCC,GAEhD,GAFgDE,sBAChDA,KAAK4O,QAAU/O,EACXG,KAAKswE,eAAgB,CACvB,MAAMlwE,EAAiBJ,KAAKswE,eAAe7mE,IACzCzJ,KAAKyzD,QAAU,YAEbrzD,IACFJ,KAAK4O,QAAUrI,YAAsBvG,KAAK4O,QAASxO,IAIvDJ,KAAK4O,QAAUrI,YAAsBvG,KAAKsnF,oBAAqBtnF,KAAK4O,SAIpE5O,KAAKunF,SAASzhF,QAAQ1F,IACpBJ,KAAKwnF,oBAAoBpnF,GAAS,KAvItCqzD,QACE,MAAM,IAAIhnD,MAAM,6CAMlB4lD,UACE,MAAM,IAAI5lD,MAAM,+CAOR66E,oBACR,MAAM,IAAI76E,MAAM,qEAOhB,OAAOzM,KAAK4O,QAAQK,sBAOpB,OAAkC,IAA3BjP,KAAK4O,QAAQ64E,UAAcrpD,YAMxBv+B,GACVG,KAAK4O,QAAQwvB,QAAUv+B,gBAGvB,OAAOG,KAAKynF,YAAsC,IAAzBznF,KAAK4O,QAAQwvB,QAAY+N,2BAKlD,OAD6BnsC,KAAK4O,QAAQu9B,uBACW,uBAIrD,MAAMtsC,EAAiBG,KAAK4O,QAAQ84E,eACpC,YAA0B,IAAnB7nF,GAAsCA,kBAO7C,OAAOG,KAAK4O,QAAQk9B,uBAOpB,YAA+B,IAAxB9rC,KAAK4O,QAAQo9B,OAAuB,GAAKhsC,KAAK4O,QAAQo9B,sBAO7D,YAAiC,IAA1BhsC,KAAK4O,QAAQ24E,SAAyB,GAAKvnF,KAAK4O,QAAQ24E,SAMjEC,oBAAoB3nF,EAA+BC,GAAgB,GACjE,OAAQD,EAAQiF,UACT,cACHjF,EAAQ8b,OAAO7V,QAAQzF,IACjBA,EAAK+9B,UACPp+B,KAAK4O,QAAQo9B,OAASpmC,OAAOU,OAAOtG,KAAK4O,QAAQo9B,QAAU,GAAI,EAC5DnsC,EAAQqR,MAAO7Q,EAAKyB,WAI3B,UACG,WACH,IAAI1B,EAAY,GAChBP,EAAQ8b,OACLlV,OAAOpG,IAAqB,IAAhBA,EAAEonF,WACd3hF,QAAQzF,IACHA,EAAK+9B,UACPh+B,GAAaC,EAAKyB,MAAQ,OAGhC1B,EAAYA,EAAUgD,MAAM,GAAG,GAC/BpD,KAAK4O,QAAQo9B,OAASpmC,OAAOU,OAAOtG,KAAK4O,QAAQo9B,QAAU,GAAI,EAC5DnsC,EAAQqR,MAAO9Q,IAKlBN,GAAiBE,KAAKswE,gBACxBtwE,KAAKswE,eAAe76D,IAClBzV,KAAKyzD,QAAU,WACf,CAACznB,OAAQhsC,KAAK4O,QAAQo9B,4BAS1B,YAA8B,IAAvBhsC,KAAK4O,QAAQm9B,MAAsB,GAAK/rC,KAAK4O,QAAQm9B,MA2B9D47C,iBAAiB9nF,EAAcC,GAC7B,MAAMM,EAAWP,EAAKwO,MAAM,kBAC5B,IAAKjO,EACH,OAGF,MAAMC,EAAsBL,KAAK4nF,kBAAkB9nF,GAC7CQ,EAAgB,GACtB,SAASwF,QAAQtF,IACfH,EAAoBsb,OAAO7V,QAAQpC,IACjC,MAAME,EAAapD,EAAQoH,UAAU,GACrC,GAA0B,iBAAflE,EAAK5B,MAAoB,CAClC,MAAM+B,EAAQH,EAAK5B,MAChBiF,cACA4hB,UAAU,OACVxiB,QAAQ,mBAAoB,IAC5BxC,MAAM,KACHI,EAAQF,EAAM3D,QAClB0D,EACGmD,cACA4hB,UAAU,OACVxiB,QAAQ,mBAAoB,MAEnB,IAAVpC,GACFzD,EAAcM,KAAKiD,EAAME,IAGzBL,EAAKmkF,WAAgE,IAApDnkF,EAAKmkF,SAAS3nF,QAAQ0D,EAAWmD,gBACpDzG,EAAcM,KAAK8C,EAAK5B,WAKvBxB,EAAcmG,OAAO,CAACjG,EAAGkD,IAAMpD,EAAcJ,QAAQM,KAAOkD,GAGrEkkF,kBAAkB/nF,GAChB,OAAOG,KAAKsnF,oBAAoBC,SAAS1sE,KACtC/a,GACQA,EAAMoR,OAASrR,IAxMrB,YAAK,GAMLkB,OAAO,GAXHA,MCLA+mF,yBAA0BT,GAIrCt/E,YAA+BlI,GAC7BggB,MAAMhgB,GAGR4zD,QACE,OAAO1yD,EAAkB6D,GAG3BytD,UACE,OAAOtxD,EAAkB+D,KAGjBwiF,oBACR,MAAO,CACLr4E,MAAO,UAjBJ,YAAK,MACLlO,OAAO67C,yCAFH77C,GAAiBrB,MAIR,uCAJTqB,EAAiBsI,QAAjBtI,EAAiB,YAAjBA,eCVWgnF,8BACQzmF,EAAKzB,GACjC,MAAO,iCAAmCA,EAAM,IAAMyB,iCAGzBA,EAAKzB,GAClC,MAAO,+CAAiDA,EAAM,IAAMyB,+BAGzCA,GAE3B,MAAO,iCADa0mF,UAAU1mF,iBCQ9B+8C,UACAyrB,cAAc,CAAC,EAAG,IAAK,KACvBme,gBAAgB,EAChBle,qBAAqB,CAAC,EAAG,IAAK,KAC9B6B,YACAsc,cAAc,IACdrc,cAAc,CAAC,EAAG,IAAK,KACvBsc,gBAAgB,GAChBxc,cAAc,IAGhB,iBAoBEttB,UACAyrB,cAAc,CAAC,EAAG,IAAK,KACvBme,gBAAgB,GAChBle,qBACA6B,YAAY,CAAC,EAAG,IAAK,KACrBsc,cAAc,IACdrc,cAAc,CAAC,EAAG,IAAK,KACvBsc,gBAAgB,GAChBxc,cAAc,IAGhB,MAAM/nE,EAAc7C,aAAmBkxE,KACvC,IAAIpuE,EACAE,EACAH,EAEFC,GADA9C,EAAUA,GACSgxD,eAGnBluD,GADA9C,EAAUA,GACSkkD,SACnBlhD,EAAOhD,EAAQ8X,KAAK6rD,UAEtB,MAAM1gE,EAAeJ,EAAcC,EAASwuD,UAAYxuD,EAASiB,KAEjE,GAAKjB,GAA6B,UAAjBG,EAeV,CACL,MAAMW,GAAkButD,SAAa9xD,GAAWgD,MAAM,GAChD0/C,GAAoBoP,SAAa5xD,GAAa8C,MAAM,GAE1D,OAAiC,IAA3BuB,EAAgBpE,SACI,iBAAdH,GAA0B,kBAAkB8kB,KAAK9kB,MAC3DuE,EAAgB,GAAKtE,GAGY,IAA7ByiD,EAAkBviD,SACI,iBAAhBD,GAA4B,kBAAkB4kB,KAAK5kB,MAC7DwiD,EAAkB,GAAKtiD,GAGlBkrE,GAA0B,CAC/Bp8D,OACAq8D,cACAE,YAAa/oB,EACb8oB,UAAWjnE,IAjC4B,CACzC,MAAMA,KAAqButD,OAAa5wD,GAAa8B,MAAM,GACrD0/C,EAAiBn+C,EAAmBvB,MAAM,EAAG,GAEnD,OAAkC,IAA9BuB,EAAmBpE,SACK,iBAAhBe,GAA4B,kBAAkB4jB,KAAK5jB,MAC7DzB,EAAgB8E,EAAmB,IAG9B0lE,GAAyB,CAC9B/6D,OACAm7C,QAAS5qD,EACTkqE,qBACAD,YAAahnB,KAzDjB,CAA4B,CAC1BzE,UACAyrB,cACAme,gBACAle,qBACA6B,YACAsc,cACArc,cACAsc,gBACAxc,yBCtCiByc,4BACS9mF,EAAKzB,EAAKC,EAAe,IAEnD,MAAO,uCAAuCD,UAAYyB,SAAWxB,KAAQD,KAAOyB,gCAG1DA,EAAKzB,EAAKC,EAAe,IACnD,MAAO,kCAAkCD,KAAOyB,KAAOxB,UCwB9CuoF,iBACXtgF,YACUlI,EACAC,EACAM,EACAC,EACAC,GAJAN,YACAA,cACAA,uBACAA,sBACAA,2BAGVsoF,eACE,MAAMzoF,EAAgBG,KAAK2K,OAAOD,UAAU,YAAc,GACpD5K,EAAgBE,KAAK2K,OAAOD,UAAU,YAAc,GACpDtK,EAASN,EAAc+Q,KAAOhR,EAAcgR,IAC5CxQ,EAAqBP,EAAcwrC,SAAW,GAE9ChrC,EAAe,GAErB,GAAIF,EAAQ,CAEV,GAAIN,EAAcg9E,WAAY,CAE5B,MAAMl5E,EAAQ5D,KADS+P,gBAAgB/B,UACfgC,QAAQ,8BAShC1P,EAAaM,QAAKoL,MARQ,CACxB,CACEpH,GAAI,qBACJqK,QACA4B,IAAK,GAAGzQ,eACR0E,KAAM,iBAOZ,MAAMtE,EAAmBR,KAAKkM,KAC3BzC,IAAe,GAAGrJ,cAClBmI,MACC,OAAK7E,GACHA,EAASgC,IAAK9B,GAAWgC,OAAOU,OAAO1C,EAAGA,EAAEgL,YAE9C,OAAYlL,GAAiC6kF,OAEjDjoF,EAAaM,KAAKJ,GAIpB,OAAIH,EAAmBE,OAAS,GAC9BD,EAAaM,MACX,QAAGP,GAAoBkI,MACrB,OAAK/H,GACHA,EAASkF,IAAKhC,IACPA,EAAEkB,KACLlB,EAAEkB,GAAKqE,KAEFvF,QAOV,YAAOpD,GAAciI,QAC1BsmD,KAAKruD,GAA0B,GAAGwF,OAAOwiF,MAAM,GAAIhoF,KAIvDioF,iBAAiB5oF,GACf,IAAIC,EACJ,SAAa4oF,GAAe3G,sBAAsBliF,EAASG,MACpDF,EAAWyhF,sBAGpBI,0BAA0B9hF,GACxB,OAAOG,KAAK2oF,4BAA4B9oF,GAAS0I,MAC/C,OAAKzI,IACH,MAAMM,EAAQN,EAAc4F,IAAKrF,KAE7BuE,GAAIy6C,GAA4Bh/C,EAAak9C,eAC7CtuC,MAAO5O,EAAa4O,MACpBnK,KAAMq8E,GAAgBniB,MACtB4pB,iBAAkB/oF,EAAQ+oF,iBAC1Bh6E,QAASvO,KAGb,MAAO,CACL,CACEuE,GAAI,2BACJE,KAAMq8E,GAAgB0H,MACtBD,iBAAkB/oF,EAAQ+oF,iBAC1B35E,MAAOpP,EAAQoP,MACfunD,aAOFmyB,4BACN9oF,GAEA,OAAOG,KAAKkM,KAAKzC,IAAoB5J,EAAQgR,KAG/C2wE,yBAAyB3hF,GACvB,OAAOG,KAAK8oF,uBAAuBjpF,GAAS0I,MAC1C,OAAKzI,IACH,MAAMM,EAAQ,GACd,IAAKN,EACH,OAAOM,EAELN,EAAaipF,SAAWjpF,EAAaipF,QAAQ7pB,UAAYp/D,EAAaipF,QAAQ7pB,SAAS3+D,SACzFV,EAAQy8C,SAAWx8C,EAAaipF,QAAQ7pB,UAE1C,MAAM7+D,EAAc,GACpBL,KAAKgpF,uBAAuBlpF,EAAai/D,WAAWC,MAAO,EAAG3+D,EAAaR,EAAQopF,gBACnF,MAAM3oF,EAA8BsF,OAAOU,OAAO,GAAIxG,EAAai/D,WAAWC,OAC9E,SAA4BA,MAAQ3+D,EAAYoG,OAAOjG,GAAwB,IAAnBA,EAAEw+D,MAAMz+D,QACpEP,KAAKkpF,sBACHrpF,EACAS,EACAF,GAEKA,KAKb4oF,uBAAuBnpF,EAAQC,EAAQ,EAAGM,EAAaC,EAAY,OACjE,IAAKD,EAAYqT,SAAS5T,EAAOqgE,OAAQ,CACrC,MAAM5/D,EAAiBsF,OAAOU,OAAO,GAAIzG,GACzCS,EAAe0+D,MAAQ,GACvB5+D,EAAYQ,KAAKN,GAErB,UAAWA,KAAST,EAAOm/D,MAAO,CAC9B,MAAMx+D,EAAgBoF,OAAOU,OAAO,GAAIhG,GACpCR,EAAQ,IACVU,EAAc0/D,MAAQrgE,EAAOqgE,MAAQ7/D,EAAYC,EAAM4/D,OAEzD5/D,EAAU0+D,MACNh/D,KAAKgpF,uBAAuBxoF,EAAeV,EAAQ,EAAGM,EAAaC,GAEnED,EAAYya,KAAKnX,GAAMA,EAAGw8D,QAAUrgE,EAAOqgE,OAAOlB,MAAMp+D,KAAKN,IAKvEmhF,0BAA0B5hF,GACxB,OAAOG,KAAK8oF,uBAAuBjpF,GAAS0I,MAC1C,OAAKzI,GAAsBE,KAAKmpF,aAAatpF,EAASC,KAI1D8hF,2BAA2B/hF,GACzB,OAAOG,KAAK8oF,uBAAuBjpF,GAAS0I,MAC1C,OAAKzI,GACIE,KAAKopF,mBAAmBvpF,EAASC,KAK9CgiF,+BAA+BjiF,GAC7B,MAAMC,EAAoBD,EAA6BgiF,UAEjDzhF,EAAuB,GAC7BN,EAAiB4F,IAAK1B,IACpBA,EAAUqlF,cAAgBxpF,EAAQwpF,cAClCjpF,EAAqBQ,KACnB8nF,GAAe3G,sBAAsB/9E,EAAWhE,SAMpD,MAAMK,EAAY,GAClBD,EAAqBsF,IAAK1B,GACxB3D,EAAUO,KAAKoD,EAAUu9E,wBAI3B,IAAIjhF,EAAY,GAEhB,WAAuB0D,GACrB,OAAOA,EAAIgD,OACT,CAACrC,EAAKm+C,IACJn+C,EAAIqB,OACF88C,EAAIh+C,OAASq8E,GAAgB0H,MAAQroF,EAAcsiD,EAAI0T,OAAS1T,GAEpE,IAIJ,GACEl9C,OAAOC,KAAK/F,GAAkB+a,KAAM7W,GAAMlE,EAAiBkE,GAAGslF,aAC9D,CACA,MAAMtlF,EAAkB,CAACW,EAAMm+C,KAC7B,MAAM77C,EAAI7G,EAAqB0iD,GACzBE,EAAiBp9C,OAAOU,OAAO,GAAIW,EAAEqiF,aAC3CtmC,EAAeumC,QAAUtiF,EAAErC,GAC3Bo+C,EAAel+C,KAAOq8E,GAAgB0H,MACtC7lC,EAAe4lC,iBAAmB3hF,EAAE2hF,sBACC,IAAjC5lC,EAAeqmC,gBACjBrmC,EAAeqmC,cAAgBpiF,EAAEoiF,eAEnCrmC,EAAewT,MAAQ,GAEvB,MAAMvT,EAAYziD,EAAcmE,GAChC,SAAUe,IACP29C,GAAOA,EAAEkmC,QAAU,GAAGvmC,EAAeumC,WAAWvmC,EAAep+C,MAElEo+C,EAAewT,MAAQvT,EAEhBD,GAGT1iD,EAAYD,EAAUqF,IAAI,CAACf,EAAKm+C,IAC9Bn+C,EAAI4D,QACFsmD,KAAK5nD,GACHnH,EAAiBgjD,GAAKwmC,YAClBtlF,EAAgBiD,EAAO67C,GACvB77C,UAKV3G,EAAYD,EAId,MAAMqD,KAAY8lF,UAAOlpF,GAAWiI,MAClC,OACGvE,GAA0B,GAAGgC,UAAUhC,KAuBtCH,EAA+B,CAACG,EAAOW,IAC3CX,EAAMgD,OAAO,CAAC87C,EAAK77C,EAAM+7C,EAAKC,KAC5B,MAAMI,EAAa1+C,EAAMsC,GACnBu8C,EAAU59C,OAAOU,OAAO,GAAIW,GAElC,GAAIA,EAAKnC,OAASq8E,GAAgBniB,MAAO,CAIvC,MAAMtb,EAAoB,GACpBuD,EAA6B,GAYnC,GAAIhE,EAXoBx8C,OAAO,CAAC8gD,EAAGC,KACjC,IAAIL,GAAO,EACX,OAAII,EAAEt4C,QAAUo0C,GAAckE,EAAEziD,OAASq8E,GAAgBniB,QACnDxX,IAAMxE,GAAOuE,EAAEgiC,UAAYtiF,EAAKsiF,UAClCpiC,GAAO,GAETzD,EAAkB9iD,KAAK4mD,IAElBL,IAGO5mD,OAAS,EAAG,CAC1B,IAAIgnD,EAAY7D,EAAkBh/C,UAAW8iD,GAAMA,IAAMxE,GAAO,EAChEQ,EAAQv0C,MAAQ,GAAGhI,EAAKgI,UAAUs4C,KAClCA,EAAYN,EAA2BviD,UAAW8iD,GAAMA,IAAMxE,GAAO,EACrEQ,EAAQimC,eAAiB,GAAGxiF,EAAKwiF,mBAAmBliC,KAMjDzE,EAHajoC,KACf0sC,GAAMA,EAAEt4C,QAAUu0C,EAAQv0C,OAASs4C,EAAEziD,OAASq8E,GAAgBniB,SAG/Dlc,EAAIA,EAAIviD,QAAUijD,QAEXv8C,EAAKnC,OAASq8E,GAAgB0H,QACvCrlC,EAAQgT,MAAQ3yD,EACdoD,EAAKuvD,MACJ9S,GAAUA,EAAMz0C,OAEnB6zC,EAAIA,EAAIviD,QAAUijD,GAGpB,OAAOV,GACN,IAQL,OANkBp/C,EAAU6E,QAC1BsmD,KAAK7qD,GAjEgB,EAACA,EAAMW,IAC5BX,EAAKgD,OAAO,CAAC87C,EAAK77C,KAChB,MAAM+7C,EA+DgC,IAAUr+C,EAAMC,GAAhB,CA/DhBqC,GAChBg8C,EAAMH,EAAIjoC,KAAMwoC,GAAMA,EAAEz+C,KAAOo+C,GAErC,GAAKC,EAEE,CACL,MAAMI,EAAKP,EAAI5iD,QAAQ+iD,IACmC,IAAtDH,EAAIO,GAAIkmC,QAAQ5lF,MAAM,KAAKzD,QAAQ+G,EAAMsiF,WAC3CzmC,EAAIO,GAAIkmC,QAAU,GAAGzmC,EAAIO,GAAIkmC,WAAWtiF,EAAMsiF,WAEhDzmC,EAAIO,GAAImT,MAAM51D,QAAQqG,EAAMuvD,YAN5B1T,EAAIA,EAAIviD,QAAU0G,EAQpB,OAAO67C,GACN,IAfkB,CAiEU9+C,OAC/B6qD,KAAK7qD,GAAW,GAAGgC,UAAUhC,OAC7B6qD,KAAK7qD,GAASH,EAA6BG,EAAOW,GAAUA,EAAMsK,SAM9D65E,uBAAuBjpF,GAE7B,OAAOG,KAAKsjE,oBACT3F,gBAFmByjB,GAAYvhF,EAAQiF,MAETjF,EAAQgR,IAAKhR,EAAQyL,SACnD/C,MACC,OAAYnI,IACV,MAAMC,EAAQL,KAAK+P,gBAAgB/B,UAAUgC,QAC3C,oCAEI1P,EACNT,EAAQoP,MAAQjP,KAAK+P,gBAAgB/B,UAAUgC,QAC7C,8BACA,CAAElO,MAAOjC,EAAQoP,QACfjP,KAAK+P,gBAAgB/B,UAAUgC,QACjC,mCAGF,YAAKe,eAAe1F,MAAM/K,EAASD,GACnC6K,QAAQG,MAAMjL,MACP4L,WAAG,MAKV09E,wBACN7pF,EACAC,GAEA,IAAKA,GAAgD,IAA5BA,EAAiBS,OACxC,OAEF,MAAMH,EAAiC,CACrCwgE,UAAW/gE,EACXoP,WAAO,EACP06E,iBAAa,EACbC,sBAAkB,EAClBC,yBAAqB,EACrBC,oBAAgB,GAIZzpF,EAA+BP,EAAiB+a,KAAKva,GAAqB,MAAhBA,EAAEsgE,WAClE,OAAIvgE,IAEEA,EAA6BwpF,sBAC/BzpF,EAAeypF,oBAAsBxpF,EAA6BwpF,qBAGhExpF,EAA6BypF,iBAC/B1pF,EAAe0pF,eAAiBzpF,EAA6BypF,iBAGjEhqF,EAAiB4F,IAAIpF,IAEfT,IAAyBS,EAAesgE,YAEtCtgE,EAAe2O,QACjB7O,EAAe6O,MAAQ3O,EAAe2O,OAGpC3O,EAAeqpF,cACjBvpF,EAAeupF,YAAcrpF,EAAeqpF,aAG1CrpF,EAAespF,mBACjBxpF,EAAewpF,iBAAmBtpF,EAAespF,qBAIhDxpF,EAKD2pF,wBAAwBlqF,EAAOC,EAAUM,EAAmBC,GAClE,MAAMC,EAAwBN,KAAKgqF,wBACjCnqF,EAAM2hE,KACNphE,GAGII,EACJH,EAAQ4pF,YAAcpqF,EAAMy/D,MACxBt/D,KAAKsjE,oBAAoB/D,SAAS1/D,EAAMy/D,YACxC,EAEA57D,EAASkC,OAAOU,OAAO,GAAIjG,EAAQuT,YAAa,CACpD0pC,OAAQz9C,EAAM2hE,KACd7X,QAAStpD,EAAQiL,UAGb1H,EAAoB,CACxBkB,KAAM,MACN+L,IAAKxQ,EAAQwQ,IACbylD,YAAaj2D,EAAQ6pF,wBAA0B,iBAAc,EAC7D3+C,YAAajrC,EACbkrC,gBACElrC,IAA0B0lD,GAAY6Z,MACtCv/D,IAA0B0lD,GAAY28B,SAClC,cACA,EACNtf,yBAAyB,GAGrBx/D,EAAgB+B,OAAOU,OAC3B,GACA1C,EACAvD,EAAQk9C,cACR,CAAEvR,WAGEjoC,EAAoB/D,KAAK0pF,wBAAwB7pF,EAAM2hE,KAAMnhE,EAAQ8pF,kBAC3E,IAAInmF,EACAW,GAAS,EACT9E,EAAMq/D,SACRl7D,EAAenE,EAAMq/D,UACXr/D,EAAMq/D,UAAY7+D,EAAQi8C,WACpCt4C,EAAe3D,EAAQi8C,UAIzB,IAAIr1C,GAA+B,MAAjBlD,OAAiB,EAAjBA,EAAmB4lF,eAAgC,MAAjB5lF,OAAiB,EAAjBA,EAAmB+lF,mBAFtC,MAALjqF,OAAK,EAALA,EAAOo/D,WAAgB,MAALp/D,OAAK,EAALA,EAAOo/D,QAAQ1+D,QAAQ,EAAS,MAALV,OAAK,EAALA,EAAOo/D,QAAQ,GAAGqB,oBAAiB,GAGxGtd,GAAoC,MAAjBj/C,OAAiB,EAAjBA,EAAmB6lF,oBAAqC,MAAjB7lF,OAAiB,EAAjBA,EAAmB8lF,sBAAuB7lF,IAGpF,MAAjBD,OAAiB,EAAjBA,EAAmB4lF,gBACF,MAAjB5lF,OAAiB,EAAjBA,EAAmB+lF,mBACF,MAAjB/lF,OAAiB,EAAjBA,EAAmB6lF,oBACD,MAAjB7lF,OAAiB,EAAjBA,EAAmB8lF,wBAErBllF,GAAS,IAEU,MAAjBZ,OAAiB,EAAjBA,EAAmB6lF,oBAAqC,MAAjB7lF,OAAiB,EAAjBA,EAAmB+lF,kBAC5DnlF,GAAS,GAGX,MAAMs+C,EAAe,CACnBr+C,GAAIy6C,GAA4Bx7C,GAChCiB,KAAMq8E,GAAgBniB,MACtB/vD,OAAwB,MAAjBlL,OAAiB,EAAjBA,EAAmBkL,OAAQlL,EAAkBkL,MAAQpP,EAAMqgE,MAClEqpB,QAASzpF,EACT8oF,iBAAkBvoF,EAAQuoF,mBAAoB,EAC9Ch6E,QAAS,CACPqgD,cAAeC,GAAuBrvD,EAAMsgE,qBAC5CxV,cAAeuE,GAAuBrvD,EAAMugE,qBAC5CC,SAAU,CACRxvD,IAAK5J,EACLi1C,SACAI,SAAU0G,EACVl+C,KAAMlB,EAAkBkB,MAE1BuqD,gBACAtiC,QAAS,CAAEjoB,KAAMzE,EAAQqrC,aACzB6R,kBAIJ,OAAOh3C,kBAA4B08C,GAG7BmnC,wBACNvqF,EACAC,EACAM,EACAC,EACAC,GAwCA,MAtCqB,CACnBsE,GAAIxE,EACJ0E,KAAMq8E,GAAgB0H,MACtB55E,MAAOpP,EAAWqgE,MAClBqpB,QAASjpF,EAAQsE,GACjBgkF,iBAAkBtoF,EAAQsoF,mBAAoB,EAC9CS,cAAe/oF,EAAQ+oF,cACvB7yB,MAAO32D,EAAWm/D,MAAMh4D,OAAO,CAACtD,EAAsBE,KACpD,QAAoB,IAAhBA,EAAMo7D,MAAqB,CAE7B,MAEMj7D,EAA8B/D,KAAKoqF,wBACvCxmF,EACA9D,EAHAM,EAAU,UAAUwD,EAAM49D,MAAQ59D,EAAMo7D,MAAM,GAAGwC,OAKjDnhE,EACAC,GAGFoD,EAAM9C,KAAKmD,OACN,CACL,IAAmD,IAA/C/D,KAAKqqF,iBAAiBzmF,EAAM49D,KAAM1hE,GACpC,OAAO4D,EAGT,MAAMG,EAAiD7D,KAAK+pF,wBAC1DnmF,EACAxD,EACAC,EACAC,GAGFoD,EAAM9C,KAAKiD,GAEb,OAAOH,GACN,KAKCwlF,sBACNrpF,EACAC,EACAM,EACAC,EAAoB,GAGpB,MAAMC,GAAWT,EAAQ4rC,YAAc,IAAI/lC,IACxClF,GAAoB,IAAIykB,OAAOzkB,IAElC,GAAKV,EAAWk/D,MAIhB,UAAWx+D,KAAQV,EAAWk/D,MAAO,CACnC,QAAmB,IAAfx+D,EAAKw+D,MAAqB,CAE5Bh/D,KAAKkpF,sBAAsBrpF,EAASW,EAAMJ,EAAcC,EAAY,GACpE,SAGF,MAAMqD,EAAoB1D,KAAKsqF,sBAAsBzqF,GAGrD,GAAkB,IAAdQ,EAAiB,CAGnB,MACMwD,EAAY7D,KAAKoqF,wBACrBtqF,EACAQ,EAHkB,iBAAiBR,EAAW0hE,MAAQhhE,EAAKghE,OAK3D99D,EACA7D,GAG6B,IAA3BgE,EAAU2yD,MAAMj2D,QAClBH,EAAaQ,KAAKiD,GAIpB,UAGkD,IAA9C7D,KAAKqqF,iBAAiB7pF,EAAKghE,KAAMlhE,GAAoB,CACvD,MAAMsD,EAAY5D,KAAK+pF,wBACrBvpF,EACAX,EAAQ+E,GACRlB,EACA7D,GAEFO,EAAaQ,KAAKgD,KAQlBulF,aACNtpF,EACAC,GAEA,IAAKA,EACH,MAAO,GAET,MAAMM,EAASN,EAAa2gE,SAASzB,MAC/B3+D,GAAWR,EAAQ4rC,YAAc,IAAI/lC,IACxCpF,GAAoB,IAAI2kB,OAAO3kB,IAGlC,OACER,EAAayqF,uBACbzqF,EAAayqF,sBAAsBrrB,UACnCp/D,EAAayqF,sBAAsBrrB,SAAS3+D,SAC5CV,EAAQy8C,SAAWx8C,EAAayqF,sBAAsBrrB,UAGjD9+D,EACJsF,IAAKpF,IAEJ,MAAME,EAAoBR,KAAK0pF,wBAAwBppF,EAAM4/D,MAAOrgE,EAAQsqF,kBAC5E,IAAIzmF,GAAS,EAETE,GAA+B,MAAjBpD,OAAiB,EAAjBA,EAAmBmpF,eAAgC,MAAjBnpF,OAAiB,EAAjBA,EAAmBspF,gBACnEjmF,GAAoC,MAAjBrD,OAAiB,EAAjBA,EAAmBopF,oBAAqC,MAAjBppF,OAAiB,EAAjBA,EAAmBqpF,sBAAuBhqF,EAAQy8C,SAelH,KAZsB,MAAjB97C,OAAiB,EAAjBA,EAAmBmpF,gBACF,MAAjBnpF,OAAiB,EAAjBA,EAAmBspF,mBACF,MAAjBtpF,OAAiB,EAAjBA,EAAmBopF,oBACD,MAAjBppF,OAAiB,EAAjBA,EAAmBqpF,wBAErBnmF,GAAS,IAEU,MAAjBlD,OAAiB,EAAjBA,EAAmBopF,oBAAqC,MAAjBppF,OAAiB,EAAjBA,EAAmBspF,kBAC5DpmF,GAAS,IAI4C,IAArD1D,KAAKqqF,iBAAiB/pF,EAAMogE,WAAYrgE,GAC1C,OAEF,MAAM0D,EAAS6B,OAAOU,OAAO,GAAIzG,EAAQ+T,YAAa,CACpDtI,QAAS,UAELtH,EAAoB,CACxBc,KAAM,OACN+L,IAAKhR,EAAQgR,IACbylD,YAAaz2D,EAAQqqF,wBACjB,iBACA,EACJztC,MAAOn8C,EAAMogE,WACb8pB,UAAW3qF,EAAQ2qF,UACnBnnB,yBAAyB,EACzBonB,gBAAiB5qF,EAAQ4qF,iBAAmB,MAC5Cp6D,MAAO,WAEH1rB,EAAgBiB,OAAOU,OAC3B,GACAtC,EACAnE,EAAQ09C,cACR,CAAEvR,WAGJ,OAAOzlC,kBAA4B,CACjC3B,GAAIy6C,GAA4B16C,GAChCG,KAAMq8E,GAAgBniB,MACtB/vD,OAAwB,MAAjBzO,OAAiB,EAAjBA,EAAmByO,OAAQzO,EAAkByO,MAAQ3O,EAAM4/D,MAClEqpB,QAAS1pF,EAAQ+E,GACjBgkF,iBAAkB/oF,EAAQ+oF,iBAC1Bh6E,QAAS,CACP2uC,gBACA8iB,SAAU,CACRxvD,IAAKjN,EACLs4C,SACAI,SAAUz4C,EACViB,KAAMd,EAAkBc,WAK/B2B,OAAQnG,QAAgD,IAATA,GAK1C8oF,mBACNvpF,EACAC,GAEA,IAAKA,EACH,MAAO,GAET,MAAMM,EACNN,EAAcuqD,OAAcvqD,EAAauqD,OAAO5jD,OAAOjG,IAAUA,EAAMsE,MAAuB,kBAAftE,EAAMsE,MAA9D,GAClBhF,EAAauqD,QAChBrqD,KAAK+Q,eAAe1F,MAClBrL,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,mCACvChQ,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,qCAI3C,MAAM3P,GAAWR,EAAQ4rC,YAAc,IAAI/lC,IACxClF,GAAoB,IAAIykB,OAAOzkB,IAGlC,IAAIF,EAMJ,OALIR,EAAawhE,oBAAsBxhE,EAAawhE,mBAAmB/gE,SAErED,EAAWR,EAAawhE,mBAAmBn7D,QAD7B,gBAC4C,KAGrD/F,EACJsF,IAAKlF,IAEJ,MAAMkD,EAAoB1D,KAAK0pF,wBAAwBlpF,EAAM0Q,KAAMrR,EAAQsqF,kBAC3E,IAAIvmF,EACAC,GAAS,EACTrD,EAAM0+D,SACRt7D,EAAepD,EAAM0+D,UACX1+D,EAAM0+D,UAAYr/D,EAAQy8C,WACpC14C,EAAe/D,EAAQy8C,UAGzB,IAAIv4C,GAA+B,MAAjBL,OAAiB,EAAjBA,EAAmBimF,eAAgC,MAAjBjmF,OAAiB,EAAjBA,EAAmBomF,gBACnE9lF,GAAoC,MAAjBN,OAAiB,EAAjBA,EAAmBkmF,oBAAqC,MAAjBlmF,OAAiB,EAAjBA,EAAmBmmF,sBAAuBjmF,EAcxG,KAXoB,MAAjBF,OAAiB,EAAjBA,EAAmBimF,gBACF,MAAjBjmF,OAAiB,EAAjBA,EAAmBomF,mBACF,MAAjBpmF,OAAiB,EAAjBA,EAAmBkmF,oBACD,MAAjBlmF,OAAiB,EAAjBA,EAAmBmmF,wBAErBhmF,GAAS,IAEU,MAAjBH,OAAiB,EAAjBA,EAAmBkmF,oBAAqC,MAAjBlmF,OAAiB,EAAjBA,EAAmBomF,kBAC5DjmF,GAAS,IAGsC,IAA7C7D,KAAKqqF,iBAAiB7pF,EAAMoE,GAAIvE,GAClC,OAEF,MAAMsE,EAAoB,CACxBG,KAAMs8E,GAAYvhF,EAAQiF,MAC1B+L,IAAKhR,EAAQgR,IACbylD,YAAaz2D,EAAQqqF,wBACjB,iBACA,EACJztC,MAAOj8C,EAAMoE,GACbw6D,WAAW,EACX7zB,YAAa,WACbi/C,UAAW3qF,EAAQ2qF,UACnBnnB,yBAAyB,EACzBhzC,MAAO,WAEHyyB,EAAgBl9C,OAAOU,OAC3B,GACA3B,EACA9E,EAAQ09C,eAEV,OAAOh3C,kBAA4B,CACjC3B,GAAIy6C,GAA4ByD,GAChCh+C,KAAMq8E,GAAgBniB,MACtB/vD,OAAwB,MAAjBvL,OAAiB,EAAjBA,EAAmBuL,OAAQvL,EAAkBuL,MAAQzO,EAAM0Q,KAClE03E,iBAAkB/oF,EAAQ+oF,iBAC1BW,QAAS1pF,EAAQ+E,GACjBgK,QAAS,CACP2uC,gBACAoN,cAAeuE,GAAuB1uD,EAAM07D,UAC5CjN,cAAeC,GAAuB1uD,EAAM27D,UAC5CkE,SAAU,CACRxvD,IAAK9M,EACLm4C,SACAI,SAAUt4C,EACVc,KAAMH,EAAkBG,WAK/B2B,OAAQjG,QAAgD,IAATA,GAG5C6pF,iBAAiBxqF,EAAmBC,GAC1C,OAAuB,IAAnBA,EAAQS,aAGsD,IAA3DT,EAAQ+a,KAAMza,GAAkBA,EAAM8kB,KAAKrlB,IAG5CmqF,wBACNnqF,EACAC,GAEA,MAAMM,EAAyBN,EAAkB+a,KAC9Cra,GAAMA,EAAEi8C,QAAU58C,GAEfQ,EAAiBP,EAAkB+a,KAAMra,GAAkB,MAAZA,EAAEi8C,OACvD,IAAIn8C,EACJ,OAAIF,EACFE,EAAcF,EAAuBmrC,YAC5BlrC,IACTC,EAAcD,EAAekrC,aAExBjrC,EAGDgqF,sBACNzqF,GAEA,MAAMC,EAAmE,GACzE,OAAKD,EAAQ0rC,aAGb3lC,OAAOC,KAAKhG,EAAQ0rC,aAAazlC,QAAS1F,IACpCP,EAAQ0rC,YAAYnrC,aAAiC+D,MACvDtE,EAAQ0rC,YAAYnrC,GAAsB0F,QAASzF,IAE9CP,EAAkB+a,KAAMva,GAAaA,EAASm8C,QAAUp8C,IAEzDP,EAAkBc,KAAK,CACrB67C,MAAOp8C,EACPkrC,YAAanrC,MAMhBN,EAAkB+a,KAChBxa,GACCA,EAASo8C,QAAU58C,EAAQ0rC,YAAYnrC,KAG3CN,EAAkBc,KAAK,CACrB67C,MAAO58C,EAAQ0rC,YAAYnrC,GAC3BmrC,YAAanrC,MAKdN,gDA/yBEiB,GAAcrB,+EAAdqB,EAAcsI,QAAdtI,EAAc,qBAFb,SAEDA,+CC7BTrB,SACEA,uCAQEA,iFAA0C,iGAE5CA,QACFA,oDAVIA,oCAAmB,UAAnBA,CAAmB,sBAAnBA,CAAmB,sCAAnBA,CAAmB,0CAAnBA,CAAmB,8BAAnBA,CAAmB,oFAYvBA,SACEA,uCAMEA,kGACFA,QACFA,oDANIA,0BAAc,sCAAdA,CAAc,0CAAdA,CAAc,+DAjBlBA,iCAcAA,qEAdeA,2BAcAA,yCCiBNgrF,iBAgCX3iF,YACUlI,EACAC,GADAE,oBACAA,aAxBDA,yBAAqB,EAoBrBA,2BAAgC,oBAtBI,OAAOA,KAAK0F,IAAI2lD,eAAeyF,YAgC5EtwC,WACE,MAAM3gB,EAAeG,KAAK0F,IAAI2kD,OAAO3kD,IAAKtF,KAEtCwE,GAAIxE,EAAMwO,QAAQ0N,OAAO1X,GACzBqK,MAAO7O,EAAM6O,MACbnK,KAAMq8E,GAAgBniB,SAG1Bh/D,KAAKoR,MAAM0G,MAAM6B,WAAW9Z,EAAc,CAAE0E,OAAO,IAAQ,GACvDvE,KAAKqrC,cAA0C,IAA/BrrC,KAAKqrC,QAAQg+C,eAC/BrpF,KAAKoR,MAAM6L,KAAKhC,KAAK,CACnB2B,UAAW5c,KAAKqrC,QAAQg+C,cACxB1sE,cAAgBvc,GAAsBA,EAAK6O,QAK/CjP,KAAK2qF,qBADqB3qF,KAAKqrC,SAAUrrC,KAAKqrC,QAAQ4+C,YACYjqF,KAAK2qF,mBAEvE3qF,KAAKygB,QAAU,IAAIC,GAAmB1gB,KAAKoR,MAAOpR,KAAKkf,OAIzD/G,cACEnY,KAAKygB,QAAQvF,UAMf0vE,QAAQ/qF,GACN,OAAOA,EAAKiF,OAASq8E,GAAgB0H,MAMvCgC,QAAQhrF,GACN,OAAOA,EAAKiF,OAASq8E,GAAgBniB,MAQvC8rB,mBAAmBjrF,GACjB,MAAMC,EAAQD,EAAM48C,MACpBz8C,KAAKoR,MAAM0G,MAAM4B,OAAO5Z,EAAO,CAAEyE,MAAO1E,EAAM0E,QAAS,GACvD1E,EAAM0E,MAAQvE,KAAK+qF,cAAcjrF,GAASE,KAAKgrF,mBAAmBlrF,GAQpEmrF,mBAAmBprF,GACjB,MAAMC,EAAQD,EAAM+3B,MACpB53B,KAAKoR,MAAM0G,MAAM4B,OAAO5Z,EAAO,CAAEyE,MAAO1E,EAAM0E,QAAS,GACvD1E,EAAM0E,MAAQvE,KAAKkrF,cAAcprF,GAASE,KAAKmrF,mBAAmBrrF,GAO5DirF,cAAclrF,GACpBG,KAAKorF,eAAe,CAACvrF,IAOfmrF,mBAAmBnrF,GACzBG,KAAKqrF,oBAAoB,CAACxrF,IAOpBurF,eAAevrF,GACrB,MAAMC,EAAUD,EAAO6F,IAAKtF,IACrBA,EAAMwO,QAAQ2uC,cAAcimB,iBAC/BpjE,EAAMwO,QAAQ2uC,cAAcimB,gBAAiB,GAExCxjE,KAAK6gF,aAAatB,iBAAiBn/E,EAAMwO,YAGlD,YAAO9O,GAASsI,UAAWhI,IACzBJ,KAAKoR,MAAM0G,MAAM6B,WAAW9Z,EAAQ,CAAE0E,OAAO,IAC7CvE,KAAK0F,IAAIyvE,UAAU/0E,KAQfirF,oBAAoBxrF,GAC1BA,EAAOiG,QAAShG,IAEd,GADAE,KAAKoR,MAAM0G,MAAM4B,OAAO5Z,EAAO,CAAEyE,OAAO,KACR,IAA5BzE,EAAM8O,QAAQogD,UAAoB,CACpC,MAAM5uD,EAASJ,KAAK0F,IAAIqvE,aAAaj1E,EAAM8O,QAAQhK,SACpC,IAAXxE,GACFJ,KAAK0F,IAAIikE,YAAYvpE,OAElB,CACL,MAAMA,EAASJ,KAAK0F,IAAIqvE,aAAaj1E,EAAM8E,SAC5B,IAAXxE,GACFJ,KAAK0F,IAAIikE,YAAYvpE,MAUrBkrF,wBAAwBzrF,EAAsBC,GACpD,MAAMM,EAAaP,EAAMob,KAAK,CAAC5a,EAAGC,KAChC,MAAME,EAASH,EAAE4O,MAAM0Z,UAAU,OAAOxiB,QAAQ,mBAAoB,IAC9DzC,EAASpD,EAAE2O,MAAM0Z,UAAU,OAAOxiB,QAAQ,mBAAoB,IAEpE,OAAI3F,EAASkD,GACJ,EAELlD,EAASkD,EACJ,EAEF,IAET,OAAQ5D,OACD,MACH,OAAOM,MACJ,OACH,OAAOA,EAAWyZ,kBAElB,OAAOha,GAQLqrF,cAAcrrF,GACpB,IAAIC,EAASD,EAAM22D,MAAM/vD,OAAQrG,IAC/B,MAAMC,EAAQL,KAAKoR,MAAM0G,MAAMrO,IAAIrJ,GAAMmE,QAAS,EAClD,OAAOvE,KAAK6qF,QAAQzqF,KAAmB,IAAVC,SAEH,IAAxBR,EAAMwpF,gBACRvpF,EAASE,KAAKsrF,wBAAwBxrF,EAAQD,EAAMwpF,gBAEtDrpF,KAAKorF,eAAetrF,EAAO+Z,WAOrBsxE,mBAAmBtrF,GACzB,MAAMC,EAASD,EAAM22D,MAAM/vD,OAAQrG,IACjC,MAAMC,EAAQL,KAAKoR,MAAM0G,MAAMrO,IAAIrJ,GAAMmE,QAAS,EAClD,OAAOvE,KAAK6qF,QAAQzqF,KAAmB,IAAVC,IAE/BL,KAAKqrF,oBAAoBvrF,iDAjNhBiB,GAAuBrB,iDAAvBqB,EAAuBugB,qfDjCpC5hB,sBACEA,iDA0BFA,eA3BUA,uBAAoB,gBACAA,+FCgCjBqB,2EC7BLrB,yBACEA,sBAOEA,uGAEFA,QACAA,gBAAYA,0BAAmCA,QACjDA,wEANIA,2BAAiB,yBAKPA,mFAQJA,yBAA8DA,SAAeA,kCAApCA,sBAAqBA,kEALtEA,eACIA,0BACEA,wBACgEA,4EAA0B,6FAExFA,gCACFA,QACJA,QACFA,iCALQA,2EAA6D,0BAE/BA,2DASlCA,iBACIA,8BACJA,eADIA,kJALNA,eACEA,qBAAyCA,wHAAzCA,QAGAA,0BAGFA,sDANuBA,6BACnBA,+CACAA,iEACMA,6EAIVA,2EACEA,yBAAsB,gEAV1BA,eACEA,wBAQAA,yBAKFA,yCAbQA,6BAWHA,sGApCTA,eACEA,kCAaAA,mBACEA,wBASAA,wBAeFA,QACFA,mDAvCkBA,+BAasBA,8CAC9BA,+CASAA,+DAzBZA,gBACEA,wBAyCFA,kDAzCQA,mCAAiB,yCAF3BA,SACEA,iCA2CFA,mCA3CiCA,sEA8C/BA,iBACEA,8BACFA,eADEA,kGAjDNA,SACEA,iCA8CAA,2CAMFA,wCApDiBA,gCAAoB,mBCoBxB6rF,iBAyDXxjF,YACUlI,EACAC,EACAM,EACAC,EACAC,GAJAN,2BACAA,uBACAA,qBACAA,YACAA,aA5DDA,qCAA0C,EAKnDA,kBAA0C,IAAI+I,IAAgB,IAoBtD/I,gBAAgB,EAKhBA,eAA6B,EAS9BA,kBAA6C,GAU7CA,gBAAY,EAgBnBwgB,WACE,IAAI3gB,EAAcG,KAAKy8C,MAAM8C,OAC7Bv/C,KAAKwrF,OAASxrF,KAAKyrF,aACnB,MAAM3rF,EAAgBE,KAAKy8C,MAAM7tC,QAAQ0N,OAAO1N,QAkBhD,GAjBA9O,GAAqBA,EAAcksC,QAAUlsC,EAAcksC,OAAO0/C,OAEhE1rF,KAAK4pD,aAAe5pD,KAAKwrF,OAAO3wE,KAAKza,GAASA,EAAM8Q,OAASpR,EAAcksC,OAAO0/C,QAAQx6E,KAChFrR,EAKDG,KAAKwrF,QAAUxrF,KAAKwrF,OAAOjrF,OAAS,IAC7CP,KAAK4pD,aAAe/pD,EAAY,GAAG+pD,cAJ/B5pD,KAAKwrF,QAAUxrF,KAAKwrF,OAAOjrF,OAAS,IACtCP,KAAK4pD,aAAe5pD,KAAKwrF,OAAO,GAAGt6E,MAMrCrR,OAD8C,IAArCG,KAAKy8C,MAAM7tC,QAAQygD,gBAA8E,IAA7CrvD,KAAKy8C,MAAM7tC,QAAQygD,cAAchiC,QAChF,GAEArtB,KAAKy8C,MAAM/1B,WAAW44B,UAAUt/C,KAAK4pD,aAAc5pD,KAAKid,MAGpEjd,KAAK2rF,gCAAmC7rF,EAAuC4pD,uBAEjF1pD,KAAKqf,QADUrf,KAAKy8C,MAAM/2C,IAAI2lD,eAAemb,OACvBp+D,UAAU,IAAMpI,KAAK4rF,uCAClC/rF,GAAsC,IAAvBA,EAAYU,OAAc,CAClDP,KAAK6rF,aAAa1jF,KAAKtI,GACvB,UAAWO,KAAUP,EACnBG,KAAK8rF,iBAAiB1rF,IAQ5B+X,mBACuB,IAAjBnY,KAAKqf,SACPrf,KAAKqf,QAAQ3W,cAIjBojF,iBAAiBjsF,GACXA,EAAKgR,KAEP,IADsBiU,GAAgB9kB,KAAKkM,KAAMlM,KAAK6O,eAC5CkW,UAAUllB,EAAKgR,KAAKtI,MAC5B,OAAYnI,IACV,GAAIA,EAAIiL,MACN,SAAIA,MAAM0D,QAAS,EACnB/O,KAAKs/C,WAAY,EACjBt/C,KAAKkf,MAAMD,gBACJ7e,KAGTgI,UAAUhI,IACV,MAAMC,EAAML,KAAK6rF,aAAa/pF,MAAM4C,UAAUlE,GAAOA,EAAIyO,QAAUpP,EAAKoP,OAExEjP,KAAK6rF,aAAa/pF,MAAMzB,GAAK0rF,cADT3rF,EAEpBJ,KAAKkf,MAAMD,kBAMnB+sE,iBAAiBnsF,EAAoBC,GACnCA,EAAKkuB,UAAYnuB,EAGXosF,0BAA0BpsF,GAChC,MAAMC,EAAuBD,EACvBO,EAAcJ,KAAKy8C,MAAM8C,OAC/B,QAASl/C,EAAI,EAAGA,EAAID,EAAYG,OAAQF,IACtCP,EAAWO,GAAG2tB,UAAY5tB,EAAYC,GAAG2tB,UAE3C,OAAOluB,EAGTosF,iBAAiBrsF,GACf,MAAMC,EAAeE,KAAKy8C,MAAM/1B,WAAW9X,QAC3C,GAA0B,QAAtB9O,EAAagF,KACf,OAAO,QAAGjF,EAAYoP,OAGxB,MAAM7O,EAASN,EAAaksC,OAAOsR,OAAO35C,MAAM,KAC1CtD,EAAoB4E,KAAKC,MAAMD,KAAKE,UAAUrF,IACpD,SAAkBksC,OAAOsR,OAASl9C,EAAOya,KAAKva,GAASA,IAAUT,EAAYoP,OACtEjP,KAAKsjE,oBACT5F,cAAcr9D,GACdkI,MAAK,OAAIjI,GACDA,EAAqB2/D,wBAAwBhxD,QASlD28E,8BACN5rF,KAAKid,KAAO,CACVmyD,WAAYpvE,KAAKy8C,MAAM/2C,IAAI2lD,eAAe0F,gBAC1CjmB,OAAQ9qC,KAAKy8C,MAAM/2C,IAAI2lD,eAAewK,YACtCpM,WAAYzpD,KAAKy8C,MAAM/2C,IAAI2lD,eAAeC,kBAAkB/J,UAC5DiI,MAAOxpD,KAAKy8C,MAAM/2C,IAAI2lD,eAAesiB,WACrCp0D,KAAMvZ,KAAKy8C,MAAM/2C,IAAIq3C,GAAG2wB,WAE1B1tE,KAAKmsF,eAMCA,eACN,IAAItsF,EAAcG,KAAKy8C,MAAM/1B,WAAW44B,UAAUt/C,KAAK4pD,aAAc5pD,KAAKid,MAI1E,GAHIjd,KAAKy8C,MAAM8C,QAAUv/C,KAAKy8C,MAAM8C,OAAOh/C,OAAS,IAAKV,EAAcG,KAAKisF,0BAA0BpsF,IACtGG,KAAKy8C,MAAM8C,OAAS1/C,EAEO,IAAvBA,EAAYU,QAAmD,IAAnCP,KAAK6rF,aAAa/pF,MAAMvB,OAGxD,MAAKsrF,aAAa1jF,KAAKtI,GACvB,UAAWC,KAAUE,KAAK6rF,aAAa/pF,MACrC9B,KAAK8rF,iBAAiBhsF,IAIlB2rF,aACN,MAAM5rF,EAAeG,KAAKy8C,MAAM7tC,QAChC,GAAI/O,GAAgBA,EAAawvD,cAAe,CAG9C,IAAIhvD,EAAkB,CAAC,CAAE6Q,KAAM,GAAIjC,MAFjBjP,KAAK+P,gBAAgB/B,UACfgC,QAAQ,kCAEhC,OAAInQ,EAAawvD,cAAcqS,kBAC7BrhE,EAAkBA,EAAgB2F,OAAOnG,EAAawvD,cAAcqS,gBAAgBj7D,OAAOnG,GAC3B,YAA9DA,EAAG4Q,KAAKyX,UAAU,OAAOxiB,QAAQ,oBAAqB,KACQ,WAA9D7F,EAAG4Q,KAAKyX,UAAU,OAAOxiB,QAAQ,oBAAqB,OAE1D9F,EAAgBoG,OAAOnG,IAAOA,EAAG2O,OAAOvJ,IAAKpF,GAAOA,EAAG2O,MAAQ3O,EAAG4Q,MAClE7Q,EAAgBqF,IAAIpF,GAAKA,EAAE2O,MAAQ3O,EAAE2O,MAAM9O,OAAO,GAAG0G,cAAgBvG,EAAE2O,MAAM7L,MAAM,GAAG+C,QAAQ,KAAM,MAC7F9F,GAKX+rF,gBACEpsF,KAAKmsF,eACL,IAAItsF,EAAS,GACTG,KAAKy8C,MAAM/1B,sBAAsB8kC,KACnCxrD,KAAKy8C,MAAM/1B,WAAWq2B,GAAGwO,YAAYjO,OAAO35C,MAAM,KAAK+B,IAAI5F,GACzDD,GAAUG,KAAK4pD,aAAe,KAEhC/pD,EAASA,EAAOuD,MAAM,GAAG,GACzBpD,KAAKy8C,MAAM/1B,WAAWq2B,GAAGmM,aAAa,CAAEwiC,YAI5CW,YAAYxsF,GACV,IAAIC,EAEFA,EADkC,IAAhCE,KAAKssF,gBAAgB/rF,OACbP,KAAKssF,gBAAgBC,MAAMjqE,cAE3BtiB,KAAKssF,gBAAgBzxE,KAAKza,GAAkBA,EAAekiB,cAAc1d,KAAO/E,GAAIyiB,cAEhGtiB,KAAKwsF,aAAa3sF,GAAMC,EAAQi9E,qDArOvBh8E,GAAoBrB,gFAApBqB,EAAoBugB,6zBDrBjC5hB,wDAAeA,ksBCqBFqB,4BCpBXrB,6CAMEA,uBAOEA,iCAASI,2CAEXJ,cAJEA,kGARFA,qBAGAA,8BAUFA,8BARKA,2EAkCLA,qEAEEA,2CCjBS+sF,iBAiDX1kF,YAAoBlI,uBAhDbG,cAAqC,IAAI+I,KAAgB,GACzD/I,gBAAuC,IAAI+I,KAAgB,GAI3D/I,uBAA8C,IAAI+I,KAAgB,GAClE/I,eAAY,IAAI+I,SAAuB,GAEtC/I,qBAA0B,EAIzBA,yBAAqB,EAUrBA,YAAQ,EAKPA,iBAAc,IAAIN,MAKlBM,yBAAsB,IAAIN,kBAMlC,OAAO6gB,GAAevgB,KAAKy8C,kBAO3B,OAAO2nB,GAAcpkE,KAAKy8C,QAAU,SAKtCj8B,WACExgB,KAAKqwD,uBACLrwD,KAAK0sF,YAAc1sF,KAAK2sF,WAAWvkF,UAAUvI,GAASG,KAAK4sF,oBAAoB10E,KAAKrY,IAGtFsY,cACEnY,KAAK0sF,YAAYhkF,cAGnBmkF,sBACI,MAAMhtF,EAAeG,KAAKy8C,MAAM7tC,QAChC,IAAK/O,EAAaktB,QAChB,OAAOxM,GAAevgB,KAAKy8C,OAE7B,MAAM38C,EAAeD,EAAaktB,QAC5B3sB,EAAiBP,EAAsCwgE,SAC7D,OAAQxgE,EAAaktB,QAAQjoB,WACtB+4C,GAAYC,MACf,OAAO99C,KAAKy8C,MAAMxtC,WACf4uC,GAAYivC,SACf,OAAI1sF,GAAiBA,EAAck8C,SAC1Bl8C,EAAck8C,SAEdt8C,KAAKy8C,MAAMxtC,WAEjB4uC,GAAYkvC,OACf,OAAIjtF,GAAgBA,EAAawP,KACxBxP,EAAawP,KAEbtP,KAAKy8C,MAAMxtC,cAGpB,OAAOjP,KAAKy8C,MAAMxtC,OAQ1B+9E,aAAantF,GACXG,KAAK47E,cAAc/7E,GAGrBotF,aAAaptF,GACXG,KAAKktF,kBAAkB/kF,MAAMnI,KAAKktF,kBAAkBprF,OACpD9B,KAAK6gF,aAAatB,iBAAiBv/E,KAAKy8C,MAAM7tC,SAASrG,QAAKmsD,SAC3DtsD,UAAUtI,GAASE,KAAKmtF,UAAUhlF,KAAKrI,IAO1C87E,cAAc/7E,GAIZ,QAHuC,IAA5BG,KAAK+2E,oBACdC,aAAah3E,KAAK+2E,oBAED,eAAfl3E,EAAMiF,OAAyB9E,KAAKotF,eAGxC,OAAQvtF,EAAMiF,UACP,QACE9E,KAAK2sF,WAAW7qF,QACf9B,KAAKuE,MACPvE,KAAKmQ,SAELnQ,KAAKg8B,OAGTh8B,KAAK2sF,WAAWxkF,MAAK,GACrB,UACG,cACEnI,KAAK2sF,WAAW7qF,QAAU9B,KAAKuE,QAClCvE,KAAK+2E,mBAAqBI,WAAW,KACnCn3E,KAAKg8B,MACLh8B,KAAK2sF,WAAWxkF,MAAK,IACpB,MAELnI,KAAKotF,gBAAiB,EACtB,UACG,aACCptF,KAAK2sF,WAAW7qF,QAClB9B,KAAKmQ,SACLnQ,KAAK2sF,WAAWxkF,MAAK,IAEvBnI,KAAKotF,gBAAiB,GAUpBpxD,MACDh8B,KAAKuE,QACRvE,KAAKuE,OAAQ,EACbvE,KAAKqtF,YAAYn1E,KAAK,CAAE3T,OAAO,EAAMk4C,MAAOz8C,KAAKy8C,SAO7CtsC,SACFnQ,KAAKuE,QACPvE,KAAKuE,OAAQ,EACbvE,KAAKqtF,YAAYn1E,KAAK,CAAE3T,OAAO,EAAOk4C,MAAOz8C,KAAKy8C,SAItD6wC,YACE,SAAUttF,KAAKy8C,MAAM8sC,SAAoD,IAAzCvpF,KAAKy8C,MAAM8sC,QAAQ5lF,MAAM,KAAKpD,QAGhE8vD,uBAGE,YAAKk9B,SAASplF,KACZnI,KAAKovE,aAHepvE,KAAKy8C,MAAM7tC,QAAQ+7C,eAAiB,IAGpB3qD,KAAKovE,aAFrBpvE,KAAKy8C,MAAM7tC,QAAQqgD,eAAiB,MAInDjvD,KAAKutF,SAASzrF,MAGvB0rF,iBACE,OAAIxtF,KAAKuE,MACAvE,KAAK2sF,WAAW7qF,MACnB,iCACA9B,KAAKutF,SAASzrF,MACd,sCACA,8CAEG9B,KAAKutF,SAASzrF,MACjB,iCACA,uFA3LGf,GAA4BrB,oCAA5BqB,EAA4BugB,owCD5BzC5hB,yBACEA,6BACAA,gBAAoGA,iCAASI,oBAA2DJ,SAASA,QAE/KA,2BAcFA,iCAEAA,oBACEA,sCAAcI,mBAAdJ,CAAmC,gCAAeI,mBAAlDJ,CAAmC,2BAM1BI,2DACTJ,wCAUFA,QAEFA,QAEAA,oBACEA,0EAIFA,eA9CaA,qCAC4BA,2EAA4D,sCAAqEA,wBAE7JA,gDAcUA,gCAOnBA,4DAA2C,uDAOxCA,0DAAyC,oEAY3CA,0cChBQqB,6BCZTrB,sBAOEA,iCAASI,2CAEXJ,cAJEA,kGARJA,oBAGEA,6BAUFA,8BARKA,0FAULA,SACEA,qBAOEA,yGACAA,uBACFA,QACFA,gCANIA,8EAAgE,6EASlEA,qBAMEA,yGACAA,uBACFA,gCAJEA,gEAA2D,0DAU7DA,kDAGAA,SACEA,wCAMEA,qFAA8C,2EAEhDA,QACFA,oDAPIA,0BAAc,0BAAdA,CAAc,0CAAdA,CAAc,yDANlBA,kCAGAA,sEAHeA,2BAGAA,yCC1BN+tF,iBANb1lF,cAYE/H,WAAQ,IAAI0+B,GAA2C,IAMvD1+B,YAAmC,IAAI+I,KAAgB,GACvD/I,cAAqC,IAAI+I,KAAgB,GAKzD/I,eAAsC,IAAI+I,KAAgB,GAejD/I,gBAAqB,EAIrBA,yBAAqB,EAKrBA,sBAA2B,EAc1BA,iBAAc,IAAIN,MAQlBM,sBAAmB,IAAIN,kBAS/B,OAAOM,KAAK43B,MAAM3oB,MAMpBuR,WACExgB,KAAKoR,MAAMxG,KAAK5K,KAAK43B,MAAM4+B,OAC3Bx2D,KAAK0tF,gBACL1tF,KAAK2tF,iBAAiB3tF,KAAKguB,gBACM,IAA7BhuB,KAAK43B,MAAMyxD,eACbrpF,KAAKoR,MAAM6L,KAAKhC,KAAK,CACnB2B,UAAW5c,KAAK43B,MAAMyxD,cACtB1sE,cAAgB9c,GAAsBA,EAAKoP,QAKjDkJ,cACEnY,KAAKoR,MAAM8J,UAMb0vE,QAAQ/qF,GACN,OAAOA,EAAKiF,OAASq8E,GAAgB0H,MAMvCgC,QAAQhrF,GACN,OAAOA,EAAKiF,OAASq8E,GAAgBniB,MAOvC4c,gBACE57E,KAAKqtC,OAAOvrC,MAAQ9B,KAAKmQ,SAAWnQ,KAAKg8B,MAO3C4xD,kBAAkB/tF,GAChBG,KAAK2tF,iBAAiB9tF,GAUxBirF,mBAAmBjrF,GACjBG,KAAK6tF,iBAAiB31E,KAAKrY,GAC3BG,KAAK8tF,eAAejuF,GAMdm8B,MACNh8B,KAAKqtC,OAAOllC,MAAK,GACjBnI,KAAKqtF,YAAYn1E,KAAK,CACpB3T,OAAO,EACPqzB,MAAO53B,KAAK43B,QAORznB,SACNnQ,KAAKqtC,OAAOllC,MAAK,GACjBnI,KAAKqtF,YAAYn1E,KAAK,CACpB3T,OAAO,EACPqzB,MAAO53B,KAAK43B,QAIhBm2D,eAAeluF,GACbG,KAAKguF,SAAS7lF,KAAKtI,GAObiuF,eAAejuF,GACrB,MAAMC,EAAQD,EAAM0E,MACdnE,EAAQP,EAAM48C,MAOhBz8C,KALqBoR,MAAM6L,KAC5BxC,MACAhU,OAAQnG,GAAsBA,EAAKsE,KAAOxE,EAAMwE,IAChDc,IAAKpF,GAAsBN,KAAK8X,MAAMrO,IAAInJ,GAAMiE,QAAS,GAE5CmY,MAAMpc,GAASA,IAAUR,GACvCA,EAAQE,KAAKg8B,MAAQh8B,KAAKmQ,UACK,IAAtBnQ,KAAKqtC,OAAOvrC,OACrB9B,KAAKqtC,OAAOllC,MAAK,GAIbulF,gBACN,MAAM7tF,EAAQG,KAAKoR,MAAMqJ,MAAMiC,MAAO5c,IACa,KAAzCE,KAAK8X,MAAMrO,IAAI3J,GAAMyE,QAAS,IAExCvE,KAAKqtC,OAAOllC,KAAKtI,GAGX8tF,iBAAiB9tF,GACvB,IAAIC,GAAW,GACc,IAAzBE,KAAKiuF,kBACPnuF,EAAWD,GAEbG,KAAKmsB,UAAUhkB,KAAKrI,GAGtBouF,eACEluF,KAAKguB,WAAahuB,KAAKguB,wDAvMdjtB,8BAA4BugB,68CDjCzC5hB,yBACEA,sBAOEA,kCAAUI,yBACZJ,QAEAA,gBAAqHA,gCAASI,mBAAgBJ,SAASA,QAEvJA,2BAeAA,mEAaAA,2CAWFA,QAEAA,uBACEA,mDAgBFA,2CAjEIA,2BAAgB,yBAK8EA,qCAA8CA,wBAErIA,gDAeMA,wEAAwD,cA2B3CA,4WCtBjBqB,MC5BAotF,iBAUXpmF,cARO/H,gBAAY,EACZA,kBAAc,EACdA,kBAAc,EACdA,yBAAqB,EACrBA,6BAAyB,EACzBA,6BAAyB,EACzBA,6BAAyB,gDARrBe,gCAAoBsI,QAApBtI,EAAoB,qBAFnB,SAEDA,+CCJXrB,0BAGEA,4DAEFA,gCADEA,iHAIFA,qBAOEA,2FACAA,0EASFA,gCAfEA,mDAA+C,sCAW7CA,gEAA4C,4DAA5CA,CAA4C,kGAMhDA,qBASAA,gHACAA,yDASFA,gCAjBEA,mDAA+C,wGAa7CA,gEAA4C,6DAA5CA,CAA4C,qFAM9CA,qBAOEA,0FACAA,uBACFA,aALEA,oFASFA,oDAEEA,uBAAe,wECvCN0uF,iBAkGXrmF,YACUlI,EACAC,EACAM,EACAC,GAHAL,sBACAA,gBACAA,aACAA,aArGHA,gBAAa,yBAgBpBA,gBAAuC,IAAI+I,KAAgB,GAE3D/I,iBAAwC,IAAI+I,KAAgB,GAE5D/I,wBAA+C,IAAI+I,KAAgB,GAEnE/I,uBAA8C,IAAI+I,KAAgB,GAgB1D/I,iBAAa,EAQrBA,aAAkC,IAAI+I,SAAuB,GAYpD/I,qCAA0C,EAE1CA,4BAAiC,EAEjCA,qCAA0C,EAE1CA,gBAAqB,EAErBA,oBAAyB,EAEzBA,oBAAyB,EAEzBA,iBAAsB,EAqBrBA,YAA8B,IAAIN,WAAoB,GACtDM,cAAW,IAAIN,wBAxFvB,OAAOM,KAAKquF,6BAEExuF,GACVA,GAASG,KAAKy8C,OAAS58C,EAAM+E,KAAO5E,KAAKy8C,MAAM73C,KAAO5E,KAAKsuF,eAC7DtuF,KAAKuuF,WAAWpmF,MAAK,GACrBnI,KAAK2iB,SAASC,SAAS5iB,KAAKquB,MAAM/L,cAAetiB,KAAKiiC,aAEtDjiC,KAAK2iB,SAASE,YAAY7iB,KAAKquB,MAAM/L,cAAetiB,KAAKiiC,4BAmB3D,OAAOjiC,KAAKwuF,yBAEA3uF,GACZG,KAAKwuF,WAAa3uF,GACJ,IAAVA,IACFG,KAAKyuF,YAAa,eAepB,OAAOzuF,KAAKo8C,iBAEJv8C,GACRG,KAAKo8C,OAASv8C,EACdG,KAAK4yE,QAAQzqE,KAAKtI,iBAuBlB,OAA4B,IAArBG,KAAKy8C,MAAMgO,QAAUA,YAElB5qD,GACVG,KAAKy8C,MAAMgO,QAAU5qD,EAAU,qBAI/B,OAA2C,IAAvCG,KAAK0uF,mBAAmB/kE,WACnB,gCAEA3pB,KAAKy8C,MAAM71B,QAAU,0BAA4B,0BAgB5DpG,WAEIxgB,KAAKy8C,MAAM71B,SACX5mB,KAAK2uF,wBAC6B,IAAlC3uF,KAAKy8C,MAAMmyC,qBAEX5uF,KAAKy8C,MAAMmyC,oBAAqB,EAChC5uF,KAAKy8C,MAAM6S,iBAAkB,GAE/BtvD,KAAK6uF,aAAa7uF,KAAKy8C,MAAM6S,iBAC7BtvD,KAAK8uF,mBAGL9uF,KAAK6wD,aADe7wD,KAAKy8C,MAAM/2C,IAAI2lD,eAAeyF,YAClB1oD,UAAU,KACxCpI,KAAK+uF,uBAEP/uF,KAAKgvF,YAAchvF,KAAKwtF,iBAExBxtF,KAAKivF,UAAYjvF,KAAK2+E,eAAevmE,eAAehQ,UAAWtI,IAC7DE,KAAK8X,MAAQhY,EACbE,KAAK+uF,uBAGP/uF,KAAKq4E,SAAWr4E,KAAK4yE,QAAQxqE,UAAU,KACjCpI,KAAKy8C,OAASz8C,KAAKy8C,MAAM7tC,QAAQ4Q,SACnCxf,KAAKuuF,WAAWpmF,MAAK,GACrBnI,KAAK2iB,SAASC,SAAS5iB,KAAKquB,MAAM/L,cAAetiB,KAAKiiC,eAItDjiC,KAAKioC,iBACPjoC,KAAKioC,gBAAgB7/B,UAAU,IAAMpI,KAAKkf,MAAMD,iBAIpD9G,cACEnY,KAAK6wD,aAAanoD,cAClB1I,KAAKivF,UAAUvmF,cACf1I,KAAKq4E,SAAS3vE,cAGhBmmF,aAAahvF,GACXG,KAAKy8C,MAAM6S,gBAAkBzvD,EAC7BG,KAAKkvF,YAAY/mF,MAAMtI,GAGzBsvF,sBACEnvF,KAAK6uF,aAAa7uF,KAAKkvF,YAAYptF,OAGrCstF,mBACEpvF,KAAKy8C,MAAM71B,SAAW5mB,KAAKy8C,MAAM71B,QAC7B5mB,KAAKqvF,gCACPrvF,KAAK6uF,cAAc7uF,KAAKy8C,MAAM71B,SAEhC5mB,KAAK8uF,mBAGPtB,iBACE,MAAM3tF,EAAeG,KAAKy8C,MAAM7tC,QAChC,IAAK/O,EAAaktB,QAChB,OAAO/sB,KAAKy8C,MAAMxtC,MAEpB,MAAMnP,EAAeD,EAAaktB,QAC5B3sB,EAAiBP,EAAsCwgE,SAC7D,OAAQxgE,EAAaktB,QAAQjoB,WACtB+4C,GAAYC,MACf,OAAO99C,KAAKy8C,MAAMxtC,WACf4uC,GAAYivC,SACf,OAAI1sF,GAAiBA,EAAck8C,SAC1Bl8C,EAAck8C,SAEdt8C,KAAKy8C,MAAMxtC,WAEjB4uC,GAAYkvC,OACf,OAAIjtF,GAAgBA,EAAawP,KACxBxP,EAAawP,KAEbtP,KAAKy8C,MAAMxtC,cAGpB,OAAOjP,KAAKy8C,MAAMxtC,OAIhB8/E,qBACN,MAAMlvF,EAAoBG,KAAKy8C,MAAM4T,sBAEb,IAAtBxwD,IACwC,IAAxCG,KAAK2rF,gCAEL3rF,KAAK6uF,cAAa,GAEpB7uF,KAAK0uF,mBAAmBvmF,KAAKtI,GAGvBivF,mBACN,MAAMjvF,GACgB,IAApBG,KAAKsvF,aACkB,IAAvBtvF,KAAKy8C,MAAM71B,UACVk/D,GAAiB9lF,KAAKy8C,OACzBz8C,KAAKuvF,kBAAkBpnF,KAAKtI,GAG9B2vF,kBACExvF,KAAKuuF,WAAWpmF,MAAMnI,KAAKuuF,WAAW5kE,aACH,IAA/B3pB,KAAKuuF,WAAW5kE,WAClB3pB,KAAK2iB,SAASC,SAAS5iB,KAAKquB,MAAM/L,cAAetiB,KAAKiiC,YAEtDjiC,KAAK2iB,SAASE,YAAY7iB,KAAKquB,MAAM/L,cAAetiB,KAAKiiC,YAE3DjiC,KAAKisB,OAAO/T,KAAKlY,KAAKy8C,OAGjBgzC,QACLzvF,KAAKyuF,YAAczuF,KAAKyuF,WACxBzuF,KAAK0vF,SAASx3E,KAAK,CAACukC,MAAOz8C,KAAKy8C,MAAOgzC,MAAOzvF,KAAKyuF,2DA5N1C1tF,GAAkBrB,2EAAlBqB,EAAkBugB,68DDzB/B5hB,2BACEA,iCAMAA,gBAAIA,gCAASI,0BAA4GJ,SAAeA,QAExIA,4BAmBAA,4BAqBAA,2BAUFA,QAEAA,mBACEA,uDAKFA,eAlEiBA,uCAMqDA,2CAAqDA,8BAEhHA,wCAmBAA,uCAqBAA,wCAcNA,4mBCtCQqB,UCzBD4uF,SAAZ,OAAY5uF,UAAqB,KAC/B6uF,gBACA7uF,gBACAA,oBAHU4uF,GAAZ,IAAY5uF,MAKA8uF,SAAZ,OAAY9uF,UAA0B,KACpC+uF,0BACA/uF,0BACAA,gBACAA,cAJU8uF,GAAZ,IAAY9uF,MAOAgvF,SAAZ,OAAYhvF,UAAqB,KAC/BivF,cACAjvF,gBAFUgvF,GAAZ,IAAYhvF,gFCXVrB,iCAMEA,mGAA6D,yEAE/DA,gCANEA,mDAA2C,2CAA3CA,CAA2C,sDAA3CA,CAA2C,6FAS/CA,2BACEA,0BAGEA,gEAE+DA,mDACjEA,QACFA,gCALIA,uFAA4E,2BAA5EA,CAA4E,6DAGbA,+JAO/DA,6BAeEA,yEAAkC,iEAEpCA,oDAfEA,iBAAe,4BAAfA,CAAe,sCAAfA,CAAe,4CAAfA,CAAe,4CAAfA,CAAe,0BAAfA,CAAe,sDAAfA,CAAe,kEAAfA,CAAe,kEAAfA,CAAe,4BAAfA,CAAe,6BAAfA,CAAe,6BAAfA,CAAe,yEAFjBA,uEAAiBA,4FAuBjBA,qBAQEA,wFACAA,uBACFA,aAHEA,oGA+DFA,qBAQEA,mHACAA,uBACFA,aAHEA,wIA/ENA,wBACEA,kBACEA,4BAYAA,qBAQEA,oKACAA,uBAEFA,QAEAA,qBAQEA,oKACAA,wBAEFA,QAGAA,4CAQEA,wBACFA,QAEAA,2BACEA,mBACEA,0BASEA,qEAA+B,2BAEpBU,4CAGbV,QACFA,QACFA,QAEAA,6BAYAA,aAKAA,UACFA,QACFA,4CA3F8FA,mCAGvFA,yDAiBDA,uJAAgJ,4BAGtIA,wEAA6D,kCAUvEA,uJAAgJ,4BAGtIA,wEAA6D,kCAWvEA,sCAAiC,mDAEvBA,0CAWNA,wBAAS,UAATA,CAAS,kBAATA,CAAS,mDAaZA,2DAYDA,0DAAyC,gGA2EvCA,yBAQEA,4EAA0B,2BAIfU,2CACbV,iCAPEA,eAAS,UAATA,CAAS,yBAATA,CAAS,2FAWfA,qBAQEA,sHACAA,uBACFA,aAHEA,mGA3FNA,6CACEA,kBACEA,qBAQEA,qIACAA,uBAEFA,QAEAA,qBAQEA,yIACAA,wBACFA,QAEAA,sBAQEA,sIACAA,wBAEFA,QAEAA,sBAQEA,sIACAA,wBAEFA,QAEAA,4CASEA,wBACFA,QAEAA,2BACEA,mBACEA,iCAcFA,QACFA,QAEAA,6BAWFA,QACFA,4CAhGsFA,iDAQhFA,sDAAuC,mKAG7BA,+BAAgB,0DAU1BA,sDAAuC,uJAG7BA,qFASVA,yJAAgJ,qCAGtIA,wEAA6D,2CAUvEA,yJAAgJ,qCAGtIA,wEAA6D,2CAUvEA,sDAAuC,sBAAvCA,CAAuC,mDAQxBA,8CAkBdA,6QCtLMuwF,iBAuLXloF,YAAoBlI,gBAtLpBG,gBAAY,EACZA,8BAA2B,EAE3BA,aAAoC,IAAI+I,IAAgB,IAExD/I,aAAU,IAAImZ,KAAoB,GAElCnZ,kBAAyC,IAAI+I,KAAgB,GAItD/I,yBAA8B,EACrCA,kBAAuC,IAAI+I,SAAgB,GAE3D/I,mBAAyB,GAKlBA,+BAA4B,IAAI+I,SAAgB,GAK9C/I,0BAA+B,EAE/BA,gBAAqB,EAErBA,iBAAsB,EA8BtBA,gBAA6B,OAE7BA,+BAAsD,GAEtDA,wBAA6B,EAE7BA,qCAA0C,EAE1CA,kCAAuC,EAEvCA,qCAA0C,EAE1CA,iBAAsB,EAErBA,0BAAuB,IAAIN,MAS7BM,mBAAW,EASXA,mBAAe,EASfA,mBAAe,EA6EhBA,oBAAgB,EAGhBA,qBAAkB,IAAI+I,SAAyB,aAnJpD,OAAO/I,KAAKg7E,aAENn7E,GACNG,KAAKg7E,KAAOn7E,aAKHA,GACTG,KAAKkwF,QAAUlwF,KAAKmwF,yBAAyBtwF,GAC7CG,KAAKmI,oBAGL,OAAOnI,KAAKkwF,wBAIErwF,GACdG,KAAKquF,aAAexuF,EACpBG,KAAKowF,aAAajoF,KAAKtI,qBAGvB,OAAOG,KAAKquF,2BAqBZ,OAAOruF,KAAKqwF,qBAEFxwF,GACVG,KAAKqwF,SAAWxwF,EAChBG,KAAKmI,yBAKL,OAAOnI,KAAKswF,6BAEEzwF,GACdG,KAAKswF,aAAezwF,EACpBG,KAAKmI,uBAKL,OAAOnI,KAAKuwF,2BAEA1wF,GACZG,KAAKuwF,aAAe1wF,EACpBG,KAAKmI,qBAKL,OAAOZ,KAAKE,MAA6C,IAAvCzH,KAAKowF,aAAazmE,WAAW8gC,SAAUA,YAE/C5qD,GACVG,KAAKowF,aAAazmE,WAAW8gC,QAAU5qD,EAAU,uBAIjD,GAAqB,MAAjBG,KAAKyqD,QAGT,OAAOzqD,KAAKyqD,4BAIZ,QACGzqD,KAAKwwF,YACNxwF,KAAKywF,YAAYzhC,WACjBhvD,KAAK0wF,gBAAgB9rF,KAAO5E,KAAKywF,YAAY7rF,KAC7C5E,KAAK2wF,iBAAiB3wF,KAAKywF,kCAQ7B,QACGzwF,KAAKwwF,YACNxwF,KAAKywF,YAAYzhC,WACjBhvD,KAAK4wF,gBAAgBhsF,KAAO5E,KAAKywF,YAAY7rF,KAC7C5E,KAAK6wF,iBAAiB7wF,KAAKywF,2CAQ7B,OACgC,IAA9BzwF,KAAK8wF,cAAcvwF,SAClBP,KAAKwwF,YACLxwF,KAAK+wF,eAAe/wF,KAAK8wF,iBACF,IAAxB9wF,KAAKgxF,eAAmBC,6BAQ1B,OACgC,IAA9BjxF,KAAK8wF,cAAcvwF,SAClBP,KAAKwwF,YACLxwF,KAAKkxF,gBAAgBlxF,KAAK8wF,iBACH,IAAxB9wF,KAAKgxF,eAAmBG,mBAQ1B,OAAqC,IAA9BnxF,KAAKoxF,uBAAyBD,iBAEtBtxF,GACf,UAAWC,KAASE,KAAK8wF,cACvBhxF,EAAM2qD,QAAU5qD,EAAU,gCAK5B,OAAOkwF,GAeTvvE,WACExgB,KAAKqxF,SAAWrxF,KAAKoa,QAClB7R,MACC,QAAS,IACuB,IAAvBvI,KAAKqqD,OAAO9pD,OAAegoF,MAAQ,QAAM,MAGnDngF,UAAU,KACTpI,KAAKsxF,aAAanpF,KAAKnI,KAAKuxF,sBAC5BvxF,KAAK4yE,QAAQzqE,KAAKnI,KAAKwxF,cAAcxxF,KAAKqqD,OAAOjnD,MAAM,KACvDpD,KAAKyxF,qBAAqBv5E,KAAK,CAC7Bw5E,QAAS1xF,KAAK0xF,QACdC,UAAW3xF,KAAK2xF,UAChBC,YAAa5xF,KAAK4xF,gBAIxB5xF,KAAK6xF,iBAAmB7xF,KAAK8xF,gBAAgB1pF,UAAWvI,IACtDG,KAAKgxF,eAAiBnxF,IAGxBG,KAAKq4E,SAAWr4E,KAAK4yE,QAAQxqE,UAAU,KACrC,GAAIpI,KAAKqqD,OAAQ,CACf,IAAIxqD,EAAS,EACb,UAAWC,KAASE,KAAKqqD,OACvBvqD,EAAMoI,QAAQE,UAAUhI,IACJ,IAAdA,GACFJ,KAAK0F,IAAIikE,YAAY7pE,KAGrBA,EAAM8O,QAAQ4Q,SAChBxf,KAAKywF,YAAc3wF,EACnBE,KAAK+xF,WAAY,GAEfjyF,EAAM8O,QAAQ6gF,QAChB5vF,GAAU,GAIZG,KAAKgxF,eADHhxF,KAAKgyF,kBAELnyF,IACEG,KAAKqqD,OAAO5jD,OACT3G,IAA0B,IAAlBA,EAAIkvD,WAAsBlvD,EAAIwwD,iBACvC/vD,OAKJV,IAAWG,KAAKqqD,OAAO5jD,OAAQ3G,GAAQA,EAAIwwD,iBAAiB/vD,UAQtE4X,cACEnY,KAAKqxF,SAAS3oF,cACd1I,KAAK6xF,iBAAiBnpF,cACtB1I,KAAKq4E,SAAS3vE,cAGhBupF,mBAAmBpyF,GACjB,IAAIC,GAAQ,EACZ,MAAMM,EAAcP,EAAM+O,QAAQk8B,OAC5BzqC,EAAqBL,KAAK0F,IAAI2lD,eAAeipB,mBAEnD,OAAIl0E,IAEAN,GADEO,GACMukE,MAAwBvkE,EAAoBD,IAKjDN,EAGToyF,qBAAqBryF,GACnB,IAAIC,GAAQ,EACZ,MAAMM,EAAewkE,QACfvkE,EAAqBL,KAAK0F,IAAI2lD,eAAeipB,mBAEnD,UAAWh0E,KAAST,EAAQ,CAC1B,MAAMW,EAAcF,EAAMsO,QAAQk8B,OAE9BtqC,IAAgBA,EAAYiT,SAAS,MACvCmxD,MAAgBxkE,EAAcI,GAIlC,OAAKokE,MAAiBxkE,KAElBN,GADEO,GACOukE,MAAwBvkE,EAAoBD,IAKlDN,EAGTqyF,iBAAiBtyF,GACfG,KAAK0F,IAAI2lD,eAAe0Z,aAAallE,EAAM+O,QAAQk8B,QAGrDsnD,kBAAkBvyF,GAChB,MAAMC,EAAe8kE,QAErB,UAAWxkE,KAASP,EAAQ,CAC1B,MAAMQ,EAAcD,EAAMwO,QAAQk8B,OAE9BzqC,GACFukE,MAAgB9kE,EAAcO,GAGlCL,KAAK0F,IAAI2lD,eAAe0Z,aAAajlE,GAGvCuyF,cAAcxyF,GACZG,KAAKyqD,QAAU5qD,EAAMiC,MAGvBwwF,eACEtyF,KAAK0xF,aAAU,EAGjBd,gBACE,OAAO5wF,KAAKqqD,OACT5jD,OAAQ5G,IAAOA,EAAEmvD,WACjBhoD,OACC,CAACnH,EAAMC,IACED,EAAKkvD,OAASjvD,EAAQivD,OAASlvD,EAAOC,EAE/C,CAAEivD,YAAQ,EAAWnqD,QAAI,IAI/BisF,iBAAiBhxF,GACf,MAAMC,EAAQE,KAAKqqD,OAAO3lD,UAAWtE,GAAQP,EAAM+E,KAAOxE,EAAIwE,IAC9D,SACE5E,KAAKqqD,SACLrqD,KAAKqqD,OAAOvqD,EAAQ,KACiB,IAArCE,KAAKqqD,OAAOvqD,EAAQ,GAAGkvD,WAO3B0hC,gBACE,OAAO1wF,KAAKqqD,OACT5jD,OAAQ5G,IAAOA,EAAEmvD,WACjBhoD,OACC,CAACnH,EAAMC,IACED,EAAKkvD,OAASjvD,EAAQivD,OAASlvD,EAAOC,EAE/C,CAAEivD,YAAQ,EAAWnqD,QAAI,IAI/B+rF,iBAAiB9wF,GACf,MAAMC,EAAQE,KAAKqqD,OAAO3lD,UAAWtE,GAAQP,EAAM+E,KAAOxE,EAAIwE,IAC9D,SACE5E,KAAKqqD,SACLrqD,KAAKqqD,OAAOvqD,EAAQ,KACiB,IAArCE,KAAKqqD,OAAOvqD,EAAQ,GAAGkvD,WAO3BujC,gBAAgB1yF,EAAoBC,GAClC,MAAMM,EAAe,CAACP,GAChBQ,EAAqB,GAC3BL,KAAKwyF,gBAAgB3yF,EAAaO,GAClCJ,KAAKqqD,OAAO3kD,IAAIpF,KACsB,IAAhCF,EAAaF,QAAQI,IACvBD,EAAmBO,KAAKN,KAI5BR,IAAmBiwF,GAAsBC,MACvChwF,KAAK81E,YAAYz1E,GAAoB,GAC5BP,IAAeiwF,GAAsB0C,OAC9CzyF,KAAKg2E,YAAY31E,GAAoB,GAIjCmyF,gBAAgB3yF,EAAoBC,GAC1C,MAAMM,EAAeP,EAAY+O,QAAQ07C,aACzC,IAAKlqD,EACH,OAEF,MAAMC,EAAkBD,EAAa4qD,OAC/B1qD,EAAeF,EAAamqD,MACZjqD,EAIpBA,EAAaoF,IAAIhC,KACVA,EAAKyjB,aAAmE,IAArDzjB,EAAKyjB,WAAWjnB,QAAQy9C,GAAiB+0C,SAGjEhvF,EAAKunD,UAAUvlD,IAAI9B,IACjB,MAAMC,EAAa7D,KAAKqqD,OAAOxvC,KAAK9W,IAAK,MAAI,OAA0B,QAA1BC,IAAM4K,QAAQ07C,oBAAY,eAAEU,UAAWpnD,IAChFC,IACG/D,EAAW2T,SAAS5P,IACvB/D,EAAWc,KAAKiD,QAOxB7D,KAAKqqD,OAAO3kD,IAAIhC,WACsB,QAAhCE,IAAYgL,QAAQ07C,oBAAY,eAAEC,QACpC7mD,EAAYkL,QAAQ07C,aAAaC,MAAM7kD,IAAI7B,WAEY,KAAvC,QAAZE,IAAEojB,kBAAU,eAAEjnB,QAAQy9C,GAAiB+0C,WAClB,IAArB7uF,EAAEsnD,iBACuC,IAAzCtnD,EAAEonD,UAAU/qD,QAAQG,KACpBP,EAAWc,KAAK8C,GAChB1D,KAAKwyF,gBAAgB9uF,EAAa5D,QAW9CixF,eAAelxF,GACb,IAAIC,GAAW,EACXM,EAAO,EACX,UAAWC,KAASR,EAAQ,CAC1B,MAAMS,EAAWN,KAAKqqD,OAAO3lD,UAAWd,GAAQvD,EAAMuE,KAAOhB,EAAIgB,IAC3DpE,EAAeR,KAAKqqD,OAAO/pD,GAC7BE,EAAawuD,YACf5uD,GAAQ,GAGV,MAAMsD,EAAgB1D,KAAKqqD,OAAO/pD,EAAW,GAE3CoD,IAC4B,IAA5BA,EAAcsrD,YACbnvD,EAAOgb,KAAMjX,GAAQF,EAAckB,KAAOhB,EAAIgB,MACpB,IAA3BpE,EAAawuD,YAEblvD,GAAW,GAIf,OACiC,IAA9BE,KAAK8wF,cAAcvwF,QAAgBP,KAAK8wF,cAAc,GAAG9hC,WAC1D5uD,IAASJ,KAAK8wF,cAAcvwF,UAE5BT,GAAW,GAENA,EAMT6yF,cAAc9yF,GACZ,QAAIA,EAAQ,MAIRG,KAAKqqD,OAAOxqD,EAAQ,GAAG+O,QAAQ6gF,OAC1BzvF,KAAK2yF,cAAc9yF,EAAQ,IAKtCi2E,YAAYj2E,EAAiBC,GAAkB,GAC7C,MAAMM,EAAgB,GACtB,UAAWC,KAASR,EAAQ,CAC1B,MAAMS,EAAQN,KAAKqqD,OAAO3lD,UAAWlE,GAAQA,EAAIoE,KAAOvE,EAAMuE,IAC1D5E,KAAK2yF,cAAcryF,IACrBF,EAAcQ,KAAKP,GAGvBL,KAAK0F,IAAIowE,YAAY11E,GACjBN,GACFq3E,WAAW,KACT,MAAM92E,EAAWL,KAAK4yF,oBACjB5yF,KAAKojC,mBAAmB/iC,EAAS,GAAIA,EAAS,GAAGwyF,gBACpDxyF,EAAS,GAAGouB,UAAYpuB,EAAS,GAAGwyF,aAAa9wD,YAElD,KAMPmvD,gBAAgBrxF,GACd,IAAIC,GAAW,EACXM,EAAO,EACX,UAAWC,KAASR,EAAQ,CAC1B,MAAMS,EAAWN,KAAKqqD,OAAO3lD,UAAWd,GAAQvD,EAAMuE,KAAOhB,EAAIgB,IAE7D5E,KADsBqqD,OAAO/pD,GAChB0uD,YACf5uD,GAAQ,GAGV,MAAMsD,EAAY1D,KAAKqqD,OAAO/pD,EAAW,GAEvCoD,IACwB,IAAxBA,EAAUsrD,YACTnvD,EAAOgb,KAAMjX,GAAQF,EAAUkB,KAAOhB,EAAIgB,MAE3C9E,GAAW,GAIf,OACiC,IAA9BE,KAAK8wF,cAAcvwF,QAAgBP,KAAK8wF,cAAc,GAAG9hC,WAC1D5uD,IAASJ,KAAK8wF,cAAcvwF,UAE5BT,GAAW,GAENA,EAMTgzF,eAAejzF,GACb,QACEA,EACAG,KAAKqqD,OAAO5jD,OAAQ3G,IAA0B,IAAlBA,EAAIkvD,WAAoBzuD,OAAS,MAK3DP,KAAKqqD,OAAOxqD,EAAQ,GAAG+O,QAAQ6gF,OAC1BzvF,KAAK8yF,eAAejzF,EAAQ,IAKvCm2E,YAAYn2E,EAAiBC,GAAkB,GAC7C,MAAMM,EAAgB,GACtB,UAAWC,KAASR,EAAQ,CAC1B,MAAMS,EAAQN,KAAKqqD,OAAO3lD,UAAWlE,GAAQA,EAAIoE,KAAOvE,EAAMuE,IAC1D5E,KAAK8yF,eAAexyF,IACtBF,EAAcQ,KAAKP,GAGvBL,KAAK0F,IAAIswE,YAAY51E,GACjBN,GACFq3E,WAAW,KACT,MAAM92E,EAAWL,KAAK4yF,kBAAkB,SACnC5yF,KAAKojC,mBAAmB/iC,EAAS,GAAIA,EAAS,GAAGwyF,gBACpDxyF,EAAS,GAAGouB,UACVpuB,EAAS,GAAGwyF,aAAa9wD,UACzB1hC,EAAS,GAAGwyF,aAAaxvD,aACzBhjC,EAAS,GAAGkuB,eAEf,KAGCpmB,OACNnI,KAAKoa,QAAQjS,OAGPqpF,cAAc3xF,GACpB,IAAIC,EAAYE,KAAK+yF,aAAalzF,GAClC,OACEC,EADEE,KAAK2xF,UACK3xF,KAAKgzF,kBAAkBlzF,GAEvBE,KAAKizF,mBAAmBnzF,GAE/BA,EAGTozF,gBAAgBrzF,GACdG,KAAK0xF,QAAU7xF,EAGjBszF,6BAA6BtzF,GAC3BG,KAAK0xF,QAAU7xF,EAAc6xF,QAC7B1xF,KAAK4xF,YAAc/xF,EAAc+xF,YACjC5xF,KAAK2xF,UAAY9xF,EAAc8xF,UAGzBoB,aAAalzF,GAMnB,GAJEG,KAAKozF,0BAA0BC,cAAgB1D,GAAsB2D,QAIlEtzF,KAAK0xF,UAAY1xF,KAAK4xF,YACzB,OAAO/xF,EAGT,MAAMC,EAAeD,EAAO6F,IAAKtF,GAAiBA,EAAMwE,IAExD,SAAOkB,QAAS1F,IACd,MACME,EAAoBF,EAAMsmB,WAAW9X,SAAW,GAGhDhL,KAJgBxD,EAAMwO,SAAoC,IAElCyxD,UAAa,IACjBE,aAAe,IACV76D,IAAK7B,GAC3BA,EAAG8kB,UAAU,OAAOxiB,QAAQ,mBAAoB,KAGzD,GAAInG,KAAK0xF,SAAWtxF,EAAM6O,MAAO,CAC/B,MAAMpL,EAAe7D,KAAK0xF,QACvB/oE,UAAU,OACVxiB,QAAQ,mBAAoB,IACzBpC,EAAa3D,EAAM6O,MACtB0Z,UAAU,OACVxiB,QAAQ,mBAAoB,IACzBnC,EAAiB1D,EAAkBwE,MAAQ,GAC3CH,EAAe,IAAIsgB,OAAOphB,EAAc,MACxCi/C,OAEJ,IADAl/C,EAAciX,KAAM5T,GAAetC,EAAaugB,KAAKje,IAEvD,IACGtC,EAAaugB,KAAKnhB,IACjB/D,KAAK0xF,QAAQ3qF,gBAAkB/C,EAAe+C,gBAC/C+7C,EACD,CACA,MAAM77C,EAAQnH,EAAaI,QAAQE,EAAMwE,IACrCqC,GAAQ,GACVnH,EAAakF,OAAOiC,EAAO,IAKjC,GAAIjH,KAAK4xF,cAAiC,IAAlBxxF,EAAMwmB,QAAmB,CAC/C,MAAM/iB,EAAQ/D,EAAaI,QAAQE,EAAMwE,IACrCf,GAAQ,GACV/D,EAAakF,OAAOnB,EAAO,MAK1BhE,EAAO4G,OACXrG,IAAoD,IAAnCN,EAAaI,QAAQE,EAAMwE,KAIzCquF,mBAAmBpzF,GACzB,OAAOA,EAAOob,KAAK,CAACnb,EAAQM,IAAWA,EAAO2uD,OAASjvD,EAAOivD,QAGxDikC,kBAAkBnzF,GACxB,OAAOA,EAAOob,KAAK,CAACnb,EAAGM,IACjBJ,KAAK2oB,UAAU7oB,EAAEmP,OAASjP,KAAK2oB,UAAUvoB,EAAE6O,QACtC,EAELjP,KAAK2oB,UAAU7oB,EAAEmP,OAASjP,KAAK2oB,UAAUvoB,EAAE6O,OACtC,EAEF,GAIH0Z,UAAU9oB,GAChB,OAAOA,EACJ8oB,UAAU,OACVxiB,QAAQ,mBAAoB,IAC5BY,cAGGwqF,qBACN,OAAQvxF,KAAKozF,0BAA0BC,kBAChC1D,GAAsBC,OACzB,OAAO,OACJD,GAAsB2D,MACzB,OAAO,UAEP,SACEtzF,KAAKqqD,OAAO9pD,QAAUP,KAAKuzF,0BAC3BvzF,KAAK0xF,SACL1xF,KAAK4xF,cAQbpC,gBAAgB3vF,GACdG,KAAKwzF,eAAgB,EAEnBxzF,KAAK+xF,WADP/xF,KAAS+xF,WAAalyF,IAAUG,KAAKywF,YAMrC,UAAW3wF,KAAOE,KAAKqqD,OACrBvqD,EAAI8O,QAAQ4Q,QAAS,EAEvB3f,EAAM+O,QAAQ4Q,QAAS,EACvBxf,KAAKywF,YAAc5wF,EAGrBy1E,aAAaz1E,GACX,GAAIA,GAAUA,EAAOU,OAAS,EAAG,CAC/BP,KAAK8wF,cAAgB,GACrB,UAAWhxF,KAASD,GACc,IAA5BC,EAAM8O,QAAQ6kF,UAChB3zF,EAAM4F,IAAIikE,YAAY7pE,GAEtBE,KAAK8wF,cAAclwF,KAAKd,QAGlBD,IAAiD,IAAvCG,KAAKywF,YAAY7hF,QAAQ6kF,YAC7CzzF,KAAKywF,YAAY/qF,IAAIikE,YAAY3pE,KAAKywF,aACtCzwF,KAAK+xF,WAAY,GAIrB3C,iBAAiBvvF,GACf,GAAIA,GAAUA,EAAOU,OAAS,EAC5B,UAAWT,KAASD,EAClBC,EAAM8mB,QAAU5mB,KAAK0zF,mBAGzB1zF,KAAK2zF,0BAA0BxrF,MAAK,GAGtCyrF,iBAAiB/zF,GACf,OAAmC,IAA5BA,EAAM+O,QAAQ6kF,UAGvBI,qBAAqBh0F,GACnB,OAAOA,EAAO6c,MAAM5c,GAAKE,KAAK4zF,iBAAiB9zF,oCAI/C,IAAID,EACFgwF,GAA2BiE,KACzBh0F,GAAoB,EACpBM,GAAqB,EAEzB,GAAkC,IAA9BJ,KAAK8wF,cAAcvwF,OACrBV,EAAuBgwF,GAA2BiE,SAC7C,CACLj0F,EAAuBgwF,GAA2BkE,MAClD/zF,KAAK0zF,oBAAqB,EAE1B,UAAWrzF,KAAUL,KAAK8wF,eACD,IAAnBzwF,EAAOumB,UACT9mB,GAAW,IAEU,IAAnBO,EAAOumB,UACTxmB,GAAY,IAIC,IAAbN,IAAmC,IAAdM,IACvBP,EAAuBgwF,GAA2BC,cAEnC,IAAbhwF,IAAoC,IAAdM,IACxBP,EAAuBgwF,GAA2BmE,WAClDh0F,KAAK0zF,oBAAqB,GAI9B,OAAO7zF,EAGTo0F,YAAYp0F,GAEV,GADAA,EAAM48C,MAAM7tC,QAAQ6gF,MAAQ5vF,EAAM4vF,OACd,IAAhB5vF,EAAM4vF,MAAgB,CACxB,MAAM3vF,EAAgBE,KAAKqqD,OAAO3lD,UAC/BtE,GAAUP,EAAM48C,MAAM73C,KAAOxE,EAAMwE,IAEtC,UAAWxE,KAASJ,KAAK8wF,cAEvB,GAAIhxF,EADaE,KAAKqqD,OAAO3lD,UAAWpE,GAAQF,EAAMwE,KAAOtE,EAAIsE,IA6B/D,OA3BA5E,KAAK8wF,cAAc9rF,OACjBhF,KAAK8wF,cAAcpsF,UAAWpE,GAAQF,EAAMwE,KAAOtE,EAAIsE,IACvD,EACA/E,EAAM48C,YAGRz8C,KAASgyF,kBAOLhyF,KAAKgxF,eALLhxF,KAAK8wF,cAAcvwF,SACnBP,KAAKqqD,OAAO5jD,OACTnG,IAA0B,IAAlBA,EAAI0uD,WAAsB1uD,EAAIgwD,iBACvC/vD,OAMMP,KAAKgyF,oBAKbhyF,KAAKgxF,eAHLhxF,KAAK8wF,cAAcvwF,SACnBP,KAAKqqD,OAAO5jD,OAAQnG,GAAQA,EAAIgwD,iBAAiB/vD,SAUzDP,KAAK8wF,cAAclwF,KAAKf,EAAM48C,WACzB,CACL,MAAM38C,EAAQE,KAAK8wF,cAAcpsF,UAC9BtE,GAAUP,EAAM48C,MAAM73C,KAAOxE,EAAMwE,IAEtC5E,KAAK8wF,cAAc9rF,OAAOlF,EAAO,GAG/BE,KAAKgyF,kBAOLhyF,KAAKgxF,eALLhxF,KAAK8wF,cAAcvwF,SACnBP,KAAKqqD,OAAO5jD,OACT3G,IAA0B,IAAlBA,EAAIkvD,WAAsBlvD,EAAIwwD,iBACvC/vD,OAMMP,KAAKgyF,oBAKbhyF,KAAKgxF,eAHLhxF,KAAK8wF,cAAcvwF,SACnBP,KAAKqqD,OAAO5jD,OAAQ3G,GAAQA,EAAIwwD,iBAAiB/vD,QASvD2zF,oBAAoBr0F,GAGlB,GAFAG,KAAK2hB,UAAY9hB,EACjBG,KAAKywF,iBAAc,GACL,IAAV5wF,EAAgB,CAClBG,KAAK+xF,WAAY,EACjB,UAAWjyF,KAASE,KAAKqqD,OACnBvqD,EAAM8O,QAAQ6gF,OAChBzvF,KAAK8wF,cAAclwF,KAAKd,IAMhCsxF,uBACE,GAAIpxF,KAAK8wF,cAAcvwF,OAAS,EAC9B,OAAO,EACF,CACL,MAAMV,EAAU,GAChB,UAAWC,KAASE,KAAK8wF,cACvBjxF,EAAQe,KAAKd,EAAM2qD,SAErB,OAAO5qD,GAIXs0F,YACE,GAAKn0F,KAAKgxF,eAeH,CACL,UAAWnxF,KAASG,KAAKqqD,OACvBxqD,EAAM+O,QAAQ6gF,OAAQ,EAExBzvF,KAAK8wF,cAAgB,GACrB9wF,KAAK8xF,gBAAgB3pF,MAAK,OApBF,CACxB,UAAWtI,KAASG,KAAKqqD,QAErBrqD,KAAKgyF,oBACe,IAApBnyF,EAAMmvD,WACNnvD,EAAMywD,kBAIItwD,KAAKgyF,mBAAqBnyF,EAAMywD,mBAF1CzwD,EAAM+O,QAAQ6gF,OAAQ,EACtBzvF,KAAK8wF,cAAclwF,KAAKf,IAM5BG,KAAK8xF,gBAAgB3pF,MAAK,IAU9Bi7B,mBAAmBvjC,EAAYC,GAC7B,MAAMM,EAAaP,EAAW4uB,UAGxBnuB,EAAUR,EAAKiiC,UAErB,OAAOzhC,EADsBR,EAAKyuB,cAHZnuB,EAAaP,EAAW0uB,cAIRjuB,GAAWF,EAGnDwyF,kBAAkB/yF,GAChB,MAAMC,EAAaE,KAAKquB,MAAM/L,cAAc8xE,uBAC1C,wBAEIh0F,EACK,UAATP,EACIG,KAAKquB,MAAM/L,cAAc8xE,uBACzB,wBACAt0F,EAAWS,OAAS,GACpBP,KAAKquB,MAAM/L,cAAc8xE,uBACzB,wBACA,GAKN,MAAO,CAJSp0F,KAAKquB,MAAM/L,cAAc4xB,qBACvC,YACA,GAEe9zC,GAGnB+vF,yBAAyBtwF,GACvB,UAAWC,KAASD,GACa,IAA3BC,EAAMw3E,kBACRt3E,KAAK0F,IAAIikE,YAAY7pE,GAGzB,OAAOD,gDAh5BEkB,GAAkBrB,uCAAlBqB,EAAkBugB,skJD1C/B5hB,oBACEA,yDASFA,QAEAA,kCASAA,uBAEAA,wBACEA,iDAoBFA,QAEAA,gCA6FAA,wCA1IwBA,iDAWRA,mCAWGA,wGAAoJ,gBAApJA,CAAoJ,gBAC1HA,gDAsBjCA,gEA6FAA,2hECjGCqB,+CClCLrB,oBAOEA,+DACAA,uBACFA,aCEK20F,iBANbtsF,cAOS/H,kBAAyC,IAAI+I,KAAgB,GAC7D/I,gBAAuC,IAAI+I,KAAgB,GAC3D/I,WAAiC,IAAI+I,SAAgB,GAKnD/I,0BAA+B,EAE/BA,gBAA6B,OA0B/BA,oBAAgB,EAEbA,0BAAuB,IAAIN,MAC3BM,eAAY,IAAIN,sBA1BVG,GACdG,KAAKs0F,aAAansF,KAAKtI,qBAGvB,OAAOG,KAAKs0F,aAAaxyF,oBAIbjC,GACZG,KAAKu0F,WAAWpsF,KAAKtI,mBAGrB,OAAOG,KAAKu0F,WAAWzyF,eAIhBjC,GACPG,KAAKw0F,MAAMrsF,KAAKtI,cAGhB,OAAOG,KAAKw0F,MAAM1yF,MAQpB0e,WACExgB,KAAKy0F,OAASz0F,KAAKw0F,MAAMpsF,UAAUvI,IACjCG,KAAKyxF,qBAAqBv5E,KAAK,CAC7Bw5E,UACAE,YAAa5xF,KAAK4xF,YAClBD,UAAW3xF,KAAK2xF,cAIpB3xF,KAAK00F,cAAgB10F,KAAKs0F,aAAalsF,UAAUvI,IAC/CG,KAAKyxF,qBAAqBv5E,KAAK,CAC7Bw5E,QAAS1xF,KAAK20F,KACd/C,cACAD,UAAW3xF,KAAK2xF,cAGpB3xF,KAAK40F,YAAc50F,KAAKu0F,WAAWnsF,UAAUvI,IAC3CG,KAAKyxF,qBAAqBv5E,KAAK,CAC7Bw5E,QAAS1xF,KAAK20F,KACd/C,YAAa5xF,KAAK4xF,YAClBD,gBAKNx5E,cACEnY,KAAK00F,cAAchsF,cACnB1I,KAAK40F,YAAYlsF,cACjB1I,KAAKy0F,OAAO/rF,cAGdmsF,YACE70F,KAAK20F,UAAO,EAEdG,kBACE90F,KAAK2xF,WAAa3xF,KAAK2xF,UAGzBoD,oBACE/0F,KAAK4xF,aAAe5xF,KAAK4xF,YAG3BsC,sBACEl0F,KAAKsuF,eAAiBtuF,KAAKsuF,cAC3BtuF,KAAK2hB,UAAUzJ,KAAKlY,KAAKsuF,6DArFhBvtF,8BAAsBugB,6hCDnBjC5hB,yBACIA,4BACEA,mBAKcA,8FALdA,QAMAA,2BAUFA,QAEAA,2DAGEA,oBAAoFA,gCAASI,sBAC3FJ,uBACFA,QACFA,QAECA,8DAGEA,qBAC6CA,gCAASI,wBACpDJ,uBAOFA,QACFA,QAEAA,8DAGEA,qBACkBA,gCAASI,0BACzBJ,uBACFA,QACFA,QAEPA,eAnD0CA,0CAGhCA,4EAA6D,iEAA7DA,CAA6D,kBAM5DA,8BAUAA,iIAGwBA,qDACfA,qFAIRA,iJAG0CA,iEAAgD,wCAOzFA,iEAKDA,qJAKSA,0XC7BRqB,MCPAi0F,iBAKXjtF,YACUlI,EACAC,EACYM,GADZJ,kBACYA,aAEpBA,KAAKs2B,UAAYz2B,EAGnB2gB,WAGExgB,KAAKi1F,8BAA6B54E,MAAc,CAC9Crc,KAAKy/D,WAAWrC,SAASwV,QACzB5yE,KAAKy/D,WAAWrC,SAAS/R,eAAeyF,cACxCvoD,MACA,OAAa,KACbH,UAAWvI,IACX,MAAMC,EAAcD,EAAM,GAAG4G,OAAQrG,IACF,IAA1BA,EAAMkwD,iBAEftwD,KAAKs2B,UAAU+zB,OAASvqD,EACxBE,KAAKk1F,0BAA0Bp1F,EAAaE,KAAKs2B,UAAU07D,qBAIvDkD,0BAA0Br1F,EAAiBC,QACjB,IAA5BE,KAAKm1F,qBACPn1F,KAAKm1F,mBAAmBzsF,cACxB1I,KAAKm1F,wBAAqB,GAE5Bn1F,KAAKm1F,sBAAqB94E,MAAcxc,EACrC4G,OAAOrG,GAASA,EAAM4uD,YAAclvD,GACpC4F,IAAKtF,GAAiBA,EAAM8qD,WAC5B3iD,MAAK,OAAKnI,GAAwBA,EAASsc,MAAMsO,WACjD5iB,UAAWhI,GACVJ,KAAKs2B,UAAU8+D,oBAAsBh1F,GAG3C+X,cACEnY,KAAKi1F,2BAA2BvsF,mBACA,IAA5B1I,KAAKm1F,qBACPn1F,KAAKm1F,mBAAmBzsF,cACxB1I,KAAKm1F,wBAAqB,iDA/CnBp0F,GAAyBrB,4DAAzBqB,EAAyBugB,4CAAzBvgB,+CCVXrB,8BAKuFA,0GACrFA,8BACFA,gCAJAA,8DAAyD,gCAAzDA,CAAyD,0BAGvDA,yFAEFA,gDAGIA,4EACgBA,iBAAe,6FAD/BA,6EAAwBA,0EAM5BA,eAEEA,8BACFA,eADEA,mHAEFA,eAEEA,8BACFA,eADEA,0HAEFA,eAEEA,8BACFA,eADEA,kGAEFA,eAEEA,8BACFA,eADEA,sFCtBS21F,iBA6BXttF,cA5BA/H,gBAAY,EAEZA,gCAAuD,IAAI+I,KAAgB,GAC3E/I,oCAA2D,IAAI+I,KAAgB,GAC/E/I,iBAAwC,IAAI+I,IAAgB,IAC5D/I,aAAoC,IAAI+I,IAAgB,IACxD/I,oBAAyB,EAClBA,aAAU,IAAImZ,KAAoB,GAWhCnZ,wBAA6B,EAE7BA,qCAA0C,EAE1CA,0BAA+B,EAE/BA,0BAA+B,EAE9BA,qBAAkB,IAAIN,OAAsB,cAhB3CG,GACTG,KAAKkwF,QAAUrwF,EACfG,KAAKmI,oBAGL,OAAOnI,KAAKkwF,QAcd1vE,WACExgB,KAAKqxF,SAAWrxF,KAAKoa,QAClB7R,MAAK,QAAS,IACiB,IAAvBvI,KAAKqqD,OAAO9pD,OAAegoF,MAAQ,QAAM,MAEjDngF,UAAU,KACT,MAAMvI,EAASG,KAAKs1F,mBAAmBt1F,KAAKqqD,OAAOjnD,MAAM,IACzDpD,KAAK4yE,QAAQzqE,KAAKtI,GAClBG,KAAKu1F,2BAA2BptF,KAC9BnI,KAAKqqD,OAAOjnD,MAAM,GACfqD,OAAO3G,IAA6B,IAApBA,EAAMkvD,WACtBvoD,OAAO3G,GAASA,EAAMorD,SAASppD,OAAShC,EAAM8uD,sBAAsB9sD,OAAOvB,OAAS,GAEzFP,KAAKw1F,+BAA+BrtF,KAClCnI,KAAKqqD,OAAOjnD,MAAM,GACfqD,OAAO3G,IAA6B,IAApBA,EAAMkvD,WACtBvoD,OAAO3G,GAASA,EAAMorD,SAASppD,QAAUhC,EAAM8uD,sBAAsB9sD,OAAOvB,OAAS,GAG1FP,KAAKy1F,YAAYttF,KACfnI,KAAKqqD,OAAOjnD,MAAM,GAAGqD,OAAO3G,MAAmC,IAA1BA,EAAMwwD,iBAA+BtwD,KAAKgyF,mBAAsBlyF,EAAMkvD,eAKnH72C,cACEnY,KAAKqxF,SAAS3oF,cAERP,OACNnI,KAAKoa,QAAQjS,OAEPmtF,mBAAmBz1F,GACzB,IAAIC,EAAcD,EAAO4G,OAAQrG,GAAiBA,EAAMwmB,SAAWxmB,EAAMiwD,sBACzE,OAAIrwD,KAAK01F,sBACP51F,EAAcD,GAETG,KAAKizF,mBAAmBnzF,GAEzBmzF,mBAAmBpzF,GACzB,OAAOA,EAAOob,KAAK,CAACnb,EAAQM,IAAWA,EAAO2uD,OAASjvD,EAAOivD,QAGhE4mC,qBAAqB91F,GACjBG,KAAK01F,oBAAsB71F,EAC3BG,KAAKmI,OACLnI,KAAK41F,gBAAgB19E,KAAKrY,iDA3EnBkB,8BAAwBugB,o6BDVrC5hB,iBACEA,sDAQAA,iDACAA,sBACEA,iDAMFA,QACAA,2EAIAA,6EAIAA,6EAIAA,6EAKFA,eA7BGA,8EAGaA,+EACJA,gCAAoB,gBACeA,gDAQ1CA,2MAIAA,uMAIAA,qLAIAA,kiBCrBQqB,+CCXbrB,oBAOEA,6FACAA,sBACFA,gCAJEA,4DAAuD,sBCM5Cm2F,iBAeX9tF,cAXS/H,mBAAe,EASjBA,WAAgB,wBANrB,GAAKA,KAAKy8C,MAGV,OAAOz8C,KAAKy8C,MAAM7tC,QAOpB4R,WACExgB,KAAKywB,MAAQzwB,KAAKuxD,aAAe,UAAY,QAG/CukC,qBACM91F,KAAKuxD,cACPvxD,KAAKy8C,MAAMiX,oBAAoB1zD,KAAKy8C,MAAM7tC,QAAQ2iD,cAClDvxD,KAAKywB,MAAQ,UAEbzwB,KAAKy8C,MAAM+U,mBAAmBxxD,KAAKy8C,MAAM7tC,QAAQ2iD,cACjDvxD,KAAKywB,MAAQ,WAEfzwB,KAAKuxD,cAAgBvxD,KAAKuxD,2DA7BjBxwD,8BAA2BugB,8bDXxC5hB,gCAASA,oHCWIqB,MCQAg1F,iBAeXhuF,YAAoBlI,yBAbpBG,wBAA+C,IAAI+I,KAAgB,GAW1D/I,qCAA0C,EAInDwgB,WAEExgB,KAAK6wD,aADe7wD,KAAKy8C,MAAM/2C,IAAI2lD,eAAeyF,YAClB1oD,UAAU,KACxCpI,KAAK+uF,uBAEP/uF,KAAKgvF,YAAchvF,KAAKwtF,iBAExBxtF,KAAKivF,UAAYjvF,KAAK2+E,eAAevmE,eAAehQ,UAAWtI,IAC7DE,KAAK8X,MAAQhY,EACbE,KAAK+uF,uBAIT52E,cACEnY,KAAK6wD,aAAanoD,cAClB1I,KAAKivF,UAAUvmF,cAGjB8kF,iBACE,MAAM3tF,EAAeG,KAAKy8C,MAAM7tC,QAChC,IAAK/O,EAAaktB,QAChB,OAAO/sB,KAAKy8C,MAAMxtC,MAEpB,MAAMnP,EAAeD,EAAaktB,QAC5B3sB,EAAiBP,EAAsCwgE,SAC7D,OAAQxgE,EAAaktB,QAAQjoB,WACtB+4C,GAAYC,MACf,OAAO99C,KAAKy8C,MAAMxtC,WACf4uC,GAAYivC,SACf,OAAI1sF,GAAiBA,EAAck8C,SAC1Bl8C,EAAck8C,SAEdt8C,KAAKy8C,MAAMxtC,WAEjB4uC,GAAYkvC,OACf,OAAIjtF,GAAgBA,EAAawP,KACxBxP,EAAawP,KAEbtP,KAAKy8C,MAAMxtC,cAGpB,OAAOjP,KAAKy8C,MAAMxtC,OAIhB8/E,qBAEN/uF,KAAK0uF,mBAAmBvmF,KADEnI,KAAKy8C,MAAM4T,oEA/D5BtvD,GAAwBrB,oCAAxBqB,EAAwBugB,sXCnBrC5hB,2BACEA,gBAAyFA,SAAeA,QAC1GA,QAEAA,mBACEA,8BAIFA,eARsCA,2CAAqDA,8BAKvFA,gCAAe,8RDaNqB,MEqEAi1F,iBAAcjsF,iBAEvB,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,CAAC+0E,GAAc7U,GAAcgkB,mDAJjCptF,4DA/CF,CACPwzB,KACA1I,MACA7e,KACAqZ,MACA4vE,KACA/mE,KACAzvB,KACAuvB,KACAknE,MACA98D,MACAnK,KACAE,KACAgnE,MACAplE,KACA1B,KACA1iB,GACAs3B,GACAnS,GACAiI,GACAqK,GACAtT,GACAwD,OAyBSvzB,YAXTqtF,GAAkB,oDAElB7C,IAAoB,mBADpBwK,GAAwB,iBACxBxK,IAAoB,UACpB0E,GAAkB,WAClBoE,GAAsBllE,4BAJtBi/D,GAAkBvtD,+EAKlBw0D,GAAwB,8BAJxBU,GAAwBl1D,qBC7Bfu1D,2HAvBF,CACPppF,KACA+jB,KACA/B,KACAvvB,KACA0vB,KACAF,KACA6B,GACAnkB,GACAs3B,GACAnS,GACA6qB,GACAq5C,OAWSj1F,gCC1CHrB,yBAEEA,SACFA,kCAFEA,4BAAsC,WACtCA,2DASFA,yBAEEA,SACFA,kCAFEA,0BAAoC,WACpCA,yDAUFA,yBAGEA,iCAASI,sBACPJ,gBAAYA,SAAQA,QACxBA,kCAHEA,iBAEcA,yBDUtBgrF,GAAuB,cACvB+C,GACAhB,GAA4B5rD,sFCN9BnhC,gBACEA,gBAAiBA,SAAgJA,QACnKA,8BADmBA,4NAEnBA,gBACEA,gBAAiBA,SAAiGA,QACpHA,8BADmBA,uHC7BR22F,iBAaXtuF,YACUlI,EACDC,EACCM,EACDC,EAGAC,GANCN,mBACDA,uBACCA,qBACDA,iBAGAA,YAlBDA,6BAA0B,MAE3BA,6BAA0B,IAAI+I,IAA2B,IAEhE/I,wBAAgC,GAEhCA,YAAQ,EAcNA,KAAKoR,MAAQ9Q,EAAK8Q,MAClBpR,KAAKs2F,mBAAqBh2F,EAAKg2F,mBAC/Bt2F,KAAKqL,MAAQ/K,EAAK+K,MAClBrL,KAAKu2F,aAAej2F,EAAKi2F,aACzBv2F,KAAKu3B,KAAOv3B,KAAKooB,YAAYwP,MAAM,CACjChzB,GAAI,CAAC,GAAI,IACTqK,MAAO,CAAC,GAAI,IACZ4B,IAAK,CAAC,GAAI,CAACwV,iBACXvhB,KAAM,CAAC9E,KAAKw2F,wBAAyB,CAACnwE,mBAI1C7F,WACExgB,KAAKoR,MAAM0G,MAAM5B,QACjBlW,KAAKy2F,iBAAmB7wF,OAAOC,KAAKw3D,IAEpCr9D,KAAK02F,mBAAqB12F,KAAKu3B,KAC5B9tB,IAAI,QACJgf,aAAargB,UAAWvI,IACT,SAAVA,EACFG,KAAKu3B,KAAK9tB,IAAI,SAASuuB,cAAc3R,gBAErCrmB,KAAKu3B,KAAK9tB,IAAI,SAASuuB,cAAc,IAEvCh4B,KAAKu3B,KAAK9tB,IAAI,SAASktF,2BAG3B32F,KAAK42F,+BACL52F,KAAK62F,eAAiB72F,KAAKoR,MAAM6L,KAC9BtC,OACAvS,UAAU,IAAMpI,KAAK42F,gCAExB52F,KAAK82F,aAAe92F,KAAK6O,cAAcnE,UAAU,gBAGnDyN,cACEnY,KAAK02F,mBAAmBhuF,cACxB1I,KAAK62F,eAAenuF,cAGtBquF,iBAAiBl3F,GACfG,KAAKu3B,KAAKy/D,WAAWn3F,GACrBG,KAAKqL,OAAQ,EACbrL,KAAK42F,+BAGPA,+BACE52F,KAAKi3F,wBAAwB9uF,KAC3BnI,KAAKs2F,mBAAmB7vF,OAAQ5G,IAAOG,KAAKoR,MAAM3H,IAAI5J,EAAE+E,MAI5DsyF,WAAWr3F,GACTG,KAAKqL,OAAQ,EACbrL,KAAKm3F,UAAUxkE,MAAM9yB,GAGvB87B,SACE37B,KAAKqL,OAAQ,EACbrL,KAAKm3F,UAAUxkE,sDAjFN5xB,GAAyBrB,mDAmB1B8yB,MAAe,6BAnBdzxB,EAAyBugB,uhCDftC5hB,gBAA4CA,8BAAkDA,QAC9FA,iBACEA,kBACEA,iBACEA,0BACEA,wCACAA,gCAA2CA,0CAAkBI,qCAC3DJ,kDAIFA,QACFA,QACFA,QACAA,kBACEA,2BACEA,oBACAA,iCAA0CA,0CAAkBI,qCAC1DJ,kDAIFA,QACFA,QACFA,QACAA,kBACEA,2BACEA,0BAGEA,iCAMFA,QACFA,QACFA,QACFA,QACAA,2BAGAA,2BAGFA,QACAA,mBACEA,mBACEA,sBAGEA,gCAASI,aACTJ,gCACFA,QACAA,sBAMEA,gCAASI,6BACTJ,gCACFA,QACFA,QACFA,4CAjE4CA,+DAEnBA,mCAG0BA,oEAAiEA,2BAEhEA,iEASwBA,oCAExBA,iEAavBA,6CASpBA,+DAGAA,gEAUHA,sEAOAA,yCAEAA,woBC/COqB,+CCbTrB,sCAKEA,gGAA0C,mFAE5CA,8CAJEA,mBAAW,uDAQjBA,iBACEA,oBAKEA,2FACAA,8BACAA,sBACFA,QACFA,cAPIA,yEAIAA,yECYS03F,iBAuCXrvF,YACUlI,EACAC,EACAM,EACAC,EACAC,GAJAN,2BACAA,sBACAA,uBACAA,sBACAA,cA9BDA,wBAA6B,EAK7BA,wBAAgC,GAK/BA,yBAAsB,IAAIN,MAKpCM,qBAAiB,sBAIf,OAAQA,KAAKswE,eAAe7mE,IAAI,kBAAoB,qBAEpC5J,GAChBG,KAAKswE,eAAe76D,IAAI,gBAAiB5V,GAc3C2gB,WACExgB,KAAKoR,MAAM0G,MAAM5B,QAEjBlW,KAAKs2F,mBAAqBt2F,KAAKs2F,mBAAmB5wF,IAAI7F,IACpDA,EAAE+E,GAAK21C,cACJ16C,EAAEiF,MAAQ,OAASk6C,GAAen/C,EAAEgR,MAEvChR,EAAEoP,MAAoB,KAAZpP,EAAEoP,OAAiBpP,EAAEoP,MAAgBpP,EAAEoP,MAAVpP,EAAEgR,IAClChR,IAIXw3F,cACE,OAAOr3F,KAAKoR,MAAM6L,KAAKtC,OAQzB28E,gBAAgBz3F,GACdG,KAAKoR,MAAM0G,MAAM4B,OACf7Z,EACA,CACEwgB,UAAU,EACV2hB,SAAS,IAEX,GAEFhiC,KAAKu3F,oBAAoBr/E,KAAK,CAAEmI,UAAU,EAAMgrB,YAG1CmsD,2BACFx3F,KAAKy3F,iBACPz3F,KAAKy3F,gBAAgB/uF,cAIzBwuF,WAAWr3F,GACT,IAAKA,EACH,OAEF,IAAIC,EAAKy6C,aACP16C,EAAaiF,KAAOk6C,GAAen/C,EAAagR,MAElD,MAAMzQ,EAAoBJ,KAAKs2F,mBAAmBz7E,KAC/Cxa,GAAMA,EAAEuE,KAAO/E,EAAa+E,IAS/B,GANIxE,IACFP,EAAayL,QAAUlL,EAAkBkL,QACzCzL,EAAa+oF,iBAAmBxoF,EAAkBwoF,iBAClD9oF,EAAKM,EAAkBwE,IAGrB5E,KAAKoR,MAAM3H,IAAI3J,GAAnB,CACE,MAAMO,EAAQL,KAAK+P,gBAAgB/B,UAAUgC,QAC3C,wCAEI1P,EAAUN,KAAK+P,gBAAgB/B,UAAUgC,QAC7C,0CAEFhQ,KAAK+Q,eAAelB,MAAMvP,EAASD,QAGrCL,KAAKw3F,2BAELx3F,KAAKy3F,gBAAkBz3F,KAAKsjE,oBAC3B3F,gBAAgB99D,EAAaiF,KAAajF,EAAagR,IAAKhR,EAAayL,SACvE/C,MACC,OAAYlI,IACV,MAAMC,EAAQN,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,oCACrD,GAAI3P,EAAEgL,MACJ,YAAKqsF,kBAAiB,EAAM73F,GAC5BQ,EAAEgL,MAAM0D,QAAS,EACV1O,EAET,MAAMG,EAAUR,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,8BAA+B,CAAElO,MAAOjC,EAAagR,MAC5G,WAAKE,eAAe1F,MAAM7K,EAASF,GAC7BD,KAGT+H,UAAW/H,IACV,IAAIC,EACAE,EACJ,OAAQX,EAAaiF,UACd,MACHxE,EAAQT,EAAaoP,OAAS5O,EAAa0oF,QAAQ7oB,MACnD1/D,EAAUX,EAAayL,SAAWjL,EAAaiL,QAC/C,UACG,iBACA,sBACA,iBACHhL,EAAQT,EAAaoP,OAAS5O,EAAas3F,QAC3C,UACG,OACHr3F,EACET,EAAaoP,OACb5O,EAAakqF,sBAAsBqN,YACrC,cAEAt3F,EAAQT,EAAaoP,MAGzB,MAAMvL,EAAe6C,kBACnBX,OAAOU,OAAO,GACZlG,EACAmG,kBAA4B,CAC1B3B,KACAqK,QACA4B,IAAKhR,EAAagR,IAClB/L,KAAMjF,EAAaiF,MAAQ,MAC3B8jF,iBAAkB/oF,EAAa+oF,mBAAoB,EACnD6K,WAAW,EACXnoF,cAENtL,KAAKoR,MAAMqM,OAAO/Z,GAClB,MAAME,EAAc5D,KAAK63F,cAAcz0F,MAAM,GAC7CQ,EAAYhD,KAAK8C,GACjB1D,KAAK63F,cAAgBj0F,EACrB5D,KAAKw3F,6BAIXr/E,cACEnY,KAAKw3F,2BAGPM,gBAAgBj4F,GACdG,KAAKoR,MAAMzH,OAAO9J,GAClBG,KAAK63F,cAAgB73F,KAAK63F,cACvBz0F,MAAM,GACNqD,OAAQ3G,GAAMA,EAAE8E,KAAO/E,EAAQ+E,IAGpC8yF,iBAAiB73F,EAAQC,GACLE,KAAKkyB,OAAOD,KAAKokE,GAA2B,CAC5D5+B,MAAO,QACPluC,KAAM,CACJ+sE,mBAAoBt2F,KAAKs2F,mBACzBllF,MAAOpR,KAAKoR,MACZ/F,QACAkrF,kBAIMjkE,cAAclqB,UAAW/H,IACjCL,KAAKk3F,WAAW72F,mDAtMTU,GAAsBrB,+EAAtBqB,EAAsBugB,oiBDhCnC5hB,sBACEA,iDAUFA,QAEAA,+BAbUA,uBACuBA,qDAY3BA,yMCmBOqB,6BC5BXrB,sBAOEA,iCAASI,2CAEXJ,cAJEA,mHAMFA,oBAOAA,qGACAA,sBACFA,aAJEA,uFAMFA,oBAKEA,sBACFA,aCjBaq4F,iBANbhwF,cAkBY/H,mBAAgB,IAAIN,kBAKR,OAAO6gB,GAAevgB,KAAKqrC,SAEjD2sD,yBAAyBn4F,GACvBA,EAAM4hB,kBACNzhB,KAAKi4F,cAAc//E,qDArBVnX,8BAA0BugB,q5BDfvC5hB,yBACEA,gBACEA,SACFA,QACAA,6BAWAA,2BAWFA,2BAOAA,eA/BIA,gCAICA,kDAUFA,2CAYAA,0OCbUqB,MCsCAm3F,2HA1BF,CACPlrF,KACAvN,KACAsxB,KACA5B,KACAF,KACAgV,GACAt3B,GACAqiB,KACAnD,MACAxF,MACAkO,KACA6E,MACAa,MACAzH,UAYSzxB,YALTq2F,GAAsB,SACtBW,GAA0Bl3D,yCCpBjBs3D,2HAhBF,CACPnrF,KACA+jB,KACAtxB,KACA0vB,KACAF,KACA6B,GACAmT,GACAnS,IAGAskE,GACA8B,MAISn3F,MCnBAq3F,iBACXrzE,UAAUllB,EAAgBC,GACxB,IAAIM,EAEJ,MAAY,SAARN,IACFM,EAASP,EAAM4G,OAAQpG,IACrB,MAAMC,EAAaD,EAAMqmB,WACzB,OACE1mB,KAAKq4F,iBAAiB/3F,SACY,IAAlCA,EAAWsO,QAAQi6C,YACnBjjD,OAAOC,KAAKvF,EAAWsO,QAAQi6C,YAAYtoD,UAIrC,QAART,IACFM,EAASP,EAAM4G,OAAQpG,GAEdL,KAAKs4F,gBADOj4F,EAAMqmB,cAItBtmB,EAGDi4F,iBAAiBx4F,GACvB,MAAgC,QAA5BA,EAAW+O,QAAQ9J,MAGhBjF,EAAW+O,QAAQg6C,eAGpB0vC,gBAAgBz4F,GACtB,IAAIC,GAAkB,EACtB,OACED,EAAW+O,QAAQ+2C,YACnB9lD,EAAW+O,QAAQ+2C,WAAWvnB,SAC9Bv+B,EAAW+O,QAAQ+2C,WAAW7E,WAE9BhhD,GAAkB,GAGlBD,EAAW+O,QAAQ+2C,YACnB9lD,EAAW+O,QAAQ+2C,WAAWvnB,UAE5Bv+B,EAAW+O,QAAQ+2C,WAAW1E,aAC9BphD,EAAW+O,QAAQ+2C,WAAWzE,YAC9BrhD,EAAW+O,QAAQ+2C,WAAWxE,cAC9BthD,EAAW+O,QAAQ+2C,WAAW9iD,QAC9BhD,EAAW+O,QAAQ+2C,WAAWvE,gBAC9BthD,GAAkB,GAEfA,gDAlDEiB,2DAAwBwkB,UAAxBxkB,MCJAw3F,iBACXxwF,eAEAywF,aACE34F,EACAC,GAEA,IAAIM,EACAC,EACAC,EACAE,EAEJ,GAAI2D,MAAM4B,QAAQjG,GAAO,CACvB,MAAM8D,EAAQ,GACV9D,EAAK,KACPQ,EAAmBN,KAAKy4F,iBAAiB34F,EAAK,IAC9C8D,EAAMhD,KAAKd,EAAK,KAEdA,EAAK,KACPU,EAAiBR,KAAKy4F,iBAAiB34F,EAAK,IAC5C8D,EAAMhD,KAAKd,EAAK,KAEG,IAAjB8D,EAAMrD,QAAgBD,IAAqBE,IAE3CJ,EADEP,aAAsBmkE,GACjB1jE,EAAmB,IAAME,EAEzBF,EAAmB,IAAME,GAGhCF,IAAqBE,IACvBJ,EAAOE,QAEAR,IACTO,EAAcL,KAAKy4F,iBAAiB34F,GACpCM,EAAOC,GAITR,EAAWk9C,GAAGmM,aADC,CAAEuC,KAAMrrD,IAEnBP,aAAsB2rD,IACF3rD,EACRipD,cADQjpD,EACoBgpD,YAAY,GAI1D6vC,aACE74F,EACAC,GAEA,IAAIM,EACAC,EACAC,EAEJ,GAAI6D,MAAM4B,QAAQjG,GAAO,CACvB,MAAM4D,EAAQ,GACV5D,EAAK,KACPO,EAAmBP,EAAK,GACxB4D,EAAM9C,KAAKd,EAAK,KAEdA,EAAK,KACPQ,EAAiBR,EAAK,GACtB4D,EAAM9C,KAAKd,EAAK,KAEG,IAAjB4D,EAAMnD,QAAgBF,IAAqBC,IAE3CF,EADEP,aAAsBmkE,GACjB3jE,EAAmB,IAAMC,EAEzBD,EAAmB,IAAMC,GAGhCD,IAAqBC,IACvBF,EAAOC,QAGTD,EAAON,EAITD,EAAWk9C,GAAGmM,aADC,CAAEuC,KAAMrrD,IAEnBP,aAAsB2rD,IACF3rD,EACRipD,cADQjpD,EACoBgpD,YAAY,GAIlD4vC,iBAAiB54F,GACvB,MAAMC,EAAOD,EAAM84F,cACnB,IAAIv4F,EAAQP,EAAM+4F,WAAa,EAC3Bv4F,EAAMR,EAAMg5F,aACZv4F,EAAOT,EAAMi5F,cACbt4F,EAASX,EAAMk5F,gBAEnB,OAAI9tE,OAAO7qB,GAAS,KAClBA,EAAQ,IAAMA,GAGZ6qB,OAAO5qB,GAAO,KAChBA,EAAM,IAAMA,GAGV4qB,OAAO3qB,GAAQ,KACjBA,EAAO,IAAMA,GAGX2qB,OAAOzqB,GAAU,KACnBA,EAAS,IAAMA,GAGVV,EAAO,IAAMM,EAAQ,IAAMC,EAAM,IAAMC,EAAO,IAAME,EAAS,qDA5G3DO,gCAAiBsI,QAAjBtI,EAAiB,YAAjBA,MCGAi4F,iBACXjxF,eAEOkxF,YAAYp5F,EAA8BC,GAC/C,MAAMM,OAAoBumD,IAAkBb,yBAAyBhmD,EAAcD,EAAc+O,QAAQo9B,OAAOsR,QAChHz9C,EAAck9C,GAAGmM,aAAa,CAAER,OAAQtoD,IAGnC84F,wBAAwBr5F,GAC7B,MAAMC,EAAeD,EAAc+O,QAC7BxO,EAAkB,IAAIumD,GAExB7mD,EAAQ6lD,WAAWvnB,SAAWt+B,EAAQ6lD,WAAWzlC,UACnDpgB,EAAQ6lD,WAAWzlC,QAAU9f,EAAgBohD,0BAC3C1hD,EAAQ6lD,WAAWzlC,QACnBpgB,EAAQ2mD,UAAUY,kBAClB,IAAIsM,KAAa,CAAEhpB,KAAM7qC,EAAQ2mD,UAAU/E,WAC3C,GAEG5hD,EAAQ6lD,WAAWwzC,sBACtBr5F,EAAQ6lD,WAAWwzC,oBAAsB/4F,EAAgB8jD,8BACvDpkD,EAAQ6lD,WAAWzlC,QACnBpgB,EAAQ2mD,UAAUY,qBAMnB+xC,wBAAwBv5F,GAC7B,MAAMC,EAAeD,EAAc+O,QAC7BxO,EAAkB,IAAIumD,GAExB7mD,EAAQ6lD,WAAWvnB,SAAWt+B,EAAQ6lD,WAAWzlC,SACnDpgB,EAAQ6lD,WAAWzlC,QAAU9f,EAAgBohD,0BAC3C1hD,EAAQ6lD,WAAWzlC,QACnBpgB,EAAQunD,uBACR,GACA,GAEGvnD,EAAQ6lD,WAAWwzC,sBACtBr5F,EAAQ6lD,WAAWwzC,oBAAsB/4F,EAAgB8jD,8BAEvDpkD,EAAQ6lD,WAAWzlC,QACnBpgB,EAAQunD,oBAGZrnD,KAAKi5F,YACHp5F,EACAO,EAAgBihD,YAAYvhD,EAAQ6lD,WAAWzlC,aAC/C,OACA,OACA,EACArgB,EAAc+O,UAGhB9O,EAAQu5F,UAAW,IAEnBv5F,EAAQ6lD,WAAWzlC,aAAU,EAC7BpgB,EAAQ6lD,WAAWwzC,oBAAsB,GACzCr5F,EAAQu5F,UAAW,iDA3DZt4F,gCAAgBsI,QAAhBtI,EAAgB,YAAhBA,UCEDu4F,SAAZ,OAAYv4F,UAAiB,KACzBw4F,wBACAx4F,oBACAA,gBAHQu4F,GAAZ,IAAYv4F,MAMAy4F,SAAZ,OAAYz4F,UAAqB,KAC7B04F,kBACA14F,wBAFQy4F,GAAZ,IAAYz4F,UCAC24F,iBAoBX3xF,YACUlI,EACAC,EACAM,GAFAJ,YACAA,uBACAA,qBAtBHA,aAAkB,8CAKlBA,mBAAgB,CACrB25F,UAAW,WACXC,OAAQ,kBACRC,QAAS,WACTC,SAAU,YACVC,OAAQ,UACRC,IAAK,MACLC,IAAK,gBACLC,QAAS,WACTC,OAAQ,cACRC,MAAO,QACPC,OAAQ,UAQRr6F,KAAKs6F,QACHt6F,KAAK6O,cAAcnE,UAAU,sBAAwB1K,KAAKs6F,QAG9DC,cAAc16F,EAAQC,GACpB,OAAO8F,OAAOC,KAAKhG,GAAQgb,KAAKza,GAAOP,EAAOO,KAASN,GAMzD06F,eAAe36F,GAEb,GADgBA,EAEd,OAAOG,KAAKkM,KACTzC,IACCzJ,KAAKs6F,QAAUt6F,KAAKy6F,cAJV56F,IAMX0I,QACCsmD,KAAIzuD,GACFA,EAAkBukF,SAASj/E,IAAIrF,IAC7BA,EAAEwY,KAAO,CACPjU,GAAIvE,EAAE8mB,WAAWwjB,MAEZtqC,MAUnBq6F,oBACE,MACM56F,EAAiC,GACvC,OAAOE,KAAKkM,KAAKzC,IAAIzJ,KAAKs6F,QAFd,SAE6B/xF,MACvC,OAAKnI,IACHA,EAAM0F,QAAQzF,IACZ,GAAIA,EAAKgkE,WAAW,SAAU,CAC5B,MAAM/jE,EAA8B,CAClC4Q,UAAM,EACNoL,OAAQjc,GAEV,IAAIG,EAASH,EAAKuH,UAAU,EAAGvH,EAAKE,QAChCmD,EAAOlD,EACX,GAAIA,EAAOiT,SAAS,KAAM,CACxB,MAAM7P,EAAQpD,EAAON,QAAQ,KAC7BwD,EAAOlD,EAAOoH,UAAUhE,EAAQ,EAAGpD,EAAOD,QAC1CC,EAASA,EAAOoH,UAAU,EAAGhE,GAE/B,IACEtD,EAAK4Q,KAAOlR,KAAK+P,gBAAgB/B,UAAUgC,QACzC,mBAAqBtM,SAEhBE,GACPtD,EAAK4Q,KAAOxN,EAAKkE,UAAU,EAAG,GAAGf,cAAgBnD,EAAKkE,UAAU,EAAGlE,EAAKnD,OAAS,GAGnF,IACED,EAAKs3B,MAAQ53B,KAAK+P,gBAAgB/B,UAAUgC,QAC1C,+BAAiCxP,SAE5BoD,GACPtD,EAAKs3B,MAAQp3B,EAAOoH,UAAU,EAAG,GAAGf,cAAgBrG,EAAOoH,UAAU,EAAGlE,EAAKnD,OAAS,GAGxFT,EAAMc,KAAKN,WAEPN,KAAKu6F,cAAcv6F,KAAKy6F,cAAep6F,GAAO,CAChD,MAAMC,EAA8B,CAClC4Q,UAAM,EACNoL,OAAQjc,GAEJG,EAAOR,KAAKu6F,cAAcv6F,KAAKy6F,cAAep6F,GACpD,IACEC,EAAK4Q,KAAOlR,KAAK+P,gBAAgB/B,UAAUgC,QACzC,mBAAqBxP,SAEhBkD,GACPpD,EAAK4Q,KAAO1Q,EAAKoH,UAAU,EAAG,GAAGf,cAAgBrG,EAAKoH,UAAU,EAAGpH,EAAKD,OAAS,GAEnFD,EAAKgc,OAASjc,EAEdP,EAAMc,KAAKN,MAIVR,KAQb66F,eACE96F,EACAC,EACAM,EACAC,EACAC,GAEA,GAAIF,EAAM,CAER,MACMsD,EAAM1D,KAAKs6F,QAAUt6F,KAAKy6F,cADhBr6F,GAEhB,IAAIwD,EAAU,GACd,OAAI9D,IAAa05F,GAAsBC,SACrC71F,EAAU,WACH5D,KAAKkM,KACTzC,IACC/F,EAAM,IAAM7D,EAAQsnB,WAAWwjB,KAAO,IAAM/mC,EAC5C,CACEooC,OAAQ,CACNiZ,SAAU,OACVhsC,KAAM,OACN2hF,YAAat6F,EAAO2C,WACpB43F,WAAY,SAIjBtyF,QACCsmD,KAAIhrD,GACFA,EAAkB8gF,SAASj/E,IAAI3B,IAC7BA,EAAE8U,KAAO,CACPjU,GAAIb,EAAEojB,WAAWwjB,KACjB17B,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QACpC,iCAEFiJ,KAAOlV,EAAUkV,MAEZlV,QAMfH,EAAUvD,EAASic,OACZtc,KAAKkM,KACTzC,IACC/F,EAAM,IAAM7D,EAAQsnB,WAAWwjB,KAAO,IAAM/mC,EAC5C,CACEooC,OAAQ,CACNiZ,SAAU,OACVhsC,KAAM,OACN2hF,YAAat6F,EAAO2C,WACpB43F,WAAY,SAIjBtyF,QACCsmD,KAAIhrD,GACFA,EAAkB8gF,SAASj/E,IAAI3B,IAC7BA,EAAE8U,KAAO,CACPjU,GAAIb,EAAEojB,WAAWwjB,KACjB17B,MAAO5O,EAAS6Q,KAChB+H,KAAOlV,EAAUkV,MAEZlV,OAKZ,CAEL,MAAMvD,EAAMR,KAAKs6F,QAAU,SAC3B,OAAIx6F,IAAa05F,GAAsBC,QAE9Bz5F,KAAKkM,KACTklC,KAA8B5wC,EAFjB,iBAEgC,CAC5CykD,SAAU,OACVhsC,KAAM,OACN6hF,IAAK71F,KAAKE,UAAUtF,GACpB+6F,YAAat6F,EAAO2C,WACpB43F,WAAY,QAEbtyF,QACCsmD,KAAIjrD,GACFA,EAAkB+gF,SAASj/E,IAAI7B,IAC7BA,EAAEgV,KAAO,CACPjU,GAAIf,EAAEsjB,WAAWwjB,KACjB17B,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QACpC,iCAEFiJ,KAAOpV,EAAUoV,MAEZpV,MAOR7D,KAAKkM,KACTklC,KAA8B5wC,EAFjB,SAAWH,EAASic,OAEY,CAC5C2oC,SAAU,OACVhsC,KAAM,OACN6hF,IAAK71F,KAAKE,UAAUtF,GACpB+6F,YAAat6F,EAAO2C,WACpB43F,WAAY,QAEbtyF,QACCsmD,KAAIjrD,GACFA,EAAkB+gF,SAASj/E,IAAI7B,IAC7BA,EAAEgV,KAAO,CACPjU,GAAIf,EAAEsjB,WAAWwjB,KACjB17B,MAAO5O,EAAS6Q,KAChB+H,KAAOpV,EAAUoV,MAEZpV,OAWrBk3F,aACEl7F,EACAC,GAEA,MAAMM,EAAcJ,KAAKy6F,cAAc36F,GACjCO,EAAc,IAAMR,EAAQsnB,WAAWwjB,KAC7C,GAAIvqC,GAAeC,EACjB,OAAOL,KAAKkM,KACTzC,IAAazJ,KAAKs6F,QAAUl6F,EAAcC,EAAa,CACtD2rC,OAAQ,CACNiZ,SAAU,UAGb18C,MACC,OAAIjI,IACFA,EAAEuY,KAAO,CACPjU,GAAItE,EAAE6mB,WAAWwjB,KACjBC,MAAOtqC,EAAE6mB,WAAWu/D,IACpBz3E,MAAO3O,EAAE6mB,WAAWu/D,KAEfpmF,KASjB06F,mBACEn7F,EACAC,EACAM,EACAC,GAEA,GAAIP,IAAew5F,GAAkBC,WAyBnC,OAAOv5F,KAAKkM,KACTklC,KAAcpxC,KAAKs6F,QAAU,qBAAsB,CAClD7qB,SACAqrB,IAAK71F,KAAKE,UAAUtF,KAErB0I,MACC,OAAIjI,GACKA,IAhCkC,CAC/C,MAAMA,EAAcN,KAAKy6F,cAAcp6F,GACjCG,EAAc,IAAMX,EAAQsnB,WAAWwjB,KAC7C,GAAIrqC,GAAeE,EACjB,OAAOR,KAAKkM,KACTzC,IAAazJ,KAAKs6F,QAAUh6F,EAAcE,EACzC,CACEwrC,OAAQ,CACNiZ,SAAU,MACVg2C,aAAc76F,EAAO6C,cAI1BsF,MACC,OAAI7E,IACFA,EAAEmV,KAAO,CACPjU,GAAIlB,EAAEyjB,WAAWwjB,KACjBC,MAAOlnC,EAAEyjB,WAAWu/D,IACpBz3E,MAAOvL,EAAEyjB,WAAWu/D,KAEfhjF,oDA9SR3C,GAAoBrB,2DAApBqB,EAAoBsI,QAApBtI,EAAoB,qBAFnB,SAEDA,MCFAm6F,iBAEXnzF,YACUlI,EACAC,GADAE,sBACAA,uBAGViyB,KAAKpyB,GACH,MAAMC,EAAYE,KAAK+P,gBAAgB/B,UACjC5N,EAAQN,EAAUkQ,QAAQ,0BAChChQ,KAAK+Q,eAAevB,QAClB1P,EAAUkQ,QAAQ,0BAClB5P,GAGF,MAAMC,EAA+BR,EAAM6mB,WAAW9X,QACtD,GAAIhJ,OAAOC,KAAKxF,EAAUwmD,UAAUtmD,OAAS,EAC3C,GACEF,EAAUwmD,SAASC,iBACQ,IAA3BzmD,EAAUwmD,SAASh2C,IACnB,CACA,IAAIvQ,EACAE,EAAc,IAAImzD,KAAa,CAAEhpB,KAAM9qC,EAAM6F,IAAI+jD,aACrD,MAAM/lD,EAAa7D,EAAM6mB,WAAW9X,QAAgB63C,UAChD/iD,GAAakC,OAAOC,KAAKnC,GAAWnD,OAAS,GAE/CC,EAAckD,EAAUg+C,QAAU,IAAIiS,KAAa,CAAEhpB,KAAMjnC,EAAUg+C,UAAalhD,EAClFF,EAAcT,EAAM6mB,WAAW9X,QAAgB63C,WAE/CnmD,EAAcT,EAAM6mB,WAAW9X,QAAgBo9B,OAGjD,MAAMpoC,EAAgBiqD,MACpBhuD,EAAM6F,IAAI2lD,eAAewK,YACzB,IAAIlC,KAAa,CAAEhpB,KAAM9qC,EAAM6F,IAAI+jD,aACnCjpD,GAEIqD,OACgC,IAApCvD,EAAW66F,0BACqB,IAA5B76F,EAAWuhD,aAA6B,GAAK,gBAAkBvhD,EAAWuhD,aAC1E,gBAAkBvhD,EAAW66F,qBAE7Bp3F,EAAU1D,EAAUwmD,SAASC,WAChC3gD,QAAQ,yBAA0B,IAClCA,QAAQ,mBAAoB,IAC5BA,QAAQ,iBAAkB,IAEvBnC,EAAcnE,EAAM6mB,WAAW9X,QAA2C+2C,WAEhF,IAAIhhD,EACJA,OAAwBgiD,IACvBjB,6BACC7lD,EAAM6mB,WAAW9X,QACjB5K,EAAW+8C,aACXn9C,EACApD,GAUAmE,EATGA,EASiB,UAAYmyD,mBAAmBnyD,QAPzBgiD,IAAkBtF,iBAC1C,EACAz9C,EACApD,EACAwD,EAAW+8C,cAKf7/C,OAAO+wB,KACL,GAAGluB,KAAWY,KAAqBd,IACnC,eAEOxD,EAAUwmD,UACnB3lD,OAAO+wB,KAAK5xB,EAAUwmD,SAASh2C,IAAK,wDAxE/B9P,GAAerB,gDAAfqB,EAAesI,QAAftI,EAAe,qBAFd,SAEDA,+CCfbrB,oBAOEA,wGACAA,sBACFA,gCAJEA,yDAAoD,sBCQzC07F,iBAmBXrzF,YAAoBlI,0BAFZG,YAAS,sBAdf,OAAOA,KAAKo8C,iBAEJv8C,GACRG,KAAKo8C,OAASv8C,cAMd,OAAOG,KAAK8gC,iBAEJjhC,GACRG,KAAK8gC,OAASjhC,EAMhBw7F,aAAax7F,GACXG,KAAKs7F,gBAAgBrpE,KAAKpyB,iBAI1B,GAAKG,KAAKy8C,MAGV,OAAOz8C,KAAKy8C,MAAM/1B,WAAW9X,sDA7BpB7N,GAAuBrB,oCAAvBqB,EAAuBugB,uXDbpC5hB,gCACGA,oLCYUqB,MCSAw6F,iBAAiBxxF,iBAE1B,MAAO,CACLC,SAAUjJ,iDAHHA,4DAVF,CACPiM,KACAvN,KACAuvB,KACAC,KACAtiB,OAKS5L,gCClBPrB,cACEA,sBACFA,+BAD4BA,4DAG5BA,cACEA,eAAwEA,8BAAmDA,QAC7HA,mDADKA,qCAAqEA,iGAG1EA,gBACEA,SACFA,wCADEA,wDAGFA,gDAA8IA,sIAG9IA,cACEA,gBAAsDA,qGAAwCA,SAAyCA,QACzIA,qDADKA,sCAA2FA,yFAGhGA,cACEA,gBAAsDA,qGAAwCA,8BAAyCA,QACzIA,cADKA,sCAA2FA,6FAGhGA,cACEA,gBAA6CA,qGAC3CA,0DACFA,QACFA,0CAHKA,qCACIA,qFAITA,iEAAgFA,uEA/BlFA,cAEEA,uBAIAA,uBAIAA,uBAIAA,uBAGAA,uBAIAA,uBAIAA,uBAMAA,uBAGFA,6CAhCOA,6EAIAA,6EAIcA,4DAIdA,iIAGAA,uFAIAA,2IAIAA,sHAMAA,4GAjCXA,mBACEA,iBACEA,2CAmCFA,QACFA,8BApC6BA,oGAsC7BA,0CAAgCA,4DAA4C,2DCR/D87F,iBAkDXzzF,YACUlI,EACAC,EACAM,EACAC,EACAC,EACAE,EACAkD,GANA1D,YACAA,aACAA,iBACAA,sBACAA,sBACAA,uBACAA,qBAvDFA,kBAAe,IAAIgI,KAC3BhI,YAAQ,EA4BEA,gBAAa,IAAIN,MACjBM,mBAAgB,IAAIN,MACpBM,sBAAmB,IAAIN,MA0B/BM,KAAK2+E,eAAevmE,eAAe7P,MAAK,QAAUvI,KAAKy7F,eAAerzF,UAAWxE,IAC/E5D,KAAK8X,MAAQlU,iBArDf,OAAO5D,KAAK07F,mBAEH77F,GACTG,KAAK07F,QAAU77F,EACfG,KAAKkf,MAAMD,8BASX,OAAOjf,KAAK27F,qBAEF97F,GACVG,KAAK27F,SAAW97F,EAChBG,KAAKkf,MAAMD,gBACXjf,KAAK47F,cAAc1jF,mBAcnB,OAAOqI,GAAevgB,KAAKq+C,oBAO3B,OAAO+lB,GAAcpkE,KAAKq+C,UAAY,OAkBxC79B,WACExgB,KAAK67F,OAAQ,EAGf1jF,cACEnY,KAAKy7F,aAAatzF,OAClBnI,KAAKy7F,aAAan2E,WAGpBw2E,aAAaj8F,GACX,OAAOG,KAAK+7F,UAAUlqF,+BAA+BhS,GAIvDm8F,gBACE,OAAIh8F,KAAKq+C,SAAWr+C,KAAKwG,SAASxG,KAAKq+C,QAAQl3B,aAAkD,WAAnCnnB,KAAKq+C,QAAQl3B,WAAWC,QACpFpnB,KAAKi8F,iBAAiB/jF,MAAK,IACpB,IAEPlY,KAAKi8F,iBAAiB/jF,MAAK,IACpB,GAIXgkF,cAAcr8F,GACZ,GAAKA,EAAMkC,MAAuC,sBAA/Bf,mBAAnB,CAIA,IADkB,2BACHkkB,KAAKrlB,EAAMkC,MAAO,CAC/B,MAAM3B,EAAM,IAAIu3E,IAAI93E,EAAMgR,IAAK3P,OAAOqS,SAAS2rC,QAC/Cr/C,EAAMkC,KAAOlC,EAAMkC,KAAKoE,QAAQ,SAAU,qBAAqB/F,EAAI8+C,YAGrE,OAAOl/C,KAAK+7F,UAAUl2E,wBAAwBhmB,EAAMkC,OAGtDyE,SAAS3G,GACP,MAAwB,iBAAVA,EAGhBs8F,cAAct8F,SACZ,IAAIO,EACJ,MAAMC,EAAa,IAAI4kB,QAAyB,QAAlBnlB,OAAK+O,qBAAa,eAAEnE,UAAU,cAAe,cAGvErK,EAAW6kB,KAAKrlB,IAClBO,EAAMP,EAAMwO,MAAMhO,GAAY,GAE9BL,KAAKkM,KAAKzC,IAAIrJ,EAAK,CACjB+kB,aAAc,SAEf/c,UAAW5H,IACV,MAAMkD,EAAUi0E,IAAIC,gBAAgBp3E,GACpCU,OAAO+wB,KAAKvuB,EAAS,UACrB1D,KAAKkf,MAAMD,iBAEZze,IACC,MAAMkD,EAAY1D,KAAK+P,gBAAgB/B,UACjCpK,EAAQF,EAAUsM,QAAQ,0CAC1BnM,EAAUH,EAAUsM,QAAQ,qCAClChQ,KAAK+Q,eAAe1F,MAAMxH,EAASD,OAGrCxD,EAAMP,EAAMwO,MApBG,yGAoBa,GAC5BnN,OAAO+wB,KAAK7xB,EAAK,WAIrB0qB,MAAMjrB,GACJ,GAAqB,iBAAVA,EAET,MADc,eACDqlB,KAAKrlB,GAItBu8F,MAAMv8F,GACJ,GAAqB,iBAAVA,EACT,QAAIG,KAAK8qB,MAAMjrB,IAEN,qBAAMqlB,KAAKrlB,EAAMkH,eAO9B8jB,MAAMhrB,GACJ,GAAoB,iBAATA,EACT,QAAIG,KAAK8qB,MAAMjrB,IAEN,mBAAMqlB,KAAKrlB,EAAMkH,eAO9Bs1F,eAAex8F,GACb,GAAqB,iBAAVA,EAET,MADc,MACDqlB,KAAKrlB,GAItBy8F,oBAAoBz8F,GAGlB,OADaA,EAAMwO,MADL,oBACkB,GAIlCkuF,wBAAwB18F,GACtB,MAAMC,EAAwBD,EAAQgZ,KAAOhZ,EAAQgZ,KAAK+xB,WAAQ,EAC5DxqC,EAAa,GACnB,IAAIC,EAYJ,OAVIL,KAAK0F,KACP1F,KAAK0F,IAAIywE,qBAAqB5tE,MAAK,QAAUvI,KAAKy7F,eAAerzF,UAAU9H,IACzED,EAAqBC,IAIrBT,EAAQsnB,YAActnB,EAAQsnB,WAAWq1E,OAASx8F,KAAK6/B,UAAY7/B,KAAK6/B,QAAQd,QAAQ,sBACnFl/B,EAAQsnB,WAAWq1E,MAGxB18F,GACF8F,OAAOC,KAAK/F,GAAuBgG,QAAQxF,IACzCF,EAAWN,EAAsBQ,IAAUT,EAAQsnB,WAAW7mB,KAEzDF,SACyB,IAAvBC,GACJA,EAaCR,EAAQgZ,MAAQhZ,EAAQgZ,KAAK2rD,yBAE/B3kE,EADwCgZ,KAAK2rD,wBACrB1+D,QAAQtF,WACvBX,EAAQsnB,WAAW3mB,KAKhCR,KAAS8X,MAAML,YAAc5X,EAAQgZ,MAAQhZ,EAAQgZ,KAAK0rD,iBAExD1kE,EADiCgZ,KAAK0rD,iBACrBz+D,QAAQtF,WAChBX,EAAQsnB,WAAW3mB,MAElBR,KAAK8X,MAAML,YAAc5X,EAAQgZ,MAAQhZ,EAAQgZ,KAAK2rD,yBAEhE3kE,EADwCgZ,KAAK2rD,wBACrB1+D,QAAQtF,WACvBX,EAAQsnB,WAAW3mB,KAIzBX,EAAQsnB,0DArONpmB,GAAuBrB,sGAAvBqB,EAAuBugB,wtBDhCpC5hB,0BAwCAA,kCAxC2CA,2GAwClCA,4YCRIqB,UChCD07F,SAAZ,OAAY17F,UAAY,KACpB27F,cACA37F,0BACAA,oBACAA,kBAJQ07F,GAAZ,IAAY17F,MAOA47F,SAAZ,OAAY57F,UAAQ,KAChB67F,cACA77F,2BACAA,oBACAA,kBACAA,6BACAA,kBACAA,kCACAA,oBACAA,2CACAA,oBACAA,iCACAA,kCACAA,8BAbQ47F,GAAZ,IAAY57F,kBCgB+BA,GACzC,OACO,IAAI66D,KAAe,CACxBJ,OAAQ,IAAIC,KAAe,CACzBhrC,OAHJ1vB,EAAQA,GAAS,CAAC,EAAG,IAAK,MAGTiF,OAAO,CAAC,IACrByxD,MAAO,IAET6C,KAAO,IAAIC,KAAa,CACtB9pC,MAAO1vB,EAAMiF,OAAO,CAAC,OAEvB+nD,OAAQ,kBASV,OAAO,IAAIqM,MAAc,CACvBoB,OAAQ,IAAIC,KAAe,CACzBhrC,MAAQ,CAAC,EAAG,IAAK,IAAK,GACtBgnC,MAAO,kBAgGX12D,GAEA,MAAMO,EAAaP,EAAQqmB,OAC3B,OAAI9lB,aAAsBgiF,MACjBhiF,EAAWylF,qBAAqB3jF,OAAM,GAAI,GAE5B9B,EACDylF,qBAAqB3jF,OAAM,GC9IXqJ,eC4FtC1E,YAAoBzG,kBA9DbtB,YAA8B,IAAIgI,KAKlChI,UAA4B,IAAIgI,KAKhChI,cAAyB,IAAIgI,KAK7BhI,aAA+B,IAAIgI,KAKnChI,aAAwB,IAAIgI,KAKzBhI,YAAuB,IAAIgI,KAKrChI,eAAsC,IAAI+I,KAAgB,GAiCxD/I,KAAK68F,eAAiBv7F,EAAQw7F,aAAex7F,EAAQw7F,aAAe98F,KAAK+8F,4BACzE/8F,KAAKg9F,eAAiBh9F,KAAK4O,QAAQquF,0BAbnC,YAAsB,IAAfj9F,KAAKwsE,MAAU0wB,2BAQtB,OAAOl9F,KAAK68F,eAAezxC,YAY7BqhB,SAASnrE,EAA0BzB,GACjC,IAAKyB,EAKH,OAJAtB,KAAKm9F,4BACLn9F,KAAKo9F,4BACLp9F,KAAKq9F,4BACLr9F,KAAKwsE,MAAQlrE,GAIftB,KAAKwsE,MAAQlrE,EACbtB,KAAKs9F,yBACLt9F,KAAKu9F,kBAAkB19F,GAMzBurD,YACE,OAAOprD,KAAKk9F,qBAOdM,gBAAgBl8F,GACdtB,KAAKg9F,eAAiB17F,EAMhBy7F,4BACN,OAAO,IAAIU,KAAc,CACvBnhF,OAAQtc,KAAK4O,QAAQ8uF,mBAAqB19F,KAAK4O,QAAQ8uF,mBAAqB,IAAIC,KAChFttE,MAAOrwB,KAAK4O,QAAQgvF,kBACpB7uC,OAAQ,MAOJquC,6BACDp9F,KAAK4O,QAAQkuF,cAAgB98F,KAAKwsE,OACrCxsE,KAAKwsE,MAAM7C,YAAY3pE,KAAK68F,gBAOxBS,yBACDt9F,KAAK4O,QAAQkuF,cAChB98F,KAAKwsE,MAAMnH,SAASrlE,KAAK68F,gBAOrBM,6BACDn9F,KAAK4O,QAAQkuF,eAAiB98F,KAAK4O,QAAQ8uF,oBAC9C19F,KAAKk9F,qBAAqBhnF,OAAM,GAOpCqnF,kBAAkBj8F,GAEhB,IAAIzB,EAuCJ,GAzBIA,EAbJG,KAAU69F,UAAUl0E,WAaI,IAAIm0E,MADE,UAAxB99F,KAAKg9F,eACwB,CAC7Bl4F,KAAM,SACNwX,OAAQtc,KAAKorD,YACb2yC,UAAW/9F,KAAK4O,QAAQmvF,UACxBC,UAAU,GAImB,CAC7Bl5F,KAAM9E,KAAKg9F,eACX1gF,OAAQtc,KAAKorD,YACb2yC,UAAW/9F,KAAK4O,QAAQmvF,UACxBC,UAAU,IAxBM,IAAIF,MAAO,CAC7Bh5F,KAAM9E,KAAKg9F,eACX1gF,OAAQtc,KAAKorD,YACb6yC,WAAW,EACX5tE,MAAOrwB,KAAK4O,QAAQsvF,iBACpBH,UAAW/9F,KAAK4O,QAAQmvF,UACxBC,UAAU,EACVG,kBAAmB,KAAM,IAuB7Bn+F,KAAKwsE,MAAMzD,eAAelpE,GAC1BG,KAAKo+F,kBAAoBv+F,EAEzBG,KAAKq+F,eAAiBx+F,EAAkBiJ,GAAG,YAAchJ,GAAuBE,KAAKs+F,YAAYx+F,IACjGE,KAAKu+F,aAAe1+F,EAAkBiJ,GAAG,UAAYhJ,GAAuBE,KAAKw+F,UAAU1+F,IAC3FE,KAAKy+F,eAAiB5+F,EAAkBiJ,GAAG,YAAchJ,GAAuBE,KAAK0+F,OAAOv2F,KAAKrI,EAAMu+C,QAAQ0T,gBAE3GzwD,EAAyB,CAE3B,MAAMxB,EAAsB,IAAI6+F,KAAS,CACvCriF,OAAQtc,KAAKorD,cAOf,GAJAprD,KAAKwsE,MAAMzD,eAAejpE,GAC1BE,KAAK4+F,oBAAsB9+F,GAGtBE,KAAK6+F,oBAAqB,CAC7B,MAAMz+F,EAAsB,IAAI0+F,KAAS,CACvCriE,UAAWsiE,MACX1uE,WAAO,IAETrwB,KAAKwsE,MAAMzD,eAAe3oE,GAC1BJ,KAAK6+F,oBAAsBz+F,EAE3BJ,KAAK6+F,oBAAoB/1F,GAAG,SAAWzI,GAAyBL,KAAKg/F,SAAS3+F,MAQ5Eg9F,uBACNr9F,KAAKi/F,sBACL,QAAQ,CAACj/F,KAAKq+F,eAAgBr+F,KAAKu+F,aAAcv+F,KAAKk/F,UAAWl/F,KAAKy+F,iBAElEz+F,KAAKwsE,QACPxsE,KAAKwsE,MAAMrD,kBAAkBnpE,KAAKo+F,mBAClCp+F,KAAKwsE,MAAMrD,kBAAkBnpE,KAAK4+F,sBAGpC5+F,KAAKo+F,uBAAoB,EACzBp+F,KAAK4+F,yBAAsB,EAOrBN,YAAYh9F,GAClB,MAAMzB,EAAayB,EAAM+8C,QAAQ0T,cACjC/xD,KAAKm/F,OAAOh3F,KAAKtI,GACjBG,KAAKm9F,4BACLn9F,KAAKk/F,UAAYr/F,EAAWiJ,GAAG,SAAWhJ,IACxCE,KAAKo/F,cAAgBC,GAAoCv/F,GACzDE,KAAKs/F,SAASn3F,KAAKrI,EAAgBsnB,UAErCpnB,KAAKu/F,mBAOCf,UAAUl9F,GAChBtB,KAAKi/F,sBACL,QAAQj/F,KAAKk/F,WACb,MAAMr/F,EAAayB,EAAM+8C,QAAQ0T,cACjClyD,EAAWiJ,GAAG,SAAU,KACtB9I,KAAKw/F,QAAQr3F,KAAKtI,KAEpBG,KAAKy/F,KAAKt3F,KAAKtI,GAOTm/F,SAAS19F,GACe,IAA1BA,EAAM+e,SAAS9f,QACjBP,KAAK0/F,QAAQv3F,KAAK7G,EAAM+e,SAAS,IAO7Bk/E,mBACNv/F,KAAKi/F,qBACLj/F,KAAK2/F,WAAY,OAAU/9F,SAAU,WAAWwG,UAAW9G,IAEvC,WAAdA,EAAM2E,KAMQ,cAAd3E,EAAM2E,KACRjG,KAAKo+F,kBAAkBwB,kBAIP,UAAdt+F,EAAM2E,KACRjG,KAAKo+F,kBAAkByB,gBAIP,MAAdv+F,EAAM2E,KACRjG,KAAKwsE,MAAMlZ,UAAU5rB,QAAQ,CAC3B2nC,OAAQrvE,KAAKo/F,cACbntC,SAAU,OAlBZjyD,KAAKo+F,kBAAkB0B,iBA4BrBb,qBACFj/F,KAAK2/F,YACP3/F,KAAK2/F,UAAUj3F,cACf1I,KAAK2/F,eAAY,QCnUVI,iBAGXh4F,YACSlI,EACyBC,GADzBE,iBACyBA,YAJzBA,kBAAuB,EAOhCggG,gBACEhgG,KAAKm3F,UAAUxkE,QAEjBstE,QAAQpgG,GACNG,KAAKkgG,aAAc,EACnBlgG,KAAKm3F,UAAUxkE,MAAM9yB,iDAbZkB,GAAkBrB,mBAKnB8yB,iCALCzxB,EAAkBugB,oYCZ/B5hB,iBACEA,eACEA,8BACFA,QACAA,4BACEA,0CAKFA,QACFA,QACAA,iBACEA,oBAA0BA,gCAASI,oBACjCJ,gCACFA,QACAA,qBAA0CA,0DAASI,qBACjDJ,iBACFA,QACFA,cAjBIA,oEAMEA,oEACAA,mCAKFA,iIDFSqB,MEJAo/F,6FAAqB7+E,8YCRlC5hB,8BACEA,eACEA,kBACEA,sBAAqEA,8BAAqCA,QAC9GA,QACAA,eACEA,kBACEA,sBAAuEA,+BAAmCA,QAC9GA,QACAA,gBACEA,mBACEA,uBAAkEA,gCAAoCA,QAC1GA,QACAA,gBACEA,mBACEA,uBAAoEA,gCAAmCA,QAC3GA,QACFA,QACAA,iCACEA,qBAA2DA,eAAEA,QAC/DA,eAjB2EA,iDAIEA,gDAILA,iDAIEA,gTDP7DqB,UELDq/F,SAAZ,OAAYr/F,UAAW,KACrBs/F,gBACAt/F,cAFUq/F,GAAZ,IAAYr/F,MAKAu/F,SAAZ,OAAYv/F,UAAiB,KAC3Bw/F,gBACAx/F,0BACAA,gBACAA,cAJUu/F,GAAZ,IAAYv/F,YAOCy/F,GAAgC,EAC1CF,GAAkBC,QAAS,KAC3BD,GAAkBG,YAAa,MAC/BH,GAAkBI,OAAQ,MAC1BJ,GAAkBK,MAAO,UAGhBC,SAAZ,OAAY7/F,UAAe,KACzB8/F,4BACA9/F,sCACAA,4BACAA,0BACAA,sBACAA,gBANU6/F,GAAZ,IAAY7/F,YASC+/F,GAA8B,EACxCF,GAAgBC,cAAe,SAC/BD,GAAgBG,kBAAmB,UACnCH,GAAgBI,aAAc,UAC9BJ,GAAgBK,YAAa,UAC7BL,GAAgBM,UAAW,MAC3BN,GAAgBO,OAAQ,kBCXQpgG,GACjC,MAAe,KAARA,cAQoBA,GAC3B,OAAe,OAARA,cAQqBA,GAC5B,OAAe,OAARA,cAQsCA,GAC7C,OAAe,KAARA,cAQiCA,GACxC,OAAe,SAARA,cAQgCA,GACvC,OAAe,OAARA,cAQ8BA,GACrC,OAAe,KAARA,cAQ2BA,GAClC,OAAe,SAARA,cASoBA,EAAeO,GAO1C,MAAMxB,EANmB,IAAIuW,IAAI,CAC/B,CAACiqF,GAAkBC,OAASngG,GAAgBA,GAC5C,CAACkgG,GAAkBG,WAAYW,IAC/B,CAACd,GAAkBI,MAAOW,IAC1B,CAACf,GAAkBK,KAAMW,MAES73F,IAAInI,GAExC,OAAOxB,EAAaA,EAAWiB,QAAS,cASPA,EAAeO,GAShD,MAAMxB,EAAa,IARUuW,IAAI,CAC/B,CAACuqF,GAAgBC,aAAezgG,GAAgBA,GAChD,CAACwgG,GAAgBG,iBAAkBQ,IACnC,CAACX,GAAgBI,YAAaQ,IAC9B,CAACZ,GAAgBK,WAAYQ,IAC7B,CAACb,GAAgBM,SAAUQ,IAC3B,CAACd,GAAgBO,MAAOQ,MAEUl4F,IAAInI,GAExC,OAAOxB,EAAaA,EAAWiB,QAAS,cAUxCA,EACAO,EAMAzB,GACA,IAAIC,EAAUwB,EAAQsgG,cACN,IAAZ9hG,GAAyBA,EAAU,KACrCA,EAAU,GAGZ,MAAMM,EAAQ,GACd,OACEA,EAAMQ,UADe,IAAnBU,EAAQgxC,OACCvxC,EAAQ8gG,eAAevgG,EAAQgxC,OAAQ,CAChDwvD,sBAAuBhiG,EACvBiiG,sBAAuBjiG,IAGdiB,EAAQihG,QAAQliG,GAASmD,iBAGjB,IAAjB3B,EAAQ2gG,OAA2C,IAArB3gG,EAAQ4gG,UAEtC9hG,EAAMQ,KADJf,EAGEA,EAAgBmO,UAAUgC,QAD5BwwF,GAA8Bl/F,EAAQ2gG,MACF,mBAAqBzB,GAA8Bl/F,EAAQ2gG,MAC3D,mBAAqBnB,GAA4Bx/F,EAAQ2gG,OAI7FzB,GAA8Bl/F,EAAQ2gG,OAASnB,GAA4Bx/F,EAAQ2gG,OAKlF7hG,EAAMqG,OAAOpG,QAAW,IAANA,GAAiBS,KAAK,mBAwC/C,OAAO,IAAIs5D,MAAc,CACvBoB,OAAQ,IAAIC,KAAe,CACzBhrC,MAAO,UACPirC,SAAU,CAAC,GAAI,IACfjE,MAAO,IAET6C,KAAO,IAAIC,KAAa,CACtB9pC,MAAO,6BAETqd,MAAO,IAAI8tB,KAAe,CACxB7N,OAAQ,EACRyN,OAAQ,IAAIC,KAAe,CACzBhrC,MAAO,YAET6pC,KAAM,IAAIC,KAAa,CACrB9pC,MAAO,6CA4ByB1vB,EAA2DO,GACjG,KAAIP,aAAsBgxE,OAGqB,IAA3ChxE,EAAWgmF,qBAAqBxmF,OAGpC,OAAO4hG,SAAYphG,EAAY,CAAC0oD,2BA0BA1oD,EAA2DO,GAC3F,MAAMzB,EAASuiG,GAAwBrhG,EAAYO,GAC7CxB,WAnB8BiB,EAA2DO,GAC/F,KAAIP,aAAsBgxE,MAAWhxE,aAAsBqiF,OAGZ,IAA3CriF,EAAWgmF,qBAAqBxmF,OAGpC,OAAO8hG,SAAUthG,EAAY,CAAC0oD,eAYxB3pD,CAA6BiB,EAAYO,GAEzClB,EAAU,GACVC,EAAcU,EAAWgmF,qBACzBzmF,EAAoBD,EAAYE,OACtC,QAASC,EAAI,EAAGA,GAAKF,EAAoB,EAAGE,GAAK,EAAG,CAClD,MAAMkD,EAAY,IAAI0/E,KAAa,CACjC,CAAC/iF,EAAYG,GAAIH,EAAYG,EAAI,IACjC,CAACH,EAAYG,EAAI,GAAIH,EAAYG,EAAI,MAGvCJ,EAAQQ,KAAKwhG,GAAwB1+F,EAAWpC,IAGlD,MAAO,CACLghG,OACA/hG,SACAgiG,uBASsCxhG,GACxC,IAAIO,EACJ,GAAIP,aAAsBgxE,KAAS,CACjC,MAAMlyE,EAAkB,IAAIkyE,KAAQhxE,EAAWgmF,sBAC/CzlF,EAAc,IAAI6C,MAAM,GACxB7C,EAAY,GAAKzB,MACZ,CACLyB,EAAckhG,GAAuBzhG,GAErC,MAAMlB,EAAckB,EAAWgmF,qBACzBjnF,EAAkBwB,EAAYf,OACpC,QAASH,EAAI,EAAGA,EAAIN,EAAiBM,IAAK,CACxC,MAAMC,EAAQ,EAAJD,EAMJI,EALY,IAAI4iF,KAAa,CACjC,CAACvjF,EAAYQ,GAAIR,EAAYQ,EAAI,IACjC,CAACR,EAAYQ,EAAI,GAAIR,EAAYQ,EAAI,MAGFoiG,gBAAgB,IAC/C/+F,EAAapC,EAAYlB,QACZ,IAAfsD,EACFA,EAAWg/F,eAAeliG,GAE1Bc,EAAYlB,GAAK,IAAI2xE,KAAQvxE,IAInC,OAAOc,EA6BT,YAAgCP,GAC9B,IAAIO,EAEFA,EADEP,aAAsBixE,KACP,EAEAzqE,KAAKyb,IAAKjiB,EAAWgmF,qBAAqBxmF,OAAS,EAAK,EAAG,GAI9E,IAAIV,EAAckB,EAAW0I,IAAI,cAEjC,QAAoB,IAAhB5J,EACF,OACEA,EAAc,IAAIsE,MADhBpD,aAAsBgxE,KACA,EAEAzwE,GAE1BP,EAAW0U,IAAI,aAAc5V,GAAa,GACnCA,EAOT,GAJuB,IAAnByB,GAIAA,IAAmBzB,EAAYU,OACjC,OAAOV,EAGT,GAAIyB,EAAiBzB,EAAYU,OAC/B,SAAYK,QAAQ,IAAIuD,MAAM7C,EAAiBzB,EAAYU,SACpDV,EAGT,QAASC,EAAIwB,EAAgBxB,EAAID,EAAYU,OAAQT,IAAK,CACxD,MAAMM,EAAaP,EAAYyB,QACZ,IAAflB,GACFuiG,GAAuBviG,GAG3B,SAAY4E,OAAO1D,GAEZzB,EAOT,YAAgCkB,GAC9B,MAAMO,EAAYP,EAAW0I,IAAI,YACjC,QAAkB,IAAdnI,EAAyB,CAC3B,MAAMzB,EAAQyB,EAAU87D,cACV,IAAVv9D,GACFA,EAAM+iG,cAActhG,gBA2FcP,GACtC,MAAMO,EAAa,GAAG0E,gBAzDiBjF,GAEvC,OADoByhG,GAAuBzhG,GACxB2E,IAAK7F,GACfA,EAAaA,EAAW4J,IAAI,iBAAc,GAsD7BzD,CAAgCjF,IAAe,IAC/DlB,WAZ6BkB,GACnC,MAAMO,EAAWP,EAAW0I,IAAI,WAChC,OAAOnI,EAAWA,EAASmI,IAAI,iBAAc,EAUvC5J,CAAuCkB,GAC7C,YAAwB,IAApBlB,GACFyB,EAAWV,KAAKf,GAEXyB,cAQ8BP,EAAkBO,GAAkB,EAAOzB,EAAqB,IACrG,MAAMC,EAAY,IAAI+iG,KAAU,CAC9BnnE,QAAS95B,SAASC,cAAc,OAChCm7B,OAAQ,EAAC,IAAK,IACdd,WAAY56B,EACZ,CAAE,kBACA,0BAA2B,gCAAkC,CAAC,kBAAmB,0BACjF,2BAA2BzB,cAAwBiB,KAAK,KAC1DgiG,WAAW,IAEb,SAAUC,YAAYhiG,EAAQgmF,sBAC9BhmF,EAAQ0U,IAAI,WAAY3V,GAEjBA,cC/gB8BiB,EAAoBO,EAAsBzB,EAAsBC,GACrG,OAAO,IAAIkjG,MAAc,CACvBxnC,OAAQ,IAAIwnC,KAAe,CACzBvyE,MAAOnvB,GAA4B,kBACnCm2D,MAAO53D,GAA4B,IAErCy6D,KAAM,IAAI0oC,KAAa,CACrBvyE,MAAO1vB,GAAwB,0BAEjC+sC,MAAO,IAAIk1D,KAAe,CACxBj1C,OAAQ,EACRyN,OAAQ,IAAIwnC,KAAe,CACzBvyE,MAAOnvB,GAA4B,kBACnCm2D,MAAO53D,GAA4B,IAErCy6D,KAAM,IAAI0oC,KAAa,CACrBvyE,MAAO1vB,GAAwB,kCCzB1BkiG,iBASXl7F,YAAoBlI,qBARZG,eAAY,wBACZA,iBAAc,kBACdA,iBAAsB,EACtBA,qBAAiB,EAEjBA,cAAmB,KACnBA,eAAoB28F,GAASC,MAAM35F,WAI3CigG,eACE,OAAOljG,KAAK4rE,UAGdu3B,aAAatjG,GACXG,KAAK4rE,UAAY/rE,EAGnBujG,iBACE,OAAOpjG,KAAK6rE,YAGdw3B,eAAexjG,GACbG,KAAK6rE,YAAchsE,EAGrByjG,iBACE,OAAOtjG,KAAK2rE,YAGd43B,oBACE,OAAOvjG,KAAKwjG,eAGdC,uBACEzjG,KAAKwjG,gBAAkBxjG,KAAKwjG,eAG9BE,QAAQ7jG,GACNG,KAAKiZ,KAAOpZ,EAGd8jG,UACE,OAAO3jG,KAAKiZ,KAId2qF,cACE,OAAO5jG,KAAK6jG,SAGdC,YAAYjkG,GACVG,KAAK6jG,SAAWhkG,EAGlBkkG,eACE,OAAO/jG,KAAKgkG,UAGdC,aAAapkG,GACXG,KAAKgkG,UAAYnkG,EAGnBqkG,wBACErkG,EACAC,EACAM,EACAC,GAEA,IAAIC,EACAE,GAA2B,EAC/B,MAAMkD,EAAO1D,KAAKy/D,WAAWrC,SAAS3T,WAChC7lD,EAAO/D,EAAQkyD,cACfluD,EAAmB,GAAG7D,KAAK6jG,cAAc7jG,KAAKgkG,YAOpD,GALIpgG,aAAgBmuE,OAClBvxE,GAAmBA,GAIjBX,EAAQ4J,IAAI,OAAQ,CACtB,MAAM1F,GAAc,SAClBlE,EAAQkyD,cAAcoyC,gBACtBzgG,EACA,aAEF,SAAQ,IAAIi3E,MAAc,CACxBrrE,KAAM,IAAIqrE,KAAa,CACrBrrE,KAAMlP,EAAiBP,EAAQ4J,IAAI,QAAU,GAC7C+xD,OAAQ,IAAImf,KAAe,CACzBlqD,MAAO,QACPgnC,MAAO,MAET6C,KAAM,IAAIqgB,KAAa,CACrBlqD,MAAO,UAETgqC,KAAM52D,EACNqmE,UAAU,IAEZp8B,MAAO,IAAI6sC,KAAe,CACxB5sB,OACEluD,EAAQ4J,IAAI,OACZlC,KAAK68F,IAAK78F,KAAKo0D,GAAK,IAAO53D,EAAY,IACvCjE,EACF07D,OAAQ,IAAImf,KAAe,CACzBlqD,MAAOzwB,KAAK6rE,YACZpU,MAAOz3D,KAAK2rE,cAEdrR,KAAM,IAAIqgB,KAAa,CACrBlqD,MAAOzwB,KAAK4rE,gBAIXtrE,EAEF,OAAID,GACTC,EAAQ,IAAIq6E,MAAc,CACxBrrE,KAAM,IAAIqrE,KAAa,CACrBrrE,KAAMlP,EAAiBP,EAAQ4J,IAAI,QAAU,GAC7C0xD,SAAS,GACTK,OAAQ,IAAImf,KAAe,CACzBlqD,MAAO,QACPgnC,MAAO,MAET6C,KAAM,IAAIqgB,KAAa,CACrBlqD,MAAO,UAETgqC,KAAM52D,EACNqmE,UAAU,IAEZ1O,OAAQ,IAAImf,KAAe,CACzBlqD,MAAOzwB,KAAK6rE,YACZpU,MAAOz3D,KAAK2rE,cAEdrR,KAAM,IAAIqgB,KAAa,CACrBlqD,MAAOzwB,KAAK4rE,YAEd99B,MAAO,IAAI6sC,KAAa,CACtBxmC,IAAK9zC,MAGFC,IAGPA,EAAQ,IAAIq6E,MAAc,CACxBrrE,KAAM,IAAIqrE,KAAa,CACrBrrE,KAAMlP,EAAiBP,EAAQ4J,IAAI,QAAU,GAC7C+xD,OAAQ,IAAImf,KAAe,CACzBlqD,MAAO,QACPgnC,MAAO,MAET6C,KAAM,IAAIqgB,KAAa,CACrBlqD,MAAO,UAETgqC,KAAM52D,EACNqmE,UAAU,EACV/O,QAAS36D,GAAkB,GAAM,IAGnCg7D,OAAQ,IAAImf,KAAe,CACzBlqD,MAAOzwB,KAAK6rE,YACZpU,MAAOz3D,KAAK2rE,cAGdrR,KAAM,IAAIqgB,KAAa,CACrBlqD,MAAOzwB,KAAK4rE,YAGd99B,MAAO,IAAI6sC,KAAe,CACxB5sB,OAAQ,EACRyN,OAAQ,IAAImf,KAAe,CACzBlqD,MAAOzwB,KAAK6rE,YACZpU,MAAOz3D,KAAK2rE,cAEdrR,KAAM,IAAIqgB,KAAa,CACrBlqD,MAAOzwB,KAAK4rE,gBAIXtrE,iDApLAS,GAAgBrB,sCAAhBqB,EAAgBsI,QAAhBtI,EAAgB,qBAFf,SAEDA,MCJAsjG,iBAITt8F,YACYlI,iBAERG,KAAKskG,eAGTC,WACI,OAAOvkG,KAAKwkG,MAGhBC,UACE,OAAOzkG,KAAK2K,OAAOD,UAAU,sBAAwB,GAGvD45F,eACEtkG,KAAKwkG,MAAQxkG,KAAKykG,wDAnBX1jG,GAAerB,qCAAfqB,EAAesI,QAAftI,EAAe,qBAFZ,SAEHA,gCCyGDrB,kBACEA,kBACFA,+BADOA,6EAITA,yBAGEA,sFACAA,kBACEA,kBACFA,QACFA,oCALEA,iBAGOA,wEAdbA,0BACEA,qBAAWA,8BAAqCA,QAChDA,sBACEA,8BACEA,yBAGFA,QACAA,yBAAqBA,kEAAyBA,8BAAuCA,QACrFA,iCAQFA,QACFA,gCAjBaA,+CAGDA,8BAIsCA,iDAEtBA,6DAuC1BA,wBAGEA,SACFA,kCAFEA,iBACAA,oEAQNA,qBASEA,0GACAA,uBACFA,gCAJEA,qDAAgD,2DCpHzCglG,iBAwDX38F,YACUlI,EACAC,EACAM,EACAC,EACAC,GAJAN,uBACAA,mBACAA,wBACAA,cACAA,uBAxDHA,mBAAqC,CAC1C2hB,WAAW,EACXmF,YAAY,EACZD,mBAAmB,EACnB5L,MAAM,EACN0L,QAAS,CAAC,CACNzV,KAAM,UACNjC,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,uBAC9C2M,cAAgBnc,GACPA,EAAQ2mB,WAAWw9E,QAK3B3kG,kBAAey8F,GAcfz8F,WAA+B,IAAI+I,IAAgB,IAElD/I,0BAAuB,IAAI29F,KAK5B39F,uBACL,IAAI+I,IAAgB,IAGf/I,4BAAiC,EACjCA,0BAA+B,EAE9BA,qBAAkC,GAInCA,cAAmB,SAYxBA,KAAK4kG,YACL5kG,KAAK4rE,UAAY5rE,KAAK6kG,iBAAiB3B,eACvCljG,KAAK6rE,YAAc7rE,KAAK6kG,iBAAiBzB,iBACzCpjG,KAAK2rE,YAAc3rE,KAAK6kG,iBAAiBvB,iBACzCtjG,KAAKwjG,eAAiBxjG,KAAK6kG,iBAAiBtB,oBAC5CvjG,KAAKwkG,MAAQxkG,KAAK8kG,gBAAgBP,WAClCvkG,KAAKiZ,KAAOjZ,KAAK6kG,iBAAiBlB,UAElC3jG,KAAK6jG,SAAW7jG,KAAK6kG,iBAAiBjB,cACtC5jG,KAAKgkG,UAAYhkG,KAAK6kG,iBAAiBd,eAIzCvjF,WACExgB,KAAK6+B,YACL7+B,KAAK+kG,YAAc/kG,KAAKglG,kBACtBhlG,KAAK4rE,UACL5rE,KAAK6rE,YACL7rE,KAAK2rE,aAEP3rE,KAAK+kG,YAAYvH,gBAAgBx9F,KAAKi9F,aAAaP,OACnD18F,KAAKilG,oBAOP9sF,cACEnY,KAAK+kG,YAAYt4B,cAAS,GAC1BzsE,KAAKmxE,gBAAgBzrE,IAAK7F,GAAMA,EAAE6I,eAUpCs8F,kBACEnlG,EACAC,EACAM,GAYA,OAVoB,IAAI8kG,GAAY,CAClCjI,kBAAc,EACdS,mBAAoB19F,KAAKk9F,qBACzBU,kBAAmB,IAAIjjB,MAAc,IACrCujB,iBAAkBiH,GAChBtlG,EACAC,EACAM,KAUNglG,qBAAqBvlG,GACnBG,KAAK+kG,YAAYvH,gBAAgB39F,GACjCG,KAAKilG,oBAMCpmE,YACN7+B,KAAK0F,IAAIikE,YAAY3pE,KAAK68F,gBAC1B78F,KAAK68F,eAAiB,IAAI13B,GAAY,CACpC5V,oBAAoB,EACpB3qD,GAAI,iBACJqK,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,wBAC9C++C,OAAQ,IACRzyC,OAAQ,IAAI0vC,GACZ37B,MAAO,CAACxwB,EAASC,IACRE,KAAK6kG,iBAAiBX,wBAC3BrkG,EACAC,EACAE,KAAKwjG,eACLxjG,KAAKiZ,MAGTq3C,iBAAiB,EACjBa,YAAY,EACZD,WAAW,EACX9nB,UAAW,CACThL,SAAS,KAGbk6C,GAAkBt4E,KAAKoR,MAAOpR,KAAK68F,gBACnCwI,GACErlG,KAAKoR,MACL,IAAIw4D,GAA4B,CAC9B/C,OAAQhqB,GAAclkC,QAG1B2sF,GACEtlG,KAAKoR,MACL,IAAIy4D,GAA8B,CAChCnkE,IAAK1F,KAAK0F,IACVmhE,OAAQhqB,GAAclkC,KACtB4sF,MAAM,KAGVvlG,KAAKoR,MAAMqrC,MAAM71B,SAAU,EAC3B5mB,KAAKoR,MAAMkL,OAAOygC,GAAGj0C,GACnB,gBACCjJ,IACC,MAAMC,EAAaD,EAAMw+C,QAAQ0T,cACjC/xD,KAAKwlG,wBAAwB1lG,KAGjCE,KAAKmxE,gBAAgBvwE,KACnBZ,KAAKoR,MAAM+L,UACRnC,QAASnb,IACyB,IAA1BA,EAAOiY,MAAMuI,UAErB9X,MACC,QAAK,IAENH,UAAWvI,IACVG,KAAKylG,kBAAkBt9F,KAAKtI,EAAQ6F,IAAK5F,GAAWA,EAAO0e,YAGjExe,KAAKmxE,gBAAgBvwE,KACnBZ,KAAKoR,MAAMkJ,OAAOlS,UAAWvI,IAEtBG,KAAKoR,MAAMqrC,MAAM7tC,QAAQ0hD,gBAD9BzwD,GAAO,KAYb6lG,cAAc7lG,EAAyBC,GACrCE,KAAK0uC,SAAW1uC,KAAK4rE,UACrB5rE,KAAK2lG,WAAa3lG,KAAK6rE,YACvB7rE,KAAK6kG,iBAAiB1B,aAAanjG,KAAK4rE,WACxC5rE,KAAK6kG,iBAAiBxB,eAAerjG,KAAK6rE,aAE1C/rE,GACEE,KAAKoR,MAAMqrC,MAAMM,GAAGgW,SAAS,CAAC3yD,EAASC,IAC9BL,KAAK6kG,iBAAiBX,wBAC3B9jG,EACAC,EACAR,EACAG,KAAKiZ,OAGTjZ,KAAKiZ,UAAO,GAEZjZ,KAAKoR,MAAMqrC,MAAMM,GAAGgW,SAAS,CAAC3yD,EAASC,IAC9BL,KAAK6kG,iBAAiBX,wBAC3B9jG,EACAC,EACAR,IAING,KAAKglG,oBAOPY,oBAAoB/lG,GAClBA,EAAkBG,KAAKilG,oBAAsBjlG,KAAK6lG,wBAM5CZ,oBACNjlG,KAAK6lG,wBACL7lG,KAAK8lG,sBAQCC,WAAWlmG,EAAmBC,GACpCq3E,WAAW,KAET,MAAM/2E,EAAYJ,KAAKkyB,OAAOD,KAAK8tE,GAAoB,CACrD5tE,cAAc,EACd5I,KAAM,CAAEy8E,aAAcnmG,EAAkB4J,IAAI,WAI9CrJ,EAAUkyB,cAAclqB,UAAW/H,IAE7BD,EAAUgyB,kBAAkB8tE,aAC9BlgG,KAAKimG,wBAAwBpmG,EAAmBQ,GAEhDP,EACEE,KAAKw+F,UAAU3+F,GAGfG,KAAKkmG,aAAarmG,EAAmBQ,IAKvCL,KAAKk9F,qBACFrpC,cACA/tD,QAASxF,IACR,MAAME,EAAWF,EAAoByxD,cACjClyD,IAAsBW,GACxBR,KAAKk9F,qBAAqBvkC,cAAcr4D,QAKjD,KAMGwlG,sBACN9lG,KAAKmmG,uBAAwB,EAC7BnmG,KAAKomG,qBAAsB,EAC3BpmG,KAAKqmG,UAAYrmG,KAAK+kG,YAAYtF,KAAKr3F,UACpCvI,IACCG,KAAK+lG,WAAWlmG,GAAY,KAIhCG,KAAK+kG,YAAYvF,QAAQp3F,UAAWvI,IAClCG,KAAKsmG,aAAazmG,KAGfG,KAAKumG,eACRvmG,KAAKumG,aAAevmG,KAAK+kG,YAAYrF,QAAQt3F,UAC1CvI,IACCG,KAAK+lG,WAAWlmG,GAAW,MAKjCG,KAAK+kG,YAAYt4B,SAASzsE,KAAK0F,IAAIq3C,IAAI,GAMjC8oD,yBACD7lG,KAAK+kG,cAIN/kG,KAAKqmG,WACPrmG,KAAKqmG,UAAU39F,cAGjB1I,KAAK+kG,YAAYt4B,cAAS,GAC1BzsE,KAAKomG,qBAAsB,GAOrB5H,UAAU3+F,EAAwBC,GACxCE,KAAKwmG,kBAAkB3mG,EAAYC,GACnCE,KAAKwlG,wBAAwB3lG,GAC7BG,KAAKoR,MAAMqrC,MAAMM,GAAGqO,YAAY3hC,UAG1B68E,aAAazmG,GACFG,KAAKoR,MAAMqJ,MAEnB3U,QAAS1F,IACCA,EAAO+mB,WAAWviB,KAEd/E,EAAWq1E,SAG9Bl1E,KAAKimG,wBAAwBpmG,EAAYO,EAAO+mB,WAAWw9E,MAC3D3kG,KAAKymG,sBAAsBrmG,EAAQP,MAKjCqmG,aAAarmG,EAAkCC,GACrD,MAAMM,EAAWJ,KAAKoR,MAAMqJ,MAEtBpa,EAAaR,EAAUkyD,cAC7B1xD,EAAW60E,OAASr1E,EAAU4J,IAAI,MAElC,MAAMnJ,EAAwB2E,KAAKE,UACjC9E,EAAWmzD,iBAAiB,IAG9BpzD,EAAS0F,QAAStF,IAChB,MAAMkD,EAAoBuB,KAAKE,UAAU3E,EAAOykD,SAASs+B,YAAY,IAErE,GAAIjjF,IAA0BoD,EAAmB,CAC/C,MAAME,EAAcpD,EAAO2mB,WAAWu/E,IAClClmG,EAAO2mB,WAAWu/E,SAClB,EACJ1mG,KAAKimG,wBAAwB5lG,EAAYP,GACzCE,KAAKymG,sBAAsBjmG,EAAQH,EAAYuD,MAU7C4iG,kBACN3mG,EACAC,EACAM,GAEA,IAAIC,EACAC,EACAE,EACAkD,EACAE,EACJ,MAAMC,EAAYzD,EAAUA,EAAQ+mB,WAAWviB,GAAK/E,EAAWq1E,OACzDnxE,EAAa/D,KAAK0F,IAAIq3C,GAAGuW,UAAUia,gBAEnCvpE,OAAe+nD,MAAYuY,oBAAoBzkE,EAAY,CAC/DikD,kBAAmB//C,EACnB8/C,eAAgB9/C,IAGlB,GAAIlE,aAAsBmyE,MAAYlyE,EACpC,GAAIA,EACFO,EAAMP,MACD,CACLkE,EAASc,KAAO,QAChBd,EAASu/E,YAAc1jF,EAAW2tE,YAClC,MAAM7oE,KAAakpD,OACjB,CACEhuD,EAAWknF,qBAAqB,GAChClnF,EAAWknF,qBAAqB,IAElChjF,EACA,aAEFzD,KAAautD,OACX,CACEhuD,EAAWknF,qBAAqB,GAChClnF,EAAWknF,qBAAqB,IAElChjF,EACA,aAEFL,EAAUpD,EAAW,GACrBsD,EAAUtD,EAAW,GACrBD,GAAM,SAAYC,EAAYqE,GAI9B9E,aAAsBkyE,OACxBvxE,GAAY,SACVX,EAAWknF,qBACXhjF,EACA,aAEFL,EAAUlD,EAAU,GACpBoD,EAAUpD,EAAU,IAGtBR,KAAKoR,MAAMsI,OAAO,CAChB5U,KAAM83C,GACNqI,WACAwE,WAAY1lD,EAAWw9C,UACvBp6B,WAAY,CACVviB,GAAIf,EACJ8gG,KAAM9kG,EAAW4J,IAAI,UACrBk9F,UAAWjjG,GAAoB,KAC/BkjG,SAAUhjG,GAAoB,KAC9B8iG,IAAKrmG,GAAY,MAEnBwY,KAAM,CACJjU,GAAIf,KAUF4iG,sBACN5mG,EACAC,EACAM,GAEAJ,KAAKoR,MAAMzH,OAAO9J,GAClBG,KAAKw+F,UAAU1+F,EAAYM,GAGrBwkG,YACN5kG,KAAKu3B,KAAOv3B,KAAKooB,YAAYwP,MAAM,CACjC0iC,KAAM,CAAC,IACPkB,OAAQ,CAAC,MAIbqrC,iBACE7mG,KAAKoR,MAAMuM,WAAW3d,KAAKylG,kBAAkB3jG,OAC7C9B,KAAKylG,kBAAkB3jG,MAAMgE,QAASjG,IACpCG,KAAKk9F,qBAAqBrpC,cAAc/tD,QAAShG,IAC/C,MAAMM,EAAWN,EAAoBiyD,cACjClyD,EAAgBsnB,WAAWviB,KAAOxE,EAAS80E,QAC7Cl1E,KAAKk9F,qBAAqBvkC,cAAc74D,OAUxC0lG,wBAAwB3lG,GAC9BinG,GAAwBjnG,GAAYiG,QACjChG,IACKA,GAAaA,EAAUs9D,UACzBp9D,KAAK0F,IAAIq3C,GAAG6lD,cAAc9iG,KASlCinG,iBACE/mG,KAAK6kG,iBAAiBpB,uBACtBzjG,KAAKwjG,gBAAkBxjG,KAAKwjG,eAExBxjG,KAAK0lG,cAAc1lG,KAAKwjG,iBAD5BxjG,KAAKiZ,MAUCgtF,wBAAwBpmG,EAAwBC,GACtDD,EAAWo6E,cACT,CACE+sB,OAAQlnG,IAEV,GAIJmnG,aAAapnG,GACXG,KAAKiZ,KAAOpZ,EACZG,KAAK6kG,iBAAiBnB,QAAQ1jG,KAAKiZ,MACnCjZ,KAAKoR,MAAMqrC,MAAMM,GAAGgW,SAAS,CAACjzD,EAASM,IAC9BJ,KAAK6kG,iBAAiBX,wBAC3BpkG,EACAM,GACA,EACAJ,KAAKiZ,OAKXiuF,qBACElnG,KAAKkyB,OAAOD,KAAKkuE,IAMnBgH,mBACE,MAAMtnG,EAAa2lE,GACjBxlE,KAAKylG,kBAAkB3jG,MAAM,GAC7B9B,KAAK0F,IAAIq3C,GAAGuW,UAAUia,gBAAgBhsB,WAExCvhD,KAAK+lG,WAAWlmG,GAAY,GAU9BunG,aAAavnG,EAAyBC,EAAcM,GAClDJ,KAAK6kG,iBAAiBf,YAAYhkG,GAClCE,KAAK6kG,iBAAiBZ,aAAa7jG,GAEnCJ,KAAKoR,MAAMqrC,MAAMM,GAAGgW,SAAS,CAAC1yD,EAASC,IAC9BN,KAAK6kG,iBAAiBX,wBAC3B7jG,EACAC,EACAT,IAGJG,KAAKglG,wCAIL,OAAOp/F,OAAO+V,OAAOghF,kDArkBZ57F,GAAarB,kFAAbqB,EAAaugB,s5ED3D1B5hB,eACEA,iBACEA,qCAAyBA,kCAAUI,kCAEjCJ,+BACEA,8BACFA,QAEAA,+BACEA,8BACFA,QAEAA,+BACEA,gCACFA,QAEAA,gCACEA,gCACFA,QACFA,QACFA,QAEAA,kBACEA,+BAIEA,kCAAUI,mCACVJ,gCACFA,QAEAA,+BAGEA,iCAAUI,qBACVJ,gCACFA,QACFA,QAEAA,mBACEA,kBACEA,iBACEA,uBACAA,gCACFA,QAEAA,mDAOEA,sBAAWA,UAAeA,QAE1BA,qBAIEA,6DAA2B,sCAWNI,kCAA8B,2BAfrDJ,QAgBFA,QACFA,QAEAA,mBACEA,iBACEA,wBACAA,gCACFA,QAEAA,oDAOEA,sBAAWA,UAAiBA,QAC5BA,qBAIEA,+DAA6B,sCAWRI,kCAA8B,2BAfrDJ,QAgBFA,QACFA,QAEAA,gBACEA,sCAmBFA,QACFA,QAGAA,mBACEA,8BACEA,sBAAWA,gCAAyCA,QACpDA,wBAQEA,4DACaI,0DATfJ,QAeAA,oBAAgBA,eAAEA,QACpBA,QACAA,8BACEA,sBAAWA,gCAA0CA,QACrDA,6BAGEA,sEAAmBI,mDACnBJ,iCAKFA,QACFA,QACFA,QAEAA,wBACAA,gBACEA,6BAaAA,mCAKEA,mCAAYI,uBACdJ,QACFA,QAEAA,sBAIEA,gCAASI,yBACTJ,8CAOFA,QACFA,cAzM2EA,6CAElDA,6CACjBA,yEAGiBA,kDACjBA,8EAGiBA,+CACjBA,4EAGiBA,8CACjBA,2EAOFA,mDAAkC,gCAAlCA,CAAkC,0BAIlCA,yEAIAA,2CAA0B,0BAG1BA,sEAImBA,mCAIjBA,yDASAA,qEACWA,4BAOTA,yCADAA,iCAA2B,cAA3BA,CAA2B,0BAA3BA,CAA2B,kBAA3BA,CAA2B,wBAA3BA,CAA2B,sBAA3BA,CAA2B,0BAA3BA,CAA2B,oBAA3BA,CAA2B,wDAA3BA,CAA2B,iBAkB7BA,2DASAA,qEACWA,8BAMTA,2CADAA,mCAA6B,cAA7BA,CAA6B,4BAA7BA,CAA6B,kBAA7BA,CAA6B,sBAA7BA,CAA6B,0BAA7BA,CAA6B,wBAA7BA,CAA6B,oBAA7BA,CAA6B,wDAA7BA,CAA6B,iBAgBhBA,yCAyBNA,qDAQTA,mCAWSA,sDAGTA,oCAGyBA,0CAW1BA,mDAeDA,gCAAe,4BAgBfA,wqDC7IOqB,MCHAsmG,2HA7BF,CACPhhF,MACAA,MACArZ,KACAgiB,KACAs4E,MACArR,KACApqE,MACApsB,KACAwvB,KACApD,MACA0I,KACApF,KACAiK,MACA88D,MACA1jE,MACA7lB,GACAqtB,GACAutE,UAWSxmG,MC5BAymG,2HAdF,CACPx6F,KACAvN,KACAkN,GACAi0B,GACA7G,OASSh5B,MCLA0mG,2HAZF,CACPz6F,KACA2sB,IAGAA,MAOS54B,MCNA2mG,4HAFA,GAAEn4E,SARJ,CACPviB,MAGAw6F,GACAC,MAKS1mG,eCyGXgH,YAAoBzG,kBA3EbtB,YAA8B,IAAIgI,KAKlChI,UAA4B,IAAIgI,KAKhChI,cAAgC,IAAIgI,KAQnChI,kCAAuC,EAKvCA,qCAA0C,EAK1CA,gCAAqC,EAQrCA,2BAAyC,GAgCzCA,aAAkB,EAKlBA,gBAAqB,OAGJ,IAAnBsB,EAAQqmG,SACV3nG,KAAK2nG,OAASrmG,EAAQqmG,aAEE,IAAtBrmG,EAAQ0M,YACVhO,KAAKgO,UAAY1M,EAAQ0M,WAIzBhO,KAAK4nG,oBADe,IAAtBtmG,EAAYm7C,MACYn7C,EAAQm7C,MAERz8C,KAAK+8F,4BAE7B/8F,KAAK6nG,mBAAqB7nG,KAAK8nG,wCA1C/B,YAAsB,IAAf9nG,KAAKwsE,MAAUu7B,sBAQtB,OAAO/nG,KAAK4nG,eAAex8C,sCAQ3B,OAAOprD,KAAK6nG,mBAAmBz8C,YAiCjCqhB,SAASnrE,GACP,QAAc,IAAVA,EAOF,OANAtB,KAAKm9F,4BACLn9F,KAAKo9F,4BACLp9F,KAAKgoG,4BACLhoG,KAAKioG,+BACLjoG,KAAKkoG,+BACLloG,KAAKwsE,MAAQlrE,GAIftB,KAAKwsE,MAAQlrE,EACbtB,KAAKs9F,0BAIe,IAAhBt9F,KAAK2nG,QACP3nG,KAAKmoG,wBAGgB,IAAnBnoG,KAAKgO,YACPhO,KAAKooG,4BACLpoG,KAAKqoG,iCAGa,IAAhBroG,KAAK2nG,SACP3nG,KAAKsoG,yBACLtoG,KAAKuoG,6BAOTn9C,YACE,OAAOprD,KAAK+nG,gBAOdS,cAAclnG,GACZ,MAAMzB,EAAY,IAAImrE,KAAU,CAAE/lB,SAAU3jD,IAC5CtB,KAAK+nG,gBAAgB7xF,QACrBlW,KAAK+nG,gBAAgBnvC,WAAW/4D,GAM1Bk9F,4BACN,OAAO,IAAIU,KAAc,CACvBnhF,OAAQtc,KAAK4O,QAAQ0N,OAAStc,KAAK4O,QAAQ0N,OAAS,IAAIqhF,KACxDttE,MAAOrwB,KAAK4O,QAAQ65F,WACpB15C,OAAQ,MAOJuuC,8BACqB,IAAvBt9F,KAAK4O,QAAQ6tC,OACfz8C,KAAKwsE,MAAMnH,SAASrlE,KAAK4nG,gBAOrBxK,iCACqB,IAAvBp9F,KAAK4O,QAAQ6tC,YAAsC,IAAfz8C,KAAKwsE,OAC3CxsE,KAAKwsE,MAAM7C,YAAY3pE,KAAK4nG,gBAOxBzK,iCACqB,IAAvBn9F,KAAK4O,QAAQ6tC,YAA+C,IAAxBz8C,KAAK4O,QAAQ0N,QACnDtc,KAAK+nG,gBAAgB7xF,OAAM,GAIvB4xF,2BACN,OAAO,IAAIrK,KAAc,CACvBnhF,OAAQ,IAAIqhF,KACZttE,MAAOq4E,KACP35C,OAAQ,MAOJ45C,wBACN3oG,KAAKwsE,MAAMnH,SAASrlE,KAAK6nG,oBAMnBe,2BACN5oG,KAAKwsE,MAAM7C,YAAY3pE,KAAK6nG,oBAMtBgB,2BACN7oG,KAAK8oG,oBAAoB5yF,OAAM,GAMzBoyF,yBACN,MAAMhnG,EAAsB,IAAIq9F,KAAS,CACvCriF,OAAQtc,KAAK+nG,gBACb13E,MAAOrwB,KAAK4O,QAAQm6F,YAEtB/oG,KAAK4+F,oBAAsBt9F,EAMrB0mG,iCAC2B,IAA7BhoG,KAAK4+F,sBAIT5+F,KAAKgpG,8BACLhpG,KAAK4+F,yBAAsB,GAGrB2J,6BACmC,IAArCvoG,KAAKipG,8BAITjpG,KAAKipG,6BAA8B,EACnCjpG,KAAKkpG,iBAAmBlpG,KAAK4+F,oBAAoB91F,GAC/C,cACCxH,GAAyBtB,KAAKmpG,cAAc7nG,IAE/CtB,KAAKopG,eAAiBppG,KAAK4+F,oBAAoB91F,GAC7C,YACCxH,GAAyBtB,KAAKqpG,YAAY/nG,IAE7CtB,KAAKwsE,MAAMzD,eAAe/oE,KAAK4+F,sBAGzBoK,+BACmC,IAArChpG,KAAKipG,8BAITjpG,KAAKipG,6BAA8B,GAEnC,QAAQ,CAACjpG,KAAKkpG,iBAAkBlpG,KAAKopG,eAAgBppG,KAAKspG,mBACvC,IAAftpG,KAAKwsE,OACPxsE,KAAKwsE,MAAMrD,kBAAkBnpE,KAAK4+F,sBAQ9BuK,cAAc7nG,GACpB,MAAMzB,EAAayB,EAAMqjF,SAAS4kB,KAAK,GAAGx3C,cAC1C/xD,KAAKm/F,OAAOh3F,KAAKtI,GACjBG,KAAKspG,YAAczpG,EAAWiJ,GAC5B,SACChJ,IACCE,KAAKo/F,cAAgBC,GACnBv/F,GAEFE,KAAKs/F,SAASn3F,KAAKrI,EAAgBsnB,UAGvCpnB,KAAKwpG,qBAOCH,YAAY/nG,IAClB,QAAQtB,KAAKspG,aACbtpG,KAAKy/F,KAAKt3F,KAAK7G,EAAMqjF,SAAS4kB,KAAK,GAAGx3C,eACtC/xD,KAAKypG,uBAMCD,qBACNxpG,KAAK2/F,WAAY,OAAU/9F,SAAU,WAAWwG,UAC7C9G,IACmB,MAAdA,EAAM2E,KAERjG,KAAKwsE,MAAMlZ,UAAU5rB,QAAQ,CAC3B2nC,OAAQrvE,KAAKo/F,cACbntC,SAAU,MAWZw3C,4BACiB,IAAnBzpG,KAAK2/F,WACP3/F,KAAK2/F,UAAUj3F,cAOX0/F,4BACN,MAAM9mG,EAAyB,IAAIooG,KAAY,CAC7Cr/C,OAAQ,CAACrqD,KAAK4nG,kBAEhB5nG,KAAK2pG,uBAAyBroG,EAMxB2mG,oCAC8B,IAAhCjoG,KAAK2pG,yBAIT3pG,KAAK4pG,iCACL5pG,KAAK2pG,4BAAyB,GAGxBtB,gCACsC,IAAxCroG,KAAK6pG,iCAIT7pG,KAAK6pG,gCAAiC,EACtC7pG,KAAK8pG,oBAAsB9pG,KAAK2pG,uBAAuB7gG,GACrD,iBACCxH,GAA4BtB,KAAK+pG,iBAAiBzoG,IAErDtB,KAAKgqG,kBAAoBhqG,KAAK2pG,uBAAuB7gG,GACnD,eACCxH,GAA4BtB,KAAKiqG,eAAe3oG,IAEnDtB,KAAKwsE,MAAMzD,eAAe/oE,KAAK2pG,yBAGzBC,kCACsC,IAAxC5pG,KAAK6pG,iCAIT7pG,KAAK6pG,gCAAiC,GACtC,QAAQ,CACN7pG,KAAK8pG,oBACL9pG,KAAKgqG,kBACLhqG,KAAKkqG,sBAEY,IAAflqG,KAAKwsE,OACPxsE,KAAKwsE,MAAMrD,kBAAkBnpE,KAAK2pG,yBAQ9BI,iBAAiBzoG,GACvB,MAAMzB,EAAayB,EAAMqjF,SAAS4kB,KAAK,GAAGx3C,cAC1C/xD,KAAKm/F,OAAOh3F,KAAKtI,GACjBG,KAAKkqG,eAAiBrqG,EAAWiJ,GAC/B,SACChJ,OAUGmqG,eAAe3oG,IACrB,QAAQtB,KAAKkqG,gBACblqG,KAAKy/F,KAAKt3F,KAAK7G,EAAMqjF,SAAS4kB,KAAK,GAAGx3C,eAMhCo2C,uBACN,MAAM7mG,EAAoB,IAAIw8F,MAAO,CACnCh5F,KAAM,UACNwX,OAAQtc,KAAK8oG,oBACb7K,WAAW,EACX5tE,MAAOq4E,KACPjsE,UAAY58B,IACcG,KAAKmqG,iBAAmBnqG,KAAKoqG,iBAClBC,qBACjCxqG,EAAMo3E,cAMZj3E,KAAKo+F,kBAAoB98F,EACzBtB,KAAKsqG,yBAMCA,yBACNtqG,KAAKuqG,eAAgB,OAAU3oG,SAAU,WAAWwG,UACjD9G,IACC,GAAkB,YAAdA,EAAM2E,IACR,OAGFjG,KAAKwqG,2BAEL,MAAM3qG,EAAaG,KAAKoqG,iBACnBvqG,KAAgBA,aAAsByjF,SAI3CtjF,KAAKyqG,uBAELzqG,KAAKgpG,8BACLhpG,KAAK4pG,iCACL5pG,KAAK0qG,6BAQHD,uBACNzqG,KAAK2qG,aAAc,OAAU/oG,SAAU,SAASwG,UAC7C9G,IACmB,YAAdA,EAAM2E,MAIVjG,KAAK4qG,yBACL5qG,KAAKypG,uBACLzpG,KAAK6qG,4BAEL7qG,KAAKuoG,6BACkB,IAAnBvoG,KAAKgO,WACPhO,KAAKqoG,+BAEProG,KAAKsqG,yBAELtqG,KAAKmqG,qBAAkB,EACvBnqG,KAAK6oG,2BACL7oG,KAAKy/F,KAAKt3F,KAAKnI,KAAKoqG,oBAQlBI,gCACqB,IAAvBxqG,KAAKuqG,eACPvqG,KAAKuqG,cAAc7hG,cAOfkiG,8BACmB,IAArB5qG,KAAK2qG,aACP3qG,KAAK2qG,YAAYjiG,cAObw/F,+BACyB,IAA3BloG,KAAKo+F,oBAITp+F,KAAKypG,uBACLzpG,KAAK4qG,yBACL5qG,KAAKwqG,2BACLxqG,KAAK6qG,4BACL7qG,KAAK6oG,2BACL7oG,KAAKo+F,uBAAoB,GAMnBsM,2BACiC,IAAnC1qG,KAAK8qG,4BAIT9qG,KAAK6oG,2BACL7oG,KAAK2oG,wBAEL3oG,KAAKwsE,MAAM5D,kBAAkB9iE,QAASxE,IAChCA,aAAyBgmE,OAC3BtnE,KAAKwsE,MAAMrD,kBAAkB7nE,GAC7BtB,KAAK+qG,sBAAsBnqG,KAAKU,MAIpCtB,KAAK8qG,2BAA4B,EACjC9qG,KAAKq+F,eAAiBr+F,KAAKo+F,kBAAkBt1F,GAC3C,YACCxH,GAAuBtB,KAAKs+F,YAAYh9F,IAE3CtB,KAAKu+F,aAAev+F,KAAKo+F,kBAAkBt1F,GACzC,UACCxH,GAAuBtB,KAAKw+F,UAAUl9F,IAEzCtB,KAAKwsE,MAAMzD,eAAe/oE,KAAKo+F,oBAMzByM,6BACiC,IAAnC7qG,KAAK8qG,4BAIT9qG,KAAK4oG,2BAEL5oG,KAAK+qG,sBAAsBjlG,QAASxE,IAClCtB,KAAKwsE,MAAMzD,eAAeznE,KAE5BtB,KAAK+qG,sBAAwB,GAE7B/qG,KAAK8qG,2BAA4B,GACjC,QAAQ,CAAC9qG,KAAKq+F,eAAgBr+F,KAAKu+F,aAAcv+F,KAAKk/F,iBACnC,IAAfl/F,KAAKwsE,OACPxsE,KAAKwsE,MAAMrD,kBAAkBnpE,KAAKo+F,oBAQ9BE,YAAYh9F,GAClB,MAAMzB,EAAayB,EAAM+8C,QAAQ0T,cACjC/xD,KAAKmqG,gBAAkBnqG,KAAKoqG,gBAAgB1gG,QAE5C,MAAM5J,EAAwBD,EAAWmrG,gBAAgBx3C,iBACzDxzD,KAAKirG,0BAA0BnrG,GAC/BE,KAAKm/F,OAAOh3F,KAAKnI,KAAKoqG,iBAEtBpqG,KAAKk/F,UAAYr/F,EAAWiJ,GAC1B,SACC1I,IACCJ,KAAKo/F,cAAgBC,GACnBj/F,GAGF,MAAME,EAAyBF,EADUgnB,OAEtC4jF,cAAc,GACdx3C,iBACHxzD,KAAKkrG,6BAA6B5qG,GAClCN,KAAKs/F,SAASn3F,KAAKnI,KAAKoqG,mBAG5BpqG,KAAKwpG,qBAOChL,UAAUl9F,IAChB,QAAQtB,KAAKk/F,WACbl/F,KAAKmqG,qBAAkB,EAEvB,MAAMtqG,EAAwByB,EAAM+8C,QACjC0T,cACAi5C,gBACAx3C,iBACHxzD,KAAKkrG,6BAA6BrrG,GAClCG,KAAK6oG,2BACL7oG,KAAKy/F,KAAKt3F,KAAKnI,KAAKoqG,iBACpBpqG,KAAKypG,uBAOCwB,0BAA0B3pG,alB1gBKP,EAAsBO,GAE7DP,EAAUoqG,iBAAiB7pG,GkBwgBOA,CACbtB,KAAKoqG,gBACH,IAAIgB,KAAa9pG,IAQhC4pG,6BAA6B5pG,GACnC,MAAMzB,EAAaG,KAAKoqG,gBAGlBhqG,EADgBP,EAAWwrG,iBAAiBjoG,MAAM,GAAG,GACtBsC,IAAKrF,GACjCA,EAAamzD,kBAEtBpzD,EAAeQ,KAAKU,GACpBzB,EAAW6iG,eAAetiG,GAOpBgqG,gBACN,MAAM9oG,EAAatB,KAAK+nG,gBAAgBl0C,cACxC,OAAOvyD,EAAWf,OAAS,EAAIe,EAAW,GAAGywD,mBAAgB,SC5qBpDu5C,GAAQ,kCCErB5rG,mBAEEA,iBACEA,cACEA,gBAAgBA,8BAAqDA,QACvEA,QACFA,QACAA,iBACEA,cACEA,cAAIA,mCAAyDA,QAC7DA,eAAIA,gCAAuDA,QAC7DA,QACAA,eACEA,eAAIA,oCAA6DA,QACjEA,eAAIA,gCAA2DA,QACjEA,QACAA,eACEA,eAAIA,oCAAwDA,QAC5DA,eAAIA,gCAAsDA,QAC5DA,QACAA,eACEA,eAAIA,oCAAuDA,QAC3DA,eAAIA,gCAAqDA,QAC3DA,QACFA,QACFA,8BArBsBA,iEAKZA,sEACAA,qEAGAA,0EACAA,yEAGAA,qEACAA,oEAGAA,oEACAA,8FAKVA,mBAEEA,iBACEA,cACEA,gBAAgBA,8BAAmDA,QACrEA,QACFA,QACAA,iBACEA,cACEA,cAAIA,mCAA2DA,QAC/DA,eAAIA,gCAA2DA,QACjEA,QACAA,eACEA,eAAIA,oCAA8DA,QAClEA,eAAIA,gCAA+DA,QACrEA,QACAA,eACEA,eAAIA,oCAA0DA,QAC9DA,eAAIA,gCAA0DA,QAChEA,QACAA,eACEA,eAAIA,oCAAoDA,QACxDA,eAAIA,gCAAoDA,QAC1DA,QACAA,eACEA,eAAIA,oCAAuDA,QAC3DA,eAAIA,gCAAuDA,QAC7DA,QACAA,eACEA,eAAIA,gCAA0DA,QAC9DA,eAAIA,oCAA4DA,QAClEA,QACFA,QACFA,8BA7BsBA,gEAKZA,wEACAA,yEAGAA,4EACAA,6EAGAA,uEACAA,wEAGAA,iEACAA,kEAGAA,oEACAA,qEAGAA,wEACAA,8EC/CG6rG,iBAMXxjG,YACSlI,EACyBC,GADzBE,iBACyBA,YANlCA,qBAAkB4gG,GAElB5gG,uBAAoBsgG,GAOpBkL,YACExrG,KAAKm3F,UAAUxkE,sDAZN5xB,GAAuBrB,mBAQxB8yB,iCARCzxB,EAAuBugB,0LDZpC5hB,gBAAqBA,8BAA8CA,QAEnEA,4BA2BAA,mCA7BqBA,0DAEbA,uCA2BAA,wVCjBKqB,+CCWTrB,gEAEAA,8BAGEA,qFACAA,8BACFA,gCAJEA,gCAAwB,0BAGxBA,+FAGFA,gEAEAA,8BAGEA,wFACAA,8BACFA,gCAJEA,mCAA2B,0BAG3BA,qHAGFA,8BAGEA,qFACAA,8BACFA,gCAJEA,gCAAwB,0BAGxBA,+FAGFA,gEAWAA,gCAMEA,4GACFA,+CANEA,0CAAkC,yCAAlCA,CAAkC,mBAAlCA,CAAkC,0BAAlCA,CAAkC,kKAQpCA,gCAMEA,0GACFA,+CANEA,wCAAgC,6CAAhCA,CAAgC,iBAAhCA,CAAgC,0BAAhCA,CAAgC,4EAXpCA,SACEA,uCASAA,uCAQFA,8BAjBsBA,4GASAA,uFAUtBA,gEAGEA,qBAKEA,4GACAA,uBACFA,gCALEA,6EAAwE,gGAO1EA,qBAKEA,yGACAA,uBACFA,gCALEA,0EAAqE,2DCrB9D+rG,iBAwPX1jG,YACUlI,EACAC,EACAM,GAFAJ,uBACAA,cACAA,sBArPHA,mBAAqC,CAC1C2hB,WAAW,EACXmF,YAAY,EACZD,mBAAmB,EACnB5L,MAAM,EACN0L,QAAS,CACP,CACEzV,KAAM,SACNjC,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,gCAC9C2M,cAAgBtc,IACd,MAAMC,EAAON,KAAK0rG,iBAElB,OAAOC,GADSC,GAAavrG,EAAa8mB,WAAW0kF,QAAQtrG,OAAQD,GACvC,CAC5BshG,QAAS,EACTK,OACAC,UAAU,EACV5vD,OAAQ,SAId,CACEphC,KAAM,OACNjC,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,8BAC9C2M,cAAgBtc,IACd,MAAMC,EAAON,KAAK8rG,eACZtrG,EAAUurG,GAAmB1rG,EAAa8mB,WAAW0kF,QAAQvJ,KAAMhiG,GACzE,OAAOE,EAAUmrG,GAAcnrG,EAAS,CACtCohG,QAAS,EACTK,OACAC,UAAU,EACV5vD,OAAQ,OACL,OAMLtyC,qBAAkC,GAMnCA,iBAAcogG,GAMdpgG,qBAAkB4gG,GAMlB5gG,uBAAoBsgG,GAMpBtgG,uBAA4B,EAM5BA,sBAA2B,EAM3BA,mBAAwB,EAMxBA,mBAAwB,EAMvBA,cAAqC,IAAI+I,KAAgB,GAM1D/I,cAAqC,IAAI+I,KAAgB,GAMzD/I,cAAqC,IAAI+I,IAAgB,IAMzD/I,uBAA2D,IAAI+I,IAAgB,IAM/E/I,mBAAwB,EAMxBA,4BAAiC,EAyBhCA,sBAAsCsgG,GAAkBC,OAKxDvgG,oBAAkC4gG,GAAgBC,aAwDlD7gG,kBAAe,IAAI29F,KAyBlB39F,sBAA2B,yBARdH,GAAsBG,KAAKgsG,qBAAqBnsG,2BAC/B,OAAOG,KAAKisG,6CAgBjD,YAAkC,IAA3BjsG,KAAKksG,kBAAsBziD,iBAIlC,OAAOzpD,KAAK0F,IAAIq3C,GAAGuW,UAAUia,gBAAgBhsB,UAa/C/gC,WACExgB,KAAK6+B,YACL7+B,KAAKmsG,wBACLnsG,KAAKosG,2BACLpsG,KAAKqsG,sBACLrsG,KAAKilG,oBACLjlG,KAAKssG,yBAAyBtsG,KAAKoR,MAAMkL,OAAOygC,IAChD/8C,KAAKusG,0BACLvsG,KAAKgsG,qBAAqB5L,GAAYC,QAOxCloF,cACEnY,KAAKgsG,0BAAqB,GAC1BhsG,KAAKwsG,0BACLxsG,KAAKysG,cACLzsG,KAAKmxE,gBAAgBzrE,IAAI7F,GAAKA,EAAE6I,eAOlCgkG,oBAAoB7sG,GAClBG,KAAK2sG,kBAAoB9sG,EAO3B+lG,oBAAoB/lG,IACH,IAAXA,EACFG,KAAKilG,oBAELjlG,KAAK6lG,wBASR+G,yBAAyB/sG,GACxBG,KAAK6sG,iBAAmBhtG,EAO1BitG,wBAAwBjtG,GACtBG,KAAK+sG,gBAAkBltG,EACvBG,KAAKgtG,oBACKhtG,KAAKswE,eAAe76D,IAAI,mBAAlC5V,EAA0DoV,YAQ5Dg4F,qBAAqBptG,GACnBG,KAAKktG,aAAertG,EACpBG,KAAKmtG,iBACKntG,KAAKswE,eAAe76D,IAAI,gBAAlC5V,EAAuDoV,YAQzDm4F,qBAAqBvtG,GACnBG,KAAKqtG,aAAextG,EACpBG,KAAKstG,iBACKttG,KAAKswE,eAAe76D,IAAI,gBAAlC5V,EAAuDoV,YAQzDs3F,2BACoD,IAA9CvsG,KAAKswE,eAAe7mE,IAAI,oBAC1BzJ,KAAK+sG,iBAAkB,IAEsB,IAA3C/sG,KAAKswE,eAAe7mE,IAAI,iBAC1BzJ,KAAKktG,cAAe,IAEyB,IAA3CltG,KAAKswE,eAAe7mE,IAAI,iBAC1BzJ,KAAKqtG,cAAe,GAQxBL,oBACMhtG,KAAK+sG,gBACP5oG,MAAMgL,KAAKvN,SAASwyF,uBAAuB,8CAA8C1uF,IAAK7F,GAC5FA,EAAMk8B,UAAU5rB,OAAO,2BAEzBhM,MAAMgL,KAAKvN,SAASwyF,uBAAuB,8CAA8C1uF,IAAK7F,GAC5FA,EAAMk8B,UAAUC,IAAI,2BAQ1BmxE,iBACMntG,KAAKktG,aACP/oG,MAAMgL,KAAKvN,SAASwyF,uBAAuB,0CAA0C1uF,IAAK7F,GACxFA,EAAMk8B,UAAU5rB,OAAO,2BAEzBhM,MAAMgL,KAAKvN,SAASwyF,uBAAuB,0CAA0C1uF,IAAK7F,GACxFA,EAAMk8B,UAAUC,IAAI,2BAQ1BsxE,iBACMttG,KAAKqtG,aACPlpG,MAAMgL,KAAKvN,SAASwyF,uBAAuB,iCAAiC1uF,IAAK7F,GAC/EA,EAAMk8B,UAAU5rB,OAAO,2BAEzBhM,MAAMgL,KAAKvN,SAASwyF,uBAAuB,iCAAiC1uF,IAAK7F,GAC/EA,EAAMk8B,UAAUC,IAAI,2BAQ1BuxE,mBAAmB1tG,GACjBG,KAAK0rG,iBAAmB7rG,EACxBG,KAAKwtG,MAAM/jF,UACXzpB,KAAKssG,yBAAyBtsG,KAAKoR,MAAMkL,OAAOygC,SAClB,IAA1B/8C,KAAKytG,kBACPztG,KAAK0tG,2BAA2B1tG,KAAKytG,kBAQzCE,iBAAiB9tG,GACfG,KAAK8rG,eAAiBjsG,EACtBG,KAAKwtG,MAAM/jF,UACXzpB,KAAKssG,yBAAyBtsG,KAAKoR,MAAMkL,OAAOygC,SAClB,IAA1B/8C,KAAKytG,kBACPztG,KAAK0tG,2BAA2B1tG,KAAKytG,kBAIzCG,mBACE,MAAM/tG,EAAWG,KAAKylG,kBAAkB3jG,MAClChC,EAAOD,EAASmH,OAAO,CAAC1G,EAAaE,IAClCF,EAAME,EAAa2mB,WAAW0kF,QAAQvJ,MAAQ,EACpD,GACGliG,EAASP,EAASmH,OAAO,CAAC1G,EAAaE,IACR,YAA/BA,EAAaykD,SAASngD,KACjBxE,EAEFA,EAAME,EAAa2mB,WAAW0kF,QAAQtrG,QAAU,EACtD,GACGF,EAAYR,EAASmH,OAAO,CAAC1G,EAAaE,IACX,eAA/BA,EAAaykD,SAASngD,KACjBxE,EAEFA,EAAME,EAAa2mB,WAAW0kF,QAAQtrG,QAAU,EACtD,GAEHP,KAAK+lG,WAAW,CACdzD,OACA/hG,SACAstG,cAIJC,gBACE9tG,KAAKoR,MAAMuM,WAAW3d,KAAKylG,kBAAkB3jG,OAC7C9B,KAAKylG,kBAAkB3jG,MAAMgE,QAAQjG,IACnCG,KAAK+tG,aAAal6C,cAAc/tD,QAAQhG,IACtC,MAAMM,EAAWN,EAAoBiyD,cACjClyD,EAAgBsnB,WAAWviB,KAAOxE,EAAS80E,QAC7Cl1E,KAAK+tG,aAAap1C,cAAc74D,OAMxCkuG,gBACE,GAA4C,IAAxChuG,KAAKylG,kBAAkB3jG,MAAMvB,OAEjC,IAAkC,IAA9BP,KAAKiuG,cAAczuF,OACrBxf,KAAKwsG,0BACLxsG,KAAKilG,wBACA,CACL,MAAMplG,EAAeG,KAAKylG,kBAAkB3jG,MAAM,GAE5C1B,EAAYJ,KADMoR,MAAMqrC,MAAMM,GAAGqO,YAAYyI,cACtBh5C,KAAMxa,GAC1BA,EAAWoJ,IAAI,QAAU5J,EAAasnB,WAAWviB,IAG1D,QAAkB,IAAdxE,EAAyB,CAC3BJ,KAAK6lG,wBACL7lG,KAAKkuG,wBAEL,MAAM7tG,EAAaD,EAAU2xD,cAC7B/xD,KAAKmuG,0BAA0B9tG,GAC/BL,KAAKiuG,cAAczF,cAAcnoG,KAK/B0lG,WAAWlmG,GACjBG,KAAKkyB,OAAOD,KAAKs5E,GAAyB,CAAChiF,SAOrCsV,YACN,MAAMh/B,EAAQG,KAAKoR,MAEbtR,EAAQ,IAAIqlE,GAAY,CAC5Bl2D,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,8BAC9Cu/C,oBAAoB,EACpB3qD,GAAI,gBAAgBqE,MACpB8lD,OAAQ,IACRzyC,OAAQ,IAAI0vC,GACZ37B,Mf9UG,IAAI+pC,MAAc,CACvBoB,OAAQ,IAAIC,KAAe,CACzBhrC,MAAO,UACPgnC,MAAO,IAET6C,KAAO,IAAIC,KAAa,CACtB9pC,MAAO,+BeyUP6/B,iBAAiB,EACjBa,YAAY,EACZD,WAAW,EACX9nB,UAAW,CAAEhL,SAAS,KAExBk6C,GAAkBz4E,EAAOC,GACzBD,EAAM48C,MAAM71B,SAAU,EACtB9mB,EAAMorD,SAAS9iD,UAAUhI,IACnBA,EACF+D,MAAMgL,KAAKvN,SAASwyF,uBAAuB,4BAA4B1uF,IAAKrF,GAC5EA,EAAM07B,UAAU5rB,OAAO,uCAGvBhM,MAAMgL,KAAKvN,SAASwyF,uBAAuB,4BAA4B1uF,IAAKrF,GAC5EA,EAAM07B,UAAUC,IAAI,yCAIxBqpE,GAAsBxlG,GAEtBylG,GAAwBzlG,EAAO,IAAIgqE,GAA8B,CAC/DnkE,IAAK1F,KAAK0F,IACV6/F,MAAM,KAGRvlG,KAAKouG,kBAAoBvuG,EAAMyc,OAAOygC,GAAGj0C,GAAG,aAAe1I,IACzD,MAAMC,EAAeD,EAAMi+C,QACrB/9C,EAAaD,EAAa0xD,cAChC/xD,KAAKquG,0BAA0B/tG,EAAYD,EAAaoJ,IAAI,YAC5DzJ,KAAKgtG,sBAGPhtG,KAAKsuG,oBAAsBzuG,EAAMyc,OAAOygC,GAAGj0C,GAAG,gBAAkB1I,IAC9D,MAAMC,EAAaD,EAAMi+C,QAAQ0T,cACjC/xD,KAAKmuG,0BAA0B9tG,KAGjCL,KAAKuuG,mBAAqB1uG,EAAMsd,UAAUnC,QAAS5a,IAChB,IAA1BA,EAAO0X,MAAMuI,UACnB9X,MACD,QAAK,IAENH,UAAWhI,KACwB,IAA9BJ,KAAKiuG,cAAczuF,QACrBxf,KAAKwsG,0BAEPxsG,KAAKylG,kBAAkBt9F,KAAK/H,EAAQsF,IAAIrF,GAAUA,EAAOme,WAG3Dxe,KAAKmxE,gBAAgBvwE,KAAKZ,KAAKoR,MAAMkM,UAAUlV,UAAUhI,IACnDA,EAAcya,KAAKxa,GAA6C,YAA9BA,EAAY4kD,SAASngD,MACzD9E,KAAKwuG,SAASrmG,MAAK,GAEnBnI,KAAKwuG,SAASrmG,MAAK,GAGrB/H,EAAkBya,KAAKxa,GAA6C,eAA9BA,EAAY4kD,SAASngD,MACzD9E,KAAKyuG,SAAStmG,MAAK,GAEnBnI,KAAKyuG,SAAStmG,MAAK,MAIvBnI,KAAKmxE,gBAAgBvwE,KAAKZ,KAAKoR,MAAMkJ,OAAOlS,UAAUhI,IAElDJ,KAAKoR,MAAMqrC,MAAM7tC,QAAQ0hD,gBAD3BlwD,GAAO,KAWHqsG,cACN,MAAM5sG,EAAQG,KAAKoR,MACnBpR,KAAKuuG,mBAAmB7lG,eACxB,QAAQ1I,KAAKouG,sBACbM,MAAQ1uG,KAAKsuG,qBACbzuG,EAAMue,yBAAyBwrD,IAC/B/pE,EAAMue,yBAAyByrD,IAMzBsiC,wBACNnsG,KAAK2uG,gBAAkB,IAAIzJ,GAAY,CACrCjI,aAAc,aACdS,mBAAoB19F,KAAK+tG,aACzB7P,iBAAkB0Q,KAClBhR,kBAAmB,IAAIxjC,MAAQ,MAO3BgyC,2BACNpsG,KAAK6uG,mBAAqB,IAAI3J,GAAY,CACxCjI,aAAc,UACdS,mBAAoB19F,KAAK+tG,aACzB7P,iBAAkB0Q,KAClBhR,kBAAmB,IAAIxjC,MAAQ,MAO3BiyC,sBACNrsG,KAAKiuG,cAAgB,IAAIa,GAAc,CACrCxyF,OAAQtc,KAAK+tG,aACbhF,UAAW6F,KACXnG,WAAY,IAAIruC,MAAQ,MAOpB6qC,oBACNjlG,KAAK6lG,wBAEL7lG,KAAS2sG,oBAAsBvM,GAAYC,OACzCrgG,KAAK8lG,oBAAoB9lG,KAAK2uG,iBACrB3uG,KAAK2sG,oBAAsBvM,GAAY2O,MAChD/uG,KAAK8lG,oBAAoB9lG,KAAK6uG,oBAQ1B/I,oBAAoBjmG,GAC1BG,KAAKmmG,uBAAwB,EAC7BnmG,KAAKksG,kBAAoBrsG,EACzBG,KAAKgvG,YAAcnvG,EAAYs/F,OAC5B/2F,UAAWtI,GAAyCE,KAAKs+F,YAAYx+F,IACxEE,KAAKqmG,UAAYxmG,EAAY4/F,KAC1Br3F,UAAWtI,GAAyCE,KAAKw+F,UAAU1+F,IACtEE,KAAKivG,cAAgBpvG,EAAYy/F,SAC9Bl3F,UAAWtI,GAAyCE,KAAKkvG,cAAcpvG,IAC1EE,KAAKivG,cAAgBpvG,EAAY6+F,OAC9Bt2F,UAAWtI,IACVE,KAAKmuG,0BAA0BruG,GAC/BE,KAAKmvG,kBAETtvG,EAAY4sE,SAASzsE,KAAK0F,IAAIq3C,IAAI,GAM5B8oD,6BACyB,IAA3B7lG,KAAKksG,oBAITlsG,KAAK+tG,aAAa73F,aACO,IAArBlW,KAAKgvG,aAA8BhvG,KAAKgvG,YAAYtmG,mBACjC,IAAnB1I,KAAKqmG,WAA4BrmG,KAAKqmG,UAAU39F,mBACzB,IAAvB1I,KAAKivG,eAAgCjvG,KAAKivG,cAAcvmG,cAE5D1I,KAAKovG,wBAAwBpvG,KAAK+tG,mBACJ,IAA1B/tG,KAAKytG,kBACPztG,KAAKmuG,0BAA0BnuG,KAAKytG,kBAEtCztG,KAAKksG,kBAAkBz/B,cAAS,GAChCzsE,KAAKksG,uBAAoB,EACzBlsG,KAAKytG,sBAAmB,GAGlBzB,qBAAqBnsG,GAC3BG,KAAKisG,mBAAqBpsG,EAC1BG,KAAKmvG,gBACLnvG,KAAKilG,oBAOC3G,YAAYz+F,GAClBG,KAAKytG,iBAAmB5tG,EAOlB2+F,UAAU3+F,GAChBG,KAAKytG,sBAAmB,EACxBztG,KAAKqvG,4BAA4BxvG,GACjCG,KAAKwmG,kBAAkB3mG,GACvBG,KAAKmuG,0BAA0BtuG,GAC/BG,KAAK+tG,aAAa73F,OAAM,GAOlBg5F,cAAcrvG,GACpB,MAAMC,EAAUwvG,GAAkBzvG,EAAYG,KAAKypD,YACnDzpD,KAAKquG,0BAA0BxuG,EAAY+F,OAAOU,OAAO,GAAIxG,EAAS,CACpEwiG,UAAM,KAERtiG,KAAKuvG,SAASpnG,KAAKrI,GAObouG,wBACN,MAAMruG,EAAYG,KAAKoR,MAAM8M,kBAAkB2rD,IAC/ChqE,EAAUwe,aACVxe,EAAUqW,QAEVlW,KAAKwvG,cAAgBxvG,KAAKiuG,cAAc9O,OACrC/2F,UAAWtI,GAAyCE,KAAKmpG,cAAcrpG,IAC1EE,KAAKyvG,YAAczvG,KAAKiuG,cAAcxO,KACnCr3F,UAAWtI,GAAyCE,KAAKqpG,YAAYvpG,IACxEE,KAAK0vG,gBAAkB1vG,KAAKiuG,cAAc3O,SACvCl3F,UAAWtI,GAAyCE,KAAK2vG,gBAAgB7vG,IAC5EE,KAAKiuG,cAAcxhC,SAASzsE,KAAK0F,IAAIq3C,IAM/ByvD,+BACqB,IAAvBxsG,KAAKwvG,eAAgCxvG,KAAKwvG,cAAc9mG,mBACnC,IAArB1I,KAAKyvG,aAA8BzvG,KAAKyvG,YAAY/mG,mBAC3B,IAAzB1I,KAAK0vG,iBAAkC1vG,KAAK0vG,gBAAgBhnG,mBAElC,IAA1B1I,KAAKytG,mBACqC,IAAxCztG,KAAKylG,kBAAkB3jG,MAAMvB,QAE/BP,KAAKwmG,kBAAkBxmG,KAAKytG,iBADPztG,KAAKylG,kBAAkB3jG,MAAM,IAGpD9B,KAAKqvG,4BAA4BrvG,KAAKytG,mBAGxCztG,KAAK+tG,aAAa73F,QAElBlW,KAAKoR,MAAM+M,uBAAuB0rD,IAElC7pE,KAAKytG,sBAAmB,EACxBztG,KAAKiuG,cAAcxhC,cAAS,GAOtB08B,cAActpG,GACpBG,KAAKs+F,YAAYz+F,GAOX8vG,gBAAgB9vG,GACtBG,KAAKkvG,cAAcrvG,GAObwpG,YAAYxpG,GAClBG,KAAKqvG,4BAA4BxvG,GAG3BwvG,4BAA4BxvG,GAClC,MAAMC,EAAUwvG,GAAkBzvG,EAAYG,KAAKypD,YACnDzpD,KAAKquG,0BAA0BxuG,EAAYC,GAQrCuuG,0BAA0BxuG,EAAsCC,GACtED,EAAWo6E,cAAc,CAAC21B,SAAU9vG,IAAU,GAC9CE,KAAK0tG,2BAA2B7tG,GAM1BsvG,gBACNnvG,KAAKuvG,SAASpnG,KAAK,IAQbq+F,kBAAkB3mG,EAAYC,GACpC,MAAMM,EAAYN,EAAeA,EAAaqnB,WAAWviB,GAAK/E,EAAWq1E,OACnE70E,EAAaL,KAAK0F,IAAIq3C,GAAGuW,UAAUia,gBACnCjtE,OAAeyrD,MAAYuY,oBAAoBzkE,EAAY,CAC/DikD,kBAAmBzjD,EACnBwjD,eAAgBxjD,IAElBL,KAAKoR,MAAMsI,OAAO,CAChB5U,KAAM83C,GACNqI,WACAwE,WAAYppD,EAAWkhD,UACvBp6B,WAAY,CACVviB,GAAIxE,EACJyrG,QAAShsG,EAAW4J,IAAI,aAE1BoP,KAAM,CACJjU,GAAIxE,KAWFstG,2BAA2B7tG,GACjC,MAAMC,EAAUD,EAAW4J,IAAI,YACzBrJ,EAAUN,EAAQyiG,QAClBliG,EAAOP,EAAQwiG,KAEfhiG,Wf3dkCS,GAC1C,MAAMO,EAAcuuG,GAA0B9uG,GAC9C,IAAIlB,EAAW,GACf,OAAIkB,aAAsBqiF,KAC1BvjF,EAAW,QACAkB,aAAsBuiF,QAC/BzjF,EAAW,aAEMyB,EAAYoE,IAAKtF,IAClC,IAAIC,EAAYD,EAAWqJ,IAAI,YAC/B,YAAkB,IAAdpJ,EACFA,EAAYyvG,GAAuB1vG,GAAY,EAAOP,GAEtDQ,EAAU0iG,YAAY3iG,EAAW2mF,sBAE5B1mF,Ie4cDC,CAAkDT,GACxD,GAAIO,EAAQG,SAAWD,EAAoBC,OACzC,QAASC,EAAI,EAAGA,EAAIF,EAAoBC,OAAQC,IAAK,CACnD,MAAMkD,EAAStD,EAAQI,QACR,IAAXkD,GACF1D,KAAK+vG,gBACHzvG,EAAoBE,GACpBorG,GAAaloG,EAAQ1D,KAAK0rG,kBAC1B1rG,KAAK0rG,iBACLtL,GAAYC,aAMP,IAAThgG,GACFL,KAAK+vG,yBfpb6BhvG,GACtC,MAAMO,WAnB+BP,GACrC,IAAIO,EAAWP,EAAW0I,IAAI,WAC9B,MAAM5J,GAAmBmwG,SAAYjvG,EAAW80D,aAChD,YAAiB,IAAbv0D,EACFA,EAASohG,eAAe7iG,IAExByB,EAAW,IAAIywE,KAAQlyE,GACvBkB,EAAW0U,IAAI,UAAWnU,IAGrBA,EASDA,CAAkCP,GACxC,IAAIlB,EAAYyB,EAASmI,IAAI,YAC7B,YAAkB,IAAd5J,EACFA,EAAYiwG,GAAuBxuG,GAAU,GAE7CzB,EAAUkjG,YAAYzhG,EAASylF,sBAE1BlnF,Ee4aEkwG,CACqBlwG,GACxBksG,GAAmB1rG,EAAML,KAAK8rG,gBAC9B9rG,KAAK8rG,eACL1L,GAAY2O,MAQVkB,yBAAyBpwG,GAC/BinG,GAAwBjnG,GAAYiG,QAAShG,IACvCE,KAAKkwG,kBAAkBpwG,IACzBE,KAAK0F,IAAIq3C,GAAGozD,WAAWrwG,KASrBquG,0BAA0BtuG,GAChCinG,GAAwBjnG,GAAYiG,QAAShG,SACzB,IAAdA,QAAkD,IAAvBA,EAAUs9D,UACvCp9D,KAAK0F,IAAIq3C,GAAG6lD,cAAc9iG,KAQxBwsG,yBAAyBzsG,GAC/BA,EAASuwG,eAAgBtwG,IACvBE,KAAK0tG,2BAA2B5tG,EAAUiyD,iBAOtCs+C,uBAAuBxwG,GAC7BA,EAASuwG,eAAgBtwG,IACvBE,KAAKiwG,yBAAyBnwG,EAAUiyD,iBAQpCq9C,wBAAwBvvG,GAC9BA,EAASuwG,eAAgBtwG,SAEJ,IADAA,EAAUiyD,eAE3B/xD,KAAKmuG,0BAA0BruG,EAAUiyD,iBAWvCg+C,gBACNlwG,EACAC,EACAM,EACAC,GAEAR,EAAUo6E,cAAc,CAAC21B,SAAU9vG,EAASwwG,MAAOlwG,EAAMmwG,MAAOlwG,IAAO,GACvER,EAAUg8B,aAAarL,UAAYxwB,KAAKwwG,wBAAwB3wG,GAC5DG,KAAKkwG,kBAAkBrwG,IACzBG,KAAK0F,IAAIq3C,GAAGozD,WAAWtwG,GASnB2wG,wBAAwB3wG,GAC9B,MAAMC,EAAaD,EAAUkrD,gBAC7B,OAAO4gD,GAAc7rG,EAAW8vG,SAAU,CACxChO,QAAS,EACTK,KAAMniG,EAAWwwG,MACjBpO,UAAU,EACV5vD,OAAQ,MACPtyC,KAAK+P,iBASFmgG,kBAAkBrwG,GACxB,IAA0B,IAAtBG,KAAKywG,aACP,OAAO,EAGT,MAAM3wG,EAAaD,EAAUkrD,gBACvB3qD,EAAUN,EAAW8vG,SAC3B,QAAgB,IAAZxvG,EACF,OAAO,EAGT,GAAIN,EAAWwwG,QAAUlQ,GAAYC,OAAQ,CAC3C,MAAMhgG,EAAmBurG,GAAa5rG,KAAK0wG,iBAAkB5wG,EAAWwwG,QAAU,EAClF,OAAOlwG,EAAUmH,KAAKyb,IAAI3iB,EAAkB,GAG9C,OAAO,gDAl9BEU,GAAiBrB,2DAAjBqB,EAAiBugB,uoCDvE9B5hB,eACEA,iBACEA,qCAEEA,kCAAUI,iCACVJ,+BACEA,8BACFA,QACAA,+BACEA,8BACFA,QACFA,QACFA,QAEAA,iBACEA,+BAIEA,kCAAUI,mCACVJ,gCACFA,QAEAA,mDAEAA,wDAOAA,qEAEAA,wDAOAA,wDAOAA,mDAEAA,+BAGEA,kCAAUI,wCACVJ,gCACFA,QACFA,QAEAA,oDAoBAA,qEAEAA,kBACEA,gEASAA,iEAgBFA,QAEAA,mCAMFA,eA/GMA,4CAEmBA,6CACjBA,4EAEiBA,2CACjBA,0EAOFA,mDAAkC,gCAAlCA,CAAkC,0BAIlCA,oEAGYA,+CAEKA,+CAOLA,wEAEKA,+CAOAA,+CAOLA,+CAGZA,6CAA4B,0BAG5BA,uEAIWA,+CAoBDA,wEAGHA,wEASAA,wEAqBTA,gCAAe,i4BCxCNqB,MC3DA4vG,iBAKX5rF,UACEllB,EAAeC,EACfM,GAAoB,EACpBC,EAAkB,GAElB,IAAIC,EACJ,OAAIsF,OAAO+V,OAAOilF,IAAiB1gG,QAAQJ,IAA4B,EACrEQ,EAAMyrG,GAAmBlsG,EAAOC,GACvB8F,OAAO+V,OAAO2kF,IAAmBpgG,QAAQJ,IAA8B,IAChFQ,EAAMsrG,GAAa/rG,EAAOC,IAGrBQ,GAAMqrG,GAAcrrG,EAAK,CAC9BshG,QAAS,EACTK,OACAC,WACA5vD,OAAQ,qDArBDvxC,oDAAiBwkB,UAAjBxkB,4BCwCA6vG,iBAkMX7oG,YACUlI,EACmBC,GADnBE,aACmBA,iBAjMrBA,eAAY,IAAI+rD,KAChB/rD,YAAQ,EAORA,eAAYA,KAAK6wG,uBAkChB7wG,eAAoB,KAKpBA,cAAmB,EAmBpBA,2BAAgC,EA8B/BA,oBAAuC,GA2JxCA,cAAgB,OAShBA,eAAiB,YAjEA,IAAnBA,KAAK8wG,YAGP9wG,KAAK8wG,UAAUn0F,cAAgB3c,uBA7KlBH,GACfG,KAAK+wG,cAAgBlxG,GACF,IAAfG,KAAK67F,QAIT77F,KAAKgxG,oBACLhxG,KAAKglG,oBACLhlG,KAAK+kG,YAAYlH,UAAU11F,KAAKnI,KAAKixG,sBACrCjxG,KAAKkxG,oCAEqC,OAAOlxG,KAAK+wG,wCAiBnB,OAAO/wG,KAAKmxG,6CACzBtxG,GAEtB,GADAG,KAAKmxG,qBAAuBtxG,GACT,IAAfG,KAAK67F,MAIT,IADA77F,KAAKgxG,qBACAhxG,KAAKmxG,qBACR,OAEAnxG,KAAKkxG,iBAFLD,2BAWkC,OAAOjxG,KAAKoxG,+CACzBvxG,GACvBG,KAAKoxG,sBAAwBvxG,EAC7BG,KAAKgxG,oBAELhxG,KAAKglG,oBACLhlG,KAAKqsG,sBAELrsG,KAAK+kG,YAAYlH,UAAU11F,KAAKnI,KAAKixG,uBAElB,IAAfjxG,KAAK67F,SAIJ77F,KAAKomG,qBAGVpmG,KAAKkxG,+BAaOrxG,QACE,IAAVA,IACFA,EAAQwxG,MAEVrxG,KAAKsxG,WAAazxG,EAElB,MAAMC,EAAeE,KAAKuxG,2BAA2B1xG,GAEnDG,KAAKwxG,4BADc,IAArB1xG,EACgCA,EAAawyD,YAEb,MAGb,IAAftyD,KAAK67F,QAIT77F,KAAKgxG,oBACLhxG,KAAKglG,oBACLhlG,KAAKqsG,sBAELrsG,KAAK+kG,YAAYlH,UAAU11F,KAAKnI,KAAKixG,sBACrCjxG,KAAKkxG,iCAEsF,OAAOlxG,KAAKsxG,4BAQxFzxG,GAAoFG,KAAKyxG,cAAgB5xG,qBAC1B,OAAOG,KAAKyxG,wBAQlG5xG,GACRG,KAAK0xG,OAAS7xG,GACK,IAAfG,KAAK67F,QAILh8F,EACFG,KAAK2xG,oBAAoB9xG,GAEzBG,KAAK+nG,gBAAgB7xF,OAAM,GAE7BlW,KAAKgmB,SAASnmB,GACdG,KAAKkxG,gBACLlxG,KAAKkf,MAAMD,6BAEkB,OAAOjf,KAAK0xG,6BAQzC,OAAO1xG,KAAK4nG,eAAex8C,uBAIlBvrD,GACT,IAAmB,IAAfG,KAAK67F,QAGL77F,KAAKiuG,cAAc7iD,aACrBprD,KAAKiuG,cAAc7iD,YAAY3hC,UAE7BzpB,KAAKixG,sBAAsB,CAC7B,IAAInxG,EACJq3E,WAAW,KACTr3E,EAAWE,KAAKiuG,cAAcrP,oBAC1B9+F,GACEA,EAAS8xG,YACX9xG,EAAS8xG,UAAU17F,QACnBlW,KAAK2xG,oBAAoB3xG,KAAK8B,SAGjC,IAoBP0e,gBACyB,IAAnBxgB,KAAK+oG,YACP/oG,KAAK+oG,UAAYsI,WAGO,IAAtBrxG,KAAK6xG,eACP7xG,KAAK6xG,aAAe7xG,KAAK+oG,WAG3B/oG,KAAK8xG,oBACL9xG,KAAKglG,oBACLhlG,KAAKqsG,sBAEDrsG,KAAK8B,OACP9B,KAAK2xG,oBAAoB3xG,KAAK8B,OAEhC9B,KAAKkxG,gBAELlxG,KAAK67F,OAAQ,EAOf1jF,cAKEnY,KAAK67F,OAAQ,EAEb77F,KAAKgxG,oBACLhxG,KAAK+nG,gBAAgB7xF,QACrBlW,KAAK0F,IAAIq3C,GAAG4sB,YAAY3pE,KAAK4nG,gBAO/BmK,iBAAiBlyG,GACfG,KAAKgmB,SAAWnmB,EAQlBmyG,kBAAkBnyG,GAChBG,KAAKiyG,UAAYpyG,EAOnBqyG,WAAWryG,GACTG,KAAK8B,MAAQjC,EAMPiyG,oBACN9xG,KAAK4nG,eAAiB,IAAInK,KAAc,CACtCnhF,OAAQ,IAAIqhF,KACZ5uC,OAAQ,IACR1+B,MAAO,OAETrwB,KAAK0F,IAAIq3C,GAAGsoB,SAASrlE,KAAK4nG,gBAMpB5C,oBACN,MAAMnlG,EAAiB+F,OAAOU,OAAO,GAAItG,KAAKmyG,eAAgB,CAC5DlV,aAAcj9F,KAAKi9F,cAAgB,QACnCH,aAAc98F,KAAK4nG,eACnB1J,iBAA4C,mBAAnBl+F,KAAK+oG,UAA2B/oG,KAAK+oG,UAAY,CAACjpG,EAAkCM,KAC3G,MAAMC,EAAQL,KAAK+oG,UACnB,YAAKqJ,6BAA6B/xG,EAAOD,GAClCC,KAGXL,KAAK+kG,YAAc,IAAIG,GAAYrlG,GAM7BwsG,sBACN,MAAMxsG,EAAiB+F,OAAOU,OAAO,GAAItG,KAAKmyG,eAAgB,CAC5D11D,MAAOz8C,KAAK4nG,eACZmB,UAAqC,mBAAnB/oG,KAAK+oG,UAA2B/oG,KAAK+oG,UAAY,CAACjpG,EAAkCM,KACpG,MAAMC,EAAQL,KAAK+oG,UACnB,YAAKqJ,6BAA6B/xG,EAAOD,GAClCC,KAGXL,KAAKiuG,cAAgB,IAAIa,GAAcjvG,GAMjCqxG,gBACN,IAAIrxG,EAEFA,GADGG,KAAK8B,OAAS9B,KAAKi9F,aACXj9F,KAAK+kG,YAEL/kG,KAAKiuG,cAOdpuG,IAAaG,KAAKqyG,gBACpBryG,KAAKgxG,oBACLhxG,KAAKsyG,gBAAgBzyG,IAQjByyG,gBAAgBzyG,GACtBG,KAAKqyG,cAAgBxyG,EACrBG,KAAKuyG,iBAAmB1yG,EAAQ4/F,KAC7Br3F,UAAWtI,GAA2BE,KAAKwyG,iBAAiB1yG,KAC1C,IAAjBE,KAAK6rG,SAAoBhsG,IAAYG,KAAK+kG,cAC5C/kG,KAAKyyG,oBAAsB5yG,EAAQy/F,SAChCl3F,UAAWtI,GAA8DE,KAAK0yG,oBAAoB5yG,KAEvGD,EAAQ4sE,SAASzsE,KAAK0F,IAAIq3C,IAAI,GAMxBi0D,oBACNhxG,KAAK2yG,4BACsB,IAAvB3yG,KAAKqyG,eACPryG,KAAKqyG,cAAc5lC,cAAS,QAEA,IAA1BzsE,KAAKuyG,kBACPvyG,KAAKuyG,iBAAiB7pG,mBAES,IAA7B1I,KAAKyyG,qBACPzyG,KAAKyyG,oBAAoB/pG,cAE3B1I,KAAKqyG,mBAAgB,EAOfG,iBAAiB3yG,GACvBG,KAAK2yG,uBACL3yG,KAAKwoG,cAAc3oG,GAOb6yG,oBAAoB7yG,GACG,UAAzBA,EAAWwyD,WACbryD,KAAK4yG,qBAAqB/yG,GAStB2oG,cAAc3oG,GACpB,IAAIC,OACe,IAAfD,IAIyB,WAAzBA,EAAWwyD,YACbxyD,EAAaG,KAAK6yG,cAAchzG,IAGlCC,EAAQE,KAAK8yG,UAAUxuC,oBAAoBzkE,EAAY,CACrDikD,kBAAmB9jD,KAAK0F,IAAI+jD,WAC5B5F,eAAgB,cAEdhkD,EAAW4J,IAAI,YACjB3J,EAAMiuD,OAASluD,EAAW4J,IAAI,UAC9B5J,EAAW4V,IAAI,SAAU3V,EAAMiuD,SAEjC/tD,KAAKkyG,WAAWpyG,IAGV+yG,cAAchzG,GACpB,MAAMC,EAASD,EAAW2tE,YACpBptE,EAAcytD,MAAiB/tD,EAAQE,KAAK0F,IAAI+jD,WAAY,aAC5DppD,EAASkH,KAAKE,MAAM5H,EAAWyyD,YAAe/qD,KAAK68F,IAAK78F,KAAKo0D,GAAK,IAAOv7D,EAAY,KAG3F,SAAa,IAAIs8F,KAAM58F,IACZ2V,IAAI,SAAUpV,GAAQ,GAC1BR,EAOD8xG,oBAAoB9xG,GAC1B,MAAMC,EAAaE,KAAK8yG,UAAUlvD,aAAa/jD,EAAU,CACvDgkD,eAAgB,YAChBC,kBAAmB9jD,KAAK0F,IAAI+jD,aAExBrpD,EAAY,IAAI4qE,KAAU,CAC9B/lB,SAAUnlD,IAEZM,EAAU2yD,SAAS/yD,KAAK6xG,cACxB7xG,KAAK+nG,gBAAgB7xF,QACrBlW,KAAK+nG,gBAAgBnvC,WAAWx4D,GAM1BywG,uBACN,OAAO,IAAIhO,KAAU,CACnBnnE,QAAS95B,SAASC,cAAc,OAChCm7B,OAAQ,EAAC,IAAK,IACdd,UAAW,CACT,kBACA,2BACAp7B,KAAK,KACPgiG,WAAW,IAQP8P,qBAAqB/yG,GAE3B,MAAMO,EADUkvG,GAAkBzvG,EAAYG,KAAK0F,IAAI+jD,YAC/B84C,QAClBliG,EAAqC,YAAzBR,EAAWwyD,UAA0BjyD,EAAQG,OAAS,EAAIH,EAAQG,OAAS,EACvFD,EAAaF,EAAQC,GAErBG,EAAcqvG,GAA0BhwG,GACxC6D,EAAiBlD,EAAYH,GACnC,GAA2B,IAAvBG,EAAYD,aAAmC,IAAnBmD,EAE9B,YADA1D,KAAK2yG,uBAIP3yG,KAAK+yG,UAAUhQ,YAAYr/F,EAAeqjF,sBAE1C,MAAMnjF,EAAY+nG,GAAcrrG,EAAY,CAC1CshG,QAAS,EACTK,KAAM3B,GAAkBC,OACxB2B,UAAU,EACV5vD,OAAQ,OAEVtyC,KAAK+yG,UAAUl3E,aAAarL,UAAY5sB,OACR,IAA5B5D,KAAK+yG,UAAU31C,UACjBp9D,KAAK0F,IAAIq3C,GAAGozD,WAAWnwG,KAAK+yG,WAOxBJ,uBACF3yG,KAAK+yG,UAAU31C,aAAsC,IAA5Bp9D,KAAK+yG,UAAU31C,WAC1Cp9D,KAAK0F,IAAIq3C,GAAG6lD,cAAc5iG,KAAK+yG,WAC/B/yG,KAAK+yG,UAAUxiD,YAAO,IASlB6hD,6BACNvyG,EAGAC,GACA,MAAMM,EAAeJ,KAAKuxG,2BAA2B1xG,GACrD,QAAqB,IAAjBO,EACF,OAGF,MAAMC,EAAYL,KAAKgzG,UACvB,IAAI1yG,EAEFA,GADGD,GAAaA,EAAY,EACnBL,KAAKwxG,uBAELnxG,EAAY,EAAIA,EAAYP,EAAaO,EAEpDD,EAAamyD,UAAUjyD,GAOjB2yG,kBAAkBpzG,GACxB,MAA0B,mBAAZA,GAA0BA,EAAQ0yD,UAO1Cg/C,2BACN1xG,GAMA,GAHIsE,MAAM4B,QAAQlG,KAChBA,EAAUA,EAAQ,IAEhBG,KAAKizG,kBAAkBpzG,GACzB,OAAOA,gDA9hBAkB,GAA+BrB,uDAA/BqB,EAA+BugB,sXCpD5C5hB,mEDoDaqB,MEdAmyG,2HApBF,CACPlmG,KACAqZ,MACAA,MACA5mB,KACAosB,MACA0I,KACAvF,KACAs4E,MACA36F,OAWS5L,MCtBAoyG,4HAFA,GAAE5jF,SARJ,CACPviB,KACAkmG,IAGAA,MAKSnyG,gCChBbrB,yCAOEA,sBACFA,8BAHEA,yDAAoD,iBAE1CA,6DAKVA,wDAGEA,mBAAgB,4CALpBA,mBAEEA,yCAMFA,8BALKA,uECAQ0zG,iBAiCXrrG,cANS/H,WAAgB,UAEhBA,aAAkB,EAEpBA,yBAAqB,cA1B1B,MAAMH,EAASG,KAAK4O,QAAQi6C,WAC5B,GAAIhpD,GAAUA,EAAOu+B,QACnB,OAAO,cAQT,OAAOp+B,KAAKo8C,iBAEJv8C,GACRG,KAAKo8C,OAASv8C,EACVA,IACFG,KAAK4O,QAAU5O,KAAKy8C,MAAM/1B,WAAW9X,SAezC4R,WACExgB,KAAK4O,QAAU5O,KAAKy8C,MAAM/1B,WAAW9X,sDApC5B7N,8BAAyBugB,uqBDbtC5hB,2BAUAA,+BAVSA,uEAWRA,kHCEYqB,+CCZXrB,iBACEA,0BACEA,uCACAA,kCACAA,mBAGEA,oEAAkB,6FAHpBA,QAQFA,QAEFA,4CAZ+BA,wBACSA,8BAElCA,mEACAA,6BAAoC,iBAApCA,CAAoC,YAApCA,CAAoC,uDAU1CA,eACEA,iBACEA,0BACEA,uCACAA,kCACAA,oBAGEA,yEAAuB,uDAAvBA,CAAuB,6FAHzBA,QASFA,QACFA,QAEAA,iBACEA,0BACEA,wCACAA,oCACAA,oBAGEA,uEAAqB,8FAHvBA,QAQFA,QACFA,QACFA,wDA5BiCA,wBACYA,8BAErCA,yEACAA,6BAAuC,sBAAvCA,CAAuC,YAAvCA,CAAuC,2BAYdA,wBACYA,8BAErCA,wEACAA,6BAAuC,oBAAvCA,CAAuC,0BAAvCA,CAAuC,wCAxCjDA,eACEA,wBAgBAA,0BAgCFA,8BAhDQA,kCAgBAA,4DAuCUA,yBAA0DA,SAAQA,kCAAtDA,iBAA8CA,4DAH1EA,iBACMA,0BACIA,yBAAoEA,oEAAkB,kGAChFA,gCACNA,QACJA,QACNA,iCAJsBA,mEAAwDA,wBAClBA,iEAShDA,yBAAyEA,SAAaA,kCAA1EA,iBAA6DA,6CAQzEA,yBAAmEA,SAAWA,kCAAlEA,iBAAuDA,4DAZ/EA,eACEA,iBACIA,0BACIA,yBAAyEA,yEAAuB,kGAC9FA,gCACFA,QACNA,QACFA,QAEAA,iBACAA,0BACIA,yBAAuEA,uEAAqB,kGACtFA,iCACNA,QACFA,QACFA,QACFA,iCAbsBA,wEAA6DA,6BACjBA,2CAOhDA,sEAA2DA,2BACfA,oEAtBhEA,eAEEA,wBAQAA,0BAkBFA,8BA1BQA,kCAQAA,4DAsCJA,gBAA+CA,SAAQA,+BAARA,iEAhBjDA,kBACEA,gBAAMA,SAAaA,QACnBA,yBASIA,8EAAwC,yEAG5CA,QACAA,gBAAMA,SAAWA,QACjBA,uBACAA,qBACEA,+BAAkBA,8FAGlBA,QACAA,sBAA0FA,gEACxFA,wBACDA,QACDA,sBAAyFA,mEACvFA,wBACFA,QACFA,QACFA,gCA5BQA,4BAIFA,8BACAA,yBAAiB,gBAAjBA,CAAiB,8BAAjBA,CAAiB,gBAAjBA,CAAiB,iDASfA,0BACFA,yCAGAA,6EAA6D,gBAA7DA,CAA6D,4BAA7DA,CAA6D,6BAGvDA,gEACIA,qCAEJA,gEACIA,gFAKlBA,iBACEA,yBAQIA,8EAAwC,kFAE5CA,QACAA,gBAAsBA,SAAyBA,QAC/CA,qBAAwCA,kEACvCA,uBACDA,QACFA,gCAZMA,8BACAA,mCAAyB,4BAAzBA,CAAyB,+BAOPA,wCAEXA,0CC1GA2zG,iBAqHXtrG,YAAoBlI,sBAhHbG,WAAQ,UASRA,eAA2B,GAC3BA,oBAAgC,GAChCA,kBAA8B,GAsB9BA,cAAW,cACXA,eAAY,SAETA,YAA4C,IAAIN,MAE1DM,gBAAsD,IAAIN,MA2ExDM,KAAKumB,YAAYC,UAAU,uBAnGZ3mB,GACf,GAAIA,GACEG,KAAK8E,OAASi4D,GAAeu2C,KAAM,CACrC,MAAMxzG,EAAaD,EAAM8D,MAAM,KAC/B,GAAI7D,EAAWS,OAAS,EAAG,CACzB,MAAMH,EAAY,IAAIiG,KAAKvG,EAAW,IAChCO,EAAU,IAAIgG,KAAKvG,EAAW,IAC/ByzG,MAAMnzG,EAAU2W,aACnB/W,KAAKwzG,UAAYpzG,GAEdmzG,MAAMlzG,EAAQ0W,aACjB/W,KAAKyzG,QAAUpzG,gBAiBvB,YAA6B,IAAtBL,KAAK4O,QAAQ9J,KAChBi4D,GAAeC,KACfh9D,KAAK4O,QAAQ9J,mBAIjB,YAA8B,IAAvB9E,KAAK4O,QAAQwyD,OAClBphE,KAAK4O,QAAQyhB,QAAU4sC,GAAgBy2C,QAErC1zG,KAAK4O,QAAQwyD,kBAIjB,YAA8B,IAAvBphE,KAAK4O,QAAQyhB,MAChB4sC,GAAgBy2C,OAChB1zG,KAAK4O,QAAQyhB,iBAIjB,IAAIxwB,EAAO,MACX,QAA0B,IAAtBG,KAAK4O,QAAQi2C,KACf,OAAQ7kD,KAAK8E,WACNi4D,GAAeC,UACfD,GAAesE,SAClBxhE,EAAO,MACP,WACGk9D,GAAetR,KAClB5rD,EAAO,KACP,WACGk9D,GAAeu2C,KAClBzzG,EAAO,QACP,cAEAA,EAAO,WAGXA,EAAOG,KAAK2zG,kBAAkB3zG,KAAK4O,QAAQi2C,MAG7C,OAAOhlD,qBAIP,YAAqC,IAA9BG,KAAK4O,QAAQglG,aAChB,IACA5zG,KAAK4O,QAAQglG,uBAIjB,GAAI5zG,KAAK4O,QAAQqU,IAAK,CACpB,MAAMpjB,EAAM,IAAIwG,KAAKrG,KAAK4O,QAAQqU,KAClC,OAAO,IAAI5c,KAAKxG,EAAIswC,UAAsC,IAA1BtwC,EAAIg0G,sBAEpC7wF,UAKF,GAAIhjB,KAAK4O,QAAQoU,IAAK,CACpB,MAAMnjB,EAAM,IAAIwG,KAAKrG,KAAK4O,QAAQoU,KAClC,OAAO,IAAI3c,KAAKxG,EAAIswC,UAAsC,IAA1BtwC,EAAIg0G,sBAEpC/pG,SAKF,YAA8B,IAAvB9J,KAAK4O,QAAQwyD,OAA8BphE,KAAK4O,QAAQwyD,MAOjE5gD,WAgBE,QAfuB,IAAnBxgB,KAAKwzG,YACPxzG,KAAKwzG,UAAY,IAAIntG,KAAKrG,KAAKijB,WAEZ,IAAjBjjB,KAAKyzG,UACPzzG,KAAKyzG,QAAU,IAAIptG,KAAKrG,KAAKgjB,WAER,IAAnBhjB,KAAK8zG,YACP9zG,KAAK8zG,UAAY,IAAIztG,KAAKrG,KAAKwzG,WAAW7a,cAC1C34F,KAAK+zG,cAAgB/zG,KAAK8zG,gBAEP,IAAjB9zG,KAAKg0G,UACPh0G,KAAKg0G,QAAU,IAAI3tG,KAAKrG,KAAKyzG,SAAS9a,cACtC34F,KAAKi0G,YAAcj0G,KAAKg0G,SAGrBh0G,KAAKk0G,QAIH,CACL,QAASr0G,EAAIG,KAAK8zG,UAAWj0G,EAAIG,KAAKg0G,QAASn0G,IAC7CG,KAAKm0G,eAAevzG,KAAKf,GAE3B,QAASA,EAAIG,KAAK8zG,UAAY,EAAGj0G,GAAKG,KAAKg0G,QAASn0G,IAClDG,KAAKo0G,aAAaxzG,KAAKf,QARzB,QAASA,EAAIG,KAAK8zG,UAAWj0G,GAAKG,KAAKg0G,QAAU,EAAGn0G,IAClDG,KAAKq0G,UAAUzzG,KAAKf,GAUxBG,KAAK4O,QAAQwvB,aACc,IAAzBp+B,KAAK4O,QAAQwvB,SAA+Bp+B,KAAK4O,QAAQwvB,QAC3Dp+B,KAAKs0G,mBACDt0G,KAAK4O,QAAQwvB,SACVp+B,KAAKk0G,SAA0B,WAAfl0G,KAAKqwB,OAAoC,SAAdrwB,KAAK8E,MACnD9E,KAAKu0G,WAAWr8F,KAAKlY,KAAKw0G,OAG5Bx0G,KAAKy0G,0BACLz0G,KAAKu0G,WAAWr8F,UAAK,IAIzBu8F,2BAGKz0G,KAAKk0G,SACNl0G,KAAKqwB,QAAU4sC,GAAgBy2C,QAC/B1zG,KAAK8E,OAASi4D,GAAeu2C,OAE7BtzG,KAAK4O,QAAQ9M,MAAQ9B,KAAKw0G,KAAKvxG,YAInCqxG,mBAEE,MAAMx0G,EAAcE,KADEy8C,MAAM/1B,WAAWq2B,GACVwO,YAAYE,KACzC,GACGzrD,KAAKk0G,SACNl0G,KAAKqwB,QAAU4sC,GAAgBy2C,QAC/B1zG,KAAK8E,OAASi4D,GAAeu2C,MAOoB,GAGjDtzG,KAAKk0G,SACLl0G,KAAKqwB,QAAU4sC,GAAgBC,UAC/Bl9D,KAAK8E,OAASi4D,GAAeu2C,MAEzBxzG,EAAa,CACfE,KAAK8zG,UAAYvrF,SAASzoB,EAAY4M,OAAO,EAAG,GAAI,IACpD1M,KAAKg0G,QAAUzrF,SAASzoB,EAAY4M,OAAO,EAAG,GAAI,IAClD,MAAMtM,EAA2B,GAC3BC,EAAyB,GAC/B,QAASC,EAAIN,KAAK+zG,cAAezzG,EAAIN,KAAKg0G,QAAS1zG,IACjDF,EAAkBQ,KAAKN,GAEzB,QAASA,EAAIN,KAAK8zG,UAAY,EAAGxzG,GAAKN,KAAKi0G,YAAa3zG,IACtDD,EAAgBO,KAAKN,GAEvBN,KAAKm0G,eAAiB/zG,EACtBJ,KAAKo0G,aAAe/zG,QAvBpBL,KAAKw0G,KADH10G,EACU,IAAIuG,KAAKvG,EAAYmD,YAAY01F,cAAgB,EACpD34F,KAAK4O,QAAQ9M,MACV,IAAIuE,KAAKrG,KAAK4O,QAAQ9M,MAAMmB,YAAY01F,cAAgB,EAExD,IAAItyF,KAAKrG,KAAKijB,KAAK01E,cAAgB,EAyBrD+b,iBAAiB70G,GACfG,KAAK20G,kBACL30G,KAAK40G,kBAIH50G,KAAK6E,OAAOqT,KADdlY,KAASk0G,QACU,CAACl0G,KAAKwzG,UAAWxzG,KAAKyzG,SAEtBzzG,KAAKwzG,WAI1BqB,iBAAiBh1G,GACf,GAAIG,KAAKk0G,QAAS,CAChBl0G,KAAKo0G,aAAe,GACpB,QAASt0G,EAAIE,KAAK8zG,UAAY,EAAGh0G,GAAKE,KAAKi0G,YAAan0G,IACtDE,KAAKo0G,aAAaxzG,KAAKd,GAEzBE,KAAKm0G,eAAiB,GACtB,QAASr0G,EAAIE,KAAK+zG,cAAgB,EAAGj0G,EAAIE,KAAKg0G,QAASl0G,IACrDE,KAAKm0G,eAAevzG,KAAKd,GAE3BE,KAAKu0G,WAAWr8F,KAAK,CAAClY,KAAK8zG,UAAW9zG,KAAKg0G,eAE3Ch0G,KAAKu0G,WAAWr8F,KAAKlY,KAAKw0G,MAI9BM,qBAAqBj1G,GACnBG,KAAK60G,iBAAiB,CAAC70G,KAAK8zG,UAAW9zG,KAAKg0G,UAG9Ce,0BAA0Bl1G,GACxBG,KAAK6E,OAAOqT,KAAK,CAAClY,KAAKwzG,UAAWxzG,KAAKyzG,UAGzCuB,aAAan1G,GACX,IAAIC,EACJ,OACEA,EADED,EACQ,IAAIwG,KAAKxG,GAET,IAAIwG,KAAKrG,KAAKijB,KAGnBnjB,EAAQqwC,UAGjB8kE,oBAAoBp1G,GAClB,MAAMC,EAAaE,KAAKk1G,eACtBl1G,KAAKm1G,SAASC,YAAY9yF,cAAc+yF,YAEtCv1G,IACFA,EAAWw1G,YAAcz1G,GAI7Bq1G,eAAer1G,GACb,IAAIC,EAEJ,SAAKgG,QAAQ1F,IACa,gCAApBA,EAAM87B,YACRp8B,EAAaM,GAGXA,EAAM22B,SAASx2B,OAAS,IAAMT,IAChCA,EAAaE,KAAKk1G,eAAe90G,EAAMi1G,cAExCr1G,MACIF,EAGTy1G,oBACEv1G,KAAK4O,QAAQwvB,SAAWp+B,KAAK4O,QAAQwvB,QAEjCp+B,KAAK4O,QAAQwvB,SAEZp+B,KAAKk0G,SACNj3C,GAAgBy2C,QAChB1zG,KAAK8E,OAASi4D,GAAeu2C,MAE7BtzG,KAAKu0G,WAAWr8F,KAAKlY,KAAKw0G,OAG5Bx0G,KAAKw1G,aACLx1G,KAAKy0G,0BACLz0G,KAAK6E,OAAOqT,UAAK,IAIrBu9F,YAAY51G,GACVG,KAAK01G,KAAO,IAAIrvG,KAAKrG,KAAKijB,KAC1BjjB,KAAKw0G,KAAOx0G,KAAK01G,KAAK/c,eAEnB34F,KAAKk0G,SACNj3C,GAAgBy2C,QAChB1zG,KAAK8E,OAASi4D,GAAeu2C,KAE7BtzG,KAAKu0G,WAAWr8F,KAAKlY,KAAKw0G,OAE1Bx0G,KAAK20G,kBACL30G,KAAK6E,OAAOqT,UAAK,IAIrBy9F,WAAW91G,GACLG,KAAK41G,SACP51G,KAAKw1G,cAELx1G,KAAK61G,SAAW,eAChB71G,KAAK41G,SAAWr6E,YACdz7B,IACE,IAAIM,EACJ,MAAMC,EAAgB,IAAIgG,KAAKvG,EAAKkjB,KAEpC5iB,OACgB,IAAdN,EAAK41G,KAAqB51G,EAAKmjB,IAAIktB,UAAYrwC,EAAK41G,KAAKvlE,UAC3D/vC,GAAoBN,EAAKq1G,SAAStwD,KAClC/kD,EAAK41G,KAAO,IAAIrvG,KAAKjG,GAEjBA,EAAmBC,EAAc8vC,WACnCrwC,EAAK01G,aAGP11G,EAAK40G,iBAAiB,CAAE5yG,MAAOhC,EAAK41G,KAAMA,KAAM51G,EAAK41G,QAEvD11G,KAAK4zG,aACL5zG,OAKN81G,SAASj2G,GAELG,KAAKw0G,KAAOx0G,KAAKm1G,SAAStwD,KAC1B7kD,KAAKgjB,IAAI21E,cAAgB34F,KAAKm1G,SAAStwD,OAEvC7kD,KAAKw1G,aACLx1G,KAAKy1G,YAAY51G,IAEfG,KAAK41G,SACP51G,KAAKw1G,cAELx1G,KAAK61G,SAAW,eAChB71G,KAAK41G,SAAWr6E,YAAY,KAEvBv7B,KAAKw0G,KAAOx0G,KAAKm1G,SAAStwD,KAAQ7kD,KAAKgjB,IAAI21E,cAC5C34F,KAAKw1G,aAELx1G,KAAKw0G,KAAOx0G,KAAKw0G,KAAOx0G,KAAKm1G,SAAStwD,KAExC7kD,KAAKu0G,WAAWr8F,KAAKlY,KAAKw0G,OAEzBx0G,KAAK4zG,aAAc5zG,OAI1Bw1G,aACMx1G,KAAK41G,UACPh6E,cAAc57B,KAAK41G,UAErB51G,KAAK41G,cAAW,EAChB51G,KAAK61G,SAAW,cAGlBE,uBAAuBl2G,GACrBG,KAAK01G,KAAO,IAAIrvG,KAAKxG,EAAMiC,OAC3B9B,KAAKi1G,oBAAoBj1G,KAAKg2G,uBAC9Bh2G,KAAK00G,iBAAiB70G,GAGxBo2G,uBAAuBp2G,GACrBG,KAAKw0G,KAAO30G,EAAMiC,MAClB9B,KAAKu0G,WAAWr8F,KAAKlY,KAAKw0G,MAG5B0B,oBACE,IAA6B,IAAzBl2G,KAAK4O,QAAQunG,UAAqBn2G,KAAKijB,IAAK,CAC9C,MAAMpjB,EAAc,IAAIwG,KACxBrG,KAAK01G,KAAO11G,KAAKo2G,eAAev2G,GAElC,OAAIG,KAAK8E,OAASi4D,GAAeu2C,KACxBtzG,KAAKw0G,UAES,IAAdx0G,KAAK01G,KAAqB11G,KAAKijB,IAAIktB,UAAYnwC,KAAK01G,KAAKvlE,UAIpE6lE,sBACE,IAAIn2G,EAEJ,OAAQG,KAAK8E,WACNi4D,GAAeC,KAClBn9D,OACgB,IAAdG,KAAK01G,KACD11G,KAAKijB,IAAIozF,eACTr2G,KAAK01G,KAAKW,eAChB,WACGt5C,GAAetR,KAClB5rD,OACgB,IAAdG,KAAK01G,KACD11G,KAAKijB,IAAIqzF,eACTt2G,KAAK01G,KAAKY,eAChB,cAGAz2G,OACgB,IAAdG,KAAK01G,KACD11G,KAAKijB,IAAIk+C,cACTnhE,KAAK01G,KAAKv0C,cAIpB,OAAOthE,EAGT80G,kBACM30G,KAAKqwB,QAAU4sC,GAAgBy2C,QACjC1zG,KAAKwzG,UAAY,IAAIntG,KAAKrG,KAAK01G,MAC/B11G,KAAKwzG,UAAU+C,YAAav2G,KAAK6kD,KAAO,KACxC7kD,KAAKyzG,QAAU,IAAIptG,KAAKrG,KAAKwzG,WAC7BxzG,KAAKyzG,QAAQ8C,WAAWv2G,KAAK6kD,KAAO,OAC1B7kD,KAAKk0G,SAAal0G,KAAK01G,MACjC11G,KAAKyzG,QAAU,IAAIptG,KAAKrG,KAAK01G,MAC7B11G,KAAKwzG,UAAY,IAAIntG,KAAKrG,KAAK01G,SACtB11G,KAAKk0G,UAAcl0G,KAAK01G,MAAS11G,KAAK01G,OAKrC11G,KAAK01G,OAJf11G,KAAKwzG,eACgB,IAAnBxzG,KAAKwzG,UAA0B,IAAIntG,KAAKrG,KAAKijB,KAAOjjB,KAAKwzG,UAC3DxzG,KAAKyzG,aACc,IAAjBzzG,KAAKyzG,QAAwB,IAAIptG,KAAKrG,KAAKgjB,KAAOhjB,KAAKyzG,SAS7DmB,kBACE,OAAQ50G,KAAK8E,WACNi4D,GAAeC,WACK,IAAnBh9D,KAAKwzG,gBAA4C,IAAjBxzG,KAAKyzG,WACvCzzG,KAAKwzG,UAAUgD,SAAS,GACxBx2G,KAAKwzG,UAAUiD,WAAW,GAC1Bz2G,KAAKwzG,UAAU+C,WAAW,GAC1Bv2G,KAAKyzG,QAAQ+C,SAAS,IACtBx2G,KAAKyzG,QAAQgD,WAAW,IACxBz2G,KAAKyzG,QAAQ8C,WAAW,KAE1B,WACGx5C,GAAetR,KAClB,GAAIzrD,KAAKqwB,QAAU4sC,GAAgBC,SAAU,CAC3C,GAAIl9D,KAAKwzG,UAAUkD,WAAa12G,KAAKijB,IAAIyzF,SAAU,CACjD,MAAM72G,EAAeG,KAAKwzG,UAAUmD,WAC9B72G,EAAiBE,KAAKwzG,UAAUoD,aACtC52G,KAAKwzG,UAAYxzG,KAAKijB,IACtBjjB,KAAKwzG,UAAUgD,SAAS32G,GACxBG,KAAKwzG,UAAUiD,WAAW32G,GAG5B,GAAIE,KAAKyzG,QAAQiD,WAAa12G,KAAKijB,IAAIyzF,SAAU,CAC/C,MAAM72G,EAAeG,KAAKyzG,QAAQkD,WAC5B72G,EAAiBE,KAAKyzG,QAAQmD,aACpC52G,KAAKyzG,QAAUzzG,KAAKijB,IACpBjjB,KAAKyzG,QAAQ+C,SAAS32G,GACtBG,KAAKyzG,QAAQgD,WAAW32G,KAIvBE,KAAKk0G,SAAWl0G,KAAK6kD,KAAO,OAC/B7kD,KAAKwzG,UAAUiD,WAAW,GAC1Bz2G,KAAKwzG,UAAU+C,WAAW,GAC1Bv2G,KAAKyzG,QAAQgD,WAAW,IACxBz2G,KAAKyzG,QAAQ8C,WAAW,MAShCM,kBACE,YAA0B,IAAnB72G,KAAKwzG,UAA0BxzG,KAAKijB,IAAMjjB,KAAKwzG,UAGxDsD,kBACE,YAAwB,IAAjB92G,KAAKyzG,QAAwBzzG,KAAKgjB,IAAMhjB,KAAKyzG,QAStD2C,eAAev2G,EAAMC,EAAW,IAC9B,MAAMM,EAAQ,IAAYN,EAC1B,OAAO,IAAIuG,KAAKkB,KAAKE,MAAM5H,EAAKswC,UAAY/vC,GAASA,GAQvDuzG,kBAAkB9zG,GAChB,OAAOggD,YAAgBhgD,GAAMk3G,+DArgBpBh2G,GAAuBrB,uCAAvBqB,EAAuBugB,0EA4CvB60E,MAAS,2lDDlEtBz2F,wBAmDAA,wBA+BEA,cACAA,0BA+BFA,+BAlHMA,oDAmDAA,6DAgCEA,uEA+BFA,88BC5FOqB,wFCVXrB,qBASEA,uIACAA,wCAIFA,iCAZEA,mDAA+C,wGAS7CA,4EAA4D,4HAvBlEA,yBACEA,sBAMEA,4EAEFA,QACAA,gBAAIA,yEAA0GA,SAAeA,QAE7HA,4BAgBFA,2CAvBIA,2BAAkB,gCAKgBA,6EAA0EA,8BAErGA,0DAoBPA,oDAA8CA,4BCpBrCs3G,iBAeXjvG,YAAoBlI,4BAdbG,WAAQ,UACfA,iBAAwC,IAAI+I,KAAgB,GAC5D/I,wBAA+C,IAAI+I,KAAgB,GAGnE/I,uBAA4B,EAEnBA,aAAkB,mBAKzB,OAAOA,KAAKy8C,MAAM/1B,WAIpBlG,WAEExgB,KAAK6wD,aADe7wD,KAAKy8C,MAAM/2C,IAAI2lD,eAAeyF,YAClB1oD,UAAU,KACxCpI,KAAK0uF,mBAAmBvmF,KAAKnI,KAAKy8C,MAAM4T,wBAI5Cl4C,cACEnY,KAAK6wD,aAAanoD,cAGpBmsG,iBAAiBh1G,GACfG,KAAKi3G,kBAAkBve,aAAa14F,KAAKk3G,WAAYr3G,GAGvD60G,iBAAiB70G,GACfG,KAAKi3G,kBAAkBze,aAAax4F,KAAKk3G,WAAYr3G,GAG/CgvF,aAAahvF,GACnBG,KAAKy8C,MAAM6S,gBAAkBzvD,EAC7BG,KAAKkvF,YAAY/mF,MAAMtI,GAGzBsvF,sBACOnvF,KAAKm3G,kBACRn3G,KAAK6uF,aAAa7uF,KAAKkvF,YAAYptF,OAIhCkuD,aACLhwD,KAAKy8C,MAAM71B,SAAU,EAGvBwwF,yBACEp3G,KAAKm3G,kBAAoBn3G,KAAKm3G,+DApDrBp2G,GAAuBrB,oCAAvBqB,EAAuBugB,uwBDZpC5hB,kCA8BAA,mBACEA,mBACEA,sDAEFA,QACAA,kCAIEA,kCAAUI,uBAAVJ,CAAmC,gCACrBI,wBAChBJ,QACFA,eA1CgBA,uBAgCOA,gDAInBA,gCAAgB,0CAAhBA,CAAgB,qTCxBPqB,+BCVTrB,2DAAsBA,mBAAe,gBCY5B23G,iBAWXtvG,YAAoBlI,gBAFZG,aAAmB,gBANzB,OAAOA,KAAKkwF,mBAEHrwF,GACTG,KAAKkwF,QAAUrwF,EACfG,KAAKkf,MAAMD,8DAPFle,GAAuBrB,uCAAvBqB,EAAuBugB,+MDdpC5hB,sBACEA,gEAGFA,eAJUA,uBAAoB,gBACCA,2FCalBqB,MCNAu2G,iBACXvvG,eAEOwvG,aAAa13G,EAAKC,EAASM,GAChC,WAAWqkF,MAAQ/rB,YAAY74D,EAAK,CAClCgkD,eAAgB/jD,EAChBgkD,kBAAmB1jD,IAGhBo3G,YAAY33G,EAAQC,EAAQM,GACjC,IAAIC,EAAgBwtD,MAAuB/tD,EAAQM,EAAYP,GAmB/D,OAlBAQ,EAAgBL,KAAKy3G,qBAAqBp3G,EAAeR,EAAQ,GAkB1D,CACL63G,QAlBc,oBACZ53G,EAAO,MAAMA,EAAO,cACpBA,EAAO,MAAMA,EAAO,cACpBA,EAAO,MAAMA,EAAO,cACpBA,EAAO,MAAMA,EAAO,cACpBA,EAAO,MAAMA,EAAO,OActB63G,QAbc,sBACZ73G,EAAO,MAAMA,EAAO,cACpBA,EAAO,MAAMA,EAAO,cACpBA,EAAO,MAAMA,EAAO,cACpBA,EAAO,MAAMA,EAAO,cACpBA,EAAO,MAAMA,EAAO,MAStB83G,eARqB,wBACjB93G,EAAO,MAAMA,EAAO,gBACpBA,EAAO,MAAMA,EAAO,gBACpBA,EAAO,MAAMA,EAAO,gBACpBA,EAAO,MAAMA,EAAO,OAQpB23G,qBAAqB53G,EAAiBC,EAAYM,EAAU,GAElE,MAAME,EADQutD,MAAW/tD,GACL8tE,WAEpB,OAA+B,IAA3B,CADa,KAAM,IAAK,SAChB1tE,QAAQI,KAClBT,EAAkBG,KAAK63G,WAAWh4G,EAAiBO,IAE9CP,EAGDg4G,WAAWh4G,EAAOC,EAAU,GAClC,IAAIM,EAAI,EACR,KAAOA,EAAIP,EAAMU,QACfV,EAAMO,GAAKP,EAAMO,GAAG4hG,QAAQliG,GAC5BM,IAEF,OAAOP,EAGFi4G,UAAUj4G,EAAMC,GAErB,IAAIM,EADJP,EAAOA,EAAKkH,cAEZ,MAAM1G,EAAK,CACT,EAAG,CAAE8O,MAAM,GAAKC,IAAI,IACpB,EAAG,CAAED,MAAM,GAAKC,IAAI,IACpB,EAAG,CAAED,MAAM,GAAKC,IAAI,IACpB,EAAG,CAAED,MAAM,GAAKC,IAAI,IACpB,EAAG,CAAED,MAAM,GAAKC,IAAI,IACpB,EAAG,CAAED,MAAM,GAAKC,IAAI,KACpB,EAAG,CAAED,MAAM,IAAMC,IAAI,KACrB,EAAG,CAAED,MAAM,IAAMC,IAAI,KACrB,EAAG,CAAED,MAAM,IAAMC,IAAI,KACrB,GAAI,CAAED,MAAM,IAAMC,IAAI,MAElB9O,EAAK,CACT,EAAG,CAAE6O,KAAM,GAAIC,GAAI,IACnB,EAAG,CAAED,KAAM,GAAIC,GAAI,IACnB,EAAG,CAAED,KAAM,GAAIC,GAAI,IACnB,EAAG,CAAED,KAAM,GAAIC,GAAI,IACnB,EAAG,CAAED,KAAM,GAAIC,GAAI,IACnB,EAAG,CAAED,KAAM,GAAIC,GAAI,IACnB,EAAG,CAAED,KAAM,GAAIC,GAAI,IACnB,EAAG,CAAED,KAAM,GAAIC,GAAI,IACnB,EAAG,CAAED,KAAM,GAAIC,IAAI,MAEf5O,EAAgB,CACpB,CAAC,IAAK,IAAK,IAAK,KAChB,CAAC,IAAK,IAAK,IAAK,KAChB,CAAC,IAAK,IAAK,IAAK,KAChB,CAAC,IAAK,IAAK,IAAK,MAGZkD,EAAe,CACnB,CAAC,KAAM,KAAM,KAAM,MACnB,CAAC,KAAM,KAAM,KAAM,MACnB,CAAC,KAAM,KAAM,KAAM,MACnB,CAAC,KAAM,KAAM,KAAM,OAMrB,IAAIM,GAAS,EACTW,GAAW,EACXm+C,GAAU,EAmBd,GAzBqB,2BAQJ59B,KAAKrlB,GACpBijD,GAAU,EARU,iBAUF59B,KAAKrlB,GACrB8E,GAAW,EAVK,YAYAugB,KAAKrlB,KACnBmE,GAAS,GAKXA,EACFnE,GAAQ,MACC8E,IACT9E,GAAQ,MAEN,2BAA2BqlB,KAAKrlB,GAAO,CACzC,MACMmjD,EAAOnjD,EAAK8D,MADF,eAEVs/C,EAASD,EAAK,GACdK,EAAWL,EAAK,GAAG,GACnBQ,EAAUR,EAAK,GAAGr/C,MAAM0/C,GAAU,GACxC,IAAIK,EAAY,EACM,IAAlBT,EAAO1iD,SACTmjD,EAAY,GAEd,MAAMuD,EAAShE,EAAOr7C,UAAU,EAAG87C,GAC7B4D,EAASrE,EAAOr7C,UAAU87C,GAC1BonB,EAAW,EACXvjB,EAAW,EACXC,EAAa,EACbL,EAAa,EACbC,EAAY,GACZgF,EAAY,IAClB,IAAIC,EAAc,EACdC,EAAc,EACdC,EAAa,EACbC,EAAa,EACjBhsD,EAAcsF,QAAQonD,KACc,IAA9BA,EAAQhtD,QAAQmjD,KAClBiJ,EAAc9rD,EAAcN,QAAQgtD,GACpCb,EAAca,EAAQhtD,QAAQmjD,MAGlC3/C,EAAaoC,QAAQonD,KACc,IAA7BA,EAAQhtD,QAAQsjD,KAClBgJ,EAAa9oD,EAAaxD,QAAQgtD,GAClCX,EAAaW,EAAQhtD,QAAQsjD,MAIjC,IAAIiJ,EAAkB,EAClBC,EAAkB,EAClBC,EAAiB,EACjBC,EAAiB,EACjBC,EAAgBie,EAChBhe,EAAgBvF,EAChB5iD,GACF8nD,EAAkBJ,EAAc7E,EAChCkF,EAAkBJ,EAAcnF,EAChCwF,EAAiB,EACjBC,EAAiB,EACjBC,EAAgBrF,EAChBsF,EAAgB3F,GACPrE,IACT2J,EAAkBJ,EAAc7E,EAChCkF,EAAkBJ,EAAcnF,EAChCwF,EAAiBJ,EAAanF,EAC9BwF,EAAiBJ,EAAaJ,EAC9BS,EAAgBzF,EAChB0F,EAAgBV,GAGlB,MAAMW,EAAkD,CACtDzgD,GAAI,CACFjM,EAAG4mD,GAAQ73C,GAAKq9C,EAAkBE,EAClCrsD,EAAGgnD,GAAQl4C,GAAKs9C,EAAkBE,IAoEtC,OAhEAG,EAAMpoB,GAAK,CACTooB,EAAMzgD,GAAG,GAAKugD,EACdE,EAAMzgD,GAAG,GAAKwgD,GAEhBC,EAAMjT,GAAK,CAACiT,EAAMzgD,GAAG,GAAIygD,EAAMzgD,GAAG,GAAKwgD,GACvCC,EAAMziD,GAAK,CAACyiD,EAAMzgD,GAAG,GAAKugD,EAAeE,EAAMzgD,GAAG,IAElDygD,EAAMzgD,GAAKuhD,MACT,CAACd,EAAMzgD,GAAG,GAAIygD,EAAMzgD,GAAG,IACvB,YACAxM,GAEFitD,EAAMpoB,GAAKkpB,MACT,CAACd,EAAMpoB,GAAG,GAAIooB,EAAMpoB,GAAG,IACvB,YACA7kC,GAEFitD,EAAMjT,GAAK+T,MACT,CAACd,EAAMjT,GAAG,GAAIiT,EAAMjT,GAAG,IACvB,YACAh6C,GAEFitD,EAAMziD,GAAKujD,MACT,CAACd,EAAMziD,GAAG,GAAIyiD,EAAMziD,GAAG,IACvB,YACAxK,GAIFitD,EAAMzgD,GAAKtM,KAAKy3G,qBAAqB1qD,EAAMzgD,GAAIxM,EAAQ,GACvDitD,EAAMpoB,GAAK3kC,KAAKy3G,qBAAqB1qD,EAAMpoB,GAAI7kC,EAAQ,GACvDitD,EAAMjT,GAAK95C,KAAKy3G,qBAAqB1qD,EAAMjT,GAAIh6C,EAAQ,GACvDitD,EAAMziD,GAAKtK,KAAKy3G,qBAAqB1qD,EAAMziD,GAAIxK,EAAQ,GAEvDM,EACE,YACA,CACE2sD,EAAMzgD,GAAGxL,KAAK,KACdisD,EAAMjT,GAAGh5C,KAAK,KACdisD,EAAMpoB,GAAG7jC,KAAK,KACdisD,EAAMziD,GAAGxJ,KAAK,KACdisD,EAAMzgD,GAAGxL,KAAK,MACdA,KAAK,KACP,KAqBK,CACL42G,UACAC,QArBA,cACA,CACE5qD,EAAMzgD,GAAGxL,KAAK,KACdisD,EAAMjT,GAAGh5C,KAAK,KACdisD,EAAMpoB,GAAG7jC,KAAK,KACdisD,EAAMziD,GAAGxJ,KAAK,KACdisD,EAAMzgD,GAAGxL,KAAK,MACdA,KAAK,KACP,IAcA82G,eAXA,cACA,CACE7qD,EAAMzgD,GAAGxL,KAAK,KACdisD,EAAMjT,GAAGh5C,KAAK,KACdisD,EAAMpoB,GAAG7jC,KAAK,KACdisD,EAAMziD,GAAGxJ,KAAK,MACdA,KAAK,KACP,oDAtPKC,gCAAUsI,QAAVtI,EAAU,qBAFT,SAEDA,gCC6CTrB,yBAMEA,SACFA,kCAJEA,uBAAqB,YAArBA,CAAqB,sBAGrBA,0EAGJA,qBAMEA,yEACIA,uBACNA,iCAHEA,oFAhCJA,6BAGEA,qEAA+B,eAA/BA,CAA6C,oEACd,IAE/BA,oBASAA,mMATAA,QAUAA,kCACAA,sFACEA,mDAQFA,QACAA,6BASFA,2CA/BEA,iCAGAA,4EAA8D,mCAA9DA,CAA8D,oBAA9DA,CAA8D,2EAA9DA,CAA8D,6HAWxCA,yDASnBA,yIAqBCA,6CAMIA,8BACJA,kCAHEA,qBAAsB,4DAEpBA,yFAYJA,yBAGIA,8BACJA,kCAFEA,sBACEA,+GAVVA,6BAGEA,yBAGEA,6FACEA,gCAKJA,QACFA,gCATIA,mDAAkC,4CAICA,2EAyBnCA,yBAKEA,SACFA,kCAHEA,iBAAe,gBAEfA,oEAGJA,qBAMEA,oEACIA,uBACNA,iCAHEA,oFA/BJA,6BAGAA,qEAA+B,kBAA/BA,CAAgD,oEACjB,IAE7BA,oBASEA,0GATFA,QAUAA,kCACEA,4FACAA,iDAOFA,QACAA,4BASFA,2CA9BAA,iCAGIA,sEAAwD,mCAAxDA,CAAwD,oBAAxDA,CAAwD,6FAAxDA,CAAwD,2GAWpCA,wDAQnBA,8IAqCHA,qBAOEA,wEAA+B,KAC7BA,uBACJA,iCAHEA,6IApBJA,6BAGAA,qEAA+B,cAA/BA,CAA4C,oEACb,IAE7BA,oBAOEA,oGAPFA,QAQAA,4BAUAA,gCAnBFA,iCAGIA,0EAA4D,gCAA5DA,CAA4D,iEAQ3DA,yFAWDA,qBAOAA,mGAIEA,uBACJA,iCAVEA,0CAAkC,mCAAlCA,CAAkC,2FAHpCA,SACEA,4BAaJA,8BAVKA,qGA8BCA,yBAKEA,SACFA,kCAHEA,iBAAe,gBAEfA,oEAGJA,qBAMEA,gEAAuB,KACnBA,uBACNA,iCAHAA,oFA7BJA,6BAGAA,qEAA+B,mBAA/BA,CAAiD,oEAClB,IAE3BA,oBAOEA,kFAA8C,0BAPhDA,QAQAA,kCACEA,gGAA4D,KAC5DA,iDAOFA,QACAA,4BASJA,2CA5BAA,iCAGMA,sEAAwD,mCAAxDA,CAAwD,oBAAxDA,CAAwD,mGASpCA,uDAQnBA,iIA0BDA,yBAKEA,SACFA,kCAHEA,iBAAe,gBAEfA,oEAGJA,qBAMEA,gEAAuB,KACnBA,uBACNA,iCAHEA,oFA7BNA,6BAGEA,qEAA+B,mBAA/BA,CAAiD,oEAClB,IAE7BA,oBAOEA,kFAA8C,0BAPhDA,QAQAA,kCACEA,gGAA4D,KAC5DA,iDAOFA,QACAA,4BASJA,2CA5BEA,iCAGIA,sEAAwD,mCAAxDA,CAAwD,oBAAxDA,CAAwD,iGASpCA,uDAQnBA,gJAUPA,kCACEA,4EAA2B,2EAA3BA,CAA2B,qFAG7BA,gCAHEA,iCAA2B,2RChQhBq4G,iBAiEXhwG,YAAoBlI,qBAhEpBG,uBAAoB2/C,GAIb3/C,yBAAsB,IAAI+I,SAC/B,GAGK/I,WAAQ,GAERA,oBAAiB,IAAI+I,SAC1B,GAEK/I,aAAU,IAAI+I,IAA6C,IAC3D/I,WAAQ,UAERA,6BAA0B,IAAI+I,KAAyB,GACvD/I,4BAAyB,IA6BxBA,WAAQ,GAEPA,gBAA6B,QAqBpCA,KAAKg4G,2BAA4BrxD,IAAkBlC,UACnDzkD,KAAKi4G,oBAAoB9vG,KAAKnI,KAAKg4G,uBACnCh4G,KAAKk4G,oBAAsB,CACzB,CACEpzG,KAAM,eAER,CACEA,KAAM,kBAhDHjF,IAGa,YAENqlB,KAAKrlB,IAHG,iBAINqlB,KAAKrlB,IALA,2BAMNqlB,KAAKrlB,MAElBG,KAAKm4G,MAAQt4G,EACbG,KAAKo4G,cAAcpzD,QAAUnlD,cAK/B,OAAOG,KAAKm4G,0BAQZ,OAAOn4G,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWwzC,oBAAoB1yF,OAC3D5G,IAAmB,IAAbA,EAAE2f,QAAW64F,uBAKtB,WAAW1xD,IAAkBtC,wBAC3BrkD,KAAKs4G,QAAQx2G,MACb9B,KAAKo4G,cAAc91D,aACnBtiD,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWrB,sBAsBvC9jC,WAEE,GAAKxgB,KAAKk3G,WAAWtoG,QAAQs4C,aAAc,CACzC,MAAMrnD,EAAUG,KAAKk3G,WAAWtoG,QAAQs4C,aAAazgD,OAClD3G,QAC8B,IAA7BA,EAAGy4G,wBAAwCz4G,EAAGy4G,uBAElD14G,EAAQ6F,IAAK5F,IACPA,EAAI6b,QACN7b,EAAI6b,OAAOV,SAGfjb,KAAKs4G,QAAQnwG,KAAKtI,GAGpBG,KAAKw4G,mBACLx4G,KAAKy4G,eAAetwG,KAClBnI,KAAKs4G,QAAQx2G,MAAM+Y,KAAMhb,GAAMA,EAAEqR,OAASlR,KAAKo4G,cAAc91D,eAE/DtiD,KAAK04G,mBACL14G,KAAKy4G,eAAerwG,UAAWvI,IAC7BG,KAAKi4G,oBAAoB9vG,KAAKnI,KAAKq4G,mBAI3B,IAFNzyG,OAAOC,KAAK7F,KAAKq4G,kBAAkBn4G,QACjCF,KAAKo4G,cAAcj2D,YAGrBniD,KAAKo4G,cAAcj2D,SAAWv8C,OAAOC,KAAK7F,KAAKq4G,kBAAkB,GACjEr4G,KAAKo4G,cAAcj2D,SAAWv8C,OAAOC,KAAK7F,KAAKq4G,kBAAkB,IAEnEr4G,KAAK04G,qBAEP14G,KAAK24G,yBAGPH,iBAAiB34G,GACfG,KAAK44G,gBACH/4G,GAASA,EAAMU,OAAS,GAAI,QAAGP,KAAK64G,cAAch5G,IAAUG,KAAKs4G,QAC/Dt4G,KAAKs4G,QAAQx2G,MAAM+Y,KAAM/a,GAAMA,EAAEoR,OAASrR,IAC5CG,KAAK84G,YAAYj5G,GAIrB64G,iBAAiB74G,EAAgBC,GAC/BE,KAAK+4G,iBAEC,QADJl5G,GAASA,EAAMU,OAAS,EACjBP,KAAKg5G,cAAcn5G,GACtBG,KAAKy4G,eAAe32G,MACjB9B,KAAKy4G,eAAe32G,MAAM6Z,OAC1B,IACL9b,GAASA,EAAMU,QAAU,GAC3BP,KAAKi5G,eAAep5G,EAAOC,GAIvB+4G,cAAch5G,GACpB,MAAMC,EAAe,IAAImlB,OACvBplB,EAAM8oB,UAAU,OAAOxiB,QAAQ,mBAAoB,IACnD,MAEF,OAAOnG,KAAKs4G,QAAQx2G,MAAM2E,OAAQrG,GAChCN,EAAaolB,KACX9kB,EAAIwqC,MAAMjiB,UAAU,OAAOxiB,QAAQ,mBAAoB,MAKrD6yG,cAAcn5G,GACpB,MAAMC,EAAe,IAAImlB,OACvBplB,EACGoD,WACA0lB,UAAU,OACVxiB,QAAQ,mBAAoB,IAC/B,MAEF,OAAOnG,KAAKy4G,eAAe32G,MAAM6Z,OAAOlV,OAAQrG,GAC9CA,GAAON,EAAaolB,KAClB9kB,EACG6C,WACA0lB,UAAU,OACVxiB,QAAQ,mBAAoB,MAKrC+yG,qBACEl5G,KAAKo4G,cAAc91D,aAAe,GAClCtiD,KAAKy4G,eAAetwG,UAAK,GACzBnI,KAAKm5G,gBAGPC,YAAYv5G,GACV,MAAMC,EAAmBE,KAAKq5G,eAAex5G,GAC7C,GAAIC,EACF,OAAOE,KAAKo4G,cAAct4G,GAG9Bq5G,cAAct5G,GAEZ,MAAMC,EAAmBE,KAAKq5G,eAAex5G,GAC7C,GAAIC,EACF,OAAQE,KAAKo4G,cAAct4G,GAAoB,GAInDy1G,kBAAkB11G,GAChBG,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWwzC,oBAAoBt+E,KACpD/a,GAAMA,EAAE8kD,WAAa5kD,KAAKo4G,cAAcxzD,UACzCplC,OAAS3f,EAAMynB,QACjBtnB,KAAKs5G,iBAGPC,eACE,MAAM15G,EAAgCG,KAAKk3G,WAAWtoG,QAAQ+2C,WAC9D9lD,EAAWs5F,oBAAsBt5F,EAAWs5F,oBAAoB1yF,OAC7D3G,GAAMA,EAAE8kD,WAAa5kD,KAAKo4G,cAAcxzD,UAE3C5kD,KAAKs5G,iBAGPE,cAAc35G,GACZG,KAAKo4G,cAAclzD,cAAgBrlD,EACnCG,KAAKs5G,iBAGPG,eAAe55G,GACbG,KAAKo4G,cAAcj2D,SAAWtiD,EAC9BG,KAAK24G,yBAEL34G,KACO05G,wBAAwB53G,OACc,IAA3C9B,KAAKo4G,cAAcr1D,aAAaxiD,OAEhCP,KAAK25G,sBAAsB35G,KAAKo4G,cAAcrzD,oBAE9C/kD,KAAKs5G,iBAITR,YAAYj5G,GACVG,KAAKo4G,cAAc91D,aAAeziD,EAClCG,KAAKy4G,eAAetwG,KAClBnI,KAAKs4G,QAAQx2G,MAAM+Y,KAAM/a,GAAMA,EAAEoR,OAASlR,KAAKo4G,cAAc91D,eAE/DtiD,KAAKs5G,iBAKPM,oBAAoB/5G,GAClBG,KAAKo4G,cAAc51D,UAAY3iD,EAAUynB,QACzCtnB,KAAKs5G,iBAGPL,eAAep5G,EAAYC,EAAcM,GAAgB,GACvD,MAAMC,EAAmBL,KAAKq5G,eAAev5G,GACzCO,IACFL,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWwzC,oBAAoBt+E,KACpDva,GAAMA,EAAEskD,WAAa5kD,KAAKo4G,cAAcxzD,UACzCvkD,GAAoBR,EAEjBO,GACHJ,KAAKs5G,kBAKXO,sBAAsBh6G,EAAOC,GAC3BE,KAAKi5G,eAAetrD,WAAW9tD,GAAQC,GAGzC65G,sBAAsB95G,GACpBG,KAAKo4G,cAAcrzD,mBAAqBllD,EAE1B,gBAAVA,GACFG,KAAK85G,yBAAwB,GAE/B95G,KAAK24G,yBACL34G,KAAKs5G,iBAGPS,WAAWl6G,GACTG,KAAKg6G,KAAOn6G,EACZG,KAAKi6G,qBAGPA,sBAC6Bj6G,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWwzC,oBAAoBt+E,KAC/E/a,GAAMA,EAAE8kD,WAAa5kD,KAAKo4G,cAAcxzD,YAMvC5kD,KAAKg6G,MAAkD,SAA1Ch6G,KAAKo4G,cAAcrzD,qBAClC/kD,KAAKo4G,cAAcr1D,aAAe/iD,KAAKk6G,WAAWpC,UAChD93G,KAAKg6G,KACLh6G,KAAK0F,IAAI+jD,YACTiuD,SAEJ13G,KAAKs5G,kBAGPQ,wBAAwBj6G,GAAmB,IACdG,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWwzC,oBAAoBt+E,KAC/Eza,GAAMA,EAAEwkD,WAAa5kD,KAAKo4G,cAAcxzD,YAMG,gBAA1C5kD,KAAKo4G,cAAcrzD,qBACrB/kD,KAAKo4G,cAAcr1D,aAAe/iD,KAAKk6G,WAAW1C,YAChDx3G,KAAK0F,IAAI+jD,WACTzpD,KAAK0F,IAAI2lD,eAAewK,YACxB71D,KAAK0F,IAAI+jD,YACTiuD,SAEA73G,GACFG,KAAKs5G,kBAITD,eAAex5G,GACb,OAAQG,KAAKo4G,cAAcj2D,eACpBxC,GAAkBM,0BAClBN,GAAkBG,uBAClBH,GAAkBQ,2BAClBR,GAAkBS,oCAClBT,GAAkBU,wBAClBV,GAAkBW,4BACrB,MAAO,kBACJX,GAAkBO,eACrB,MAAO,eACJP,GAAkBY,kBACrB,OAAO1gD,GAAe,IAARA,EACV,gBACAA,GAAe,IAARA,EACP,qBACA,OACD8/C,GAAkBa,OACrB,OAAO3gD,GAAe,IAARA,EACV,QACAA,GAAe,IAARA,EACP,WACA,UAEJ,QAIE84G,yBACN,IAAI94G,GAAY,EACZG,KAAKo4G,gBACPv4G,GAK6C,IAJ3C,CACE8/C,GAAkBiB,SAClBjB,GAAkBe,WAClBf,GAAkBgB,QAClBzgD,QAAQF,KAAKo4G,cAAcj2D,WAEjCniD,KAAK05G,wBAAwBvxG,KAAKtI,GAGpCs6G,qBACE,OACEn6G,KAAKo4G,cAAcj2D,SAASp7C,gBAC5B/G,KAAKo6G,kBAAkB55D,OAAOz5C,4DA9VvBhG,GAAsBrB,oCAAtBqB,EAAsBugB,8kGDnBnC5hB,0BAIEA,iCAASW,qBAATX,CAAkC,4BACxBI,8CAEZJ,QAEAA,4BAEEA,wBAMEA,2CAAmBI,gDACjBJ,6CAKIA,8BACJA,QACAA,8CAKIA,gCACJA,QACJA,QACFA,QAEAA,8GAuCAA,iEAGEA,yBAMEA,2CAAmBI,wEACjBJ,uEAQJA,QACFA,QAEAA,sDAeAA,qCAqCAA,mBACEA,sBAOEA,gCAASI,yCACTJ,wBACFA,QACFA,QAEAA,uDA0BEA,qDAgBFA,eAEAA,sCAmCAA,sCAmCAA,iDA/QEA,mEAA6D,kCAO7DA,2LAEEA,mDAAkC,sCAAlCA,CAAkC,sHAO9BA,gDAA6B,0DAI3BA,4DAGFA,+CAA4B,0DAI1BA,4DAOPA,iKAsCDA,0HAAoH,2BAKlHA,sKAA4J,mCAA5JA,CAA4J,kCAKnIA,0EAY5BA,8DAeAA,qEAyCGA,wEASHA,2GAwBgBA,kHAoBhBA,+FAmCEA,+FAiCmBA,s1CC/PTqB,+BCnBbrB,2DAGEA,sCAA8B,0BAA9BA,CAA8B,YAA9BA,CAA8B,2DAUhCA,qEACEA,yBAA+B,+BAA/BA,CAA+B,0BAA/BA,CAA+B,uCALjCA,qDAGAA,0ECJa26G,iBA0BXtyG,cAFO/H,WAAQ,4BAfb,OAAOA,KAAKs5G,wCAIZ,GAAIt5G,KAAKk3G,WAAWtoG,QAAQ+2C,WAC1B,OAAO3lD,KAAKk3G,WAAWtoG,QAAQ+2C,WAAW3E,uCAM5C,OAAOhhD,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWwzC,oBAC1Cn5F,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWwzC,oBAAoB,QAAK,gDArBnDp4F,8BAA0BugB,+ZDRvC5hB,6CASAA,gCARGA,oCASFA,0GCFYqB,+CCNXrB,sBAMEA,4EAEFA,2CAJcA,kBAAqB,iHAKnCA,gBAAIA,yEAA6KA,SAAeA,gCAA7IA,oEAAgE,4BAA8DA,wEAC/KA,qBACwEA,8FACtEA,uBACFA,gCAH6DA,wCAAgC,mDAAhCA,CAAgC,oGAI7FA,qBASEA,sIACAA,wCAIFA,gCAZEA,mDAA+C,wGAS7CA,4EAA4D,qEAQ9DA,qDAA8CA,kDADhDA,qBACEA,uDAEFA,8BAFqBA,0FAMvBA,sBACEA,uBACAA,2BAAqCA,4EAAsC,yGAEzEA,8BACFA,QACFA,gCAHIA,6EACAA,4ECvBO46G,iBA2BXvyG,YAAoBlI,2BA1BbG,WAAQ,UAEPA,0BAAuB2/C,GAAkBoE,IAC1C/jD,6BAAyB,EACzBA,yBAAqB,EACrBA,uBAAmB,EACnBA,kBAAuB,EAC9BA,iBAAwC,IAAI+I,KAAgB,GAC5D/I,wBAA+C,IAAI+I,KAAgB,GAQ1D/I,aAAkB,EAWzBA,KAAK8pD,gBAAkB,IAAInD,qBAR3B,OAAO3mD,KAAKs5G,eAAehoD,KAAKtxD,uBAIhC,OAAOA,KAAKy8C,MAAM/1B,WAOpBlG,WACE,MAAM3gB,EAAaG,KAAKk3G,WAAWtoG,QAAQ+2C,WAa3C,QAXG9lD,EAAWohD,aAAephD,EAAWohD,YAAYuE,QAAQjlD,OAAS,GAClEV,EAAWqhD,YAAcrhD,EAAWqhD,WAAWsE,QAAQjlD,OAAS,GAChEV,EAAWshD,cAAgBthD,EAAWshD,aAAaqE,QAAQjlD,OAAS,GACpEV,EAAWgD,QAAUhD,EAAWgD,OAAO2iD,QAAQjlD,OAAS,GACxDV,EAAWuhD,cAAgBvhD,EAAWuhD,aAAaoE,QAAQjlD,OAAS,UAC/B,IAAlCV,EAAWmhD,qBACbnhD,EAAWmhD,oBAAqB,GAElChhD,KAAKu6G,aAAc,GAGbv6G,KAAKk3G,WAAWtoG,QAAQ9J,UACzB,MACH9E,KAAKw6G,iBAAiBphB,wBAAwBp5F,KAAKk3G,YACnD,UACG,MACHl3G,KAAKw6G,iBAAiBthB,wBAAwBl5F,KAAKk3G,YAMnDr3G,IACEA,EAAWs5F,sBACbn5F,KAAKy6G,iBAAmBx1G,KAAKC,MAC3BD,KAAKE,UAAUtF,EAAWs5F,sBAG1Bt5F,EAAWs5F,oBAAoB1yF,OAAOrG,GAAKA,EAAE2iD,cAAcxiD,QAAU,IAErEP,KAAK06G,wBAAyB,IAIlC16G,KAAK26G,qBAAqB96G,EAAWihD,UACjCjhD,EAAWihD,UAKjB9gD,KAAK6wD,aADe7wD,KAAKy8C,MAAM/2C,IAAI2lD,eAAeyF,YAClB1oD,UAAU,KACxCpI,KAAK0uF,mBAAmBvmF,KAAKnI,KAAKy8C,MAAM4T,wBAI5Cl4C,cACEnY,KAAK6wD,aAAanoD,cAGpBkyG,sBACE56G,KAAKm3G,kBAAmB,EAGxB,MAAMr3G,EAAME,KAFkDk3G,WAC3DtoG,QAAQ+2C,WAAWwzC,qBACa,GAC7B/4F,EAA2B,IAAfN,EAAIS,OAAe,EAAIT,EAAIA,EAAIS,OAAS,GAAG4kD,MAC7D,IAAI9kD,EAAiB,GACrB,MAAMC,EAAiBN,KAAKk3G,WAAWtoG,QAAQs4C,aAAazgD,OAAO1C,IAAMA,EAAEw0G,uBAK3E,IAAI/3G,EAJAF,EAAeC,OAAS,IAC1BF,OAC6B,IAA3BC,EAAe,GAAG4Q,KAAqB,GAAK5Q,EAAe,GAAG4Q,MAGlE,MAAMxN,EAAoB1D,KAAKk3G,WAC5BtoG,QACClL,EAAkB2jD,kBACpB7mD,EAAoBkD,EAAkB2jD,kBAErCrnD,KAAKk3G,WAAWtoG,QAAgB63C,WAChCzmD,KAAKk3G,WAAWtoG,QAAgB63C,UAAUY,oBAE3C7mD,EAAqBR,KAAKk3G,WAAWtoG,QAAgB63C,UAClDY,mBAEL,MAAMzjD,EAAmB5D,KAAK8pD,gBAAgBzF,wBAC5CrkD,KAAKk3G,WAAWtoG,QAAQs4C,aACxB7mD,EACAL,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWrB,sBAC/BzgD,EAAoB+B,OAAOC,KAAKjC,GAAkB,GAExD9D,EAAIc,KACFZ,KAAK8pD,gBAAgB1F,mBACnB,CACE9B,aAAcjiD,EACd8hD,SAAUt+C,EACV2b,QAAQ,EACRulC,mBAAoB,cACpBrD,QAAS1hD,KAAK0F,IAAI+jD,YAEpBjpD,EACAJ,EACAJ,KAAK66G,uBAGT76G,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWwzC,oBAAsBr5F,EAG3Dw5G,eAAez5G,IACC,IAAVA,IACFG,KAAKy6G,sBAAmB,GAE1B,MAAM36G,EAAgCE,KAAKk3G,WAAWtoG,QAAQ+2C,WACxDvlD,EAAgBN,EAAWq5F,oBAC/Br5F,EAAWq5F,oBAAoB1yF,OAAOpG,IAAkB,IAAbA,EAAEmf,QAAmB,GAkBlE,GAjB6B,IAAzBpf,EAAcG,SAChBT,EAAWogB,aAAU,EACrBpgB,EAAWu5F,UAAW,GAEpBj5F,EAAcG,OAAS,IACzBH,EAAc,GAAG8kD,cAAgB9kD,EAAc,GAAG8kD,eAOlDllD,KAAK06G,uBAFQ,IAFbt6G,EAAcqG,OACZpG,IAAoE,IAA9D,CAAC,WAAY,aAAc,UAAUH,QAAQG,EAAG8hD,WACtD5hD,OAQA0E,KAAKE,UAAUnF,KAAKy6G,oBAAsBx1G,KAAKE,UAAU/E,GAC3D,CACA,GAA2C,QAAvCJ,KAAKy8C,MAAM/1B,WAAW9X,QAAQ9J,KACL9E,KAAKy8C,MAAM/1B,WACY9X,QAAQ+2C,WACjDzlC,QAAUlgB,KAAK8pD,gBAAgBzE,sCACtCjlD,GAEFJ,KAAKy8C,MAAM/1B,WAAWq2B,GAAGtzB,kBAEc,QAAvCzpB,KAAKy8C,MAAM/1B,WAAW9X,QAAQ9J,MAC9BhF,EAAWs+B,QACX,CACA,IAAI/9B,EAAgB,GACpB,GAAID,EAAcG,QAAU,EAAG,CAC7B,MAAMD,EAAqBN,KAAKy8C,MAAM/1B,WAChClmB,EAA8BF,EAAcsO,QAAQ+2C,WAC1DnlD,EAAS0f,QAAUlgB,KAAK8pD,gBAAgBzE,sCACtCjlD,GAEFC,EAAgBL,KAAK8pD,gBAAgBzI,YACnC7gD,EAAS0f,aACT,OACA,EACClgB,KAAKy8C,MAAM/1B,WAAW9X,QAAgBy4C,kBACvC/mD,EAAcsO,SAGlB5O,KAAKw6G,iBAAiBvhB,YACpBj5F,KAAKk3G,WACL72G,GAEFL,KAAKk3G,WAAWtoG,QAAQ+2C,WAAW0zC,SACR,IAAzBj5F,EAAcG,OAGlBP,KAAKy6G,iBAAmBx1G,KAAKC,MAAMD,KAAKE,UAAU/E,IAInDJ,KAAKy8C,MAAM/1B,WAAuCiiC,cAAc7oD,GAAY,GAGxEkwD,aACLhwD,KAAKy8C,MAAM71B,SAAU,EAGhBk0F,uBACL,OAAO96G,KAAKk3G,WAAWtoG,QAAQ+2C,WAAW3E,mBAGrC+5D,oBACL,OACG/6G,KAAKk3G,WAAWtoG,QAAQs4C,cACuB,IAAhDlnD,KAAKk3G,WAAWtoG,QAAQs4C,aAAa3mD,OAIjCy6G,mCAAmCn7G,GACzCG,KAAKk3G,WAAWtoG,QAAQ+2C,WAAW3E,mBAAqBnhD,EAG1Do7G,oBAAoBp7G,GAClBG,KAAKg7G,mCAAmCn7G,EAAqBynB,SACzDznB,EAAqBynB,SACvBtnB,KAAKs5G,gBAAe,GAIhBzqB,aAAahvF,GACnBG,KAAKy8C,MAAM6S,gBAAkBzvD,EAC7BG,KAAKkvF,YAAY/mF,MAAMtI,GAGzBsvF,sBACOnvF,KAAKm3G,kBACRn3G,KAAK6uF,aAAa7uF,KAAKkvF,YAAYptF,OAIvCs1G,yBACEp3G,KAAKm3G,kBAAoBn3G,KAAKm3G,+DA5OrBp2G,GAA0BrB,oCAA1BqB,EAA0BugB,26CDtBvC5hB,yBAEEA,6BASAA,uBACEA,2BAIAA,4BAeJA,QAEAA,sBACIA,wBAIFA,qCAGAA,4BAOFA,eA7CKA,gCAQkCA,gCAC1BA,sEAIAA,gCAkBHA,gCAIiBA,0CAAyB,YAAzBA,CAAyB,gCAGxCA,oYCnBCqB,+BCpBTrB,8DAAqCA,mBAAe,UAAfA,CAAe,kBCY3Cw7G,iBAMXnzG,6DANWhH,8BAA0BugB,kODdvC5hB,sBACEA,gEAIFA,eALUA,uBAAoB,gBACCA,0FCalBqB,gCCdbrB,yCAUEA,sBACFA,8BAHEA,yDAAoD,iBAE1CA,6DAOVA,2DAGEA,mBAAgB,kBAAhBA,CAAgB,4CAPpBA,mBAIEA,4CAOFA,8BANKA,8ECNQy7G,iBAmGXpzG,cANS/H,WAAgB,UAIlBA,wBAAoB,4BA5FzB,MAAMQ,EAASR,KAAK4O,QAAQ+2C,WAC5B,IAAIjiD,EAAM,EACV,GAAIlD,IAAWA,EAAOwgD,mBAAoB,CACxC,GAAIxgD,EAAOygD,YAAa,CAEtB,MAAMp9C,EAAyBrD,EADJygD,YACgB5pB,OAAOxc,KAAK7W,GAAMA,EAAGo6B,SAChE,IAAIr6B,EAAiB,EACjBF,IACsC,QAAxChE,IAAuB0lD,yBAAiB,SAAE7/C,IAAI1B,UAAM,UAAuC,QAArBW,EAACX,EAAGsd,iBAAiB,eAAE7a,OAC3Fq8C,GAAUA,EAAO1kB,SAAS79B,UAE9BmD,GAAOK,EAET,GAAIvD,EAAO0gD,WAAY,CAErB,MAAMr9C,EAAuBrD,EADH0gD,WACc7pB,OAAOxc,KAAK7W,GAAMA,EAAGo6B,SAC7D,IAAIr6B,EAAgB,EAChBF,IACoC,QAAtC/D,IAAqBylD,yBAAiB,SAAE7/C,IAAI1B,UAAM,UAAsC,QAArBW,EAACX,EAAGsd,iBAAiB,eAAE7a,OACxFq8C,GAAYA,EAAS1kB,SAAS79B,UAElCmD,GAAOK,EAET,GAAIvD,EAAO2gD,aAAc,CAEvB,MAAMt9C,EAA2BrD,EADL2gD,aACkB9pB,OAAOxc,KAAK7W,GAAMA,EAAGo6B,SACnE,IAAIr6B,EAAkB,EAClBF,IACwC,QAA1CzD,IAAyBmlD,yBAAiB,SAAE7/C,IAAI1B,UAAM,UAAwC,QAArBW,EAACX,EAAGsd,iBAAiB,eAAE7a,OAC9Fq8C,GAASA,EAAM1kB,SAAS79B,UAE5BmD,GAAOK,EAET,GAAIvD,EAAOqC,OAAQ,CAEjB,MAAMgB,EAAqBrD,EADLqC,OACYw0B,OAAOxc,KAAK7W,GAAMA,EAAGo6B,SACvD,IAAIr6B,EAAY,EACZF,IACkC,QAApCxD,IAAmBklD,yBAAiB,SAAE7/C,IAAI1B,UAAM,UAAkC,QAArBW,EAACX,EAAGsd,iBAAiB,eAAE7a,OAClFq8C,GAASA,EAAM1kB,SAAS79B,UAE5BmD,GAAOK,EAET,GAAIvD,EAAO4gD,aAAc,CAEvB,MAAMv9C,EAA2BrD,EADL4gD,aACkB/pB,OAAOxc,KAAK7W,GAAMA,EAAGo6B,SACnE,IAAIr6B,EAAkB,EAClBF,IACwC,QAA1CvD,IAAyBilD,yBAAiB,SAAE7/C,IAAI1B,UAAM,UAAwC,QAArBW,EAACX,EAAGsd,iBAAiB,eAAE7a,OAC9Fq8C,GAAgBA,EAAa1kB,SAAS79B,UAE1CmD,GAAOK,OAEJ,IAAIvD,GAAUA,EAAO0f,UAAY1f,EAAO0f,QAAQA,QACrD,OAAO,EACF,GAAI1f,GAAUA,EAAO0f,SAAW1f,EAAO0f,QAAQA,QACpD,OAAO1f,EAAO0f,QAAQA,QAAQ3f,OAEhC,GAAIC,EAAO0f,SAAuC,WAA5B1f,EAAO0f,QAAQiiC,UAAyB3hD,EAAO0f,QAAQV,QAC3Ehf,EAAO24F,qBAAuB34F,EAAO24F,oBAAoB,GAAG35E,OAAQ,CACpE,MAAM5b,EAAoBpD,EAAO24F,oBAAoB,GACjD34F,EAAO0f,QAAQqoC,kBAEZ3kD,EAAkBu/C,MAAMv7C,UAAU,EAAE,KAAO5H,KAAK4O,QAAQw0C,QAAQx7C,UAAU,EAAE,IAChFhE,EAAkB0/C,IAAI17C,UAAU,EAAE,KAAO5H,KAAK4O,QAAQ20C,QAAQ37C,UAAU,EAAE,MACzElE,GAAO,IAECE,EAAkBu/C,QAAUnjD,KAAK4O,QAAQw0C,SAAax/C,EAAkB0/C,MAAQtjD,KAAK4O,QAAQ20C,WACvG7/C,GAAO,GAGX,OAAOA,EAAM,EAAIA,OAAM,cAKvB,OAAO1D,KAAKo8C,iBAEJv8C,GACRG,KAAKo8C,OAASv8C,EACVA,IACFG,KAAK4O,QAAU5O,KAAKy8C,MAAM/1B,WAAW9X,SAezC4R,WACExgB,KAAK4O,QAAU5O,KAAKy8C,MAAM/1B,WAAW9X,sDAtG5B7N,8BAAwBugB,irBDZrC5hB,2BAaAA,+BAZGA,kRAaFA,mTCFYqB,MCVb,MAAM8+C,GAAS15B,OAOFi1F,iBAITrzG,cAFS/H,4BAAyB,IAIlC6kD,KAAKhlD,EAAqCC,GAC1C,OAAOD,EAAW+O,QAAQ4xD,SACtB3gE,EAAW+O,QAAQ4xD,SACnB1gE,EAAc+kD,KAGlBw2D,gBAAgBx7G,EAAqCC,GACjD,MAAMM,EAAOy/C,GAAOoS,SAASjyD,KAAK6kD,KAAKhlD,EAAYC,IAAgBi3G,iBACnE,OAAgB,IAAT32G,EAAaJ,KAAKs7G,uBAAyBl7G,EAGtDm7G,mBAAmB17G,GACf,MAAMC,EAAO+/C,GAAOoS,SAASpyD,GAC7B,OACqB,IAAjBC,EAAK07G,SACa,IAAlB17G,EAAK27G,UACY,IAAjB37G,EAAK47G,SACW,IAAhB57G,EAAK67G,QACY,IAAjB77G,EAAK87G,SACc,IAAnB97G,EAAK+7G,UAIbC,oBAAoBj8G,GAChB,MAAMC,EAAQ+/C,GAAOoS,SAASpyD,GAC9B,OACuB,IAAnBC,EAAM27G,UACY,IAAlB37G,EAAM47G,SACW,IAAjB57G,EAAM67G,QACY,IAAlB77G,EAAM87G,SACc,IAApB97G,EAAM+7G,UAIdE,mBAAmBl8G,GACf,MAAMC,EAAO+/C,GAAOoS,SAASpyD,GAC7B,OACqB,IAAjBC,EAAK47G,SACW,IAAhB57G,EAAK67G,QACY,IAAjB77G,EAAK87G,SACc,IAAnB97G,EAAK+7G,UAIbG,kBAAkBn8G,GACd,MAAMC,EAAM+/C,GAAOoS,SAASpyD,GAC5B,OAAsB,IAAfC,EAAI67G,QAAgC,IAAhB77G,EAAI87G,SAAmC,IAAlB97G,EAAI+7G,UAGxDI,mBAAmBp8G,GACf,MAAMC,EAAO+/C,GAAOoS,SAASpyD,GAC7B,OAAwB,IAAjBC,EAAK87G,SAAoC,IAAnB97G,EAAK+7G,UAGtCK,qBAAqBr8G,GAEjB,OAA4B,IAArBs8G,GADelqD,SAASpyD,GACjBg8G,UAGlB7G,aAAan1G,GACT,IAAIC,EAAU,IAAIuG,KAClB,OAAIxG,IACFC,EAAU,IAAIuG,KAAKxG,IAEdC,EAAQqwC,UAGZisE,QAAQv8G,EAAOC,GAClB,OAAO+/C,GAAOhgD,GAAOm8B,IAAIl8B,EAAiB,gBAAgBu8G,SAGvDC,aAAaz8G,EAAOC,GACvB,OAAO+/C,GAAOhgD,GAAO08G,SAASz8G,EAAiB,gBAAgBu8G,uDA9E1Dt7G,gCAAoBsI,QAApBtI,EAAoB,YAApBA,uDCCDrB,yBAC0BA,SAC1BA,kCADEA,iBAAwBA,yEAPhCA,kBACEA,0BACEA,yBAGEA,0GACAA,gCAGFA,QACFA,QACFA,iCAPMA,2EAA6D,mCAEvBA,6FAUxCA,gCAGoCA,+HACVA,SAC1BA,+CAJEA,oCAAwC,8BAAxCA,CAAwC,oBAAxCA,CAAwC,WAGhBA,0DAR9BA,SACEA,cAAIA,SAAgBA,QACpBA,sCAEEA,uCAMFA,QACFA,6CAVMA,wBAEuEA,iDAC5BA,iEAlBnDA,iBACEA,uBACAA,wBAYAA,iCAYFA,+BAxB+BA,yDAYIA,iGAsB3BA,yBAC0BA,SAC1BA,kCADEA,iBAAwBA,yEAPhCA,kBACEA,0BACEA,yBAGEA,yGACAA,gCAGFA,QACFA,QACFA,iCAPMA,2EAA6D,kCAEvBA,4FASxCA,2BAEkCA,+HACVA,SACxBA,+CAHEA,oCAAsC,oBAAtCA,CAAsC,WAEhBA,yEAIxBA,gBAEEA,qEAA4B,cAAaA,8BAC3CA,cAD2CA,gHAE3CA,gBAEEA,qEAA4B,cAAaA,8BAC3CA,cAD2CA,iGAP7CA,aACEA,uBAIAA,uBAIFA,mDARMA,qDAIAA,gFAdRA,SACEA,cAAIA,SAAgBA,QACpBA,kBACEA,kCAKFA,QACAA,sBAUFA,6CAlBMA,wBAEoCA,sCAMpCA,+GAvBRA,kBACEA,uBACAA,wBAYAA,iCAoBFA,+BAhC+BA,wDAYIA,gGA8B3BA,yBAC0BA,SAC1BA,kCADEA,iBAAwBA,yEAPhCA,kBACEA,0BACEA,yBAGEA,2GACAA,gCAGFA,QACFA,QACFA,iCAPMA,2EAA6D,oCAEvBA,8FAUxCA,+BAEEA,8FAA+BA,8BACjCA,cAFEA,6DAC+BA,0GAEjCA,+BAEqCA,+HACVA,SAC3BA,+CAHEA,oCAAyC,oBAAzCA,CAAyC,WAEhBA,yEAGzBA,gBAEEA,qEAA4B,WAAUA,8BACxCA,cADwCA,gHAExCA,gBAEEA,qEAA4B,WAAUA,8BACxCA,cADwCA,iGAP1CA,aACEA,uBAIAA,uBAIFA,mDARMA,kDAIAA,6EAlBVA,SACEA,cAAIA,SAAgBA,QACpBA,8BAEEA,sCAIAA,sCAKAA,sBAUFA,QACFA,6CAvBMA,wBAGiBA,oCAI0BA,sCAKzCA,yGA3BVA,kBACEA,uBACAA,wBAYAA,iCAyBFA,+BArC+BA,0DAYIA,kGAmC3BA,yBAC0BA,SAC1BA,kCADEA,iBAAwBA,yEAPhCA,kBACEA,0BACEA,yBAGEA,qGACAA,gCAGFA,QACFA,QACFA,iCAPMA,2EAA6D,8BAEvBA,wFASxCA,yBAIEA,uFACAA,uBACFA,aAHEA,iJASMA,2BACEA,iFAA+B,oEACCA,iBAClCA,iCAFEA,qCAA+B,wEAInCA,yBAEEA,kIACoBA,SACtBA,+CAHEA,oCAAoC,WAEhBA,0DAZ1BA,eACEA,4BAEEA,kBACEA,kCAIFA,QACAA,gCAKFA,QACFA,wCAbeA,sCAA4B,uBAEtBA,kCAKiBA,gFAUlCA,yBAEsBA,gIAAqEA,SAC3FA,+CAFEA,oCAAoC,WACqDA,0DAJ7FA,yBAEEA,gCAIFA,wCALEA,6BACkCA,iEA9B5CA,SACEA,cAAIA,SAAgBA,QACpBA,kBACEA,gCAOAA,0BACEA,yBAgBAA,4CASFA,QACFA,QACFA,6CArCMA,wBAEWA,iDAOGA,mDACRA,kCAAuB,yCAzBrCA,kBACEA,uBACAA,wBAYAA,iCAuCFA,+BAnD+BA,oDAYIA,4FAiD3BA,yBAC8BA,SAC9BA,kCADEA,iBAA4BA,yEAPpCA,kBACEA,0BACEA,yBAGEA,2GACAA,gCAGFA,QACFA,QACFA,iCAPMA,2EAA6D,oCAEnBA,8FAS5CA,yBAIEA,6FACAA,uBACFA,aAHEA,uFASIA,yBACEA,SACFA,kCAFuFA,iBACrFA,0EANRA,0BACEA,uBAEEA,kCAAwDA,sGAEtDA,iDAGFA,QACJA,gEAT2DA,0CAEvDA,oCAAwB,uBAExBA,0CAC0CA,gGAflDA,SACEA,cAAIA,SAAgBA,QACpBA,kBACEA,gCAOAA,oCAUFA,QACFA,6CApBMA,wBAEWA,oCAOIA,kFAxBvBA,kBACEA,uBACAA,wBAYAA,iCAsBFA,+BAlC+BA,0DAYIA,kGA/KrCA,eACEA,wBA4BAA,wBAoCAA,wBAyCAA,wBAuDAA,wBAqCFA,kCArMiCA,qDA4BFA,mDAoCGA,sDAyCLA,iDAuDMA,+EA0CnCA,cAAiCA,8BAAgDA,eAAhDA,qFACjCA,cAAgCA,SAAyBA,+BAAzBA,gFAHlCA,eACEA,uBACAA,uBACAA,uBACAA,kCACEA,4EAA2B,2EAA3BA,CAA2B,qFAG7BA,QACFA,gCAPOA,8CACAA,6CAEHA,0CAA2B,sCC3KlB88G,iBA+JXz0G,YACUlI,EACAC,EACAM,EACAC,EACAC,GAJAN,wBACAA,mBACAA,kBACAA,qBACAA,aA1JDA,qBAAkB,EAClBA,uBAAoB,EACpBA,eAAY,EAcdA,uBAAoB2/C,GAIpB3/C,WAAQ,UACRA,wBAAoB,EACpBA,oBAAiB,IAAI+I,SAAgB,GACrC/I,qBAAkB,IAAI+I,IAAgB,IACtC/I,0BAAuB,IAAI+I,SAAgB,GAC3C/I,6BAA0B,GAmI/BA,KAAK8pD,gBAAkB,IAAInD,GAC3B3mD,KAAK4kG,gCAvJL,OAAO5kG,KAAKy8G,iCAEI58G,SAChBG,KAAKy8G,eAAiB58G,GACC,QAAnBC,OAAK28G,sBAAc,eAAE33D,iBACvB9kD,KAAKy8G,eAAe33D,cAAc1mB,SAAU,6FAmB9C,MAAMouB,EAAc,GACpB,OAAwC,QAApCpsD,EAAwB,QAAxBN,EAAe,QAAfD,OAAKq3G,kBAAU,eAAEtoG,eAAO,eAAE+2C,kBAAU,eAAE1E,cACxCuL,EAAY5rD,KAAyC,QAApCJ,EAAwB,QAAxBF,EAAe,QAAfD,OAAK62G,kBAAU,eAAEtoG,eAAO,eAAE+2C,kBAAU,eAAE1E,cAEjB,QAApCp9C,EAAwB,QAAxBD,EAAe,QAAfF,OAAKwzG,kBAAU,eAAEtoG,eAAO,eAAE+2C,kBAAU,eAAEzE,aACxCsL,EAAY5rD,KAAyC,QAApC+D,EAAwB,QAAxBX,EAAe,QAAfD,OAAKmzG,kBAAU,eAAEtoG,eAAO,eAAE+2C,kBAAU,eAAEzE,aAEjB,QAApC8B,EAAwB,QAAxB/7C,EAAe,QAAf67C,OAAKo0D,kBAAU,eAAEtoG,eAAO,eAAE+2C,kBAAU,eAAExE,eACxCqL,EAAY5rD,KAAyC,QAApC4iD,EAAwB,QAAxBH,EAAe,QAAfJ,OAAKi0D,kBAAU,eAAEtoG,eAAO,eAAE+2C,kBAAU,eAAExE,eAEjB,QAApCmG,EAAwB,QAAxBL,EAAe,QAAfvD,OAAKwzD,kBAAU,eAAEtoG,eAAO,eAAE+2C,kBAAU,eAAE9iD,SACxC2pD,EAAY5rD,KAAyC,QAApC4mD,EAAwB,QAAxBD,EAAe,QAAfujB,OAAKosC,kBAAU,eAAEtoG,eAAO,eAAE+2C,kBAAU,eAAE9iD,SAEjB,QAApCupD,EAAwB,QAAxBhF,EAAe,QAAfD,OAAK+vD,kBAAU,eAAEtoG,eAAO,eAAE+2C,kBAAU,eAAEvE,eACxCoL,EAAY5rD,KAAyC,QAApC2rD,EAAwB,QAAxBD,EAAe,QAAfD,OAAK6qD,kBAAU,eAAEtoG,eAAO,eAAE+2C,kBAAU,eAAEvE,cAEzDoL,EAAYvxC,KAAK,CAACwxC,EAAGC,IACfD,EAAE1gB,MAAQ2gB,EAAE3gB,OACP,EAEL0gB,EAAE1gB,MAAQ2gB,EAAE3gB,MACP,EAEF,GAEFygB,gCAIP,OAAOxsD,KAAKu3B,KAAK9tB,IAAI,oBAAoB3H,kCAEfjC,GAC1BG,KAAKu3B,KAAKy/D,WAAW,CAAE0lB,iBAAkB78G,iCAIzC,OAAOG,KAAKu3B,KAAK9tB,IAAI,mBAAmB3H,iCAEfjC,GACzBG,KAAKu3B,KAAKy/D,WAAW,CAAE2lB,gBAAiB98G,mCAIxC,OAAOG,KAAKu3B,KAAK9tB,IAAI,qBAAqB3H,mCAEfjC,GAC3BG,KAAKu3B,KAAKy/D,WAAW,CAAE4lB,kBAAmB/8G,6BAI1C,OAAOG,KAAKu3B,KAAK9tB,IAAI,eAAe3H,6BAEfjC,GACrBG,KAAKu3B,KAAKy/D,WAAW,CAAE6lB,YAAah9G,IACpCG,KAAKkf,MAAMD,+CAIX,OAAOjf,KAAKu3B,KAAK9tB,IAAI,qBAAqB3H,mCAEfjC,GAC3BG,KAAKu3B,KAAKy/D,WAAW,CAAE8lB,kBAAmBj9G,IAC1CG,KAAKkf,MAAMD,oCAIX,OAAOjf,KAAK+8G,eAAej7G,wBAGXjC,GAChBG,KAAK+8G,eAAe50G,KAAKtI,GACzBm3E,aAAah3E,KAAKg9G,qBAClBh9G,KAAKi9G,mBAAmB13D,kBAAkBz/C,QAAQhG,UAC5B,QAApBM,IAAWkhB,iBAAS,SAAExb,QAAQzF,IACPA,EAAS+9B,QAA9Bv+B,IAAUQ,MAIdL,KAAKg9G,oBAAsB7lC,WAAW,KACpCn3E,KAAKk9G,gBACJ,0BAIH,OAAOl9G,KAAKm9G,gBAAgBr7G,yBAGXjC,GACjBG,KAAKm9G,gBAAgBh1G,KAAKtI,GAC1Bm3E,aAAah3E,KAAKg9G,qBAClBh9G,KAAKi9G,mBAAmB13D,kBAAkBz/C,QAAQhG,UAC5B,QAApBM,IAAWkhB,iBAAS,SAAExb,QAAQzF,IACDA,EAAS+9B,UAApCv+B,EAAM4T,SAASpT,OAInBL,KAAKg9G,oBAAsB7lC,WAAW,KACpCn3E,KAAKk9G,gBACJ,+BAIH,OAAOl9G,KAAKo9G,qBAAqBt7G,8BAGXjC,GACtBG,KAAKo9G,qBAAqBj1G,KAAKtI,GAC/Bm3E,aAAah3E,KAAKg9G,qBAClBh9G,KAAKq9G,yBAAyB93D,kBAAkBz/C,QAAQhG,UAClC,QAApBM,IAAWkhB,iBAAS,SAAExb,QAAQzF,IACDA,EAAS+9B,QAApCv+B,IAAUQ,EAAS4O,UAIvBjP,KAAKg9G,oBAAsB7lC,WAAW,KACpCn3E,KAAKk9G,gBACJ,KAcGtY,YACN5kG,KAAKu3B,KAAOv3B,KAAKooB,YAAYwP,MAAM,CACjCqpB,YAAa,CAAC,GAAI,CAAC56B,iBACnB86B,aAAc,CAAC,GAAI,CAAC96B,iBACpBq2F,iBAAkB,CAAC,GAAI,CAACr2F,iBACxBs2F,gBAAiB,CAAC,GAAI,CAACt2F,iBACvBu2F,kBAAmB,CAAC,GAAI,CAACv2F,iBACzBw2F,YAAa,CAAC,GAAI,CAACx2F,iBACnBxjB,OAAQ,CAAC,GAAI,CAACwjB,iBACdi3F,YAAa,CAAC,GAAI,CAACj3F,iBACnBy2F,kBAAmB,CAAC,GAAI,CAACz2F,iBACzB+6B,aAAc,CAAC,GAAI,CAAC/6B,mBAIxBk3F,iCACE,GAAwC,QAApCn9G,EAAwB,QAAxBN,EAAe,QAAfD,OAAKq3G,kBAAU,eAAEtoG,eAAO,eAAE+2C,kBAAU,eAAE1E,YACxC,OAAOjhD,KAAKk3G,WAAWtoG,QAAQ+2C,WAAW1E,YAAY5pB,OAI1DmmF,gCACE,GAAwC,QAApCp9G,EAAwB,QAAxBN,EAAe,QAAfD,OAAKq3G,kBAAU,eAAEtoG,eAAO,eAAE+2C,kBAAU,eAAEzE,WACxC,OAAOlhD,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWzE,WAAW7pB,OAIzDomF,kCACE,GAAwC,QAApCr9G,EAAwB,QAAxBN,EAAe,QAAfD,OAAKq3G,kBAAU,eAAEtoG,eAAO,eAAE+2C,kBAAU,eAAExE,aACxC,OAAOnhD,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWxE,aAAa9pB,OAI3DqmF,4BACE,GAAwC,QAApCt9G,EAAwB,QAAxBN,EAAe,QAAfD,OAAKq3G,kBAAU,eAAEtoG,eAAO,eAAE+2C,kBAAU,eAAE9iD,OACxC,OAAO7C,KAAKk3G,WAAWtoG,QAAQ+2C,WAAW9iD,OAAOw0B,OAIrDsmF,kCACE,GAAwC,QAApCv9G,EAAwB,QAAxBN,EAAe,QAAfD,OAAKq3G,kBAAU,eAAEtoG,eAAO,eAAE+2C,kBAAU,eAAEvE,aACxC,OAAOphD,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWvE,aAAa/pB,OAIrD7W,0DACAxgB,KAAKk3G,WAAWtoG,QAAQ+2C,aACtB3lD,KAAKk3G,WAAWtoG,QAAQ+2C,WAAW1E,cACrCjhD,KAAK49G,wBACH59G,KAAKk3G,WAAWtoG,QAAQ+2C,WAAW1E,YAAY5pB,OAAOxc,KAAKhb,GAASA,EAAMu+B,UAC1Ep+B,KAAKk3G,WAAWtoG,QAAQ+2C,WAAW1E,YAAY5pB,OAAO,IAEtDr3B,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWzE,aACrClhD,KAAK69G,uBACH79G,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWzE,WAAW7pB,OAAOxc,KAAKhb,GAASA,EAAMu+B,UACzEp+B,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWzE,WAAW7pB,OAAO,IAErDr3B,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWxE,eACrCnhD,KAAK89G,yBACH99G,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWxE,aAAa9pB,OAAOxc,KAAKhb,GAASA,EAAMu+B,UAC3Ep+B,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWxE,aAAa9pB,OAAO,IAEvDr3B,KAAKk3G,WAAWtoG,QAAQ+2C,WAAW9iD,SACrC7C,KAAKi9G,mBACHj9G,KAAKk3G,WAAWtoG,QAAQ+2C,WAAW9iD,OAAOw0B,OAAOxc,KAAKhb,GAASA,EAAMu+B,UACrEp+B,KAAKk3G,WAAWtoG,QAAQ+2C,WAAW9iD,OAAOw0B,OAAO,GACnDr3B,KAAK+9G,yBACC/9G,KAAKg+G,sBAETh+G,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWvE,eACrCphD,KAAKq9G,yBACHr9G,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWvE,aAAa/pB,OAAOxc,KAAKhb,GAASA,EAAMu+B,UAC3Ep+B,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWvE,aAAa/pB,OAAO,GACzDr3B,KAAKi+G,+BACCj+G,KAAKk+G,4BAEbl+G,KAAKk9G,gBAGPl9G,KAAKu3B,KACJ9tB,IAAI,oBACJgf,aACAlgB,MAAK,OAAa,MAClBH,UAAU,KACTpI,KAAKm+G,2BACLn+G,KAAKk9G,iBAEPl9G,KAAKu3B,KACJ9tB,IAAI,mBACJgf,aACAlgB,MAAK,OAAa,MAClBH,UAAU,KACTpI,KAAKo+G,0BACLp+G,KAAKk9G,iBAEPl9G,KAAKu3B,KACF9tB,IAAI,qBACJgf,aACAlgB,MAAK,OAAa,MAClBH,UAAU,KACTpI,KAAKq+G,4BACLr+G,KAAKk9G,iBAETl9G,KAAKu3B,KACF9tB,IAAI,eACJgf,aACAlgB,MAAK,OAAa,MAClBH,UAAU,KACTpI,KAAKs+G,sBACLt+G,KAAKk9G,iBAETl9G,KAAKu3B,KACF9tB,IAAI,qBACJgf,aACAlgB,MAAK,OAAa,MAClBH,UAAU,KACTpI,KAAKu+G,4BACLv+G,KAAKk9G,iBAETl9G,KAAKu3B,KACF9tB,IAAI,eACJgf,aACAlgB,MAAK,OAAa,MAClBH,UAAU,KACTpI,KAAKk9G,iBAETl9G,KAAKu3B,KACF9tB,IAAI,gBACJgf,aACAlgB,MAAK,OAAa,MAClBH,UAAU,KACTpI,KAAKk9G,mBAIHa,mBACN,MAAMl+G,EAAW,GACjB,IAAIC,EACJE,KAAKi9G,mBAAmB13D,kBAAkBz/C,QAAQ1F,YAC5CA,EAAWkoB,UACO,QAApBjoB,IAAWihB,iBAAS,SAAExb,QAAQtF,IACxBA,EAAS49B,SACXv+B,EAASe,KAAKJ,KAGlBR,KAAKw+G,eAAiB3+G,EACtBG,KAAKu3B,KAAK7P,SAAS41F,YAAe31F,SAAS9nB,KAEvB,QAApBS,IAAWghB,iBAAS,SAAExb,QAAQtF,IACxBA,EAAS49B,UACXt+B,EAAUU,KAGdR,KAAKu3B,KAAK7P,SAAS7kB,OAAU40B,MAAM33B,GACnCE,KAAK+8G,eAAe30G,UAAW5H,IACzBR,KAAKu3B,KAAK7P,SAAS7kB,OAAUf,QAAUtB,GACzCR,KAAKu3B,KAAK7P,SAAS7kB,OAAU8kB,SAASnnB,KAG1CR,KAAKy+G,cAAgB3+G,KAKnBm+G,yBACN,IAAIp+G,EACJG,KAAKq9G,yBAAyB93D,kBAAkBz/C,QAAQhG,UAClC,QAApBM,IAAWkhB,iBAAS,SAAExb,QAAQzF,IACxBA,EAAS+9B,UAKXv+B,EAAUQ,EAAS4O,MACnBjP,KAAKu3B,KAAK7P,SAAS05B,aAAgBz5B,SALvB,CACV/iB,GAAIvE,EAAS6f,QAAQujC,WACrB3hD,MAAOzB,EAAS4O,WAMtBjP,KAAK0+G,oBAAsB7+G,IAI/B8+G,WAAW9+G,GACT,IAAIC,EACJ,OAAID,EAASktB,UAETjtB,EADEqE,MAAM4B,QAAQlG,EAASktB,SACfltB,EAASktB,QAAQjsB,KAAK,MAEtBjB,EAASktB,SAGhBjtB,GAAW,GAGdk+G,4EACJ,UAAW59G,KAAUJ,KAAKk3G,WAAWtoG,QAAQ+2C,WAAW9iD,OAAO2iD,QAC7D,GAAIplD,EAAOw+G,aAAc,CACvB,IAAIv+G,EACJ,UAAWC,KAAeF,EAAOw+G,aAAc,CAC7C,IAAIp+G,EACJ,UAAWkD,KAAc1D,KAAK6O,cAAcnE,UAAU,QAChDpK,EAAYsE,KAAOlB,EAAWkB,IAAMtE,EAAY4Q,OAASxN,EAAWwN,QACtE1Q,EAAY,CACVoE,GAAIlB,EAAWkB,GACfiM,IAAKnN,EAAWmN,IAChBK,KAAMxN,EAAWwN,KACjByK,OAAQjY,EAAWiY,SAOzB,GAHgBtb,EAAhBG,EAAUqQ,UAAwB7Q,KAAK6+G,WAAWpqF,OAAOj0B,GAC3CA,EAAUmb,OAEpBtb,EAAW,CACb,IAEIuD,EAFAF,EAAYtD,EAChBsD,EAAU4d,UAAY,GAEtB,UAAWzd,KAASxD,EAAW,CAC7B,GAAID,EAAOkoB,SAAU,CACnB,IAAIvkB,EAC0DA,KAA3C,QAAnBlE,OAAK2+G,sBAAc,eAAE3jG,KAAK7W,GAAOA,EAAIiL,QAAUpL,EAAM/B,QACrD8B,EAAW,CACTqL,MAAOpL,EAAM/B,MACbs8B,UACAle,QAAS,CACPiiC,SAAU7hD,EAAY6hD,SACtBG,aAAchiD,EAAYgiD,aAC1BmB,WAAY5/C,EAAMe,UAItBhB,EAAW,CACTqL,MAAOpL,EAAM/B,MACbs8B,SAA2B,QAAlBt+B,OAAK2+G,qBAAa,eAAExvG,SAAUpL,EAAM/B,MAE7Coe,QAAS,CACPiiC,SAAU7hD,EAAY6hD,SACtBG,aAAchiD,EAAYgiD,aAC1BmB,WAAY5/C,EAAMe,KAIxBlB,EAAU4d,UAAU1gB,KAAKgD,GAE3B5D,KAAK09G,kBAAkB7iG,KAAKhX,GAASA,EAAMqF,IAAIuK,SAAS/P,EAAUkB,KAAK2gD,kBACpE1qC,KAAKhX,GAAQA,EAAKoL,QAAUvL,EAAUuL,OAAOqS,UAAY5d,EAAU4d,WAG1EthB,KAAK+9G,sBAKLG,0EACJ,UAAWr+G,KAAUG,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWvE,aAAaoE,QACnE,GAAI3lD,EAAO++G,aAAc,CACvB,IAAI9+G,EACJ,UAAWM,KAAeP,EAAO++G,aAAc,CAC7C,IAAIv+G,EACJ,UAAWC,KAAcN,KAAK6O,cAAcnE,UAAU,QAChDtK,EAAYwE,KAAOtE,EAAWsE,IAAMxE,EAAY8Q,OAAS5Q,EAAW4Q,QACtE7Q,EAAY,CACVuE,GAAItE,EAAWsE,GACfiM,IAAKvQ,EAAWuQ,IAChBK,KAAM5Q,EAAW4Q,KACjByK,OAAQrb,EAAWqb,SAOzB,GAHgB7b,EAAhBO,EAAUwQ,UAAwB7Q,KAAK6+G,WAAWpqF,OAAOp0B,GAC3CA,EAAUsb,OAEpB7b,EAAW,CACb,IAEIU,EAFAF,EAAYT,EAChBS,EAAUghB,UAAY,GAEtB,UAAW5d,KAAS5D,EAClBU,EAAW,CACTyO,MAAOvL,EAAM5B,MACbs8B,WAASp+B,KAAK0+G,qBAAuB1+G,KAAK0+G,sBAAwBh7G,EAAM5B,OAExEoe,QAAS,CACPiiC,SAAU/hD,EAAY+hD,SACtBG,aAAcliD,EAAYkiD,aAC1BmB,WAAY//C,EAAMkB,KAGtBtE,EAAUghB,UAAU1gB,KAAKJ,GAE3BR,KAAK29G,wBAAwB9iG,KAAKnX,GAASA,EAAMwF,IAAIuK,SAASnT,EAAUsE,KAAK2gD,kBAC1E1qC,KAAKnX,GAAQA,EAAKuL,QAAU3O,EAAU2O,OAAOqS,UAAYhhB,EAAUghB,WAI1EthB,KAAK8+G,wBAAwBj/G,EAAO+E,IAAM,IAAI8R,IAC9C1W,KAAKkf,MAAMD,gBACXjf,KAAK8+G,wBAAwBj/G,EAAO+E,IAAM5E,KAAKu3B,KAAK7P,SAAS05B,aAAgB34B,aAAalgB,MACxF,OAAInI,IACF,GAAIA,EAAMG,OACR,OAAgB,MAATT,OAAS,EAATA,EAAW2G,OAAQpG,IACxB,MAAMC,EAAmBF,EAAQA,EAAM2G,cAAc4hB,UAAU,OAAOxiB,QAAQ,mBAAoB,IAAM,GAExG,OAD8B9F,EAAOyB,MAAMiF,cAAc4hB,UAAU,OAAOxiB,QAAQ,mBAAoB,IACzEsN,SAASnT,WAyBpDy+G,eAAel/G,GACb,IAAIC,EACJ,OAAID,EAAW4wB,OAAS5wB,EAAWu+B,UACjCt+B,EAAS,CACP,mBAAoB,QAAQD,EAAW4wB,WAGpC3wB,EAGTk/G,iBAAiBn/G,GACf,QAAOA,EAAOo/G,UAAWp/G,EAAOo/G,SAG1Bd,2BACNn+G,KAAKu9G,uBAAuB73G,IAAI7F,GAASA,EAAMu+B,SAAU,GACzDp+B,KAAKu9G,uBAAuB1iG,KAAKhb,GAASA,IAAUG,KAAK49G,yBAAyBx/E,SAAU,EAGtFggF,0BACNp+G,KAAKw9G,sBAAsB93G,IAAI7F,GAASA,EAAMu+B,SAAU,GACxDp+B,KAAKw9G,sBAAsB3iG,KAAKhb,GAASA,IAAUG,KAAK69G,wBAAwBz/E,SAAU,EAGpFigF,4BACNr+G,KAAKy9G,wBAAwB/3G,IAAI7F,GAASA,EAAMu+B,SAAU,GAC1Dp+B,KAAKy9G,wBAAwB5iG,KAAKhb,GAASA,IAAUG,KAAK89G,0BAA0B1/E,SAAU,EAGxFkgF,sBACNt+G,KAAK09G,kBAAkBh4G,IAAI7F,GAASA,EAAMu+B,SAAU,GACpDp+B,KAAK09G,kBAAkB7iG,KAAKhb,GAASA,IAAUG,KAAKi9G,oBAAoB7+E,SAAU,EAG5EmgF,4BACNv+G,KAAK29G,wBAAwBj4G,IAAI7F,GAASA,EAAMu+B,SAAU,GAC1Dp+B,KAAK29G,wBAAwB9iG,KAAKhb,GAASA,IAAUG,KAAKq9G,0BAA0Bj/E,SAAU,EAGhGvd,kBAAkBhhB,EAAsBC,GACtCk3E,aAAah3E,KAAKg9G,qBACG,gBAAjBl9G,GACFE,KAAKk/G,oBAGHr/G,IACFA,EAAoBu+B,SAAWv+B,EAAoBu+B,SAErDp+B,KAAKg9G,oBAAsB7lC,WAAW,KACpCn3E,KAAKk9G,gBACJ,KAGLgC,oBACEl/G,KAAK89G,yBAAyBv4D,kBAAkBz/C,QAAQjG,IACtDA,EAAWyhB,UAAU5b,IAAI5F,GAAYA,EAASs+B,SAAU,GAExDp+B,KAAKg9G,oBAAsB7lC,WAAW,KACpCn3E,KAAKk9G,gBACJ,OAIPiC,cACEn/G,KAAKy+G,mBAAgB,EAGvBW,oBACEp/G,KAAK0+G,yBAAsB,EAC3B1+G,KAAKu3B,KAAK7P,SAAS05B,aAAgBz5B,SAAS,IAC5C3nB,KAAKu3B,KAAK7P,SAAS05B,aAAgBi+D,kBAGrCC,qBACE,GAAIt/G,KAAKu/G,kBAAmB,CAC1B,MAAM1/G,EAAW,GACjBG,KAAKi9G,mBAAmB13D,kBAAkBz/C,QAAQhG,UAC5B,QAApBM,IAAWkhB,iBAAS,SAAExb,QAAQzF,IAC5BR,EAASe,KAAKP,OAGlBL,KAAKw/G,IAAI5wG,QAAQ9I,QAAShG,GAAoBA,EAAK+C,UACnD7C,KAAKw+G,eAAiB3+G,OAEtBG,KAAKw/G,IAAI5wG,QAAQ9I,QAASjG,GAAoBA,EAAK4/G,YACnDz/G,KAAKw+G,eAAiB,GAI1BkB,kBAAkB7/G,EAAOC,EAAQM,GAC/B,GAAIN,EAAOwoB,SAAU,CACnB,MAAMjoB,EAAWL,KAAKw+G,eACtB,IAAIl+G,GAAY,EAOhB,GANAN,KAAKw/G,IAAI5wG,QAAQ9I,QAAStF,IACnBA,EAAK6f,WACR/f,GAAY,KAGhBN,KAAKu/G,kBAAoBj/G,EACrBF,EAAMu/G,YACR,GAAIt/G,EAASE,QACX,UAAWC,KAAWH,EACpB,GAAIG,EAAQyO,QAAUpP,EAAMoP,OAC1B,GAAIzO,EAAQ49B,SAAWv+B,EAAMu+B,QAAS,CACpC/9B,EAAS2E,OAAO3E,EAASH,QAAQM,GAAU,GAC3CR,KAAKw+G,eAAiBn+G,EACtB,eAEOA,EAASH,QAAQM,KAAaH,EAASE,OAAS,EAAG,CAC5DF,EAASO,KAAKf,GACdG,KAAKw+G,eAAiBn+G,EACtB,YAIJA,EAASO,KAAKf,GACdG,KAAKw+G,eAAiBn+G,OAI1BL,KAAKy+G,cAAgB5+G,EAIzB+/G,wBAAwB//G,GACtBG,KAAK0+G,oBAAsB7+G,EAAMiC,MAGnC+9G,UAAUhgH,GACR,OAAOA,EAAMA,EAAIiC,WAAQ,EAGnBo7G,eACN,IAAIr9G,EAAoB,GACxB,MAAMC,EAAa,GACbM,EAAgB,CAACJ,KAAK49G,wBAAyB59G,KAAK69G,uBACxD79G,KAAK89G,yBAA0B99G,KAAKi9G,mBAAoBj9G,KAAKq9G,0BAC/D,UAAWh9G,KAAgBD,EACrBC,EAAaklD,mBACfllD,EAAaklD,kBAAkB7/C,IAAIpF,UACjC,MAAMoD,EAAkB,GACA,QAAxBlD,IAAe8gB,iBAAS,SAAE7a,OAAO7C,IAAuC,IAAxBA,EAAYw6B,SAC3Dt4B,QAAQlC,GAAmBF,EAAgB9C,KAAKgD,EAAgBsc,UAC7Dxc,EAAgBnD,QAAU,GAE1BT,EAAWc,KADkB,IAA3B8C,EAAgBnD,OACFmD,EAAgB,GAEhB,CAAC0+C,QAAS9hD,EAAe8hD,QAASliC,QAASxc,MAMjE1D,KAAKm6G,sBAAwBn6G,KAAKy8G,eAAej9F,QACnD1f,EAAWc,KAAKZ,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWwzC,oBAAoB,IAErEr5F,EAAWS,QAAU,IACvBV,EAAoBG,KAAK8pD,gBACtBzI,YAAkC,IAAtBvhD,EAAWS,OACtBT,EAAW,GAAK,CAACsiD,QAAS,MAAOliC,QAASpgB,KAEX,QAAjCE,KAAKk3G,WAAWtoG,QAAQ9J,MAC1B9E,KAAKw6G,iBAAiBvhB,YAAYj5F,KAAKk3G,WAA6Br3G,GAEjC,QAAjCG,KAAKk3G,WAAWtoG,QAAQ9J,MAE1B9E,KAAKk3G,WAAWn6D,GAAGtzB,UAErBzpB,KAAKk3G,WAAWvuD,cAAc3oD,KAAKk3G,WAAWtoG,QAAQ+2C,YAAY,GAGpEm6D,cAAcjgH,EAAQC,GACpB,IAAIM,EAAkB,EACtB,UAAWE,KAAaT,EAAOyhB,UAC7BlhB,IAGF,OAAOA,GADgB,UAATN,EAAmBE,KAAK+/G,kBAAoB//G,KAAKggH,iBAIjEC,mBAAmBpgH,GACR,UAATA,EAAmBG,KAAK+/G,mBAAqB,EAAI//G,KAAKggH,iBAAmB,EAI3EE,cAAcrgH,EAAQC,GACpB,IAAIM,EAAkB,EACtB,UAAWE,KAAaT,EAAOyhB,UAC7BlhB,IAGF,OAAOJ,KAAKmgH,aADW,UAATrgH,EAAmBE,KAAK+/G,kBAAoB//G,KAAKggH,kBAC5B5/G,EAAkBJ,KAAKmgH,UAG5DC,mBAAmBvgH,GACR,UAATA,EAAmBG,KAAK+/G,kBAAoB//G,KAAKmgH,UAAYngH,KAAKggH,gBAAkBhgH,KAAKmgH,UAI3FhG,6BACE,OAC8B,QAA5Br6G,EAAkB,QAAlBD,OAAKu4G,qBAAa,eAAEj2D,gBAAQ,eAAEp7C,iBAC9B/G,KAAKo6G,kBAAkB55D,OAAOz5C,cAIlCkyG,eAAep5G,EAAYC,EAAcM,GAAgB,GACvD,MAAMC,EAAmBL,KAAKq5G,eAAev5G,GACzCO,IACFL,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWwzC,oBAAoBt+E,KACrDva,GAAUA,EAAOskD,WAAa5kD,KAAKo4G,cAAcxzD,UACjDvkD,GAAoBR,EAEjBO,GACHJ,KAAKk9G,gBAKX7D,eAAex5G,GACb,OAAQG,KAAKo4G,cAAcj2D,eACpBxC,GAAkBM,0BAClBN,GAAkBG,uBAClBH,GAAkBQ,2BAClBR,GAAkBS,oCAClBT,GAAkBU,wBAClBV,GAAkBW,4BACrB,MAAO,kBACJX,GAAkBO,eACrB,MAAO,eACJP,GAAkBY,kBACrB,OAAO1gD,GAAe,IAARA,EACV,gBACAA,GAAe,IAARA,EACP,qBACA,OACD8/C,GAAkBa,OACrB,OAAO3gD,GAAe,IAARA,EACV,QACAA,GAAe,IAARA,EACP,WACA,UAEJ,sDAnuBKkB,GAA2BrB,iFAA3BqB,EAA2BugB,0VAF3B,CAAEkT,MAAY6rF,ujHDlC3B3gH,kBACEA,wBAuMFA,QAEAA,+BA1MMA,0BACsBA,gDAyMtBA,kkCCtKOqB,gCC3BLrB,yBACEA,8BACFA,kCAFgDA,iBAC9CA,6DCcG4gH,iBAwCXv4G,cA7BO/H,eAAsB,CAAC,SAAU,UAAW,WAAY,SAAU,MAAO,MAAO,YAAa,WAC7FA,uBAAoB,IAAIqmB,MAAY,GAMpCrmB,iBAAcs5F,GAEdt5F,oBAAoCA,KAAKugH,YAAYC,QAMnDxgH,YAAkB,GAIjBA,eAAY,IAAIN,MAEhBM,oBAAiB,IAAIN,MAErBM,gBAAa,IAAIN,MACjBM,0BAAuB,IAAIN,MAE3BM,kBAAe,IAAIN,MACnBM,uBAAoB,IAAIN,kBAlChC,OAAOM,KAAKygH,iBAEJ5gH,GACRG,KAAKygH,OAAS5gH,EAmChB2gB,WACuC,IAAjCxgB,KAAK0gH,kBAAkB5+G,QACzB9B,KAAK8E,KAAO9E,KAAKugH,YAAYhnB,YAEM,IAAjCv5F,KAAK0gH,kBAAkB5+G,QACzB9B,KAAK8E,KAAO9E,KAAK2gH,gBAEnB3gH,KAAKq3C,UAAUn/B,KAAKlY,KAAK8E,MAG3B87G,aAAa/gH,GAC0B,IAAjCG,KAAK0gH,kBAAkB5+G,QACzB9B,KAAK8E,KAAOw0F,GAAkBC,YAEK,IAAjCv5F,KAAK0gH,kBAAkB5+G,QACzB9B,KAAK8E,KAAO9E,KAAK2gH,gBAEnB3gH,KAAKq3C,UAAUn/B,KAAKlY,KAAK8E,MAG3B+7G,iBAAiBhhH,GACfG,KAAK2gH,eAAiB9gH,EACtBG,KAAKq3C,UAAUn/B,KAAKlY,KAAK2gH,gBAG3B9/F,oBACE7gB,KAAK8gH,eAAe5oG,KAAKlY,KAAK+gH,mBAC9B/gH,KAAKghH,WAAW9oG,UAAK,iDArEZnX,8BAA0BugB,0xBDxBvC5hB,2BAEEA,+CAAuBI,iCAAvBJ,CAA0D,uCACrCI,oBAErBJ,0CACEA,0BACEA,qBAAWA,8BAAmDA,QAC9DA,wBAAYA,0CAAmBI,uBAAnBJ,CAAuC,yDACjDA,+BAGFA,QACFA,QACAA,qCAKEA,sCAAcI,sBAAdJ,CAAsC,0CACdI,gCADxBJ,CAAsC,kCAEtBI,wBAFhBJ,CAAsC,uCAGjBI,8BACvBJ,QACFA,QAEAA,4CACEA,kBACEA,sCAEEA,kCAAUI,8BACVJ,sDACIA,uBACJA,QACAA,sDACIA,uBACJA,QACFA,QACFA,QACFA,QAEFA,eAxCEA,iDAISA,uEAEMA,gEACyCA,4CAChBA,sCAMpCA,gCAAe,gCAAfA,CAAe,cAAfA,CAAe,mBAWVA,kEAGHA,yCAEmBA,8CAA6B,+DAG7BA,4CAA2B,8qBCVzCqB,gCClBDrB,yBACIA,SACJA,kCAFoEA,iBAChEA,oEAkBRA,yBACIA,8BACJA,kCAFqDA,iBACjDA,6DCACuhH,iBA6DXl5G,YACUlI,EACAC,EACAM,GAFAJ,4BACAA,sBACAA,uBA9BDA,YAAkB,GAKpBA,iBAAiCsgG,GAAkBC,OAEnDvgG,iBAAc,IAAIqmB,MAElBrmB,uBAAoB,IAAIqmB,MAUrBrmB,gBAAa,IAAIN,MACjBM,0BAAuB,IAAIN,MAC3BM,kBAAe,IAAIN,MACnBM,uBAAoB,IAAIN,kBApDhC,OAAOM,KAAKygH,iBAEJ5gH,GACRG,KAAKygH,OAAS5gH,kBAMd,OAAOG,KAAKkhH,yBAEArhH,GACZG,KAAK+4B,YAAYpR,SAAS,IAC1B3nB,KAAKkhH,WAAarhH,aAMlB,OAAOG,KAAKmhH,eAELthH,GACPG,KAAKmhH,MAAQthH,EACRA,IACHG,KAAKohH,oBAAiB,EACtBphH,KAAKqhH,kBAAkB15F,SAAS,uBAqBlC,MAAO,CAAC24E,GAAkBC,OAAQD,GAAkBG,YAgBtDjgF,WACExgB,KAAKshH,mBAAqBthH,KAAK+4B,YAAYtQ,aAAargB,UAAWvI,IAC7DA,EAAMU,QACRP,KAAKoR,MAAM6L,KAAKxW,OAAQ3G,IACtB,MAAMM,EAAmBP,EAAMkH,cAAc4hB,UAAU,OAAOxiB,QAAQ,mBAAoB,IAE1F,OAD8BrG,EAAQqnB,WAAWu/D,IAAI3/E,cAAc4hB,UAAU,OAAOxiB,QAAQ,mBAAoB,IACnFsN,SAASrT,OAK5CJ,KAAKuhH,qBAAuBvhH,KAAKqhH,kBAAkB54F,aAChDlgB,QACC8P,KAAa,MACb,UAEDjQ,UAAWvI,IACNG,KAAKwhH,cAAgBlhB,GAAkBC,QAAU1gG,EAAQ,GAAKA,GAAS,KACzEG,KAAKyhH,aAAavpG,KAAKrY,GACvBG,KAAK0hH,qBAAqB1mB,mBACxBh7F,KAAK2hH,aACLroB,GAAkBC,WAClB15F,EACAG,KAAK4hH,WACLx5G,UAAWtI,IACXE,KAAKohH,eAAiBthH,EACtBE,KAAK6hH,qBAAqB3pG,KAAKlY,KAAKohH,mBAE7BphH,KAAKwhH,cAAgBlhB,GAAkBG,YAAc5gG,EAAQ,GAAKA,GAAS,KACpFG,KAAKyhH,aAAavpG,KAAKrY,GACvBG,KAAK0hH,qBAAqB1mB,mBACxBh7F,KAAK2hH,aACLroB,GAAkBC,WACV,IAAR15F,EACAG,KAAK4hH,WACLx5G,UAAWtI,IACXE,KAAKohH,eAAiBthH,EACtBE,KAAK6hH,qBAAqB3pG,KAAKlY,KAAKohH,mBAEnB,IAAdvhH,GAAmBG,KAAKqqD,OAAO9pD,OAAS,GAC7CP,KAAKyhH,aAAavpG,KAAKrY,GACvBG,KAAK6hH,qBAAqB3pG,KAAKlY,KAAK2hH,gBAElC9hH,EAAQ,GACPG,KAAKwhH,cAAgBlhB,GAAkBC,QAAU1gG,EAAQ,KACzDG,KAAKwhH,cAAgBlhB,GAAkBG,YAAc5gG,EAAQ,OAC9DG,KAAKqhH,kBAAkB15F,SAAS,GAChC3nB,KAAK+Q,eAAelB,MAAM7P,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,qCAC/DhQ,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,qCAKnDmI,cACEnY,KAAKshH,mBAAmB54G,cAG1Bm3G,UAAUhgH,GACR,OAAOA,EAAUA,EAAQsnB,WAAWu/D,SAAM,EAG5Co7B,aAAajiH,GACPA,GAAWG,KAAK4hH,WAClB5hH,KAAK0hH,qBAAqB3mB,aAAal7F,EAASG,KAAK4hH,WACpDx5G,UAAWtI,IACVE,KAAK2hH,aAAe7hH,EACpBE,KAAKghH,WAAW9oG,KAAKpY,KAS3BiiH,oBAAoBliH,GACdA,IAASG,KAAKwhH,cAGhBxhH,KAAKwhH,YAAc3hH,EACnBG,KAAKgiH,kBAAkB9pG,KAAKlY,KAAKwhH,aAE/BxhH,KAAKqhH,kBAAkB15F,SADzB3nB,KAAKwhH,cAAgBlhB,GAAkBC,OAC0B,IAA/BvgG,KAAKqhH,kBAAkBv/G,MACvB9B,KAAKqhH,kBAAkBv/G,MAAQ,oDArJ1Df,GAA0BrB,wDAA1BqB,EAA0BugB,gtBD1BvC5hB,kBACIA,4BACIA,0CAEAA,gCAA0CA,0CAAkBI,iCAExDJ,gDAGJA,QACJA,QACJA,gBAEAA,kBACIA,mBACIA,6BACIA,2CAEJA,QACJA,QAEAA,8BACIA,0BAEAA,2CAAmBI,iCACnBJ,gCAGAA,QACJA,QACJA,QAnBAA,QAXAA,+BAEkCA,4EAC1BA,mCAA2B,qBAE3BA,0CACqCA,0DAUHA,0EAA6DA,yCAAiC,UAAjCA,CAAiC,oBAOhIA,sCAEoCA,0dCC/BqB,+CCZTrB,+BAGEA,0EACAA,8BACFA,gCAJEA,uCAA+B,0BAG/BA,iHAEFA,+BAGEA,8EACAA,8BACFA,gCAJEA,wCAAgC,0BAGhCA,sGAgBFA,wBACIA,8BACJA,kCAFqDA,iBACjDA,kGAbRA,kBACEA,mBACEA,6BACEA,yCAEFA,QACFA,QAEAA,6BACEA,yBAEAA,2FACAA,gCAGAA,QACFA,QACFA,gCAdoCA,wEAA6DA,yCAAiC,UAAjCA,CAAiC,uCAO9HA,sCAEoCA,oEAmBpCA,wBACIA,8BACJA,kCAFqDA,iBACjDA,kGAbRA,kBACEA,mBACEA,6BACEA,oBACeA,oFADfA,QAEFA,QACFA,QAEAA,6BACEA,yBAEAA,2FACAA,gCAGAA,QACFA,QACFA,gCAdoCA,wEAA6DA,yCAAiC,YAAjCA,CAAiC,+DAO9HA,sCAEoCA,mFASpCA,+BAEEA,yEACAA,8BACFA,oCAHEA,iBAEAA,sFAQEA,8BAA4DA,8BAAiDA,eAAjDA,uGAK5DA,8BACEA,2BAAcA,+EAAoC,OAGlDA,QACFA,iCAHgBA,4CAA2B,2FAM/CA,gDACAA,4DAMAA,4BACEA,iBAEEA,qBACAA,SACAA,2BAAiCA,iCAASU,qBAATV,CAAkC,wFACX,OAExDA,QACFA,QACFA,+CANIA,+BAGcA,sGAMlBA,gCACIA,kBACEA,qBACEA,uFACAA,uBACFA,QACAA,SACAA,2BAAmCA,+FAA2C,OAG9EA,QACFA,QACAA,iBACEA,YACFA,QACJA,+CAXkBA,qFAEZA,+BAEcA,6CAA+B,+DAI3BA,iGAjD5BA,kBACEA,qBAEIA,YACEA,qCACFA,QAGAA,YACEA,qCAMJA,QAEAA,oCACAA,6BAEFA,QAEAA,uBAEEA,mCAaAA,2CAiBFA,QACFA,8BAtCqBA,qDACaA,sDAItBA,0CAAyB,6BAegBA,0FAsBnDA,qBACEA,iEACEA,8BACJA,gCAH6EA,0CAEzEA,iHAGJA,qBACEA,mEACAA,8BACFA,gCAHqFA,6CAEnFA,+GAkBJA,qBAMEA,4FACAA,uBACFA,aAHEA,kHAMAA,qBAKEA,6FACFA,uBACAA,aAHEA,kHALJA,kBACEA,4BAQAA,+BAIEA,uDAAsBA,EAAtBomB,MAAsBm8F,uBACxBviH,QACFA,gCAbKA,uCASDA,2CAA0B,sBCtIjBwiH,iBA2MXn6G,YACUlI,EACAC,EACAM,EACAC,GAHAL,aACAA,4BACAA,sBACAA,uBA5FDA,YAAkB,GAElBA,eAAqB,GAWpBA,kBAAe,IAAIN,MAEnBM,oBAAiB,IAAIN,MAErBM,oBAAiB,IAAIN,MAErBM,mBAAgB,IAAIN,MAEpBM,iBAAc,IAAIN,MAClBM,0BAAuB,IAAIN,MAC3BM,uBAAoB,IAAIN,MAExBM,iBAAc,IAAIN,MAClBM,qBAAkB,IAAIN,MAEtBM,sBAAmB,IAAIN,MAEvBM,sBAAmB,IAAIN,MAEvBM,YAAS,IAAIN,MAEbM,mBAAgB,IAAIN,MACpBM,kBAAe,IAAIN,MAEtBM,cAAoC,CAACw5F,GAAsBC,QAASD,GAAsB2oB,WAC1FniH,sBAA0Cw5F,GAAsBC,QAGvEz5F,iBAAwD,IAAIoiH,MAAyC9hH,GAAQA,EAAKy2B,UAG3G/2B,sBAA6B,CAAC,OAAQ,UACtCA,eAAqC,GACrCA,YAAmB,GACnBA,eAAqC,GACrCA,gBAAa,IAAIqiH,MACjBriH,uBAAoB,IAAI6kC,OAAsC,EAAM,IAG3E7kC,YAA2C,IAAI+I,SAAgB,GAC/D/I,gBAAsC,IAAI+I,IAAgB,MAC1D/I,mBAA2F,IAAI+I,SAAgB,GAC/G/I,gBAAwF,IAAI+I,SAAgB,GAMrG/I,iBAAc,IAAIqmB,MAElBrmB,wBAAoB,EACpBA,mBAA0B,CAAC,QAAS,WACpCA,qBAAiB,EACjBA,eAAoB,KACpBA,0BAAuB,GACvBA,cAAU,EACVA,0BAAsB,EACtBA,2BAAuB,EAQvBA,YAAiB,EACjBA,uBAAoB,IAAIqmB,MACxBrmB,uBAAoB,IAAIqmB,MAExBrmB,iBAAiCsgG,GAAkBC,OAGnDvgG,oBAAgB,aAlMrB,OAAOA,KAAKuwG,eAEL1wG,GACPG,KAAKuwG,MAAQ1wG,EACb,MAAMC,EAAQE,KAAKsiH,cAAc59G,UAAUtE,GAAQA,IAASJ,KAAK8E,MAiBjE,GAhBA9E,KAAKi9F,aAAej9F,KAAKsiH,cAAcxiH,GACvCE,KAAK+4B,YAAYtB,QACjBz3B,KAAK+tD,YAAS,EACd/tD,KAAKuiH,WAAWp6G,KAAK,MACrBnI,KAAKwiH,WAAWr6G,UAAK,GAGjBnI,KAAK8E,OAASw0F,GAAkBC,YAKlCv5F,KAAK+4B,YAAYpR,SAJgB,CAC/B7iB,KAAM,QACNy+E,YAAa,KAMbvjF,KAAK8E,OAASw0F,GAAkBoD,MAClC18F,KAAK+tD,OAAS,IACd/tD,KAAKyiH,kBAAkB96F,SAAS3nB,KAAK+tD,QACrC/tD,KAAK0iH,WAAa,CAACtiH,EAAgCC,KACjD,MAAMC,EAAOF,EAAQ2xD,cACfvxD,EAAcqtD,MAAiBvtD,EAAKkzD,iBAAkBxzD,KAAK0F,IAAI+jD,WAAY,aACjF,OAAO,IAAIk5D,MAAe,CACxB70E,MAAO,IAAI60E,KAAgB,CACzB50D,OAAQ/tD,KAAK+tD,OAAUxmD,KAAK68F,IAAK78F,KAAKo0D,GAAK,IAAOn7D,EAAY,IAAOH,EACrEm7D,OAAQ,IAAImnD,KAAe,CACzBlrD,MAAO,EACPhnC,MAAO,sBAET6pC,KAAM,IAAIqoD,KAAa,CACrBlyF,MAAO,gCAKfzwB,KAAK6xG,aAAe7xG,KAAK0iH,WACzB1iH,KAAKwiH,WAAWr6G,KAAKnI,KAAK6xG,kBACrB,CAEL7xG,KAAK+tD,YAAS,EACd/tD,KAAK4iH,UAAY,IACR,IAAID,MAAe,CACxBnnD,OAAQ,IAAImnD,KAAe,CACzBlrD,MAAO,EACPhnC,MAAO,sBAET6pC,KAAM,IAAIqoD,KAAa,CACrBlyF,MAAO,6BAIb,MAAMrwB,EAAQ,CAAC,EAAG,IAAK,KACjBC,EAAY,IACT,IAAIsiH,MAAc,CACvB70E,MAAO,IAAI60E,KAAgB,CACzB50D,OAAQ,EACRyN,OAAQ,IAAImnD,KAAe,CACzBlrD,MAAO,EACPhnC,MAAO,sBAET6pC,KAAM,IAAIqoD,KAAa,CACrBlyF,MAAO,6BAGX+qC,OAAQ,IAAImnD,KAAe,CACzBlyF,MAAOrwB,EAAM4F,OAAO,CAAC,IACrByxD,MAAO,IAET6C,KAAO,IAAIqoD,KAAa,CACtBlyF,MAAOrwB,EAAM4F,OAAO,CAAC,SAI3BhG,KAAK6xG,aAAe7xG,KAAK4iH,UACzB5iH,KAAKwiH,WAAWr6G,KAAK9H,GAEvBL,KAAK6iH,cAAc16G,KAAKnI,KAAK6xG,0BAY7B,OAAO7xG,KAAKygH,iBAEJ5gH,GACRG,KAAKygH,OAAS5gH,EACdG,KAAKygH,OAAOnjG,UAAUlV,UAAU,KAAQpI,KAAKkf,MAAMD,qCASnD,MAAO,CAACqhF,GAAkBC,OAAQD,GAAkBG,iCASpD,OAAOzgG,KAAK8iH,mCAEKjjH,GACjBG,KAAK8iH,gBAAkBjjH,EAqFzB2gB,WACExgB,KAAK0hH,qBAAqBhnB,oBACzBtyF,UAAWhI,IACV,UAAWE,KAAQF,EACjBJ,KAAK+iH,UAAUniH,KAAKN,GACpBN,KAAK+iH,UAAU9nG,KAAK,CAACza,EAAGkD,IACflD,EAAE0Q,KAAK9J,cAAc1D,EAAEwN,OAGlClR,KAAKq3B,OAAOz2B,KAAKZ,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,4BACxD,MAAM3P,EAAgC,CACpC6Q,KAAMlR,KAAKq3B,OAAO,GAClBN,SAAU,IAEZ/2B,KAAKgjH,UAAUpiH,KAAKP,GACpBL,KAAK+iH,UAAUj9G,QAAQxF,IACjBA,EAAMs3B,QAA+C,IAArC53B,KAAKq3B,OAAOn3B,QAAQI,EAAMs3B,SAC5C53B,KAAKq3B,OAAOz2B,KAAKN,EAAMs3B,OAKvB53B,KAAKgjH,UAAUpiH,KAJyB,CACtCsQ,KAAM5Q,EAAMs3B,MACZb,SAAU,MAKTz2B,EAAMs3B,QAEPt3B,EAAM4Q,OAASlR,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,8BACtD1P,EAAM4Q,OAASlR,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,wBACtD1P,EAAM4Q,OAASlR,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,2BACtD1P,EAAM4Q,OAASlR,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,4BACtD1P,EAAM4Q,OAASlR,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,6BACtD1P,EAAM4Q,OAASlR,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,2BACtD1P,EAAM4Q,OAASlR,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,wBACtD1P,EAAM4Q,OAASlR,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,2BACpD1P,EAAMs3B,MAAQv3B,EAAO6Q,KACd5Q,EAAM4Q,OAASlR,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,0BAC/D1P,EAAMs3B,MAAQ53B,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,yCAOrDhQ,KAAKgjH,UAAUpiH,KALyB,CACtCsQ,KAAM5Q,EAAM4Q,KACZ6lB,SAAU,GACVza,OAAQhc,EAAMgc,UAKpBtc,KAAKgjH,UAAU/nG,KAAK,CAACza,EAAGkD,IACflD,EAAE0Q,KAAK9J,cAAc1D,EAAEwN,SAGlClR,KAAKgjH,UAAUl9G,QAAQxF,IACrB,UAAWE,KAASR,KAAK+iH,UACnBviH,EAAMo3B,QAAUt3B,EAAS4Q,MAC3B5Q,EAASy2B,SAASn2B,KAAKJ,OAM/BR,KAAK0mB,WAAW6C,KAAOvpB,KAAKgjH,UAE5BhjH,KAAKuiH,WAAWp6G,KAAK,MACrBnI,KAAKijH,OAAO96G,KAAKnI,KAAK+4B,YAAYj3B,MAAQ9B,KAAK+4B,YAAYj3B,WAAQ,GACnE9B,KAAKkjH,QAAUljH,KAAK+4B,YAAYtQ,aAAargB,UAAWhI,IAClDA,GACFJ,KAAKijH,OAAO96G,KAAK/H,GACjBJ,KAAKmjH,SAAWnjH,KAAK+4B,YAAYj3B,MACb,IAAhB9B,KAAKyvE,SACPzvE,KAAKojH,cAAclrG,KAAKlY,KAAKmjH,UAC7BnjH,KAAKqhH,kBAAkB15F,SAAS3nB,KAAKyvE,WAGvCzvE,KAAKijH,OAAO96G,UAAK,GACjBnI,KAAKmjH,cAAW,KAIpBnjH,KAAKijH,OAAO76G,UAAU,KACpBpI,KAAKsyD,YACLtyD,KAAKkf,MAAMD,kBAGbjf,KAAKqjH,gBAAkBrjH,KAAKyiH,kBAAkBh6F,aAAargB,UAAU,KACnEpI,KAAKsyD,YACLtyD,KAAKkf,MAAMD,kBAGbjf,KAAKsjH,gBAAkBtjH,KAAKqhH,kBAAkB54F,aAC3ClgB,MACC,OAAa,MAEdH,UAAWhI,IACNJ,KAAKwhH,cAAgBlhB,GAAkBC,QAAUngG,EAAQ,GAAKA,GAAS,KACzEJ,KAAKyvE,OAASrvE,EACdJ,KAAKujH,YAAYrrG,KAAK9X,GACtBJ,KAAK0hH,qBAAqB1mB,mBACxBh7F,KAAKmjH,SACL7pB,GAAkBknB,QAClBpgH,GACAgI,UAAW/H,IACXL,KAAKohH,eAAiB/gH,EACtBL,KAAK6hH,qBAAqB3pG,KAAKlY,KAAKohH,mBAE7BphH,KAAKwhH,cAAgBlhB,GAAkBG,YAAcrgG,EAAQ,GAAKA,GAAS,KACpFJ,KAAKyvE,OAASrvE,EACdJ,KAAKujH,YAAYrrG,KAAK9X,GACtBJ,KAAK0hH,qBAAqB1mB,mBACxBh7F,KAAKmjH,SACL7pB,GAAkBknB,QACV,IAARpgH,GACAgI,UAAW/H,IACXL,KAAKohH,eAAiB/gH,EACtBL,KAAK6hH,qBAAqB3pG,KAAKlY,KAAKohH,mBAEnB,IAAdhhH,GACLJ,KAAKyvE,OAASrvE,EACdJ,KAAKujH,YAAYrrG,KAAK9X,GACtBJ,KAAKojH,cAAclrG,KAAKlY,KAAKmjH,YAE7B/iH,EAAQ,GACPJ,KAAKwhH,cAAgBlhB,GAAkBC,QAAUngG,EAAQ,KACzDJ,KAAKwhH,cAAgBlhB,GAAkBG,YAAcrgG,EAAQ,OAC5DJ,KAAKqhH,kBAAkB15F,SAAS,GAChC3nB,KAAKyvE,OAAS,EACdzvE,KAAK+Q,eAAelB,MAAM7P,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,qCAC/DhQ,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,qCAIjD,MAAMnQ,EAAyB,IAAI2jH,GAAmC,IAChE1jH,EAAoB,IAAI+pE,GAA8B,CAC1DptB,MAAO,IAAI0oB,GAAY,CACrBpW,OAAQ,IACRzyC,OAAQ,IAAI0vC,GACZ37B,WAAO,EACPigC,iBAAiB,EACjBa,YAAY,EACZD,WAAW,IAEbxrD,IAAK1F,KAAK0F,IACV+iE,aAAc,GACd5B,OAAQhqB,GAActkC,QACtBgtF,MAAM,EACNv9B,SAAS,IAGXhoE,KAAKoR,MAAMwM,YAAY9d,GAAmB,GAC1CE,KAAKoR,MAAMwM,YAAY/d,GAAwB,GAOjDsY,cACEnY,KAAKkjH,QAAQx6G,cACb1I,KAAKqjH,gBAAgB36G,cACrB1I,KAAKsjH,gBAAgB56G,cACrB1I,KAAKkf,MAAMukG,SACPzjH,KAAKqjH,iBACPrjH,KAAKqjH,gBAAgB36G,cAEnB1I,KAAKkjH,SACPljH,KAAKkjH,QAAQx6G,cAIjBg7G,iBAAiB7jH,GACfG,KAAK2jH,iBAAmB9jH,EAAMiC,MAC9B9B,KAAK4jH,eAAe1rG,KAAKlY,KAAK2jH,kBAOhC5B,oBAAoBliH,GACdA,IAASG,KAAKwhH,cAGhBxhH,KAAKwhH,YAAc3hH,EACnBG,KAAKgiH,kBAAkB9pG,KAAKlY,KAAKwhH,aACjCxhH,KAAS6jH,YAEL7jH,KAAKqhH,kBAAkB15F,SADzB3nB,KAAKwhH,cAAgBlhB,GAAkBC,OAC0B,IAA/BvgG,KAAKqhH,kBAAkBv/G,MACvB9B,KAAKqhH,kBAAkBv/G,MAAQ,KACxD9B,KAAK8jH,WAEZ9jH,KAAKyiH,kBAAkB96F,SADzB3nB,KAAKwhH,cAAgBlhB,GAAkBC,OAC0B,IAA/BvgG,KAAKyiH,kBAAkB3gH,MACvB9B,KAAKyiH,kBAAkB3gH,MAAQ,MAKvEiiH,eACE,OAAO/jH,KAAK8E,OAASw0F,GAAkBC,WAGzCsqB,YACE,OAAO7jH,KAAK8E,OAASw0F,GAAkBknB,QAGzCsD,UACE,OAAO9jH,KAAK8E,OAASw0F,GAAkBoD,MAGzCsnB,SAASnkH,EAAWC,GAClB,QAAIA,EAAKi3B,UACAj3B,EAAKi3B,SAASx2B,OAKzBq7E,cAAc/7E,GACZG,KAAKikH,YAAYC,WAAWrkH,GAAQG,KAAKikH,YAAYE,SAAStkH,GAAQG,KAAKikH,YAAYpnC,OAAOh9E,GAGhGymC,cAAczmC,GACZ,IAAIC,EACAM,EAAW,EAsBf,OArBKP,GAaHC,EAAcD,EAAKk3B,SAASx2B,OAC5BV,EAAKk3B,SAASjxB,QAAQzF,IAChBL,KAAKokH,kBAAkB/jG,SAASxF,KAAKva,GAAYA,IAAaD,IAChED,QAfJN,EAAcE,KAAKokH,kBAAkB/jG,SAAS9f,OAC9CP,KAAKgjH,UAAUl9G,QAAQzF,KACsB,IAAvCL,KAAKq3B,OAAOn3B,QAAQG,EAAS6Q,OAC/B9Q,MAGJJ,KAAK+iH,UAAUj9G,QAAQzF,IAChBL,KAAKgjH,UAAUnoG,KAAKva,GAAYA,EAASgc,SAAWjc,EAASic,SAChElc,OAYFA,GAAY,GACPN,IAAgBM,EAM3BikH,oBAAoBxkH,GAClB,IAAIC,GAAO,EACX,SAAKi3B,SAASjxB,QAAQ1F,IAChBJ,KAAKokH,kBAAkB/jG,SAASxF,KAAKxa,GAAYA,EAASic,SAAWlc,EAAMkc,UAC7Exc,GAAO,KAGJA,EAMTymC,eACEvmC,KAAKsmC,gBACHtmC,KAAKokH,kBAAkBluG,QACvBlW,KAAKm0F,YAEP,MAAMt0F,EAAiD,GACvD,UAAWC,KAAYE,KAAKokH,kBAAkB/jG,SAC5CxgB,EAAsBe,KAAKd,GAGzBE,KAAKsmC,gBACPtmC,KAAKgjH,UAAUl9G,QAAQhG,IACjBE,KAAKgkH,SAAS,EAAGlkH,IACnBE,KAAKikH,YAAYpnC,OAAO/8E,KAI5BE,KAAKgjH,UAAUl9G,QAAQhG,IACjBE,KAAKgkH,SAAS,EAAGlkH,IACnBE,KAAKikH,YAAYE,SAASrkH,KAIhCE,KAAKskH,eAAepsG,KAAKrY,GAG3Bs0F,UAAUt0F,GACHA,EAYCG,KAAKgkH,SAAS,EAAGnkH,IACnBA,EAAKk3B,SAASjxB,QAAQhG,GAAYE,KAAKokH,kBAAkBvhH,OAAO/C,KAZlEE,KAAKgjH,UAAUl9G,QAAQhG,KACsB,IAAvCE,KAAKq3B,OAAOn3B,QAAQJ,EAASoR,OAC/BlR,KAAKokH,kBAAkBvhH,OAAO/C,KAGlCE,KAAK+iH,UAAUj9G,QAAQhG,IAChBE,KAAKokH,kBAAkB/jG,SAASxF,KAAKza,GAAYA,EAASkc,SAAWxc,EAASwc,SACjFtc,KAAKokH,kBAAkBvhH,OAAO/C,MAUtCykH,gBAAgB1kH,GACdG,KAAKsmC,cAAczmC,GACnBA,EAAKk3B,SAASjxB,QAAQ1F,GAASJ,KAAKokH,kBAAkB3E,SAASr/G,IAC/DJ,KAAKm0F,UAAUt0F,GAEf,MAAMC,EAAiD,GACvD,UAAWM,KAAYJ,KAAKokH,kBAAkB/jG,SAC5CvgB,EAAsBc,KAAKR,GAE7BJ,KAAKikH,YAAYpnC,OAAOh9E,GACxBG,KAAKskH,eAAepsG,KAAKpY,GAM3B0kH,eAAe3kH,GACb,IAAIC,GAAW,OACmF,IAA9FE,KAAKokH,kBAAkB/jG,SAASxF,KAAKxa,GAAYA,EAASic,SAAWzc,EAAayc,UACpFxc,GAAW,GAGbE,KAAK+iH,UAAUj9G,QAAQzF,IACjBA,IAAaR,IAA6B,IAAbC,GAC/BE,KAAKokH,kBAAkBvhH,OAAOxC,GAE5BA,IAAaR,IAA6B,IAAbC,GAC/BE,KAAKokH,kBAAkB3E,SAASp/G,KAGpCL,KAAKgjH,UAAUl9G,QAAQzF,IACjBA,IAAaR,IAA6B,IAAbC,GAC/BE,KAAKokH,kBAAkBvhH,OAAOxC,GAE5BA,IAAaR,IAA6B,IAAbC,GAC/BE,KAAKokH,kBAAkB3E,SAASp/G,KAIpC,MAAMD,EAAiD,GACvD,UAAWC,KAAYL,KAAKokH,kBAAkB/jG,SAC5CjgB,EAAsBQ,KAAKP,GAE7BL,KAAKskH,eAAepsG,KAAK9X,GAG3BqkH,sBACEzkH,KAAKomG,qBAAuBpmG,KAAKomG,oBAGnCse,0BACE1kH,KAAKixG,sBAAwBjxG,KAAKixG,qBAClCjxG,KAAK2kH,gBAAgBzsG,KAAKlY,KAAKixG,sBAMjC2T,qBACO5kH,KAAK+jH,iBACJ/jH,KAAKyvE,OAAS,GAChBzvE,KAAKohH,eAAevoG,KAAO,CACzBjU,QAAI,EACJqK,MAAO,QAETjP,KAAKohH,eAAej6F,WAAa,CAC/Bu/D,IAAK,OACL5hF,KAAM9E,KAAK8E,MAEb9E,KAAKojH,cAAclrG,KAAKlY,KAAKohH,kBAE7BphH,KAAKmjH,SAAStqG,KAAO,CACnBjU,QAAI,EACJqK,MAAO,QAETjP,KAAKmjH,SAASh8F,WAAa,CACzBu/D,IAAK,OACL5hF,KAAM9E,KAAK8E,MAEb9E,KAAKojH,cAAclrG,KAAKlY,KAAKmjH,YAGjCnjH,KAAS8jH,UACP9jH,KAAK6kH,YAAY3sG,KAAKlY,KAAK+tD,QAClB/tD,KAAK6jH,aACd7jH,KAAKujH,YAAYrrG,KAAKlY,KAAKyvE,QAE7BzvE,KAAK8kH,aAAa5sG,OAClBlY,KAAKoR,MAAMkM,UAAU/U,MACnB,OAAa,MACbH,UAAWvI,IACPA,EAAMU,QAAUP,KAAKqqD,OAAO9pD,SAAWP,KAAK+kH,eAAiB,IAC/D/kH,KAAKglH,cAAc9sG,OACnBlY,KAAKilH,yBAQXC,cACEllH,KAAKs4C,SAAU,EACXt4C,KAAKoR,OACPpR,KAAKoR,MAAM8E,SAETlW,KAAK8jH,WAAa9jH,KAAK6jH,eACzB7jH,KAAKmjH,cAAW,EAChBnjH,KAAK+4B,YAAYtB,SAEnBz3B,KAAKqhH,kBAAkB15F,SAAS,GAChC3nB,KAAKyvE,OAAS,EACdzvE,KAAKujH,YAAYrrG,KAAK,GACtBlY,KAAKmlH,iBAAiBjtG,OACtBlY,KAAKs4C,SAAU,EACft4C,KAAKolH,mBAAgB,EAGvBC,gBACErlH,KAAK+4B,YAAYtB,QACjBz3B,KAAKqhH,kBAAkB15F,SAAS,GAChC3nB,KAAKyvE,OAAS,EAMhB61C,cACEtlH,KAAKokH,kBAAkBluG,QACvBlW,KAAKqhH,kBAAkB15F,SAAS,GAChC3nB,KAAKyvE,OAAS,EACdzvE,KAAKujH,YAAYrrG,KAAK,GACtBlY,KAAKskH,eAAepsG,KAAK,IACzBlY,KAAKulH,iBAAiBrtG,OAMxBstG,sBACE,GAAIxlH,KAAK8E,OAASw0F,GAAkBC,WAAY,CAC9C,GAAIv5F,KAAK2jH,mBAAqBnqB,GAAsBC,cAC3B,IAAnBz5F,KAAK4hH,gBAAyC,IAAd5hH,KAAKylH,KACvC,OAAOzlH,KAAKs4C,QAGhB,GAAIt4C,KAAK2jH,mBAAqBnqB,GAAsB2oB,gBAC3B,IAAnBniH,KAAK4hH,gBAAyC,IAAd5hH,KAAKylH,MAAsBzlH,KAAKokH,kBAAkB/jG,SAAS9f,OAAS,EACtG,OAAOP,KAAKs4C,QAIlB,GAAIt4C,KAAK8E,OAASw0F,GAAkBknB,SAAWxgH,KAAK8E,OAASw0F,GAAkBoD,MAAO,CACpF,GAAI18F,KAAK2jH,mBAAqBnqB,GAAsBC,SAAsC,OAA3Bz5F,KAAK+4B,YAAYj3B,MAC9E,OAAO9B,KAAKs4C,QAEd,GAAIt4C,KAAK2jH,mBAAqBnqB,GAAsB2oB,WAC9CniH,KAAKokH,kBAAkB/jG,SAAS9f,OAAS,GAAgC,OAA3BP,KAAK+4B,YAAYj3B,MACjE,OAAO9B,KAAKs4C,QAIlB,OAAO,EAGTotE,sBACE,IAAI7lH,GAAU,EACd,OACEA,EADFG,KAAK2jH,mBAAqBnqB,GAAsBC,aACjB,IAAnBz5F,KAAK4hH,eACc,IAAnB5hH,KAAK4hH,WAAsE,IAA3C5hH,KAAKokH,kBAAkB/jG,SAAS9f,OAErEV,EAMTyyD,YACE,IAAIzyD,EASJ,GANIA,EAF2B,OAA3BG,KAAK+4B,YAAYj3B,MACnB9B,KAAKwhH,cAAgBlhB,GAAkBC,OACzBvgG,KAAK+4B,YAAYj3B,MAAMisD,OACvB/tD,KAAK+4B,YAAYj3B,MAAMisD,OAAS,SAElC,EAGV/tD,KAAK8E,OAASw0F,GAAkBoD,MAAO,CACzC,GAAK18F,KAAKixG,sBAeR,GAAIpxG,EAAW,CACb,GAAIA,GAAa,IAIf,OAHAG,KAAK+Q,eAAelB,MAAM7P,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,qCAC/DhQ,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,uCACzChQ,KAAK+4B,YAAYtB,QAGnB,GAAI53B,IAAcG,KAAKyiH,kBAAkB3gH,MAEvC,YADA9B,KAAKyiH,kBAAkB96F,SAAS9nB,SAChC,GAtBFG,KAAKyiH,kBAAkB3gH,MAAQ,GAC9B9B,KAAKwhH,cAAgBlhB,GAAkBC,QAAUvgG,KAAKyiH,kBAAkB3gH,OAAS,KACjF9B,KAAKwhH,cAAgBlhB,GAAkBG,YAAczgG,KAAKyiH,kBAAkB3gH,OAAS,IAQtF,OAPA9B,KAAK+Q,eAAelB,MAAM7P,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,qCAC/DhQ,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,kCACzChQ,KAAK+tD,OAAS,IAEZ/tD,KAAKyiH,kBAAkB96F,SADzB3nB,KAAKwhH,cAAgBlhB,GAAkBC,OACLvgG,KAAK+tD,OACL/tD,KAAK+tD,OAAS,UAChD/tD,KAAKuiH,WAAWp6G,KAAKnI,KAAK+tD,QAiB1B/tD,KAAKwhH,cAAgBlhB,GAAkBC,QACzCvgG,KAAK+tD,OAAS/tD,KAAKyiH,kBAAkB3gH,MACrC9B,KAAKuiH,WAAWp6G,KAAKnI,KAAK+tD,UAE1B/tD,KAAK+tD,OAAwC,IAA/B/tD,KAAKyiH,kBAAkB3gH,MACrC9B,KAAKuiH,WAAWp6G,KAAmB,IAAdnI,KAAK+tD,SAE5B/tD,KAAK6iH,cAAc16G,KAAKnI,KAAK0iH,YAC7B1iH,KAAKwiH,WAAWr6G,KAAKnI,KAAK0iH,aAI9BiD,oBACE3lH,KAAK4lH,eAAiB5lH,KAAK4lH,cAGrBX,sBACN,MAAMplH,EAAa,CACjBqR,KAAM,aACNjC,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,8BAC9C2S,SAAUrK,oBAENxY,EAAa,CACjBoR,KAAM,iBACNjC,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,uCAC9C2S,SAAUrK,oBAIZtY,KAAKolH,cAAgB,CACnBzjG,WAAW,EACX1G,MAAM,EACN0L,QALc,CAAC9mB,EAAYC,kDAvvBpBiB,GAA0BrB,qEAA1BqB,EAA0BugB,0pGD9CvC5hB,8FAaAA,iBACIA,qCAMAA,qCAMJA,QAEAA,wBAmBAA,wBAmBAA,uBAAwCA,gCAAiDA,QACzFA,8BACIA,sCAKJA,QAEAA,0BAyDAA,kBAEEA,6BAKAA,6BAKAA,sBACEA,gCAASI,yBACTJ,gCACFA,QAEAA,sBAAoFA,gCAASI,kBAC3FJ,gCACFA,QAEAA,sBAAgGA,gCAASI,kBACvGJ,gCACFA,QAEFA,QAEAA,6BAUAA,iCAxKEA,mCAA2B,YAA3BA,CAA2B,8BAA3BA,CAA2B,qCAA3BA,CAA2B,oBAA3BA,CAA2B,4CAA3BA,CAA2B,8CAA3BA,CAA2B,qCAA3BA,CAA2B,2CAA3BA,CAA2B,mBAaNA,yCAMAA,yCAQGA,qCAmBAA,mCAmBcA,qEACvBA,2CACsBA,qCAOfA,+IA2DbA,wCAKAA,kDAKuCA,mDAE9CA,sEAG8CA,kDAC9CA,yEAG8CA,gEAC9CA,yEAODA,+EAQmBA,q7GC3HTqB,yIC7CXrB,8BAEEA,yEAAwB,6DAExBA,8BACFA,gCAHEA,8BAEAA,8GAGFA,iBACEA,wCAKEA,qFAEFA,QAEFA,gCARIA,qCAAoB,gDAApBA,CAAoB,gCAApBA,CAAoB,qEAYtBA,iBAGEA,6BACEA,qBAAWA,8BAA6CA,QACxDA,oBAIEA,6FAAwD,WAJ1DA,QAOAA,oCAEAA,gCAKEA,4FAAsD,WAExDA,QAEAA,uBAUFA,QAEAA,8BACEA,sBAAWA,gCAA2CA,QACtDA,qBAIEA,8FAAsD,SAJxDA,QAMAA,qCACAA,iCAKEA,6FAAoD,SAEtDA,QAEAA,wBAUFA,QACAA,sBAGEA,wFAGAA,wBACFA,QACAA,gCAEEA,+FAKFA,QAEFA,wDA7EeA,2DAITA,wCAEAA,uCAE+BA,wBAAuB,iCAKtDA,6CAA4B,wBAS5BA,kCAAiC,6EAAjCA,CAAiC,iDAAjCA,CAAiC,+FAUxBA,0DAITA,sCAEAA,uCAC+BA,wBAAqB,iCAIpDA,6CAA4B,sBAS5BA,kCAA+B,yEAA/BA,CAA+B,2EAA/BA,CAA+B,kDAYjCA,wEAAwD,iCAE9CA,sCAKVA,6EAA6D,4DAwCvDA,yBAA2DA,SAAQA,kCAAvBA,iBAAeA,4DAN/DA,6BACEA,qBAAWA,8BAAyCA,QACpDA,yBAGEA,oHAAuD,KACvDA,gCACFA,QACFA,iCAPaA,qDAETA,qDACAA,0CAE6BA,kEAS7BA,yBAAiEA,SAAUA,kCAA3BA,iBAAiBA,4DANrEA,6BACEA,qBAAWA,8BAA2CA,QACtDA,yBAGEA,oHAAuD,KACvDA,gCACFA,QACFA,iCAPaA,uDAETA,uDACAA,0CAE+BA,oEAoC/BA,yBAAyDA,SAAQA,kCAAvBA,iBAAeA,4DAN7DA,6BACEA,qBAAWA,8BAAyCA,QACpDA,yBAGEA,oHAAqD,KACrDA,gCACFA,QACFA,iCAPaA,qDAETA,mDACAA,0CAE6BA,gEAS7BA,yBAA+DA,SAAUA,kCAA3BA,iBAAiBA,4DANnEA,6BACEA,qBAAWA,8BAA2CA,QACtDA,yBAGEA,oHAAqD,KACrDA,gCACFA,QACFA,iCAPaA,uDAETA,qDACAA,0CAE+BA,iFAvCvCA,kBACEA,6BACEA,oCACEA,uBAKEA,uGAAgD,0BALlDA,QAWAA,mBACAA,gCAGEA,4FAAoD,QAApDA,CAA2D,wFACL,SAC1DA,QACFA,QAEAA,kBACEA,qCASAA,qCASFA,QACFA,4CAzCqCA,wBAAqB,iCAGlDA,kCAA+B,uDAA/BA,CAA+B,iDAA/BA,CAA+B,yEAA/BA,CAA+B,2EAA/BA,CAA+B,iDAA/BA,CAA+B,iCAE/BA,0CASAA,6CAA4B,sBAQIA,qDASEA,+FAhF5CA,kBACEA,kBACEA,6BACEA,oCACAA,uBAKEA,uGAAkD,0BALpDA,QAWAA,mBACAA,gCAIEA,4FAAsD,UAAtDA,CAA+D,wFACP,WAC1DA,QACFA,QAEAA,mBACEA,qCASAA,qCASFA,QACFA,QAEAA,4BA6CAA,sBAEEA,wFAGAA,wBACFA,QACAA,gCAEEA,+FAKFA,QACFA,4CAxGuCA,wBAAuB,iCAGtDA,kCAAiC,yDAAjCA,CAAiC,mDAAjCA,CAAiC,6EAAjCA,CAAiC,iDAAjCA,CAAiC,8FAAjCA,CAAiC,iCAEjCA,0CAUAA,6CAA4B,wBAQMA,qDASEA,qDAYbA,6CAgD3BA,wEAAwD,iCAE9CA,sCAOVA,6EAA6D,4DA7LnEA,eAEEA,0BAmFAA,0BA4GFA,8BA/LqCA,0CAmFIA,kDCtF3C,MAAMmgD,GAAS15B,OAOF0/F,iBAiFX99G,YAAmBlI,+BA9ETG,oBAIL,IAAIN,MAMTM,0BAAuB,IAAIqmB,MAC3BrmB,4BAAyB,IAAIqmB,MAC7BrmB,wBAAqB,IAAIqmB,MACzBrmB,0BAAuB,IAAIqmB,MAGlBrmB,iBAAsB,aACtBA,iBAAsB,aACtBA,2BAAgC,qBAChCA,gCAAqC,EAC9CA,uBAAoB2/C,GACb3/C,iBAAa,EAEXA,4BAAyB,IAK3BA,uBAAmB,EACnBA,eAAY,oBASjB,OAAOA,KAAKk3G,WAAWtoG,QAAQ4xD,SAC3BxgE,KAAKk3G,WAAWtoG,QAAQ4xD,SACxBxgE,KAAKo4G,cAAcvzD,4BAIvB,MAAMhlD,EAAOggD,GAAOoS,SAASjyD,KAAK6kD,MAAMkyD,iBACxC,OAAgB,IAATl3G,EAAaG,KAAKs7G,uBAAyBz7G,iBAGrCA,GACbG,KAAK8lH,YAAcjmH,mBAInB,OAAOG,KAAK8lH,yBAGDjmH,GACXG,KAAK+lH,UAAYlmH,iBAIjB,OAAOG,KAAK+lH,+BAIZ,YAA6C,IAAtC/lH,KAAKo4G,cAAc4N,eACtB,IACAhmH,KAAKo4G,cAAc4N,6BAIvB,OAAOhmH,KAAKk3G,WAAWtoG,QAAQ20C,QAAUvjD,KAAKk3G,WAAWtoG,QAAQ20C,QAAUvjD,KAAKimH,gCAIhF,OAAOjmH,KAAKo4G,cAAc8N,cAAgBlmH,KAAKo4G,cAAc8N,cAAgBlmH,KAAKmmH,sBAKpF3lG,WACMxgB,KAAKo4G,cAActzD,gBACrB9kD,KAAKo4G,cAActzD,cAAc1mB,aAAuD,IAA7Cp+B,KAAKo4G,cAActzD,cAAc1mB,QAC1Ep+B,KAAKo4G,cAActzD,cAAc1mB,QAAUp+B,KAAKomH,2BAEpDpmH,KAAKqmH,WAAarmH,KAAKsmH,YAAYtmH,KAAKumH,aACxCvmH,KAAKwmH,SAAWxmH,KAAKsmH,YAAYtmH,KAAKymH,aAEtCzmH,KAAK0mH,cAAgB1mH,KAAKqmH,WAAWM,iBACrC3mH,KAAK4mH,YAAc5mH,KAAKwmH,SAASG,iBACjC3mH,KAAK6mH,iBAAmB7mH,KAAK8mH,qBAC7B9mH,KAAK+mH,wBACL/mH,KAAKgnH,0BAELhnH,KAAKinH,eAGPX,YAAYzmH,GACV,IAAKA,EACH,OAAO,IAAIwG,KACN,GAAKktG,MAAO,IAAIltG,KAAKxG,GAAQswC,WAAc,CAChD,GAAItwC,EAAO2T,OAAO,QAAU,EAAI,CAC9B,MAAM1T,EAAWD,EAAOwO,MAAM,yCAC9B,GAAIxO,EAAOwO,MAAM,MAAO,CACtB,MAAMjO,EAAcmoB,SAClB1oB,EAAO+H,UAAU/H,EAAO2T,OAAO,KAAO,EAAG1T,EAASwZ,OAClD,IAEF,OAAOumC,KAAS7jB,IAAI57B,EAAaN,EAAS,IAAIu8G,SAEhD,GAAIx8G,EAAOwO,MAAM,MAAO,CACtB,MAAMjO,EAAcmoB,SAClB1oB,EAAO+H,UAAU/H,EAAO2T,OAAO,KAAO,EAAG1T,EAASwZ,OAClD,IAEF,OAAOumC,KAAS08D,SAASn8G,EAAaN,EAAS,IAAIu8G,SAErD,OAAO,IAAIh2G,KAEb,GAAIxG,EAAO2T,OAAO,UAAY,EAAE,CAC9B,MAAM1T,EAAO+/C,KAASqnE,MAAM,OAAO7K,SAC7Bj8G,EAAWP,EAAOwO,MAAM,yCAC9B,GAAKxO,EAAOwO,MAAM,MAAQ,CACxB,MAAMhO,EAAckoB,SAAU1oB,EAAO+H,UAAU/H,EAAO2T,OAAO,KAAO,EAAGpT,EAASkZ,OAAQ,IACxF,OAAOumC,GAAO//C,GAAMk8B,IAAI37B,EAAaD,EAAS,IAAIi8G,SAEpD,GAAKx8G,EAAOwO,MAAM,MAAQ,CACxB,MAAMhO,EAAckoB,SAAS1oB,EAAO+H,UAAU/H,EAAO2T,OAAO,KAAO,EAAGpT,EAASkZ,OAAQ,IACvF,OAAOumC,GAAO//C,GAAMy8G,SAASl8G,EAAaD,EAAS,IAAIi8G,SAEzD,OAAOv8G,EAET,OAAO,IAAIuG,KAEb,OAAIrG,KAAKo4G,cAAc7vD,iBACRvoD,KAAKmnH,6BAA6BtnH,GAGxCA,EAAS,IAAIwG,KAAKxG,GAAU,IAAIwG,KAI3C+gH,uBAAuBvnH,EAAOC,EAAWM,GAAgB,GACvD,IAAIC,EAAWL,KAAKqnH,YAAYxnH,EAAOC,GACvC,GAAIE,KAAK8mH,qBAAsB,CAC7B,IAAIxmH,EAYJ,OAXiB,IAAbR,GACFE,KAAKqmH,WAAaxmH,EAClBG,KAAK0mH,cAAgB1mH,KAAKqmH,WAAW1tB,cACrCr4F,EAA2B,GAAGN,KAAK0mH,wBAEnC1mH,KAAKwmH,SAAW3mH,EAChBG,KAAK4mH,YAAc5mH,KAAKwmH,SAAS7tB,cACjCr4F,EAA2B,GAAGN,KAAK4mH,0BAGrC5mH,KAAKi5G,eAAe9wG,KAAK,CAAErG,MAAOxB,EAA0BgnH,IAAKxnH,EAAUynH,kBAG5D,IAAbznH,GAA0C,SAAxBE,KAAKwnH,iBAA8BxnH,KAAKynH,aAE5DpnH,EAAWw/C,GAAOx/C,GAAU6mH,MAAM,OAAO7K,UAG1B,IAAjBv8G,GACEE,KAAKqmH,WAAahmH,EACdL,KAAK0nH,oBACP1nH,KAAKonH,uBAAuBpnH,KAAK2nH,qBAAqBvL,QAAQ/7G,EAAUL,KAAK4nH,kBAAmB,EAAGxnH,IAGrGJ,KAAKwmH,SAAWnmH,EAElBL,KAAKgnH,0BACLhnH,KAAKi5G,eAAe9wG,KAAK,CAAErG,MAAOzB,EAASwnH,cAAeP,IAAKxnH,EAAUynH,kBAG3EO,WAAWjoH,GACT,GAAKA,GAAmB,KAAVA,EAGd,MAAsB,iBAAXA,GAAuBG,KAAKo4G,cAAc7vD,iBAC5CvoD,KAAKmnH,6BAA6BtnH,GAEpC,IAAIwG,KAAKxG,GAGlB2nH,eACE,OAAIxnH,KAAKo4G,cAAc7vD,iBACd,OAELvoD,KAAK4nH,iBAAmB,MACnB,WAEF,OAGTd,qBACE,MAA4B,SAAxB9mH,KAAKwnH,eAOXO,oBAAoBloH,EAAaC,EAAkBM,GACjD,MACME,EAAON,KAAKmnH,6BADLtnH,EAAYunB,OAAOtlB,OAEhC9B,KAAKgoH,aAAa1nH,EAAMR,EAAYM,GAGtC4nH,aAAanoH,EAAMC,EAAkBM,EAAmBC,GAAgB,GAClEL,KAAK2nH,qBAAqBpM,mBAAmBv7G,KAAK6kD,QAChD/kD,GACFA,EAAW6yB,QAEI,QAAbvyB,EAEFP,EAAOggD,GAAOhgD,GAAMqnH,MAAM,QAAQ7K,SACZ,UAAbj8G,GAAwBJ,KAAK0nH,qBAAuB1nH,KAAK6mH,kBAClE7mH,KAAKgoH,aAAanoH,OAAM,EAAW,OAErCG,KAAKonH,uBAAuBvnH,EAAmB,UAAbO,EAAuB,EAAI,EAAGC,IAIpE4nH,cAAcpoH,EAAOC,EAAkBM,EAAmBC,GAAgB,GACpEL,KAAK2nH,qBAAqB7L,oBAAoB97G,KAAK6kD,QACjD/kD,GACFA,EAAW6yB,QAEI,QAAbvyB,EACFP,EAAQggD,GAAOhgD,GAAOqnH,MAAM,SAAS7K,SACf,UAAbj8G,GAAwBJ,KAAK0nH,oBACtC1nH,KAAKioH,cAAcpoH,OAAO,EAAW,OAEvCG,KAAKonH,uBAAuBvnH,EAAoB,UAAbO,EAAuB,EAAI,EAAGC,IAIrE6nH,eACE,MAAMroH,EAAOG,KAAK4nH,iBACZ9nH,EAAOyH,KAAK6mD,IAChBpuD,KAAKsmH,YAAYtmH,KAAKo4G,cAAc90D,KAAKnT,UACvCnwC,KAAKsmH,YAAYtmH,KAAKo4G,cAAcj1D,OAAOhT,WAE/C,OAAInwC,KAAK2nH,qBAAqBpM,mBAAmBv7G,KAAK6kD,MAC7C,aACE7kD,KAAK2nH,qBAAqB7L,oBAAoB97G,KAAK6kD,MACrD,OACEhlD,EAAO,OAAYC,EAAO,MAC5B,QAEA,QAIXqoH,WAAWtoH,EAAcC,GACvB,MAAMM,EAAY,IAAIiG,KAAKvG,GACrBO,EAAOD,EAAU+vC,UAAY,IAAI9pC,KAAKrG,KAAKumH,aAAap2E,UAE9D,GAAInwC,KAAK2nH,qBAAqBpM,mBAAmBv7G,KAAK6kD,MAAO,CAC3D,MAAMvkD,EAAYu/C,GAAOz/C,GAAW4C,KAAK68C,GAAO7/C,KAAKumH,aAAc,SAAS,GAC5E,GAAc,QAAT1mH,EAAiB,CACpB,MAAMW,EAAiBq/C,GAAOz/C,GAAW47B,IAAI,EAAG,KAEhD,OAAQosF,GADsB5nH,GAAgBwC,KAAK68C,GAAO7/C,KAAKumH,aAAc,SAAS,GAC7D1mE,GAAOoS,SAASjyD,KAAK6kD,MAAMwjE,WAAe,KAChD,UAATxoH,EACV,OAAQS,EAAYu/C,GAAOoS,SAASjyD,KAAK6kD,MAAMwjE,WAAe,UAGzDroH,KAAK2nH,qBAAqB7L,oBAAoB97G,KAAK6kD,MAAO,CACjE,MAAMvkD,EAAYu/C,GAAOz/C,GAAW4C,KAAK68C,GAAO7/C,KAAKumH,aAAc,UAAU,GAC7E,GAAc,QAAT1mH,EAAiB,CACpB,MAAMW,EAAiBq/C,GAAOz/C,GAAW47B,IAAI,EAAG,KAEhD,OAAQosF,GADsB5nH,GAAgBwC,KAAK68C,GAAO7/C,KAAKumH,aAAc,UAAU,GAC9D1mE,GAAOoS,SAASjyD,KAAK6kD,MAAMyjE,YAAgB,KACjD,UAATzoH,EACV,OAAQS,EAAYu/C,GAAOoS,SAASjyD,KAAK6kD,MAAMyjE,YAAgB,UAExDtoH,KAAK2nH,qBAAqB5L,mBAAmB/7G,KAAK6kD,MAAO,CAClE,MAAMvkD,EAAWu/C,GAAOz/C,GAAW4C,KAAK68C,GAAO7/C,KAAKumH,aAAc,SAAS,GAC3E,GAAc,QAAT1mH,EAAiB,CACpB,MAAMW,EAAiBq/C,GAAOz/C,GAAW47B,IAAI,EAAG,KAEhD,OAAQosF,GADqB5nH,GAAgBwC,KAAK68C,GAAO7/C,KAAKumH,aAAc,SAAS,GAC7D1mE,GAAOoS,SAASjyD,KAAK6kD,MAAM0jE,WAAe,KAC/C,UAAT1oH,EACV,OAAQS,EAAWu/C,GAAOoS,SAASjyD,KAAK6kD,MAAM0jE,WAAe,UAEtDvoH,KAAK2nH,qBAAqB3L,kBAAkBh8G,KAAK6kD,MAAO,CACjE,MAAMvkD,EAAUu/C,GAAOz/C,GAAW4C,KAAK68C,GAAO7/C,KAAKumH,aAAc,QAAQ,GACzE,GAAc,QAAT1mH,EAAiB,CACpB,MAAMW,EAAiBq/C,GAAOz/C,GAAW47B,IAAI,EAAG,KAE1Cp4B,EAAQwkH,GADc5nH,GAAgBwC,KAAK68C,GAAO7/C,KAAKumH,aAAc,QAAQ,GACtD1mE,GAAOoS,SAASjyD,KAAK6kD,MAAM2jE,SACxD,OAAQ5kH,EAAO,MAAaA,GAAO,MAAwB,IAATA,EAAS,GACxC,UAAT/D,EAAmB,CAC7B,MAAMW,EAASF,EAAUu/C,GAAOoS,SAASjyD,KAAK6kD,MAAM2jE,SAAY,EAChE,OAAQhoH,EAAO,MAAaA,GAAO,MAAuB,IAATA,GAAwB,IAATA,OAE7D,IAAKR,KAAK2nH,qBAAqB1L,mBAAmBj8G,KAAK6kD,MAE5D,OAAQujE,GADgBhoH,GAAW4C,KAAK68C,GAAO7/C,KAAKumH,aAAc,SAAS,GACxD1mE,GAAOoS,SAASjyD,KAAK6kD,MAAM4jE,WAAe,EAExD,GAAKzoH,KAAK2nH,qBAAqBzL,qBAAqBl8G,KAAK6kD,MAC9D,OAAO,EAGT,OAAOxkD,EAAOL,KAAK4nH,kBAAqB,EAG1CP,YAAYxnH,EAAMC,GAChB,MAAMM,EAAW,IAAIiG,KAAKxG,GAC1B,IAAIQ,EACJ,IAAKL,KAAKynH,WACR,OAAQ3nH,QACD,EACH,GAAIE,KAAKo4G,cAAc7vD,iBAAkB,CACvCloD,EAAYD,EAASo2G,SAAS,EAAG,GACjC,MAEAn2G,EAAYD,EAASo2G,SACrBx2G,KAAK0oH,qBAAqB5mH,MAC1B9B,KAAK2oH,uBAAuB7mH,OAE5B,WAGC,EACH,GAAI9B,KAAKo4G,cAAc7vD,iBAAkB,CACvCloD,EAAYD,EAASo2G,SAAS,EAAG,GACjC,MAEAn2G,EAAYD,EAASo2G,SACnBx2G,KAAK4oH,mBAAmB9mH,MACxB9B,KAAK6oH,qBAAqB/mH,OAOpC,OAAO,IAAIuE,KAAKhG,GAAwBD,GAG1C0oH,wBACE,OAAI9oH,KAAK2nH,qBAAqBzL,qBAAqBl8G,KAAK6kD,MAClD7kD,KAAK4nH,iBAAmB,KACnB5nH,KAAK4nH,iBAAmB,KAAS,GAAK,EAAI5nH,KAAK4nH,iBAAmB,IAEjE5nH,KAAK4nH,iBAAmB,KAAW,GAEpC5nH,KAAK2nH,qBAAqB1L,mBAAmBj8G,KAAK6kD,MACpD,GAEF,EAGTkkE,sBACE,OAAI/oH,KAAK2nH,qBAAqB1L,mBAAmBj8G,KAAK6kD,MAC7C7kD,KAAK4nH,iBAAmB,IAAO,GAAK,GAEtC,EAGToB,oBAAoBnpH,GAEhBG,KAAKipH,WAAa9kH,MAAMgL,KADtBtP,EAEA,CACEU,QACGP,KAAK4oH,mBAAmB9mH,MAAQ,GAAK9B,KAAK+oH,sBAAwB,GAMvE,CAAExoH,OAAS,GAAUP,KAAK+oH,sBAAwB,GAJlD,CAACjpH,EAAGM,IAAM,EAAIA,EAAIJ,KAAK+oH,uBAQ3B/oH,KAAK0oH,qBAAqB/gG,SAAS3nB,KAAKqmH,WAAW1P,YAGrDuS,kBAAkBrpH,GAEdG,KAAKmpH,SADHtpH,EACcsE,MAAMgL,KACpB,CACE5O,QACG,GAAKP,KAAK0oH,qBAAqB5mH,OAC9B9B,KAAK+oH,sBACP,GAEJ,CAACjpH,EAAGM,IACFJ,KAAK0oH,qBAAqB5mH,MAAQ1B,EAAIJ,KAAK+oH,uBAG/B5kH,MAAMgL,KACpB,CAAE5O,OAAS,GAAUP,KAAK+oH,sBAAwB,GAClD,CAACjpH,EAAGM,IAAM,EAAIA,EAAIJ,KAAK+oH,uBAG3B/oH,KAAK4oH,mBAAmBjhG,SAAS3nB,KAAKwmH,SAAS7P,YAGjDyS,sBAAsBvpH,GAElBG,KAAKqpH,aAAellH,MAAMgL,KADxBtP,EAEA,CACEU,QACGP,KAAK6oH,qBAAqB/mH,MAAQ,GACjC9B,KAAK8oH,wBACP,GAMJ,CAAEvoH,OAAS,GAAUP,KAAK8oH,wBAA0B,GAJpD,CAAChpH,EAAGM,IAAM,EAAIA,EAAIJ,KAAK8oH,yBAQ3B9oH,KAAK2oH,uBAAuBhhG,SAAS3nB,KAAKqmH,WAAWzP,cAGvD0S,oBAAoBzpH,GAEhBG,KAAKupH,WADH1pH,EACgBsE,MAAMgL,KACtB,CACE5O,QACG,GAAKP,KAAK2oH,uBAAuB7mH,OAChC9B,KAAK8oH,wBACP,GAEJ,CAAChpH,EAAGM,IACFJ,KAAK2oH,uBAAuB7mH,MAAQ1B,EAAIJ,KAAK8oH,yBAG/B3kH,MAAMgL,KACtB,CAAE5O,OAAS,GAAUP,KAAK8oH,wBAA0B,GACpD,CAAChpH,EAAGM,IAAM,EAAIA,EAAIJ,KAAK8oH,yBAG3B9oH,KAAK6oH,qBAAqBlhG,SAAS3nB,KAAKwmH,SAAS5P,cAGnDoQ,0BACE,MAAMnnH,EAAW,IAAIwG,KAAKrG,KAAKqmH,YACzBvmH,EAAS,IAAIuG,KAAKrG,KAAKwmH,UACzB3mH,EAAS22G,SAAS,EAAG,KAAO12G,EAAO02G,SAAS,EAAG,IACjDx2G,KAAKgpH,qBAAoB,GACzBhpH,KAAKkpH,mBAAkB,GACnBlpH,KAAKqmH,WAAW1P,aAAe32G,KAAKwmH,SAAS7P,aAC/C32G,KAAKopH,uBAAsB,GAC3BppH,KAAKspH,qBAAoB,MAG3BtpH,KAAKgpH,sBACLhpH,KAAKkpH,oBACLlpH,KAAKopH,wBACLppH,KAAKspH,uBAIDrC,eACNjnH,KAAKonH,uBAAuBpnH,KAAKqmH,WAAY,GAAG,GAChDrmH,KAAKonH,uBAAuBpnH,KAAKwmH,SAAU,GAAG,GAGzCkB,mBACL,QAAO1nH,KAAKo4G,cAAcoR,gBACtBxpH,KAAKo4G,cAAcoR,eAGlBjD,YACL,OAAOvmH,KAAKo4G,cAAcj1D,MAAQnjD,KAAKo4G,cAAcj1D,MAC1CnjD,KAAKk3G,WAAWtoG,QAAQw0C,QAAUpjD,KAAKk3G,WAAWtoG,QAAQw0C,QAAUpjD,KAAKypH,YAG/EhD,YACL,OAAOzmH,KAAKo4G,cAAc90D,IAAMtjD,KAAKo4G,cAAc90D,IACxCtjD,KAAKk3G,WAAWtoG,QAAQ20C,QAAUvjD,KAAKk3G,WAAWtoG,QAAQ20C,QAAUvjD,KAAKimH,YAGtFyD,qBAAqB7pH,GACnBG,KAAKi5G,eAAe9wG,KAAKtI,GAG3B8pH,WAAW9pH,GACJA,EAAMynB,SACTtnB,KAAKinH,eAITF,wBAEI/mH,KAAK4pH,qBADH5pH,KAAKo4G,gBACoBp4G,KAAKo4G,cAAc54F,OAIrB,aAAxBxf,KAAKwnH,kBAC0B,IAA5BxnH,KAAK4pH,oBACP5pH,KAAK0oH,qBAAqB1/F,UAC1BhpB,KAAK2oH,uBAAuB3/F,UAC5BhpB,KAAK4oH,mBAAmB5/F,UACxBhpB,KAAK6oH,qBAAqB7/F,YAE1BhpB,KAAK0oH,qBAAqB7mF,SAC1B7hC,KAAK2oH,uBAAuB9mF,SAC5B7hC,KAAK4oH,mBAAmB/mF,SACxB7hC,KAAK6oH,qBAAqBhnF,WAIhCslF,6BAA6BtnH,GAM3B,IAAIC,EACAM,EAAQ,KACRC,EAAM,KACV,GAA0B,KAAtBR,EAAWU,OAAe,CAC3B,MAAMD,EAAYT,EAAW8D,MAAM,KAClC,GAAyB,IAArBrD,EAAUC,OACZ,MAAM,IAAIkM,MAAM,wGAEhB3M,EAAOQ,EAAU,GACjBF,EAAQE,EAAU,GAClBD,EAAMC,EAAU,WAEW,IAAtBT,EAAWU,OAGpB,OAAO,IAAI8F,KAAKxG,GAFhBC,EAAOD,EAIT,OAAO,IAAIwG,KAAK,GAAGvG,KAAQM,KAASC,cAGtCo1G,cACE,IAEI31G,EACAM,EACAC,EACAC,EALAT,EAAqBG,KAAKk3G,WAAWtoG,QAAQ+2C,WAAWzlC,QAOxDlgB,KAAK6mH,kBAGLvmH,EAF6B,UAA3BT,EAAmByjD,IAEC,QADUj9C,MAAOwjH,mBAAmB,SACXjiH,UAAU,EAAE,WAErC,GAAG/H,EAAmByjD,IAAI17C,UAAU,EAAE,WAE9DvH,EAAsB,GAAGR,EAAmBsjD,MAAMv7C,UAAU,EAAE,WAC9D9H,EAAiBE,KAAKmnH,6BAA6B9mH,GACnDD,EAAiBJ,KAAKmnH,6BAA6B7mH,KAEnDR,EAAiBE,KAAKsmH,YAAYzmH,EAAmBsjD,OACrD/iD,EAAiBJ,KAAKsmH,YAAYzmH,EAAmByjD,KACrDjjD,EAAsBP,EAAe+nH,cACrCvnH,EAAsBF,EAAeynH,gBAGlC7nH,KAAKo4G,cAAcj1D,QAAU9iD,GACjCL,KAAKo4G,cAAc90D,MAAQhjD,KAC1BN,KAAKqmH,WAAavmH,EAClBE,KAAKwmH,SAAWpmH,EAChBJ,KAAKinH,gBAIT1R,oBAEIv1G,KAAKo4G,cAAc54F,QADa,IAA9Bxf,KAAKo4G,cAAc54F,OAKvBxf,KAAK+mH,wBACL/mH,KAAKinH,6DArkBIlmH,GAAsBrB,oCAAtBqB,EAAsBugB,m5DD1BnC5hB,iBACEA,qCAOAA,wBAYAA,wBAkMFA,eApNKA,sGAM4BA,oCAYzBA,g7DCMKqB,MCdb,MAAM+oH,GAAS3jG,OAOF4jG,iBAgDXhiH,YAAmBlI,+BA3CTG,oBAIL,IAAIN,MAITM,iBAAsB,EACtBA,oBAAyB,EAChBA,2BAAgC,qBAChCA,4BAAiC,IACnCA,cAAW,cACXA,eAAY,SA+BjBA,KAAKgqH,kBAAoBhqH,KAAKgqH,kBAAkB14D,KAAKtxD,2BA5BrD,YAA6C,IAAtCA,KAAKo4G,cAAc4N,eACtBhmH,KAAKiqH,uBACLjqH,KAAKo4G,cAAc4N,yCAIvB,OAAoC,QAAhCnmH,OAAKu4G,cAActzD,qBAAa,eAAEohE,eAC7BlmH,KAAKo4G,cAActzD,cAAcohE,cAEtClmH,KAAKo4G,cAAc8N,cACdlmH,KAAKo4G,cAAc8N,cAErBlmH,KAAKmmH,6CAIZ,OAAOnmH,KAAK2nH,qBAAqB3S,aAAah1G,KAAKmjD,4BAInD,OAAOnjD,KAAK2nH,qBAAqB3S,aAAah1G,KAAKgjB,2BAInD,OAAOhjB,KAAK2nH,qBAAqBtM,gBAAgBr7G,KAAKk3G,WAAYl3G,KAAKo4G,eAOzE53F,WACExgB,KAAKkqH,gBACLlqH,KAAKmqH,kBAAkB,CAACroH,MAAO,IAGjCkoH,kBAAkBnqH,GAChB,IAAIC,EAAU,IAAIuG,KAAKrG,KAAKoqH,kBAAqBvqH,EAAQ,GAAKG,KAAKq7G,iBAEnE,GAAIr7G,KAAK2nH,qBAAqBpM,mBAAmBv7G,KAAK2nH,qBAAqB9iE,KAAK7kD,KAAKk3G,WAAYl3G,KAAKo4G,gBAAiB,CACrH,MAAMh4G,EAAQ0pH,GAAO73D,SAASjyD,KAAK2nH,qBAAqB9iE,KAAK7kD,KAAKk3G,WAAYl3G,KAAKo4G,gBAAgBoD,QACnG17G,EAAUgqH,GAAO9pH,KAAKoqH,kBAAkBpuF,KAAKn8B,EAAQ,GAAKO,EAAO,QAAQi8G,iBAC/Dr8G,KAAK2nH,qBAAqB7L,oBAAoB97G,KAAK2nH,qBAAqB9iE,KAAK7kD,KAAKk3G,WAAYl3G,KAAKo4G,gBAAiB,CAC9H,MAAMh4G,EAAQ0pH,GAAO73D,SAASjyD,KAAK2nH,qBAAqB9iE,KAAK7kD,KAAKk3G,WAAYl3G,KAAKo4G,gBAAgBqD,SACnG37G,EAAUgqH,GAAO9pH,KAAKoqH,kBAAkBpuF,KAAKn8B,EAAQ,GAAKO,EAAO,SAASi8G,SAG5E,OAAOyN,GAAOhqH,GAASioB,OAAO/nB,KAAKkmH,eAGrCvQ,WAAW91G,GACLG,KAAK41G,SACP51G,KAAKw1G,cAELx1G,KAAK61G,SAAW,eAChB71G,KAAK41G,SAAWr6E,YACdz7B,IAEE,GAAIE,KAAKqqH,OAAOvoH,MAAQ9B,KAAKsqH,eAAgB,CAC3C,MACMjqH,EAAkB,kBACxBL,KAAKqqH,OAAOE,WAAY,GACxBvqH,KAAKqqH,OAAOhqH,UAEZL,KAAKw1G,cAGTx1G,KAAKgmH,eACLhmH,OAKNw1G,aACMx1G,KAAK41G,UACPh6E,cAAc57B,KAAK41G,UAErB51G,KAAK41G,cAAW,EAChB51G,KAAK61G,SAAW,cAGlBJ,YAAY51G,GACNG,KAAK41G,UACPh6E,cAAc57B,KAAK41G,UAErB51G,KAAK41G,cAAW,EAChB51G,KAAK61G,SAAW,cAChB71G,KAAKqqH,OAAOvoH,MAAQ,EAGpB9B,KAAKqqH,OAAOG,kBAGdL,kBAAkBtqH,GAChB,GAAIA,EAEF,GAAKG,KAAK2nH,qBAAqBpM,mBAAmBv7G,KAAK2nH,qBAAqB9iE,KAAK7kD,KAAKk3G,WAAYl3G,KAAKo4G,gBAAkB,CACvH,MAAMt4G,EAAQgqH,GAAO73D,SAASjyD,KAAK2nH,qBAAqB9iE,KAAK7kD,KAAKk3G,WAAYl3G,KAAKo4G,gBAAgBoD,QAC7Fp7G,EAAe0pH,GAAO9pH,KAAKoqH,kBAAkBpuF,KAAKn8B,EAAgBiC,MAAQ,GAAKhC,EAAO,QAAQu8G,SAC9Fh8G,EAAaypH,GAAO1pH,GAAc47B,IAAIl8B,EAAO,QAAQu8G,SAC3Dr8G,KAAKi5G,eAAe9wG,KAAK,CAACrG,MAAOgoH,GAAO1pH,GAAci8G,SAASwL,cACnCP,IAAK,EAAGC,eAAe,IACnDvnH,KAAKi5G,eAAe9wG,KAAK,CAACrG,MAAOgoH,GAAOzpH,GAAYg8G,SAASwL,cACjCP,IAAK,EAAGC,eAAe,YAEzCvnH,KAAK2nH,qBAAqB7L,oBAAoB97G,KAAK2nH,qBAAqB9iE,KAAK7kD,KAAKk3G,WAAYl3G,KAAKo4G,gBAAkB,CAC/H,MAAMt4G,EAAQgqH,GAAO73D,SAASjyD,KAAK2nH,qBAAqB9iE,KAAK7kD,KAAKk3G,WAAYl3G,KAAKo4G,gBAAgBqD,SAC7Fr7G,EAAe0pH,GAAO9pH,KAAKoqH,kBAAkBpuF,KAAKn8B,EAAgBiC,MAAQ,GAAKhC,EAAO,SAASu8G,SAC/Fh8G,EAAaypH,GAAO1pH,GAAc47B,IAAIl8B,EAAO,SAASu8G,SAC5Dr8G,KAAKi5G,eAAe9wG,KAAK,CAACrG,MAAOgoH,GAAO1pH,GAAcqqH,QAAQ,SAASpO,SAASwL,cACpDP,IAAK,EAAGC,eAAe,IACnDvnH,KAAKi5G,eAAe9wG,KAAK,CAACrG,MAAOgoH,GAAOzpH,GAAYg8G,SAASwL,cACjCP,IAAK,EAAGC,eAAe,YAEzCvnH,KAAK2nH,qBAAqB3L,kBAAkBh8G,KAAK2nH,qBAAqB9iE,KAAK7kD,KAAKk3G,WAAYl3G,KAAKo4G,iBACzGp4G,KAAK2nH,qBAAqB1L,mBAAmBj8G,KAAK2nH,qBAAqB9iE,KAAK7kD,KAAKk3G,WAAYl3G,KAAKo4G,iBAClGp4G,KAAK2nH,qBAAqBzL,qBAAqBl8G,KAAK2nH,qBAAqB9iE,KAAK7kD,KAAKk3G,WAAYl3G,KAAKo4G,gBAAkB,CACpH,MAAMt4G,EAAU,IAAIuG,KAAKrG,KAAKoqH,iBAAoBpqH,KAAKq7G,iBAAmBx7G,EAAgBiC,MAAQ,IAClG9B,KAAKi5G,eAAe9wG,KAAK,CAACrG,MAAOhC,EAAQ+nH,cAAeP,IAAK,EAAGC,eAAe,IAC/EvnH,KAAKi5G,eAAe9wG,KAAK,CAACrG,MAAO,IAAIuE,KAAKrG,KAAK2nH,qBAAqBvL,QAAQt8G,EAAQ+nH,cACxD7nH,KAAKq7G,kBAAkBwM,cACvBP,IAAK,EAAGC,eAAe,KAK7D2C,gBACE,QAASrqH,EAAI,EAAIG,KAAK0qH,gBAAkB1qH,KAAKoqH,iBAAoBvqH,EAAIG,KAAKq7G,mBAAsB,EAAIx7G,IAClGG,KAAKsqH,eAAiBzqH,gDArJfkB,GAA4BrB,oCAA5BqB,EAA4BugB,gFAU5B60E,MAAS,6aC7BtBz2F,iBACEA,wBAKEA,2DAAyB,2BAEhBI,yBAGXJ,QACAA,oBAAwCA,iCAASI,kBAC/CJ,sBACFA,QACAA,oBAAwCA,iCAASI,mBAC/CJ,sBACFA,QAEFA,eAhBIA,yBAAU,QAAVA,CAAU,uBAAVA,CAAU,wBAAVA,CAAU,mCAUAA,qCAGAA,8hCDGDqB,ME6HA4pH,iBAAe5gH,iBAExB,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,CACT,CACEC,QAAS0gH,MACTp/G,SAAU,yDAPPzK,6DAFA,CAACw3F,GAAmBS,GAAkBoiB,GAAsB1hB,IAAqBnqE,SA5EnF,CACPviB,KACAqZ,MACAA,MACA4T,MACAx6B,KACAuvB,KACA67F,MACAC,MACA57F,KACA5I,MACA+7F,MACA/a,MACAj4E,KACA8mE,MACAD,MACArqE,MACA0I,KACAq2F,MACAxxF,MACAjK,KACAF,KACAkL,MACAywF,MACAG,MACAA,MACAp+G,GACAqpF,GACAlkE,GACAmS,GACA7J,GACAzF,GACAiM,GACAuyE,GACApiF,SA4CShwB,YApBTqyG,GAAyB,0BAEzB4D,GAAuBn2E,kBAAvBm2E,GAAuB,qDADvB3D,IAAuB,mBAEvBgE,GAAuB,SADvBL,GAAuBn2E,KAHvBu3D,WAMA2f,GAAsB,8EAUtB8N,IAAsB,sBATtB1K,GAAwB,0BAGxBb,GAA0Bz5E,kBAF1B27E,GAA2B,yIAQ3BqJ,IAAsB,mBAPtBxL,GAA0B,MAD1BmC,GAA2B37E,QAF3Bk3E,IAAsB,UAItBuC,GAA0B,qDAD1BD,GAA0BpkB,0CAE1BilB,GAA0B,SAD1BZ,GAA0Bz5E,KAV1Bu3D,WAaAkoB,GAA0B,0CAC1BW,GAA0B3Z,qCAC1B4a,GAA0B,sOAC1B2D,GAAsB,wBACtBkE,GAA4Bl+F,0GC5ICpf,wBAEWu+G,GAC1CjjH,cACE8X,MAAM,gBACNja,OAAOqlH,eAAejrH,KAAMkrH,GAAuBC,6BAIPH,GAC9CjjH,cACE8X,MAAM,qBACNja,OAAOqlH,eAAejrH,KAAMgkD,GAA2BmnE,kBCV9CC,GAAeC,EAAQ,CAAC,MAAO,UAAW,MAAO,MAAO,MAAO,YAAa,WAAY,iBAGxFC,GAAiBD,EAAQ,CAAC,OAAQ,eCiBlCE,iBAeXxjH,YAAoBlI,iBAFZG,yBAA8B,EAGpCA,KAAKwrH,QAAUxrH,KAAK2K,OAAOD,UAAU,oBACrC,MAAM5K,EAAwBE,KAAK2K,OAAOD,UACxC,2CAE4B,IAA1B5K,IACFE,KAAKyrH,mBAAqB3rH,GAI9B4rH,OACE7rH,EACAC,EACAM,EACAC,EACAC,EAAe,YACfE,EAAgB,aAEhB,MAAMkD,EAAmB1D,KAAK2rH,gBAAgB9rH,EAAYC,GAE1D,OAAOE,KAAK4rH,YAAYloH,EAAkB5D,EAAQM,EAAOC,EAAUC,EAAcE,GAG3EmrH,gBACN9rH,EACAC,GAEA,OAAIA,IAAWsrH,GAAaS,KAAO7rH,KAAKyrH,mBAC/BzrH,KAAK8rH,0BAA0BjsH,GAGjCA,EAAW6F,IAAKtF,IAIrB,MAAME,EAAaF,EAFhBq1D,UACAhvD,OAAQjG,IAAiBA,EAAI6jE,WAAW,MACnBr9D,OACtB,CAACxG,EAAakD,KACZlD,EAAIkD,GAAOtD,EAAUqJ,IAAI/F,GAClBlD,GAET,CAAEykD,SAAU7kD,EAAU2xD,gBAExB,OAAO,IAAIiZ,KAAU1qE,KAIjBwrH,0BAA0BjsH,GAChC,OAAOA,EAAW6F,IAAK5F,IACrB,MAAMM,EAAON,EAAU21D,UAAUhvD,OAAQ/C,IAAiBA,EAAI2gE,WAAW,MACzE,IAAIhkE,EAAkB,GACtB,MAAMC,EAAaF,EAAK4G,OAAO,CAACtD,EAAaE,KACvCA,GAAe,aAARA,IACD,OAARA,GAAgB9D,EAAU2J,IAAI,QAAUpJ,GAAWuD,EAAM,IAAM9D,EAAU2J,IAAI,QAAU,UACrFpJ,GAAWuD,EAAM,IAAM9D,EAAU2J,IAAI7F,GAAO,WAEhDF,EAAIE,GAAO9D,EAAU2J,IAAI7F,GAClBF,GAET,CACEuhD,SAAUnlD,EAAUiyD,gBAEhBvxD,EAAa,IAAIwqE,KAAU1qE,GACjC,SAAWmV,IAAI,OAAQ3V,EAAU2zD,SACjCjzD,EAAWiV,IAAI,MAAOpV,GAEfG,IAIHorH,YACN/rH,EACAC,EACAM,EACAC,EACAC,EACAE,GAyBA,OAAO,IAAIkW,IAvBO9S,IAEhB,GADwB5D,KAAK+rH,gBAAgBlsH,EAAYC,GAEvD8D,EAASyH,MAAM,IAAI24C,SAKrB,GAAIp+C,OADuBC,KAAK9E,EAAcirH,aAC9B9rH,QAAQJ,IAAW,EAAG,CACpC,IAAKE,KAAKwrH,QAMR,YALIzqH,EAAckrH,gBAAgB/rH,QAAQJ,IAAW,EACnDE,KAAKksH,aAAarsH,EAAY+D,EAAU9D,EAAQM,EAAOE,EAAcE,GAErEoD,EAASyH,MAAM,IAAI6/G,KAIvBlrH,KAAKmsH,eAAetsH,EAAY+D,EAAU9D,EAAQM,EAAOC,EAAUC,EAAcE,QAEjFR,KAAKksH,aAAarsH,EAAY+D,EAAU9D,EAAQM,EAAOE,EAAcE,KAOjE0rH,aACRrsH,EACAC,EACAM,EACAC,EACAC,EACAE,aC3I4BO,EAAiBO,EAAkBzB,aAYnCkB,EAAaO,GAC3C,MAAMzB,EAAU+B,SAASC,cAAc,KACvChC,EAAQusH,aAAa,OAAQrrH,GAC7BlB,EAAQusH,aAAa,WAAY9qH,GACjCzB,EAAQwwB,MAAMhD,QAAU,OACxBzrB,SAASG,KAAKC,YAAYnC,GAE1BA,EAAQ8xB,QAER/vB,SAASG,KAAKE,YAAYpC,GArBuCA,CACrD,QAAQyB,KAAYw1D,mBAAmB/1D,KAC9BlB,IDyInBW,EAYA6rH,IAVqBvgE,GAAS1rD,IACAksH,cAAczsH,EAAY,CACtDgkD,eAAgBrjD,EAChBsjD,kBAAmBxjD,EACnBisH,YAAa,UACb5qE,UAAW,+BAKiB,2BAFb,GAAGthD,KAASD,EAAO2G,iBAGpCjH,EAASwlB,WAGH6mG,eACNtsH,EACAC,EACAM,EACAC,EACAC,EACAE,EACAkD,GAEA,IAAIE,OAA2BmoD,MAAmBugE,cAChDzsH,EACA,CACEgkD,eAAgBngD,EAChBogD,kBAAmBtjD,IAIvB,MAAMqD,EAAM,GAAG7D,KAAKwrH,sBACdznH,EAAOnC,SAASC,cAAc,QAOpC,GANAkC,EAAKssB,MAAMhD,QAAU,OACrBzrB,SAASG,KAAKC,YAAY+B,GAC1BA,EAAKqoH,aAAa,SAAU,QAC5BroH,EAAKqoH,aAAa,SAAU,UAC5BroH,EAAKqoH,aAAa,SAAUvoH,GAExBvD,IAAiBgrH,GAAekB,KAClCzoH,EAAK0oH,cAAgB,QACrB1oH,EAAK2oH,QAAU,4DACNpsH,IAAiBgrH,GAAeqB,OAAQ,CACjD,MAAM1pE,EAAU,aACVI,EAAep+C,KAAKC,MAAMtB,GAChCy/C,EAAashC,SAASj/E,IAAIg+C,IACxB,MAAMuD,EAAoBxmD,OAAOI,aAC9B2nF,MAAM,MAAM,SAAOvjF,KAAKE,UAAUu+C,EAAEv8B,YAAa,CAAEylG,KAAM,iBAC5DlpE,EAAEv8B,WAAaliB,KAAKC,MAAM+hD,KAE5BrjD,EAAeqB,KAAKE,UAAUk+C,GAC9B,MAAMG,EAAW5hD,SAASC,cAAc,SACxC2hD,EAAS4oE,aAAa,OAAQ,UAC9B5oE,EAAS4oE,aAAa,OAAQ,YAC9B5oE,EAAS4oE,aAAa,QAASnpE,GAC/Bl/C,EAAK/B,YAAYwhD,GAGnB,GAAe,iBAAXpjD,EAA2B,CAC7B,MAAM6iD,EAAUrhD,SAASC,cAAc,SACvCohD,EAAQmpE,aAAa,OAAQ,UAC7BnpE,EAAQmpE,aAAa,OAAQ,OAC7BnpE,EAAQmpE,aAAa,QAAS,uBAC9BroH,EAAK/B,YAAYihD,GAGnB,MAAMj/C,EAAepC,SAASC,cAAc,SAC5CmC,EAAaooH,aAAa,OAAQ,UAClCpoH,EAAaooH,aAAa,OAAQ,QAClCpoH,EAAaooH,aAAa,QAASxoH,GACnCG,EAAK/B,YAAYgC,GAEjB,MAAMW,EAAkB/C,SAASC,cAAc,SAC/C,IAAIihD,EAAwB,cAAX1iD,EAAyB,GAAGC,QAAc,GAAGA,KAASD,EAAO2G,iBAC/D,aAAX3G,GAAoC,iBAAXA,KAC3B0iD,EAAa,GAAGziD,SAElByiD,EAAaA,EAAW38C,QAAQ,IAAK,KACrC28C,EAAaA,EAAWn6B,UAAU,OAAOxiB,QAAQ,mBAAoB,IACrExB,EAAgBynH,aAAa,OAAQ,UACrCznH,EAAgBynH,aAAa,OAAQ,cACrCznH,EAAgBynH,aAAa,QAAStpE,GACtC/+C,EAAK/B,YAAY2C,GAEjB,IAAIsC,EAAalG,EAAcirH,YAAY5rH,IAC5B,aAAXA,GAAoC,iBAAXA,KAC3B6G,EAAa,OAEf,MAAM+7C,EAAoBphD,SAASC,cAAc,SACjDmhD,EAAkBopE,aAAa,OAAQ,UACvCppE,EAAkBopE,aAAa,OAAQ,UACvCppE,EAAkBopE,aAAa,QAASnlH,GACxClD,EAAK/B,YAAYghD,GAEjBj/C,EAAK8oH,SACLjrH,SAASG,KAAKE,YAAY8B,GAE1BjE,EAASwlB,WAGHymG,gBAAgBlsH,EAAqCC,GAC3D,OAA0B,IAAtBD,EAAWU,QAGA,QAAXT,QAMqB,IAAhBD,EALwBgb,KAAKxa,GAEhC,CAAC,QAAS,aAAc,mBAAmBH,QAAQG,EAAU0xD,cAAcM,YAAc,IAxO1F,qBAAc,CACnBy6D,IAAK,MACLjB,IAAK,MACLkB,IAAK,MACLC,UAAW,iBACXC,SAAU,WACVC,aAAc,gBAGTnsH,kBAAkB,CAAC,MAAO,MAAO,6CAV7BA,GAAarB,qCAAbqB,EAAasI,QAAbtI,EAAa,qBAFZ,SAEDA,kBEwJXA,EACAO,EACAzB,EACAC,EACAM,EACAC,EACAC,GAEA,GAAwB,IAApBgB,EAASf,OAEX,qBA+FFQ,EACAO,EACAzB,GAEA,MAAMC,EAAYD,EAAgBmO,UAC5B5N,EAAQN,EAAUkQ,QAAQ,mCAC1B3P,EAAUP,EAAUkQ,QAAQ,iCAAkC,CAClElO,MAAOf,EAAKmQ,KACZi8G,SAAUpsH,EAAK+D,OAEjBxD,EAAe+J,MAAMhL,EAASD,GAzG5B,CAD2BW,EAAMjB,EAAgBM,GAInD,MAAMI,EAAa4sH,GAA0BrsH,GAExCV,WAzILU,EACAO,EACAzB,EACAC,EACAM,EACAC,EACAC,EACAE,EACAkD,GAAkB,GAGlB,MAAME,EAAa7C,EAAS2E,IAAKo9C,GAC/B0iB,GAAY1iB,EAASxhD,EAAImoD,aAE3B,IAAI5lD,EACAE,EAqDAC,EAnDJ,GACElE,EAAiButH,aAAaxtH,EAAWoD,WAAa,qBACtD,CACA,MAAM6/C,EAAqChjD,EAAiButH,aAC1DxtH,EAAWoD,WAAa,qBAG1BY,EAAQ,CAACoD,EAAS+7C,IACT5iD,EAAawqE,uBAAuB3jE,EAAS67C,EAAkBE,WAGxEljD,EAAiButH,aAAaxtH,EAAWoD,WAAa,iBACtD,CACA,MAAM6/C,EAA6BhjD,EAAiButH,aAClDxtH,EAAWoD,WAAa,iBAE1Bc,EAAWjE,EAAiButH,aAC1BxtH,EAAWoD,WAAa,aAG1BY,EAAQ,CAACoD,EAAS+7C,KAChB,MAAMC,EAAY7iD,EAAagqE,YAC7BtqE,EAAiButH,aAAaxtH,EAAWoD,WAAa,iBAAkBgE,EAAS+7C,GAEnF,OAAO5iD,EAAa6qE,mBAAmBhkE,EAAS+7C,EAAYF,EAAcG,YAEnEnjD,EAAiButH,aAAaxtH,EAAWoD,WAAa,UAC/DY,EAAQ,CAACi/C,EAAS77C,IAAe7G,EAAagqE,YAC5CtqE,EAAiButH,aAAaxtH,EAAWoD,WAAa,UAAW6/C,EAAS77C,WAG5EnH,EAAiButH,aAAa,yBACA,UAA9BtsH,EAAS,GAAGkkD,SAASngD,KACrB,CACA,MAAMg+C,EAA6BhjD,EAAiButH,aAClD,wBAEFtpH,EAAWjE,EAAiButH,aAAa,oBAEzCxpH,EAAQ,CAACoD,EAAS+7C,KAChB,MAAMC,EAAY7iD,EAAagqE,YAC7BtqE,EAAiButH,aAAa,wBAAyBpmH,EAAS+7C,GAElE,OAAO5iD,EAAa6qE,mBAAmBhkE,EAAS+7C,EAAYF,EAAcG,SAG5Ep/C,EAAQ,CAACi/C,EAAS77C,IAAe7G,EAAagqE,YAC5CtqE,EAAiButH,aAAa,iBAAkBvqE,EAAS77C,GAKzDnH,EAAiButH,aAAaxtH,EAAWoD,WAAa,kBAOxDe,EAAS,IAAIkoD,GAAkBtmD,OAAOU,OALP,CAC7BgnH,WACAxoH,KAAM,UACNs6D,WAAW,GAE+C9+D,IAC5D0D,EAAO+4C,GAAGzgC,OAAO+3C,YAAYzwD,IACpB9D,EAAiButH,aAAaxtH,EAAWoD,aAKlDe,EAAS,IAAIgoD,GAAkBpmD,OAAOU,OAJuC,CAC3ExB,KAAM,SACNs6D,WAAW,GAE+C9+D,IAC5D0D,EAAO+4C,GAAGsX,YAAYzwD,IAEtB9D,EAAiButH,aAAa,yBACA,UAA9BtsH,EAAS,GAAGkkD,SAASngD,MAQrBd,EAAS,IAAIkoD,GAAkBtmD,OAAOU,OALP,CAC7BgnH,WACAxoH,KAAM,UACNs6D,WAAW,GAE+C9+D,IAC5D0D,EAAO+4C,GAAGzgC,OAAO+3C,YAAYzwD,KAM7BI,EAAS,IAAIgoD,GAAkBpmD,OAAOU,OAJuC,CAC3ExB,KAAM,SACNs6D,WAAW,GAE+C9+D,IAC5D0D,EAAO+4C,GAAGsX,YAAYzwD,IAGxB,MAAMe,EAAQ,IAAIwgE,GAChBv/D,OAAOU,OAAO,CACZ2I,MAAOpP,EACP+E,GAAIvE,GAAW4I,IACfsmD,oBAAoB,EACpBjzC,SACA+T,SACC7vB,IACLc,EAAI+jE,SAAS1gE,GACTjB,GACFqiE,GAAiBzkE,EAAKsC,GAqBnBvD,CAIDiB,EACAzB,EACAW,EACAH,EACAC,YA5KJS,EACAO,EACAzB,GAEA,MAAMC,EAAaiB,EAAS2E,IAAKlF,GAC/BglE,GAAYhlE,EAASc,EAAImoD,aAOrBppD,EAAS,IAAI2rD,GAJ0D,CAC3ElnD,KAAM,SACNs6D,WAAW,IAGb/+D,EAAO08C,GAAGsX,YAAYv0D,GACtB,MAAMQ,EAAQ,IAAI6kE,GAAY,CAC5Bl2D,MAAOpP,EACP0vD,oBAAoB,EACpBjzC,SACA+T,MAAOk9F,OAETjsH,EAAI+jE,SAAS/kE,GACbylE,GAAiBzkE,EAAKxB,GAuJlBQ,CAPuBgB,EAAUzB,EAAKW,GAW1C,MAAMkD,EAAYtD,EAAgB4N,UAC5BpK,EAAeF,EAAUsM,QAAQ,qCACjCnM,EAAUH,EAAUsM,QAAQ,mCAAoC,CACpElO,MAAOtB,IAETV,EAAe0P,QAAQ3L,EAASD,eA4BhC7C,EACAO,EACAzB,EACAC,GAEA,MAAMM,EAAYN,EAAgBkO,UAC5B3N,EAAQD,EAAU4P,QAAQ,qCAC1B1P,EAAUF,EAAU4P,QAAQ,mCAAoC,CACpElO,MAAOf,EAAKmQ,KACZi8G,SAAUpsH,EAAK+D,OAEjBjF,EAAewL,MAAM/K,EAASD,eAI9BU,EACAO,EACAzB,EACAC,GAEA,MAAMM,EAAYN,EAAgBkO,UAC5B3N,EAAQD,EAAU4P,QAAQ,wCAC1B1P,EAAUF,EAAU4P,QAAQ,sCAAuC,CACvElO,MAAOf,EAAKmQ,OAEdrR,EAAewL,MAAM/K,EAASD,eAI9BU,EACAO,EACAzB,EACAC,EACAM,GAEA,MAAMC,EAAYP,EAAgBkO,UAC5B1N,EAAQD,EAAU2P,QAAQ,sCAC1BxP,EAAUH,EAAU2P,QAAQ,oCAAqC,CACrElO,MAAOf,EAAKmQ,KACZqI,KAAMnZ,IAERP,EAAewL,MAAM7K,EAASF,eAkB9BS,EACAO,EACAzB,GAEA,MAAMC,EAAYD,EAAgBmO,UAC5B5N,EAAQN,EAAUkQ,QAAQ,wCAC1B3P,EAAUP,EAAUkQ,QAAQ,sCAAuC,CACvElO,MAAOf,EAAKmQ,KACZi8G,SAAUpsH,EAAK+D,OAEjBxD,EAAe+J,MAAMhL,EAASD,eAI9BW,EACAO,EACAzB,EACAC,GAEA,MAAMM,EAAQN,EAAgBkO,UAAUgC,QAAQ,wCAC1C3P,EAAUP,EAAgBkO,UAAUgC,QAAQ,uCAClDnQ,EAAewL,MAAMhL,EAASD,eAGCW,GAC/B,OAAOA,EAAKmQ,KACTvN,MAAM,KACNonB,MACAhkB,0BAGqChG,GACxC,OAAOA,EAAKmQ,KAAKxE,OAAO,EAAG3L,EAAKmQ,KAAK4zE,YAAY,MAEnD,cACE,MAAM/jF,EAAIwG,KAAK4hB,MAAsB,IAAhB5hB,KAAKI,UACpBrG,EAAIiG,KAAK4hB,MAAsB,IAAhB5hB,KAAKI,UACpB9H,EAAI0H,KAAK4hB,MAAsB,IAAhB5hB,KAAKI,UACpB7H,EAAS,IAAI6iH,KAAe,CAChClyF,MAAO,CAAC1vB,EAAGO,EAAGzB,EAAG,GACjB43D,MAAO,IAEHr3D,EAAO,IAAIuiH,KAAa,CAC5BlyF,MAAO,CAAC1vB,EAAGO,EAAGzB,EAAG,MAGnB,OAAQQ,IACJ,MAAMC,EAAcD,EAAUoJ,IAAI,UAClC,OAAInJ,OACuB6pE,IACLC,YAAY9pE,GAGpB,IAAIqiH,MAAc,CAC9BnnD,SACAlB,OACAxsB,MAAO,IAAI60E,KAAe,CACxB50D,OAAQ,EACRyN,SACAlB,SAEFhrD,KAAMjP,EAAUoJ,IAAI,aAAe,IAAIk5G,KAAa,CAClDrzG,KAAMjP,EAAUoJ,IAAI,aAAaxG,WACjC+3D,QAAS,EACTG,SAAS,EACTV,KAAM,0BACNH,KAAM,IAAIqoD,KAAa,CAAElyF,MAAO,SAChC+qC,OAAQ,IAAImnD,KAAe,CAAElyF,MAAO,OAAQgnC,MAAO,IACnDyS,UAAU,SACR,sBC1WqBz9D,wBAEW+gH,GAC1CzlH,cACE8X,MAAM,gBACNja,OAAOqlH,eAAejrH,KAAMytH,GAAuBtC,6BAIRqC,GAC7CzlH,cACI8X,MAAM,uBACNja,OAAOqlH,eAAejrH,KAAM0tH,GAA0BvC,6BAIZqC,GAC9CzlH,cACI8X,MAAM,qBACNja,OAAOqlH,eAAejrH,KAAM2tH,GAA2BxC,6BAIxBqC,GACnCzlH,cACI8X,MAAM,qBACNja,OAAOqlH,eAAejrH,KAAM2tH,GAA2BxC,6BAIzBqC,GAClCzlH,cACI8X,MAAM,0BACNja,OAAOqlH,eAAejrH,KAAM2tH,GAA2BxC,6BAIlBqC,GACzCzlH,cACI8X,MAAM,uBACNja,OAAOqlH,eAAejrH,KAAM4tH,GAAsBzC,gBCf3C0C,iBAmBX9lH,YAAoBlI,EAA0BC,GAA1BE,YAA0BA,cAC5CA,KAAKwrH,QAAUxrH,KAAK2K,OAAOD,UAAU,oBACrC,MAAMtK,EAAmBJ,KAAK2K,OAAOD,UAAU,wCAC/C1K,KAAK8tH,uBAAyB1tH,GAAsC,IAAMmH,KAAKC,IAAI,KAAM,GAG3FumH,OACEluH,EACAC,EAAe,YACfM,EAAgB,aAEhB,OAAOJ,KAAKguH,YAAYnuH,EAAMC,EAAcM,GAGtC6tH,gBACNpuH,GAOA,MAAMC,EAAYouH,GAAiBruH,GAC7BO,EAAWP,EAAKiF,KAChBzE,EAAmB,IACpBU,EAAcotH,oBACdptH,EAAcqtH,qBAEb9tH,EAAoBS,EAAcstH,kBAExC,KACEhuH,EAAiBH,QAAQE,GAAY,GACrCE,EAAkBJ,QAAQJ,GAAa,GAGlC,IACQ,qBAAbM,GACA,CAAC,OAAQ,UAAW,MAAO,OAAOF,QAAQJ,IAAc,EAExD,OAAOE,KAAKsuH,WACP,QAAqB,IAAjBtuH,KAAKwrH,QACd,OAAOxrH,KAAKuuH,oBAMRP,YACNnuH,EACAC,EACAM,GAgBA,OAAO,IAAIsW,IAdOpW,IAChB,GAAIT,EAAK0Z,MAAQvZ,KAAK8tH,sBAEpB,YADAxtH,EAAS+K,MAAM,IAAImjH,IAGrB,MAAMhuH,EAAWR,KAAKiuH,gBAAgBpuH,QACrB,IAAbW,EAKJA,EAASiI,KAAKzI,KAAMH,EAAMS,EAAUR,EAAcM,GAJhDE,EAAS+K,MAAM,IAAIoiH,MAUjBa,WACNzuH,EACAC,EACAM,EACAC,GAEA,MAAMC,EAAS,IAAIqW,WAEnBrW,EAAOuW,OAAUrW,IACf,IACE,MAAMkD,EAAW1D,KAAKyuH,sBACpB5uH,EACAW,EAAM4mB,OAAOtQ,OACb1W,EACAC,GAEFP,EAASqI,KAAKzE,SACPA,GACP5D,EAASuL,MAAM,IAAIqiH,IAGrB5tH,EAASwlB,YAGXhlB,EAAO2zD,QAAUzzD,IACfV,EAASuL,MAAM,IAAIqiH,KAGrBptH,EAAOouH,WAAW7uH,EAAM,SAGlB0uH,mBACN1uH,EACAC,EACAM,EACAC,GAEA,MAAMC,EAAM,GAAGN,KAAKwrH,kBACdhrH,EAAW,IAAImuH,SACrBnuH,EAASouH,OAAO,SAAU/uH,GAC1BW,EAASouH,OAAO,YAAaxuH,GAC7BI,EAASouH,OAAO,YAAavuH,GAC7BG,EAASouH,OAAO,eAAgB,WAChCpuH,EAASouH,OAAO,eAAgB,IAEhC5uH,KAAKkM,KAAKklC,KAAK9wC,EAAKE,EAAU,CAAEgJ,QAAS,IAAIW,OAC5C/B,UACE1E,IACC,GAAiB,OAAbA,EAMJ,IADgBA,EAAiBk1B,QAAU,IAChCr4B,OAAS,EAClBT,EAASuL,MAAM,IAAIqiH,QACd,CACL,MAAM7pH,EAAW7D,KAAK6uH,yBACpBhvH,EACA6D,EACArD,GAEFP,EAASqI,KAAKtE,GACd/D,EAASwlB,gBAdTxlB,EAASuL,MAAM,IAAIqiH,KAiBtBhqH,IACCA,EAAM2H,MAAM0D,QAAS,EACrB,MAAMnL,EAASF,EAAM2H,MAAMyjH,KAAO,GACnB,yBAAXlrH,EACF9D,EAASuL,MAAM,IAAIoiH,IACd7pH,GAAcA,EAAOmrH,UAAU,6CAEpCjvH,EAASuL,MAAM,IAAI2jH,IAEnBlvH,EAASuL,MADiB,MAAjB3H,EAAMkF,OACA,IAAIglH,GAEJ,IAAIF,MAMnBe,sBACN5uH,EACAC,EACAM,EACAC,GAEA,MAAMC,EAAY4tH,GAAiBruH,GAC7BW,EAAWX,EAAKiF,KAEhBpB,EAAU,IAAIqoD,KAEpB,IAAInoD,EACJ,GAAiB,yCAAbpD,EACFoD,EAAS,IAAIqrH,cACS,wBAAbzuH,EACToD,EAAS,IAAIsrH,aACS,wBAAb1uH,EACToD,EAAS,IAAIurH,UAEb,OAAQ7uH,OACD,MACHsD,EAAS,IAAIqrH,MACb,UACG,MACHrrH,EAAS,IAAIurH,KACb,UACG,MACHvrH,EAAS,IAAIsrH,KACb,cAEAtrH,EAASF,EAmBf,OAdmBE,EAAOwwD,aAAat0D,EAAM,CAC3C+jD,eAAgBzjD,EAChB0jD,kBAAmBzjD,IAEOqF,IAAK1B,GACxB4B,OAAOU,OAAO5C,EAAQ0rH,mBAAmBprH,GAAY,CAC1DylD,WAAYppD,EACZwY,KAAM,CACJjU,GAAIqE,IACJgG,MAAOm+G,GAA0BvtH,OAQjCgvH,yBACNhvH,EACAC,EACAM,GAEA,MAAMC,EAAW,IAAI0rD,KAYrB,OAXmB1rD,EAAS+zD,aAAat0D,GACb4F,IAAKhC,GACxBkC,OAAOU,OAAOjG,EAAS+uH,mBAAmB1rH,GAAY,CAC3D+lD,WAAYrpD,EACZyY,KAAM,CACJjU,GAAIqE,IACJgG,MAAOm+G,GAA0BvtH,QA1OlC,0BAAmB,CACxB,sBACA,uCACA,sBACA,oBAGKkB,sBAAsB,CAC3B,kBACA,+BACA,qBAGKA,oBAAoB,CAAC,UAAW,MAAO,MAAO,OAAQ,6CAdlDA,GAAarB,iDAAbqB,EAAasI,QAAbtI,EAAa,qBAFZ,SAEDA,MCbAsuH,iBAGXtnH,YAAoBlI,mBAFZG,eAAoB,GAOrBqtH,aAAaxtH,GAClB,OAAO0G,UAAoBvG,KAAKsvH,UAAWzvH,GAMtC+K,KAAK/K,GACV,MAAMC,EAAgBD,EAAQgL,SAAW,GACzC,IAAKhL,EAAQiL,KACX,YAAKwkH,UAAYxvH,GACV,EAGT,MAAMM,EAAOJ,KAAK+K,SAAStB,IAAIU,MAE/B,OAAO,IAAIa,QAAQ,CAAC3K,EAASC,KAC3BF,EACGqJ,IAAI5J,EAAQiL,MACZvC,QACC0C,KAAYzK,IACV0K,QAAQC,IAAI,kBAAkBtL,EAAQiL,0BACtCzK,GAAQ,MACD+K,KAAW5K,EAAM6K,OAAS,mBAGpCjD,UAAW5H,IACVR,KAAKsvH,UAAY/oH,YAAsBzG,EAAeU,GACtDH,GAAQ,qDApCLU,GAAgBrB,yCAAhBqB,EAAgBsI,QAAhBtI,EAAgB,qBAFf,SAEDA,gCCWHrB,gBAA4CA,8BAA+FA,wCAA/FA,+GAC5CA,gBAA6CA,SAAoBA,wCAApBA,mDAL/CA,yBAGEA,iCAASI,sBACTJ,uBACAA,uBACFA,kCAJEA,iBAEaA,sCACAA,iFAXvBA,kBACEA,iBACEA,0BACEA,qBAAWA,8BAAgEA,QAC3EA,wBACEA,sEACAA,gDAOFA,QACFA,QACFA,QAEAA,6DAKEA,sBAIEA,mDAASiyB,4BACPjyB,gCACJA,QACAA,6CACAA,wBAKEA,yDAA2B,MAA3BA,CAAgC,2EALlCA,QAOFA,QACFA,gCAtCuBA,gCAGNA,6EAETA,oCAEyBA,qDAa7BA,kKAGEA,yEAIEA,6EAESA,gDAKXA,iGAKNA,sBACEA,cAAIA,8BAA+DA,QACnEA,cACEA,cAAIA,8BAA6EA,QACjFA,cAAIA,+BAAiEA,QACrEA,eAAIA,gCAAuDA,QAC7DA,QACFA,8BANMA,2EAEEA,8FACAA,8EACAA,6FAIRA,sBACEA,cAAIA,8BAAmEA,QACzEA,eADMA,0GAWIA,mBACEA,8BACFA,+BADEA,mNAUAA,+BAEEA,yGAA4C,4GAA5CA,CAA4C,+FAG5CA,iBAAOA,8BAAgEA,QACzEA,cALEA,+BAIOA,qKAZbA,yBAIEA,iCAASI,sBACTJ,gBAAYA,SAAeA,QAC3BA,gBACEA,sCAOFA,QACFA,6CAbEA,2DAA4E,cAGhEA,wBAESA,gFAmBrBA,wBACEA,8BACFA,kCAFiEA,qBAC/DA,+FAFJA,SACEA,qEAGFA,+BAHiCA,mFAIjCA,yBACEA,8BACFA,eADEA,2FAMRA,iBACEA,0BACIA,yCACJA,QACFA,eAF6CA,yHAUrCA,wBACEA,8BACFA,kCAFqEA,qBACnEA,iGAFJA,SACEA,qEAGFA,+BAHmCA,wFANzCA,iBACEA,0BACEA,qBAAWA,8BAA8DA,QACzEA,yBAEEA,mDAKFA,QACFA,QACFA,+BAVeA,0EAGMA,kFASrBA,kBACEA,+BAGMA,8BACNA,QACFA,eAHMA,yCACEA,2GAIRA,kBACEA,+BAGMA,8BACNA,QACFA,eAHMA,yCACEA,sGAIRA,kBACEA,+BAGMA,8BACNA,QACFA,eAHMA,yCACEA,8HAzFVA,kBACEA,iBACEA,0BACEA,qBAAWA,8BAAiEA,QAC5EA,yBACEA,mEACAA,8BACEA,SACAA,0BAGFA,QACAA,mDAgBFA,QACFA,QACFA,QAEAA,kBACEA,2BACEA,sBAAWA,gCAAkEA,QAC7EA,0BAEEA,qDAKAA,mDAGFA,QACFA,QACFA,QAEAA,0BAMAA,0BAcAA,0BAQAA,0BAQAA,0BAQAA,mBACEA,sBAIEA,oHACAA,4EACFA,QACAA,6CACFA,QAEFA,gCAxGuBA,0BAGNA,8EAETA,iCAEEA,4EACOA,yCAKWA,2DAqBXA,gFAGMA,0DAKFA,0DAOeA,kEAMAA,8FAciBA,mHAQLA,+IAQFA,mDAYxCA,kEAEAA,yPAEWA,qDCtGJ6vH,iBAyFXxnH,YACUlI,EACAC,EACAM,EACAC,EACAC,EACAE,EACAkD,EACAE,EACAC,EACAE,EACAC,GAVAhE,qBACAA,qBACAA,uBACAA,sBACAA,wBACAA,oBACAA,mBACAA,cACAA,aACAA,sBACAA,uBAjGHA,cAAW,IAAI+I,SAAgB,GAC/B/I,gBAAa,IAAI+I,SAAgB,GACjC/I,uBAAiD,IAAI+I,IAC1D,IAEK/I,cAAW,IAAI+I,KAAgB,GAC/B/I,kBAAc,EACdA,mBAAgB,SAUfA,mBAAgB,IAAIilB,OAAO,aAI5BjlB,kBAAoD,IAAI+I,IAAgB,IAGxE/I,mBAAwB,EAEvBA,yBAOJ,IAAI+I,SAAgB,GAEf/I,sBAA2B,EAI5BA,6BAAyD,GAexDA,kBAAe,SAEdA,gBAAa,IAAIN,MAElBM,oBAAiD,IAAI+I,SAC5D,GAGQ/I,yBAAsB,IAAIN,MAqClCM,KAAKwvH,aACLxvH,KAAK4kG,YACL5kG,KAAKyvH,gDA5DoB5vH,GACzBG,KAAK0vH,wBAA0B7vH,EAC/BG,KAAKyvH,kDAGL,OAAOzvH,KAAK0vH,yBAA2B,gBAmBvC,OAAO1vH,KAAKu3B,KAAK9tB,IAAI,UAAU3H,iBAEtBjC,GACTG,KAAKu3B,KAAKy/D,WAAW,CAAE3sC,OAAQxqD,oBAI/B,OAAOG,KAAK2vH,WAAWlmH,IAAI,aAAa3H,oBAE5BjC,GACZG,KAAK2vH,WAAW34B,WAAW,CAAE44B,UAAW/vH,uBAIxC,OAAOG,KAAKswE,eAAe7mE,IAAI,8BAA0C,mBAG1D5J,GACfG,KAAKswE,eAAe76D,IAAI,2BAA4B5V,GAqBtD2gB,WACExgB,KAAKq4E,SAAWr4E,KAAK0F,IAAIktE,QAAQxqE,UAAWtI,IAC1CE,KAAK6vH,kBAAkB1nH,KACrBrI,EAAO2G,OAAQrG,GAEVA,aAAiB+kE,KAAoC,IAArB/kE,EAAM+wD,YACtC/wD,EAAMsmB,WAAW9X,QAAQi4C,UACxBzmD,EAAMsmB,WAAW9X,QAAQi4C,SAASh2C,QAK5C,MAAMhR,EAAmBG,KAAK2K,OAAOD,UACnC,wCAEF1K,KAAK8tH,uBACFjuH,GAAsC,IAAM0H,KAAKC,IAAI,KAAM,GAC9DxH,KAAK8vH,WAAa9vH,KAAK8tH,sBAAwBvmH,KAAKC,IAAI,KAAM,GAE9DxH,KAAK+vH,gBAAkB/vH,KAAKgwH,eACzBznH,QAAK29D,MAAWpmE,IAAmBA,IACnCsI,UAAWtI,IACVE,KAAKu3B,KAAKy/D,WAAWl3F,EAAe,CAAEiY,WAAW,IAC7CjY,EAAcuqD,QAChBrqD,KAAKiwH,eACHnwH,EAAcuqD,OAAO3kD,IAAKtF,GAAMJ,KAAK0F,IAAIqvE,aAAa30E,OAI9DJ,KAAKkwH,YAAclwH,KAAKu3B,KACrB9tB,IAAI,UACJgf,aACArgB,UAAWtI,UACV,MAAMO,EAAcuF,OAAOC,KAAK0lH,GAAcS,cAE3ChsH,KAAKmwH,eACuB,QAA7B/vH,OAAKm3B,KAAK9tB,IAAI,UAAU3H,aAAK,eAAEvB,QAAS,IACvCF,EAAYH,QAAQJ,IAAW,GAAKA,IAAWsrH,GAAazzC,OACxD33E,KAAKowH,aAAY,IACpBpwH,KAAKu3B,KAAKy/D,WAAW,CAAEjvE,YAAQ,GAAa,CAAEhQ,WAAW,OAKjE/X,KAAKkwH,YAAclwH,KAAKu3B,KACrB9tB,IAAI,UACJgf,aAAargB,UAAWtI,IACvBE,KAAKqwH,2BACL,MAAMjwH,EAAiBN,aAAoBqE,MAAQrE,EAAW,CAACA,GAC/DE,KAAKu3B,KAAKy/D,WAAW,CAAE3sC,OAAQjqD,GAAkB,CAAE2X,WAAW,IAC9D,MAAM1X,EAASD,EAAesF,IAAKlF,GAAMR,KAAK0F,IAAIqvE,aAAav0E,IAC/DR,KAAKiwH,eAAe5vH,IAIlB,IADAuF,OAAOC,KAAK7F,KAAKswH,SAASxuH,OAAO5B,QAAQF,KAAKu3B,KAAKz1B,MAAMimB,SAGzD/nB,KAAKu3B,KAAKy/D,WAAW,CAAEjvE,YAAQ,IAGjC/nB,KAAKuwH,SAASpoH,MAAK,GACnB,MAAM7H,EAKA,GACND,EAAOyF,QAAStF,IAEZA,aAAiB2kE,IAC4B,IAA7C3kE,EAAMkmB,WAAWq2B,GAAG8W,cAActzD,SAElCD,EAAcM,KAAK,CACjBgE,GAAIpE,EAAMoE,GACVgiB,QAASpmB,EAAMomB,QACf6jC,QAASjqD,EAAMiqD,QACf2U,UAAY5+D,EAAc4+D,YAE5B5+D,EAAMiqD,QAAU,EAChBjqD,EAAMomB,SAAU,KAIpB5mB,KAAKwwH,oBAAoBroH,KAAK7H,GAC9B62E,WAAW,KACTn3E,KAAKuwH,SAASpoH,MAAK,IAClB,OAGPnI,KAAKywH,UAAYzwH,KAAKswH,SACnB/nH,QAAK29D,MAAWpmE,IAAaA,IAC7BsI,UAAWtI,IAC0B,IAAhC8F,OAAOC,KAAK/F,GAASS,QACvBP,KAAKu3B,KAAKy/D,WAAW,CAAEjvE,OAAQjoB,EAAQ8F,OAAOC,KAAK/F,GAAS,QAIlEE,KAAK0wH,YAAc1wH,KAAK2wH,WACrBpoH,QAAK29D,MAAWpmE,IAAeA,IAC/BsI,UAAWtI,IAC4B,IAAlC8F,OAAOC,KAAK/F,GAAWS,QACzBP,KAAKu3B,KAAKy/D,WAAW,CAAE45B,SAAU9wH,EAAU8F,OAAOC,KAAK/F,GAAW,QAIxEE,KAAK6wH,mBAAqB7wH,KAAK6vH,kBAC5BtnH,QAAK29D,MAAWpmE,IAAYA,IAC5BsI,UAAWtI,IACY,IAAlBA,EAAOS,QACTP,KAAKu3B,KAAKy/D,WAAW,CAAE3sC,OAAQvqD,EAAO,GAAG8E,OAI/C5E,KAAKu3B,KAAK7P,SAAS1nB,KAAK8wH,eAAeroG,aAAargB,UAAWtI,IAE3DE,KAAKu3B,KAAKy/D,WADRl3F,IAAWsrH,GAAa6B,UAAYntH,IAAWsrH,GAAa8B,aACzC,CAAE0D,SAAUtF,GAAeqB,QAE3B,CAAEiE,SAAUtF,GAAekB,OAElDxsH,KAAKkf,MAAMD,kBAKTjf,KAAK2vH,WAAW34B,WAFhBh3F,KAAK+wH,gBACgC,IAAvC/wH,KAASgxH,aAAalvH,MAAMvB,OACC,CAAEqvH,UAAW,CAAEqB,aAAc,QAASrmF,MAAO,QAASD,KAAM,YAAa86E,KAAM,KAE/E,CAAEmK,UAAW5vH,KAAKgxH,aAAalvH,MAAM,IAGvC,CAAE8tH,eAAW,IAIpCH,qBACNzvH,KAAKkxH,gCCnQLnwH,GAEA,MAAMO,EAAUP,EAAuBowH,QACjCtxH,EAAUkB,EAAuBqwH,QAiBvC,MAhB+B,CAC3BC,gBAA0D,IAA1CtwH,EAAuBswH,eACvCC,OAAwC,IAAjCvwH,EAAuBuwH,MAC9BC,OAAwC,IAAjCxwH,EAAuBwwH,MAC9BC,aAAoD,IAAvCzwH,EAAuBywH,YACpCC,KAAoC,IAA/B1wH,EAAuB0wH,IAC5BC,KAAoC,IAA/B3wH,EAAuB2wH,IAC5BN,QAAS,CACTO,QAAS9xH,GAAWA,EAAQ8xH,QAAU9xH,EAAQ8xH,QAAU,GACxDC,QAAS/xH,GAAWA,EAAQ+xH,QAAU/xH,EAAQ+xH,QAAU,IAExDT,QAAS,CACTQ,QAASrwH,GAAWA,EAAQqwH,QAAUrwH,EAAQqwH,QAAU,EACxDC,QAAStwH,GAAWA,EAAQswH,QAAUtwH,EAAQswH,QAAU,KDkPvDV,CAAuDlxH,KAAK6xH,wBACjE,MAAMhyH,EAAkC,GAYxC,GAVIG,KAAKkxH,uBAAuBI,OAC9BzxH,EAAYe,KAAK,CAAEqwH,aAAc,QAASrmF,MAAO,QAASD,KAAM,YAAa86E,KAAM,KAEjFzlH,KAAKkxH,uBAAuBK,OAC9B1xH,EAAYe,KAAK,CAAEqwH,aAAc,QAASrmF,MAAO,QAASD,KAAM,YAAa86E,KAAM,KAEjFzlH,KAAKkxH,uBAAuBM,aAC9B3xH,EAAYe,KAAK,CAAEqwH,aAAc,cAAermF,MAAO,eAAgBD,KAAM,YAAa86E,KAAM,KAG9FzlH,KAAKkxH,uBAAuBQ,IAAK,CAEnC,MACMrxH,EAAUL,KAAKkxH,uBAAuBC,QAAQS,QAEpD,QAAStxH,EAHON,KAAKkxH,uBAAuBC,QAAQQ,QAGxBrxH,GAAWD,EAASC,IAE9CT,EAAYe,KAAK,CAAEqwH,aAAc,MAAOrmF,MAAO,OAAOtqC,IAAWqqC,KADpDrqC,EAAU,GAAK,YAAYA,IAAY,WAAW,GAAKA,IACGmlH,KAAM,GAAGnlH,MAIpF,GAAIN,KAAKkxH,uBAAuBO,IAAK,CAEnC,MACMpxH,EAAUL,KAAKkxH,uBAAuBE,QAAQQ,QAEpD,QAAStxH,EAHON,KAAKkxH,uBAAuBE,QAAQO,QAGxBrxH,GAAWD,EAASC,IAE9CT,EAAYe,KAAK,CAAEqwH,aAAc,MAAOrmF,MAAO,OAAOtqC,IAAWqqC,KADpDrqC,EAAU,GAAK,YAAYA,IAAY,WAAWA,IACQmlH,KAAM,GAAGnlH,MAIpF,IAAIR,EAAmB,GACnBE,KAAKkxH,uBAAuBG,iBAC9BvxH,EAAmBE,KAAK2K,OAAOD,UAAU,gBAAkB,IAG7D1K,KAAKgxH,aAAa7oH,KAAKrI,EAAiBkG,OAAOnG,IAGzCiyH,sBAAsBjyH,GAC5B,MAAMC,EAAiBE,KAAKoR,MACzBqJ,MACAI,KAAKza,GAAcA,EAAiEq8C,MAAM73C,KAAO/E,GACpG,GAAIC,EACF,OAAOA,EAKJiyH,kBAAkBlyH,SACvB,OAAgC,QAAzBC,OAAK4F,IAAIqvE,aAAal1E,UAAG,eAAEoP,MAIpC+iH,yBAAyBnyH,GACvB,MAAMC,EAAeE,KAAK8xH,sBAAsBjyH,EAAM+E,IACtD,GAAI9E,EAKF,QAJaA,EAAaiqC,YAAY5sB,UACnCvC,QAASva,IACyB,IAA1BA,EAAOyX,MAAMuI,UAMrB4xG,aAAapyH,EAA6BC,GAC/C,IAAIM,EAAsBJ,KAAKu3B,KAAKz1B,MAAMowH,oBACtCryH,EAAMynB,QACRlnB,EAAoBQ,KAAKd,GAEzBM,EAAsBA,EAAoBqG,OAAOpG,GAAWA,IAAYP,GAE1EE,KAAKu3B,KAAKy/D,WAAW,CAAEk7B,wBAGlBC,kBAAkBtyH,EAAOC,GAC1BE,KAAKu3B,KAAKz1B,MAAMuoD,OAAOxvC,KAAKza,GAAWA,IAAYN,IACrDD,EAAM4hB,kBAIH2wG,gCAAgCvyH,GACrC,QAAOG,KAAKu3B,KAAKz1B,MAAMowH,oBAAoBr3G,KAAK/a,GAAWA,IAAYD,EAAM+E,IAG/EuT,cACEnY,KAAKq4E,SAAS3vE,cACd1I,KAAK6wH,mBAAmBnoH,cACxB1I,KAAKywH,UAAU/nH,cACf1I,KAAK0wH,YAAYhoH,cACjB1I,KAAKkwH,YAAYxnH,cACb1I,KAAK+vH,iBACP/vH,KAAK+vH,gBAAgBrnH,cAEvB1I,KAAKqyH,oBAAoBn6G,KAAKlY,KAAKu3B,KAAKz1B,OACxC9B,KAAKqwH,2BAGCA,2BACN,MAAMxwH,EAAgBG,KAAKwwH,oBAAoB1uH,MAC3CjC,GAAiBA,EAAcU,QACjCV,EAAciG,QAAShG,IACrB,MAAMM,EAAgBJ,KAAK0F,IAAIqvE,aAAaj1E,EAAM8E,IAClDxE,EAAcwmB,QAAU9mB,EAAM8mB,QAC9BxmB,EAAcqqD,QAAU3qD,EAAM2qD,QAC7BrqD,EAAsBg/D,UAAYt/D,EAAMs/D,YAG7Cp/D,KAAKwwH,oBAAoBroH,UAAK,GAGhCmqH,YAAYzyH,GACV,IAAIC,EAAYE,KAAK4vH,UAAUjlF,KAC3B3qC,KAAKuyH,cAAcrtG,KAAKplB,KAC1BA,EAAY,QAAQA,KAGtBE,KAAKuwH,SAASpoH,MAAK,GACnB,UAAW/H,KAAQP,EACjBG,KAAKwyH,cAAczE,OAAO3tH,EAAMN,GAAWsI,UACxC/H,GAAwBL,KAAKyyH,oBAAoBryH,EAAMC,GACvDA,GAAiBL,KAAK0yH,kBAAkBtyH,EAAMC,GAC/C,KACEL,KAAKuwH,SAASpoH,MAAK,KAM3BioH,YAAYvwH,GAAoB,GACnBqB,OAAO+wB,KAAK,GAAI,QAAS,qBACjCU,QACH,MAAMvyB,EAAKc,OAAO+wB,KAAK,GAAI,QAAS,qBACpC,OAAK7xB,GAAMA,EAAGuyH,aAA+B,IAAdvyH,EAAGuyH,QAAiC,OAAPvyH,GAC1DJ,KAAK4yH,oBAAoB/yH,GACzBG,KAAK6yH,cAAe,IAEpBzyH,EAAGuyB,QACH3yB,KAAK6yH,cAAe,EACpB7yH,KAAKmwH,cAAe,GAEfnwH,KAAK6yH,aAGdC,uBAAuBjzH,GACrBG,KAAKuwH,SAASpoH,MAAK,GAEnB,MAAMrI,EAAc8F,OAAOC,KAAK0lH,GAAcS,cACzChsH,KAAKmwH,cAAgBtwH,EAAKwqD,OAAO9pD,OAAS,IAC5CT,EAAYI,QAAQL,EAAKkoB,SAAW,GAAKloB,EAAKkoB,SAAWqjG,GAAazzC,OAAS33E,KAAK6yH,cACrF7yH,KAAKowH,cAGP,IAAIhwH,EAA4D,GAC5DC,EAAqB,GACrBC,EAAmB,GAEvB,UAAYE,EAAYkD,KAAU7D,EAAKwqD,OAAOlwC,UAAW,CACvD,MAAMvW,EAAM5D,KAAK0F,IAAIqvE,aAAarxE,GAC5B7D,EAAKkoB,SAAWqjG,GAAa8B,cAAgBrtH,EAAKkoB,SAAWqjG,GAAa6B,WAC5EptH,EAAKkzH,eAAwC,IAAvBlzH,EAAKwqD,OAAO9pD,QACpCD,EAAWsD,EAAIqL,MACXpP,EAAKqR,OACP5Q,EAAWT,EAAKqR,OAGlB5Q,EAAWN,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,iCAEpD,MAAMnM,EAA+BD,EAAI8iB,WAAW9X,QACpD,GAAI/O,EAAKkoB,SAAWqjG,GAAazzC,KAAO9zE,EAAUgjD,WAAahjD,EAAUgjD,SAASh2C,KAAOhN,EAAUgjD,SAASC,YAO1G,YANAqwB,WAAW,KAET,MAAMlwE,EAAMpD,EAAUgjD,SAASh2C,KAAOhN,EAAUgjD,SAASC,WACzD7/C,EAAIoH,MAAM,iBAAmBrO,KAAKs7F,gBAAgBrpE,KAAKruB,GAAO1C,OAAO+wB,KAAKhrB,EAAM,UAChFjH,KAAKuwH,SAASpoH,MAAK,IAClB,KAGL,MAAMpE,EAAM/D,KAAK8xH,sBAAsBpuH,GACvC,IAAIM,EACJ,GAAID,GAAOA,EAAIgmC,aAAehmC,EAAIgmC,YAAY5sB,UAAU1C,MAAMla,OAI1DyD,GAF8C,IAA5CnE,EAAKqyH,oBAAoBhyH,QAAQwD,IAAiB7D,EAAKmzH,mBAE5CjvH,EAAIgmC,YAAY5sB,UAAU1C,MACpChU,OAAQQ,GAA4BA,EAAE6Q,MAAM2uD,aAAex/D,EAAE6Q,MAAMuI,UAAU3a,IAAIuB,GAAMA,EAAEuX,OAAmBu+B,KAC1D,IAA5Cl9C,EAAKqyH,oBAAoBhyH,QAAQwD,IAAkB7D,EAAKmzH,mBAI5DnzH,EAASmzH,mBAEDjvH,EAAIgmC,YAAY5sB,UAAU1C,MACpChU,OAAQQ,GAA4BA,EAAE6Q,MAAM2uD,aAAa/gE,IAAIuB,GAAMA,EAAEuX,OAAmBu+B,IAG9Eh5C,EAAIgmC,YAAY5sB,UAAU1C,MAAM/U,IAAIuB,GAAMA,EAAEuX,OAAmBu+B,IAR/Dh5C,EAAIgmC,YAAY5sB,UAAU1C,MACpChU,OAAQQ,GAA4BA,EAAE6Q,MAAMuI,UAAU3a,IAAIuB,GAAMA,EAAEuX,OAAmBu+B,QAUvF,CACH,MAAM91C,EAAKrD,EAAI8iB,WAAWq2B,GAExB/4C,EADEnE,EAAKmzH,mBACM/rH,EAAGoiE,oBACdzlE,EAAI8B,IAAI2lD,eAAewK,aAGZ5uD,EAAG4sD,cAEdjwD,EAAI8iB,sBAAsBwlC,KAC5BloD,EAAaA,EAAWqjE,QAASrkB,GAC/BA,EAAQv5C,IAAI,cAKlB,MAAM9E,EAAY3E,KAAK+P,gBAAgB/B,UACvC,IAAI80C,EAAyD,GA2B7D,GA1BIjjD,EAAKkoB,SAAWqjG,GAAa4B,WAAantH,EAAKkoB,SAAWqjG,GAAaS,IACzE7nH,EAAW8B,QAASmB,IAClB,MAAM+7C,EAAkB/7C,EAAU8qD,cAAcM,UAC1CpP,EAAkBH,EAAUjoC,KAAKwoC,GAAYA,EAAS45C,eAAiBj6C,GACzEC,EACFA,EAAgB0hC,SAAS/jF,KAAKqG,GAE9B67C,EAAUliD,KAAK,CAAEq8F,aAAcj6C,EAAiB2hC,SAAU,CAAC19E,OAI/D67C,EAAY,CAAC,CAAEm6C,aAAc,GAAItY,SAAU3gF,IAG7C8+C,EAAUh9C,QAAQmB,IAChBA,EAAS09E,SAAS7+E,QAAQk9C,IACxB,MAAMC,EAAiBD,EAAQv5C,IAAI,OACnC,GAAIw5C,EAAQ,CACV,MAAMI,EAA4B,CAACL,EAAQv5C,IAAI,aAAcu5C,EAAQv5C,IAAI,aACnE+5C,GAAS,SAASH,EAAYJ,EAAQ,KAC5CO,EAAOz+B,UAAU,YAAai+B,EAAQv5C,IAAI,gBAC1Cu5C,EAAQm3B,YAAY32B,QAKtB3jD,EAAKkoB,SAAWqjG,GAAaS,IAAK,CACpC,MAAM5kH,EAAgB67C,EAAUviD,OAGhC,GAFAuiD,EAAYA,EAAUr8C,OAAOw8C,GAAY,CAAC,aAAc,SAASxvC,SAASwvC,EAASg6C,eAE/Eh2F,EAD6B67C,EAAUviD,OACG,CAC5C,MAAM0iD,EAAQt+C,EAAUqL,QAAQ,uCAC1BqzC,EAAU1+C,EAAUqL,QAAQ,sCAClChQ,KAAK+Q,eAAe1F,MAAMg4C,EAASJ,EAAO,CAAE91C,QAAS,gBAE7CtN,EAAKkoB,SAAWqjG,GAAa8B,cAAgBrtH,EAAKkoB,SAAWqjG,GAAa6B,WAAaptH,EAAKkzH,cAAe,CAGrH,GAFAjwE,EAAUh9C,QAAQmB,GAAY7G,EAAaQ,KAAKqG,IAE5CzG,IAAeX,EAAKwqD,OAAO9pD,OAAS,EACtC,SACK,CACL,IAAI0G,EACJ7G,EAAa0F,QAAQk9C,IACnBA,EAAS2hC,SAAS7+E,QAAQm9C,IACxB,GAAIpjD,EAAKozH,UACP,GAAIhsH,GACF,GAAIg8C,EAAex5C,IAAI,iBAAiBgzC,MAAM7tC,QAAQK,QACtDhI,EAAgBwC,IAAI,iBAAiBgzC,MAAM7tC,QAAQK,MAAO,CACxD,MAAMo0C,EAAiBrjD,KAAKkzH,qBAAqBjsH,EAAiBg8C,GAClE5iD,EAAYO,KAAKyiD,EAAe,IAChChjD,EAAYO,KAAKyiD,EAAe,IAChChjD,EAAYO,KAAKyiD,EAAe,SAE7B,CACL,MAAMA,EAAiBrjD,KAAKkzH,qBAAqBjwE,EAAgBA,GACjE5iD,EAAYO,KAAKyiD,EAAe,IAGpChjD,EAAYO,KAAKqiD,GACjBh8C,EAAkBg8C,OAM1B,GAAyB,IAArBH,EAAUviD,OAAc,CAC1BP,KAAKuwH,SAASpoH,MAAK,GACnB,MAAMlB,EAAQtC,EAAUqL,QAAQ,gCAC1BgzC,EAAUr+C,EAAUqL,QAAQ,+BAClChQ,KAAK+Q,eAAe1F,MAAM23C,EAAS/7C,EAAO,CAAEkG,QAAS,WAG/CtN,EAAKkoB,SAAWqjG,GAAa8B,cAAgBrtH,EAAKkoB,SAAWqjG,GAAa6B,WAAcptH,EAAKkzH,gBACjGjwE,EAAUp9C,IAAIuB,GACZjH,KAAKmzH,cAAczH,OAAOzkH,EAAS09E,SAAU9kF,EAAKkoB,OAAQznB,EAAW2G,EAASg2F,aAAcp9F,EAAK+wH,SAAU5wH,KAAK0F,IAAI+jD,YACnHrhD,UACC,OACC46C,GAAiBhjD,KAAKozH,kBAAkBpwE,GACzC,KACEhjD,KAAKqzH,sBAELpsH,EAAS09E,SAAS7+E,QAAQk9C,IACxBhjD,KAAK6yG,cAAc7vD,KAGrBhjD,KAAKuwH,SAASpoH,MAAK,OAM1BtI,EAAKkoB,SAAWqjG,GAAa8B,cAAgBrtH,EAAKkoB,SAAWqjG,GAAa6B,WAAaptH,EAAKkzH,eAC/F/yH,KAAKmzH,cAAczH,OAAOrrH,EAAaR,EAAKkoB,OAAQznB,EAAUT,EAAK+wH,SAAU5wH,KAAK0F,IAAI+jD,YACrFrhD,UACC,OACC5H,GAAiBR,KAAKozH,kBAAkB5yH,GACzC,KACER,KAAKqzH,sBAELhzH,EAAYyF,QAAQtF,IAClBR,KAAK6yG,cAAcryG,KAGrBR,KAAKuwH,SAASpoH,MAAK,KAMnB+qH,qBAAqBrzH,EAAiBC,GAC5C,MAAMM,EAAWN,EAAe4J,QAC1BrJ,EAAYP,EAAe4J,QAC3BpJ,EAAWR,EAAe4J,QAC1BlJ,EAAqCX,EAAgB41D,UAC3D,IAAI/xD,EAA2B,GAC/B,UAAWo/C,KAAOtiD,EAChB,GAAiC,aAA7BA,EAAoBsiD,GAAqB,CAC3Cp/C,EAAmBlD,EAAoBsiD,GACvC,MAIJ,MAAMl/C,EAAoC9D,EAAe21D,UACzD,IAAI5xD,EAA0B,GAC9B,UAAWi/C,KAAOl/C,EAChB,GAAgC,aAA5BA,EAAmBk/C,GAAqB,CAC1Cj/C,EAAkBD,EAAmBk/C,GACrC,MAGJ,MAAM/+C,EAAyBjE,EAAe21D,UAC9Cj1D,EAAoBsF,QAAQg9C,IACtB/+C,EAAQ0P,SAASqvC,IAAgBA,IAAgBp/C,GACnDK,EAAQnD,KAAKkiD,KAGjB/+C,EAAQmiC,QAAQxiC,GAEhB,IAAIM,EAAsB,GAC1B,UAAW8+C,KAAO/+C,EAChB,GAAqB,aAAjBA,EAAQ++C,GAAqB,CAC/B9+C,EAAcD,EAAQ++C,GACtB,MAGJ,SAAQh9C,QAAQg9C,IACd,MAAM77C,EAAoBzG,EAAoBD,SAAWqD,EAAmBrD,QAC5EC,EAAoBkc,MAAM,CAACsmC,EAAOC,IAAUD,IAAUp/C,EAAmBq/C,IACrEH,IAAQ9+C,GAAgBiD,EAIrB67C,IAAY9+C,GAAeiD,GAIvB67C,IAAQj/C,GAHjBzD,EAASqV,IAAIqtC,EAAKhjD,EAAe2J,IAAI,iBAAiBgzC,MAAM7tC,QAAQK,OAAO,GAC3E5O,EAAUoV,IAAIqtC,EAAKA,GAAK,GACxBxiD,EAASgzH,MAAMxwE,GAAK,IAKH,aAARA,GACT1iD,EAASkzH,MAAMxwE,GAAK,GACpBziD,EAAUoV,IAAIqtC,EAAKA,GAAK,GACxBxiD,EAASgzH,MAAMxwE,GAAK,KAEpB1iD,EAASkzH,MAAMxwE,GAAK,GACpBxiD,EAASgzH,MAAMxwE,GAAK,KAjBpB1iD,EAASqV,IAAIqtC,EAAKhjD,EAAe2J,IAAI,iBAAiBgzC,MAAM7tC,QAAQK,MAAQ,qBAAqB,GACjG5O,EAAUoV,IAAIqtC,EAAKA,GAAK,GACxBxiD,EAASgzH,MAAMxwE,GAAK,IAkBhBl/C,EAAmB6P,SAASqvC,IAChCziD,EAAUizH,MAAMxwE,GAAK,KAGF,CAAC1iD,EAAUC,EAAWC,GAIvCuyG,cAAchzG,GAGpB,GAFuBA,EAAQ4J,IAAI,OAEvB,CACV,MAAMrJ,EAAQ,IAAImzH,KAAQ,CAAC1zH,EAAQ4J,IAAI,aAAc5J,EAAQ4J,IAAI,cACjErJ,EAAM2kB,UAAU,YAAallB,EAAQ4J,IAAI,gBACzC5J,EAAQs6E,YAAY/5E,IAIhBwkG,YACN5kG,KAAK2vH,WAAa3vH,KAAKooB,YAAYwP,MAAM,CACvCg4F,UAAW,CAAC,GAAI,CAACvpG,mBAIjBrmB,KAAKu3B,KAAOv3B,KAAKooB,YAAYwP,MAD/B53B,KAASwzH,YAC4B,CACjCzrG,OAAQ,CAAC,GAAI,CAAC1B,iBACdgkC,OAAQ,CAAC,GAAI,CAAChkC,iBACd6rG,oBAAqB,CAAC,IACtBtB,SAAU,CAACtF,GAAekB,KAAM,CAACnmG,iBACjC0sG,cAAe,EAAC,EAAM,CAAC1sG,iBACvB4sG,UAAW,EAAC,EAAO,CAAC5sG,iBACpB2sG,mBAAoB,EAAC,EAAO,CAAC3sG,iBAC7BnV,KAAM,CAAC,GAAI,CAACmV,kBAGqB,CACjC0B,OAAQ,CAAC,GAAI,CAAC1B,iBACdgkC,OAAQ,CAAC,GAAI,CAAChkC,iBACd6rG,oBAAqB,CAAC,IACtBtB,SAAU,CAACtF,GAAekB,KAAM,CAACnmG,iBACjC0sG,cAAe,EAAC,EAAM,CAAC1sG,iBACvB4sG,UAAW,EAAC,EAAO,CAAC5sG,iBACpB2sG,mBAAoB,EAAC,EAAO,CAAC3sG,mBAK3BosG,oBAAoB5yH,EAAYC,GACjCE,KAAK2K,OAAOD,UAAU,mBASzB+oH,GACE5zH,EACAC,EACAE,KAAK0F,IACL1F,KAAK+Q,eACL/Q,KAAK+P,gBACL/P,KAAK0zH,iBACL1zH,KAAKi5E,cAfPw6C,GACE5zH,EACAC,EACAE,KAAK0F,IACL1F,KAAK+Q,eACL/Q,KAAK+P,iBAeH2iH,kBAAkB7yH,EAAYC,GACpCE,KAAKuwH,SAASpoH,MAAK,YL3iBrBpH,EACAO,EACAzB,EACAC,EACAM,KAIE,eAAgBuzH,GAChB,oBAAqBC,GACrB,sBAAuBC,GACvB,yBAA0BC,GAC1B,sBAAuBC,KAEdzyH,EAAM0N,SACfjO,EACAO,EACAzB,EACAC,EAZFM,EAASA,GAAkB,IKqiBN,CAEjBP,EACAC,EACAE,KAAK+Q,eACL/Q,KAAK+P,gBACL/P,KAAK8vH,YAID8C,oBAAoB/yH,GAAoB,GAC9CG,KAAKuwH,SAASpoH,MAAK,GACnB,MAAMrI,EAAYE,KAAK+P,gBAAgB/B,UACjC5N,EAAQN,EAAUkQ,QAAQ,qCAC1B3P,EACJP,EAAUkQ,QADSnQ,EACD,0CACA,qCACdS,EAAUR,EAAUkQ,QAAQ,mCAAoC,CAAEgkH,iBACxEh0H,KAAK+Q,eAAe1F,MAAM/K,EAASF,EAAO,CAAE+M,QAAS,MAG/CimH,kBAAkBvzH,GACxBG,KAAKuwH,SAASpoH,MAAK,YExwBrBpH,EACAO,EACAzB,GAEA,GAAIkB,aAAiBijD,GAEnB,qBAmBFjjD,EACAO,GAEA,MAAMzB,EAAYyB,EAAgB0M,UAC5BlO,EAAQD,EAAUmQ,QAAQ,gCAC1B5P,EAAUP,EAAUmQ,QAAQ,+BAClCjP,EAAesK,MAAMjL,EAASN,GAzB5B,CAD2BwB,EAAgBzB,GAG7C,MAAMC,EAAYD,EAAgBmO,UAC5B5N,EAAQN,EAAUkQ,QAAQ,+BAC1B3P,EAAUP,EAAUkQ,QAAQ,8BAClC1O,EAAe+J,MAAMhL,EAASD,GF6vBT,CACGP,EAAOG,KAAK+Q,eAAgB/Q,KAAK+P,iBAGjDy/G,kBACoD,IAAtDxvH,KAAK2K,OAAOD,UAAU,8BACxB1K,KAAKwzH,YAAcxzH,KAAK2K,OAAOD,UAAU,6BAE3C1K,KAAKiwH,iBACLjwH,KAAKi0H,gBAGAC,qBAAqBr0H,GAC1B,OAAIA,IAAWurH,GAAa6B,UAAYptH,IAAWurH,GAAa8B,cAC9DltH,KAAKu3B,KAAKy/D,WAAW,CAAE45B,SAAUtF,GAAeqB,SACzCrB,GAAeqB,SAEtB3sH,KAAKu3B,KAAKy/D,WAAW,CAAE45B,SAAUtF,GAAekB,OACzClB,GAAekB,MAIlByH,gBACNj0H,KAAK2wH,WAAWxoH,KAAKmjH,IAGf2E,eAAepwH,GACrB,IAAIC,EAA2B8F,OAAOC,KAAKulH,IAC3C,MAAMhrH,EAAc,CAClB+zH,SAAS,EACTC,YAAY,EACZC,cAAc,EACdC,YAAY,GAERj0H,EAAa,GACnB,GAAIR,GAAUA,EAAOU,OAwBnB,GAvBAV,EAAOiG,QAASxF,WACTA,KAGgC,QAAjCE,IAAMkmB,WAAW9X,QAAQi4C,gBAAQ,eAAE0tE,iBACrCn0H,EAAYk0H,YAAa,EACzBj0H,EAAWO,KAAK,CAAC67C,MAAOn8C,EAAM2O,MAAOulH,QAASx0H,KAAKy0H,mBAAmBn0H,EAAMomB,WAAW9X,QAAQi4C,SAAS0tE,mBAEtGj0H,aAAiB6kE,KACnB7kE,EAAMomB,WAAW9X,QAAQi4C,WACzBvmD,EAAMomB,WAAW9X,QAAQi4C,SAASh2C,IAG7BvQ,EACComB,WAAW9X,QAAQi4C,WACxBvmD,EAAMomB,WAAW9X,QAAQi4C,SAASh2C,KAAOvQ,EAAMomB,WAAW9X,QAAQi4C,SAASC,YAE5E1mD,EAAYi0H,cAAe,EAClB/zH,aAAiB6kE,KAC1B/kE,EAAYg0H,YAAa,GAPzBh0H,EAAY+zH,SAAU,MAWE,IAAxB/zH,EAAY+zH,UAA+C,IAA3B/zH,EAAYg0H,WAC9Ct0H,EAAiB,CAAC,gBAES,IAA3BM,EAAYg0H,aACY,IAAxBh0H,EAAY+zH,QAEZn0H,KAAKiwH,iBACD7E,GAAazzC,OAAO33E,KAAKswH,SAASxuH,QAIpChC,EAHa8F,OAAOC,KAAK7F,KAAKswH,SAASxuH,OAAO2E,OAC3CjG,GAAgB,QAARA,SAAQ,IAKQ,IAA7BJ,EAAYi0H,eACY,IAAxBj0H,EAAY+zH,UACe,IAA3B/zH,EAAYg0H,aAEZp0H,KAAKiwH,mBACC7E,GAAazzC,OAAO33E,KAAKswH,SAASxuH,QAAQ,CAC9C,MAAMxB,EAAOsF,OAAOC,KAAK7F,KAAKswH,SAASxuH,OACvCxB,EAAKM,KAAK,OACVd,EAAiBQ,EAUvB,QANsD,IAAlDN,KAAK2K,OAAOD,UAAU,0BAIxB5K,EAH4BE,KAAKy0H,mBAC/Bz0H,KAAK2K,OAAOD,UAAU,0BAItBtK,EAAYk0H,WAAhB,CACE,IAAIh0H,EACJ,MAAME,EAA0B,GAChC,IAAIkD,EAA4BrD,EAAW,GAAGm0H,QAC9Cn0H,EAAWqF,IAAI7B,IACbrD,EAAwBI,KAAKiD,EAAK44C,OAClCn8C,EAAgBuD,EAAK2wH,QAAQ/tH,OAAO1C,GAASL,EAA0B+P,SAAS1P,IAChFL,EAA4BG,EAAK2wH,UAEnC,MAAM5wH,EAAetD,EAAcmG,OAAO5C,GAAS/D,EAAe2T,SAAS5P,IACvED,EAAarD,OAAS,GACxBP,KAAKswH,SAASnoH,KAAKkjH,EAAQznH,IAEvB/D,GAAUA,EAAOU,QACfV,EAAOU,OAAS,GAClBP,KAAK+Q,eAAelB,MAClB7P,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,iCAAkC,CAAElO,MAAOtB,EAAwBM,SAC1Gd,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,sCAK7ChQ,KAAKswH,SAASnoH,KAAK,IACnBnI,KAAK+Q,eAAelB,MAClB7P,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,gCACvChQ,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,wCAK3ChQ,KAAKswH,SAASnoH,KAAKkjH,EAAQvrH,IAIvB20H,mBAAmB50H,GACzB,OAAOA,EACJ4G,OAAQ3G,IACP,GACEA,EAAO+G,gBAAkBukH,GAAa6B,SAASpmH,eAC/C/G,EAAO+G,gBAAkBukH,GAAa8B,aAAarmH,eACnD/G,EAAO+G,gBAAkBukH,GAAa0B,IAAIjmH,eAC1C/G,EAAO+G,gBAAkBukH,GAAaS,IAAIhlH,eAC1C/G,EAAO+G,gBAAkBukH,GAAasJ,QAAQ7tH,eAC9C/G,EAAO+G,gBAAkBukH,GAAa2B,IAAIlmH,eAC1C/G,EAAO+G,gBAAkBukH,GAAa4B,UAAUnmH,eAChD/G,EAAO+G,gBAAkBukH,GAAazzC,IAAI9wE,cAE1C,OAAO/G,IAGV4F,IAAK5F,GACAA,EAAO+G,gBAAkBukH,GAAa6B,SAASpmH,cACjD/G,EAASsrH,GAAa6B,SAGpBntH,EAAO+G,gBAAkBukH,GAAa8B,aAAarmH,cACrD/G,EAASsrH,GAAa8B,aAGpBptH,EAAO+G,gBAAkBukH,GAAa0B,IAAIjmH,cAC5C/G,EAASsrH,GAAa0B,IAGpBhtH,EAAO+G,gBAAkBukH,GAAaS,IAAIhlH,cAC5C/G,EAASsrH,GAAaS,IAGpB/rH,EAAO+G,gBAAkBukH,GAAasJ,QAAQ7tH,cAChD/G,EAASsrH,GAAasJ,QAGpB50H,EAAO+G,gBAAkBukH,GAAa2B,IAAIlmH,cAC5C/G,EAASsrH,GAAa2B,IAGpBjtH,EAAO+G,gBAAkBukH,GAAa4B,UAAUnmH,cAClD/G,EAASsrH,GAAa4B,UAIpBltH,EAAO+G,gBAAkBukH,GAAazzC,IAAI9wE,cAC5C/G,EAASsrH,GAAazzC,SADxB,GAOCg9C,YAAY90H,GACjBG,KAAK40H,WAAW18G,KAAKrY,GAGfwzH,gCE/6BRtyH,EACAO,GAEA,MAAMzB,EAAYyB,EAAgB0M,UAC5BlO,EAAQD,EAAUmQ,QAAQ,gCAC1B5P,EAAUP,EAAUmQ,QAAQ,+BAClCjP,EAAeyO,QAAQpP,EAASN,GFy6BxBuzH,CACkBrzH,KAAK+Q,eAAgB/Q,KAAK+P,iBAGpD8kH,qBAAqBh1H,GACnBG,KAAK80H,aAAej1H,EAAMiC,oDA94BjBf,GAAqBrB,6IAArBqB,EAAqBugB,o6DDhElC5hB,iBACEA,qCAEMA,kCAAUI,4BACVJ,+BACEA,8BACFA,QACAA,+BACEA,8BACFA,QACNA,QACFA,QAEAA,2BAuCAA,8BASAA,+CAIAA,qDA/DQA,uCAEmBA,iCACjBA,6EAEiBA,iCACjBA,8EAKuCA,iDAuChBA,iDASAA,8FAIUA,kuDCD9BqB,MG3DFg0H,GAAoB,IAAIr1H,MAAiC,gCAE5BqB,GACtC,MAAO,CACLmJ,QAAS6qH,GACTvpH,SAAUzK,eAKZA,EACAO,GAEA,MAAO,IAAMP,EAAiB6J,KAAKtJ,OCVxB0zH,iBAAkBjrH,iBAE3B,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,CAACgrH,GAAwB,IDUjC,CACL/qH,QAASxK,MACTiM,WAAYupH,GACZ7qH,OAAO,EACPwB,KAAM,CAACwjH,GAAkB0F,qDClBhBh0H,4DAJF,MAIEA,MCuCAo0H,iBAAqBprH,iBAE9B,MAAO,CACLC,SAAUjJ,iDAHHA,4DAvBF,CACPtB,KACAwvB,KACA5I,MACAA,MACArZ,KACAgiB,KACAs4E,MACAujB,MACAzxF,MACAwxF,MACA/+F,MACA0I,KACA2hE,MACAvpF,GACAg4B,GACA/D,GACAhM,GACAogG,GAAmBjrH,WAEkCirH,MAG5Cj0H,MCuBAq0H,2HA7CF,CACPpoH,KACAL,GACA4lB,GACA9yB,KACAuvB,KACAC,SAuCSluB,gCCvDTrB,wBACEA,8BACFA,kCAFqDA,iBACnDA,+DD0CF+8E,GAA2B,+BAC3B4D,IAAoB,cAApBA,GAAoB,MAPpBjK,IAAmB,QEzBVi/C,iBA8DXttH,cAxDO/H,cAAoC,IAAI+I,SAAgB,GAiCvD/I,YAAiB,EAUfA,uBAAoB,IAAIN,kBArBtBG,GACVG,KAAKuvG,SAASpnG,KAAKtI,iBAEG,OAAOG,KAAKuvG,SAASztG,eAMpCjC,GAAkBG,KAAKs1H,eAAez1H,cACzB,OAAOG,KAAKu1H,yBAkBhC,OACS3vH,OAAO+V,OADZ3b,KAAKw1H,cAAgBp1B,GAAY2O,KACdnO,GAEFN,IASvBnoF,cACEnY,KAAKs1H,gBAAe,GAOtBvT,oBAAoBliH,GAClBG,KAAKwhH,YAAc3hH,EACnBG,KAAKgiH,kBAAkB9pG,KAAKrY,GAGtBy1H,eAAez1H,QACE,IAAnBG,KAAKy1H,WACPz1H,KAAKy1H,UAAU/sH,eAEF,IAAX7I,IACFG,KAAKy1H,UAAYz1H,KAAKuvG,SAASnnG,UAAWtI,IACxCE,KAAK01H,uBAAuB51H,MAGhCE,KAAKu1H,MAAQ11H,EAGP61H,uBAAuB71H,GAC7B,IAAIC,EAAcE,KAAKwhH,YACnBxhH,KAAKw1H,cAAgBp1B,GAAY2O,KACnCjvG,WvE4E8BiB,GAClC,IAAIO,EAAOs/F,GAAgBC,aACvBhhG,EAAYkB,EAChB,MAAMjB,EAAgB,CAAC8gG,GAAgBG,kBACvC,KAAOlhG,EAAY,KAAWC,EAAcS,OAAS,GACnDe,EAAOxB,EAAcirB,MACrBlrB,EAAYksG,GAAmBhrG,EAAOO,GAExC,OAAOA,EuEpFHxB,CAAkCD,GACzBG,KAAKw1H,cAAgBp1B,GAAYC,SAC1CvgG,WvE0DgCiB,GACpC,IAAIO,EAAOg/F,GAAkBC,OACzB1gG,EAAYkB,EAChB,MAAMjB,EAAgB,CAACwgG,GAAkBG,YACzC,KAAO5gG,EAAY,KAAQC,EAAcS,OAAS,GAChDe,EAAOxB,EAAcirB,MACrBlrB,EAAY+rG,GAAa7qG,EAAOO,GAElC,OAAOA,EuElEHxB,CAAoCD,IAElCC,IAAgBE,KAAKwhH,aACvBxhH,KAAK+hH,oBAAoBjiH,iDArGlBiB,8BAAqBugB,ycD3BlC5hB,4BAIEA,qBAAWA,SAAeA,QAC1BA,6DAIFA,QACAA,4BACEA,wBAGEA,2CAAmBI,iCACnBJ,+BAGFA,QACFA,eAfaA,8BAGTA,8BAAiB,2DAKjBA,sCAAqB,mBAGeA,2XCY3BqB,MCuBA40H,2HAzBF,CACP3oH,KACAgiB,KACAs4E,MACA7nG,KACAwvB,KACApD,MACA0I,KACA6E,MACA88D,MACAD,KACAtpF,GACAqtB,OAaSj5B,YART0qG,GAAiB,6BADjB4pB,GAAqBrmG,sCAErBu8E,GAAuB,aAHvBoF,SC7BSilB,2HANF,GAGPD,MAGS50H,UCXD80H,SAAZ,OAAY90H,UAAa,KACrBA,iBACAA,mBACAA,mBACAA,+CAJQ80H,GAAZ,IAAY90H,UCUC+0H,iBAMX/tH,cALO/H,eAAY,IAAI+I,IAA4C,CACjE,QACA,IAKFgjE,YAAYlsE,EAAqBC,EAAwB+1H,GAAcl9G,MACrE3Y,KAAK+1H,UAAU5tH,KAAK,CAACtI,EAAUC,IAGjCoW,QACElW,KAAK+1H,UAAU5tH,KAAK,CAAC,GAAI0tH,GAAcl9G,qDAb9B5X,gCAAcsI,QAAdtI,EAAc,qBAFb,SAEDA,MCKAi1H,iBAQXjuH,YACkBlI,EACRC,GADQE,iBACRA,sBARFA,YAAS,IAAIi2H,eAGnB,OAAOj2H,KAAKs2B,UAAU5wB,IAQxB8a,WACExgB,KAAKk2H,WAAal2H,KAAKm2H,eAAeJ,UAAU3tH,UAAUvI,GACxDG,KAAKo2H,eAAev2H,EAAI,GAAIA,EAAI,KAIpCsY,cACEnY,KAAKk2H,WAAWxtH,cAGV0tH,eAAev2H,EAAqBC,kDAvBjCiB,GAAgBrB,gDAAhBqB,EAAgBugB,mCAAhBvgB,MCNAs1H,iBAAgBtsH,iBAEzB,MAAO,CACLC,SAAUjJ,iDAHHA,4DAJF,MAIEA,MCgBAu1H,iBAIXvuH,YACUlI,EACAC,EACAM,EACAC,EACAC,GAJAN,YACAA,sBACAA,uBACAA,uBACAA,qBAGVu2H,MAAM12H,EAAaC,GACjB,MAAMM,EAAU,IAAI4H,KAEd3H,EAAsBP,EAAQ02H,YAC9Bl2H,GAAcR,EAAQsvE,WACtB5uE,EAAcV,EAAQ22H,YAG5Bz2H,KAAKu2E,WAAav2E,KAAK6J,gBAAgBb,WACvC,MAAMpF,EAAM,IAAI8yH,MAAM,CACpBD,cACA1uG,OAAQ1nB,EAAY0G,gBAGhBlD,EAAa,CACjBD,EAAI+yH,SAAS5yG,SAAS0zC,MACtB7zD,EAAI+yH,SAAS5yG,SAASg5D,QAGlBh5E,EAAU,CAAC,GAAI,GAAI,GAAI,IACvBC,EAAQH,EAAW,GAAKE,EAAQ,GAAKA,EAAQ,GAC7CY,EAASd,EAAW,GAAKE,EAAQ,GAAKA,EAAQ,GAC9C++C,EAAO,CAAC9+C,EAAOW,GACrB,IAAIsC,EAAmB,CAAC,EAAG,GAM3B,QAJsB,IAAlBnH,EAAQmP,QACVhI,EAAmBjH,KAAK42H,aAAa92H,EAAQmP,MAAOjL,EAAOW,EAAQf,GACnE5D,KAAK62H,SAASjzH,EAAK9D,EAAQmP,MAAOhI,EAAiB,GAAIlD,EAAQ,GAAKkD,EAAiB,GAAIA,EAAiB,IAAM,KAAO,WAEhG,IAArBnH,EAAQg3H,SAAwB,CAClC,IAAI9zE,EAAqB,EACzB,MAAMC,EAASh8C,EAAiB,GAChC+7C,EAAqBhjD,KAAK+2H,gBAAgBj3H,EAAQg3H,SAAU9yH,EAAOW,EAAQf,GAC3E5D,KAAKg3H,YAAYpzH,EAAK9D,EAAQg3H,SAAmB,GAAT7zE,EAAcl/C,EAAQ,GAAKi/C,EAA6B,IAATC,GAAgB,KAAO,KAC9Gl/C,EAAQ,GAAKA,EAAQ,GAA2B,GAAtBkD,EAAiB,IAAY,KAAO,IAEhE,QAA+B,IAA3BnH,EAAQm3H,iBAAiD,IAAtBn3H,EAAQo3H,YAC7Cl3H,KAAKm3H,aACHvzH,EACA/D,EACAS,EACAR,EAAQm3H,eACRn3H,EAAQo3H,WAGY,KAApBp3H,EAAQs3H,SACVp3H,KAAKq3H,WAAWzzH,EAAK9D,EAAQs3H,SAG/Bp3H,KAAKs3H,OAAO1zH,EAAK/D,EAAKS,EAAYwiD,EAAM/+C,GAASqE,UACxC46C,IAAqB,wCACtBA,IAAWl7C,eACP9H,KAAKu3H,SAAS3zH,EAAK/D,EAAKkE,SACxB/D,KAAKw3H,mBAAmB5zH,EAAK/D,EAAKkE,GACT,SAA3BjE,EAAQ23H,eACV,CAAK,UAAW,WAAY,aAAc,eAAev3H,QAAQJ,EAAQ23H,iBAAkB,QACnFz3H,KAAK03H,kBAAkB9zH,EAAK/D,EAAKkE,EAASzD,EAAYR,EAAQ23H,gBAChC,YAA3B33H,EAAQ23H,uBACXz3H,KAAK23H,UAAU/zH,EAAK/D,EAAKkE,EAASzD,UAGpCN,KAAK43H,QAAQh0H,KAInBo/C,IAAWl7C,QAAsBk7C,IAAWl7C,WAC9C9H,KAAK6J,gBAAgBT,WAAWpJ,KAAKu2E,YACrCn2E,EAAQ+H,KAAKL,YAKZ1H,EASKo3H,mBACZ33H,EACAC,EACAM,kDAEA,GAAIN,EAAIuqD,OAAOxvC,KAAKxa,GAASA,EAAMumB,SAAWvmB,EAAMuE,GAAGy/D,WAAW,kBAAmB,CACnF,IAAIhkE,EACJ,MAAMC,EAAyBR,EAAIi9C,GAAG86E,4BAChCC,KAAYx3H,EAAwB,CACxCkpD,MAAO,EACPuuE,gBAAiB,OAChBvkF,KAAKhzC,IACNH,EAA4BG,IAE9BR,KAAKg4H,UAAUn4H,EAAKQ,EAA2BD,MAUnD63H,oBACEvyH,EACA5F,EACAM,GAEA,OAAO,IAAIsW,IAAYrW,IACrB,IAAIC,EAAO,GACX,MAAME,WC9IqBO,EAAiBO,GAChD,MAAMzB,EAAU,GAEhB,UAAWC,KAASiB,EAAQ,CAC1B,MAAMX,EAAgBN,EAAM8O,QAAQygD,cACpC,IAAsB,IAAlBvvD,EAAM8mB,QAAqB,SAE/B,MAAMvmB,EAAaP,EAAM4mB,WAAW44B,eAAU,EAAWh+C,IAAS,GAClE,UAAWhB,KAAaD,OACA,IAAlBC,EAAUuQ,KAGdhR,EAAQe,KAAK,CACXqO,MAAOnP,EAAMmP,OAAS,GACtB4B,IAAKvQ,EAAUuQ,IACfwc,aAAoC,KAAd,MAAbjtB,OAAa,EAAbA,EAAeitB,UAA+BjtB,EAAcitB,UAK3E,OAAOxtB,ED0HGW,CACJkF,EAAI2kD,OACJ,CACE+kB,WAAY1pE,EAAI2lD,eAAe0F,gBAC/BjmB,OAAQplC,EAAI2lD,eAAewK,YAC3BpM,WAAY/jD,EAAI2lD,eAAeC,kBAAkB/J,UAEjDhoC,KAAM7T,EAAIq3C,GAAG2wB,YAGjB,GAAuD,IAAnDltE,EAAQiG,OAAO7C,IAAmB,IAAdA,EAAEypB,SAAkB9sB,OAG1C,OAFAF,EAAS8H,KAAK7H,QACdD,EAASilB,WAKXhlB,GAAQ,yCACRA,GAAQ,mCAAqCR,EAAQ,8CACrDQ,GAAQ,0CACRA,GAAQ,6FACRA,GAAQ,WAIRA,GAAQ,gCACRA,GAAQ,4BACRA,GAAQ,+BAGR,MAAMoD,EAAUlD,EAAQiG,OAAO7C,GAAKA,EAAEypB,SAAS3nB,IAAK9B,GAClD5D,KAAKk4H,aAAat0H,EAAOiN,KAAKtI,MAC5B4vH,OAAOt0H,IACL,IAAIE,EAAU,WAAaH,EAAOqL,MAAMpI,cAAgB,aACxD,UAAW,qBAAuBhD,EAAY,eACvCE,OAIb,QAASL,GAAS0E,UAAWxE,IAC3BtD,EAAOsD,EAAWoD,OAAO,CAACnD,EAAKE,IAAaF,EAAOE,EAAUzD,GAC7DA,GAAQ,WACRA,GAAQ,SACRD,EAAS8H,KAAK7H,GACdD,EAASilB,eAKf4yG,aAAar4H,GAEX,OAAO,IADeilB,GAAgB9kB,KAAKkM,KAAMlM,KAAK6O,eACrCkW,UAAUllB,GAQvBu4H,qBACJv4H,EACAC,EAAiB,MACjBM,EACAC,kDAEA,MAAMC,EAAU,IAAI0H,KAGpB,IAAItE,QAAa1D,KAAKi4H,oBACpBp4H,EAFY,IAIZQ,GACAq0B,YACF50B,EAASA,EAAOiH,cAGI,IAAhBrD,EAAKnD,SACPmD,EAAO,uCACPA,GAAQ,8CAGV,MAAME,EAAM1C,OAAOU,SAASC,cAAc,OAC1C+B,EAAIysB,MAAM2C,SAAW,WACrBpvB,EAAIysB,MAAM08C,IAAM,IAGhB7rE,OAAOU,SAASG,KAAKC,YAAY4B,GACjCA,EAAI4sB,UAAY9sB,QAEV1D,KAAKkxE,QAAQ,GACnB,MAAMrtE,QAAei0H,KAAYl0H,EAAK,CAAEy0H,SAAS,IAAQ3iF,MAAO3xC,IAC9DmH,QAAQC,IAAIpH,KAGd,GAAIF,EAAQ,CACV,IAAIE,EAAS+D,OACb,IACO1H,EAKHJ,KAAKs4H,uBAAuBz0H,EAAQ,eAAsB/D,GAH1DE,KAAKu4H,sBAAsB10H,EAAQ,cAAe/D,GAKpD8D,EAAIwwC,WAAWnyC,YAAY2B,SACpBI,GACPD,EAAS+D,QAEXxH,EAAQ6H,KAAKpE,GAGf,OAAOzD,IAGTs2H,aAAa/2H,EAAeC,EAAmBM,EAAoBC,GACjE,MACMG,EAAY+G,KAAKE,MAAM,GAAKrH,EAAa,KAAO,KAAQ,EAC9DC,EAAIm4H,QAAQ,QAAS,QACPn4H,EAAIo4H,aAAa54H,GAA/B,MAEM+D,EAAavD,EAAIq4H,mBAAmB74H,GAASW,EAAYH,EAAIs2H,SAASgC,YACtE90H,EAAsB0D,KAAKE,MAAO,GAAKrH,EAAa,KAAQ,MAAS,EAC3E,IAEI4D,EAFAD,EAAgB,EAGpB,OAAIH,GAAe9D,GACjBkE,EAAkB,EAClBD,EAAgBwD,KAAKE,MAAQ3H,EAAYD,EAAMU,OAZ3B,GAYsD,MAEtEwD,EAAgBF,IAClBE,EAAgBF,KAGlBG,GAAmBlE,EAAY8D,GAAc,EAC7CG,EAAgBvD,GAEX,CAACuD,EAAeC,GAGzB+yH,gBAAgBl3H,EAAkBC,EAAmBM,EAAoBC,GACvE,MAAMC,EAAe,GAAMiH,KAAKE,MAAM,GAAKrH,EAAa,KAAO,KAAQ,EAEvEC,EAAIm4H,QAAQ,QAAS,QAErB,MAAMh4H,EAAgBH,EAAIq4H,mBAAmB74H,GAAYS,EAAeD,EAAIs2H,SAASgC,YAErF,IAAIj1H,EACJ,OACEA,EADElD,GAAkBV,EACC,GAECA,EAAYU,GAAiB,EAE9CkD,EAGDmzH,SAASh3H,EAAYC,EAAeM,EAAuBC,EAAyBC,GAC1FT,EAAI24H,QAAQ,QAAS,QACrB34H,EAAIikG,YAAY1jG,GAChBP,EAAIyP,KAAKxP,EAAOO,EAAiBC,GAG3B02H,YAAYn3H,EAAYC,EAAkBM,EAA0BC,EAA4BC,GACtGT,EAAI24H,QAAQ,QAAS,QACrB34H,EAAIikG,YAAY1jG,GAChBP,EAAIyP,KAAKxP,EAAUO,EAAoBC,GAQjC+2H,WAAWx3H,EAAYC,GAC7B,MAGMU,EAAeX,EAAI82H,SAAS5yG,SAASg5D,OADtB,EAGrBl9E,EAAI24H,QAAQ,WACZ34H,EAAIikG,YANgB,IAOpBjkG,EAAIyP,KAAKxP,EANiB,GAMWU,GAU/B22H,aACNt3H,EACAC,EACAM,EACAC,EACAC,GAEA,MAAME,EAAYR,KAAK+P,gBAAgB/B,UAIjCjK,EAAelE,EAAI82H,SAAS5yG,SAASg5D,OADtB,GAGrB,IAAI/4E,EAAwB,IACT,IAAf3D,IAEF2D,GADiBxD,EAAUwP,QAAQ,gCACP,KAAOlQ,EAAI2pD,aAE3B,IAAVnpD,KACiB,IAAfD,IACF2D,GAAiB,OAInBA,GAFkBxD,EAAUwP,QAAQ,2BAEP,WAAa4oH,GADzB94H,EAAIurD,eAAesiB,SAASvtE,KAG/CP,EAAI24H,QAAQ,WACZ34H,EAAIikG,YAnBkB,IAoBtBjkG,EAAIyP,KAAKtL,EAnBmB,GAmBiBD,GASjC4zH,UACZ93H,EACAC,EACAM,EACAC,kDAGA,MAAMC,EAAQT,EAAI82H,SAAS5yG,SAAS0zC,MAC9Bj3D,QAAaR,KAAKi4H,oBACtBn4H,EACAQ,EACAD,GACAq0B,YAEF,GAAa,KAATl0B,EACF,aAAMR,KAAK43H,QAAQ/3H,IACZ,EAGT,MAAM6D,EAAMxC,OAAOU,SAASC,cAAc,OAC1C6B,EAAI2sB,MAAM2C,SAAW,WACrBtvB,EAAI2sB,MAAM08C,IAAM,IAGhB7rE,OAAOU,SAASG,KAAKC,YAAY0B,GACjCA,EAAI8sB,UAAYhwB,QAEVR,KAAKkxE,QAAQ,GACnB,MAAMttE,QAAek0H,KAAYp0H,EAAK,CAAE20H,SAAS,IAAQ3iF,MAAO7xC,IAC9DqH,QAAQC,IAAItH,KAGd,GAAID,EAAQ,CACV,MAAMC,EAAuB,IACvBE,EAAY,CAACF,GAAwB,KAAOD,EAAO6zD,OAASp3D,EAAYwD,GACzE,KAAOD,EAAOm5E,QAAU18E,GAC7B,IAAI2D,EACJnE,EAAIg5H,UACJ70H,EAAUJ,EAAOk1H,UAAU,aAC3Bj5H,EAAIk5H,SAAS/0H,EAAS,MAAO,GAAI,GAAID,EAAU,GAAIA,EAAU,IAC7DL,EAAI0wC,WAAWnyC,YAAYyB,SAGvB1D,KAAK43H,QAAQ/3H,KAUJ63H,kBACb73H,EACAC,EACAM,EACAC,EACAC,kDAGA,MAAME,EAAQX,EAAI82H,SAAS5yG,SAAS0zC,MAC9B/zD,QAAa1D,KAAKi4H,oBACtBn4H,EACAU,EACAH,GACAq0B,YAEF,GAAa,KAAThxB,EACF,aAAM1D,KAAK43H,QAAQ/3H,IACZ,EAGT,MAAM+D,EAAM1C,OAAOU,SAASC,cAAc,OAC1C+B,EAAIysB,MAAM2C,SAAW,WACrBpvB,EAAIysB,MAAM08C,IAAM,IAEhB7rE,OAAOU,SAASG,KAAKC,YAAY4B,GACjCA,EAAI4sB,UAAY9sB,QACV1D,KAAKkxE,QAAQ,GACnB,MAAMrtE,QAAei0H,KAAYl0H,EAAK,CAAEy0H,SAAS,IAAQ3iF,MAAO1xC,IAC9DkH,QAAQC,IAAInH,KAEd,IAAID,EACJ,GAAIF,EAAQ,CACV,MAAMG,EAAuB,IACvBW,EAAY,CAACX,GAAwB,KAAOH,EAAO4zD,OAASp3D,EAC/D2D,GAAwB,KAAOH,EAAOk5E,QAAU18E,GAE3B,gBAAnBC,EACHyD,EAAgB,CAAClE,EAAI82H,SAAS5yG,SAASg5D,OAAS38E,EAAQ,GAAKuE,EAAU,GAAIvE,EAAQ,GAClFA,EAAQ,GAAIP,EAAI82H,SAAS5yG,SAAS0zC,MAAQr3D,EAAQ,GAAKuE,EAAU,IACtC,aAAnBrE,EACTyD,EAAgB,CAAC3D,EAAQ,GAAIA,EAAQ,GAAIP,EAAI82H,SAAS5yG,SAASg5D,OAAS38E,EAAQ,GAAKuE,EAAU,GAC/F9E,EAAI82H,SAAS5yG,SAAS0zC,MAAQr3D,EAAQ,GAAKuE,EAAU,IACzB,eAAnBrE,EAETyD,EAAgB,CAAClE,EAAI82H,SAAS5yG,SAASg5D,OAAS38E,EAAQ,GAAKuE,EAAU,GAAK,GAC5E9E,EAAI82H,SAAS5yG,SAAS0zC,MAAQr3D,EAAQ,GAAKuE,EAAU,GAAIvE,EAAQ,GAAK,GAAIA,EAAQ,IACtD,YAAnBE,IACTyD,EAAgB,CAAC3D,EAAQ,GAAIP,EAAI82H,SAAS5yG,SAAS0zC,MAAQr3D,EAAQ,GAAKuE,EAAU,GACjF9E,EAAI82H,SAAS5yG,SAASg5D,OAAS38E,EAAQ,GAAKuE,EAAU,GAAIvE,EAAQ,KAErEJ,KAAKg4H,UAAUn4H,EAAKgE,EAAQE,GAC5BH,EAAIwwC,WAAWnyC,YAAY2B,SACrB5D,KAAK43H,QAAQ/3H,MAUX03H,SACZ13H,EACAC,EACAM,kDAEE,MAAMC,EAAUP,EAAIi9C,GAAG2wB,UAIvB,IAAIltE,EAHWV,EAAIi9C,GAAGuW,UAAUma,gBAAgBptE,GAIhD,MAAMqD,EAAiB5D,EAAIi9C,GAAGi8E,+BAExBp1H,EAAqBF,EAAewwC,qBAAqB,UACzDrwC,EAAwBM,MAAMgL,KAAKvL,GACzC,UAAWI,KAAqBH,EAC9BG,EAAkBooH,aAAa,0BAA2B,cAQvC0L,KAAYp0H,EAAgB,CAC/C8lD,MAAO,EACPuuE,gBAAiB,KACjBkB,YAAY,EACZZ,SAAS,IACR7kF,KAAMxvC,IACPxD,EAAoBwD,IAEtBhE,KAAKg4H,UAAUn4H,EAAKW,EAAmBJ,KAG3C84H,sBAAsBr5H,GACpBG,KAAKm5H,gBAAkBt5H,EAGjBqxE,QAAQrxE,GACd,OAAO,IAAImL,QAASlL,GAAYq3E,WAAWr3E,EAASD,IAG9Cm4H,UACNn4H,EACAC,EACAM,GAEA,IAAIC,EAKJ,GAJIP,IACFO,EAAQP,EAAOg5H,UAAU,mBAGb,IAAVz4H,EAAqB,CACvB,MAAMC,EAAYN,KAAKo5H,qBAAqBv5H,EAAKC,EAAQM,GACzDP,EAAIk5H,SACF14H,EACA,MACAD,EAAQ,GACRA,EAAQ,GACRE,EAAU,GACVA,EAAU,IAEZT,EAAIw5H,KAAKj5H,EAAQ,GAAIA,EAAQ,GAAIE,EAAU,GAAIA,EAAU,KAKrDg3H,OACNz3H,EACAC,EACAM,EACAC,EACAC,GAEA,MAAME,EAAU,IAAIwH,KAEdtE,EAAU5D,EAAIi9C,GAAG2wB,UACjB9pE,EAAS9D,EAAIi9C,GAAGuW,UAAUma,gBAAgB/pE,GAE1CG,EAAc0D,KAAKE,MAAOpH,EAAK,GAAKD,EAAc,MAClD2D,EAAewD,KAAKE,MAAOpH,EAAK,GAAKD,EAAc,MAEzD,IAAI4D,EAEJ,SAAI+4C,GAAGg3B,KAAK,iBAAmBpvE,IAC7B,MAAMm+C,EAAWn+C,EAAMyiB,OAAOkyG,cAAcplF,qBAAqB,UAC3DjtC,EAAcnH,EAAIoI,QAAQE,UAAW46C,IAGzC,GAFAg0B,aAAahzE,GAETg/C,IAAcl7C,OAChB,OAGFb,EAAYyB,cAEZ,IAAIu6C,EAASn7C,OACb,IACE,UAAWu7C,KAAUP,EACE,IAAjBO,EAAOoU,OACTz3D,KAAKg4H,UAAUn4H,EAAKwjD,EAAQ/iD,SAGzB+iD,GACPJ,EAASn7C,QACT9H,KAAK+Q,eAAe1F,MAClBrL,KAAK+P,gBAAgB/B,UAAUgC,QAC7B,0CAEFhQ,KAAK+P,gBAAgB/B,UAAUgC,QAC7B,6CAINhQ,KAAKu5H,UAAUz5H,EAAK4D,EAASE,GAC7BpD,EAAQ2H,KAAK86C,KAKfj/C,EAAU9C,OAAOi2E,WAAW,KAC1BlwE,EAAYyB,cAEZ,IAAIs6C,EAASl7C,OACb,IACE,UAAWm7C,KAAUH,EACE,IAAjBG,EAAOwU,OACTz3D,KAAKg4H,UAAUn4H,EAAKojD,EAAQ3iD,SAGzB2iD,GACPD,EAASl7C,QACT9H,KAAK+Q,eAAe1F,MAClBrL,KAAK+P,gBAAgB/B,UAAUgC,QAC7B,0CAEFhQ,KAAK+P,gBAAgB/B,UAAUgC,QAC7B,6CAINhQ,KAAKu5H,UAAUz5H,EAAK4D,EAASE,GAC7BpD,EAAQ2H,KAAK66C,IACZ,OAGLhjD,KAAKu5H,UAAUz5H,EAAK,CAAC+D,EAAaE,GAAeH,GAE1CpD,EAgBTg5H,iBACE35H,EACAC,EACAM,EAAS,MACTC,GAAa,EACbC,GAAQ,EACRE,GAAS,EACTkD,EAAQ,GACRE,EAAW,GACXC,EAAU,GACVE,GAAY,GAEZ,MAAMC,EAAU,IAAIgE,KAEpBhI,KAAKu2E,WAAav2E,KAAK6J,gBAAgBb,WACvC,MAAMrE,EAAY3E,KAAK+P,gBAAgB/B,UACvC,SAAI+uC,GAAGg3B,KAAK,iBAAmBjxB,IAC7B1iD,EAASA,EAAO2G,cAChB,MAAME,EAAY67C,EAAM17B,OACrBkyG,cACAplF,qBAAqB,UAAU,GAC5B8O,EAAYphD,SAASC,cAAc,UACnCohD,EAAaD,EAAUy2E,WAAW,MAExC,IAAIp2E,EAAkB,EAElBG,EAAqB,GAEzB,MAAME,EAAQz8C,EAAUwwD,MACxB,IAAIxQ,EAAShgD,EAAU81E,OAEvB95B,EAAWwX,KAAO,eAClB,MAAMnT,EAAerE,EAAWy2E,YAAY71H,GAAS4zD,MAErDxQ,EAAmB,KAAVvjD,EAAeujD,EAAS,GAAKA,EAEtCA,EAAsB,KAAbrjD,EAAkBqjD,EAAS,GAAKA,EAEzCA,GAAwB,IAAf5mD,IAAkC,IAAVC,EAAkB2mD,EAAS,GAAKA,EACjE,MAAM6jB,EAAqB7jB,EAAS,GAE9BM,EAAgBhgD,KAAKoyH,KAAKryE,EAAe5D,GAE/CuD,EAAqB,KAAZpjD,EAAiBojD,EAAyB,GAAhBM,EAAqBN,EACxD,IAAIO,EAAmBP,EAAyB,GAAhBM,EAAqB,EA8BrD,GA5BAvE,EAAUyU,MAAQ/T,EAClBV,EAAU+5B,OAAS91B,EAEJ,SAAX7mD,IACF6iD,EAAW22E,UAAY,UACvB32E,EAAW42E,SAAS,EAAG,EAAGn2E,EAAOuD,GACjChE,EAAW22E,UAAY,WAGX,KAAVl2H,IAGFu/C,EAAWwX,KAAO,eAClBpX,EAAkB,GAClBJ,EAAW6X,UAAY,SACvB7X,EAAW62E,SAASp2H,EAAOggD,EAAQ,EAAG,GAAY,GAARA,IAE3B,KAAb9/C,IAGFq/C,EAAWwX,KAAO,eAClBpX,EAAkB,GAClBJ,EAAW6X,UAAY,SACvB7X,EAAW62E,SAASl2H,EAAU8/C,EAAQ,EAAG,GAAY,GAARA,IAG/CT,EAAWwX,KAAO,gBAEC,IAAfp6D,EAAsB,CACxB,MAAM+rD,EAAWznD,EAAUqL,QAAQ,gCACnCizC,EAAW6X,UAAY,QACvB7X,EAAW62E,SACT1tE,EAAW,KAAOvsD,EAAI4pD,WACtBjG,EACAsnB,GAEFtnB,GAAsB,IAIxB,IAAc,IAAVljD,EAAiB,CACnB,MAAM8rD,EAAYznD,EAAUqL,QAAQ,2BAC9Bq8C,EAAWxsD,EAAIwrD,eAAesiB,SAAS7tE,GAC7CmjD,EAAW6X,UAAY,QACvB7X,EAAW62E,SACT1tE,EAAY,WAAawsE,GAAYvsE,GACrC7I,EACAsnB,GAIJ,GAAgB,KAAZjnE,EAGF,GAFAo/C,EAAW6X,UAAY,SAED,IAAlBvT,EACFtE,EAAW62E,SAASj2H,EAAS6/C,EAAQ,EAAG8D,OACnC,CAEL,MACM6E,EAAqB9kD,KAAK4hB,MADVtlB,EAAQtD,OACwBgnD,GACtD,IAEIiF,EAFAF,EAAqB,GACrBC,EAAuB,EAG3B,QAASE,EAAI,EAAGA,EAAIlF,EAAekF,IAE7BlF,EAAgB,EAAIkF,GAEtBH,EAAqBzoD,EAAQ6I,OAC3B6/C,EACAF,GAGFG,EAAoBF,EAAmBw4B,YAAY,KACnD7hC,EAAW62E,SACTxtE,EAAmB5/C,OAAO,EAAG8/C,GAC7B9I,EAAQ,EACR8D,GAEF+E,GAAwBC,EAExBhF,GAAoB,IAGpBvE,EAAW62E,SACTj2H,EAAQ6I,OAAO6/C,GACf7I,EAAQ,EACR8D,GAOVvE,EAAW82E,UAAU9yH,EAAW,EAAGo8C,GAEnC,IAAI8D,EAASr/C,OACTs/C,EAAkB,OAAShnD,EACF,SAAzBA,EAAO2G,gBACTqgD,EAAkB,MAAQvnD,EAAI4pD,WAAWtjD,QAAQ,IAAK,KAAO,IAAM/F,GAGrE,IAEO2D,GAEE3D,EAAW2G,cAEhB/G,KAAKs4H,uBAAuBt1E,EAAWoE,IAHvCpnD,KAAKu4H,sBAAsBv1E,EAAWoE,EAAiBhnD,SAQlDgsD,GACPjF,EAASr/C,QAKX,GAFA9D,EAAQmE,KAAKg/C,GAEgB,SAAzB/mD,EAAO2G,cAA0B,CACnC,MAAMqlD,EAAqBhF,EAAgBx/C,UAAU,EAAGw/C,EAAgBrgD,cAAc7G,QAAQ,UAAY,OACpGmsD,EAAarsD,KAAKg6H,wBAAwBn6H,GAC1CysD,EAAO,IAAIh1C,KAAK,CAAC+0C,GAAa,CAClCvnD,KAAM,6BAEHf,EAMH/D,KAAKi6H,aAAa7tE,EAAmBE,OAJrC4tE,WAAO5tE,EAAMF,GACbpsD,KAAKm6H,yBAOXt6H,EAAIk9C,GAAGq9E,aAEAp2H,EAGDu1H,UAAU15H,EAAKC,EAAMM,GAC3BP,EAAIk9C,GAAGs9E,aACPx6H,EAAIk9C,GAAGq9E,aAOOxC,QAAQ/3H,wDAChBA,EAAIy6H,KAAK,UAAW,CAAEC,eAAe,MASrCnB,qBAAqBv5H,EAAKC,EAAQM,GAExC,MAAMC,EACJR,EAAI82H,SAAS5yG,SAASy2G,aAAep6H,EAAQ,GAAKA,EAAQ,IACtDE,EACJT,EAAI82H,SAAS5yG,SAAS6uC,YAAcxyD,EAAQ,GAAKA,EAAQ,IACrDI,EAAYV,EAAOi9E,OACnBr5E,EAAW5D,EAAO23D,MAClB7zD,EAAcpD,EAAYH,EAC1BwD,EAAaH,EAAWpD,EACxByD,EAAWH,EAAcC,EAAaD,EAAcC,EAI1D,MAAO,CAFUE,EAAW,EAAIL,EAAWK,EAAWL,EADrCK,EAAW,EAAIvD,EAAYuD,EAAWvD,GAUjDw5H,wBAAwBn6H,GAC9B,MAAMC,EAAoBD,EAAIwrD,eAAe0F,gBACvC3wD,EAAgBP,EAAIwrD,eAAewK,YACzC,MAAO,CACL/1D,EACA,EACA,GACCA,EACDM,EAAc,GAAKN,EAAoB,GACvCM,EAAc,GAAKN,EAAoB,IACvCgB,KAAK,MASDy3H,sBAAsB14H,EAAQC,EAAaM,GACjD,MAAMC,EAAa,SAAWD,EACxBE,EAAON,KAEb,IACEH,EAAOi5H,YAEP33H,UAAcs5H,YACZt5H,UAAUs5H,WAAW56H,EAAO66H,WAAY56H,GACxCE,KAAKm6H,sBAELt6H,EAAO86H,OAAQn6H,KAEb,aAAOA,EAAMV,GACbQ,EAAK65H,sBACJ95H,SAEEG,GACPR,KAAK+Q,eAAe1F,MAClBrL,KAAK+P,gBAAgB/B,UAAUgC,QAC7B,0CAEFhQ,KAAK+P,gBAAgB/B,UAAUgC,QAC7B,8CAWAsoH,uBAAuBz4H,EAAQC,GACrC,MACMO,EAAOL,OAEVA,KAAK2G,eAAe,iBACG,IAAjB3G,KAAK46H,WAEZ56H,KAAK46H,QAAU,IAAIC,IAGrB,IACEh7H,EAAOi5H,YACH33H,UAAUs5H,WACZz6H,KAAKi6H,aAAan6H,EAAMD,EAAO66H,YAE/B76H,EAAO86H,OAAQr6H,IACbD,EAAK45H,aAAan6H,EAAMQ,IAfX,cAgBZ,MAEEA,GACPN,KAAK+Q,eAAe1F,MAClBrL,KAAK+P,gBAAgB/B,UAAUgC,QAC7B,0CAEFhQ,KAAK+P,gBAAgB/B,UAAUgC,QAC7B,8CAWAiqH,aAAap6H,EAAMC,GAEzBE,KAAK46H,QAAQE,KAAKj7H,EAAMC,GACxBE,KAAKm5H,kBAGwB,IAAzBn5H,KAAKm5H,kBAEPn5H,KAAK+6H,aAEL/6H,KAAK6J,gBAAgBT,WAAWpJ,KAAKu2E,aAIjC4jD,qBACNn6H,KAAKm5H,kBAGwB,IAAzBn5H,KAAKm5H,iBAEPn5H,KAAK6J,gBAAgBT,WAAWpJ,KAAKu2E,YAQjCwkD,aACN,MAAMl7H,EAAOG,KACbA,KAAK46H,QAAQI,cAAc,CAAEl2H,KAAM,SAAU0uC,KAAM1zC,KAEjD,aAAOA,EAAM,kBACND,EAAK+6H,wDAj9BL75H,GAAYrB,8EAAZqB,EAAYsI,QAAZtI,EAAY,qBAFX,SAEDA,YEvBAk6H,GAAoB5P,EAAQ,CAAC,MAAO,UAIpC6P,GAAmB7P,EAAQ,CACtC,KACA,KACA,KACA,KACA,KACA,KACA,SACA,UAIW8P,GAAmB9P,EAAQ,CAAC,YAAa,aAGzC+P,GAAkB/P,EAAQ,CAAC,KAAM,KAAM,MAAO,QAG9CgQ,GAAuBhQ,EAAQ,CAC1C,MACA,MACA,OACA,MACA,SAIWiQ,GAAsBjQ,EAAQ,CACzC,OACA,WACA,UACA,aACA,cACA,sCCgBM3rH,yBACIA,8BACJA,kCAFuEA,qBACnEA,2GAWJA,yBACIA,SACJA,kCAFmEA,qBAC/DA,2DAWJA,yBACEA,8BACFA,kCAFiEA,qBAC/DA,wGAWFA,yBACEA,SACFA,kCAFiEA,qBAC/DA,2DAWFA,yBACEA,SACFA,kCAF+DA,qBAC7DA,kEAWFA,yBACEA,8BACFA,kCAFiEA,qBAC/DA,qEC3FG67H,iBAiLXxzH,YAAoBlI,sBA/KbG,mBAAgBi7H,GAChBj7H,kBAAek7H,GACfl7H,kBAAem7H,GACfn7H,iBAAco7H,GACdp7H,kBAAeq7H,GACfr7H,qBAAkBs7H,GAClBt7H,qBAAiB,EAuKdA,YAAqC,IAAIN,MAGjDM,KAAKu3B,KAAOv3B,KAAKooB,YAAYwP,MAAM,CACjC3oB,MAAO,CAAC,GAAI,IACZ6nH,SAAU,CAAC,GAAI,IACfM,QAAS,CAAC,GAAI,IACdv1E,aAAc,CAAC,GAAI,CAACx7B,iBACpBmwG,YAAa,CAAC,GAAI,CAACnwG,iBACnBm1G,YAAa,CAAE,GAAI,CAACn1G,iBACpB+oD,WAAY,CAAC,GAAI,CAAC/oD,iBAClBowG,YAAa,CAAC,GAAI,CAACpwG,iBACnBoxG,eAAgB,CAAC,GAAI,CAACpxG,iBACtB4wG,gBAAgB,EAChBC,WAAW,EACXjtC,YAAY,EACZwxC,UAAW,CAAC,CAAC5rG,OAAQ7vB,KAAK07H,qCAjL5B,OAAO17H,KAAK27H,iBAAiB75H,sBAEfjC,GACdG,KAAK27H,iBAAiBh0G,SAAS9nB,GAASw7H,GAAqBO,KAAM,CACjEC,UAAU,uBAMZ,OAAO77H,KAAK87H,kBAAkBh6H,uBAEfjC,GACfG,KAAK87H,kBAAkBn0G,SAAS9nB,GAASo7H,GAAkBc,IAAK,CAC9DF,UAAU,sBAMZ,OAAO77H,KAAKg8H,iBAAiBl6H,sBAEfjC,GACdG,KAAKg8H,iBAAiBr0G,SAAS9nB,GAASq7H,GAAiBe,OAAQ,CAC/DJ,UAAU,sBAMZ,OAAO77H,KAAKk8H,iBAAiBp6H,sBAEfjC,GACdG,KAAKk8H,iBAAiBv0G,SAAS9nB,GAASs7H,GAAiBgB,UAAW,CAClEN,UAAU,qBAMZ,OAAO77H,KAAKo8H,gBAAgBt6H,qBAEfjC,GACbG,KAAKo8H,gBAAgBz0G,SAAS9nB,GAASu7H,GAAgB,IAAO,CAC5DS,UAAU,yBAMZ,OAAO77H,KAAKq8H,oBAAoBv6H,yBAEfjC,GACjBG,KAAKq8H,oBAAoB10G,SAAS9nB,GAASy7H,GAAoBgB,KAAM,CACnET,UAAU,gBAMZ,OAAO77H,KAAKu8H,WAAWz6H,gBAEfjC,GACRG,KAAKu8H,WAAW50G,SAAS9nB,EAAO,CAAEg8H,UAAU,mBAI5C,OAAO77H,KAAKw8H,cAAc16H,mBAEfjC,GACXG,KAAKw8H,cAAc70G,SAAS9nB,EAAO,CAAEg8H,UAAU,kBAI/C,OAAO77H,KAAKy8H,aAAa36H,kBAEfjC,GACVG,KAAKy8H,aAAa90G,SAAS9nB,EAAO,CAAEg8H,UAAU,yBAI9C,OAAO77H,KAAK08H,oBAAoB56H,yBAEfjC,GACjBG,KAAK08H,oBAAoB/0G,SAAS9nB,EAAO,CAAEg8H,UAAU,oBAIrD,OAAO77H,KAAK28H,eAAe76H,oBAEfjC,GACZG,KAAK28H,eAAeh1G,SAAS9nB,EAAO,CAAEg8H,UAAU,qBAIhD,OAAO77H,KAAK48H,gBAAgB96H,qBAEfjC,GACbG,KAAK48H,gBAAgBj1G,SAAS9nB,EAAO,CAAEg8H,UAAU,oBAKjD,OAAO77H,KAAK68H,eAAe/6H,oBAEfjC,GACZG,KAAK68H,eAAel1G,SAAS9nB,EAAO,CAAEg8H,UAAU,4BAIhD,OAAQ77H,KAAKu3B,KAAK7P,SAAiBm6B,oCAInC,OAAQ7hD,KAAKu3B,KAAK7P,SAAiB8uG,mCAInC,OAAQx2H,KAAKu3B,KAAK7P,SAAiB8zG,mCAInC,OAAQx7H,KAAKu3B,KAAK7P,SAAiB+uG,kCAInC,OAAQz2H,KAAKu3B,KAAK7P,SAAiB0nD,8BAInC,OAAQpvE,KAAKu3B,KAAK7P,SAAiB0vG,kCAInC,OAAQp3H,KAAKu3B,KAAK7P,SAAiBuvG,oCAInC,OAAQj3H,KAAKu3B,KAAK7P,SAAiBwvG,gCAInC,OAAQl3H,KAAKu3B,KAAK7P,SAAiBuiE,gCAInC,OAAQjqF,KAAKu3B,KAAK7P,SAAiB+zG,2BAInC,OAAQz7H,KAAKu3B,KAAK7P,SAAiBzY,0BAInC,OAAQjP,KAAKu3B,KAAK7P,SAAiBovG,mCAInC,OAAQ92H,KAAKu3B,KAAK7P,SAAiB+vG,eAuBrCj3G,WACExgB,KAAK68H,eAAel1G,UAAS,GAG/Bm1G,iBAAiBj9H,EAAoBC,GACnCD,EAAK67H,eAAiB17H,KAAK07H,eACvB57H,GACFE,KAAK6sH,OAAO30G,KAAKrY,GAIrBk9H,sBAEI/8H,KAAK07H,eAD8B,UAAjC17H,KAAK87H,kBAAkBh6H,oDA/MlBf,GAAkBrB,uCAAlBqB,EAAkBugB,o8CDzB/B5hB,kBACEA,iBACEA,0BACEA,wCAIFA,QACFA,QACAA,iBACEA,0BACEA,wCAIFA,QACFA,QACAA,iBACEA,2BACEA,0CAIFA,QACFA,QAEAA,kBACEA,kBACEA,+BAIEA,gCACFA,QACAA,+BAIEA,gCACFA,QACAA,+BAKEA,gCACFA,QACFA,QACFA,QAEAA,kBACEA,2BACEA,+CAGEA,sDAGFA,QACFA,QACFA,QAEAA,kBACEA,2BACEA,0BAAYA,0CAAmBI,gDAG7BJ,sDAGFA,QACFA,QACFA,QAEAA,kBACEA,2BACEA,gDAGEA,sDAGFA,QACFA,QACFA,QAEAA,kBACEA,2BACEA,gDAGEA,sDAGFA,QACFA,QACFA,QAEAA,mBACEA,2BACEA,gDAGEA,sDAGFA,QACFA,QACFA,QAEAA,kBACEA,2BACEA,gDAGEA,sDAGFA,QACFA,QACFA,QAEAA,mBACEA,sBAIEA,gCAASI,kEACTJ,gCACFA,QACFA,QAEFA,eApIuBA,0BAMfA,oEAQAA,uEAQAA,uEASAA,yCACAA,wEAKAA,yCACAA,mEAMAA,qDADAA,gCAEAA,mEASAA,8EACuCA,yDAWvCA,4EACqCA,uDAOVA,0DAI3BA,2EACoCA,sDAOTA,0DAI3BA,2EACoCA,sDAWpCA,0EACmCA,qDAORA,0DAI3BA,2EACoCA,sDAWtCA,mEAEAA,yyBCvGOqB,MCHAi8H,iBAkEXj1H,YAAoBlI,uBAjEbG,eAAY,IAAI+I,KAAgB,aAIrC,OAAO/I,KAAKg7E,aAENn7E,GACNG,KAAKg7E,KAAOn7E,qBAMZ,OAAOG,KAAKi9H,+BAEGp9H,GACfG,KAAKi9H,cAAgBp9H,oBAMrB,OAAOG,KAAKk9H,6BAEEr9H,GACdG,KAAKk9H,aAAer9H,oBAMpB,OAAOG,KAAKm9H,6BAEEt9H,GACdG,KAAKm9H,aAAet9H,oBAMpB,OAAOG,KAAKo9H,6BAEEv9H,GACdG,KAAKo9H,aAAev9H,uBAMpB,OAAOG,KAAKq9H,mCAEKx9H,GACjBG,KAAKq9H,gBAAkBx9H,mBAMvB,OAAOG,KAAKs9H,2BAECz9H,GACbG,KAAKs9H,YAAcz9H,EAMrBi9H,iBAAiBj9H,GAIf,GAFAG,KAAKmsB,UAAUhkB,MAAK,IAEQ,IAAxBtI,EAAK67H,eACP17H,KAAKu9H,aACFhH,MAAMv2H,KAAK0F,IAAK7F,GAChB0I,MAAK,QAAK,IACVH,UAAU,KACTpI,KAAKmsB,UAAUhkB,MAAK,SAEnB,CACL,IAAIrI,EAAkB,EAElBD,EAAKoqF,YACPnqF,IAEqC,SAAnCD,EAAK27H,YAAYz0H,eACnBjH,IAGFE,KAAKu9H,aAAarE,sBAAsBp5H,GAExC,MAAMM,GAAcP,EAAKuvE,WAEzB,IAAI/uE,EAAaR,EAAKoqF,WAAa,EAAI,EACvCjqF,KAAKu9H,aACF/D,iBACCx5H,KAAK0F,IACLtF,EACAP,EAAK27H,YACL37H,EAAKo3H,eACLp3H,EAAKq3H,UACLr3H,EAAKoqF,WACLpqF,EAAKoP,MACLpP,EAAKi3H,SACLj3H,EAAKu3H,QACLv3H,EAAK47H,WAENlzH,MAAK,QAAK,IACVH,UAAU,KACT/H,IACKA,GACHL,KAAKmsB,UAAUhkB,MAAK,KAGtBtI,EAAKoqF,YACPjqF,KAAKu9H,aACFnF,qBACCp4H,KAAK0F,IACL7F,EAAK27H,YACL37H,EAAK47H,WACJr7H,GAEFozC,KAAK,KACJnzC,IACKA,GACHL,KAAKmsB,UAAUhkB,MAAK,oDA7HrBpH,GAAcrB,oCAAdqB,EAAcugB,oXCtB3B5hB,4BAQEA,kCAAUI,wBACZJ,cAREA,qCAA6B,4BAA7BA,CAA6B,4BAA7BA,CAA6B,4BAA7BA,CAA6B,0BAA7BA,CAA6B,kCAA7BA,CAA6B,4DDqBlBqB,MEaAy8H,2HAjBF,CACPxwH,KACAqZ,MACAA,MACA5mB,KACAuvB,KACAoK,MACAwxF,MACAr2F,KACA1I,MACAqqE,MACAvpF,GACAi0B,OAKS7/B,kBCzB4BA,GACvC,OAAO,IAAI+mF,GACT/mF,EAAO2J,UAAU,iBAAiBo9E,GAAkBljF,OAAS,QCGpD64H,iBAAc1zH,iBAEvB,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,CDCR,CACLC,QAASm9E,GACT17E,WAAY+xH,GACZrzH,OAAO,EACPwB,KAAM,CAACpB,oDCTE1J,6DAFA,CAACuhF,IAAa/yD,SAHhB,CAACviB,KAAcL,GAAmBI,OAKhChM,yBCZXgH,YAAmBzG,+BAG0BP,GAC7C,OAAO,IAAI48H,GAAwB58H,OCPzB68H,SAAZ,OAAY78H,UAAgB,KAC1BA,uBACAA,mBAFU68H,GAAZ,IAAY78H,MAIA88H,SAAZ,OAAY98H,UAAoB,KAC9By7F,cACAz7F,cAFU88H,GAAZ,IAAY98H,MAKA+8H,SAAZ,OAAY/8H,UAAY,KACtBg9H,cACAh9H,cAFU+8H,GAAZ,IAAY/8H,MAKAi9H,SAAZ,OAAYj9H,UAAa,KACvBk9H,YACAl9H,gBACAA,kBAHUi9H,GAAZ,IAAYj9H,MAMAm9H,SAAZ,OAAYn9H,UAA6B,KACvCo9H,cACAp9H,8BACAA,YAHUm9H,GAAZ,IAAYn9H,kBCQuBA,EAAwBO,EAA4B,MAAOzB,EAAQ,YACpGkB,EAAWkc,KAAKhC,KAAK,CACnB2B,YACAD,cAAgB7c,GAAiBA,EAAOD,iBAIJkB,EAAeO,GACrD,IAAIzB,EAAmBq+H,GAA8BE,aACrD,OAAc,IAAVr9H,EACFlB,EAAmBq+H,GAA8BC,MACxCp9H,IAAUO,EAAc,IACjCzB,EAAmBq+H,GAA8BG,KAE5Cx+H,cAoBsBkB,GAE7B,MAAMO,EAAK2H,IACLpJ,EAAQkB,EAAW0Z,MACzB,IAAI3a,EAEFA,EADuB,IAArBiB,EAAW+F,MACD,CAAC,GAEDjH,EAAM6F,IAAIhC,GAAQA,EAAKsvB,UAErC,MAAM5yB,EAAsBmH,KAAKyb,OAAOljB,GAClCO,EAAyBD,EACzBE,EAAuBF,EAAc,EAErCI,EAAeO,EAAW0Z,MAAMI,KAAKnX,GAAQA,EAAKsvB,WAAa5yB,GACrE,OAAII,IACFA,EAAawyB,SAAW1yB,EACxBE,EAAa89H,iBAAmBC,GAAwBj+H,EAAcS,EAAW+F,MAAQ,IAG3F/F,EAAW0c,OAAO,CAAE7Y,KAAIouB,SAAU3yB,EAAgBi+H,iBAAkBC,GAAwBl+H,EAAgBU,EAAW+F,MAAQ,KAE/H03H,GAAmBz9H,GACZA,EAAW0I,IAAInI,eActBP,EACAO,GAEA,MAAMzB,EAAc,CAClB,IAAI8iH,MAAc,CAChB19D,SAAUlkD,EAAQgxD,cAClBjkB,MAAO,IAAI60E,KAAe,CACxB50D,OAAQ,EACRyN,OAAQ,IAAImnD,KAAe,CAAElyF,MAAO,UAAWgnC,MAAO,SAKtD33D,EAAYuqE,GAAyB,CACzC/6D,KAAMvO,EAAQ0I,IAAI,YAClBghD,QAAS1pD,EAAQ0I,IAAI,eACrBqgE,YAAa/oE,EAAQ0I,IAAI,aACzBsgE,mBAAoB,CAAC,IAAK,IAAK,OAG3B3pE,EAAa,CACjB,IAAIuiH,MAAc,CAChBnnD,OAAQ,IAAImnD,KAAe,CAAElyF,MAAO,uBAAuB1vB,EAAQ0I,IAAI,UAAY,IAAO,KAAMguD,MAAO,OAEzG,IAAIkrD,MAAc,CAChBnnD,OAAQ,IAAImnD,KAAe,CAAElyF,MAAO,sBAAsB1vB,EAAQ0I,IAAI,UAAY,IAAO,KAAMguD,MAAO,OAI1G,OAAI12D,EAAQ0I,IAAI,UAAYu0H,GAAcC,KACjCn+H,EAEmB,WAAxBiB,EAAQ0I,IAAI,QACP5J,EAELkB,EAAQ0I,IAAI,UAAYu0H,GAAcxhC,MACjCp8F,OADT,cAoM6BW,GAC7B,GAAiB,IAAbA,EAGJ,OAAIA,GAAY,IACP4tD,kBAA4BpnD,KAAKE,MAAM1G,GAAY,IAAM,GAAK,MAEnEA,GAAY,KAGZA,GAAY,IACP4tD,kBAA4BpnD,KAAKE,MAAM1G,GAAY,IAAM,GAAI,GAAK,MAEpE4tD,kBAA4B5tD,EAAU,GAAK,iBAGrBA,GAC7B,GAAIA,GAAY,KAAM,CACpB,MAAMO,EAAOiG,KAAK4hB,MAAMpoB,EAAW,MAC7BlB,EAAS0H,KAAKE,MAAiC,IAA1B1G,EAAW,KAAOO,IAC7C,OAAe,KAAXzB,EACKyB,EAAO,EAAI,KAEbA,EAAO,MAAQzB,EAAS,OAGjC,OAAIkB,GAAY,GACPwG,KAAKE,MAAM1G,EAAW,IAAM,OAE9BA,EAAW,iBAIlBA,EACAO,EACAzB,EACAC,EACAM,EACAC,EACAC,EACAE,GAAW,GAEX,MAAMkD,EAAYpD,EAAgB0N,UAClC,IAAIpK,EACAC,EAAQ,UACRE,EAAW,aACf,MAAMC,WAgJyBjD,EAAiBO,GAChD,MAAMzB,EAAYyB,EAAgB0M,UAClC,OAAIjN,GAAW,KAAOA,EAAU,GACvBlB,EAAUmQ,QAAQ,4BAChBjP,EAAU,GACZlB,EAAUmQ,QAAQ,6BAChBjP,EAAU,IACZlB,EAAUmQ,QAAQ,4BAChBjP,EAAU,IACZlB,EAAUmQ,QAAQ,6BAChBjP,EAAU,IACZlB,EAAUmQ,QAAQ,4BAChBjP,EAAU,IACZlB,EAAUmQ,QAAQ,6BAChBjP,EAAU,IACZlB,EAAUmQ,QAAQ,4BAChBjP,EAAU,IACZlB,EAAUmQ,QAAQ,kCAEzB,EAnKIhM,CAAuClE,EAAWQ,GAClDqE,WAwH0B5D,EAAUO,GAC1C,MAAMzB,EAAYyB,EAAgB0M,UAClC,MAAiB,UAAbjN,EACKlB,EAAUmQ,QAAQ,4BACH,gBAAbjP,EACFlB,EAAUmQ,QAAQ,kCACH,UAAbjP,EACFlB,EAAUmQ,QAAQ,4BACH,iBAAbjP,EACFlB,EAAUmQ,QAAQ,mCACH,eAAbjP,EACFO,EAAgB0M,UAAUgC,QAAQ,iCACnB,SAAbjP,EACFO,EAAgB0M,UAAUgC,QAAQ,2BACnB,gBAAbjP,EACFO,EAAgB0M,UAAUgC,QAAQ,kCACnB,aAAbjP,EACFO,EAAgB0M,UAAUgC,QAAQ,+BAElCjP,EA3IH4D,CAAuCrD,EAAUhB,GAGvD,IAAI2G,GAFwB,aAAb3F,EAA0B,GAAKoC,EAAUsM,QAAQ,uCAE7BrL,EAgCnC,IA7BY,MAARrD,OAAQ,EAARA,EAAUkS,OAAO,YAAa,IAChCvM,EAAsBtC,GAGP,UAAbrD,GACFuC,EAAQ,UACRE,EAAW,aACW,gBAAjBzC,GAGiB,UAAbA,GAFTuC,EAAQ,2BACRE,EAAW,gBAIW,iBAAbzC,GACTuC,EAAQ,UACRE,EAAW,cACW,aAAjBzC,EACLuC,EAAQ,UACc,gBAAjBvC,GACLuC,EAAQ,UACRE,EAAW,eACW,SAAbzC,GAGa,eAAbA,KACTuC,EAAQ,0BACRE,EAAW,gBAGA,SAAThD,EAEA6C,EADe,aAAbtC,EACUoC,EAAUsM,QAAQ,mCAAoC,CAAE6D,UAC9C,UAAjBvS,EACOoC,EAAUsM,QAAQ,gCAAiC,CAAE6D,UAErDnQ,EAAUsM,QAAQ,+BAAgC,CAAE6D,QAAO4qH,sBAAqBC,+BAE5E,aAAT39H,EACT6C,EAAYF,EAAUsM,QAAQ,8BAA+B,CAAE6D,QAAO8qH,wBACtE96H,EAAQ,UACRE,EAAW,WACO,WAAThD,EACT6C,EAAYF,EAAUsM,QAAQ,4BAA6B,CAAE6D,QAAO8qH,wBACpE96H,EAAQ,UACRE,EAAW,WACO,WAAThD,EACLP,GAEFyG,EAAsBtC,EAA2BsC,EAAL,GAC5CrD,EAAYF,EAAUsM,QAAQ,qCAAsC,CAAE4uH,KAFzDj6H,EAA2B,KAAL,GAEyC85H,0BAE5E76H,EAAYF,EAAUsM,QAAQ,yCAA0C,CAAE6D,UAC1EhQ,EAAQ,aACRE,EAAW,YAEK,UAAThD,EACT6C,EAAYF,EAAUsM,QAAQ,2BAA4B,CAAE6D,UAC5DhQ,EAAQ,UACRE,EAAW,qBACO,YAAThD,EACT6C,EAAYF,EAAUsM,QAAQ,6BAA8B,CAAEyuH,gCAC5C,aAAT19H,EACT6C,EAAYF,EAAUsM,QAAQ,8BAA+B,CAAEyuH,gCAC7C,SAAT19H,EAEP6C,EADEtC,EAASkS,OAAO,SAAW,EACjB9P,EAAUsM,QAAQ,+BAAgC,CAAE6D,UACvDvS,EAASkS,OAAO,UAAY,EACzB9P,EAAUsM,QAAQ,gCAAiC,CAAE6D,UAErDnQ,EAAUsM,QAAQ,+BAAgC,CAAE6D,kBAEhD,gBAAT9S,EACT6C,EAAYF,EAAUsM,QAAQ,iCAAkC,CAAE0uH,qBAAoB7qH,kBACpE,aAAT9S,EACT6C,EAAYF,EAAUsM,QAAQ,uCACZ,aAATjP,GAAoC,UAAbO,EAChCsC,EAAYF,EAAUsM,QAAQ,uCAAwC,CAAE6D,UACxEhQ,EAAQ,UACRE,EAAW,qBACO,eAAThD,EAAuB,CAChC,MAAMiiD,EACJt/C,EAAUsM,QADe,IAAT3P,EACE,qCACA,8CACpBuD,EAAYF,EAAUsM,QAAQ,gCAAiC,CAAE6uH,OAAMC,YAAWjrH,UAClFhQ,EAAQ,cACRE,EAAW,OACO,WAAThD,GACT6C,EAAYF,EAAUsM,QAAQ,6BAC9BnM,EAAQ,cACRE,EAAW,IACO,oBAAThD,GACT6C,EAAYF,EAAUsM,QAAQ,sCAC9BnM,EAAQ,cACRE,EAAW,IACO,oBAAThD,GACT6C,EAAYF,EAAUsM,QAAQ,qCAAsC,CAAE6D,UACtEhQ,EAAQ,UACRE,EAAW,cAEXH,EADkB,iBAAb7C,EACO2C,EAAUsM,QAAQ,mCACR,UAAb1O,EACGoC,EAAUsM,QAAQ,+BAAgC,CAAE2uH,sBAAqB9qH,UAEzEnQ,EAAUsM,QAAQ,8BAGhC,SAAQxP,EAAW,eAAiBqD,EACpCE,EAAWvD,EAAW,GAAKuD,EAC3BF,EAAyB,IAAjBzD,EAAqB,UAAYyD,EACzCE,EAA4B,IAAjB3D,EAAqB,GAAK2D,EAE9B,CAAEg7H,YAAan7H,EAAWkqC,QAAOkxF,qDCxdlCt/H,qBAK8DA,+GAC1DA,uBACJA,aAHIA,4FAOFA,yBAEEA,SACFA,kCAHkDA,iBAAgB,qCAEhEA,0EAHFA,2BACAA,gCAIAA,kCAL0DA,8BAA6B,kCACxDA,8EAkBnCA,qBAC8EA,iHAC5EA,uBACFA,aAFEA,0FAGFA,0CAEEA,uBACFA,cAF4BA,6FAX9BA,kBACEA,0CAEEA,uBACFA,QAEAA,6CAIAA,6CAIFA,+BAZIA,0EAIOA,wDAIAA,mGAtDbA,iBACAA,yFAAgC,+DAAhCA,CAAgC,iFAAhCA,CAAgC,+DAAhCA,CAAgC,mEAIA,GAJhCA,CAAgC,iEAKF,IAE5BA,iBACEA,0BACEA,mBAMIA,qFAA4B,8DAA5BA,CAA4B,gFAA5BA,CAA4B,mCAGXU,qBATrBV,QAWAA,2BASAA,gCAAwEA,mGACtEA,iCAMFA,QACFA,QACFA,QAKAA,wBAeFA,yDAnDOA,0CAEMA,0BACHA,yCAAoC,oBAApCA,CAAoC,iBAApCA,CAAoC,qBAYnCA,2FAOaA,8CACiBA,4CAaHA,yFCtB3Bu/H,iBAeXl3H,YAAoBlI,0BAbHG,iBAAc,CAAC,UAAW,QAAS,OAC5CA,yBAAsB,GAEvBA,oBAAyB,EAIvBA,0BAA+B,EAE/BA,cAAmB,IACnBA,YAAiB,EAEhBA,uBAA2C,IAAIN,OAAsB,GAG/EyY,cACEnY,KAAKk/H,yBAEPC,YAAYt/H,GACVG,KAAKo/H,cAAgBv/H,EAEvBw/H,cACEr/H,KAAKo/H,mBAAgB,EAGvBE,cAAcz/H,GACZ,OAAIA,aAAkB+F,QACP,MAAN/F,OAAM,EAANA,EAAQgZ,MAAOhZ,EAAOgZ,KAAK5J,MAAQ,GAErCpP,EAGT0/H,eAAe1/H,EAAuDC,GACpE,MAAMM,EAAkBP,EAAM+nB,OAAO9lB,MACrC,GAAI1B,EAAQ,CACV,IAAIC,EACJ,MAAMC,EAAOF,EAAO6kD,SACpB,GAAkB,UAAd3kD,EAAKwE,KACPzE,EAAYC,EAAKijF,gBACZ,CACL,MAAM/iF,GAAQ,QAAeJ,EAAO6kD,UACpC5kD,EAAY,CACVG,EAAMykD,SAASs+B,YAAY,GAC3B/iF,EAAMykD,SAASs+B,YAAY,IAG3BljF,IACFP,EAAKyjF,YAAcljF,EACnBP,EAAKwP,KAAOlP,EAAOyY,KAAK5J,MACxBjP,KAAKw/H,WAAW9lH,OAAO5Z,KAK7B2/H,YAAY5/H,EAAsBC,GAChCE,KAAKk/H,yBACL,MAAM9+H,EAAQP,EAAMunB,OAA4BtlB,MAC5B,IAAhB1B,EAAKG,OACPP,KAAK0/H,UAAU5/H,GACNE,KAAK2/H,aAAav/H,KAC3BN,EAAKwP,KAAOlP,EACZJ,KAAKw/H,WAAW9lH,OAAO5Z,IAI3B6/H,aAAa9/H,GACX,SACEG,KAAK4/H,WAAW//H,MACfA,EAAKU,QAAUP,KAAKO,QAA0B,IAAhBV,EAAKU,SAOhCq/H,WAAW//H,GACjB,YAAyD,IAAlDG,KAAK6/H,YAAYhlH,KAAK/a,GAASA,IAAUD,GAGlDigI,WAAWjgI,GACT,OAAKG,KAAKo/H,eAECv/H,EAAK+E,KAAO5E,KAAKo/H,cAAcx6H,GACjC,6BAFA,sBAQXm7H,eAAelgI,GACb,IAAIC,EAAQ,GACZ,OAAID,EAAKy+H,kBACHz+H,EAAKy+H,mBAAqBJ,GAA8BE,eAC1Dt+H,EAAQ,KAAOD,EAAKmzB,UAEfhzB,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,0BAA4BnQ,EAAKy+H,kBAAoBx+H,GAE5F,GAIXkgI,WAAWngI,aFtCuBkB,EAAwBO,GAC1DP,EAAW4I,OAAOrI,YA5CiBP,GAEnC,MAAMO,EAAyB,IAAIP,EAAW0Z,OAC9CnZ,EAAuB2Z,KAAK,CAACpb,EAAGC,IAAMD,EAAEmzB,SAAWlzB,EAAEkzB,UACrD1xB,EAAuBoE,IAAI,CAAC7F,EAAMC,KAChCD,EAAKmzB,SAAWlzB,EAChBD,EAAKy+H,iBAAmBC,GAAwB1+H,EAAKmzB,SAAU1xB,EAAuBf,UAEpFe,GACFP,EAAW4Y,WAAWrY,GAmCNA,CACGP,GEoCVlB,CACWG,KAAKw/H,WAAY3/H,GAGvC6/H,UAAU7/H,GACRG,KAAKw/H,WAAW9lH,OAAO,CAAE9U,GAAI/E,EAAK+E,GAAI05H,iBAAkBz+H,EAAKy+H,iBAAkBtrG,SAAUnzB,EAAKmzB,WAGhGitG,KAAKpgI,GACHG,KAAKkgI,UAAUrgI,EAAMsgI,cAAetgI,EAAMugI,cAGpCF,UAAUrgI,EAAWC,GAC3B,GAAID,IAAcC,EAAS,CACzB,MAAMM,EAAQ,IAAIJ,KAAKw/H,WAAWviH,KAAKxC,UACvC4lH,OAAgBjgI,EAAOP,EAAWC,GAClCM,EAAMsF,IAAI,CAACrF,EAAMC,KACfD,EAAKi+H,iBAAmBC,GAAwBj+H,EAAGF,EAAMG,QACzDF,EAAK2yB,SAAW1yB,IAElBN,KAAKw/H,WAAW7lH,WAAWvZ,GAC3Bo+H,GAAmBx+H,KAAKw/H,aAI5Bc,aAAazgI,WACNA,EAAKyP,MAA8B,KAAb,QAATxP,IAAKwP,YAAI,eAAE/O,WAC3BP,KAAKk/H,yBACLl/H,KAAKugI,kBAAkBroH,MAAK,GAC5BlY,KAAKwgI,qBAAqB3gI,IAItB2gI,qBAAqB3gI,GAC3B,MAAMC,EAAME,KAAKygI,kBAAkBhkF,MAAM/2C,IAAIq3C,GAAGg3B,KAAK,cAAe3zE,IAClE,MAKME,EAAeogI,GALIC,MACvBvgI,EAAM62E,WACNj3E,KAAKygI,kBAAkBhkF,MAAM/2C,IAAI+jD,WACjCzpD,KAAKypD,YAEiEzpD,KAAK4gI,sBAC7E/gI,EAAKyP,KAAOhP,EAAaQ,KAAK,KAC9BjB,EAAK0jF,YAAcjjF,EACnBN,KAAKw/H,WAAW9lH,OAAO7Z,GACvBs3E,WAAW,KACTn3E,KAAKugI,kBAAkBroH,MAAK,IAC3B,OAELlY,KAAK6gI,oBAAoBjgI,KAAKd,GAGxBo/H,yBACNl/H,KAAK6gI,oBAAoBn7H,IAAI7F,IAC3B6uG,KAAqB7uG,KAEvBG,KAAK6gI,oBAAsB,iDA9JlB9/H,GAAyBrB,oCAAzBqB,EAAyBugB,4vEDvBtC5hB,iBAAoCA,8CAAsBI,YACxDJ,0CA4DFA,eArDuEA,w0CCe1DqB,MCZA+/H,iBACX/4H,YAAoBlI,kCAEpBgU,MAAMhU,EAAiCC,EAAsC,IAC3E,GAA2B,IAAvBD,EAAYU,OAGhB,OAAOP,KAAK+gI,wBAAwBz1F,QACjC7kC,OAAQrG,GAA6BA,EAAOg+B,SAC5C14B,IAAKtF,GAA6BJ,KAAKghI,YAAY5gI,EAAQP,EAAaC,IAG7EkhI,YACEnhI,EACAC,EACAM,EAAsC,IAGtC,OADgBP,EAAOgU,MAAM/T,EAAaM,iDAjBjCW,GAAiBrB,sCAAjBqB,EAAiBsI,QAAjBtI,EAAiB,qBAFhB,SAEDA,kBCDmBA,GAC9B,YAAkC,IAA1BA,EAAeyS,mBAQczS,GACrC,YAAyC,IAAjCA,EAAekgI,0BAQuBlgI,GAC9C,YAAyC,IAAjCA,EAAekgI,gBAA+D,IAAhClgI,EAAOorC,iCA2BtCprC,EAAcO,GACrC,IAAIzB,EAAO,GACX,SAAK8D,MAAM,IAAImC,QAAQ,CAAChG,EAAKM,KACvBN,IAAQiB,EAAKZ,OAAOC,KACtBP,GAAQC,KAGLD,cAY6BkB,EAAMO,EAAIzB,GAAyB,GACvE,IAAKkB,IAASO,EACZ,OAAO,EAET,MAAMxB,EAAWD,EAAgBkB,EAAOA,EAAKgG,cACvC3G,EAASP,EAAgByB,EAAKA,EAAGyF,cAGjCvG,EAFa0gI,GAASphI,EAAUM,GACnB8gI,GAAS9gI,EAAQN,GAGpC,IAAI4D,EAAQ,EACZ,OAAIlD,EAAUD,SACZmD,EAAQlD,EAAUD,OAAST,EAASS,OAAS,KAGxC,IAAMgH,KAAK4hB,MAAMzlB,YClFxBqE,YAAoBzG,kBAMpB6/H,aACE,OAAOnhI,KAAKsrC,QAOd81F,oBACE,OAAOphI,KAAKmhI,aAAa16H,OACtBnF,IAA4C,IAAnBA,EAAO88B,SAUrCijG,oBAAoB//H,GAClBtB,KAAKmhI,aAAar7H,QAASjG,IAEvBA,EAAOu+B,QADJv+B,EAAOkI,YAAoCjD,OAASxD,IAa7DkmF,oBAAoBlmF,EAAsBzB,GACxCyB,EAAOkmF,oBAAoB3nF,QCtBlByhI,iBACXv5H,YACUlI,EACAC,GADAE,2BACAA,kBAQVwT,OAAO3T,EAAcC,EAA6B,YAChD,IAAKE,KAAKuhI,YAAY1hI,GACpB,MAAO,GAGT,MACMW,EAAWghI,GAAe3hI,GADK,QAAxBO,OAAKq/D,WAAWrC,gBAAQ,eAAE3T,aAAc,YACT,CAC1CwE,QAASnuD,EAAQmuD,UAEnB,GAAIztD,EAASstD,OACX,OAAO9tD,KAAKihI,cAAczgI,EAASstD,OAAQ,CAAEw/D,SAAU9sH,EAASutD,OAAQC,KAAMxtD,EAASwtD,OASzF,IAAItqD,EAEJ,OAVWlD,EAASwO,SAClB9D,QAAQC,IAAI3K,EAASwO,SAGvBlP,EAAQgrC,OACG,QADMzqC,OAAKo/D,WACnBrC,gBAAQ,eACP/R,eAAewK,UAAU,aAK3BnyD,EADE5D,EAAQ2hI,qBAA6C,IAA3B3hI,EAAQ2hI,eAC1BzhI,KAAK0hI,oBAAoBN,oBAEzBphI,KAAK0hI,oBAAoBP,aAGrCrhI,EAAY45C,SACVh2C,EAAUA,EAAQ+C,OAAQ7C,GAAWA,EAAO6vD,UAAY3zD,EAAQ45C,UACvD55C,EAAQ6hI,aACjBj+H,EAAUA,EAAQ+C,OACf7C,GAAWA,EAAOyuD,YAAcvyD,EAAQ6hI,aAI7Cj+H,EAAUA,EAAQ+C,OAAOm7H,IAClB5hI,KAAK2rC,cAAcjoC,EAAS7D,EAAMC,GAQ3CmhI,cACEphI,EACAC,EACAM,GAA4B,GAE5B,MAAMC,EAAwBD,EAC1ByhI,GACAC,GACExhI,EAAUN,KAAK0hI,oBAClBN,oBACA36H,OAAOpG,GACV,OAAOL,KAAK+hI,qBAAqBzhI,EAAST,EAAQC,GAAW,IASvD6rC,cACN9rC,EACAC,EACAM,GAEA,OAAOP,EAAQ6F,IAAKrF,KAEhBq+D,QAAWr+D,EAA8BmT,OAAO1T,EAAMM,GACtDyZ,SAAS,EACTyC,YAWEylH,qBACNliI,EACAC,EACAM,GAEA,OAAOP,EAAQ6F,IAAKrF,KAEhBq+D,QAAWr+D,EAAiC4gI,cAC1CnhI,EACAM,GAEFyZ,SAAS,EACTyC,YAUEilH,YAAY1hI,GAClB,MAAuB,iBAATA,GAA8B,KAATA,gDAtH1BkB,GAAarB,gDAAbqB,EAAasI,QAAbtI,EAAa,qBAFZ,SAEDA,+CCvBXrB,oBAEsFA,qFACpFA,sBACFA,aAFEA,oHAGFA,oBACiDA,oFAE/CA,sBACFA,aAFEA,2GAGFA,oBACiDA,oGAE/CA,sBACFA,aAFEA,sGAGFA,oBACiDA,8FAE/CA,sBACFA,aAFEA,iECPSsiI,iBASXj6H,YACUlI,EACAC,EACYM,GAFZJ,uBACAA,sBACYA,aANbA,wBAAoC,IAAIgI,uBAH/C,OAAOhI,KAAKiiI,mBAAmBxnH,MAAMI,KAAKhb,GAASA,EAAMsnB,WAAW3H,QAWtE0iH,aACEliI,KAAKw/H,WAAW2C,aAIlBC,UACEC,GAAeriI,KAAKw/H,YAItB8C,sBAEE,GADmB/gI,OAAevB,KAAKmsD,UACvB,CACd,MAAMrsD,EAAYE,KAAK+P,gBAAgB/B,UACjC5N,EAAQN,EAAUkQ,QACtB,2CAEI3P,EAAMP,EAAUkQ,QACpB,6CAEFhQ,KAAK+Q,eAAevB,QAAQnP,EAAKD,IAIrCmiI,YACEviI,KAAKwiI,mBAAmBr6H,OAG1Bs6H,4BACE,MAAM5iI,EAAiBG,KAAK0iI,mBAE5B,GADmBnhI,OAAe1B,GAClB,CACd,MAAMO,EAAYJ,KAAK+P,gBAAgB/B,UACjC3N,EAAQD,EAAU4P,QACtB,2CAEI1P,EAAMF,EAAU4P,QAAQ,yCAC9BhQ,KAAK+Q,eAAevB,QAAQlP,EAAKD,IAI7BqiI,mBACN,MAAM7iI,EAAS,KACf,IAAIC,EACFE,KAAK+P,gBAAgB/B,UAAUgC,QAC7B,uCACE,MACF5P,EAAe,GACnB,MAAMC,EACJL,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,kCACvC,OACAnQ,EACAG,KAAK2iI,YAAYx7G,WAAWvK,UAAU3N,MACtC,KACApP,EACA+iI,GAAe5iI,KAAK2iI,YAAYx7G,WAAWvK,UAAU0wG,UACrD,KACAztH,EACAgjI,GAAe7iI,KAAK2iI,YAAYx7G,WAAWvK,UAAUq1C,UACrD,OACAjyD,KAAK+P,gBAAgB/B,UAAUgC,QAC7B,oCAEF,MAEI1P,EACJN,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,+BACvC,MACAnQ,EACAG,KAAKmsD,SAEP,IAAI3rD,EAAe,EACnBR,KAAKw/H,WAAWviH,KAAKxC,MAAM3U,QAAQjC,IACjC,IAAIE,EAAQ,GACRC,EAAW,GACXH,EAAKyL,OAASoxH,GAAa78H,EAAK0/E,aAAaziF,KAAK,MACpDkD,EAAWH,EAAKyL,KAChBvL,EAAQ,MAAM28H,GAAa78H,EAAK0/E,aAAaziF,KAAK,UAElDkD,EAAW08H,GAAa78H,EAAK0/E,aAAaziF,KACxC,KAIJV,EACEA,EACAP,EACAW,EAAaqhG,iBACb,KACA79F,EACAD,EACA,KACFvD,MAGF,IAAIkD,EAAW,EACf,YAAKi/H,YAAYx7G,WAAWvK,UAAUqf,MAAMn2B,QAAQjC,IAClD,MAAME,EAAc/D,KAAK8iI,WAAWj/H,EAAMH,GAAUq7H,YAC9C/6H,OAC8B,IAAlC4+H,GAAe/+H,EAAKypH,UAChB,GACA,KAAOsV,GAAe/+H,EAAKypH,UAAY,IAC7CxtH,EACEA,EACAD,GACC6D,EAAW,GAAGm+F,iBACf,KACA99F,EACAC,EACA,KACFN,MAIArD,EAAUD,EAAe,KAAOE,EAAM,OAASR,EAKnDgjI,WAAWjjI,EAAMC,GACf,OAAOijI,GACLljI,EAAKmjI,SAASl+H,KACdjF,EAAKmjI,SAASC,SACdpjI,EAAKqR,KACLrR,EAAKmjI,SAASE,cACdpjI,EACAD,EAAKmjI,SAASnE,KACd7+H,KAAK+P,gBACLjQ,IAAQE,KAAK2iI,YAAYx7G,WAAWvK,UAAUqf,MAAM17B,OAAS,GAIzD4rD,SACN,IAAKnsD,KAAK6T,MACR,OAEF,IAAIhU,EAAU,GACVG,KAAKmjI,aACPtjI,EAAU,WAAWG,KAAKmjI,eAG5B,MAAMrjI,EAAME,KAAKiiI,mBAAmBxnH,MACnC/U,IAAKhC,GAAoCA,EAAUyjB,WAAWviB,IAAI1E,QAAQF,KAAK2iI,YAAYx7G,WAAWviB,IACvG,IAAIxE,EAAiB,GACT,IAARN,IAEFM,EAAiB,IADSJ,KAAK6T,MAAMjF,QAAQ6D,+BACI3S,KAEnD,MAAMO,EAAgBL,KAAK6T,MAAMjF,QAAQ4D,mBACnClS,EAAmBN,KAAKw/H,WAAWviH,KAAKxC,MAAM/U,IAAIhC,GAAQg9H,GAAah9H,EAAK6/E,YAAa,IAC/F,IAAI/iF,EAAgB,GACpB,OAAIF,EAAiBC,QAAU,GAC7BC,EAAgB,GAAGH,KAAiBC,EAAiBQ,KAAK,OACnD,GAAGyS,SAAS2rC,SAAS3rC,SAAS6vH,YAAYvjI,8BAAoCW,IAAgBJ,UAFvG,gDArKSW,GAA0BrB,0DAA1BqB,EAA0BugB,q3BDfvC5hB,iBACEA,oBAC8EA,gCAASI,mCACrFJ,sBACFA,QACAA,6DAKAA,4CAKAA,6CAKAA,8CAKFA,eAvBIA,yEAICA,oGAKAA,kEAKAA,mEAKAA,sICNQqB,gCCXDrB,wBACIA,SAEJA,uDAHmEA,iBAC/DA,mJAJZA,0BACIA,wBACIA,4EAAiC,8FACjCA,+BAIJA,QACJA,iCAPgBA,iFAC0BA,mCACAA,8DAO1CA,gEAKIA,4BACIA,0FAAgC,6EACN,KAE1BA,uBAGAA,iBAAaA,SAAgDA,QAC7DA,iBAA2BA,SAAiCA,QAChEA,yDALsEA,kDAAxDA,4CAGGA,6DACcA,uFAxBvCA,iBACIA,mCAUAA,gCAEAA,sBAAUA,0EACNA,gBAAsDA,SAAyBA,QAC/EA,gBAAkBA,SAA0FA,QAC5GA,kCAWAA,uBAEJA,QAEJA,gCA9BqBA,2DAUHA,6DAG4CA,wCACpCA,qHAIGA,uDCGhB2jI,iBAUXt7H,YACUlI,EACAC,GADAE,uBACAA,aAGVwgB,WACExgB,KAAKmf,WAAanf,KAAKiiI,mBAAmB3kH,UACvC/U,MAAK,OAAa,MAClBH,UAAUvI,IACT,MAAMC,EAA6BD,EAASgb,KAAKza,GAAUA,EAAO+mB,WAAW3H,QAC7Exf,KAAKsjI,WAAazjI,EAAS6F,IAAItF,GAAUA,EAAO+mB,WAAWvK,WAEzD5c,KAAKujI,gBADPzjI,EACyBA,EAA2BqnB,WAAWvK,eAEtC,EAEzB5c,KAAKkf,MAAMD,kBAIjB9G,cACEnY,KAAKmf,WAAWzW,cAGlB86H,cACExjI,KAAKiiI,mBAAmB3kH,UAAUxb,MAAM4D,IAAI7F,GAC1CA,EAAOsnB,WAAW3H,QAAU3f,EAAOsnB,WAAW3H,QAEhDxf,KAAKiiI,mBAAmBxlF,MAAMM,GAAGqO,YAAYyI,cAAcnuD,IAAI7F,GAC7DA,EAAQ4V,IAAI,UAAW5V,EAAQ4J,IAAI,YAIvCg6H,eAAe5jI,GACb,OAAO+iI,GAAe/iI,GAGxB6jI,eAAe7jI,GACb,OAAOgjI,GAAehjI,GAGxBijI,WAAWjjI,EAAMC,GACf,OAAOijI,GACLljI,EAAKmjI,SAASl+H,KACdjF,EAAKmjI,SAASC,SACdpjI,EAAKqR,KACLrR,EAAKmjI,SAASE,cACdpjI,EACAD,EAAKmjI,SAASnE,KACd7+H,KAAK+P,gBACLjQ,IAAQE,KAAKujI,gBAAgBtnG,MAAM17B,OAAS,GAIhDojI,kBACE3jI,KAAK4jI,iBAAiB1tH,QAGxB2tH,YAAYhkI,EAAeC,GAAe,GACxCE,KAAK8jI,yBAAyBjkI,EAAMC,GAGtCgkI,yBAAyBjkI,EAAeC,GAAe,GAErD,MACMO,EAAW,SAOXuD,EAD2B,IALRmgI,KAFLlkI,EAAKolD,SAASs+B,aAGSx+D,UACzC,YACA/kB,KAAK4jI,iBAAiBnnF,MAAM/2C,IAAI+jD,YAE6B+J,iBACrB,GAEpC3vD,EAAW,IAAIkgI,KAAangI,GAC5BG,EAAU,IAAIkuE,KAAU,CAAEhtB,aAE1BjhD,OAAkB+nD,MAAYuY,oBAAoBzgE,EAAU,CAChEigD,kBAAmB9jD,KAAK4jI,iBAAiBnnF,MAAM/2C,IAAI+jD,WACnD5F,eAAgB7jD,KAAK4jI,iBAAiBnnF,MAAM/2C,IAAI+jD,aAG5C9kD,EAAiB3E,KAAK4jI,iBAAiBn6H,IAAIpJ,GAoBjDL,KAAK4jI,iBAAiBlqH,OAfe,CACnC5U,KAAM83C,GACNqI,SAAUjhD,EACVylD,WAAYzpD,KAAK4jI,iBAAiBnnF,MAAM/2C,IAAI+jD,WAC5CtiC,WAAY,CACVviB,GAAIvE,EACJwkD,OACA//C,KAAMk5H,GAAcgG,QAEtBnrH,KAAM,CACJjU,GAAIvE,EACJqe,UAf2B/Z,EAC3BA,EAAekU,KAAK6F,SACpB,GAamC,GAErCq+B,GAAIh5C,IAGFjE,GACFE,KAAK4jI,iBAAiBnnF,MAAM/2C,IAAI2lD,eAAe0Z,aAAahhE,EAAQguD,cAAc8D,2DAlH3E90D,GAA0BrB,iDAA1BqB,EAA0BugB,oqBDtBvC5hB,8BAAkCA,83BCsBrBqB,MCYAkjI,iBA+BXl8H,YACUlI,EACAC,EACAM,EACAC,EACAC,GAJAN,aACAA,uBACAA,yBACAA,qBACAA,oBAhCHA,gBAAqB,YAKpBA,qBAAkC,GAKlCA,kBAAuB,EACvBA,oBAAyB,EAE1BA,mBAAwB,GAEvBA,eAA4B,GAO3BA,cAAmB,IACnBA,YAAiB,EACjBA,0BAA+B,EAC/BA,wBAAoC,IAAIgI,KAWjDwY,WACExgB,KAAKkmF,aAAaC,cAAe,EACjCnmF,KAAKkkI,mBACL/sD,WAAW,eX8DuBp2E,EAAsCO,GAC1E,MAAMzB,EAAkB,IAAI+pE,GAA4B,CACtD/C,OAAQhqB,GAAclkC,OA4BxB2/D,GAAkBv3E,EAzBC,IAAIokE,GAAY,CACjC5V,oBAAoB,EACpB3qD,GAAI,4BACJqK,MAAO3N,EAAgB0M,UAAUgC,QAAQ,oCACzC++C,OAAQ,IACRzyC,OAAQ,IAAI0vC,GACZsE,iBAAiB,EACjBlnB,UAAW,CACThL,SAAS,GAEXksB,aAAc,CACZU,OAAQ,4BACRT,MAAO,CACL,CACEY,gBAAgB,EAChBsqB,cAAc,EACdxqB,UAAW,CAAC,6BACZ9jC,WAAY,MAIlBgqC,YAAY,EACZD,WAAW,EACX7gC,MAAO8zG,MAGTpjI,EAAkB07C,MAAM71B,SAAU,EAClCy+E,GAAsBtkG,EAAmBlB,IW9F5B,CACaG,KAAKygI,kBAAmBzgI,KAAK+P,0BXgGlBhP,EAAwCO,GAC7E,MAAMzB,EAAkB,IAAI+pE,GAA4B,CACtD/C,OAAQhqB,GAAclkC,OAoBxB2/D,GAAkBv3E,EAjBC,IAAIokE,GAAY,CACjC5V,oBAAoB,EACpB3qD,GAAI,4BACJqK,MAAO3N,EAAgB0M,UAAUgC,QAAQ,qCACzC++C,OAAQ,IACRzyC,OAAQ,IAAI0vC,GACZsE,iBAAiB,EACjBlnB,UAAW,CACThL,SAAS,GAEXksB,aAAc,CACZU,OAAQ,6BAEVmG,YAAY,EACZD,WAAW,EACX7gC,MAAO8zG,MAGTpjI,EAAmB07C,MAAM71B,SAAU,EACnCy+E,GAAsBtkG,EAAoBlB,GWxHakQ,CAC5B/P,KAAKiiI,mBAAoBjiI,KAAK+P,0BX0HtBhP,GACnC,MAAMO,EAAkB,IAAIsoE,GAA4B,CACtD/C,OAAQhqB,GAAclkC,OAoBxB2/D,GAAkBv3E,EAjBA,IAAIokE,GAAY,CAChC5V,oBAAoB,EACpB3qD,GAAI,2BACJqK,MAAO,GACP8/C,OAAQ,IACRzyC,OAAQ,IAAI0vC,GACZsE,iBAAiB,EACjBlnB,UAAW,CACThL,SAAS,GAEXksB,aAAc,CACZU,OAAQ,6BAEVmG,YAAY,EACZD,WAAW,EACX7gC,MAAO8zG,MAGTpjI,EAAiB07C,MAAM71B,SAAU,EACjCy+E,GAAsBtkG,EAAkBO,GWlJiByO,CAChC/P,KAAK4jI,kBAC1B5jI,KAAKokI,qBACJ,GAILjsH,cACEnY,KAAKkmF,aAAaC,cAAe,EACjCnmF,KAAKqkI,aAAa37H,cAClB1I,KAAKskI,cAAc57H,cACnB1I,KAAKukI,gBAAgB7+H,IAAK7F,GAAMA,EAAE6I,eAClC1I,KAAKwkI,YAAY97H,cACjB1I,KAAKykI,eAGCA,eACNzkI,KAAKygI,kBAAkBhkF,MAAM/2C,IAAIq3C,GAAGosB,kBAAkBnpE,KAAK0kI,uBAC3D1kI,KAAKygI,kBAAkBhkF,MAAM/2C,IAAIq3C,GAAGosB,kBAAkBnpE,KAAK2kI,eAC3D3kI,KAAKiiI,mBAAmBxlF,MAAM/2C,IAAIq3C,GAAGosB,kBAAkBnpE,KAAK4kI,eAC5D5kI,KAAKygI,kBAAkBriH,yBAAyBwrD,IAChD5pE,KAAKiiI,mBAAmB7jH,yBAAyBwrD,IACjD5pE,KAAK4jI,iBAAiBxlH,yBAAyBwrD,IAGzCs6D,mBACNlkI,KAAKygB,QAAU,IAAIC,GAAmB1gB,KAAKw/H,WAAYx/H,KAAKkf,OAC5Dlf,KAAK6kI,0BACL7kI,KAAK8kI,2BACL9kI,KAAK+kI,yBAGCA,yBACN/kI,KAAKwkI,YAAcxkI,KAAKwiI,mBAAmBp6H,UAAU,KACnD,GAAIpI,KAAKiiI,mBAAmBn7H,OAAS,EAAG,CACtC,MAAMjH,EAAcG,KAAKiiI,mBAAmBxnH,MAAMI,KAAK/a,GAASA,EAAMqnB,WAAW3H,QAEjF,GAAI3f,EAAa,CACfA,EAAYk9C,GAAGgV,cACf,MAAMjyD,EAAcD,EAAYk9C,GAAGgV,cAAc8D,YACjD71D,KAAKiiI,mBAAmBxlF,MAAM/2C,IAAI2lD,eAAe0Z,aAAajlE,OAM9DskI,oBACNpkI,KAAK0kI,sBAAwB,IAAI5lC,KAAqB,CACpDz0C,OAAQ,CAACrqD,KAAKygI,kBAAkBhkF,MAAMM,IACtC0rB,aAAc,EACdhsC,UAAY58B,GACY,gBAAfA,EAAMiF,OAA2BjF,EAAMi3E,WAIlD92E,KAAK2kI,cAAgB,IAAIj7B,KAAwB,CAC/C/kB,SAAU3kF,KAAK0kI,sBAAsB7wE,gBAEvC7zD,KAAK2kI,cAAc77H,GAAG,cAAgBjJ,IACpCG,KAAKglI,eAAgB,EACrBhlI,KAAKilI,uBAAuBplI,EAAI8kF,YAElC3kF,KAAK2kI,cAAc77H,GAAG,eAAiBjJ,IACrCG,KAAKglI,eAAgB,EACrBhlI,KAAKilI,uBAAuBplI,EAAI8kF,YAGlC3kF,KAAK4kI,cAAgB,IAAI9lC,KAAqB,CAC5Cz0C,OAAQ,CAACrqD,KAAKiiI,mBAAmBxlF,MAAMM,IACvCtgB,UAAWsiE,MACXt2B,aAAc,EACdhiE,OAAQ5G,GACCA,EAAQ4J,IAAI,UAAYu0H,GAAcxhC,OAC3C38F,EAAQ4J,IAAI,YACXzJ,KAAKglI,gBAGZhlI,KAAK4kI,cAAc97H,GAAG,SAAWjJ,IAC/B,IAAyB,IAArBG,KAAKklI,YAAuB,CAC9B,MAAMplI,EAAoB4gI,GACxBC,MACG9gI,EAAYupE,gBAAgB6N,WAC7Bj3E,KAAKiiI,mBAAmBxlF,MAAM/2C,IAAI+jD,WAClCzpD,KAAKypD,YACgBzpD,KAAK4gI,sBACxBxgI,EAAYiiI,GAAeriI,KAAKw/H,YACtCp/H,EAAUkP,KAAOxP,EAAkBgB,KAAK,KACxCV,EAAUmjF,YAAc,CAACzjF,EAAkB,GAAIA,EAAkB,OAIrEE,KAAKygI,kBAAkBhkF,MAAM/2C,IAAIq3C,GAAGgsB,eAAe/oE,KAAK0kI,uBACxD1kI,KAAKygI,kBAAkBhkF,MAAM/2C,IAAIq3C,GAAGgsB,eAAe/oE,KAAK2kI,eACxD3kI,KAAKiiI,mBAAmBxlF,MAAM/2C,IAAIq3C,GAAGgsB,eAAe/oE,KAAK4kI,eAG3DO,0BAA0BtlI,GACxBA,EACEG,KAAKiiI,mBAAmBxlF,MAAM/2C,IAAIq3C,GAAGosB,kBAAkBnpE,KAAK4kI,eAC5D5kI,KAAKiiI,mBAAmBxlF,MAAM/2C,IAAIq3C,GAAGgsB,eAAe/oE,KAAK4kI,eAGrDK,uBACNplI,GAEA,GAA6B,IAAzBA,EAASulI,YACX,OAEF,MAAMtlI,EAAeD,EAASgpE,WAAW,GACnCzoE,EAAmBN,EAAa2zD,QAEhCpzD,EAAyBsgI,MAC7B7gI,EAAaiyD,cAAcyB,iBAC3BxzD,KAAKygI,kBAAkBhkF,MAAM/2C,IAAI+jD,WACjCzpD,KAAKypD,YAEDnpD,EAAiBN,KAAKw/H,WAAW/1H,IAAIrJ,GACrCI,EAAekgI,GAAargI,EAA4CL,KAAK4gI,sBACnFtgI,EAAeijF,YAAc/iF,EAC7BF,EAAegP,KAAO9O,EAAaM,KAAK,KACxCd,KAAKw/H,WAAW9lH,OAAOpZ,GAIjBukI,0BAEN7kI,KAAKqkI,aAAerkI,KAAKw/H,WAAWllH,OACjC/R,MACC,UACAH,UAAWvI,IACX,GAAIA,EAAQ,EAAG,CAEb,GADAwiI,GAAeriI,KAAKw/H,YACU,IAA1Bx/H,KAAKw/H,WAAW14H,MAElB,YADA9G,KAAKw/H,WAAW6F,kBAAkBl9H,MAAK,GAGzCnI,KAAKw/H,WAAW6F,kBAAkBl9H,MAAK,GAEzCnI,KAAKukI,gBAAgB7+H,IAAK5F,GAAMA,EAAE4I,iBAIhCo8H,2BACN9kI,KAAKskI,cAAgBtkI,KAAKw/H,WAAWliH,UAClC/U,MAAK,OAAavI,KAAKslI,WACvBl9H,UAAWvI,IACVG,KAAKulI,eAAe1lI,GACpB2+H,GAAmBx+H,KAAKw/H,YACxBx/H,KAAKwlI,qBACLxlI,KAAKylI,UAAUzlI,KAAKglI,iBAI1BU,eACE1lI,KAAK2lI,UAAUjgI,IAAI7F,GAAKA,EAAE6I,eAGpB68H,eAAe1lI,GACrB,MAAMC,EAAkBD,EAAM6F,IAAKpF,GAC1BiG,kBAA2BX,cAAM,CAAEhB,GAAItE,EAAKsE,GAAI0K,KAAMhP,EAAKgP,KAAMi0E,YAAajjF,EAAKijF,gBAEtFnjF,EAAOgF,cAAwBpF,KAAK4lI,cAAe9lI,EAAiB,CAAC,gBACrEO,EAAkBD,EAAKmE,MAAMyB,OAAO5F,EAAKqE,UAC3CpE,GACFA,EAAgBqF,IAAKpF,IACnB,MAAME,EAAeF,EAAOmF,SAC5B,GAAIjF,EAAa,CACf,MAAMkD,EAAa1D,KAAKw/H,WAAW/1H,IAAIjJ,EAAYoE,IAC7ChB,EAAOF,EAAK4L,KAClB,IAAK1L,GAAwB,IAAhBA,EAAKrD,OAChB,OAEF,MAAMsD,EAAW29H,GAAe59H,EAAM5D,KAAKygI,kBAAkBhkF,MAAM/2C,IAAI+jD,YACvE,IAAI1lD,EACAC,GAAU,EACVH,EAASiqD,SACX9pD,GAAU,GAEZD,EAAa/D,KAAK6lI,cAAcryH,OAAO5P,EAAM,CAAE+9H,WAAY,YAC3D3hI,KAAK0lI,eACL,MAAM/gI,EAAYZ,EAAW2B,IAAIo9C,GAAOA,EAAI4b,QACzCn2D,MAAK,OAAKtB,GAA4BA,EAAQR,OAAOu8C,GACpDh/C,EAAmC,UAAzBg/C,EAAEz5B,KAAK07B,SAASngD,MAAoBk+C,EAAEz5B,KAAK07B,SAAWjC,EAAEz5B,KAAK07B,aAG3EjlD,KAAK2lI,UAAYhhI,EAAUe,IAAKo9C,GACvBA,EAAQv6C,QAAKsmD,KAAK5nD,GAA4BA,EAAQR,OAAOu8C,GAClEh/C,EAAmC,UAAzBg/C,EAAEz5B,KAAK07B,SAASngD,MAAoBk+C,EAAEz5B,KAAK07B,SAAWjC,EAAEz5B,KAAK07B,YACtE78C,UAAWnB,IACV,GAAIA,EAAI1G,OAAS,EAAG,CAClB,MAAMyiD,EAAS/7C,EAAI,GAAGqV,OAChB2mC,EAAOh8C,EAAI,GAAG4R,KACdwqC,EAAUp8C,EAAIvB,IAAIg+C,GAAKA,EAAEn6B,MAC1B7lB,EAAKoiI,kBACRpiI,EAAKoiI,gBAAkB,IAEzBpiI,EAAKoiI,gBAAkBpiI,EAAKoiI,gBAAgBr/H,OAAOi9C,GAAMA,EAAG5+C,QAAUd,EAAU85H,GAAaC,MAAQD,GAAaiI,OAClH,IAAIviF,EAAe9/C,EAAKoiI,gBAAgBjrH,KAAK6oC,GAAMA,EAAGpnC,SAAW0mC,GAC7DQ,EACFA,EAAawiF,QAAU3iF,EAEvB3/C,EAAKoiI,gBAAgBllI,KAAK,CACxBkE,KAAMd,EAAU85H,GAAaC,MAAQD,GAAaiI,KAClDzpH,SACAzD,OACAmtH,YAINhmI,KAAKkf,MAAMD,sBAMvBjf,KAAK4lI,cAAgB9lI,EAGf0lI,qBACN,MAAM3lI,EAAQG,KAAKw/H,WAAW/kH,MACD5a,EAAM4G,OAAOpG,GAAQA,EAAKkjF,aAClC79E,IAAIrF,GAAQL,KAAKimI,eAAe5lI,IACrDL,KAAKygI,kBAAkBhmH,MAAM/U,IAC1BrF,IACML,KAAKw/H,WAAW/1H,IAAIpJ,EAAY8mB,WAAWviB,KAC9C5E,KAAKygI,kBAAkB92H,OAAOtJ,KAGJR,EAAM4G,OAAOpG,IAASA,EAAKkjF,aACnC79E,IAAIrF,IAC1B,MAAMC,EAAcN,KAAKygI,kBAAkBh3H,IAAIpJ,EAAKuE,IAChDtE,GACFN,KAAKygI,kBAAkB92H,OAAOrJ,KAK5BmlI,UAAU5lI,GAAsB,GACtC,MAAMC,EAAuBE,KAAKw/H,WAAWviH,KAC1CxC,MACAhU,OAAOjG,GAAQA,EAAK+iF,aACvB,GAAIzjF,EAAqBS,OAAS,EAEhC,YADAP,KAAKiiI,mBAAmBtkH,WAAW3d,KAAKiiI,mBAAmBxnH,OAI7D,MAAMra,EAAqBN,EAAqB4F,IAAKlF,GAC9BkgI,GAAalgI,EAAK+iF,YAAavjF,KAAK4gI,uBAS3D5gI,KAAKukI,gBAAgB7+H,IAAKlF,GAAMA,EAAEkI,eAClC,MAAMpI,EAAgBN,KAAKkmI,kBAAkBryH,MAC3CzT,EACAP,EATkD,CAClDsmI,UAAU,EACVlqG,OAAO,EACPmqG,cAAc,EACdC,mBAAmB,QAKsB,GAEvC/lI,GACFA,EAAcoF,IAAIlF,GAChBR,KAAKukI,gBAAgB3jI,KACnBJ,EAAI4H,UAAU1E,IACZ1D,KAAKiiI,mBAAmBtkH,WAAW3d,KAAKiiI,mBAAmBxnH,OAC3D/W,EAAWgC,IAAI9B,YXzDzB7C,EACAO,EACAzB,EACAC,GAAkB,EAClBM,GAAe,GACf,MAEMI,EAAW,IADQujI,KADZziI,EAAU2jD,SAASs+B,aAEFx+D,UAC5BllB,EACAkB,EAAmB2E,IAAI+jD,YAGnB/lD,OAAkBqoD,MAAYuY,oBAAoB9jE,EAAU,CAChEsjD,kBAAmB/iD,EAAmB2E,IAAI+jD,WAC1C5F,eAAgB9iD,EAAmB2E,IAAI+jD,aAInC7lD,EAAgB7C,EAAmB0I,IAAInI,EAAUsD,IAKjDb,EAA0C,CAC9Ce,KAAM83C,GACNqI,SAAUvhD,EACV+lD,WAAY1oD,EAAmB2E,IAAI+jD,WACnCtiC,WAAY,CACVviB,GAAItD,EAAUsD,GACdE,KAAMk5H,GAAcxhC,MACpBh9E,SACA5C,aAEF/D,KAAM,CACJjU,GAAItD,EAAUsD,GACd8Z,UAhB0B9a,EAC1BA,EAAciV,KAAK6F,SACnB,GAckC,GAEpCq+B,GAAI,IAAIk1B,KAAU,CAAEhtB,cAEtBlkD,EAAmB2Y,OAAO3V,GWkBDH,CAEX5D,KAAKiiI,mBACLr+H,EACA5D,KAAKypD,WACL7lD,IAAcF,EAAW,SAQhCuiI,eAAepmI,aXhItBkB,EACAO,EACAzB,EACAC,EACAM,GACA,IAAIC,EACAC,EAGJ,OAAQS,EAAKu9H,uBACNJ,GAA8BC,MACjC99H,EAAY,UACZC,EAAWF,EAAgB4N,UAAUgC,QAAQ,gCAC7C,WACGkuH,GAA8BG,IACjCh+H,EAAY,UACZC,EAAWF,EAAgB4N,UAAUgC,QAAQ,8BAC7C,cAEA3P,EAAY,UACZC,EAAWF,EAAgB4N,UAAUgC,QAAQ,uCAAyC,KAAOjP,EAAKiyB,SAItG,MAAMxyB,EAAW,IAAIujI,KACnBpD,MAAiB5/H,EAAKwiF,YAAazjF,EAAYD,EAAkB6F,IAAI+jD,aAGjE/lD,OAAkBqoD,MAAYuY,oBAAoB9jE,EAAU,CAChEsjD,kBAAmBjkD,EAAkB6F,IAAI+jD,WACzC5F,eAAgBhkD,EAAkB6F,IAAI+jD,aAGlC7lD,EAAe/D,EAAkB4J,IAAI1I,EAAK6D,IAG1Cb,EAAoC,CACxCe,KAAM83C,GACNqI,SAAUvhD,EACV+lD,WAAY5pD,EAAkB6F,IAAI+jD,WAClCtiC,WAAY,CACVviB,GAAI7D,EAAK6D,GACTE,KAAMk5H,GAAcC,KACpBqI,WACAC,YACAC,YAAa,EACbC,QAEF5tH,KAAM,CACJjU,GAAI7D,EAAK6D,GACT8Z,UAhByB9a,EAAeA,EAAaiV,KAAK6F,SAAW,GAgBpC,GAEnCq+B,GAAI,IAAIk1B,KAAU,CAAEhtB,cAEtBplD,EAAkB6Z,OAAO3V,GW0EHlE,CACOA,EAAMG,EAAiBA,KAAKygI,kBAAmBzgI,KAAKypD,WAAYzpD,KAAK+P,+DArUvFhP,GAAmBrB,+EAAnBqB,EAAmBugB,6lBClChC5hB,oCAEAA,mCAAuBA,6CAAqBI,iCAAqNJ,QACjQA,cACAA,2CAJwBA,iCAAyB,0CAAzBA,CAAyB,0CAAzBA,CAAyB,2BAE8BA,8DAA6C,0BAA7CA,CAA6C,wCAA7CA,CAA6C,0BAA7CA,CAA6C,sBAA7CA,CAA6C,mBAEpGA,sDAAqC,iFD8BhDqB,MEsBA2lI,iBAAmB38H,iBAE5B,MAAO,CACLC,SAAUjJ,iDAHHA,6DAFA,Cf3CJ,CACLmJ,QAASyzH,GACThyH,WAAYg7H,GACZ96H,KAAM,CAAC+6H,MewCoCr3G,SA7BpC,CACPviB,KACAqzH,MACAh6G,MACAA,MACA5mB,KACAuvB,KACAG,KACA8mE,KACApqE,MACA0I,KACAq2F,MACAxxF,MACAnK,KACAgL,MACAttB,OAgBS5L,kBCjD8BA,GACzC,OAAO,IAAIqO,GAAoBrO,OCwBpB8lI,iBACX9+H,YAAoBlI,0BAEpBinI,aAAajnI,GACX,OAAOA,gDAJEkB,GAA6BrB,sCAA7BqB,EAA6BsI,QAA7BtI,EAA6B,YAA7BA,eAWXgmI,UAAUzlI,GACR,OAAOw1D,mBAAmBx1D,GAG5B0lI,YAAY1lI,GACV,OAAOw1D,mBAAmBx1D,GAG5B2lI,UAAU3lI,GACR,OAAOgS,mBAAmBhS,GAG5B4lI,YAAY5lI,GACV,OAAOgS,mBAAmBhS,QAQjB6lI,yBAA6B9/C,GAYxCt/E,YACUlI,EACAC,EACRM,EACmBC,EAEXC,EACRE,GAEAqf,MAAMxf,EAASD,GARPJ,YACAA,uBAIAA,iBAdVA,YAAkC,IAAI+I,IAAwB,IAEtD/I,yBAAsB,GAiB5BA,KAAK+P,gBAAgB/B,UAClBvE,IAAIzJ,KAAK4O,QAAQK,OACjB7G,UAAWxE,GAAU5D,KAAKonI,OAAOj/H,KAAKvE,IAEzC,MAAMF,EAAclD,EAASiJ,IAAI4mC,IAC7BrwC,KAAKunF,SAAShnF,SACXmD,EAGHA,EAAY4sC,cAAcloC,UAAU,KAClCpI,KAAKqnI,oBAHPrnI,KAAKqnI,+BArBT,OAAOrnI,KAAKonI,OAAOz9G,WA8BrB8pC,QACE,OAAO1yD,EAAqB6D,GAG9BytD,UACE,OAAOtxD,EAAqB+D,KAGpBwiF,0BACR,MAAMxnF,EACJE,KAAK4O,QAAQo9B,QAAUhsC,KAAK4O,QAAQo9B,OAAOC,MACvChhB,OAAOjrB,KAAK4O,QAAQo9B,OAAOC,YAC3B,EACA7rC,EACJJ,KAAK4O,QAAQo9B,QAAUhsC,KAAK4O,QAAQo9B,OAAOs7F,MACvCr8G,OAAOjrB,KAAK4O,QAAQo9B,OAAOs7F,YAC3B,EAEAjnI,GAA2B,QAAnBR,OAAK+O,QAAQo9B,cAAM,eAAElnC,MAC7B9E,KAAK4O,QAAQo9B,OAAOlnC,KAAKqB,QAAQ,MAAO,IAAIY,cAAcpD,MAAM,KAChE,CACE,WACA,gBACA,SACA,gBACA,gBACA,MACA,WACA,SAGR,MAAO,CACLsL,MAAO,+BACP68B,UAAW,8CACXy7C,SAAU,CACR,CACEziF,KAAM,WACNmK,MAAO,eACPiC,KAAM,OACNyK,OAAQ,CACN,CACE1M,MAAO,uCACPnN,MAAO,WACPs8B,SAAuC,IAA9B/9B,EAAMH,QAAQ,YACvB2nF,SAAU,CAAC,YAEb,CACE54E,MAAO,0CACPnN,MAAO,qBACPs8B,SAAiD,IAAxC/9B,EAAMH,QAAQ,sBACvB2nF,SAAU,CAAC,uBAEb,CACE54E,MAAO,0CACPnN,MAAO,gBACPs8B,SAA4C,IAAnC/9B,EAAMH,QAAQ,iBACvB2nF,SAAU,CAAC,gBAEb,CACE54E,MAAO,oCACPnN,MAAO,SACPs8B,SAAqC,IAA5B/9B,EAAMH,QAAQ,UACvB2nF,SAAU,CAAC,UAEb,CACE54E,MAAO,4CACPnN,MAAO,gBACPs8B,SAA4C,IAAnC/9B,EAAMH,QAAQ,iBACvB2nF,SAAU,CAAC,eAAgB,MAE7B,CACE54E,MAAO,oCACPnN,MAAO,gBACPs8B,SAA4C,IAAnC/9B,EAAMH,QAAQ,iBACvB2nF,SAAU,CAAC,kBAAgB,QAE7B,CACE54E,MAAO,uCACPnN,MAAO,0BACPs8B,SAAsD,IAA7C/9B,EAAMH,QAAQ,2BACvB2nF,SAAU,CAAC,4BAEb,CACE54E,MAAO,mCACPnN,MAAO,MACPs8B,SAAkC,IAAzB/9B,EAAMH,QAAQ,OACvB2nF,SAAU,CAAC,QAEb,CACE54E,MAAO,wCACPnN,MAAO,WACPs8B,SAAuC,IAA9B/9B,EAAMH,QAAQ,YACvB2nF,SAAU,CAAC,2BAAyB,aAEtC,CACE54E,MAAO,0CACPnN,MAAO,cACPs8B,SAA0C,IAAjC/9B,EAAMH,QAAQ,eACvBunF,WAAW,EACXI,SAAU,CAAC,eAEb,CACE54E,MAAO,qCACPnN,MAAO,QACPs8B,SAAoC,IAA3B/9B,EAAMH,QAAQ,SACvB2nF,SAAU,CAAC,SAEb,CACE54E,MAAO,oCACPnN,MAAO,oBACPs8B,SAAgD,IAAvC/9B,EAAMH,QAAQ,qBACvB2nF,SAAU,CAAC,SAAU,UAAW,SAElC,CACE54E,MAAO,kCACPnN,MAAO,YACPs8B,SAAwC,IAA/B/9B,EAAMH,QAAQ,aACvB2nF,SAAU,CAAC,QAAS,SAAU,YAAU,OAE1C,CACE54E,MAAO,mCACPnN,MAAO,aACPs8B,SAAyC,IAAhC/9B,EAAMH,QAAQ,cACvB2nF,SAAU,CAAC,QAAS,SAAU,YAAU,MAAO,QAEjD,CACE54E,MAAO,kCACPnN,MAAO,YACPs8B,SAAwC,IAA/B/9B,EAAMH,QAAQ,aACvB2nF,SAAU,CAAC,QAAS,SAAU,OAEhC,CACE54E,MAAO,oCACPnN,MAAO,cACPs8B,SAA0C,IAAjC/9B,EAAMH,QAAQ,eACvB2nF,SAAU,CAAC,QAAS,SAAU,SAEhC,CACE54E,MAAO,kCACPnN,MAAO,KACPs8B,SAAiC,IAAxB/9B,EAAMH,QAAQ,MACvB2nF,SAAU,CAAC,OAEb,CACE54E,MAAO,wCACPnN,MAAO,WACPs8B,SAAuC,IAA9B/9B,EAAMH,QAAQ,YACvB2nF,SAAU,CAAC,eAIjB,CACE/iF,KAAM,cACNmK,MAAO,gBACPiC,KAAM,QACNyK,OAAQ,CACN,CACE1M,MAAO,IACPnN,MAAO,EACPs8B,QAAmB,IAAVt+B,GAEX,CACEmP,MAAO,IACPnN,MAAO,EACPs8B,QAAmB,IAAVt+B,IAAgBA,GAE3B,CACEmP,MAAO,KACPnN,MAAO,GACPs8B,QAAmB,KAAVt+B,GAEX,CACEmP,MAAO,KACPnN,MAAO,GACPs8B,QAAmB,KAAVt+B,GAEX,CACEmP,MAAO,KACPnN,MAAO,GACPs8B,QAAmB,KAAVt+B,KAIf,CACEgF,KAAM,cACNmK,MAAO,QACPiC,KAAM,QACNyK,OAAQ,CACN,CACE1M,MAAO,OACPnN,MAAO,GACPs8B,QAAmB,KAAVh+B,GAEX,CACE6O,MAAO,OACPnN,MAAO,GACPs8B,QAAmB,KAAVh+B,IAAiBA,GAE5B,CACE6O,MAAO,OACPnN,MAAO,GACPs8B,QAAmB,KAAVh+B,GAEX,CACE6O,MAAO,OACPnN,MAAO,GACPs8B,QAAmB,KAAVh+B,GAEX,CACE6O,MAAO,QACPnN,MAAO,IACPs8B,QAAmB,MAAVh+B,KAIf,CACE0E,KAAM,cACNmK,MAAO,iBACPiC,KAAM,MACNyK,OAAQ,CACN,CACE1M,MAAO,6CACPnN,MAAO,OACPs8B,SAAS,GAEX,CACEnvB,MAAO,gDACPnN,MAAO,QACPs8B,SAAS,OAgBrB5qB,OACE3T,EACAC,GAEA,MAAMM,EAASJ,KAAKunI,qBAAqB1nI,EAAMC,GAAW,IAC1D,OAAKM,EAAOqJ,IAAI,QAAQlJ,QAGxBP,KAAK4O,QAAQo9B,OAAOw7F,KAAOpnI,EAAOqJ,IAAI,SAAW,IAE1CzJ,KAAKkM,KAAKzC,IAAI,GAAGzJ,KAAK8rC,oBAAqB,CAAEE,WAAUzjC,MAC5D,OAAKlI,GAA+BL,KAAKynI,eAAepnI,EAAUR,KAClE,OAAYQ,IACV,QAAIgL,MAAMyF,WAAY,EACtBzQ,EAAIgL,MAAM4D,MAAQjP,KAAK+P,gBAAgB/B,UAAUgC,QAC/ChQ,KAAKsnF,oBAAoBr4E,OAErB5O,SAXD2L,MAAG,IAgBNq7H,kBACN,OAAOrnI,KAAKkM,KACTzC,IAAI,GAAGzJ,KAAK8rC,mBACZ1jC,UAAWvI,IACV,MAAMC,EAAcE,KAAKunF,SAAS1sE,KAAMza,GAAiB,SAAXA,EAAE8Q,MAChDpR,EAAY6b,OAAO7V,QAAS1F,IAC1B,MAAMC,EAAQ,IAAI4kB,OAAO,IAAI7kB,EAAE0B,gBACzBxB,EAAeT,EAAM4G,OAAQjG,GAAUH,EAAM6kB,KAAK1kB,IACxDJ,EAAEqnF,UAAYnnF,EAAaC,OAAS,EACpB,UAAZH,EAAE0B,QACJ9B,KAAK0nI,oBAAsB,IACrB,IAAI/hI,IACNrF,EACGoF,IAAKlF,GAAMA,EAAEmD,MAAM,MACnBqD,OAAO,CAACxG,EAAGkD,IAAMlD,EAAEwF,OAAOtC,IAC1B+C,OAAQjG,GAAY,UAANA,QAKzBR,KAAKwnF,oBAAoB1nF,GAAa,KAIpCynI,qBACN1nI,EACAC,GAEA,MAAMM,EAAmBwF,OAAOU,OAC9B,CACE2+C,UAAU,EACVi+B,MAAM,EACNjqE,MAAM,EACNnU,KACE,mFAEJ9E,KAAKgsC,OACLhsC,KAAK2nI,oBAAoB9nI,EAAMC,GAAW,IAAIksC,OAC9C,CACE7hC,EAAGnK,KAAK4nI,YAAY/nI,GACpB2nI,KAAM1nI,EAAQ0nI,OAIlB,GAAwB,SAApBpnI,EAAY06F,IAAgB,CAC9B,MAAOz6F,EAAMC,EAAME,EAAMkD,GAAQ5D,EAAQgrC,OACzC1qC,EAAY06F,IAAM,GAAGz6F,KAAQC,KAAQE,KAAQF,KAAQE,KAAQkD,KAAQrD,KAAQqD,KAAQrD,KAAQC,QAChE,UAApBF,EAAY06F,YACd16F,EAAY06F,IAGrB,MAAI,aAAa51E,KAAK9kB,EAAY+J,KAChC/J,EAAY0E,KAAO,SAGd,IAAIqF,KAAW,CACpBs0D,WAAYl4D,kBAA4BnG,GACxCynI,QAAS,IAAIC,KAITL,eAAe5nI,EAA4BC,GACjD,OAAOD,EAAS8kF,SAASj/E,IAAKtF,GACrBJ,KAAK+nI,UAAUjB,aAAa9mI,KAAKgoI,aAAa5nI,EAAMN,EAAMD,KAI7DmoI,aACNnoI,EACAC,EACAM,GAEA,MAAMC,EAAaL,KAAKioI,kBAAkBpoI,GACpCS,EAAK,CAACN,KAAKyzD,QAASpzD,EAAWyE,KAAMzE,EAAWsqC,MAAM7pC,KAAK,KAUjE,MAAO,CACLwb,OAAQtc,KACRupB,KAAM,CACJzkB,KAAM83C,GACN6M,WAAY,YACZxE,SAAUplD,EAAKolD,SACfna,OAAQjrC,EAAKqjF,KACb/7D,aACAtO,KAAM,CACJjU,KACAqK,MAAOpP,EAAKsnB,WAAWu/D,MAG3B7tE,KAAM,CACJqvH,SAAUtrF,GACVh4C,KACAqK,MAAOpP,EAAKsnB,WAAWu/D,IACvByhD,WAzBctoI,EAAKuoI,UAAUn5H,OAASpP,EAAKsnB,WAAWu/D,MACrC7mF,EAAKuoI,UAAUC,OAChC,YAAcxoI,EAAKuoI,UAAUC,OAAS,WACtC,KACkBxoI,EAAKuoI,UAAUE,OACjC,eAAiBzoI,EAAKuoI,UAAUE,OAAS,WACzC,IAoBArvH,KAAMpZ,EAAKoZ,MAAQ,aACnBsvH,MAAO1oI,EAAK0oI,OAASC,GAAsB1oI,EAAK2tD,OAAQ5tD,EAAKsnB,WAAWu/D,KACxE+hD,SACEroI,EAASukF,SAASpkF,QAAUP,KAAK4O,QAAQo9B,OAAOC,OAAU,IACzDjsC,KAAK4O,QAAQo9B,OAAOw7F,KAAO,KAK5BS,kBAAkBpoI,GACxB,MAAMC,EAAayG,aACjB1G,EAAKsnB,WACLpmB,EAAqB2nI,qBAGvB,IAAK7oI,EAAKolD,SACR,OAAOr/C,OAAOU,OAAO,CAAExB,KAAMjF,EAAKyZ,OAASxZ,GAG7C,MAAMM,EAGF,CACFuoI,WAAY,IAGd,IAAItoI,EAcAC,EAbJ,GAA2B,UAAvBT,EAAKolD,SAASngD,KAChBzE,EAAauoI,GAAY7gD,uBACvBloF,EAAKolD,SAASs+B,YAAY,GAC1B1jF,EAAKolD,SAASs+B,YAAY,QAEvB,CACL,MAAM7/E,GAAQ,QAAe7D,EAAKolD,UAClC5kD,EAAauoI,GAAY7gD,uBACvBrkF,EAAMuhD,SAASs+B,YAAY,GAC3B7/E,EAAMuhD,SAASs+B,YAAY,IAM7BjjF,EAAgBsoI,GAAYC,sBADX,WAAfhpI,EAAKyZ,MAELzZ,EAAKsnB,WAAWu/D,IAAM,KAAO7mF,EAAKsnB,WAAW2hH,aAEvB,kBAAfjpI,EAAKyZ,MAEZzZ,EAAKsnB,WAAWu/D,IAAM,UAEA,QAAnB7mF,EAASyZ,MAEZ,OAASzZ,EAAKsnB,WAAWu/D,IAEH,aAAf7mF,EAAKyZ,MAEZzZ,EAAKsnB,WAAWu/D,IAAM,OAItB7mF,EAAKsnB,WAAWu/D,KAAO7mF,EAAKuoI,UAAUn5H,OAI1C7O,EAAsBuoI,WACpB,WACAtoI,EACA,oBACAL,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,yBACvC,uBACA1P,EACA,oBACAN,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,wBACvC,OAEyB,UAAvBnQ,EAAKolD,SAASngD,OAChB1E,EAAsB2oI,iBAAmBH,GAAYI,wBACnDnpI,EAAKolD,SAASs+B,YAAY,GAC1B1jF,EAAKolD,SAASs+B,YAAY,KAI9B,MAAM/iF,EAEF,CACFg8F,MACE,6BACAx8F,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,sBACvC,gBAGJ,OAAOpK,OAAOU,OACZ,CAAExB,KAAMjF,EAAKyZ,OACbxZ,EACAM,EACAI,GAQIonI,YAAY/nI,GAGlB,IAAIO,GAAO,EACX,UAFiBP,EAAKwO,MAAM,kBAAoB,IAEhC6L,KAAM7Z,IACpB,MAAMC,EAAaD,EAAQuH,UAAU,GACrC,OAAO5H,KAAK0nI,oBAAoBxtH,KAC7B1Z,GACCA,EACGuG,cACA4hB,UAAU,OACVxiB,QAAQ,mBAAoB,MAC/B7F,EACGyG,cACA4hB,UAAU,OACVxiB,QAAQ,mBAAoB,OAIhC/F,IACHP,EAAOA,EAAKsG,QAAQ,gBAAiB,KAGhCtG,EAAKsG,QAAQ,gDAAkC,IAQhDwhI,oBACN9nI,EACAC,GAEA,MAAMM,EAAWyf,MAAM8nE,iBAAiB9nF,EAAM,QAC9C,OAAIO,IACFN,EAAQksC,OAASpmC,OAAOU,OAAOxG,EAAQksC,QAAU,GAAI,CACnDlnC,KAAM1E,EAASU,KAAK,QAIjBhB,GAriBF,YAAK,WACLiB,OAAO67C,GACP77C,sBAAgC,yCAH5BA,GAAoBrB,sCAgBrB,WAASA,MACTmnI,IAA6BnnI,yCAjB5BqB,EAAoBsI,QAApBtI,EAAoB,eA2R/BykB,WAHCC,MAAU,CACTC,cAAe,MAEjB3kB,qBAoBC,MA/SUA,MA8iBAkoI,yBAAoC5hD,GAY/Ct/E,YACUlI,EACAC,EACRM,EACmBC,EACnBC,GAEAuf,MAAMxf,EAASD,GANPJ,YACAA,uBARVA,YAAkC,IAAI+I,IAAwB,IAe5D/I,KAAK+P,gBAAgB/B,UAClBvE,IAAIzJ,KAAK4O,QAAQK,OACjB7G,UAAW1E,GAAU1D,KAAKonI,OAAOj/H,KAAKzE,IAEzC,MAAMlD,EAAcF,EAASmJ,IAAI4mC,IAC7BrwC,KAAKunF,SAAShnF,SACXC,EAGHA,EAAY8vC,cAAcloC,UAAU,KAClCpI,KAAKqnI,oBAHPrnI,KAAKqnI,+BAnBT,OAAOrnI,KAAKonI,OAAOz9G,WA4BrB8pC,QACE,OAAO1yD,EAA4B6D,GAGrCytD,UACE,OAAOtxD,EAA4B+D,KAG3BwiF,oBACR,MAAMznF,EACJG,KAAK4O,QAAQo9B,QAAUhsC,KAAK4O,QAAQo9B,OAAOlnC,KACvC9E,KAAK4O,QAAQo9B,OAAOlnC,KAAKqB,QAAQ,MAAO,IAAIY,cAAcpD,MAAM,KAChE,CAAC,WAAY,gBAAiB,MAAO,YAE3C,MAAO,CACLsL,MAAO,sCACP68B,UAAW,6CACXy7C,SAAU,CACR,CACEziF,KAAM,WACNmK,MAAO,eACPiC,KAAM,OACNyK,OAAQ,CACN,CACE1M,MAAO,uCACPnN,MAAO,WACPs8B,SAAuC,IAA9Bv+B,EAAMK,QAAQ,aAEzB,CACE+O,MAAO,oCACPnN,MAAO,SACPs8B,SAAqC,IAA5Bv+B,EAAMK,QAAQ,UACvBunF,WAAW,GAEb,CACEx4E,MAAO,wCACPnN,MAAO,kBACPs8B,SAA8C,IAArCv+B,EAAMK,QAAQ,oBAEzB,CACE+O,MAAO,oCACPnN,MAAO,gBACPs8B,SAA4C,IAAnCv+B,EAAMK,QAAQ,kBAEzB,CACE+O,MAAO,mCACPnN,MAAO,MACPs8B,SAAkC,IAAzBv+B,EAAMK,QAAQ,QAEzB,CACE+O,MAAO,wCACPnN,MAAO,WACPs8B,SAAuC,IAA9Bv+B,EAAMK,QAAQ,eAI7B,CACE4E,KAAM,cACNmK,MAAO,SACPiC,KAAM,cACNyK,OAAQ,CACN,CACE1M,MAAO,QACPnN,MAAO,IACPs8B,SAAUp+B,KAAK4O,QAAQ0+G,UAAsC,MAA1BttH,KAAK4O,QAAQ0+G,UAElD,CACEr+G,MAAO,QACPnN,MAAO,IACPs8B,QAAmC,MAA1Bp+B,KAAK4O,QAAQ0+G,UAExB,CACEr+G,MAAO,OACPnN,MAAO,IACPs8B,QAAmC,MAA1Bp+B,KAAK4O,QAAQ0+G,UAExB,CACEr+G,MAAO,OACPnN,MAAO,IACPs8B,QAAmC,MAA1Bp+B,KAAK4O,QAAQ0+G,UAExB,CACEr+G,MAAO,OACPnN,MAAO,IACPs8B,QAAmC,MAA1Bp+B,KAAK4O,QAAQ0+G,cAiBlC2T,cACEphI,EACAC,GAEA,MAAMM,EAASJ,KAAKunI,qBAAqB1nI,EAAQC,GAAW,IAC5D,OAAKM,EAAOqJ,IAAI,QAAQlJ,OAGjBP,KAAKkM,KAAKzC,IAAI,GAAGzJ,KAAK8rC,mBAAoB,CAAEE,WAAUzjC,QAC3DsmD,KAAKxuD,GACIL,KAAKynI,eAAepnI,QAJtB2L,MAAG,IASNq7H,kBACN,OAAOrnI,KAAKkM,KACTzC,IAAI,GAAGzJ,KAAK8rC,mBACZ1jC,UAAWvI,IACV,MAAMC,EAAcE,KAAKunF,SAAS1sE,KAAMza,GAAiB,SAAXA,EAAE8Q,MAChDpR,EAAY6b,OAAO7V,QAAS1F,IAC1BA,EAAEqnF,UAAY5nF,EAAMK,QAAQE,EAAE0B,QAAmB,IAEnD9B,KAAKwnF,oBAAoB1nF,GAAa,KAIpCynI,qBACN1nI,EACAC,GAEA,OAAIA,EAAQwtH,UAAYttH,KAAK4O,QAAQ0+G,YACnCxtH,EAAQksC,OAASpmC,OAAOU,OAAOxG,EAAQksC,QAAU,GAAI,CACnD4uD,YAAa96F,EAAQwtH,UAAYttH,KAAK4O,QAAQ0+G,YAI3C,IAAInjH,KAAW,CACpBs0D,WAAY74D,OAAOU,OACjB,CACEw0F,IAAKj7F,EAAOiB,KAAK,KACjBma,KAAM,WACNgqC,UAAU,EACVhsC,MAAM,GAERnZ,EAAQksC,QAAU,GAClBhsC,KAAKgsC,UAKHy7F,eACN5nI,GAEA,OAAOA,EAAS8kF,SAASj/E,IAAK5F,GACrBE,KAAKgoI,aAAaloI,IAIrBopI,YAAYrpI,GAClB,IAAKG,KAAKunF,SAAShnF,OACjB,MAAO,GAET,IAAIT,EAAW,GACf,OAAQD,EAAKsnB,WAAWriB,UACjB,kBACHhF,EAAWD,EAAKsnB,WAAW2hH,aAAe,oBAC1C,cAGA,MAAMzoI,EAAOL,KADYunF,SAAS1sE,KAAMva,GAAiB,SAAXA,EAAE4Q,MACvByK,OAAOd,KAC7Bva,GAAMA,EAAEwB,QAAUjC,EAAKsnB,WAAWriB,MAEjCzE,IACFP,EAAWE,KAAK+P,gBAAgB/B,UAAUgC,QAAQ3P,EAAK4O,QAG7D,OAAOnP,EAGDkoI,aAAanoI,GACnB,MAAMC,EAAaE,KAAKioI,kBAAkBpoI,GACpCO,EAASJ,KAAKmpI,cAActpI,GAC5BQ,EAAK,CAACL,KAAKyzD,QAAS3zD,EAAWgF,KAAMhF,EAAW6qC,MAAM7pC,KAAK,KAE3DR,EAAYT,EAAKsnB,WAAWu/D,IAC5BlmF,EAAe,YAAcR,KAAKkpI,YAAYrpI,GAAQ,WAE5D,MAAO,CACLyc,OAAQtc,KACRupB,KAAM,CACJzkB,KAAM83C,GACN6M,WAAY,YACZxE,SAAUplD,EAAKolD,SACfna,SACA3jB,aACAtO,KAAM,CACJjU,KACAqK,MAAOpP,EAAKsnB,WAAWu/D,MAG3B7tE,KAAM,CACJqvH,SAAUtrF,GACVh4C,KACAqK,MAAOpP,EAAKsnB,WAAWu/D,IACvByhD,UAAW7nI,EAAYE,EACvByY,KAAMpZ,EAAKoZ,MAAQ,aACnBmwH,oBAAqBppI,KAAKkpI,YAAYrpI,GAAO,KAAOA,EAAKsnB,WAAWu/D,MAKlEuhD,kBAAkBpoI,GACxB,MAAMC,EAAayG,aACjB1G,EAAKsnB,WACLpmB,EAA4B2nI,qBAGxBtoI,EAEF,CACFo8F,MACE,6BACAx8F,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,sBACvC,gBAGJ,OAAOpK,OAAOU,OAAOxG,EAAYM,GAG3B+oI,cACNtpI,GAEA,OAAOA,EAAKqjF,KACR,CAACrjF,EAAKqjF,KAAK,GAAIrjF,EAAKqjF,KAAK,GAAIrjF,EAAKqjF,KAAK,GAAIrjF,EAAKqjF,KAAK,SACrD,GA/QC,YAAK,kBACLniF,OAAO67C,GACP77C,sBAAgC,yCAJ5BA,GAA2BrB,sCAgB5B,WAASA,yCAhBRqB,EAA2BsI,QAA3BtI,EAA2B,eA0ItCykB,WAHCC,MAAU,CACTC,cAAe,MAEjB3kB,4BAaC,MAvJUA,kBC7lBXA,GAEA,OAAO,IAAI8lI,GAA8B9lI,eAmBzCA,EACAO,EACAzB,EACAC,EACAM,EACAC,GAEA,OAAO,IAAI8mI,GACTpmI,EACAO,EACAzB,EACAC,EAAO4K,UAAU,iBAAiBy8H,GAAqBviI,MACvDxE,EACAC,eA4BFU,EACAO,EACAzB,EACAC,EACAM,GAEA,OAAO,IAAI6oI,GACTloI,EACAO,EACAzB,EACAC,EAAO4K,UAAU,iBAAiBu+H,GAA4BrkI,MAC9DxE,OCrESipI,iBACXthI,YAAoBlI,0BAEpBinI,aAAajnI,GACX,OAAOA,gDAJEkB,GAAgCrB,sCAAhCqB,EAAgCsI,QAAhCtI,EAAgC,YAAhCA,MAWAuoI,yBAAuCjiD,GAalDt/E,YACqBlI,EACXC,EACRM,EACuBC,GAEvBwf,MAAMhgB,EAASO,GAJPJ,uBARVA,YAAkC,IAAI+I,IAAwB,IAa5D/I,KAAK0qC,YAAcrqC,EACnBL,KAAK+P,gBAAgB/B,UAClBvE,IAAIzJ,KAAK4O,QAAQK,OACjB7G,UAAU9H,GAASN,KAAKonI,OAAOj/H,KAAK7H,gBAbvC,OAAON,KAAKonI,OAAOz9G,WAgBrB8pC,QACE,OAAO1yD,EAA+B6D,GAGxCytD,UACE,OAAOtxD,EAA+B+D,KAG9BwiF,oBACR,MAAO,CACLr4E,MAAO,kCACP88B,MAAO,EACP27C,gBAAgB,GAapBu5C,cACEphI,EACAC,GAEA,OAAO,QAAG,CAACE,KAAKgoI,aAAanoI,EAAQC,KAG/BkoI,aAAanoI,EAAwBC,GAC3C,MAAMM,W9O0RRW,EAA4BO,EAAkB,GAE9C,MAAMzB,EAAY,GAElB,SAASiG,QAAQhG,IACf,MAAMM,EAAUN,EAAK,EAAIyH,KAAKoyH,KAAK75H,GAAMyH,KAAK4hB,MAAMrpB,GAC9CO,EAAMP,EAAK,EAAqB,IAAhBM,EAAUN,GAA4B,IAAhBA,EAAKM,GAC3CE,EAAUiH,KAAK4hB,MAAM9oB,GACrBG,GAA6B,IAAjBH,EAAMC,IAAe0hG,QAAQ1gG,GAE/CzB,EAAUe,KAAK,GAAGR,SAAYE,MAAYE,QAErCX,E8OtSCO,CAAyBP,GAEzBS,W9O4YRS,EACAO,GAOA,MAAMzB,EAAeguD,MAAiB9sD,EAAQ,YAAa,aACrDjB,EAAkB,CACtB,CACE6qC,KAAM,YACNC,MAAO,eACP2+F,MAAO1pI,EACP2pI,gBAAiB,GAAG9I,GAAa7gI,GAAciB,KAAK,iBAKlDV,WA+C0BW,GAChC,OAAOwG,KAAKoyH,MAAM54H,EAAO,GAAK,KAAO,GAhD/BX,CAA4BW,GAC5BV,EAAUD,EAAU,GAAK,YAAYA,IAAY,WAAWA,IAC5DE,EAAU,OAAOF,IACjBI,EAAcqtD,MAAiB9sD,EAAQ,YAAaV,GAC1DP,EAAgBc,KAAK,CACnB+pC,KAAMtqC,EACNuqC,MAAO,MACP2+F,MAAO/oI,EACPgpI,gBAAiB,GAAGlpI,KAAWogI,GAAalgI,GAAaM,KAAK,UAIhE,MAAM4C,WA4C0B3C,GAChC,MAAMO,EAAOP,EAAO,GACpB,IAAIlB,EACJ,OAAIyB,GAAO,IAAOA,GAAO,KACvBzB,EAAU,GAERyB,GAAO,IAAOA,GAAO,KACvBzB,EAAU,GAERyB,GAAO,IAAOA,GAAO,KACvBzB,EAAU,GAERyB,GAAO,IAAOA,GAAO,KACvBzB,EAAU,GAERyB,GAAO,IAAOA,GAAO,KACvBzB,EAAU,GAERyB,GAAO,IAAOA,GAAO,KACvBzB,EAAU,GAERyB,GAAO,IAAOA,GAAO,KACvBzB,EAAU,GAERyB,GAAO,IAAOA,GAAO,KACvBzB,EAAU,GAERyB,GAAO,IAAOA,GAAO,KACvBzB,EAAU,GAERyB,GAAO,IAAOA,GAAO,KACvBzB,EAAU,IAELA,EA7ED6D,CAA4B3C,GAClC,GAAI2C,EAAS,CACX,MAAME,EACJF,EAAU,GAAK,YAAYA,IAAY,WAAW,GAAKA,IACnDG,EAAU,OAAOH,IACjBK,EAAc8pD,MAAiB9sD,EAAQ,YAAa6C,GAC1D9D,EAAgBc,KAAK,CACnB+pC,KAAM/mC,EACNgnC,MAAO,MACP2+F,MAAOxlI,EACPylI,gBAAiB,GAAG3lI,KAAW68H,GAAa38H,GAAajD,KAAK,UAIlE,SAAYgF,QAAQlC,IAClB,MAAMC,EAAWgqD,MAAiB9sD,EAAQ,YAAa6C,EAAW+mC,MAC5D5mC,EAAkBH,EAAW+mC,KAAKhnC,MAAM,KAAK,GACnD7D,EAAgBc,KAAK,CACnB+pC,KAAM/mC,EAAW+mC,KACjBC,MAAOhnC,EAAWgnC,OAAShnC,EAAW+mC,KACtC4+F,MAAO1lI,EACP2lI,gBAAiB,GAAG9I,GAAa78H,GAAU/C,KACzC,WACKiD,QAIJjE,E8OtcCQ,CADkCT,EAAMG,KAAK0qC,aACrB1jC,OAAO,CAAC87C,EAAK77C,KACzC67C,EAAI77C,EAAK2jC,OAAS3jC,EAAKuiI,gBAAiB1mF,GAAM,IAE1CtiD,EAAqBkgI,GAAa7gI,EAAM,GAAGiB,KAAK,MAChD4C,EAAwBtD,EAAQU,KAAK,MAE3C,IAAI8C,EAA4B,CAC9BkB,KAAM,QACNy+E,YAAa,CAAC1jF,EAAK,GAAIA,EAAK,KAG9B,MAAMgE,EAAa,GACnB,IAAIE,EAAe,GACnB,GAAIjE,EAAQwtH,SAAU,CAEpBzpH,EADkB7D,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,sCACjClQ,EAAQwtH,SAChCvpH,EAAe,qBAAuBjE,EAAQwtH,SAAW,aAGzD,MAAMrmH,EAAS4mD,MAAiB,CAAChuD,EAAK,GAAIA,EAAK,IAAK,YAAa,aAC3DmjD,EAAiB,IAAIgvB,KAAS/qE,EAAQnH,EAAQwtH,UAC9CrqE,GAAkB,SAAWD,GAC7BK,EAAS,IAAI0I,KACnBnoD,EAAWqB,KAAKC,MAAMm+C,EAAOomF,cAAcxmF,EAAgBl+B,UAAU,YAAa,eAcpF,OAXIjlB,EAAQkuD,OAEVnqD,EADgB7D,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,oCACjClQ,EAAQkuD,KAC9BjqD,GAAiC,KAAjBA,EAAsB,OAAS,qBAC/CA,GAAgB,qBAAuBjE,EAAQkuD,KAAO,aAIxDnqD,EADiB7D,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,qCACjCxP,EAGvBqD,EADoB7D,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,wCACjCtM,EAEnB,CACL4Y,OAAQtc,KACRupB,KAAM,CACJzkB,KAAM83C,GACN6M,WAAY,YACZxE,WACAna,YAAQ,EACR3jB,WAAYvhB,OAAOU,OACjBzC,EACAvD,EACA,CACEqoI,WAAYC,GAAY7gD,uBAAuBloF,EAAK,GAAIA,EAAK,IAC7DkpI,iBAAkBH,GAAYI,wBAC5BnpI,EAAK,GACLA,EAAK,IAEP6pI,cAAeC,GAASvhD,qBAAqBvoF,EAAK,GAAIA,EAAK,GAAI,IAC/D28F,MAAO,6BAA+Bx8F,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,sBAAwB,iBAGzG6I,KAAM,CACJjU,GAAI/E,EAAK,GAAGoD,WAAa,IAAMpD,EAAK,GAAGoD,WACvCgM,MAAOzO,IAGXqY,KAAM,CACJqvH,SAAUtrF,GACVh4C,GAAI/E,EAAK,GAAGoD,WAAa,IAAMpD,EAAK,GAAGoD,WACvCgM,MAAOzO,EACP2nI,UAAW3nI,EAAqBuD,EAChCkV,KAAM,aACNsvH,MAAO,OAjIN,YAAK,qBACLxnI,OAAO67C,yCAHH77C,GAA8BrB,MAc/B,WAASA,0BAGT,2CAjBCqB,EAA8BsI,QAA9BtI,EAA8B,eAmDzCykB,WAHCC,MAAU,CACTC,cAAe,MAEjB3kB,4BAKC,MAxDUA,kBCjBXA,GAEA,OAAO,IAAIsoI,GAAiCtoI,eAmB5CA,EACAO,EACAzB,EACAC,GAEA,OAAO,IAAIwpI,GACTvoI,EAAO2J,UAAU,iBAAiB4+H,GAA+B1kI,MACjEtD,EACAzB,EACCkB,EAAO2J,UAAU,gBAAmC,QCjB5Ck/H,iBACX7hI,YAAoBlI,0BAEpBinI,aAAajnI,GACX,MAAMC,EAAa,CACjB,QACA,WACA,aACA,cACA,cACA,UACA,QAGIM,EAAWwF,OAAOuU,QAAQta,EAAKsnB,YAClC1gB,OAAO,EAAEnG,MAAqC,IAA5BR,EAAWI,QAAQI,IACrC0G,OAAO,CAAC1G,EAA6BE,KACpC,MAAOkD,EAAKE,GAASpD,EACrB,IAAIqD,EACJ,IACEA,EAAS7D,KAAK+P,gBAAgB/B,UAAUgC,QACtC,oCAAsCtM,SAEjCK,GACPF,EAASH,EAEX,SAAIG,GAAUD,GAAgB,GACvBtD,GACN,IAECD,EAAQuF,OAAOU,OAAO,GAAIzG,GAChC,SAAMsnB,WAAa/mB,EAEZC,gDAjCEU,GAA2BrB,sCAA3BqB,EAA2BsI,QAA3BtI,EAA2B,YAA3BA,MAyCA8oI,yBAA2BxiD,GAUtCt/E,YACUlI,EACAC,EACRM,EACmBC,EAEXC,GAERuf,MAAMxf,EAASD,GAPPJ,YACAA,uBAIAA,iBAZVA,YAAkC,IAAI+I,IAAwB,IAe5D/I,KAAK+P,gBAAgB/B,UAClBvE,IAAIzJ,KAAK4O,QAAQK,OACjB7G,UAAU5H,GAASR,KAAKonI,OAAOj/H,KAAK3H,gBAdvC,OAAOR,KAAKonI,OAAOz9G,WAiBrB8pC,QACE,OAAO1yD,EAAmB6D,GAG5BytD,UACE,OAAOtxD,EAAmB+D,KAGlBwiF,oBACR,MAAMznF,EACJG,KAAK4O,QAAQo9B,QAAUhsC,KAAK4O,QAAQo9B,OAAOC,MACvChhB,OAAOjrB,KAAK4O,QAAQo9B,OAAOC,YAC3B,EACAnsC,EACJE,KAAK4O,QAAQo9B,QAAUhsC,KAAK4O,QAAQo9B,OAAOs7F,MACvCr8G,OAAOjrB,KAAK4O,QAAQo9B,OAAOs7F,YAC3B,EACN,MAAO,CACLr4H,MAAO,6BACP68B,UAAW,mDACXy7C,SAAU,CACR,CACEziF,KAAM,WACNmK,MAAO,eACPiC,KAAM,OACNyK,OAAQ,CACN,CACE1M,MAAO,mCACPnN,MAAO,QACPs8B,SAAS,EACTypD,SAAU,CAAC,QAAS,SAAU,SAAU,YAE1C,CACE54E,MAAO,wCACPnN,MAAO,QACPs8B,SAAS,EACTypD,SAAU,CAAC,WAAY,YAAa,YAAa,iBAIvD,CACE/iF,KAAM,cACNmK,MAAO,gBACPiC,KAAM,QACNyK,OAAQ,CACN,CACE1M,MAAO,IACPnN,MAAO,EACPs8B,QAAmB,IAAVv+B,GAEX,CACEoP,MAAO,IACPnN,MAAO,EACPs8B,QAAmB,IAAVv+B,IAAgBA,GAE3B,CACEoP,MAAO,KACPnN,MAAO,GACPs8B,QAAmB,KAAVv+B,GAEX,CACEoP,MAAO,KACPnN,MAAO,GACPs8B,QAAmB,KAAVv+B,GAEX,CACEoP,MAAO,KACPnN,MAAO,GACPs8B,QAAmB,KAAVv+B,KAIf,CACEiF,KAAM,cACNmK,MAAO,QACPiC,KAAM,QACNyK,OAAQ,CACN,CACE1M,MAAO,OACPnN,MAAO,GACPs8B,QAAmB,KAAVt+B,GAEX,CACEmP,MAAO,OACPnN,MAAO,GACPs8B,QAAmB,KAAVt+B,GAEX,CACEmP,MAAO,OACPnN,MAAO,GACPs8B,QAAmB,KAAVt+B,IAAiBA,GAE5B,CACEmP,MAAO,OACPnN,MAAO,GACPs8B,QAAmB,KAAVt+B,GAEX,CACEmP,MAAO,QACPnN,MAAO,IACPs8B,QAAmB,MAAVt+B,OAiBrB0T,OACE3T,EACAC,GAEA,MAAMM,EAASJ,KAAK8pI,2BAA2BjqI,EAAMC,GAAW,IAChE,OAAKM,EAAOqJ,IAAI,MAASrJ,EAAOqJ,IAAI,SAGpCzJ,KAAK4O,QAAQo9B,OAAOw7F,KAAOpnI,EAAOqJ,IAAI,SAAW,IAE1CzJ,KAAKkM,KACTzC,IAAIzJ,KAAK8rC,UAAW,CAAEE,WACtBzjC,MACC,OAAKlI,GAAoCL,KAAKynI,eAAepnI,EAAUR,OAPlE,QAAG,IAWNiqI,2BACNjqI,EACAC,GAEA,OAAO,IAAIqK,KAAW,CACpBs0D,WAAYl4D,kBACVX,OAAOU,OACL,CACE6D,EAAGnK,KAAK4nI,YAAY/nI,IAEtBG,KAAKgsC,OACLhsC,KAAK2nI,oBAAoB9nI,EAAMC,GAAW,IAAIksC,OAC9C,CACEw7F,KAAM1nI,EAAQ0nI,UAWhBI,YAAY/nI,GAClB,OAAOA,EAAKsG,QAAQ,aAAc,IAAIA,QAAQ,8BAAyB,IAQjEwhI,oBACN9nI,EACAC,GAEA,MAAMM,EAAWyf,MAAM8nE,iBAAiB9nF,EAAM,QAC9C,OAAIO,IACFN,EAAQksC,OAASpmC,OAAOU,OAAOxG,EAAQksC,QAAU,GAAI,CACnDlnC,KAAM1E,EAASU,KAAK,QAIjBhB,EAGD2nI,eACN5nI,EAAiCC,GAEjC,OAAOD,EAAS22D,MAAM9wD,IAAKtF,GAC3BJ,KAAKgoI,aAAa5nI,EAAMN,EAAMD,IAIxBmoI,aACNnoI,EACAC,EACAM,GAEA,MAAMC,EAAeL,KAAK+pI,oBAAoBlqI,GAExCS,EAAYT,EAAKuoI,UAAUn5H,OAASpP,EAAKsnB,WAAWlY,MACpDzO,EAAaX,EAAKuoI,UAAU4B,YAAcnqI,EAAKsnB,WAAW6iH,WAC1DtmI,EAAelD,EACjB,mCAAqCA,EAAa,WAClD,GAEJ,MAAO,CACL8b,OAAQtc,KACR6Y,KAAM,CACJqvH,SAAU58B,GACV1mG,GAAI,CAAC5E,KAAKyzD,QAAS5zD,EAAKsnB,WAAWviB,IAAI9D,KAAK,KAC5CmO,MAAOpP,EAAKsnB,WAAWlY,MACvBk5H,UAAW7nI,EAAYoD,EACvBuV,KAA+B,UAAzBpZ,EAAKsnB,WAAWriB,KAAmB,SAAW,MACpDyjI,MAAO1oI,EAAK0oI,OAASC,GAAsB1oI,EAAK2tD,OAAQ5tD,EAAKsnB,WAAWjW,MACxEu3H,SACEroI,EAASo2D,MAAMj2D,QAAUP,KAAK4O,QAAQo9B,OAAOC,OAAU,IACtDjsC,KAAK4O,QAAQo9B,OAAOw7F,KAAO,IAEhCj+G,KAAMlpB,GAIF0pI,oBAAoBlqI,GAC1B,MAAMC,EAAMD,EAAKsnB,WAAWtW,IACtBzQ,EAA0CJ,KAAKiqI,gCACnDnqI,GAEF,OAAOyG,kBAA4B,CACjCg3C,cAAe,CACb34C,GAAI/E,EAAKsnB,WAAWviB,GACpBE,KAAMjF,EAAKsnB,WAAWY,OACtBlX,MACA06B,YAAanrC,EAAYmrC,YACzBC,gBAAiBprC,EAAYorC,gBAC7BQ,OAAmC,QAA3BnsC,EAAKsnB,WAAWY,OAAmB,CAACu1B,OAAQz9C,EAAKsnB,WAAWjW,WAAQ,EAC5EurC,MAAkC,QAA3B58C,EAAKsnB,WAAWY,YAAmB,EAAYloB,EAAKsnB,WAAWjW,KACtEmyD,yBAAyB,EACzB/M,YAAa,aAEfrnD,MAAOpP,EAAKsnB,WAAWlY,MACvBggD,cAAeC,GACbjkC,OAAOprB,EAAKsnB,WAAWgoC,gBAEzBxE,cAAeuE,GACbjkC,OAAOprB,EAAKsnB,WAAWioC,gBAEzBiR,SAAU,CACRxvD,IAAKhR,EAAKsnB,WAAWwiE,YACrBztC,SAAQr8C,EAAKsnB,WAAWwiE,kBAAqB,EAC7CrtC,SAAUz8C,EAAKsnB,WAAWm1B,eAAY,GAExCn1B,WAAYnnB,KAAK+nI,UAAUjB,aAAajnI,GAAMsnB,aAI1C8iH,gCACNpqI,GAEA,IAAIC,EACAM,EACJ,MAAMC,EAAaL,KAAK4O,QAAsC28B,YAC9D,GAAIlrC,EAAW,CACb,UAAWC,KAAOsF,OAAOC,KAAKxF,GAAY,CACxC,MAAMG,EAAQH,EAAUC,GACxB,GAAc,MAAVE,EAAe,CACjBV,EAAckmD,GAAY1lD,EAAIuG,eAC9B,MAGF,MAAMnD,EAASlD,EAAqC0pI,KACpD,GAAI/lI,MAAM4B,QAAQrC,GAAO,CACvBA,EAAKoC,QAAQlC,KACiB,IAAxB/D,EAAIK,QAAQ0D,KACd9D,EAAckmD,GAAY1lD,EAAIuG,kBAGlC,QAKF/G,IAAgBkmD,GAAY6Z,MAC5B//D,IAAgBkmD,GAAY28B,YAE5BviF,EAAkB,UAItB,MAAO,CACLmrC,cACAC,oBAtTG,YAAK,SACLzqC,OAAOuqG,yCAFHvqG,GAAkBrB,sCAcnB,WAASA,MACTkqI,gCAfC7oI,EAAkBsI,QAAlBtI,EAAkB,eA6I7BykB,WAHCC,MAAU,CACTC,cAAe,MAEjB3kB,qBAeC,MA5JUA,kBCzDXA,GAEA,OAAO,IAAI6oI,GAA4B7oI,eAmBvCA,EACAO,EACAzB,EACAC,EACAM,GAEA,OAAO,IAAIypI,GACT9oI,EACAO,EACAzB,EACAC,EAAO4K,UAAU,iBAAiBm/H,GAAmBjlI,MACrDxE,SCzCS+pI,GAAe,CAACvtF,GAAS0uD,8BCkBhC5rG,8BACEA,8BACFA,4CAFyDA,iBACvDA,gECQK0qI,iBA0BXriI,YAAoBlI,8BAxBXG,iBAAuC,IAAI+I,SAAgB,GAU3D/I,iBAAwBmqI,GAYvBnqI,sBAAmB,IAAIN,qBANlBG,GAAiBG,KAAKqqI,cAAcxqI,oBACxB,OAAOG,KAAKsqI,YAAYxoI,MASnD0e,WACExgB,KAAKuqI,aAAevqI,KAAKsqI,YACtB/hI,MAAK,UACLH,UAAWvI,GAAuBG,KAAKwqI,gBAAgB3qI,IAG5DsY,cACEnY,KAAKuqI,aAAa7hI,cAQpB+hI,mBAAmB5qI,GACjBG,KAAKqqI,cAAcxqI,GAUrB6qI,mBAAmB7qI,GACjB,MAAO,kBAAkBA,EAAWkH,sBAO9BsjI,cAAcxqI,GACpBG,KAAKsqI,YAAYniI,KAAKtI,GAGhB2qI,gBAAgB3qI,GACyB,MAA3CA,IAIJG,KAAK0hI,oBAAoBL,oBAAoBxhI,GAC7CG,KAAK2qI,iBAAiBzyH,KAAKrY,kDAxElBkB,GAAuBrB,oCAAvBqB,EAAuBugB,+lBD9BpC5hB,iBACEA,yCAQEA,sBACFA,QAEAA,wBAKEA,6BAGEA,kCAAUI,iDACVJ,qCAGFA,QACFA,QAEFA,+BApBIA,sEAAwD,uBAYtDA,iDAEyCA,qbCSlCqB,MCGA6pI,2HAdF,CACP59H,KACAiiB,KACAxvB,KACAuvB,KACAE,KACA47F,MACAD,MACAx7F,KACA1iB,OAKS5L,+CClBTrB,iBACEA,oBACEA,8EAAyCA,mDAAgJA,QAC7LA,gCAD6CA,+KAWvCA,qBAEgBA,SAChBA,mDAFEA,6BACcA,0DAEhBA,qBAGEA,SACFA,wCADEA,0EAiBQA,+BAKEA,iCAASU,qBAATV,CAAkC,mJAElCA,8BACFA,+CANEA,iBAAsB,6CAAtBA,CAAsB,qBAKtBA,sEAXNA,gBACEA,8BAGEA,sCASFA,QACFA,wCAXIA,0BAC2CA,6EAY7CA,iBACEA,oBACEA,0HAAmDA,mDAAgMA,QACvPA,2CADuDA,0NAEvDA,2BAMEA,iCAASU,qBAATV,CAAkC,gJAElCA,8BACFA,oEAPEA,gCACAA,2BAAgC,UAAhCA,CAAgC,8CAKhCA,sEAbJA,gBACEA,wBAIAA,kCAUFA,mDAd+BA,yCAIUA,6EA7B7CA,SACEA,qBAGEA,8BACFA,QACAA,0BAGEA,0BAeAA,0BAgBFA,QACFA,6CAtCMA,sCACFA,oFAGAA,kCAEOA,6CAeAA,oFA5CjBA,SACEA,mBACEA,2BAIEA,iCAASU,qBAATV,CAAkC,0FAEpCA,QACAA,4BAIAA,4BAKFA,QACEA,4BACEA,iCA0CFA,QACJA,oCA3DMA,oCAA0B,WAKnBA,2CAMNA,6CAKiCA,+EA4CxCA,gBACEA,uBACAA,mBACEA,+BAAiDA,mFAA6C,2BAEnFU,2CACTV,8BACFA,QACAA,+BAAiDA,oFAA8C,2BAEpFU,2CACTV,+BACFA,QACFA,QACFA,gCAVgCA,sFAAwE,kCAAxEA,CAAwE,yBAElGA,gFAG0BA,wFAAyE,yCAAzEA,CAAyE,yBAEnGA,uFCtDCmrI,iBAuCX9iI,YACUlI,EACAC,EACAM,GAFAJ,2BACAA,oBACAA,sBAzCHA,oCAAyC,EACzCA,8BAAmC,EAEnCA,YAAS,GACTA,iBAAcqG,KAAKykI,MAEnB9qI,kBAAe,QAMbA,4BAAiC,EACjCA,mCAAwC,EAKvCA,wBAAqB,IAAIN,MAKzBM,0BAAuB,IAAIN,MAK3BM,iCAA8B,IAAIN,0BAnB1C,OAAOM,KAAKikB,aAAapP,gBAsB3B4tB,oBAAoB5iC,GACA,OAAdA,EAAMoG,MACRjG,KAAK+qI,uBAAyB/qI,KAAK+qI,sBACnC/qI,KAAKgrI,qBAAqB9yH,KAAKlY,KAAK+qI,wBAUxCvqH,WACExgB,KAAKirI,8BAAgCjrI,KAAKkrI,2CAO5CC,mBACE,MAAMtrI,EAAoBG,KAAK0hI,oBAC5BP,aACA16H,OAAOm7H,IACPn7H,OAAQpG,GAAMA,EAAEonF,WAA2B,QAAdpnF,EAAEozD,SAAqBpzD,EAAEqnF,gBAEnD5nF,EAAuBE,KAAK0hI,oBAC/BP,aACA16H,OAAOq7H,IACPr7H,OAAQpG,GAAMA,EAAEonF,WAA2B,QAAdpnF,EAAEozD,SAAqBpzD,EAAEqnF,gBACnDtnF,EAAUP,EAAkBmG,OAAOlG,GACzC,YAAKsrI,+BAA+BhrI,GAC7BA,EAOT8qI,2CACE,QACElrI,KAAK0hI,oBACFN,oBACA36H,OAAOo7H,IAAiCthI,OAY/C8qI,6BACExrI,EACAC,EACAM,EACAC,GAEAA,EAAa+9B,QAAUv+B,EAAMynB,QAC7BxnB,EAAO0nF,oBAAoBpnF,GAC3BJ,KAAKsrI,mBAAmBpzH,KAAKpY,GAS/ByrI,+BAA+B1rI,GAGzBA,EAAQ2rI,gBAFe,IAAvB3rI,EAAQ2rI,YACV3rI,EAAY8b,OAAOd,KAAM/a,GAAiBA,EAAas+B,UAMjCv+B,EAAQ2rI,WAUlCJ,+BAA+BvrI,GAC7B,MAAMC,EAAoBD,EAAQ4G,OAAQpG,GAAWA,EAAO+9B,SAAS79B,OAC/DH,EAAqBP,EAAQ4G,OAAQpG,IAAYA,EAAO+9B,SAC3D79B,OACHP,KAAKyrI,0BACH3rI,GAAqBM,GAOzBsrI,gBAAgB7rI,EAAOC,EAAsBM,GAC3CP,EAAM4hB,kBACNzhB,KAAKurI,+BAA+BnrI,GACpCA,EAAQub,OAAO7V,QAASzF,IACtBA,EAAa+9B,QAAUh+B,EAAQorI,aAEjC1rI,EAAO0nF,oBAAoBpnF,GAC3BJ,KAAKsrI,mBAAmBpzH,KAAKpY,GAO/B6rI,uBAAuB9rI,GACrBA,EAAM4hB,kBACNzhB,KAAKmrI,mBAAmBzlI,IAAK5F,IAC3BA,EAAOs+B,QAAUp+B,KAAKyrI,wBACtBzrI,KAAKsrI,mBAAmBpzH,KAAKpY,KAQjC8rI,gCACE/rI,EACAC,EACAM,EACAC,GAEAD,EAAQub,OAAO7V,QAASxF,IAEpBA,EAAK89B,QADH99B,EAAKwB,QAAUzB,EAAayB,OACdjC,EAAMyc,OAAOgL,QAEdznB,EAAMyc,OAAOgL,UAGhCxnB,EAAO0nF,oBAAoBpnF,GAC3BJ,KAAKsrI,mBAAmBpzH,KAAKpY,GAG/B+rI,oBAAoBhsI,EAA0BC,GAC5CA,EAAOs+B,QAAUv+B,EAAMynB,QACvB,MAAMlnB,EAAWJ,KAAKswE,eAAe7mE,IAAI3J,EAAO2zD,QAAU,aAAe,GACzErzD,EAAQg+B,QAAUt+B,EAAOs+B,QACzBp+B,KAAKswE,eAAe76D,IAClB3V,EAAO2zD,QAAU,WACjBrzD,GAEFJ,KAAKsrI,mBAAmBpzH,KAAKpY,GAG/BgsI,mBAAmBjsI,GACjB,OAAOA,EAAQ8b,OAAOlV,OAAQ3G,IAAsB,IAAhBA,EAAE2nF,WAGxCskD,2BAA2BlsI,GACzB,GAAIA,EAAQgoF,SACV,OAAOhoF,EAAQgoF,SAASniF,IAAK5F,GAAM,IAAMA,GAAGgB,KAAK,MAKrD2gB,gBAAgB5hB,GACdA,EAAM4hB,kBAGRuqH,2BAA2BnsI,GACzBG,KAAK+qI,sBAAwBlrI,EAAMynB,QACnCtnB,KAAKgrI,qBAAqB9yH,KAAKlY,KAAK+qI,uBAGtCkB,4BAA4BpsI,GAC1BG,KAAKksI,6BAA+BrsI,EAAMynB,QAC1CtnB,KAAKmsI,4BAA4Bj0H,KAAKlY,KAAKksI,4EAnNlCnrI,GAAuBrB,wDAAvBqB,EAAuBugB,uGAAvBxhB,2BAA2B,wpDDxCxCJ,iBAEEA,yCAQEA,sBACFA,QACAA,wBAGEA,wBAIEA,iCAgEAA,2BAeJA,QACFA,+BA3FIA,sEAAwD,uBAO3BA,qDAIMA,+CAgE1BA,ioCC3CAqB,MCPAqrI,2HAdF,CACPp/H,KACAiiB,KACAxvB,KACAuvB,KACAE,KACA47F,MACAz7F,KACA4mE,KACAC,MACAvpF,OAIS5L,mDC/BTrB,qBAAyBA,SAASA,8BAATA,mDAczBA,qBAIEA,uBACFA,8BAHEA,uBAEUA,iFAGZA,qBAIEA,wEACAA,uBACFA,gCAHEA,iEAKFA,kCAIEA,sGACFA,gCAHEA,mCAA2B,iFAK7BA,kCAGEA,yDAAwBA,EAAxBomB,MAAwBklH,8BAAxBtrI,CAA0D,0DAE3BA,EAF2BomB,MAE3BqmH,qCAF/BzsI,CAA0D,mFAI5DA,gCALEA,uDAA+C,kJCHxC2sI,iBAgMXtkI,YACUlI,EACAC,EACAM,GAFAJ,uBACAA,qBACAA,2BArLDA,kBAAwC,IAAI+I,IACnD,8BAGO/I,YAAmC,IAAI+I,KAAgB,GAUxD/I,aAAmC,IAAI+I,IAAgB,IAiBtD/I,iBAAwBmqI,GAYxBnqI,iBAAuC,IAAI+I,SAClD,GAMQ/I,0BAAuB,IAAIN,MAK1BM,iCAA8B,IAAIN,MAYpCM,WAAiC,IAAI+I,IAAgB,IAYrD/I,eAAsC,IAAI+I,KAAgB,GAE1D/I,4BAAiC,EACjCA,mCAAwC,EAIxCA,gBAA6B,QAE7BA,gBAAqC,SASrCA,WAAQ,UAERA,kBAAuB,IAKvBA,cAAW,IAKXA,eAAY,EAUZA,qBAAiB,EAKjBA,qBAAiB,EAKjBA,cAAU,EAUTA,sBAAmB,IAAIN,MAKvBM,YAAS,IAAIN,MAQbM,sBAAmB,IAAIN,MAKvBM,kBAAe,IAAIN,MAKnBM,0BAAuB,IAAIN,qBA7HtBG,GACbG,KAAKqqI,cAAcxqI,oBAGnB,OAAOG,KAAKsqI,YAAYxoI,eAoBjBjC,GACPG,KAAKssI,QAAQzsI,cAGb,OAAOG,KAAKw0F,MAAM1yF,mBAQPjC,GACXG,KAAKmsB,UAAUhkB,KAAKtI,kBAGpB,OAAOG,KAAKmsB,UAAUrqB,kBAkGtB,OAA4B,IAArB9B,KAAK20F,KAAKp0F,OAanBigB,WACExgB,KAAKy0F,OAASz0F,KAAKw0F,MAAMpsF,UAAWvI,IAClCG,KAAKua,OAAOpS,UAAc,IAATtI,GAAsC,IAAhBA,EAAKU,UAG9CP,KAAKusI,SAAWvsI,KAAKwsI,QAClBjkI,MACC,QAAU1I,GAA2B,KAATA,EAAc0oF,QAAQkkD,MAAMzsI,KAAKslI,YAE9Dl9H,UAAWvI,GAAiBG,KAAK0sI,UAAU7sI,IAE9CG,KAAK2sI,oBAEL3sI,KAAKuqI,aAAevqI,KAAKsqI,YACtB/hI,MAAK,UACLH,UAAWvI,GAAuBG,KAAKwqI,gBAAgB3qI,IAO5DsY,cACEnY,KAAKy0F,OAAO/rF,cACZ1I,KAAKusI,SAAS7jI,cACd1I,KAAKuqI,aAAa7hI,cASpBkkI,QAAQ/sI,GAEDG,KAAK4/H,WADE//H,EAAMoG,MAKlBjG,KAAKssI,QADSzsI,EAAMunB,OAA4BtlB,OAQlD+qI,qBACE7sI,KAAKkW,QACLlW,KAAK8sI,aAAa50H,OAQpBuyH,mBAAmB5qI,GACjBG,KAAKqqI,cAAcxqI,GAUrBwqI,cAAcxqI,GACZG,KAAKsqI,YAAYniI,KAAKtI,GAGxBktI,yBACE/sI,KAAKgtI,SAAShtI,KAAK20F,MACnB30F,KAAKitI,qBAAqB/0H,OAC1BlY,KAAK2sI,oBAOPL,QAAQzsI,GACN,GAAIG,KAAK4jB,SACP,QAGF/jB,EAAOA,GAAQ,MAEFG,KAAK20F,MAChB30F,KAAKw0F,MAAMrsF,KAAKtI,GAGlB,MAAMC,EAAOD,EAAKsG,QAAQ,aAAc,IAAIsnD,QACxC3tD,EAAKS,QAAUP,KAAKktI,WAA6B,IAAhBptI,EAAKS,SACxCP,KAAKwsI,QAAQrkI,KAAKtI,GAOdqW,QACNlW,KAAKw0F,MAAMrsF,KAAK,IAChBnI,KAAKwsI,QAAQrkI,KAAK,IAClBnI,KAAKmtI,MAAM7qH,cAAc6e,QAMnBy+F,WAAW//H,GACjB,OAAuD,IAAhDkB,EAAmB8+H,YAAY3/H,QAAQL,GAQxC6sI,UAAU7sI,GAChBG,KAAKotI,iBAAiBl1H,KAAKrY,GAC3BG,KAAKgtI,SAASntI,GAGR8sI,oBACN,MAAM9sI,EAAc,IACf,IAAI8F,IACL3F,KAAK0hI,oBACFN,oBACA36H,OAAQrG,IAAQ,CAAC,MAAO,sBAAsBqT,SAASrT,EAAGqzD,UAC1D/tD,IAAKtF,GAAOA,EAAGiyD,aAItB,IAAIvyD,EAAc,6BACS,IAAvBD,EAAYU,OACdT,EAAc,kBAAkBD,EAAY,GAAGkH,4BACf,IAAvBlH,EAAYU,SACrBT,EAAc,wCAEhBE,KAAKqtI,aAAallI,KAAKrI,GAGjB0qI,gBAAgB3qI,GACtB,GAA+C,MAA3CA,EACF,OAGFG,KAAK2qI,iBAAiBzyH,KAAKrY,GAE3B,MAAMC,EAAc,kBAAkBD,EAAWkH,4BACjD/G,KAAKqtI,aAAallI,KAAKrI,GAEvBE,KAAKssI,QAAQtsI,KAAK20F,MAOZq4C,SAASntI,GAMf,IAAIC,EALAE,KAAKstI,eACPttI,KAAKstI,aAAa5nI,IAAKrF,GAAaA,EAASqI,eAC7C1I,KAAKstI,kBAAe,GAIlBttI,KAAKutI,cAAgB1tI,EAAQwO,MAAM,IAAI4W,OAAOjlB,KAAKutI,aAAc,OACnEztI,EAAQD,EAAQ8D,MAAM3D,KAAKutI,cAAc9mI,OAAQpG,GAAMA,EAAEE,QAAUP,KAAKktI,WACpEltI,KAAKoR,OACPpR,KAAKoR,MAAM8E,SAGbpW,EAAQ,CAACD,GAGX,IAAIO,EAAyB,GAC7BN,EAAM4F,IAAKrF,IAEI,MADAA,EAAOA,EAAK8F,QAAQ,aAAc,IAAIsnD,OAAS,IAQ5DrtD,EAAaA,EAAW4F,OAAOhG,KAAK6lI,cAAcryH,OAAOnT,EAAM,CAC7D4tD,QAASjuD,KAAKiuD,gBAPK,IAAfjuD,KAAKoR,OACPpR,KAAKoR,MAAM8E,UASjBlW,KAAKstI,aAAeltI,EAAWsF,IAAKrF,GAC3BA,EAASq+D,QAAQt2D,UAAW9H,IACjCN,KAAKwtI,oBAAoBntI,EAAUC,MAWjCktI,oBAAoB3tI,EAAoBC,GAG9C,GAFAE,KAAKwT,OAAO0E,KAAK,CAAEu1H,WAAUzH,iBAEV,IAAfhmI,KAAKoR,MAAqB,CAC5B,MAAMhR,EAAaJ,KAAKoR,MACrBqJ,MACAhU,OAAQpG,GAAWA,EAAOic,SAAWzc,EAASyc,QAC9CtW,OAAOlG,GACVE,KAAKoR,MAAMuI,WAAWvZ,KA1ZnB,qBAAc,CACnB,UACA,QACA,MACA,YACA,UACA,aACA,mDAXSW,GAAkBrB,wDAAlBqB,EAAkBugB,ktDDrC/B5hB,kCACEA,4BACEA,8BACAA,qBAQEA,iCAASI,cAATJ,CAAyB,8BACbI,uFATdJ,QAUFA,QAEAA,kBACEA,4BAOAA,8CAQAA,yCAOAA,yCAQFA,QACFA,eA/CsCA,mDACpBA,0CAAyB,2BAC3BA,+BAKVA,oDAAyC,mCAAzCA,CAAyC,6GAAzCA,CAAyC,6BAYxCA,6CAKAA,kDAQAA,wCAOAA,gtCCFMqB,MCQA2sI,2HAtBF,CACP1gI,KACAqZ,MACA4I,KACAxvB,KACAuvB,KACAE,KACA47F,MACAj/F,MACA0I,KACA5nB,GACAi+H,GACAwB,OAUSrrI,+BC5CXrB,2CAAuCA,sEAEvCA,qCAA8BA,qCAAuB,uDACrDA,gBAA8EA,SAASA,8BAA9BA,4BAAqBA,kEAE9EA,oBAGEA,mEACAA,sBACFA,uFCWWiuI,iBAyDX5lI,cApCS/H,qBAAiB,EAEhBA,eAAY,IAAIN,MAElBM,YAAS,IAAIi2H,iBAGnB,OAAO11G,GAAevgB,KAAK8W,wBAQ3B,gB5dT+B/V,GACjC,MAAMO,EAAQP,EAAe8X,MAAQ,GACrC,OAAOvX,EAAK6mI,UAAY7mI,EAAK6mI,UAAYrvH,GAAkB/X,EAAQO,EAAKssI,mBAAqB,a4dO3F,CAA0B5tI,KAAK8W,0BAQ/B,OAAO9W,KAAKmoI,UACThiI,QAAQ,qBAAsB,MAC9BA,QAAQ,kBAAmB,eAQ9B,OAAOi+D,GAAcpkE,KAAK8W,QAK5B+2H,gBACE,MAAMhuI,EAAYG,KAAK+nB,OAAO2wC,YAAY14D,KAAK8W,OAAOyS,KAAM,CAC1Ds6B,eAAgB7jD,KAAK8W,OAAOyS,KAAKkgC,WACjC3F,kBAAmB9jD,KAAK0F,IAAI+jD,aAE9Bsc,GAAiB/lE,KAAK0F,IAAK,CAAC7F,GAAYg9C,GAActkC,uDAhE7CxX,8BAA0BugB,4zBDtBvC5hB,yBACEA,6BAEAA,uBACAA,uBAEAA,2BAOAA,SAIFA,eAhBaA,8BAEEA,mCACAA,oCAEJA,qNCgBEqB,8DCXPrB,0FALFA,6BAIEA,2GACAA,iCACFA,+DANiBA,wBAEfA,sCAAkC,yCAGnBA,qCAAqC,wEAIpDA,6GAAeA,4BAAqC,kIAKlDA,qCASEA,2DAASA,EAATomB,OAASgoH,qBAATpuI,CAAkC,uDACvBA,EADuBomB,OACvBioH,uBADXruI,CAAkC,kFAAlCA,CAAkC,0DAGpBA,EAHoBomB,OAGpBgoH,qBAHdpuI,CAAkC,0DAIpBA,EAJoBomB,OAIpBioH,wBAEdruI,YAKFA,+CAjBEA,mBAAW,WAAXA,CAAW,wBAAXA,CAAW,kCAAXA,CAAW,uCAAXA,CAAW,0CAaTA,2DAA0C,mFAMhDA,mBAAsEA,oGACpEA,aAAGA,8BAAqDA,QAC1DA,cADKA,0FAxBLA,iCAuBAA,+EAvB8BA,mBAuBYA,qEApC5CA,oCAQAA,2CAIAA,4EAXGA,kDAAyC,mBCkBpCsuI,SAAZ,OAAYjtI,UAAgB,KAC1BktI,kBACAltI,cAFUitI,GAAZ,IAAYjtI,UAeCmtI,iBAkGXnmI,YAAoBlI,EACAC,GADAE,aACAA,qBA9FbA,sBAAmBguI,GASnBhuI,kBAAqC,GAErCA,eAAkC,GAiBhCA,UAAyBguI,GAAiBC,QAK1CjuI,qBAAiB,EAejBA,qBAAkB,IAAI+I,SAAyB,GAE/C/I,kBAAuB,IAKtBA,iBAAc,IAAIN,MAKlBM,mBAAgB,IAAIN,MAKpBM,kBAAe,IAAIN,MAKnBM,iBAAc,IAAIN,MAQlBM,sBAAmB,IAAIN,MACvBM,sBAAmB,IAAIN,iBAvC/B,OAAOM,KAAKmuI,eAELtuI,GACPG,KAAKmuI,MAAQtuI,EACbG,KAAKouI,aAAe,kBAwCpB,YAAuB,IAAnBpuI,KAAKquI,YACPruI,KAAKquI,UAAYruI,KAAKsuI,eAEjBtuI,KAAKquI,UAad7tH,WACExgB,KAAKygB,QAAU,IAAIC,GAAmB1gB,KAAKoR,MAAOpR,KAAKkf,OAEvDlf,KAAKuuI,iBAAmBvuI,KAAKwuI,gBAAgBpmI,UAAU,KACrDpI,KAAKouI,aAAe,KAQxBj2H,cACEnY,KAAKygB,QAAQvF,UACblb,KAAKuuI,iBAAiB7lI,cASxB+lI,kBAAkB5uI,GAChB,MAAMC,EAAQ,CAACD,EAAMyc,OAAOrN,OACtB7O,EAAQP,EAAMmmI,QAAQzlI,OAC5B,OAAIH,EAAQ,GACVN,EAAMc,KAAK,IAAIR,MAEVN,EAAMgB,KAAK,KASpB4tI,eAAe7uI,GACTG,KAAKoR,MAAM0G,MAAMrO,IAAI5J,KACuB,IAA1CG,KAAKoR,MAAM0G,MAAMrO,IAAI5J,GAAQwgB,WAInCrgB,KAAKoR,MAAM0G,MAAM4B,OAAO7Z,EAAQ,CAACmiC,SAAS,EAAM3hB,UAAU,IAAO,GACjErgB,KAAK2uI,aAAaz2H,KAAKrY,IAQhByuI,cACP,OAAOtuI,KAAKoR,MAAM+L,UAAUxC,OAAOpS,MACjC,QAAU1I,GACkB,IAAnBA,EAAQU,OAAegoF,MAAQ,QAAM,OAE9C,OAAK1oF,GACIG,KAAK4uI,aAAa/uI,EAAQ6F,IAAI5F,GAAKA,EAAE0e,QAAQvD,KAAKjb,KAAK6uI,gBAU5DA,YAAYhvI,EAAkBC,GACpC,OAAOD,EAAGyc,OAAOwyH,aAAehvI,EAAGwc,OAAOwyH,aAQpCF,aAAa/uI,GACnB,MAAMC,EAAU,IAAIuW,IACpB,SAAQvQ,QAAS1F,IACf,MAAMC,EAASD,EAAOkc,OACtB,IAAIhc,EAAgBR,EAAQ2J,IAAIpJ,QACV,IAAlBC,IACFA,EAAgB,GAChBR,EAAQ2V,IAAIpV,EAAQC,IAEtBA,EAAcM,KAAKR,KAGd+D,MAAMgL,KAAKrP,EAAQ+F,QAAQH,IAAKtF,SACK,IAAtCJ,KAAKouI,aAAahuI,EAAOqzD,WAC3BzzD,KAAKouI,aAAahuI,EAAOqzD,SAAW,GAE/B,CAACn3C,SAAQ0pH,QAASlmI,EAAQ2J,IAAIrJ,MAIzC0/G,cAAcjgH,GAEZ,MAAMC,EAAUE,KAAKoR,MAAM8M,kBAAkB6wH,IAE7C,QADsB,MAAPjvI,OAAO,EAAPA,EAAS0f,SACN3f,EAAMmmI,UACoC,IAA1DnmI,EAAMmmI,QAAQnmI,EAAMmmI,QAAQzlI,OAAS,GAAGsY,KAAK4vH,SAGjDxoB,mBAAmBpgH,GACjB,MAAMC,EAA6B,CACjC45C,SAAU75C,EAAMyc,OAAOm3C,QACvB+zE,OAAQxnI,KAAKouI,aAAavuI,EAAMyc,OAAOm3C,UAGzC,IAAIrzD,EAEFA,EADEJ,KAAKutI,cAAgBvtI,KAAK20F,KAAKtmF,MAAM,IAAI4W,OAAOjlB,KAAKutI,aAAc,MAC7DvtI,KAAK20F,KAAKhxF,MAAM3D,KAAKutI,cAErB,CAACvtI,KAAK20F,MAGhB,IAAIt0F,EAAyB,GAC7BD,EAAMsF,IAAKpF,IACTD,EAAaA,EAAW2F,OAAOhG,KAAK6lI,cAAcryH,OAAOlT,EAAMR,MAGjEO,EAAWqF,IAAIpF,IACbA,EAASo+D,QAAQt2D,UAAW5H,IAC1B,MAAMkD,EAAa7D,EAAMmmI,QAAQhgI,OAAOxF,GACnCA,EAAQD,SACXmD,EAAWA,EAAWnD,OAAS,GAAGsY,KAAK4vH,UAAW,GAEpDzoI,KAAKgvI,YAAY92H,KAAK,CAACu1H,WAAUzH,QAAStiI,sDA3OrC3C,GAAsBrB,iDAAtBqB,EAAsBugB,ooCDxCnC5hB,sBACEA,yDAgDFA,eAjDUA,uBAINA,wSCoCSqB,+CCxCbrB,oBAEAA,yEAAmC,kEAAnCA,CAAmC,sHAQnCA,wDAUAA,gCAbAA,qDAA6C,sDAO3CA,wDAAqC,wECO1BuvI,iBAsCXlnI,YAAoBlI,uBArCbG,cAAoC,IAAI+I,IAC7C,kCAKK/I,cAAqC,IAAI+I,KAAgB,GAEzD/I,gBAAuC,IAAI+I,KAAgB,GAE1D/I,wBAAqB,GAIrBA,qBAA0B,EAqB1BA,YAAS,sBALf,OAAOA,KAAK8gC,iBAEJjhC,GACRG,KAAK8gC,OAASjhC,EAShB2gB,WACmC,UAA7BxgB,KAAKy8C,MAAM5jC,KAAKqvH,WAClBloI,KAAKuE,OAGG,IAFNvE,KAAK0F,IAAI2kD,OAAO3lD,UACd7E,GAAOA,EAAI+E,KAAO5E,KAAKy8C,MAAMlzB,KAAKg0B,cAAc34C,KAGtD5E,KAAK6wD,aAAe7wD,KAAK0F,IAAI2lD,eAAeyF,YAAY1oD,UAAUvI,IAChEG,KAAKqwD,qBAAqBxwD,GAC1BG,KAAK2tB,SAASxlB,KAAKnI,KAAKwtF,oBAI5Br1E,cACEnY,KAAK6wD,aAAanoD,cAOpBskF,aAAantF,GACXG,KAAK47E,cAAc/7E,GAOrB+7E,cAAc/7E,GAKZ,QAJuC,IAA5BG,KAAK+2E,oBACdC,aAAah3E,KAAK+2E,oBAGD,eAAfl3E,EAAMiF,OAAyB9E,KAAKotF,eAGxC,OAAQvtF,EAAMiF,UACP,QACE9E,KAAK2sF,WAAW7qF,QACf9B,KAAKuE,MACPvE,KAAKmQ,SAELnQ,KAAKg8B,OAGTh8B,KAAK2sF,WAAWxkF,MAAK,GACrB,UACG,cACEnI,KAAK2sF,WAAW7qF,QAAU9B,KAAKuE,QAClCvE,KAAK+2E,mBAAqBI,WAAW,KACnCn3E,KAAKg8B,MACLh8B,KAAK2sF,WAAWxkF,MAAK,IACpB,MAELnI,KAAKotF,gBAAiB,EACtB,UACG,aACCptF,KAAK2sF,WAAW7qF,QAClB9B,KAAKmQ,SACLnQ,KAAK2sF,WAAWxkF,MAAK,IAEvBnI,KAAKotF,gBAAiB,GAOpBpxD,MACDh8B,KAAKuE,QACRvE,KAAKuE,OAAQ,EACbvE,KAAK+qF,iBAID56E,SACFnQ,KAAKuE,QACPvE,KAAKuE,OAAQ,EACbvE,KAAKgrF,qBACLhrF,KAAKkvI,mBAAmBxpI,IAAI7F,GAAKA,EAAE6I,eACnC1I,KAAKkvI,mBAAqB,IAOtBnkD,gBAKN,QAJiB,IAAb/qF,KAAK0F,KAIL1F,KAAKy8C,MAAM5jC,KAAKqvH,WAAa58B,GAC/B,OAGF,MAAMzrG,EAAgBG,KAAKy8C,MAAqClzB,UACd,IAA9C1pB,EAAa09C,cAAcimB,iBAC7B3jE,EAAa09C,cAAcimB,gBAAiB,GAE9CxjE,KAAKkvI,mBAAmBtuI,KACtBZ,KAAK6gF,aACFtB,iBAAiB1/E,GACjBuI,UAAUtI,GAASE,KAAK0F,IAAI2/D,SAASvlE,KAOpCkrF,qBAKN,QAJiB,IAAbhrF,KAAK0F,KAIL1F,KAAKy8C,MAAM5jC,KAAKqvH,WAAa58B,GAC/B,OAGF,MAAMzrG,EAASG,KAAK0F,IAAIqvE,aAAa/0E,KAAKy8C,MAAMlzB,KAAKg0B,cAAc34C,IACnE5E,KAAK0F,IAAIikE,YAAY9pE,GAGvBwwD,qBAAqBxwD,GAGnBG,KAAKutF,SAASplF,KACZtI,IAHoBG,KAAKy8C,MAAMlzB,KAAKohC,eAAiB,IAGtB9qD,IAFXG,KAAKy8C,MAAMlzB,KAAK0lC,eAAiB,MAMzDu+B,iBACE,OAAIxtF,KAAKuE,MACAvE,KAAKutF,SAASzrF,MACjB,sCACA,8CAEG9B,KAAKutF,SAASzrF,MACjB,iCACA,uFAvLGf,GAA8BrB,oCAA9BqB,EAA8BugB,wpBDrB3C5hB,iCAGCA,6ICkBYqB,MC6BAouI,2HAxBF,CACPniI,KACA+jB,KACA9B,KACAxvB,KACA0vB,KACAH,KACA8C,GACAmS,GACApK,GACAltB,GACAmkB,GACA6rB,OAYS57C,MCFAquI,iBAuCXrnI,YACkBlI,EACRC,EACAM,EACAC,GAHQL,iBACRA,qBACAA,2BACAA,oBAvCFA,wBAAgD,IAAI0+B,GAA0B,IAI9E1+B,qBAAkC,GAClCA,oCAAyC,EAOzCA,mCAAwC,gCAIvCA,kCAAuC,IAKvCA,qCAA0C,YAOjD,OAAOA,KAAKs2B,UAAU5wB,wBAItB,OAAQ1F,KAAKs2B,UAAU5wB,IAAe+jD,WAcxCjpC,WACExgB,KAAKy2E,yBACLz2E,KAAKo4E,0BAELp4E,KAAK0F,IAAIwC,QAAQK,MAAK,QAAK,IAAIH,UAAU,KACvCpI,KAAKoR,MAAQ,IAAIs4D,GAAsB,GAAI,CAAChkE,IAAK1F,KAAK0F,MACtD1F,KAAK6+B,cAIP7+B,KAAKq4E,SAAWr4E,KAAK0F,IAAIktE,QAAQxqE,UAAWvI,IACtCG,KAAKoR,QAAUvR,EAAOgb,KAAK/a,GAAc,2BAATA,EAAE8E,KACpC5E,KAAK6+B,cAUHA,YAcNy5C,GAbct4E,KAAKoR,MAEL,IAAI+zD,GAAY,CAC5B5V,oBAAoB,EACpB3qD,GAAK,yBACLqK,MAAO,uBACP8/C,OAAQ,IACRzyC,OAAQ,IAAI0vC,GACZsE,iBAAiB,EACjBa,YAAY,EACZD,WAAW,EACX7gC,MAAOg/G,MAKXC,wBAIMtvI,KAAKirI,gCAHFjrI,KAAK0hI,oBAAoBN,oBAAoB36H,OAAOo7H,IAAiCthI,OAW9F4X,cACEnY,KAAK02E,2BACL12E,KAAKk5E,4BACLl5E,KAAKuvI,2BACLvvI,KAAKq4E,SAAS3vE,cAOhB0vE,0BACEp4E,KAAKo5E,QAAUp5E,KAAKwvI,mBAAmBlyH,UAAUlV,UAAUvI,IACzDG,KAAKs5E,yBAAyBz5E,KAS1B4vI,6BAA6B5vI,GACnC,MAAMC,EAAsB,GAE5B,SAAQ4F,IAAItF,IACNA,EAAOmpB,KAAKpC,WAAWriB,MAAQ1E,EAAOmpB,KAAKpC,WAAWmmG,UAAY,IAChExtH,EAAoB6G,eAAevG,EAAOmpB,KAAKpC,WAAWriB,MAExD1E,EAAOmpB,KAAKpC,WAAWmmG,SADNxtH,EAAoBM,EAAOmpB,KAAKpC,WAAWriB,MAAMwoH,WAGpExtH,EAAoBM,EAAOmpB,KAAKpC,WAAWriB,MAAQ,CAAEwoH,SAAUltH,EAAOmpB,KAAKpC,WAAWmmG,SAAUr+G,MADlF7O,EAAOyY,KAAKuwH,qBAAuBhpI,EAAOyY,KAAK5J,QAK/DnP,EAAoBM,EAAOmpB,KAAKpC,WAAWriB,MAAQ,CAAEwoH,SAAUltH,EAAOmpB,KAAKpC,WAAWmmG,SAAUr+G,MADlF7O,EAAOyY,KAAKuwH,qBAAuBhpI,EAAOyY,KAAK5J,UAM5DnP,EAODw5E,yBAAyBz5E,GAC/B,MAAMC,EAAsBE,KAAKyvI,6BAA6B5vI,GACxDO,EAAwBwF,OAAOC,KAAK/F,GACpCO,EAAiC,GACjCC,EAAU,GAChBT,EAA4B6F,IAAIlF,IAC9B,MAAMkD,EAAYtD,EAAsBF,QAAQM,EAAO+oB,KAAKpC,WAAWriB,OACrD,IAAdpB,GACFpD,EAAQM,KAAKd,EAAoBU,EAAO+oB,KAAKpC,WAAWriB,MAAMmK,OAC9D7O,EAAsB4E,OAAOtB,EAAW,GACxCrD,EAA+BO,KAAKJ,EAAO+oB,KAAKpC,WAAWriB,QAEiB,IAAxEzE,EAA+BH,QAAQM,EAAO+oB,KAAKpC,WAAWriB,OAChExE,EAAQM,KAAKJ,EAAOqY,KAAKuwH,qBAAuB5oI,EAAOqY,KAAK5J,SAI9D3O,EAAQC,QACVP,KAAK0vI,kBAAkBpvI,EAAQQ,KAAK,OAOhC21E,yBACNz2E,KAAK22E,oBAAsB32E,KAAK0F,IAAIq3C,GAAGj0C,GACrC,cACCjJ,GAAuCG,KAAKw5E,WAAW35E,IAQ5Dq5E,4BACEl5E,KAAKo5E,QAAQ1wE,cAMf6mI,2BACEvvI,KAAK2vI,gBAAgBjqI,IAAI7F,GAAKA,EAAE6I,eAChC1I,KAAK2vI,gBAAkB,GAOjBj5D,4BACN,QAAQ12E,KAAK22E,qBACb32E,KAAK22E,yBAAsB,EAOrB6C,WAAW35E,IAEfA,EAAMi3E,UAAa92E,KAAK4vI,gCACvB5vI,KAAKirI,gCAAiCjrI,KAAKikB,aAAapP,sBAIpB,IAA5B7U,KAAK+2E,qBACdC,aAAah3E,KAAK+2E,oBAClB/2E,KAAK4lE,aACL5lE,KAAKuvI,4BAGPvvI,KAAK8tD,QAAS,SAAUjuD,EAAMo3E,WAAYj3E,KAAKk3E,cAAe,aAE9Dl3E,KAAK+2E,mBAAqBI,WAAW,KACnCn3E,KAAK6vI,sBACJ7vI,KAAK8vI,+BAbN9vI,KAAK4lE,aAqBEipE,YAAYhvI,EAAkBC,GACrC,OAAOD,EAAGyc,OAAOwyH,aAAehvI,EAAGwc,OAAOwyH,aAGtCe,qBACN7vI,KAAKwvI,mBAAmBt5H,QACxB,MAAMrW,EAAUG,KAAK6lI,cAAc5E,cAAcjhI,KAAK8tD,OAAQ,CAAE9hB,OAAQ,CAAEiZ,SAAU,QAAShsC,KAAM,WAAa,GAEhH,UAAWnZ,KAAKD,EACVA,EAAQU,OAAS,GACnBP,KAAK2vI,gBAAgB/uI,KACnBf,EAAQC,GAAG4+D,QAAQt2D,UAAWhI,IAC5BJ,KAAK+vI,SAAS,CAAEtC,SAAU5tI,EAAQC,GAAIkmI,QAAS5lI,OAMjD2vI,SAASlwI,GACf,MAAMC,EAAUD,EAAMmmI,QAChB5lI,EAAaJ,KAAKwvI,mBAAmB/0H,MACxChU,OAAQpG,GAAyBA,EAAOic,SAAWzc,EAAM4tI,SAASnxH,QAClEtW,OAAOlG,GACVE,KAAKwvI,mBAAmB5kI,KAAKxK,EAAW6a,KAAKjb,KAAK6uI,cAO5Ca,kBAAkB7vI,GACxBG,KAAK4lE,aAEL,MAAM9lE,EAAW,IAAIiyE,MACnB,SAAU/xE,KAAK8tD,OAAQ,YAAa9tD,KAAKk3E,gBAErC92E,EAAU,IAAI6xE,KAAU,CAAEhtB,aAC1B5kD,OAAkB0rD,MAAYuY,oBAAoBxkE,EAAU,CAChEgkD,kBAAmB9jD,KAAKk3E,cACxBrzB,eAAgB7jD,KAAKk3E,gBAgBvBl3E,KAAKoR,MAAMk0D,iBAAiB,CAbT,CACjBxgE,KAAM83C,GACNqI,SAAU5kD,EACVopD,WAAYzpD,KAAKk3E,cACjB/vD,WAAY,CACVviB,GAAI5E,KAAKgwI,8BACTC,eAAgBpwI,GAElBgZ,KAAM,CACJjU,GAAI5E,KAAKgwI,+BAEXjzF,GAAI38C,IAE2By8C,GAAclkC,MAM3CitD,aACF5lE,KAAKoR,OACPpR,KAAKoR,MAAMw0D,2DAzSF7kE,GAA6BrB,oEAA7BqB,EAA6BugB,qLAA7BvgB,kBAoTgCA,EAAgCO,GAC3E,OAAO,IAAI84D,MAAc,CACvBtsB,MAAO,IAAIwtB,KAAa,CACtBnnB,IAAK,+CACL61B,QAAS,CAAC,GAAI,MAGhB16D,KAAM,IAAI+qD,KAAa,CACrB/qD,KAAMvO,EAAQ0I,IAAI,kBAClBqxD,UAAW,OACXF,aAAc,SACdH,KAAM,0BACNH,KAAM,IAAIC,KAAa,CAAE9pC,MAAO,SAChCsoD,eAAgB,IAAIxe,KAAa,CAAE9pC,MAAO,6BAC1CuoD,iBAAkB,IAAIvd,KAAe,CAAEhrC,MAAO,4BAA6BgnC,MAAO,IAClF+D,OAAQ,IAAIC,KAAe,CAAEhrC,MAAO,OAAQgnC,MAAO,IACnDyS,UAAU,EACVlP,QAAS,GACTG,SAAS,GACT6R,QAAS,CAAC,IAAK,IAAK,IAAK,aCvVlBkjE,iBAAenmI,iBAExB,MAAO,CACLC,SAAUjJ,EACVkJ,UAAW,CACTq3H,GzBtBC,CACLp3H,QAASkF,GACTzD,WAAYwkI,GACZtkI,KAAM,CAACw7E,KEQF,CACLn9E,QAAS28H,GACTl7H,WAAYykI,GACZvkI,KAAM,CAACkC,KELF,CACL7D,QAASm/H,GACT19H,WAAY0kI,GACZxkI,KAAM,CAACkC,KENF,CACL7D,QAAS0/H,GACTj+H,WAAY2kI,GACZzkI,KAAM,CAACkC,qDmBQEhN,4DAhBF,CACPiM,KACA0gI,GACA9C,GACAuE,GACA/C,IAGAsB,GACA9C,GACAuE,GACA/C,MAKSrrI,MCZAwvI,iBAgBXxoI,YAAoBlI,gBAPVG,cAAW,IAAIN,MAKfM,YAAS,IAAIN,MAOvBi2B,iBACE31B,KAAKkf,MAAMD,gBAMbq5C,UACEt4D,KAAK27B,OAAOzjB,qDA7BHnX,GAAkBrB,uCAAlBqB,EAAkBugB,8MCpB/B5hB,0CAEEA,uBAAe,YAAfA,CAAe,8DDkBJqB,YEdAyvI,GAAkB,IAAI9wI,MAAuB,+BAEnBqB,GACrC,OAAOA,EAAc2G,OAAO6oI,QCajBE,2HATF,CACPzjI,KACAgiB,KACAriB,GACAg+G,OAKS5pH,uBCRqB2vI,GAQhC3oI,YAAsBzG,GACpBue,MAAMve,GADctB,eANbA,wBAA+C,IAAI+I,KAAgB,GAQ1E/I,KAAK0F,IAAI2lD,eAAeyF,YAAY1oD,UAAWvI,IAE3CG,KAAK0uF,mBAAmBvmF,KADtBtI,EAAgBG,KAAKy8C,MAAMkO,eAAiB9qD,EAAgBG,KAAKy8C,MAAMwS,iBAG5CxS,YAVR,OAAOz8C,KAAK4O,QAAQ6tC,gBAE3B,OAAOz8C,KAAK4O,QAAQlJ,IAajCirI,kCACL,YAA4D,KAAf,QAAzCrvI,OAAKm7C,MAAM7tC,QAAQw6B,UAAUwnG,oBAAY,eAAEC,WACtC7wI,KAAKy8C,MAAM7tC,QAAQw6B,UAAUwnG,aAAaC,SAK9CC,kCACL,YAAqE,KAAxB,QAAzCxvI,OAAKm7C,MAAM7tC,QAAQw6B,UAAUwnG,oBAAY,eAAEG,oBACtC/wI,KAAKy8C,MAAM7tC,QAAQw6B,UAAUwnG,aAAaG,kBAK7CC,uBACN,OAAOhxI,KAAK0uF,mBAAmB5sF,WCbtBmvI,iBAQXlpI,YAAoBlI,EAAwCC,GAAxCE,sBAAwCA,qBAFrDA,SAAM,IAAI+I,SAAwB,kBAHvC,OAAO/I,KAAKswE,eAAe7mE,IAAI,YAOjCynI,gBAAgBrxI,EAAoBC,SAClC,IAAyC,KAAd,QAAvBM,IAAMwO,QAAQw6B,iBAAS,eAAEhL,UAAqBv+B,EAAM6mB,WAAW9X,QAAQsc,QACzE,OAGFrrB,EAAM+O,QAAQw6B,UAAYxjC,OAAOU,OAAO,GAAIzG,EAAM+O,QAAQw6B,UACxD,CACE+nG,MAAOtxI,EAAM+E,GACbwsI,YAAavxI,EAAM+E,GACnBw5B,SAAS,IAGb,MAAM/9B,EAAM,IAAIgxI,GAAa,CAC3BzsI,GAAI/E,EAAM+E,GACVqK,MAAOpP,EAAMoP,MACbwtC,QACA/2C,MACAqkC,YAAa/pC,KAAKsxI,mBAAmBzxI,EAAOC,GAC5CunC,YAAa,IAAIN,GAAY,IAC7BluB,KAAM,CACJusG,mBAAe,KAGnB,YAAKH,oBAAoB5kH,EAAKR,GACvBQ,EAGDixI,mBAAmBzxI,EAAoBC,GAC7C,MAAMM,EAAQ,IAAIspE,GAAa,GAAI,CAAChkE,QACpCtF,EAAMglE,UAAUvlE,GAEhB,MAAMQ,EAAkB,IAAIkxI,GAAiC,IACvDjxI,EAAsB,IAAIkxI,GAAgC,IAC1DhxI,EAA0B,IAAIixI,GAAoC,IAClE/tI,EAAyB,IAAI8/G,GAAmC,IAChE5/G,EAAuB5D,KAAK6O,cAAcnE,UAAU,qBAEpD7G,EAAoB,IAAIgmE,GAA8B,CAC1DptB,MAAO,IAAI0oB,GAAY,CACrBpW,OAAQ,IACRzyC,OAAQ,IAAI0vC,GACZ37B,MAAQtsB,GACC2tI,GAA6B9rI,OAAOU,OAAO,GAAI,CAAC+3C,WAAUz6C,EAAsB+d,WAAa,KAEtG2uC,iBAAiB,EACjBa,YAAY,EACZD,WAAW,IAEbxrD,MACA+iE,aAAc,GACd5B,OAAQ7mE,KAAK2xI,SAAW90F,GAActkC,QAAUskC,GAAclkC,KAC9D4sF,MAAM,EACNv9B,SAAS,IAEX,SAAMpqD,YAAYvd,GAAiB,GACnCD,EAAMwd,YAAYtd,GAAqB,GACvCF,EAAMwd,YAAYpd,GAAyB,GAC3CJ,EAAMwd,YAAY/Z,GAAmB,GACrCzD,EAAMwd,YAAYla,GAAwB,GAC1CtD,EAAMwd,YAAY5d,KAAK4xI,+CAA+C,GAC/DxxI,EAGD6kH,oBAAoBplH,EAAyBC,GACnD,MAAMM,EAASN,EAAM4mB,WAAW9X,QAAQs4C,cAAgB,GAElD7mD,EAAYP,EAAM4mB,WAAW9X,QAAQijI,WAAa,GAExD,GAAsB,IAAlBzxI,EAAOG,OAyBT,YAxBAV,EAAUkqC,YAAYzsB,UAAU/U,MAC9B,QAAU7E,GAAsB,IAAfA,EAAInD,SACrB,QAAK,IACL6H,UAAU1E,IACV,MAAME,EAAMF,EAAS,GAAeq5C,GAC9Bl5C,EAAsBD,EAAG6xD,UAC9BhvD,OACC1C,IAAQA,EAAIsgE,WAAW,MACf,aAARtgE,GACAA,IAAQH,EAAG8xD,oBACV3xD,EAAIsK,MAAM,gBACZ3I,IAAI3B,KAEDmN,KAAM,cAAcnN,IACpBkL,MAAOlL,EACP4e,SAAUrK,sBAGdzY,EAAUgZ,KAAKusG,cAAgB,CAC7BzjG,WAAW,EACX1G,MAAM,EACN0L,QAAS9iB,KAKf,MAAMvD,EAAUF,EAAOsF,IAAKhC,KAExBwN,KAAM,cAAcxN,EAAMwN,OAC1BjC,MAAOvL,EAAMknC,MAAQlnC,EAAMknC,MAAQlnC,EAAMwN,KACzCyR,SAAUrK,mBACVyU,QAASrpB,EAAMqpB,WAIbvsB,EAAkBH,EAAUqF,IAAKhC,KAEnCwN,KAAM,cAAcxN,EAASwN,OAC7BjC,MAAOvL,EAASknC,MAAQlnC,EAASknC,MAAQlnC,EAASwN,KAClDyR,SAAUrK,QACVW,KAAMvV,EAASuV,KACf4uB,OAAQnkC,EAASmkC,OACjB/iC,KAAM,WACNioB,QAASrpB,EAASqpB,QAClBvL,QAAS,KACLxhB,KAAK8xI,IAAI3pI,KAAKzE,EAASuL,QAE3B0c,cAAe,MACJomH,YAAc,OAK7BzxI,EAAQM,QAAQJ,GAChBX,EAAUgZ,KAAKusG,cAAgB,CAC7BzjG,WAAW,EACX1G,MAAM,EACN0L,WAGIirH,8CAIN,OAAO,IAAI7C,GAAoC,CAAC5uH,iBAHtBrgB,IACY,IAA7BA,EAAOgY,MAAM2uD,cAAyD,IAAjC3mE,EAAOgY,MAAM6uD,gEA7IlD5lE,GAAmBrB,+CAAnBqB,EAAmBsI,QAAnBtI,EAAmB,qBAFlB,SAEDA,MCIAixI,iBAQXjqI,YACUlI,EACAC,EACAM,EACAC,GAHAL,oBACAA,sBACAA,oBACAA,qBANHA,SAAM,IAAI+I,SAAwB,kBAHvC,OAAO/I,KAAKswE,eAAe7mE,IAAI,YAWjCynI,gBAAgBrxI,EAAmBC,+BACjC,IACGD,EAAM+O,QAAQw6B,WACftpC,EAAIuqD,OAAOxvC,KAAK0sC,GAAOA,EAAI3iD,KAAO/E,EAAM+E,GAAK,2BAC7C/E,EAAM6mB,WAAW9X,QAAQsc,QACzB,OAEF,MAAM83B,EAA4BnjD,EAAM6mB,WAClCu8B,EAAYpjD,EAAM+E,GAAK,wBACvBy+C,EAAYxjD,EAAM+E,GAAK,yBACxB/E,EAAM+O,QAAQ07C,eACjBzqD,EAAM+O,QAAQ07C,aAAe,CAAEU,OAAQ/H,EAAWsH,MAAO,KAE3D,MAAM/G,EAAiB,CACrB2H,gBAAgB,EAChBsqB,cAAc,EACdxqB,UAAW,CAAC5H,GACZl8B,WAAY,CACVw2B,GAAiB+0C,OACjB/0C,GAAiB6M,WAGO,QAAvBpqD,IAAMwO,QAAQw6B,iBAAS,eAAEuhB,gBAC3BnH,EAAer8B,WAAWvmB,KAAK+8C,GAAiB+M,eAEnD,IAAIhH,GAAgB,GACiD,QAAjErjD,EAAC2iD,EAAWp0C,QAA2C+2C,kBAAU,eAAEvnB,WACrEolB,EAAer8B,WAAWvmB,KAAK+8C,GAAiBkN,YAChDnH,GAAgB,IAEU,QAAvBpjD,IAAMsO,QAAQw6B,iBAAS,eAAE6lB,gBAC5BzL,EAAer8B,WAAWvmB,KAAK+8C,GAAiBiN,eAGlD,IAAI3D,EAAsC,GACtCpnD,EAAM+O,QAAQ07C,aAAaC,QAC7BtD,EAAchiD,KAAKC,MAAMD,KAAKE,UAAUtF,EAAM+O,QAAQ07C,aAAaC,SAErEtD,EAAYrmD,KAAK4iD,GAEjB3jD,EAAM+O,QAAQ07C,aAAaU,OAASnrD,EAAM+O,QAAQ07C,aAAaU,OAASnrD,EAAM+O,QAAQ07C,aAAaU,OAAS/H,EAC1GpjD,EAAM+O,QAAQ07C,aAAaC,MAAQtD,EAGrC,IAAIK,EACAwjB,EAAiB,CACnBqmE,MAAOtxI,EAAM+E,GACbwsI,iBAAa,EACbhzG,SAAS,EACTwyG,aAAc,CACZG,kBAAwD,QAArCrtI,EAAuB,QAAvBlD,IAAMoO,QAAQw6B,iBAAS,eAAEwnG,oBAAY,eAAEG,kBAC1DF,SAA+C,QAArChtI,EAAuB,QAAvBD,IAAMgL,QAAQw6B,iBAAS,eAAEwnG,oBAAY,eAAEC,UAEnD9sH,SAAiC,QAAvBhgB,IAAM6K,QAAQw6B,iBAAS,eAAErlB,SACnCC,gBAAwC,QAAvBhgB,IAAM4K,QAAQw6B,iBAAS,eAAEplB,iBAG5C,YAAK68D,aACFtB,iBAAiB,CAChBhwB,oBAAoB,EACpB3qD,GAAIy+C,EACJiH,aAAc,CACZU,OAAQ3H,GAEVja,UAAW0hC,EACXxa,iBAAiB,EACjB7F,QAAS,EACTx7C,MAAOpP,EAAMoP,MACb07C,eAAsC,QAAvBhmD,IAAMiK,QAAQw6B,iBAAS,eAAEuhB,gBAAiB9qD,EAAM8qD,eAAiB,EAChFsE,eAAsC,QAAvBnM,IAAMl0C,QAAQw6B,iBAAS,eAAE6lB,gBAAiBpvD,EAAMovD,eAAiB,IAChF5+B,MAAOrwB,KAAKi5E,aAAa7O,YACvB,CACE9P,KAAM,CACJ7pC,MAAS,6BAEX+qC,OAAQ,CACN/qC,MAAS,6BAEXwhH,OAAQ,CACN33E,KAAM,CACJ7pC,MAAO,6BAET+qC,OAAQ,CACN/qC,MAAO,6BAETs9B,OAAQ,KAGdxQ,cAAe,CACbsJ,SAAU7D,EAAWp0C,QAAQi4C,SAC7B/hD,KAAM,MACN+L,IAAKmyC,EAAWp0C,QAAQm4C,QAAU/D,EAAWp0C,QAAQiC,IACrDuuD,WAAW,EACXyyE,UAAW7uF,EAAWp0C,QAAQijI,UAC9B9oF,WAAa/F,EAAWp0C,QAAuCm6C,WAC/D09B,mBAAyC,QAAvBx/E,IAAM2H,QAAQw6B,iBAAS,eAAEhL,UAAW4kB,EAAWp0C,QAAuC63E,iBACxGz6C,OAAQgX,EAAWp0C,QAAQ63C,UAC3Bd,WAAY//C,OAAOU,OAAO,GAAI08C,EAAWsG,YAAYxnD,MAAO,CAACs8B,QAASslB,IACtEwD,aAAclE,EAAWp0C,QAAQs4C,mBAAgB,KAGpD9+C,UAAWm/C,sBAKV,GAJAznD,EAAIulE,SAAS9d,GACb1nD,EAAMk9C,GAAGk9B,cAAc,CAAE3vB,aAAc,CAAEU,OAAQnrD,EAAM+O,QAAQ07C,aAAaU,OAAQT,MAAOtD,KAAiB,GAC5GM,EAAe7gC,WAAWq2B,GAAGtzB,UAED,QAAvB+9B,IAAM54C,QAAQw6B,iBAAS,eAAEhL,QAG9B,SAAM,IAAIizG,GAAa,CACrBzsI,GAAI/E,EAAM+E,GACVqK,MAAOpP,EAAMoP,MACbwtC,MAAO8K,EACP7hD,MACAqkC,YAAa/pC,KAAKsxI,mBAAmB/pF,EAAgBznD,GACrDunC,YAAa,IAAIN,GAAY,IAC7BluB,KAAM,CACJusG,mBAAe,KAGnBplH,KAAKilH,oBAAoB39D,EAAKC,GAE9BA,EAAe34C,QAAQw6B,UAAUgoG,YAAc7pF,EAAe3iD,GAC9D/E,EAAM+O,QAAQw6B,UAAYxjC,OAAOU,OAAO,GAAIzG,EAAM+O,QAAQw6B,UACxD,CACEhL,SAAS,EACT+yG,MAAOtxI,EAAM+E,GACbwsI,YAAa7pF,EAAe3iD,GAC5BgsI,aAAc,CACZG,kBAAwD,QAArC3pF,EAAuB,QAAvBD,IAAMv4C,QAAQw6B,iBAAS,eAAEwnG,oBAAY,eAAEG,kBAC1DF,SAA+C,QAArCxkF,EAAuB,QAAvBD,IAAMx9C,QAAQw6B,iBAAS,eAAEwnG,oBAAY,eAAEC,UAEnD9sH,SAAiC,QAAvBuoC,IAAM19C,QAAQw6B,iBAAS,eAAErlB,SACnCC,gBAAwC,QAAvBuoC,IAAM39C,QAAQw6B,iBAAS,eAAEplB,yBAGvCg/B,EAAWp0C,QAAQi4C,SACnBS,IAIJA,EAGDgqF,mBAAmBzxI,EAAoBC,GAC7C,MAAMM,EAAQ,IAAIspE,GAAa,GAAI,CAAEhkE,QACrCtF,EAAMglE,UAAUvlE,GAEhB,MAAMQ,EAAkB,IAAIkxI,GAAiC,IACvDjxI,EAAsB,IAAIkxI,GAAgC,IAC1DhxI,EAA0B,IAAIixI,GAAoC,IAClE/tI,EAAyB,IAAI8/G,GAAmC,IAChE5/G,EAAuB5D,KAAK6O,cAAcnE,UAAU,qBAEpD7G,EAAoB,IAAIgmE,GAA8B,CAC1DptB,MAAO,IAAI0oB,GAAY,CACrBpW,OAAQ,IACRzyC,OAAQ,IAAI0vC,GACZ37B,MAAQtsB,GACC2tI,GAA6B9rI,OAAOU,OAAO,GAAI,CAAC+3C,WAAUz6C,EAAsB+d,WAAa,KAEtG2uC,iBAAiB,EACjBa,YAAY,EACZD,WAAW,IAEbxrD,MACA+iE,aAAc,GACd5B,OAAQ7mE,KAAK2xI,SAAW90F,GAActkC,QAAUskC,GAAclkC,KAC9D4sF,MAAM,EACNv9B,SAAS,IAEX,SAAMpqD,YAAYvd,GAAiB,GACnCD,EAAMwd,YAAYtd,GAAqB,GACvCF,EAAMwd,YAAYpd,GAAyB,GAC3CJ,EAAMwd,YAAY/Z,GAAmB,GACrCzD,EAAMwd,YAAYla,GAAwB,GAC1CtD,EAAMwd,YAAY5d,KAAK4xI,+CAA+C,GAC/DxxI,EAGD6kH,oBAAoBplH,EAAyBC,GACnD,MAAMM,EAASN,EAAM4mB,WAAW9X,QAAQs4C,cAAgB,GAElD7mD,EAAYP,EAAM4mB,WAAW9X,QAAQijI,WAAa,GAExD,GAAsB,IAAlBzxI,EAAOG,OAyBT,YAxBAV,EAAUkqC,YAAYzsB,UAAU/U,MAC9B,QAAU7E,GAAsB,IAAfA,EAAInD,SACrB,QAAK,IACL6H,UAAU1E,IACV,MAAME,EAAMF,EAAS,GAAeq5C,GAC9Bl5C,EAAsBD,EAAG6xD,UAC5BhvD,OACC1C,IAAQA,EAAIsgE,WAAW,MACb,aAARtgE,GACAA,IAAQH,EAAG8xD,oBACV3xD,EAAIsK,MAAM,gBACd3I,IAAI3B,KAEDmN,KAAM,cAAcnN,IACpBkL,MAAOlL,EACP4e,SAAUrK,sBAGhBzY,EAAUgZ,KAAKusG,cAAgB,CAC7BzjG,WAAW,EACX1G,MAAM,EACN0L,QAAS9iB,KAKf,MAAMvD,EAAUF,EAAOsF,IAAKhC,KAExBwN,KAAM,cAAcxN,EAAMwN,OAC1BjC,MAAOvL,EAAMknC,MAAQlnC,EAAMknC,MAAQlnC,EAAMwN,KACzCyR,SAAUrK,mBACVyU,QAASrpB,EAAMqpB,WAIbvsB,EAAkBH,EAAUqF,IAAKhC,KAEnCwN,KAAM,cAAcxN,EAASwN,OAC7BjC,MAAOvL,EAASknC,MAAQlnC,EAASknC,MAAQlnC,EAASwN,KAClDyR,SAAUrK,QACVW,KAAMvV,EAASuV,KACf4uB,OAAQnkC,EAASmkC,OACjB/iC,KAAM,WACNioB,QAASrpB,EAASqpB,QAClBvL,QAAS,KACLxhB,KAAK8xI,IAAI3pI,KAAKzE,EAASuL,QAE3B0c,cAAe,MACJomH,YAAc,OAK7BzxI,EAAQM,QAAQJ,GAChBX,EAAUgZ,KAAKusG,cAAgB,CAC7BzjG,WAAW,EACX1G,MAAM,EACN0L,WAIIirH,8CAIN,OAAO,IAAI7C,GAAoC,CAAC5uH,iBAHtBrgB,IACY,IAA7BA,EAAOgY,MAAM2uD,cAAyD,IAAjC3mE,EAAOgY,MAAM6uD,gEAvQlD5lE,GAAmBrB,mEAAnBqB,EAAmBsI,QAAnBtI,EAAmB,qBAFlB,SAEDA,MCzBEmxI,iBAEXnqI,YACSlI,EACAC,EACyBM,GAFzBJ,iBACAA,uBACyBA,YAElCmyI,eACEnyI,KAAKupB,KAAKoS,QAAS,EACnB37B,KAAKm3F,UAAUxkE,MAAM3yB,KAAKupB,KAAKoS,QAGjCy2G,kBACEpyI,KAAKupB,KAAKoS,QAAS,EACnB37B,KAAKm3F,UAAUxkE,MAAM3yB,KAAKupB,KAAKoS,sDAdtB56B,GAA0BrB,6BAK3B8yB,iCALCzxB,EAA0BugB,uQCdzC5hB,iBACEA,eAA0BA,SAEmDA,QAC/EA,QACAA,iBACEA,oBAGEA,gCAASI,sBAAmBJ,eAC9BA,QACAA,oBAEEA,gCAASI,mBAAgBJ,SAC3BA,QACFA,eAd4BA,oJAYCA,sMDCdqB,uBEkBuB2vI,GA+CpC3oI,YACYzG,EACFzB,EACAC,EACAM,GACRyf,MAAMve,GAJItB,eACFA,+BACAA,cACAA,qBAjDDA,wBAA+C,IAAI+I,KAAgB,GAQpE/I,0BAAuB,IAAI29F,KAE5B39F,kBAAey8F,GAGfz8F,iBAAc,IAAI26E,MAAc,CACrCnf,OAAQ,IAAImf,KAAe,CACzBlqD,MAAO,sBACPgnC,MAAO,IAET6C,KAAM,IAAIqgB,KAAa,CACrBlqD,MAAO,sBAETqd,MAAO,IAAI6sC,KAAe,CACxB5sB,OAAQ,EACRyN,OAAQ,IAAImf,KAAe,CACzBlqD,MAAO,sBACPgnC,MAAO,IAET6C,KAAM,IAAIqgB,KAAa,CACrBlqD,MAAO,0BAKLzwB,gCAA8BK,IACD,IAA5BA,EAAOyX,MAAMu6H,WAGdryI,iCAA+BK,IACR,IAAtBA,EAAOyX,MAAMw6H,KAapBtyI,KAAK0F,IAAI2lD,eAAeyF,YAAY1oD,UAAW/H,IAE3CL,KAAK0uF,mBAAmBvmF,KADtB9H,EAAgBL,KAAKy8C,MAAMkO,eAAiBtqD,EAAgBL,KAAKy8C,MAAMwS,iBAO7EjvD,KAAK+kG,YAAc/kG,KAAKglG,oBACxBhlG,KAAK+kG,YAAYvH,gBAAgBx9F,KAAKi9F,aAAaP,OAEnD18F,KAAK0F,IAAIikE,YAAY3pE,KAAK68F,gBAE1B78F,KAAK68F,eAAiB,IAAI13B,GAAY,CACpCvgE,GAAI,iBACJqK,MAAO,UACP8/C,OAAQ,IACRzyC,OAAQ,IAAI0vC,GACZsE,iBAAiB,EACjBa,YAAY,EACZD,WAAW,EACX9nB,UAAW,CACThL,SAAS,iBAvEyB,OAAOp+B,KAAK4O,QAAQ6tC,gBAExC,OAAOz8C,KAAK4O,QAAQlJ,IA0EhCsrI,uBACN,OAAOhxI,KAAK0uF,mBAAmB5sF,MAGjCywI,cAAcjxI,EAASzB,GACrBs3E,WAAW,KACSn3E,KAAKkyB,OAAOD,KAAKigH,GAA4B,CAC7D//G,cAAc,EACd5I,KAAM,CAACzkB,KAAM,YAGLwtB,cAAclqB,UAAUhI,IAChC,IAAe,IAAXA,EAAkB,CACpB,MAAMC,EAAUR,EAAU48C,MAAM/1B,WAAW9X,QAAQsc,QAAQovE,QACrDh6F,EAAYT,EAAU48C,MAAM/1B,WAAW9X,QAAQsc,QAAQsnH,UAC7D,IAAIhyI,EACAkD,EAEFA,EADErD,EACIL,KAAK6O,cAAcnE,UAAU,eAAiBrK,EAAU,IAAMC,EAE9DN,KAAK6O,cAAcnE,UAAU,eAAiBpK,EAGtD,UAAWsD,KAAU/D,EAAUgZ,KAAKusG,cAAcz+F,QAChD,UAAW9iB,KAAYvC,EAAQ6lB,WAAY,CACzC,IAAIpjB,EAAaH,EAAOsN,KACpBnN,EAAW0P,SAAS,iBACtB1P,EAAaA,EAAWJ,MAAM,KAAK,IAEjCI,IAAeF,IAA+B,IAAnBD,EAAO6uI,UACpCjyI,EAAKc,EAAQ6lB,WAAWtjB,IAI1BH,IACFA,GAAOlD,EACPR,KAAK0yI,wBAAwBH,cAAc1yI,EAAW6D,QAI3D,KAGLivI,YAAYrxI,EAASzB,GACnByB,EAAQ4pB,SAAU,EAClB,IAAIprB,EACAM,GAAO,EACX,MAAMC,EAAaR,EAAU48C,MAAM/1B,WAAW9X,QAAQsc,QACtD,UAAW5qB,KAAUT,EAAUgZ,KAAKusG,cAAcz+F,QAQhD,IALoB,SAAhBrmB,EAAOwE,MAAmC,iBAAhBxE,EAAOwE,OACnC9E,KAAK0yI,wBAAwBE,gBAAgBtyI,EAAOuyI,UAAUzqI,UAAU5H,IACtEF,EAAOooB,aAAeloB,KAGb,IAATJ,EACF,UAAWI,KAAYc,EAAQ6lB,WAAY,CACzC,IAAIzjB,EAAapD,EAAO4Q,KAIxB,GAHIxN,EAAW+P,SAAS,iBACtB/P,EAAaA,EAAWC,MAAM,KAAK,IAEjCD,IAAelD,IAA+B,IAAnBF,EAAOmyI,QAAkB,CACtD3yI,EAAKwB,EAAQ6lB,WAAW3mB,GACxBJ,GAAO,EACP,OAKJN,GACFwB,EAAQwxI,oBAAsB7tI,KAAKC,MAAMD,KAAKE,UAAU7D,EAAQ6lB,aAChE7lB,EAAQyxI,kBAAoBzxI,EAAQ2jD,SACpC3jD,EAAQ0xI,MAAQlzI,EAChBD,EAAUkqC,YAAYjyB,MAAMkC,UAAU,CAAEs4H,MAAM,IAC9CzyI,EAAUkqC,YAAY5sB,UAAU1W,OAAOzG,KAAKizI,6BAC5CjzI,KAAKwmG,kBAAkBllG,EAASzB,KAG3ByB,EAAQ+wI,YAAchyI,EAAW6yI,WACpC5xI,EAAQ+wI,YAAa,EACrBryI,KAAK0yI,wBAAwBS,QAAQhrI,MAAK,GAC1CtI,EAAUkqC,YAAYjyB,MAAMkC,UAAU,CAAEq4H,YAAY,IACpDxyI,EAAUkqC,YAAY5sB,UAAU1W,OAAOzG,KAAKozI,4BACxC/yI,EAAWgzI,YAEbrzI,KAAKolG,qBADgB/kG,EAAW6yI,SACQ5xI,EAASzB,IAEjDA,EAAUkqC,YAAYtsB,OAAOnc,GAC7BzB,EAAUkqC,YAAYjyB,MAAM4B,OAAOpY,EAAS,CAAE+wI,YAAY,IAAQ,KAa1ErtC,kBAAkB1jG,EAAoBzB,EAAsBC,GAQ1D,OAPoB,IAAIolG,GAAY,CAClCjI,kBAAc,EACdS,mBAAoB19F,KAAKk9F,qBACzBU,kBAAmB,IAAIjjB,MAAc,IACrCujB,iBAAkBiH,GAAuB7jG,EAAWzB,EAAaC,KAUrEslG,qBAAqB9jG,EAAqCzB,EAASC,GAC/DE,KAAK+kG,YAAYvH,gBAAgBl8F,GACjCtB,KAAKilG,kBAAkBplG,EAASC,GAM5BmlG,kBAAkB3jG,EAASzB,GACjCG,KAAK6lG,wBACL7lG,KAAK8lG,oBAAoBxkG,EAASzB,GAM7BgmG,yBACA7lG,KAAK+kG,cAIN/kG,KAAKqmG,WACPrmG,KAAKqmG,UAAU39F,cAGjB1I,KAAK+kG,YAAYt4B,cAAS,IAMpBq5B,oBAAoBxkG,EAASzB,GACnCG,KAAKqmG,UAAYrmG,KAAK+kG,YAAYtF,KAAKr3F,UAAWtI,IAChDE,KAAKwmG,kBAAkBllG,EAASzB,EAAWC,KAG7CE,KAAK+kG,YAAYt4B,SAASzsE,KAAK0F,IAAIq3C,IAAI,GAQjCypD,kBAAkBllG,EAASzB,EAA6BC,GAC9D,MAAMM,EAAaJ,KAAK0F,IAAIq3C,GAAGuW,UAAUia,gBACzC,IAAIltE,EAAWiB,EAAQ2jD,SAGnBnlD,GACFD,EAAUkqC,YAAYtsB,OAAOnc,GAC7BzB,EAAUkqC,YAAYjyB,MAAM4B,OAAOpY,EAAS,CAAE+wI,YAAY,IAAQ,GAClEhyI,OAAe0rD,MAAYuY,oBAAoBxkE,EAAY,CACzDgkD,kBAAmB1jD,EACnByjD,eAAgB,cAGlBviD,EAAQ2jD,SAAW5kD,GAEnBR,EAAUkqC,YAAYjyB,MAAM4B,OAAOpY,EAAS,CAAEgxI,MAAM,IAAQ,GAG9DhxI,EAAQmoD,WAAa,YAErB,MAAMnpD,EAAYklE,GAAYlkE,EAASlB,EAAWmhD,WAElDvhD,KAAK68F,eAAen2E,WAAWq2B,GAAG7mC,QAClClW,KAAK68F,eAAen2E,WAAWq2B,GAAG6b,WAAWt4D,GAC7CN,KAAK0F,IAAI2/D,SAASrlE,KAAK68F,gBAEvB78F,KAAK6lG,wBACL7lG,KAAKszI,wBAAwBhzI,EAAWgB,EAASzB,GAOnDgnG,iBACE7mG,KAAK0F,IAAIikE,YAAY3pE,KAAK68F,gBAC1B78F,KAAKk9F,qBAAqBhnF,QAC1BlW,KAAK0F,IAAIq3C,GAAGosB,kBAAkBnpE,KAAK2nG,QAMrC2rC,wBAAwBhyI,EAAkCzB,EAASC,GACjEE,KAAK0F,IAAIq3C,GAAGosB,kBAAkBnpE,KAAK2nG,QACnC,MAAMvnG,EAAe,IAAImzI,KAAW,CAACjyI,GAAY,CAAEoQ,QAAQ,IAC3D1R,KAAK2nG,OAAS,IAAIhJ,KAAS,CACzBha,SAAUvkF,IAGZJ,KAAK0F,IAAIq3C,GAAGgsB,eAAe/oE,KAAK2nG,QAChCvnG,EAAa0F,QAAQzF,IACnBA,EAAQ0yD,SAAS/yD,KAAKwzI,eAGxBxzI,KAAK2nG,OAAO7+F,GAAG,YAAczI,UAC3B,MAAMG,EAAyC,QAA5BF,IAAMqkF,SAAS9b,WAAW,UAAE,eAAE9W,cAC7CvxD,GACFR,KAAKwmG,kBAAkB3mG,EAASC,EAAWU,UC/RtCizI,iBAYX1rI,YACUlI,EACAC,EACAM,EACAC,EACAC,EACAE,EACAkD,EACAE,EACDC,GARC7D,oBACAA,sBACAA,qBACAA,sBACAA,uBACAA,YACAA,cACAA,oBACDA,uBAnBFA,SAAM,IAAI+I,SAAwB,GAClC/I,aAAU,IAAI+I,KAAyB,GACvC/I,qBAAkB,IAAI+I,SAA8C,GACpE/I,oCAAiC,IAAI+I,KAAyB,GAC9D/I,cAAU,iBAGf,OAAOA,KAAKswE,eAAe7mE,IAAI,YAcjCynI,gBAAgBrxI,EAAmBC,+BACjC,IAAyC,KAAd,QAAvBM,IAAMwO,QAAQw6B,iBAAS,eAAEhL,WAAiE,IAA7Cv+B,EAAM6mB,WAAW9X,QAAQsc,QAAQkT,QAChF,OAEF,IAAI4kB,EAEFA,EADEnjD,EAAM+O,QAAQw6B,UACJvpC,EAAM+O,QAAQw6B,UAEd,GAEd4Z,EAAUmuF,MAAQtxI,EAAM+E,GACxBo+C,EAAUouF,YAAcvxI,EAAM+E,GAC9Bo+C,EAAU5kB,SAAU,EACpB4kB,EAAUj/B,SAAkC,QAAvB1jB,IAAMuO,QAAQw6B,iBAAS,eAAErlB,SAC9Ci/B,EAAUh/B,gBAAyC,QAAvB1jB,IAAMsO,QAAQw6B,iBAAS,eAAEplB,gBAErD,MAAMi/B,EAA4BpjD,EAAM6mB,WAClC28B,EAAYxjD,EAAM+E,GAAK,wBACvB4+C,EAAY3jD,EAAM+E,GAAK,yBACxB/E,EAAM+O,QAAQ07C,eACjBzqD,EAAM+O,QAAQ07C,aAAe,CAAEU,OAAQ3H,EAAWkH,MAAO,KAE3D,MAAM7G,EAAiB,CACrByH,gBAAgB,EAChBsqB,cAAc,EACdxqB,UAAW,CAACzH,GACZr8B,WAAY,CACVw2B,GAAiB+0C,OACjB/0C,GAAiB6M,WAGO,QAAvBhqD,IAAMoO,QAAQw6B,iBAAS,eAAEuhB,gBAC3BjH,EAAev8B,WAAWvmB,KAAK+8C,GAAiB+M,eAEnD,IAAIzD,GAAgB,GACiD,QAAjEvjD,EAACu/C,EAAWr0C,QAA2C+2C,kBAAU,eAAEvnB,WACrEslB,EAAev8B,WAAWvmB,KAAK+8C,GAAiBkN,YAChD5D,GAAgB,IAEU,QAAvBrjD,IAAMgL,QAAQw6B,iBAAS,eAAE6lB,gBAC5BvL,EAAev8B,WAAWvmB,KAAK+8C,GAAiBiN,eAGlD,IASIkgB,EATAxjB,EAAsC,GAU1C,OATIznD,EAAM+O,QAAQ07C,aAAaC,QAC7BjD,EAAcriD,KAAKC,MAAMD,KAAKE,UAAUtF,EAAM+O,QAAQ07C,aAAaC,SAErEjD,EAAY1mD,KAAK8iD,GAEjB7jD,EAAM+O,QAAQ07C,aAAaU,OAASnrD,EAAM+O,QAAQ07C,aAAaU,OAASnrD,EAAM+O,QAAQ07C,aAAaU,OAAS3H,EAC1GxjD,EAAM+O,QAAQ07C,aAAaC,MAAQjD,EAGrCtnD,KAAK6gF,aACFtB,iBAAiB,CAChB36E,GAAI4+C,EACJ8G,aAAc,CACZU,OAAQxH,GAEVpa,UAAW,CACT+nG,MAAOtxI,EAAM+E,GACbwsI,iBAAa,EACbhzG,SAAS,EACTwyG,aAAc,CACZG,kBAAwD,QAArChtI,EAAuB,QAAvBF,IAAM+K,QAAQw6B,iBAAS,eAAEwnG,oBAAY,eAAEG,kBAC1DF,UAAU,GAEZ9sH,SAAiC,QAAvB/f,IAAM4K,QAAQw6B,iBAAS,eAAErlB,SACnCC,gBAAwC,QAAvBrf,IAAMiK,QAAQw6B,iBAAS,eAAEplB,iBAE5CssC,iBAAiB,EACjB7F,QAAS,EACTx7C,MAAOpP,EAAMoP,MACb07C,eAAsC,QAAvB7H,IAAMl0C,QAAQw6B,iBAAS,eAAEuhB,gBAAiB9qD,EAAM8qD,eAAiB,EAChFsE,eAAsC,QAAvBhoD,IAAM2H,QAAQw6B,iBAAS,eAAE6lB,gBAAiBpvD,EAAMovD,eAAiB,IAChF5+B,MAAOrwB,KAAKi5E,aAAa7O,YACvB,CACE9P,KAAM,CACJ7pC,MAAS,6BAEX+qC,OAAQ,CACN/qC,MAAS,6BAEXwhH,OAAQ,CACN33E,KAAM,CACJ7pC,MAAO,6BAET+qC,OAAQ,CACN/qC,MAAO,6BAETs9B,OAAQ,KAGZxQ,cAAe,CACfsJ,SAAU5D,EAAWr0C,QAAQi4C,SAC7B/hD,KAAM,MACN+L,IAAKoyC,EAAWr0C,QAAQm4C,QAAU9D,EAAWr0C,QAAQiC,IACrDuuD,WAAW,EACXyyE,UAAW5uF,EAAWr0C,QAAQijI,UAC9B9oF,WAAa9F,EAAWr0C,QAAuCm6C,WAC/D/c,OAAQiX,EAAWr0C,QAAQ63C,UAC3Bd,WAAY//C,OAAOU,OAAO,GAAI28C,EAAWqG,YAAYxnD,MAAO,CAACs8B,QAAS6oB,IACtEC,aAAcjE,EAAWr0C,QAAQs4C,mBAAgB,EACjDh8B,QAAS+3B,EAAWr0C,QAAQsc,WAG/B9iB,UAAWm/C,IACVznD,EAAIulE,SAAS9d,GACb1nD,EAAMk9C,GAAGk9B,cAAc,CAAE3vB,aAAc,CAAEU,OAAQnrD,EAAM+O,QAAQ07C,aAAaU,OAAQT,MAAOjD,KAAiB,GAC5GC,EAAe7gC,WAAWq2B,GAAGtzB,UAE7BqhD,EAAM,IAAI4oE,GAAiB,CACzB9uI,GAAI/E,EAAM+E,GACVqK,MAAOpP,EAAMoP,MACbwtC,MAAO8K,EACP7hD,MACAqkC,YAAa/pC,KAAKsxI,mBAAmB/pF,EAAgBznD,GACrDunC,YAAa,IAAIN,GAAY,IAC7BluB,KAAM,CACJusG,mBAAe,IAEhBplH,KAAMA,KAAKkyB,OAAQlyB,KAAK6O,eAC3B7O,KAAKilH,oBAAoBn6C,EAAKvjB,GAE9BA,EAAe34C,QAAQw6B,UAAUgoG,YAAc7pF,EAAe3iD,GAC9D/E,EAAM+O,QAAQw6B,UAAYxjC,OAAOU,OAAO,GAAIzG,EAAM+O,QAAQw6B,UACxD,CACEuqG,qBAGG1wF,EAAWr0C,QAAQi4C,SACnBikB,IAIJA,EAGDwmE,mBAAmBzxI,EAAoBC,GAC7C,MAAMM,EAAQ,IAAIspE,GAAa,GAAI,CAAEhkE,QACrCtF,EAAMglE,UAAUvlE,GAEhB,MAAMQ,EAAkB,IAAIkxI,GAAiC,IACvDjxI,EAAsB,IAAIkxI,GAAgC,IAC1DhxI,EAA0B,IAAIixI,GAAoC,IAClE/tI,EAAyB,IAAI8/G,GAAmC,IAChE5/G,EAAoB,IAAIimE,GAA8B,CAC1DptB,MAAO,IAAI0oB,GAAY,CACrBpW,OAAQ,IACRzyC,OAAQ,IAAI0vC,GACZ37B,WAAO,EACPigC,iBAAiB,EACjBa,YAAY,EACZD,WAAW,IAEbxrD,MACA+iE,aAAc,GACd5B,OAAQ7mE,KAAK2xI,SAAW90F,GAActkC,QAAUskC,GAAclkC,KAC9D4sF,MAAM,EACNv9B,SAAS,IAEX,SAAMpqD,YAAYvd,GAAiB,GACnCD,EAAMwd,YAAYtd,GAAqB,GACvCF,EAAMwd,YAAYpd,GAAyB,GAC3CJ,EAAMwd,YAAYha,GAAmB,GACrCxD,EAAMwd,YAAYla,GAAwB,GAC1CtD,EAAMwd,YAAY5d,KAAK4xI,+CAA+C,GAC/DxxI,EAGD6kH,oBAAoBplH,EAA6BC,GACvD,MAAMM,EAASN,EAAM4mB,WAAW9X,QAAQs4C,cAAgB,GAElD7mD,EAAYP,EAAM4mB,WAAW9X,QAAQijI,WAAa,GAExD,IAAIvxI,EAAegY,mBACf9X,EAAU,GACVkD,EAAU,GACVE,EAAkB,GAEtBpD,EAAU,CAAC,CACT0Q,KAAM,UACNjC,WAAO,EACP0T,SAAUrK,eACVm6H,SAAS,EACT91H,cAAe,IACN,CAAC,CACNi3H,UAAU,EACV36H,KAAM,SACNwX,MAAO,UACP7M,UAA4D,IAAlD9jB,EAAM4mB,WAAW9X,QAAQsc,QAAQ2oH,aAC3CliH,MAAQ9tB,IAAchE,EAAU8yI,YAAY9uI,EAAShE,KAEvD,CACE+zI,UAAU,EACV36H,KAAM,SACNwX,MAAO,OACP7M,UAA4D,IAAlD9jB,EAAM4mB,WAAW9X,QAAQsc,QAAQ4oH,aAC3CniH,MAAQ9tB,IAAchE,EAAU0yI,cAAc1uI,EAAShE,KAEzD,CACE+zI,UAAU,EACV36H,KAAM,QACNwX,MAAO,UACP7M,SAAU5jB,KAAKs4C,QACf3mB,MAAQ9tB,IAAc7D,KAAK+zI,YAAYlwI,EAAShE,KAElD,CACE+zI,UAAU,EACV36H,KAAM,UACNwX,MAAO,UACP7M,SAAU5jB,KAAKs4C,QACf3mB,MAAQ9tB,IAAc7D,KAAKg0I,WAAWn0I,EAAWgE,QAMjC,IAAlBzD,EAAOG,QA4BXmD,EAAUtD,EAAOsF,IAAK7B,IAEpB,IAAIE,EAAS,CACXmN,KAAM,cAAcrN,EAAMqN,OAC1BjC,MAAOpL,EAAM+mC,MAAQ/mC,EAAM+mC,MAAQ/mC,EAAMqN,KACzCyR,SAAUriB,EACVqc,mBAAe,EACfgP,cAAe,KACb,MAAM3nB,EAAY,GAClB,GAAIH,EAAMiB,KACR,SAAU,SAASjB,EAAMiB,SAAU,EAC5Bd,GAGXyuI,SAA2B,IAAlB5uI,EAAM4uI,QACf7rH,QAAS/iB,EAAM+iB,QACfqB,WAAYpkB,EAAMokB,WAClBY,gBAAiBhlB,EAAMglB,gBACvB/jB,KAAMjB,EAAMiB,KACZ4jB,kBAAc,EACdmqH,cAAU,EACVvqH,SAAUzkB,EAAMykB,SAChBu8B,KAAMhhD,EAAMghD,KACZ93B,QAASlpB,EAAMkpB,SAGjB,OAAmB,SAAflpB,EAAMiB,MAAkC,iBAAfjB,EAAMiB,OACjC9E,KAAK4yI,gBAAgB/uI,EAAMgvI,UAAUzqI,UAAUpE,IAC7CD,EAAO2kB,aAAe1kB,EACtBD,EAAO8uI,SAAWhvI,EAAMgvI,WAGrB9uI,IAGTH,EAAkBvD,EAAUqF,IAAK7B,KAE7BqN,KAAM,cAAcrN,EAASqN,OAC7BjC,MAAOpL,EAAS+mC,MAAQ/mC,EAAS+mC,MAAQ/mC,EAASqN,KAClDyR,SAAUrK,QACVW,KAAMpV,EAASoV,KACf4uB,OAAQhkC,EAASgkC,OACjB/iC,KAAM,WACNioB,QAASlpB,EAASkpB,QAClBvL,QAAS,MACyB,IAA5BxhB,KAAKmzI,QAAQxpH,YACf3pB,KAAK8xI,IAAI3pI,KAAKtE,EAASoL,QAG3B0c,cAAe,MACJomH,YAAc,OAK7BruI,EAAQ9C,QAAQgD,GAChBF,EAAQ9C,QAAQJ,GAEhBX,EAAUgZ,KAAKusG,cAAgB,CAC7BzjG,WAAW,EACX1G,MAAM,EACN0L,YAxFA9mB,EAAUkqC,YAAYzsB,UAAU/U,MAC9B,QAAU1E,GAAsB,IAAfA,EAAItD,SACrB,QAAK,IACL6H,UAAUvE,IACV,MAAME,EAAMF,EAAS,GAAek5C,GAC9B/4C,EAAsBD,EAAG0xD,UAC5BhvD,OACC9B,IAAQA,EAAI0/D,WAAW,MACb,aAAR1/D,GACAA,IAAQZ,EAAG2xD,oBACV/wD,EAAI0J,MAAM,gBACd3I,IAAIf,KAEDuM,KAAM,cAAcvM,IACpBsK,MAAOtK,EACPge,SAAUriB,KAGhBT,EAAUgZ,KAAKusG,cAAgB,CAC7BzjG,WAAW,EACX1G,MAAM,EACN0L,QAAS3iB,KAuET4tI,8CAIN,OAAO,IAAI7C,GAAoC,CAAC5uH,iBAHtBrgB,IACY,IAA7BA,EAAOgY,MAAM2uD,cAAyD,IAAjC3mE,EAAOgY,MAAM6uD,kBAKtDotE,YAAYl0I,EAASC,GAC1B,IAAKE,KAAKi0I,gBAAgBp0I,EAASC,GACjC,OAAO,EAGTE,KAAKk0I,kBAAkBr0I,EAASC,GAEhC,IAAIM,EAAMJ,KAAK6O,cAAcnE,UAAU,eAMvC,GAJI5K,EAAU28C,MAAM/1B,WAAW9X,QAAQsc,QAAQovE,UAC7Cl6F,GAAON,EAAU28C,MAAM/1B,WAAW9X,QAAQsc,QAAQovE,SAGhDz6F,EAAQwyI,WAAY,CACtBjyI,GAAON,EAAU28C,MAAM/1B,WAAW9X,QAAQsc,QAAQipH,OAElD,MACM7zI,EAAU,IAAI6J,KADDrK,EAAU28C,MAAM/1B,WAAW9X,QAAQsc,QAAQkpH,YAG9Dp0I,KAAK44D,WAAW/4D,EAASC,EAAWM,EAAKE,OACpC,CAEHF,GADgE,SAA9DN,EAAU28C,MAAM/1B,WAAW9X,QAAQsc,QAAQmpH,eACtC,IAAMv0I,EAAU28C,MAAM/1B,WAAW9X,QAAQsc,QAAQopH,UAAYz0I,EAAQmzI,MAGrElzI,EAAU28C,MAAM/1B,WAAW9X,QAAQsc,QAAQopH,UAGpD,MAAMj0I,EAAYP,EAAU28C,MAAM/1B,WAAW9X,QAAQsc,QAAQmpH,eAEvD7zI,EAAU,IAAI2J,KADErK,EAAU28C,MAAM/1B,WAAW9X,QAAQsc,QAAQqpH,eAGjEv0I,KAAKw0I,cAAc30I,EAASC,EAAWM,EAAKI,EAASH,IAIlDu4D,WAAW/4D,EAASC,EAA6BM,EAAaC,WAE/DP,EAAU28C,MAAM/1B,WAAW9X,QAAQsc,QAAQupH,cAE7C50I,EAAQsnB,WAAWw/E,UAAe9mG,EAAQolD,SAASs+B,YAAY,GAC/D1jF,EAAQsnB,WAAWy/E,SAAc/mG,EAAQolD,SAASs+B,YAAY,IAGhE,UAAW7/E,KAAY7D,EAAQsnB,WAC7B,UAAWvjB,KAAM9D,EAAU28C,MAAM/1B,WAAW9X,QAAQs4C,cAC7CtjD,EAAGsN,OAASxN,IAAyB,QAAbpD,IAAG2nB,kBAAU,eAAEzlB,WAAcoB,EAAGsN,OAASxN,IAAoC,KAAX,QAAblD,IAAGynB,kBAAU,eAAEqsC,eACxFz0D,EAAQsnB,WAAWzjB,GAKhC1D,KAAKs4C,SAAU,EACft4C,KAAKkM,KAAKklC,KAAK,GAAGhxC,IAAOP,EAAQsnB,WAAY,CAAE3d,QAASnJ,IAAW+H,UACjE,KACEpI,KAAKs4C,SAAU,EACfx4C,EAAUiqC,YAAY5sB,UAAUjH,QAChCpW,EAAU+mG,iBACV/mG,EAAUiqC,YAAYpgC,OAAO9J,GAE7B,MAAM6D,EAAU1D,KAAK+P,gBAAgB/B,UAAUgC,QAC7C,gCAEFhQ,KAAK+Q,eAAevB,QAAQ9L,GAE5B1D,KAAK00I,WAAW50I,EAAU28C,MAAsB38C,EAAU28C,MAAM/2C,KAChE1F,KAAKmzI,QAAQhrI,MAAK,GAClBnI,KAAK20I,+BAA+BxsI,MAAK,IAE3CzE,IACE1D,KAAKs4C,SAAU,EACf50C,EAAM2H,MAAM0D,QAAS,EACrB,MAAMnL,EAAsB5D,KAAK+P,gBAAgB/B,UAAUgC,QACzD,8BAEInM,EAAW/D,EAAU28C,MAAM/1B,WAAW9X,QAAQsc,QAAQglC,SAC5D,GAAIrsD,EAAU,CACZ,IAAIE,EACJF,EAASiC,QAAQ9B,IACf,MAAMW,EAAMiB,OAAOC,KAAK7B,GAAS,GAC7BN,EAAM2H,MAAM2D,QAAQyE,SAAS9O,KAC/BZ,EAAOC,EAAQW,GACf3E,KAAK+Q,eAAe1F,MAAMtH,MAGzBA,GACH/D,KAAK+Q,eAAe1F,MAAMzH,QAG5B5D,KAAK+Q,eAAe1F,MAAMzH,KAM3B2uI,cAAc1yI,EAA6BC,GAChDE,KAAKs4C,SAAU,EACft4C,KAAKkM,KAAKvC,OAAO,GAAG7J,IAAO,IAAIsI,UAC7B,KACEpI,KAAKs4C,SAAU,EACf,MAAMl4C,EAAUJ,KAAK+P,gBAAgB/B,UAAUgC,QAC7C,mCAEFhQ,KAAK+Q,eAAevB,QAAQpP,GAE5BJ,KAAK00I,WAAW70I,EAAU48C,MAAsB58C,EAAU48C,MAAM/2C,KAChE,UAAWrF,KAAYR,EAAU48C,MAAM7tC,QAAQ2uC,cAAcs0F,UAC3DhyI,EAAU6F,IAAI2kD,OAAOvkD,QAASxF,IACxBA,EAAM2O,QAAU5O,EAAS4O,OAC3B3O,EAAMomB,WAAWq2B,GAAGtzB,aAK5BrpB,IACEJ,KAAKs4C,SAAU,EACfl4C,EAAMiL,MAAM0D,QAAS,EACnB,MAAM1O,EAAsBL,KAAK+P,gBAAgB/B,UAAUgC,QACzD,8BAEI1P,EAAWT,EAAU48C,MAAM/1B,WAAW9X,QAAQsc,QAAQglC,SAC5D,GAAI5vD,EAAU,CACZ,IAAIE,EACJF,EAASwF,QAAQpC,IACf,MAAME,EAAMgC,OAAOC,KAAKnC,GAAS,GAC7BtD,EAAMiL,MAAM2D,QAAQyE,SAAS7P,KAC/BpD,EAAOkD,EAAQE,GACf5D,KAAK+Q,eAAe1F,MAAM7K,MAGzBA,GACHR,KAAK+Q,eAAe1F,MAAMhL,QAG5BL,KAAK+Q,eAAe1F,MAAMhL,KAM7Bm0I,cAAc30I,EAASC,EAA6BM,EAAaC,EAA+BC,EAAY,iBAE7GR,EAAU28C,MAAM/1B,WAAW9X,QAAQsc,QAAQupH,cAE7C50I,EAAQsnB,WAAWw/E,UAAe9mG,EAAQolD,SAASs+B,YAAY,GAC/D1jF,EAAQsnB,WAAWy/E,SAAc/mG,EAAQolD,SAASs+B,YAAY,IAGhE,UAAW3/E,KAAY/D,EAAQsnB,WAC7B,UAAWtjB,KAAM/D,EAAU28C,MAAM/1B,WAAW9X,QAAQs4C,cAC7CrjD,EAAGqN,OAAStN,IAAyB,QAAbpD,IAAGynB,kBAAU,eAAEzlB,WAAcqB,EAAGqN,OAAStN,IAAoC,KAAX,QAAbF,IAAGukB,kBAAU,eAAEqsC,OAC/E,cAAb1wD,WACI/D,EAAQsnB,WAAWvjB,GAKhC5D,KAAKs4C,SAAU,EACft4C,KAAKkM,KAAK5L,GAAW,GAAGF,IAAOP,EAAQsnB,WAAY,CAAE3d,QAASnJ,IAAW+H,UACvE,KACEpI,KAAKs4C,SAAU,EACft4C,KAAKg0I,WAAWl0I,EAAWD,GAAS,GAEpC,MAAM+D,EAAU5D,KAAK+P,gBAAgB/B,UAAUgC,QAC7C,mCAEFhQ,KAAK+Q,eAAevB,QAAQ5L,GAE5B5D,KAAK00I,WAAW50I,EAAU28C,MAAsB38C,EAAU28C,MAAM/2C,KAEhE,IAAI7B,EAAiB,GACrB,UAAWE,KAAYjE,EAAU28C,MAAM7tC,QAAQ2uC,cAAcs0F,UAC3D/xI,EAAU4F,IAAI2kD,OAAOvkD,QAAS9B,IACxBA,EAAMiL,QAAUlL,EAASkL,QAC3BpL,EAAejD,KAAKoD,GACpBA,EAAM0iB,WAAWq2B,GAAGtzB,aAI1BzpB,KAAK40I,gBAAgBzsI,KAAKtE,IAE5BD,IACE5D,KAAKs4C,SAAU,EACf10C,EAAMyH,MAAM0D,QAAS,EACrB,MAAMlL,EAAsB7D,KAAK+P,gBAAgB/B,UAAUgC,QACzD,8BAEIjM,EAAWjE,EAAU28C,MAAM/1B,WAAW9X,QAAQsc,QAAQglC,SAC5D,GAAInsD,EAAU,CACZ,IAAIC,EACJD,EAAS+B,QAAQnB,IACf,MAAMm+C,EAAMl9C,OAAOC,KAAKlB,GAAS,GAC7Bf,EAAMyH,MAAM2D,QAAQyE,SAASqvC,KAC/B9+C,EAAOW,EAAQm+C,GACf9iD,KAAK+Q,eAAe1F,MAAMrH,MAGzBA,GACHhE,KAAK+Q,eAAe1F,MAAMxH,QAG5B7D,KAAK+Q,eAAe1F,MAAMxH,KAMlCmwI,WAAWn0I,EAA6BC,EAASM,GAAW,GAC1DN,EAAQorB,SAAU,EAClBlrB,KAAKmzI,QAAQhrI,MAAK,GAClBtI,EAAUgnG,iBACVhnG,EAAUkqC,YAAY5sB,UAAUjH,QAE5BpW,EAAQuyI,YACVxyI,EAAUkqC,YAAYpgC,OAAO7J,GAC7BD,EAAUgmG,wBAEV7lG,KAAK20I,+BAA+BxsI,MAAK,KAEpC/H,IACHN,EAAQqnB,WAAarnB,EAAQgzI,oBAC7BhzI,EAAQmlD,SAAWnlD,EAAQizI,0BAEtBjzI,EAAQgzI,2BACRhzI,EAAQizI,mBAInBH,gBAAgB/yI,GACd,IAAIC,EAAMD,EAASgR,IACnB,OAAK/Q,IACHA,EAAME,KAAK6O,cAAcnE,UAAU,eAAiB7K,EAAS2tG,OAGxDxtG,KAAKkM,KAAKzC,IAAS3J,GAAKyI,MAC7B,OAAInI,GACKA,IAET,OAAYA,IACVA,EAAIiL,MAAM0D,QAAS,KACZ3D,KAAWhL,MAUxBs0I,WAAW70I,EAAoBC,WAC7B,MAAMQ,EAAaT,EAAM6mB,WAAWq2B,GAcpCz8C,EAAWuxD,UAbI,CAACnuD,EAAQE,EAAYC,EAAME,EAASC,KACjDnE,EAAM6xD,gBACJ7xD,EAAMk9C,GAAGqO,YACTvrD,EAAM+O,QAAQ2uC,cACdv9C,KAAK2xD,gBACLjuD,EACAE,EACAC,EACAE,EACAC,GACA,KAIJ1D,EAAWmpB,UAEX,UAAW/lB,KAAO5D,EAAIuqD,OACpB,GACE3mD,EAAIkB,KAAO/E,EAAM+E,KACO,QAAxBxE,IAAIwO,QAAQ07C,oBAAY,eAAEU,OAAOv3C,SAAS5T,EAAM+E,GAAG8H,OAAO,EAAG7M,EAAM+E,GAAG1E,QAAQ,KAAO,OAC7D,QAAxBG,IAAIuO,QAAQ07C,oBAAY,eAAEU,OAAOv3C,SAAS,yBAE1C,CACE,MAAM7P,EAAaF,EAAIgjB,WAAWq2B,GAClC,IAAIl5C,EAASD,EAAW2nD,YACxB1nD,EAAOgnH,QAASxkH,MAAO8pC,UACvBvsC,EAAWslD,aAAarlD,IAKhCowI,gBAAgBp0I,EAASC,GACvB,MAAMM,EAAYJ,KAAK+P,gBAAgB/B,UACvC,IAAI3N,EACAC,EACAE,GAAQ,EACZ,SAAUqY,KAAKusG,cAAcz+F,QAAQ7gB,QAAQpC,IACvCA,EAAOiD,eAAe,eAAiBjD,EAAOukB,aAChD3nB,EAAMu0I,GAAiCnxI,EAAOwN,MAC9CtL,OAAOC,KAAMnC,EAAOukB,YAAYniB,QAASlC,IACvC,OAAQA,OACD,YACCF,EAAOukB,WAAWrkB,MAAW/D,EAAQsnB,WAAWxgB,eAAerG,KAAST,EAAQsnB,WAAW7mB,MAC7FE,GAAQ,EACNH,EAAUD,EAAU4P,QAAQ,mCAC5B,CACE8Z,OAAQpmB,EAAOuL,QAGnBjP,KAAK+Q,eAAe1F,MAAMhL,IAE5B,UAEG,WACCR,EAAQsnB,WAAWxgB,eAAerG,IAAQT,EAAQsnB,WAAW7mB,IAAQT,EAAQsnB,WAAW7mB,GAAOoD,EAAOukB,WAAWrkB,KACnHpD,GAAQ,EACRH,EAAUD,EAAU4P,QAAQ,kCAC1B,CACE8Z,OAAQpmB,EAAOuL,MACfnN,MAAO4B,EAAOukB,WAAWrkB,KAG7B5D,KAAK+Q,eAAe1F,MAAMhL,IAE5B,UAEG,WACCR,EAAQsnB,WAAWxgB,eAAerG,IAAQT,EAAQsnB,WAAW7mB,IAAQT,EAAQsnB,WAAW7mB,GAAOoD,EAAOukB,WAAWrkB,KACnHpD,GAAQ,EACRH,EAAUD,EAAU4P,QAAQ,kCAC1B,CACE8Z,OAAQpmB,EAAOuL,MACfnN,MAAO4B,EAAOukB,WAAWrkB,KAG7B5D,KAAK+Q,eAAe1F,MAAMhL,IAE5B,UAEG,YAEDR,EAAQsnB,WAAWxgB,eAAerG,IAAQT,EAAQsnB,WAAW7mB,IAC7DT,EAAQsnB,WAAW7mB,GAAKC,OAASmD,EAAOukB,WAAWrkB,KAEnDpD,GAAQ,EACRH,EAAUD,EAAU4P,QAAQ,mCAC1B,CACE8Z,OAAQpmB,EAAOuL,MACfnN,MAAO4B,EAAOukB,WAAWrkB,KAG7B5D,KAAK+Q,eAAe1F,MAAMhL,IAE5B,UAEG,YAEDR,EAAQsnB,WAAWxgB,eAAerG,IAAQT,EAAQsnB,WAAW7mB,IAC7DT,EAAQsnB,WAAW7mB,GAAKC,OAASmD,EAAOukB,WAAWrkB,KAEnDpD,GAAQ,EACRH,EAAUD,EAAU4P,QAAQ,mCAC1B,CACE8Z,OAAQpmB,EAAOuL,MACfnN,MAAO4B,EAAOukB,WAAWrkB,KAG7B5D,KAAK+Q,eAAe1F,MAAMhL,UAQ/BG,EAGT0zI,kBAAkBr0I,EAASC,GACzBA,EAAU+Y,KAAKusG,cAAcz+F,QAAQ7gB,QAAQ1F,IACvB,SAAhBA,EAAO0E,MAAmBjF,EAAQsnB,WAAW0tH,GAAiCz0I,EAAO8Q,SACvFrR,EAAQsnB,WAAW0tH,GAAiCz0I,EAAO8Q,OACzDrR,EAAQsnB,WAAW0tH,GAAiCz0I,EAAO8Q,OAAOjO,4DA3sB/DlC,GAAuBrB,0HAAvBqB,EAAuBsI,QAAvBtI,EAAuB,qBAFtB,SAEDA,MAmtBb,YAA0CA,GACxC,OAAIA,EAAO0S,SAAS,eACX1S,EAAO4C,MAAM,KAAK,GAEpB5C,mBCrvB6B2vI,GAQpC3oI,YAAsBzG,GACpBue,MAAMve,GADctB,eANbA,wBAA+C,IAAI+I,KAAgB,GAQ1E/I,KAAK0F,IAAI2lD,eAAeyF,YAAY1oD,UAAWvI,IAE3CG,KAAK0uF,mBAAmBvmF,KADtBtI,EAAgBG,KAAKy8C,MAAMkO,eAAiB9qD,EAAgBG,KAAKy8C,MAAMwS,iBAG5CxS,YAVR,OAAOz8C,KAAK4O,QAAQ6tC,gBAE3B,OAAOz8C,KAAK4O,QAAQlJ,IAajCirI,kCACL,YAA4D,KAAf,QAAzCrvI,OAAKm7C,MAAM7tC,QAAQw6B,UAAUwnG,oBAAY,eAAEC,WACtC7wI,KAAKy8C,MAAM7tC,QAAQw6B,UAAUwnG,aAAaC,SAK9CC,kCACL,YAAqE,KAAxB,QAAzCxvI,OAAKm7C,MAAM7tC,QAAQw6B,UAAUwnG,oBAAY,eAAEG,oBACtC/wI,KAAKy8C,MAAM7tC,QAAQw6B,UAAUwnG,aAAaG,kBAK7CC,uBACN,OAAOhxI,KAAK0uF,mBAAmB5sF,WCXtBgzI,iBAQX/sI,YAAoBlI,EAAwCC,GAAxCE,sBAAwCA,qBAFrDA,SAAM,IAAI+I,SAAwB,kBAHvC,OAAO/I,KAAKswE,eAAe7mE,IAAI,YAOjCynI,gBAAgBrxI,EAAoBC,SAClC,IAAyC,KAAd,QAAvBM,IAAMwO,QAAQw6B,iBAAS,eAAEhL,UAAqBv+B,EAAM6mB,WAAW9X,QAAQsc,QACzE,OAGFrrB,EAAM+O,QAAQw6B,UAAYxjC,OAAOU,OAAO,GAAIzG,EAAM+O,QAAQw6B,UACxD,CACE+nG,MAAOtxI,EAAM+E,GACbwsI,YAAavxI,EAAM+E,GACnBw5B,SAAS,IAIb,MAAM/9B,EAAM,IAAI00I,GAAiB,CAC/BnwI,GAAI/E,EAAM+E,GACVqK,MAAOpP,EAAMoP,MACbwtC,QACA/2C,MACAqkC,YAAa/pC,KAAKsxI,mBAAmBzxI,EAAOC,GAC5CunC,YAAa,IAAIN,GAAY,IAC7BluB,KAAM,CACJusG,mBAAe,KAGnB,YAAKH,oBAAoB5kH,EAAKR,GACvBQ,EAIDixI,mBAAmBzxI,EAAoBC,GAC7C,MAAMM,EAAQ,IAAIspE,GAAa,GAAI,CAAChkE,QACpCtF,EAAMglE,UAAUvlE,GAEhB,MAAMQ,EAAkB,IAAIkxI,GAAiC,IACvDjxI,EAAsB,IAAIkxI,GAAgC,IAC1DhxI,EAA0B,IAAIixI,GAAoC,IAClE/tI,EAAyB,IAAI8/G,GAAmC,IAChE5/G,EAAuB5D,KAAK6O,cAAcnE,UAAU,qBAEpD7G,EAAoB,IAAIgmE,GAA8B,CAC1DptB,MAAO,IAAI0oB,GAAY,CACrBpW,OAAQ,IACRzyC,OAAQ,IAAI0vC,GACZ37B,MAAQtsB,GACC2tI,GAA6B9rI,OAAOU,OAAO,GAAI,CAAC+3C,WAAUz6C,EAAsB+d,WAAa,KAEtG2uC,iBAAiB,EACjBa,YAAY,EACZD,WAAW,IAEbxrD,MACA+iE,aAAc,GACd5B,OAAQ7mE,KAAK2xI,SAAW90F,GAActkC,QAAUskC,GAAclkC,KAC9D4sF,MAAM,EACNv9B,SAAS,IAEX,SAAMpqD,YAAYvd,GAAiB,GACnCD,EAAMwd,YAAYtd,GAAqB,GACvCF,EAAMwd,YAAYpd,GAAyB,GAC3CJ,EAAMwd,YAAY/Z,GAAmB,GACrCzD,EAAMwd,YAAYla,GAAwB,GAC1CtD,EAAMwd,YAAY5d,KAAK4xI,+CAA+C,GAC/DxxI,EAGD6kH,oBAAoBplH,EAA6BC,GACvD,MAAMM,EAASN,EAAM4mB,WAAW9X,QAAQs4C,cAAgB,GAElD7mD,EAAYP,EAAM4mB,WAAW9X,QAAQijI,WAAa,GAExD,GAAsB,IAAlBzxI,EAAOG,OAyBT,YAxBAV,EAAUkqC,YAAYzsB,UAAU/U,MAC9B,QAAU7E,GAAsB,IAAfA,EAAInD,SACrB,QAAK,IACL6H,UAAU1E,IACV,MAAME,EAAMF,EAAS,GAAeq5C,GAC9Bl5C,EAAsBD,EAAG6xD,UAC9BhvD,OACC1C,IAAQA,EAAIsgE,WAAW,MACf,aAARtgE,GACAA,IAAQH,EAAG8xD,oBACV3xD,EAAIsK,MAAM,gBACZ3I,IAAI3B,KAEDmN,KAAM,cAAcnN,IACpBkL,MAAOlL,EACP4e,SAAUrK,sBAGdzY,EAAUgZ,KAAKusG,cAAgB,CAC7BzjG,WAAW,EACX1G,MAAM,EACN0L,QAAS9iB,KAKf,MAAMvD,EAAUF,EAAOsF,IAAKhC,KAExBwN,KAAM,cAAcxN,EAAMwN,OAC1BjC,MAAOvL,EAAMknC,MAAQlnC,EAAMknC,MAAQlnC,EAAMwN,KACzCyR,SAAUrK,mBACVyU,QAASrpB,EAAMqpB,WAIbvsB,EAAkBH,EAAUqF,IAAKhC,KAEnCwN,KAAM,cAAcxN,EAASwN,OAC7BjC,MAAOvL,EAASknC,MAAQlnC,EAASknC,MAAQlnC,EAASwN,KAClDyR,SAAUrK,QACVW,KAAMvV,EAASuV,KACf4uB,OAAQnkC,EAASmkC,OACjB/iC,KAAM,WACNioB,QAASrpB,EAASqpB,QAClBvL,QAAS,KACLxhB,KAAK8xI,IAAI3pI,KAAKzE,EAASuL,QAE3B0c,cAAe,MACJomH,YAAc,OAK7BzxI,EAAQM,QAAQJ,GAChBX,EAAUgZ,KAAKusG,cAAgB,CAC7BzjG,WAAW,EACX1G,MAAM,EACN0L,WAIIirH,8CAIN,OAAO,IAAI7C,GAAoC,CAAC5uH,iBAHtBrgB,IACY,IAA7BA,EAAOgY,MAAM2uD,cAAyD,IAAjC3mE,EAAOgY,MAAM6uD,gEAhJlD5lE,GAAuBrB,+CAAvBqB,EAAuBsI,QAAvBtI,EAAuB,qBAFtB,SAEDA,MCfAi0I,iBAgBXjtI,YACUlI,EACAC,EACAM,EACAC,EACAC,GAJAN,iBACAA,2BACAA,2BACAA,+BACAA,+BAlBFA,gBAA6B,GAI3BA,qBAAkB,IAAIN,MACtBM,mBAAgB,IAAIN,MACpBM,oBAAiB,IAAIN,MACrBM,mCAAgC,IAAIN,2BAG5C,OAAOM,KAAKs2B,UAAUllB,MAWxBoP,WACExgB,KAAKq4E,SAAWr4E,KAAK0F,IAAIktE,QACtBrqE,MAAK,OAAa,KAClBH,UAAWvI,GACVG,KAAKi1I,eAAep1I,IAGxBG,KAAKk1I,wBAAwBpD,IAAI1pI,UAAWvI,IAASG,KAAKm1I,gBAAgBj9H,KAAKrY,KAC/EG,KAAKo1I,oBAAoBtD,IAAI1pI,UAAWvI,IAASG,KAAKm1I,gBAAgBj9H,KAAKrY,KAC3EG,KAAKq1I,oBAAoBvD,IAAI1pI,UAAWvI,IAASG,KAAKm1I,gBAAgBj9H,KAAKrY,KAC3EG,KAAK0yI,wBAAwBZ,IAAI1pI,UAAWvI,IAASG,KAAKm1I,gBAAgBj9H,KAAKrY,KAC/EG,KAAK0yI,wBAAwBS,QAAQ/qI,UAAWvI,IAAaG,KAAK84B,cAAc5gB,KAAKrY,KACrFG,KAAK0yI,wBAAwBkC,gBAAgBxsI,UAAWvI,IAAaG,KAAKs1I,eAAep9H,KAAKrY,KAC9FG,KAAK0yI,wBAAwBiC,+BAA+BvsI,UAAWvI,IACrEG,KAAKu1I,8BAA8Br9H,KAAKrY,KAI5CsY,cACEnY,KAAKq4E,SAAS3vE,cACd1I,KAAKmf,WAAWzZ,IAAI7F,GAAYA,EAAS6I,eAGnCusI,eAAep1I,GACrB,MAAMC,EAAiBD,EAAO4G,OAAQjG,GACpCR,KAAKw1I,gBAAgBh1I,IAEjBJ,EAAoBN,EAAe4F,IAAKlF,GAAiBA,EAAMoE,IAE/DvE,EAAkBP,EACrB4F,IAAKlF,GAAuBR,KAAKy1I,qBAAqBj1I,IACtDiG,OAAQjG,QAAmD,IAAdA,GAE1CF,EAAqBN,KAAK01I,eAAej7H,MAC5ChU,OAAQjG,GACAJ,EAAkBF,QAAQM,EAAUoE,IAAM,GAGjDtE,EAAmBC,OAAS,IAC9BD,EAAmBwF,QAAStF,IAC1BA,EAAUupC,YAAY3rB,yBAAyBozH,IAC/ChxI,EAAU6d,eAEZre,KAAK01I,eAAe59H,MAAM6B,WAAWrZ,EAAoB,CAACkf,QAAQ,EAAOa,UAAU,IACnFrgB,KAAK01I,eAAe/3H,WAAWrd,IAG7BD,EAAgBE,OAAS,GAC3BP,KAAK01I,eAAeh4H,WAAWrd,GAI3Bo1I,qBAAqB51I,eAE3B,QAAkB,IAAdG,KADmB01I,eAAejsI,IAAI5J,EAAM+E,IAIhD,IAAI/E,EAAM6mB,sBAAsBy8C,KAA+D,KAAd,QAAhCrjE,IAAM4mB,WAAW9X,QAAQsc,eAAO,eAAEkT,SAEjF,OADep+B,KAAKq1I,oBAAoBnE,gBAAgBrxI,EAAsBG,KAAK0F,KAE9E,GAAI7F,EAAM6mB,sBAAsB8kC,KAA+D,KAAd,QAAhCprD,IAAMsmB,WAAW9X,QAAQsc,eAAO,eAAEkT,SAAkB,CAC1G,IAAKv+B,EAAM6mB,WAAW9X,QAAQ63C,UAAa,OAC3C,MAAM/iD,EAAS1D,KAAKo1I,oBAAoBlE,gBAAgBrxI,EAAqBG,KAAK0F,KAClF,OAAM,MAANhC,KAAQgrF,mBAAmBtmF,UAAWxE,IACnC/D,EAAM6mB,WAAW9X,QAAuCwwD,WAAax7D,EACrEF,EAAO+4C,MAAM/1B,WAAW9X,QAAuCwwD,UAAYx7D,IAEvEF,EACF,GACH7D,EAAM6mB,sBAAsBslC,KACU,IAArCnsD,EAAsBsxD,aACuB,KAAd,QAAhC9wD,IAAMqmB,WAAW9X,QAAQsc,eAAO,eAAEkT,SAEpC,OADmBp+B,KAAKk1I,wBAAwBhE,gBAAgBrxI,EAAsBG,KAAK0F,KAEtF,GAAI7F,EAAM6mB,sBAAsB8kC,KAA+D,KAAd,QAAhClrD,IAAMomB,WAAW9X,QAAQsc,eAAO,eAAEkT,SAExF,OADmBp+B,KAAK0yI,wBAAwBxB,gBAAgBrxI,EAAqBG,KAAK0F,MAOtF8vI,gBAAgB31I,WACtB,MAAMQ,EAAaR,EAAM6mB,WAIzB,OAHIrmB,aAAsB8iE,IAGtB9iE,aAAsB2rD,IAGtB3rD,aAAsBmrD,MAGY,QAA5B1rD,GAFmBO,EAAWuO,SACpC,IACwB+2C,kBAAU,eAAEvnB,eAA0D,KAAnB,QAA5Bh+B,IAAWwO,QAAQ63C,iBAAS,eAAExH,6DArHxEl+C,GAA0BrB,4EAA1BqB,EAA0BugB,wOAA1BvgB,MCHA40I,2HAVF,CACP3oI,SASSjM,MCAA60I,2HAVF,CACP5oI,SASSjM,MCEA80I,2HATF,CACP7oI,KACAgiB,KACAwD,MACA80E,UAKSvmG,MCaA+0I,4HAJA,CfjBJ,CACL5rI,QAASsmI,GACT7kI,WAAYoqI,GACZlqI,KAAM,CAAC+8B,MegBRrZ,SAlBQ,CACPviB,KACAL,GACAk8B,GACA8sG,GACAC,GACAnF,GACAj+G,OAGAmjH,GACAC,GACAnF,GACAoF,MAOS90I,uBCzBmB29B,GAAhC32B,kCAEW/H,uBAA8C,IAAI+I,KAAgB,GAElEo5H,aACHniI,KAAKqlI,kBAAkBl9H,MAAK,GAC5BnI,KAAKkW,0BAK0BwzD,qBAGCA,qBAGFA,QCTzBssE,yBAA6BpP,GAYxC7+H,YAAoBlI,EAA0BC,GAC5C+f,QADkB7f,YAA0BA,cAJtCA,mBACN,sEAKAA,KAAK4O,QAAU5O,KAAK2K,OAAOD,UAAU,2BAA6B,GAClE1K,KAAKi2I,cAAgBj2I,KAAK4O,QAAQiC,KAAO7Q,KAAKi2I,4BAb9C,OAAgC,IAAzBj2I,KAAK4O,QAAQwvB,QAAYA,YAEtBv+B,GACVG,KAAK4O,QAAQwvB,QAAUv+B,EAazBw5C,UACE,OAAOt4C,EAAqBm1I,MAM9BriI,MAAMhU,EAAiCC,EAAsC,IAC3E,MAAMM,EAAmBJ,KAAKm2I,eAAer2I,GAC7C,OAAOE,KAAKkM,KACTzC,IAAYzJ,KAAKi2I,cAAgBp2I,EAAYiB,KAAK,KAAM,CACvDkrC,OAAQ5rC,IAETmI,MAAK,OAAIlI,GAAOL,KAAKo2I,kBAAkB/1I,KAGpC+1I,kBAAkBv2I,GACxB,MAAMC,EAAgB,GACtB,SAASu6F,OAAOv0F,QAAQ1F,IACtBN,EAAcc,KAAKZ,KAAKq2I,YAAYj2I,EAAOP,EAASy2I,cAE/Cx2I,EAGDq2I,eAAet2I,EAAsC,IAE3D,SAAkBumI,kBAAkD,IAAnCvmI,EAAkBumI,cAA6BvmI,EAAkBumI,aAClGvmI,EAAkBo8B,WAAoC,IAA5Bp8B,EAAkBo8B,OAAsBp8B,EAAkBo8B,MACpFp8B,EAAkB02I,gBAA8C,IAAjC12I,EAAkB02I,WAA2B12I,EAAkB02I,WAAa,UAC3G12I,EAAkBsmI,cAA0C,IAA/BtmI,EAAkBsmI,UAAyBtmI,EAAkBsmI,SAC1FtmI,EAAkBwmI,uBAA4D,IAAxCxmI,EAAkBwmI,mBAAkCxmI,EAAkBwmI,kBAErG,IAAIl8H,KAAW,CACpBs0D,WAAY,CACV2nE,aAAcvmI,EAAkBumI,aAAe,OAAS,QACxDD,SAAUtmI,EAAkBsmI,SAAW,aAAe,OACtDlqG,MAAOp8B,EAAkBo8B,MAAQ,OAAS,QAC1Cs6G,WAAY12I,EAAkB02I,WAAa12I,EAAkB02I,WAAa,UAC1ElQ,kBAAmBxmI,EAAkBwmI,kBAAoB,OAAS,WAKhEgQ,YAAYx2I,EAAuBC,GACzC,MAAMM,EAAU,GAChB,SAAiBo2I,KAAK1wI,QAAQzF,IAC5BA,EAAI47B,MAAMn2B,QAAQxF,IAChBF,EAAQQ,KAAKN,OAGV,CACLsE,GAAIqE,IACJgG,MAAOpP,EAAiB22I,KAAK,GAAGC,QAChCn6H,OAAQvb,EAAqBm1I,MAC7BQ,WAAY7Y,GAAqBrhC,MACjCzwD,MAAO,EACPhkB,OAAQ61G,GAAiBlJ,QACzBz7G,KAAM,aACNwwC,WAAY,YACZ6sF,YACAhpB,SAAUztH,EAAiBytH,SAC3Br7D,SAAUpyD,EAAiBoyD,SAC3BhN,SAAUplD,EAAiBolD,SAC3BuxF,KAAM32I,EAAiB22I,KACvBv6G,MAAO77B,EACPs6D,OAAQ76D,EAAiB66D,OACzBi8E,YAAa92I,EAAiB82I,cA7E3B,eAAQ,uDAPJ51I,GAAoBrB,iDAApBqB,EAAoBsI,QAApBtI,EAAoB,eAyB/BykB,WAHCC,MAAU,CACTC,cAAe,MAEjB3kB,oBAOC,MAhCUA,kBCTXA,EACAO,GAEA,OAAO,IAAI00I,GAAqBj1I,EAAMO,OCU3Bs1I,yBAA6BvvD,GAIxCt/E,YACUlI,EACAC,EACRM,EACmBC,GAEnBwf,MAAMxf,EAASD,GALPJ,YACAA,uBAOVyzD,QACE,OAAO1yD,EAAqB6D,GAG9BytD,UACE,OAAOtxD,EAAqB+D,KAMpBwiF,oBACR,MAAO,CACLr4E,MAAO,uBACP68B,UAAW,uDAYft4B,OACE3T,EACAC,GAIAD,GADAA,GADAA,EAAOA,EAAKg3I,SAAS,KAAOh3I,EAAKuD,MAAM,GAAG,GAAMvD,GACpCwkE,WAAW,KAAOxkE,EAAK6M,OAAO,GAAK7M,GACnCsG,QAAQ,KAAM,IAE1B,MAAM/F,EAASJ,KAAK8pI,2BAA2BjqI,EAAMC,GAAW,IAChE,OAAKM,EAAOqJ,IAAI,WAAcrJ,EAAOqJ,IAAI,UAAU4E,MAAM,cAGlDrO,KAAKkM,KACTzC,IAAIzJ,KAAK8rC,UAAW,CAAEE,SAAQ7mB,aAAc,SAC5C5c,MAAK,OAAKlI,GAAqBL,KAAKynI,eAAepnI,EAAUR,MAJvD,QAAG,IAONiqI,2BACNjqI,EACAC,GAEA,OAAO,IAAIqK,KAAW,CACpBs0D,WAAY74D,OAAOU,OACjB,CACEwwI,OAAQj3I,EACRk3I,KAAM,QAER/2I,KAAKgsC,OACLlsC,EAAQksC,QAAU,MAKhBy7F,eAAe5nI,EAAkBC,GACvC,OAAOD,EACJ8D,MAAM,UACN8C,OAAQrG,GAAgBA,EAAIG,OAAS,GACrCmF,IAAKtF,GAAgBJ,KAAKgoI,aAAa5nI,EAAKN,IAGzCkoI,aAAanoI,EAAcC,GACjC,MAAMM,EAAMP,EAAK8D,MAAM,KACjBtD,EAASD,EAAI,GAEbI,EAAWR,KAAKg3I,gBADV52I,EAAI,IAGVsD,EAAa,CACjBuzI,MAAO52I,EACPm8F,MAAO,6BAA+Bx8F,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,sBAAwB,gBAEjGpM,EAAK,CAAC5D,KAAKyzD,QAAS,WAAYpzD,GAAQS,KAAK,KAEnD,MAAO,CACLwb,OAAQtc,KACR6Y,KAAM,CACJqvH,SAAUtrF,GACVh4C,KACAqK,MAAO5O,EACPkoI,MAAOC,GAAsB1oI,EAAK2tD,OAAQptD,GAC1C4Y,KAAM,cAERsQ,KAAM,CACJzkB,KAAM83C,GACN6M,WAAY,YACZxE,WACA99B,aACAtO,KAAM,CACJjU,KACAqK,MAAO5O,KAMP22I,gBAAgBn3I,GACtB,MAAMC,OAAc2kF,MAAQ/rB,YAAY74D,EAAK,CAC3CgkD,eAAgB,YAChBC,kBAAmB,cAErB,MAAO,CACLh/C,KAAMhF,EAAQiyD,cAAcM,UAC5BkxB,YAAazjF,EAAQiyD,cAAcyB,mBAvHhC,YAAK,WACLzyD,OAAO67C,yCAFH77C,GAAoBrB,sCAQrB,uCARCqB,EAAoBsI,QAApBtI,EAAoB,eAuC/BykB,WAHCC,MAAU,CACTC,cAAe,MAEjB3kB,qBAeC,MAtDUA,kBCTXA,EACAO,EACAzB,EACAC,GAEA,OAAO,IAAI82I,GACT71I,EACAO,EACAzB,EACAC,EAAO4K,UAAU,iBAAiBksI,GAAqBhyI,WCD9CsyI,yBAA8B7vD,GAIzCt/E,YACUlI,EACWC,EACnBM,GAEAyf,MAAM/f,EAASM,GAJPJ,YAOVyzD,QACE,OAAO1yD,EAAsB6D,GAG/BytD,UACE,OAAOtxD,EAAsB+D,KAMrBwiF,oBACR,MAAO,CACLr4E,MAAO,kBACP68B,UAAW,6CACXy7C,SAAU,CACR,CACEziF,KAAM,WACNmK,MAAO,eACPiC,KAAM,UACNyK,OAAQ,CACN,CACE1M,MAAO,qCACPnN,MACE,sFACFs8B,SAAS,GAEX,CACEnvB,MAAO,uCACPnN,MACE,8FACFs8B,SAAS,GAEX,CACEnvB,MAAO,8CACPnN,MACE,yMAEFs8B,SAAS,GAEX,CACEnvB,MAAO,wCACPnN,MAAO,4BACPs8B,SAAS,KAIf,CACEt5B,KAAM,cACNmK,MAAO,gBACPiC,KAAM,QACNyK,OAAQ,CACN,CACE1M,MAAO,KACPnN,MAAO,GACPs8B,SAAS,GAEX,CACEnvB,MAAO,KACPnN,MAAO,GACPs8B,SAAS,GAEX,CACEnvB,MAAO,KACPnN,MAAO,GACPs8B,SAAS,KAIf,CACEt5B,KAAM,cACNmK,MAAO,iBACPiC,KAAM,eACNyK,OAAQ,CACN,CACE1M,MAAO,0CACPnN,MAAO,KACPs8B,SAAS,GAEX,CACEnvB,MAAO,uCACPnN,MAAO,KACPs8B,SAAS,KAIf,CACEt5B,KAAM,cACNmK,MAAO,kBACPiC,KAAM,SACNyK,OAAQ,CACN,CACE1M,MAAO,6CACPnN,MAAO,EACPs8B,SAAS,GAEX,CACEnvB,MAAO,8CACPnN,MAAO,EACPs8B,SAAS,OAgBrB5qB,OACE3T,EACAC,GAEA,MAAMM,EAASJ,KAAK8pI,2BAA2BjqI,EAAMC,GAAW,IAChE,OAAKM,EAAOqJ,IAAI,KAGTzJ,KAAKkM,KACTzC,IAAIzJ,KAAK8rC,UAAW,CAAEE,WACtBzjC,MAAK,OAAKlI,GAA8BL,KAAKynI,eAAepnI,EAAUR,QAJhEmM,MAAG,IAON89H,2BACNjqI,EACAC,GAEA,OAAO,IAAIqK,KAAW,CACpBs0D,WAAY74D,OAAOU,OACjB,CACE6D,EAAGnK,KAAK4nI,YAAY/nI,GACpBkoB,OAAQ,QAEV/nB,KAAKgsC,OACLlsC,EAAQksC,QAAU,MAKhBy7F,eAAe5nI,EAA2BC,GAChD,OAAOD,EAAS6F,IAAKtF,GAAwBJ,KAAKgoI,aAAa5nI,EAAMN,IAG/DkoI,aAAanoI,EAAqBC,GACxC,MAAMM,EAAaJ,KAAKioI,kBAAkBpoI,GACpCQ,EAAWL,KAAKg3I,gBAAgBn3I,GAChCS,EAASN,KAAKmpI,cAActpI,GAC5BW,EAAK,CAACR,KAAKyzD,QAAS,QAAS5zD,EAAKs3I,UAAUr2I,KAAK,KAEvD,MAAO,CACLwb,OAAQtc,KACR6Y,KAAM,CACJqvH,SAAUtrF,GACVh4C,KACAqK,MAAOpP,EAAKu3I,aACZn+H,KAAM,aACNsvH,MAAOC,GAAsB1oI,EAAK2tD,OAAQ5tD,EAAKu3I,eAEjD7tH,KAAM,CACJzkB,KAAM83C,GACN6M,WAAY,YACZxE,WACAna,SACA3jB,aACAtO,KAAM,CACJjU,KACAqK,MAAOpP,EAAKu3I,gBAMZnP,kBAAkBpoI,GACxB,MAAO,CACLu3I,aAAcv3I,EAAKu3I,aACnBD,SAAUt3I,EAAKs3I,SACfE,SAAUx3I,EAAKw3I,SACf/5G,MAAOz9B,EAAKy9B,MACZx4B,KAAMjF,EAAKiF,MAIPkyI,gBAAgBn3I,GACtB,MAAO,CACLiF,KAAM,QACNy+E,YAAa,CAAC51B,WAAW9tD,EAAKy3I,KAAM3pF,WAAW9tD,EAAK03I,OAIhDpO,cAActpI,GACpB,MAAO,CACL8tD,WAAW9tD,EAAK23I,YAAY,IAC5B7pF,WAAW9tD,EAAK23I,YAAY,IAC5B7pF,WAAW9tD,EAAK23I,YAAY,IAC5B7pF,WAAW9tD,EAAK23I,YAAY,KAIxB5P,YAAY/nI,GAClB,OAAOG,KAAKy3I,gBAAgB53I,GAOtB43I,gBAAgB53I,GACtB,MAAMC,EAAW+f,MAAM8nE,iBAAiB9nF,EAAM,WAC9C,OAAKC,EAIAA,EAASS,QAIdV,EAAOA,EAAKsG,QAAQ,aAAc,IAClCrG,EAASgG,QAAQ1F,IACfP,GAAQ,KAAOO,EAAM,MAGhBP,GARE,KAJAG,KAAK03I,oBAAoB73I,GAmB5B63I,oBAAoB73I,GAC1B,YAAK+O,QAAQ24E,SAASzhF,QAAQhG,IACN,YAAlBA,EAASoR,MACXpR,EAAS6b,OAAO7V,QAAQ1F,IAClBA,EAAKg+B,SAAiC,iBAAfh+B,EAAK0B,OAE9B1B,EADsB0B,MAAM6B,MAAM,KACzBmC,QAAQxF,IACfT,GAAQ,KAAOS,EAAQ,UAM1BT,GAjQF,YAAK,YACLkB,OAAO67C,yCAFH77C,GAAqBrB,kBAMtB,WAASA,sCANRqB,EAAqBsI,QAArBtI,EAAqB,eA+HhCykB,WAHCC,MAAU,CACTC,cAAe,MAEjB3kB,qBAWC,MA1IUA,kBCRXA,EACAO,EACAzB,GAEA,OAAO,IAAIq3I,GACTn2I,EACAO,EAAOoJ,UAAU,iBAAiBwsI,GAAsBtyI,MACxD/E,OCgBS83I,yBAAkCtwD,GAc7Ct/E,YACUlI,EACAC,EACRM,EACmBC,GAInB,GAFAwf,MAAMxf,EAASD,GALPJ,YACAA,uBAKRA,KAAK43I,qBAAuBv3I,EACxBL,KAAK43I,uBAAyB53I,KAAK43I,qBAAqBnwD,UAC1D,OAGF,MAOM5jF,EAAqB,QAiB3B,GAfK7D,KAAK43I,uBACR1sI,QAAQC,IACN,6FAEFnL,KAAK43I,qBAAuB,CAC1BC,eAdyB,OAezBvgH,OAdgD,CAClD,CAAEpmB,KAAM,OAAQ4mI,aAAc,OAC9B,CAAE5mI,KAAM,WAAY4mI,aAAc,IAAKC,YAAa,QAalDC,aAXwB,8BAYxBC,QAXmB,YAYnBC,YAAar0I,GAEf7D,KAAKk4I,YAAcr0I,EACnBqH,QAAQC,IAAI,iBAAkBnL,KAAK43I,wBAGhC53I,KAAK43I,qBAAqBC,eAG7B,MAAM,IAAIprI,MADR,yHAGJ,IAAKzM,KAAK43I,qBAAqBtgH,OAC7B,MAAM,IAAI7qB,MACR,8GAUJ,GANAzM,KAAK43I,qBAAqBI,aACxBh4I,KAAK43I,qBAAqBI,cAAgB,8BAC5Ch4I,KAAK43I,qBAAqBK,QACxBj4I,KAAK43I,qBAAqBK,SAAW,YAIrCj4I,KAFyB43I,qBAAqBC,eAAe9wI,cAE/C0M,SAAS,mBACvBzT,KAAK43I,qBAAqBI,aACvBjxI,cACA0M,SAAS,kBACZ,CACA,IAAIzP,EACF,2FACF,SAAO,sCACD,IAAIyI,MAAMzI,GAGZhE,KAAK43I,qBAAqBtgH,kBAAkBnzB,QAChDnE,KAAK43I,qBAAqBtgH,OAAS,CAACt3B,KAAK43I,qBAAqBtgH,SAGhEt3B,KAAKm4I,oBACHn4I,KAAK43I,qBAAqBtgH,OAAO/2B,OAAS,EAE5CP,KAAK43I,qBAAqBtgH,OAAOxxB,QAAQ,CAAC9B,EAAOW,KAC/C,GAAI3E,KAAKm4I,sBAAwBn0I,EAAM+zI,aAAyB,IAAVpzI,EACpD,MAAM,IAAI8H,MACR,yGAGJ,IAAKzI,EAAM8zI,aACT,MAAM,IAAIrrI,MACR,mFAKNzM,KAAK43I,qBAAqBM,YACxBl4I,KAAK43I,qBAAqBM,aAAel4I,KAAKk4I,YAGlDzkF,QACE,OAAO1yD,EAA0B6D,GAGnCytD,UACE,OAAOtxD,EAA0B+D,KAGzBwiF,oBACR,MAAO,CACLr4E,MAAO,iBACP68B,UAAW,mDAqBft4B,OACE3T,EACAC,GAEA,MAAMM,EAAsBJ,KAAKutI,aAC/B1tI,EACAG,KAAK43I,qBAAqBtgH,QAEtBj3B,EAASL,KAAKunI,qBAClBznI,GAAW,GACXM,GAKF,OAHAJ,KAAK4O,QAAQo9B,OAAShsC,KAAK4O,QAAQo9B,OAAShsC,KAAK4O,QAAQo9B,OAAS,GAClEhsC,KAAK4O,QAAQo9B,OAAOw7F,KAAO1nI,EAAQ0nI,KAAO/mI,OAAOX,EAAQ0nI,MAAQ,IAG/D,IAAIviH,OAAO,YAAa,KAAKC,KAAKllB,KAAK43I,qBAAqBI,cAErDh4I,KAAKkM,KACTzC,IAAIzJ,KAAK8rC,UAAW,CAAEE,SAAQ7mB,aAAc,SAC5C5c,MACC,OAAIjI,IACF,IAAIE,EAAcR,KAAKynI,eAAeznI,KAAKo4I,eAAe93I,GAAWT,GAKrE,GAJAW,EAAYya,KAAK,CAACvX,EAAGE,IAClBF,EAAEmV,KAAK0vH,MAAQ3kI,EAAEiV,KAAK0vH,OACtB7kI,EAAEmV,KAAK0vH,QAAU3kI,EAAEiV,KAAK0vH,OAAW7kI,EAAEmV,KAAKsvH,UAAYvkI,EAAEiV,KAAKsvH,UAD9B,GACqD,GACvF3nI,EAAYqZ,UACRrZ,EAAYD,OAAS0qB,OAAOjrB,KAAK4O,QAAQo9B,OAAOC,OAAQ,CAC1D,MAAMvoC,EAASunB,OAAOjrB,KAAK4O,QAAQo9B,OAAOC,OAAShhB,OAAOjrB,KAAK4O,QAAQo9B,OAAOw7F,MACxE5jI,EAAkBpD,EAAYD,OACpCC,EAAcA,EAAY4C,MAAM,EAAGM,GAEjClD,EAAYA,EAAYD,OAAS,GAAIsY,KAAK4vH,SADxC/kI,EAASE,EAMf,OAAOpD,KAINR,KAAKkM,KAAKzC,IAAIzJ,KAAK8rC,UAAW,CAAEE,WAAUzjC,QAC/CsmD,KAAIvuD,GACKN,KAAKynI,eAAeznI,KAAKo4I,eAAe93I,GAAWT,KAM1Dw4I,uBACN,IAAIx4I,EAEJ,MAAMC,EAAeE,KAAK43I,qBAAqBI,aACzC53I,EAAc,IAAI6kB,OAAO,YAAa,KAG5C,OAAI,IAFuBA,OAAO,aAAc,KAE7BC,KAAKplB,KACtBD,EAAcksD,MAEZ3rD,EAAY8kB,KAAKplB,KACnBD,EAAciiD,MAGT,IAAIjiD,EAGLu4I,eAAev4I,GACrB,MAAMC,EAAWE,KAAKq4I,uBAChBj4I,EAAU2rD,KACV1rD,EAAcP,EAASs0D,aAAav0D,GAE1C,OADiBoF,KAAKC,WAAU9E,GAAUksH,cAAcjsH,IAIlDktI,aAAa1tI,EAAcC,GACjC,MAAMM,EAAe,GACrB,IAAIC,EAAgBR,EAChBS,EAAM,EAWV,OARAR,EAAOgG,QAAQpC,IACbtD,EAAasD,EAAMwN,MAAQxN,EAAMo0I,aACjC,MAAMl0I,EAAgB,IAAIqhB,OAAOvhB,EAAMq0I,YAAc,OAAQ,KACzDn0I,EAAcshB,KAAK7kB,KACrBC,EAAMoD,EAAMq0I,YAAez3I,GAAO,EAAKA,EACvCD,EAAgBA,EAAcsD,MAAMC,GAAe,MAG3C,IAARtD,GACFF,EAAaN,EAAO,GAAGoR,MAAQrR,EACxBO,IAETC,EAAgBR,EAEhB,IADwBC,GAAQ+Z,UACpB/T,QAAQpC,IAClB,MAAME,EAAgB,IAAIqhB,OAAOvhB,EAAMq0I,aAAe,OAAa,KACnE,GAAI13I,GAAmC,KAAlBA,EAAsB,CACzC,MAAMwD,EAASxD,EAAcsD,MAAMC,GACnCvD,EAAgBwD,EAAO,GACnBA,EAAO,KACTzD,EAAasD,EAAMwN,MAAQrN,EAAO,GAAG4pD,WAIpCrtD,GAGDmnI,qBACN1nI,EACAC,GAEA,MAAMM,EAAaJ,KAAK43I,qBAAqBC,eAC1C9wI,cACA0M,SAAS,kBACR,QACA,QACJ,OAAO,IAAItJ,KAAW,CACpBs0D,WAAY74D,OAAOU,OACjB,CACEq4D,QAAS,MACTrzD,QAASlL,EACTs+D,QAAS,aACTm5E,eAAgB73I,KAAK43I,qBAAqBC,eAC1CI,QAASj4I,KAAK43I,qBAAqBK,QACnCD,aAAch4I,KAAK43I,qBAAqBI,cAE1Cl4I,EACAE,KAAKgsC,OACLnsC,EAAQmsC,QAAU,MAKhBy7F,eACN5nI,EAAiCC,GAEjC,OAAOD,EAAS8kF,SAASj/E,IAAKtF,GACrBJ,KAAKgoI,aAAa5nI,EAAMN,IAI3BkoI,aAAanoI,EAAyBC,GAC5C,MAAMM,EAAaJ,KAAKioI,kBAAkBpoI,GACpCQ,EAAK,CAACL,KAAKyzD,QAASrzD,EAAW0E,KAAMjF,EAAK+E,IAAI9D,KAAK,KACnDR,EAAQT,EAAKsnB,WAAWnnB,KAAK43I,qBAAqBM,aACpDl4I,KAAK43I,qBAAqBM,YAC1Bl4I,KAAKk4I,YACT,MAAO,CACL57H,OAAQtc,KACRupB,KAAM,CACJzkB,KAAM83C,GACN6M,WAAY,YACZxE,SAAUplD,EAAKolD,SAEf99B,aACAtO,KAAM,CACJjU,KACAqK,MAAOpP,EAAKsnB,WAAW7mB,KAG3BuY,KAAM,CACJqvH,SAAUtrF,GACVh4C,KACAqK,MAAOpP,EAAKsnB,WAAWlY,MACvBk5H,UAAWtoI,EAAKsnB,WAAW7mB,GAC3B2Y,KAAM,aACNsvH,MACAC,GAAsB1oI,EAAK2tD,OADnB5tD,EAAKsnB,WAAWlY,MACWpP,EAAKsnB,WAAWlY,MAChBpP,EAAKsnB,WAAW7mB,MAMjD2nI,kBAAkBpoI,GASxB,OARmB+F,OAAOU,OACxB,GACAC,aACE1G,EAAKsnB,WACLpmB,EAA0B2nI,qBAE5B,CAAElsC,MAAO,6BAA+Bx8F,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,sBAAwB,kBA1TpG,YAAK,gBACLjP,OAAO67C,GACP77C,sBAAgC,CACrC,YACA,KACA,UACA,iDARSA,GAAyBrB,sCAkB1B,uCAlBCqB,EAAyBsI,QAAzBtI,EAAyB,eAuIpCykB,WAHCC,MAAU,CACTC,cAAe,MAEjB3kB,qBA+CC,MAtLUA,MA4UAu3I,yBAAyCjxD,GASpDt/E,YACUlI,EACAC,EACRM,EACmBC,GAKnB,GAHAwf,MAAMxf,EAASD,GALPJ,YACAA,uBAKRA,KAAK43I,qBAAuBv3I,EAEvBL,KAAK43I,wBAAyB53I,KAAK43I,sBAAyB53I,KAAK43I,qBAAqBnwD,WAI3F,KAAKznF,KAAK43I,qBAAqBC,eAG7B,MAAM,IAAIprI,MADR,yHAGJ,IAAKzM,KAAK43I,qBAAqBW,UAC7B,MAAM,IAAI9rI,MACR,oGAGJ,IAAKzM,KAAK43I,qBAAqBY,SAC7B,MAAM,IAAI/rI,MACR,kGAIJzM,KAAK43I,qBAAqBI,aACxBh4I,KAAK43I,qBAAqBI,cAAgB,8BAC5Ch4I,KAAK43I,qBAAqBK,QACxBj4I,KAAK43I,qBAAqBK,SAAW,YACvCj4I,KAAK43I,qBAAqBM,YACxBl4I,KAAK43I,qBAAqBM,aAAel4I,KAAKk4I,aAGlDzkF,QACE,OAAO1yD,EAAiC6D,GAG1CytD,UACE,OAAOtxD,EAAiC+D,KAGhCwiF,oBACR,MAAO,CACLr4E,MAAO,2BACP68B,UAAW,mDAafm1F,cACEphI,EACAC,GAEA,MAAMM,EAASJ,KAAKunI,qBAAqB1nI,EAAQC,GAAW,IAE5D,OACE,IAAImlB,OAAO,YAAa,KAAKC,KAAKllB,KAAK43I,qBAAqBI,cAErDh4I,KAAKkM,KACTzC,IAAIzJ,KAAK8rC,UAAW,CAAEE,SAAQ7mB,aAAc,SAC5C5c,MACC,OAAIlI,GACKL,KAAKynI,eAAeznI,KAAKo4I,eAAe/3I,MAI9CL,KAAKkM,KAAKzC,IAAIzJ,KAAK8rC,UAAW,CAAEE,WAAUzjC,QAC/CsmD,KAAIxuD,GACKL,KAAKynI,eAAeznI,KAAKo4I,eAAe/3I,MAM/Cg4I,uBACN,IAAIx4I,EAEJ,MAAMC,EAAeE,KAAK43I,qBAAqBI,aACzC53I,EAAc,IAAI6kB,OAAO,YAAa,KAG5C,OAAI,IAFuBA,OAAO,aAAc,KAE7BC,KAAKplB,KACtBD,EAAcksD,MAEZ3rD,EAAY8kB,KAAKplB,KACnBD,EAAciiD,MAGT,IAAIjiD,EAGLu4I,eAAev4I,GACrB,MAAMC,EAAWE,KAAKq4I,uBAChBj4I,EAAU2rD,KACV1rD,EAAcP,EAASs0D,aAAav0D,GAE1C,OADiBoF,KAAKC,WAAU9E,GAAUksH,cAAcjsH,IAIlDknI,qBACN1nI,EACAC,GAEA,MAAMM,EAAgB,GACtB,SAAcJ,KAAK43I,qBAAqBW,WAAa14I,EAAO,GAC5DO,EAAcJ,KAAK43I,qBAAqBY,UAAY34I,EAAO,GAEpD,IAAIsK,KAAW,CACpBs0D,WAAY74D,OAAOU,OACjB,CACEq4D,QAAS,MACTrzD,QAAS,QACTozD,QAAS,aACTm5E,eAAgB73I,KAAK43I,qBAAqBC,eAC1CI,QAASj4I,KAAK43I,qBAAqBK,QACnCD,aAAch4I,KAAK43I,qBAAqBI,cAE1C53I,EACAJ,KAAKgsC,OACLlsC,EAAQksC,QAAU,MAKhBy7F,eACN5nI,GAEA,OAAOA,EAAS8kF,SAASj/E,IAAK5F,GACrBE,KAAKgoI,aAAaloI,IAIrBkoI,aAAanoI,GACnB,MAAMC,EAAaE,KAAKioI,kBAAkBpoI,GACpCO,EAAK,CAACJ,KAAKyzD,QAAS3zD,EAAWgF,KAAMjF,EAAK+E,IAAI9D,KAAK,KACnDT,EAAQR,EAAKsnB,WAAWnnB,KAAK43I,qBAAqBM,aACpDl4I,KAAK43I,qBAAqBM,YAC1Bl4I,KAAKk4I,YAET,MAAO,CACL57H,OAAQtc,KACRupB,KAAM,CACJzkB,KAAM83C,GACN6M,WAAY,YACZxE,SAAUplD,EAAKolD,SACf99B,aACAtO,KAAM,CACJjU,KACAqK,MAAOpP,EAAKsnB,WAAW9mB,KAG3BwY,KAAM,CACJqvH,SAAUtrF,GACVh4C,KACAqK,MAAOpP,EAAKsnB,WAAW9mB,GACvB4Y,KAAM,eAKJgvH,kBACNpoI,GAEA,MAAMC,EAAayG,aACjB1G,EAAKsnB,WACLpmB,EAAiC2nI,qBAE7BtoI,EAAU,CACdo8F,MAAO,6BAA+Bx8F,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,sBAAwB,gBAEvG,OAAOpK,OAAOU,OAAOxG,EAAY,CAAEgF,KAAMjF,EAAKsnB,WAAWsxH,UAAYr4I,IA7LhE,YAAK,uBACLW,OAAO67C,GACP77C,sBAAgC,yCAJ5BA,GAAgCrB,sCAajC,uCAbCqB,EAAgCsI,QAAhCtI,EAAgC,eAsE3CykB,WAHCC,MAAU,CACTC,cAAe,MAEjB3kB,4BAuBC,MA7FUA,kBChWXA,EACAO,EACAzB,EACAC,GAEA,OAAO,IAAI63I,GACT52I,EACAO,EACAzB,EACAC,EAAO4K,UAAU,iBAAiBitI,GAA0B/yI,mBAsB9D7D,EACAO,EACAzB,EACAC,GAEA,OAAO,IAAIw4I,GACTv3I,EACAO,EACAzB,EACAC,EAAO4K,UAAU,iBAAiB4tI,GAAiC1zI,mBC7BxB7D,GAC7C,OAAOA,EAAGgpC,YAAY7rB,kBAAkB6wH,IAAqCxvH,QAAQhX,MACnF,OAAKjH,GAAoBA,EAAS,+CAAiD,+DAIrDP,GAChC,OAAOA,EAAGgpC,YAAY5sB,UAAUnC,QAAS1Z,IACN,IAA1BA,EAAOwW,MAAMuI,UACnB9X,MACD,OAAKjH,GAAsCA,EAASf,QAAU,8BCXlEb,aAA0BA,SAAgBA,8BAAhBA,gCCpB1B,MAOag5I,GAA4BxuG,cAPlB,CACrB,CACEp/B,KAAM,aACNwrB,UCEJ,MAAM,QA0BJvuB,YACUlI,EACAC,EACAM,EACAC,GAHAL,uBACAA,yBACAA,oBACAA,oBA5BHA,uBAA4B,EAC5BA,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,GAEb8kD,WAAW,KAIR9yE,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,EACN5S,SAAU,KAiBVr7D,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,QAEPsD,UAAU9H,IACTN,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,MACPqN,OAAQhc,mBArBhB,OAAON,KAAKikB,aAAatP,+BAIzB,OAAO3U,KAAKikB,aAAapP,gBAuB3B8jI,cAAc94I,GACZG,KAAK44I,aAAe/4I,gDA/CXkB,GAAqBrB,kEAArBqB,EAAqBugB,sXFVlC5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,sBAAUA,QAC1BA,4BACEA,cAAIA,yCAA6BA,QAEjCA,cACAA,qBAAQA,gBAAgGA,iCAAoBA,QAC5HA,eACFA,QAEAA,8BAGAA,gDAAwBI,qBACtBJ,+BACAA,8BACAA,mCACAA,qCACAA,kCACAA,mCACFA,QAEFA,QAEAA,8BAdmBA,6BAAW,cAAXA,CAAW,4CAIRA,6CACDA,4BACKA,4BACEA,4BACHA,4BAAW,uBACVA,4BAKtBA,iLEfSqB,GAAb,MCWO,IAAM83I,GAAb,MAAM,sDAAO93I,4DATF,CACPiM,KACA0rI,GACAtpH,KACAJ,KACAomG,OAISr0H,GAAb,6BCGQrB,iCACAA,iCACAA,mCACAA,oCACAA,4DAJqBA,iBACAA,0BACEA,4BAAe,WACdA,4BAAe,WACbA,0BAAe,oBCvBjD,MAOao5I,GAAwB5uG,cAPd,CACrB,CACEp/B,KAAM,QACNwrB,UCWJ,MAAM,QAeJvuB,YACUlI,EACAC,EACAM,GAFAJ,uBACAA,yBACAA,oBAjBHA,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,MAKVhuB,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdiF,mBAAoB,EAAC,KAAW,MAAS,KAAU,KACnDrG,KAAM,GAQNjuE,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,QAEPsD,UAAU1E,IACT1D,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,MACP2X,SAAS,EACTooC,WAAW,EACX1yC,OAAQ5Y,OA+BhB1D,KAAKw/E,kBACFvd,sBAvB+B,CAChCn9D,KAAM,MACN+L,IAAK,4DACLm7B,OAAQ,CACNiT,aAAc,8BACdoI,kBAAmB,WACnBL,YAAa,IACb17C,QAAS,QACTu2C,kBAAc,EACds5C,qBAAsB,OAExBx1C,WAAY,CACVvnB,SAAS,EACT0iB,UAAU,EACV5gC,QAAS,CACPiiC,SAAU,oBACVG,aAAc,oBACdmB,WAAY,YAOfr7C,UAAU1E,IAMT1D,KAAK0F,IAAI2/D,SAASrlE,KAAK6gF,aAAa5B,YALR,CAC1BhwE,MAAO,OACP2X,SAAS,EACTtK,OAAQ5Y,OA+Bd1D,KAAKw/E,kBACFvd,sBA3ByC,CAC1Cn9D,KAAM,MACN+L,IAAK,4DACLm7B,OAAQ,CACNiT,aAAc,8BACdoI,kBAAmB,WACnBL,YAAa,IACb17C,QAAS,QACTu2C,aAAc,eACdH,QAAS,aACTy5C,qBAAsB,OAExBx1C,WAAY,CACVvnB,SAAS,EACT0iB,UAAU,EACV5gC,QAAS,CACPiiC,SAAU,oBACVG,aAAc,oBACdmB,WAAY,UAGhBiE,cAAe,CACb7D,eAAgB,gBAMjBz7C,UAAU1E,IAOT1D,KAAK0F,IAAI2/D,SAASrlE,KAAK6gF,aAAa5B,YANR,CAC1BhwE,MAAO,oBACP2X,SAAS,EACTtK,OAAQ5Y,EACR+vF,WAAW,OAKjBzzF,KAAK6gF,aACFtB,iBAAiB,CAChBhiC,cAAe,CACbz4C,KAAM,MACN+L,IAAK,kDACLwyD,yBAAyB,EACzBr3B,OAAQ,CACNsR,OAAQ,eACRqM,QAAS,YAIdvhD,UAAU1E,GAAK1D,KAAK0F,IAAI2/D,SAAS3hE,IAEpC1D,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,oBACP2X,SAAS,EACT22B,cAAe,CACbz4C,KAAM,MACN+L,IAAK,kDACLm7B,OAAQ,CACNsR,OAAQ,+BACRqM,QAAS,YAIdvhD,UAAU1E,GAAK1D,KAAK0F,IAAI2/D,SAAS3hE,IAEpC1D,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,iBACP2X,SAAS,EACT22B,cAAe,CACbz4C,KAAM,MACN+L,IAAK,kDACLwyD,yBAAyB,EACzBr3B,OAAQ,CACNsR,OAAQ,aACRqM,QAAS,YAIdvhD,UAAU1E,GAAK1D,KAAK0F,IAAI2/D,SAAS3hE,IAEpC1D,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,aACP2X,SAAS,EACT22B,cAAe,CACbz4C,KAAM,MACN+L,IAAK,wDACLwyD,yBAAyB,EACzBr3B,OAAQ,CACNsR,OAAQ,aACRqM,QAAS,YAIdvhD,UAAU1E,GAAK1D,KAAK0F,IAAI2/D,SAAS3hE,IAEpC1D,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,yBACP2X,SAAS,EACTyoC,cAAe,CAEbhiC,SAAS,EAETq0C,gBAAiB,CACf,CAAExwD,KAAM,OAAQjC,MAAO,SACvB,CAAEiC,KAAM,SAAUjC,MAAO,eAG7BsuC,cAAe,CACbz4C,KAAM,MACN+L,IAAK,8CACLwyD,yBAAyB,EACzBr3B,OAAQ,CACNsR,OAAQ,kBACRqM,QAAS,YAIdvhD,UAAU1E,GAAK1D,KAAK0F,IAAI2/D,SAAS3hE,IAEpC1D,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,yBACP2X,SAAS,EACT22B,cAAe,CACbz4C,KAAM,MACN+L,IAAK,kDACLm7B,OAAQ,CACNsR,OAAQ,aACRqM,QAAS,YAIdvhD,UAAU1E,GAAK1D,KAAK0F,IAAI2/D,SAAS3hE,IAgBpC1D,KAAKw/E,kBACFvd,sBAfsC,CACvCn9D,KAAM,MACN+L,IAAK,4DACLu3C,mBAAoB,GACpBpc,OAAQ,CACNsR,OAAQ,2CACRqM,QAAS,WAUVvhD,UAAU1E,IAUT1D,KAAK0F,IAAI2/D,SAASrlE,KAAK6gF,aAAa5B,YATI,CACtChwE,MAAO,aACPqN,OAAQ5Y,EACR28D,SAAU,CACRxvD,IACE,sGACFqrC,QAAQ,sDA1OPn7C,GAAiBrB,wDAAjBqB,EAAiBugB,sZFnB9B5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,sBAAUA,QAC1BA,4BACEA,cAAIA,yCAA6BA,QAEjCA,cACAA,qBAAQA,gBAA2FA,iCAAoBA,QACvHA,eACFA,QAEAA,8BACEA,8BACFA,QAEAA,wBACEA,6BAOEA,4CAQFA,QACFA,QAEFA,eAvBmBA,6BAAW,eACTA,4BAKjBA,4BAAW,sBAAXA,CAAW,iCAAXA,CAAW,iNEEFqB,GAAb,MCcO,IAAMg4I,GAAb,MAAM,sDAAOh4I,4DAdF,CACP+3I,GACA1pH,KACAJ,KACAvvB,KACA2kC,GACAgxF,GACAp/B,GACA20B,GACAhuE,GACA4+C,OAISx6F,GAAb,GC5BA,MAOai4I,GAAyB9uG,cAPf,CACrB,CACEp/B,KAAM,SACNwrB,UCWJ,MAAM,QAcJvuB,YACUlI,EACAC,EACAM,GAFAJ,uBACAA,yBACAA,oBAhBHA,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,MAKVhuB,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,GAQNjuE,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,QAEPsD,UAAU5H,IACTR,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,MACP2X,SAAS,EACTooC,WAAW,EACX1yC,OAAQ9b,OA+BhBR,KAAK6gF,aACJtB,iBAAiB,CAChBtwE,MAAO,4BACP2X,SAAS,EACTyoC,cAAe,CACbhiC,SAAS,EACT/c,KAAM,aAERitC,cAAe,CACbz4C,KAAM,MACN+L,IAAK,wDACLwyD,yBAAyB,EACzBr3B,OAAQ,CACNsR,OAAQ,aACRqM,QAAS,YAIdvhD,UAAU5H,GAAKR,KAAK0F,IAAI2/D,SAAS7kE,IAElCR,KAAK6gF,aACJtB,iBAAiB,CAChBtwE,MAAO,iBACP2X,SAAS,EACTyoC,cAAe,CACbhiC,SAAS,EACT/c,KAAM,4DAERitC,cAAe,CACbz4C,KAAM,MACN+L,IAAK,wDACLwyD,yBAAyB,EACzBr3B,OAAQ,CACNsR,OAAQ,cACRqM,QAAS,YAIdvhD,UAAU5H,GAAKR,KAAK0F,IAAI2/D,SAAS7kE,IAElCR,KAAK6gF,aACJtB,iBAAiB,CAChBtwE,MAAO,wBACP2X,SAAS,EACTyoC,cAAe,CACbx+C,IAAK,moPAGP0sC,cAAe,CACbz4C,KAAM,MACN+L,IAAK,wDACLwyD,yBAAyB,EACzBr3B,OAAQ,CACNsR,OAAQ,aACRqM,QAAS,YAIdvhD,UAAU5H,GAAKR,KAAK0F,IAAI2/D,SAAS7kE,IAElCR,KAAKw/E,kBACFvd,sBAnF+B,CAChCn9D,KAAM,MACN+L,IAAK,4DACLm7B,OAAQ,CACNiT,aAAc,8BACdoI,kBAAmB,WACnBL,YAAa,IACb17C,QAAS,QACTu2C,kBAAc,EACds5C,qBAAsB,OAExBx1C,WAAY,CACVvnB,SAAS,EACT0iB,UAAU,EACV5gC,QAAS,CACPiiC,SAAU,oBACVG,aAAc,oBACdmB,WAAY,YAmEfr7C,UAAU5H,IAMTR,KAAK0F,IAAI2/D,SAASrlE,KAAK6gF,aAAa5B,YALR,CAC1BhwE,MAAO,OACP2X,SAAS,EACTtK,OAAQ9b,OAKdR,KAAK6gF,aACFtB,iBAAiB,CAChBhiC,cAAe,CACbz4C,KAAM,MACN+L,IAAK,4DACLwyD,yBAAyB,EACzBr3B,OAAQ,CACNsR,OAAQ,kBACRqM,QAAS,YAIdvhD,UAAU5H,GAAKR,KAAK0F,IAAI2/D,SAAS7kE,IAEpCR,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,oBACP2X,SAAS,EACT22B,cAAe,CACbz4C,KAAM,MACN+L,IAAK,kDACLm7B,OAAQ,CACNsR,OAAQ,+BACRqM,QAAS,YAIdvhD,UAAU5H,GAAKR,KAAK0F,IAAI2/D,SAAS7kE,IAEpCR,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,iBACP2X,SAAS,EACT22B,cAAe,CACbz4C,KAAM,MACN+L,IAAK,kDACLwyD,yBAAyB,EACzBr3B,OAAQ,CACNsR,OAAQ,aACRqM,QAAS,YAIdvhD,UAAU5H,GAAKR,KAAK0F,IAAI2/D,SAAS7kE,IAEpCR,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,kCACP2X,SAAS,EACTyoC,cAAe,CAEbhiC,SAAS,EAETq0C,gBAAiB,CACf,CAAExwD,KAAM,OAAQjC,MAAO,SACvB,CAAEiC,KAAM,SAAUjC,MAAO,eAG7BsuC,cAAe,CACbz4C,KAAM,MACN+L,IAAK,8CACLwyD,yBAAyB,EACzBr3B,OAAQ,CACNsR,OAAQ,kBACRqM,QAAS,YAIdvhD,UAAU5H,GAAKR,KAAK0F,IAAI2/D,SAAS7kE,IAEpCR,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,yBACP2X,SAAS,EACT22B,cAAe,CACbz4C,KAAM,MACN+L,IAAK,kDACLm7B,OAAQ,CACNsR,OAAQ,aACRqM,QAAS,YAIdvhD,UAAU5H,GAAKR,KAAK0F,IAAI2/D,SAAS7kE,IAgBpCR,KAAKw/E,kBACFvd,sBAfsC,CACvCn9D,KAAM,MACN+L,IAAK,4DACLu3C,mBAAoB,GACpBpc,OAAQ,CACNsR,OAAQ,2CACRqM,QAAS,WAUVvhD,UAAU5H,IAWTR,KAAK0F,IAAI2/D,SAASrlE,KAAK6gF,aAAa5B,YAVI,CACtChwE,MAAO,aACP2X,SAAS,EACTtK,OAAQ9b,EACR6/D,SAAU,CACRxvD,IACE,sGACFqrC,QAAQ,sDAhPPn7C,GAAkBrB,wDAAlBqB,EAAkBugB,4VCnB/B5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,yCAA6BA,QAC7CA,4BACEA,cAAIA,yCAA6BA,QAEjCA,cACAA,qBAAQA,gBAA2FA,iCAC1FA,QACTA,eACFA,QAEAA,8BACEA,8BACFA,QAEAA,wBACEA,oCAOFA,QAEFA,eAdmBA,6BAAW,eACTA,4BAIMA,sCAAqB,uBAArBA,CAAqB,yBAArBA,CAAqB,oCAArBA,CAAqB,2MDEnCqB,GAAb,MEcO,IAAMk4I,GAAb,MAAM,sDAAOl4I,4DAdF,CACPi4I,GACA5pH,KACAJ,KACAvvB,KACA2kC,GACAgxF,GACAp/B,GACA20B,GACAhuE,GACA4+C,OAISx6F,GAAb,GC5BA,MAOam4I,GAA0BhvG,cAPhB,CACrB,CACEp/B,KAAM,UACNwrB,UCSJ,MAAM,QAeJvuB,YACUlI,EACAC,EACAM,GAFAJ,uBACAA,yBACAA,oBAjBHA,SAAM,IAAIsgF,GAAO,CACtBvtD,SAAS,EACTrL,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,MAKVhuB,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,GASRztD,WACExgB,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,QAEPsD,UAAUvI,IACTG,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,MACPqN,OAAQzc,OAMlB+iC,kBAwCE5iC,KAAK0F,IAAIqtB,QAAQg5C,YACf,CAxCwB,CACxBjnE,KAAM83C,GACN6M,WAAY,YACZ5wC,KAAM,CACJjU,GAAI,GAENuiB,WAAY,GACZ89B,SAAU,CACRngD,KAAM,QACNy+E,YAAa,EAAC,GAAK,QAIG,CACxBz+E,KAAM83C,GACN6M,WAAY,YACZ5wC,KAAM,CACJjU,GAAI,GAENuiB,WAAY,GACZ89B,SAAU,CACRngD,KAAM,aACNy+E,YAAa,CAAC,EAAC,GAAK,MAAO,EAAC,KAAO,MAAO,EAAC,KAAO,SAI5B,CACxBz+E,KAAM83C,GACN6M,WAAY,YACZ5wC,KAAM,CACJjU,GAAI,GAENuiB,WAAY,GACZ89B,SAAU,CACRngD,KAAM,UACNy+E,YAAa,CAAC,CAAC,EAAC,GAAK,MAAO,EAAC,GAAK,IAAK,EAAC,KAAO,WAMjD1mC,uDA9EO97C,GAAmBrB,wDAAnBqB,EAAmBugB,6NCjBhC5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,mBAAOA,QACvBA,4BACEA,cAAIA,yCAA6BA,QAEjCA,cACAA,qBAAQA,gBAA6FA,iCAAoBA,QACzHA,eACFA,QAEAA,8BACEA,8BACFA,QAEFA,eAJmBA,6BAAW,eACTA,8IDKRqB,GAAb,MEGO,IAAMo4I,GAAb,MAAM,sDAAOp4I,4DATF,CACPm4I,GACA9pH,KACAJ,KACAomG,GACAiB,OAISt1H,GAAb,4CCTErB,sBAIEA,sFAEAA,4BAEAA,iBACEA,oBAIEA,8DACAA,uBACFA,QACAA,oBAIEA,+DACAA,wBACFA,QACAA,oBAKEA,oBACFA,QACFA,QACFA,yCA7BEA,gBAAa,+BAIGA,oCAqBZA,6CCjCR,MAOa05I,GAA2BlvG,cAPjB,CACrB,CACEp/B,KAAM,WACNwrB,UCMJ,MAAM,QAwBJvuB,YACUlI,EACAC,EACAM,EACAC,GAHAL,uBACAA,mBACAA,yBACAA,oBA1BVA,SAAM,IAAIsgF,GAAO,CACf54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,GAEb8kD,WAAW,KAIf9yE,UAAO,CACLqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,IAGRjuE,WAAQ,IAAI+I,SAAsB,GAElC/I,WAAQ,IAAI+I,SAAsC,GAElD/I,qBAAiB,EAWjBwgB,WACExgB,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,QAEPsD,UAAU/H,IACTL,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,MACPqN,OAAQjc,OAiDhB,MAAMP,EAAS,CA3Cb,CACEoR,KAAM,WACNjC,MAAO,WACPL,QAAU,CACRkpB,UAAWzR,gBAEbvhB,KAAM,WACNowB,OAAQ,CACNxvB,IAAK1F,KAAK0F,IACV2zI,mBAAmB,EACnBp8C,aAAc,UACdq8C,gBAAgB,EAChBtmC,UAAW,GACXumC,qBAAsB,aACtBxwC,UAAW,IAAI3uC,MAAc,CAC3BoB,OAAQ,IAAIC,KAAe,CACzBhrC,MAAO,CAAC,IAAK,EAAG,EAAG,GACnBgnC,MAAO,IAET6C,KAAO,IAAIC,KAAa,CACtB9pC,MAAO,CAAC,IAAK,EAAG,EAAG,MAErBqd,MAAO,IAAI8tB,KAAe,CACxB7N,OAAQ,EACRyN,OAAQ,IAAIC,KAAe,CACzBhrC,MAAO,CAAC,IAAK,EAAG,EAAG,KAErB6pC,KAAM,IAAIC,KAAa,CACrB9pC,MAAO,CAAC,IAAK,EAAG,EAAG,YAM7B,CACEvf,KAAM,OACNjC,MAAO,OACPL,QAAU,CACRkpB,UAAWzR,kBAKW3gB,IAAKrF,GAAWL,KAAKquC,YAAYpW,MAAM53B,IAC7DD,EAAOJ,KAAKquC,YAAY9W,KAAK,GAAI,CAACv3B,KAAKquC,YAAYzW,MAAM,CAAC1mB,KAAM,QAASpR,KAE/EE,KAAKsuC,eAAiBluC,EAAKioB,QAAQI,aAAargB,UAAU,KACxDpI,KAAKuuC,gBAAkBnuC,EAAKioB,QAAQmmB,QAGtCxuC,KAAKyuC,MAAMtmC,KAAK/H,GAGlB+X,cACEnY,KAAKsuC,eAAe5lC,cAGtBgmC,WACE1uC,KAAK2uC,MAAMxmC,KAAK,CACd+I,KAAM,QACN+zC,SAAUhgD,KAAKE,UAAU,CAACL,KAAM,UAAWy+E,YAAa,CAAC,CACvD,EAAC,IAAM,IACP,EAAC,IAAM,IACP,EAAC,GAAK,IACN,EAAC,GAAK,IACN,EAAC,IAAM,UAKb30C,YACE5uC,KAAKyuC,MAAM3sC,MAAMumB,QAAQoP,QAG3BP,SAASr3B,GACPgQ,MAAM5K,KAAKE,UAAUtF,kDAzHZkB,GAAoBrB,kEAApBqB,EAAoBugB,wdFdjC5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,yBAAaA,QAC7BA,4BACEA,qBAAQA,eAA6FA,gCAAoBA,QAC3HA,QAEAA,6BACEA,8BACFA,QAEAA,iDAgCFA,eApCmBA,4BAAW,eACTA,4BAIhBA,6YEEQqB,GAAb,MCUO,IAAMy4I,GAAb,MAAM,sDAAOz4I,4DAXF,CACPiM,KACAosI,GACApqH,KACAI,KACAuK,GACAw5E,GACAiiB,OAISr0H,GAAb,GCnBA,MAOa04I,GAA0BvvG,cAPhB,CACrB,CACEp/B,KAAM,UACNwrB,UCWJ,MAAM,QAoCJvuB,YACUlI,EACAC,EACAM,GAFAJ,uBACAA,yBACAA,oBAtCHA,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,MAKVhuB,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,GAGDjuE,mBAAgB,CACrB2hB,WAAW,EACXmF,YAAY,EACZ7L,MAAM,EACN0L,QAAS,CACP,CACEzV,KAAM,gBACNjC,MAAO,MAET,CACEiC,KAAM,kBACNjC,MAAO,QAET,CACEiC,KAAM,yBACNjC,MAAO,iBAKNjP,WAAQ,IAAI0pE,GAAa,GAAI,CAAEhkE,IAAK1F,KAAK0F,MAQhD8a,WACE,MAAM3gB,EAAkB,IAAI+pE,GAA4B,IACxD5pE,KAAKoR,MAAMwM,YAAY/d,GAEvB,MAAMC,EAAoB,IAAI+pE,GAA8B,CAC1DnkE,IAAK1F,KAAK0F,IACVmhE,OAAQhqB,aAEV78C,KAAKoR,MAAMwM,YAAY9d,GAEvBE,KAAKoR,MAAMxG,KAAK,CACd,CACEiO,KAAM,CAAEjU,GAAI,GACZE,KAAM,UACNmgD,SAAU,CACRngD,KAAM,QACNy+E,YAAa,EAAC,GAAK,OAErB95B,WAAY,YACZtiC,WAAY,CACVviB,GAAI,EACJsM,KAAM,SACN28B,YAAa,kBAGjB,CACEh1B,KAAM,CAAEjU,GAAI,GACZE,KAAM,UACNmgD,SAAU,CACRngD,KAAM,QACNy+E,YAAa,EAAC,GAAK,OAErB95B,WAAY,YACZtiC,WAAY,CACVviB,GAAI,EACJsM,KAAM,SACN28B,YAAa,kBAEf,CACAh1B,KAAM,CAAEjU,GAAI,GACZE,KAAM,UACNmgD,SAAU,CACRngD,KAAM,QACNy+E,YAAa,EAAC,GAAK,OAErB95B,WAAY,YACZtiC,WAAY,CACVviB,GAAI,EACJsM,KAAM,SACN28B,YAAa,kBAGjB,CACEh1B,KAAM,CAAEjU,GAAI,GACZE,KAAM,UACNmgD,SAAU,CACRngD,KAAM,aACNy+E,YAAa,CAAC,EAAC,GAAK,MAAO,EAAC,KAAO,MAAO,EAAC,KAAO,QAEpD95B,WAAY,YACZtiC,WAAY,CACVviB,GAAI,EACJsM,KAAM,SACN28B,YAAa,kBAGjB,CACEh1B,KAAM,CAAEjU,GAAI,GACZE,KAAM,UACNmgD,SAAU,CACRngD,KAAM,UACNy+E,YAAa,CAAC,CAAC,EAAC,GAAK,MAAO,EAAC,GAAK,IAAK,EAAC,KAAO,SAEjD95B,WAAY,YACZtiC,WAAY,CACVviB,GAAI,EACJsM,KAAM,SACN28B,YAAa,oBAKnB7tC,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,WACP2X,SAAS,EACT22B,cAAe,CACbz4C,KAAM,MACN+L,IACE,oHACFuuD,WAAW,GAEb4gB,YAAa,CACXnvE,IAAK,4CACLyL,OAAQ,cAGXlU,UAAUhI,GAAKJ,KAAK0F,IAAI2/D,SAASjlE,IAEpCJ,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,WAEPsD,UAAUhI,IACT,MAAMC,EAAQL,KAAK6gF,aAAa5B,YAAY,CAC1ChwE,MAAO,eACPqN,OAAQlc,EACRgxD,UAAW,CACTa,SAAU,KAEZ+tB,YAAa,CACXnvE,IAAK,yCACLyL,OAAQ,kBAGZtc,KAAK0F,IAAI2/D,SAAShlE,GAClBL,KAAKoR,MAAMg0D,UAAU/kE,GACrBR,EAAgBke,WAChBje,EAAkBie,aAIxB5F,cACEnY,KAAKoR,MAAM8J,wDArKFna,GAAmBrB,wDAAnBqB,EAAmBugB,qPCnBhC5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,mBAAOA,QACvBA,4BACEA,qBAAQA,eAA8FA,gCAAoBA,QAC5HA,QAEAA,6BACEA,8BACFA,QAEAA,+BAIFA,eARmBA,4BAAW,eACTA,4BAIjBA,gCAAe,0MDONqB,GAAb,MEQO,IAAM24I,GAAb,MAAM,sDAAO34I,4DAbF,CACP04I,GACAzsI,KACAoiB,KACAJ,KACAvvB,KACA2kC,GACApK,GACAo7F,GACA1tB,OAIS3mG,GAAb,GCxBA,MAOa44I,GAAwBzvG,cAPd,CACrB,CACEp/B,KAAM,QACNwrB,UCIJ,MAAM,QA6BJvuB,YACUlI,EACAC,EACAM,EACAC,GAHAL,uBACAA,yBACAA,oBACAA,oBA9BHA,uBAA4B,EAC5BA,8BAAmC,EACnCA,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,GAEb8kD,WAAW,KAIR9yE,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,EACNxkB,WAAY,aAmBZzpD,KAAKw/E,kBACJvd,sBAAsB,CACrBn9D,KAAM,OACN+L,IAAK,2DACL4rC,MAAO,uBACP+tC,UAAW,YACXl/E,QAAS,UAEVlD,UAAU1E,IACT1D,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,SACP2X,SAAS,EACTooC,WAAW,EACX1yC,OAAQ5Y,OAqBd1D,KAAKw/E,kBACFvd,sBAd0C,CAC3Cn9D,KAAM,MACN+L,IAAK,4DACLm7B,OAAQ,CACNiT,aAAc,yBACdoI,kBAAmB,WACnBL,YAAa,IACb17C,QAAS,QACTu2C,kBAAc,EACds5C,qBAAsB,SAMvB/yF,UAAW1E,IAMV1D,KAAK0F,IAAI2/D,SAASrlE,KAAK6gF,aAAa5B,YALF,CAChChwE,MAAO,gBACP2X,SAAS,EACTtK,OAAQ5Y,OAkBd1D,KAAKw/E,kBACFvd,sBAdwC,CACzCn9D,KAAM,MACN+L,IAAK,4DACLm7B,OAAQ,CACNiT,aAAc,UACdoI,kBAAmB,WACnBL,YAAa,IACb17C,QAAS,QACTu2C,kBAAc,EACds5C,qBAAsB,SAMvB/yF,UAAW1E,IA0CV1D,KAAK0F,IAAI2/D,SAASrlE,KAAK6gF,aAAa5B,YAzCF,CAChChwE,MAAO,cACP2X,SAAS,EACTtK,OAAQ5Y,EACR85C,iBAAkB,CAChB+sB,UAAW,aACXhhD,KAAM,CAAC,OAAQ,SACfiyC,OAAQ,CAAC,MAAO,QAChBlB,KAAM,CAAC,UAAW,WAClBvM,OAAQ,CAAC,EAAG,GACZ0J,MAAO,CAAC,EAAG,IAEbha,WAAY,CACV4Z,MAAO,CACLkT,UAAW,uDACXl6C,MAAO,CACLyqC,UAAW,OACXF,aAAc,MACdH,KAAM,0BACNH,KAAM,CAAE7pC,MAAO,QACfsoD,eAAgB,CAAEtoD,MAAO,4BACzBuoD,iBAAkB,CAAEvoD,MAAO,4BAA6BgnC,MAAO,GAC/D+D,OAAQ,CAAE/qC,MAAO,OAAQgnC,MAAO,GAChCyS,UAAU,EACVlP,QAAS,GACTG,QAAS,GACT6R,QAAS,CAAC,IAAK,IAAK,IAAK,OAG7BjC,UAAW,CACTknE,OAAQ,CACNz2E,OAAQ,CACN/qC,MAAO,SACPgnC,MAAO,GAETA,MAAO,CAAC,GACR1J,OAAQ,WAKgC6rF,YArHpD,OAAO55I,KAAKikB,aAAatP,+BAIzB,OAAO3U,KAAKikB,aAAapP,8DA1BhB9T,GAAiBrB,kEAAjBqB,EAAiBugB,6UCV9B5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,iBAAKA,QACrBA,4BACEA,cAAIA,yCAA6BA,QAEjCA,cACAA,qBAAQA,gBAA2FA,iCAAoBA,QACvHA,eACFA,QAEAA,8BAIEA,8BACAA,mCACAA,qCACAA,kCACFA,QAEFA,eAVmBA,6BAAW,cAAXA,CAAW,kDAAXA,CAAW,6BAITA,4BACKA,4BACEA,4BACHA,4BAAW,qJDRvBqB,GAAb,MEWO,IAAM84I,GAAb,MAAM,sDAAO94I,4DATF,CACPiM,KACA2sI,GACAvqH,KACAJ,KACAomG,OAISr0H,GAAb,GChBA,MAOa+4I,GAA0B5vG,cAPhB,CACrB,CACEp/B,KAAM,UACNwrB,UCQJ,MAAM,QAmBJvuB,YACUlI,EACAC,EACAM,GAFAJ,uBACAA,yBACAA,oBApBHA,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,GAEb8kD,WAAW,KAIR9yE,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,EACNxkB,WAAY,aAGPzpD,WAAQ,IAAI0pE,GAAiC,GAAI,CAAChkE,IAAK1F,KAAK0F,MAOjE1F,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,QAEPsD,UAAU/H,IACTL,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,MACPqN,OAAQjc,qDAhCPU,GAAmBrB,wDAAnBqB,EAAmBugB,+OChBhC5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,sBAAUA,QAC1BA,4BACEA,cAAIA,yCAA6BA,QAEjCA,cACAA,qBAAQA,gBAA6FA,iCAAoBA,QACzHA,eACFA,QAEAA,8BACEA,8BACFA,QAEAA,2BAEFA,eANmBA,6BAAW,eACTA,4BAGLA,gCAAe,0PDClBqB,GAAb,MEEO,IAAMg5I,GAAb,MAAM,sDAAOh5I,4DARF,CACP+4I,GACA1qH,KACAgmG,GACAQ,OAIS70H,GAAb,GCdA,MAOai5I,GAAuB9vG,cAPb,CACrB,CACEp/B,KAAM,OACNwrB,UCUJ,MAAM,QAmBJvuB,YACUlI,EACAC,EACAM,EACAC,GAHAL,uBACAA,yBACAA,oBACAA,kBArBHA,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,GAEb8kD,WAAW,KAIR9yE,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,EACNxkB,WAAY,aAGPzpD,WAAQ,IAAI0pE,GAA8B,GAAI,CAAChkE,IAAK1F,KAAK0F,MAQ9D1F,KAAKy/D,WAAWlP,OAAOvwD,KAAK0F,KAC5B1F,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,QAEPsD,UAAU9H,IACTN,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,MACPqN,OAAQhc,qDAlCPS,GAAgBrB,kEAAhBqB,EAAgBugB,yOCjB7B5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,sBAAUA,QAC1BA,4BACEA,cAAIA,yCAA6BA,QAEjCA,cACAA,qBAAQA,gBAA0FA,iCAAoBA,QACtHA,eACFA,QAEAA,8BACEA,8BACFA,QAEAA,uBAEFA,eANmBA,6BAAW,eACTA,4BAGTA,gCAAe,sPDEdqB,GAAb,MECO,IAAMk5I,GAAb,MAAM,sDAAOl5I,4DARF,CACPi5I,GACA5qH,KACAgmG,GACA/tB,OAIStmG,GAAb,6BCIIrB,SACEA,cAAIA,0BAAcA,kBAAyCA,SAAqBA,QAAOA,QACvFA,iCACFA,uCAF6DA,8BACtCA,6BCnB3B,MAOaw6I,GAAwBhwG,cAPd,CACrB,CACEp/B,KAAM,QACNwrB,UCwBJ,MAAM,QAgBJvuB,YACUlI,EACAC,EACAM,EACAC,GAHAL,uBACAA,yBACAA,oBACAA,sBAnBHA,cAAW,IAAI+I,SAAyB,GAExC/I,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,MAKVhuB,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,GASNjuE,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,QAEPsD,UAAU9H,IACTN,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,MACPqN,OAAQhc,OAKhBN,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,MACN+L,IAAK,kDACLuuD,WAAW,EACXrW,WAAY,UACZ/c,OAAQ,CACNqe,OAAQ,+BACR/+C,QAAS,WAGZlD,UAAU9H,IACTN,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,MACPqN,OAAQhc,EACRi9C,cAAej9C,EAAWsO,aAKlC5O,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,MACN+L,IAAK,kDACLuuD,WAAW,EACX7zB,YAAaya,YACbxa,gBAAiB2a,UACjBna,OAAQ,CACNqe,OAAQ,+BACR/+C,QAAS,WAGZlD,UAAU9H,IACTN,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,kCACPqN,OAAQhc,EACRi9C,cAAej9C,EAAWsO,aAKlC5O,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,SACNs6D,WAAW,EACXrW,WAAY,uBACZ7B,aAAc,CACZ,CAAEh2C,KAAM,OAAQ05B,MAAO,cACvB,CAAE15B,KAAM,cAAe05B,MAAO,wBAGjCxiC,UAAU9H,IACTN,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,eACPqN,OAAQhc,EACRi9C,cAAej9C,EAAWsO,WAG9B5O,KAAKq0D,YAAY/zD,KAIvB+zD,YAAYx0D,GACV,MAAMC,EAAW,IAAIkrE,KAAU,CAC7B95D,KAAM,WACN+zC,SAAU,IAAIm+B,KAAa,CACzBv1B,MAAiB,EAAC,GAAK,MAAO,YAAa,aAC3CA,MAAiB,EAAC,KAAO,MAAO,YAAa,aAC7CA,MAAiB,EAAC,KAAO,MAAO,YAAa,iBAI3CztD,EAAW,IAAI4qE,KAAU,CAC7B95D,KAAM,WACN+zC,SAAU,IAAI8sB,KACZlkB,MAAiB,EAAC,GAAK,MAAO,YAAa,gBAIzCxtD,EAAW,IAAI2qE,KAAU,CAC7B95D,KAAM,WACN+zC,SAAU,IAAIq+B,MAAU,CACtB,CACEz1B,MAAiB,EAAC,GAAK,MAAO,YAAa,aAC3CA,MAAiB,EAAC,GAAK,IAAK,YAAa,aACzCA,MAAiB,EAAC,KAAO,MAAO,YAAa,kBAKnDhuD,EAAWk9C,GAAGsX,YAAY,CAACv0D,EAAUM,EAAUC,IAE/CL,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,6CACP2X,SAAS,EACT22B,cAAe,CACbz4C,KAAM,MACN+L,IACE,oHACFuuD,WAAW,EACXimB,SAAU,kXACVU,oBAAoB,EACpBx6C,YAAa,WAEfy0C,YAAa,CACXnvE,IAAK,4CACLyL,OAAQ,cAGXlU,UAAU9H,GAAKN,KAAK0F,IAAI2/D,SAAS/kE,IAGlCN,KAAKw/E,kBACJvd,sBAAsB,CACrBn9D,KAAM,MACN+L,IAAK,uDACLuuD,WAAW,EACXimB,SAAU,gXACV95C,YAAa,UACbS,OAAQ,CACNqe,OAAQ,UACR/+C,QAAS,WAGZlD,UAAU9H,IACTN,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,qCACPqN,OAAQhc,EACRi9C,cAAej9C,EAAWsO,aAOpCurI,mBAAmBt6I,GACjB,MAAMC,EAAsBD,EAAQ8kF,SACpC,IAAIvkF,EACAN,EAASS,QAAUT,EAAS,KAC9BM,EAAUN,EAAS,GACnBE,KAAKo6I,SAASjyI,KAAK/H,GACnBJ,KAAK0F,IAAImuE,oBAAoB9H,YAAY,CAAC3rE,GAAUy8C,UAKxD5O,SAASpuC,GACP,OAAO0gB,GAAe1gB,iDA3LbkB,GAAiBrB,kEAAjBqB,EAAiBugB,6VFhC9B5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,iBAAKA,QACrBA,4BACEA,cAAIA,yCAA6BA,QAEjCA,cACAA,qBAAQA,gBAA2FA,iCAAoBA,QACvHA,eACFA,QAEAA,8BAMEA,iCAASI,0BACTJ,8BACFA,QAEAA,wBACEA,oDAIFA,QAEFA,eAhBIA,6BAAW,cAAXA,CAAW,oBAMMA,4BAIFA,uPEUNqB,GAAb,MCCO,IAAMs5I,GAAb,MAAM,sDAAOt5I,4DAdF,CACPm5I,GACAltI,KACAoiB,KACAJ,KACAvvB,KACA2kC,GACAgxF,GACAiB,GACAoH,GACA/1B,OAIS3mG,GAAb,GC5BA,MAOau5I,GAA0BpwG,cAPhB,CACrB,CACEp/B,KAAM,UACNwrB,UCGJ,MAAM,QAkBJvuB,YACUlI,EACAC,EACAM,EACAC,EACAC,GAJAN,qBACAA,uBACAA,oBACAA,sBACAA,sBAtBHA,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,MAKVhuB,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,GAGDjuE,kBAAe,IAAI0+B,GAAqB,IAExC1+B,sBAAmB,IAAI0+B,GAAyB,IAavDle,WACExgB,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,MACPsuC,cAAe,CACbz4C,KAAM,SAGTsD,UAAUvI,GAASG,KAAK0F,IAAI2/D,SAASxlE,IAExCG,KAAKsoF,eAQPiyD,sBAAsB16I,GACpBG,KAAKyoF,iBAAiB5oF,EAAMwrC,SAOtBi9C,eACNtoF,KAAKqhF,eAAeiH,eACjBlgF,UAAWvI,IACVG,KAAKw6I,aAAatkI,QAClBlW,KAAKw6I,aAAa5vI,KAAK/K,EAASmG,OAAQhG,KAAKswE,eAAe7mE,IAAI,kBAAoB,OASlFg/E,iBAAiB5oF,GACvBG,KAAKqhF,eAAeoH,iBAAiB5oF,GAClCuI,UAAWtI,IACVE,KAAKy6I,iBAAiBvkI,QACtBlW,KAAKy6I,iBAAiB7vI,KAAK9K,mDAxEtBiB,GAAmBrB,2EAAnBqB,EAAmBugB,oaCXhC5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,mBAAOA,QACvBA,4BACEA,cAAIA,wDAA4CA,QAEhDA,cACAA,qBAAQA,gBAA6FA,iCAAoBA,QAAIA,eAC7HA,yCAA2BA,gBAA2FA,gCAAkBA,QACxIA,eACFA,QAEAA,8BACEA,8BACFA,QAEAA,wBACEA,kCAEEA,+CAAuBI,6BACzBJ,QACFA,QAEAA,wBACEA,kCAIFA,QAEFA,eAlBmBA,6BAAW,eACTA,4BAKfA,uCAOAA,2CAA0B,wIDdnBqB,GAAb,MEyBO,IAAM25I,GAAb,MAAM,sDAAO35I,6DANA,CACT2K,GAAqB,CACnBb,QAAS0/B,UAEZhb,SAjBQ,CACPviB,KACAstI,GACAlrH,KACAJ,KACAvvB,KACAwvB,KACAxjB,GACA24B,GACAgxF,GACAj9B,OASSp3F,GAAb,mBCpCiC0L,MCAAA,UCArBkuI,SAAZ,OAAY55I,UAAc,KACxBA,iBACAA,mBACAA,qBAHU45I,GAAZ,IAAY55I,UC+CC65I,iBAwBX7yI,YACUlI,EACAC,EACAM,EACAC,EACAC,EACAE,EACYkD,GANZ1D,YACAA,mBACAA,uBACAA,cACAA,sBACAA,sBACYA,aA9BfA,cAAW,IAAI+I,SAAiC,GAChD/I,eAAY,IAAI+I,IAA8B,CAAE8xI,KAAM,KACtD76I,uBAAoB,IAAI+I,SAAwB,GAChD/I,oBAAiB,IAAI+I,SAAiC,GACtD/I,qBAA0C,GAC1CA,mBAAgB,IAAIgI,KACnBhI,sBAAmC,GA0BzCA,KAAK4O,QAAUhJ,OAAOU,OACpB,CACEw0I,SAAU,WACVC,gBAAiB,iBACjBC,kBAAmB,YAErBh7I,KAAK2K,OAAOD,UAAU,YAGxB1K,KAAKs6F,QAAUt6F,KAAK4O,QAAQiC,IAE5B7Q,KAAKi7I,sBAEDj7I,KAAK+zC,YAAYmnG,eACnBl7I,KAAK+zC,YAAYvD,QAAQpoC,UAAWxE,IAC9BA,IACF5D,KAAKm7I,UAAU5yI,QAAK0T,MAAK,IAAI,WAAS7T,UAAWvE,IAC/C7D,KAAKo7I,yBAEPp7I,KAAKq7I,mBAITr7I,KAAKq7I,eACLr7I,KAAKo7I,sBAAqB,4BAxC5B,OAAOp7I,KAAKswE,eAAe7mE,IAAI,yBAAqCzJ,KAAKs7I,oBAAsBt7I,KAAK4O,QAAQosI,wCAExFn7I,GACpBG,KAAKs7I,mBAAqBz7I,EAyC5B4J,IAAI5J,EAAwBC,GAC1B,IAAIM,EAAMJ,KAAKs6F,QAAU,YACzB,OAAIz6F,GAAeG,KAAK+zC,YAAYxD,gBAClCnwC,GAAO,eAAiBP,EAAYiB,OAChChB,IACFM,GAAO,iBAGJJ,KAAKkM,KAAKzC,IAAkBrJ,GAGrCm7I,QAAQ17I,GAEN,OAAOG,KAAKkM,KAAKzC,IADLzJ,KAAKs6F,QAAU,aAAez6F,GAI5C27I,WAAW37I,GAET,OAAOG,KAAKkM,KAAKzC,IADL,GAAGzJ,KAAKs6F,oBAAoBz6F,aACG0I,MACzC,OAAYnI,IACV,WAAKqQ,YAAYrQ,EAAKP,GAChBO,KAKZq7I,aACE,GAAIz7I,KAAK+zC,YAAYxD,cAEnB,OAAOvwC,KAAKkM,KAAKzC,IADLzJ,KAAKs6F,QAAU,qBACgB/xF,MACzC,QAAKzI,IACHE,KAAK07I,kBAAkBvzI,KAAKrI,EAAQ8E,OAGnC,CACL,MAAM/E,EAAMG,KAAKswE,eAAe7mE,IAAI,wBACpC,YAAKiyI,kBAAkBvzI,KAAKtI,GACrBG,KAAK27I,gBAAgB97I,IAKhC+7I,kBACE,OAAI57I,KAAKs6F,QAEAt6F,KAAKkM,KAAKzC,IADLzJ,KAAKs6F,QAAU,gBAGtBtuF,MAAG,IAGZ6vI,WAAWh8I,GACT,OAAIG,KAAK+zC,YAAYxD,cAEZvwC,KAAKkM,KAAKklC,KADLpxC,KAAKs6F,QAAU,oBACA,CAAEwhD,iBAAkBj8I,KAE/CG,KAAKswE,eAAe76D,IAAI,uBAAwB5V,MACzCmM,WAAG,IAId+vI,YAAYl8I,GAEV,OAAOG,KAAKkM,KAAKklC,KADLpxC,KAAKs6F,QAAU,aAAez6F,EAAK,QACpB,IAG7Bm8I,YAAYn8I,GAEV,OAAOG,KAAKkM,KAAKklC,KADLpxC,KAAKs6F,QAAU,aAAez6F,EAAK,QACpB,IAG7B8J,OAAO9J,EAAYC,GAAW,GAC5B,MAAMM,EAAyB,CAAEy6I,KAAM,IAMvC,OALAj1I,OAAOC,KAAK7F,KAAKm7I,UAAUr5I,OAAOgE,QAC/BxF,GACEF,EAASE,GAAON,KAAKm7I,UAAUr5I,MAAMxB,GAAKmG,OAAQjG,GAAMA,EAAEoE,KAAO/E,IAGlEC,GACFE,KAAKi8I,gBAAkBj8I,KAAKi8I,gBAAgBx1I,OAAQnG,GAAMA,EAAEsE,KAAO/E,IAC5D,QAAGG,KAAKm7I,UAAUhzI,KAAK/H,KAIzBJ,KAAKkM,KAAKvC,OADL3J,KAAKs6F,QAAU,aAAez6F,GACP0I,MACjC,QAAKjI,IACHN,KAAKm7I,UAAUhzI,KAAK/H,MAK1BsH,OAAO7H,GAEL,OAAOG,KAAKkM,KAAKklC,KADLpxC,KAAKs6F,QAAU,YACSz6F,GAAS0I,MAC3C,OAAKnI,IAEDA,EAAe87I,WADbl8I,KAAK+zC,YAAYxD,cACSoqG,GAAeA,GAAewB,OAE9BxB,GAAeA,GAAe97E,MAE5D7+D,KAAKm7I,UAAUr5I,MAAM+4I,KAAK30G,QAAQ9lC,GAClCJ,KAAKm7I,UAAUhzI,KAAKnI,KAAKm7I,UAAUr5I,OAC5B1B,KAKbsJ,MAAM7J,EAAYC,EAAa,IAE7B,OAAOE,KAAKkM,KAAKklC,KADLpxC,KAAKs6F,QAAU,aAAez6F,EAAK,SACXC,GAAYyI,QAC9CsmD,KAAKxuD,IACHA,EAAc67I,WAAavB,GAAeA,GAAewB,OACzDn8I,KAAKm7I,UAAUr5I,MAAM+4I,KAAK30G,QAAQ7lC,GAClCL,KAAKm7I,UAAUhzI,KAAKnI,KAAKm7I,UAAUr5I,OAC5BzB,KAKbqZ,OAAO7Z,EAAYC,GAEjB,OAAOE,KAAKkM,KAAKgmC,MADLlyC,KAAKs6F,QAAU,aAAez6F,EACLC,GAKvCs8I,mBAAmBv8I,EAAmBC,GAKpC,OAAOE,KAAKkM,KAAKklC,KAJL,GAAGpxC,KAAKs6F,oBAAoBz6F,UACpB,CAClBw8I,WAKJC,sBAAsBz8I,EAAmBC,GAEvC,OAAOE,KAAKkM,KAAKvC,OADL,GAAG3J,KAAKs6F,oBAAoBz6F,WAAmBC,KAI7Dy8I,eAAe18I,GAEb,OAAOG,KAAKkM,KAAKzC,IADLzJ,KAAKs6F,QAAU,aAAez6F,EAAK,gBAIjD28I,yBACE38I,EACAC,EACAM,GAQA,OAAOJ,KAAKkM,KAAKklC,KANL,GAAGpxC,KAAKs6F,oBAAoBz6F,gBACpB,CAClB48I,SACAC,eAAgBt8I,IAG2CmI,MAC3D,OAAY/H,IACV,WAAKiQ,YAAYjQ,OAAK,GAAW,GAC3B,CAACA,MAKbm8I,4BACE98I,EACAC,GAGA,OAAOE,KAAKkM,KAAKvC,OADL,GAAG3J,KAAKs6F,oBAAoBz6F,iBAAyBC,KAMnE88I,mBACE,MAAM/8I,EAAMG,KAAKykG,QAAQzkG,KAAK4O,QAAQmsI,iBACtC,OAAO/6I,KAAKkM,KAAKzC,IAAkB5J,GAAK0I,MACtC,OAAKzI,KACM+6I,KAAM/6I,MAKrB+8I,gBAAgBh9I,GACd,MAAMC,EAAME,KAAKykG,QAAQ,GAAG5kG,UAC5B,OAAOG,KAAKkM,KAAKzC,IAAqB3J,GAAKyI,MACzC,SAAUnI,IACR,IAAKA,EAAI08I,KACP,SAAO9wI,MAAG5L,GAEZ,MAAMC,EAAUL,KAAKykG,QAAQ,GAAGrkG,EAAI08I,aACpC,OAAO98I,KAAKkM,KAAKzC,IAAqBpJ,GAASkI,MAC7C,OAAKjI,IACH,MAAME,EAAWJ,EACjB,SAASsF,IAAMa,YAAsBjG,EAAQoF,IAAKtF,EAAIsF,KACtDlF,EAAS6pD,QAAU/pD,EAAQ+pD,QAAU,IAClCrkD,OAAO5F,EAAIiqD,QAAU,IACrBxwC,UACApT,OACC,CAAC/C,EAAGE,EAAOC,KACRH,EAAEkB,IAAMf,EAAKa,UAAWX,GAAOA,EAAGa,KAAOlB,EAAEkB,MAAQhB,GAEvDiW,UACHrZ,EAASo+B,QAAUx+B,EAAIw+B,SAAWt+B,EAAQs+B,QAC1Cp+B,EAASwO,QAAU5O,EAAI4O,SAAW1O,EAAQ0O,QAC1CxO,EAAS0vD,SAAW9vD,EAAI8vD,UAAY5vD,EAAQ4vD,SAC5C1vD,EAASs/B,OAAS1/B,EAAI0/B,OAAS,IAC5B95B,OAAO1F,EAAQw/B,OAAS,IACxBr5B,OACC,CAAC/C,EAAGE,EAAOC,IACTA,EAAKa,UAAWX,GAAOA,EAAGmN,OAASxN,EAAEwN,QAAUtN,GAE9CpD,KAET,OAAYF,IACV,WAAKmQ,YAAYnQ,EAAKT,GAChBS,QAIZ,OAAYF,IACV,WAAKqQ,YAAYrQ,EAAMP,GACjBO,KAKZi7I,aAAax7I,EAAwBC,GACnC,IAAIM,EAEFA,EADEJ,KAAKs6F,QACGt6F,KAAKyJ,IAAI5J,EAAaC,GAEtBE,KAAK48I,mBAEjBx8I,EAAQgI,UAAW/H,IACjBA,EAASw6I,KAAO76I,KAAKi8I,gBAAgBj2I,OAAO3F,EAASw6I,MACrD76I,KAAKm7I,UAAUhzI,KAAK9H,KAIxB08I,qBACE,MAAMl9I,EAAU,CAACC,GAAS,MACnBA,GAAUE,KAAKs6F,SAAWt6F,KAAK+zC,YAAYxD,cAC9CvwC,KAAKy7I,aAAarzI,UACfhI,IACCJ,KAAKg7I,kBAAoB56I,EAAS48I,IAClCh9I,KAAKi9I,iBAAiB78I,GACtBJ,KAAKk9I,WAAW98I,IAElB,KACEJ,KAAK07I,kBAAkBvzI,UAAK,GAC5BnI,KAAKm9I,YAAYn9I,KAAKg7I,qBAI1Bh7I,KAAKm9I,YAAYn9I,KAAKg7I,oBAItBh7I,KAAK6T,OAAS7T,KAAK6T,MAAMjF,QAAQwD,WACnCpS,KAAK6T,MAAMD,YAAYrL,MAAK,OAAa,MAAMH,UAAWtI,IACxD,MAAMM,EAAeN,EAAOE,KAAK6T,MAAMjF,QAAQwD,YAC/C,IAAI/R,GAAS,EACTD,IACFJ,KAAKg7I,kBAAoB56I,EACzBC,GAAS,GAEXR,EAAQQ,KAGVR,IAIJs9I,YAAYt9I,GACV,MAAMC,EAAUE,KAAKo9I,SAASt7I,MAE1BhC,GAAWA,EAAQk9I,MAAQn9I,GAI/BG,KAAK27I,gBAAgB97I,GAClB0I,MAAK,WACLH,UACEhI,IACCJ,KAAKi9I,iBAAiB78I,GACtBJ,KAAKk9I,WAAW98I,IAEjBA,IACKP,IAAQG,KAAK4O,QAAQosI,mBACvBh7I,KAAKm9I,YAAYn9I,KAAK4O,QAAQosI,qBAMxCkC,WAAWr9I,GACTG,KAAKq9I,qBAAqBx9I,GAC1B,MAAMC,EAAiBE,KAAKo9I,SAASt7I,MACrC,GAAIhC,GAAkBD,GAAWA,EAAQ+E,KAAO9E,EAAe8E,GAK7D,YAJyC,IAArC/E,EAAQ6F,IAAIuX,KAAKqgI,kBACnBz9I,EAAQ6F,IAAIuX,KAAKqgI,iBAAkB,QAErCt9I,KAAKo9I,SAASj1I,KAAKtI,GAIhBA,EAAQ6F,MACX7F,EAAQ6F,IAAM,CAAEuX,KAAM,KAGxBrX,OAAOU,OAAOzG,EAAQ6F,IAAIuX,KAAMjd,KAAKu9I,kBAErCv9I,KAAKo9I,SAASj1I,KAAKtI,GAGrB29I,kBAAkB39I,GAChBG,KAAK27I,gBAAgB97I,GAAKuI,UAAWtI,IACnCE,KAAKy9I,iBAAiB39I,KAI1B29I,iBAAiB59I,GACfG,KAAK09I,eAAev1I,KAAKtI,GAG3B89I,kBAAkB99I,EAAgBC,GAChC,MAAMM,EAAOP,EAAOk9C,GAAGuW,UACjBjzD,EAAOD,EAAKmtE,gBAAgBhsB,UAC5BjhD,EAAc,IAAIyxE,KAAQ3xE,EAAKotE,aAAazoD,UAChD1kB,EACA,aAGIG,EAAU,CACdw8I,IAAK/zI,IACLgG,MAAO,GACP2G,MAAO,UACPlQ,IAAK,CACHuX,KAAM,CACJoyD,OAAQ/uE,EAAOkzD,iBACfya,KAAM7tE,EAAK8kE,UACXzb,WAAYppD,EACZ0uE,gBAAiBlvE,EAAOwrD,eAAe0jB,kBAG3C1kB,OAAQ,GACRvqB,MAAO,IAGT,IAAIp8B,EAAS,GAEXA,GADY,IAAV5D,EACOD,EAAO+yE,QACbjpD,WACAljB,OACE5C,IACmB,IAAlBA,EAAImrD,WACe,2BAAnBnrD,EAAI+K,QAAQhK,IAEfqW,KAAK,CAACpX,EAAGE,IAAMF,EAAEkrD,OAAShrD,EAAEgrD,QAEtBlvD,EAAO+yE,QAAQjpD,WAAWljB,OAAO5C,IAAQA,EAAIe,GAAG6O,SAAS,0BAA0BwH,KAAK,CAACpX,EAAGE,IAAMF,EAAEkrD,OAAShrD,EAAEgrD,QAG1H,IAAInrD,EAAI,EACR,UAAWC,KAAKH,EAAQ,CACtB,MAAMK,EAAaF,EACbG,EAAO,CACXY,GAAIb,EAAM6K,QAAQhK,GAAKnE,OAAOsD,EAAM6K,QAAQhK,SAAM,EAClDg5I,aAAc,CACZ3uI,MAAOlL,EAAM6K,QAAQK,MACrB8/C,SAAUnrD,EACVgjB,QAAS7iB,EAAM6iB,SAEjB22B,cAAe,CACbz4C,KAAMf,EAAM2iB,WAAW9X,QAAQ9J,KAC/BknC,OAAQjoC,EAAM2iB,WAAW9X,QAAQo9B,OACjCn7B,IAAK9M,EAAM2iB,WAAW9X,QAAQiC,IAC9BuuD,UAAWr7D,EAAMq7D,YAGjBp7D,EAAKu5C,cAAcz4C,MACrBtE,EAAQ6pD,OAAOzpD,KAAKoD,GAIxB,SAAQ87B,MAAQ9/B,KAAK8/B,MAAMp6B,IAAK7B,KACrBe,GAAInE,OAAOoD,EAAKe,IAAKi5I,OAAQh6I,EAAKg6I,UAGtCr9I,EAGTs9I,qBACEj+I,EACAC,EACAM,GAEA,MAAMC,EAAiBL,KAAKo9I,SAASzzH,WAC/BrpB,EAAOT,EAAOk9C,GAAGuW,UACjB9yD,EAAOF,EAAKitE,gBAAgBhsB,UAM5B39C,EAAU,CACdo5I,IAAK58I,EACL6O,MAAO7O,EACPsF,IAAK,CACHuX,KAAM,CACJoyD,OAVc,IAAI0C,KAAQzxE,EAAKktE,aAAazoD,UAChDvkB,EACA,aAQmBgzD,iBACfya,KAAM3tE,EAAK4kE,UACXzb,WAAYjpD,IAGhB6pD,OAAQ,GACRzrB,QAAS,GACTkB,MAAO,GACPi+G,cAAe,IAGXl6I,EAAgBhE,EAAO+yE,QAAQjpD,WACrC,SAAQ0gC,OAASxmD,EACd4C,OAAQ1C,GAAMA,EAAEirD,WAChBtpD,IAAK3B,KAEFirD,WAAW,EACXzR,cAAex5C,EAAE6K,QAAQ2uC,cACzBtuC,MAAOlL,EAAE6K,QAAQK,MACjB2X,QAAS7iB,EAAE6iB,WAIjB9mB,EAAOgG,QAAS/B,IACd,MAAMC,EAAa3D,EAAegqD,OAAOxvC,KACtClW,GACCZ,EAAMa,KAAOD,EAAa2X,OAAO1X,KAAOD,EAAaqqD,WAGzD,GAAIhrD,EAAY,CACd,IAAIW,EAAaX,EAAWqsB,MACxBrsB,EAAWw5C,iBACb74C,OAAa,EACJX,EAAW47E,mBACpBj7E,OAAa,SACNX,EAAWu5C,cAAcjhC,cACzBtY,EAAWu5C,cAAcx1B,QAclCnkB,EAAQymD,OAAOzpD,KAZF,CACXouD,UAAWhrD,EAAWgrD,UACtB//C,MAAOlL,EAAM6K,QAAQK,MACrB8/C,OAAQhrD,EAAMgrD,OACdvR,iBAAkBx5C,EAAWw5C,iBAC7BoiC,iBAAkB57E,EAAW47E,iBAC7BvvD,MAAO1rB,EACPk7E,aAAc77E,EAAW67E,aACzBj5D,QAAS7iB,EAAM6iB,QACf6jC,QAAS1mD,EAAM0mD,QACflN,cAAev5C,EAAWu5C,qBAER,GAEdx5C,EAAMg5C,GAAGqO,sBAAuBuyC,KAK/B,CACL,IAAIh5F,EACJ,MAAMm+C,EAAS,IAAIiJ,KACnB,GAAIhoD,EAAMg5C,GAAGqO,sBAAuBa,KAAS,CAC3C,MAAMhlD,EAAgBlD,EAAMg5C,GAAGqO,YAC/BzmD,EAAWm+C,EAAOwpE,cAChBrlH,EAAc4sD,cACd,CACEhQ,eAAgB,YAChBC,kBAAmB,kBAGlB,CACL,MAAM78C,EAASlD,EAAMg5C,GAAGqO,YACxBzmD,EAAWm+C,EAAOwpE,cAChBrlH,EAAO4sD,cACP,CACEhQ,eAAgB,YAChBC,kBAAmB,cAIzBn/C,EAAWM,KAAKC,MAAMP,GACtBA,EAASuM,KAAOnN,EAAM6K,QAAQK,MAC9BrL,EAAQm6I,cAAcn9I,KAAK+D,OA7B0B,CACrD,MAAMA,EAAeZ,EAAM6K,QAC3BjK,EAAaoqD,OAAShrD,EAAMgrD,cACrBpqD,EAAa2X,OACpB1Y,EAAQymD,OAAOzpD,KAAK+D,MA8B1Bf,EAAQg7B,QAAU5+B,KAAK4+B,QACvBh7B,EAAQk8B,MAAQ9/B,KAAK8/B,MAEdl8B,EAGTq7B,SAASp/B,GACPG,KAAK8/B,MAAQjgC,EAGf8+B,WAAW9+B,GACTG,KAAK4+B,QAAU/+B,EAGTw9I,qBAAqBx9I,GACvBG,KAAKo9I,SAASt7I,OAASjC,EAAQm9I,KAAOh9I,KAAKo9I,SAASt7I,MAAMk7I,MAAQn9I,EAAQm9I,KAC5Eh9I,KAAK+Q,eAAeX,uBAGtBvQ,EAAQqwD,SAAWrwD,EAAQqwD,SAAWrwD,EAAQqwD,SAAW,GACzDrwD,EAAQqwD,SAAStvD,KAAKf,EAAQmP,SAC9BnP,EAAQqwD,SAASxqD,IAAI5F,IACfA,IACFA,EAAQmP,MAAQnP,EAAQmP,MACpBjP,KAAK+P,gBAAgB/B,UAAUgC,QAAQlQ,EAAQmP,YAC/C,EACJnP,EAAQwP,KAAOxP,EAAQwP,KACnBtP,KAAK+P,gBAAgB/B,UAAUgC,QAAQlQ,EAAQwP,WAC/C,EACJtP,KAAK+Q,eAAe/B,QAAQlP,MAK1B67I,gBAAgB97I,GACtB,GAAIG,KAAKs6F,QAAS,CAChB,IAAIl6F,EACJ,UAAWE,KAAOsF,OAAOC,KAAK7F,KAAKm7I,UAAUr5I,OAI3C,GAHA1B,EAAgBJ,KAAKm7I,UAAUr5I,MAAMxB,GAAKua,KAAMra,GACvCA,EAAEw8I,MAAQn9I,GAEfO,EACF,MAIJ,OAAIA,GAAiBA,EAAc49I,YAC1BhyI,MAAG5L,GAKLJ,KAAKw7I,WADDp7I,EAAgBA,EAAcwE,GAAK/E,GAIhD,MAAMC,EAAkBE,KAAKm7I,UAAUr5I,MAAM+4I,KAAKhgI,KAAMza,GAC/CA,EAAe48I,MAAQn9I,IAAmC,IAA5BO,EAAe49I,UAGtD,OAAIl+I,GACK,QAAGA,GAEHE,KAAK68I,gBAAgBh9I,GAIhCo+I,iBAAiBp+I,GACf,MAAMC,EAAkB,GAExB,OADkBD,EAAO+yE,QAAQjpD,WACvB7jB,QAASzF,KACZA,EAAM2uD,WAAkC,2BAArB3uD,EAAMuO,QAAQhK,IACpC9E,EAAOc,KAAKP,KAGTP,EAGDm7I,uBACDj7I,KAAK6T,OAIV7T,KAAK6T,MAAMD,YAAYxL,UAAWvI,IAChC,MAAMC,EAAYE,KAAK6T,MAAMjF,QAAQqD,UACjCnS,GAAaD,EAAOC,KAEtBE,KAAKu9I,iBAAiBluE,OADDxvE,EAAOC,GACgB6D,MAAM,KAAK+B,IAAIulB,SAG7D,MAAM7qB,EAAgBJ,KAAK6T,MAAMjF,QAAQuD,cACrC/R,GAAiBP,EAAOO,KAE1BJ,KAAKu9I,iBAAiB9zF,WADE5pD,EAAOO,IAIjC,MAAMC,EAAUL,KAAK6T,MAAMjF,QAAQsD,QAC/B7R,GAAWR,EAAOQ,KAEpBL,KAAKu9I,iBAAiBtvE,KAAOhjD,OADXprB,EAAOQ,OAMvBokG,QAAQ5kG,GAGd,MAAO,GAFUG,KAAK4O,QAAQksI,SAAS30I,QAAQ,MAAO,OAEhCtG,IAGhB4Q,YACN5Q,EACAC,EACAM,GAEA,MAAMC,EAAUL,KAAKm7I,UAAUr5I,MAAM+4I,KAAKhgI,KAAMra,GAAQA,EAAIw8I,MAAQl9I,GAC9DQ,EAAeD,EAAUA,EAAQ4O,MAAQnP,EAC/CD,EAAMwL,MAAM4D,MAAQjP,KAAK+P,gBAAgB/B,UAAUgC,QACjD,4CAGFnQ,EAAMwL,MAAM2D,QAAUhP,KAAK+P,gBAAgB/B,UAAUgC,QACnD,0CACA,CAAElO,MAAOxB,IAGXT,EAAMwL,MAAMyF,WAAY,EAEpB1Q,IACFP,EAAMwL,MAAM4D,MAAQjP,KAAK+P,gBAAgB/B,UAAUgC,QACjD,wDAEFnQ,EAAMwL,MAAM2D,QAAUhP,KAAK+P,gBAAgB/B,UAAUgC,QACnD,oDAGJhQ,KAAK+Q,eAAe1F,MAAMxL,EAAMwL,MAAM2D,QAASnP,EAAMwL,MAAM4D,OAGrDmsI,qBACNv7I,GAAqB,GAErB,MAAMC,EAAUE,KAAKo9I,SAASt7I,MACxB1B,EAAgBJ,KAAK09I,eAAe57I,QACrChC,GAAWA,EAAQk9I,MAAQh9I,KAAK4O,QAAQosI,qBAC3Cn7I,GAAqB,GAElBA,GAAuBG,KAAKk+I,YAAYp+I,IAI3CE,KAAK27I,gBAAgB77I,EAAQk9I,KAC1Bz0I,MAAK,WACLH,UACE9H,IACCN,KAAKm+I,cAAch2I,KAAK7H,KAI1BN,KAAKs6F,SAAWt6F,KAAK+zC,YAAYxD,eACnCvwC,KAAKy7I,aAAarzI,cAZpBpI,KAAKg7I,uBAAoB,EACzBh7I,KAAK+8I,sBAcP,MAAM18I,EAAcL,KAAKk+I,YAAY99I,KAChCC,GAA0C,UAA3BA,EAAY67I,aAC9Bl8I,KAAKy9I,sBAAiB,GAIlBR,iBAAiBp9I,GAEvB,IADqBG,KAAKk+I,YAAYr+I,GACnB,CACjB,MAAMO,EAAmB,CACvBwE,GAAI/E,EAAQ+E,GACZo4I,IAAKn9I,EAAQm9I,IACb/tI,MAAOpP,EAAQoP,MACf2G,MAAO/V,EAAQ+V,MACfsmI,WAAYvB,GAAeA,GAAe97E,OAGxC7+D,KAAKm7I,UAAUr5I,OAAS9B,KAAKm7I,UAAUr5I,MAAMs8I,SAC/Cp+I,KAAKm7I,UAAUr5I,MAAMs8I,OAAOx9I,KAAKR,GACjCJ,KAAKm7I,UAAUhzI,KAAKnI,KAAKm7I,UAAUr5I,SAKjCo8I,YAAYr+I,GAClB,IAAKA,EACH,OAAO,EAGT,MAAMC,EAAWE,KAAKm7I,UAAUr5I,MAChC,IAAI1B,EACJ,UAAWC,KAAOuF,OAAOC,KAAK/F,GAO5B,GALAM,EAAQN,EADeO,GACTwa,KACXra,GACEX,EAAQ+E,IAAMpE,EAAEoE,KAAO/E,EAAQ+E,IAC/B/E,EAAQm9I,KAAOx8I,EAAEw8I,MAAQn9I,EAAQm9I,KAElC58I,EACF,MAIJ,OAAOA,gDAzvBEW,GAAcrB,qGAAdqB,EAAcsI,QAAdtI,EAAc,qBAFb,SAEDA,MCHAs9I,iBAA4Bt0I,iBAErC,MAAO,CACLC,SAAUjJ,iDAHHA,4DAxBF,CACPslB,MACAA,MACArZ,KACAgiB,KACAs4E,MACArR,KACA40B,MACAzxF,MACAwxF,MACA/+F,MACA0I,KACAlF,KACA1iB,GACAg4B,GACA1V,SASSluB,MC7BAu9I,iBAQXv2I,YACElI,EACQC,EACAM,GADAJ,sBACAA,oBAERA,KAAKs2B,UAAYz2B,YARjB,OAAOG,KAAKs2B,UAAU5wB,IAWxB8a,WACExgB,KAAKu+I,UAAYv+I,KAAKw+I,eAAepB,SAClC70I,QAAKqxC,MAAO/5C,QAAuB,IAAZA,IACvBuI,UAAUvI,GAAWG,KAAKy+I,oBAAoB5+I,IAGnDsY,cACEnY,KAAKu+I,UAAU71I,cAGT+1I,oBAAoB5+I,GAC1B,QAAoB,IAAhBA,EAAQ6F,IACV,OAiBF,MAAM5F,EAA8BD,EAAQ6F,IAAIuX,OAC3Cjd,KAAKs2B,UAAUrZ,OAAwC,IAAhCnd,EAAYw9I,mBACtCt9I,KAAKs2B,UAAUrZ,KAAOnd,GAEpBE,KAAKs2B,UAAU5wB,IAAIsuE,uBACrBh0E,KAAKs2B,UAAU5wB,IAAIsuE,sBAAsB1C,yBAAyBxxE,GAGpE,MAAMM,EAAsCP,EAAQ6F,IAAIgiB,SACxD,IAAK1nB,KAAKs2B,UAAU5O,UAAYtnB,EAAiB,CAC/C,GAAIJ,KAAKikB,aAAalP,YACsB,kBAA/B3U,EAAgB0yE,UAA0B,CACnD,MAAMzyE,EAAkBD,EAAgB0yE,UACnCzyE,EAAgBq+I,WACnBr+I,EAAgBq+I,SAAWn3I,KAAK0b,IAAI,GAAI5iB,EAAgBq+I,UACxDt+I,EAAgB0yE,UAAYzyE,GAIlCL,KAAKs2B,UAAU5O,SAAWtnB,iDAhEnBW,GAAmBrB,wDAAnBqB,EAAmBugB,sCAAnBvgB,MCYA49I,iBAYX52I,YACUlI,EACAC,EACAM,EACAC,EACAC,EACAE,EACYkD,GANZ1D,iBACAA,sBACAA,oBACAA,qBACAA,wBACAA,oBACYA,aAfdA,mBAAyB,GAExBA,kCAAuC,YAG9C,OAAOA,KAAKs2B,UAAU5wB,IAaxB8a,WAKE,GAJAxgB,KAAKu+I,UAAYv+I,KAAKw+I,eAAepB,SAClC70I,QAAKqxC,MAAQ/5C,QAAwB,IAAZA,IACzBuI,UAAWvI,GAAYG,KAAKy+I,oBAAoB5+I,IAGjDG,KAAK6T,OACL7T,KAAK6T,MAAMjF,QAAQ0D,oBACnBtS,KAAK6T,MAAMjF,QAAQ2D,qBACnBvS,KAAK6T,MAAMjF,QAAQwD,WACnB,CACA,MAAMvS,EAAgBG,KAAK6T,MAAMD,YAAYxL,UAAWtI,IAClD8F,OAAOC,KAAK/F,GAAQS,OAAS,IAC/BP,KAAK4T,YAAc9T,EACnBD,EAAc6I,kBAMtByP,cACEnY,KAAKu+I,UAAU71I,cAGT+1I,oBAAoB5+I,GAC1B,QAAuB,IAAnBA,EAAQwqD,OACV,QAEuC,IAArCrqD,KAAK4+I,4BACP5+I,KAAK0F,IAAIgwE,kBAET11E,KAAK0F,IAAI4vE,aAAat1E,KAAK6+I,eAE7B7+I,KAAK6+I,cAAgB,GAErB,MAAM/+I,GAAkB,WACnBD,EAAQwqD,OAAO3kD,IAAI,CAACtF,EAA4BC,IAC1CL,KAAK6gF,aAAatB,iBAAiBn/E,EAAcP,EAAQm9I,OAIpEl9I,EACGyI,MAAK,QAAOzI,EAAgByI,MAAK,OAAa,QAC9CH,UAAWhI,IACVA,EAASA,EACNqG,OAAQpG,QAA2B,IAAVA,GACzBqF,IAAKrF,IACJA,EAAMumB,QAAU5mB,KAAK8+I,8BAA8Bz+I,GACnDA,EAAM0uD,OAAS1uD,EAAM0uD,OAEd1uD,IAGXL,KAAK6+I,cAAc74I,OAAO5F,GAC1BJ,KAAK0F,IAAIyvE,UAAU/0E,GAEfP,EAAQk+I,eACVl+I,EAAQk+I,cAAcj4I,QAASzF,IAC7B,MAAMC,EAAS,IAAIyrD,KACbvrD,EAAQH,EAAkB6Q,KAChC7Q,EAAoB4E,KAAKE,UAAU9E,GACnCA,EAAoBC,EAAO8zD,aAAa/zD,EAAmB,CACzDwjD,eAAgB,YAChBC,kBAAmB,cAErB9jD,KAAU6O,cAAcnE,UAAU,4BCmG5C3J,EACAO,EACAzB,EACAC,EACAM,GAEA,IAAIC,EACAC,EAqCAE,EAnCJ,GACEV,EAAiButH,aAAaxtH,EAAWoD,WAAa,qBACtD,CACA,MAAMW,EAAqC9D,EAAiButH,aAC1DxtH,EAAWoD,WAAa,qBAG1B5C,EAAQ,CAACwD,EAASE,IACT3D,EAAawqE,uBAAuB/mE,EAASD,EAAkBG,WAGxEjE,EAAiButH,aAAaxtH,EAAWoD,WAAa,iBACtD,CACA,MAAMW,EAA6B9D,EAAiButH,aAClDxtH,EAAWoD,WAAa,iBAE1B3C,EAAWR,EAAiButH,aAC1BxtH,EAAWoD,WAAa,aAG1B5C,EAAQ,CAACwD,EAASE,KAChB,MAAMC,EAAY5D,EAAagqE,YAC7BtqE,EAAiButH,aAAaxtH,EAAWoD,WAAa,iBAAkBY,EAASE,GAEnF,OAAO3D,EAAa6qE,mBAAmBpnE,EAASE,EAAYH,EAAcI,SAG5E3D,EADSP,EAAiButH,aAAaxtH,EAAWoD,WAAa,UACvD,CAACW,EAASC,IAAezD,EAAagqE,YAC5CtqE,EAAiButH,aAAaxtH,EAAWoD,WAAa,UAAWW,EAASC,GAGpE,CAACD,EAASC,IAAezD,EAAagqE,YAC5CtqE,EAAiButH,aAAa,iBAAkBzpH,EAASC,GAKzD/D,EAAiButH,aAAaxtH,EAAWoD,WAAa,kBAOxDzC,EAAS,IAAI0rD,GALkB,CAC7BohE,WACAxoH,KAAM,UACNs6D,WAAW,IAGb5+D,EAAOu8C,GAAGzgC,OAAO+3C,YAAYtzD,KAO7BP,EAAS,IAAIwrD,GAJkB,CAC7BlnD,KAAM,SACNs6D,WAAW,IAGb5+D,EAAOu8C,GAAGsX,YAAYtzD,IAGxB,MAAM2C,EAAQ,IAAIyhE,GAAY,CAC5Bl2D,MAAOpP,EACP0vD,oBAAoB,EACpBjzC,SACA+T,UAEF/uB,EAAI+jE,SAAS3hE,GD1K+B,CAI9BrD,EACAL,KAAK0F,IACLlF,EACAR,KAAK0zH,iBACL1zH,KAAKi5E,uBCkDnBl4E,EACAO,EACAzB,GAEA,MAAMC,EAAIyH,KAAK4hB,MAAsB,IAAhB5hB,KAAKI,UACpBvH,EAAImH,KAAK4hB,MAAsB,IAAhB5hB,KAAKI,UACpBtH,EAAIkH,KAAK4hB,MAAsB,IAAhB5hB,KAAKI,UACpBrH,EAAS,IAAIm7D,KAAe,CAChChrC,MAAO,CAAC3wB,EAAGM,EAAGC,EAAG,GACjBo3D,MAAO,IAGHj3D,EAAO,IAAI+5D,KAAa,CAC5B9pC,MAAO,CAAC3wB,EAAGM,EAAGC,EAAG,MAMbuD,EAAS,IAAIooD,GAJ0D,CAC3ElnD,KAAM,SACNs6D,WAAW,IAGbx7D,EAAOm5C,GAAGsX,YAAYtzD,GACtB,MAAM8C,EAAQ,IAAIshE,GAAY,CAC5Bl2D,MAAOpP,EACP0vD,oBAAoB,EACpBjzC,SACA+T,MAAO,IAAI+pC,MAAc,CACvBoB,SACAlB,OACAxsB,MAAO,IAAI8tB,KAAe,CACxB7N,OAAQ,EACRyN,SACAlB,aAINh5D,EAAI+jE,SAASxhE,GDrFMo1E,CAPkB54E,EAAmBL,KAAK0F,IAAKlF,OAe1Ds+I,8BAA8Bj/I,GACpC,MAAMC,EAASE,KAAK4T,YAEdvT,EAAyBR,EAAM+E,GAErC,IAAItE,EAAUT,EAAM+mB,QACpB,IAAK9mB,IAAWO,EACd,OAAOC,EAGT,MAAME,EAAgBV,EAAOE,KAAK6T,MAAMjF,QAAQwD,YAChD,GAAI5R,IATmBR,KAAKw+I,eAAepB,SAASt7I,MAAMk7I,MASjBx8I,EAAe,CACtD,IAAIkD,EAAwB,GACxBE,EAAyB,GACzBC,EAA0B,GAC1BE,EAA4B,GAG9B/D,KAAK6T,MAAMjF,QAAQ0D,oBACnBxS,EAAOE,KAAK6T,MAAMjF,QAAQ0D,sBAE1B5O,EACE5D,EAAOE,KAAK6T,MAAMjF,QAAQ0D,qBAG5BtS,KAAK6T,MAAMjF,QAAQ2D,qBACnBzS,EAAOE,KAAK6T,MAAMjF,QAAQ2D,uBAE1B3O,EACE9D,EAAOE,KAAK6T,MAAMjF,QAAQ2D,sBAKA,MAA1B7O,IACFpD,GAAU,GAEmB,MAA3BsD,IACFtD,GAAU,GAIZuD,EAAgBH,EAAsBC,MAAM,KAC5CI,EAAkBH,EAAuBD,MAAM,MAC3CE,EAAc3D,QAAQG,IAAkB,GAAMwD,EAAc3D,QAAQG,EAAe4C,aAAc,KACnG3C,GAAU,IAERyD,EAAgB7D,QAAQG,IAAkB,GAAM0D,EAAgB7D,QAAQG,EAAe4C,aAAc,KACvG3C,GAAU,GAId,OAAOA,gDA3JES,GAAqBrB,iGAArBqB,EAAqBugB,2GAArBvgB,ME3Bb,IAAYg+I,GAIX,MAJD,OAAYh+I,UAAuB,KACjC6uF,gBACA7uF,gBACAA,oBAHUg+I,GAAZ,IAAYh+I,GAIX,OCGYi+I,iBAGXj3I,YAAmBlI,kEAHRkB,GAAuBrB,uCAAvBqB,EAAuBugB,iZCPpC5hB,gBAA4CA,8BAA2DA,QACvGA,iBACEA,0BACEA,mBAGEA,0EAHFA,QAIFA,QACFA,QACAA,iBACEA,oBAEOA,gCAASI,6BACdJ,+BACFA,QACAA,qBACQA,gCAASI,mBAAgB,KAC/BJ,gCACFA,QACFA,eAnB4CA,qEAKtCA,yFAA2E,mBAMxEA,oCAELA,2EAIAA,yLDVSqB,+BEITrB,4CAAqCA,mHACrCA,uCAA+BA,iFATjCA,oBAOEA,2GACAA,6BACAA,wBACFA,gCANEA,6FAA4F,uCAIjFA,4CACLA,qFAERA,oBAOEA,2GACAA,sBACFA,gCALEA,qEAAgE,iFAY/DA,qBAMEA,0DAASU,8CACTV,uBACFA,iCALEA,iEAA4D,2DAS7DA,qBAKEA,0DAASU,2DACTV,uBACFA,iCALEA,8EAAyE,2DAe3EA,qBAMEA,0DAASU,+CACTV,uBACFA,iCALEA,kEAA6D,2DAO/DA,qBAMEA,0DAASU,8CACTV,uBACFA,iCALEA,uBAAe,qGAOjBA,qBAMEA,0DAASU,8CACTV,uBACFA,iCALEA,uBAAe,qGAOjBA,qBAMEA,0DAASU,8CACTV,uBACFA,iCALEA,uBAAe,qGAOjBA,qBAMEA,0DAASU,gDACTV,uBACFA,aAJEA,4GA7ENA,kBAIGA,4BAUDA,qBAEEA,4BAiBAA,4BAUAA,4BAUAA,4BAUAA,4BAUAA,4BASFA,QAEAA,sBAOEA,oFACAA,wBACFA,QAEFA,2CA3FYA,sIAYCA,uDAiBAA,2CAUAA,4GAUAA,8DAUAA,6DAUAA,2GAeTA,gCAAe,WAAfA,CAAe,oFC/FRu/I,iBA4BXl3I,YACSlI,EACCC,GADDE,YACCA,sBA7BHA,oBAAiB26I,GACjB36I,WAAQ,UACRA,gBAAY,EAEVA,mBAAwB,EAKvBA,UAAO,IAAIN,MACXM,YAAS,IAAIN,MACbM,UAAO,IAAIN,MACXM,WAAQ,IAAIN,MACZM,UAAO,IAAIN,MACXM,UAAO,IAAIN,MACXM,cAAW,IAAIN,MACfM,uBAAoB,IAAIN,MACxBM,iBAAc,IAAIN,mBAG1B,OAAOM,KAAKk/I,QAAQrvH,sBAIpB,OAA+C,IAAxC7vB,KAAKswE,eAAe7mE,IAAI,YAQjC01I,cAAct/I,GACZG,KAAKo/I,SAASlnI,KAAKrY,iDAlCVkB,GAAoBrB,8CAApBqB,EAAoBugB,65EDnBjC5hB,2BAGEA,2BAWAA,2BAUAA,gBAAYA,SAAiBA,QAE7BA,0BAiGFA,eAzHEA,sCAEGA,4CAWAA,6DASSA,gCAENA,6hBCPKqB,+CCZTrB,qBAQEA,kEACAA,uBACFA,kDAhBFA,6BACEA,oBAIEA,wFAJFA,QAKAA,4BAWFA,gCAjBqCA,kIAIjCA,wFAA0E,kBAOzEA,+EAQLA,qBAMAA,6DAAoB,0BACpBA,uBACAA,aAJAA,wHAKAA,qBAMEA,6DAAoB,0BACpBA,uBACFA,aAJEA,sGAMFA,iDAEEA,2BAAmB,sBAAnBA,CAAmB,cAAnBA,CAAmB,wCAAnBA,CAAmB,gBAAnBA,CAAmB,mDASrBA,0CAMEA,uBACFA,uCAJEA,uEAAkE,kDAgB9DA,qBAGEA,SACFA,mDAHEA,6BAEAA,2DAEFA,oBAGEA,SACFA,wCADEA,0EAKFA,0BAGEA,iCAASU,qBAATV,CAAkC,uGAElCA,SACFA,+CAJEA,4CAGAA,0EA3BNA,SACEA,kBACEA,2BAIEA,iCAASU,qBAATV,CAAkC,iFAEpCA,QACAA,4BAKAA,4BAKFA,QAEAA,4BACEA,kCAOFA,QACFA,8CA1BMA,qDAAuC,kDAKhCA,gCAONA,iCAM6BA,6EA6BhCA,+BAMEA,0DAAQA,EAARomB,OAAQwsH,cAAR5yI,CAA2B,sDACjBA,EADiBomB,OACjBnc,gBADVjK,CAA2B,qDAElBA,EAFkBomB,OAElBpc,eAFThK,CAA2B,oDAGnBA,EAHmBomB,OAGnBw0G,cAHR56H,CAA2B,6EAA3BA,CAA2B,6EAA3BA,CAA2B,wDAMfA,EANeomB,OAMfs5H,kBANZ1/I,CAA2B,2DAOZA,EAPYomB,OAOZu5H,qBAPf3/I,CAA2B,iEAQNA,EARMomB,OAQNw5H,2BARrB5/I,CAA2B,sDASjBA,EATiBomB,OASjBjjB,gBATVnD,CAA2B,wDAUfA,EAVeomB,OAUf0b,mBACd9hC,+CAdEA,mEAAmE,YAAnEA,CAAmE,yGAPzEA,8BAC2DA,2IAEzDA,iCAqBFA,oDAxB0EA,gDAAqD,gDAG9FA,4EAwB/BA,+BAOEA,8DAAYA,EAAZomB,OAAYs5H,kBAAZ1/I,CAAmC,sDACzBA,EADyBomB,OACzBjjB,gBADVnD,CAAmC,wDAEvBA,EAFuBomB,OAEvB0b,mBACd9hC,+CAPEA,oFAA4E,4DAA5EA,CAA4E,YAA5EA,CAA4E,+HAJhFA,gEAAyFA,oDA1BzFA,qCA0BAA,8DA1BkBA,mDA0BJA,kEC1FL6/I,iBA+GXx3I,YACUlI,EACAC,EACDM,EACAC,EACCC,EACAE,EACAkD,GANA1D,aACAA,sBACDA,qBACAA,YACCA,cACAA,uBACAA,sBArHFA,qBAAgC,CAAE66I,KAAM,IAChD76I,eAA2C,IAAI+I,IAC7C/I,KAAKw/I,iBAGPx/I,aAAU,IAAImZ,KAAoB,GAa1BnZ,eAA0B,CAAE66I,KAAM,IA+BnC76I,eAAgC,GAE7BA,YAAS,IAAIN,MACbM,cAAW,IAAIN,MACfM,UAAO,IAAIN,MACXM,YAAS,IAAIN,MACbM,UAAO,IAAIN,MACXM,WAAQ,IAAIN,MACZM,YAAS,IAAIN,MACbM,UAAO,IAAIN,MACXM,UAAO,IAAIN,MACXM,wBAAqB,IAAIN,MACzBM,cAAW,IAAIN,MACfM,uBAAoB,IAAIN,MACxBM,iBAAc,IAAIN,MAClBM,8BAA2B,IAAIN,MAIlCM,kBAAe,CACpB66I,KAAM,yCACN4E,OAAQ,4CACRrB,OAAQ,6CAIHp+I,iBAAuC,GAEvCA,iBAAc,IAAI+mC,GAAY,IAC9B/mC,mBAAgB+rB,WAEhB/rB,WAAQ,UAERA,iBAAa,EAabA,WAAgB,GASfA,uBAAwB,EAEzBA,uBAAoB++I,GAAwBnvD,OAE5C5vF,uBAAoB,iBAjGzB,OAAOA,KAAK0/I,uBAED7/I,GACXG,KAAK0/I,UAAY7/I,EACjBG,KAAKkf,MAAMD,gBACXjf,KAAKmI,6BAML,OAAOnI,KAAK2/I,qCAEM9/I,GAClBG,KAAK2/I,iBAAmB9/I,EACxBG,KAAKkf,MAAMD,0BAMX,OAAOjf,KAAKg7E,aAENn7E,GACNG,KAAKg7E,KAAOn7E,yBAMZ,OAAOG,KAAK6O,cAAcnE,UAAU,WAAa1K,KAAK4/I,kBACpD5/I,KAAKswE,eAAe7mE,IAAI,yBAAqCzJ,KAAK4/I,uCAEjD//I,GACnBG,KAAK4/I,kBAAoB//I,WA2ClBA,GACPG,KAAKmuI,MAAQtuI,EACbG,KAAKmI,kBAGL,OAAOnI,KAAKmuI,wBAKZ,OAAOnuI,KAAKuwF,6BAEE1wF,GACdG,KAAKuwF,aAAe1wF,EACpBG,KAAKmI,OAkBPqY,WACExgB,KAAKqxF,SAAWrxF,KAAKoa,QAClB7R,MACC,QAAS,IAC8B,IAA9BvI,KAAK6/I,SAAShF,KAAKt6I,OAAegoF,MAAQ,QAAM,MAG1DngF,UAAU,KACTpI,KAAKm7I,UAAUhzI,KAAKnI,KAAK8/I,mBAAmB9/I,KAAK6/I,aAGrD7/I,KAAKqnC,YAAYz8B,KAAK,CACpB,CACEhG,GAAI,eACJqK,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QACpC,2CAEFiJ,KAAM,cACN8T,QAAS/sB,KAAK+P,gBAAgB/B,UAAUgC,QACtC,kDAEF+d,QAAS,KACP/tB,KAAK+/I,eAAc,KAGvB,CACEn7I,GAAI,iBACJqK,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QACpC,yCAEFiJ,KAAM,YACN8T,QAAS/sB,KAAK+P,gBAAgB/B,UAAUgC,QACtC,gDAEF+d,QAAS,KACP/tB,KAAK+/I,eAAc,OAMnB53I,OACNnI,KAAKoa,QAAQjS,OAGP23I,mBAAmBjgJ,GACzB,GAAkB,KAAdG,KAAK20F,KACP,OAAI30F,KAAKggJ,cACPngJ,EAAWG,KAAKigJ,iBAAiBpgJ,IAE5BA,EACF,CAaL,IAAIO,EAA+B,CACjCy6I,KAbWh7I,EAASg7I,KAAKp0I,OAAQpG,IACjC,MAAMC,EAAmBN,KAAK20F,KAC3B5tF,cACA4hB,UAAU,OACVxiB,QAAQ,mBAAoB,IAK/B,OAJ+B9F,EAAQ4O,MACpClI,cACA4hB,UAAU,OACVxiB,QAAQ,mBAAoB,IACDsN,SAASnT,MAOzC,GAAIN,KAAK6/I,SAASzB,OAAQ,CACxB,MAAM/9I,EAAUR,EAASu+I,OAAO33I,OAAQnG,IACtC,MAAME,EAAmBR,KAAK20F,KAC3B5tF,cACA4hB,UAAU,OACVxiB,QAAQ,mBAAoB,IAK/B,OAJ+B7F,EAAQ2O,MACpClI,cACA4hB,UAAU,OACVxiB,QAAQ,mBAAoB,IACDsN,SAASjT,KAEzCJ,EAAeg+I,OAAS/9I,EAG1B,GAAIL,KAAK6/I,SAASJ,OAAQ,CACxB,MAAMp/I,EAASR,EAAS4/I,OAAOh5I,OAAQnG,IACrC,MAAME,EAAmBR,KAAK20F,KAC3B5tF,cACA4hB,UAAU,OACVxiB,QAAQ,mBAAoB,IAK/B,OAJ+B7F,EAAQ2O,MACpClI,cACA4hB,UAAU,OACVxiB,QAAQ,mBAAoB,IACDsN,SAASjT,KAEzCJ,EAAeq/I,OAASp/I,EAG1B,OAAIL,KAAKggJ,cACP5/I,EAAiBJ,KAAKigJ,iBAAiB7/I,IAElCA,GAIX+X,cACEnY,KAAKqxF,SAAS3oF,cAGTw3I,aACL,OAAQlgJ,KAAKmgJ,wBACNpB,GAAwBnvD,OAC3B,OAAO,OACJmvD,GAAwBzrD,MAC3B,OAAO,UAEP,IAAIzzF,EAAcG,KAAK6/I,SAAShF,KAAKt6I,OAOrC,OALKV,GADLG,KAAK6/I,SAASzB,OACMp+I,KAAK6/I,SAASzB,OAAO79I,OACrB,EAEfV,GADLG,KAAK6/I,SAASJ,OACMz/I,KAAK6/I,SAASJ,OAAOl/I,OACrB,EAChBV,GAAeG,KAAKogJ,mBAO9BH,iBAAiBpgJ,GACf,GAAIA,EAAU,CACZ,MAAMC,EAAemF,KAAKC,MAAMD,KAAKE,UAAUtF,IAC/C,SAAag7I,KAAK5/H,KAAK,CAAC7a,EAAGC,IACrBL,KAAK2oB,UAAUvoB,EAAE6O,OAASjP,KAAK2oB,UAAUtoB,EAAE4O,QACtC,EAELjP,KAAK2oB,UAAUvoB,EAAE6O,OAASjP,KAAK2oB,UAAUtoB,EAAE4O,OACtC,EAEF,GAGLnP,EAAa2/I,OACf3/I,EAAa2/I,OAAOxkI,KAAK,CAAC7a,EAAGC,IACvBL,KAAK2oB,UAAUvoB,EAAE6O,OAASjP,KAAK2oB,UAAUtoB,EAAE4O,QACtC,EAELjP,KAAK2oB,UAAUvoB,EAAE6O,OAASjP,KAAK2oB,UAAUtoB,EAAE4O,OACtC,EAEF,GAEAnP,EAAas+I,QACtBt+I,EAAas+I,OAAOnjI,KAAK,CAAC7a,EAAGC,IACvBL,KAAK2oB,UAAUvoB,EAAE6O,OAASjP,KAAK2oB,UAAUtoB,EAAE4O,QACtC,EAELjP,KAAK2oB,UAAUvoB,EAAE6O,OAASjP,KAAK2oB,UAAUtoB,EAAE4O,OACtC,EAEF,GAGJnP,GAIX6oB,UAAU9oB,GACR,OAAOA,EACJ8oB,UAAU,OACVxiB,QAAQ,mBAAoB,IAC5BY,cAGLs5I,WAAWxgJ,GACTG,KAAKggJ,YAAcngJ,EAGrBygJ,cACEtgJ,KAAK20F,KAAO,GAGdorD,cAAclgJ,GACZG,KAAKkyB,OACFD,KAAK+sH,GAAyB,CAAE7sH,cAAc,IAC9CG,cACA/pB,MAAK,QAAK,IACVH,UAAWtI,IACNA,GACFE,KAAK0H,OAAOwQ,KAAK,CAAEjJ,QAAOsxI,YAKlCC,cAAc3gJ,GACZ,GAAIA,EAEF,OADmBG,KAAKygJ,YAAY5lI,KAAMza,GAAMA,EAAE8Q,OAASrR,EAAKqR,MAKpEwvI,cAAc7gJ,EAAMC,GAClB,MAAMM,EAAaJ,KAAKwgJ,cAAc3gJ,GAUtC,GATIO,IACFA,EAAWknB,SAAWlnB,EAAWknB,QACjCtnB,KAAKswE,eAAe76D,IAClB,wBAA0BrV,EAAW8Q,KACrC9Q,EAAWknB,SAEblnB,EAAWugJ,eAAgB,GAGzB7gJ,EAAQ,CACV,IAAIO,GAAgB,EAEpB,UAAWG,KAAKV,EAAO8gJ,OAErB,GAAI5gJ,KADqBwgJ,cAAchgJ,GACvB8mB,UAAYlnB,EAAWknB,QAAS,CAC9CjnB,GAAgB,EAChB,MAGJ,MAAMC,EAAmBN,KAAKwgJ,cAAc1gJ,GACxCQ,IACFA,EAAiBgnB,QAAUlnB,EAAWknB,QACtCtnB,KAAKswE,eAAe76D,IAClB,wBAA0BnV,EAAiB4Q,KAC3C9Q,EAAWknB,SAEbhnB,EAAiBqgJ,cAAgBtgJ,GAIrC,GAAIR,EAAK+gJ,OACP,UAAWvgJ,KAAKR,EAAK+gJ,OAAQ,CAC3B,MAAMtgJ,EAAqBN,KAAKwgJ,cAAcngJ,GAE5CC,GACAA,EAAmBgnB,UAAYlnB,EAAWknB,UAE1ChnB,EAAmBgnB,QAAUlnB,EAAWknB,QACxCtnB,KAAKswE,eAAe76D,IAClB,wBAA0BnV,EAAmB4Q,KAC7C9Q,EAAWknB,UAMnBtnB,KAAK6gJ,yBAAyB3oI,KAAKlY,KAAKygJ,aAG1C1E,YAAYl8I,GAEV,GADAA,EAAQgwB,QAAS,GACZ7vB,KAAK8gJ,WAAY,CACpB,MAAMhhJ,EAAyB,CAAE+6I,KAAM,GAAI4E,OAAQ,GAAIrB,OAAQ,IAC/Dt+I,EAAS+6I,KAAO76I,KAAK6/I,SAAShF,KAAKp0I,OAAQrG,GAAMA,EAAEwE,KAAO/E,EAAQ+E,IAClE9E,EAAS2/I,OAASz/I,KAAK6/I,SAASJ,OAAOh5I,OAAQrG,GAAMA,EAAEwE,KAAO/E,EAAQ+E,IACtE9E,EAASs+I,OAASp+I,KAAK6/I,SAASzB,OAAO33I,OAAQrG,GAAMA,EAAEwE,KAAO/E,EAAQ+E,IACtE5E,KAAK6/I,SAAW//I,EAElBE,KAAK89B,KAAK5lB,KAAKrY,GAGjBm8I,YAAYn8I,GACVA,EAAQgwB,QAAS,EACjB7vB,KAAKu8B,KAAKrkB,KAAKrY,iDApYNkB,GAAoBrB,qGAApBqB,EAAoBugB,++ED3CjC5hB,sBACEA,mCAmBAA,2BASAA,2BAUAA,kCAWAA,2BASAA,2BACEA,iCAgCAA,kBACEA,2BAGEA,iCAASW,qBAATX,CAAkC,2BACxBI,8BACZJ,QACAA,qBACEA,gCACFA,QACFA,QACFA,QAEAA,yEA2CFA,eApJUA,uBACSA,sCAoBhBA,sCASEA,qCASaA,kFAWPA,kFAUwBA,kCAmC3BA,uCAKAA,6EAK+BA,suBC9D1BqB,MCfAggJ,iBAoMXh5I,YACUlI,EACAC,EACAM,EACAC,EACAC,EACAE,EACAkD,EACAE,EACAC,GAPA7D,sBACAA,kBACAA,uBACAA,4BACAA,sBACAA,YACAA,sBACAA,aAERA,KAAKs2B,UAAYz2B,EAvMnBm/F,SAASn/F,GACPG,KAAKw+I,eAAerB,YAAYt9I,EAAQm9I,KAI1CgE,OAAOnhJ,GACLG,KAAKw+I,eAAehB,kBAAkB39I,EAAQm9I,KAIhDiE,OAAOphJ,GACL,MAAMC,EAAME,KAAKy/D,WAAWrC,SACtBh9D,EAAiBJ,KAAKw+I,eAAeb,kBAAkB79I,GAEvDO,EAAa,KACjB,MAAMG,EAAYR,KAAK+P,gBAAgB/B,UACjCtK,EAAUlD,EAAUwP,QACxB,4CACA,CACElO,MAAOjC,EAAQoP,QAGbrL,EAAQpD,EAAUwP,QACtB,+CAEFhQ,KAAK+Q,eAAevB,QAAQ9L,EAASE,IAGvC,GAAI/D,EAAQm+I,SAOV,OANA59I,EAAe6O,MAAQpP,EAAQoP,MAC/BjP,KAAKw+I,eAAe70I,OAAO9J,EAAQ+E,IAAI,QACvC5E,KAAKw+I,eAAe92I,OAAOtH,GAAgBgI,UAAW5H,IACpDR,KAAKw+I,eAAerB,YAAY38I,EAAew8I,KAC/C38I,MAYJL,KAAKw+I,eAAe9kI,OAAO7Z,EAAQ+E,GAPd,CACnBylD,OAAQjqD,EAAeiqD,OACvB3kD,IAAK,CACHuX,KAAM7c,EAAesF,IAAIuX,QAImB7U,UAAU,KACxD/H,MAKJ6gJ,WAAWrhJ,GACJA,EAAQ+E,KACX/E,EAAQ+E,GAAK/E,EAAQm9I,KAEvBh9I,KAAKw+I,eAAe3C,WAAWh8I,EAAQ+E,IAAIwD,UAAU,KAC/CpI,KAAK6X,mBACP7X,KAAK+Q,eAAeZ,OAAOnQ,KAAK6X,mBAElC7X,KAAKw+I,eAAe9C,kBAAkBvzI,KAAKtI,EAAQ+E,IACnD,MAAM9E,EAAYE,KAAK+P,gBAAgB/B,UACjC5N,EAAUN,EAAUkQ,QACxB,gDACA,CACElO,MAAOjC,EAAQoP,QAGb5O,EAAQP,EAAUkQ,QACtB,mDAEI1P,EAAaN,KAAK+Q,eAAevB,QAAQpP,EAASC,GACxDL,KAAK6X,kBAAoBvX,EAAWwP,QACpC9P,KAAKkf,MAAMD,kBAKfkiI,cAActhJ,GACZG,KAAKw+I,eAAehB,kBAAkB39I,EAAQm9I,KAIhDoE,oBAAoBvhJ,GAClBG,KAAKw+I,eAAehB,kBAAkB39I,EAAQm9I,KAIhDqE,SAASxhJ,GACP,MAAMC,EAAYE,KAAK+P,gBAAgB/B,UACvChO,KAAKshJ,qBACFrvH,KACCnyB,EAAUkQ,QAAQ,oDAEnB5H,UAAWhI,IACNA,GACFJ,KAAKw+I,eACF70I,OAAO9J,EAAQ+E,GAAI/E,EAAQm+I,UAC3B51I,UAAU,KACT,MAAM/H,EAAUP,EAAUkQ,QACxB,8CACA,CACElO,MAAOjC,EAAQoP,QAGb3O,EAAQR,EAAUkQ,QACtB,iDAEFhQ,KAAK+Q,eAAerB,KAAKrP,EAASC,OAO9CihJ,QAAQ1hJ,GAKNG,KAAKw+I,eAAe90I,MAAM7J,EAAQ+E,GAJf,CACjBqK,MAAOpP,EAAQoP,MAAQ,QACvB+tI,IAAKn9I,EAAQm9I,IAAM,UAE6B50I,UAAU,KAC1D,MAAMhI,EAAYJ,KAAK+P,gBAAgB/B,UACjC3N,EAAUD,EAAU4P,QACxB,6CACA,CACElO,MAAOjC,EAAQoP,QAGb3O,EAAQF,EAAU4P,QACtB,gDAEFhQ,KAAK+Q,eAAevB,QAAQnP,EAASC,KAKzCkhJ,SAAS3hJ,GACP,MAAQoP,QAAOsxI,SAAU1gJ,EACnBQ,EAAUL,KAAKw+I,eAAeb,kBAClC39I,KAAKs2B,UAAU5wB,IACftF,GAEFC,EAAQ4O,MAAQnP,EAChBE,KAAKw+I,eAAe92I,OAAOrH,GAAS+H,UAAU,KAC5C,MAAM9H,EAAYN,KAAK+P,gBAAgB/B,UACjCxN,EAASF,EAAU0P,QACvB,iDAEItM,EAAUpD,EAAU0P,QACxB,8CACA,CACElO,MAAOzB,EAAQ4O,QAGnBjP,KAAK+Q,eAAevB,QAAQ9L,EAASlD,GACrCR,KAAKw+I,eAAerB,YAAY98I,EAAQ28I,OAK5C3B,eACE,MAAMx7I,EAAc,CAAC,QACrB,UAAWC,KAAKE,KAAKs2B,UAAUmqH,cACX,IAAd3gJ,EAAEwnB,UAAwC,IAApBxnB,EAAE6gJ,gBAC1B9gJ,EAAYe,KAAKd,EAAEoR,MAInBlR,KAAKw+I,eAAenD,aAAax7I,IADrCG,KAAKs2B,UAAUwqH,YAMjBW,qBACEzhJ,KAAKs2B,UAAUwqH,YAAc9gJ,KAAKs2B,UAAUwqH,WAC5C9gJ,KAAKswE,eAAe76D,IAAI,sBAAuBzV,KAAKs2B,UAAUwqH,YAC9D9gJ,KAAKq7I,eAIPqG,cAAc7hJ,GACZG,KAAKw+I,eAAexC,YAAYn8I,EAAQ+E,IAAIwD,YAI9Cu5I,cAAc9hJ,GACZG,KAAKw+I,eAAezC,YAAYl8I,EAAQ+E,IAAIwD,YAiB9CoY,WAEExgB,KAAKs2B,UAAUupH,SAAW,CAAEhF,KAAM,IAClC76I,KAAKs2B,UAAUwqH,WAAa9gJ,KAAKswE,eAAe7mE,IAC9C,uBAGFzJ,KAAK4hJ,WAAa5hJ,KAAKw+I,eAAerD,UAAU/yI,UAAWtI,GACzDE,KAAKo7I,qBAAqBt7I,IAG5BE,KAAK6hJ,mBAAqB7hJ,KAAKw+I,eAAe9C,kBAAkBtzI,UAC7DtI,IACCE,KAAKs2B,UAAUwlH,iBAAmBh8I,IAGtC,MAAMD,EAAmBG,KAAKswE,eAAe7mE,IAAI,wBAC7C5J,IAAqBG,KAAK+qC,KAAKwF,eACjCvwC,KAAKw+I,eAAe9C,kBAAkBvzI,KAAKtI,GAI7CG,KAAK8hJ,kBAAoB9hJ,KAAKw+I,eAAepB,SAC1C70I,MAAK,OAAa,MAClBH,UAAWtI,GAAaE,KAAKs2B,UAAUyrH,gBAAkBjiJ,GAE5DE,KAAK+qC,KAAKuF,cAAcloC,UAAWtI,IAC7BA,GACFE,KAAKw+I,eAAe5C,kBAAkBxzI,UAAWhI,IAC/CJ,KAAKs2B,UAAU0rH,MAAQ5hJ,EACvBJ,KAAKs2B,UAAUmqH,YAAc,GAC7B,MAAMpgJ,EAAaL,KAAKs2B,UAAU0rH,MAAMh7I,OAAO,CAACxG,EAAKkD,KACnDlD,EAAMA,EAAIwF,OAAOtC,GACXA,EAAIk9I,OAASpgJ,EAAIwF,OAAOtC,EAAIk9I,QAAUpgJ,GAE3C,IAEH,UAAWA,KAAQH,EAAY,CAC7B,MAAMqD,EAAoC,CACxCwN,KAAM1Q,EAAK0Q,KACXoW,QAAStnB,KAAKswE,eAAe7mE,IAC3B,wBAA0BjJ,EAAK0Q,OAGR,OAAvBxN,EAAW4jB,UACb5jB,EAAW4jB,SAAU,GAEvBtnB,KAAKs2B,UAAUmqH,YAAY7/I,KAAK8C,GAGlC,MAAMpD,EAAc,CAAC,QACrB,UAAWE,KAAKR,KAAKs2B,UAAUmqH,cACX,IAAdjgJ,EAAE8mB,UAAwC,IAApB9mB,EAAEmgJ,gBAC1BrgJ,EAAYM,KAAKJ,EAAE0Q,MAKnBlR,KAAKw+I,eAAenD,aAAa/6I,IADrCN,KAAKs2B,UAAUwqH,gBAQvB3oI,cACEnY,KAAK4hJ,WAAWl5I,cAChB1I,KAAK8hJ,kBAAkBp5I,cACvB1I,KAAK6hJ,mBAAmBn5I,cAGlB0yI,qBAAqBv7I,GAC3BG,KAAKs2B,UAAUupH,SAAWhgJ,gDA1RjBkB,GAA2BrB,yHAA3BqB,EAA2BugB,8GAA3BxhB,eAA2BwhB,CAAX,0BAAhBxhB,aAA2BwhB,CAAb,0BAAdxhB,aAA2BwhB,CAAb,8BAAdxhB,iBAA2BwhB,CAAT,iCAAlBxhB,oBAA2BwhB,CAAN,uCAArBxhB,0BAA2BwhB,6BAA3BxhB,eAA2BwhB,CAAX,2BAAhBxhB,cAA2BwhB,CAAZ,4BAAfxhB,eAA2BwhB,CAAX,6CAAhBxhB,kBAA2BwhB,CAAb,uCAAdxhB,wBAA2BwhB,CAAP,0BAApBxhB,oBAA2BwhB,CAAN,0BAArBxhB,8BCpBAmiJ,iBAGXl6I,YAAoBlI,EAA0BC,GAA1BE,YAA0BA,cAC5CA,KAAKs6F,QAAUt6F,KAAK2K,OAAOD,UAAU,eAGvCjB,MACE,OAAKzJ,KAAKs6F,QAKHt6F,KAAKkM,KAAKzC,IADLzJ,KAAKs6F,QAAU,SAHlB/R,KAOX5+E,OAAO9J,GAEL,OAAOG,KAAKkM,KAAKvC,OADL3J,KAAKs6F,QAAU,SAAWz6F,GAIxC6H,OAAO7H,GAEL,OAAOG,KAAKkM,KAAKklC,KADLpxC,KAAKs6F,QAAU,QACKz6F,iDAvBvBkB,GAAUrB,iDAAVqB,EAAUsI,QAAVtI,EAAU,YAAVA,MC6CAmhJ,iBAAyBn4I,iBAElC,MAAO,CACLC,SAAUjJ,iDAHHA,6DAFA,CAACkhJ,IAAW1yH,SAzBd,CACPviB,KACAL,GACA4lB,GACAsH,GACAgiB,GACAx1B,MACA5mB,KACAuvB,KACAoK,MACAwxF,MACA37F,KACApD,MACA2G,MACA+B,SAaSxzB,MC2CAohJ,iBAAuBp4I,iBAEhC,MAAO,CACLC,SAAUjJ,iDAHHA,4DAnDF,CACPiM,KACAqZ,MACAA,MACAwF,MACA0I,KACA90B,KACAuvB,KACAC,KACAE,KACAE,KACAy7F,MACAt4F,MACAtD,KACA07F,MACA3wF,MACA4hB,GACA5X,GACArD,GACA9O,GACA+H,GACAltB,GACA0xI,GACA6D,GACAnzH,OA2BShuB,UC3FDqhJ,SAAZ,OAAYrhJ,UAAgB,KAC1B07C,cACA17C,oBAFUqhJ,GAAZ,IAAYrhJ,MAKAshJ,SAAZ,OAAYthJ,UAAgB,KAC1BgtH,gBACAhtH,kBAFUshJ,GAAZ,IAAYthJ,UAWCuhJ,iBAHbv6I,cAKW/H,uBAAuD,IAAI+I,IAAgBq5I,GAAiB3lG,OAC5Fz8C,mBAAmD,IAAI+I,IAAgBs5I,GAAiBt0B,QACxF/tH,oBAAiD,IAAI+I,SAAgB,GAE9Ew5I,oBAAoB1iJ,GAClBG,KAAKwiJ,kBAAkBr6I,KAAKtI,GAG9B4iJ,QAAQ5iJ,GACNG,KAAK0iJ,cAAcv6I,KAAKtI,GAG1B8iJ,kBAAkB9iJ,GACdG,KAAKgwH,eAAe7nH,KAAKtI,iDAflBkB,gCAAiBsI,QAAjBtI,EAAiB,qBAFhB,SAEDA,MCPA6hJ,iBAOX76I,YACUlI,EACAC,GADAE,mBACAA,yBAJHA,kBAAyC,IAAI+I,SAAgB,iBAHlE,OAAO/I,KAAKkgC,YAAYL,QAUxBgjH,0BAA0BhjJ,GAC1B,GAAKA,EACL,IAA4B,iBAAxBA,EAAeijJ,KAAyB,CAC1C,IAAIhjJ,EAA+BE,KAAK+iJ,kBAAkB/yB,eAAeluH,MACpEhC,GAMHA,EAAcuqD,OAASxqD,EAAe+O,QAAQy7C,OAC9CvqD,EAAckzH,mBAAqBnzH,EAAe+O,QAAQokH,oBAN1DlzH,EAAgB,CACduqD,OAAQxqD,EAAe+O,QAAQy7C,OAC/B2oE,mBAAoBnzH,EAAe+O,QAAQokH,oBAM/ChzH,KAAK+iJ,kBAAkBJ,kBAAkB7iJ,GACzCE,KAAK+iJ,kBAAkBN,QAAQJ,GAAiB32B,QAG9C1rH,KAAK6/B,QAAQd,QAAQl/B,EAAeijJ,QACtC9iJ,KAAK6/B,QAAQT,aAAav/B,EAAeijJ,MACzC9iJ,KAAKgjJ,aAAa76I,MAAK,mDA/BhBpH,GAASrB,gDAATqB,EAASsI,QAATtI,EAAS,qBAFR,SAEDA,kBCLkBA,EAA+DO,GACrEP,EAAUgpC,YAC1B7rB,kBAAkB2rD,IACVjD,UAAUtlE,EAAemI,IAAI,YAAyBozC,WAAwBA,aCFlFx6B,iBAKXta,YAAoBlI,iDAHlB,OAAOG,KAAKijJ,gEAFHliJ,GAAYrB,sCAAZqB,EAAYsI,QAAZtI,EAAY,qBAFX,SAEDA,MCcAmiJ,iBAiBXn7I,YACUlI,EACDC,EACCM,EACAC,GAHAL,oBACDA,uBACCA,iBACAA,oBAnBHA,eAAsC,IAAI+I,IAC/C/I,KAAKswE,eAAe7mE,IAAI,sBAG1BzJ,eAAsC,IAAI+I,KAAgB,wBAIxD,OAAO/I,KAAKmjJ,aAAa7yE,8BAIzB,OAAOtwE,KAAKswE,eAAe7mE,IAAI,YAUjC0O,cACMnY,KAAKojJ,iBACPpjJ,KAAKojJ,gBAAgB16I,cAIzB26I,YACExjJ,EACAC,EACAM,GAEA,MAAMC,EAAUL,KAAKsjJ,aACnBzjJ,EACAC,EACAM,GAEFP,EAAUwnC,YAAYz8B,KAAKvK,GAG7BijJ,aACEzjJ,EACAC,EACAM,GAEA,YAAKmjJ,UAAUp7I,KAAKnI,KAAK2xI,UACzB3xI,KAAKojJ,gBAAkBpjJ,KAAKswE,eAAe36D,eACxCpN,MACC,QACGlI,GACuB,aAAtBA,EAAc4F,KAAsB5F,EAAcwV,QAAUV,aAGjE/M,UAAU,KACTpI,KAAKujJ,UAAUp7I,KAAKnI,KAAK2xI,UACzB6R,GAAe3jJ,EAAWG,KAAKswE,kBAE5B,CACL,CACE1rE,GAAI,WACJ8qF,UAAU,EACVzgF,MAAO,2CACP8d,QAAS,6CACTH,eAAgB5sB,KAAKujJ,UACrBx1H,QAAS,KACPy1H,GAAe3jJ,EAAWG,KAAKswE,gBAC/BtwE,KAAKswE,eAAe76D,IAClB,YACCzV,KAAKswE,eAAe7mE,IAAI,eAI/B,CACE7E,GAAI,oBACJ8qF,UAAU,EACVzgF,MAAO,8CACP8d,QAAS02H,GAA+B5jJ,GACxC+sB,eAAgB9sB,EAChBiuB,QAAS,IAAMjuB,EAA+BqI,MAAMrI,EAA+BgC,QAErF,CACE8C,GAAI,eACJ8qF,UAAU,EACVzgF,MAAO,2CACP8d,QAAS,6CACTH,eAAgBxsB,EAChB2tB,QAAS,IAAM3tB,EAA0B+H,MAAM/H,EAA0B0B,QAE3E,CACE8C,GAAI,iBACJqU,KAAM,aACNhK,MAAO,iDACP8d,QAAS,mDACTgB,QAAU1tB,IACRA,EAAG0pC,YAAYjyB,MAAM6B,WAAWtZ,EAAG0pC,YAAY9sB,KAAKxC,MAAO,CACzD4F,UAAU,KAGdgM,KAAM,CAACxsB,GACPqtB,aAAe7sB,GAAyBqjJ,GAAkBrjJ,IAE5D,CACEuE,GAAI,kBACJqU,KAAM,cACNhK,MAAO,2CACP8d,QAAS,6CACTgB,QAAU1tB,IACR,MAAMC,EAAiBD,EAAG0pC,YAAY7rB,kBACpC6wH,IAKIrrI,EAH0BrD,EAAG0pC,YAAY7rB,kBAC7CslG,IAEkDhkG,OAChD,CAACnf,EAAGo8C,MAAM73C,IACV,GACJ5E,KAAK2jJ,UAAUd,0BAA0B,CACvCC,KAAM,eACNl0I,QAAS,CACPy7C,OAAQ,CAAChqD,EAAGo8C,MAAM73C,IAClBouH,mBAAoB1yH,EAAekf,OACnC0yG,0BAIN7lG,KAAM,CAACxsB,IAET,CACE+E,GAAI,WACJqK,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,sCAC9C+c,QAAS/sB,KAAK+P,gBAAgB/B,UAAUgC,QACtC,6CAEFiJ,KAAM,SACNoU,QAAS,IACArtB,KAAK4jJ,UAAUr7I,QAAKsmD,KAAKxuD,IAAOA,IAAML,KAAKikB,aAAalP,aAEjEgZ,QAAS,KACF/tB,KAAKikB,aAAalP,YACrB/U,KAAK4jJ,UAAUz7I,MAAK,KAI1B,CACEvD,GAAI,iBACJqK,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QACpC,4CAEF+c,QAAS/sB,KAAK+P,gBAAgB/B,UAAUgC,QACtC,mDAEFiJ,KAAM,SACNoU,QAAS,IACArtB,KAAK4jJ,UAAUr7I,QAAKsmD,KAAKxuD,GAAMA,IAAML,KAAKikB,aAAalP,aAEhEgZ,QAAS,KACP/tB,KAAK4jJ,UAAUz7I,MAAK,oDA/JjBpH,GAAqBrB,oEAArBqB,EAAqBsI,QAArBtI,EAAqB,qBAFpB,SAEDA,MCGA8iJ,iBAmBX97I,YACmClI,EACzBC,EACDM,EACCC,EACAC,GAJyBN,uBACzBA,oBACDA,uBACCA,oBACAA,iBAtBHA,eAAsC,IAAI+I,IAC/C/I,KAAKswE,eAAe7mE,IAAI,sBAG1BzJ,+BAAsD,IAAI+I,KAAgB,GAE1E/I,eAAsC,IAAI+I,KAAgB,wBAIxD,OAAO/I,KAAKmjJ,aAAa7yE,8BAIzB,OAAOtwE,KAAKswE,eAAe7mE,IAAI,YAUjC0O,cACMnY,KAAKojJ,iBACPpjJ,KAAKojJ,gBAAgB16I,cAIzB26I,YACExjJ,EACAC,EACAM,GAEA,MAAMC,EAAUL,KAAKsjJ,aACnBzjJ,EACAC,EACAM,GAEFP,EAAUwnC,YAAYz8B,KAAKvK,GAG7BijJ,aACEzjJ,EACAC,EACAM,WAEAJ,KAAKujJ,UAAUp7I,KAAKnI,KAAK2xI,UACzB3xI,KAAKojJ,gBAAkBpjJ,KAAKswE,eAAe36D,eACxCpN,MAAK,QAAW7E,GACQ,cAAV,MAAbA,OAAa,EAAbA,EAAeuC,OAAmC,MAAbvC,OAAa,EAAbA,EAAemS,SAAUV,aAC/D/M,UAAU,KACTpI,KAAKujJ,UAAUp7I,KAAKnI,KAAK2xI,UACzB6R,GAAe3jJ,EAAWG,KAAKswE,kBAEnC,MAAM9vE,EAAU,CACd,CACEoE,GAAI,WACJ8qF,UAAU,EACVzgF,MAAO,2CACP8d,QAAS,6CACTH,eAAgB5sB,KAAKujJ,UACrBx1H,QAAS,KACPy1H,GAAe3jJ,EAAWG,KAAKswE,gBAC/BtwE,KAAKswE,eAAe76D,IAAI,YAAazV,KAAKswE,eAAe7mE,IAAI,eAGjE,CACE7E,GAAI,oBACJ8qF,UAAU,EACVzgF,MAAO,8CACP8d,QAAS02H,GAA+B5jJ,GACxC+sB,eAAgB9sB,EAChBiuB,QAAS,IAAMjuB,EAA+BqI,MAAMrI,EAA+BgC,QAErF,CACE8C,GAAI,eACJ8qF,UAAU,EACVzgF,MAAO,2CACP8d,QAAS,2CACTH,eAAgBxsB,EAChB2tB,QAAS,IAAM3tB,EAA0B+H,MAAM/H,EAA0B0B,QAE3E,CACE8C,GAAI,iBACJqU,KAAM,aACNhK,MAAO,iDACP8d,QAAS,mDACTgB,QAAUrqB,IACRA,EAAGqmC,YAAYjyB,MAAM6B,WAAWjW,EAAGqmC,YAAY9sB,KAAKxC,MAAO,CAAE4F,UAAU,KAEzEgM,KAAM,CAACxsB,GACPqtB,aAAexpB,GAAqBggJ,GAAkBhgJ,IAExD,CACEkB,GAAI,cACJqU,KAAM,cACNhK,MAAO,2CACP8d,QAAS,6CACTgB,QAAUrqB,IACR,MAAME,EAAiBF,EAAGqmC,YAAY7rB,kBAAkB6wH,IAElDhrI,EAD0BL,EAAGqmC,YAAY7rB,kBAAkBslG,IACbhkG,OAAS,CAAC9b,EAAG+4C,MAAM73C,IAAM,GAC7E5E,KAAK2jJ,UAAUd,0BAA0B,CACvCC,KAAM,eACNl0I,QAAS,CAAEy7C,OAAQ,CAAC3mD,EAAG+4C,MAAM73C,IAAKouH,mBAAoBpvH,EAAe4b,OAAQ0yG,0BAGjF7lG,KAAM,CAACxsB,IAET,CACE+E,GAAI,YACJqU,KAAM,SACNhK,MAAO,4CACP8d,QAAS,8CACTgB,QAAS,CAACrqB,EAAgBE,KACxBA,EAAGomC,eAAetmC,EAAQ,CACxBgC,IAAK9B,EAAG8B,IACR+2C,MAAO74C,EAAG64C,SAGdpwB,KAAM,CAACrsB,KAAK8jJ,gBAAiBjkJ,IAE/B,CACE+E,GAAI,WACJqK,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,sCAC9C+c,QAAS/sB,KAAK+P,gBAAgB/B,UAAUgC,QACtC,6CAEFiJ,KAAM,SACNoU,QAAS,IACArtB,KAAK4jJ,UAAUr7I,QAAKsmD,KAAKnrD,IAAOA,IAAM1D,KAAKikB,aAAalP,aAEjEgZ,QAAS,KACF/tB,KAAKikB,aAAalP,YACrB/U,KAAK4jJ,UAAUz7I,MAAK,KAI1B,CACEvD,GAAI,iBACJqK,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QACpC,4CAEF+c,QAAS/sB,KAAK+P,gBAAgB/B,UAAUgC,QACtC,mDAEFiJ,KAAM,SACNoU,QAAS,IACArtB,KAAK4jJ,UAAUr7I,QAAKsmD,KAAKnrD,GAAMA,IAAM1D,KAAKikB,aAAalP,aAEhEgZ,QAAS,KACP/tB,KAAK4jJ,UAAUz7I,MAAK,MAI1B,OAAiF,QAA1E7H,EAAmE,QAAnED,EAACR,EAAU48C,MAAM/1B,WAAuC4iC,mBAAW,eAAExnD,aAAK,eAAEs8B,SACnF59B,EAAUA,EAAQiG,OAAO/C,GAAwB,cAAdA,EAAOkB,kDAhKjC7D,GAAiBrB,MAoBlB8wI,IAAe9wI,oEApBdqB,EAAiBsI,QAAjBtI,EAAiB,qBAFhB,SAEDA,MCAAgjJ,iBAiBXh8I,YACmClI,EACzBC,EACDM,EACCC,EACAC,GAJyBN,uBACzBA,oBACDA,uBACCA,oBACAA,iBApBHA,eAAsC,IAAI+I,IAC/C/I,KAAKswE,eAAe7mE,IAAI,sBAG1BzJ,eAAsC,IAAI+I,KAAgB,wBAIxD,OAAO/I,KAAKmjJ,aAAa7yE,8BAIzB,OAAOtwE,KAAKswE,eAAe7mE,IAAI,YAUjC0O,cACMnY,KAAKojJ,iBACPpjJ,KAAKojJ,gBAAgB16I,cAIzB26I,YACExjJ,EACAC,EACAM,GAEA,MAAMC,EAAUL,KAAKsjJ,aACnBzjJ,EACAC,EACAM,GAEFP,EAAUwnC,YAAYz8B,KAAKvK,GAG7BijJ,aACEzjJ,EACAC,EACAM,WAEAJ,KAAKujJ,UAAUp7I,KAAKnI,KAAK2xI,UACzB3xI,KAAKojJ,gBAAkBpjJ,KAAKswE,eAAe36D,eACxCpN,MAAK,QAAW7E,GACQ,cAAV,MAAbA,OAAa,EAAbA,EAAeuC,OAAmC,MAAbvC,OAAa,EAAbA,EAAemS,SAAUV,aAC/D/M,UAAU,KACTpI,KAAKujJ,UAAUp7I,KAAKnI,KAAK2xI,UACzB6R,GAAe3jJ,EAAWG,KAAKswE,kBAEnC,MAAM9vE,EAAU,CACd,CACEoE,GAAI,WACJ8qF,UAAU,EACVzgF,MAAO,2CACP8d,QAAS,6CACTH,eAAgB5sB,KAAKujJ,UACrBx1H,QAAS,KACPy1H,GAAe3jJ,EAAWG,KAAKswE,gBAC/BtwE,KAAKswE,eAAe76D,IAAI,YAAazV,KAAKswE,eAAe7mE,IAAI,eAGjE,CACE7E,GAAI,oBACJ8qF,UAAU,EACVzgF,MAAO,8CACP8d,QAAS02H,GAA+B5jJ,GACxC+sB,eAAgB9sB,EAChBiuB,QAAS,IAAMjuB,EAA+BqI,MAAMrI,EAA+BgC,QAErF,CACE8C,GAAI,eACJ8qF,UAAU,EACVzgF,MAAO,2CACP8d,QAAS,2CACTH,eAAgBxsB,EAChB2tB,QAAS,IAAM3tB,EAA0B+H,MAAM/H,EAA0B0B,QAE3E,CACE8C,GAAI,iBACJqU,KAAM,aACNhK,MAAO,iDACP8d,QAAS,mDACTgB,QAAUrqB,IACRA,EAAGqmC,YAAYjyB,MAAM6B,WAAWjW,EAAGqmC,YAAY9sB,KAAKxC,MAAO,CAAE4F,UAAU,KAEzEgM,KAAM,CAACxsB,GACPqtB,aAAexpB,GAAyBggJ,GAAkBhgJ,IAE5D,CACEkB,GAAI,cACJqU,KAAM,cACNhK,MAAO,2CACP8d,QAAS,6CACTgB,QAAUrqB,IACR,MAAME,EAAiBF,EAAGqmC,YAAY7rB,kBAAkB6wH,IAElDhrI,EAD0BL,EAAGqmC,YAAY7rB,kBAAkBslG,IACbhkG,OAAS,CAAC9b,EAAG+4C,MAAM73C,IAAM,GAC7E5E,KAAK2jJ,UAAUd,0BAA0B,CACvCC,KAAM,eACNl0I,QAAS,CAAEy7C,OAAQ,CAAC3mD,EAAG+4C,MAAM73C,IAAKouH,mBAAoBpvH,EAAe4b,OAAQ0yG,0BAGjF7lG,KAAM,CAACxsB,IAET,CACE+E,GAAI,YACJqU,KAAM,SACNhK,MAAO,4CACP8d,QAAS,8CACTgB,QAAS,CAACrqB,EAAgBE,KACxBA,EAAGomC,eAAetmC,EAAQ,CACxBgC,IAAK9B,EAAG8B,IACR+2C,MAAO74C,EAAG64C,SAGdpwB,KAAM,CAACrsB,KAAK8jJ,gBAAiBjkJ,IAE/B,CACE+E,GAAI,WACJqK,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QAAQ,sCAC9C+c,QAAS/sB,KAAK+P,gBAAgB/B,UAAUgC,QACtC,6CAEFiJ,KAAM,SACNoU,QAAS,IACArtB,KAAK4jJ,UAAUr7I,QAAKsmD,KAAKnrD,IAAOA,IAAM1D,KAAKikB,aAAalP,aAEjEgZ,QAAS,KACF/tB,KAAKikB,aAAalP,YACrB/U,KAAK4jJ,UAAUz7I,MAAK,KAI1B,CACEvD,GAAI,iBACJqK,MAAOjP,KAAK+P,gBAAgB/B,UAAUgC,QACpC,4CAEF+c,QAAS/sB,KAAK+P,gBAAgB/B,UAAUgC,QACtC,mDAEFiJ,KAAM,SACNoU,QAAS,IACArtB,KAAK4jJ,UAAUr7I,QAAKsmD,KAAKnrD,GAAMA,IAAM1D,KAAKikB,aAAalP,aAEhEgZ,QAAS,KACP/tB,KAAK4jJ,UAAUz7I,MAAK,MAI1B,OAAiF,QAA1E7H,EAAmE,QAAnED,EAACR,EAAU48C,MAAM/1B,WAAuC4iC,mBAAW,eAAExnD,aAAK,eAAEs8B,SACnF59B,EAAUA,EAAQiG,OAAO/C,GAAwB,cAAdA,EAAOkB,kDA9JjC7D,GAAqBrB,MAkBtB8wI,IAAe9wI,oEAlBdqB,EAAqBsI,QAArBtI,EAAqB,qBAFpB,SAEDA,MCHAijJ,iBAoDXj8I,YACUlI,EACAC,EACAM,EACAC,GAHAL,6BACAA,yBACAA,6BACAA,sBAtDHA,6BAAkC,EAEhCA,uBAA8C,IAAI+I,KAAyB,GAC3E/I,oCAA2D,IAAI+I,KAAyB,GACxF/I,+BAAsD,IAAI+I,KAAyB,GAEnF/I,wBAA+C,IAAI+I,IAC1D/I,KAAKswE,eAAe7mE,IAAI,sBAElBzJ,sBAAmC,GAYlCA,4BAAkD,IAAI+I,SAAwB,GAKhF/I,gBAAa,IAAI+I,SAA2B,GA8BjD/I,KAAKikJ,6BAzBuB,OAAOjkJ,KAAKygH,sCAIxC,OAAIzgH,KAAKkkJ,WAAWpiJ,MACQ,QAArBjC,OAAKqkJ,WAAWpiJ,aAAK,eAAEioC,YAAY5sB,UAAUpC,OAAQjb,IAA2B,IAArBA,EAAEgY,MAAMuI,UAEjE,qCAKT,OAAIrgB,KAAKkkJ,WAAWpiJ,MACuB,QAAlChC,EAAqB,QAArBD,OAAKqkJ,WAAWpiJ,aAAK,eAAEioC,mBAAW,eAAE5sB,UAAUnC,QAAS5a,IAA2B,IAArBA,EAAE0X,MAAMuI,aAErErU,MAAG,IAkBNi4I,iBACNjkJ,KAAKygH,OAAS,IAAI0jC,GAAe,IACjCnkJ,KAAKygH,OAAOtjG,UACTrC,SAAUjb,IAA4D,IAAxBA,EAAOiY,MAAM0H,QAC3DpX,UAAWvI,IAEVG,KAAKkkJ,WAAW/7I,KADEtI,EAASA,EAAO2e,YAAS,KAI/Cxe,KAAKygH,OAAOtjG,UAAUxC,OACrBvS,UAAWvI,IACVA,EAAW6F,IAAK5F,IACVA,EAAI0e,OAAO6oB,YAAYk5G,QACrBzgJ,EAAI0e,kBAAkB6yH,GACxBrxI,KAAKokJ,kBAAkBf,YACrBvjJ,EAAI0e,OACJxe,KAAK20I,+BACL30I,KAAKqkJ,2BACEvkJ,EAAI0e,kBAAkBu2H,GAC/B/0I,KAAKskJ,sBAAsBjB,YACzBvjJ,EAAI0e,OACJxe,KAAK20I,+BACL30I,KAAKqkJ,2BACEvkJ,EAAI0e,kBAAkBk1H,IAC/B1zI,KAAKukJ,sBAAsBlB,YACzBvjJ,EAAI0e,OACJxe,KAAK20I,+BACL30I,KAAKqkJ,gCAOfrkJ,KAAKwkJ,iBAAiB5jJ,KAAKZ,KAAKskJ,sBAAsBV,UAAUx7I,UAAUvI,IACxEG,KAAKykJ,wBAAwB5kJ,MAG/BG,KAAKwkJ,iBAAiB5jJ,KAAKZ,KAAKokJ,kBAAkBR,UAAUx7I,UAAUvI,IACpEG,KAAKykJ,wBAAwB5kJ,MAG/BG,KAAKwkJ,iBAAiB5jJ,KAAKZ,KAAKukJ,sBAAsBX,UAAUx7I,UAAUvI,IACxEG,KAAKykJ,wBAAwB5kJ,MAG/BG,KAAK0kJ,kBAAoB1kJ,KAAKkkJ,WAC3B97I,UAAWvI,SAC2B,IAAjCG,KAAK2kJ,0BACP3kJ,KAAK2kJ,wBAAwBj8I,cAC7B1I,KAAK2kJ,6BAA0B,QAGf,IAAd9kJ,IACFG,KAAK2kJ,wBAA0B9kJ,EAAUwpC,QACtCjhC,UAAWtI,GAAmBE,KAAK4kJ,uBAAuBz8I,KAAKrI,OAIxEE,KAAK6kJ,gCAAkC7kJ,KAAK20I,+BAA+BvsI,UAAWvI,IACpFG,KAAKygH,OAAOtjG,UAAU1C,MAAM/U,IAAK5F,IAC/B,IAAKA,EAAI0e,OAAO6oB,YAAYk5G,MAAO,CACjC,MAAMngJ,EAAiBN,EAAI0e,OAAOurB,YAAY7rB,kBAAkB6wH,IAC5D3uI,IACEP,EACFO,EAAe2d,WAEf3d,EAAeie,mBAOzBre,KAAK8kJ,2BAA6B9kJ,KAAKqkJ,0BAA0Bj8I,UAAWvI,IAC1EG,KAAKygH,OAAOtjG,UAAU1C,MAAM/U,IAAK5F,IAC/B,IAAKA,EAAI0e,OAAO6oB,YAAYk5G,MAAO,CACjC,MAAMngJ,EAAiBN,EAAI0e,OAAOurB,YAAY7rB,kBAAkBslG,IAC5DpjH,IACEP,EACFO,EAAe2d,WAEf3d,EAAeie,mBAQnBomI,wBAAwB5kJ,GAC9BG,KAAKswE,eAAe76D,IAAI,oBAAqB5V,GAC7CG,KAAK+kJ,mBAAmB58I,KAAKtI,GAGxBmlJ,uBAAuBnlJ,GAC5B,MAAMC,EAAYE,KAAKoR,MACtBqJ,MACAI,KAAKza,GAAaA,EAAUwE,KAAO/E,GAChCC,GACFE,KAAKoR,MAAM63B,kBAAkBnpC,GAI1BmlJ,0BAA0BplJ,GAC/B,MAAMC,EAAeE,KAAKoR,MACvBqJ,MACAI,KAAKza,GAAaA,EAAU6O,QAAUpP,GACrCC,GACFE,KAAKoR,MAAM63B,kBAAkBnpC,GAQjCqY,cACEnY,KAAKklJ,qBACLllJ,KAAKwkJ,iBAAiB9+I,IAAI7F,GAAKA,EAAE6I,eAC7B1I,KAAK6kJ,iCACP7kJ,KAAK8kJ,2BAA2Bp8I,cAE9B1I,KAAK8kJ,4BACP9kJ,KAAK8kJ,2BAA2Bp8I,cAO5Bw8I,qBACNllJ,KAAKoR,MAAM8E,aAC0B,IAAjClW,KAAK2kJ,yBACP3kJ,KAAK2kJ,wBAAwBj8I,mBAEA,IAA3B1I,KAAK0kJ,mBACP1kJ,KAAK0kJ,kBAAkBh8I,4DA3MhB3H,GAAcrB,oEAAdqB,EAAcsI,QAAdtI,EAAc,qBAFb,SAEDA,MCXAg8C,iBAoCXh1C,YACUlI,EACAC,EACAM,GAFAJ,2BACAA,sBACAA,qBAtCHA,wBAA+C,GAC/CA,iCAAwD,GACxDA,6BAAoD,GAKlDA,yBAA+C,IAAI+I,IAAgB,KAEnE/I,iBAAuC,IAAI+I,SAAgB,GAE3D/I,iBAAuC,IAAI+I,SAAgB,GAE3D/I,qBAA4C,IAAI+I,KAAgB,GAEhE/I,mCAA0D,IAAI+I,KAAgB,GAE9E/I,2BAAkD,IAAI+I,SAAgB,GAEtE/I,qBAAiD,IAAI+I,SAAgB,GAKrE/I,WAAmC,IAAI0+B,GAA0B,IAexE,MAAMr+B,EAAqBL,KAAK6O,cAAcnE,UAAU,sBAKpDrK,IACFL,KAAKmlJ,mBAAqB9kJ,EAAmBy8I,KAC7C98I,KAAKolJ,4BAA8B/kJ,EAAmBshB,UACtD3hB,KAAKqlJ,wBAA0BhlJ,EAAmB8gC,OAGpD,MAAM7gC,EAA+BN,KAAKswE,eAAe7mE,IAAI,gCACzDnJ,GACFN,KAAKslJ,8BAA8Bn9I,KAAK7H,GAE1CN,KAAKoR,MAAMwM,YAAY5d,KAAKulJ,kCAAkC,qBAxB9D,OAAOvlJ,KAAK0hI,oBACTN,oBACA17H,IAAK7F,GAA0BA,EAAOkI,YAAoBjD,MAyBvDygJ,iCAIN,OAAO,IAAIxW,GAAoC,CAAC5uH,iBAHtBrgB,GACY,MAA7BA,EAAO0e,OAAO3F,KAAK0vH,QAS9Bid,mCACE,MAAM3lJ,EAAWG,KAAKoR,MAAM8M,kBAAkB6wH,SAC7B,IAAblvI,GACFA,EAASke,WAQb0nI,qCACE,MAAM5lJ,EAAWG,KAAKoR,MAAM8M,kBAAkB6wH,SAC7B,IAAblvI,GACFA,EAASwe,aAIbqnI,eACE1lJ,KAAK2lJ,gBAAgBx9I,MAAK,GAG5By9I,gBACE5lJ,KAAK2lJ,gBAAgBx9I,MAAK,GAG5B09I,cAAchmJ,GACZG,KAAK8lJ,YAAY39I,KAAKtI,GAGxBwqI,cAAcxqI,GACZG,KAAK0hI,oBAAoBL,oBAAoBxhI,GAC7CG,KAAKsqI,YAAYniI,KAAKtI,GAGxBkmJ,0BACE/lJ,KAAKgmJ,sBAAsB79I,MAAK,GAGlC89I,kBAAkBpmJ,GAChBG,KAAKkmJ,gBAAgB/9I,KAAKtI,GAG5BsmJ,+BAA+BtmJ,GAC7BG,KAAKswE,eAAe76D,IAAI,+BAAgC5V,GACxDG,KAAKslJ,8BAA8Bn9I,KAAKtI,iDAlH/BkB,GAAWrB,yDAAXqB,EAAWsI,QAAXtI,EAAW,qBAFV,SAEDA,MCCAqlJ,2HAJF,CAAClW,OAICnvI,MC0BAslJ,2HAlBF,CACPr5I,KACAvN,KACAsxB,KACA9B,KACAD,KACAriB,GACA+6F,GACAwoC,GACAt5G,GACAwN,GACAojE,GACAlzE,OAMSvzB,MC3BAulJ,2HAPF,GAGRF,GACAC,MAGUtlJ,qDCFTrB,mBACEA,0DACFA,kCAkCMA,oEACEA,mBAAW,sCAQrBA,wBACEA,kCACFA,8BADuBA,sEAMvBA,iDACEA,uBAAe,cAAfA,CAAe,gBAAfA,CAAe,mBC3DnB,MAOa6mJ,GAAyBr8G,cAPf,CACrB,CACEp/B,KAAM,SACNwrB,UC0BJ,MAAM,QAyCJvuB,YACUlI,EACAC,EACAM,EACAC,EACAC,EACAE,EACAkD,GANA1D,uBACAA,yBACAA,kBACAA,oBACAA,mBACAA,qBACAA,oBA/CHA,WAAQ,IAAI+mC,GAAY,IAExB/mC,qCAA0C,EAE1CA,kBAAuB,IAEvBA,SAAM,IAAIsgF,GAAO,CACtBvtD,SAAS,EACTrL,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,MAKVhuB,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,GAWDjuE,qBAAkB,IAAI+I,SAAyB,GAqBpD/I,KAAKy/D,WAAWlP,OAAOvwD,KAAK0F,KAE5B1F,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,MACPsuC,cAAe,CACbz4C,KAAM,SAGTsD,UAAUxE,IACT5D,KAAKwmJ,SAAW5iJ,EAChB5D,KAAK0F,IAAI2/D,SAASzhE,uBA7BtB,OAAO5D,KAAKymJ,YAAYr1I,0BAIxB,OAAOpR,KAAKikB,aAAapP,gBA6B3B6xI,6BAA6B7mJ,GAC3BG,KAAK4vI,+BAAiC/vI,EAGxC8mJ,mBAAmB9mJ,EAAO,IACxBG,KAAK20F,KAAO90F,EAERA,EAD4BsG,QAAQ,aAAc,IAAIsnD,OACnCltD,OAAS,IAC9BP,KAAK4mJ,YAAY1wI,QACjBlW,KAAK6mJ,qBAAkB,GAI3B9W,SAASlwI,GACP,MAAMC,EAAUD,EAAMmmI,QACtBhmI,KAAK4mJ,YAAY9uI,MAAMkC,UAAU,CAAEgoB,SAAS,EAAO3hB,UAAU,IAC7D,MAAMjgB,EAAaJ,KAAK4mJ,YAAYtpI,UAAUxb,MAC3C2E,OAAQpG,GAAyBA,EAAOic,SAAWzc,EAAM4tI,SAASnxH,QAClEtW,OAAOlG,GACVE,KAAK4mJ,YAAYjtI,WAAWvZ,GAG9B2sI,yBACE/sI,KAAKwuI,gBAAgBrmI,MAAK,GAQ5B2+I,cAAcjnJ,GACZG,KAAK+mJ,mBAAmBlnJ,GACxBG,KAAK6mJ,gBAAmBhnJ,EAAiC0pB,KAOnDw9H,mBAAmBlnJ,GACrBA,EAAMgZ,KAAKqvH,WAAatrF,SAKA,IAAxB/8C,EAAM0pB,KAAK07B,UAIfjlD,KAAK0F,IAAIouE,qBAAqB/H,YAC5B,CAAClsE,EAAM0pB,MACPszB,YAIJr8B,WACExgB,KAAKoR,MAAMxG,KAAK,CACd,CACEhG,GAAI,cACJqK,MAAO,cACP8e,QAAS/tB,KAAK6vI,mBAAmBv+E,KAAKtxD,OAExC,CACE4E,GAAI,aACJqK,MAAO,YACP8e,QAAS/tB,KAAKgnJ,iBAAiB11F,KAAKtxD,MACpCqsB,KAAM,CAAC,MAET,CACEznB,GAAI,mBACJqK,MAAO,mBACP8e,QAAS/tB,KAAKinJ,uBAAuB31F,KAAKtxD,SAKhDmY,cACEnY,KAAKoR,MAAM8J,UAMbgsI,uBACElnJ,KAAK0F,IAAIouE,qBAAqB59D,QAGhCixI,kBAAkBtnJ,GAChB,MAAMC,EAAWE,KAAKonJ,YAAYvnJ,GAC5BO,EAAQJ,KAAKy/D,WAAWrC,SAASrgB,GAAGsqG,uBAAuBvnJ,GACjEE,KAAKk3E,cAAgBl3E,KAAKy/D,WAAWrC,SAAS3T,WAC9CzpD,KAAKsnJ,OAASz5F,MAAeztD,EAAOJ,KAAKk3E,cAAe,aAG1DkwE,YAAYvnJ,GACV,MAAMC,EAAmBD,EACzB,SAAiBoH,EACfnH,EAAiBmH,EACjBjH,KAAKunJ,WAAWjlI,cAAcklI,wBAAwBz6E,IACtD7rE,OAAOumJ,QACT3nJ,EAAiBiM,EACfjM,EAAiBiM,EACjB/L,KAAKunJ,WAAWjlI,cAAcklI,wBAAwBr6E,KACtDjsE,OAAOwmJ,QACQ,CAAC5nJ,EAAiBiM,EAAGjM,EAAiBmH,GAIzD0gJ,gBAAgB9nJ,GACdG,KAAKsnJ,OAASznJ,EACdG,KAAK6vI,qBAGPA,qBACE7vI,KAAK4mJ,YAAY1wI,QACjB,MAAMrW,EAAUG,KAAK6lI,cAAc5E,cAAcjhI,KAAKsnJ,QAEtD,UAAWxnJ,KAAKD,EACVA,EAAQU,OAAS,GACnBV,EAAQC,GAAG4+D,QAAQt2D,UAAWhI,IAC5BJ,KAAK+vI,SAAS,CAAEtC,SAAU5tI,EAAQC,GAAIkmI,QAAS5lI,MAMvD4mJ,mBACE9lJ,OAAO+wB,KAAK22G,0BAAmC5oI,KAAKsnJ,OAAO,GAAItnJ,KAAKsnJ,OAAO,KAG7EL,yBACE/lJ,OAAO+wB,KACL22G,2BAAoC5oI,KAAKsnJ,OAAO,GAAItnJ,KAAKsnJ,OAAO,mDAtMzDvmJ,GAAkBrB,gGAAlBqB,EAAkBugB,qEAuBI5hB,q7BFzDnCA,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,kBAAMA,QACtBA,4BACEA,cAAIA,wDAA4CA,QAEhDA,cACAA,qBAAQA,gBAA4FA,iCAAoBA,QAAIA,eAC5HA,wCAA0BA,gBAA2FA,gCAAkBA,QACvIA,eACAA,eACAA,0BAGFA,QAEAA,gCAKEA,wCAAgBI,yBAChBJ,8BACFA,QAEAA,wBACEA,6BACEA,gDAAwBI,mCAAxBJ,CAA6D,sCAIzCI,yBAJpBJ,CAA6D,4BAKnDI,eALVJ,CAA6D,iCAM7CI,0BANhBJ,CAA6D,yCAOrCI,6BAC1BJ,QAEAA,iCAMEA,uCAAeI,oBAAfJ,CAAqC,kCACrBI,oBADhBJ,CAAqC,iCAEtBI,gBACbJ,4CAMJA,QAEFA,QAEAA,+BAIFA,QAEAA,qEAnDWA,yCAKoBA,4BAAW,cAAXA,CAAW,mBAAXA,CAAW,mCAAXA,CAAW,mEAMrBA,4BAMfA,oCAAuB,sBAAvBA,CAAuB,+BAUvBA,sCAAqB,cAArBA,CAAqB,8BAArBA,CAAqB,qCAkBbA,6PEtBDqB,GAAb,MC+BO,IAAM6mJ,GAAb,MAAM,sDAAO7mJ,6DAXA,ChIDJ,CACLmJ,QAASm9E,GACT17E,WAAYk8I,GACZx9I,OAAO,EACPwB,KAAM,CAACpB,EAAesD,GAAiBqH,GAAgBusD,K4C5BlD,CACLz3D,QAASm9E,GACT17E,WAAYm8I,GACZz9I,OAAO,EACPwB,KAAM,CAAC1B,KAAY4D,GAAiBqH,GAAgB3K,I9C0B/C,CACLP,QAASm9E,GACT17E,WAAYo8I,GACZ19I,OAAO,EACPwB,KAAM,CACJ1B,KACA4D,GACAqH,GACA3K,EACAo8H,GACAnnI,QIjBG,CACLwK,QAASm9E,GACT17E,WAAYq8I,GACZ39I,OAAO,EACPwB,KAAM,CAAC1B,KAAY4D,GAAiBqH,GAAgB3K,EAAem/H,K4C7B9D,CACL1/H,QAASm9E,GACT17E,WAAYs8I,GACZ59I,OAAO,EACPwB,KAAM,CAAC1B,KAAYM,EAAe2K,KhDmE7B,CACLlL,QAASm9E,GACT17E,WAAYu8I,GACZ79I,OAAO,EACPwB,KAAM,CAAC1B,KAAY4D,GAAiBqH,GAAgB3K,EAAe/K,QkDtE9D,CACLwK,QAASm9E,GACT17E,WAAYw8I,GACZ99I,OAAO,EACPwB,KAAM,CAAC1B,KAAY4D,GAAiBqH,GAAgB3K,IA2B/C,CACLP,QAASm9E,GACT17E,WAAYy8I,GACZ/9I,OAAO,EACPwB,KAAM,CAAC1B,KAAY4D,GAAiBqH,GAAgB3K,KgFJrD8kB,SA1BQ,CACPviB,KACAu5I,GACAn3H,KACAJ,KACAvvB,KACAwvB,KACAliB,aACAq3B,GACAgxF,GACA8a,aACAoW,GACAv3H,GACAsF,GACAqzE,OAcS3mG,GAAb,GC5DA,MAOasnJ,GAAwBn+G,cAPd,CACrB,CACEp/B,KAAM,QACNwrB,UCEJ,MAAM,QAcJvuB,YACUlI,EACAC,GADAE,uBACAA,oBAfHA,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,MAKVhuB,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,GAONjuE,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,kBACPsuC,cAAe,CACbz4C,KAAM,OACN+L,IAAK,2DACL4rC,MAAO,mBACP+tC,UAAW,YACXl/E,QAAS,QACTgrD,YAAa,YACbM,aAAc,mSAGjBxuD,UAAUhI,GAAKJ,KAAK0F,IAAI2/D,SAASjlE,IAEpCJ,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,eACPsuC,cAAe,CACbz4C,KAAM,MACN+L,IAAK,4DACLm7B,OAAQ,CACNsR,OAAQ,kBACRqM,QAAS,SAEX2M,YAAa,eAGhBluD,UAAUhI,GAAKJ,KAAK0F,IAAI2/D,SAASjlE,IAEpCJ,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,UACPsuC,cAAe,CACbz4C,KAAM,MACN+L,IAAK,4DACLm7B,OAAQ,CACNsR,OAAQ,2CACRqM,QAAS,SAEX2M,YAAa,eAGhBluD,UAAUhI,GAAKJ,KAAK0F,IAAI2/D,SAASjlE,kDA7D3BW,GAAiBrB,8CAAjBqB,EAAiBugB,kRCV9B5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,iBAAKA,QACrBA,4BACEA,cAAIA,yCAA6BA,QAEjCA,cACAA,qBAAQA,gBAA2FA,iCAAoBA,QACvHA,eACFA,QAEAA,8BACEA,8BACAA,mCACAA,qCACAA,kCACFA,QAEAA,wBAEFA,eATmBA,6BAAW,eACTA,4BACKA,4BACEA,4BACHA,4BAAW,uBAGvBA,4JDRAqB,GAAb,MEYO,IAAMunJ,GAAb,MAAM,sDAAOvnJ,4DAVF,CACPsnJ,GACAj5H,KACAJ,KACAjiB,GACAqoH,GACAoI,OAISz8H,GAAb,GCjBA,MAOawnJ,GAA+Br+G,cAPrB,CACrB,CACEp/B,KAAM,gBACNwrB,UCGJ,MAAM,QAgBJvuB,YACUlI,EACAC,GADAE,uBACAA,oBAjBHA,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,MAKVhuB,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,GAGDjuE,WAAQ,IAAImkJ,GAAe,IAMhCnkJ,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,MACPsuC,cAAe,CACbz4C,KAAM,SAGTsD,UAAUhI,GAAKJ,KAAK0F,IAAI2/D,SAASjlE,kDA3B3BW,GAAwBrB,8CAAxBqB,EAAwBugB,2PCXrC5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,2BAAeA,QAC/BA,4BACEA,cAAIA,yCAA6BA,QAEjCA,cACAA,qBAAQA,gBAAmGA,iCAAoBA,QAC/HA,eACFA,QAEAA,8BACEA,8BACFA,QAEAA,gCAEFA,eANmBA,6BAAW,eACTA,4BAGAA,gCAAe,oIDJvBqB,GAAb,MEoBO,IAAMynJ,GAAb,MAAM,sDAAOznJ,6DANA,CACTk0H,GAAwB,CACtBnqH,KAAM,gCAETykB,SAbQ,CACPg5H,GACAn5H,KACAJ,KACAjiB,GACAqoH,GACAD,OASSp0H,GAAb,GC1BA,MAOa0nJ,GAA6Bv+G,cAPnB,CACrB,CACEp/B,KAAM,aACNwrB,UCYJ,MAAM,QAqBJvuB,YACUlI,EACAC,EACAM,EACAC,GAHAL,yBACAA,uBACAA,oBACAA,kBAxBHA,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,MAKVhuB,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,EACNsD,WAAW,GAGNvxE,gBAAyB,IAAI0oJ,GAAW,IACxC1oJ,uBAAuC,IAAI2oJ,GAAkB,GAAI,CAAEjjJ,IAAK1F,KAAK0F,MAC7E1F,sBAAqC,IAAI4oJ,GAAiB,GAAI,CAAEljJ,IAAK1F,KAAK0F,MAC1E1F,wBAAyC,IAAI6oJ,GAAmB,GAAI,CAAEnjJ,IAAK1F,KAAK0F,MAChF1F,wBAAoC,IAAIgI,KAQ7ChI,KAAKy/D,WAAWlP,OAAOvwD,KAAK0F,KAC5B1F,KAAK6gF,aACFtB,iBAAiB,CAChBtwE,MAAO,MACPsuC,cAAe,CACbz4C,KAAM,SAGTsD,UAAU9H,GAAKN,KAAK0F,IAAI2/D,SAAS/kE,kDAnC3BS,GAAsBrB,kEAAtBqB,EAAsBugB,qXCpBnC5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,sBAAUA,QAC1BA,4BACEA,cAAIA,yCAA6BA,QAEjCA,cACAA,qBAAQA,gBAAgGA,iCAAoBA,QAC5HA,eACFA,QAEAA,8BACEA,8BACAA,mCACAA,qCACAA,kCACFA,QAEAA,6BAUFA,eAjBmBA,6BAAW,eACTA,4BACKA,4BACEA,4BACHA,4BAAW,uBAIhCA,0CAAyB,wCAAzBA,CAAyB,sCAAzBA,CAAyB,0CAAzBA,CAAyB,yKDChBqB,GAAb,MEOO,IAAM+nJ,GAAb,MAAM,sDAAO/nJ,6DAFA,ClGVJ,CACLmJ,QAAS08H,GACTj7H,WAAYo9I,GACZ1+I,OAAO,EACPwB,KAAM,CAAC1B,KAAYM,KkGMqB8kB,SATjC,CACPk5H,GACAr5H,KACAJ,KACAjiB,GACAqoH,GACAsR,OAKS3lI,GAAb,GCtBA,MAOaioJ,GAA6B9+G,cAPnB,CACrB,CACEp/B,KAAM,cACNwrB,UCSJ,MAAM,QAcJvuB,YACUlI,EACAC,EACAM,GAFAJ,uBACAA,yBACAA,oBAhBHA,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,MAKVhuB,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,GAQNjuE,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,QAEPsD,UAAU9H,IACTN,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,MACPqN,OAAQhc,OA2ChBN,KAAKw/E,kBACFvd,sBApBqD,CACtDn9D,KAAM,MACN+L,IAAK,uDACLm7B,OAAQ,CACNsR,OAAQ,2CACRqM,QAAS,SAEXf,gBAAgB,EAChBC,WAAY,CACV5lC,IAAK,OACLD,IAAK,OACLo+C,OAAO,EACPt8D,KAAMi4D,QACN1sC,MAAO4sC,UACPpY,KAAM,EACN+uD,aAAc,OAMfxrG,UAAU9H,IACTN,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,kBACP2X,SAAS,EACTtK,OAAQhc,qDA7EPS,GAAsBrB,wDAAtBqB,EAAsBugB,qQCjBnC5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,uBAAWA,QAC3BA,4BACEA,cAAIA,4CAAgCA,QACpCA,cAAIA,oEAAwDA,QAC5DA,eAAIA,0CAA6BA,QAEjCA,eACAA,sBAAQA,gBAAiGA,iCAAoBA,QAC7HA,eACFA,QAEAA,8BACEA,8BACFA,QAEAA,wBACEA,mCACFA,QAEFA,eARmBA,6BAAW,eACTA,4BAIKA,uNDDbqB,GAAb,MEOO,IAAMkoJ,GAAb,MAAM,sDAAOloJ,4DAXF,CACPioJ,GACA55H,KACAJ,KACAvvB,KACA2kC,GACAgxF,GACAzK,OAIS5pH,GAAb,GCnBA,MAOamoJ,GAA4Bh/G,cAPlB,CACrB,CACEp/B,KAAM,aACNwrB,UCeJ,MAAM,QAcJvuB,YACUlI,EACAC,EACAM,GAFAJ,uBACAA,yBACAA,oBAhBHA,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,MAKVhuB,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,GAQNjuE,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,QAEPsD,UAAU06C,IACT9iD,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,MACPqN,OAAQwmC,OA2DhB9iD,KAAKw/E,kBACFvd,sBAnD4B,CAC7Bn9D,KAAM,MACN+L,IAAK,4DACLm7B,OAAQ,CACNiT,aAAc,8BACdoI,kBAAmB,WACnBL,YAAa,IACb17C,QAAS,QACTu2C,kBAAc,EACds5C,qBAAsB,OAExBj0C,aAAc,CACZ,CAAEh2C,KAAM,oBAAqB05B,MAAO,4BACpC,CAAE15B,KAAM,mBAAoBqnG,uBAAuB,GACnD,CAAErnG,KAAM,UAAWyK,OAAQ,CAAC,eAAa,cAE3CgqC,WAAY,CACVvnB,SAAS,EACT0iB,UAAU,EACVwD,qBAAsB7E,OACtBv/B,QAAS,CACPkiC,QAAS,KACTliC,QAAS,CACP,CACEiiC,SAAU,oBACVG,aAAc,oBACdmB,WAAY,SAEd,CACEtB,SAAU,aACVpB,aAAc,WACdgC,aAAc,qeAqBrB36C,UAAU06C,IACT9iD,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,+CACPqN,OAAQwmC,EACRzyB,MAAO,IAAI+pC,MAAM,CACftsB,MAAO,IAAI8tB,KAAO,CAChB7N,OAAQ,EACRuM,KAAM,IAAIC,KAAK,CACb9pC,MAAO,UAET+qC,OAAQ,IAAIC,KAAO,CACjBhrC,MAAO,SACPgnC,MAAO,aAoCrBz3D,KAAKw/E,kBACFvd,sBA7BwC,CACzCn9D,KAAM,MACN+L,IAAK,4DACLm7B,OAAQ,CACNiT,aAAc,8BACdoI,kBAAmB,WACnBL,YAAa,IACb17C,QAAS,QACTu2C,kBAAc,EACds5C,qBAAsB,OAExBx1C,WAAY,CACVvnB,SAAS,EACT0iB,UAAU,EACVwD,qBAAsB7E,OACtBv/B,QACE,CACEiiC,SAAU,SACVG,aAAc,mBACda,MAAO,4BACPG,IAAK,8BAGXF,QAAS,4BACTG,QAAS,4BACTid,SAAU,QAKTp4D,UAAU06C,IACT9iD,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,iCACPrK,GAAI,IACJ0X,OAAQwmC,EACRzyB,MAAO,IAAI+pC,MAAM,CACftsB,MAAO,IAAI8tB,KAAO,CAChB7N,OAAQ,EACRuM,KAAM,IAAIC,KAAK,CACb9pC,MAAO,UAET+qC,OAAQ,IAAIC,KAAO,CACjBhrC,MAAO,MACPgnC,MAAO,aAwCrBz3D,KAAKw/E,kBACFvd,sBAhC4C,CAC7Cn9D,KAAM,MACN+L,IAAK,4DACLm7B,OAAQ,CACNiT,aAAc,8BACdoI,kBAAmB,WACnBL,YAAa,IACb17C,QAAS,QACTu2C,kBAAc,EACds5C,qBAAsB,OAExBj0C,aAAc,CACZ,CAAEh2C,KAAM,mBAAoB05B,MAAO,wBAA0B0Z,qBAAsB,SAErFqB,WAAY,CACVvnB,SAAS,EACT0iB,UAAU,EACVwD,qBAAsB7E,OACtBv/B,QACE,CACEiiC,SAAU,SACVG,aAAc,mBACda,MAAO,4BACPG,IAAK,8BAGXF,QAAS,4BACTG,QAAS,4BACTid,SAAU,SAKTp4D,UAAU06C,IACT9iD,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,kCACPrK,GAAI,IACJ0X,OAAQwmC,EACRzyB,MAAO,IAAI+pC,MAAM,CACftsB,MAAO,IAAI8tB,KAAO,CAChB7N,OAAQ,EACRuM,KAAM,IAAIC,KAAK,CACb9pC,MAAO,UAET+qC,OAAQ,IAAIC,KAAO,CACjBhrC,MAAO,OACPgnC,MAAO,aAwCrBz3D,KAAKw/E,kBACFvd,sBAjCiD,CAClDn9D,KAAM,MACN+L,IAAK,4DACLm7B,OAAQ,CACNiT,aAAc,8BACdoI,kBAAmB,WACnBL,YAAa,IACb17C,QAAS,QACTu2C,kBAAc,EACds5C,qBAAsB,OAExBj0C,aAAc,CACZ,CAAEh2C,KAAM,mBAAoB05B,MAAO,wBAA0B0Z,qBAAsB,SAErFqB,WAAY,CACVvnB,SAAS,EACT0iB,UAAU,EACVwD,qBAAsB7E,OACtBv/B,QACE,CACEiiC,SAAU,SACVG,aAAc,mBACda,MAAO,4BACPG,IAAK,4BACL4iE,cAAe,SAGrB9iE,QAAS,4BACTG,QAAS,4BACTid,SAAU,QAKTp4D,UAAU06C,IACT9iD,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,iCACPrK,GAAI,IACJ0X,OAAQwmC,EACRzyB,MAAO,IAAI+pC,MAAM,CACftsB,MAAO,IAAI8tB,KAAO,CAChB7N,OAAQ,EACRuM,KAAM,IAAIC,KAAK,CACb9pC,MAAO,UAET+qC,OAAQ,IAAIC,KAAO,CACjBhrC,MAAO,SACPgnC,MAAO,aA4CrBz3D,KAAKw/E,kBACFvd,sBArCgD,CACjDn9D,KAAM,MACN+L,IAAK,4DACLm7B,OAAQ,CACNiT,aAAc,8BACdoI,kBAAmB,WACnBL,YAAa,IACb17C,QAAS,QACTu2C,kBAAc,EACds5C,qBAAsB,OAExBj0C,aAAc,CACZ,CAAEh2C,KAAM,mBAAoB05B,MAAO,wBAA0B0Z,qBAAsB,SAErFqB,WAAY,CACVvnB,SAAS,EACT0iB,UAAU,EACVwD,qBAAsB7E,OACtBv/B,QACE,CACEiiC,SAAU,SACVG,aAAc,mBACda,MAAO,4BACPG,IAAK,4BACLwB,cAAe,CACb8wD,SAAU,IACVsQ,cAAe,MAEjBA,cAAe,SAGrB9iE,QAAS,4BACTG,QAAS,4BACTid,SAAU,QAKTp4D,UAAU06C,IACT9iD,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,iCACPrK,GAAI,IACJ0X,OAAQwmC,EACRzyB,MAAO,IAAI+pC,MAAM,CACftsB,MAAO,IAAI8tB,KAAO,CAChB7N,OAAQ,EACRuM,KAAM,IAAIC,KAAK,CACb9pC,MAAO,UAET+qC,OAAQ,IAAIC,KAAO,CACjBhrC,MAAO,QACPgnC,MAAO,aAuCrBz3D,KAAKw/E,kBACFvd,sBAhCoD,CACrDn9D,KAAM,MACN+L,IAAK,4DACLm7B,OAAQ,CACNiT,aAAc,8BACdoI,kBAAmB,WACnBL,YAAa,IACb17C,QAAS,QACTu2C,kBAAc,EACds5C,qBAAsB,OAExBj0C,aAAc,CACZ,CAAEh2C,KAAM,mBAAoB05B,MAAO,wBAA0B0Z,qBAAsB,SAErFqB,WAAY,CACVvnB,SAAS,EACT0iB,UAAU,EACVwD,qBAAsB7E,OACtBv/B,QACE,CACEiiC,SAAU,SACVG,aAAc,mBACda,MAAO,iBACPG,IAAK,UAGXF,QAAS,4BACTG,QAAS,4BACTid,SAAU,QAKTp4D,UAAU06C,IACT9iD,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,oDACPrK,GAAI,IACJ0X,OAAQwmC,EACRzyB,MAAO,IAAI+pC,MAAM,CACftsB,MAAO,IAAI8tB,KAAO,CAChB7N,OAAQ,EACRuM,KAAM,IAAIC,KAAK,CACb9pC,MAAO,UAET+qC,OAAQ,IAAIC,KAAO,CACjBhrC,MAAO,QACPgnC,MAAO,aAuCrBz3D,KAAKw/E,kBACFvd,sBAhC4D,CAC7Dn9D,KAAM,MACN+L,IAAK,4DACLm7B,OAAQ,CACNiT,aAAc,8BACdoI,kBAAmB,WACnBL,YAAa,IACb17C,QAAS,QACTu2C,kBAAc,EACds5C,qBAAsB,OAExBj0C,aAAc,CACZ,CAAEh2C,KAAM,mBAAoB05B,MAAO,wBAA0B0Z,qBAAsB,SAErFqB,WAAY,CACVvnB,SAAS,EACT0iB,UAAU,EACVwD,qBAAsB7E,OACtBv/B,QACE,CACEiiC,SAAU,SACVG,aAAc,mBACda,MAAO,sBACPqmE,gBAAgB,IAGtBpmE,QAAS,4BACTG,QAAS,4BACTid,SAAU,QAKTp4D,UAAU06C,IACT9iD,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,iDACPrK,GAAI,IACJ0X,OAAQwmC,EACRzyB,MAAO,IAAI+pC,MAAM,CACftsB,MAAO,IAAI8tB,KAAO,CAChB7N,OAAQ,EACRuM,KAAM,IAAIC,KAAK,CACb9pC,MAAO,UAET+qC,OAAQ,IAAIC,KAAO,CACjBhrC,MAAO,MACPgnC,MAAO,aA+BrBz3D,KAAKw/E,kBACFvd,sBAxBqC,CACpCn9D,KAAM,MACN+L,IAAK,4DACLwyD,yBAAyB,EACzBr3B,OAAQ,CACNsR,OAAQ,8CACRqM,QAAS,SAEXzC,aAAc,CACZ,CAAEh2C,KAAM,mBAAoB05B,MAAO,wBAA0B0Z,qBAAsB,SAErFqB,WAAY,CACVvnB,SAAS,EACT0iB,UAAU,EACV5gC,QACA,CACEiiC,SAAU,SACVG,aAAc,oBAEhBgC,qBAAsB7E,WAMzBr3C,UAAU06C,IACT9iD,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,+CACPqN,OAAQwmC,OAmJhB9iD,KAAKw/E,kBACFvd,sBA3I8C,CAC/Cn9D,KAAM,MACN+L,IAAK,kDACLk2C,OAAQ,kDACR/a,OAAQ,CACNsR,OAAQ,gBACRqM,QAAS,SAEXhE,WAAY,CACVvnB,SAAS,EACT0iB,UAAU,EACVG,YAAa,CACXwE,aAAc,aACd1Z,MAAO,EACP1U,OAAS,CACP,CAACpoB,MAAO,uBAAwBiC,KAAM,WAAYhI,IAAM,CAAC,SAE3Ds8C,QAAS,CACP,CACE5gD,GAAI,MACJqK,MAAO,aACPmzC,QAAS,KACT68D,UAAU,EACV39F,UAAW,CACT,CACErS,MAAO,sBACPmvB,SAAS,EACTrR,QAAS,+BACT7M,QAAS,CACPkiC,QAAS,KACTliC,QAAS,CACP,CACEiiC,SAAU,oBACVG,aAAc,SACdmB,WAAY,eAEd,CACEtB,SAAU,oBACVG,aAAc,SACdmB,WAAY,YAKpB,CACEx0C,MAAO,8BACPmvB,SAAS,EACTrR,QAAS,+BACT7M,QAAS,CACPkiC,QAAS,MACTliC,QAAS,CACP,CACEiiC,SAAU,uBACVG,aAAc,SACdmB,WAAY,eAEd,CACEtB,SAAU,uBACVG,aAAc,SACdmB,WAAY,gBAS5BvC,WAAY,CACVuE,aAAc,WACd1Z,MAAO,EACP1U,OAAS,CACP,CAACpoB,MAAO,2BAA4BiC,KAAM,eAAgBhI,IAAM,CAAC,SAEnEs8C,QAAS,CACP,CACE5gD,GAAI,MACJqK,MAAO,sBACPmzC,QAAS,KACT9gC,UAAW,CACT,CACErS,MAAO,mBACPmvB,SAAS,EACTrR,QAAS,+BACT7M,QAAS,CACPiiC,SAAU,oBACVG,aAAc,eACdmB,WAAY,qBAGhB,CACEx0C,MAAO,qBACPmvB,SAAS,EACTrR,QAAS,+BACT7M,QAAS,CACPiiC,SAAU,oBACVG,aAAc,eACdmB,WAAY,uBAGhB,CACEx0C,MAAO,+BACPmvB,SAAS,EACT3N,MAAO,UACP1D,QAAS,+BACT7M,QAAS,CACPiiC,SAAU,oBACVG,aAAc,eACdmB,WAAY,kDAGhB,CACEx0C,MAAO,kBACPmvB,SAAS,EACT3N,MAAO,UACP1D,QAAS,+BACT7M,QAAS,CACPiiC,SAAU,oBACVG,aAAc,eACdmB,WAAY,8CAOxBa,qBAAsB7E,UAExBgH,UAAW,CACTxH,aAAc,gBACdoI,kBAAmB,WACnBL,YAAa,IACb17C,QAAS,QACTu2C,aAAc,UACds5C,qBAAsB,SAMvB/yF,UAAU06C,IACT9iD,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,+DACPqN,OAAQwmC,qDAjnBP/hD,GAAqBrB,wDAArBqB,EAAqBugB,yQCvBlC5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,sBAAUA,QAC1BA,4BACEA,cAAIA,yCAA6BA,QAEjCA,cACAA,qBAAQA,gBAAgGA,iCAAoBA,QAC5HA,eACFA,QAEAA,8BACEA,8BACFA,QAEAA,wBACEA,sCAGFA,QAEFA,eAVmBA,6BAAW,eACTA,4BAIQA,4BAAW,wMDO3BqB,GAAb,MECO,IAAMooJ,GAAb,MAAM,sDAAOpoJ,4DAXF,CACPmoJ,GACA95H,KACAJ,KACAvvB,KACA2kC,GACAgxF,GACAzK,OAIS5pH,GAAb,6BC4BIrB,SACEA,iCACFA,6BADuBA,6BChD3B,MAOa0pJ,GAAgCl/G,cAPtB,CACrB,CACEp/B,KAAM,iBACNwrB,UCyBJ,MAAM,QAqCJvuB,YACUlI,EACAC,EACAM,EACAC,EACAC,GAJAN,4BACAA,yBACAA,oBACAA,sBACAA,uBAzCHA,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,MAKjBhuB,UAAO,CACLqvE,OAAQ,EAAC,KAAO,MAChBpB,KAAM,IAICjuE,cAAkCw5F,WAGpCx5F,YAAkB,GAOlBA,sBAA6C,IAAI+I,SACtD,GAGM/I,YAAS,IAAI+rD,KAEd/rD,WAAQ,IAAI0+B,GAAqB,IAEjC1+B,sBAAmB,IAAI0+B,GAAqB,IAE5C1+B,cAAU,EASfA,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,QAEPsD,UAAU5H,IACTR,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,MACPqN,OAAQ9b,EACRwuD,WAAW,EACXpoC,SAAS,OAMnByiI,cAAcxpJ,GACZG,KAAK8E,KAAOjF,EACZG,KAAK4hH,eAAY,EACjB5hH,KAAK+tD,YAAS,EAGhBu7F,mBAAmBzpJ,GACjBG,KAAK4hH,UAAY/hH,EACbG,KAAK4hH,WACP5hH,KAAKw6F,iBAIDA,iBACNx6F,KAAK0hH,qBACFlnB,eAAex6F,KAAK4hH,WACpBx5G,UAAWvI,IACVA,EAASob,KAAK,CAACnb,EAAGM,IACZN,EAAEqnB,WAAWu/D,IAAMtmF,EAAE+mB,WAAWu/D,KAC3B,EAEL5mF,EAAEqnB,WAAWu/D,IAAMtmF,EAAE+mB,WAAWu/D,IAC3B,EAEF,GAET1mF,KAAKupJ,iBAAiBrzI,QACtBlW,KAAKupJ,iBAAiB3+I,KAAK/K,KAIjC2pJ,wBACExpJ,KAAKypJ,gBAGPC,uBACE1pJ,KAAKylH,UAAO,EACZzlH,KAAK4hH,eAAY,EAGX6nC,gBACNzpJ,KAAKs4C,SAAU,EACft4C,KAAK2pJ,oBAAoB,CAAC3pJ,KAAKylH,OAC1BzlH,KAAKgjH,YAIRhjH,KAAKgjH,UAAY,CAHoB,CACnC9xG,KAAM,MAINlR,KAAK8E,OAASw0F,aAChBt5F,KAAK+tD,YAAS,GAEhB/tD,KAAKgjH,UAAUl9G,QAAQjG,IACrBG,KAAK0hH,qBACF/mB,eACC36F,KAAKylH,KACLzlH,KAAK4pJ,SACL5pJ,KAAK4hH,UACL/hH,EACAG,KAAK+tD,QAEN3lD,UAAWtI,IACVE,KAAKoR,MAAMsM,WAAW5d,GACtB,MAAMM,EAA2B,GAC3BC,EAA8B,GACpC,IAAIC,EACAE,EACJV,EAASgG,QAAQpC,IACe,UAA1BA,EAAQuhD,SAASngD,MACnB1E,EAAcQ,KAAK8C,GACnBpD,EAAUoD,EAAQmV,KAAKjU,KAEvBvE,EAAiBO,KAAK8C,GACtBlD,EAAakD,EAAQmV,KAAKjU,MAG9B5E,KAAK6pJ,iBAAiBzpJ,EAAeE,GACrCN,KAAK8pJ,iBAAiBzpJ,EAAkBG,GACxCR,KAAKs4C,SAAU,EACXx4C,EAASS,QAAU,KACrBP,KAAK+Q,eAAelB,MAClB7P,KAAK+P,gBAAgB/B,UAAUgC,QAC7B,sCAEFhQ,KAAK+P,gBAAgB/B,UAAUgC,QAC7B,iCAEF,CAAE7C,QAAS,MAGVrN,EAASS,QACZP,KAAK+Q,eAAelB,MAClB7P,KAAK+P,gBAAgB/B,UAAUgC,QAC7B,qCAEFhQ,KAAK+P,gBAAgB/B,UAAUgC,QAC7B,iCAEF,CAAE7C,QAAS,UAOvB20G,aAAajiH,GACXG,KAAKylH,KAAO5lH,EACRA,IACFG,KAAK2pJ,oBAAoB,CAAC9pJ,IAC1BG,KAAK+pJ,oBAAoBlqJ,IAOtB8pJ,oBAAoB9pJ,GACzB,IAAIC,EAAI,EACR,UAAWM,KAAWP,EAAU,CAC9B,GAAIG,KAAK8E,OAASw0F,cAChB,UAAWj5F,KAASL,KAAK0F,IAAI2kD,OAAQ,CACnC,GACEhqD,EAAMuO,QAAQo7I,WACd3pJ,EAAMuO,QAAQo7I,UAAUr/G,OAASvqC,EAAQ+mB,WAAWwjB,KAEpD,OAEEtqC,EAAM4O,MAAMo1D,WAAW,SACzBrkE,KAAK0F,IAAIikE,YAAYtpE,GAI3B,UAAWA,KAASL,KAAK0F,IAAI2kD,OACvBhqD,EAAM4O,MAAMo1D,WAAW,SACzBvkE,IAGJE,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,SACNs6D,WAAW,IAEZh3D,UAAW/H,IACV,MAAMC,EAAUN,KAAK6gF,aAAa5B,YAAY,CAC5ChwE,MAAQ,QAAUnP,EAClBkqJ,UAAW,CACTr/G,KACE3qC,KAAK8E,OAASw0F,cACVl5F,EAAQ+mB,WAAWwjB,UACnB,GAERruB,OAAQjc,EACRumB,SAAS,EACTyJ,MAAO,CAACzsB,EAAUC,KAChB,MAAME,EAAelE,EAAS,GAAW0jF,YACzC,OAAO,IAAInpB,MAAc,CACvBtsB,MAAO,IAAI8tB,KAAe,CACxB7N,OAAQhqD,EACJ/D,KAAK+tD,OACLxmD,KAAK68F,IAAK78F,KAAKo0D,GAAK,IAAO53D,EAAY,IACvCF,OACA,EACJy2D,KAAM,IAAIC,KAAa,CACrB9pC,MAAO,4BAET+qC,OAAQ,IAAIC,KAAe,CACzBhE,MAAO,EACPhnC,MAAO,aAGX+qC,OAAQ,IAAIC,KAAe,CACzBhE,MAAO,EACPhnC,MAAO,WAET6pC,KAAM,IAAIC,KAAa,CACrB9pC,MAAO,iCAKTjwB,EAAaX,EAAS6F,IAAI9B,GACvB4hE,GAAY5hE,EAAG5D,KAAK0F,IAAI+jD,aAEtBppD,EAAW08C,GACnBsX,YAAY7zD,GACfR,KAAK0F,IAAI2/D,SAAS/kE,GAClBN,KAAKqqD,OAAOzpD,KAAKN,MASjBupJ,iBAAiBhqJ,EAAqBC,GAC5C,IAAIM,EAAI,EACR,GAAIP,EAASU,QAAU,EAAG,CACxB,QAAiB,IAAbP,KAAK0F,IACP,OAEF,UAAWrF,KAASL,KAAK0F,IAAI2kD,OACvBhqD,EAAM4O,MAAMo1D,WAAWxkE,EAAS,GAAGgZ,KAAK5J,QAC1C7O,IAGJJ,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,UACNF,KACAw6D,WAAW,EACXkuD,SAAU,IACVz0G,KAAM,CACJ5J,MAAO,aAGV7G,UAAW/H,IACV,MAAMC,EAAUN,KAAK6gF,aAAa5B,YAAY,CAC5ChwE,MAAQpP,EAAS,GAAGgZ,KAAK5J,MAAQ,IAAM7O,EACvCkc,OAAQjc,EACRumB,SAAS,EACTi5D,aAAc,CACZ3U,cAAe,CAAC,CAAEC,UAAW,EAAGC,UAAW,EAAG/6C,MAAO,QAGnD7vB,EAAaX,EAAS6F,IAAI9B,GACvB4hE,GAAY5hE,EAAS5D,KAAK0F,IAAI+jD,aAE5BppD,EAAW08C,GACnBqO,YAAYiJ,YAAY7zD,GACvBR,KAAK0F,IAAI2kD,OAAOxvC,KAAKjX,GAASA,EAAMgB,KAAOtE,EAAQsE,MACrD5E,KAAK0F,IAAIikE,YACP3pE,KAAK0F,IAAI2kD,OAAOxvC,KAAKjX,GAASA,EAAMgB,KAAOtE,EAAQsE,KAErDxE,GAAQ,EACRE,EAAQ2O,MAASpP,EAAS,GAAGgZ,KAAK5J,MAAQ,IAAM7O,EAChDE,EAAQsO,QAAQK,MAAQ3O,EAAQ2O,OAElCjP,KAAK0F,IAAI2/D,SAAS/kE,GAClBN,KAAKqqD,OAAOzpD,KAAKN,MAQjBwpJ,iBAAiBjqJ,EAAqBC,GAC5C,IAAIM,EAAI,EACR,GAAIP,EAASU,OAAS,EAAG,CACvB,QAAiB,IAAbP,KAAK0F,IACP,OAEF,UAAWrF,KAASL,KAAK0F,IAAI2kD,OACvBhqD,EAAM4O,MAAMo1D,WAAWxkE,EAAS,GAAGgZ,KAAK5J,QAC1C7O,IAGJJ,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,SACNF,KACAw6D,WAAW,IAEZh3D,UAAW/H,IACV,MAAMC,EAAUN,KAAK6gF,aAAa5B,YAAY,CAC5ChwE,MAAQpP,EAAS,GAAGgZ,KAAK5J,MAAQ,IAAM7O,EACvCkc,OAAQjc,EACRumB,SAAS,IAELpmB,EAAaX,EAAS6F,IAAI9B,GACvB4hE,GAAY5hE,EAAS5D,KAAK0F,IAAI+jD,aAE5BppD,EAAW08C,GACnBsX,YAAY7zD,GACXR,KAAK0F,IAAI2kD,OAAOxvC,KAAKjX,GAASA,EAAMgB,KAAOtE,EAAQsE,MACrD5E,KAAK0F,IAAIikE,YACP3pE,KAAK0F,IAAI2kD,OAAOxvC,KAAKjX,GAASA,EAAMgB,KAAOtE,EAAQsE,KAErDxE,GAAQ,EACRE,EAAQ2O,MAASpP,EAAS,GAAGgZ,KAAK5J,MAAQ,IAAM7O,EAChDE,EAAQsO,QAAQK,MAAQ3O,EAAQ2O,OAElCjP,KAAK0F,IAAI2/D,SAAS/kE,GAClBN,KAAKqqD,OAAOzpD,KAAKN,MAKzBypJ,oBAAoBlqJ,GAClB,GAAIA,EAAS,CACX,MAAMC,EAAYE,KAAK+nB,OAAO2wC,YAAY74D,EAAS,CACjDgkD,eAAgBhkD,EAAQ4pD,WACxB3F,kBAAmB9jD,KAAK0F,IAAI+jD,aAE9Bsc,GAAiB/lE,KAAK0F,IAAK,CAAC5F,GAAY+8C,UAO5Cs9F,mBAAmBt6I,GACjB,MAAMC,EAAsBD,EAAQ8kF,SACpC,IAAIvkF,EACAN,EAASS,SACXH,EAAUN,EAAS,IAErBE,KAAKiqJ,iBAAiB9hJ,KAAK/H,iDAhXlBW,GAAyBrB,4EAAzBqB,EAAyBugB,stBFjCtC5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,0BAAcA,QAC9BA,4BACEA,cAAIA,4CAAgCA,QACpCA,cAAIA,oEAAwDA,QAC5DA,eAAIA,0CAA6BA,QAEjCA,eACAA,sBAAQA,gBAAoGA,iCAAoBA,QAChIA,eACFA,QAEAA,8BAIEA,iCAASI,0BAETJ,8BACFA,QAEAA,wBACEA,sCAIEA,qCAAaI,oBAAbJ,CAAmC,oCACjBI,yBADlBJ,CAAmC,gCAErBI,oBAChBJ,QAEAA,sCAQEA,oDAA+B,+DAA/BA,CAA+B,6CAA/BA,CAA+B,kDAA/BA,CAA+B,mDAA/BA,CAA+B,iCAKfI,2BALhBJ,CAA+B,kDAA/BA,CAA+B,qCAOXI,2BACtBJ,QACFA,QAEAA,wBACEA,oDAGFA,QAEFA,eA3CIA,6BAAW,cAAXA,CAAW,oBAKMA,4BAKfA,2CAA0B,gCAA1BA,CAA0B,eAS1BA,8BAAa,wBAAbA,CAAa,YAAbA,CAAa,cAAbA,CAAa,oBAAbA,CAAa,gBAAbA,CAAa,mBAmBAA,6XEnBNqB,GAAb,MCDO,IAAMmpJ,GAAb,MAAM,sDAAOnpJ,4DAjBF,CACPqoJ,GACAh6H,KACAJ,KACAvvB,KACA2kC,GACAgxF,GACAroH,GACA0wH,GACA/1B,GACAF,GACAmjB,GACAhxF,GACA3sB,SAISjM,GAAb,4CCdIrB,wCAKEA,kFACFA,+CAJEA,6BAA+B,sCAA/BA,CAA+B,oEAHnCA,SACEA,gEAOFA,6BANKA,iFASHA,gEAEEA,6BAA+B,gBAA/BA,CAA+B,sBAA/BA,CAA+B,eAA/BA,CAA+B,kDAOjCA,mEAGEA,wCAAgC,kCAAhCA,CAAgC,sBAAhCA,CAAgC,yDAKlCA,4BAEEA,8DACFA,mCArBFA,SACEA,kCASAA,sDAQAA,sDAKAA,yCAEFA,6BAvBKA,qCASAA,oGAQFA,4DAI4BA,+BC7CjC,MAOayqJ,GAA4BjgH,cAPlB,CACrB,CACEp/B,KAAM,YACNwrB,UCoBJ,MAAM,QAiCJvuB,YACUlI,EACAC,EACAM,EACDC,GAHCL,uBACAA,yBACAA,oBACDA,sBAlCTA,uBAA8C,IAAI+I,KAAgB,GAC3D/I,sBAAgD,CACrD+jB,SAAU,EACVC,gBAAiB,CAAC,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,KACxCE,sBAAsB,GAGjBlkB,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,MAKVhuB,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,GASDjuE,mBAAgB+rB,WAEhB/rB,oBAAiBwY,gCAPtB,OAAOxY,KAAKoqJ,eAAeh5I,MAgB7BoP,WACExgB,KAAKqqJ,mBAAqBrqJ,KAAK01I,eAAev4H,UAC3CrC,SACEhb,IAA8D,IAA1BA,EAAOgY,MAAMuI,UAEnD9X,MACC,OAAKzI,IACH,MAAMM,OAAoB,IAAXN,OAAuB,EAAYA,EAAO0e,OACzD,OAAIpe,GAMFA,EAAOinC,YAAYpqB,KAAKxW,OAAQpG,GACT,gBAAdA,EAAOuE,IAGXxE,KAKbJ,KAAKw/E,kBACFvd,sBAAsB,CACrBn9D,KAAM,QAEPsD,UAAUtI,IACTE,KAAK0F,IAAI2/D,SACPrlE,KAAK6gF,aAAa5B,YAAY,CAC5BhwE,MAAO,MACPqN,OAAQxc,OA6DhBE,KAAKw/E,kBACFvd,sBAjBgD,CACjDn9D,KAAM,MACN+L,IAAK,kDACLm7B,OAAQ,CACNiT,aAAc,oBACdoI,kBAAmB,WACnB/7C,QAAS,QACTu2C,aAAc,WAEhBqF,aAAc,CACZ,CAAEh2C,KAAM,YAAa05B,MAAO,MAC5B,CAAE15B,KAAM,aAAc05B,MAAO,QAC7B,CAAE15B,KAAM,aAAc05B,MAAO,WAM9BxiC,UAAUtI,IAOTE,KAAK0F,IAAI2/D,SAASrlE,KAAK6gF,aAAa5B,YANtB,CACZhwE,MAAO,cACPggD,cAAe,IACfroC,SAAS,EACTtK,OAAQxc,OAMhB8kB,gBAAgB/kB,GACdG,KAAKsqJ,mBAAqBzqJ,gDAlJjBkB,GAAqBrB,kEAArBqB,EAAqBugB,8vBF5BlC5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,qBAASA,QACzBA,4BACEA,qBAAQA,eAA+FA,gCAAoBA,QAC7HA,QAEAA,6BACEA,8BACFA,QAEAA,qCAMAA,oDAUAA,oDA2BFA,eA/CmBA,4BAAW,eACTA,4BAKjBA,yCAAwB,aAIXA,wDAUAA,qWECJqB,GAAb,MCSO,IAAMwpJ,GAAb,MAAM,sDAAOxpJ,4DAfF,CACPiM,KACAm9I,GACA/6H,KACAJ,KACAvvB,KACA6vB,GACA8K,GACAwP,GACAxF,GACAgxF,GACA0gB,OAIS/0I,GAAb,yBCRQrB,uCAAqBA,uBCxB7B,MAOa8qJ,GAA0BtgH,cAPhB,CACrB,CACEp/B,KAAM,UACNwrB,UCEJ,MAAM,QAcJvuB,YACUlI,EACAC,EACAM,GAFAJ,uBACAA,kBACAA,sBAhBHA,SAAM,IAAIsgF,GAAO,CACtB54D,SAAU,CACR8qD,YAAa,CACXxkD,WAAW,MAKVhuB,UAAO,CACZqvE,OAAQ,EAAC,GAAK,MACdpB,KAAM,GAQNjuE,KAAKy/D,WAAWlP,OAAOvwD,KAAK0F,mDAnBnB3E,GAAmBrB,wDAAnBqB,EAAmBugB,oiBFVhC5hB,oBACEA,6BAAmBA,eAAGA,QACtBA,0BAAgBA,mBAAOA,QACvBA,4BACEA,aAAGA,2CAA+BA,QAElCA,cACAA,qBAAQA,gBAAiGA,iCAAoBA,QAAIA,eACjIA,kBAAIA,gBAAuFA,sBAAQA,QACnGA,eACFA,QAEAA,8BAIEA,8BACAA,mCACAA,qCACAA,kCACFA,QAEAA,wBACEA,+BACFA,QAEAA,wBACEA,6BACEA,4CAGFA,QACFA,QAEFA,eAnBIA,6BACiBA,4BACKA,4BACEA,4BACHA,4BAAW,uBAIQA,4BAIJA,8NEjB3BqB,GAAb,MC4BO,IAAM0pJ,GAAb,MAAM,sDAAO1pJ,4DAjBF,CACPoJ,KACAqgJ,GACAp7H,KACAJ,KACAvvB,KACA2kC,GACAgxF,GACAp/B,GACAr5C,GACA05E,GACAoH,GACA/1B,GACAy6C,OAISphJ,GAAb,GCnCA,MAAM2pJ,GAAiB,CACrB,CAAE5/I,KAAM,GAAI6/I,WAAY,QAASC,UAAW,QAC5C,CAAE9/I,KAAM,KAAM6/I,WAAY,UAOrB,IAAME,GAAb,MAAM,sDAAO9pJ,4DAHF,CAACmpC,aAAqBwgH,GAAQ,CAAEI,SAAS,KACxC5gH,QAECnpC,GAAb,GCIagqJ,GAAb,MAAM,QAQJhjJ,YACUlI,EACAC,EACAM,GAFAJ,yBACAA,aACAA,gBARHA,WAAQ,MACRA,aAAUsK,EACTtK,gBAAa,mBAQnBA,KAAKgrJ,YAAclrJ,EAAMmrJ,WAAW,sBACpCjrJ,KAAKkrJ,qBAAuB,IAAMrrJ,EAAkBof,gBACpDjf,KAAKgrJ,YAAYG,iBAAiB,SAAUnrJ,KAAKkrJ,sBAEjDlrJ,KAAK2iB,SAASC,SAAShhB,SAASG,KAAM/B,KAAKorJ,YAE3CprJ,KAAKqrJ,mBAGPlzI,cACEnY,KAAKgrJ,YAAYM,oBAAoB,SAAUtrJ,KAAKkrJ,sBAG9CG,mBACarqJ,YAAoB,CACrCorD,GAAI,MACJ6vB,OAAQ,MACRC,QAAS,SAIThxE,QAAQC,IAAI,sBAAuBnK,8DAlC5BD,GAAYrB,gEAAZqB,EAAYugB,y4DChBzB5hB,iBACEA,yBACEA,oBAAwBA,mDAASgyB,WAAehyB,sBAAoCA,QACpFA,cAAIA,SAASA,QACbA,cAAIA,SAAeA,QACrBA,QAEAA,mCACEA,2BACEA,yBACEA,gBAAgCA,iBAAIA,QAEpCA,eAEAA,gBAAuCA,qBAAQA,QAC/CA,gBAAqCA,mBAAMA,QAC3CA,iBAAuCA,qBAAQA,QAC/CA,iBAAoCA,kBAAKA,QACzCA,iBAAsCA,oBAAOA,QAC7CA,iBAAsCA,oBAAOA,QAE7CA,eAEAA,iBAAwCA,6BAAgBA,QAExDA,eAEAA,iBAAqCA,mBAAMA,QAC3CA,iBAAgDA,8BAAiBA,QACjEA,iBAA2CA,yBAAYA,QACvDA,iBAA8CA,4BAAeA,QAC7DA,iBAAmCA,iBAAIA,QACvCA,iBAAoCA,kBAAKA,QACzCA,iBAAmCA,iBAAIA,QACvCA,iBAAqCA,mBAAMA,QAE3CA,eAEAA,iBAAyCA,uBAAUA,QACnDA,iBAAoCA,kBAAKA,QACzCA,iBAAqCA,mBAAMA,QAC3CA,iBAAsCA,oBAAOA,QAC7CA,iBAAuCA,qBAAQA,QAC/CA,iBAAsCA,oBAAOA,QAC7CA,iBAAoCA,kBAAKA,QACzCA,iBAAsCA,oBAAOA,QAC7CA,iBAAmCA,iBAAIA,QACvCA,iBAAoCA,kBAAKA,QACzCA,iBAAsCA,oBAAOA,QAC7CA,iBAAqCA,mBAAMA,QAC3CA,iBAAoCA,kBAAKA,QACzCA,iBAA4CA,0BAAaA,QACzDA,iBAAyCA,uBAAUA,QACnDA,iBAA0CA,wBAAWA,QACrDA,iBAAyCA,uBAAUA,QACnDA,iBAA6CA,2BAAcA,QAC3DA,iBAAwCA,sBAASA,QAEjDA,eAEAA,iBAAsCA,oBAAOA,QAE/CA,QACFA,QAEAA,gCACEA,0BACFA,QAEFA,QACFA,cAtE+BA,iDAGvBA,wBACAA,8BAGmDA,6DACtBA,2DAA8C,mwBDQtEqB,GAAb,GEoGawqJ,GAAb,MAAM,QACJxjJ,YAAYlI,EAAkCC,GAC5CD,EAAgB+R,cACd9R,EAAa+R,+BACX,mFAJK9Q,GAASrB,kDAATqB,EAASyqJ,WAFRT,mCAHD,CACT,CAAC7gJ,QAASxK,MAAiBiM,WAAY8/I,GAAuB5/I,KAAM,CAACkC,IAAkB1D,OAAO,IAC/FklB,SAzDQ,CACP5d,GACArS,KACAosJ,KACAC,KACAC,KACA58H,KACAvvB,KACA0vB,KAEAgb,GACAG,GACAkC,GACAG,GACAE,GACAE,GACAI,GAEAG,GACAK,GACAI,GACAG,GACAW,GACAM,GACAM,GACAI,GAEAmM,GAEA68F,GACAE,GACAE,GACAE,GACAK,GACAE,GACAG,GACAE,GACAE,GACAI,GACAK,GACAkN,GACAU,GACAE,GACAM,GACAG,GACAE,GACAe,GACAK,GAEAE,GAEAI,GAEAvrJ,SAOSyB,GAAb,GAUM,YAAgCA,GACpC,MAAO,IAAM,IAAIiK,QAAc1J,IAC3BP,EAAgBiN,UAAUlC,eAAe/K,EAAgBmN,eAAe9F,UAAU,KAChF8C,QAAQwE,KAAK,6BAA6B3O,EAAgBmN,8BACzDrO,IACDqL,QAAQG,MAAM,iBAAiBtK,EAAgBmN,6CAC9C,KACD5M,EAAQ,mBC7HZipC,kBACF7qC,SAGFJ,OACGusJ,gBAAgBN,IAChB71G,MAAM30C,GAAOmK,QAAQC,IAAIpK,2BCd5B,OACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,YACA,eACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,sBACA,mBACA,sBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,eACA,kBACA,gBACA,aACA,gBACA,WACA,cACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,YACA,eACA,YACA,eACA,YACA,eACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,iBACA,oBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,cACA,iBACA,aACA,gBACA,cACA,iBACA,cACA,mBACA,sBACA,iBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,mBACA,sBACA,aACA,gBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,oBAIA,cACA,WACA,YAEA,cACA,cACA,8CACA,gCACAtB,EAEA,YAEAC,kBACA,uBAEAA,YACAF,YACAE","names":["Ee","io","le","T","e","Lp","getByte","t","o","charCodeAt","this","ALPHA","indexOf","charAt","n","s","a","length","l","String","PADCHAR","getByte64","push","fromCharCode","join","i","Go","Mp","window","navigator","userAgent","copy","r","Mt","createTextArea","selectText","copyTextToClipboard","destroyTextArea","document","createElement","value","body","appendChild","removeChild","getOSName","contentEditable","readOnly","createRange","getSelection","contenteditable","readonly","selectNodeContents","removeAllRanges","addRange","setSelectionRange","select","compareVersion","execCommand","diff","toString","Yo","getChanges","slice","mtc","ins","sbs","del","fis","c","split","u","p","fil","d","g","getMatchingSubstring","rotateArray","Array","hi","ADDED","findChanges","added","deleted","modified","findIndex","m","id","change","type","DELETED","splice","JSON","parse","stringify","ts","compareObject","MODIFIED","keysChanged","oldValue","newValue","map","Set","Object","keys","forEach","isArray","concat","key","resolve","replace","shift","Date","assign","E","isObject","filter","mergeDeep","hasOwnProperty","copyDeep","toUpperCase","count","toLowerCase","reduce","y","removeUndefined","removeNull","localeCompare","getOwnPropertyNames","roundToNDecimal","Math","pow","round","create","random","substring","Fo","fe","constructor","Ae","_status","status$","next","subscribe","watch","status$$","pipe","handleStatusChange","call","unsubscribe","unwatch","status","Waiting","on","v","register","Ze","ids","counter$","unregister","factory","Ip","intercept","headers","get","clone","delete","handle","activityService","is","forRoot","ngModule","providers","provide","q","useClass","multi","ll","lib","releaseDate","$","getConfig","config","load","default","path","injector","Promise","ge","console","log","en","error","version","cl","useValue","Gn","ns","useFactory","Zp","deps","getTranslation","x","W","prefix","http","suffix","kp","L","ul","translateService","langs","Error","substr","K","Dp","missingTranslationHandler","Pp","ho","h","al","positionClass","timeOut","extendedTimeOut","messageClass","closeButton","progressBar","enableHtml","tapToDismiss","maxOpened","preventDuplicates","resetTimeoutOnDuplicate","countDuplicates","includeTitleDuplicates","M","translate","getBrowserLang","getLanguage","setDefaultLang","language","match","setLanguage","use","reloadLang","fo","ERROR","me","options","configService","showError","caught","message","title","messages$","from","to","handleTemplate","text","SUCCESS","success","INFO","info","ALERT","WARNING","alert","toastId","languageService","instant","toastr","warning","remove","removeAllAreNotError","template","html","$p","httpError","handleError","handleCaughtError","handleUncaughtError","statusText","url","toDisplay","messageService","rs","Ep","name","objectStoresMeta","store","storeConfig","keyPath","autoIncrement","storeSchema","keypath","unique","qp","addSvgIconSet","bypassSecurityTrustResourceUrl","os","pl","fi","centerKey","zoomKey","projectionKey","contextKey","searchKey","visibleOnLayersKey","visibleOffLayersKey","directionsCoordKey","directionsOptionsKey","toolKey","wmsUrlKey","wmsLayersKey","wmtsUrlKey","wmtsLayersKey","arcgisUrlKey","arcgisLayersKey","iarcgisUrlKey","iarcgisLayersKey","tarcgisUrlKey","tarcgisLayersKey","vectorKey","decodeURIComponent","location","search","includes","router","navigate","queryParams","route","qt","Mobile","ro","Portrait","pt","observe","Io","matches","media$","orientation$","Landscape","Tablet","Desktop","getMedia","getOrientation","isTouchScreen","documentElement","isMobile","isDesktop","Fe","SESSION","so","se","sessionStorage","getItem","LOCAL","localStorage","set","setItem","storageChange$","scope","event","previousValue","currentValue","removeItem","REMOVED","clear","CLEARED","Bp","Map","generateBase64Index","base64Index","indexBase64","compressBlob","et","FileReader","readAsDataURL","onload","result","valueOf","compressStringBase64","object","decompressBlob","decompressStringBase64","atob","Uint8Array","Blob","ss","nn","connection","onLine","checkNetworkState","onlineSubscription","previousMessageId","state","emitEvent","offlineSubscription","stateChangeEventEmitter","emit","ngOnDestroy","currentState","ve","Ge","Default","vi","Auto","sn","None","safeObject","meta","Wo","idProperty","titleProperty","icon","iconProperty","rn","getKey","an","index","size","setMany","setAll","update","updateMany","updateManyExclusive","reverse","reverseMany","reverseChanges","updateAll","getAllKeys","some","entries","change$","getKey$","count$","empty$","_index","all","values$","all$","firstBy","find","firstBy$","manyBy","manyBy$","sort","destroy","values$$","createIndex","lifted","joins","filter$","addFilter","filterIndex","filters$","values","removeFilter","sort$","lift","liftJoinedSource","liftSource","_i","processValues","setValues","source$","Ke","source","computeJoinedValue","filterValues","sortValues","every","valueAccessor","direction","nullsFirst","generateIndex","getProperty","createStateManager","view","createDataView","stateView","createStateView","_pristine","entities$","softClear","updateCount","insert","insertMany","deleteMany","addStrategy","strategies","bindStore","activate","removeStrategy","unbindStore","getStrategyOfType","activateStrategyOfType","deactivateStrategyOfType","deactivate","Yp","hl","entity","statesAreTheSame","revision","ref","setChangeDetector","setStore","teardownObservers","innerStateIndex","setupObservers","detectChanges","cdRef","entities$$","onEntitiesChange","state$$","onStateChange","active$","active","doDeactivate","doActivate","stores","Xo","super","filterStore","unfilterStore","filterAll","unfilterAll","filters","filterClauseFunc","has","selected","fl","Jt","ngOnInit","watcher","ln","selected$$","onSelectFromStore","onSelectionChange","multiSelectValue","emptyValue","selectedChange","selected$","updateMultiToggleWithEntities","multiText$","multiNoneText","multiAllText","selectors","bi","onClick","stopPropagation","Wp","selection","_selected","toggleSelected","scroll","selectOnClick","addCls","selectedCls","highlightSelection","highlightedCls","removeCls","el","nativeElement","scrollMode","behavior","block","inline","renderer","addClass","removeClass","_l","paginationLabelTranslation$$","max","min","ngOnChanges","unsubscribeAll","count$$","emitPaginator","entitySortChange$$","entitySortChange$","paginator","firstPage","initPaginatorOptions","translateLabels","disabled","paginatorOptions","pageIndex","pageSize","pageSizeOptions","mediaService","showFirstLastButtons","hidePageSize","_intl","firstPageLabel","getRangeLabel","rangeLabel","itemsPerPageLabel","lastPageLabel","nextPageLabel","previousPageLabel","paginatorChange","Yn","Hn","transform","activityInterceptor","RegExp","test","responseType","dl","onloadend","complete","pure","G","Rt","maxCacheCount","Vn","_sanitizer","bypassSecurityTrustHtml","oxw","onFocus","onChange","onBlur","ds","yi","Ko","_","be","dateAdapter","setLocale","_paginator","dataSource","columns","visible","selectionCheckbox","selectMany","fixedHeader","handleDatasource","onValueChange","getColumnKeyWithoutPropertiesTag","properties","target","onBooleanValueChange","checked","onSelectValueChange","onAutocompleteValueChange","formGroup","controls","setValue","option","viewValue","onDateChange","format","enableEdit","validation","mandatory","setControl","formBuilder","control","multiple","parseInt","filteredOptions","valueChanges","domainValues","normalize","isEdition","linkColumnForce","utc","getValidationAttributeValue","disable","unsubscribeStore","selection$$","floor","selectionState$","computeSelectionState","dataSource$$","data","getTrackByFunction","refresh","onSort","getValue","sortNullsFirst","entitySortChange","column","onRowClick","lastRecordCheckedKey","entityClick","onRowSelect","entitySelectChange","onToggleRows","onToggleRow","onShiftToggleRow","selectNode","stopImmediatePropagation","All","Some","columnIsSortable","rowIsSelected","isImg","isUrl","pop","Boolean","Number","edition","getColumnRenderer","getTableClass","getHeaderClass","headerClassFunc","Function","getRowClass","rowClassFunc","getCellClass","cellClassFunc","onButtonClick","O","useExisting","yo","Dock","action","eg","disabled$","noDisplay$","args","ngClass","ngClass$$","updateNgClass","icon$$","updateIcon","ls","checkCondition","checkCondition$$","updateCheckCondition","tooltip","tooltip$$","updateTooltip","availability","availability$$","disabled$$","display","display$$","noDisplay","noDisplay$$","trigger","ngClass$","tooltip$","checkCondition$","icon$","cn","handler","collapsed","_overlayClass","withTitle","withIcon","horizontal","elRef","scrollActive","clientHeight","scrollHeight","scrollTop","positionConditionLow","onTriggerAction","scrollDown","scrollBy","scrollUp","Wn","S","Z","De","J","C","Xe","gs","imports","ms","matIconRegistry","getNamedSvgIcon","svg","updateSvg","hidden","updateHidden","updateDisabled","inverseColor","updateColor","inheritColor","querySelector","badge","style","alignItems","justifyContent","innerHTML","color","background","getComputedStyle","getPropertyValue","originalColor","Xn","ht","dg","handleMouseClick","contains","clickout","gg","xi","_target","_collapsed","collapseTarget","expandTarget","toggle","click","hs","_title","Ci","hg","fs","open","dialog","disableClose","componentInstance","confirmMessage","afterClosed","yl","R","vl","onContextMenu","close","preventDefault","menuPosition","overlayRef","overlay","position","flexibleConnectedTo","withPositions","originX","originY","overlayX","overlayY","positionStrategy","scrollStrategy","scrollStrategies","attach","Np","menuContext","viewContainerRef","$implicit","sub","mo","overlayElement","tt","elementRef","dispose","bl","Kn","H","er","getDom","toPromise","_g","vg","setTarget","componentRef","createComponent","componentFactory","updateInputs","inputs","updateSubscribers","subscribers","unobserveAllInputs","instance","propName","unobserveInput","observeInput","setInputValue","onUpdateInputs","getPrototypeOf","getOwnPropertyDescriptor","outputs","subscriptions","inputs$$","_s","resolver","resolveComponentFactory","xl","tr","component","dynamicComponent","dynamicComponentService","renderComponent","ys","vs","bs","xs","buttons","children","formData","setData","onSubmit","submitForm","getData","groups","fields","form","updateDataWithFormField","reset","Ig","Cs","group","addControl","validator","getValidators","setValidators","field","extendFieldConfig","getValidator","Ss","getFieldByType","Og","getFieldComponent","formFieldService","getFieldInputs","fieldInputs","fieldOptions","errors","placeholder","disableSwitch","formControl","required","getFieldSubscribers","fieldSubscribers","ws","ue","Sl","getFieldColSpan","cols","getFieldNgClass","getErrorMessage","wl","un","Ts","sr","Ms","As","Si","lt","Vo","Zo","Tl","Ml","jsonURL","getPathToConfigFile","loadConfigTour","getJSON","allToursOptions","getTourOptionData","Ls","isAppHaveTour","interactiveTourLoader","isToolHaveTourConfig","disabledTourButton","conditions","isTourDisplayInMobile","getButtons","classes","getAction","addProgress","setInterval","getCurrentStep","attachTo","element","cancel","clearInterval","getElement","querySelectorAll","classList","add","steps","className","innerText","insertBefore","checkNext","_setupModal","show","executeAction","condition","executeActionPromise","waitFor","maxWait","getShepherdSteps","popperOptions","modifiers","offset","beforeShowPromise","previousStep","beforeChange","beforeShow","noBackButton","class","highlightClass","scrollTo","scrollToElement","canClickTarget","disableInteraction","when","onShow","hide","onHide","startTour","shepherdService","defaultStepOptions","cancelIcon","enabled","modal","confirmCancel","addSteps","tourObject","start","ot","setToolbar","toolbar","initStore","activeTool$$","getTool","getTools","setTools","getToolbar","toolbar$","activateTool","activatePreviousTool","activeToolHistory","deactivateTool","clearActiveToolHistory","setActiveTool","activeTool$","wi","Al","toolbox","tools","Ll","getClass","styleButton","toolService","getTourToStart","tourToStart","activeToolName","isActiveTool","isToolHaveTour","interactiveTourService","startInteractiveTour","Fl","ei","Ti","kt","_color","_focused","beforeFocus","beforeUnfocus","toggleFocusedClass","focus","unfocus","beforeSelect","beforeUnselect","toggleSelectedClass","unselect","_disabled","beforeDisable","beforeEnable","toggleDisabledClass","enable","getOffsetTop","offsetTop","focused","focusedCls","disabledCls","vo","_navigation","_selection","_selectedItem","focusedItem","_focusedItem","handleKeyboardEvent","navigationEnabled","enableNavigation","ngAfterViewInit","listItems","init","listItems$$","changes","focusNext","toArray","getFocusedIndex","isScrolledIntoView","offsetHeight","focusPrevious","selectedItem","navigation","disableNavigation","scrollToItem","findSelectedItem","findFocusedItem","handleItemBeforeSelect","handleItemSelect","handleItemBeforeFocus","handleItemFocus","ti","At","_withHeader","vt","ar","shown$","shown","lm","counter$$","spinner","lr","gl","ps","_filterChange","connect","_database","cs","dataChange","_sort","sortChange","getFilteredData","getSortedData","disconnect","_model","filterable","pn","Am","_hasFIlterInput","Il","database","model","displayedColumns","displayed","unshift","actions","changed","getActionColor","isAllSelected","masterToggle","handleClickAction","Lm","Qp","Mi","White","he","km","Oo","Grey","Primary","toolbar$$","onToolbarChange","onActiveToolChange","actionStore","onAnimationStart","animating$","onAnimationComplete","getToolInputs","animate","onAnimate","animation$","parent","unAnimate","animating$$","Fm","changeDetection","Dm","Pm","Zl","onCancel","onComplete","destroyWidget","getEffectiveSubscribers","baseSubscribers","widget","Is","Zs","Ol","kl","getWorkspaceTitle","onSelectedChange","activateWorkspace","Em","Rm","workspace","widget$","widgetInputs$","widgetSubscribers$","onWidgetCancel","deactivateWidget","onWidgetComplete","Bm","Jm","activeWorkspace$","deactivateWorkspace","entityStore","activateWidget","jm","X","Qm","Ym","idsActivity","zm","ks","production","igo","projections","code","alias","def","extent","auth","intern","allowAnonymous","interactiveTour","tourInMobile","importExport","catalog","sources","queryFormat","queryHtmlTarget","regFilters","tooltipType","searchSources","nominatim","icherche","searchUrl","order","params","limit","coordinatesreverse","showInPointerSummary","icherchereverse","ilayer","Vm","configLanguage","Wm","Km","changeLanguage","eh","oh","ih","rh","sh","lh","callHttp","callHttpError","ch","dh","added$","gh","Ds","mh","fh","toggleComponent","_h","vh","description","image","bh","Sh","getTitle","wh","Ah","choices","formService","valueChanges$$","submitDisabled","valid","form$","fillForm","data$","clearForm","Lh","Ih","sortable","showName","Um","handleSelect","Zh","Ai","Oe","Li","Ph","activateSalutationTool","$h","Eh","Rh","widgetService","Bh","Ps","tokenKey","decode","Uh","isExpired","getTime","exp","Be","authenticate$","authenticated","logged$","login","username","password","encodePassword","loginCall","loginWithToken","token","typeConnection","infosUser","loginAnonymous","anonymous","post","tokenService","logout","isAuthenticated","getToken","decodeToken","goToRedirectUrl","redirectUrl","loginRoute","navigateByUrl","homeRoute","getUserInfo","getProfils","updateUser","patch","isAnonymous","user","isAdmin","locale","jh","apiKey","clientId","loadSDKGoogle","loadPlatform","warn","handleSignInClick","gapi","auth2","getAuthInstance","signIn","handleSignOutClick","signOut","handleClientLoad","initClient","client","discoveryDocs","then","updateTextButton","isSignedIn","listen","updateSigninStatus","loginGoogle","access_token","authService","appRef","tick","getElementsByTagName","src","parentNode","Qh","msalService","cr","cache","cacheLocation","broadcastService","Ut","inProgress$","Fi","_destroying$","checkAccount","loginMicrosoft","loginPopup","getConf","authRequest","setActiveAccount","account","acquireTokenSilent","accessToken","tokenId","idToken","catch","Pl","acquireTokenPopup","msalGuardConfig","$s","redirectHash","initializeWrapperLibrary","acquireTokenRedirect","handleRedirectObservable","ao","handleRedirectPromise","loginRedirect","logoutRedirect","logoutPopup","ssoSilent","getLogger","logger","setLogger","Gh","_msalSubject","msalSubject$","asObservable","_inProgress","msalInstance","addEventCallback","Nh","verbose","eventType","Yh","browserAuthOptions","loginMicrosoftb2c","zh","appId","loadSDKFacebook","subscribeEvents","FB","Event","statusChangeCallback","loginFacebook","authResponse","getElementById","Wh","_allowAnonymous","loginUser","loading","Es","backgroundDisable","isLogoutRoute","_backgroundDisable","hasAlreadyConnectedDiv","_hasAlreadyConnectedDiv","hasLogoutDiv","_hasLogoutDiv","showAlreadyConnectedDiv","_showAlreadyConnectedDiv","showLogoutDiv","_showLogoutDiv","showLoginDiv","analyzeRoute","getName","onLogin","logoutRoute","home","firstName","sourceId","events","Ho","isLoginRoute","ur","hostname","handleHostsWithCredentials","handleHostsAuthByKey","withCredentials","refreshToken","href","host","trustHosts","lo","interceptXhr","setRequestHeader","alterUrlWithKeyAuth","hostsWithCredentials","domainRegFilters","hostsWithAuthByKey","keyProperty","keyValue","refreshInProgress","redirectUri","authority","interactionType","scopes","loginHint","df","mf","pf","gf","hf","preference","mergePreference","qs","$l","yf","vf","Kf","extern","Di","_layer","openMetadata","abstract","ic","layerTitle","layer","metadataService","si","oe","V","tn","ol","handleLoadStart","handleLoadEnd","handleLoadError","__watchers__","loaded","params_","LAYERS","sourceOptions","styleByAttribute","hoverStyle","featureClass","$e","OPACITY","Nt","TITLE","wms","n_","wmts","r_","xyz","s_","feature","a_","wfs","l_","arcgisrest","Hs","imagearcgisrest","tilearcgisrest","osm","tiledebug","Vs","qo","featureTypes","origin","generateId","createOlSource","xn","getLegend","legend","setLegend","Ne","BasicNumericOperator","P","BBOX","moment","PropertyIsEqualTo","spatial","fieldRestrict","PropertyIsNotEqualTo","PropertyIsLike","PropertyIsGreaterThan","PropertyIsGreaterThanOrEqualTo","PropertyIsLessThan","PropertyIsLessThanOrEqualTo","PropertyIsBetween","During","PropertyIsNull","Intersects","Within","Contains","defineOgcFiltersDefaultOptions","editable","geometryName","advancedOgcFilters","pushButtons","checkboxes","radioButtons","autocomplete","buildFilter","ct","getCode","checkIgoFiltersProperties","bundleFilter","srsName","featureNS","featurePrefix","outputFormat","ni","writeGetFeature","XMLSerializer","serializeToString","createFilter","operator","logical","logicalArray","propertyName","pattern","matchCase","wildCard","singleChar","escapeChar","lowerBoundary","upperBoundary","f","wkt_geometry","b","w","parseFilterOptionDate","begin","minDate","A","end","maxDate","D","expression","F","olFormatWKT","readGeometry","dataProjection","featureProjection","And","Or","Not","defineInterfaceFilterSequence","filterSequence","addInterfaceFilter","computeAllowedOperators","allowedOperatorsType","Spatial","BasicAndSpatial","operators","Basic","Time","filterid","step","sliderOptions","igoSpatialSelector","igoSNRC","geometry","parentLogical","level","addFilterProperties","rebuiltIgoOgcFilterObjectFromSequence","computeIgoSelector","computedSelectors","bundles","selectorType","handleOgcFiltersAppliedValue","ogcFilters","formatGroupAndFilter","verifyMultipleEnableds","formatProcessedOgcFilter","isValid","qe","GML2","Qt","Wt","IFRAME","rc","Pi","Ws","ac","paramsWFS","Xs","Pt","xmlFilter","download","dynamicUrl","urlWfs","maxFeatures","k","sourceFields","ye","Me","fieldNameGeometry","ce","N","re","OlFormat","formatOptions","gmlFormat","js","Lf","jl","Ff","jt","DPI","MAP_RESOLUTION","FORMAT_OPTIONS","refreshIntervalSec","cc","buildDynamicDownloadUrlFromParamsWFS","calendarModeYear","wfsService","getSourceFieldsFromWFS","FILTER","setOgcFilters","timeFilterable","timeFilter","setTimeFilter","queryTitle","mapLabel","BLANK","updateParams","igoRefresh","wf","ratio","ogcFilters$","timeFilter$","scale","projection","contentDependentLegend","VERSION","currentStyle","onUnwatch","ogcFilterWriter","transferCommonProperties","ogcFilters$$","transferOgcFiltersProperties","timeFilter$$","transferTimeFilterProperties","syncChildLayers","layers","linkedLayers","links","VISIBLE","opacity","MINRESOLUTION","minResolution","MAXRESOLUTION","OGCFILTERS","TIMEFILTER","getProperties","linkId","linkedIds","visible$","bidirectionnal","getSource","viewController","getOlProjection","getParams","Lt","TIME","tile","getSourceFormatFromOptions","olSourceVector","formatType","gr","xe","Ce","Ql","Xt","getUrl","ie","z","ke","de","Qe","zt","Lo","Qn","Xi","mi","Ki","te","Kr","il","go","QL","Sp","wp","GL","es","toLocaleUpperCase","trim","Uo","parseFloat","Ro","Y","lonLat","radius","conf","forceNA","YL","C3","abs","originalEvent","altKey","If","metaKey","ctrlKey","shiftKey","zo","isInResolutionsRange$","I","createOlLayer","zIndex","baseLayer","maxResolution","mt","maxScaleDenom","minScaleDenom","legendOptions","legendCollapsed","isIgoInternalLayer","getZIndex","setZIndex","setOpacity","setMaxResolution","updateInResolutionsRange","getMaxResolution","setMinResolution","getMinResolution","setVisible","hasBeenVisible$","messages","showOnEachLayerVisibility","showMessage","isInResolutionsRange","showInLayerList","setMap","unobserveResolution","observeResolution","layerSyncWatcher","u_","hasBeenVisible$$","resolution$$","resolution$","getResolution","yr","d_","browsable","exportable","animation","flash","bind","trackFeature","enableTrackFeature","olLayerVector","customWFSLoader","authInterceptor","customLoader","setLoader","frameState","getGeometry","time","duration","ColorAsArray","getStyleFunction","getImage","getType","getRadius","setRadius","getStroke","setColor","setWidth","Oi","getWidth","getFill","setText","setStyle","drawGeometry","render","stopAnimation","trackFeatureListenerId","centerMapOnFeature","getFeatureById","getView","setCenter","getCoordinates","getId","disableTrackFeature","ki","lc","getFeatures","mostRecentIdCallOGCFilter","XMLHttpRequest","removeLoadedExtent","onerror","responseText","getFormat","readFeatures","addFeatures","send","geoNetworkService","geoDBService","Do","ko","xo","DOMParser","parseFromString","readProjection","responseXML","response","Zf","Of","Ks","strategy","Gl","b_","defineFieldAndValuefromWFS","wfsGetFeature","getKeys","getGeometryName","built_properties_value","boundedBy","getExtent","extentGetWidth","kf","extentGetTopLeft","resolutions","matrixIds","tileGrid","x_","Yl","crossOrigin","Df","items","cartocss","layer_name","mr","attributions","overlaps","encodeURIComponent","customParams","olloadingstrategy","legendInfo","htmlImgSrc","contentType","imageData","label","uniqueValueInfos","symbol","createSVG","width","outline","renderingRule","Pf","layerId","$f","qf","Ef","createWebSocket","WebSocket","onmessage","onMessage","onclose","onClose","onError","onopen","onOpen","readFeature","removeFeature","addFeature","Hl","zl","_converters","esriPMS","je","_convertEsriPMS","esriSFS","_convertEsriSFS","esriSLS","_convertEsriSLS","esriSMS","_convertEsriSMS","esriTS","_convertEsriTS","_renderers","uniqueValue","_renderUniqueValue","simple","_renderSimple","classBreaks","_renderClassBreaks","_transformAngle","angle","U","ft","fill","j","_transformColor","font","weight","family","textBaseline","verticalAlignment","textAlign","horizontalAlignment","offsetX","_convertPointToPixel","xoffset","offsetY","yoffset","rotation","Ii","_convertOutline","stroke","B","lineDash","PI","Le","Zi","points","radius2","_convertLabelingInfo","labelExpression","maxScale","minScale","_getResolutionForScale","getText","defaultSymbol","classBreakInfos","classMinValue","minValue","classMaxValue","field1","generateStyle","drawingInfo","labelingInfo","He","DATE","St","CALENDAR","$t","getMap","Ei","br","Mf","Af","esriJSON","getWMSOptions","getCapabilities","parseWMSOptions","getWMTSOptions","parseWMTSOptions","getCartoOptions","jsonp","mapId","parseCartoOptions","getArcgisOptions","bo","parseArcgisOptions","getImageArcgisOptions","parseTileOrImageArcgisOptions","getTileArcgisOptions","fromObject","request","service","parsers","read","findDataSourceInCapabilities","Capability","Layer","DataURL","Abstract","KeywordList","queryable","getTimeFilter","Style","getStyle","EX_GeographicBoundingBox","mapService","GEOJSON","GEOJSON2","GML3","HTML","Request","GetFeatureInfo","Format","_layerOptionsFromSource","Title","MaxScaleDenominator","MinScaleDenominator","metadata","OnlineResource","keywordList","stepDate","Contents","Identifier","layer_definition","layerName","units","dr","copyrightText","timeInfo","timeExtent","setTime","toUTCString","range","DATETIME","serviceDescription","displayField","Name","Dimension","stylesAvailable","Sn","registerProjection","Bs","Bl","setExtent","bt","createAsyncDataSource","createOSMDataSource","createFeatureDataSource","createWFSDataSource","createWMSDataSource","createWMTSDataSource","createXYZDataSource","createTileDebugDataSource","createCartoDataSource","createArcGISRestDataSource","createArcGISRestImageDataSource","createWebSocketDataSource","createMVTDataSource","createTileArcGISRestDataSource","createClusterDataSource","datasources$","dc","mc","$i","wfsDataSourceService","optionsFromCapabilities","capabilitiesService","optionsService","optionsFromApi","oa","ta","gc","vr","getArcgisRestOptions","ia","na","Cn","ra","OlFormatGeoJSON","setId","zn","startsWith","writeGeometryObject","excludeAttribute","excludeAttributeOffline","idColumn","mapTitle","getRevision","Ye","_c","Zoom","zoomToExtent","Move","moveToExtent","getZoom","Se","bindLayer","addLayer","setLayerFeatures","checkLayer","Ft","setLayerOlFeatures","setStoreOlFeatures","ai","clearLayer","removeOlFeaturesFromLayer","addOlFeaturesToLayer","Kt","watchStore","empty$$","Dt","updateEntitiesInExtent","unwatchStore","unwatchAll","stores$$","states$$","state$","inMapExtent","updateEntitiesInResolution","inMapResolution","setMotion","motion","onFeaturesChange","selectMotion","viewScale","areaRatio","getFeatureId","pristine","onSourceChanges","flatMap","Vl","_overlayStore","createOverlayStore","unselectAll","overlayStore","deactivateSelection","unlistenToMapClick","removeDragBoxInteraction","addOverlayLayer","listenToMapClick","dragBox","addDragBoxInteraction","watchAll","removeOverlayLayer","mapClickListener","onMapClick","_r","getFeaturesAtPixel","pixel","hitTolerance","layerFilter","onSelectFromMap","getInteractions","getArray","Sr","addInteraction","olDragSelectInteraction","olDragSelectInteractionEndKey","onDragBoxEnd","removeInteraction","mapBrowserEvent","getFeaturesInExtent","groupFeaturesByStore","unselectAllFeaturesFromStore","selectFeaturesFromStore","createOverlayLayer","xt","removeLayer","Gt","wt","markerColor","markerOutlineColor","imgSize","anchor","overflow","uo","createStyle","Ri","parseStyle","attribute","getLabel","getOlCls","getOlKey","Sf","createStyleByAttribute","guessTypeFeature","pe","baseStyle","Je","createClusterStyle","clusterRanges","minRadius","maxRadius","showRange","dynamicRadius","image_","radiusCalc","matchAll","xc","strokeWidth","fillColor","strokeColor","L_","setFeatures","removeOlFeature","addOlFeatures","addOlFeature","removeFeatures","unwatchLayer","watchLayer","Bi","getOlMap","olMap","setOlMap","observerKeys","Cc","stateHistory","olView","setPadding","top","padding","right","bottom","left","onMoveEnd","extent$$","extent$","getProjection","getCenter","calculateExtent","getSize","getScale","getUnits","zoomIn","zoomTo","zoomOut","cancelAnimations","zoom","easing","getRotation","resetRotation","hasPreviousState","states","stateIndex","hasNextState","previousState","setStateIndex","nextState","clearStateHistory","setInitialState","sqrt","maxZoomOnExtent","fit","maxZoom","callback","setState","resolution","center","trunc","Co","Position","buffer","accuracyThreshold","followPosition","geolocationOverlay","wr","_buffer","handleFeatureCreation","position$","_accuracyThreshold","geolocation","getTracking","setTracking","tracking$","storageService","_followPosition","followPosition$","deleteGeolocationFeatures","deleteFeatureByType","Accuracy","Buffer","onPositionChange","Rf","trackingOptions","enableHighAccuracy","maximumAge","timeout","subscriptions$$","emissionIntervalSeconds$","tracking","updateGeolocationOptions","geolocate","alwaysTracking","accuracy","altitude","altitudeAccuracy","heading","speed","timestamp","Pe","_n","olFeature","positionFeatureStyle","accuracyFeatureStyle","bufferRadius","bufferStroke","bufferFill","showBufferRadius","attribution","defaultOptions","layerWatcher","I_","layers$","olControlAttribution","scaleLine","Rl","interactions","altShiftDragRotate","doubleClickZoom","keyboard","mouseWheelZoom","shiftDragZoom","dragPan","pinchRotate","pinchZoom","bf","olinteraction","setView","Z_","queryResultsOverlay","searchResultsOverlay","once","geolocationController","O_","mapViewOptions","updateView","constrainResolution","xf","maxLayerZoomExtent","updateControls","getControls","removeControl","changeBaseLayer","getBaseLayers","setMinZoom","minZoom","setMaxZoom","getLayerById","getLayerByAlias","getLayerByOlUId","ol_uid","addLayers","doAddLayer","setLayers","removeLayers","handleLinkedLayersDeletion","doRemoveLayer","syncedDelete","removeAllLayers","raiseLayer","getLayerIndex","moveLayer","raiseLayers","lowerLayer","lowerLayers","sortLayersByZIndex","onOfflineToggle","offlineButtonToggle$","we","_view","_controls","activityId","D_","listenToMapPointerMove","unlistenToMapPointerMove","pointerMoveListener","onPointerEvent","pointerPositionDelay","dragging","lastTimeoutRequest","clearTimeout","coordinate","mapProjection","setTimeout","pointerPositionCoord","i_","olLoadingProblem","Jf","setImageLoadFunction","abort","TextDecoder","URL","createObjectURL","uc","Uf","setTileLoadFunction","hr","onLoad","E_","mouseout","subscribeToPointerStore","layers$$","li","q_","selectionLayer","renderMode","declutter","olVectorTileSource","mvtStyleOptions","selectionMVT","createHoverStyle","backgroundFill","backgroundStroke","styleService","unsubscribeToPointerStore","unlistenToMapSingleClick","store$$","pointerHoverFeatureStore","entitiesToPointerOverlay","addFeatureOverlay","onMapEvent","singleClickMapListener","onMapSingleClickEvent","igoHoverFeatureEnabled","getPixelFromCoordinate","forEachFeatureAtPixel","canProcessHover","handleRenderFeature","setLayerStyleFromOptions","setProperties","OlGeom","setGeometry","setSource","igoHoverFeatureDelay","Xl","hoverFeatureId","hoverSummary","getHoverSummary","getOrientedFlatCoordinates","OlStyle","st","getMinZoom","getMaxZoom","Mn","_map","ngAfterContentInit","tracking$$","onGeolocationClick","An","computeHomeExtent","homeExtentButtonExtent","extentOverride","homeExtentButtonCenter","centerOverride","homeExtentButtonZoom","zoomOverride","onToggleClick","U_","noSleep","jf","edge","chrome","firefox","opera","safari","disableWakeLock","onblur","enableWakeLock","toggleWakeLock","z_","useStaticIcon","_baseLayers","collapseOrExpand","expand","baseLayers","height","H_","compression","regionID","compressed","insertSource","insertEvent","ngxIndexedDBService","getByID","dbName","collisionsMap","customUpdate","_newTiles","deleteByKey","getRegionTileCountByID","getRegionByID","IDBKeyRange","only","getAllByIndex","deleteByRegionID","openCursor","lowerBound","openCursorByIndex","resetCounters","resetCollisionsMap","revertCollisions","getByKey","V_","networkService","networkOnline","getOnline","getOffline","isOnline","Ie","createLayer","createTileLayer","createVectorLayer","createImageLayer","nc","createVectorTileLayer","createAsyncLayer","dataSourceService","P_","$_","geoNetwork","clusterBaseStyle","clusterParam","applyMapboxStyle","Sc","mapboxStyle","getStuff","sprite","getAbsoluteUrl","Kl","Ac","Ve","_baseLayer","handleBaseLayerChanged","handleMainMapViewChange","basemap","setResolution","setRotation","layerService","handleLinkedBaseLayer","Ln","_showIfNoRotation","rotationStyle","oy","at","_e","catalogService","Ui","collectCatalogItems","loadCatalogWMSLayerItems","loadCatalogWMTSLayerItems","baselayers","loadCatalogBaseLayerItems","loadCatalogArcGISRestItems","composite","loadCatalogCompositeLayerItems","createInstanceCatalog","ay","ry","sy","Lc","ny","iy","sa","query","previousMessageIds","queryLayer","getQueryUrl","HTMLGML2","mergeGML","extractData","Ul","Bf","Wl","getQueryParams","bbox","appendLineString","Ht","appendPolygon","co","coordinates","convexHull","cross","getAllowedFieldsAndAlias","extractGML3Data","extractGeoJSONData","ESRIJSON","extractEsriJSONData","TEXT","extractTextData","extractHtmlData","extractGML2Data","createGeometryFromUrlClick","FEATURE_COUNT","featureCount","defaultFeatureCount","getQueryTitle","sourceTitle","fn","featureToResult","features","crs","srs","lastIndexOf","Qf","GEOMETRIE","shape","SHAPE","the_geom","geom","queryUrl","getCustomQueryUrl","INFO_FORMAT","getMimeInfoFormat","QUERY_LAYERS","getFeatureInfoUrl","sql","queryPrecision","getLabelMatch","Fn","queryLayerFeatures","Ic","cancelOngoingQueries","queryService","queryEnabled","queryFeatures","doQueryFeatures","waitForAllQueries","queries$$","values_","queryFormatAsWms","nom","id_","_icon","OlRenderFeature","getEnds","getFlatCoordinates","Js","queryFeaturesHitTolerance","queryFeaturesCondition","cy","forEachFeatureIntersectingExtent","ut","getDefaultOptions","settings","setParamFromSetting","available","showInSettings","getHashtagsValid","getSettingsValues","hashtags","Zc","getGoogleMapsCoordLink","encodeURI","markerOpacity","fillOpacity","strokeOpacity","getOpenStreetMapLink","la","loadCatalogs","ii","apply","loadCatalogItems","Fc","getCatalogBaseLayersOptions","externalProvider","Group","getCatalogCapabilities","Service","flattenWmsCapabilities","groupSeparator","includeRecursiveItems","getWMTSItems","getArcGISRESTItems","sortDirection","groupImpose","address","pr","newMetadataUrl","computeForcedProperties","metadataUrl","metadataAbstract","metadataAbstractAll","metadataUrlAll","prepareCatalogItemLayer","retrieveLayerInfoFormat","showLegend","setCrossOriginAnonymous","forcedProperties","prepareCatalogItemGroup","testLayerRegexes","findCatalogInfoFormat","ServiceIdentification","matrixSet","requestEncoding","ca","catalogAllowLegend","isGroup","isLayer","onLayerAddedChange","addLayerToMap","removeLayerFromMap","onGroupAddedChange","addGroupToMap","removeGroupFromMap","addLayersToMap","removeLayersFromMap","sortCatalogItemsByTitle","In","styles","listStyles","STYLES","updateLegendOnResolutionChange","onViewControllerStateChange","legendItems$","getLegendGraphic","imgGraphValue","toggleLegendItem","transfertToggleLegendItem","computeItemTitle","updateLegend","onChangeStyle","onLoadImage","renderedLegends","first","imagesHeight","Oc","isPreview$$","isPreview$","addedLayerIsPreview","computeTitleTooltip","ABSTRACT","CUSTOM","onMouseEvent","askForLegend","layerLegendShown$","igoLayer$","mouseInsideAdd","addedChange","haveGroup","inRange$","computeTooltip","By","evaluateAdded","evaluateDisabled","onToggleCollapsed","layerAddedChange","tryToggleGroup","onLayerPreview","preview$","toggleCollapsed","onTitleClick","Jy","Dc","_activeLayer","selectionMode","layerTool$","_selectAll","layerCheck","inResolutionRange$","expandLegendIfVisible","firstLoadComponent","toggleLegend","updateQueryBadge","onResolutionChange","tooltipText","network$$","showLegend$","toggleLegendOnClick","toggleVisibility","toggleLegendOnVisibilityChange","queryBadge","queryBadgeHidden$","toggleLayerTool","check","checkbox","it","always","Jo","ALL_VISIBLE","Ni","Raise","ci","_layers","removeProblemLayerInList","activeLayer$","_keyword","_onlyVisible","_sortedAlpha","orderable","activeLayer","getUpperLayer","isUpperBaselayer","getLowerLayer","isLowerBaselayer","layersChecked","raisableLayers","selectAllCheck","lowerDisabledSelection","lowerableLayers","checkOpacity","layersCheckedOpacity","change$$","showToolbar$","computeShowToolbar","computeLayers","appliedFilterAndSort","keyword","sortAlpha","onlyVisible","selectAllCheck$$","selectAllCheck$","layerTool","excludeBaseLayers","activeLayerIsValid","activeLayersAreValid","zoomLayerExtents","zoomLayersExtents","changeOpacity","clearKeyword","moveActiveLayer","getLinkedLayers","Lower","ZINDEX","raisableLayer","computeElementRef","offsetParent","lowerableLayer","filterLayers","sortLayersByTitle","sortLayersByZindex","onKeywordChange","onAppliedFilterAndSortChange","layerFilterAndSortOptions","showToolbar","never","thresholdToFilterAndSort","toggleOpacity","removable","hideSelectedLayers","layerItemChangeDetection$","isLayerRemovable","isAllLayersRemovable","NULL","MIXED","ALL_HIDDEN","layersCheck","toggleSelectionMode","selectAll","getElementsByClassName","cv","onlyVisible$","sortAlpha$","term$","term$$","onlyVisible$$","term","sortAlpha$$","clearTerm","toggleSortAlpha","toggleOnlyVisible","Tr","layersOrResolutionChange$$","setLayersVisibilityStatus","layersVisibility$$","layersAreAllVisible","Zn","computeShownLayers","hasVisibleOrInRangeLayers$","hasVisibleAndNotInRangeLayers$","layersInUi$","showAllLegendsValue","toggleShowAllLegends","allLegendsShown","Mr","toggleTrackFeature","$c","ui","dt","rt","ri","Ec","Mv","predefinedCatalogs","addedCatalog","defaultAddedCatalogType","typeCapabilities","addedCatalogType$$","updateValueAndValidity","computePredefinedCatalogList","storeViewAll$$","emailAddress","changeUrlOrTitle","patchValue","predefinedCatalogsList$","addCatalog","dialogRef","ua","getCatalogs","onCatalogSelect","catalogSelectChange","unsubscribeAddingCatalog","addingCatalog$$","addCatalogDialog","mapName","ServiceType","addedCatalogs","onCatalogRemove","Ov","removeCatalogFromLibrary","catalogRemove","qc","Rc","Bc","isTimeFilterable","isOgcFilterable","Jc","filterByDate","reformatDateTime","filterByYear","getFullYear","getMonth","getUTCDate","getUTCHours","getUTCMinutes","pa","filterByOgc","setOgcWFSFiltersOptions","interfaceOgcFilters","setOgcWMSFiltersOptions","filtered","Te","Predefined","yt","Address","On","AdmRegion","Arrond","CircFed","CircProv","DirReg","MRC","Mun","RegTour","bornes","hydro","routes","baseUrl","getKeyByValue","loadFilterList","urlFilterList","loadThematicsList","loadFilterItem","bufferInput","simplified","loc","loadItemById","loadBufferGeometry","bufferOutput","Uc","outputFormatDownload","Pv","openDownload","downloadService","Ar","pi","unsubscribe$","_source","_feature","selectFeature","ready","urlSanitizer","sanitizer","isHtmlDisplay","htmlDisplayEvent","htmlSanitizer","openSecureUrl","isDoc","isEmbeddedLink","getEmbeddedLinkText","filterFeatureProperties","Route","kn","Point","Dn","Arial","olDrawingLayer","drawingLayer","createOlInnerOverlayLayer","olGeometryType","geometryType","olDrawingLayerSource","clearOlInnerOverlaySource","removeOlInnerOverlayLayer","removeOlInteractions","addOlInnerOverlayLayer","addOlInteractions","setGeometryType","Po","drawingLayerSource","Vt","drawingLayerStyle","freehand$","fr","maxPoints","freehand","stopClick","interactionStyle","freehandCondition","olDrawInteraction","onDrawStartKey","onDrawStart","onDrawEndKey","onDrawEnd","onDrawAbortKey","abort$","Qs","olModifyInteraction","olSelectInteraction","Rs","tc","onSelect","unsubscribeKeyDown","onDrawKey","start$","mousePosition","ha","changes$","subscribeKeyDown","modify$","end$","select$","keyDown$$","removeLastPoint","finishDrawing","abortDrawing","t1","cancelDrawing","confirm","confirmFlag","o1","Et","Length","ne","Meters","fa","Kilometers","Miles","Feet","We","SquareMeters","Gc","SquareKilometers","SquareMiles","SquareFeet","Hectares","Acres","i1","r1","n1","s1","a1","l1","c1","u1","decimal","toLocaleString","minimumFractionDigits","maximumFractionDigits","toFixed","unit","unitAbbr","olGetLength","ya","olGetArea","area","lengths","Yc","getCoordinateAt","setCoordinates","zc","removeOverlay","oc","stopEvent","setPosition","Olstyle","v1","getFillColor","setFillColor","getStrokeColor","setStrokeColor","getStrokeWidth","getLabelsAreShown","labelsAreShown","toggleLabelsAreShown","setIcon","getIcon","getFontSize","fontSize","setFontSize","getFontStyle","fontStyle","setFontStyle","createDrawingLayerStyle","flatCoordinates","cos","b1","getIconsList","getIcons","icons","getPath","Kc","draw","buildForm","drawStyleService","drawIconService","drawControl","createDrawControl","toggleDrawControl","ji","Wc","onGeometryTypeChange","wn","bc","many","clearLabelsOfOlGeometry","selectedFeatures$","onColorChange","strokeForm","onToggleDrawControl","deactivateDrawControl","activateDrawControl","openDialog","currentLabel","updateLabelOfOlGeometry","onSelectDraw","drawControlIsDisabled","drawControlIsActive","drawEnd$$","onModifyDraw","drawSelect$$","addFeatureToStore","replaceFeatureInStore","rad","longitude","latitude","deleteDrawings","xa","onToggleLabels","_label","onIconChange","openShorcutsDialog","editLabelDrawing","onFontChange","eu","Ue","ec","Ca","A1","So","modify","olOverlayLayer","olLinearRingsLayer","createOlLinearRingsLayer","olOverlaySource","removeOlModifyInteraction","removeOlTranslateInteraction","removeOlDrawInteraction","addOlDrawInteraction","addOlTranslateInteraction","activateTranslateInteraction","addOlModifyInteraction","activateModifyInteraction","setOlGeometry","layerStyle","Qc","addOlLinearRingsLayer","removeOlLinearRingsLayer","clearOlLinearRingsSource","olLinearRingsSource","drawStyle","deactivateModifyInteraction","olModifyInteractionIsActive","onModifyStartKey","onModifyStart","onModifyEndKey","onModifyEnd","onModifyKey","item","subscribeToKeyDown","unsubscribeToKeyDown","Jl","olTranslateInteraction","deactivateTranslateInteraction","olTranslateInteractionIsActive","onTranslateStartKey","onTranslateStart","onTranslateEndKey","onTranslateEnd","onTranslateKey","olOuterGeometry","getOlGeometry","intersectsCoordinate","subscribeToDrawKeyDown","drawKeyDown$$","unsubscribeToDrawKeyDown","subscribeToDrawKeyUp","activateDrawInteraction","drawKeyUp$$","unsubscribeToDrawKeyUp","deactivateDrawInteraction","olDrawInteractionIsActive","removedOlInteractions","getLinearRing","addLinearRingToOlGeometry","updateLinearRingOfOlGeometry","appendLinearRing","Gf","getLinearRings","En","iu","onNoClick","Sa","activeLengthUnit","$n","Pn","measure","activeAreaUnit","Lr","setActiveMeasureType","_activeMeasureType","activeDrawControl","createDrawLineControl","createDrawPolygonControl","createModifyControl","updateTooltipsOfOlSource","checkDistanceAreaToggle","deactivateModifyControl","freezeStore","onMeasureTypeChange","activeMeasureType","onToggleMeasureUnitsAuto","measureUnitsAuto","onToggleDisplayDistance","displayDistance","onDisplayDistance","onToggleDisplayLines","displayLines","onDisplayLines","onToggleDisplayAreas","displayAreas","onDisplayAreas","onLengthUnitChange","table","activeOlGeometry","updateTooltipsOfOlGeometry","onAreaUnitChange","onCalculateClick","perimeter","onDeleteClick","olDrawSource","onModifyClick","modifyControl","activateModifyControl","clearTooltipsOfOlGeometry","onFeatureAddedKey","updateMeasureOfOlGeometry","onFeatureRemovedKey","selectedFeatures$$","hasArea$","hasLine$","ze","drawLineControl","_a","drawPolygonControl","ou","Area","drawStart$$","drawChanges$$","onDrawChanges","clearMeasures","clearTooltipsOfOlSource","finalizeMeasureOfOlGeometry","va","measure$","modifyStart$$","modifyEnd$$","modifyChanges$$","onModifyChanges","_measure","ba","Vc","updateOlTooltip","olGetCenter","showTooltipsOfOlGeometry","shouldShowTooltip","addOverlay","forEachFeature","showTooltipsOfOlSource","_unit","_type","computeTooltipInnerHTML","showTooltips","minSegmentLength","nu","ru","createMeasureTooltip","ngControl","_geometryType","deactivateControl","freehandDrawIsActive","toggleControl","_drawControlIsActive","_freehandDrawIsActive","jc","_drawStyle","getGuideStyleFromDrawStyle","defaultDrawStyleRadius","_overlayStyle","_value","addGeoJSONToOverlay","features_","overlayStyle","addOlOverlayLayer","registerOnChange","registerOnTouched","onTouched","writeValue","controlOptions","updateDrawStyleWithDrawGuide","activeControl","activateControl","olGeometryEnds$$","onOlGeometryEnds","olGeometryChanges$$","onOlGeometryChanges","removeMeasureTooltip","updateMeasureTooltip","circleToPoint","olGeoJSON","olTooltip","drawGuide","isStyleWithRadius","su","wa","qn","ab","YEAR","isNaN","startDate","endDate","SLIDER","getStepDefinition","timeInterval","getTimezoneOffset","startYear","initStartYear","endYear","initEndYear","isRange","startListYears","endListYears","listYears","checkFilterValue","yearChange","year","storeCurrentFilterValue","handleDateChange","setupDateOutput","applyTypeChange","handleYearChange","handleListYearChange","handleListYearStartChange","dateToNumber","setSliderThumbLabel","findThumbLabel","mySlider","_elementRef","childNodes","textContent","toggleFilterState","stopFilter","resetFilter","date","playFilter","interval","playIcon","playYear","handleSliderDateChange","handleSliderTooltip","handleSliderYearChange","handleSliderValue","current","getRoundedDate","toDateString","toTimeString","setSeconds","setHours","setMinutes","getDay","getHours","getMinutes","getRangeMinDate","getRangeMaxDate","asMilliseconds","Fr","timeFilterService","datasource","filtersCollapsed","toggleFiltersCollapsed","Ir","hb","wktToFeature","extentToWkt","roundCoordinateArray","wktPoly","wktLine","wktMultiPoints","roundArray","snrcToWkt","au","allOgcFilterOperators","ogcFilterOperators$","igoSpatialSelectors","_snrc","currentFilter","allowedOperators","fields$","excludeFromOgcFilters","updateFieldsList","selectedField$","updateValuesList","currentFilterIsSpatial","filteredFields$","_filterFields","changeField","filteredValues$","_filterValues","changeProperty","clearSelectedField","clearProperty","isClearable","detectProperty","refreshFilters","deleteFilter","changeLogical","changeOperator","currentFilterIsSpatial$","changeSpatialSelector","changeCaseSensitive","changeNumericProperty","changeMapExtentGeometry","changeSNRC","snrc","changeSNRCGeometry","wktService","isTemporalOperator","ogcFilterOperator","lu","Rn","hasSelector","ogcFilterService","lastRunOgcFilter","hasActiveSpatialFilter","filtersAreEditable","addFilterToSequence","defaultLogicalParent","isAdvancedOgcFilters","addFilterDisabled","changeOgcFiltersAdvancedOgcFilters","changeOgcFilterType","Zr","Bn","Ta","stepMillisecond","defaultStepMillisecond","stepIsYearDuration","years","months","weeks","days","hours","minutes","stepIsMonthDuration","stepIsWeekDuration","stepIsDayDuration","stepIsHourDuration","stepIsMinuteDuration","wo","addStep","toDate","subtractStep","subtract","cu","_currentFilter","pushButtonsGroup","checkboxesGroup","radioButtonsGroup","selectGroup","autocompleteGroup","selectEnabled$","applyFiltersTimeout","currentSelectGroup","applyFilters","selectEnableds$","autocompleteEnabled$","currentAutocompleteGroup","selectMulti","getPushButtonsGroups","getCheckboxesGroups","getRadioButtonsGroups","getSelectGroups","getAutocompleteGroups","currentPushButtonsGroup","currentCheckboxesGroup","currentRadioButtonsGroup","getSelectEnabled","getSelectDomValues","getAutocompleteEnabled","getAutocompleteDomValues","onPushButtonsChangeGroup","onCheckboxesChangeGroup","onRadioButtonsChangeGroup","onSelectChangeGroup","onAutocompleteChangeGroup","selectEnableds","selectEnabled","autocompleteEnabled","getToolTip","domSelectors","domService","filteredOgcAutocomplete","getButtonColor","bundleIsVertical","vertical","emptyRadioButtons","emptySelect","emptyAutocomplete","markAsUntouched","toggleAllSelection","selectAllSelected","sel","deselect","selectOptionClick","isUserInput","autocompleteOptionClick","displayFn","isMoreResults","radioButtonsIndex","checkboxesIndex","displayMoreResults","isLessResults","baseIndex","displayLessResults","decls","Ma","spatialType","Polygon","_store","selectedTypeIndex","activeDrawType","onTypeChange","onDrawTypeChange","eventQueryType","selectedQueryType","zoneChange","K0","_queryType","_zone","zoneWithBuffer","bufferFormControl","formValueChanges$$","bufferValueChanges$$","measureUnit","bufferChange","spatialFilterService","selectedZone","queryType","zoneWithBufferChange","onZoneChange","onMeasureUnitChange","measureUnitChange","entityChange","Aa","Thematics","Yf","Eo","geometryTypes","drawGuide$","drawStyle$","radiusFormControl","PointStyle","olStyle","PolyStyle","overlayStyle$","_thematicLength","childrens","thematics","value$","value$$","drawZone","drawZoneEvent","radiusChanges$$","bufferChanges$$","bufferEvent","_o","detach","onItemTypeChange","selectedItemType","itemTypeChange","isPolygon","isPoint","isPredefined","hasChild","treeControl","isExpanded","collapse","selectedThematics","hasChildrenSelected","thematicChange","childrensToggle","onToggleChange","onDrawControlChange","onfreehandControlChange","freehandControl","toggleSearchButton","radiusEvent","toggleSearch","thematicLength","openWorkspace","createTableTemplate","clearButton","clearButtonEvent","tableTemplate","clearDrawZone","clearSearch","clearSearchEvent","disableSearchButton","zone","disabledClearSearch","toggleVisibleList","listIsVisible","La","_beginValue","_endValue","sliderInterval","_defaultMax","displayFormat","_defaultDisplayFormat","_defaultSliderModeEnabled","beginValue","parseFilter","handleMin","endValue","handleMax","onlyYearBegin","getUTCFullYear","onlyYearEnd","calendarTypeYear","isCalendarYearMode","setFilterStateDisable","updateHoursMinutesArray","updateValues","endOf","getDateFromStringWithoutTime","changeTemporalProperty","getDateTime","pos","refreshFilter","calendarType","sliderMode","restrictedToStep","ogcFilterTimeService","stepMilliseconds","toISOString","handleDate","yearOnlyInputChange","yearSelected","monthSelected","calendarView","dateFilter","ae","asYears","asMonths","asWeeks","asDays","asHours","beginHourFormControl","beginMinuteFormControl","endHourFormControl","endMinuteFormControl","handleMinuteIncrement","handleHourIncrement","fullBeginHoursArray","beginHours","fullEndHoursArray","endHours","fullBeginMinutesArray","beginMinutes","fullEndMinutesArray","endMinutes","restrictToStep","_defaultMin","changePropertyByPass","modeChange","filterStateDisable","toLocaleDateString","Tt","Ex","sliderDisplayWith","_defaultSliderInterval","calculateStep","handleSliderInput","beginMillisecond","slider","calculatedStep","_increment","_emitInputEvent","startOf","maxMillisecond","To","Q","_t","gt","yn","uu","setPrototypeOf","Ia","prototype","ee","no","eo","Za","ogreUrl","aggregateInComment","export","generateFeature","exportAsync","GPX","generateAggregatedFeature","nothingToExport","ogreFormats","noOgreFallbacks","exportToFile","exportWithOgre","setAttribute","sl","writeFeatures","featureType","UTF8","acceptCharset","enctype","LATIN1","mode","submit","GML","KML","Shapefile","CSVcomma","CSVsemicolon","mimeType","Oa","getStyleList","distance","Vx","Qi","Dr","di","Pr","ka","gu","clientSideFileSizeMax","import","importAsync","getFileImporter","du","allowedMimeTypes","allowedZipMimeTypes","allowedExtensions","importFile","importFileWithOgre","Wx","parseFeaturesFromFile","readAsText","FormData","append","parseFeaturesFromGeoJSON","msg","startWith","Xx","Ns","Nl","Us","writeFeatureObject","$r","styleList","mu","loadConfig","computeProjections","_projectionsLimitations","importForm","inputProj","exportableLayers$","fileSizeMb","exportOptions$$","exportOptions$","computeFormats","formLayer$$","popupChecked","handlePopup","handlePreviousLayerSpecs","formats$","loading$","previousLayerSpecs$","formats$$","encodings$$","encodings$","encoding","exportableLayers$$","controlFormat","selectFirstProj","projections$","translateKey","projectionsConstraints","mtmZone","utmZone","projFromConfig","nad83","wgs84","webMercator","utm","mtm","minZone","maxZone","projectionsLimitations","getWorkspaceByLayerId","getLayerTitleById","layerHasSelectedFeatures","onlySelected","layersWithSelection","onlySelectedClick","inLayersIdToExportSelectionOnly","exportOptionsChange","importFiles","espgCodeRegex","importService","onFileImportSuccess","onFileImportError","closed","onPopupBlockedError","popupAllowed","handleExportFormSubmit","combineLayers","featureInMapExtent","separator","createTitleEmptyRows","exportService","onFileExportError","onFileExportSuccess","unset","olPoint","forceNaming","kr","styleListService","jx","Gx","Qx","zx","Hx","extraMessage","loadEncodings","encodingDefaultValue","onlyUrl","onlyVector","vectorAndUrl","customList","allowedFormats","formats","validateListFormat","GeoJSON","modeChanged","selectMode","onImportExportChange","selectedMode","hu","_u","fu","xC","Er","nt","wC","toggleAutoUnit","_auto","measureType","measure$$","computeBestMeasureUnit","yu","vu","Jn","Da","features$","TC","olFormatGeoJSON","features$$","overlayService","handleFeatures","qr","MC","print","paperFormat","orientation","Hf","internal","getTitleSize","addTitle","subtitle","getSubTitleSize","addSubTitle","showProjection","showScale","addProjScale","comment","addComment","addMap","addScale","handleMeasureLayer","legendPosition","addLegendSamePage","addLegend","saveDoc","getOverlayContainer","vn","backgroundColor","addCanvas","getLayersLegendHtml","getDataImage","rxMap","getLayersLegendImage","useCORS","generateCanvaFileToZip","saveCanvasImageAsFile","setFont","getTextWidth","getStringUnitWidth","scaleFactor","ea","addPage","toDataURL","addImage","getOverlayContainerStopEvent","allowTaint","defineNbFileToProcess","nbFileToProcess","getImageSizeToFitPdf","rect","getViewport","renderMap","downloadMapImage","getContext","measureText","ceil","fillStyle","fillRect","fillText","drawImage","getWorldFileInformation","addFileToZip","Ys","saveFileProcessing","renderSync","updateSize","save","returnPromise","getHeight","msSaveBlob","msToBlob","toBlob","zipFile","Wf","file","getZipFile","generateAsync","bu","xu","Cu","Su","wu","Tu","kC","imageFormat","doZipFile","isPrintService","imageFormatField","Jpeg","onlySelf","outputFormatField","Pdf","paperFormatField","Letter","orientationField","landscape","resolutionField","legendPositionField","none","titleField","subtitleField","commentField","showProjectionField","showScaleField","showLegendField","doZipFileField","handleFormSubmit","toggleImageSaveProp","Mu","_outputFormat","_paperFormat","_orientation","_imageFormat","_legendPosition","_resolution","printService","Pa","Un","DC","Ea","Rr","Br","gi","Coord","Mo","Stop","Ao","Start","Intermediate","End","relativePosition","Jr","qa","aggregatedDirection","translatedModifier","translatedDirection","coma","exit","cntSuffix","instruction","cssClass","eS","unlistenMapSingleClick","onStopEnter","stopWithHover","onStopLeave","getOptionText","chooseProposal","stopsStore","setStopText","clearStop","validateTerm","keyIsValid","invalidKeys","getNgClass","getPlaceholder","removeStop","drop","moveStops","previousIndex","currentIndex","bn","onInputFocus","stopInputHasFocus","listenMapSingleClick","stopsFeatureStore","Ct","olProj","coordRoundedDecimals","onMapClickEventKeys","tS","directionsSourceService","routeSource","reverseSearch","Iu","getSources","getEnabledSources","enableSourcesByType","Yi","termIsValid","pc","getEnabledOnly","searchSourceService","searchType","Nn","Ja","Fu","reverseSearchSources","sS","routesFeatureStore","resetStops","clearStops","addStop","Ra","copyLinkToClipboard","zoomRoute","zoomToActiveRoute$","copyDirectionsToClipboard","directionsToText","activeRoute","Ur","Au","formatStep","Lu","maneuver","modifier","bearing_after","contextUri","pathname","dS","directions","activeDirection","changeRoute","formatDistance","formatDuration","onStepsListBlur","stepFeatureStore","showSegment","showRouteSegmentGeometry","olGeom","Vertex","Zu","initEntityStores","Ba","initOlInteraction","storeEmpty$$","storeChange$$","routesQueries$$","zoomRoute$$","freezeStores","selectStopInteraction","translateStop","selectedRoute","monitorEmptyEntityStore","monitorEntityStoreChange","monitorActiveRouteZoom","isTranslating","executeStopTranslation","focusOnStop","onStopInputHasFocusChange","getLength","storeInitialized$","debounce","handleStopDiff","handleStopsFeature","getRoutes","cancelSearch","searchs$$","previousStops","searchService","searchProposals","Text","results","addStopOverlay","directionsService","overview","alternatives","continue_straight","stopText","stopColor","stopOpacity","stop","Ua","$C","$a","Nr","formatResult","encodeKey","encodeValue","decodeKey","decodeValue","Ou","title$","getAllowedTypes","ecmax","computeRequestParams","page","extractResults","hashtagsLieuxToKeep","computeOptionsParam","computeTerm","encoder","hS","formatter","dataToResult","computeProperties","dataType","titleHtml","highlight","title2","title3","score","Gi","nextPage","propertiesBlacklist","GoogleMaps","Yt","getGoogleMapsNameLink","municipalite","GoogleStreetView","getGoogleStreetViewLink","ku","getSubtitle","computeExtent","pointerSummaryTitle","Du","Pu","coord","igo2CoordFormat","writeGeometry","OpenStreetMap","uy","jr","$u","computeSearchRequestParams","computeLayerOptions","groupTitle","extractQueryParamsFromSourceUrl","urls","Eu","ZS","setSearchType","searchType$","searchType$$","onSetSearchType","onSearchTypeChange","getSearchTypeTitle","searchTypeChange","Na","NS","now","pointerSummaryEnabled","pointerSummaryStatus","hasPointerReverseSearchSource","hasReverseSearchSourcesForPointerSummary","getSearchSources","computeSourcesCheckAllBehavior","settingsValueCheckedCheckbox","searchSourceChange","computeSettingCheckAllBehavior","allEnabled","searchSourcesAllEnabled","checkUncheckAll","checkUncheckAllSources","settingsValueCheckedRadioButton","onCheckSearchSource","getAvailableValues","getAvailableHashtagsValues","changePointerReverseSearch","changeSearchResultsGeometry","searchResultsGeometryEnabled","searchResultsGeometryStatus","ja","Qa","setTerm","stream$$","stream$","gn","onSetTerm","handlePlaceholder","onKeyup","onClearButtonClick","clearFeature","onSearchSettingsChange","doSearch","searchSettingsChange","minLength","input","searchTermChange","placeholder$","researches$$","termSplitter","onResearchCompleted","research","qu","nw","titleHtmlProperty","onZoomHandler","resultFocus","resultUnfocus","jn","Grouped","Bu","_term","pageIterator","_results$","liftResults","settingsChange$$","settingsChange$","computeGroupTitle","onResultSelect","resultSelect","groupResults","sortByOrder","displayOrder","Ot","moreResults","Ju","layersSubcriptions","Uu","fw","_w","ngAfterContentChecked","unsubscribeReverseSearch","pointerSearchStore","computeSummaryClosestFeature","addPointerOverlay","reverseSearch$$","igoSearchPointerSummaryEnabled","onSearchCoordinate","igoSearchPointerSummaryDelay","onSearch","searchPointerSummaryFeatureId","pointerSummary","Qr","gS","fS","CS","MS","xw","Ga","Nu","Os","getLayerWksOptionTabQuery","queryOptions","tabQuery","getLayerWksOptionMapQuery","mapQueryOnOpenTab","getInResolutionRange","ju","createWorkspace","srcId","workspaceId","Ya","createFeatureStore","Cr","qi","xr","Bo","zoomAuto","createFilterInMapExtentOrResolutionStrategy","relations","ws$","class_icon","Qu","circle","ww","cancelAction","confirmedAction","newFeature","edit","deleteFeature","deleteUrl","primary","editionWorkspaceService","editFeature","getDomainValues","relation","original_properties","original_geometry","idkey","editFeaturefilterClauseFunc","geomType","adding$","newFeaturefilterClauseFunc","addWithDraw","createModifyInteraction","Xf","modifyStyle","Yu","Gu","wksConfig","editMode","modifyButton","deleteButton","saveFeature","cancelEdit","validateFeature","sanitizeParameter","addUrl","addHeaders","modifyProtocol","modifyUrl","modifyHeaders","modifyFeature","hasGeometry","refreshMap","rowsInMapExtentCheckCondition$","relationLayers$","Gr","Hu","zu","Tw","onLayersChange","featureWorkspaceService","changeWorkspace","wmsWorkspaceService","wfsWorkspaceService","relationLayers","rowsInMapExtentCheckCondition","layerIsEditable","getOrCreateWorkspace","workspaceStore","Vu","Wu","Mw","Xu","Cw","Lw","directionsUrl","_name","getRouteParams","extractRoutesData","formatRoute","waypoints","geometries","legs","summary","sourceType","weight_name","ip","endsWith","numero","epsg","computeGeometry","NoLot","np","place_id","display_name","osm_type","lon","lat","boundingbox","computeTermTags","computeTermSettings","rp","storedQueriesOptions","storedquery_id","defaultValue","splitPrefix","outputformat","srsname","resultTitle","multipleFieldsQuery","extractWFSData","getFormatFromOptions","sp","longField","latField","doc_type","Jw","onPointerMove","pointerCoord","Uw","Qw","Gw","zw","Hw","Ww","Xw","tT","geometryTypeField","drawGuideField","drawGuidePlaceholder","oT","nT","rT","aT","media","lT","uT","pT","gT","mT","_T","handleQueryResults","feature$","yT","bT","onCatalogSelectChange","catalogStore","catalogItemStore","xT","It","oo","ours","basePath","contextListFile","defaultContextUri","readParamsFromRoute","hasAuthService","contexts$","handleContextsChange","loadContexts","_defaultContextUri","getById","getDetails","getDefault","defaultContextId$","getContextByUri","getProfilByUser","setDefault","defaultContextId","hideContext","showContext","importedContext","permission","write","addToolAssociation","toolId","deleteToolAssociation","getPermissions","addPermissionAssociation","profil","typePermission","deletePermissionAssociation","getLocalContexts","getLocalContext","base","loadDefaultContext","uri","addContextToList","setContext","loadContext","context$","handleContextMessage","keepCurrentView","mapViewFromRoute","loadEditedContext","setEditedContext","editedContext$","getContextFromMap","layerOptions","global","getContextFromLayers","extraFeatures","imported","getContextLayers","findContext","toolsChanged$","public","Wa","lp","context$$","contextService","handleContextChange","minWidth","cp","removeLayersOnContextChange","contextLayers","computeLayerVisibilityFromUrl","zi","up","r2","context","favoriteClick","favorite","manageTools","managePermissions","Wr","contextsInitial","shared","_contexts","_selectedContext","_defaultContextId","contexts","filterContextsList","createContext","sortedAlpha","sortContextsList","showFilter","showContextFilter","thresholdToFilter","toggleSort","clearFilter","empty","getPermission","permissions","userSelection","indeterminate","childs","filterPermissionsChanged","showHidden","Xa","onEdit","onSave","onFavorite","onManageTools","onManagePermissions","onDelete","confirmDialogService","onClone","onCreate","showHiddenContexts","onShowContext","onHideContext","contexts$$","defaultContextId$$","selectedContext$$","selectedContext","users","gp","mp","Ka","Hi","po","Vi","setImportExportType","importExportType$","setMode","selectedMode$","setsExportOptions","Zt","toolToActivateFromOptions","tool","importExportState","openSidenav$","igoStorageService","AM","storageState","storageChange$$","loadActions","buildActions","zoomAuto$","Wi","za","Ha","toolState","maximize$","LM","ogcFilterWidget","FM","Xr","initWorkspaces","workspace$","Dl","wfsActionsService","selectOnlyCheckCondition$","featureActionsService","editionActionsService","actionMaximize$$","setWorkspaceIsMaximized","activeWorkspace$$","activeWorkspaceWidget$$","activeWorkspaceWidget$","rowsInMapExtentCheckCondition$$","selectOnlyCheckCondition$$","workspaceMaximize$","setActiveWorkspaceById","setActiveWorkspaceByTitle","teardownWorkspaces","searchOverlayStyle","searchOverlayStyleSelection","searchOverlayStyleFocus","searchResultsGeometryEnabled$","createCustomFilterTermStrategy","activateCustomFilterTermStrategy","deactivateCustomFilterTermStrategy","enableSearch","searchDisabled$","disableSearch","setSearchTerm","searchTerm$","setSearchSettingsChange","searchSettingsChange$","setSelectedResult","selectedResult$","setSearchResultsGeometryStatus","$A","UA","Cp","sL","osmLayer","searchState","onPointerSummaryStatusChange","onSearchTermChange","searchStore","selectedFeature","onResultFocus","tryAddFeatureToMap","onOpenGoogleMaps","onOpenGoogleStreetView","removeFeatureFromMap","onContextMenuOpen","mapPosition","getCoordinateFromPixel","lonlat","mapBrowser","getBoundingClientRect","scrollY","scrollX","onPointerSearch","aL","wS","Zw","yS","LS","kw","bS","Pw","Ew","cL","uL","dL","gL","hL","Ku","ep","op","tp","fL","Fw","yL","vL","xL","CL","TL","getOutputType","getOutputQueryType","spatialListStore","getOutputToggleSearch","loadThematics","getOutputClearSearch","tryAddFeaturesToMap","itemType","tryAddPointToMap","tryAddLayerToMap","zoomToFeatureExtent","_internal","selectedFeature$","ML","DL","workspaceState","selectedWorkspace$","workspacePaginator","PL","qL","RL","BL","redirectTo","pathMatch","JL","useHash","UL","mobileQuery","matchMedia","_mobileQueryListener","addEventListener","themeClass","detectOldBrowser","removeEventListener","NL","bootstrap","jL","No","jo","nl","bootstrapModule"],"sources":["webpack:///$_lazy_route_resources|lazy|groupOptions:%20%7B%7D|namespace%20object","webpack:///dist/core/locale|sync|/^/.*/.json$","webpack:///packages/utils/src/lib/base64.ts","webpack:///packages/utils/src/lib/user-agent.ts","webpack:///packages/utils/src/lib/clipboard.ts","webpack:///packages/utils/src/lib/string-utils.ts","webpack:///packages/utils/src/lib/change.interface.ts","webpack:///packages/utils/src/lib/change.ts","webpack:///packages/utils/src/lib/object-utils.ts","webpack:///packages/utils/src/lib/number-utils.ts","webpack:///packages/utils/src/lib/strenum.ts","webpack:///packages/utils/src/lib/uuid.ts","webpack:///packages/utils/src/lib/watcher.ts","webpack:///packages/core/src/lib/activity/activity.service.ts","webpack:///packages/core/src/lib/activity/activity.interceptor.ts","webpack:///packages/core/src/lib/activity/activity.module.ts","webpack:///packages/core/src/lib/config/version.ts","webpack:///packages/core/src/lib/config/config.service.ts","webpack:///packages/core/src/lib/config/config.provider.ts","webpack:///packages/core/src/lib/config/config.module.ts","webpack:///packages/core/src/lib/language/shared/language.loader.ts","webpack:///packages/core/src/lib/language/shared/language.provider.ts","webpack:///packages/core/src/lib/language/shared/missing-translation.guard.ts","webpack:///packages/core/src/lib/language/language.module.ts","webpack:///packages/core/src/lib/message/message.module.ts","webpack:///packages/core/src/lib/language/shared/language.service.ts","webpack:///packages/core/src/lib/message/shared/message.enum.ts","webpack:///packages/core/src/lib/message/shared/message.service.ts","webpack:///packages/core/src/lib/request/error.interceptor.ts","webpack:///packages/core/src/lib/request/error.module.ts","webpack:///packages/core/src/lib/core.module.ts","webpack:///packages/core/src/lib/route/route.service.ts","webpack:///packages/core/src/lib/media/media.enum.ts","webpack:///packages/core/src/lib/media/media.service.ts","webpack:///packages/core/src/lib/storage/storage.interface.ts","webpack:///packages/core/src/lib/storage/storage.service.ts","webpack:///packages/core/src/lib/compression/compression.service.ts","webpack:///packages/core/src/lib/network/network.service.ts","webpack:///packages/common/src/lib/entity/shared/entity.enums.ts","webpack:///packages/common/src/lib/entity/shared/entity.utils.ts","webpack:///packages/common/src/lib/entity/shared/state.ts","webpack:///packages/common/src/lib/entity/shared/view.ts","webpack:///packages/common/src/lib/entity/shared/store.ts","webpack:///packages/common/src/lib/entity/shared/watcher.ts","webpack:///packages/common/src/lib/entity/shared/strategies/strategy.ts","webpack:///packages/common/src/lib/entity/shared/strategies/filter-custom-function.ts","webpack:///packages/common/src/lib/entity/shared/strategies/filter-selection.ts","webpack:///packages/common/src/lib/entity/entity-selector/entity-selector.component.html","webpack:///packages/common/src/lib/entity/entity-selector/entity-selector.component.ts","webpack:///packages/common/src/lib/stop-propagation/stop-propagation.directive.ts","webpack:///packages/common/src/lib/entity/entity-table/entity-table-row.directive.ts","webpack:///packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.component.ts","webpack:///packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.component.html","webpack:///packages/common/src/lib/image/secure-image.pipe.ts","webpack:///packages/common/src/lib/custom-html/custom-html.pipe.ts","webpack:///packages/common/src/lib/entity/entity-table/entity-table.component.html","webpack:///packages/common/src/lib/entity/entity-table/entity-table.component.ts","webpack:///packages/common/src/lib/action/shared/action.enums.ts","webpack:///packages/common/src/lib/action/actionbar/actionbar-item.component.html","webpack:///packages/common/src/lib/action/actionbar/actionbar-item.component.ts","webpack:///packages/common/src/lib/action/actionbar/actionbar.component.html","webpack:///packages/common/src/lib/action/actionbar/actionbar.component.ts","webpack:///packages/common/src/lib/action/actionbar/actionbar.module.ts","webpack:///packages/common/src/lib/action/action.module.ts","webpack:///packages/common/src/lib/badge-icon/badge-icon.directive.ts","webpack:///packages/common/src/lib/badge-icon/badge-icon.module.ts","webpack:///packages/common/src/lib/clickout/clickout.directive.ts","webpack:///packages/common/src/lib/clickout/clickout.module.ts","webpack:///packages/common/src/lib/collapsible/collapse.directive.ts","webpack:///packages/common/src/lib/collapsible/collapsible.component.ts","webpack:///packages/common/src/lib/collapsible/collapsible.component.html","webpack:///packages/common/src/lib/collapsible/collapsible.module.ts","webpack:///packages/common/src/lib/confirm-dialog/confirm-dialog.component.ts","webpack:///packages/common/src/lib/confirm-dialog/confirm-dialog.component.html","webpack:///packages/common/src/lib/confirm-dialog/confirm-dialog.service.ts","webpack:///packages/common/src/lib/confirm-dialog/confirm-dialog.module.ts","webpack:///packages/common/src/lib/context-menu/context-menu.directive.ts","webpack:///packages/common/src/lib/context-menu/context-menu.module.ts","webpack:///packages/common/src/lib/custom-html/custom-html.module.ts","webpack:///packages/common/src/lib/dom/dom.service.ts","webpack:///packages/common/src/lib/dom/dom.module.ts","webpack:///packages/common/src/lib/drag-drop/drag-drop.module.ts","webpack:///packages/common/src/lib/dynamic-component/shared/dynamic-component.ts","webpack:///packages/common/src/lib/dynamic-component/shared/dynamic-component.service.ts","webpack:///packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.component.ts","webpack:///packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.component.html","webpack:///packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.module.ts","webpack:///packages/common/src/lib/dynamic-component/dynamic-component.module.ts","webpack:///packages/common/src/lib/flexible/flexible.module.ts","webpack:///packages/common/src/lib/form/form/form.component.ts","webpack:///packages/common/src/lib/form/shared/form.utils.ts","webpack:///packages/common/src/lib/form/form/form.component.html","webpack:///packages/common/src/lib/form/form/form.module.ts","webpack:///packages/common/src/lib/form/shared/form.service.ts","webpack:///packages/common/src/lib/form/shared/form-field.service.ts","webpack:///packages/common/src/lib/form/form-field/form-field.component.html","webpack:///packages/common/src/lib/form/form-field/form-field.component.ts","webpack:///packages/common/src/lib/form/form-field/form-field.module.ts","webpack:///packages/common/src/lib/form/form-group/form-group.component.html","webpack:///packages/common/src/lib/form/form-group/form-group.component.ts","webpack:///packages/common/src/lib/form/form-group/form-group.module.ts","webpack:///packages/common/src/lib/form/form.module.ts","webpack:///packages/common/src/lib/entity/entity-selector/entity-selector.module.ts","webpack:///packages/common/src/lib/stop-propagation/stop-propagation.module.ts","webpack:///packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.module.ts","webpack:///packages/common/src/lib/image/image.module.ts","webpack:///packages/common/src/lib/entity/entity-table/entity-table.module.ts","webpack:///packages/common/src/lib/entity/entity.module.ts","webpack:///packages/common/src/lib/interactive-tour/interactive-tour.loader.ts","webpack:///packages/common/src/lib/interactive-tour/interactive-tour.service.ts","webpack:///packages/common/src/lib/tool/shared/toolbox.ts","webpack:///packages/common/src/lib/tool/shared/tool.service.ts","webpack:///packages/common/src/lib/interactive-tour/interactive-tour.component.html","webpack:///packages/common/src/lib/interactive-tour/interactive-tour.component.ts","webpack:///packages/common/src/lib/interactive-tour/interactive-tour.module.ts","webpack:///packages/common/src/lib/keyvalue/keyvalue.pipe.ts","webpack:///packages/common/src/lib/keyvalue/keyvalue.module.ts","webpack:///packages/common/src/lib/list/list-item.directive.ts","webpack:///packages/common/src/lib/list/list.component.ts","webpack:///packages/common/src/lib/list/list.component.html","webpack:///packages/common/src/lib/list/list.module.ts","webpack:///packages/common/src/lib/panel/panel.component.html","webpack:///packages/common/src/lib/panel/panel.component.ts","webpack:///packages/common/src/lib/panel/panel.module.ts","webpack:///packages/common/src/lib/spinner/spinner.component.ts","webpack:///packages/common/src/lib/spinner/spinner.component.html","webpack:///packages/common/src/lib/spinner/spinner-activity.directive.ts","webpack:///packages/common/src/lib/spinner/spinner.module.ts","webpack:///packages/common/src/lib/table/table-datasource.ts","webpack:///packages/common/src/lib/table/table-action-color.enum.ts","webpack:///packages/common/src/lib/table/table.component.html","webpack:///packages/common/src/lib/table/table.component.ts","webpack:///packages/common/src/lib/table/table.module.ts","webpack:///packages/common/src/lib/action/shared/store.ts","webpack:///packages/common/src/lib/tool/shared/toolbox.enums.ts","webpack:///packages/common/src/lib/tool/toolbox/toolbox.animation.ts","webpack:///packages/common/src/lib/tool/toolbox/toolbox.component.html","webpack:///packages/common/src/lib/tool/toolbox/toolbox.component.ts","webpack:///packages/common/src/lib/tool/toolbox/toolbox.module.ts","webpack:///packages/common/src/lib/tool/tool.module.ts","webpack:///packages/common/src/lib/widget/widget-outlet/widget-outlet.component.html","webpack:///packages/common/src/lib/widget/widget-outlet/widget-outlet.component.ts","webpack:///packages/common/src/lib/widget/widget-outlet/widget-outlet.module.ts","webpack:///packages/common/src/lib/widget/shared/widget.service.ts","webpack:///packages/common/src/lib/widget/widget.module.ts","webpack:///packages/common/src/lib/workspace/workspace-selector/workspace-selector.component.ts","webpack:///packages/common/src/lib/workspace/workspace-selector/workspace-selector.component.html","webpack:///packages/common/src/lib/workspace/workspace-selector/workspace-selector.module.ts","webpack:///packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.component.html","webpack:///packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.component.ts","webpack:///packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.module.ts","webpack:///packages/common/src/lib/workspace/workspace.module.ts","webpack:///packages/common/src/lib/table/table-database.ts","webpack:///packages/common/src/lib/tool/shared/tool-component.ts","webpack:///packages/common/src/lib/workspace/shared/store.ts","webpack:///packages/common/src/lib/workspace/shared/workspace.ts","webpack:///demo/src/app/core/home/home-routing.module.ts","webpack:///demo/src/app/core/home/home.component.ts","webpack:///demo/src/app/core/home/home.component.html","webpack:///demo/src/app/core/home/home.module.ts","webpack:///demo/src/app/core/activity/activity-routing.module.ts","webpack:///demo/src/app/core/activity/activity.component.ts","webpack:///demo/src/app/core/activity/activity.component.html","webpack:///demo/src/app/core/activity/activity.module.ts","webpack:///demo/src/environments/environment.prod.ts","webpack:///demo/src/app/core/config/config-routing.module.ts","webpack:///demo/src/app/core/config/config.component.ts","webpack:///demo/src/app/core/config/config.component.html","webpack:///demo/src/app/core/config/config.module.ts","webpack:///demo/src/app/core/language/language-routing.module.ts","webpack:///demo/src/app/core/language/language.component.ts","webpack:///demo/src/app/core/language/language.component.html","webpack:///demo/src/app/core/language/language.module.ts","webpack:///demo/src/app/core/media/media-routing.module.ts","webpack:///demo/src/app/core/media/media.component.ts","webpack:///demo/src/app/core/media/media.component.html","webpack:///demo/src/app/core/media/media.module.ts","webpack:///demo/src/app/core/message/message-routing.module.ts","webpack:///demo/src/app/core/message/message.component.ts","webpack:///demo/src/app/core/message/message.component.html","webpack:///demo/src/app/core/message/message.module.ts","webpack:///demo/src/app/core/request/request-routing.module.ts","webpack:///demo/src/app/core/request/request.component.ts","webpack:///demo/src/app/core/request/request.component.html","webpack:///demo/src/app/core/request/request.module.ts","webpack:///demo/src/app/common/action/action.component.html","webpack:///demo/src/app/common/action/action-routing.module.ts","webpack:///demo/src/app/common/action/action.component.ts","webpack:///demo/src/app/common/action/action.module.ts","webpack:///demo/src/app/common/dynamic-component/dynamic-component.component.ts","webpack:///demo/src/app/common/dynamic-component/dynamic-component-routing.module.ts","webpack:///demo/src/app/common/dynamic-component/dynamic-component.component.html","webpack:///demo/src/app/common/dynamic-component/dynamic-component.module.ts","webpack:///demo/src/app/common/entity-table/entity-table-routing.module.ts","webpack:///demo/src/app/common/entity-table/entity-table.component.ts","webpack:///demo/src/app/common/entity-table/entity-table.component.html","webpack:///demo/src/app/common/entity-table/entity-table.module.ts","webpack:///demo/src/app/common/entity-selector/entity-selector.component.html","webpack:///demo/src/app/common/entity-selector/entity-selector-routing.module.ts","webpack:///demo/src/app/common/entity-selector/entity-selector.component.ts","webpack:///demo/src/app/common/entity-selector/entity-selector.module.ts","webpack:///demo/src/app/common/form/form.component.html","webpack:///demo/src/app/common/form/form-routing.module.ts","webpack:///demo/src/app/common/form/form.component.ts","webpack:///demo/src/app/common/form/form.module.ts","webpack:///demo/src/app/common/table/table-routing.module.ts","webpack:///demo/src/app/common/table/table.component.ts","webpack:///demo/src/app/common/table/table.component.html","webpack:///demo/src/app/common/table/table.module.ts","webpack:///demo/src/app/common/tool/tool.component.html","webpack:///demo/src/app/common/tool/tool.component.ts","webpack:///demo/src/app/common/tool/tool-routing.module.ts","webpack:///demo/src/app/common/tool/tool.module.ts","webpack:///demo/src/app/common/widget/widget.component.ts","webpack:///demo/src/app/common/widget/widget-routing.module.ts","webpack:///demo/src/app/common/widget/widget.component.html","webpack:///demo/src/app/common/widget/widget.module.ts","webpack:///packages/auth/src/lib/shared/token.service.ts","webpack:///packages/auth/src/lib/shared/auth.service.ts","webpack:///packages/auth/src/lib/auth-form/auth-google.component.ts","webpack:///packages/auth/src/lib/auth-form/auth-google.component.html","webpack:///packages/auth/src/lib/auth-form/auth-microsoft.component.ts","webpack:///packages/auth/src/lib/auth-form/auth-microsoft.component.html","webpack:///packages/auth/src/lib/shared/auth-msalServiceb2c.service..ts","webpack:///packages/auth/src/lib/shared/auth-msalBroadcastServiceb2c.service.ts","webpack:///packages/auth/src/lib/auth-form/auth-microsoftb2c.component.ts","webpack:///packages/auth/src/lib/auth-form/auth-microsoftb2c.component.html","webpack:///packages/auth/src/lib/auth-form/auth-facebook.component.ts","webpack:///packages/auth/src/lib/auth-form/auth-facebook.component.html","webpack:///packages/auth/src/lib/auth-form/auth-intern.component.html","webpack:///packages/auth/src/lib/auth-form/auth-intern.component.ts","webpack:///packages/auth/src/lib/auth-form/auth-form.component.html","webpack:///packages/auth/src/lib/auth-form/auth-form.component.ts","webpack:///packages/auth/src/lib/shared/auth.interceptor.ts","webpack:///packages/auth/src/lib/shared/auth-microsoft.provider.ts","webpack:///packages/auth/src/lib/shared/storage.service.ts","webpack:///packages/auth/src/lib/auth.module.ts","webpack:///demo/src/app/auth/auth-form/auth-form-routing.module.ts","webpack:///demo/src/app/auth/auth-form/auth-form.component.ts","webpack:///demo/src/app/auth/auth-form/auth-form.component.html","webpack:///demo/src/app/auth/auth-form/auth-form.module.ts","webpack:///packages/geo/src/lib/metadata/shared/metadata.service.ts","webpack:///packages/geo/src/lib/metadata/metadata-button/metadata-button.component.html","webpack:///packages/geo/src/lib/metadata/metadata-button/metadata-abstract.component.html","webpack:///packages/geo/src/lib/metadata/metadata-button/metadata-button.component.ts","webpack:///packages/geo/src/lib/metadata/metadata.module.ts","webpack:///packages/geo/src/lib/feature/shared/feature.enums.ts","webpack:///packages/geo/src/lib/layer/utils/image-watcher.ts","webpack:///packages/geo/src/lib/layer/utils/layer.utils.ts","webpack:///packages/geo/src/lib/layer/shared/layers/layer.interface.ts","webpack:///packages/geo/src/lib/utils/id-generator.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/datasource.ts","webpack:///packages/geo/src/lib/filter/shared/ogc-filter.enum.ts","webpack:///packages/geo/src/lib/filter/shared/ogc-filter.ts","webpack:///packages/geo/src/lib/query/shared/query.enums.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/wms-wfs.utils.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/wms-datasource.ts","webpack:///packages/geo/src/lib/layer/utils/layerSync-watcher.ts","webpack:///packages/geo/src/lib/layer/utils/tile-watcher.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/feature-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/cluster-datasource.ts","webpack:///packages/geo/src/lib/layer/utils/vector-watcher.ts","webpack:///packages/geo/src/lib/map/shared/map.utils.ts","webpack:///packages/geo/src/lib/layer/shared/layers/layer.ts","webpack:///packages/geo/src/lib/layer/shared/layers/vector-layer.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/osm-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/xyz-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/wfs-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/wfs.service.ts","webpack:///packages/geo/src/lib/datasource/utils/tilegrid.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/wmts-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/carto-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/arcgisrest-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/imagearcgisrest-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/tilearcgisrest-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/tiledebug-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/websocket-datasource.ts","webpack:///packages/geo/src/lib/datasource/shared/datasources/mvt-datasource.ts","webpack:///packages/geo/src/lib/datasource/utils/esri-style-generator.ts","webpack:///packages/geo/src/lib/filter/shared/time-filter.enum.ts","webpack:///packages/geo/src/lib/map/shared/map.service.ts","webpack:///packages/geo/src/lib/datasource/shared/capabilities.service.ts","webpack:///packages/geo/src/lib/map/shared/projection.service.ts","webpack:///packages/geo/src/lib/datasource/shared/datasource.service.ts","webpack:///packages/geo/src/lib/feature/shared/feature.utils.ts","webpack:///packages/geo/src/lib/feature/shared/store.ts","webpack:///packages/geo/src/lib/feature/shared/strategies/in-map-extent.ts","webpack:///packages/geo/src/lib/feature/shared/strategies/in-map-resolution.ts","webpack:///packages/geo/src/lib/feature/shared/strategies/loading.ts","webpack:///packages/geo/src/lib/feature/shared/strategies/loading-layer.ts","webpack:///packages/geo/src/lib/feature/shared/strategies/selection.ts","webpack:///packages/geo/src/lib/feature/shared/strategies.utils.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay-marker-style.utils.ts","webpack:///packages/geo/src/lib/layer/shared/style.service.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay.utils.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay.ts","webpack:///packages/geo/src/lib/map/utils/layer-watcher.ts","webpack:///packages/geo/src/lib/map/shared/map.enums.ts","webpack:///packages/geo/src/lib/map/shared/controllers/controller.ts","webpack:///packages/geo/src/lib/map/shared/controllers/view.ts","webpack:///packages/geo/src/lib/map/shared/controllers/geolocation.ts","webpack:///packages/geo/src/lib/map/shared/map.ts","webpack:///packages/geo/src/lib/map/map-browser/map-browser.component.ts","webpack:///packages/geo/src/lib/map/map-browser/map-browser.component.html","webpack:///packages/geo/src/lib/map/shared/map-pointer-position.directive.ts","webpack:///packages/geo/src/lib/layer/shared/layers/image-layer.ts","webpack:///packages/geo/src/lib/layer/shared/layers/tile-layer.ts","webpack:///packages/geo/src/lib/layer/shared/layers/vectortile-layer.ts","webpack:///packages/geo/src/lib/map/shared/hover-feature.directive.ts","webpack:///packages/geo/src/lib/map/zoom-button/zoom-button.component.ts","webpack:///packages/geo/src/lib/map/zoom-button/zoom-button.component.html","webpack:///packages/geo/src/lib/map/geolocate-button/geolocate-button.component.html","webpack:///packages/geo/src/lib/map/geolocate-button/geolocate-button.component.ts","webpack:///packages/geo/src/lib/map/home-extent-button/home-extent-button.component.ts","webpack:///packages/geo/src/lib/map/home-extent-button/home-extent-button.component.html","webpack:///packages/geo/src/lib/map/wake-lock-button/wake-lock-button.component.html","webpack:///packages/geo/src/lib/map/wake-lock-button/wake-lock-button.component.ts","webpack:///packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.html","webpack:///packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.ts","webpack:///packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.animation.ts","webpack:///packages/geo/src/lib/offline/geoDB/geoDB.service.ts","webpack:///packages/geo/src/lib/offline/shared/geo-network.service.ts","webpack:///packages/geo/src/lib/layer/shared/layer.service.ts","webpack:///packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.html","webpack:///packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.ts","webpack:///packages/geo/src/lib/map/rotation-button/rotation-button.component.html","webpack:///packages/geo/src/lib/map/rotation-button/rotation-button.component.ts","webpack:///packages/geo/src/lib/map/info-section/info-section.component.html","webpack:///packages/geo/src/lib/map/info-section/info-section.component.ts","webpack:///packages/geo/src/lib/catalog/shared/catalog.enum.ts","webpack:///packages/geo/src/lib/catalog/shared/catalog.abstract.ts","webpack:///packages/geo/src/lib/query/shared/query.service.ts","webpack:///packages/geo/src/lib/query/shared/query.utils.ts","webpack:///packages/geo/src/lib/query/shared/query.directive.ts","webpack:///packages/geo/src/lib/search/shared/sources/source.ts","webpack:///packages/geo/src/lib/query/shared/query-search-source.ts","webpack:///packages/geo/src/lib/utils/googleLinks.ts","webpack:///packages/geo/src/lib/utils/commonVectorStyle.ts","webpack:///packages/geo/src/lib/utils/osmLinks.ts","webpack:///packages/geo/src/lib/catalog/shared/catalog.service.ts","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.html","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.ts","webpack:///packages/geo/src/lib/layer/layer-legend/layer-legend.component.html","webpack:///packages/geo/src/lib/layer/layer-legend/layer-legend.component.ts","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.html","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.ts","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.html","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.ts","webpack:///packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.service.ts","webpack:///packages/geo/src/lib/layer/layer-item/layer-item.component.html","webpack:///packages/geo/src/lib/layer/layer-item/layer-item.component.ts","webpack:///packages/geo/src/lib/layer/layer-list/layer-list.enum.ts","webpack:///packages/geo/src/lib/layer/layer-list/layer-list.component.html","webpack:///packages/geo/src/lib/layer/layer-list/layer-list.component.ts","webpack:///packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.html","webpack:///packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.ts","webpack:///packages/geo/src/lib/layer/layer-list/layer-list-binding.directive.ts","webpack:///packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.html","webpack:///packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.ts","webpack:///packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.html","webpack:///packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.ts","webpack:///packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.ts","webpack:///packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.html","webpack:///packages/geo/src/lib/layer/layer.module.ts","webpack:///packages/geo/src/lib/catalog/catalog-browser/catalog-browser.module.ts","webpack:///packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.html","webpack:///packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.ts","webpack:///packages/geo/src/lib/catalog/catalog-library/catalog-library.component.html","webpack:///packages/geo/src/lib/catalog/catalog-library/catalog-library.component.ts","webpack:///packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.html","webpack:///packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.ts","webpack:///packages/geo/src/lib/catalog/catalog-library/catalog-library.module.ts","webpack:///packages/geo/src/lib/catalog/catalog.module.ts","webpack:///packages/geo/src/lib/filter/shared/filterable-datasource.pipe.ts","webpack:///packages/geo/src/lib/filter/shared/time-filter.service.ts","webpack:///packages/geo/src/lib/filter/shared/ogc-filter.service.ts","webpack:///packages/geo/src/lib/filter/shared/spatial-filter.enum.ts","webpack:///packages/geo/src/lib/filter/shared/spatial-filter.service.ts","webpack:///packages/geo/src/lib/download/shared/download.service.ts","webpack:///packages/geo/src/lib/download/download-button/download-button.component.html","webpack:///packages/geo/src/lib/download/download-button/download-button.component.ts","webpack:///packages/geo/src/lib/download/download.module.ts","webpack:///packages/geo/src/lib/feature/feature-details/feature-details.component.html","webpack:///packages/geo/src/lib/feature/feature-details/feature-details.component.ts","webpack:///packages/geo/src/lib/draw/shared/draw.enum.ts","webpack:///packages/geo/src/lib/geometry/shared/geometry.utils.ts","webpack:///packages/geo/src/lib/geometry/shared/geometry.errors.ts","webpack:///packages/geo/src/lib/geometry/shared/controls/draw.ts","webpack:///packages/geo/src/lib/draw/draw/draw-popup.component.ts","webpack:///packages/geo/src/lib/draw/draw/draw-popup.component.html","webpack:///packages/geo/src/lib/draw/draw/draw-shorcuts.component.ts","webpack:///packages/geo/src/lib/draw/draw/draw-shorcuts.component.html","webpack:///packages/geo/src/lib/measure/shared/measure.enum.ts","webpack:///packages/geo/src/lib/measure/shared/measure.utils.ts","webpack:///packages/geo/src/lib/draw/shared/draw.utils.ts","webpack:///packages/geo/src/lib/draw/shared/draw-style.service.ts","webpack:///packages/geo/src/lib/draw/shared/draw-icon.service.ts","webpack:///packages/geo/src/lib/draw/draw/draw.component.html","webpack:///packages/geo/src/lib/draw/draw/draw.component.ts","webpack:///packages/geo/src/lib/draw/draw/draw.module.ts","webpack:///packages/geo/src/lib/feature/feature-details/feature-details.module.ts","webpack:///packages/geo/src/lib/feature/feature-form/feature-form.module.ts","webpack:///packages/geo/src/lib/feature/feature.module.ts","webpack:///packages/geo/src/lib/geometry/shared/controls/modify.ts","webpack:///packages/geo/src/lib/layer/shared/layer.enums.ts","webpack:///packages/geo/src/lib/measure/measurer/measurer-dialog.component.html","webpack:///packages/geo/src/lib/measure/measurer/measurer-dialog.component.ts","webpack:///packages/geo/src/lib/measure/measurer/measurer.component.html","webpack:///packages/geo/src/lib/measure/measurer/measurer.component.ts","webpack:///packages/geo/src/lib/measure/measurer/measure-format.pipe.ts","webpack:///packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.ts","webpack:///packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.html","webpack:///packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.module.ts","webpack:///packages/geo/src/lib/geometry/geometry.module.ts","webpack:///packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.html","webpack:///packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.ts","webpack:///packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.html","webpack:///packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.ts","webpack:///packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.html","webpack:///packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.ts","webpack:///packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.html","webpack:///packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.ts","webpack:///packages/geo/src/lib/wkt/shared/wkt.service.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.html","webpack:///packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.html","webpack:///packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.html","webpack:///packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.html","webpack:///packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.html","webpack:///packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.ts","webpack:///packages/geo/src/lib/filter/shared/ogc-filter-time.service.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.html","webpack:///packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.ts","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.html","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.ts","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.html","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.ts","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.html","webpack:///packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.html","webpack:///packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.ts","webpack:///packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.html","webpack:///packages/geo/src/lib/filter/filter.module.ts","webpack:///packages/geo/src/lib/import-export/shared/export.errors.ts","webpack:///packages/geo/src/lib/import-export/shared/export.type.ts","webpack:///packages/geo/src/lib/import-export/shared/export.service.ts","webpack:///packages/utils/src/lib/file.ts","webpack:///packages/geo/src/lib/import-export/shared/import.utils.ts","webpack:///packages/geo/src/lib/import-export/shared/import.errors.ts","webpack:///packages/geo/src/lib/import-export/shared/import.service.ts","webpack:///packages/geo/src/lib/import-export/style-list/style-list.service.ts","webpack:///packages/geo/src/lib/import-export/import-export/import-export.component.html","webpack:///packages/geo/src/lib/import-export/import-export/import-export.component.ts","webpack:///packages/geo/src/lib/map/shared/projection.utils.ts","webpack:///packages/geo/src/lib/import-export/shared/export.utils.ts","webpack:///packages/geo/src/lib/import-export/style-list/style-list.provider.ts","webpack:///packages/geo/src/lib/import-export/style-list/style-list.module.ts","webpack:///packages/geo/src/lib/import-export/import-export.module.ts","webpack:///packages/geo/src/lib/map/map.module.ts","webpack:///packages/geo/src/lib/measure/measurer/measurer-item.component.html","webpack:///packages/geo/src/lib/measure/measurer/measurer-item.component.ts","webpack:///packages/geo/src/lib/measure/measurer/measurer.module.ts","webpack:///packages/geo/src/lib/measure/measure.module.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay.enum.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay.service.ts","webpack:///packages/geo/src/lib/overlay/shared/overlay.directive.ts","webpack:///packages/geo/src/lib/overlay/overlay.module.ts","webpack:///packages/geo/src/lib/print/shared/print.service.ts","webpack:///packages/geo/src/lib/layer/utils/outputLegend.ts","webpack:///packages/geo/src/lib/print/shared/print.type.ts","webpack:///packages/geo/src/lib/print/print-form/print-form.component.html","webpack:///packages/geo/src/lib/print/print-form/print-form.component.ts","webpack:///packages/geo/src/lib/print/print/print.component.ts","webpack:///packages/geo/src/lib/print/print/print.component.html","webpack:///packages/geo/src/lib/print/print.module.ts","webpack:///packages/geo/src/lib/query/shared/query-search-source.providers.ts","webpack:///packages/geo/src/lib/query/query.module.ts","webpack:///packages/geo/src/lib/directions/shared/directions-source.service.ts","webpack:///packages/geo/src/lib/directions/shared/directions.enum.ts","webpack:///packages/geo/src/lib/directions/shared/directions.utils.ts","webpack:///packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.html","webpack:///packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.ts","webpack:///packages/geo/src/lib/directions/shared/directions.service.ts","webpack:///packages/geo/src/lib/search/shared/search.utils.ts","webpack:///packages/geo/src/lib/search/shared/search-source.service.ts","webpack:///packages/geo/src/lib/search/shared/search.service.ts","webpack:///packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.html","webpack:///packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.ts","webpack:///packages/geo/src/lib/directions/directions-results/directions-results.component.html","webpack:///packages/geo/src/lib/directions/directions-results/directions-results.component.ts","webpack:///packages/geo/src/lib/directions/directions.component.ts","webpack:///packages/geo/src/lib/directions/directions.component.html","webpack:///packages/geo/src/lib/directions/directions.module.ts","webpack:///packages/geo/src/lib/search/shared/search-source-service.providers.ts","webpack:///packages/geo/src/lib/search/shared/sources/icherche.ts","webpack:///packages/geo/src/lib/search/shared/sources/icherche.providers.ts","webpack:///packages/geo/src/lib/search/shared/sources/coordinates.ts","webpack:///packages/geo/src/lib/search/shared/sources/coordinates.providers.ts","webpack:///packages/geo/src/lib/search/shared/sources/ilayer.ts","webpack:///packages/geo/src/lib/search/shared/sources/ilayer.providers.ts","webpack:///packages/geo/src/lib/search/shared/search.enums.ts","webpack:///packages/geo/src/lib/search/search-selector/search-selector.component.html","webpack:///packages/geo/src/lib/search/search-selector/search-selector.component.ts","webpack:///packages/geo/src/lib/search/search-selector/search-selector.module.ts","webpack:///packages/geo/src/lib/search/search-settings/search-settings.component.html","webpack:///packages/geo/src/lib/search/search-settings/search-settings.component.ts","webpack:///packages/geo/src/lib/search/search-settings/search-settings.module.ts","webpack:///packages/geo/src/lib/search/search-bar/search-bar.component.html","webpack:///packages/geo/src/lib/search/search-bar/search-bar.component.ts","webpack:///packages/geo/src/lib/search/search-bar/search-bar.module.ts","webpack:///packages/geo/src/lib/search/search-results/search-results-item.component.html","webpack:///packages/geo/src/lib/search/search-results/search-results-item.component.ts","webpack:///packages/geo/src/lib/search/search-results/search-results.component.html","webpack:///packages/geo/src/lib/search/search-results/search-results.component.ts","webpack:///packages/geo/src/lib/search/search-results/search-results-add-button.component.html","webpack:///packages/geo/src/lib/search/search-results/search-results-add-button.component.ts","webpack:///packages/geo/src/lib/search/search-results/search-results.module.ts","webpack:///packages/geo/src/lib/search/shared/search-pointer-summary.directive.ts","webpack:///packages/geo/src/lib/search/search.module.ts","webpack:///packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.ts","webpack:///packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.html","webpack:///packages/geo/src/lib/workspace/widgets/widgets.ts","webpack:///packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.module.ts","webpack:///packages/geo/src/lib/workspace/shared/wfs-workspace.ts","webpack:///packages/geo/src/lib/workspace/shared/wfs-workspace.service.ts","webpack:///packages/geo/src/lib/workspace/shared/wms-workspace.service.ts","webpack:///packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.ts","webpack:///packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.html","webpack:///packages/geo/src/lib/workspace/shared/edition-workspace.ts","webpack:///packages/geo/src/lib/workspace/shared/edition-workspace.service.ts","webpack:///packages/geo/src/lib/workspace/shared/feature-workspace.ts","webpack:///packages/geo/src/lib/workspace/shared/feature-workspace.service.ts","webpack:///packages/geo/src/lib/workspace/workspace-selector/workspace-selector.directive.ts","webpack:///packages/geo/src/lib/workspace/workspace-selector/workspace-selector.module.ts","webpack:///packages/geo/src/lib/workspace/workspace-updator/workspace-updator.module.ts","webpack:///packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.module.ts","webpack:///packages/geo/src/lib/workspace/workspace.module.ts","webpack:///packages/geo/src/lib/directions/shared/store.ts","webpack:///packages/geo/src/lib/directions/directions-sources/osrm-directions-source.ts","webpack:///packages/geo/src/lib/directions/directions-sources/directions-source.provider.ts","webpack:///packages/geo/src/lib/search/shared/sources/cadastre.ts","webpack:///packages/geo/src/lib/search/shared/sources/cadastre.providers.ts","webpack:///packages/geo/src/lib/search/shared/sources/nominatim.ts","webpack:///packages/geo/src/lib/search/shared/sources/nominatim.providers.ts","webpack:///packages/geo/src/lib/search/shared/sources/storedqueries.ts","webpack:///packages/geo/src/lib/search/shared/sources/storedqueries.providers.ts","webpack:///packages/geo/src/lib/workspace/shared/workspace.utils.ts","webpack:///demo/src/app/geo/simple-map/simple-map.component.html","webpack:///demo/src/app/geo/simple-map/simple-map-routing.module.ts","webpack:///demo/src/app/geo/simple-map/simple-map.component.ts","webpack:///demo/src/app/geo/simple-map/simple-map.module.ts","webpack:///demo/src/app/geo/layer/layer.component.html","webpack:///demo/src/app/geo/layer/layer-routing.module.ts","webpack:///demo/src/app/geo/layer/layer.component.ts","webpack:///demo/src/app/geo/layer/layer.module.ts","webpack:///demo/src/app/geo/legend/legend-routing.module.ts","webpack:///demo/src/app/geo/legend/legend.component.ts","webpack:///demo/src/app/geo/legend/legend.component.html","webpack:///demo/src/app/geo/legend/legend.module.ts","webpack:///demo/src/app/geo/overlay/overlay-routing.module.ts","webpack:///demo/src/app/geo/overlay/overlay.component.ts","webpack:///demo/src/app/geo/overlay/overlay.component.html","webpack:///demo/src/app/geo/overlay/overlay.module.ts","webpack:///demo/src/app/geo/geometry/geometry.component.html","webpack:///demo/src/app/geo/geometry/geometry-routing.module.ts","webpack:///demo/src/app/geo/geometry/geometry.component.ts","webpack:///demo/src/app/geo/geometry/geometry.module.ts","webpack:///demo/src/app/geo/feature/feature-routing.module.ts","webpack:///demo/src/app/geo/feature/feature.component.ts","webpack:///demo/src/app/geo/feature/feature.component.html","webpack:///demo/src/app/geo/feature/feature.module.ts","webpack:///demo/src/app/geo/hover/hover-routing.module.ts","webpack:///demo/src/app/geo/hover/hover.component.ts","webpack:///demo/src/app/geo/hover/hover.component.html","webpack:///demo/src/app/geo/hover/hover.module.ts","webpack:///demo/src/app/geo/measure/measure-routing.module.ts","webpack:///demo/src/app/geo/measure/measure.component.ts","webpack:///demo/src/app/geo/measure/measure.component.html","webpack:///demo/src/app/geo/measure/measure.module.ts","webpack:///demo/src/app/geo/draw/draw-routing.module.ts","webpack:///demo/src/app/geo/draw/draw.component.ts","webpack:///demo/src/app/geo/draw/draw.component.html","webpack:///demo/src/app/geo/draw/draw.module.ts","webpack:///demo/src/app/geo/query/query.component.html","webpack:///demo/src/app/geo/query/query-routing.module.ts","webpack:///demo/src/app/geo/query/query.component.ts","webpack:///demo/src/app/geo/query/query.module.ts","webpack:///demo/src/app/geo/catalog/catalog-routing.module.ts","webpack:///demo/src/app/geo/catalog/catalog.component.ts","webpack:///demo/src/app/geo/catalog/catalog.component.html","webpack:///demo/src/app/geo/catalog/catalog.module.ts","webpack:///packages/context/src/lib/context-import-export/shared/context-export.errors.ts","webpack:///packages/context/src/lib/context-import-export/shared/context-import.errors.ts","webpack:///packages/context/src/lib/context-manager/shared/context.enum.ts","webpack:///packages/context/src/lib/context-manager/shared/context.service.ts","webpack:///packages/context/src/lib/context-import-export/context-import-export.module.ts","webpack:///packages/context/src/lib/context-manager/shared/map-context.directive.ts","webpack:///packages/context/src/lib/context-manager/shared/layer-context.directive.ts","webpack:///packages/context/src/lib/context-import-export/shared/context-import.utils.ts","webpack:///packages/context/src/lib/context-manager/context-list/context-list.enum.ts","webpack:///packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.ts","webpack:///packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.html","webpack:///packages/context/src/lib/context-manager/context-item/context-item.component.html","webpack:///packages/context/src/lib/context-manager/context-item/context-item.component.ts","webpack:///packages/context/src/lib/context-manager/context-list/context-list.component.html","webpack:///packages/context/src/lib/context-manager/context-list/context-list.component.ts","webpack:///packages/context/src/lib/context-manager/context-list/context-list-binding.directive.ts","webpack:///packages/context/src/lib/context-map-button/poi-button/shared/poi.service.ts","webpack:///packages/context/src/lib/context-map-button/context-map-button.module.ts","webpack:///packages/context/src/lib/context-manager/context-manager.module.ts","webpack:///packages/integration/src/lib/import-export/import-export.state.ts","webpack:///packages/integration/src/lib/tool/tool.state.ts","webpack:///packages/integration/src/lib/workspace/shared/workspace.utils.ts","webpack:///packages/integration/src/lib/storage/storage.state.ts","webpack:///packages/integration/src/lib/workspace/shared/feature-actions.service.ts","webpack:///packages/integration/src/lib/workspace/shared/wfs-actions.service.ts","webpack:///packages/integration/src/lib/workspace/shared/edition-actions.service.ts","webpack:///packages/integration/src/lib/workspace/workspace.state.ts","webpack:///packages/integration/src/lib/search/search.state.ts","webpack:///packages/integration/src/lib/search/search-bar/search-bar.module.ts","webpack:///packages/integration/src/lib/search/search-results-tool/search-results-tool.module.ts","webpack:///packages/integration/src/lib/search/search.module.ts","webpack:///demo/src/app/geo/search/search.component.html","webpack:///demo/src/app/geo/search/search-routing.module.ts","webpack:///demo/src/app/geo/search/search.component.ts","webpack:///demo/src/app/geo/search/search.module.ts","webpack:///demo/src/app/geo/print/print-routing.module.ts","webpack:///demo/src/app/geo/print/print.component.ts","webpack:///demo/src/app/geo/print/print.component.html","webpack:///demo/src/app/geo/print/print.module.ts","webpack:///demo/src/app/geo/import-export/import-export-routing.module.ts","webpack:///demo/src/app/geo/import-export/import-export.component.ts","webpack:///demo/src/app/geo/import-export/import-export.component.html","webpack:///demo/src/app/geo/import-export/import-export.module.ts","webpack:///demo/src/app/geo/directions/directions-routing.module.ts","webpack:///demo/src/app/geo/directions/directions.component.ts","webpack:///demo/src/app/geo/directions/directions.component.html","webpack:///demo/src/app/geo/directions/directions.module.ts","webpack:///demo/src/app/geo/time-filter/time-filter-routing.module.ts","webpack:///demo/src/app/geo/time-filter/time-filter.component.ts","webpack:///demo/src/app/geo/time-filter/time-filter.component.html","webpack:///demo/src/app/geo/time-filter/time-filter.module.ts","webpack:///demo/src/app/geo/ogc-filter/ogc-filter-routing.module.ts","webpack:///demo/src/app/geo/ogc-filter/ogc-filter.component.ts","webpack:///demo/src/app/geo/ogc-filter/ogc-filter.component.html","webpack:///demo/src/app/geo/ogc-filter/ogc-filter.module.ts","webpack:///demo/src/app/geo/spatial-filter/spatial-filter.component.html","webpack:///demo/src/app/geo/spatial-filter/spatial-filter-routing.module.ts","webpack:///demo/src/app/geo/spatial-filter/spatial-filter.component.ts","webpack:///demo/src/app/geo/spatial-filter/spatial-filter.module.ts","webpack:///demo/src/app/geo/workspace/workspace.component.html","webpack:///demo/src/app/geo/workspace/workspace-routing.module.ts","webpack:///demo/src/app/geo/workspace/workspace.component.ts","webpack:///demo/src/app/geo/workspace/workspace.module.ts","webpack:///demo/src/app/context/context/context.component.html","webpack:///demo/src/app/context/context/context-routing.module.ts","webpack:///demo/src/app/context/context/context.component.ts","webpack:///demo/src/app/context/context/context.module.ts","webpack:///demo/src/app/app-routing.module.ts","webpack:///demo/src/app/app.component.ts","webpack:///demo/src/app/app.component.html","webpack:///demo/src/app/app.module.ts","webpack:///demo/src/main.ts","webpack:///node_modules/moment/locale|sync|/^/.*$"],"sourcesContent":["function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 98255;\nmodule.exports = webpackEmptyAsyncContext;","var map = {\n\t\"./en.auth.json\": 50257,\n\t\"./en.common.json\": 35488,\n\t\"./en.context.json\": 88952,\n\t\"./en.core.json\": 63154,\n\t\"./en.geo.json\": 10711,\n\t\"./en.integration.json\": 32766,\n\t\"./en.json\": 10503,\n\t\"./fr.auth.json\": 8555,\n\t\"./fr.common.json\": 20551,\n\t\"./fr.context.json\": 68079,\n\t\"./fr.core.json\": 5415,\n\t\"./fr.geo.json\": 27268,\n\t\"./fr.integration.json\": 63031,\n\t\"./fr.json\": 65962\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 36438;","/* eslint-disable */\n\nconst ALPHA =\n  'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\nexport class Base64 {\n  private static PADCHAR: string = '=';\n  private static ALPHA: string = ALPHA;\n\n  private static getByte(s: string, i: number): number {\n    const x = s.charCodeAt(i);\n    return x;\n  }\n\n  private static getByte64(s: string, i: number): number {\n    const idx = this.ALPHA.indexOf(s.charAt(i));\n    return idx;\n  }\n\n  public static decode(s: string): string {\n    let pads = 0,\n      i,\n      b10,\n      imax = s.length,\n      x = [];\n\n    s = String(s);\n\n    if (imax === 0) {\n      return s;\n    }\n\n    if (s.charAt(imax - 1) === this.PADCHAR) {\n      pads = 1;\n      if (s.charAt(imax - 2) === this.PADCHAR) {\n        pads = 2;\n      }\n      imax -= 4;\n    }\n\n    for (i = 0; i < imax; i += 4) {\n      b10 =\n        (this.getByte64(s, i) << 18) |\n        (this.getByte64(s, i + 1) << 12) |\n        (this.getByte64(s, i + 2) << 6) |\n        this.getByte64(s, i + 3);\n      x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255, b10 & 255));\n    }\n\n    switch (pads) {\n      case 1:\n        b10 =\n          (this.getByte64(s, i) << 18) |\n          (this.getByte64(s, i + 1) << 12) |\n          (this.getByte64(s, i + 2) << 6);\n        x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255));\n        break;\n      case 2:\n        b10 = (this.getByte64(s, i) << 18) | (this.getByte64(s, i + 1) << 12);\n        x.push(String.fromCharCode(b10 >> 16));\n        break;\n    }\n\n    return x.join('');\n  }\n\n  public static encode(s: string): string {\n    s = String(s);\n\n    let i,\n      b10,\n      x = [],\n      imax = s.length - s.length % 3;\n\n    if (s.length === 0) {\n      return s;\n    }\n\n    for (i = 0; i < imax; i += 3) {\n      b10 =\n        (this.getByte(s, i) << 16) |\n        (this.getByte(s, i + 1) << 8) |\n        this.getByte(s, i + 2);\n      x.push(this.ALPHA.charAt(b10 >> 18));\n      x.push(this.ALPHA.charAt((b10 >> 12) & 63));\n      x.push(this.ALPHA.charAt((b10 >> 6) & 63));\n      x.push(this.ALPHA.charAt(b10 & 63));\n    }\n\n    switch (s.length - imax) {\n      case 1:\n        b10 = this.getByte(s, i) << 16;\n        x.push(\n          this.ALPHA.charAt(b10 >> 18) +\n            this.ALPHA.charAt((b10 >> 12) & 63) +\n            this.PADCHAR +\n            this.PADCHAR\n        );\n        break;\n      case 2:\n        b10 = (this.getByte(s, i) << 16) | (this.getByte(s, i + 1) << 8);\n        x.push(\n          this.ALPHA.charAt(b10 >> 18) +\n            this.ALPHA.charAt((b10 >> 12) & 63) +\n            this.ALPHA.charAt((b10 >> 6) & 63) +\n            this.PADCHAR\n        );\n        break;\n    }\n\n    return x.join('');\n  }\n}\n","import * as Bowser from 'bowser';\n\nexport interface UserAgent extends Bowser.Parser.Parser {\n  compareVersion: (version: string) => boolean;\n}\n\nexport const userAgent = Bowser.getParser(\n  window.navigator.userAgent\n) as UserAgent;\n","import { userAgent } from './user-agent';\n\nexport class Clipboard {\n  static copy(element: HTMLTextAreaElement | string): boolean {\n    let successful = false;\n    if (typeof element === 'string') {\n      const textArea = Clipboard.createTextArea(element);\n      Clipboard.selectText(textArea);\n      successful = Clipboard.copyTextToClipboard();\n      Clipboard.destroyTextArea(textArea);\n    } else {\n      Clipboard.selectText(element);\n      successful = Clipboard.copyTextToClipboard();\n    }\n    return successful;\n  }\n\n  private static createTextArea(text: string): HTMLTextAreaElement {\n    const textArea = document.createElement('textArea') as HTMLTextAreaElement;\n    textArea.value = text;\n    document.body.appendChild(textArea);\n    return textArea;\n  }\n\n  private static destroyTextArea(textArea) {\n    document.body.removeChild(textArea);\n  }\n\n  private static selectText(textArea) {\n    if (userAgent.getOSName() === 'iOS') {\n      const oldContentEditable = textArea.contentEditable;\n      const oldReadOnly = textArea.readOnly;\n      const range = document.createRange();\n      const selection = window.getSelection();\n\n      textArea.contenteditable = true;\n      textArea.readonly = false;\n      range.selectNodeContents(textArea);\n      selection.removeAllRanges();\n      selection.addRange(range);\n      textArea.setSelectionRange(0, 999999);\n      textArea.contentEditable = oldContentEditable;\n      textArea.readOnly = oldReadOnly;\n    } else {\n      textArea.select();\n    }\n  }\n\n  private static copyTextToClipboard(): boolean {\n    if (!(userAgent.getOSName() === 'iOS' && userAgent.compareVersion('<10'))) {\n      return document.execCommand('copy');\n    }\n    return false;\n  }\n}\n","export class StringUtils {\n  static diff(s1: string, s2: string, p = 4): string {\n    if (!s1 && !s2) {\n      return '';\n    }\n    if (!s1) {\n      return '<span class=\"inserted\">' + s2 + '</span>';\n    }\n    if (!s2) {\n      return '<span class=\"deleted\">' + s1 + '</span>';\n    }\n    s1 = s1.toString();\n    s2 = s2.toString();\n    const changeData = StringUtils.getChanges(s1, s2, '', p);\n    const nextS = s2.slice(\n      changeData.mtc.length + changeData.ins.length + changeData.sbs.length\n    ); // remaining part of \"s\"\n    const nextThis = s1.slice(\n      changeData.mtc.length + changeData.del.length + changeData.sbs.length\n    ); // remaining part of \"this\"\n    let result = ''; // the glorious result\n    if (changeData.del.length > 0) {\n      changeData.del = '<span class=\"deleted\">' + changeData.del + '</span>';\n    }\n    if (changeData.ins.length > 0) {\n      changeData.ins = '<span class=\"inserted\">' + changeData.ins + '</span>';\n    }\n    result = changeData.mtc + changeData.del + changeData.ins + changeData.sbs;\n    result +=\n      nextThis !== '' || nextS !== ''\n        ? StringUtils.diff(nextThis, nextS, p)\n        : '';\n    return result;\n  }\n\n  private static getMatchingSubstring(s, l, m) {\n    // returns the first matching substring in-between the two strings\n    let i = 0;\n    let match = false;\n    const slen = s.length;\n    const o = { fis: slen, mtc: m, sbs: '' }; // temporary object used to construct the cd (change data) object\n\n    while (i < slen) {\n      l[i] === s[i]\n        ? match\n          ? (o.sbs += s[i]) // o.sbs holds the matching substring itsef\n          : ((match = true), (o.fis = i), (o.sbs = s[i]))\n        : match\n          ? (i = slen) // stop after the first found substring\n          : (i = i);\n      ++i;\n    }\n    return o;\n  }\n\n  private static getChanges(s1, s2, m, p) {\n    const isThisLonger = s1.length >= s1.length ? true : false;\n    let [longer, shorter] = isThisLonger ? [s1, s2] : [s2, s1]; // assignment of longer and shorter by es6 destructuring\n    let bi = 0; // base index designating the index of first mismacthing character in both strings\n\n    while (shorter[bi] === longer[bi] && bi < shorter.length) {\n      ++bi;\n    } // make bi the index of first mismatching character\n    longer = longer.split('').slice(bi); // as the longer string will be rotated it is converted into array\n    shorter = shorter.slice(bi); // shorter and longer now starts from the first mismatching character\n\n    const len = longer.length; // length of the longer string\n    let cd: any = {\n      fis: shorter.length, // the index of matching string in the shorter string\n      fil: len, // the index of matching string in the longer string\n      sbs: '', // the matching substring itself\n      mtc: m + s2.slice(0, bi)\n    }; // if exists mtc holds the matching string at the front\n    let sub: any = { sbs: '' }; // returned substring per 1 character rotation of the longer string\n\n    if (shorter !== '') {\n      for (let rc = 0; rc < len && sub.sbs.length < p; rc++) {\n        // rc -> rotate count, p -> precision factor\n        sub = StringUtils.getMatchingSubstring(\n          shorter,\n          StringUtils.rotateArray(longer, rc),\n          cd.mtc\n        ); // rotate longer string 1 char and get substring\n        sub.fil =\n          rc < len - sub.fis\n            ? sub.fis + rc // mismatch is longer than the mismatch in short\n            : sub.fis - len + rc; // mismatch is shorter than the mismatch in short\n        if (sub.sbs.length > cd.sbs.length) {\n          cd = sub; // only keep the one with the longest substring.\n        }\n      }\n    }\n    // insert the mismatching delete subsrt and insert substr to the cd object and attach the previous substring\n    [cd.del, cd.ins] = isThisLonger\n      ? [longer.slice(0, cd.fil).join(''), shorter.slice(0, cd.fis)]\n      : [shorter.slice(0, cd.fis), longer.slice(0, cd.fil).join('')];\n    return cd.del.indexOf(' ') === -1 ||\n      cd.ins.indexOf(' ') === -1 ||\n      cd.del === '' ||\n      cd.ins === '' ||\n      cd.sbs === ''\n      ? cd\n      : StringUtils.getChanges(cd.del, cd.ins, cd.mtc, p);\n  }\n\n  private static rotateArray(array, n) {\n    const len = array.length;\n    const res = new Array(array.length);\n    if (n % len === 0) {\n      return array.slice();\n    } else {\n      for (let i = 0; i < len; i++) {\n        res[i] = array[(i + (len + (n % len))) % len];\n      }\n    }\n    return res;\n  }\n}\n","export enum ChangeType {\n  ADDED = 'added',\n  DELETED = 'deleted',\n  MODIFIED = 'modified'\n}\n\nexport interface Change {\n  type: ChangeType;\n  keysChanged?: {\n    key: string;\n    newValue: any;\n    oldValue: any;\n  }[];\n}\n\nexport interface GroupingChanges {\n  added: ChangeItem[];\n  deleted: ChangeItem[];\n  modified: ChangeItem[];\n}\n\nexport interface ChangeItem {\n  change: Change;\n  value: any;\n  oldValue?: any;\n  newValue?: any;\n}\n","import { StringUtils } from './string-utils';\nimport { GroupingChanges, ChangeType } from './change.interface';\n\nexport class ChangeUtils {\n  static findChanges(\n    obj1: any[],\n    obj2: any[],\n    ignoreKeys: string[] = []\n  ): GroupingChanges {\n    const items: GroupingChanges = {\n      added: [],\n      deleted: [],\n      modified: []\n    };\n\n    if (!obj1 || !obj2) {\n      return items;\n    }\n\n    const obj1Clone: any = [...obj1];\n    const obj2Clone: any = [...obj2];\n\n    for (const fromItem of obj1Clone) {\n      const index = obj2Clone.findIndex(s => s.id === fromItem.id);\n\n      if (index === -1) {\n        items.deleted.push({\n          change: { type: ChangeType.DELETED },\n          value: fromItem\n        });\n        continue;\n      }\n\n      const toItem = obj2Clone.splice(index, 1)[0];\n      const fromItemClone = JSON.parse(JSON.stringify(fromItem));\n      const toItemClone = JSON.parse(JSON.stringify(toItem));\n\n      const keysChanged = ChangeUtils.compareObject(\n        fromItemClone,\n        toItemClone,\n        undefined,\n        ignoreKeys\n      );\n\n      if (keysChanged.length) {\n        items.modified.push({\n          change: {\n            type: ChangeType.MODIFIED,\n            keysChanged\n          },\n          value: fromItemClone,\n          oldValue: fromItem,\n          newValue: toItem\n        });\n      }\n    }\n\n    items.added = obj2Clone.map(itemAdded => {\n      return {\n        change: { type: ChangeType.ADDED },\n        value: itemAdded\n      };\n    });\n\n    return items;\n  }\n\n  private static compareObject(fromItem, toItem, baseKey?, ignoreKeys = []) {\n    const fromItemClone = JSON.parse(JSON.stringify(fromItem));\n    const toItemClone = JSON.parse(JSON.stringify(toItem));\n\n    const keys: any = new Set([\n      ...Object.keys(fromItem),\n      ...Object.keys(toItem)\n    ]);\n    let keysChanged = [];\n    keys.forEach(key => {\n      const keyString = baseKey ? `${baseKey}.${key}` : key;\n      if (ignoreKeys.indexOf(keyString) !== -1) {\n        return;\n      }\n\n      if (Array.isArray(fromItem[key])) {\n        fromItem[key] = fromItem[key].join(',<br>');\n      }\n      if (Array.isArray(toItem[key])) {\n        toItem[key] = toItem[key].join(',<br>');\n      }\n\n      if (\n        typeof fromItem[key] === 'object' &&\n        typeof toItem[key] === 'object' &&\n        fromItem[key] !== null &&\n        toItem[key] !== null\n      ) {\n        keysChanged = keysChanged.concat(\n          this.compareObject(fromItem[key], toItem[key], keyString)\n        );\n      } else {\n        if (fromItem[key] !== toItem[key]) {\n          keysChanged.push({\n            key: keyString,\n            oldValue: fromItemClone[key],\n            newValue: toItemClone[key]\n          });\n          fromItem[key] = StringUtils.diff(fromItem[key], toItem[key]);\n        }\n      }\n    });\n\n    return keysChanged;\n  }\n}\n","export class ObjectUtils {\n  static resolve(obj: object, key: string): any {\n    const keysArray = key\n      .replace(/\\[/g, '.')\n      .replace(/\\]/g, '')\n      .split('.');\n    let current = obj;\n    while (keysArray.length) {\n      if (typeof current !== 'object') {\n        return undefined;\n      }\n      current = current[keysArray.shift()];\n    }\n\n    return current;\n  }\n\n  static isObject(item: object) {\n    return (\n      item &&\n      typeof item === 'object' &&\n      !Array.isArray(item) &&\n      item !== null &&\n      !(item instanceof Date)\n    );\n  }\n\n  static mergeDeep(\n    target: object,\n    source: object,\n    ignoreUndefined = false\n  ): any {\n    const output = Object.assign({}, target);\n    if (ObjectUtils.isObject(target) && ObjectUtils.isObject(source)) {\n      Object.keys(source)\n        .filter(key => !ignoreUndefined || source[key] !== undefined)\n        .forEach(key => {\n          if (ObjectUtils.isObject(source[key])) {\n            if (!(key in target)) {\n              Object.assign(output, { [key]: source[key] });\n            } else {\n              output[key] = ObjectUtils.mergeDeep(\n                target[key],\n                source[key],\n                ignoreUndefined\n              );\n            }\n          } else {\n            Object.assign(output, { [key]: source[key] });\n          }\n        });\n    }\n    return output;\n  }\n\n  static copyDeep(src): any {\n    const target = Array.isArray(src) ? [] : {};\n    for (const prop in src) {\n      if (src.hasOwnProperty(prop)) {\n        const value = src[prop];\n        if (value && typeof value === 'object') {\n          target[prop] = this.copyDeep(value);\n        } else {\n          target[prop] = value;\n        }\n      }\n    }\n    return target;\n  }\n\n  static removeDuplicateCaseInsensitive(obj: object) {\n    const summaryCapitalizeObject = {};\n    const capitalizeObject = {};\n    const upperCaseCount = [];\n\n    for (const property in obj) {\n      if (obj.hasOwnProperty(property)) {\n        const upperCaseProperty = property.toUpperCase();\n        if (!summaryCapitalizeObject.hasOwnProperty(upperCaseProperty)) {\n          summaryCapitalizeObject[upperCaseProperty] = [\n            { [property]: obj[property] }\n          ];\n        } else {\n          summaryCapitalizeObject[upperCaseProperty].push({\n            [property]: obj[property]\n          });\n        }\n        // counting the number of uppercase lettersMna\n        upperCaseCount.push({\n          key: property,\n          count: property.replace(/[^A-Z]/g, '').length\n        });\n      }\n    }\n    for (const capitalizedProperty in summaryCapitalizeObject) {\n      if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\n        if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\n          const capitalizedPropertyObject =\n            summaryCapitalizeObject[capitalizedProperty];\n          if (capitalizedPropertyObject.length === 1) {\n            // for single params (no duplicates)\n            const singlePossibility = capitalizedPropertyObject[0];\n            capitalizeObject[capitalizedProperty] =\n              singlePossibility[Object.keys(singlePossibility)[0]];\n          } else if (capitalizedPropertyObject.length > 1) {\n            // defining the closest to lowercase property\n            const paramClosestToLowercase = upperCaseCount\n              .filter(\n                f => f.key.toLowerCase() === capitalizedProperty.toLowerCase()\n              )\n              .reduce((prev, current) => {\n                return prev.y < current.y ? prev : current;\n              });\n            capitalizeObject[paramClosestToLowercase.key.toUpperCase()] =\n              obj[paramClosestToLowercase.key];\n          }\n        }\n      }\n    }\n    for (const property in obj) {\n      if (obj.hasOwnProperty(property)) {\n        delete obj[property];\n      }\n    }\n\n    for (const property in capitalizeObject) {\n      if (capitalizeObject.hasOwnProperty(property)) {\n        obj[property] = capitalizeObject[property];\n      }\n    }\n  }\n\n  static removeUndefined(obj: object): any {\n    const output = {};\n    if (ObjectUtils.isObject(obj)) {\n      Object.keys(obj)\n        .filter(key => obj[key] !== undefined)\n        .forEach(key => {\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\n            output[key] = ObjectUtils.removeUndefined(obj[key]);\n          } else {\n            output[key] = obj[key];\n          }\n        });\n\n      return output;\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map(o => ObjectUtils.removeUndefined(o));\n    }\n\n    return obj;\n  }\n\n  static removeNull(obj: object): any {\n    const output = {};\n    if (ObjectUtils.isObject(obj)) {\n      Object.keys(obj)\n        .filter(key => obj[key] !== null)\n        .forEach(key => {\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\n            output[key] = ObjectUtils.removeNull(obj[key]);\n          } else {\n            output[key] = obj[key];\n          }\n        });\n\n      return output;\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map(o => ObjectUtils.removeNull(o));\n    }\n\n    return obj;\n  }\n\n  static naturalCompare(a, b, direction = 'asc', nullsFirst?: boolean) {\n    if (direction === 'desc') {\n      b = [a, (a = b)][0];\n    }\n\n    // nullsFirst = undefined : end if direction = 'asc', first if direction = 'desc'\n    // nullsFirst = true : always first\n    // nullsFirst = false : always end\n    if (\n      a === null ||\n      a === '' ||\n      a === undefined ||\n      b === null ||\n      b === '' ||\n      b === undefined\n    ) {\n      const nullScore =\n        a === b\n          ? 0\n          : a === undefined\n          ? 3\n          : b === undefined\n          ? -3\n          : a === null\n          ? 2\n          : b === null\n          ? -2\n          : a === ''\n          ? 1\n          : -1;\n      if (direction === 'desc') {\n        return nullsFirst !== false ? nullScore : nullScore * -1;\n      }\n      return nullsFirst === true ? nullScore * -1 : nullScore;\n    }\n\n    const ax = [];\n    const bx = [];\n    a = '' + a;\n    b = '' + b;\n\n    a.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\n      ax.push([$1 || Infinity, $2 || '']);\n    });\n\n    b.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\n      bx.push([$1 || Infinity, $2 || '']);\n    });\n\n    while (ax.length && bx.length) {\n      const an = ax.shift();\n      const bn = bx.shift();\n      const nn = an[0] - bn[0] || an[1].localeCompare(bn[1]);\n      if (nn) {\n        return nn;\n      }\n    }\n\n    return ax.length - bx.length;\n  }\n\n  /**\n   * Return true if two object are equivalent.\n   * Objects are considered equivalent if they have the same properties and\n   * if all of their properties (first-level only) share the same value.\n   * @param obj1 First object\n   * @param obj2 Second object\n   * @returns Whether two objects arer equivalent\n   */\n  static objectsAreEquivalent(obj1: object, obj2: object): boolean {\n    if (obj1 === obj2) {\n      return true;\n    }\n\n    const obj1Props = Object.getOwnPropertyNames(obj1);\n    const obj2Props = Object.getOwnPropertyNames(obj2);\n    if (obj1Props.length !== obj2Props.length) {\n      return false;\n    }\n\n    for (const prop of obj1Props) {\n      if (obj1[prop] !== obj2[prop]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Return a new object with an array of keys removed\n   * @param obj Source object\n   * @param keys Keys to remove\n   * @returns A new object\n   */\n  static removeKeys(obj: object, keys: string[]): object {\n    const newObj = Object.keys(obj)\n      .filter(key => keys.indexOf(key) < 0)\n      .reduce((_obj, key) => {\n        _obj[key] = obj[key];\n        return _obj;\n      }, {});\n\n    return newObj;\n  }\n}\n","export class NumberUtils {\n    static roundToNDecimal(num: number, decimal: number = 3): number {\n        const roundFactor = Math.pow(10, decimal);\n        return Math.round((num) * roundFactor) / roundFactor;\n    }\n}\n","/** Utility function to create a K:V from a list of strings */\nexport function strEnum<T extends string>(o: Array<T>): { [K in T]: K } {\n  return o.reduce((res, key) => {\n    res[key] = key;\n    return res;\n  }, Object.create(null));\n}\n","export function S4() {\n  // eslint-disable-next-line no-bitwise\n  return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n}\n\nexport function uuid() {\n  const id = `${S4()}${S4()}-${S4()}-${S4()}-${S4()}-${S4()}${S4()}${S4()}`;\n  return id.toLowerCase();\n}\n","import { Subject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nexport enum SubjectStatus {\n  Error = 0,\n  Done = 1,\n  Working = 2,\n  Waiting = 3\n}\n\nexport abstract class Watcher {\n  public status$ = new Subject<SubjectStatus>();\n  protected status$$: Subscription;\n\n  get status(): SubjectStatus {\n    return this._status;\n  }\n  set status(value: SubjectStatus) {\n    this._status = value;\n    this.status$.next(value);\n  }\n  private _status: SubjectStatus;\n\n  protected abstract watch();\n\n  protected abstract unwatch();\n\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  subscribe(callback: Function, scope?: any) {\n    this.watch();\n\n    this.status$$ = this.status$\n      .pipe(distinctUntilChanged())\n      .subscribe((status: SubjectStatus) => {\n        this.handleStatusChange(status);\n        callback.call(scope, this);\n      });\n  }\n\n  unsubscribe() {\n    this.unwatch();\n    if (this.status$$ !== undefined) {\n      this.status$$.unsubscribe();\n      this.status$$ = undefined;\n    }\n    this.status = SubjectStatus.Waiting;\n  }\n\n  protected handleStatusChange(status: SubjectStatus) {}\n}\n","import { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { uuid } from '@igo2/utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ActivityService {\n  public counter$ = new BehaviorSubject<number>(0);\n\n  private ids: string[] = [];\n\n  constructor() {}\n\n  register(): string {\n    const id = uuid();\n    this.ids.push(id);\n    this.counter$.next(this.ids.length);\n\n    return id;\n  }\n\n  unregister(id: string) {\n    const index = this.ids.indexOf(id);\n    if (index === -1) {\n      return;\n    }\n    this.ids.splice(index, 1);\n\n    this.counter$.next(this.ids.length);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport {\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpRequest\n} from '@angular/common/http';\n\nimport { Observable } from 'rxjs';\nimport { finalize } from 'rxjs/operators';\n\nimport { ActivityService } from './activity.service';\n\n@Injectable()\nexport class ActivityInterceptor implements HttpInterceptor {\n  constructor(private activityService: ActivityService) {}\n\n  intercept(\n    req: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const activity = req.headers.get('activityInterceptor');\n    if (activity) {\n      const actReq = req.clone({\n        headers: req.headers.delete('activityInterceptor')\n      });\n      if (activity === 'false') {\n        return next.handle(actReq);\n      }\n    }\n\n    const id = this.activityService.register();\n\n    return next.handle(req).pipe(\n      finalize(() => {\n        this.activityService.unregister(id);\n      })\n    );\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\n\nimport { ActivityInterceptor } from './activity.interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoActivityModule {\n  static forRoot(): ModuleWithProviders<IgoActivityModule> {\n    return {\n      ngModule: IgoActivityModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: ActivityInterceptor,\n          multi: true\n        }\n      ]\n    };\n  }\n}\n","export interface Version {\n  lib: string;\n  releaseDate: number;\n}\n\nexport const version: Version = {\n  lib: '1.12.1',\n  releaseDate: 1657730230569\n};\n","import { Injectable, Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { ConfigOptions } from './config.interface';\nimport { version } from './version';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ConfigService {\n  private config: object = {};\n\n  constructor(private injector: Injector) {}\n\n  /**\n   * Use to get the data found in config file\n   */\n  public getConfig(key: string): any {\n    return ObjectUtils.resolve(this.config, key);\n  }\n\n  /**\n   * This method loads \"[path]\" to get all config's variables\n   */\n  public load(options: ConfigOptions) {\n    const baseConfig = options.default || {};\n    if (!options.path) {\n      this.config = baseConfig;\n      return true;\n    }\n\n    const http = this.injector.get(HttpClient);\n\n    return new Promise((resolve, _reject) => {\n      http\n        .get(options.path)\n        .pipe(\n          catchError((error: any): any => {\n            console.log(`Configuration file ${options.path} could not be read`);\n            resolve(true);\n            return throwError(error.error || 'Server error');\n          })\n        )\n        .subscribe((configResponse: object) => {\n          this.config = ObjectUtils.mergeDeep(\n            ObjectUtils.mergeDeep({ version }, baseConfig),\n            configResponse\n          );\n          resolve(true);\n        });\n    });\n  }\n}\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\n\nimport { ConfigService } from './config.service';\nimport { ConfigOptions } from './config.interface';\n\nexport let CONFIG_OPTIONS = new InjectionToken<ConfigOptions>('configOptions');\n\nexport function provideConfigOptions(options: ConfigOptions) {\n  return {\n    provide: CONFIG_OPTIONS,\n    useValue: options\n  };\n}\n\nexport function configFactory(\n  configService: ConfigService,\n  options: ConfigOptions\n) {\n  return () => configService.load(options);\n}\n\nexport function provideConfigLoader() {\n  return {\n    provide: APP_INITIALIZER,\n    useFactory: configFactory,\n    multi: true,\n    deps: [ConfigService, CONFIG_OPTIONS]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { provideConfigOptions, provideConfigLoader } from './config.provider';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoConfigModule {\n  static forRoot(): ModuleWithProviders<IgoConfigModule> {\n    return {\n      ngModule: IgoConfigModule,\n      providers: [provideConfigOptions({}), provideConfigLoader()]\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { of, combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { TranslateLoader } from '@ngx-translate/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { ConfigService } from '../../config/config.service';\n\ndeclare function require(arg: string): any;\n\nexport class LanguageLoader implements TranslateLoader {\n  constructor(\n    private http: HttpClient,\n    private prefix?: string | string[],\n    private suffix: string = '.json',\n    private config?: ConfigService\n  ) {}\n\n  public getTranslation(lang: string): any {\n    const translation = require(`../locale/${lang}.json`);\n    const igoLocale$ = of(translation);\n\n    if (this.config && !this.prefix) {\n      const prefix = this.config.getConfig('language.prefix');\n      this.prefix = !prefix || Array.isArray(prefix) ? prefix : [prefix];\n    }\n\n    if (!this.prefix || this.prefix.length === 0) {\n      return igoLocale$;\n    }\n\n    const appLocale$ = (this.prefix as string[]).map((prefix) =>\n      this.http.get(`${prefix}${lang}${this.suffix}`)\n    );\n\n    const locale$ = combineLatest([igoLocale$, ...appLocale$]);\n\n    return locale$.pipe(\n      map((translations) => {\n        return translations.reduce(\n          (acc, current) => ObjectUtils.mergeDeep(acc, current),\n          {}\n        );\n      })\n    );\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { TranslateLoader } from '@ngx-translate/core';\n\nimport { ConfigService } from '../../config/config.service';\nimport { LanguageLoader } from './language.loader';\n\nexport function defaultLanguageLoader(\n  http: HttpClient,\n  config?: ConfigService\n) {\n  return new LanguageLoader(http, undefined, undefined, config);\n}\n\nexport function provideLanguageLoader(loader?) {\n  return {\n    provide: TranslateLoader,\n    useFactory: loader || defaultLanguageLoader,\n    deps: [HttpClient]\n  };\n}\n\nexport function provideDefaultLanguageLoader(loader?) {\n  return {\n    provide: TranslateLoader,\n    useFactory: loader || defaultLanguageLoader,\n    deps: [HttpClient, ConfigService]\n  };\n}\n","import {\n  MissingTranslationHandler,\n  MissingTranslationHandlerParams\n} from '@ngx-translate/core';\n\nexport class IgoMissingTranslationHandler implements MissingTranslationHandler {\n  handle(params: MissingTranslationHandlerParams) {\n    if (!params.translateService.langs.length) {\n      const error =\n        'Translations are not yet loaded. \\\n         Check that the LanguageService is injected.';\n      throw new Error(error);\n    }\n\n    if (params.key.substr(0, 4) === 'igo.') {\n      throw new Error(`The Key \"${params.key}\" is missing in locale file.`);\n    } else {\n      return params.key;\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport {\n  TranslateModule,\n  MissingTranslationHandler\n} from '@ngx-translate/core';\n\nimport { provideDefaultLanguageLoader } from './shared/language.provider';\nimport { IgoMissingTranslationHandler } from './shared/missing-translation.guard';\n\n@NgModule({\n  imports: [\n    TranslateModule.forRoot({\n      missingTranslationHandler: {\n        provide: MissingTranslationHandler,\n        useClass: IgoMissingTranslationHandler\n      }\n    })\n  ],\n  declarations: [],\n  exports: [TranslateModule]\n})\nexport class IgoLanguageModule {\n  static forRoot(): ModuleWithProviders<IgoLanguageModule> {\n    return {\n      ngModule: IgoLanguageModule,\n      providers: [provideDefaultLanguageLoader()]\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { GlobalConfig, ToastrModule } from 'ngx-toastr';\n\n@NgModule({\n  imports: [CommonModule,\n    ToastrModule.forRoot({\n      positionClass: 'toast-bottom-right',\n      timeOut: 10000,\n      extendedTimeOut: 10000,\n      messageClass: 'toast-message mat-typography',\n      closeButton: true,\n      progressBar: true,\n      enableHtml: true,\n      tapToDismiss: true,\n      maxOpened: 4,\n      preventDuplicates: true,\n      resetTimeoutOnDuplicate: true,\n      countDuplicates: false,\n      includeTitleDuplicates: true\n    } as GlobalConfig)],\n  declarations: [],\n  exports: []\n})\nexport class IgoMessageModule {\n  static forRoot(): ModuleWithProviders<IgoMessageModule> {\n    return {\n      ngModule: IgoMessageModule,\n      providers: []\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LanguageService {\n  private language: string = this.translate.getBrowserLang();\n\n  constructor(public translate: TranslateService) {\n    const lang = this.getLanguage();\n    this.translate.setDefaultLang(lang);\n  }\n\n  public getLanguage(): string {\n    return this.language.match(/en|fr/) ? this.language : 'en';\n  }\n\n  public setLanguage(language: string) {\n    this.language = language.match(/en|fr/) ? language : 'en';\n    this.translate.use(this.language);\n    this.translate.reloadLang(this.language);\n  }\n}\n","export enum MessageType {\n  ERROR = 'error',\n  ALERT = 'warning', // todo delete (transition to ngx-toastr)\n  WARNING = 'warning',\n  INFO = 'info',\n  SUCCESS = 'success'\n}\n","import { Injectable, Inject, Injector } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { ConfigService } from '../../config/config.service';\n\nimport { Message, MessageOptions } from './message.interface';\nimport { ActiveToast, IndividualConfig, ToastrService } from 'ngx-toastr';\nimport { MessageType } from './message.enum';\nimport { LanguageService } from '../../language/shared/language.service';\n\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MessageService {\n  public messages$ = new BehaviorSubject<Message[]>([]);\n  private options: MessageOptions;\n\n  constructor(\n    @Inject(Injector) private injector: Injector,\n    private configService: ConfigService,\n    private languageService: LanguageService\n  ) {\n    this.options = this.configService.getConfig('message') || {};\n  }\n\n  private get toastr(): ToastrService {\n    return this.injector.get(ToastrService);\n  }\n\n  showError(httpError: HttpErrorResponse) {\n    httpError.error.caught = true;\n    return this.error(httpError.error.message, httpError.error.title);\n  }\n\n  message(message: Message) {\n    this.messages$.next(this.messages$.value.concat([message]));\n\n    message.options = message.options || {} as MessageOptions;\n    const currentDate = new Date();\n\n    message.options.from = message.options.from ? message.options.from : new Date('1 jan 1900');\n    message.options.to = message.options.to ? message.options.to : new Date('1 jan 3000');\n    if (typeof message.options.from === 'string') {\n      message.options.from = new Date(Date.parse(message.options.from.replace(/-/g, ' ')));\n    }\n    if (typeof message.options.to === 'string') {\n      message.options.to = new Date(Date.parse(message.options.to.replace(/-/g, ' ')));\n    }\n    if (\n      currentDate > message.options.from && currentDate < message.options.to) {\n\n      message = this.handleTemplate(message);\n\n      if (message.text) {\n        let messageShown: ActiveToast<any>;\n        switch (message.type) {\n          case MessageType.SUCCESS:\n            messageShown = this.success(message.text, message.title, message.options);\n            break;\n          case MessageType.ERROR:\n            messageShown = this.error(message.text, message.title, message.options);\n            break;\n          case MessageType.INFO:\n            messageShown = this.info(message.text, message.title, message.options);\n            break;\n          case MessageType.ALERT:\n          case MessageType.WARNING:\n            messageShown = this.alert(message.text, message.title, message.options);\n            break;\n          default:\n            messageShown = this.info(message.text, message.title, message.options);\n            break;\n        }\n        message.options.id = messageShown.toastId;\n      }\n    }\n  }\n\n  success(text: string, title: string = 'igo.core.message.success', options: Partial<IndividualConfig> = {}): ActiveToast<any> {\n    const message = this.languageService.translate.instant(text);\n    const translatedTitle = this.languageService.translate.instant(title);\n    return this.toastr.success(message, translatedTitle, options);\n  }\n\n  error(text: string, title: string = 'igo.core.message.error', options: Partial<IndividualConfig> = {}): ActiveToast<any> {\n    const message = this.languageService.translate.instant(text);\n    const translatedTitle = this.languageService.translate.instant(title);\n    return this.toastr.error(message, translatedTitle, options);\n  }\n\n  info(text: string, title: string = 'igo.core.message.info', options: Partial<IndividualConfig> = {}): ActiveToast<any> {\n    const message = this.languageService.translate.instant(text);\n    const translatedTitle = this.languageService.translate.instant(title);\n    return this.toastr.info(message, translatedTitle, options);\n  }\n\n  alert(text: string, title: string = 'igo.core.message.alert', options: Partial<IndividualConfig> = {}): ActiveToast<any> {\n    const message = this.languageService.translate.instant(text);\n    const translatedTitle = this.languageService.translate.instant(title);\n    return this.toastr.warning(message, translatedTitle, options);\n  }\n\n  remove(id?: number) {\n    this.toastr.remove(id);\n  }\n\n  removeAllAreNotError() {\n    for (const mess of this.messages$.value) {\n      if (mess.type !== MessageType.ERROR) {\n        this.remove(mess.options.id);\n      }\n    }\n  }\n\n  private handleTemplate(message: Message): Message {\n    if (!this.options.template || message.html) {\n      return message;\n    }\n\n    let html = this.options.template;\n    html = html.replace('${text}', message.text);\n    html = html.replace('${title}', message.title);\n\n    message.html = undefined;\n    message.text = html;\n    message.title = undefined;\n    return message;\n  }\n}\n","import { Injectable, Injector } from '@angular/core';\nimport {\n  HttpInterceptor,\n  HttpHandler,\n  HttpRequest,\n  HttpEvent,\n  HttpErrorResponse\n} from '@angular/common/http';\n\nimport { Observable, throwError } from 'rxjs';\nimport { catchError, finalize } from 'rxjs/operators';\n\nimport { MessageService } from '../message/shared/message.service';\nimport { LanguageService } from '../language/shared/language.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ErrorInterceptor implements HttpInterceptor {\n  constructor(\n    private messageService: MessageService,\n    private injector: Injector\n  ) {}\n\n  intercept(\n    req: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const errorContainer = { httpError: undefined };\n    return next.handle(req).pipe(\n      catchError(error => this.handleError(error, errorContainer)),\n      finalize(() => {\n        this.handleCaughtError(errorContainer);\n        this.handleUncaughtError(errorContainer);\n      })\n    );\n  }\n\n  private handleError(\n    httpError: HttpErrorResponse,\n    errorContainer: { httpError: HttpErrorResponse }\n  ) {\n    if (httpError instanceof HttpErrorResponse) {\n      const errorObj = httpError.error === 'object' ? httpError.error : {};\n      errorObj.message = httpError.error.message || httpError.statusText;\n      errorObj.caught = false;\n\n      httpError = new HttpErrorResponse({\n        error: errorObj,\n        headers: httpError.headers,\n        status: httpError.status,\n        statusText: httpError.statusText,\n        url: httpError.url\n      });\n    }\n\n    errorContainer.httpError = httpError;\n    return throwError(httpError);\n  }\n\n  private handleCaughtError(errorContainer: { httpError: HttpErrorResponse }) {\n    const httpError = errorContainer.httpError;\n    if (httpError && httpError.error.toDisplay) {\n      httpError.error.caught = true;\n      this.messageService.error(httpError.error.message, httpError.error.title);\n    }\n  }\n\n  private handleUncaughtError(errorContainer: {\n    httpError: HttpErrorResponse;\n  }) {\n    const httpError = errorContainer.httpError;\n    if (httpError && !httpError.error.caught) {\n      const translate = this.injector.get(LanguageService).translate;\n      const message = translate.instant('igo.core.errors.uncaught.message');\n      const title = translate.instant('igo.core.errors.uncaught.title');\n      httpError.error.caught = true;\n      this.messageService.error(message, title);\n    }\n  }\n}\n","import {\n  NgModule,\n  ModuleWithProviders,\n  Optional,\n  SkipSelf\n} from '@angular/core';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\n\nimport { ErrorInterceptor } from './error.interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoErrorModule {\n  static forRoot(): ModuleWithProviders<IgoErrorModule> {\n    return {\n      ngModule: IgoErrorModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: ErrorInterceptor,\n          multi: true\n        }\n      ]\n    };\n  }\n\n  constructor(@Optional() @SkipSelf() parentModule: IgoErrorModule) {\n    if (parentModule) {\n      throw new Error(\n        'IgoErrorModule is already loaded. Import it in the AppModule only'\n      );\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { HttpClientModule } from '@angular/common/http';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { MatIconRegistry } from '@angular/material/icon';\n\nimport { IgoActivityModule } from './activity/activity.module';\nimport { IgoConfigModule } from './config/config.module';\nimport { IgoLanguageModule } from './language/language.module';\nimport { IgoMessageModule } from './message/message.module';\nimport { IgoErrorModule } from './request/error.module';\nimport { DBConfig, NgxIndexedDBModule } from 'ngx-indexed-db';\n\nconst dbConfig: DBConfig = {\n  name: 'igo2DB',\n  version: 1,\n  objectStoresMeta: [{\n    store: 'geoData',\n    storeConfig: { keyPath: 'url', autoIncrement: false },\n    storeSchema: [\n      { name: 'regionID', keypath: 'regionID', options: { unique: false }}\n    ]\n  }]\n};\n@NgModule({\n  imports: [\n    CommonModule,\n    HttpClientModule,\n    IgoActivityModule.forRoot(),\n    IgoConfigModule.forRoot(),\n    IgoErrorModule.forRoot(),\n    IgoLanguageModule.forRoot(),\n    IgoMessageModule.forRoot(),\n    NgxIndexedDBModule.forRoot(dbConfig)\n  ],\n  declarations: [],\n  exports: [\n    IgoActivityModule,\n    IgoConfigModule,\n    IgoErrorModule,\n    IgoLanguageModule,\n    IgoMessageModule\n  ]\n})\nexport class IgoCoreModule {\n  static forRoot(): ModuleWithProviders<IgoCoreModule> {\n    return {\n      ngModule: IgoCoreModule,\n      providers: []\n    };\n  }\n\n  constructor(matIconRegistry: MatIconRegistry, domSanitizer: DomSanitizer) {\n    matIconRegistry.addSvgIconSet(\n      domSanitizer.bypassSecurityTrustResourceUrl(\n        './assets/igo2/core/icons/mdi.svg'\n      )\n    );\n  }\n}\n","import { Injectable, Inject, InjectionToken, Optional } from '@angular/core';\nimport { ActivatedRoute, Params, Router } from '@angular/router';\nimport { Observable } from 'rxjs';\n\nimport { RouteServiceOptions } from './route.interface';\n\nexport let ROUTE_SERVICE_OPTIONS = new InjectionToken<RouteServiceOptions>(\n  'routeServiceOptions'\n);\n\nexport function provideRouteServiceOptions(options: RouteServiceOptions) {\n  return {\n    provide: ROUTE_SERVICE_OPTIONS,\n    useValue: options\n  };\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RouteService {\n  public options: RouteServiceOptions;\n\n  constructor(\n    private router: Router,\n    public route: ActivatedRoute,\n    @Inject(ROUTE_SERVICE_OPTIONS)\n    @Optional()\n    options: RouteServiceOptions\n  ) {\n    const defaultOptions = {\n      centerKey: 'center',\n      zoomKey: 'zoom',\n      projectionKey: 'projection',\n      contextKey: 'context',\n      searchKey: 'search',\n      visibleOnLayersKey: 'visiblelayers',\n      visibleOffLayersKey: 'invisiblelayers',\n      directionsCoordKey: 'routing',\n      directionsOptionsKey: 'routingOptions',\n      toolKey: 'tool',\n      wmsUrlKey: 'wmsUrl',\n      wmsLayersKey:  'wmsLayers',\n      wmtsUrlKey: 'wmtsUrl',\n      wmtsLayersKey:  'wmtsLayers',\n      arcgisUrlKey: 'arcgisUrl',\n      arcgisLayersKey:  'arcgisLayers',\n      iarcgisUrlKey: 'iarcgisUrl',\n      iarcgisLayersKey:  'iarcgisLayers',\n      tarcgisUrlKey: 'tarcgisUrl',\n      tarcgisLayersKey:  'tarcgisLayers',\n      vectorKey: 'vector'\n    };\n    this.options = Object.assign({}, defaultOptions, options);\n  }\n\n  get queryParams(): Observable<Params> {\n    let url = decodeURIComponent(location.search);\n    if (url.includes('er=')) {\n      url = url.replace('er', '&center');\n      const queryParams: any = url\n      .slice(1)\n      .split('&')\n      .map(p => p.split('='))\n      .reduce((obj, pair) => {\n        const [key, value] = pair.map(decodeURIComponent);\n        obj[key] = value;\n        return obj;\n      }, {});\n      this.router.navigate([], { queryParams });\n    }\n    return this.route.queryParams;\n  }\n}\n","export enum Media {\n  Mobile = 'mobile',\n  Tablet = 'tablet',\n  Desktop = 'desktop'\n}\n\nexport enum MediaOrientation {\n  Portrait = 'portrait',\n  Landscape = 'landscape'\n}\n","import { Injectable } from '@angular/core';\nimport { Breakpoints, BreakpointObserver } from '@angular/cdk/layout';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Media, MediaOrientation } from './media.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MediaService {\n  public media$ = new BehaviorSubject<Media>(undefined);\n  public orientation$ = new BehaviorSubject<MediaOrientation>(undefined);\n\n  constructor(breakpointObserver: BreakpointObserver) {\n    breakpointObserver\n      .observe([Breakpoints.HandsetLandscape])\n      .subscribe(res => {\n        if (res.matches) {\n          this.media$.next(Media.Mobile);\n          this.orientation$.next(MediaOrientation.Landscape);\n        }\n      });\n\n    breakpointObserver.observe([Breakpoints.HandsetPortrait]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Mobile);\n        this.orientation$.next(MediaOrientation.Portrait);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.TabletLandscape]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Tablet);\n        this.orientation$.next(MediaOrientation.Landscape);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.TabletPortrait]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Tablet);\n        this.orientation$.next(MediaOrientation.Portrait);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.WebLandscape]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Desktop);\n        this.orientation$.next(MediaOrientation.Landscape);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.WebPortrait]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Desktop);\n        this.orientation$.next(MediaOrientation.Portrait);\n      }\n    });\n  }\n\n  getMedia(): Media {\n    return this.media$.value;\n  }\n\n  getOrientation(): MediaOrientation {\n    return this.orientation$.value;\n  }\n\n  isTouchScreen(): boolean {\n    return 'ontouchstart' in document.documentElement ? true : false;\n  }\n\n  isMobile(): boolean {\n    const media = this.getMedia();\n    return media === 'mobile';\n  }\n\n  isDesktop(): boolean {\n    const media = this.getMedia();\n    return media === 'desktop';\n  }\n}\n","export enum StorageScope {\n  SESSION = 'Session',\n  LOCAL = 'Local'\n}\n\nexport interface StorageOptions {\n  key: string;\n}\n\nexport interface StorageServiceEvent {\n  key?: string;\n  scope: StorageScope;\n  event: StorageServiceEventEnum;\n  previousValue?: any;\n  currentValue?: any;\n}\n\nexport enum StorageServiceEventEnum {\n  ADDED = 'Added',\n  MODIFIED = 'Modified',\n  REMOVED = 'Removed',\n  CLEARED = 'Cleared'\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '../config/config.service';\nimport { StorageScope, StorageOptions, StorageServiceEvent, StorageServiceEventEnum } from './storage.interface';\nimport { BehaviorSubject } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageService {\n  protected options: StorageOptions;\n\n  public storageChange$: BehaviorSubject<StorageServiceEvent> = new BehaviorSubject(undefined);\n\n  constructor(private config: ConfigService) {\n    this.options = this.config.getConfig('storage') || { key: 'igo' };\n  }\n  /**\n   * Use to get the data found in storage file\n   */\n  get(key: string, scope?: StorageScope): string | object | boolean | number {\n    let value: any;\n\n    if (!scope || scope === StorageScope.SESSION) {\n      value = sessionStorage.getItem(`${this.options.key}.${key}`);\n    }\n\n    if (scope === StorageScope.LOCAL || (!value && !scope)) {\n      value = localStorage.getItem(`${this.options.key}.${key}`);\n    }\n\n    if (value) {\n      try {\n        value = JSON.parse(value);\n      } catch {\n        value = value;\n      }\n    }\n\n    return value;\n  }\n\n  set(\n    key: string,\n    value: string | object | boolean | number,\n    scope: StorageScope = StorageScope.LOCAL\n  ) {\n    const previousValue = this.get(key, scope);\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.setItem(\n        `${this.options.key}.${key}`,\n        JSON.stringify(value)\n      );\n    } else {\n      localStorage.setItem(`${this.options.key}.${key}`, JSON.stringify(value));\n    }\n    const currentValue = this.get(key, scope);\n\n    if (currentValue !== previousValue) {\n      this.storageChange$.next({\n        key, scope,\n        event: previousValue !== undefined ? StorageServiceEventEnum.MODIFIED : StorageServiceEventEnum.ADDED,\n        previousValue,\n        currentValue\n      });\n    }\n  }\n\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\n    const previousValue = this.get(key, scope);\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.removeItem(`${this.options.key}.${key}`);\n    } else {\n      localStorage.removeItem(`${this.options.key}.${key}`);\n    }\n    this.storageChange$.next({key, scope, event: StorageServiceEventEnum.REMOVED, previousValue });\n  }\n\n  clear(scope: StorageScope = StorageScope.LOCAL) {\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.clear();\n    } else {\n      localStorage.clear();\n    }\n    this.storageChange$.next({scope, event: StorageServiceEventEnum.CLEARED });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, Observer } from 'rxjs';\nimport { CompressedData } from './compressedData.interface';\n\nfunction getNumber(v: number, endposition: number, length: number) {\n  /* tslint:disable:no-bitwise*/\n  const mask = ((1 << length) - 1);\n  return (v >> endposition) & mask;\n  /* tslint:enable:no-bitwise*/\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CompressionService {\n  private base64Index = new Map<string, number>();\n  private indexBase64 = new Map<number, string>();\n\n  constructor() {\n    this.generateBase64Index();\n  }\n\n  private generateBase64Index() {\n    // https://fr.wikipedia.org/wiki/Base64\n    // A-Z => [0, 25]\n    for (let i = 0; i < 26; i++) {\n      this.base64Index.set(String.fromCharCode('A'.charCodeAt(0) + i), i);\n      this.indexBase64.set(i, String.fromCharCode('A'.charCodeAt(0) + i));\n    }\n    // a-z => [26, 51]\n    for (let i = 0; i < 26; i++) {\n      this.base64Index.set(String.fromCharCode('a'.charCodeAt(0) + i), i + 26);\n      this.indexBase64.set(i + 26, String.fromCharCode('a'.charCodeAt(0) + i));\n    }\n    // 0-9 => [52, 61]\n    for (let i = 0; i < 10; i++) {\n      this.base64Index.set(String.fromCharCode('0'.charCodeAt(0) + i), i + 52);\n      this.indexBase64.set(i + 52, String.fromCharCode('0'.charCodeAt(0) + i));\n    }\n    // + / => [62, 63]\n    this.base64Index.set('+', 62);\n    this.base64Index.set('/', 63);\n    this.indexBase64.set(62, '+');\n    this.indexBase64.set(63, '/');\n  }\n\n  compressBlob(blob: Blob): Observable<CompressedData> {\n    if (!blob) {\n      return;\n    }\n\n    const observable = new Observable((observer: Observer<CompressedData>) => {\n      const reader = new FileReader();\n      reader.readAsDataURL(blob);\n      reader.onload = () => {\n        const base64 = reader.result.valueOf() as string;\n        const text64 = base64.substr(base64.indexOf(',') + 1);\n        const compressed = this.compressStringBase64(text64);\n        const compressedData: CompressedData = { length: text64.length,\n                                                 type: blob.type,\n                                                 object: compressed };\n        observer.next(compressedData);\n      };\n    });\n    return observable;\n  }\n\n  decompressBlob(compressedData: CompressedData): Blob {\n    /* tslint:disable:no-bitwise*/\n    const object = compressedData.object;\n    const length = compressedData.length;\n    const decompressed: string = this.decompressStringBase64(object, length);\n    const byteCharacters = atob(decompressed);\n    const byteNumbers = new Array(byteCharacters.length);\n    for (let i = 0; i < byteCharacters.length; i++) {\n        byteNumbers[i] = byteCharacters.charCodeAt(i);\n    }\n    const byteArray = new Uint8Array(byteNumbers);\n    const blob = new Blob([byteArray], {type: compressedData.type});\n    /* tslint:enable:no-bitwise*/\n    return blob;\n  }\n\n  private compressStringBase64(s: string): string {\n    /* tslint:disable:no-bitwise*/\n    let out = '';\n    let bits = 16;\n    let chr = 0;\n    let rem = 0;\n    for (const c of s) {\n      const value = this.base64Index.get(c);\n      if (bits > 6) {\n        bits -= 6;\n        chr += value << bits;\n      } else {\n        rem = 6 - bits;\n        chr += value >> rem;\n        out += String.fromCharCode(chr);\n        chr = (value) << (16 - rem);\n        bits = 16 - rem;\n      }\n    }\n    if (s.length % 8 !== 0) {\n      out += String.fromCharCode(chr);\n    }\n    /* tslint:enable:no-bitwise*/\n    return String.fromCharCode(9731) + out;\n  }\n\n  private decompressStringBase64(c: string, length: number): string {\n     /* tslint:disable:no-bitwise*/\n    if (!c) {\n      return;\n    }\n\n    if (c.charCodeAt(0) !== 9731) {\n      return c;\n    }\n\n    let chr = 0;\n    let rem = 0;\n    let bits = 16;\n    let out = '';\n    let j = 1;\n    let value = c.charCodeAt(j);\n    for (let i = 0; i < length; i++) {\n      if (bits > 6) {\n        bits -= 6;\n        chr = getNumber(value, bits, 6);\n        out += this.indexBase64.get(chr);\n      } else {\n        rem = 6 - bits;\n        chr = getNumber(value, 0, bits) << rem;\n        value = c.charCodeAt(++j);\n        chr += getNumber(value, 16 - rem, rem);\n        out += this.indexBase64.get(chr);\n        bits = 16 - rem;\n      }\n    }\n    return out;\n    /* tslint:enable:no-bitwise*/\n  }\n}\n","import { Injectable, EventEmitter, OnDestroy, Injector } from '@angular/core';\nimport { Observable, Subscription, fromEvent } from 'rxjs';\nimport { debounceTime, startWith } from 'rxjs/operators';\n\nimport { MessageService } from '../message/shared/message.service';\nimport { LanguageService } from '../language/shared/language.service';\nimport { ConnectionState } from './network.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NetworkService implements OnDestroy {\n  private stateChangeEventEmitter = new EventEmitter<ConnectionState>();\n  private onlineSubscription: Subscription;\n  private offlineSubscription: Subscription;\n  private previousMessageId;\n\n  private state: ConnectionState = {\n    connection: window.navigator.onLine\n  };\n\n  constructor(\n    private messageService: MessageService,\n    private injector: Injector\n  ) {\n      this.checkNetworkState();\n  }\n\n  private checkNetworkState() {\n    this.onlineSubscription = fromEvent(window, 'online').subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      const translate = this.injector.get(LanguageService).translate;\n      const message = translate.instant('igo.core.network.online.message');\n      const title = translate.instant('igo.core.network.online.title');\n      const messageObj = this.messageService.info(message, title);\n      this.previousMessageId = messageObj.toastId;\n      this.state.connection = true;\n      this.emitEvent();\n    });\n\n    this.offlineSubscription = fromEvent(window, 'offline').subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      const translate = this.injector.get(LanguageService).translate;\n      const message = translate.instant('igo.core.network.offline.message');\n      const title = translate.instant('igo.core.network.offline.title');\n      const messageObj = this.messageService.info(message, title);\n      this.previousMessageId = messageObj.toastId;\n      this.state.connection = false;\n      this.emitEvent();\n    });\n  }\n\n  private emitEvent() {\n    this.stateChangeEventEmitter.emit(this.state);\n  }\n\n  ngOnDestroy(): void {\n    try {\n      this.offlineSubscription.unsubscribe();\n      this.onlineSubscription.unsubscribe();\n    } catch (e) {}\n  }\n\n  currentState(reportState = true): Observable<ConnectionState> {\n    return reportState\n      ? this.stateChangeEventEmitter.pipe(\n          debounceTime(300),\n          startWith(this.state)\n        )\n      : this.stateChangeEventEmitter.pipe(debounceTime(300));\n  }\n}\n","export enum EntityOperationType {\n  Insert = 'Insert',\n  Update = 'Update',\n  Delete = 'Delete'\n}\n\nexport enum EntityTableColumnRenderer {\n  Default = 'Default',\n  HTML = 'HTML',\n  UnsanitizedHTML = 'UnsanitizedHTML',\n  Editable = 'Editable',\n  Icon = 'Icon',\n  ButtonGroup = 'ButtonGroup'\n}\n\nexport enum EntityTableScrollBehavior {\n  Auto = 'auto',\n  Instant = 'instant',\n  Smooth = 'smooth'\n}\n\nexport enum EntityTableSelectionState {\n  None = 'None',\n  All = 'All',\n  Some = 'Some'\n}\n","import t from 'typy';\n\nimport { EntityKey } from './entity.interfaces';\n\n/**\n * Get an entity's named property. Nested properties are supported\n * with the dotted notation. (i.e 'author.name')\n *\n * Note: this method is a 'best attempt' at getting an entity's property.\n * It fits the most common cases but you might need to explicitely define\n * a property getter when using an EntityStore, for example.\n * @param entity Entity\n * @param property Property name\n * @returns Property value\n */\nexport function getEntityProperty(entity: object, property: string): any {\n  return t(entity, property).safeObject;\n}\n\n/**\n * Get an entity's id. An entity's id can be one of:\n * 'entity.meta.id', 'entity.meta.idProperty' or 'entity.id'.\n *\n * Note: See the note in the 'getEntityProperty' documentation.\n * @param entity Entity\n * @returns Entity id\n */\nexport function getEntityId(entity: object): EntityKey {\n  const meta = (entity as any).meta || {};\n  return meta.id ? meta.id : getEntityProperty(entity, meta.idProperty || 'id');\n}\n\n/**\n * Get an entity's title. An entity's title can be one of:\n * 'entity.meta.title', 'entity.meta.titleProperty' or 'entity.title'.\n * @param entity Entity\n * @returns Entity title\n */\nexport function getEntityTitle(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.title ? meta.title : getEntityProperty(entity, meta.titleProperty || 'title');\n}\n\n/**\n * Get an entity's HTML title. An entity's HTML title can be one of:\n * 'entity.meta.titleHtml', 'entity.meta.titleHtmlProperty' or 'entity.titleHtml'.\n * @param entity Entity\n * @returns Entity HTML title\n */\nexport function getEntityTitleHtml(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.titleHtml ? meta.titleHtml : getEntityProperty(entity, meta.titleHtmlProperty || 'titleHtml');\n}\n\n/**\n * Get an entity's icon. An entity's icon can be one of:\n * 'entity.meta.icon', 'entity.meta.iconProperty' or 'entity.icon'.\n * @param entity Entity\n * @returns Entity icon\n */\nexport function getEntityIcon(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.icon ? meta.icon : getEntityProperty(entity, meta.iconProperty || 'icon');\n}\n\n/**\n * Get an entity's revision.\n * @param entity Entity\n * @returns Entity revision\n */\nexport function getEntityRevision(entity: object): number {\n  const meta = (entity as any).meta || {};\n  return meta.revision || 0;\n}\n","import { ReplaySubject } from 'rxjs';\n\nimport { EntityKey, EntityState, EntityStateManagerOptions } from './entity.interfaces';\nimport { getEntityId } from './entity.utils';\nimport { EntityStore } from './store';\n\n/**\n * This class is used to track a store's entities state\n */\nexport class EntityStateManager<E extends object, S extends EntityState = EntityState> {\n\n  /**\n   * State index\n   */\n  readonly index = new Map<EntityKey, S>();\n\n  /**\n   * Change emitter\n   */\n  readonly change$ = new ReplaySubject<void>(1);\n\n  /**\n   * Method to get an entity's id\n   */\n  readonly getKey: (E) => EntityKey;\n\n  private store: EntityStore<object> | undefined;\n\n  constructor(options: EntityStateManagerOptions = {}) {\n    this.store = options.store ? options.store : undefined;\n    this.getKey = options.getKey\n      ? options.getKey\n      : (this.store ? this.store.getKey : getEntityId);\n    this.next();\n  }\n\n  /**\n   * Clear state\n   */\n  clear() {\n    if (this.index.size > 0) {\n      this.index.clear();\n      this.next();\n    }\n  }\n\n  /**\n   * Get an entity's state\n   * @param entity Entity\n   * @returns State\n   */\n  get(entity: E): S {\n    return (this.index.get(this.getKey(entity)) || {}) as S;\n  }\n\n  /**\n   * Set an entity's state\n   * @param entity Entity\n   * @param state State\n   */\n  set(entity: E, state: S) {\n    this.setMany([entity], state);\n  }\n\n  /**\n   * Set many entitie's state\n   * @param entitie Entities\n   * @param state State\n   */\n  setMany(entities: E[], state: S) {\n    entities.forEach((entity: E) => {\n      this.index.set(this.getKey(entity), Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Set state of all entities that already have a state. This is not\n   * the same as setting the state of all the store's entities.\n   * @param state State\n   */\n  setAll(state: S) {\n    Array.from(this.index.keys()).forEach((key: EntityKey) => {\n      this.index.set(key, Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Update an entity's state\n   * @param entity Entity\n   * @param changes State changes\n   */\n  update(entity: E, changes: Partial<S>, exclusive = false) {\n    this.updateMany([entity], changes, exclusive);\n  }\n\n  /**\n   * Update many entitie's state\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  updateMany(entities: E[], changes: Partial<S>, exclusive = false) {\n    if (exclusive === true) {\n      return this.updateManyExclusive(entities, changes);\n    }\n\n    entities.forEach((entity: E) => {\n      const state = Object.assign({}, this.get(entity), changes);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Reversee an entity's state\n   * @param entity Entity\n   * @param keys State keys to reverse\n   */\n  reverse(entity: E, keys: string[]) {\n    this.reverseMany([entity], keys);\n  }\n\n  /**\n   * Reverse many entitie's state\n   * @param entitie Entities\n   * @param keys State keys to reverse\n   */\n  reverseMany(entities: E[], keys: string[]) {\n    entities.forEach((entity: E) => {\n      const currentState = this.get(entity);\n      const changes = keys.reduce((acc: {[key: string]: boolean}, key: string) => {\n        acc[key] = currentState[key] || false;\n        return acc;\n      }, {}) as Partial<S>;\n      const reversedChanges = this.reverseChanges(changes);\n      const state = Object.assign({}, currentState, reversedChanges);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Update state of all entities that already have a state. This is not\n   * the same as updating the state of all the store's entities.\n   * @param changes State\n   */\n  updateAll(changes: Partial<S>) {\n    const allKeys = this.getAllKeys();\n    Array.from(allKeys).forEach((key: EntityKey) => {\n      const state = Object.assign({}, this.index.get(key), changes);\n      this.index.set(key, state);\n    });\n    this.next();\n  }\n\n  /**\n   * When some state changes are flagged as 'exclusive', reverse\n   * the state of all other entities. Changes are reversable when\n   * they are boolean.\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  private updateManyExclusive(entities: E[], changes: Partial<S>) {\n    const reverseChanges = this.reverseChanges(changes);\n\n    const keys = entities.map((entity: E) => this.getKey(entity));\n    const allKeys = new Set(keys.concat(Array.from(this.getAllKeys())));\n    allKeys.forEach((key: EntityKey) => {\n      const state = this.index.get(key) || {} as S;\n\n      if (keys.indexOf(key) >= 0) {\n        this.index.set(key, Object.assign({}, state, changes));\n      } else {\n        // Update only if the reverse changes would modify\n        // a key already present in the current state\n        const shouldUpdate = Object.keys(reverseChanges).some((changeKey: string) => {\n          return state[changeKey] !== undefined &&\n            state[changeKey] !== reverseChanges[changeKey];\n        });\n        if (shouldUpdate === true) {\n          this.index.set(key, Object.assign({}, state, reverseChanges));\n        }\n      }\n    });\n\n    this.next();\n  }\n\n  /**\n   * Compute a 'reversed' version of some state changes.\n   * Changes are reversable when they are boolean.\n   * @param changes State changes\n   * @returns Reversed state changes\n   */\n  private reverseChanges(changes: Partial<S>): Partial<S> {\n    return Object.entries(changes).reduce((reverseChanges: Partial<S>, bunch: [string, any]) => {\n      const [changeKey, value] = bunch;\n      if (typeof value === typeof true) {\n        (reverseChanges as object)[changeKey] = !value;\n      }\n      return reverseChanges;\n    }, {});\n  }\n\n  /**\n   * Return all the keys in that state and in the store it's bound to, if any.\n   * @returns Set of keys\n   */\n  private getAllKeys(): Set<EntityKey> {\n    const storeKeys = this.store ? Array.from(this.store.index.keys()) : [];\n    return new Set(Array.from(this.index.keys()).concat(storeKeys));\n  }\n\n  /**\n   * Emit 'change' event\n   */\n  private next() {\n    this.change$.next();\n  }\n\n}\n","import { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\nimport { debounceTime, map, skip } from 'rxjs/operators';\n\nimport { ObjectUtils, uuid } from '@igo2/utils';\nimport {\n  EntityKey,\n  EntityFilterClause,\n  EntitySortClause,\n  EntityJoinClause\n} from './entity.interfaces';\n\n/**\n * An entity view streams entities from an observable source. These entities\n * can be filtered or sorted without affecting the source. A view can also\n * combine data from multiple sources, joined together.\n */\nexport class EntityView<E extends object, V extends object = E> {\n\n  /**\n   * Observable stream of values\n   */\n  readonly values$ = new BehaviorSubject<V[]>([]);\n\n  /**\n   * Subscription to the source (and joined sources) values\n   */\n  private values$$: Subscription;\n\n  /**\n   * Whether this view has been lifted\n   */\n  private lifted = false;\n\n  /**\n   * Join clauses\n   */\n  private joins: EntityJoinClause[] = [];\n\n  /**\n   * Observable of a filter clause\n   */\n  private filter$ = new BehaviorSubject(undefined);\n\n  /**\n   * Observable of filter clauses\n   */\n  private filters$: BehaviorSubject<EntityFilterClause[]> = new BehaviorSubject([]);\n\n  /**\n   * Filters index\n   */\n  private filterIndex: Map<string, EntityFilterClause> = new Map();\n\n  /**\n   * Observable of a sort clause\n   */\n  private sort$ = new BehaviorSubject(undefined);\n\n  /**\n   * Method for indexing\n   */\n  get getKey(): (V) => EntityKey { return this.getKey$.value; }\n  private getKey$: BehaviorSubject<(V) => EntityKey> = new BehaviorSubject(undefined);\n\n  /**\n   * Number of entities\n   */\n  readonly count$ = new BehaviorSubject<number>(0);\n  get count(): number { return this.count$.value; }\n\n  /**\n   * Whether the store is empty\n   */\n  readonly empty$ = new BehaviorSubject<boolean>(true);\n  get empty(): boolean { return this.empty$.value; }\n\n  /**\n   * Store index\n   */\n  get index(): Map<EntityKey, V> { return this._index; }\n  private _index: Map<EntityKey, V>;\n\n  constructor(private source$: BehaviorSubject<E[]>) {}\n\n  /**\n   * Get a value from the view by key\n   * @param key Key\n   * @returns Value\n   */\n  get(key: EntityKey): V {\n    if (this._index === undefined) {\n      throw new Error('This view has no index, therefore, this method is unavailable.');\n    }\n    return this.index.get(key);\n  }\n\n  /**\n   * Get all the values\n   * @returns Array of values\n   */\n  all(): V[] {\n    return this.values$.value;\n  }\n\n  /**\n   * Observe all the values\n   * @returns Observable of values\n   */\n  all$(): BehaviorSubject<V[]> {\n    return this.values$;\n  }\n\n  /**\n   * Get the first value that respects a criteria\n   * @returns A value\n   */\n  firstBy(clause: EntityFilterClause<V>): V {\n    return this.values$.value.find(clause);\n  }\n\n  /**\n   * Observe the first value that respects a criteria\n   * @returns Observable of a value\n   */\n  firstBy$(clause: EntityFilterClause<V>): Observable<V> {\n    return this.values$.pipe(map((values: V[]) => values.find(clause)));\n  }\n\n  /**\n   * Get all the values that respect a criteria\n   * @returns Array of values\n   */\n  manyBy(clause: EntityFilterClause<V>): V[] {\n    return this.values$.value.filter(clause);\n  }\n\n  /**\n   * Observe all the values that respect a criteria\n   * @returns Observable of values\n   */\n  manyBy$(clause: EntityFilterClause<V>): Observable<V[]> {\n    return this.values$.pipe(map((values: V[]) => values.filter(clause)));\n  }\n\n  /**\n   * Clear the filter and sort and unsubscribe from the source\n   */\n  clear() {\n    this.filter(undefined);\n    this.sort(undefined);\n  }\n\n  destroy() {\n    if (this.values$$ !== undefined) {\n      this.values$$.unsubscribe();\n    }\n    this.clear();\n  }\n\n  /**\n   * Create an index\n   * @param getKey Method to get a value's id\n   * @returns The view\n   */\n  createIndex(getKey: (E) => EntityKey): EntityView<E, V> {\n    this._index = new Map();\n    this.getKey$.next(getKey);\n    return this;\n  }\n\n  /**\n   * Join another source to the stream (chainable)\n   * @param clause Join clause\n   * @returns The view\n   */\n  join(clause: EntityJoinClause): EntityView<E, V> {\n    if (this.lifted === true) {\n      throw new Error('This view has already been lifted, therefore, no join is allowed.');\n    }\n    this.joins.push(clause);\n    return this;\n  }\n\n  /**\n   * Filter values (chainable)\n   * @param clause Filter clause\n   * @returns The view\n   */\n  filter(clause: EntityFilterClause<V>): EntityView<E, V> {\n    this.filter$.next(clause);\n    return this;\n  }\n\n  /**\n   * @param clause Filter clause\n   * @returns The filter id\n   */\n  addFilter(clause: EntityFilterClause<V>): string {\n    const id = uuid();\n    this.filterIndex.set(id, clause);\n    this.filters$.next(Array.from(this.filterIndex.values()));\n    return id;\n  }\n\n  /**\n   * Remove a filter by id\n   * @param clause Filter clause\n   */\n  removeFilter(id: string) {\n    this.filterIndex.delete(id);\n    this.filters$.next(Array.from(this.filterIndex.values()));\n  }\n\n  /**\n   * Sort values (chainable)\n   * @param clauseSort clause\n   * @returns The view\n   */\n  sort(clause: EntitySortClause<V>): EntityView<E, V> {\n    this.sort$.next(clause);\n    return this;\n  }\n\n  /**\n   * Create the final observable\n   * @returns Observable\n   */\n  lift() {\n    this.lifted = true;\n    const source$ = this.joins.length > 0 ? this.liftJoinedSource() : this.liftSource();\n    const observables$ = [\n      source$,\n      this.filters$,\n      this.filter$,\n      this.sort$,\n      this.getKey$\n    ];\n\n    this.values$$ = combineLatest(observables$)\n      .pipe(skip(1), debounceTime(5))\n      .subscribe((bunch: [V[], EntityFilterClause[], EntityFilterClause, EntitySortClause, (V) => EntityKey]) => {\n        const [_values, filters, filter, sort, getKey] = bunch;\n        const values = this.processValues(_values, filters, filter, sort);\n        const generateIndex = getKey !== undefined;\n        this.setValues(values, generateIndex);\n      });\n  }\n\n  /**\n   * Create the source observable when no joins are defined\n   * @returns Observable\n   */\n  private liftSource(): Observable<V[]> {\n    return this.source$ as any as Observable<V[]>;\n  }\n\n  /**\n   * Create the source observable when joins are defined\n   * @returns Observable\n   */\n  private liftJoinedSource(): Observable<V[]> {\n    const sources$ = [this.source$, combineLatest(\n      this.joins.map((join: EntityJoinClause) => join.source)\n    )];\n\n    return combineLatest(sources$)\n      .pipe(\n        map((bunch: [E[], any[]]) => {\n          const [entities, joinData] = bunch;\n          return entities.reduce((values: V[], entity: E) => {\n            const value = this.computeJoinedValue(entity, joinData);\n            if (value !== undefined) {\n              values.push(value);\n            }\n            return values;\n          }, []);\n        })\n      );\n  }\n\n  /**\n   * Apply joins to a source's entity and return the final value\n   * @returns Final value\n   */\n  private computeJoinedValue(entity: E, joinData: any[]): V | undefined {\n    let value = entity as Partial<V>;\n    let joinIndex = 0;\n    while (value !== undefined && joinIndex < this.joins.length) {\n      value = this.joins[joinIndex].reduce(value, joinData[joinIndex]);\n      joinIndex += 1;\n    }\n    return value as V;\n  }\n\n  /**\n   * Filter and sort values before streaming them\n   * @param values Values\n   * @param filters Filter clauses\n   * @param filter Filter clause\n   * @param sort Sort clause\n   * @returns Filtered and sorted values\n   */\n  private processValues(\n    values: V[], filters: EntityFilterClause[], filter: EntityFilterClause, sort: EntitySortClause\n  ): V[] {\n    values = values.slice(0);\n    values = this.filterValues(values, filters.concat([filter]));\n    values = this.sortValues(values, sort);\n    return values;\n  }\n\n  /**\n   * Filter values\n   * @param values Values\n   * @param filters Filter clauses\n   * @returns Filtered values\n   */\n  private filterValues(values: V[], clauses: EntityFilterClause[]): V[] {\n    if (clauses.length === 0) { return values; }\n\n    return values\n      .filter((value: V) => {\n        return clauses\n          .filter((clause: EntityFilterClause) => clause !== undefined)\n          .every((clause: EntityFilterClause) => clause(value));\n      });\n  }\n\n  /**\n   * Sort values\n   * @param values Values\n   * @param sort Sort clause\n   * @returns Sorted values\n   */\n  private sortValues(values: V[], clause: EntitySortClause): V[] {\n    if (clause === undefined) { return values; }\n    return values.sort((v1: V, v2: V) => {\n      return ObjectUtils.naturalCompare(\n        clause.valueAccessor(v1),\n        clause.valueAccessor(v2),\n        clause.direction,\n        clause.nullsFirst\n      );\n    });\n  }\n\n  /**\n   * Set value and optionally generate an index\n   * @param values Values\n   * @param generateIndex boolean\n   */\n  private setValues(values: V[], generateIndex: boolean) {\n    if (generateIndex === true) {\n      this._index = this.generateIndex(values);\n    }\n\n    this.values$.next(values);\n\n    const count = values.length;\n    const empty = count === 0;\n    this.count$.next(count);\n    this.empty$.next(empty);\n  }\n\n  /**\n   * Generate a complete index of all the values\n   * @param entities Entities\n   * @returns Index\n   */\n  private generateIndex(values: V[]): Map<EntityKey, V> {\n    const entries = values.map((value: V) => [this.getKey(value), value]);\n    return new Map(entries as [EntityKey, V][]);\n  }\n}\n","import { BehaviorSubject } from 'rxjs';\n\nimport { EntityStateManager } from './state';\nimport { EntityView } from './view';\nimport { EntityKey, EntityState, EntityRecord, EntityStoreOptions } from './entity.interfaces';\nimport { getEntityId, getEntityProperty } from './entity.utils';\nimport { EntityStoreStrategy } from './strategies/strategy';\n\n/**\n * An entity store class holds any number of entities\n * as well as their state. It can be observed, filtered and sorted and\n * provides methods to insert, update or delete entities.\n */\nexport class EntityStore<E extends object = object, S extends EntityState = EntityState> {\n\n  /**\n   * Observable of the raw entities\n   */\n  readonly entities$ = new BehaviorSubject<E[]>([]);\n\n  /**\n   * Number of entities\n   */\n  readonly count$ = new BehaviorSubject<number>(0);\n  get count(): number { return this.count$.value; }\n\n  /**\n   * Whether the store is empty\n   */\n  readonly empty$ = new BehaviorSubject<boolean>(true);\n  get empty(): boolean { return this.empty$.value; }\n\n  /**\n   * Entity store state\n   */\n  readonly state: EntityStateManager<E, S>;\n\n  /**\n   * View of all the entities\n   */\n  readonly view: EntityView<E>;\n\n  /**\n   * View of all the entities and their state\n   */\n  readonly stateView: EntityView<E, EntityRecord<E, S>>;\n\n  /**\n   * Method to get an entity's id\n   */\n  readonly getKey: (E) => EntityKey;\n\n  /**\n   * Method to get an entity's named property\n   */\n  readonly getProperty: (E, prop: string) => any;\n\n  /**\n   * Store index\n   */\n  get index(): Map<EntityKey, E> { return this._index; }\n  private _index: Map<EntityKey, E>;\n\n  /**\n   * Store index\n   */\n  get pristine(): boolean { return this._pristine; }\n  private _pristine: boolean = true;\n\n  /**\n   * Strategies\n   */\n  private strategies: EntityStoreStrategy[] = [];\n\n  constructor(entities: E[], options: EntityStoreOptions = {}) {\n    this.getKey = options.getKey ? options.getKey : getEntityId;\n    this.getProperty = options.getProperty ? options.getProperty : getEntityProperty;\n\n    this.state = this.createStateManager();\n    this.view = this.createDataView();\n    this.stateView = this.createStateView();\n\n    this.view.lift();\n    this.stateView.lift();\n\n    if (entities.length > 0) {\n      this.load(entities);\n    } else {\n      this._index = this.generateIndex(entities);\n    }\n  }\n\n  /**\n   * Get an entity from the store by key\n   * @param key Key\n   * @returns Entity\n   */\n  get(key: EntityKey): E {\n    return this.index.get(key);\n  }\n\n  /**\n   * Get all entities in the store\n   * @returns Array of entities\n   */\n  all(): E[] {\n    return this.entities$.value;\n  }\n\n  /**\n   * Set this store's entities\n   * @param entities Entities\n   */\n  load(entities: E[], pristine: boolean = true) {\n    this._index = this.generateIndex(entities);\n    this._pristine = pristine;\n    this.next();\n  }\n\n  /**\n   * Clear the store's entities but keep the state and views intact.\n   * Views won't return any data but future data will be subject to the\n   * current views filter and sort\n   */\n  softClear() {\n    if (this.index && this.index.size > 0) {\n      this.index.clear();\n      this._pristine = true;\n      this.next();\n    } else if (this.index) {\n      this.updateCount();\n    }\n  }\n\n  /**\n   * Clear the store's entities, state and views\n   */\n  clear() {\n    this.stateView.clear();\n    this.view.clear();\n    this.state.clear();\n    this.softClear();\n  }\n\n  destroy() {\n    this.stateView.destroy();\n    this.view.destroy();\n    this.clear();\n  }\n\n  /**\n   * Insert an entity into the store\n   * @param entity Entity\n   */\n  insert(entity: E) {\n    this.insertMany([entity]);\n  }\n\n  /**\n   * Insert many entities into the store\n   * @param entities Entities\n   */\n  insertMany(entities: E[]) {\n    entities.forEach((entity: E) => this.index.set(this.getKey(entity), entity));\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Update or insert an entity into the store\n   * @param entity Entity\n   */\n  update(entity: E) {\n    this.updateMany([entity]);\n  }\n\n  /**\n   * Update or insert many entities into the store\n   * @param entities Entities\n   */\n  updateMany(entities: E[]) {\n    entities.forEach((entity: E) => this.index.set(this.getKey(entity), entity));\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Delete an entity from the store\n   * @param entity Entity\n   */\n  delete(entity: E) {\n    this.deleteMany([entity]);\n  }\n\n  /**\n   * Delete many entities from the store\n   * @param entities Entities\n   */\n  deleteMany(entities: E[]) {\n    entities.forEach((entity: E) => this.index.delete(this.getKey(entity)));\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Add a strategy to this store\n   * @param strategy Entity store strategy\n   * @returns Entity store\n   */\n  addStrategy(strategy: EntityStoreStrategy, activate: boolean = false): EntityStore {\n    const existingStrategy = this.strategies.find((_strategy: EntityStoreStrategy) => {\n      return strategy.constructor === _strategy.constructor;\n    });\n    if (existingStrategy !== undefined) {\n      throw new Error('A strategy of this type already exists on that EntityStore.');\n    }\n\n    this.strategies.push(strategy);\n    strategy.bindStore(this);\n\n    if (activate === true) {\n      strategy.activate();\n    }\n\n    return this;\n  }\n\n  /**\n   * Remove a strategy from this store\n   * @param strategy Entity store strategy\n   * @returns Entity store\n   */\n  removeStrategy(strategy: EntityStoreStrategy): EntityStore {\n    const index = this.strategies.indexOf(strategy);\n    if (index >= 0) {\n      this.strategies.splice(index, 1);\n      strategy.unbindStore(this);\n    }\n    return this;\n  }\n\n  /**\n   * Return strategies of a given type\n   * @param type Entity store strategy class\n   * @returns Strategies\n   */\n  getStrategyOfType(type: typeof EntityStoreStrategy): EntityStoreStrategy {\n    return this.strategies.find((strategy: EntityStoreStrategy) => {\n      return strategy instanceof type;\n    });\n  }\n\n  /**\n   * Activate strategies of a given type\n   * @param type Entity store strategy class\n   */\n  activateStrategyOfType(type: typeof EntityStoreStrategy) {\n    const strategy = this.getStrategyOfType(type);\n    if (strategy !== undefined) {\n      strategy.activate();\n    }\n  }\n\n  /**\n   * Deactivate strategies of a given type\n   * @param type Entity store strategy class\n   */\n  deactivateStrategyOfType(type: typeof EntityStoreStrategy) {\n    const strategy = this.getStrategyOfType(type);\n    if (strategy !== undefined) {\n      strategy.deactivate();\n    }\n  }\n\n  /**\n   * Generate a complete index of all the entities\n   * @param entities Entities\n   * @returns Index\n   */\n  private generateIndex(entities: E[]): Map<EntityKey, E> {\n    const entries = entities.map((entity: E) => [this.getKey(entity), entity]);\n    return new Map(entries as [EntityKey, E][]);\n  }\n\n  /**\n   * Push the index's entities into the entities$ observable\n   */\n  private next() {\n    this.entities$.next(Array.from(this.index.values()));\n    this.updateCount();\n  }\n\n  /**\n   * Update the store's count and empty\n   */\n  private updateCount() {\n    const count = this.index.size;\n    const empty = count === 0;\n    this.count$.next(count);\n    this.empty$.next(empty);\n  }\n\n  /**\n   * Create the entity state manager\n   * @returns EntityStateManager\n   */\n  private createStateManager() {\n    return new EntityStateManager<E, S>({store: this});\n  }\n\n  /**\n   * Create the data view\n   * @returns EntityView<E>\n   */\n  private createDataView() {\n    return new EntityView<E>(this.entities$);\n  }\n\n  /**\n   * Create the state view\n   * @returns EntityView<EntityRecord<E>>\n   */\n  private createStateView() {\n    return new EntityView<E, EntityRecord<E, S>>(this.view.all$())\n      .join({\n        source: this.state.change$,\n        reduce: (entity: E): EntityRecord<E, S> => {\n          const key = this.getKey(entity);\n          const state = this.state.get(entity);\n          const currentRecord = this.stateView.get(key);\n\n          if (\n            currentRecord !== undefined &&\n            currentRecord.entity === entity &&\n            this.statesAreTheSame(currentRecord.state, state)\n          ) {\n            return currentRecord;\n          }\n\n          const revision = currentRecord ? currentRecord.revision + 1 : 1;\n          const ref = `${key}-${revision}`;\n          return {entity, state, revision, ref};\n        }\n      })\n      .createIndex((record: EntityRecord<E, S>) => this.getKey(record.entity));\n  }\n\n  private statesAreTheSame(currentState: S, newState: S): boolean {\n    if (currentState === newState) {\n      return true;\n    }\n\n    const currentStateIsEmpty = Object.keys(currentState).length === 0;\n    const newStateIsEmpty = Object.keys(newState).length === 0;\n    return currentStateIsEmpty && newStateIsEmpty;\n  }\n\n}\n","import { ChangeDetectorRef } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { skip } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { EntityKey } from './entity.interfaces';\n\nimport { EntityStore } from './store';\n\n/**\n * This class is used to synchronize a component's changes\n * detection with an EntityStore changes. For example, it is frequent\n * to have a component subscribe to a store's selected entity and, at the same time,\n * this component provides a way to select an entity with, let's say, a click.\n *\n * This class automatically handles those case and triggers the compoent's\n * change detection when needed.\n *\n * Note: If the component observes the store's stateView, a workspace is\n * probably not required because the stateView catches any changes to the\n * entities and their state.\n */\nexport class EntityStoreWatcher<E extends object> {\n\n  /**\n   * Component change detector\n   */\n  private cdRef: ChangeDetectorRef;\n\n  /**\n   * Entity store\n   */\n  private store: EntityStore<E>;\n\n  /**\n   * Component inner state\n   */\n  private innerStateIndex = new Map<EntityKey, {[key: string]: any}>();\n\n  /**\n   * Subscription to the store's entities\n   */\n  private entities$$: Subscription;\n\n  /**\n   * Subscription to the store's state\n   */\n  private state$$: Subscription;\n\n  constructor(store?: EntityStore<E>, cdRef?: ChangeDetectorRef) {\n    this.setChangeDetector(cdRef);\n    this.setStore(store);\n  }\n\n  destroy() {\n    this.setChangeDetector(undefined);\n    this.setStore(undefined);\n  }\n\n  /**\n   * Bind this workspace to a store and start watching for changes\n   * @param store Entity store\n   */\n  setStore(store?: EntityStore<E>) {\n    if (store === undefined) {\n      this.teardownObservers();\n      this.innerStateIndex.clear();\n      this.store = undefined;\n      return;\n    }\n\n    this.setStore(undefined);\n    this.store = store;\n    this.setupObservers();\n    this.detectChanges();\n  }\n\n  /**\n   * Bind this workspace to a component's change detector\n   * @param cdRef Change detector\n   */\n  setChangeDetector(cdRef?: ChangeDetectorRef) {\n    this.cdRef = cdRef;\n  }\n\n  /**\n   * Set up observers on a store's entities and their state\n   * @param store Entity store\n   */\n  private setupObservers() {\n    this.teardownObservers();\n\n    this.entities$$ = this.store.entities$\n      .subscribe((entities: E[]) => this.onEntitiesChange(entities));\n\n    this.state$$ = this.store.state.change$\n      .pipe(skip(1))\n      .subscribe(() => this.onStateChange());\n  }\n\n  /**\n   * Teardown store observers\n   */\n  private teardownObservers() {\n    if (this.entities$$ !== undefined) {\n      this.entities$$.unsubscribe();\n    }\n    if (this.state$$ !== undefined) {\n      this.state$$.unsubscribe();\n    }\n    this.entities$$ = undefined;\n    this.state$$ = undefined;\n  }\n\n  /**\n   * When the entities change, always trigger the changes detection\n   */\n  private onEntitiesChange(entities: E[]) {\n    this.detectChanges();\n  }\n\n  /**\n   * When the entities state change, trigger the change detection\n   * only if the component has not handled these changes yet. For example,\n   * the component might have initiated thoses changes itself.\n   */\n  private onStateChange() {\n    let changesDetected = false;\n    const storeIndex = this.store.state.index;\n    const innerIndex = this.innerStateIndex;\n\n    if (storeIndex.size !== innerIndex.size) {\n      changesDetected = this.detectChanges();\n    }\n\n    const storeKeys = Array.from(storeIndex.keys());\n    for (const key of storeKeys) {\n      const storeValue = storeIndex.get(key);\n      const innerValue = innerIndex.get(key);\n      if (changesDetected === false) {\n        if (innerValue === undefined) {\n          changesDetected = this.detectChanges();\n        } else if (!ObjectUtils.objectsAreEquivalent(storeValue, innerValue)) {\n          changesDetected = this.detectChanges();\n        }\n      }\n\n      this.innerStateIndex.set(key, Object.assign({}, storeValue));\n    }\n  }\n\n  /**\n   * Trigger the change detection of the workspace is bound to a change detector\n   */\n  private detectChanges() {\n    if (this.cdRef !== undefined) {\n      this.cdRef.detectChanges();\n    }\n    return true;\n  }\n\n}\n","import { BehaviorSubject } from 'rxjs';\n\nimport { EntityStoreStrategyOptions } from '../entity.interfaces';\nimport { EntityStore } from '../store';\n\n/**\n * Entity store strategies. They can do pretty much anything during a store's\n * lifetime. For example, they may act as triggers when something happens.\n * Sharing a strategy is a good idea when multiple strategies would have\n * on cancelling effect on each other.\n *\n * At creation, strategy is inactive and needs to be manually activated.\n */\nexport class EntityStoreStrategy {\n\n  /**\n   * Feature store\n   * @internal\n   */\n  protected stores: EntityStore[] = [];\n\n  /**\n   * Whether this strategy is active\n   * @internal\n   */\n  get active(): boolean { return this.active$.value; }\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  constructor(protected options: EntityStoreStrategyOptions = {}) {\n    this.options = options;\n  }\n\n  /**\n   * Activate the strategy. If it's already active, it'll be deactivated\n   * and activated again.\n   */\n  activate() {\n    if (this.active === true) {\n      this.doDeactivate();\n    }\n    this.active$.next(true);\n    this.doActivate();\n  }\n\n  /**\n   * Activate the strategy. If it's already active, it'll be deactivated\n   * and activated again.\n   */\n  deactivate() {\n    this.active$.next(false);\n    this.doDeactivate();\n  }\n\n  /**\n   * Bind this strategy to a store\n   * @param store Feature store\n   */\n  bindStore(store: EntityStore) {\n    if (this.stores.indexOf(store) < 0) {\n      this.stores.push(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from store\n   * @param store Feature store\n   */\n  unbindStore(store: EntityStore) {\n    const index = this.stores.indexOf(store);\n    if (index >= 0) {\n      this.stores.splice(index, 1);\n    }\n  }\n\n  /**\n   * Do the stataegy activation\n   * @internal\n   */\n  protected doActivate() {}\n\n  /**\n   * Do the strategy deactivation\n   * @internal\n   */\n  protected doDeactivate() {}\n\n}\n","import { EntityStoreStrategyFuncOptions } from '../entity.interfaces';\nimport { EntityStore } from '../store';\nimport { EntityStoreStrategy } from './strategy';\n\n/**\n * When active, this strategy filters a store's stateView to return\n * selected entities only.\n */\nexport class EntityStoreFilterCustomFuncStrategy extends EntityStoreStrategy {\n\n  constructor(protected options: EntityStoreStrategyFuncOptions) {\n    super(options);\n  }\n\n  /**\n   * Store / filter ids map\n   */\n  private filters: Map<EntityStore, string> = new Map();\n\n  /**\n   * Bind this strategy to a store and start filtering it\n   * @param store Entity store\n   */\n  bindStore(store: EntityStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.filterStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop filtering it\n   * @param store Entity store\n   */\n  unbindStore(store: EntityStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unfilterStore(store);\n    }\n  }\n\n  /**\n   * Start filtering all stores\n   * @internal\n   */\n  protected doActivate() {\n    this.filterAll();\n  }\n\n  /**\n   * Stop filtering all stores\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unfilterAll();\n  }\n\n  /**\n   * Filter all stores\n   */\n  private filterAll() {\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\n  }\n\n  /**\n   * Unfilter all stores\n   */\n  private unfilterAll() {\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\n  }\n\n  /**\n   * Filter a store and add it to the filters map\n   */\n  private filterStore(store: EntityStore) {\n    this.filters.set(store, store.stateView.addFilter(this.options.filterClauseFunc));\n  }\n\n  /**\n   * Unfilter a store and delete it from the filters map\n   */\n  private unfilterStore(store: EntityStore) {\n    const filterId = this.filters.get(store);\n    if (filterId === undefined) {\n      return;\n    }\n\n    store.stateView.removeFilter(filterId);\n    this.filters.delete(store);\n  }\n}\n","import { EntityRecord } from '../entity.interfaces';\nimport { EntityStore } from '../store';\nimport { EntityStoreStrategy } from './strategy';\n\n/**\n * When active, this strategy filters a store's stateView to return\n * selected entities only.\n */\nexport class EntityStoreFilterSelectionStrategy extends EntityStoreStrategy {\n\n  /**\n   * Store / filter ids map\n   */\n  private filters: Map<EntityStore, string> = new Map();\n\n  /**\n   * Bind this strategy to a store and start filtering it\n   * @param store Entity store\n   */\n  bindStore(store: EntityStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.filterStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop filtering it\n   * @param store Entity store\n   */\n  unbindStore(store: EntityStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unfilterStore(store);\n    }\n  }\n\n  /**\n   * Start filtering all stores\n   * @internal\n   */\n  protected doActivate() {\n    this.filterAll();\n  }\n\n  /**\n   * Stop filtering all stores\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unfilterAll();\n  }\n\n  /**\n   * Filter all stores\n   */\n  private filterAll() {\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\n  }\n\n  /**\n   * Unfilter all stores\n   */\n  private unfilterAll() {\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\n  }\n\n  /**\n   * Filter a store and add it to the filters map\n   */\n  private filterStore(store: EntityStore) {\n    if (this.filters.has(store)) {\n      return;\n    }\n\n    const filter = (record: EntityRecord<object>) => {\n      return record.state.selected === true;\n    };\n    this.filters.set(store, store.stateView.addFilter(filter));\n  }\n\n  /**\n   * Unfilter a store and delete it from the filters map\n   */\n  private unfilterStore(store: EntityStore) {\n    const filterId = this.filters.get(store);\n    if (filterId === undefined) {\n      return;\n    }\n\n    store.stateView.removeFilter(filterId);\n    this.filters.delete(store);\n  }\n}\n","<mat-form-field class=\"igo-entity-selector\">\n  <mat-select\n    [disabled]=\"disabled\"\n    [value]=\"selected$ | async\"\n    [multiple]=\"multi\"\n    [placeholder]=\"placeholder\"\n    (selectionChange)=\"onSelectionChange($event)\">\n    <mat-option *ngIf=\"emptyText !== undefined && multi === false\" [value]=\"emptyValue\">{{emptyText}}</mat-option>\n    <mat-option *ngIf=\"multi === true\" [value]=\"multiSelectValue\">{{multiText$ | async}}</mat-option>\n    <ng-template ngFor let-record [ngForOf]=\"store.stateView.all$() | async\">\n      <mat-option [value]=\"record.entity\">\n        {{titleAccessor(record.entity)}}\n      </mat-option>\n    </ng-template>\n  </mat-select>\n</mat-form-field>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { EntityRecord } from '../shared/entity.interfaces';\nimport { EntityStore } from '../shared/store';\nimport { EntityStoreWatcher } from '../shared/watcher';\nimport { getEntityTitle } from '../shared/entity.utils';\n\n@Component({\n  selector: 'igo-entity-selector',\n  templateUrl: './entity-selector.component.html',\n  styleUrls: ['./entity-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class EntitySelectorComponent implements OnInit, OnDestroy {\n\n  /**\n   * The selected entity\n   * @internal\n   */\n  readonly selected$ = new BehaviorSubject<object>(undefined);\n\n  /**\n   * The current multi select option text\n   * @internal\n   */\n  readonly multiText$ = new BehaviorSubject<string>(undefined);\n\n  readonly multiSelectValue = {id: 'IGO_MULTI_SELECT'};\n\n  readonly emptyValue = {id: 'IGO_EMPTY_SELECT'};\n\n  /**\n   * Subscription to the selected entity\n   */\n  private selected$$: Subscription;\n\n  /**\n   * Store watcher\n   */\n  private watcher: EntityStoreWatcher<object>;\n\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Title accessor\n   */\n  @Input() titleAccessor: (object) => string = getEntityTitle;\n\n  /**\n   * Text to display when nothing is selected\n   */\n  @Input() emptyText: string = undefined;\n\n  /**\n   * Wheter selecting many entities is allowed\n   */\n  @Input() multi: boolean = false;\n\n  /**\n   * Text to display for the select all option\n   */\n  @Input() multiAllText: string = 'All';\n\n  /**\n   * Text to display for the select none option\n   */\n  @Input() multiNoneText: string = 'None';\n\n  /**\n   * Field placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Wheter the selector is disabled or not\n   */\n  @Input() disabled: boolean = false;\n\n  /**\n   * Event emitted when the selection changes\n   */\n  @Output() selectedChange = new EventEmitter<{\n    selected: boolean;\n    value: object | object[];\n  }>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Create a store watcher and subscribe to the selected entity\n   * @internal\n   */\n  ngOnInit() {\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n    this.selected$$ = this.store.stateView\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\n      .subscribe((records: EntityRecord<object>[]) => {\n        const entities = records.map((record: EntityRecord<object>) => record.entity);\n        this.onSelectFromStore(entities);\n      });\n  }\n\n  /**\n   * Unsubscribe to the selected entity and destroy the store watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n    this.selected$$.unsubscribe();\n  }\n\n  /**\n   * On selection change, update the store's state and emit an event\n   * @internal\n   */\n  onSelectionChange(event: {value: object | undefined}) {\n    const values = event.value instanceof Array ? event.value : [event.value];\n\n    const multiSelect = values.find((_value: object) => _value === this.multiSelectValue);\n    let entities = values.filter((_value: object) => _value !== this.multiSelectValue);\n    if (multiSelect !== undefined) {\n      if (entities.length === this.store.count) {\n        entities = [];\n      } else if (entities.length < this.store.count) {\n        entities = this.store.all();\n      }\n    }\n\n    entities = entities.filter((entity: object) => entity !== this.emptyValue);\n    if (entities.length === 0) {\n      this.store.state.updateAll({selected: false});\n    } else {\n      this.store.state.updateMany(entities, {selected: true}, true);\n    }\n\n    const value = this.multi ? entities : event.value;\n    this.selectedChange.emit({selected: true, value});\n  }\n\n  private onSelectFromStore(entities: object[]) {\n    if (this.multi === true) {\n      this.selected$.next(entities);\n    } else {\n      const entity = entities.length > 0 ? entities[0] : undefined;\n      this.selected$.next(entity);\n    }\n\n    this.updateMultiToggleWithEntities(entities);\n  }\n\n  private updateMultiToggleWithEntities(entities: object[]) {\n    if (entities.length === this.store.count && this.multiText$.value !== this.multiNoneText) {\n      this.multiText$.next(this.multiNoneText);\n    } else if (entities.length < this.store.count && this.multiText$.value !== this.multiAllText) {\n      this.multiText$.next(this.multiAllText);\n    }\n  }\n\n}\n","import { Directive, HostListener } from '@angular/core';\n\n@Directive({\n  selector: '[igoStopPropagation]'\n})\nexport class StopPropagationDirective {\n  @HostListener('click', ['$event'])\n  public onClick(event: any): void {\n    event.stopPropagation();\n  }\n}\n","import {\n  Directive,\n  Input,\n  ElementRef,\n  Renderer2,\n  EventEmitter,\n  Output,\n  HostListener\n} from '@angular/core';\n\nimport scrollIntoView from 'scroll-into-view-if-needed';\n\nimport { EntityTableScrollBehavior } from '../shared/entity.enums';\n\n/**\n * Directive that handles an entity table row click and selection.\n */\n@Directive({\n  selector: '[igoEntityTableRow]'\n})\nexport class EntityTableRowDirective {\n\n  /**\n   * Class added to a selected row\n   */\n  static selectedCls = 'igo-entity-table-row-selected';\n\n  /**\n   * Class added to a highlighted row\n   */\n  static highlightedCls = 'igo-entity-table-row-highlighted';\n\n  /**\n   * Whether a row supports selection\n   */\n  @Input() selection = false;\n\n  /**\n   * Whether clicking a row should select it (if selection is true)\n   */\n  @Input() selectOnClick: boolean = true;\n\n  /**\n   * Whether the selected row should be highlighted\n   */\n  @Input() highlightSelection: boolean = true;\n\n  /**\n   * Whether a row is selected\n   */\n  @Input()\n  set selected(value: boolean) {\n    if (this.selection === false) { return; }\n    if (value === this._selected) { return; }\n\n    this.toggleSelected(value);\n    this.scroll();\n  }\n  get selected(): boolean {\n    return this._selected;\n  }\n  private _selected = false;\n\n  /**\n   * Scroll behavior on selection\n   */\n  @Input()\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\n\n  /**\n   * Event emitted when a row is selected\n   */\n  @Output() select = new EventEmitter<EntityTableRowDirective>();\n\n  /**\n   * When a row is clicked, select it if it's supported\n   * @ignore\n   */\n  @HostListener('click')\n  onClick() {\n    if (this.selection === false || this.selectOnClick === false) {\n      return;\n    }\n\n    this.toggleSelected(true);\n    this.select.emit(this);\n  }\n\n  constructor(private renderer: Renderer2, private el: ElementRef) {}\n\n  /**\n   * Select a row and add or remove the selected class from it\n   * @param selected Whether the row should be selected\n   */\n  private toggleSelected(selected: boolean) {\n    this._selected = selected;\n    if (selected === true) {\n      this.addCls(EntityTableRowDirective.selectedCls);\n      if (this.highlightSelection === true) {\n        this.addCls(EntityTableRowDirective.highlightedCls);\n      }\n    } else {\n      this.removeCls(EntityTableRowDirective.selectedCls);\n      this.removeCls(EntityTableRowDirective.highlightedCls);\n    }\n  }\n\n  /**\n   * Scroll to the selected row\n   */\n  private scroll() {\n    if (this._selected === true) {\n      scrollIntoView(this.el.nativeElement, {\n        scrollMode: 'if-needed',\n        behavior: 'smooth',\n        block: 'end',\n        inline: 'nearest'\n      });\n    }\n  }\n\n  /**\n   * Add the selected CSS class\n   */\n  private addCls(cls: string) {\n    this.renderer.addClass(this.el.nativeElement, cls);\n  }\n\n  /**\n   * Remove the selected CSS class\n   */\n  private removeCls(cls: string) {\n    this.renderer.removeClass(this.el.nativeElement, cls);\n  }\n}\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnChanges,\n  ViewChild,\n  Output,\n  EventEmitter,\n  OnDestroy\n} from '@angular/core';\n\nimport {\n  EntityStore\n} from '../shared';\nimport { MatPaginator, PageEvent } from '@angular/material/paginator';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LanguageService, MediaService } from '@igo2/core';\nimport { EntityTablePaginatorOptions } from './entity-table-paginator.interface';\n\n@Component({\n  selector: 'igo-entity-table-paginator',\n  templateUrl: './entity-table-paginator.component.html',\n  styleUrls: ['./entity-table-paginator.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class EntityTablePaginatorComponent implements OnChanges, OnDestroy {\n\n  public disabled: boolean = false;\n  public hidePageSize: boolean = false;\n  public pageIndex: number = 0;\n  public pageSize: number = 50;\n  public pageSizeOptions: number[] = [5, 10, 20, 50, 100, 200];\n  public showFirstLastButtons: boolean = true;\n  private count$$: Subscription;\n  private entitySortChange$$: Subscription;\n  private paginationLabelTranslation$$: Subscription[] = [];\n\n  @Input() entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Paginator options\n   */\n  @Input()\n  paginatorOptions: EntityTablePaginatorOptions;\n\n  /**\n   * Event emitted when the paginator changes the page size or page index.\n   */\n  @Output() page: EventEmitter<PageEvent>;\n\n  public length: number = 0;\n\n  /**\n   * Paginator emitted.\n   */\n  @Output() paginatorChange: EventEmitter<MatPaginator> = new EventEmitter<MatPaginator>();\n\n  constructor(private languageService: LanguageService, private mediaService: MediaService) {}\n\n  @ViewChild(MatPaginator, { static: true }) paginator: MatPaginator;\n\n  ngOnChanges() {\n    this.unsubscribeAll();\n    this.count$$ = this.store.stateView.count$.subscribe((count) => {\n      this.length = count;\n      this.emitPaginator();\n    });\n    this.entitySortChange$$ = this.entitySortChange$.subscribe(() => {\n      if (this.paginator) {\n        this.paginator.firstPage();\n      }\n    });\n    this.initPaginatorOptions();\n    this.translateLabels();\n  }\n\n  initPaginatorOptions() {\n    this.disabled = this.paginatorOptions?.disabled || this.disabled;\n    this.pageIndex = this.paginatorOptions?.pageIndex || this.pageIndex;\n    this.pageSize = this.paginatorOptions?.pageSize || this.pageSize;\n    this.pageSizeOptions = this.paginatorOptions?.pageSizeOptions || this.pageSizeOptions;\n    if (this.mediaService.isMobile()) {\n      this.showFirstLastButtons = false;\n      this.hidePageSize = true;\n    } else {\n      this.showFirstLastButtons = this.paginatorOptions?.showFirstLastButtons || this.showFirstLastButtons;\n      this.hidePageSize = this.paginatorOptions?.hidePageSize || this.hidePageSize;\n    }\n  }\n\n  translateLabels() {\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.firstPageLabel').subscribe((label: string) => {\n        this.paginator._intl.firstPageLabel = label;\n      }));\n\n    this.paginator._intl.getRangeLabel = this.rangeLabel;\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.itemsPerPageLabel').subscribe((label: string) => {\n        this.paginator._intl.itemsPerPageLabel = label;\n      }));\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.lastPageLabel').subscribe((label: string) => {\n        this.paginator._intl.lastPageLabel = label;\n      }));\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.nextPageLabel').subscribe((label: string) => {\n        this.paginator._intl.nextPageLabel = label;\n      }));\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.previousPageLabel').subscribe((label: string) => {\n        this.paginator._intl.previousPageLabel = label;\n      }));\n  }\n\n  rangeLabel = (page: number, pageSize: number, length: number) => {\n    const of: BehaviorSubject<string> = new BehaviorSubject('');\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.of').subscribe((label: string) => {\n        of.next(label);\n      }));\n    if (length === 0 || pageSize === 0) { return `0 ${of.value} ${length}`; }\n    length = Math.max(length, 0);\n    const startIndex = page * pageSize;\n    const endIndex = startIndex < length ?\n        Math.min(startIndex + pageSize, length) :\n        startIndex + pageSize;\n    return `${startIndex + 1} - ${endIndex} ${of.value} ${length}`;\n  }\n\n  private unsubscribeAll() {\n    this.paginationLabelTranslation$$.map(sub => sub.unsubscribe());\n    if (this.count$$) { this.count$$.unsubscribe(); }\n    if (this.entitySortChange$$) { this.entitySortChange$$.unsubscribe(); }\n  }\n\n  ngOnDestroy(): void {\n    this.unsubscribeAll();\n  }\n\n  emitPaginator() {\n    this.paginatorChange.emit(this.paginator);\n  }\n}\n","<mat-paginator \n  [disabled]=\"disabled\"\n  [hidePageSize]=\"hidePageSize\"\n  [length]=\"length\"\n  [pageIndex]=\"pageIndex\"\n  [pageSize]=\"pageSize\"\n  [pageSizeOptions]=\"pageSizeOptions\"\n  [showFirstLastButtons]=\"showFirstLastButtons\"\n  (page)=\"emitPaginator()\">\n</mat-paginator>\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\n\nimport { Cacheable } from 'ts-cacheable';\nimport { Observable } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\nimport { ConfigService } from '@igo2/core';\n\n@Pipe({\n  name: 'secureImage'\n})\nexport class SecureImagePipe implements PipeTransform {\n  constructor(\n    private http: HttpClient,\n    private configService?: ConfigService) {}\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  transform(url: string): Observable<string> {\n    const headers = new HttpHeaders({\n      'Content-Type': 'text/plain',\n      activityInterceptor: 'false'\n    });\n\n    const regexDepot = new RegExp(this.configService?.getConfig('depot.url') + '.*?(?=\"|$)');\n    if (regexDepot.test(url)) {\n      url = url.match(regexDepot)[0];\n    }\n\n    return this.http\n      .get(url, {\n        headers,\n        responseType: 'blob'\n      })\n      .pipe(\n        switchMap((blob) => {\n          return new Observable((observer) => {\n            const reader = new FileReader();\n            reader.readAsDataURL(blob);\n            reader.onloadend = () => {\n              observer.next(reader.result);\n              observer.complete();\n            };\n          });\n        })\n      ) as Observable<string>;\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml } from '@angular/platform-browser';\n\n@Pipe({ name: 'sanitizeHtml' })\nexport class SanitizeHtmlPipe implements PipeTransform {\n  constructor(private _sanitizer: DomSanitizer) {\n  }\n  transform(v: string): SafeHtml {\n    return this._sanitizer.bypassSecurityTrustHtml(v);\n  }\n}\n","<div class=\"table-container\">\n  <table mat-table matSort [ngClass]=\"getTableClass()\" [dataSource]=\"dataSource\" [trackBy]=\"getTrackByFunction()\" (matSortChange)=\"onSort($event)\">\n      <ng-container matColumnDef=\"selectionCheckbox\" class=\"mat-cell-checkbox\">\n          <th mat-header-cell *matHeaderCellDef>\n              <ng-container *ngIf=\"selectMany\">\n                  <ng-container *ngIf=\"selectionState$ | async as selectionState\">\n                      <mat-checkbox (change)=\"onToggleRows($event.checked)\" [checked]=\"selectionState === entityTableSelectionState.All\"\n                      [indeterminate]=\"selectionState === entityTableSelectionState.Some\">\n                      </mat-checkbox>\n                  </ng-container>\n              </ng-container>\n          </th>\n          <td mat-cell *matCellDef=\"let record\">\n              <mat-checkbox (mousedown)=\"$event.shiftKey ? $event.preventDefault() : null\" (click)=\"$event.shiftKey ?\n              onShiftToggleRow(!rowIsSelected(record), record, $event) : $event.stopPropagation()\" (change)=\"onToggleRow($event.checked,record)\"\n              [checked]=\"rowIsSelected(record)\">\n              </mat-checkbox>\n          </td>\n      </ng-container>\n\n      <ng-container [matColumnDef]=\"column.name\" *ngFor=\"let column of template.columns\">\n          <ng-container *ngIf=\"columnIsSortable(column)\">\n              <th mat-header-cell *matHeaderCellDef mat-sort-header [matTooltip]=\"column.tooltip ? column.tooltip : undefined\">\n                  {{column.title}}\n              </th>\n          </ng-container>\n\n          <ng-container *ngIf=\"!columnIsSortable(column)\">\n              <th mat-header-cell *matHeaderCellDef [matTooltip]=\"column.tooltip ? column.tooltip : undefined\">\n                  {{column.title}}\n              </th>\n          </ng-container>\n\n          <ng-container *ngIf=\"getColumnRenderer(column) as columnRenderer\">\n              <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.Default\">\n                  <ng-container *matCellDef=\"let record\">\n                      <td mat-cell class=\"mat-cell-text\" *ngIf=\"!isUrl(getValue(record, column));else isAnUrlDefault\" [ngClass]=\"getCellClass(record, column)\">\n                          {{getValue(record, column)}}\n                      </td>\n                      <ng-template #isAnUrlDefault>\n                          <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                              <a href=\"{{getValue(record, column)}}\" target='_blank' rel=\"noopener noreferrer\" (click)=\"$event.stopPropagation()\">\n                                  <img *ngIf=\"isImg(getValue(record, column));else notImg\" src=\"{{(getValue(record, column) | secureImage) | async}}\" width=\"50\" heigth=\"auto\">\n                                  <ng-template #notImg><span>{{\n                    'igo.common.entity-table.targetHtmlUrl' | translate }}\n                  </span></ng-template>\n                              </a>\n                          </td>\n                      </ng-template>\n                  </ng-container>\n              </ng-container>\n              <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.HTML\">\n                  <ng-container *matCellDef=\"let record\">\n                      <td mat-cell class=\"mat-cell-text\" *ngIf=\"!isUrl(getValue(record, column));else isAnUrlHTML\" [ngClass]=\"getCellClass(record, column)\"\n                      [innerHTML]=\"getValue(record, column)\">\n                      </td>\n                      <ng-template #isAnUrlHTML>\n                          <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                              <a href=\"{{getValue(record, column)}}\" target='_blank' rel=\"noopener noreferrer\" (click)=\"$event.stopPropagation()\">\n                                  <img *ngIf=\"isImg(getValue(record, column));else notImg\" src=\"{{(getValue(record, column) | secureImage) | async}}\" width=\"50\" heigth=\"auto\">\n                                  <ng-template #notImg><span>{{ 'igo.geo.targetHtmlUrl' |\n                    translate }} </span></ng-template>\n                              </a>\n                          </td>\n                      </ng-template>\n                  </ng-container>\n              </ng-container>\n              <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.UnsanitizedHTML\">\n                  <ng-container *matCellDef=\"let record\">\n                      <td mat-cell class=\"mat-cell-text edition\" [formGroup]=\"formGroup\" *ngIf=\"isEdition(record);else isUnsanitizedHTML\"\n                      [ngClass]=\"getCellClass(record, column)\">\n                          <div class=\"date-picker\" *ngIf=\"column.type === 'date'\">\n                              <mat-datepicker-toggle matSuffix [for]=\"picker\"></mat-datepicker-toggle>\n                              <input matInput [matDatepicker]=\"picker\" [formControlName]=\"column.name\" value=\"{{getValue(record, column)}}\"\n                              (dateChange)=\"onDateChange(column.name, record, $event)\">\n                              <mat-datepicker #picker></mat-datepicker>\n                          </div>\n                          <input matInput type=\"time\" *ngIf=\"column.type === 'time'\" [formControlName]=\"column.name\" step=\"900\" (focus)=\"column.onFocus($event)\"\n                          (keypress)=\"column.onChange($event)\" (blur)=\"column.onBlur($event)\">\n                          <input matInput type=\"number\" class=\"class_number_edition\" *ngIf=\"column.type === 'number'\" [formControlName]=\"column.name\" step=\"{{column.step}}\"\n                          value=\"{{getValue(record,column)}}\" (input)=\"onValueChange(column.name, record, $event)\"\n                          readonly=\"{{getValidationAttributeValue(column, 'readonly')}}\" required=\"{{getValidationAttributeValue(column, 'mandatory')}}\"\n                          min=\"{{getValidationAttributeValue(column, 'minValue')}}\" max=\"{{getValidationAttributeValue(column, 'maxValue')}}\">\n                          <input matInput type=\"text\" *ngIf=\"!column.type || column.type ==='string'\" [formControlName]=\"column.name\"\n                          value=\"{{getValue(record, column)}}\" (input)=\"onValueChange(column.name, record, $event)\"\n                          readonly=\"{{getValidationAttributeValue(column, 'readonly')}}\" required=\"{{getValidationAttributeValue(column, 'mandatory')}}\">\n                          <mat-checkbox *ngIf=\"column.type === 'boolean'\" [formControlName]=\"column.name\" [checked]=\"getValue(record,column)\"\n                          (change)=\"onBooleanValueChange(column.name, record,$event)\"></mat-checkbox>\n                          <mat-select *ngIf=\"column.type === 'list'\" required=\"{{getValidationAttributeValue(column, 'mandatory')}}\"\n                          [formControlName]=\"column.name\" [multiple]=\"column.multiple\" (selectionChange)=\"onSelectValueChange(column.name, record, $event)\"\n                          [value]=\"getValue(record, column)\">\n                              <mat-option *ngFor=\"let option of column.domainValues\" [value]=\"option.id\" [disabled]=\"option.disabled\">\n                                  {{ option.value }}\n                              </mat-option>\n                          </mat-select>\n                          <input matInput type=\"text\" [formControlName]=\"column.name\" *ngIf=\"column.type === 'autocomplete'\"\n                          [matAutocomplete]=\"auto\" required=\"{{getValidationAttributeValue(column, 'mandatory')}}\" value=\"{{getValue(record, column)}}\">\n                              <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)=\"onAutocompleteValueChange(column.name, record, $event)\"\n                              panelWidth=\"430px\">\n                                  <mat-option *ngFor=\"let option of filteredOptions | async\" [value]=\"option.id\">\n                                      {{ option.value }}\n                                  </mat-option>\n                              </mat-autocomplete>\n                      </td>\n                      <ng-template #isUnsanitizedHTML>\n                          <td mat-cell class=\"mat-cell-text\" *ngIf=\"!isUrl(getValue(record, column));else isAnUrlUnsanitizedHTML\" [ngClass]=\"getCellClass(record, column)\"\n                          [innerHTML]=\"getValue(record, column) | sanitizeHtml\">\n                          </td>\n                          <ng-template #isAnUrlUnsanitizedHTML>\n                              <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                                  <a href=\"{{getValue(record, column)}}\" target='_blank' rel=\"noopener noreferrer\" (click)=\"$event.stopPropagation()\">\n                                      <img *ngIf=\"isImg(getValue(record, column));else notImg\" src=\"{{(getValue(record, column) | secureImage) | async}}\" width=\"50\" heigth=\"auto\">\n                                      <ng-template #notImg><span>{{ 'igo.geo.targetHtmlUrl' | translate }} </span></ng-template>\n                                  </a>\n                              </td>\n                          </ng-template>\n                      </ng-template>\n                  </ng-container>\n              </ng-container>\n              <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.Icon\">\n                  <td mat-cell *matCellDef=\"let record\" class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                      <mat-icon svgIcon=\"{{getValue(record, column)|| column.icon}}\" (click)=\"column.onClick($event)\"></mat-icon>\n                  </td>\n              </ng-container>\n              <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.ButtonGroup\">\n                  <ng-container *matCellDef=\"let record\">\n                      <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                          <span *ngFor=\"let button of getValue(record, column)\">\n                              <ng-container *ngIf=\"isEdition(record) === button.editMode\">\n                                  <button *ngIf=\"button.style === 'mat-icon-button'\" igoStopPropagation mat-icon-button\n                                      [color]=\"button.color\" (mousedown)=\"onButtonClick(button.click, record)\" [disabled]=\"button.disabled\">\n                                      <mat-icon svgIcon=\"{{button.icon}}\"></mat-icon>\n                                  </button>\n                                  <button *ngIf=\"button.style !== 'mat-icon-button'\" igoStopPropagation mat-mini-fab\n                                      [color]=\"button.color\" (mousedown)=\"onButtonClick(button.click, record)\" [disabled]=\"button.disabled\">\n                                      <mat-icon svgIcon=\"{{button.icon}}\"></mat-icon>\n                                  </button>\n                              </ng-container>\n                          </span>\n                      </td>\n                  </ng-container>\n              </ng-container>\n          </ng-container>\n      </ng-container>\n\n      <tr mat-header-row *matHeaderRowDef=\"headers; sticky: fixedHeader;\" [ngClass]=\"getHeaderClass()\">\n      </tr>\n      <tr mat-row igoEntityTableRow *matRowDef=\"let record; columns: headers;\" [scrollBehavior]=\"scrollBehavior\" [ngClass]=\"getRowClass(record)\" [selection]=\"selection\" [selected]=\"rowIsSelected(record)\" (select)=\"onRowSelect(record)\" (click)=\"onRowClick(record)\">\n      </tr>\n  </table>\n  <igo-entity-table-paginator *ngIf=\"withPaginator\" [store]=\"store\" [paginatorOptions]=\"paginatorOptions\" [entitySortChange$]=\"entitySortChange$\" (paginatorChange)=\"paginatorChange($event)\">\n  </igo-entity-table-paginator>\n</div>","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy,\n  OnChanges,\n  SimpleChanges,\n  ElementRef,\n  Optional,\n  Self\n} from '@angular/core';\n\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\n\nimport {\n  EntityKey,\n  EntityRecord,\n  EntityState,\n  EntityStore,\n  EntityTableTemplate,\n  EntityTableColumn,\n  EntityTableColumnRenderer,\n  EntityTableSelectionState,\n  EntityTableScrollBehavior\n} from '../shared';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { MatTableDataSource } from '@angular/material/table';\nimport { EntityTablePaginatorOptions } from '../entity-table-paginator/entity-table-paginator.interface';\nimport { MatFormFieldControl } from '@angular/material/form-field';\nimport { FormBuilder, NgControl, NgForm, FormControlName, FormGroup } from '@angular/forms';\nimport { FocusMonitor } from '@angular/cdk/a11y';\nimport { DateAdapter, ErrorStateMatcher } from '@angular/material/core';\nimport { map } from 'rxjs/operators';\nimport * as moment_ from 'moment';\nconst moment = moment_;\n\n@Component({\n  selector: 'igo-entity-table',\n  templateUrl: './entity-table.component.html',\n  styleUrls: ['./entity-table.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [{ provide: MatFormFieldControl, useExisting: EntityTableComponent }]\n})\nexport class EntityTableComponent implements OnInit, OnChanges, OnDestroy {\n\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public formGroup: FormGroup = new FormGroup({});\n\n  public filteredOptions: Observable<any[]>;\n\n  /**\n   * Reference to the column renderer types\n   * @internal\n   */\n  entityTableColumnRenderer = EntityTableColumnRenderer;\n\n  /**\n   * Reference to the selection's state\n   * @internal\n   */\n  entityTableSelectionState = EntityTableSelectionState;\n\n  /**\n   * Observable of the selection,s state\n   * @internal\n   */\n  readonly selectionState$: BehaviorSubject<EntityTableSelectionState> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the store's selection\n   */\n  private selection$$: Subscription;\n\n  /**\n   * Subscription to the dataSource\n   */\n  private dataSource$$: Subscription;\n\n  /**\n   * The last record checked. Useful for selecting\n   * multiple records by holding the shift key and checking\n   * checkboxes.\n   */\n  private lastRecordCheckedKey: EntityKey;\n\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Table paginator\n   */\n  @Input() set paginator(value: MatPaginator) {\n    this._paginator = value;\n    this.dataSource.paginator = value;\n  }\n\n  get paginator(): MatPaginator {\n    return this._paginator;\n  }\n  private _paginator: MatPaginator;\n\n  /**\n   * Table template\n   */\n  @Input() template: EntityTableTemplate;\n\n  /**\n   * Scroll behavior on selection\n   */\n  @Input()\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\n\n  /**\n   * Whether nulls should be first when sorting\n   */\n  @Input()\n  sortNullsFirst: boolean = false;\n\n  /**\n   * Show the table paginator or not. False by default.\n   */\n  @Input()\n  withPaginator: boolean = false;\n\n  /**\n   * Paginator options\n   */\n  @Input()\n  paginatorOptions: EntityTablePaginatorOptions;\n\n  /**\n   * Event emitted when an entity (row) is clicked\n   */\n  @Output() entityClick = new EventEmitter<object>();\n\n  /**\n   * Event emitted when an entity (row) is selected\n   */\n  @Output() entitySelectChange = new EventEmitter<{\n    added: object[];\n  }>();\n\n  /**\n   * Event emitted when the table sort is changed.\n   */\n  @Output() entitySortChange: EventEmitter<{column: EntityTableColumn, direction: string}> = new EventEmitter(undefined);\n\n  /**\n   * Table headers\n   * @internal\n   */\n  get headers(): string[] {\n    let columns = this.template.columns\n      .filter((column: EntityTableColumn) => column.visible !== false)\n      .map((column: EntityTableColumn) => column.name);\n\n    if (this.selectionCheckbox === true) {\n      columns = ['selectionCheckbox'].concat(columns);\n    }\n\n    return columns;\n  }\n\n  /**\n   * Data source consumable by the underlying material table\n   * @internal\n   */\n  dataSource = new MatTableDataSource<object>();\n\n  /**\n   * Whether selection is supported\n   * @internal\n   */\n  get selection(): boolean { return this.template.selection || false; }\n\n  /**\n   * Whether a selection checkbox should be displayed\n   * @internal\n   */\n  get selectionCheckbox(): boolean { return this.template.selectionCheckbox || false; }\n\n  /**\n   * Whether selection many entities should eb supported\n   * @internal\n   */\n  get selectMany(): boolean { return this.template.selectMany || false; }\n\n  /**\n   * Whether selection many entities should eb supported\n   * @internal\n   */\n  get fixedHeader(): boolean { return this.template.fixedHeader === undefined ? true : this.template.fixedHeader; }\n\n  constructor(private cdRef: ChangeDetectorRef,\n    private formBuilder: FormBuilder,\n    protected _focusMonitor: FocusMonitor,\n    protected _elementRef: ElementRef<HTMLElement>,\n    @Optional() @Self() public ngControl: NgControl,\n    @Optional() protected _parentForm: NgForm,\n    @Optional() protected _controlName: FormControlName,\n    protected _defaultErrorStateMatcher: ErrorStateMatcher,\n    private dateAdapter: DateAdapter<Date>\n  ) {\n    this.dateAdapter.setLocale('fr-CA');\n  }\n\n  /**\n   * Track the selection state to properly display the selection checkboxes\n   * @internal\n   */\n  ngOnInit() {\n    this.handleDatasource();\n    this.dataSource.paginator = this.paginator;\n  }\n\n  /**\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const store = changes.store;\n    if (store && store.currentValue !== store.previousValue) {\n      this.handleDatasource();\n    }\n  }\n\n  /**\n   * Process text or number value change (edition)\n   */\n  onValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.target.value;\n  }\n\n  /**\n   * Process boolean value change (edition)\n   */\n  onBooleanValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.checked;\n  }\n\n  /**\n   * Process select value change (edition)\n   */\n  onSelectValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.value;\n  }\n\n  /**\n   * Process autocomplete value change (edition)\n   */\n  onAutocompleteValueChange(column: string, record: EntityRecord<any>, event) {\n    this.formGroup.controls[column].setValue(event.option.viewValue);\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.option.value;\n  }\n\n  /**\n   * Process date value change (edition)\n   */\n  onDateChange(column: string, record: EntityRecord<any>, event) {\n    const format = \"YYYY-MM-DD\";\n    const value = moment(event.value).format(format);\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = value;\n  }\n\n  /**\n   * Enable edition mode for one row\n   * More than one row can be edited at the same time\n   */\n  private enableEdit(record: EntityRecord<any>) {\n    const item = record.entity.properties || record.entity;\n    this.template.columns.forEach(column => {\n      column.title = column.validation?.mandatory && !column.title.includes('*') ? column.title + ' *' : column.title;\n\n      const key = this.getColumnKeyWithoutPropertiesTag(column.name);\n      if (column.type === 'boolean') {\n        if (!item[key] || item[key] === null) {\n          item[key] = false;\n        } else if (typeof item[key] === 'string') {\n          item[key] = JSON.parse(item[key].toLowerCase());\n        }\n        this.formGroup.setControl(column.name, this.formBuilder.control(\n          item[key]\n        ));\n      } else if (column.type === 'list') {\n        if (column.multiple) {\n          this.formGroup.setControl(column.name, this.formBuilder.control(\n            [item[key]]\n          ));\n        } else {\n          this.formGroup.setControl(column.name, this.formBuilder.control(\n            item[key]\n          ));\n\n          typeof item[key] === 'string' ?\n            this.formGroup.controls[column.name].setValue(parseInt(item[key])) :\n            this.formGroup.controls[column.name].setValue(item[key]);\n        }\n      } else if (column.type === 'autocomplete') {\n        this.formGroup.setControl(column.name, this.formBuilder.control(\n          item[key]\n        ));\n\n        this.filteredOptions = this.formGroup.controls[column.name].valueChanges.pipe(\n          map(value => {\n            if (value.length) {\n              return column.domainValues.filter((option) => {\n                const filterNormalized = value ? value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '') : '';\n                const featureNameNormalized = option.value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n                return featureNameNormalized.includes(filterNormalized);\n              });\n            }\n          })\n        );\n\n        let formControlValue = item[key];\n        column.domainValues.forEach(option => {\n          if (typeof formControlValue === 'string' && /^\\d+$/.test(formControlValue)) {\n            formControlValue = parseInt(formControlValue);\n          }\n          if (option.value === formControlValue || option.id === formControlValue) {\n            formControlValue = option.value;\n          }\n        });\n\n        this.formGroup.controls[column.name].setValue(formControlValue);\n        if (this.isEdition(record) && column.linkColumnForce) {\n          const entity = record.entity as any;\n          this.formGroup.controls[column.name].setValue(\n            entity?.properties[this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)]\n          );\n        }\n      } else if (column.type === 'date') {\n        if (column.visible) {\n          if (item[key]) {\n            let date = moment(item[key]);\n            item[key] = date.utc().format('YYYY-MM-DD');\n            this.formGroup.setControl(column.name, this.formBuilder.control(\n              item[key]\n            ));\n          } else {\n            const newKey = this.getColumnKeyWithoutPropertiesTag(column.name);\n            record.entity.properties[newKey] = null;\n            this.formGroup.setControl(column.name, this.formBuilder.control(\n              null\n            ));\n          }\n        }\n      } else {\n        this.formGroup.setControl(column.name, this.formBuilder.control(\n          item[key]\n        ));\n      }\n\n      if (this.formGroup.controls[column.name] && this.getValidationAttributeValue(column, 'readonly')) {\n        this.formGroup.controls[column.name].disable();\n      }\n    });\n  }\n\n  private handleDatasource() {\n    this.unsubscribeStore();\n    this.selection$$ = this.store.stateView\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\n      .subscribe((records: EntityRecord<object>[]) => {\n        const firstSelected = records[0];\n        const firstSelectedStateviewPosition = this.store.stateView.all().indexOf(firstSelected);\n        const pageMax = this.paginator ? this.paginator.pageSize * (this.paginator.pageIndex + 1) : 0;\n        const pageMin = this.paginator ? pageMax - this.paginator.pageSize : 0;\n\n        if (\n          this.paginator &&\n          (firstSelectedStateviewPosition < pageMin ||\n          firstSelectedStateviewPosition >= pageMax)) {\n          const pageToReach = Math.floor(firstSelectedStateviewPosition / this.paginator.pageSize);\n          this.dataSource.paginator.pageIndex = pageToReach;\n        }\n        this.selectionState$.next(this.computeSelectionState(records));\n      });\n    this.dataSource$$ = this.store.stateView.all$().subscribe((all) => {\n      if (all[0]) {\n        this.enableEdit(all[0]);\n      }\n      this.dataSource.data = all;\n    });\n\n  }\n\n  /**\n   * Unbind the store watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unsubscribeStore();\n  }\n\n  private unsubscribeStore() {\n    if (this.selection$$) {\n      this.selection$$.unsubscribe();\n    }\n    if (this.dataSource$$) {\n      this.dataSource$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Trackby function\n   * @param record Record\n   * @param index Record index\n   * @internal\n   */\n  getTrackByFunction() {\n    return (index: number, record: EntityRecord<object, EntityState>) => {\n      return record.ref;\n    };\n  }\n\n  /**\n   * Trigger a refresh of thre table. This can be useful when\n   * the data source doesn't emit a new value but for some reason\n   * the records need an update.\n   * @internal\n   */\n  refresh() {\n    this.cdRef.detectChanges();\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.paginator = event;\n  }\n\n  /**\n   * On sort, sort the store\n   * @param event Sort event\n   * @internal\n   */\n  onSort(event: {active: string, direction: string}) {\n    const direction = event.direction;\n    const column = this.template.columns\n      .find((c: EntityTableColumn) => c.name === event.active);\n\n    if (direction === 'asc' || direction === 'desc') {\n      this.store.stateView.sort({\n        valueAccessor: (record: EntityRecord<object>) => this.getValue(record, column),\n        direction,\n        nullsFirst: this.sortNullsFirst\n      });\n      this.entitySortChange.emit({column, direction});\n      this.entitySortChange$.next(true);\n    } else {\n      this.store.stateView.sort(undefined);\n    }\n  }\n\n  /**\n   * When an entity is clicked, emit an event\n   * @param record Record\n   * @internal\n   */\n  onRowClick(record: EntityRecord<object>) {\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n    this.entityClick.emit(record.entity);\n  }\n\n  /**\n   * When an entity is selected, select it in the store and emit an event. Even if\n   * \"many\" is set to true, this method always select a single, exclusive row. Selecting\n   * multiple rows should be achieved by using the checkboxes.\n   * @param record Record\n   * @internal\n   */\n  onRowSelect(record: EntityRecord<object>) {\n    if (this.selection === false) { return; }\n\n    const entity = record.entity;\n    this.store.state.update(entity, {selected: true}, true);\n    this.entitySelectChange.emit({added: [entity]});\n  }\n\n  /**\n   * Select or unselect all rows at once. On select, emit an event.\n   * @param toggle Select or unselect\n   * @internal\n   */\n  onToggleRows(toggle: boolean) {\n    if (this.selection === false) { return; }\n\n    this.store.state.updateAll({selected: toggle});\n    if (toggle === true) {\n      const entities = this.store.stateView\n        .all()\n        .map((record: EntityRecord<object>) => record.entity);\n      this.entitySelectChange.emit({added: [entities]});\n    }\n  }\n\n  /**\n   * When an entity is toggled, select or unselect it in the store. On select,\n   * emit an event.\n   * @param toggle Select or unselect\n   * @param record Record\n   * @internal\n   */\n  onToggleRow(toggle: boolean, record: EntityRecord<object>) {\n    if (this.selection === false) { return; }\n\n    const entity = record.entity;\n    const exclusive = toggle === true && !this.selectMany;\n    this.store.state.update(entity, {selected: toggle}, exclusive);\n    if (toggle === true) {\n      this.entitySelectChange.emit({added: [entity]});\n    }\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n  }\n\n  /**\n   * When an entity is toggled, select or unselect it in the store. On select,\n   * emit an event.\n   * @param toggle Select or unselect\n   * @param record Record\n   * @internal\n   */\n  onShiftToggleRow(toggle: boolean, record: EntityRecord<object>, event: MouseEvent) {\n    if (this.selection === false) { return; }\n\n    if (this.selectMany === false || this.lastRecordCheckedKey === undefined) {\n      this.onToggleRow(toggle, record);\n      return;\n    }\n\n    // This is a workaround mat checkbox wrong behavior\n    // when the shift key is held.\n    // See https://github.com/angular/components/issues/6232\n    const range = window.document.createRange();\n    range.selectNode(event.target as HTMLElement);\n    window.getSelection().removeAllRanges();\n    window.getSelection().addRange(range);\n    event.stopImmediatePropagation();\n\n    const records = this.store.stateView.all();\n    const recordIndex = records.indexOf(record);\n    const lastRecordChecked = this.store.stateView.get(this.lastRecordCheckedKey);\n    const lastRecordIndex = records.indexOf(lastRecordChecked);\n    const indexes = [recordIndex, lastRecordIndex];\n    const selectRecords = records.slice(Math.min(...indexes), Math.max(...indexes) + 1);\n\n    const entities = selectRecords.map((_record: EntityRecord<object>) => _record.entity);\n    this.store.state.updateMany(entities, {selected: toggle});\n    if (toggle === true) {\n      this.entitySelectChange.emit({added: entities});\n    }\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n  }\n\n  /**\n   * Compute the selection state\n   * @returns Whether all, some or no rows are selected\n   * @internal\n   */\n  private computeSelectionState(selectedRecords: EntityRecord<object>[]): EntityTableSelectionState {\n    const states = EntityTableSelectionState;\n    const selectionCount = selectedRecords.length;\n    return selectionCount === 0 ?\n      states.None :\n      (selectionCount === this.store.stateView.count ? states.All : states.Some);\n  }\n\n  /**\n   * Whether a column is sortable\n   * @param column Column\n   * @returns True if a column is sortable\n   * @internal\n   */\n  columnIsSortable(column: EntityTableColumn): boolean {\n    let sortable = column.sort;\n    if (sortable === undefined) {\n      sortable = this.template.sort === undefined ? false : this.template.sort;\n    }\n    return sortable;\n  }\n\n  /**\n   * Whether a row is should be selected based on the underlying entity state\n   * @param record Record\n   * @returns True if a row should be selected\n   * @internal\n   */\n  rowIsSelected(record: EntityRecord<object>): boolean {\n    const state = record.state;\n    return state.selected ? state.selected : false;\n  }\n\n  isImg(value) {\n    if (this.isUrl(value)) {\n      return (\n        ['jpg', 'png', 'gif'].indexOf(value.split('.').pop().toLowerCase()) !== -1\n      );\n    } else {\n      return false;\n    }\n  }\n\n  isUrl(value) {\n    if (typeof value === 'string') {\n      return (\n        value.slice(0, 8) === 'https://' || value.slice(0, 7) === 'http://'\n      );\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Method to access an entity's values\n   * @param record Record\n   * @param column Column\n   * @returns Any value\n   * @internal\n   */\n  getValue(record: EntityRecord<object>, column: EntityTableColumn): any {\n    const entity = record.entity;\n    let value;\n    if (column.valueAccessor !== undefined) {\n      return column.valueAccessor(entity, record);\n    }\n    if (this.template.valueAccessor !== undefined) {\n      return this.template.valueAccessor(entity, column.name, record);\n    }\n    value = this.store.getProperty(entity, column.name);\n\n    if (column.type === 'boolean') {\n      if (value === undefined || value === null || value === '') {\n        value = false;\n      } else if (typeof value !== 'boolean' && value !== undefined) {\n        if (typeof value === 'number'){\n          value = Boolean(value);\n        } else {\n          value = JSON.parse(value.toLowerCase());\n        }\n      }\n      if (!this.isEdition(record)){\n        value = value ? '&#10003;' : ''; // check mark\n      }\n    } else if (column.type === 'list' && value && column.domainValues) {\n      const entity = record.entity as any;\n      if (column.multiple) {\n        let list_id;\n        typeof value === 'string' ? list_id = value.match(/[\\w.-]+/g).map(Number) : list_id = value;\n        let list_option = [];\n\n        column.domainValues.forEach(option => {\n          if (list_id.includes(option.id)) {\n            if (record.edition) {\n              list_option.push(option.id);\n            } else {\n              list_option.push(option.value);\n            }\n          }\n        });\n\n        this.isEdition(record) ? value = list_id : value = list_option;\n      } else {\n        if (!this.isEdition(record) && column.linkColumnForce) {\n          value = entity?.properties[this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)];\n        } else {\n          column.domainValues.forEach(option => {\n            if (typeof value === 'string' && /^\\d+$/.test(value)) {\n              value = parseInt(value);\n            }\n            if (option.value === value || option.id === value) {\n              this.isEdition(record) ? value = option.id : value = option.value;\n            }\n          });\n        }\n      }\n    } else if (column.type === 'autocomplete' && value && column.domainValues) {\n      const entity = record.entity as any;\n      if (!this.isEdition(record) && column.linkColumnForce) {\n        value = entity?.properties[this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)];\n      } else {\n        column.domainValues.forEach(option => {\n          if (typeof value === 'string' && /^\\d+$/.test(value)) {\n            value = parseInt(value);\n          }\n          if (option.value === value || option.id === value) {\n            value = option.value;\n          }\n        });\n      }\n    } else if (column.type === 'date') {\n      if (this.isEdition(record)) {\n        if (value) {\n          let date = moment(value);\n          value = date.format();\n          this.formGroup.controls[column.name].setValue(value);\n        }\n      } else if (!this.isEdition(record) && value === null) {\n        value = \"\";\n      }\n    }\n\n    if (value === undefined) {\n      value = '';\n    }\n\n    return value;\n  }\n\n  /**\n   * Method to access an entity's validation values\n   * @param column Column\n   * @param validationType string\n   * @returns Any value (false if no validation or not the one concerned)\n   * @internal\n   */\n  getValidationAttributeValue(column: EntityTableColumn, validationType: string): any {\n    if (column.validation !== undefined && column.validation[validationType] !== undefined) {\n      return column.validation[validationType];\n    } else {\n      return false;\n    }\n  }\n\n  public isEdition(record) {\n    return record.entity.edition ? true : false;\n  }\n\n  /**\n   * Return the type of renderer of a column\n   * @param column Column\n   * @returns Renderer type\n   * @internal\n   */\n  getColumnRenderer(column: EntityTableColumn): EntityTableColumnRenderer {\n    if (column.renderer !== undefined) {\n      return column.renderer;\n    }\n    return EntityTableColumnRenderer.Default;\n  }\n\n  /**\n   * Return the table ngClass\n   * @returns ngClass\n   * @internal\n   */\n  getTableClass(): {[key: string]: boolean} {\n    return {\n      'igo-entity-table-with-selection': this.selection\n    };\n  }\n\n  /**\n   * Return a header ngClass\n   * @returns ngClass\n   * @internal\n   */\n  getHeaderClass(): {[key: string]: boolean} {\n    const func = this.template.headerClassFunc;\n    if (func instanceof Function) {\n      return func();\n    }\n    return {};\n  }\n\n  /**\n   * Return a row ngClass\n   * @param record Record\n   * @returns ngClass\n   * @internal\n   */\n  getRowClass(record: EntityRecord<object>): {[key: string]: boolean} {\n    const entity = record.entity;\n    const func = this.template.rowClassFunc;\n    if (func instanceof Function) {\n      return func(entity, record);\n    }\n    return {};\n  }\n\n  /**\n   * Return a row ngClass\n   * @param record Record\n   * @param column Column\n   * @returns ngClass\n   * @internal\n   */\n  getCellClass(record: EntityRecord<object>, column: EntityTableColumn): {[key: string]: boolean} {\n    const entity = record.entity;\n    const cls = {};\n\n    const tableFunc = this.template.cellClassFunc;\n    if (tableFunc instanceof Function) {\n      Object.assign(cls, tableFunc(entity, column, record));\n    }\n\n    const columnFunc = column.cellClassFunc;\n    if (columnFunc instanceof Function) {\n      Object.assign(cls, columnFunc(entity, record));\n    }\n\n    return cls;\n  }\n\n  /**\n   * When a button is clicked\n   * @param func Function\n   * @param record Record\n   * @internal\n   */\n  onButtonClick(\n    clickFunc: (entity: object, record?: EntityRecord<object>) => void,\n    record: EntityRecord<object>\n  ) {\n    this.enableEdit(record);\n    if (typeof clickFunc === 'function') {\n      clickFunc(record.entity, record);\n    }\n  }\n\n  /**\n   * Retrieve column name without his \"properties\" tag (useful for edition workspace properties)\n   */\n  public getColumnKeyWithoutPropertiesTag(column: string) {\n    if (column.includes('properties.')) {\n      return column.split('.')[1];\n    }\n    return column;\n  }\n}\n","export enum ActionbarMode {\n  Dock = 'dock',\n  Overlay = 'overlay',\n  Context = 'context'\n}\n","<mat-list-item *ngIf=\"!action.checkbox\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\"\n  (click)=\"onClick()\">\n  <button *ngIf=\"withIcon\"\n    mat-list-avatar\n    mat-icon-button\n    [color]=\"color\"\n    [disabled]=\"disabled$ | async\">\n    <mat-icon *ngIf=\"withIcon\" svgIcon=\"{{icon$ | async}}\"></mat-icon>\n  </button>\n  <h4 *ngIf=\"withTitle\" matLine>{{title | translate}}</h4>\n</mat-list-item>\n\n<mat-list-item class=\"item-checkbox\" *ngIf=\"action.checkbox\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\">\n  <mat-checkbox *ngIf=\"withTitle\"\n      (change)=\"action.handler()\"\n      [checked]=\"checkCondition$ | async\">\n      {{title | translate}}\n  </mat-checkbox>\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription, isObservable } from 'rxjs';\n\nimport { Action } from '../shared/action.interfaces';\n\n /**\n  * An action button\n  */\n@Component({\n  selector: 'igo-actionbar-item',\n  templateUrl: './actionbar-item.component.html',\n  styleUrls: ['./actionbar-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ActionbarItemComponent implements OnInit, OnDestroy {\n\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly checkCondition$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly tooltip$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly noDisplay$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly ngClass$: BehaviorSubject<{[key: string]: boolean}> = new BehaviorSubject({});\n\n  private ngClass$$: Subscription;\n\n  private disabled$$: Subscription;\n\n  private availability$$: Subscription;\n\n  private icon$$: Subscription;\n\n  private checkCondition$$: Subscription;\n\n  private tooltip$$: Subscription;\n\n  private noDisplay$$: Subscription;\n\n  private display$$: Subscription;\n\n  /**\n   * Action\n   */\n  @Input() action: Action;\n\n  /**\n   * Color\n   */\n  @Input() color = 'default';\n\n  /**\n   * Whether the action title is displayed\n   */\n  @Input() withTitle = true;\n\n  /**\n   * Whether the action icon is displayed\n   */\n  @Input() withIcon = true;\n\n  /**\n   * Whether a tooltip should be shown\n   */\n  @Input() withTooltip = true;\n\n  /**\n   * Whether the action is disabled\n   */\n  @Input()\n  set disabled(value: boolean) { this.disabled$.next(value); }\n  get disabled(): boolean { return this.disabled$.value; }\n\n  /**\n   * Whether the action is display or not\n   */\n  @Input()\n  set noDisplay(value: boolean) { this.noDisplay$.next(value); }\n  get noDisplay(): boolean { return this.noDisplay$.value; }\n\n  /**\n   * Event emitted when the action button is clicked\n   */\n  @Output() trigger: EventEmitter<Action> = new EventEmitter();\n\n  /**\n   * @internal\n   */\n  get title(): string { return this.action.title; }\n\n  constructor() {}\n\n  ngOnInit() {\n    const args = this.action.args || [];\n\n    if (this.action.ngClass !== undefined) {\n      this.ngClass$$ = this.action.ngClass(...args)\n        .subscribe((ngClass: {[key: string]: boolean}) => this.updateNgClass(ngClass));\n    }\n\n    if (isObservable(this.action.icon)) {\n      this.icon$$ = this.action.icon\n        .subscribe((icon: string) => this.updateIcon(icon));\n    } else {\n      this.updateIcon(this.action.icon);\n    }\n\n    if (isObservable(this.action.checkCondition)) {\n      this.checkCondition$$ = this.action.checkCondition\n        .subscribe((checkCondition: boolean) => this.updateCheckCondition(checkCondition));\n    } else {\n      this.updateCheckCondition(this.action.checkCondition);\n    }\n\n    if (isObservable(this.action.tooltip)) {\n      this.tooltip$$ = this.action.tooltip\n        .subscribe((tooltip: string) => this.updateTooltip(tooltip));\n    } else {\n      this.updateTooltip(this.action.tooltip);\n    }\n\n    if (this.action.availability !== undefined) {\n      this.availability$$ = this.action.availability(...args)\n        .subscribe((available: boolean) => this.disabled = !available);\n    }\n\n    this.disabled$$ = this.disabled$\n      .subscribe((disabled: boolean) => this.updateNgClass({'igo-actionbar-item-disabled': disabled}));\n\n    if (this.action.display !== undefined) {\n      this.display$$ = this.action.display(...args)\n        .subscribe((display: boolean) => this.noDisplay = !display);\n    }\n\n    this.noDisplay$$ = this.noDisplay$\n      .subscribe((noDisplay: boolean) => this.updateNgClass({'igo-actionbar-item-no-display': noDisplay}));\n  }\n\n  ngOnDestroy() {\n    if (this.ngClass$$ !== undefined) {\n      this.ngClass$$.unsubscribe();\n      this.ngClass$$ = undefined;\n    }\n\n    if (this.availability$$ !== undefined) {\n      this.availability$$.unsubscribe();\n      this.availability$$ = undefined;\n    }\n\n    if (this.display$$ !== undefined) {\n      this.display$$.unsubscribe();\n      this.display$$ = undefined;\n    }\n\n    if (this.checkCondition$$ !== undefined) {\n      this.checkCondition$$.unsubscribe();\n      this.checkCondition$$ = undefined;\n    }\n\n    if (this.icon$$ !== undefined) {\n      this.icon$$.unsubscribe();\n      this.icon$$ = undefined;\n    }\n\n    if (this.tooltip$$ !== undefined) {\n      this.tooltip$$.unsubscribe();\n      this.tooltip$$ = undefined;\n    }\n\n    this.disabled$$.unsubscribe();\n    this.noDisplay$$.unsubscribe();\n  }\n\n  /**\n   * When the action button is clicked, emit the 'trigger' event but don't\n   * invoke the action handler. This is handled by the parent component.\n   * @internal\n   */\n  onClick() {\n    if (this.disabled === true) {\n      return;\n    }\n    this.trigger.emit(this.action);\n  }\n\n  private updateNgClass(ngClass: {[key: string]: boolean}) {\n    this.ngClass$.next(Object.assign({}, this.ngClass$.value, ngClass));\n  }\n\n  private updateTooltip(tooltip: string) {\n    this.tooltip$.next(tooltip);\n  }\n\n  private updateCheckCondition(checkCondition: boolean) {\n    this.checkCondition$.next(checkCondition);\n  }\n\n  private updateIcon(icon: string) {\n    this.icon$.next(icon);\n  }\n}\n","<mat-list *ngIf=\"mode === actionbarMode.Dock\">\n\n    <div *ngIf=\"heightCondition && positionConditionTop && isDesktop\"\n      id=\"topChevron\">\n      <button\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.common.actionbar.scrollUp' | translate\"\n        (click)=\"scrollUp()\">\n        <mat-icon svgIcon=\"chevron-up\"></mat-icon>\n      </button>\n    </div>\n\n    <igo-actionbar-item\n      *ngIf=\"withToggleButton\"\n      color=\"accent\"\n      [withTitle]=\"false\"\n      [withIcon]=\"true\"\n      [color]=\"color\"\n      [disabled]=\"store.view.empty\"\n      [action]=\"toggleCollapseAction\"\n      (trigger)=\"onTriggerAction(toggleCollapseAction)\">\n    </igo-actionbar-item>\n\n    <ng-template #buttonContent *ngIf=\"!collapsed\" ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n      <igo-actionbar-item\n        color=\"accent\"\n        [withTitle]=\"withTitle\"\n        [withIcon]=\"withIcon\"\n        [withTooltip]=\"withTooltip\"\n        [color]=\"color\"\n        [disabled]=\"store.state.get(action).disabled\"\n        [action]=\"action\"\n        (trigger)=\"onTriggerAction(action)\">\n      </igo-actionbar-item>\n    </ng-template>\n\n    <div *ngIf=\"heightCondition && positionConditionLow && isDesktop\"\n      id=\"lowChevron\">\n      <button\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.common.actionbar.scrollDown' | translate\"\n        (click)=\"scrollDown()\">\n        <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n      </button>\n    </div>\n\n</mat-list>\n\n<div *ngIf=\"mode === actionbarMode.Overlay\">\n  <button class=\"buttonOverlay\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.common.actionbar.icon' | translate\"\n    [matMenuTriggerFor]=\"actionbarMenu\"\n    [disabled]=\"store.view.empty\"\n    [color]=\"iconColor\">\n    <mat-icon [svgIcon]=\"icon\"></mat-icon>\n  </button>\n\n  <mat-menu\n    #actionbarMenu=\"matMenu\"\n    class=\"igo-compact-menu igo-no-min-width-menu\"\n    overlapTrigger=\"true\"\n    [xPosition]=\"xPosition\"\n    [yPosition]=\"yPosition\"\n    [class]=\"overlayClass\">\n\n    <mat-list>\n      <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n        <igo-actionbar-item\n          color=\"accent\"\n          [withTitle]=\"withTitle\"\n          [withIcon]=\"withIcon\"\n          [color]=\"color\"\n          [action]=\"action\"\n          (trigger)=\"onTriggerAction(action)\">\n        </igo-actionbar-item>\n      </ng-template>\n    </mat-list>\n  </mat-menu>\n</div>\n<mat-card *ngIf=\"mode === actionbarMode.Context\" class=\"context-menu-card mat-elevation-z4\">\n  <mat-list>\n      <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n          <igo-actionbar-item\n            color=\"accent\"\n            [withTitle]=\"withTitle\"\n            [withIcon]=\"withIcon\"\n            [color]=\"color\"\n            [action]=\"action\"\n            (trigger)=\"onTriggerAction(action)\">\n          </igo-actionbar-item>\n        <br/>\n      </ng-template>\n  </mat-list>\n</mat-card>\n","import {\n  Component,\n  Input,\n  HostBinding,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy,\n  OnChanges,\n  OnDestroy,\n  SimpleChanges,\n  ElementRef\n} from '@angular/core';\n\nimport { MediaService, Media } from '@igo2/core';\nimport { EntityStoreWatcher } from '../../entity';\nimport { Action } from '../shared/action.interfaces';\nimport { ActionbarMode } from '../shared/action.enums';\nimport { ActionStore } from '../shared/store';\nimport { Overlay } from '@angular/cdk/overlay';\nimport { BehaviorSubject } from 'rxjs';\n\n/**\n * A list of action buttons.\n * This component can be displayed in one of two way: 'dock' or 'overlay'\n */\n@Component({\n  selector: 'igo-actionbar',\n  templateUrl: './actionbar.component.html',\n  styleUrls: ['./actionbar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ActionbarComponent implements OnDestroy, OnChanges {\n\n  /**\n   * Reference to the ActionbarMode enum for use in the template\n   * @internal\n   */\n  actionbarMode = ActionbarMode;\n\n  /**\n   * Whether the actionbar is collapsed (Dock mode)\n   * @internal\n   */\n  collapsed = false;\n\n  /**\n   * Toggle collapse action (Dock)\n   * @internal\n   */\n  toggleCollapseAction = {\n    id: 'actionbar_toggle',\n    icon: 'dots-vertical',\n    handler: () => {\n      this.collapsed = !this.collapsed;\n    }\n  };\n\n  /**\n   * Action store watcher\n   * @internal\n   */\n  private watcher: EntityStoreWatcher<Action>;\n\n  /**\n   * Height Condition for scroll button\n   */\n  heightCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n\n  /**\n   * Position Condition for top scroll button\n   */\n  positionConditionTop$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(true);\n\n  /**\n   * Position Condition for low scroll button\n   */\n  positionConditionLow$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(true);\n\n  /**\n   * Action store\n   */\n  @Input() store: ActionStore;\n\n  /**\n   * Actionbar mode\n   */\n  @Input() mode: ActionbarMode = ActionbarMode.Dock;\n\n  /**\n   * Whether a toggle button should be displayed (Dock mode)\n   */\n  @Input() withToggleButton = false;\n\n  /**\n   * Whether a the actionbar should display buttons horizontally\n   */\n  @Input() horizontal = false;\n\n  /**\n   * Color\n   */\n  @Input() color = 'default';\n\n  /**\n   * Color of the button if action mode === overlay\n   */\n  @Input() iconColor = 'default';\n\n  /**\n   * Whether action titles are displayed\n   */\n  @Input() withTitle = true;\n\n  /**\n   * Whether action tooltips are displayed\n   */\n  @Input() withTooltip = true;\n\n  /**\n   * Whether action titles are displayed (condition for scroll button)\n   */\n  @Input() scrollActive = true;\n\n  /**\n   * Whether action icons are displayed\n   */\n  @Input() withIcon = true;\n\n  /**\n   * Which icon want to be shown\n   */\n  @Input() icon = 'dots-horizontal';\n\n  /**\n   * Overlay X position\n   */\n  @Input() xPosition = 'before';\n\n  /**\n   * Overlay Y position\n   */\n  @Input() yPosition = 'above';\n\n  /**\n   * Class to add to the actionbar overlay\n   */\n  @Input()\n  set overlayClass(value: string) {\n    this._overlayClass = value;\n  }\n  get overlayClass(): string {\n    return [this._overlayClass, 'igo-actionbar-overlay'].join(' ');\n  }\n  private _overlayClass = '';\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.with-title')\n  get withTitleClass() {\n    return this.withTitle;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.with-icon')\n  get withIconClass() {\n    return this.withIcon;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.horizontal')\n  get horizontalClass() {\n    return this.horizontal;\n  }\n\n  get heightCondition(): boolean {\n    const el = this.elRef.nativeElement;\n    if (this.scrollActive === false) {\n      if (el.clientHeight < el.scrollHeight) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  get positionConditionTop(): boolean {\n    if (this.elRef.nativeElement.scrollTop === 0) {\n      return false;\n    }\n    return true;\n  }\n\n  get positionConditionLow(): boolean {\n    const el = this.elRef.nativeElement;\n    if (el.scrollTop >= (el.scrollHeight - el.clientHeight)) {\n      return false;\n    }\n    return true;\n  }\n\n  get isDesktop(): boolean {\n    return this.mediaService.getMedia() === Media.Desktop;\n  }\n\n  constructor(\n    public overlay: Overlay,\n    private elRef: ElementRef,\n    private cdRef: ChangeDetectorRef,\n    public mediaService: MediaService) {}\n\n  /**\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const store = changes.store;\n    if (store && store.currentValue !== store.previousValue) {\n      if (this.watcher !== undefined) {\n        this.watcher.destroy();\n      }\n      this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n    }\n  }\n\n  /**\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n  }\n\n  /**\n   * Invoke the action handler\n   * @internal\n   */\n  onTriggerAction(action: Action) {\n    const args = action.args || [];\n    action.handler(...args);\n  }\n\n  scrollDown() {\n    this.elRef.nativeElement.scrollBy(0, 52);\n  }\n\n  scrollUp() {\n    this.elRef.nativeElement.scrollBy(0, -52);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { ActionbarComponent } from './actionbar.component';\nimport { ActionbarItemComponent } from './actionbar-item.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatMenuModule,\n    MatListModule,\n    MatCardModule,\n    MatCheckboxModule\n  ],\n  exports: [ActionbarComponent],\n  declarations: [ActionbarComponent, ActionbarItemComponent]\n})\nexport class IgoActionbarModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoActionbarModule } from './actionbar/actionbar.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoActionbarModule\n  ],\n  exports: [\n    IgoActionbarModule\n  ],\n  declarations: [],\n  providers: []\n})\nexport class IgoActionModule {}\n","import { Directive, Input, ElementRef, OnInit } from '@angular/core';\nimport { MatIconRegistry } from '@angular/material/icon';\n\n\n/**\n * This directive allow to add an icon inside a matBadge.\n * A value must be set into the matBadge directive ex: matBadge=\"icon\".\n * The badge content will be overrided by this current directive.\n */\n@Directive({\n  selector: '[igoMatBadgeIcon]'\n})\nexport class IgoBadgeIconDirective implements OnInit {\n  @Input()\n  set igoMatBadgeIcon(value: string) {\n    this.matIconRegistry.getNamedSvgIcon(value).subscribe((svgObj) => {\n      this.svg = svgObj;\n      this.updateSvg();\n    });\n  }\n  private svg: SVGElement;\n\n  @Input()\n  set matBadgeHidden(value: boolean) {\n    this.hidden = value;\n    this.updateHidden();\n  }\n  private hidden = false;\n\n  @Input()\n  set matBadgeDisabled(value: boolean) {\n    this.disabled = value;\n    this.updateDisabled();\n  }\n  private disabled = false;\n\n  @Input()\n  set igoMatBadgeInverseColor(value: boolean) {\n    this.inverseColor = value;\n    this.updateColor();\n  }\n  private inverseColor = false;\n\n  @Input()\n  set igoMatBadgeInheritColor(value: boolean) {\n    this.inheritColor = value;\n    this.updateColor();\n  }\n  private inheritColor = false;\n\n  get badge() {\n    return this.el.nativeElement.querySelector('.mat-badge-content');\n  }\n\n  private originalColor: string;\n\n  constructor(\n    private el: ElementRef,\n    private matIconRegistry: MatIconRegistry\n  ) {}\n\n  ngOnInit() {\n    this.badge.style.alignItems = 'center';\n    this.badge.style.justifyContent = 'center';\n\n    this.updateHidden();\n    this.updateColor();\n    this.updateSvg();\n  }\n\n  private updateSvg() {\n    if (!this.badge) {\n      return;\n    }\n    this.badge.innerHTML = '';\n    if (this.svg) {\n      this.badge.appendChild(this.svg);\n    }\n  }\n  private updateColor() {\n    if (!this.badge) {\n      return;\n    }\n\n    if (this.inheritColor) {\n      if (this.inverseColor) {\n        this.badge.style.color = 'currentColor';\n        this.badge.style.background = 'none';\n      } else {\n        this.badge.style.color = '';\n        this.badge.style.background = 'currentColor';\n      }\n    } else {\n      if (this.inverseColor) {\n        this.badge.style.color = window\n          .getComputedStyle(this.badge, null)\n          .getPropertyValue('background-color');\n        this.badge.style.background = 'none';\n      } else {\n        this.badge.style.color = '';\n        this.badge.style.background = '';\n      }\n    }\n    this.originalColor = this.badge.style.color;\n    this.updateDisabled();\n  }\n\n  private updateHidden() {\n    if (!this.badge) {\n      return;\n    }\n    this.badge.style.display = this.hidden ? 'none' : 'flex';\n  }\n\n  private updateDisabled() {\n    if (!this.badge || !this.inverseColor) {\n      return;\n    }\n    if (this.disabled) {\n      this.originalColor = this.badge.style.color;\n      this.badge.style.color = '#b9b9b9';\n    } else {\n      this.badge.style.color = this.originalColor;\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { IgoBadgeIconDirective } from './badge-icon.directive';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatIconModule } from '@angular/material/icon';\n\n@NgModule({\n  imports: [MatBadgeModule, MatIconModule],\n  declarations: [IgoBadgeIconDirective],\n  exports: [MatBadgeModule, IgoBadgeIconDirective]\n})\nexport class IgoMatBadgeIconModule {\n  static forRoot(): ModuleWithProviders<IgoMatBadgeIconModule> {\n    return {\n      ngModule: IgoMatBadgeIconModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Output\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoClickout]'\n})\nexport class ClickoutDirective {\n  @Output() clickout = new EventEmitter<MouseEvent>();\n\n  @HostListener('document:click', ['$event', '$event.target'])\n  handleMouseClick(event: MouseEvent, target: HTMLElement) {\n    if (!target) {\n      return;\n    }\n\n    if (!this.el.nativeElement.contains(target)) {\n      this.clickout.emit(event);\n    }\n  }\n\n  constructor(private el: ElementRef) {}\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { ClickoutDirective } from './clickout.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [ClickoutDirective],\n  exports: [ClickoutDirective]\n})\nexport class IgoClickoutModule {\n  static forRoot(): ModuleWithProviders<IgoClickoutModule> {\n    return {\n      ngModule: IgoClickoutModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  HostListener,\n  ElementRef,\n  Renderer2\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoCollapse]'\n})\nexport class CollapseDirective {\n  @Input()\n  get target() {\n    return this._target;\n  }\n  set target(value: Element) {\n    this._target = value;\n  }\n  private _target: Element;\n\n  @Input()\n  get collapsed(): boolean {\n    return this._collapsed;\n  }\n  set collapsed(collapsed: boolean) {\n    collapsed ? this.collapseTarget() : this.expandTarget();\n    this._collapsed = collapsed;\n    this.toggle.emit(collapsed);\n  }\n  private _collapsed = false;\n\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\n\n  @HostListener('click')\n  click() {\n    this.collapsed = !this.collapsed;\n  }\n\n  constructor(private renderer: Renderer2, private el: ElementRef) {}\n\n  private collapseTarget() {\n    this.renderer.addClass(this.target, 'igo-collapsed');\n    this.renderer.addClass(this.el.nativeElement, 'collapsed');\n  }\n\n  private expandTarget() {\n    this.renderer.removeClass(this.target, 'igo-collapsed');\n    this.renderer.removeClass(this.el.nativeElement, 'collapsed');\n  }\n}\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\n\n@Component({\n  selector: 'igo-collapsible',\n  templateUrl: './collapsible.component.html',\n  styleUrls: ['./collapsible.component.scss']\n})\nexport class CollapsibleComponent {\n  @Input()\n  get title() {\n    return this._title;\n  }\n  set title(value: string) {\n    this._title = value;\n  }\n  private _title = '';\n\n  @Input()\n  get collapsed() {\n    return this._collapsed;\n  }\n  set collapsed(value: boolean) {\n    this._collapsed = value;\n    this.toggle.emit(value);\n  }\n  private _collapsed = false;\n\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\n}\n","<mat-list-item>\n  <mat-icon\n    svgIcon=\"chevron-up\" \n    class=\"igo-chevron\"\n    mat-list-avatar\n    igoCollapse\n    [target]=\"content\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"collapsed = $event\">\n  </mat-icon>\n  <h4 matLine>{{title}}</h4>\n</mat-list-item>\n\n<div #content>\n  <ng-content></ng-content>\n</div>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { CollapseDirective } from './collapse.directive';\nimport { CollapsibleComponent } from './collapsible.component';\n\n@NgModule({\n  imports: [MatIconModule, MatListModule],\n  declarations: [CollapsibleComponent, CollapseDirective],\n  exports: [CollapsibleComponent, CollapseDirective]\n})\nexport class IgoCollapsibleModule {\n  static forRoot(): ModuleWithProviders<IgoCollapsibleModule> {\n    return {\n      ngModule: IgoCollapsibleModule,\n      providers: []\n    };\n  }\n}\n","import { Component } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\n@Component({\n  selector: 'igo-confirm-dialog',\n  templateUrl: './confirm-dialog.component.html',\n  styleUrls: ['./confirm-dialog.component.scss']\n})\nexport class ConfirmDialogComponent {\n  public confirmMessage: string;\n\n  constructor(public dialogRef: MatDialogRef<ConfirmDialogComponent>) {}\n}\n","<h2 mat-dialog-title class=\"mat-typography\">{{'igo.common.confirmDialog.title' |translate}}</h2>\n<div mat-dialog-content class=\"mat-typography\">{{confirmMessage}}</div>\n<div mat-dialog-actions>\n  <button mat-button color=\"primary\" (click)=\"dialogRef.close(true)\">{{'igo.common.confirmDialog.confirmBtn' | translate}}</button>\n  <button mat-button (click)=\"dialogRef.close(false)\">{{'igo.common.confirmDialog.cancelBtn' |translate}}</button>\n</div>\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { Observable } from 'rxjs';\n\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\n\n@Injectable()\nexport class ConfirmDialogService {\n  constructor(private dialog: MatDialog) {}\n\n  public open(message: string): Observable<any> {\n    const dialogRef = this.dialog.open(ConfirmDialogComponent, {\n      disableClose: false\n    });\n    dialogRef.componentInstance.confirmMessage = message;\n\n    return dialogRef.afterClosed();\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\nimport { ConfirmDialogService } from './confirm-dialog.service';\n\n@NgModule({\n  imports: [MatButtonModule, MatDialogModule, IgoLanguageModule],\n  declarations: [ConfirmDialogComponent],\n  exports: [ConfirmDialogComponent],\n  providers: [ConfirmDialogService]\n})\nexport class IgoConfirmDialogModule {\n  static forRoot(): ModuleWithProviders<IgoConfirmDialogModule> {\n    return {\n      ngModule: IgoConfirmDialogModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Input,\n  Output,\n  ViewContainerRef\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { TemplatePortal } from '@angular/cdk/portal';\nimport { fromEvent, Subscription } from 'rxjs';\nimport { filter, take } from 'rxjs/operators';\nimport { Overlay, OverlayRef } from '@angular/cdk/overlay';\n\n@Directive({\n  selector: '[igoContextMenu]'\n})\nexport class ContextMenuDirective {\n  private overlayRef: OverlayRef | null;\n  private sub: Subscription;\n\n  @Input('igoContextMenu') menuContext: TemplateRef<any>;\n  @Output() menuPosition = new EventEmitter<{ x: number; y: number }>();\n\n  constructor(\n    public overlay: Overlay,\n    public viewContainerRef: ViewContainerRef,\n    private elementRef: ElementRef\n  ) {}\n\n  @HostListener('contextmenu', ['$event'])\n  public onContextMenu(e: MouseEvent): void {\n    const {x, y} = e;\n    this.close();\n    e.preventDefault();\n    this.menuPosition.emit({ x, y });\n    this.overlayRef = null;\n    const positionStrategy = this.overlay\n      .position()\n      .flexibleConnectedTo({ x, y })\n      .withPositions([\n        {\n          originX: 'end',\n          originY: 'bottom',\n          overlayX: 'start',\n          overlayY: 'top'\n        }\n      ]);\n    this.overlayRef = this.overlay.create({\n      positionStrategy,\n      scrollStrategy: this.overlay.scrollStrategies.close()\n    });\n    this.overlayRef.attach(\n      new TemplatePortal(this.menuContext, this.viewContainerRef, {\n        $implicit: undefined\n      })\n    );\n\n    this.sub = fromEvent<MouseEvent>(document, 'click')\n      .pipe(\n        filter(event => {\n          const clickTarget = event.target as HTMLElement;\n          this.close();\n          return (\n            !!this.overlayRef &&\n            !this.overlayRef.overlayElement.contains(clickTarget)\n          );\n        }),\n        take(1)\n      )\n      .subscribe(() => this.close());\n\n    this.sub = fromEvent<MouseEvent>(document, 'contextmenu')\n      .pipe(\n        filter(event => {\n          const clickTarget = event.target as HTMLElement;\n          if (\n            clickTarget &&\n            !this.elementRef.nativeElement.contains(clickTarget) &&\n            !this.overlayRef.overlayElement.contains(clickTarget)\n          ) {\n            return true;\n          } else {\n            event.preventDefault();\n          }\n        }),\n        take(1)\n      )\n      .subscribe(() => this.close());\n  }\n\n  close() {\n    if (this.overlayRef) {\n      this.overlayRef.dispose();\n      this.overlayRef = null;\n    }\n    if (this.sub) {\n      this.sub.unsubscribe();\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { ContextMenuDirective } from './context-menu.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [ContextMenuDirective],\n  exports: [ContextMenuDirective]\n})\nexport class IgoContextMenuModule {\n  static forRoot(): ModuleWithProviders<IgoContextMenuModule> {\n    return {\n      ngModule: IgoContextMenuModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { CustomHtmlComponent } from './custom-html.component';\nimport { SanitizeHtmlPipe } from './custom-html.pipe';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatInputModule,\n    MatButtonModule,\n    IgoLanguageModule\n  ],\n  exports: [SanitizeHtmlPipe, CustomHtmlComponent],\n  declarations: [SanitizeHtmlPipe, CustomHtmlComponent]\n})\nexport class IgoCustomHtmlModule {\n  static forRoot(): ModuleWithProviders<IgoCustomHtmlModule> {\n    return {\n      ngModule: IgoCustomHtmlModule\n    };\n  }\n}\n","import { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { catchError, map } from 'rxjs/operators';\nimport { throwError } from 'rxjs';\n\nimport { DOMOptions, DOMValue } from './dom.interfaces';\nimport { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DOMService {\n\n  constructor(private http: HttpClient) {}\n\n  async getDom(dom: DOMOptions): Promise<DOMValue[]> {\n    const url = dom.url;\n    let result: DOMValue[];\n\n    await this.http.get<any>(url).pipe(\n      map(response => {\n        result = response;\n        return response;\n      }),\n      catchError((err: HttpErrorResponse) => {\n        return throwError(err);\n      })\n    ).toPromise();\n\n    return result;\n  }\n\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { DOMService } from './dom.service';\n\n@NgModule({\n  providers: [DOMService]\n})\nexport class IgoDOMModule {\n  static forRoot(): ModuleWithProviders<IgoDOMModule> {\n    return {\n      ngModule: IgoDOMModule,\n      providers: [\n        DOMService\n      ]\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { DragAndDropDirective } from './drag-drop.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [DragAndDropDirective],\n  exports: [DragAndDropDirective]\n})\nexport class IgoDrapDropModule {\n  static forRoot(): ModuleWithProviders<IgoDrapDropModule> {\n    return {\n      ngModule: IgoDrapDropModule,\n      providers: []\n    };\n  }\n}\n","import {\n  ComponentFactory,\n  ComponentRef,\n  ViewContainerRef\n} from '@angular/core';\n\nimport { Observable, Subscription } from 'rxjs';\n\n/**\n * This class is used in the DynamicComponentOutlet component. It holds\n * a reference to a component factory and can render that component\n * in a target element on demand. It's also possible to set inputs\n * and to subscribe to outputs.\n */\nexport class DynamicComponent<C> {\n\n  /**\n   * Component reference\n   */\n  private componentRef: ComponentRef<C>;\n\n  /**\n   * Subscriptions to the component's outputs. Those need\n   * to be unsubscribed when the component is destroyed.\n   */\n  private subscriptions: Subscription[] = [];\n\n  /**\n   * Component target element\n   */\n  private target: ViewContainerRef;\n\n  /**\n   * Component inputs\n   */\n  private inputs: {[key: string]: any} = {};\n\n  /**\n   * Subscriptions to the component's async inputs\n   */\n  private inputs$$: {[key: string]: Subscription} = {};\n\n  /**\n   * Subscribers to the component's outputs\n   */\n  private subscribers: {[key: string]: (event: any) => void} = {};\n\n  constructor(private componentFactory: ComponentFactory<C>) {}\n\n  /**\n   * Render the component to a target element.\n   * Set it's inputs and subscribe to it's outputs.\n   * @param target Target element\n   */\n  setTarget(target: ViewContainerRef) {\n    this.target = target;\n    this.componentRef = target.createComponent(this.componentFactory);\n    this.updateInputs(this.inputs);\n    this.updateSubscribers(this.subscribers);\n  }\n\n  /**\n   * Destroy this component. That means, removing from it's target\n   * element and unsubscribing to it's outputs.\n   */\n  destroy() {\n    if (this.target !== undefined) {\n      this.target.clear();\n    }\n    if (this.componentRef !== undefined) {\n      this.componentRef.destroy();\n      this.componentRef = undefined;\n    }\n    this.unobserveAllInputs();\n    this.unsubscribeAll();\n  }\n\n  /**\n   * Update the component inputs. This is an update so any\n   * key not defined won't be overwritten.\n   */\n  updateInputs(inputs: {[key: string]: any}) {\n    this.inputs = inputs;\n    if (this.componentRef === undefined) {\n      return;\n    }\n\n    const instance = this.componentRef.instance;\n    const allowedInputs = this.componentFactory.inputs;\n    allowedInputs.forEach((value: {propName: string; templateName: string; }) => {\n      const key = value.propName;\n\n      this.unobserveInput(key);\n\n      const inputValue = inputs[key];\n      if (inputs.hasOwnProperty(key)) {\n        if (inputValue instanceof Observable) {\n          this.observeInput(key, inputValue);\n        } else {\n          this.setInputValue(instance, key, inputValue);\n        }\n      }\n    });\n\n    if (typeof (instance as any).onUpdateInputs === 'function') {\n      (instance as any).onUpdateInputs();\n    }\n  }\n\n  /**\n   * Set an instance's input value\n   * @param instance Component instance\n   * @param key Input key\n   * @param value Input value\n   */\n  private setInputValue(instance: C, key: string, value: any) {\n    const currentValue = instance[key];\n    if (value === currentValue) {\n      return;\n    }\n\n    const prototype = Object.getPrototypeOf(instance);\n    const descriptor = Object.getOwnPropertyDescriptor(prototype, key);\n    if (descriptor !== undefined && descriptor.set !== undefined) {\n      descriptor.set.call(instance, value);\n    } else {\n      instance[key] = value;\n    }\n  }\n\n  /**\n   * Update the component subscribers. This is an update so any\n   * key not defined won't be overwritten.\n   */\n  updateSubscribers(subscribers: {[key: string]: (event: any) => void}) {\n    this.subscribers = subscribers;\n    if (this.componentRef === undefined) {\n      return;\n    }\n\n    const instance = this.componentRef.instance;\n    const allowedSubscribers = this.componentFactory.outputs;\n    allowedSubscribers.forEach((value: {propName: string; templateName: string; }) => {\n      const key = value.propName;\n      if (subscribers.hasOwnProperty(key)) {\n        const emitter = instance[key];\n        const subscriber = subscribers[key];\n        if (Array.isArray(subscriber)) {\n          subscriber.forEach((_subscriber) => {\n            this.subscriptions.push(emitter.subscribe(_subscriber));\n          });\n        } else {\n          this.subscriptions.push(emitter.subscribe(subscriber));\n        }\n      }\n    });\n  }\n\n  /**\n   * Subscribe to an observable input and update the component's input value\n   * accordingly\n   * @param key Input key\n   * @param observable Observable\n   */\n  private observeInput(key: string, observable: Observable<any>) {\n    this.inputs$$[key] = observable.subscribe((value: any) => {\n      const instance = this.componentRef.instance;\n      this.setInputValue(instance, key, value);\n\n      if (typeof (instance as any).onUpdateInputs === 'function') {\n        (instance as any).onUpdateInputs();\n      }\n    });\n  }\n\n  /**\n   * Unsubscribe to an observable input\n   * @param key Input key\n   */\n  private unobserveInput(key: string) {\n    if (this.inputs$$[key] !== undefined) {\n      this.inputs$$[key].unsubscribe();\n      this.inputs$$[key] = undefined;\n    }\n  }\n\n  /**\n   * Unsubscribe to all outputs.\n   */\n  private unobserveAllInputs() {\n    Object.values(this.inputs$$).forEach((s: Subscription | undefined) => {\n      if (s !== undefined) {\n        s.unsubscribe();\n      }\n    });\n    this.inputs$$ = {};\n  }\n\n  /**\n   * Unsubscribe to all outputs.\n   */\n  private unsubscribeAll() {\n    this.subscriptions.forEach((s: Subscription) => s.unsubscribe());\n    this.subscriptions = [];\n  }\n\n}\n","import {\n  ComponentFactoryResolver,\n  Injectable\n} from '@angular/core';\n\nimport { DynamicComponent } from './dynamic-component';\n\n/**\n * Service to creates DynamicComponent instances from base component classes\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DynamicComponentService {\n\n  constructor(private resolver: ComponentFactoryResolver) {}\n\n  /**\n   * Creates a DynamicComponent instance from a base component class\n   * @param componentCls The component class\n   * @returns DynamicComponent instance\n   */\n  create(componentCls: any): DynamicComponent<any> {\n    const factory = this.resolver.resolveComponentFactory(componentCls as any);\n    return new DynamicComponent<typeof componentCls>(factory);\n  }\n}\n","import {\n  Input,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy,\n  Component,\n  OnChanges,\n  OnDestroy,\n  SimpleChanges,\n  ViewContainerRef,\n  ViewChild\n} from '@angular/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { DynamicComponent } from '../shared/dynamic-component';\nimport { DynamicComponentService } from '../shared/dynamic-component.service';\n\n@Component({\n  selector: 'igo-dynamic-outlet',\n  templateUrl: 'dynamic-outlet.component.html',\n  styleUrls: ['dynamic-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DynamicOutletComponent implements OnChanges, OnDestroy {\n  /**\n   * The dynamic component base class or the dynamic component itself\n   */\n  @Input() component: DynamicComponent<any> | any;\n\n  /**\n   * The dynamic component inputs\n   */\n  @Input() inputs: { [key: string]: any } = {};\n\n  /**\n   * The subscribers to the dynamic component outputs\n   */\n  @Input() subscribers: { [key: string]: (event: any) => void } = {};\n\n  /**\n   * The dynamic component\n   */\n  private dynamicComponent: DynamicComponent<any>;\n\n  /**\n   * The view element to render the component to\n   * @ignore\n   */\n  @ViewChild('target', { read: ViewContainerRef, static: true })\n  private target: ViewContainerRef;\n\n  constructor(\n    private dynamicComponentService: DynamicComponentService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * If the dynamic component changes, create it.\n   * If the inputs or subscribers change, update the current component's\n   * inputs or subscribers.\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const component = changes.component;\n    const inputs = changes.inputs;\n    const subscribers = changes.subscribers;\n    const eq = ObjectUtils.objectsAreEquivalent;\n\n    if (!component || !component.currentValue) {\n      return;\n    }\n\n    if (component.currentValue !== component.previousValue) {\n      this.createComponent(component.currentValue);\n    } else {\n      const inputsAreEquivalents =\n        inputs && eq(inputs.currentValue || {}, inputs.previousValue || {});\n      const subscribersAreEquivalents =\n        subscribers &&\n        eq(subscribers.currentValue || {}, subscribers.previousValue || {});\n\n      if (inputsAreEquivalents === false) {\n        this.updateInputs();\n      }\n\n      if (subscribersAreEquivalents === false) {\n        this.updateSubscribers();\n      }\n    }\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * Destroy the dynamic component and all it's subscribers\n   * @internal\n   */\n  ngOnDestroy() {\n    if (this.dynamicComponent) {\n      this.dynamicComponent.destroy();\n    }\n  }\n\n  /**\n   * Create a  DynamicComponent out of the component class and render it.\n   * @internal\n   */\n  private createComponent(component: DynamicComponent<any> | any) {\n    if (this.dynamicComponent !== undefined) {\n      this.dynamicComponent.destroy();\n    }\n    this.dynamicComponent =\n      component instanceof DynamicComponent\n        ? component\n        : this.dynamicComponentService.create(component);\n    this.renderComponent();\n  }\n\n  /**\n   * Create and render the dynamic component. Set it's inputs and subscribers\n   * @internal\n   */\n  private renderComponent() {\n    this.updateInputs();\n    this.updateSubscribers();\n    this.dynamicComponent.setTarget(this.target);\n  }\n\n  /**\n   * Update the dynamic component inputs. This is an update so any\n   * key not defined won't be overwritten.\n   * @internal\n   */\n  private updateInputs() {\n    this.dynamicComponent.updateInputs(this.inputs);\n  }\n\n  /**\n   * Update the dynamic component subscribers. This is an update so any\n   * key not defined won't be overwritten.\n   * @internal\n   */\n  private updateSubscribers() {\n    this.dynamicComponent.updateSubscribers(this.subscribers);\n  }\n}\n","<ng-template #target></ng-template>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { DynamicOutletComponent } from './dynamic-outlet.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    DynamicOutletComponent\n  ],\n  declarations: [\n    DynamicOutletComponent\n  ]\n})\nexport class IgoDynamicOutletModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoDynamicOutletModule } from './dynamic-outlet/dynamic-outlet.module';\nimport { DynamicComponentService } from './shared/dynamic-component.service';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoDynamicOutletModule\n  ],\n  exports: [\n    IgoDynamicOutletModule\n  ],\n  providers: [\n    DynamicComponentService\n  ]\n})\nexport class IgoDynamicComponentModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { FlexibleComponent } from './flexible.component';\n\n@NgModule({\n  imports: [],\n  declarations: [FlexibleComponent],\n  exports: [FlexibleComponent]\n})\nexport class IgoFlexibleModule {\n  static forRoot(): ModuleWithProviders<IgoFlexibleModule> {\n    return {\n      ngModule: IgoFlexibleModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  OnChanges,\n  SimpleChanges,\n  ChangeDetectionStrategy,\n  ViewChild,\n  ElementRef\n} from '@angular/core';\n\nimport t from 'typy';\n\nimport { Form, FormField, FormFieldGroup } from '../shared/form.interfaces';\nimport { getAllFormFields } from '../shared/form.utils';\n\n/**\n * A configurable form\n */\n@Component({\n  selector: 'igo-form',\n  templateUrl: './form.component.html',\n  styleUrls: ['./form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormComponent implements OnChanges {\n\n  /**\n   * Form\n   */\n  @Input() form: Form;\n\n  /**\n   * Input data\n   */\n  @Input() formData: { [key: string]: any};\n\n  /**\n   * Form autocomplete\n   */\n  @Input() autocomplete: string = 'off';\n\n  /**\n   * Event emitted when the form is submitted\n   */\n  @Output() submitForm = new EventEmitter<{[key: string]: any}>();\n\n  @ViewChild('buttons', { static: true }) buttons: ElementRef;\n\n  get hasButtons(): boolean {\n    return this.buttons.nativeElement.children.length !== 0;\n  }\n\n  constructor() {}\n\n  /**\n   * Is the entity or the template change, recreate the form or repopulate it.\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const formData = changes.formData;\n    if (formData && formData.currentValue !== formData.previousValue) {\n      if (formData.currentValue === undefined) {\n        this.clear();\n      } else {\n        this.setData(formData.currentValue);\n      }\n    }\n  }\n\n  /**\n   * Transform the form data to a feature and emit an event\n   * @param event Form submit event\n   * @internal\n   */\n  onSubmit() {\n    this.submitForm.emit(this.getData());\n  }\n\n  getData(): { [key: string]: any} {\n    const data = {};\n    getAllFormFields(this.form).forEach((field: FormField) => {\n      this.updateDataWithFormField(data, field);\n    });\n    return data;\n  }\n\n  private setData(data: {[key: string]: any}) {\n    this.form.fields.forEach((field: FormField) => {\n      field.control.setValue(t(data, field.name).safeObject);\n    });\n\n    this.form.groups.forEach((group: FormFieldGroup) => {\n      group.fields.forEach((field: FormField) => {\n        field.control.setValue(t(data, field.name).safeObject);\n      });\n    });\n  }\n\n  private updateDataWithFormField(data: { [key: string]: any}, field: FormField) {\n    const control = field.control;\n    if (!control.disabled) {\n      data[field.name] = control.value;\n    }\n  }\n\n  /**\n   * Clear form\n   */\n  private clear() {\n    this.form.control.reset();\n  }\n\n}\n","import { AbstractControl } from '@angular/forms';\n\nimport { Form, FormField, FormFieldGroup } from './form.interfaces';\n\nexport function formControlIsRequired(control: AbstractControl): boolean {\n  if (control.validator) {\n    const validator = control.validator({} as AbstractControl);\n    if (validator && validator.required) {\n      return true;\n    }\n  }\n\n  if ((control as any).controls) {\n    const requiredControl = Object.keys((control as any).controls).find((key: string) => {\n      return formControlIsRequired((control as any).controls[key]);\n    });\n    return requiredControl !== undefined;\n  }\n\n  return false;\n}\n\nexport function getDefaultErrorMessages(): {[key: string]: string} {\n  return {\n    required: 'igo.common.form.errors.required'\n  };\n}\n\nexport function getControlErrorMessage(control: AbstractControl, messages: {[key: string]: string}): string {\n  const errors = control.errors || {};\n  const errorKeys = Object.keys(errors);\n  const errorMessages = errorKeys\n    .map((key: string) => messages[key])\n    .filter((message: string) => message !== undefined);\n  return errorMessages.length > 0 ? errorMessages[0] : '';\n}\n\nexport function getAllFormFields(form: Form): FormField[] {\n  return form.groups.reduce((acc: FormField[], group: FormFieldGroup) => {\n    return acc.concat(group.fields);\n  }, [].concat(form.fields));\n}\n\nexport function getFormFieldByName(form: Form, name: string): FormField {\n  const fields = getAllFormFields(form);\n  return fields.find((field: FormField) => {\n    return field.name === name;\n  });\n}\n","\n<form\n  [autocomplete]=\"autocomplete\"\n  [formGroup]=\"form.control\"\n  (ngSubmit)=\"onSubmit()\">\n  <div class=\"igo-form-body\" [ngClass]=\"{'igo-form-body-with-buttons': hasButtons}\">\n    <div class=\"igo-form-content\">\n      <ng-content></ng-content>\n    </div>\n    <div #buttons class=\"igo-form-buttons\">\n      <ng-content select=\"[formButtons]\"></ng-content>\n    </div>\n  </div>\n</form>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { FormComponent } from './form.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule\n  ],\n  exports: [\n    FormComponent,\n    FormsModule,\n    ReactiveFormsModule\n  ],\n  declarations: [\n    FormComponent\n  ]\n})\nexport class IgoFormFormModule {}\n","import { Injectable } from '@angular/core';\nimport { FormBuilder, Validators, ValidatorFn } from '@angular/forms';\n\nimport {\n  Form,\n  FormField,\n  FormFieldConfig,\n  FormFieldGroup,\n  FormFieldGroupConfig\n} from './form.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FormService {\n\n  constructor(private formBuilder: FormBuilder) {}\n\n  form(fields: FormField[], groups: FormFieldGroup[]): Form {\n    const control = this.formBuilder.group({});\n    fields.forEach((field: FormField) => {\n      control.addControl(field.name, field.control);\n    });\n    groups.forEach((group: FormFieldGroup) => {\n      control.addControl(group.name, group.control);\n    });\n\n    return {fields, groups, control};\n  }\n\n  group(config: FormFieldGroupConfig, fields: FormField[]): FormFieldGroup {\n    const options = config.options || {};\n    const control = this.formBuilder.group({});\n    fields.forEach((field: FormField) => {\n      control.addControl(field.name, field.control);\n    });\n\n    if (options.validator) {\n      const validators = this.getValidators(options.validator); // convert string to actual validator\n      control.setValidators(validators);\n    }\n\n    return Object.assign({}, config, {fields, control}) as FormFieldGroup;\n  }\n\n  field(config: FormFieldConfig): FormField {\n    const options = config.options || {};\n    const state = {\n      value: '',\n      disabled: options.disabled\n    };\n    const control = this.formBuilder.control(state);\n\n    if (options.validator) {\n      const validators = this.getValidators(options.validator); // convert string to actual validator\n      control.setValidators(validators);\n    }\n\n    return Object.assign({type: 'text'}, config, {control}) as FormField;\n  }\n\n  extendFieldConfig(config: FormFieldConfig, partial: Partial<FormFieldConfig>): FormFieldConfig {\n    const options = Object.assign({}, config.options || {}, partial.options || {});\n    const inputs = Object.assign({}, config.inputs || {}, partial.inputs || {});\n    const subscribers = Object.assign({}, config.subscribers || {}, partial.subscribers || {});\n    return Object.assign({}, config, {options, inputs, subscribers});\n  }\n\n  private getValidators(validatorOption: string | string[] | ValidatorFn): ValidatorFn | ValidatorFn[] {\n    if (Array.isArray(validatorOption)) {\n      return validatorOption.map((validatorStr) => {\n        return this.getValidator(validatorStr);\n      });\n    }\n\n    return this.getValidator(validatorOption);\n  }\n\n  private getValidator(validatorStr: string | ValidatorFn): ValidatorFn {\n    if (typeof validatorStr !== 'string') {\n      return validatorStr;\n    }\n\n    // regex pattern to extract arguments from string for e.g applying on \"minLength(8)\" would extract 8\n    const re = /^([a-zA-Z]{3,15})\\((.{0,20})\\)$/;\n    const match = validatorStr.match(re);\n\n    if (!match) {\n      return Validators[validatorStr];\n    }\n\n    const name = match[1];\n    const args = match[2];\n    return Validators[name](args);\n  }\n\n}\n","import { Injectable } from '@angular/core';\n\n/**\n * Service where all available form fields are registered.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class FormFieldService {\n\n  static fields: {[key: string]: any} = {};\n\n  static register(type: string, component: any) {\n    FormFieldService.fields[type] = component;\n  }\n\n  constructor() {}\n\n  /**\n   * Return field component by type\n   * @param type Field type\n   * @returns Field component\n   */\n  getFieldByType(type: string): any {\n    return FormFieldService.fields[type];\n  }\n\n}\n","\n\n<ng-container *ngIf=\"field !== undefined\">\n  <igo-dynamic-outlet\n    [component]=\"getFieldComponent()\"\n    [inputs]=\"getFieldInputs()\"\n    [subscribers]=\"getFieldSubscribers()\">\n  </igo-dynamic-outlet>\n</ng-container>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { FormField, FormFieldInputs, FormFieldOptions } from '../shared/form.interfaces';\nimport { FormFieldService } from '../shared/form-field.service';\nimport { getDefaultErrorMessages } from '../shared';\n\n/**\n * This component renders the proper form input based on\n * the field configuration it receives.\n */\n@Component({\n  selector: 'igo-form-field',\n  templateUrl: './form-field.component.html',\n  styleUrls: ['./form-field.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormFieldComponent {\n\n  /**\n   * Field configuration\n   */\n  @Input() field: FormField;\n\n  /**\n   * Field inputs cache\n   */\n  private fieldInputs: FormFieldInputs = undefined;\n\n  /**\n   * Field subscribers cache\n   */\n  private fieldSubscribers: {[key: string]: ({field: FormField, control: FormControl}) => void } = undefined;\n\n  get fieldOptions(): FormFieldOptions {\n    return this.field.options || {};\n  }\n\n  constructor(private formFieldService: FormFieldService) {}\n\n  getFieldComponent(): any {\n    return this.formFieldService.getFieldByType(this.field.type || 'text');\n  }\n\n  getFieldInputs(): FormFieldInputs {\n    if (this.fieldInputs !== undefined) {\n      return this.fieldInputs;\n    }\n\n    const errors = this.fieldOptions.errors || {};\n    this.fieldInputs = Object.assign(\n      {\n        placeholder: this.field.title,\n        disableSwitch: this.fieldOptions.disableSwitch || false\n      },\n      Object.assign({}, this.field.inputs || {}),\n      {\n        formControl: this.field.control,\n        errors: Object.assign({}, getDefaultErrorMessages(), errors)\n      }\n    );\n    return this.fieldInputs;\n  }\n\n  getFieldSubscribers(): {[key: string]: ({field: FormField, control: FormControl}) => void } {\n    if (this.fieldSubscribers !== undefined) {\n      return this.fieldSubscribers;\n    }\n\n    this.fieldSubscribers = Object.assign({}, this.field.subscribers || {});\n    return this.fieldSubscribers;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoDynamicOutletModule } from '../../dynamic-component/dynamic-outlet/dynamic-outlet.module';\n\nimport { FormFieldComponent } from './form-field.component';\nimport { FormFieldSelectComponent } from './form-field-select.component';\nimport { FormFieldTextComponent } from './form-field-text.component';\nimport { FormFieldTextareaComponent } from './form-field-textarea.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    IgoLanguageModule,\n    IgoDynamicOutletModule\n  ],\n  exports: [\n    FormFieldComponent,\n    FormFieldSelectComponent,\n    FormFieldTextComponent,\n    FormFieldTextareaComponent\n  ],\n  declarations: [\n    FormFieldComponent,\n    FormFieldSelectComponent,\n    FormFieldTextComponent,\n    FormFieldTextareaComponent\n  ]\n})\nexport class IgoFormFieldModule {}\n","<div\n  *ngIf=\"group && group.fields.length > 0\"\n  class=\"igo-form-group-fields\">\n  <div\n    *ngFor=\"let field of group.fields\"\n    class=\"igo-form-field-wrapper\"\n    [ngClass]=\"getFieldNgClass(field)\">\n    <igo-form-field [field]=\"field\"></igo-form-field>\n  </div>\n</div>\n\n<div class=\"igo-form-group-extra-content\">\n  <ng-content></ng-content>\n</div>\n\n<mat-error *ngIf=\"formControl.errors\">{{getErrorMessage() | translate}}</mat-error>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { FormGroup } from '@angular/forms';\n\nimport { getControlErrorMessage } from '../shared/form.utils';\nimport { FormField, FormFieldGroup } from '../shared/form.interfaces';\n\n/**\n * A configurable form, optionnally bound to an entity\n * (for example in case of un update). Submitting that form\n * emits an event with the form data but no other operation is performed.\n */\n@Component({\n  selector: 'igo-form-group',\n  templateUrl: './form-group.component.html',\n  styleUrls: ['./form-group.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormGroupComponent {\n\n  /**\n   * Form field group\n   */\n  @Input() group: FormFieldGroup;\n\n  /**\n   * Field placeholder\n   */\n  @Input() errors: {[key: string]: string};\n\n  /**\n   * Form group control\n   */\n  get formControl(): FormGroup { return this.group.control; }\n\n  constructor() {}\n\n  /**\n   * Return the number of columns a field should occupy.\n   * The maximum allowed is 2, even if the field config says more.\n   * @param field Field\n   * @returns Number of columns\n   * @internal\n   */\n  getFieldColSpan(field: FormField): number {\n    let colSpan = 2;\n    const options = field.options || {};\n    if (options.cols && options.cols > 0) {\n      colSpan = Math.min(options.cols, 2);\n    }\n\n    return colSpan;\n  }\n\n  /**\n   * Return the number of columns a field should occupy.\n   * The maximum allowed is 2, even if the field config says more.\n   * @param field Field\n   * @returns Number of columns\n   * @internal\n   */\n  getFieldNgClass(field: FormField): {[key: string]: boolean} {\n    const colspan = this.getFieldColSpan(field);\n    return {[`igo-form-field-colspan-${colspan}`]: true};\n  }\n\n  /**\n   * Get error message\n   */\n  getErrorMessage(): string {\n    const options = this.group.options || {};\n    return getControlErrorMessage(this.formControl, options.errors || {});\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatFormFieldModule } from '@angular/material/form-field';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoFormFieldModule } from '../form-field/form-field.module';\nimport { FormGroupComponent } from './form-group.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatFormFieldModule,\n    IgoLanguageModule,\n    IgoFormFieldModule\n  ],\n  exports: [\n    FormGroupComponent\n  ],\n  declarations: [\n    FormGroupComponent\n  ]\n})\nexport class IgoFormGroupModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFormFormModule } from './form/form.module';\nimport { IgoFormGroupModule } from './form-group/form-group.module';\nimport { IgoFormFieldModule } from './form-field/form-field.module';\nimport { FormService } from './shared/form.service';\nimport { FormFieldService } from './shared/form-field.service';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoFormGroupModule,\n    IgoFormFieldModule\n  ],\n  exports: [\n    IgoFormFormModule,\n    IgoFormGroupModule,\n    IgoFormFieldModule\n  ],\n  declarations: [],\n  providers: [\n    FormService,\n    FormFieldService\n  ]\n})\nexport class IgoFormModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { EntitySelectorComponent } from './entity-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    MatSelectModule\n  ],\n  exports: [EntitySelectorComponent],\n  declarations: [EntitySelectorComponent]\n})\nexport class IgoEntitySelectorModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { StopDropPropagationDirective } from './stop-drop-propagation.directive';\nimport { StopPropagationDirective } from './stop-propagation.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [StopDropPropagationDirective, StopPropagationDirective],\n  exports: [StopDropPropagationDirective, StopPropagationDirective]\n})\nexport class IgoStopPropagationModule {\n  static forRoot(): ModuleWithProviders<IgoStopPropagationModule> {\n    return {\n      ngModule: IgoStopPropagationModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { EntityTablePaginatorComponent } from './entity-table-paginator.component';\nimport { MatPaginatorModule } from '@angular/material/paginator';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    MatPaginatorModule,\n  ],\n  exports: [\n    EntityTablePaginatorComponent\n  ],\n  declarations: [\n    EntityTablePaginatorComponent,\n  ]\n})\nexport class IgoEntityTablePaginatorModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { SecureImagePipe } from './secure-image.pipe';\n\n@NgModule({\n  imports: [],\n  declarations: [SecureImagePipe],\n  exports: [SecureImagePipe]\n})\nexport class IgoImageModule {\n  static forRoot(): ModuleWithProviders<IgoImageModule> {\n    return {\n      ngModule: IgoImageModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSortModule } from '@angular/material/sort';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\n\nimport { IgoStopPropagationModule } from '../../stop-propagation/stop-propagation.module';\nimport { IgoCustomHtmlModule } from '../../custom-html/custom-html.module';\nimport { EntityTableRowDirective } from './entity-table-row.directive';\nimport { EntityTableComponent } from './entity-table.component';\nimport { MatPaginatorModule } from '@angular/material/paginator';\nimport { IgoEntityTablePaginatorModule } from '../entity-table-paginator/entity-table-paginator.module';\nimport { IgoImageModule } from '../../image/image.module';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatSelectModule } from '@angular/material/select';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatTableModule,\n    MatAutocompleteModule,\n    MatSortModule,\n    MatIconModule,\n    MatButtonModule,\n    MatCheckboxModule,\n    MatPaginatorModule,\n    MatSelectModule,\n    IgoStopPropagationModule,\n    IgoCustomHtmlModule,\n    IgoEntityTablePaginatorModule,\n    IgoImageModule,\n    IgoLanguageModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatInputModule,\n    MatDatepickerModule,\n    MatTooltipModule\n  ],\n  exports: [\n    EntityTableComponent\n  ],\n  declarations: [\n    EntityTableComponent,\n    EntityTableRowDirective\n  ]\n})\nexport class IgoEntityTableModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoEntitySelectorModule } from './entity-selector/entity-selector.module';\nimport { IgoEntityTableModule } from './entity-table/entity-table.module';\nimport { IgoEntityTablePaginatorModule } from './entity-table-paginator/entity-table-paginator.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoEntitySelectorModule,\n    IgoEntityTableModule,\n    IgoEntityTablePaginatorModule\n  ],\n  declarations: []\n})\nexport class IgoEntityModule {}\n","import { catchError } from 'rxjs/operators';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { Injectable } from '@angular/core';\nimport { InteractiveTourOptions } from './interactive-tour.interface';\nimport { ConfigService } from '@igo2/core';\n\n@Injectable()\nexport class InteractiveTourLoader {\n  private jsonURL: string;\n  private allToursOptions;\n\n  constructor(private http: HttpClient, private configService: ConfigService) {\n    this.jsonURL = this.getPathToConfigFile();\n  }\n\n   public loadConfigTour() {\n      this.getJSON()\n        .subscribe(\n          (data) => {\n            this.allToursOptions = data;\n          },\n          (err) => {\n            throw new Error(`Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.`);\n          }\n        );\n   }\n\n  public getPathToConfigFile(): string {\n    return (\n      this.configService.getConfig('interactiveTour.pathToConfigFile') ||\n      './config/interactiveTour.json'\n    );\n  }\n\n  public getJSON(): Observable<any> {\n    return this.http.get(this.jsonURL).pipe(\n      catchError((e) => {\n        e.error.caught = true;\n        throw e;\n      })\n    );\n  }\n\n  public getTourOptionData(toolName): InteractiveTourOptions {\n    if (this.allToursOptions === undefined) {\n      return undefined;\n    }\n    let nameInConfigFile = toolName;\n    nameInConfigFile = nameInConfigFile.replace(/\\s/g, '');\n    return this.allToursOptions[nameInConfigFile];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { ShepherdService } from 'angular-shepherd';\n\nimport { ConfigService, MediaService, LanguageService } from '@igo2/core';\nimport { InteractiveTourLoader } from './interactive-tour.loader';\nimport {\n  InteractiveTourOptions,\n  InteractiveTourStep,\n  InteractiveTourAction\n} from './interactive-tour.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class InteractiveTourService {\n  private previousStep: InteractiveTourStep;\n  private nextIndex = 1;\n\n  constructor(\n    private configService: ConfigService,\n    private mediaService: MediaService,\n    private languageService: LanguageService,\n    private interactiveTourLoader: InteractiveTourLoader,\n    private shepherdService: ShepherdService\n  ) {\n    if (this.isAppHaveTour()) {\n      this.interactiveTourLoader.loadConfigTour();\n    }\n  }\n\n  public isAppHaveTour() {\n    const haveTour = this.configService.getConfig('interactiveTour.activateInteractiveTour');\n    if (haveTour === undefined) {\n      return true;\n    } else {\n      return haveTour;\n    }\n  }\n\n  public isToolHaveTourConfig(toolName: string): boolean {\n    const checkTourActiveOptions = this.interactiveTourLoader.getTourOptionData(\n      toolName\n    );\n    if (checkTourActiveOptions === undefined) {\n      return false;\n    } else {\n      return true;\n    }\n  }\n\n  public disabledTourButton(toolName: string): boolean {\n    const stepConfig: InteractiveTourOptions = this.interactiveTourLoader.getTourOptionData(\n      toolName\n    );\n\n    if (stepConfig?.conditions) {\n      for (const condition of stepConfig?.conditions) {\n        if (document.querySelector(condition) === null) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  public isMobile(): boolean {\n    return this.mediaService.isMobile();\n  }\n\n  public isTourDisplayInMobile(): boolean {\n    const showInMobile = this.configService.getConfig(\n      'interactiveTour.tourInMobile'\n    );\n    if (showInMobile === undefined) {\n      return true;\n    }\n    return this.configService.getConfig('interactiveTour.tourInMobile');\n  }\n\n  private getButtons(buttonKind?: 'first' | 'last' | 'noBackButton') {\n    if (buttonKind === 'noBackButton') {\n      return [\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.nextButton'\n          ),\n          type: 'next'\n        }\n      ];\n    }\n    if (buttonKind === 'first') {\n      return [\n        {\n          classes: 'shepherd-button-secondary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.exitButton'\n          ),\n          type: 'cancel'\n        },\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.nextButton'\n          ),\n          type: 'next'\n        }\n      ];\n    }\n\n    if (buttonKind === 'last') {\n      return [\n        {\n          classes: 'shepherd-button-secondary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.backButton'\n          ),\n          type: 'back'\n        },\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.exitButton'\n          ),\n          type: 'cancel'\n        }\n      ];\n    }\n\n    return [\n      {\n        classes: 'shepherd-button-secondary',\n        text: this.languageService.translate.instant(\n          'igo.common.interactiveTour.backButton'\n        ),\n        type: 'back'\n      },\n      {\n        classes: 'shepherd-button-primary',\n        text: this.languageService.translate.instant(\n          'igo.common.interactiveTour.nextButton'\n        ),\n        type: 'next'\n      }\n    ];\n  }\n\n  private getAction(actionName: string) {\n    const action = {\n      click: 'click'\n    };\n    return action[actionName.toLowerCase()];\n  }\n\n  private addProgress() {\n    const self = this as any;\n    let nbTry = 0;\n    const maxTry = 21;\n    const checkExist = setInterval(() => {\n      if (self.getCurrentStep()) {\n        if (self.getCurrentStep().options.attachTo.element && !document.querySelector(self.getCurrentStep().options.attachTo.element)) {\n          self.cancel();\n          clearInterval(checkExist);\n          return;\n        } else {\n          const currentStepElement = self.getCurrentStep().getElement();\n          if (currentStepElement) {\n            const shepherdList = currentStepElement.querySelectorAll('.shepherd-content, .shepherd-text');\n            shepherdList.forEach(element => {\n              element.classList.add('mat-typography');\n            });\n          }\n          const header = currentStepElement\n            ? currentStepElement.querySelector('.shepherd-header')\n            : undefined;\n\n          nbTry++;\n          if (header || nbTry > maxTry) {\n            clearInterval(checkExist);\n          }\n\n          if (header) {\n            const stepsArray = self.steps;\n            const progress = document.createElement('span');\n            progress.className = 'shepherd-progress';\n            progress.innerText = `${\n              stepsArray.indexOf(self.getCurrentStep()) + 1\n            }/${stepsArray.length}`;\n            header.insertBefore(\n              progress,\n              currentStepElement.querySelector('.shepherd-cancel-icon')\n            );\n          }\n        }\n      }\n    }, 100);\n  }\n\n  private checkNext(index, tour, service) {\n    if (tour.getCurrentStep()) {\n      if (tour.getCurrentStep().options.attachTo.element && document.querySelector(tour.getCurrentStep().options.attachTo.element)) {\n        tour.complete();\n        return;\n      }\n\n      if (index.index === tour.steps.length - 1) {\n        tour.complete();\n        return;\n      }\n\n      tour.steps.splice(index.index, 1);\n      const nextStep = tour.steps[index.index];\n      if (nextStep.options.attachTo.element && !document.querySelector(nextStep.options.attachTo.element)) {\n        service.checkNext(index, tour, service);\n      } else {\n        tour._setupModal();\n        tour.show(nextStep.id);\n      }\n    }\n  }\n\n  private executeAction(\n    step: InteractiveTourStep,\n    actionConfig: InteractiveTourAction\n  ) {\n    if (!actionConfig) {\n      return;\n    }\n\n    if (\n      actionConfig.condition &&\n      ((actionConfig.condition.charAt(0) === '!' &&\n        document.querySelector(actionConfig.condition.slice(1))) ||\n        (actionConfig.condition.charAt(0) !== '!' &&\n          !document.querySelector(actionConfig.condition)))\n    ) {\n      return;\n    }\n\n    const element: HTMLElement = document.querySelector(\n      actionConfig.element || step.element\n    ) as HTMLElement;\n    const action = this.getAction(actionConfig.action);\n    if (element && action) {\n      element[action]();\n    }\n  }\n\n  private executeActionPromise(\n    step: InteractiveTourStep,\n    actionConfig: InteractiveTourAction\n  ) {\n    return new Promise<void>((resolve) => {\n      this.executeAction(step, actionConfig);\n      if (!actionConfig || !actionConfig.waitFor) {\n        resolve();\n        return;\n      }\n      let nbTry = 0;\n      const maxTry = actionConfig.maxWait ? actionConfig.maxWait / 100 : 20;\n      const checkExist = setInterval(() => {\n        nbTry++;\n        if (nbTry > maxTry || document.querySelector(actionConfig.waitFor)) {\n          clearInterval(checkExist);\n          resolve();\n        }\n      }, 100);\n    });\n  }\n\n  private getShepherdSteps(stepConfig: InteractiveTourOptions) {\n    const shepherdSteps = [];\n\n    let i = 0;\n    for (const step of stepConfig.steps) {\n      shepherdSteps.push({\n        attachTo: {\n          element: step.element,\n          on: step.position || stepConfig.position\n        },\n        popperOptions: {\n          modifiers: [{ name: 'offset', options: { offset: [0, 15] } }]\n        },\n        beforeShowPromise: () => {\n          return Promise.all([\n            this.executeActionPromise(\n              this.previousStep,\n              this.previousStep ? this.previousStep.beforeChange : undefined\n            ),\n            this.executeActionPromise(step, step.beforeShow)\n          ]);\n        },\n        buttons: this.getButtons(\n          i === 0\n            ? 'first'\n            : i + 1 === stepConfig.steps.length\n            ? 'last'\n            : stepConfig.steps[i].noBackButton\n            ? 'noBackButton'\n            : undefined\n        ),\n        classes: step.class,\n        highlightClass: step.highlightClass,\n        scrollTo: step.scrollToElement || stepConfig.scrollToElement || true,\n        canClickTarget: step.disableInteraction\n          ? !step.disableInteraction\n          : undefined,\n        title: this.languageService.translate.instant(\n          step.title || stepConfig.title\n        ),\n        text: [this.languageService.translate.instant(step.text)],\n        when: {\n          show: () => {\n            this.executeAction(step, step.onShow);\n          },\n          hide: () => {\n            this.previousStep = step;\n            this.executeAction(step, step.onHide);\n          }\n        }\n      });\n      i++;\n    }\n\n    return shepherdSteps;\n  }\n\n  public startTour(toolName: string) {\n    const stepConfig: InteractiveTourOptions = this.interactiveTourLoader.getTourOptionData(\n      toolName\n    );\n\n    this.shepherdService.defaultStepOptions = {\n      classes: stepConfig.class,\n      highlightClass: stepConfig.highlightClass,\n      canClickTarget: stepConfig.disableInteraction\n        ? !stepConfig.disableInteraction\n        : true,\n      cancelIcon: {\n        enabled: true\n      }\n    };\n\n    const shepherdSteps = this.getShepherdSteps(stepConfig);\n\n    this.shepherdService.modal = true;\n    this.shepherdService.confirmCancel = false;\n    this.shepherdService.addSteps(shepherdSteps);\n\n    this.shepherdService.tourObject.on('show', this.addProgress);\n    this.shepherdService.tourObject.on('cancel', (index) =>{\n      this.checkNext(index, this.shepherdService.tourObject, this);\n    });\n\n    this.shepherdService.start();\n  }\n}\n","import { EntityRecord, EntityStore } from '../../entity';\nimport { Tool, ToolboxOptions } from './tool.interface';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n/**\n * Service where all available tools and their component are registered.\n */\nexport class Toolbox {\n  /**\n   * Observable of the active tool\n   */\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\n\n  /**\n   * Ordered list of tool names to display in a toolbar\n   */\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\n\n  /**\n   * Observable of the active tool\n   */\n  private activeTool$$: Subscription;\n\n  /**\n   * Active tool history. Useful for activating the previous tool.\n   */\n  private activeToolHistory: string[] = [];\n\n  /**\n   * Tool store\n   */\n  private store = new EntityStore<Tool>([], {\n    getKey: (tool: Tool) => tool.name\n  });\n\n  get tools$(): BehaviorSubject<Tool[]> {\n    return this.store.entities$;\n  }\n\n  constructor(private options: ToolboxOptions = {}) {\n    this.setToolbar(options.toolbar);\n    this.initStore();\n  }\n\n  /**\n   * Destroy the toolbox\n   */\n  destroy() {\n    this.activeTool$$.unsubscribe();\n    this.store.destroy();\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return this.store.get(name);\n  }\n\n  /**\n   * Return all tools\n   * @returns Array of tools\n   */\n  getTools(): Tool[] {\n    return this.store.all();\n  }\n\n  /**\n   * Set tool configurations\n   * @param tools Tools\n   */\n  setTools(tools: Tool[]) {\n    this.store.load(tools);\n  }\n\n  /**\n   * Get toolbar\n   * @returns Toolbar value\n   */\n  getToolbar(): string[] {\n    return this.toolbar$.getValue();\n  }\n\n  /**\n   * Set toolbar\n   * @param toolbar A list of tool names\n   */\n  setToolbar(toolbar: string[]) {\n    this.toolbar$.next(toolbar || []);\n  }\n\n  /**\n   * Activate a tool (and deactivate other tools)\n   * @param name Tool name\n   * @param options Tool options\n   */\n  activateTool(name: string, options: { [key: string]: any } = {}) {\n    const tool = this.getTool(name);\n    if (tool === undefined) {\n      return;\n    }\n\n    this.store.state.update(tool, { active: true, options }, true);\n  }\n\n  /**\n   * Activate the previous tool, if any\n   */\n  activatePreviousTool() {\n    if (this.activeToolHistory.length <= 1) {\n      this.deactivateTool();\n      return;\n    }\n    const [previous, current] = this.activeToolHistory.splice(-2, 2);\n    this.activateTool(previous);\n  }\n\n  /**\n   * Activate the tool below, if any\n   */\n  /* activateBelowTool() {\n    const arrayTools = this.getToolbar();\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\n    if (arrayTools[index + 1] !== undefined) {\n      this.deactivateTool();\n      const below = arrayTools[index + 1];\n      this.activateTool(below);\n    } else {\n      this.deactivateTool();\n      const below = arrayTools[0];\n      this.activateTool(below);\n    }\n  } */\n\n  /**\n   * Activate the tool above, if any\n   */\n  /* activateAboveTool() {\n    const arrayTools = this.getToolbar();\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\n    if (arrayTools[index - 1] !== undefined) {\n      this.deactivateTool();\n      const above = arrayTools[index - 1];\n      this.activateTool(above);\n    } else {\n      this.deactivateTool();\n      const above = arrayTools[arrayTools.length - 1];\n      this.activateTool(above);\n    }\n  } */\n\n  /**\n   * Deactivate the active tool\n   */\n  deactivateTool() {\n    this.clearActiveToolHistory();\n    this.store.state.updateAll({ active: false });\n  }\n\n  /**\n   * Initialize the tool store and start observing the active tool\n   */\n  private initStore() {\n    this.store = new EntityStore<Tool>([], {\n      getKey: (entity: Tool) => entity.name\n    });\n\n    this.activeTool$$ = this.store.stateView\n      .firstBy$((record: EntityRecord<Tool>) => record.state.active === true)\n      .subscribe((record: EntityRecord<Tool>) => {\n        if (record === undefined) {\n          this.setActiveTool(undefined);\n          return;\n        }\n\n        const tool = record.entity;\n        const options = Object.assign(\n          {},\n          tool.options || {},\n          record.state.options || {}\n        );\n        this.setActiveTool(Object.assign({}, tool, { options }));\n      });\n  }\n\n  /**\n   * Set the active tool and update the tool history\n   * @param tool Tool\n   */\n  private setActiveTool(tool: Tool | undefined) {\n    this.activeTool$.next(tool);\n    if (tool === undefined) {\n      this.clearActiveToolHistory();\n    } else {\n      this.activeToolHistory = this.activeToolHistory\n        .filter((name: string) => name !== tool.name)\n        .concat([tool.name]);\n    }\n  }\n\n  /**\n   * Clear the tool history\n   */\n  private clearActiveToolHistory() {\n    this.activeToolHistory = [];\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { Tool } from './tool.interface';\nimport { Toolbox } from './toolbox';\n\n/**\n * Service where runtime tool configurations are registered\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ToolService {\n  static tools: { [key: string]: Tool } = {};\n\n  /**\n   * Toolbox that holds main tools\n   */\n  public toolbox: Toolbox = new Toolbox();\n\n  static register(tool: Tool) {\n    ToolService.tools[tool.name] = tool;\n  }\n\n  constructor() {\n    this.toolbox.setTools(this.getTools());\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return ToolService.tools[name];\n  }\n\n  /**\n   * Return all tools\n   * @returns tTols\n   */\n  getTools(): Tool[] {\n    return Object.values(ToolService.tools);\n  }\n}\n","<button *ngIf=\"showTourButton\"\n  (click) = \"startInteractiveTour()\"\n  [ngClass]=\"getClass()\"\n  mat-raised-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [disabled]=disabledTourButton>\n  <span class=\"interactive-tour-button-title\">{{'igo.common.interactiveTour.buttonTitle' | translate}} {{(discoverTitleInLocale$ | async) | translate}}</span>\n  <mat-icon\n    svgIcon=\"presentation-play\"\n    [matTooltip]=\"disabledTourButton ?\n    ('igo.common.interactiveTour.disaledTooltipTourToolButton' | translate) :\n    ('igo.common.interactiveTour.tooltipTourToolButton' | translate)\">\n  </mat-icon>\n</button>\n","import { Component, ViewEncapsulation, Input } from '@angular/core';\nimport { InteractiveTourService } from './interactive-tour.service';\nimport { ToolService } from '../tool/shared/tool.service';\nimport { Observable, of } from 'rxjs';\n\n@Component({\n  selector: 'igo-interactive-tour',\n  templateUrl: './interactive-tour.component.html',\n  styleUrls: ['./interactive-tour.component.scss'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class InteractiveTourComponent {\n  /**\n   * Toolbox that holds main tools\n   */\n  @Input() tourToStart: string = '';\n  @Input() styleButton: string;\n  @Input() discoverTitleInLocale$: Observable<string> = of('IGO');\n\n  getClass() {\n    return {\n      'tour-button-tool-icon': this.styleButton === 'icon',\n      'tour-button-tool': this.styleButton === 'raised'\n    };\n  }\n\n  get toolbox() {\n    return this.toolService.toolbox;\n  }\n\n  getTourToStart() {\n    if (this.tourToStart) {\n      return this.tourToStart;\n    } else {\n      return this.activeToolName;\n    }\n  }\n\n  get activeToolName() {\n    if (this.toolbox) {\n      if (this.isActiveTool) {\n        return this.toolbox.activeTool$.getValue().name;\n      } else {\n        return 'global';\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  get isActiveTool(): boolean {\n    if (this.toolbox) {\n      return this.toolbox.activeTool$.getValue() !== undefined;\n    } else {\n      return undefined;\n    }\n  }\n\n  get isToolHaveTour(): boolean {\n    if (this.activeToolName === 'about' && !this.tourToStart) {\n      return false;\n    }\n    return this.interactiveTourService.isToolHaveTourConfig(\n      this.getTourToStart()\n    );\n  }\n\n  get showTourButton(): boolean {\n    // 2 conditions to show: have Tour on tool in Config file and if we are in mobile displayInMobile= true\n    let haveTour: boolean;\n    haveTour = this.isToolHaveTour;\n    if (haveTour === false) {\n      return false;\n    }\n\n    let inMobileAndShow: boolean;\n    if (this.interactiveTourService.isMobile()) {\n      inMobileAndShow = this.isTourDisplayInMobile;\n      if (inMobileAndShow === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  get isTourDisplayInMobile(): boolean {\n    return this.interactiveTourService.isTourDisplayInMobile();\n  }\n\n  get disabledTourButton(): boolean {\n    return this.interactiveTourService.disabledTourButton(this.activeToolName);\n  }\n\n  constructor(\n    private interactiveTourService: InteractiveTourService,\n    private toolService: ToolService\n  ) {}\n\n  startInteractiveTour() {\n    const tour = this.getTourToStart();\n    if (tour) {\n      this.interactiveTourService.startTour(tour);\n    } else {\n      return;\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { InteractiveTourService } from './interactive-tour.service';\nimport { InteractiveTourComponent } from './interactive-tour.component';\nimport { InteractiveTourLoader } from './interactive-tour.loader';\n\n@NgModule({\n  declarations: [InteractiveTourComponent],\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule\n  ],\n  providers: [InteractiveTourService, InteractiveTourLoader],\n  exports: [InteractiveTourComponent]\n})\nexport class IgoInteractiveTourModule {}\n","import { Pipe, PipeTransform } from '@angular/core';\n\n@Pipe({\n  name: 'keyvalue'\n})\nexport class KeyValuePipe implements PipeTransform {\n  transform(value: any, args?: any): any {\n    const keyValues = [];\n    Object.getOwnPropertyNames(value).forEach((key: string) =>\n      keyValues.push({ key, value: value[key] })\n    );\n\n    return keyValues;\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { KeyValuePipe } from './keyvalue.pipe';\n\n@NgModule({\n  imports: [],\n  declarations: [KeyValuePipe],\n  exports: [KeyValuePipe]\n})\nexport class IgoKeyValueModule {\n  static forRoot(): ModuleWithProviders<IgoKeyValueModule> {\n    return {\n      ngModule: IgoKeyValueModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  ElementRef,\n  Renderer2,\n  HostListener,\n  EventEmitter\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoListItem]'\n})\nexport class ListItemDirective {\n\n  static focusedCls = 'igo-list-item-focused';\n  static selectedCls = 'igo-list-item-selected';\n  static disabledCls = 'igo-list-item-disabled';\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  @Input()\n  get focused() {\n    return this._focused;\n  }\n  set focused(value: boolean) {\n    if (value === this._focused) {\n      return;\n    }\n    if (this.disabled) {\n      return;\n    }\n\n    value ? this.beforeFocus.emit(this) : this.beforeUnfocus.emit(this);\n\n    this._focused = value;\n    if (this.selected !== true) {\n      this.toggleFocusedClass();\n    }\n\n    value ? this.focus.emit(this) : this.unfocus.emit(this);\n  }\n  private _focused = false;\n\n  @Input()\n  get selected() {\n    return this._selected;\n  }\n  set selected(value: boolean) {\n    if (value === this._selected) {\n      return;\n    }\n    if (this.disabled) {\n      return;\n    }\n\n    value ? this.beforeSelect.emit(this) : this.beforeUnselect.emit(this);\n\n    this._selected = value;\n    this._focused = value;\n    this.toggleSelectedClass();\n\n    value ? this.select.emit(this) : this.unselect.emit(this);\n  }\n  private _selected = false;\n\n  @Input()\n  get disabled() {\n    return this._disabled;\n  }\n  set disabled(value: boolean) {\n    if (value === this._disabled) {\n      return;\n    }\n\n    if (value === true) {\n      this.selected = false;\n    }\n\n    value ? this.beforeDisable.emit(this) : this.beforeEnable.emit(this);\n\n    this._disabled = value;\n    this.toggleDisabledClass();\n\n    value ? this.disable.emit(this) : this.enable.emit(this);\n  }\n  private _disabled = false;\n\n  @Output() beforeSelect = new EventEmitter<ListItemDirective>();\n  @Output() beforeFocus = new EventEmitter<ListItemDirective>();\n  @Output() beforeUnselect = new EventEmitter<ListItemDirective>();\n  @Output() beforeUnfocus = new EventEmitter<ListItemDirective>();\n  @Output() beforeDisable = new EventEmitter<ListItemDirective>();\n  @Output() beforeEnable = new EventEmitter<ListItemDirective>();\n  @Output() focus = new EventEmitter<ListItemDirective>();\n  @Output() unfocus = new EventEmitter<ListItemDirective>();\n  @Output() select = new EventEmitter<ListItemDirective>();\n  @Output() unselect = new EventEmitter<ListItemDirective>();\n  @Output() disable = new EventEmitter<ListItemDirective>();\n  @Output() enable = new EventEmitter<ListItemDirective>();\n\n  @HostListener('click')\n  onClick() {\n    this.selected = true;\n  }\n\n  constructor(public renderer: Renderer2, public el: ElementRef) {}\n\n  getOffsetTop(): number {\n    const padding = 5;\n\n    return this.el.nativeElement.offsetTop - padding;\n  }\n\n  private toggleFocusedClass() {\n    if (this.focused) {\n      this.addCls(ListItemDirective.focusedCls);\n    } else {\n      this.removeCls(ListItemDirective.focusedCls);\n    }\n  }\n\n  private toggleSelectedClass() {\n    if (this.selected) {\n      this.addCls(ListItemDirective.selectedCls);\n      this.removeCls(ListItemDirective.focusedCls);\n    } else {\n      this.removeCls(ListItemDirective.selectedCls);\n    }\n  }\n\n  private toggleDisabledClass() {\n    if (this.disabled) {\n      this.addCls(ListItemDirective.disabledCls);\n    } else {\n      this.removeCls(ListItemDirective.disabledCls);\n    }\n  }\n\n  private addCls(cls: string) {\n    this.renderer.addClass(this.el.nativeElement, cls);\n  }\n\n  private removeCls(cls: string) {\n    this.renderer.removeClass(this.el.nativeElement, cls);\n  }\n}\n","import {\n  Component,\n  AfterViewInit,\n  OnInit,\n  OnDestroy,\n  Input,\n  ContentChildren,\n  HostListener,\n  ElementRef\n} from '@angular/core';\nimport type { QueryList } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport { ListItemDirective } from './list-item.directive';\n\n@Component({\n  selector: 'igo-list',\n  templateUrl: './list.component.html',\n  styleUrls: ['./list.component.scss']\n})\nexport class ListComponent implements AfterViewInit, OnInit, OnDestroy {\n  @Input()\n  get navigation() {\n    return this._navigation;\n  }\n  set navigation(value: boolean) {\n    this._navigation = value;\n  }\n  private _navigation = true;\n\n  @Input()\n  get selection() {\n    return this._selection;\n  }\n  set selection(value: boolean) {\n    this._selection = value;\n  }\n  private _selection = true;\n\n  get selectedItem() {\n    return this._selectedItem;\n  }\n  set selectedItem(value: ListItemDirective) {\n    this.focusedItem = value;\n    this._selectedItem = value;\n  }\n  private _selectedItem: ListItemDirective;\n\n  get focusedItem() {\n    return this._focusedItem;\n  }\n  set focusedItem(value: ListItemDirective) {\n    this._focusedItem = value;\n  }\n  private _focusedItem: ListItemDirective;\n\n  private navigationEnabled: boolean;\n  private listItems$$: Subscription;\n  private subscriptions: Subscription[] = [];\n\n  @ContentChildren(ListItemDirective, { descendants: true })\n  listItems: QueryList<ListItemDirective>;\n\n  @HostListener('document:keydown', ['$event'])\n  @HostListener('document:enter', ['$event'])\n  handleKeyboardEvent(event: KeyboardEvent) {\n    // It would be nice to be able to unsubscribe to the event\n    // completely but until ES7 this won't be possible because\n    // document events are not observables\n    if (this.navigationEnabled) {\n      if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {\n        event.preventDefault();\n        this.navigate(event.key);\n      } else if (event.key === 'Enter') {\n        this.select(this.focusedItem);\n      }\n    }\n  }\n\n  constructor(private el: ElementRef) {}\n\n  ngOnInit() {\n    this.enableNavigation();\n  }\n\n  ngAfterViewInit() {\n    if (this.listItems.length) {\n      this.init();\n    }\n\n    this.listItems$$ = this.listItems.changes.subscribe(\n      (items: ListItemDirective[]) => this.init()\n    );\n  }\n\n  ngOnDestroy() {\n    this.listItems$$.unsubscribe();\n  }\n\n  focus(item?: ListItemDirective) {\n    if (!this.selection) {\n      return;\n    }\n\n    this.unfocus();\n\n    // We need to make this check because dynamic\n    // lists such as in the search results list may fail\n    if (item !== undefined) {\n      item.focused = true;\n    }\n  }\n\n  unfocus() {\n    if (this.focusedItem !== undefined) {\n      this.focusedItem.focused = false;\n    }\n\n    this.focusedItem = undefined;\n  }\n\n  focusNext() {\n    const items = this.listItems.toArray();\n    let item;\n    const igoList = this.el.nativeElement;\n    let disabled = true;\n    let index = this.getFocusedIndex();\n    if (index === undefined) {\n      index = -1;\n    }\n\n    while (disabled && index < items.length - 1) {\n      index += 1;\n      item = items[index];\n      disabled = item.disabled;\n    }\n\n    if (item !== undefined) {\n      this.focus(item);\n    }\n\n    if (!items[index + 1]) {\n      igoList.scrollTop = igoList.scrollHeight - igoList.clientHeight;\n      return;\n    }\n\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\n      igoList.scrollTop =\n        item.el.nativeElement.offsetTop +\n        item.el.nativeElement.children[0].offsetHeight -\n        igoList.clientHeight;\n    }\n  }\n\n  focusPrevious() {\n    const items = this.listItems.toArray();\n    let item: ListItemDirective;\n    const igoList = this.el.nativeElement;\n    let disabled = true;\n    let index = this.getFocusedIndex();\n\n    while (disabled && index > 0) {\n      index -= 1;\n      item = items[index];\n      disabled = item.disabled;\n    }\n\n    if (item !== undefined) {\n      this.focus(item);\n    }\n\n    if (!items[index - 1]) {\n      igoList.scrollTop = 0;\n      return;\n    }\n\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\n      const padding = 3;\n      igoList.scrollTop = item.el.nativeElement.offsetTop - padding;\n    }\n  }\n\n  select(item?: ListItemDirective) {\n    if (!this.selection) {\n      return;\n    }\n\n    this.unselect();\n\n    if (item !== undefined) {\n      item.selected = true;\n    }\n  }\n\n  unselect() {\n    this.unfocus();\n\n    if (this.selectedItem !== undefined) {\n      this.selectedItem.selected = false;\n    }\n\n    this.selectedItem = undefined;\n  }\n\n  enableNavigation() {\n    if (this.navigation) {\n      this.navigationEnabled = true;\n    }\n  }\n\n  disableNavigation() {\n    this.navigationEnabled = false;\n  }\n\n  scrollToItem(item: ListItemDirective) {\n    this.el.nativeElement.scrollTop = item.getOffsetTop();\n  }\n\n  isScrolledIntoView(elem) {\n    const docViewTop =\n      this.el.nativeElement.scrollTop + this.el.nativeElement.offsetTop;\n    const docViewBottom = docViewTop + this.el.nativeElement.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.children[0].offsetHeight;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  private init() {\n    this.subscribe();\n\n    this.selectedItem = this.findSelectedItem();\n    this.focusedItem = this.findFocusedItem();\n\n    this.enableNavigation();\n  }\n\n  private subscribe() {\n    this.unsubscribe();\n\n    this.listItems.toArray().forEach(item => {\n      this.subscriptions.push(\n        item.beforeSelect.subscribe((item2: ListItemDirective) =>\n          this.handleItemBeforeSelect(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.select.subscribe((item2: ListItemDirective) =>\n          this.handleItemSelect(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.beforeFocus.subscribe((item2: ListItemDirective) =>\n          this.handleItemBeforeFocus(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.focus.subscribe((item2: ListItemDirective) =>\n          this.handleItemFocus(item2)\n        )\n      );\n    }, this);\n  }\n\n  private unsubscribe() {\n    this.subscriptions.forEach((sub: Subscription) => sub.unsubscribe());\n    this.subscriptions = [];\n  }\n\n  private handleItemBeforeFocus(item: ListItemDirective) {\n    if (item !== this.focusedItem) {\n      this.unfocus();\n    }\n  }\n\n  private handleItemFocus(item: ListItemDirective) {\n    this.focusedItem = item;\n  }\n\n  private handleItemBeforeSelect(item: ListItemDirective) {\n    if (item !== this.focusedItem) {\n      this.unselect();\n    }\n  }\n\n  private handleItemSelect(item: ListItemDirective) {\n    this.selectedItem = item;\n  }\n\n  private findSelectedItem() {\n    return this.listItems.toArray().find(item => item.selected);\n  }\n\n  private findFocusedItem() {\n    return this.listItems.toArray().find(item => item.focused);\n  }\n\n  private getFocusedIndex() {\n    return this.listItems\n      .toArray()\n      .findIndex(item => item === this.focusedItem);\n  }\n\n  private navigate(key: string) {\n    switch (key) {\n      case 'ArrowUp':\n        this.focusPrevious();\n        break;\n      case 'ArrowDown':\n        this.focusNext();\n        break;\n      default:\n        break;\n    }\n  }\n}\n","<mat-list\n  igoClickout\n  [ngClass]=\"{'selectable': selection}\"\n  (clickout)=\"disableNavigation()\"\n  (click)=\"enableNavigation()\">\n  <ng-content></ng-content>\n</mat-list>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { IgoClickoutModule } from '../clickout/clickout.module';\n\nimport { ListItemDirective } from './list-item.directive';\nimport { ListComponent } from './list.component';\n\n@NgModule({\n  imports: [CommonModule, MatIconModule, MatListModule, IgoClickoutModule],\n  declarations: [ListItemDirective, ListComponent],\n  exports: [ListItemDirective, ListComponent]\n})\nexport class IgoListModule {\n  static forRoot(): ModuleWithProviders<IgoListModule> {\n    return {\n      ngModule: IgoListModule,\n      providers: []\n    };\n  }\n}\n","<div *ngIf=\"withHeader\" class=\"igo-panel-header mat-typography\" title=\"\">\n  <h3>\n    <ng-content select=\"[panelLeftButton]\"></ng-content>\n    <div class=\"igo-panel-title\">\n      {{ title }}\n      <ng-content select=\"[panelHeader]\"></ng-content>\n    </div>\n    <ng-content select=\"[panelRightButton]\"></ng-content>\n  </h3>\n</div>\n<div class=\"igo-panel-content\" title=\"\">\n  <ng-content></ng-content>\n</div>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  HostBinding\n} from '@angular/core';\n\n@Component({\n  selector: 'igo-panel',\n  templateUrl: './panel.component.html',\n  styleUrls: ['./panel.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PanelComponent {\n  @Input()\n  get title() {\n    return this._title;\n  }\n  set title(value: string) {\n    this._title = value;\n  }\n  private _title: string;\n\n  @Input()\n  @HostBinding('class.igo-panel-with-header')\n  get withHeader(): boolean {\n    return this._withHeader;\n  }\n  set withHeader(value: boolean) {\n    this._withHeader = value;\n  }\n  private _withHeader = true;\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { PanelComponent } from './panel.component';\n\n@NgModule({\n  imports: [CommonModule],\n  exports: [PanelComponent],\n  declarations: [PanelComponent]\n})\nexport class IgoPanelModule {}\n","import { Component, Input } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'igo-spinner',\n  templateUrl: './spinner.component.html',\n  styleUrls: ['./spinner.component.scss']\n})\nexport class SpinnerComponent {\n\n  public shown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  @Input()\n  set shown(value: boolean) { this.shown$.next(value); }\n  get shown(): boolean { return this.shown$.value; }\n\n  constructor() {}\n\n  show() {\n    this.shown = true;\n  }\n\n  hide() {\n    this.shown = false;\n  }\n}\n","<div\n  [ngClass]=\"{'igo-spinner-container': true, 'igo-spinner-shown': (shown$ | async)}\">\n  <div class=\"igo-spinner-background\"></div>\n  <mat-progress-spinner diameter=\"40\" mode=\"indeterminate\"></mat-progress-spinner>\n</div>\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { ActivityService } from '@igo2/core';\nimport { SpinnerComponent } from './spinner.component';\n\n/**\n * A directive to bind a SpinnerComponent to the activity service.\n * The activity service tracks any HTTP request and this directive\n * will display the spinner it's attached to when the activity counter\n * is greater than 0.\n */\n@Directive({\n  selector: '[igoSpinnerActivity]'\n})\nexport class SpinnerActivityDirective implements OnInit, OnDestroy {\n  /**\n   * Subscription to the activity service counter\n   */\n  private counter$$: Subscription;\n\n  constructor(\n    @Self() private spinner: SpinnerComponent,\n    private activityService: ActivityService\n  ) {}\n\n  /**\n   * Subscribe to the activity service counter and display the spinner\n   * when it's is greater than 0.\n   * @internal\n   */\n  ngOnInit() {\n    this.counter$$ = this.activityService.counter$\n      .pipe(debounceTime(50))\n      .subscribe((count: number) => {\n        count > 0 ? this.spinner.show() : this.spinner.hide();\n      });\n  }\n\n  /**\n   * Unsubcribe to the activity service counter.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.counter$$.unsubscribe();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\n\nimport { SpinnerActivityDirective } from './spinner-activity.directive';\nimport { SpinnerComponent } from './spinner.component';\n\n@NgModule({\n  imports: [CommonModule, MatProgressSpinnerModule],\n  declarations: [SpinnerActivityDirective, SpinnerComponent],\n  exports: [SpinnerActivityDirective, SpinnerComponent]\n})\nexport class IgoSpinnerModule {}\n","import { DataSource } from '@angular/cdk/table';\nimport { MatSort } from '@angular/material/sort';\n\nimport { Observable, BehaviorSubject, merge } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { TableDatabase, TableModel } from './index';\n\nexport class TableDataSource extends DataSource<any> {\n  get filter(): string {\n    return this._filterChange.value;\n  }\n  set filter(filter: string) {\n    this._filterChange.next(filter);\n  }\n  private _filterChange = new BehaviorSubject('');\n\n  constructor(\n    private _database: TableDatabase,\n    private _model: TableModel,\n    private _sort: MatSort\n  ) {\n    super();\n  }\n\n  // Connect function called by the table to retrieve one stream containing\n  // the data to render.\n  connect(): Observable<any[]> {\n    if (!this._database) {\n      return merge([]);\n    }\n    const displayDataChanges = [\n      this._database.dataChange,\n      this._filterChange,\n      this._sort.sortChange\n    ];\n\n    return merge(...displayDataChanges).pipe(\n      map(() => {\n        return this.getFilteredData(this._database.data);\n      }),\n      map(data => {\n        return this.getSortedData(data);\n      })\n    );\n  }\n\n  disconnect() {}\n\n  getFilteredData(data): any[] {\n    if (!this.filter) {\n      return data;\n    }\n    return data.slice().filter((item: any) => {\n      const searchStr: string = this._model.columns\n        .filter(c => c.filterable)\n        .map(c => ObjectUtils.resolve(item, c.name))\n        .join(' ')\n        .toLowerCase();\n\n      return searchStr.indexOf(this.filter.toLowerCase()) !== -1;\n    });\n  }\n\n  getSortedData(data): any[] {\n    if (!this._sort.active || this._sort.direction === '') {\n      return data;\n    }\n\n    return data.sort((a, b) => {\n      const propertyA: number | string = ObjectUtils.resolve(\n        a,\n        this._sort.active\n      );\n      const propertyB: number | string = ObjectUtils.resolve(\n        b,\n        this._sort.active\n      );\n\n      return ObjectUtils.naturalCompare(\n        propertyB,\n        propertyA,\n        this._sort.direction\n      );\n    });\n  }\n}\n","export enum TableActionColor {\n  primary,\n  accent,\n  warn\n}\n","<div class='table-box'>\n  <div class='table-header' *ngIf=\"hasFilterInput\">\n    <mat-form-field floatPlaceholder='never'>\n      <input matInput #filter [placeholder]=\"'igo.common.table.filter' | translate\">\n    </mat-form-field>\n  </div>\n\n  <div class='table-container'>\n    <table mat-table #table [dataSource]='dataSource' matSort>\n\n      <!-- Checkbox Column -->\n      <ng-container matColumnDef=\"selectionCheckbox\">\n        <th mat-header-cell *matHeaderCellDef>\n          <mat-checkbox (change)=\"$event ? masterToggle() : null\"\n                        [checked]=\"selection.hasValue() && isAllSelected()\"\n                        [indeterminate]=\"selection.hasValue() && !isAllSelected()\">\n          </mat-checkbox>\n        </th>\n        <td mat-cell *matCellDef=\"let row\">\n          <mat-checkbox (click)=\"$event.stopPropagation()\"\n                        (change)=\"$event ? selection.toggle(row) : null\"\n                        [checked]=\"selection.isSelected(row)\">\n          </mat-checkbox>\n        </td>\n      </ng-container>\n\n      <ng-container [matColumnDef]='column.name' *ngFor='let column of model.columns'>\n        <ng-container *ngIf='column.sortable'>\n          <th mat-header-cell *matHeaderCellDef mat-sort-header> {{column.title}} </th>\n        </ng-container>\n\n        <ng-container *ngIf='!column.sortable'>\n          <th mat-header-cell *matHeaderCellDef> {{column.title}} </th>\n        </ng-container>\n\n        <ng-container *ngIf=\"!column.html; else cellHTML\">\n          <td mat-cell *matCellDef='let row' class=\"mat-cell-text\"\n            [ngClass]=\"model.cellClassFunc ? model.cellClassFunc(row, column) : {}\">\n            {{getValue(row, column.name)}}\n          </td>\n        </ng-container>\n\n        <ng-template #cellHTML>\n          <td mat-cell *matCellDef='let row' class=\"mat-cell-text\"\n            [ngClass]=\"model.cellClassFunc ? model.cellClassFunc(row, column) : {}\"\n            [innerHTML]=\"getValue(row, column.name)\">\n          </td>\n        </ng-template>\n      </ng-container>\n\n      <!-- Action Column -->\n      <ng-container matColumnDef='action'>\n        <th mat-header-cell *matHeaderCellDef></th>\n        <td mat-cell *matCellDef='let row'>\n          <button *ngFor='let action of model.actions'\n          mat-mini-fab\n          [color]='getActionColor(action.color)'\n          (click)='handleClickAction($event, action, row)'>\n            <mat-icon svgIcon=\"{{action.icon}}\"></mat-icon>\n          </button>\n        </td>\n      </ng-container>\n\n      <tr mat-header-row *matHeaderRowDef='displayedColumns;'></tr>\n      <tr mat-row\n        *matRowDef='let row; columns: displayedColumns;'\n        [ngClass]=\"model.rowClassFunc ? model.rowClassFunc(row) : {}\"\n        (click)=\"selection.toggle(row)\">\n      </tr>\n\n    </table>\n  </div>\n\n</div>\n","import {\n  Component,\n  ElementRef,\n  ViewChild,\n  Input,\n  Output,\n  OnChanges,\n  OnInit,\n  AfterViewInit,\n  EventEmitter\n} from '@angular/core';\nimport { MatSort } from '@angular/material/sort';\nimport { SelectionModel } from '@angular/cdk/collections';\n\nimport { debounceTime, distinctUntilChanged } from 'rxjs/operators';\nimport { fromEvent } from 'rxjs';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { TableModel } from './table-model.interface';\nimport { TableDatabase } from './table-database';\nimport { TableDataSource } from './table-datasource';\nimport { TableActionColor } from './table-action-color.enum';\n\n@Component({\n  selector: 'igo-table',\n  templateUrl: './table.component.html',\n  styleUrls: ['./table.component.scss']\n})\nexport class TableComponent implements OnChanges, OnInit, AfterViewInit {\n  @Input()\n  get database(): TableDatabase {\n    return this._database;\n  }\n  set database(value: TableDatabase) {\n    this._database = value;\n  }\n  private _database: TableDatabase;\n\n  @Input()\n  get model(): TableModel {\n    return this._model;\n  }\n  set model(value: TableModel) {\n    this._model = value;\n  }\n  private _model: TableModel;\n\n  @Input()\n  get hasFilterInput(): boolean {\n    return this._hasFIlterInput;\n  }\n  set hasFilterInput(value: boolean) {\n    this._hasFIlterInput = value;\n  }\n  private _hasFIlterInput = true;\n\n  public displayedColumns;\n  public dataSource: TableDataSource | null;\n  public selection = new SelectionModel<any>(true, []);\n\n  @Output()\n  select = new EventEmitter<{\n    added: any[];\n    removed: any[];\n    source: SelectionModel<any>;\n  }>();\n\n  @ViewChild('filter') filter: ElementRef;\n  @ViewChild(MatSort, { static: true }) sort: MatSort;\n\n  ngOnInit() {\n    this.dataSource = new TableDataSource(this.database, this.model, this.sort);\n\n    if (this.model) {\n      this.displayedColumns = this.model.columns\n        .filter(c => c.displayed !== false)\n        .map(c => c.name);\n\n      if (this.model.selectionCheckbox) {\n        this.displayedColumns.unshift('selectionCheckbox');\n      }\n      if (this.model.actions && this.model.actions.length) {\n        this.displayedColumns.push('action');\n      }\n    }\n\n    this.selection.changed.subscribe(e => this.select.emit(e));\n  }\n\n  ngAfterViewInit() {\n    if (this.filter) {\n      fromEvent(this.filter.nativeElement, 'keyup')\n        .pipe(\n          debounceTime(150),\n          distinctUntilChanged()\n        )\n        .subscribe(() => {\n          if (!this.dataSource) {\n            return;\n          }\n          this.dataSource.filter = this.filter.nativeElement.value;\n        });\n    }\n  }\n\n  ngOnChanges(change) {\n    if (change.database) {\n      this.dataSource = new TableDataSource(\n        this.database,\n        this.model,\n        this.sort\n      );\n      this.selection.clear();\n    }\n  }\n\n  getActionColor(colorId: number): string {\n    return TableActionColor[colorId];\n  }\n\n  getValue(row, key) {\n    return ObjectUtils.resolve(row, key);\n  }\n\n  /** Whether the number of selected elements matches the total number of rows. */\n  isAllSelected() {\n    const numSelected = this.selection.selected.length;\n    const numRows = this.database.data.length;\n    return numSelected === numRows;\n  }\n\n  /** Selects all rows if they are not all selected; otherwise clear selection. */\n  masterToggle() {\n    this.isAllSelected()\n      ? this.selection.clear()\n      : this.database.data.forEach(row => this.selection.select(row));\n  }\n\n  handleClickAction(event, action, row) {\n    event.stopPropagation();\n    action.click(row);\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { CdkTableModule } from '@angular/cdk/table';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSortModule } from '@angular/material/sort';\nimport { MatTableModule } from '@angular/material/table';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { TableComponent } from './table.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    CdkTableModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTableModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSortModule,\n    MatCheckboxModule,\n    IgoLanguageModule\n  ],\n  declarations: [TableComponent],\n  exports: [TableComponent]\n})\nexport class IgoTableModule {\n  static forRoot(): ModuleWithProviders<IgoTableModule> {\n    return {\n      ngModule: IgoTableModule,\n      providers: []\n    };\n  }\n}\n","import { EntityStore } from '../../entity';\nimport { Action } from './action.interfaces';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * actions.\n */\nexport class ActionStore extends EntityStore<Action> {\n\n}\n","export enum ToolboxColor {\n  White = 'white',\n  Grey = 'grey',\n  Primary = 'primary'\n}\n","import {\n  trigger,\n  state,\n  style,\n  transition,\n  animate,\n  AnimationTriggerMetadata\n} from '@angular/animations';\n\nexport function toolSlideInOut(\n  speed = '300ms',\n  type = 'ease-in-out'\n): AnimationTriggerMetadata {\n  return trigger('toolSlideInOut', [\n    state(\n      'enter',\n      style({\n        transform: 'translate3d(0, 0, 0)'\n      })\n    ),\n    transition('void => enter', animate(speed + ' ' + type))\n  ]);\n}\n","<igo-actionbar\n  *ngIf=\"(toolbar$ | async).length > 0\"\n  [store]=\"actionStore\"\n  [withIcon]=\"true\"\n  [withTitle]=\"toolbarWithTitle$ | async\"\n  [withTooltip]=\"(toolbarWithTitle$ | async) === false\"\n  [scrollActive]=\"toolbarWithTitle$ | async\"\n  [horizontal]=\"false\">\n</igo-actionbar>\n\n<div\n  *ngIf=\"activeTool$ | async as tool\"\n  class=\"igo-tool-container\"\n  [ngClass]=\"{'igo-tool-container-with-toolbar': !actionStore.empty, 'igo-tool-container-with-animation': animate}\"\n  [@toolSlideInOut]=\"animation$ | async\"\n  (@toolSlideInOut.start)=\"onAnimationStart()\"\n  (@toolSlideInOut.done)=\"onAnimationComplete()\">\n\n  <igo-dynamic-outlet\n    [component]=\"tool.component\"\n    [inputs]=\"getToolInputs(tool)\">\n  </igo-dynamic-outlet>\n\n</div>\n","import {\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  HostBinding,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { Subscription, BehaviorSubject, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Action, ActionStore } from '../../action';\nimport { Tool } from '../shared/tool.interface';\nimport { ToolboxColor } from '../shared/toolbox.enums';\nimport { Toolbox } from '../shared/toolbox';\nimport { toolSlideInOut } from './toolbox.animation';\n\n@Component({\n  selector: 'igo-toolbox',\n  templateUrl: 'toolbox.component.html',\n  styleUrls: ['toolbox.component.scss'],\n  animations: [toolSlideInOut()],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ToolboxComponent implements OnInit, OnDestroy {\n  /**\n   * Observable of the active tool\n   */\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\n\n  /**\n   * Store of actions that toggle tools\n   */\n  actionStore: ActionStore = new ActionStore([]);\n\n  /**\n   * Observable of he anmation state\n   */\n  animation$: BehaviorSubject<string> = new BehaviorSubject('none');\n\n  /**\n   * Observable of the toolbar\n   */\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\n\n  /**\n   * Whether the Toolbar should display actions' titles\n   */\n  toolbarWithTitle$: Observable<boolean> = this.activeTool$.pipe(\n    map((tool: Tool | undefined) => tool === undefined)\n  );\n\n  /**\n   * Subscription to the active tool\n   */\n  private activeTool$$: Subscription;\n\n  /**\n   * Subscription to the toolbar\n   */\n  private toolbar$$: Subscription;\n\n  /**\n   * Observable of the ongoing animation. This is useful when\n   * multiple animations are triggered at once i.e. when the user clicks\n   * too fast on different actions\n   */\n  private animating$ = new BehaviorSubject<boolean>(false);\n\n  /**\n   * Subscription to the ongoing animation\n   */\n  private animating$$: Subscription;\n\n  /**\n   * Toolbox\n   */\n  @Input() toolbox: Toolbox;\n\n  /**\n   * Whether the toolbox should animate the first tool entering\n   */\n  @Input() animate: boolean = false;\n\n  /**\n   * Color of Toolbox\n   */\n  @Input() color: ToolboxColor = ToolboxColor.White;\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.color-grey')\n  get classColorGrey() {\n    return this.color === ToolboxColor.Grey;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.color-primary')\n  get classColorPrimary() {\n    return this.color === ToolboxColor.Primary;\n  }\n\n  /**\n   * Initialize the toolbar and subscribe to the active tool\n   * @internal\n   */\n  ngOnInit() {\n    this.toolbar$$ = this.toolbox.toolbar$.subscribe((toolbar: string[]) =>\n      this.onToolbarChange(toolbar)\n    );\n    this.activeTool$$ = this.toolbox.activeTool$.subscribe((tool: Tool) =>\n      this.onActiveToolChange(tool)\n    );\n  }\n\n  /**\n   * Unsubscribe to the active tool and destroy the action store\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toolbar$$.unsubscribe();\n    this.activeTool$$.unsubscribe();\n    this.actionStore.destroy();\n  }\n\n  /**\n   * Track the starting animation\n   * @internal\n   */\n  onAnimationStart() {\n    this.animating$.next(true);\n  }\n\n  /**\n   * Untrack the completed animation\n   * @internal\n   */\n  onAnimationComplete() {\n    this.animating$.next(false);\n  }\n\n  /**\n   * Return a tool's inputs\n   * @param tool Tool\n   * @returns Tool inputs\n   * @internal\n   */\n  getToolInputs(tool: Tool): { [key: string]: any } {\n    return tool.options || {};\n  }\n\n  /**\n   * Initialize an action store\n   * @param toolbar Toolbar\n   */\n  private onToolbarChange(toolbar: string[]) {\n    this.setToolbar(toolbar);\n  }\n\n  /**\n   * Activate a tool and trigger an animation or not\n   * @param tool Tool to activate\n   */\n  private onActiveToolChange(tool: Tool) {\n    if (!this.animate) {\n      this.setActiveTool(tool);\n      return;\n    }\n    this.onAnimate(() => this.setActiveTool(tool));\n  }\n\n  /**\n   * Set the active tool\n   * @param tool Tool to activate\n   */\n  private setActiveTool(tool: Tool | undefined) {\n    if (tool === undefined) {\n      this.actionStore.state.updateAll({ active: false });\n    } else {\n      const action = this.actionStore.get(tool.name);\n      if (action !== undefined) {\n        this.actionStore.state.update(action, { active: true }, true);\n      }\n    }\n\n    this.activeTool$.next(tool);\n    if (this.animate) {\n      this.animation$.next('enter');\n    }\n  }\n\n  /**\n   * Initialize the toolbar\n   */\n  private setToolbar(toolbar: string[]) {\n    const actions = toolbar.reduce((acc: Action[], toolName: string) => {\n      const tool = this.toolbox.getTool(toolName);\n      if (tool === undefined) {\n        return acc;\n      }\n\n      acc.push({\n        id: tool.name,\n        title: tool.title,\n        icon: tool.icon,\n        // iconImage: tool.iconImage,\n        tooltip: tool.tooltip,\n        args: [tool, this.toolbox],\n        handler: (_tool: Tool, _toolbox: Toolbox) => {\n          _toolbox.activateTool(_tool.name);\n        },\n        ngClass: (_tool: Tool, _toolbox: Toolbox) => {\n          return this.toolbox.activeTool$.pipe(\n            map((activeTool: Tool) => {\n              let toolActivated = false;\n              if (activeTool !== undefined && _tool.name === activeTool.name) {\n                toolActivated = true;\n              }\n\n              let childrenToolActivated = false;\n              if (\n                activeTool !== undefined &&\n                _tool.name === activeTool.parent\n              ) {\n                childrenToolActivated = true;\n              }\n\n              return {\n                'tool-activated': toolActivated,\n                'children-tool-activated': childrenToolActivated\n              };\n            })\n          );\n        }\n      });\n      return acc;\n    }, []);\n    this.actionStore.load(actions);\n    this.toolbar$.next(toolbar);\n  }\n\n  /**\n   * Observe the ongoing animation and ignore any incoming animation\n   * while one is still ongoing.\n   * @param callback Callback to execute when the animation completes\n   */\n  private onAnimate(callback: () => void) {\n    this.unAnimate();\n    this.animating$$ = this.animating$.subscribe((animation: boolean) => {\n      if (!animation) {\n        callback.call(this);\n        this.unAnimate();\n      }\n    });\n  }\n\n  /**\n   * Stop observing an animation when it's complete\n   */\n  private unAnimate() {\n    if (this.animating$$) {\n      this.animating$$.unsubscribe();\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoActionModule } from '../../action/action.module';\nimport {\n    IgoDynamicComponentModule\n} from '../../dynamic-component/dynamic-component.module';\n\nimport { ToolboxComponent } from './toolbox.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoActionModule,\n    IgoDynamicComponentModule\n  ],\n  exports: [\n    ToolboxComponent\n  ],\n  declarations: [\n    ToolboxComponent\n  ]\n})\nexport class IgoToolboxModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { ToolService } from './shared/tool.service';\nimport { IgoToolboxModule } from './toolbox/toolbox.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoToolboxModule\n  ],\n  declarations: []\n})\nexport class IgoToolModule {\n  static forRoot(): ModuleWithProviders<IgoToolModule> {\n    return {\n      ngModule: IgoToolModule,\n      providers: [\n        ToolService\n      ]\n    };\n  }\n}\n","<igo-dynamic-outlet\n  *ngIf=\"widget\"\n  [component]=\"widget\"\n  [inputs]=\"inputs\"\n  [subscribers]=\"getEffectiveSubscribers()\">\n</igo-dynamic-outlet>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnDestroy\n} from '@angular/core';\n\nimport { DynamicComponent } from '../../dynamic-component';\n\nimport { WidgetComponent } from '../shared/widget.interfaces';\n\n/**\n * This component dynamically renders a widget. It also subscribes\n * to the widget's 'cancel' and 'complete' events and destroys it\n * when any of those event is emitted.\n */\n@Component({\n  selector: 'igo-widget-outlet',\n  templateUrl: './widget-outlet.component.html',\n  styleUrls: ['./widget-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WidgetOutletComponent implements OnDestroy {\n\n  /**\n   * Widget subscribers to 'cancel' and 'complete'\n   * @internal\n   */\n  private baseSubscribers = {\n    cancel: (event: any) => this.onCancel(event),\n    complete: (event: any) => this.onComplete(event)\n  };\n\n  /**\n   * Widget\n   */\n  @Input() widget: DynamicComponent<WidgetComponent>;\n\n  /**\n   * Widget inputs\n   */\n  @Input() inputs: {[key: string]: any};\n\n  /**\n   * Widget subscribers\n   */\n  @Input() subscribers: {[key: string]: (event: any) => void} = {};\n\n  /**\n   * Event emitted when the widget emits 'complete'\n   */\n  @Output() complete = new EventEmitter<any>();\n\n  /**\n   * Event emitted when the widget emits 'cancel'\n   */\n  @Output() cancel = new EventEmitter<any>();\n\n  constructor() {}\n\n  /**\n   * Destroy the current widget and all it's inner subscriptions\n   * @internal\n   */\n  ngOnDestroy() {\n    this.destroyWidget();\n  }\n\n  /**\n   * Get the effective subscribers. That means a combination of the base\n   * subscribers and any subscriber given as input.\n   * @returns Combined subscribers\n   * @internal\n   */\n  getEffectiveSubscribers(): {[key: string]: (event: any) => void} {\n    const subscribers = Object.assign({}, this.subscribers);\n\n    // Base subscribers\n    Object.keys(this.baseSubscribers).forEach((key: string) => {\n      const subscriber = subscribers[key];\n      const baseSubscriber = this.baseSubscribers[key];\n      if (subscriber !== undefined) {\n        subscribers[key] = (event: any) => {\n          subscriber(event);\n          baseSubscriber(event);\n        };\n      } else {\n        subscribers[key] = baseSubscriber;\n      }\n    });\n\n    return subscribers;\n  }\n\n  /**\n   * When the widget emits 'cancel', propagate that event and destroy\n   * the widget\n   */\n  private onCancel(event: any) {\n    this.cancel.emit(event);\n    this.destroyWidget();\n  }\n\n  /**\n   * When the widget emits 'complete', propagate that event and destroy\n   * the widget\n   */\n  private onComplete(event: any) {\n    this.complete.emit(event);\n    this.destroyWidget();\n  }\n\n  /**\n   * Destroy the current widget\n   */\n  private destroyWidget() {\n    if (this.widget !== undefined) {\n      this.widget.destroy();\n    }\n    this.widget = undefined;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport {\n  IgoDynamicComponentModule\n} from '../../dynamic-component/dynamic-component.module';\n\nimport { WidgetOutletComponent } from './widget-outlet.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoDynamicComponentModule\n  ],\n  exports: [\n    WidgetOutletComponent\n  ],\n  declarations: [\n    WidgetOutletComponent\n  ]\n})\nexport class IgoWidgetOutletModule {}\n","import { Injectable } from '@angular/core';\n\nimport { DynamicComponentService } from '../../dynamic-component/shared/dynamic-component.service';\n\nimport { Widget } from './widget';\nimport { WidgetComponent } from './widget.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WidgetService {\n\n  constructor(private dynamicComponentService: DynamicComponentService) {}\n\n  create(widgetCls: any): Widget {\n    return this.dynamicComponentService.create(widgetCls as WidgetComponent);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoWidgetOutletModule } from './widget-outlet/widget-outlet.module';\nimport { WidgetService } from './shared/widget.service';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoWidgetOutletModule\n  ],\n  exports: [\n    IgoWidgetOutletModule\n  ],\n  declarations: [],\n  providers: [\n    WidgetService\n  ]\n})\nexport class IgoWidgetModule {}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { getEntityTitle } from '../../entity';\nimport { Workspace } from '../shared/workspace';\nimport { WorkspaceStore } from '../shared/store';\n\n/**\n * Drop list that activates the selected workspace emit an event.\n */\n@Component({\n  selector: 'igo-workspace-selector',\n  templateUrl: './workspace-selector.component.html',\n  styleUrls: ['./workspace-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WorkspaceSelectorComponent {\n\n  /**\n   * Store that holds the available workspaces.\n   */\n  @Input() store: WorkspaceStore;\n\n  /**\n   * Wheither the selector must be disabled or not.\n   */\n  @Input() disabled: boolean;\n\n  /**\n   * Event emitted when an workspace is selected or unselected\n   */\n  @Output() selectedChange = new EventEmitter<{\n    selected: boolean;\n    value: Workspace;\n  }>();\n\n  /**\n   * @internal\n   */\n  getWorkspaceTitle(workspace: Workspace): string {\n    return getEntityTitle(workspace);\n  }\n\n  /**\n   * When an workspace is manually selected, select it into the\n   * store and emit an event.\n   * @internal\n   * @param event The selection change event\n   */\n  onSelectedChange(event: {value: Workspace}) {\n    const workspace = event.value;\n    this.store.activateWorkspace(workspace);\n    this.selectedChange.emit({selected: true, value: workspace});\n  }\n\n}\n","<igo-entity-selector\n  [store]=\"store\"\n  [multi]=\"false\"\n  [titleAccessor]=\"getWorkspaceTitle\"\n  [disabled]=\"disabled\"\n  (selectedChange)=\"onSelectedChange($event)\">\n</igo-entity-selector>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoEntitySelectorModule } from '../../entity/entity-selector/entity-selector.module';\nimport { WorkspaceSelectorComponent } from './workspace-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoEntitySelectorModule\n  ],\n  exports: [\n    WorkspaceSelectorComponent\n  ],\n  declarations: [\n    WorkspaceSelectorComponent\n  ]\n})\nexport class IgoWorkspaceSelectorModule {}\n","<ng-container *ngIf=\"widget$ | async as widget\">\n  <igo-widget-outlet\n    [widget]=\"widget\"\n    [inputs]=\"widgetInputs$ | async\"\n    [subscribers]=\"widgetSubscribers$ | async\"\n    (cancel)=\"onWidgetCancel(widget)\"\n    (complete)=\"onWidgetComplete(widget)\">\n  </igo-widget-outlet>\n</ng-container>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Widget } from '../../widget';\nimport { Workspace } from '../shared/workspace';\n\n/**\n * This component dynamically render an Workspace's active widget.\n * It also deactivate that widget whenever the widget's component\n * emit the 'cancel' or 'complete' event.\n */\n@Component({\n  selector: 'igo-workspace-widget-outlet',\n  templateUrl: './workspace-widget-outlet.component.html',\n  styleUrls: ['./workspace-widget-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WorkspaceWidgetOutletComponent {\n\n  /**\n   * Workspace\n   */\n  @Input() workspace: Workspace;\n\n  /**\n   * Event emitted when a widget is deactivate which happens\n   * when the widget's component emits the 'cancel' or 'complete' event.\n   */\n  @Output() deactivateWidget = new EventEmitter<Widget>();\n\n  /**\n   * Observable of the workspace's active widget\n   * @internal\n   */\n  get widget$(): BehaviorSubject<Widget> { return this.workspace.widget$; }\n\n  /**\n   * Observable of the workspace's widget inputs\n   * @internal\n   */\n  get widgetInputs$(): BehaviorSubject<{[key: string]: any}> {\n    return this.workspace.widgetInputs$;\n  }\n\n  /**\n   * Observable of the workspace's widget inputs\n   * @internal\n   */\n  get widgetSubscribers$(): BehaviorSubject<{[key: string]: (event: any) => void}> {\n    return this.workspace.widgetSubscribers$;\n  }\n\n  constructor() {}\n\n  /**\n   * When a widget's component emit the 'cancel' event,\n   * deactivate that widget and emit the 'deactivateWidget' event.\n   * @param widget Widget\n   * @internal\n   */\n  onWidgetCancel(widget: Widget) {\n    this.workspace.deactivateWidget();\n    this.deactivateWidget.emit(widget);\n  }\n\n  /**\n   * When a widget's component emit the 'cancel' event,\n   * deactivate that widget and emit the 'deactivateWidget' event.\n   * @param widget Widget\n   * @internal\n   */\n  onWidgetComplete(widget: Widget) {\n    this.workspace.deactivateWidget();\n    this.deactivateWidget.emit(widget);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoWidgetOutletModule } from '../../widget/widget-outlet/widget-outlet.module';\n\nimport { WorkspaceWidgetOutletComponent } from './workspace-widget-outlet.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoWidgetOutletModule\n  ],\n  exports: [\n    WorkspaceWidgetOutletComponent\n  ],\n  declarations: [\n    WorkspaceWidgetOutletComponent\n  ]\n})\nexport class IgoWorkspaceWidgetOutletModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\nimport { IgoWorkspaceWidgetOutletModule } from './workspace-widget-outlet/workspace-widget-outlet.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceWidgetOutletModule\n  ],\n  declarations: []\n})\nexport class IgoWorkspaceModule {}\n","import { BehaviorSubject } from 'rxjs';\n\nexport class TableDatabase {\n  /** Stream that emits whenever the data has been modified. */\n  dataChange: BehaviorSubject<any[]> = new BehaviorSubject<any[]>([]);\n  get data(): any[] {\n    return this.dataChange.value;\n  }\n\n  constructor(data?) {\n    if (data) {\n      this.dataChange.next(data);\n    }\n  }\n\n  set(data) {\n    this.dataChange.next(data);\n  }\n\n  add(item) {\n    const copiedData = this.data.slice();\n    copiedData.push(item);\n    this.set(copiedData);\n  }\n\n  remove(item) {\n    const copiedData = this.data.slice();\n    const index = copiedData.indexOf(item);\n    copiedData.splice(index, 1);\n    this.set(copiedData);\n  }\n}\n","import { Tool } from './tool.interface';\nimport { ToolService } from './tool.service';\n\nexport function ToolComponent(tool: Partial<Tool>): (cls: any) => any {\n  return (compType: any) => {\n    ToolService.register(Object.assign({}, tool, {\n      component: compType\n    } as Tool));\n  };\n}\n","import { EntityStore } from '../../entity';\nimport { Workspace } from './workspace';\nimport { BehaviorSubject } from 'rxjs';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * workspaces.\n */\nexport class WorkspaceStore extends EntityStore<Workspace> {\n\n  activeWorkspace$: BehaviorSubject<Workspace> = new BehaviorSubject(undefined);\n\n  /**\n   * Activate the an workspace workspace and deactivate the one currently active\n   * @param workspace Workspace\n   */\n  activateWorkspace(workspace: Workspace) {\n    const active = this.activeWorkspace$.value;\n    if (active !== undefined) {\n      active.deactivate();\n    }\n\n    this.deactivateWorkspace();\n    if (workspace !== undefined) {\n      this.state.update(workspace, {active: true, selected: true}, true);\n      this.activeWorkspace$.next(workspace);\n      workspace.activate();\n    }\n  }\n\n  /**\n   * Deactivate the current workspace\n   * @param workspace Workspace\n   */\n  deactivateWorkspace() {\n    const active = this.activeWorkspace$.value;\n    if (active !== undefined) {\n      active.deactivate();\n      this.activeWorkspace$.next(undefined);\n    }\n  }\n\n}\n","import { Subscription, BehaviorSubject, Subject } from 'rxjs';\n\nimport { ActionStore } from '../../action';\nimport { Widget } from '../../widget';\nimport { EntityStore } from '../../entity';\n\nimport { WorkspaceOptions } from './workspace.interfaces';\n\n/**\n * This class is responsible of managing the relations between\n * entities and the actions that consume them. It also defines an\n * entity table template that may be used by an entity table component.\n */\nexport class Workspace<E extends object = object> {\n\n  /**\n   * Observable of the selected widget\n   */\n  readonly widget$ = new BehaviorSubject<Widget>(undefined);\n\n  /**\n   * Observable of the selected widget's inputs\n   */\n  readonly widgetInputs$ = new BehaviorSubject<{[key: string]: any}>({});\n\n  /**\n   * Observable of the selected widget's subscribers\n   */\n  readonly widgetSubscribers$ = new BehaviorSubject<{[key: string]: (event: any) => void}>({});\n\n  /**\n   * Subscription to the selected entity\n   */\n  private entities$$: Subscription;\n\n  /**\n   * State change that trigger an update of the actions availability\n   */\n  private change: Subject<void> = new Subject();\n\n  /**\n   * Subscription to state changes\n   */\n  private change$: Subscription;\n\n  /**\n   * Workspace id\n   */\n  get id(): string { return this.options.id; }\n\n  /**\n   * Workspace title\n   */\n  get title(): string { return this.options.title; }\n\n  /**\n   * Workspace title\n   */\n  get meta(): {[key: string]: any} { return this.options.meta || {}; }\n\n  /**\n   * Entities store\n   */\n  get entityStore(): EntityStore<E> { return this.options.entityStore as EntityStore<E>; }\n\n  /**\n   * Actions store (some actions activate a widget)\n   */\n  get actionStore(): ActionStore { return this.options.actionStore; }\n\n  /**\n   * Selected widget\n   */\n  get widget(): Widget { return this.widget$.value; }\n\n  /**\n   * Whether a widget is selected\n   */\n  get hasWidget(): boolean { return this.widget !== undefined; }\n\n  constructor(protected options: WorkspaceOptions) {}\n\n  /**\n   * Whether this strategy is active\n   * @internal\n   */\n  get active(): boolean { return this.active$.value; }\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Activate the workspace. By doing that, the workspace will observe\n   * the selected entity (from the store) and update the actions availability.\n   * For example, some actions require an entity to be selected.\n   */\n  activate() {\n    if (this.active === true) {\n      this.deactivate();\n    }\n    this.active$.next(true);\n\n    if (this.entityStore !== undefined) {\n      this.entities$$ = this.entityStore.stateView.all$()\n        .subscribe(() => this.onStateChange());\n    }\n\n    this.change.next();\n  }\n\n  /**\n   * Deactivate the workspace. Unsubcribe to the selected entity.\n   */\n  deactivate() {\n    this.active$.next(false);\n    this.deactivateWidget();\n\n    if (this.entities$$ !== undefined) {\n      this.entities$$.unsubscribe();\n    }\n    if (this.change$ !== undefined) {\n      this.change$.unsubscribe();\n    }\n  }\n\n  /**\n   * Activate a widget. In itself, activating a widget doesn't render it but,\n   * if an WorkspaceWidgetOutlet component is bound to this workspace, the widget will\n   * show up.\n   * @param widget Widget\n   * @param inputs Inputs the widget will receive\n   */\n  activateWidget(\n    widget: Widget,\n    inputs: {[key: string]: any} = {},\n    subscribers: {[key: string]: (event: any) => void} = {}\n  ) {\n    this.widget$.next(widget);\n    this.widgetInputs$.next(inputs);\n    this.widgetSubscribers$.next(subscribers);\n    this.change.next();\n  }\n\n  /**\n   * Deactivate a widget.\n   */\n  deactivateWidget() {\n    this.widget$.next(undefined);\n    this.change.next();\n  }\n\n  /**\n   * When the state changes, update the actions availability.\n   */\n  private onStateChange() {\n    this.change.next();\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppHomeComponent } from './home.component';\n\nconst routes: Routes = [\n  {\n    path: 'home',\n    component: AppHomeComponent\n  }\n];\n\nexport const AppHomeRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\nimport { InteractiveTourService } from '@igo2/common';\n\n@Component({\n  selector: 'app-home',\n  templateUrl: './home.component.html',\n  styleUrls: ['./home.component.scss']\n})\nexport class AppHomeComponent {\n  constructor(private interactiveTourService: InteractiveTourService) {}\n\n  startTour() {\n    this.interactiveTourService.startTour('global');\n  }\n}\n","<div style=\"text-align:center\">\n  <h1 id=\"igo-title\">\n    Welcome to IGO\n  </h1>\n  <img  class=\"igo-logo\" width=\"180\" src=\"assets/igo2/core/logo.png\">\n</div>\n\n<p>\n  <igo-interactive-tour\n    tourToStart = \"global\"\n    menuIsOpen = true\n    styleButton = \"raised\">\n  </igo-interactive-tour>\n</p>\n\n<p>\n  IGO2 library contains many components and services that may benefit any web application. <br>\n  IGO2 library is open source project using Angular, Angular Material and OpenLayers.\n</p>\n\n<h3>IGO2 library is divided into several elements: </h3>\n<ul>\n  <li><b>@igo2/utils</b> : Basic utilies without dependency (ex: base64, clipboard, uuid)</li>\n  <li><b>@igo2/core</b> : Element affecting the core of the application (ex: config, language, message, media, request)</li>\n  <li><b>@igo2/common</b> : Library containing reusable components (ex: clickout, drag-drop, list, panel, spinner, table)</li>\n  <li><b>@igo2/auth</b> : Library grouping the authentication and security module</li>\n  <li><b>@igo2/geo</b> : Library containing the geomatic components. Depends on Openlayers.</li>\n  <li><b>@igo2/context</b> : Library of components uniting @igo2/geo and @igo2/auth</li>\n  <li><b>@igo2/integration</b> : Library integrate basic components</li>\n</ul>\n\n<h2>Here are some links to help you start: </h2>\n<ul>\n  <li>\n    <h2><a target=\"_blank\" rel=\"noopener\" href=\"https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation\">Installation</a></h2>\n  </li>\n  <li>\n    <h2><a target=\"_blank\" rel=\"noopener\" href=\"https://angular.io/docs\">Angular Documentation</a></h2>\n  </li>\n</ul>\n\n*** Modules in <code>@igo2/core</code> must be imported only once\n","import { NgModule } from '@angular/core';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { AppHomeComponent } from './home.component';\nimport { AppHomeRoutingModule } from './home-routing.module';\nimport { IgoInteractiveTourModule } from '@igo2/common';\n\n@NgModule({\n  declarations: [AppHomeComponent],\n  imports: [\n    AppHomeRoutingModule,\n    IgoInteractiveTourModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule\n  ],\n  exports: [AppHomeComponent]\n})\nexport class AppHomeModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppActivityComponent } from './activity.component';\n\nconst routes: Routes = [\n  {\n    path: 'activity',\n    component: AppActivityComponent\n  }\n];\n\nexport const AppActivityRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { ActivityService } from '@igo2/core';\n\n@Component({\n  selector: 'app-activity',\n  templateUrl: './activity.component.html',\n  styleUrls: ['./activity.component.scss']\n})\nexport class AppActivityComponent {\n  private idsActivity: string[] = [];\n\n  constructor(private activityService: ActivityService) {}\n\n  register() {\n    this.idsActivity.push(this.activityService.register());\n  }\n\n  unregister() {\n    this.activityService.unregister(this.idsActivity.pop());\n  }\n\n  get counter() {\n    return this.activityService.counter$.value;\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>Activity</mat-card-title>\n  <mat-card-content>\n    <p>Register activities in service. Use to display a loading icon</p>\n\n    <li>Import <code>IgoActivityModule</code> only if you want register http calls</li>\n    <li>Import <code>IgoActivityModule</code> only once</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/activity\"> code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <mat-card-actions>\n    <button mat-raised-button (click)=\"register()\">Register</button>\n    <button mat-raised-button (click)=\"unregister()\">Unregister</button>\n  </mat-card-actions>\n  <p>Counter: {{counter}}</p>\n\n  <igo-spinner igoSpinnerActivity></igo-spinner>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoActivityModule } from '@igo2/core';\nimport { IgoSpinnerModule } from '@igo2/common';\n\nimport { AppActivityComponent } from './activity.component';\nimport { AppActivityRoutingModule } from './activity-routing.module';\n\n@NgModule({\n  declarations: [AppActivityComponent],\n  imports: [\n    AppActivityRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoActivityModule.forRoot(), // Only if you want register http calls\n    IgoSpinnerModule\n  ],\n  exports: [AppActivityComponent]\n})\nexport class AppActivityModule {}\n","interface Environment {\n  production: boolean;\n  igo: any;\n}\n\nexport const environment: Environment = {\n  production: true,\n  igo: {\n    projections: [\n      {\n        code: 'EPSG:32198',\n        alias: 'Quebec Lambert',\n        def:\n          '+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs',\n        extent: [-886251.0296, 180252.9126, 897177.3418, 2106143.8139]\n      }\n    ],\n    auth: {\n      intern: {\n        enabled: true\n      },\n      allowAnonymous: true\n    },\n    interactiveTour: {\n      tourInMobile: true\n    },\n    importExport: {\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ogre'\n    },\n    language: {\n      prefix: './locale/'\n    },\n    catalog: {\n      sources: [\n        {\n          id: 'Gououvert',\n          title: 'Gouvouvert',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi'\n        },\n        {\n          id: 'DefiningInfoFormat',\n          title: 'Defining info_format',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          queryFormat: {\n            html: '*',\n            'application/json': [\n              'stations_meteoroutieres',\n              'histo_stations_meteoroutieres'\n            ]\n          },\n          queryHtmlTarget: 'iframe',\n          count: 30\n        },\n        {\n          id: 'catalogwithregex',\n          title: 'Filtered catalog by regex',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          regFilters: ['zpegt']\n        },\n        {\n          id: 'catalogwithtooltipcontrol',\n          title: 'Controling tooltip format',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          tooltipType: 'abstract' // or title\n        }\n      ]\n    },\n    searchSources: {\n      nominatim: {\n        enabled: false\n      },\n      icherche: {\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\n        order: 2,\n        enabled: true,\n        params: {\n          limit: '8'\n        }\n      },\n      coordinatesreverse: {\n        showInPointerSummary: true\n      },\n      icherchereverse: {\n        showInPointerSummary: true,\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\n        order: 3,\n        enabled: true\n      },\n      ilayer: {\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\n        order: 4,\n        enabled: true,\n        params: {\n          limit: '5'\n        }\n      }\n    }\n  }\n};\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppConfigComponent } from './config.component';\n\nconst routes: Routes = [\n  {\n    path: 'config',\n    component: AppConfigComponent\n  }\n];\n\nexport const AppConfigRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\nimport { ConfigService, LanguageOptions } from '@igo2/core';\n\n@Component({\n  selector: 'app-config',\n  templateUrl: './config.component.html',\n  styleUrls: ['./config.component.scss']\n})\nexport class AppConfigComponent {\n  public configLanguage: LanguageOptions;\n\n  constructor(private configService: ConfigService) {\n    this.configLanguage = this.configService.getConfig('language');\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>config</mat-card-title>\n  <mat-card-content>\n    <p>Load config in your angular application</p>\n\n    <li>Import <code>IgoConfigModule</code> only once</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/config\"> code of this example</a> <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\n    <hr>\n  </mat-card-content>\n\n  <p>Config language: {{configLanguage | json }}<p>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoConfigModule, provideConfigOptions } from '@igo2/core';\n\nimport { environment } from '../../../environments/environment';\nimport { AppConfigComponent } from './config.component';\nimport { AppConfigRoutingModule } from './config-routing.module';\n\n@NgModule({\n  declarations: [AppConfigComponent],\n  imports: [\n    AppConfigRoutingModule,\n    CommonModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoConfigModule.forRoot()\n  ],\n  exports: [AppConfigComponent],\n  providers: [\n    provideConfigOptions({\n      default: environment.igo\n    })\n  ]\n})\nexport class AppConfigModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppLanguageComponent } from './language.component';\n\nconst routes: Routes = [\n  {\n    path: 'language',\n    component: AppLanguageComponent\n  }\n];\n\nexport const AppLanguageRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-language',\n  templateUrl: './language.component.html',\n  styleUrls: ['./language.component.scss']\n})\nexport class AppLanguageComponent {\n  public app = {\n    title: 'IGO'\n  };\n  constructor(private languageService: LanguageService) {}\n\n  changeLanguage(language: string) {\n    this.languageService.setLanguage(language);\n    console.log(this.languageService);\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>language</mat-card-title>\n  <mat-card-content>\n    <p>Translate your angular application</p>\n\n    <li>Import <code>IgoLanguageModule</code> only once</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/language\">code of this example</a><br>\n    See language section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a><br>\n    See <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/locale\">locale files</a>\n    <hr>\n  </mat-card-content>\n\n  <mat-card-actions>\n    <button mat-raised-button (click)=\"changeLanguage('en')\">English</button>\n    <button mat-raised-button (click)=\"changeLanguage('fr')\">Franais</button>\n  </mat-card-actions>\n\n  <p>{{'welcome' | translate: app}}<p>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { AppLanguageComponent } from './language.component';\nimport { AppLanguageRoutingModule } from './language-routing.module';\n\n@NgModule({\n  declarations: [AppLanguageComponent],\n  imports: [\n    AppLanguageRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoLanguageModule.forRoot()\n  ],\n  exports: [AppLanguageComponent]\n})\nexport class AppLanguageModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppMediaComponent } from './media.component';\n\nconst routes: Routes = [\n  {\n    path: 'media',\n    component: AppMediaComponent\n  }\n];\n\nexport const AppMediaRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { MediaService } from '@igo2/core';\n\n@Component({\n  selector: 'app-media',\n  templateUrl: './media.component.html',\n  styleUrls: ['./media.component.scss']\n})\nexport class AppMediaComponent {\n  constructor(private mediaService: MediaService) {}\n\n  get media() {\n    return this.mediaService.getMedia();\n  }\n\n  get orientation() {\n    return this.mediaService.getOrientation();\n  }\n\n  get isTouchScreen() {\n    return this.mediaService.isTouchScreen();\n  }\n\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>Media</mat-card-title>\n  <mat-card-content>\n    <p>Detect type of media (mobile, tablet, desktop)</p>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/media\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <p>Current media: {{media}}</p>\n  <p>Current orientation: {{orientation}}</p>\n  <p>Device mode:  {{isTouchScreen ? 'Touch device' : 'Not a touch device '}}</p>\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { AppMediaComponent } from './media.component';\nimport { AppMediaRoutingModule } from './media-routing.module';\n\n@NgModule({\n  declarations: [AppMediaComponent],\n  imports: [AppMediaRoutingModule, MatCardModule],\n  exports: [AppMediaComponent]\n})\nexport class AppMediaModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppMessageComponent } from './message.component';\n\nconst routes: Routes = [\n  {\n    path: 'message',\n    component: AppMessageComponent\n  }\n];\n\nexport const AppMessageRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { MessageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-message',\n  templateUrl: './message.component.html',\n  styleUrls: ['./message.component.scss']\n})\nexport class AppMessageComponent {\n  constructor(private messageService: MessageService) {}\n\n  success() {\n    this.messageService.success('Congratulations', 'Success');\n  }\n\n  info() {\n    this.messageService.info('Welcome to IGO', 'Info');\n  }\n\n  alert() {\n    this.messageService.alert('Warning', 'Alert');\n  }\n  error() {\n    this.messageService.error('There is a bug', 'Error');\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>Message</mat-card-title>\n  <mat-card-content>\n    <p>Show message to user.</p>\n\n    <li>Import <code>IgoMessageModule</code> only once</li>\n    <li>Dependencies: BrowserAnimationsModule </li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/message\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <mat-card-actions>\n    <button mat-raised-button (click)=\"success()\">Success message</button>\n    <button mat-raised-button color='primary' (click)=\"info()\">Info message</button>\n    <button mat-raised-button color='accent' (click)=\"alert()\">Alert message</button>\n    <button mat-raised-button color='warn' (click)=\"error()\">Error message</button>\n  </mat-card-actions>\n</mat-card>\n\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMessageModule } from '@igo2/core';\n\nimport { AppMessageComponent } from './message.component';\nimport { AppMessageRoutingModule } from './message-routing.module';\n\n@NgModule({\n  declarations: [AppMessageComponent],\n  imports: [\n    AppMessageRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMessageModule.forRoot()\n  ],\n  exports: [AppMessageComponent]\n})\nexport class AppMessageModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppRequestComponent } from './request.component';\n\nconst routes: Routes = [\n  {\n    path: 'request',\n    component: AppRequestComponent\n  }\n];\n\nexport const AppRequestRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-request',\n  templateUrl: './request.component.html',\n  styleUrls: ['./request.component.scss']\n})\nexport class AppRequestComponent {\n  constructor(\n    private http: HttpClient,\n    public languageService: LanguageService\n  ) {}\n\n  callHttp() {\n    const url = 'https://geoegl.msp.gouv.qc.ca/apis/icherche/info';\n    this.http.get(url).subscribe(rep => {\n      console.log(rep);\n    });\n  }\n\n  callHttpError() {\n    const url = '404';\n    this.http.get(url).subscribe(rep => {\n      console.log(rep);\n    });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>Request</mat-card-title>\n  <mat-card-content>\n    <p>Register http calls in console</p>\n\n    <li>Import <code>IgoLoggingModule</code> only if you want register http calls in console</li>\n    <li>Import <code>IgoErrorModule</code> only if you want register errors from http call in console</li>\n    <li>Import modules only once</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/request\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <mat-card-actions>\n    <button mat-raised-button (click)=\"callHttp()\">Log</button>\n    <button mat-raised-button (click)=\"callHttpError()\">Error</button>\n  </mat-card-actions>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { HttpClientModule } from '@angular/common/http';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoErrorModule, IgoLanguageModule } from '@igo2/core';\n\nimport { AppRequestComponent } from './request.component';\nimport { AppRequestRoutingModule } from './request-routing.module';\n\n@NgModule({\n  declarations: [AppRequestComponent],\n  imports: [\n    AppRequestRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    HttpClientModule,\n    IgoLanguageModule.forRoot(),\n    IgoErrorModule.forRoot() // Only if you want register errors from http call in console\n    // IgoLoggingModule.forRoot() // Only if you want register http calls in console\n  ],\n  exports: [AppRequestComponent]\n})\nexport class AppRequestModule {}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Action</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/action\">code of this example</a>\n  </mat-card-content>\n\n  <igo-actionbar\n    [store]=\"store\"\n    [withIcon]=\"true\"\n    [withTitle]=\"actionbarMode === 'overlay'\"\n    [horizontal]=\"true\"\n    [mode]=\"actionbarMode\">\n  </igo-actionbar>\n\n</mat-card>\n<p></p>\n\n<mat-card [igoContextMenu]= actionbarMenu>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Action context-menu</mat-card-title>\n  <div></div>\n</mat-card>\n\n\n\n<ng-template #actionbarMenu>\n  <igo-actionbar\n    [store]=\"store\"\n    [withIcon]=\"true\"\n    [horizontal]=\"true\"\n    [mode]=\"'context'\">\n  </igo-actionbar>\n</ng-template>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppActionComponent } from './action.component';\n\nconst routes: Routes = [\n  {\n    path: 'action',\n    component: AppActionComponent\n  }\n];\n\nexport const AppActionRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport {\n  Media,\n  MediaOrientation,\n  MediaService,\n  LanguageService\n} from '@igo2/core';\nimport { ActionStore, ActionbarMode } from '@igo2/common';\nimport { Overlay } from '@angular/cdk/overlay';\n\n@Component({\n  selector: 'app-action',\n  templateUrl: './action.component.html',\n  styleUrls: ['./action.component.scss']\n})\nexport class AppActionComponent implements OnInit, OnDestroy {\n  public store = new ActionStore([]);\n\n  private added$ = new BehaviorSubject(false);\n\n  get actionbarMode(): ActionbarMode {\n    const media = this.mediaService.media$.value;\n    const orientation = this.mediaService.orientation$.value;\n    if (media === Media.Desktop && orientation === MediaOrientation.Landscape) {\n      return ActionbarMode.Dock;\n    }\n    return ActionbarMode.Overlay;\n  }\n\n  constructor(\n    public overlay: Overlay,\n    private mediaService: MediaService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    this.store.load([\n      {\n        id: 'add',\n        title: 'Add',\n        icon: 'plus',\n        tooltip: 'Add Tooltip',\n        handler: () => {\n          alert('Add!');\n          this.added$.next(true);\n        }\n      },\n      {\n        id: 'edit',\n        title: 'Edit',\n        icon: 'pencil',\n        tooltip: 'Edit Tooltip',\n        args: ['1'],\n        handler: (item: string) => {\n          alert(`Edit item ${item}!`);\n        },\n        availability: () => this.added$\n      },\n      {\n        id: 'delete',\n        title: 'Delete',\n        tooltip: 'Delete Tooltip',\n        icon: 'delete',\n        handler: () => {\n          alert('Delete!');\n          this.added$.next(false);\n        },\n        availability: () => this.added$\n      }\n    ]);\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoActionModule, IgoContextMenuModule } from '@igo2/common';\n\nimport { AppActionComponent } from './action.component';\nimport { AppActionRoutingModule } from './action-routing.module';\n\n@NgModule({\n  declarations: [AppActionComponent],\n  imports: [\n    AppActionRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoActionModule,\n    IgoContextMenuModule\n  ],\n  exports: [AppActionComponent]\n})\nexport class AppActionModule {}\n","import { Component, Input, ChangeDetectionStrategy, ChangeDetectorRef } from '@angular/core';\n\nimport { OnUpdateInputs } from '@igo2/common';\n\n@Component({\n  selector: 'app-salutation-component',\n  template: '<p>Hello, my name is {{name}}.</p>',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSalutationComponent implements OnUpdateInputs {\n\n  @Input() name: string;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n}\n\n@Component({\n  selector: 'app-explanation-component',\n  template: '<p>I am a dynamic component, rendered into an IgoDynamicOutlet.</p>',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppExplanationComponent implements OnUpdateInputs {\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n}\n\n@Component({\n  selector: 'app-dynamic-component',\n  templateUrl: './dynamic-component.component.html',\n  styleUrls: ['./dynamic-component.component.scss']\n})\nexport class AppDynamicComponentComponent {\n\n  component: any = AppSalutationComponent;\n\n  inputs = {name: 'Bob'};\n\n  toggleComponent() {\n    this.component = this.component === AppSalutationComponent ?\n      AppExplanationComponent :\n      AppSalutationComponent;\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppDynamicComponentComponent } from './dynamic-component.component';\n\nconst routes: Routes = [\n  {\n    path: 'dynamic-component',\n    component: AppDynamicComponentComponent\n  }\n];\n\nexport const AppDynamicComponentRoutingModule = RouterModule.forChild(\n  routes\n);\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Dynamic Component</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/dynamic-component\">code of this example</a>\n  </mat-card-content>\n\n  <igo-dynamic-outlet\n    [component]=\"component\"\n    [inputs]=\"inputs\">\n  </igo-dynamic-outlet>\n\n  <button mat-flat-button color=\"primary\" (click)=\"toggleComponent()\">Toggle Component</button>\n</mat-card>\n\n\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoDynamicComponentModule } from '@igo2/common';\n\nimport {\n  AppSalutationComponent,\n  AppExplanationComponent,\n  AppDynamicComponentComponent\n} from './dynamic-component.component';\nimport { AppDynamicComponentRoutingModule } from './dynamic-component-routing.module';\n\n@NgModule({\n  declarations: [\n    AppSalutationComponent,\n    AppDynamicComponentComponent,\n    AppExplanationComponent\n  ],\n  imports: [\n    AppDynamicComponentRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoDynamicComponentModule\n  ],\n  exports: [AppDynamicComponentComponent],\n  entryComponents: [\n    AppSalutationComponent,\n    AppExplanationComponent\n  ]\n})\nexport class AppDynamicComponentModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppEntityTableComponent } from './entity-table.component';\n\nconst routes: Routes = [\n  {\n    path: 'entity-table',\n    component: AppEntityTableComponent\n  }\n];\n\nexport const AppEntityTableRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  EntityStore,\n  EntityTableButton,\n  getEntityProperty,\n  EntityTableColumnRenderer,\n  EntityTablePaginatorOptions\n} from '@igo2/common';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'app-entity-table',\n  templateUrl: './entity-table.component.html',\n  styleUrls: ['./entity-table.component.scss']\n})\nexport class AppEntityTableComponent implements OnInit, OnDestroy {\n  public store = new EntityStore([]);\n  public paginator: MatPaginator;\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public paginatorOptions: EntityTablePaginatorOptions = {pageSize: 10};\n\n  public template = {\n    selection: true,\n    selectionCheckbox: true,\n    selectMany: true,\n    sort: true,\n    valueAccessor: (entity: object, name: string) => {\n      return getEntityProperty(entity, name);\n    },\n    columns: [\n      {\n        name: 'selected',\n        title: 'Selected',\n        valueAccessor: (entity: object) => {\n          return this.store.state.get(entity).selected\n            ? 'radiobox-marked'\n            : 'radiobox-blank';\n        },\n        renderer: EntityTableColumnRenderer.Icon\n      },\n      {\n        name: 'id',\n        title: 'ID'\n      },\n      {\n        name: 'name',\n        title: 'Name'\n      },\n      {\n        name: 'description',\n        title: 'Description',\n        renderer: EntityTableColumnRenderer.HTML\n      },\n      {\n        name: 'url',\n        title: 'Hyperlink'\n      },\n      {\n        name: 'image',\n        title: 'Image'\n      },\n      {\n        name: 'action',\n        title: '',\n        valueAccessor: (entity: object) => {\n          return [{\n            icon: 'home',\n            color: 'warn',\n            click: (row) => { console.log(row); }\n          }] as EntityTableButton[];\n        },\n        renderer: EntityTableColumnRenderer.ButtonGroup\n      }\n    ]\n  };\n\n  constructor(private languageService: LanguageService) {}\n\n  ngOnInit() {\n    const ids = [2, 1, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13];\n\n    const entities = ids.map(id => {\n      return { id , name: `Name ${id}`, description: `<b>Description ${id}</b>`, url: 'https://igouverte.org', image: 'https://www.igouverte.org/assets/img/Igo_logoavec.png'};\n    });\n    this.store.load(entities);\n  }\n\n  entitySortChange() {\n    this.entitySortChange$.next(true);\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.paginator = event;\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Entity Table</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/entity-table\">code of this example</a>\n  </mat-card-content>\n  <igo-entity-table\n    [store]=\"store\"\n    [withPaginator]=\"true\"\n    [paginatorOptions]=\"paginatorOptions\"\n    [template]=\"template\"\n    (entitySortChange)=\"entitySortChange()\">\n  </igo-entity-table>\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoEntityTableModule, IgoEntityTablePaginatorModule } from '@igo2/common';\n\nimport { AppEntityTableComponent } from './entity-table.component';\nimport { AppEntityTableRoutingModule } from './entity-table-routing.module';\n\n@NgModule({\n  declarations: [AppEntityTableComponent],\n  imports: [\n    AppEntityTableRoutingModule,\n    MatCardModule,\n    IgoEntityTableModule,\n    IgoEntityTablePaginatorModule\n  ],\n  exports: [AppEntityTableComponent]\n})\nexport class AppEntityTableModule {}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Entity Selector</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/entity-selector\">code of this example</a>\n  </mat-card-content>\n\n  <igo-entity-selector\n    [store]=\"store\"\n    [titleAccessor]=\"getTitle\"\n    [emptyText]=\"''\"\n    [placeholder]=\"'Select an entity'\"\n    (selectedChange)=\"onSelectedChange($event)\">\n  </igo-entity-selector>\n\n  <div *ngIf=\"selected$ | async as selected\">\n    <p>ID: {{selected.id}}</p>\n    <p>Name: {{selected.name}}</p>\n    <p>Description: <span [innerHtml]=\"selected.description\"></span></p>\n  </div>\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppEntitySelectorComponent } from './entity-selector.component';\n\nconst routes: Routes = [\n  {\n    path: 'entity-selector',\n    component: AppEntitySelectorComponent\n  }\n];\n\nexport const AppEntitySelectorRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport { EntityStore } from '@igo2/common';\n\ninterface DemoEntity {\n  id: string;\n  name: string;\n  description: string;\n}\n\n@Component({\n  selector: 'app-entity-selector',\n  templateUrl: './entity-selector.component.html',\n  styleUrls: ['./entity-selector.component.scss']\n})\nexport class AppEntitySelectorComponent implements OnInit, OnDestroy {\n\n  public store = new EntityStore([]);\n\n  public selected$ = new BehaviorSubject<DemoEntity>(undefined);\n\n  constructor(private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.store.load([\n      {id: '2', name: 'Name 2', description: '<b>Description 2</b>'},\n      {id: '1', name: 'Name 1', description: '<b>Description 1</b>'},\n      {id: '3', name: 'Name 3', description: '<b>Description 3</b>'}\n    ]);\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  getTitle(entity: DemoEntity): string {\n    return entity.name;\n  }\n\n  onSelectedChange(event: {selected: boolean; entity: DemoEntity}) {\n    this.selected$.next(event.entity);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoEntitySelectorModule } from '@igo2/common';\n\nimport { AppEntitySelectorComponent } from './entity-selector.component';\nimport { AppEntitySelectorRoutingModule } from './entity-selector-routing.module';\n\n@NgModule({\n  declarations: [AppEntitySelectorComponent],\n  imports: [\n    CommonModule,\n    AppEntitySelectorRoutingModule,\n    MatCardModule,\n    IgoEntitySelectorModule\n  ],\n  exports: [AppEntitySelectorComponent]\n})\nexport class AppEntitySelectorModule {}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Form</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/form\">code of this example</a>\n  </mat-card-content>\n\n  <igo-form\n    *ngIf=\"form$ | async as form\"\n    [form]=\"form\"\n    [formData]=\"data$ | async\"\n    (submitForm)=\"onSubmit($event)\">\n\n    <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n    <div formButtons>\n      <button\n        mat-stroked-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"fillForm()\">\n        Fill Form\n      </button>\n      <button\n        mat-stroked-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"clearForm()\">\n        Clear Form\n      </button>\n      <button\n        mat-flat-button\n        type=\"submit\"\n        color=\"primary\"\n        [disabled]=\"submitDisabled\">\n        Submit\n      </button>\n    </div>\n  </igo-form>\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppFormComponent } from './form.component';\n\nconst routes: Routes = [\n  {\n    path: 'form',\n    component: AppFormComponent\n  }\n];\n\nexport const AppFormRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport { Form, FormService } from '@igo2/common';\n\n@Component({\n  selector: 'app-form',\n  templateUrl: './form.component.html',\n  styleUrls: ['./form.component.scss']\n})\nexport class AppFormComponent implements OnInit, OnDestroy {\n\n  form$ = new BehaviorSubject<Form>(undefined);\n\n  data$ = new BehaviorSubject<{[key: string]: any}>(undefined);\n\n  submitDisabled = true;\n\n  private valueChanges$$: Subscription;\n\n  constructor(\n    private formService: FormService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    const fieldConfigs = [\n      {\n        name: 'id',\n        title: 'ID',\n        options: {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        options: {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'status',\n        title: 'Status',\n        type: 'select',\n        options: {\n          cols: 2\n        },\n        inputs: {\n          choices: [\n            {value: 1, title: 'Single'},\n            {value: 2, title: 'Married'}\n          ]\n        }\n      }\n    ];\n\n    const fields = fieldConfigs.map((config) => this.formService.field(config));\n    const form = this.formService.form([], [this.formService.group({name: 'info'}, fields)]);\n\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\n      this.submitDisabled = !form.control.valid;\n    });\n\n    this.form$.next(form);\n  }\n\n  ngOnDestroy() {\n    this.valueChanges$$.unsubscribe();\n  }\n\n  fillForm() {\n    this.data$.next({\n      id: 1,\n      name: 'Bob',\n      status: 2\n    });\n  }\n\n  clearForm() {\n    this.form$.value.control.reset();\n  }\n\n  onSubmit(data: {[key: string]: any}) {\n    alert(JSON.stringify(data));\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoFormModule } from '@igo2/common';\n\nimport { AppFormComponent } from './form.component';\nimport { AppFormRoutingModule } from './form-routing.module';\n\n@NgModule({\n  declarations: [AppFormComponent],\n  imports: [\n    CommonModule,\n    AppFormRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoFormModule\n  ],\n  exports: [AppFormComponent]\n})\nexport class AppFormModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppTableComponent } from './table.component';\n\nconst routes: Routes = [\n  {\n    path: 'table',\n    component: AppTableComponent\n  }\n];\n\nexport const AppTableRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { TableDatabase, TableActionColor } from '@igo2/common';\n\n@Component({\n  selector: 'app-table',\n  templateUrl: './table.component.html',\n  styleUrls: ['./table.component.scss']\n})\nexport class AppTableComponent implements OnInit {\n  public database: TableDatabase;\n\n  public model = {\n    columns: [\n      {\n        name: 'id',\n        title: 'ID',\n        sortable: false,\n        filterable: true\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        sortable: true,\n        filterable: true\n      },\n      {\n        name: 'description',\n        title: 'Description',\n        sortable: true,\n        filterable: true\n      }\n    ],\n    actions: [\n      {\n        icon: 'file-document',\n        color: TableActionColor.primary,\n        click: row => this.showName(row.name)\n      }\n    ],\n    selectionCheckbox: true\n  };\n\n  constructor(private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.database = new TableDatabase([\n      { id: '2', name: 'Name 2', description: 'Hello 2' },\n      { id: '1', name: 'Name 1', description: 'Bonjour 1' },\n      { id: '3', name: 'Name 3', description: 'Hola 3' }\n    ]);\n  }\n\n  showName(name) {\n    alert(name);\n  }\n\n  handleSelect(rows) {\n    console.log(rows);\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Table</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/table\">code of this example</a>\n  </mat-card-content>\n\n  <igo-table\n    [database]=\"database\"\n    [model]=\"model\"\n    [hasFilterInput]=\"true\"\n    (select)=\"handleSelect($event)\">\n  </igo-table>\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoTableModule } from '@igo2/common';\n\nimport { AppTableComponent } from './table.component';\nimport { AppTableRoutingModule } from './table-routing.module';\n\n@NgModule({\n  declarations: [AppTableComponent],\n  imports: [\n    AppTableRoutingModule,\n    MatCardModule,\n    IgoTableModule\n  ],\n  exports: [AppTableComponent]\n})\nexport class AppTableModule {}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Tool</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/tool\">code of this example</a>\n  </mat-card-content>\n\n  <igo-panel [title]=\"panelTitle\">\n    <button\n      mat-icon-button\n      panelLeftButton\n      (click)=\"toolbox.activatePreviousTool()\"\n      *ngIf=\"activeTool$ | async\">\n      <mat-icon svgIcon=\"arrow-back\"></mat-icon>\n    </button>\n\n    <button\n      mat-icon-button\n      panelRightButton\n      (click)=\"toolbox.deactivateTool()\"\n      *ngIf=\"activeTool$ | async\">\n      <mat-icon svgIcon=\"menu\"></mat-icon>\n    </button>\n\n    <igo-toolbox [toolbox]=\"toolbox\" [animate]=\"true\"></igo-toolbox>\n  </igo-panel>\n\n  <button\n    mat-flat-button\n    type=\"button\"\n    color=\"primary\"\n    (click)=\"activateSalutationTool()\">\n    Activate Salutation Tool\n  </button>\n\n</mat-card>\n","import {\n  Component,\n  OnInit,\n  OnDestroy,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  OnUpdateInputs,\n  Tool,\n  Toolbox,\n  ToolComponent,\n  ToolService\n} from '@igo2/common';\n\n@ToolComponent({\n  name: 'demo-salutation',\n  title: 'Salutation',\n  icon: 'account',\n  options: {name: 'Jack'}\n})\n@Component({\n  selector: 'app-salutation-tool',\n  template: `\n    <p>Hello, my name is {{name}}.</p>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSalutationToolComponent implements OnUpdateInputs {\n\n  @Input() name: string;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n}\n\n@ToolComponent({\n  name: 'demo-about',\n  title: 'About',\n  icon: 'information'\n})\n@Component({\n  selector: 'app-about-tool',\n  template: `\n    <p>I'm a tool inside a toolbox.</p>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppAboutToolComponent {}\n\n@Component({\n  selector: 'app-tool',\n  templateUrl: './tool.component.html',\n  styleUrls: ['./tool.component.scss']\n})\nexport class AppToolComponent implements OnInit, OnDestroy {\n\n  toolbox = new Toolbox();\n\n  get activeTool$(): BehaviorSubject<Tool> {\n    return this.toolbox.activeTool$;\n  }\n\n  get panelTitle(): string {\n    return this.activeTool$.value ? this.activeTool$.value.title : 'Toolbox';\n  }\n\n  constructor(\n    private toolService: ToolService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    this.toolbox.setToolbar(['demo-salutation', 'demo-about']);\n    this.toolbox.setTools(this.toolService.getTools());\n  }\n\n  ngOnDestroy() {\n    this.toolbox.destroy();\n  }\n\n  activateSalutationTool() {\n    this.toolbox.activateTool('demo-salutation', {name: 'Bob'});\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppToolComponent } from './tool.component';\n\nconst routes: Routes = [\n  {\n    path: 'tool',\n    component: AppToolComponent\n  }\n];\n\nexport const AppToolRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoPanelModule, IgoToolModule } from '@igo2/common';\n\nimport {\n  AppToolComponent,\n  AppSalutationToolComponent,\n  AppAboutToolComponent\n} from './tool.component';\nimport { AppToolRoutingModule } from './tool-routing.module';\n\n@NgModule({\n  declarations: [\n    AppToolComponent,\n    AppSalutationToolComponent,\n    AppAboutToolComponent\n  ],\n  imports: [\n    CommonModule,\n    AppToolRoutingModule,\n    MatButtonModule,\n    MatIconModule,\n    MatCardModule,\n    IgoLanguageModule,\n    IgoPanelModule,\n    IgoToolModule.forRoot()\n  ],\n  exports: [AppToolComponent],\n  entryComponents: [\n    AppSalutationToolComponent,\n    AppAboutToolComponent\n  ]\n})\nexport class AppToolModule {}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { DynamicComponent, OnUpdateInputs, WidgetComponent, WidgetService } from '@igo2/common';\n\n@Component({\n  selector: 'app-salutation-widget',\n  template: `\n    <p>Hello, my name is {{name}}.</p>\n    <button mat-flat-button (click)=\"complete.emit(name)\">Nice to meet you</button>\n    <button mat-flat-button (click)=\"cancel.emit(name)\">Dismiss</button>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSalutationWidgetComponent implements OnUpdateInputs, WidgetComponent {\n\n  @Input() name: string;\n\n  @Output() complete = new EventEmitter<string>();\n\n  @Output() cancel = new EventEmitter<string>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n}\n\n@Component({\n  selector: 'app-widget',\n  templateUrl: './widget.component.html',\n  styleUrls: ['./widget.component.scss']\n})\nexport class AppWidgetComponent {\n\n  widget: DynamicComponent<WidgetComponent> = this.widgetService.create(AppSalutationWidgetComponent);\n\n  inputs = {name: 'Bob'};\n\n  constructor(private widgetService: WidgetService) {}\n\n  onWidgetComplete(name: string) {\n    alert(`${name} emitted event 'complete' then got automatically destroyed.`);\n  }\n\n  onWidgetCancel() {\n    alert(`Widget emitted event 'cancel' then got automatically destroyed.`);\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppWidgetComponent } from './widget.component';\n\nconst routes: Routes = [\n  {\n    path: 'widget',\n    component: AppWidgetComponent\n  }\n];\n\nexport const AppWidgetRoutingModule = RouterModule.forChild(\n  routes\n);\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Widget</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/widget\">code of this example</a>\n  </mat-card-content>\n\n  <igo-widget-outlet\n    [widget]=\"widget\"\n    [inputs]=\"inputs\"\n    (complete)=\"onWidgetComplete($event)\"\n    (cancel)=\"onWidgetCancel()\">\n  </igo-widget-outlet>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoWidgetModule } from '@igo2/common';\n\nimport {\n  AppSalutationWidgetComponent,\n  AppWidgetComponent\n} from './widget.component';\nimport { AppWidgetRoutingModule } from './widget-routing.module';\n\n@NgModule({\n  declarations: [\n    AppSalutationWidgetComponent,\n    AppWidgetComponent\n  ],\n  imports: [\n    AppWidgetRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoWidgetModule\n  ],\n  exports: [AppWidgetComponent],\n  entryComponents: [\n    AppSalutationWidgetComponent\n  ]\n})\nexport class AppWidgetModule {}\n","import { Injectable, Injector } from '@angular/core';\nimport jwtDecode from 'jwt-decode';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthOptions } from './auth.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TokenService {\n  private options: AuthOptions;\n\n  constructor(private injector: Injector) {}\n\n  set(token: string) {\n    localStorage.setItem(this.tokenKey, token);\n  }\n\n  remove() {\n    localStorage.removeItem(this.tokenKey);\n  }\n\n  get(): string {\n    return localStorage.getItem(this.tokenKey);\n  }\n\n  decode() {\n    const token = this.get();\n    if (!token) {\n      return;\n    }\n    return jwtDecode(token);\n  }\n\n  isExpired() {\n    const jwt = this.decode();\n    const currentTime = new Date().getTime() / 1000;\n    if (jwt && currentTime < jwt.exp) {\n      return false;\n    }\n    return true;\n  }\n\n  private get tokenKey() {\n    const config = this.injector.get<ConfigService>(ConfigService);\n    this.options = config.getConfig('auth') || {};\n    return this.options.tokenKey;\n  }\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Router } from '@angular/router';\n\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport { tap, catchError } from 'rxjs/operators';\nimport { globalCacheBusterNotifier } from 'ts-cacheable';\n\nimport { ConfigService, LanguageService, MessageService } from '@igo2/core';\nimport { Base64 } from '@igo2/utils';\n\nimport { User, IInfosUser } from './auth.interface';\nimport { TokenService } from './token.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  public authenticate$ = new BehaviorSubject<boolean>(undefined);\n  public logged$ = new BehaviorSubject<boolean>(undefined);\n  public redirectUrl: string;\n  private anonymous = false;\n\n  get hasAuthService() {\n    return this.config.getConfig('auth.url') !== undefined;\n  }\n\n  constructor(\n    private http: HttpClient,\n    private tokenService: TokenService,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    @Optional() private router: Router\n  ) {\n    this.authenticate$.next(this.authenticated);\n    this.authenticate$.subscribe((authenticated) => {\n      this.logged$.next(authenticated);\n      globalCacheBusterNotifier.next();\n    });\n  }\n\n  login(username: string, password: string): Observable<void> {\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\n\n    const body = {\n      username,\n      password: this.encodePassword(password)\n    };\n\n    return this.loginCall(body, myHeader);\n  }\n\n  loginWithToken(token: string, type: string, infosUser?: IInfosUser): Observable<void> {\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\n\n    const body = {\n      token,\n      typeConnection: type,\n      infosUser\n    };\n\n    return this.loginCall(body, myHeader);\n  }\n\n  loginAnonymous(): Observable<boolean> {\n    this.anonymous = true;\n    this.logged$.next(true);\n    return of(true);\n  }\n\n  refresh(): Observable<void> {\n    const url = this.config.getConfig('auth.url');\n    return this.http.post(`${url}/refresh`, {}).pipe(\n      tap((data: any) => {\n        this.tokenService.set(data.token);\n      }),\n      catchError((err) => {\n        err.error.caught = true;\n        throw err;\n      })\n    );\n  }\n\n  logout(): Observable<boolean> {\n    this.anonymous = false;\n    this.tokenService.remove();\n    this.authenticate$.next(false);\n    return of(true);\n  }\n\n  isAuthenticated(): boolean {\n    return !this.tokenService.isExpired();\n  }\n\n  getToken(): string {\n    return this.tokenService.get();\n  }\n\n  decodeToken() {\n    if (this.isAuthenticated()) {\n      return this.tokenService.decode();\n    }\n    return false;\n  }\n\n  goToRedirectUrl() {\n    if (!this.router) {\n      return;\n    }\n    const redirectUrl = this.redirectUrl || this.router.url;\n\n    const options = this.config.getConfig('auth') || {};\n    if (redirectUrl === options.loginRoute) {\n      const homeRoute = options.homeRoute || '/';\n      this.router.navigateByUrl(homeRoute);\n    } else if (redirectUrl) {\n      this.router.navigateByUrl(redirectUrl);\n    }\n  }\n\n  getUserInfo(): Observable<User> {\n    const url = this.config.getConfig('auth.url') + '/info';\n    return this.http.get<User>(url);\n  }\n\n  getProfils(): Observable<{ profils: string[] }> {\n    const url = this.config.getConfig('auth.url');\n    return this.http.get<{ profils: string[] }>(`${url}/profils`);\n  }\n\n  updateUser(user: User): Observable<User> {\n    const url = this.config.getConfig('auth.url');\n    return this.http.patch<User>(url, user);\n  }\n\n  private encodePassword(password: string) {\n    return Base64.encode(password);\n  }\n\n  // authenticated or anonymous\n  get logged(): boolean {\n    return this.authenticated || this.isAnonymous;\n  }\n\n  get isAnonymous(): boolean {\n    return this.anonymous;\n  }\n\n  get authenticated(): boolean {\n    return this.isAuthenticated();\n  }\n\n  get isAdmin(): boolean {\n    const token = this.decodeToken();\n    if (token && token.user && token.user.isAdmin) {\n      return true;\n    }\n    return false;\n  }\n\n  private loginCall(body, headers) {\n    const url = this.config.getConfig('auth.url');\n    return this.http.post(`${url}/login`, body, { headers }).pipe(\n      tap((data: any) => {\n        this.tokenService.set(data.token);\n        const tokenDecoded = this.decodeToken();\n        if (tokenDecoded && tokenDecoded.user) {\n          if (tokenDecoded.user.locale) {\n            this.languageService.setLanguage(tokenDecoded.user.locale);\n          }\n          if (tokenDecoded.user.isExpired) {\n            this.languageService.translate\n              .get('igo.auth.error.Password expired')\n              .subscribe((expiredAlert) =>\n                this.messageService.alert(expiredAlert)\n              );\n          }\n        }\n        this.authenticate$.next(true);\n      }),\n      catchError((err) => {\n        err.error.caught = true;\n        throw err;\n      })\n    );\n  }\n}\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter\n} from '@angular/core';\n\nimport { ConfigService, LanguageService } from '@igo2/core';\nimport { AuthGoogleOptions } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\n\n@Component({\n  selector: 'igo-auth-google',\n  templateUrl: './auth-google.component.html',\n  styleUrls: ['./auth-google.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthGoogleComponent {\n  private options: AuthGoogleOptions;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private appRef: ApplicationRef\n  ) {\n    this.options = this.config.getConfig('auth.google') || {};\n\n    if (this.options.apiKey && this.options.clientId) {\n      this.loadSDKGoogle();\n      this.loadPlatform();\n    } else {\n      console.warn('Google authentification needs \"apiKey\" and \"clientId\" options');\n    }\n  }\n\n  public handleSignInClick() {\n    (window as any).gapi.auth2.getAuthInstance().signIn();\n  }\n\n  public handleSignOutClick() {\n    (window as any).gapi.auth2.getAuthInstance().signOut();\n  }\n\n  private handleClientLoad() {\n    (window as any).gapi.load('client:auth2', () => this.initClient());\n  }\n\n  private initClient() {\n    (window as any).gapi.client\n      .init({\n        apiKey: this.options.apiKey,\n        clientId: this.options.clientId,\n        discoveryDocs: [\n          'https://people.googleapis.com/$discovery/rest?version=v1'\n        ],\n        scope: 'profile'\n      })\n      .then(() => {\n        this.handleSignOutClick();\n        this.updateTextButton();\n        (window as any).gapi.auth2.getAuthInstance().isSignedIn.listen(rep => {\n          this.updateSigninStatus(rep);\n        });\n      });\n  }\n\n  private updateSigninStatus(isSignedIn) {\n    this.updateTextButton();\n    if (isSignedIn) {\n      this.loginGoogle((window as any).gapi.client.getToken().access_token);\n    }\n  }\n\n  private updateTextButton() {\n    const btn = document.querySelector('span[id^=\"not_signed_\"]');\n    if (btn && this.languageService.getLanguage() !== 'en') {\n      if (btn.innerHTML === 'Sign in with Google') {\n        btn.innerHTML = this.languageService.translate.instant('igo.auth.google.login');\n      } else if (btn.innerHTML === 'Signed in with Google') {\n        btn.innerHTML = this.languageService.translate.instant('igo.auth.google.logged');\n      }\n    }\n  }\n\n  private loginGoogle(token) {\n    this.authService.loginWithToken(token, 'google').subscribe(() => {\n      this.appRef.tick();\n      this.login.emit(true);\n    });\n  }\n\n  private loadSDKGoogle() {\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'google-jssdk';\n    js.src = 'https://apis.google.com/js/api.js';\n    js.onload = () => {\n      this.handleClientLoad();\n    };\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n\n  private loadPlatform() {\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'google-platform';\n    js.src = 'https://apis.google.com/js/platform.js';\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n}\n","<div class=\"g-signin2 google-login-button\" data-height=\"40\" data-width=\"265\" data-longtitle=\"true\">\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter,\n  Inject\n} from '@angular/core';\nimport { MsalBroadcastService, MsalService, MSAL_GUARD_CONFIG} from '@azure/msal-angular';\nimport {\n  InteractionStatus,\n  AuthenticationResult,\n  PublicClientApplication,\n  PopupRequest,\n  SilentRequest,\n  InteractionRequiredAuthError\n} from '@azure/msal-browser';\nimport { ConfigService } from '@igo2/core';\nimport { AuthMicrosoftOptions, MSPMsalGuardConfiguration } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\nimport { filter, takeUntil } from 'rxjs/operators';\nimport { Subject } from 'rxjs';\n\n@Component({\n  selector: 'igo-auth-microsoft',\n  templateUrl: './auth-microsoft.component.html',\n  styleUrls: ['./auth-microsoft.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthMicrosoftComponent {\n  private options: AuthMicrosoftOptions;\n  private readonly _destroying$ = new Subject<void>();\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n  private broadcastService: MsalBroadcastService;\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef,\n    private msalService: MsalService,\n    @Inject(MSAL_GUARD_CONFIG) private msalGuardConfig: MSPMsalGuardConfiguration[],\n  ) {\n    this.options = this.config.getConfig('auth.microsoft') || {};\n\n    this.msalService.instance = new PublicClientApplication({\n      auth: this.options,\n      cache: {\n        cacheLocation: 'sessionStorage'\n      }\n    });\n\n    this.broadcastService = new MsalBroadcastService(this.msalService.instance, this.msalService);\n\n    if (this.options.clientId) {\n      this.broadcastService.inProgress$\n      .pipe(\n        filter((status: InteractionStatus) => status === InteractionStatus.None),\n        takeUntil(this._destroying$)\n      )\n      .subscribe(() => {\n        this.checkAccount();\n      });\n\n    } else {\n      console.warn('Microsoft authentification needs \"clientId\" option');\n    }\n  }\n\n  public loginMicrosoft() {\n    this.msalService.loginPopup({...this.getConf().authRequest} as PopupRequest)\n    .subscribe((response: AuthenticationResult) => {\n      this.msalService.instance.setActiveAccount(response.account);\n      this.checkAccount();\n    });\n  }\n\n  private checkAccount() {\n    this.msalService.instance\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\n      .then((response: AuthenticationResult) => {\n        const tokenAccess = response.accessToken;\n        const tokenId = response.idToken;\n        this.authService.loginWithToken(tokenAccess, 'microsoft', { tokenId } ).subscribe(() => {\n          this.appRef.tick();\n          this.login.emit(true);\n        });\n      })\n      .catch(async (error) => {\n        if (error instanceof InteractionRequiredAuthError) {\n          // fallback to interaction when silent call fails\n          return this.msalService.acquireTokenPopup(this.getConf().authRequest as SilentRequest);\n        }\n        console.log(error);\n      }).catch(error => {\n        console.log('Silent token fails');\n      });\n  }\n\n  private getConf(): MSPMsalGuardConfiguration {\n    return this.msalGuardConfig.filter(conf => conf.type === 'add')[0];\n  }\n}\n","<button class=\"microsoft-login-button\" mat-raised-button (click)=\"loginMicrosoft()\">\n  <mat-icon svgIcon=\"microsoft\"></mat-icon>\n  {{'igo.auth.microsoft.login' | translate}}\n</button>\n","/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { Inject, Injectable } from '@angular/core';\nimport { Location } from '@angular/common';\nimport {\n    IPublicClientApplication,\n    EndSessionRequest,\n    EndSessionPopupRequest,\n    AuthenticationResult,\n    RedirectRequest,\n    SilentRequest,\n    PopupRequest,\n    SsoSilentRequest,\n    Logger,\n    WrapperSKU\n} from '@azure/msal-browser';\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\nimport { Observable, from } from 'rxjs';\nimport { IMsalService } from '@azure/msal-angular';\n\n@Injectable()\nexport class MsalServiceb2c implements IMsalService {\n    private redirectHash: string;\n    private logger: Logger;\n    private name = '@azure/msal-angular';\n    private version = '2.0.0-beta.2';\n    constructor(\n        @Inject(MSAL_INSTANCE) public instance: IPublicClientApplication,\n        private location: Location\n    ) {\n        const hash = this.location.path(true).split('#').pop();\n        if (hash) {\n            this.redirectHash = `#${hash}`;\n        }\n        this.instance.initializeWrapperLibrary(WrapperSKU.Angular, this.version);\n    }\n\n    acquireTokenPopup(request: PopupRequest): Observable<AuthenticationResult> {\n        return from(this.instance.acquireTokenPopup(request));\n    }\n    acquireTokenRedirect(request: RedirectRequest): Observable<void> {\n        return from(this.instance.acquireTokenRedirect(request));\n    }\n    acquireTokenSilent(silentRequest: SilentRequest): Observable<AuthenticationResult> {\n        return from(this.instance.acquireTokenSilent(silentRequest));\n    }\n    handleRedirectObservable(hash?: string): Observable<AuthenticationResult> {\n        return from(this.instance.handleRedirectPromise(hash || this.redirectHash));\n    }\n    loginPopup(request?: PopupRequest): Observable<AuthenticationResult> {\n        return from(this.instance.loginPopup(request));\n    }\n    loginRedirect(request?: RedirectRequest): Observable<void> {\n        return from(this.instance.loginRedirect(request));\n    }\n    logout(logoutRequest?: EndSessionRequest): Observable<void> {\n        return from(this.instance.logout(logoutRequest));\n    }\n    logoutRedirect(logoutRequest?: EndSessionRequest): Observable<void> {\n        return from(this.instance.logoutRedirect(logoutRequest));\n    }\n    logoutPopup(logoutRequest?: EndSessionPopupRequest): Observable<void> {\n        return from(this.instance.logoutPopup(logoutRequest));\n    }\n    ssoSilent(request: SsoSilentRequest): Observable<AuthenticationResult> {\n        return from(this.instance.ssoSilent(request));\n    }\n    /**\n     * Gets logger for msal-angular.\n     * If no logger set, returns logger instance created with same options as msal-browser\n     */\n    getLogger(): Logger {\n        if (!this.logger) {\n            this.logger = this.instance.getLogger().clone(this.name, this.version);\n        }\n        return this.logger;\n    }\n    // Create a logger instance for msal-angular with the same options as msal-browser\n    setLogger(logger: Logger): void {\n        this.logger = logger.clone(this.name, this.version);\n        this.instance.setLogger(logger);\n    }\n\n}\n","/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { Inject, Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\nimport { EventMessage, EventMessageUtils, IPublicClientApplication, InteractionStatus } from '@azure/msal-browser';\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service.';\n\n@Injectable()\nexport class MsalBroadcastServiceb2c {\n    private _msalSubject: Subject<EventMessage>;\n    public msalSubject$: Observable<EventMessage>;\n    private _inProgress: BehaviorSubject<InteractionStatus>;\n    public inProgress$: Observable<InteractionStatus>;\n\n    constructor(\n        @Inject(MSAL_INSTANCE) private msalInstance: IPublicClientApplication,\n        private authService: MsalServiceb2c\n    ) {\n        this._msalSubject = new Subject<EventMessage>();\n        this.msalSubject$ = this._msalSubject.asObservable();\n\n        // InProgress as BehaviorSubject so most recent inProgress state will be available upon subscription\n        this._inProgress = new BehaviorSubject<InteractionStatus>(InteractionStatus.Startup);\n        this.inProgress$ = this._inProgress.asObservable();\n\n        this.msalInstance.addEventCallback((message: EventMessage) => {\n            this._msalSubject.next(message);\n            const status = EventMessageUtils.getInteractionStatusFromEvent(message);\n            if (status !== null) {\n                this.authService.getLogger().verbose(`BroadcastService - ${message.eventType} results in setting inProgress to ${status}`);\n                this._inProgress.next(status);\n            }\n        });\n    }\n}\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter,\n  Inject\n} from '@angular/core';\n\nimport { MSAL_GUARD_CONFIG } from '@azure/msal-angular';\nimport {\n  InteractionStatus,\n  AuthenticationResult,\n  PublicClientApplication,\n  PopupRequest,\n  SilentRequest,\n  InteractionRequiredAuthError\n} from '@azure/msal-browser';\nimport { ConfigService } from '@igo2/core';\nimport { AuthMicrosoftb2cOptions, MSPMsalGuardConfiguration } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\nimport { filter, takeUntil } from 'rxjs/operators';\nimport { Subject } from 'rxjs';\nimport { MsalBroadcastServiceb2c } from '../shared/auth-msalBroadcastServiceb2c.service';\nimport { MsalServiceb2c } from '../shared/auth-msalServiceb2c.service.';\n\n@Component({\n  selector: 'igo-auth-microsoftb2c',\n  templateUrl: './auth-microsoftb2c.component.html',\n  styleUrls: ['./auth-microsoftb2c.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthMicrosoftb2cComponent {\n  private options: AuthMicrosoftb2cOptions;\n  private readonly _destroying$ = new Subject<void>();\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n  private broadcastService: MsalBroadcastServiceb2c;\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef,\n    private msalService: MsalServiceb2c,\n    @Inject(MSAL_GUARD_CONFIG) private msalGuardConfig: MSPMsalGuardConfiguration[],\n  ) {\n\n    this.options = this.config.getConfig('auth.microsoftb2c') || {};\n\n    this.msalService.instance = new PublicClientApplication({\n      auth: this.options.browserAuthOptions,\n      cache: {\n        cacheLocation: 'sessionStorage'\n      }\n    });\n\n    this.broadcastService = new MsalBroadcastServiceb2c(this.msalService.instance, this.msalService);\n\n    if (this.options.browserAuthOptions.clientId) {\n      this.broadcastService.inProgress$\n      .pipe(\n        filter((status: InteractionStatus) => status === InteractionStatus.None),\n        takeUntil(this._destroying$)\n      )\n      .subscribe(() => {\n        this.checkAccount();\n      });\n\n    } else {\n      console.warn('Microsoft authentification needs \"clientId\" option');\n    }\n  }\n\n  public loginMicrosoftb2c() {\n    this.msalService.loginPopup({...this.getConf().authRequest} as PopupRequest)\n    .subscribe((response: AuthenticationResult) => {\n      this.msalService.instance.setActiveAccount(response.account);\n      this.checkAccount();\n    });\n  }\n\n  private checkAccount() {\n    this.msalService.instance\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\n      .then((response: AuthenticationResult) => {\n        const token = response.idToken;\n        this.authService.loginWithToken(token, 'microsoftb2c').subscribe(() => {\n          this.appRef.tick();\n          this.login.emit(true);\n        });\n      })\n      .catch(async (error) => {\n        if (error instanceof InteractionRequiredAuthError) {\n          // fallback to interaction when silent call fails\n          return this.msalService.acquireTokenPopup(this.getConf().authRequest as SilentRequest);\n        }\n        }).catch(error => {\n          console.log('Silent token fails');\n        });\n  }\n\n  private getConf(): MSPMsalGuardConfiguration {\n    return this.msalGuardConfig.filter(conf => conf.type === 'b2c')[0];\n  }\n}\n","<button class=\"microsoft-login-button\" mat-raised-button (click)=\"loginMicrosoftb2c()\">\n  <mat-icon svgIcon=\"microsoft\"></mat-icon>\n  {{'igo.auth.microsoftb2c.login' | translate}}\n</button>\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter\n} from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthFacebookOptions } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\n\n@Component({\n  selector: 'igo-auth-facebook',\n  templateUrl: './auth-facebook.component.html',\n  styleUrls: ['./auth-facebook.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthFacebookComponent {\n  private options: AuthFacebookOptions;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef\n  ) {\n    this.options = this.config.getConfig('auth.facebook') || {};\n\n    if (this.options.appId) {\n      this.loadSDKFacebook();\n    } else {\n      console.warn('Facebook authentification needs \"appId\" option');\n    }\n  }\n\n  private subscribeEvents() {\n    (window as any).FB.Event.subscribe('auth.statusChange', rep => {\n      this.statusChangeCallback(rep);\n    });\n  }\n\n  private statusChangeCallback(response) {\n    if (response.status === 'connected') {\n      const accessToken = response.authResponse.accessToken;\n      this.loginFacebook(accessToken);\n    }\n  }\n\n  private loginFacebook(token) {\n    this.authService.loginWithToken(token, 'facebook').subscribe(() => {\n      this.appRef.tick();\n      this.login.emit(true);\n    });\n  }\n\n  private loadSDKFacebook() {\n    if (document.getElementById('facebook-jssdk')) {\n      return;\n    }\n\n    const urlSDK =\n      'https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9';\n\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'facebook-jssdk';\n    js.src = `${urlSDK}&appId=${this.options.appId}`;\n    js.onload = () => {\n      this.subscribeEvents();\n    };\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n}\n","<div scope=\"public_profile,email\"\n     class=\"fb-login-button\" data-max-rows=\"1\" data-size=\"large\"\n     data-button-type=\"login_with\" data-show-faces=\"false\"\n     data-auto-logout-link=\"false\" data-use-continue-as=\"false\">\n</div>\n","<form [formGroup]=\"form\" role=\"form\" (ngSubmit)=\"loginUser(form.value)\">\n  <div>\n    <mat-form-field class=\"full-width\">\n      <input matInput required placeholder=\"{{'igo.auth.user' | translate}}\" formControlName=\"username\">\n    </mat-form-field>\n  </div>\n\n  <div>\n    <mat-form-field class=\"full-width\">\n      <input matInput required type=\"password\" placeholder=\"{{'igo.auth.password' | translate}}\" formControlName=\"password\">\n    </mat-form-field>\n  </div>\n\n  <button mat-raised-button type=\"submit\">{{'igo.auth.login' | translate}}</button>\n  <button *ngIf=\"allowAnonymous\" mat-raised-button class=\"anonymous\" type=\"button\" [disabled]=\"loading\" (click)=\"loginAnonymous()\">\n    {{'igo.auth.accessAnonymous' | translate }}\n  </button>\n  <div *ngIf=\"error\">\n    <br/>\n    <font size=\"3\" color=\"red\">{{error}}</font>\n  </div>\n</form>\n\n<!--\nThis part was removed from the below line to fix Angular issue 30616 : [disabled]=\"!form.valid || loading\n  <button mat-raised-button type=\"submit\" [disabled]=\"!form.valid || loading\">{{'igo.auth.login' | translate}}</button>*/\n-->\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  Input,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Validators, FormGroup, FormBuilder } from '@angular/forms';\n\nimport { AuthService } from '../shared/auth.service';\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'igo-auth-intern',\n  templateUrl: './auth-intern.component.html',\n  styleUrls: ['./auth-intern.component.scss'],\n  changeDetection: ChangeDetectionStrategy.Default\n})\nexport class AuthInternComponent {\n  @Input()\n  get allowAnonymous(): boolean {\n    return this._allowAnonymous;\n  }\n  set allowAnonymous(value: boolean) {\n    this._allowAnonymous = value;\n  }\n  private _allowAnonymous = true;\n\n  public error = '';\n  public form: FormGroup;\n  public loading = false;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    public auth: AuthService,\n    private languageService: LanguageService,\n    fb: FormBuilder\n  ) {\n    this.form = fb.group({\n      username: ['', Validators.required],\n      password: ['', Validators.required]\n    });\n  }\n\n  loginUser(values: any) {\n    this.loading = true;\n    this.auth.login(values.username, values.password).subscribe(\n      () => {\n        this.login.emit(true);\n        this.loading = false;\n      },\n      (error: any) => {\n        try {\n          this.languageService.translate\n            .get('igo.auth.error.' + error.error.message)\n            .subscribe(errorMsg => (this.error = errorMsg));\n        } catch (e) {\n          this.error = error.error.message;\n        }\n        this.loading = false;\n      }\n    );\n    return false;\n  }\n\n  loginAnonymous() {\n    this.auth.loginAnonymous().subscribe(() => {\n      this.login.emit(true);\n    });\n  }\n}\n","<div *ngIf=\"visible\">\n  <div *ngIf=\"!auth.logged && backgroundDisable\" class=\"backgroundDisable\"></div>\n\n  <div *ngIf=\"!auth.logged && showLoginDiv\" class=\"login center-block\">\n    <h1>{{'igo.auth.connection' | translate}}</h1>\n\n    <igo-auth-google\n      *ngIf=\"options.google && options.google.enabled !== false\"\n      (login)=\"onLogin()\">\n    </igo-auth-google>\n    <igo-auth-microsoft\n      *ngIf=\"options.microsoft && options.microsoft.enabled !== false\"\n      (login)=\"onLogin()\">\n    </igo-auth-microsoft>\n    <igo-auth-microsoftb2c\n      *ngIf=\"options.microsoftb2c && options.microsoftb2c.enabled !== false\"\n      (login)=\"onLogin()\">\n    </igo-auth-microsoftb2c>\n    <igo-auth-facebook\n      *ngIf=\"options.facebook && options.facebook.enabled !== false\"\n      (login)=\"onLogin()\">\n    </igo-auth-facebook>\n    <igo-auth-intern\n      *ngIf=\"!options.intern || options.intern.enabled !== false\"\n      [allowAnonymous]=\"options.allowAnonymous\"\n      (login)=\"onLogin()\">\n    </igo-auth-intern>\n  </div>\n\n  <div *ngIf=\"auth.logged && showAlreadyConnectedDiv\" class=\"login center-block\">\n    <p>{{'igo.auth.welcome' |translate: user}}</p>\n    <button mat-raised-button type=\"button\" (click)=\"logout()\">{{'igo.auth.signOut' |translate}}</button>\n  </div>\n\n  <div *ngIf=\"showLogoutDiv\" class=\"login center-block\">\n    <p>{{'igo.auth.deconnection' |translate}}</p>\n    <button *ngIf=\"options.homeRoute\" mat-raised-button type=\"button\" (click)=\"home()\">{{'igo.auth.home' |translate}}</button>\n  </div>\n\n</div>\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  OnInit,\n  Input,\n  Optional,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Router, NavigationStart } from '@angular/router';\nimport { filter } from 'rxjs/operators';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthOptions } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\n\n@Component({\n  selector: 'igo-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.Default\n})\nexport class AuthFormComponent implements OnInit {\n  @Input()\n  get backgroundDisable(): boolean {\n    if (this.isLogoutRoute || this.isLogoutRoute) {\n      return false;\n    }\n    return this._backgroundDisable;\n  }\n  set backgroundDisable(value: boolean) {\n    this._backgroundDisable = value.toString() === 'true';\n  }\n  private _backgroundDisable = true;\n\n  @Input()\n  get hasAlreadyConnectedDiv(): boolean {\n    return this._hasAlreadyConnectedDiv;\n  }\n  set hasAlreadyConnectedDiv(value: boolean) {\n    this._hasAlreadyConnectedDiv = value.toString() === 'true';\n  }\n  private _hasAlreadyConnectedDiv = true;\n\n  @Input()\n  get hasLogoutDiv(): boolean {\n    return this._hasLogoutDiv;\n  }\n  set hasLogoutDiv(value: boolean) {\n    this._hasLogoutDiv = value.toString() === 'true';\n  }\n  private _hasLogoutDiv = true;\n\n  @Input()\n  get showAlreadyConnectedDiv(): boolean {\n    if (this.isLogoutRoute) {\n      return this.hasAlreadyConnectedDiv;\n    }\n    return this._showAlreadyConnectedDiv;\n  }\n  set showAlreadyConnectedDiv(value: boolean) {\n    this._showAlreadyConnectedDiv = value.toString() === 'true';\n  }\n  private _showAlreadyConnectedDiv = false;\n\n  @Input()\n  get showLogoutDiv(): boolean {\n    if (this.isLogoutRoute) {\n      return this.hasLogoutDiv;\n    }\n    return this._showLogoutDiv;\n  }\n  set showLogoutDiv(value: boolean) {\n    this._showLogoutDiv = value.toString() === 'true';\n  }\n  private _showLogoutDiv = false;\n\n  get showLoginDiv(): boolean {\n    if (!this.isLogoutRoute) {\n      return true;\n    }\n  }\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  public options: AuthOptions;\n  public user;\n\n  public visible = true;\n\n  private isLoginRoute: boolean;\n  private isLogoutRoute: boolean;\n\n  constructor(\n    public auth: AuthService,\n    private config: ConfigService,\n    @Optional() private router: Router\n  ) {\n    this.options = this.config.getConfig('auth') || {};\n    this.visible = Object.getOwnPropertyNames(this.options).length !== 0;\n  }\n\n  public ngOnInit() {\n    this.analyzeRoute();\n    this.getName();\n  }\n\n  public onLogin() {\n    this.auth.goToRedirectUrl();\n    this.getName();\n    this.login.emit(true);\n  }\n\n  public logout() {\n    this.auth.logout().subscribe(() => {\n      this.user = undefined;\n      if (this.router) {\n        if (this.options.logoutRoute) {\n          this.router.navigate([this.options.logoutRoute]);\n        } else if (this.options.homeRoute) {\n          this.router.navigate([this.options.homeRoute]);\n        }\n      }\n    });\n  }\n\n  public home() {\n    if (this.router && this.options.homeRoute) {\n      this.router.navigate([this.options.homeRoute]);\n    }\n  }\n\n  private getName() {\n    const tokenDecoded = this.auth.decodeToken();\n    if (tokenDecoded) {\n      this.user = {\n        name: tokenDecoded.user.firstName || tokenDecoded.user.sourceId\n      };\n    }\n  }\n\n  private analyzeRoute() {\n    if (!this.router) {\n      return;\n    }\n\n    this.router.events\n      .pipe(filter((event) => event instanceof NavigationStart))\n      .subscribe((changeEvent: any) => {\n        if (changeEvent.url) {\n          const currentRoute = changeEvent.url;\n          const logoutRoute = this.options.logoutRoute;\n          const loginRoute = this.options.loginRoute;\n\n          this.isLogoutRoute = currentRoute === logoutRoute;\n          this.isLoginRoute = currentRoute === loginRoute;\n\n          if (this.isLogoutRoute) {\n            this.auth.logout();\n          }\n        }\n      });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport {\n  HttpEvent,\n  HttpInterceptor,\n  HttpHandler,\n  HttpRequest\n} from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { Md5 } from 'ts-md5';\n\nimport { ConfigService } from '@igo2/core';\nimport { TokenService } from './token.service';\nimport { AuthByKeyOptions, WithCredentialsOptions } from './auth.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthInterceptor implements HttpInterceptor {\n  private refreshInProgress = false;\n\n  private get trustHosts() {\n    const trustHosts = this.config.getConfig('auth.trustHosts') || [];\n    trustHosts.push(window.location.hostname);\n    return trustHosts;\n  }\n\n  private get hostsWithCredentials(): WithCredentialsOptions[] {\n    return this.config.getConfig('auth.hostsWithCredentials') || [];\n  }\n\n  private get hostsWithAuthByKey(): AuthByKeyOptions[] {\n    return this.config.getConfig('auth.hostsByKey') || [];\n  }\n\n  constructor(\n    private config: ConfigService,\n    private tokenService: TokenService,\n    private http: HttpClient\n  ) {}\n\n  intercept(\n    originalReq: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const withCredentials = this.handleHostsWithCredentials(originalReq.url);\n    let req = originalReq.clone();\n    const hostWithKey = this.handleHostsAuthByKey(originalReq.url);\n    if (hostWithKey) {\n      req = req.clone({\n        params: req.params.set(hostWithKey.key, hostWithKey.value)\n      });\n    }\n    if (withCredentials) {\n      req = originalReq.clone({\n        withCredentials\n      });\n    }\n    this.refreshToken();\n    const token = this.tokenService.get();\n    const element = document.createElement('a');\n    element.href = req.url;\n    if (element.host === '') {\n      element.href = element.href; // FIX IE11, DO NOT REMOVE\n    }\n\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\n      return next.handle(req);\n    }\n\n    const authHeader = `Bearer ${token}`;\n    let authReq = req.clone({\n      headers: req.headers.set('Authorization', authHeader)\n    });\n\n    const tokenDecoded: any = this.tokenService.decode();\n    if (\n      authReq.params.get('_i') === 'true' &&\n      tokenDecoded &&\n      tokenDecoded.user &&\n      tokenDecoded.user.sourceId\n    ) {\n      const hashUser = Md5.hashStr(tokenDecoded.user.sourceId) as string;\n      authReq = authReq.clone({\n        params: authReq.params.set('_i', hashUser)\n      });\n    } else if (authReq.params.get('_i') === 'true') {\n      authReq = authReq.clone({\n        params: authReq.params.delete('_i')\n      });\n    }\n\n    return next.handle(authReq);\n  }\n\n  interceptXhr(xhr, url: string): boolean {\n    const withCredentials = this.handleHostsWithCredentials(url);\n    if (withCredentials) {\n       xhr.withCredentials = withCredentials;\n       return true;\n    }\n\n    this.refreshToken();\n    const element = document.createElement('a');\n    element.href = url;\n\n    const token = this.tokenService.get();\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\n      return false;\n    }\n    xhr.setRequestHeader('Authorization', 'Bearer ' + token);\n    return true;\n  }\n\n  alterUrlWithKeyAuth(url: string): string {\n    const hostWithKey = this.handleHostsAuthByKey(url);\n    let interceptedUrl = url;\n    if (hostWithKey) {\n      const urlDecomposed = interceptedUrl.split(/[?&]/);\n      let urlWithKeyAdded = urlDecomposed.shift();\n      const paramsToKeep = urlDecomposed.filter(p => p.length !== 0);\n      paramsToKeep.push(`${hostWithKey.key}=${hostWithKey.value}`);\n      if (paramsToKeep.length) {\n        urlWithKeyAdded += '?' + paramsToKeep.join('&');\n      }\n      return urlWithKeyAdded;\n    }\n    return;\n  }\n\n  private handleHostsWithCredentials(reqUrl: string) {\n    let withCredentials = false;\n    for (const hostWithCredentials of this.hostsWithCredentials) {\n      const domainRegex = new RegExp(hostWithCredentials.domainRegFilters);\n      if (domainRegex.test(reqUrl)) {\n        withCredentials = hostWithCredentials.withCredentials !== undefined ? hostWithCredentials.withCredentials : undefined;\n        break;\n      }\n    }\n    return withCredentials;\n  }\n\n  private handleHostsAuthByKey(reqUrl: string): {key: string, value: string} {\n    let hostWithKey;\n    for (const hostWithAuthByKey of this.hostsWithAuthByKey) {\n      const domainRegex = new RegExp(hostWithAuthByKey.domainRegFilters);\n      if (domainRegex.test(reqUrl)) {\n        var replace = `${hostWithAuthByKey.keyProperty}=${hostWithAuthByKey.keyValue}`;\n        var keyAdded = new RegExp(replace,\"gm\");\n        if (!keyAdded.test(reqUrl)) {\n          hostWithKey = {key : hostWithAuthByKey.keyProperty, value: hostWithAuthByKey.keyValue};\n          break;\n        }\n      }\n    }\n    return hostWithKey;\n  }\n\n  refreshToken() {\n    const jwt = this.tokenService.decode();\n    const currentTime = new Date().getTime() / 1000;\n\n    if (\n      !this.refreshInProgress &&\n      jwt &&\n      currentTime < jwt.exp &&\n      currentTime > jwt.exp - 1800\n    ) {\n      this.refreshInProgress = true;\n\n      const url = this.config.getConfig('auth.url');\n      return this.http.post(`${url}/refresh`, {}).subscribe(\n        (data: any) => {\n          this.tokenService.set(data.token);\n          this.refreshInProgress = false;\n        },\n        err => {\n          err.error.caught = true;\n          return err;\n        }\n      );\n    }\n  }\n}\n","import {\n  MSAL_GUARD_CONFIG,\n  MSAL_INSTANCE,\n  MsalService,\n} from '@azure/msal-angular';\n\nimport {\n  PublicClientApplication,\n  InteractionType\n} from '@azure/msal-browser';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { BrowserAuthOptions } from '@azure/msal-browser';\n\nimport { AuthMicrosoftOptions, MSPMsalGuardConfiguration } from './auth.interface';\n\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service.';\n\nexport function MSALConfigFactory(config: ConfigService): PublicClientApplication {\n\n  const msConf: BrowserAuthOptions = config.getConfig('auth.microsoft') || {};\n\n  msConf.redirectUri = msConf.redirectUri || window.location.href;\n  msConf.authority = msConf.authority || 'https://login.microsoftonline.com/organizations';\n\n  const myMsalObj = new PublicClientApplication({\n    auth: msConf,\n    cache: {\n      cacheLocation: 'sessionStorage'\n    }\n  });\n\n  return myMsalObj;\n}\n\nexport function MSALConfigFactoryb2c(config: ConfigService): PublicClientApplication {\n\n  const msConf: BrowserAuthOptions = config.getConfig('auth.microsoftb2c.browserAuthOptions') || {};\n  msConf.redirectUri = msConf.redirectUri || window.location.href;\n  msConf.authority = msConf.authority || 'https://login.microsoftonline.com/organizations';\n\n  const myMsalObj = new PublicClientApplication({\n    auth: msConf,\n    cache: {\n      cacheLocation: 'sessionStorage'\n    }\n  });\n\n  return myMsalObj;\n}\n\nexport function MSALAngularConfigFactory(config: ConfigService): MSPMsalGuardConfiguration {\n\n  const msConf: AuthMicrosoftOptions = config.getConfig('auth.microsoft') || {};\n\n  return {\n    interactionType: InteractionType.Popup,\n    authRequest: {\n      scopes: ['user.read'],\n      loginHint: 'todo',\n    },\n    type: 'add'\n  };\n}\n\nexport function MSALAngularConfigFactoryb2c(config: ConfigService): MSPMsalGuardConfiguration {\n\n  const msConf: BrowserAuthOptions = config.getConfig('auth.microsoftb2c.browserAuthOptions') || {};\n\n  return {\n    interactionType: InteractionType.Popup,\n    authRequest: {\n      scopes: [msConf.clientId]\n    },\n    type: 'b2c'\n  };\n}\n\nexport function provideAuthMicrosoft(type?: string) {\n  if (type === 'b2c') {\n    return [\n      {\n        provide: MSAL_INSTANCE,\n        useFactory: MSALConfigFactoryb2c,\n        deps: [ConfigService]\n      },\n      {\n        provide: MSAL_GUARD_CONFIG,\n        useFactory: MSALAngularConfigFactoryb2c,\n        deps: [ConfigService],\n        multi: true\n      },\n      MsalServiceb2c\n    ];\n  } else {\n    return [\n      {\n        provide: MSAL_INSTANCE,\n        useFactory: MSALConfigFactory,\n        deps: [ConfigService]\n      },\n      {\n        provide: MSAL_GUARD_CONFIG,\n        useFactory: MSALAngularConfigFactory,\n        deps: [ConfigService],\n        multi: true\n      },\n      MsalService\n    ];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { StorageService, StorageScope, ConfigService } from '@igo2/core';\nimport { AuthService } from './auth.service';\nimport { TokenService } from './token.service';\nimport { AuthStorageOptions } from './storage.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthStorageService extends StorageService {\n  protected options: AuthStorageOptions;\n\n  constructor(\n    config: ConfigService,\n    private http: HttpClient,\n    private authService: AuthService,\n    private tokenService: TokenService\n  ) {\n    super(config);\n\n    this.authService.authenticate$.subscribe(isAuthenticated => {\n      if (isAuthenticated && this.options.url) {\n        this.http\n          .get(this.options.url)\n          .subscribe((userIgo: { preference: object }) => {\n            if (userIgo && userIgo.preference) {\n              for (const key of Object.keys(userIgo.preference)) {\n                const value = userIgo.preference[key];\n                super.set(key, value);\n              }\n            }\n          });\n      }\n    });\n  }\n\n  set(\n    key: string,\n    value: string | object | boolean | number,\n    scope: StorageScope = StorageScope.LOCAL\n  ) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      const preference = {};\n      preference[key] = value;\n      this.http.patch(this.options.url, { preference }).subscribe();\n    }\n    super.set(key, value, scope);\n  }\n\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      const preference = {};\n      preference[key] = undefined;\n      this.http.patch(this.options.url, { preference }).subscribe();\n    }\n    super.remove(key, scope);\n  }\n\n  clear(scope: StorageScope = StorageScope.LOCAL) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      this.http.patch(this.options.url, { preference: {}}, {\n        params: {\n          mergePreference: 'false'\n        }\n      }).subscribe();\n    }\n\n    let token: string;\n    if (scope === StorageScope.LOCAL) {\n      token = this.tokenService.get();\n    }\n\n    super.clear(scope);\n\n    if (token) {\n      this.tokenService.set(token);\n    }\n\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      this.http\n        .get(this.options.url)\n        .subscribe((userIgo: { preference: object }) => {\n          if (userIgo && userIgo.preference) {\n            for (const key of Object.keys(userIgo.preference)) {\n              const value = userIgo.preference[key];\n              super.set(key, value);\n            }\n          }\n        });\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MsalModule } from '@azure/msal-angular';\n\nimport { StorageService, IgoLanguageModule } from '@igo2/core';\n\nimport { AuthStorageService } from './shared/storage.service';\nimport { ProtectedDirective } from './shared/protected.directive';\nimport { AuthInterceptor } from './shared/auth.interceptor';\nimport { provideAuthMicrosoft } from './shared/auth-microsoft.provider';\n\nimport { AuthInternComponent } from './auth-form/auth-intern.component';\nimport { AuthFormComponent } from './auth-form/auth-form.component';\nimport { AuthGoogleComponent } from './auth-form/auth-google.component';\nimport { AuthFacebookComponent } from './auth-form/auth-facebook.component';\nimport { AuthMicrosoftComponent } from './auth-form/auth-microsoft.component';\nimport { AuthMicrosoftb2cComponent } from './auth-form/auth-microsoftb2c.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatIconModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    MsalModule\n  ],\n  declarations: [\n    AuthFormComponent,\n    AuthGoogleComponent,\n    AuthInternComponent,\n    AuthFacebookComponent,\n    AuthMicrosoftComponent,\n    AuthMicrosoftb2cComponent,\n    ProtectedDirective\n  ],\n  exports: [AuthFormComponent, ProtectedDirective]\n})\nexport class IgoAuthModule {\n  static forRoot(): ModuleWithProviders<IgoAuthModule> {\n    return {\n      ngModule: IgoAuthModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: AuthInterceptor,\n          multi: true\n        },\n        {\n          provide: StorageService,\n          useClass: AuthStorageService\n        },\n        ...provideAuthMicrosoft('add'),\n        ...provideAuthMicrosoft('b2c')\n      ]\n    };\n  }\n}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppAuthFormComponent } from './auth-form.component';\n\nconst routes: Routes = [\n  {\n    path: 'auth-form',\n    component: AppAuthFormComponent\n  }\n];\n\nexport const AppAuthFormRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss']\n})\nexport class AppAuthFormComponent {\n  private idsActivity: string[] = [];\n\n  constructor(private languageService: LanguageService) {}\n}\n","<mat-card>\n  <mat-card-subtitle>Auth</mat-card-subtitle>\n  <mat-card-title>Authentification</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: ConfigService, LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/auth/auth-form\">code of this example</a><br>\n    See auth section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\n  </mat-card-content>\n</mat-card>\n\n<igo-auth-form></igo-auth-form>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoAuthModule } from '@igo2/auth';\n\nimport { AppAuthFormComponent } from './auth-form.component';\nimport { AppAuthFormRoutingModule } from './auth-form-routing.module';\n\n@NgModule({\n  declarations: [AppAuthFormComponent],\n  imports: [AppAuthFormRoutingModule, MatCardModule, IgoAuthModule.forRoot()],\n  exports: [AppAuthFormComponent]\n})\nexport class AppAuthFormModule {}\n","import { Injectable } from '@angular/core';\n\nimport { MetadataOptions } from './metadata.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MetadataService {\n  constructor() {}\n\n  open(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      window.open(metadata.url, '_blank');\n    }\n  }\n}\n","<button\n  *ngIf=\"(options && options.metadata && options.metadata.url) || (options && options.metadata && options.metadata.abstract)\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.metadata.show' | translate\"\n  [color]=\"color\"\n  (click)=\"openMetadata(options.metadata)\">\n  <mat-icon svgIcon=\"information-outline\"></mat-icon>\n</button>\n","<h2 mat-dialog-title>{{ data.layerTitle }}</h2>\n<button class=\"close-button\" mat-button mat-dialog-close>X</button>\n<mat-dialog-content *ngIf=\"data.type !== 'arcgisrest'\" class=\"mat-typography\">\n  <h3>{{ data.abstract }}</h3>\n</mat-dialog-content>\n<mat-dialog-content *ngIf=\"data.type === 'arcgisrest'\" class=\"mat-typography\">\n  <h3 [innerHTML]=\"data.abstract\"></h3>\n</mat-dialog-content>\n","import { Component, Input, ChangeDetectionStrategy, Inject, ViewEncapsulation } from '@angular/core';\nimport { MatDialog, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport {\n  MetadataOptions,\n  MetadataLayerOptions\n} from '../shared/metadata.interface';\nimport { MetadataService } from '../shared/metadata.service';\n\n@Component({\n  selector: 'igo-metadata-button',\n  templateUrl: './metadata-button.component.html',\n  styleUrls: ['./metadata-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MetadataButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(\n    private metadataService: MetadataService,\n    private dialog: MatDialog) {}\n\n  openMetadata(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      if (!metadata.url && metadata.abstract) {\n        this.dialog.open(MetadataAbstractComponent, {\n          data: {\n            layerTitle: this.layer.title,\n            abstract: metadata.abstract,\n            type: metadata.type\n          }\n        });\n      } else if (metadata.url) {\n        this.metadataService.open(metadata);\n      }\n    } else if (!metadata.extern && metadata.abstract) {\n      this.dialog.open(MetadataAbstractComponent, {\n        data: {\n          layerTitle: this.layer.title,\n          abstract: metadata.abstract,\n          type: metadata.type\n        }\n      });\n    }\n  }\n\n  get options(): MetadataLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n}\n\n@Component({\n  selector: 'igo-metadata-abstract',\n  templateUrl: './metadata-abstract.component.html',\n  styleUrls: ['./metadata-abstract.component.scss'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class MetadataAbstractComponent {\n  constructor(@Inject(MAT_DIALOG_DATA) public data: MetadataOptions) {}\n}\n","import { MatDialogModule } from '@angular/material/dialog';\nimport { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { MetadataButtonComponent, MetadataAbstractComponent } from './metadata-button/metadata-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule,\n    MatDialogModule\n  ],\n  exports: [\n    MetadataButtonComponent,\n    MetadataAbstractComponent],\n  declarations: [\n    MetadataButtonComponent,\n    MetadataAbstractComponent]\n})\nexport class IgoMetadataModule {\n  static forRoot(): ModuleWithProviders<IgoMetadataModule> {\n    return {\n      ngModule: IgoMetadataModule,\n      providers: []\n    };\n  }\n}\n","export const FEATURE = 'Feature';\n\nexport enum FeatureMotion {\n  None,\n  Move,\n  Zoom,\n  Default\n}\n","import olSourceImage from 'ol/source/Image';\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { ImageLayer } from '../shared/layers/image-layer';\n\n\nexport class ImageWatcher extends Watcher {\n  protected id: string;\n  protected loaded = 0;\n  protected loading = 0;\n\n  private source: olSourceImage;\n\n  private messageService: MessageService;\n  private languageService: LanguageService;\n\n  constructor(layer: ImageLayer, messageService: MessageService, languageService: LanguageService) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n    this.messageService = messageService;\n    this.languageService = languageService;\n  }\n\n  protected watch() {\n    this.source.on(`imageloadstart`, e => this.handleLoadStart(e));\n    this.source.on(`imageloadend`, e => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, e => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, e => this.handleLoadError(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`imageloadstart`, e => this.handleLoadStart(e));\n    this.source.un(`imageloadend`, e => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, e => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, e => this.handleLoadError(e));\n  }\n\n  private handleLoadStart(event: any) {\n    if (!event.image.__watchers__) {\n      event.image.__watchers__ = [];\n    }\n    event.image.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.image.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.image.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.image.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n\n  private handleLoadError(event) {\n\n    if (!event.image.__watchers__) {\n      return;\n    }\n    const title = this.languageService.translate.instant(\n      'igo.geo.dataSource.unavailableTitle'\n    );\n    const message = this.languageService.translate.instant(\n      'igo.geo.dataSource.unavailable', {value: event.target.params_.LAYERS}\n    );\n\n    this.messageService.error(message, title);\n    this.loaded = -1;\n    this.loading = 0;\n    this.status = SubjectStatus.Error;\n\n  }\n}\n","import { AnyLayerOptions } from \"../shared/layers/any-layer.interface\";\nimport { VectorTileLayerOptions } from \"../shared/layers/vectortile-layer.interface\";\n\n\nexport function computeMVTOptionsOnHover(layerOptions: AnyLayerOptions) {\n  const vectorTileLayerOptions = layerOptions as VectorTileLayerOptions;\n  if (\n    vectorTileLayerOptions.sourceOptions?.type === 'mvt' &&\n    (vectorTileLayerOptions.styleByAttribute?.hoverStyle || vectorTileLayerOptions.hoverStyle)) {\n    const fc = vectorTileLayerOptions.sourceOptions.featureClass;\n    vectorTileLayerOptions.sourceOptions.featureClass = fc ? fc : 'feature';\n  }\n  return layerOptions;\n}\n","import olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\nimport { Message } from '@igo2/core';\n\nimport { DataSource } from '../../../datasource/shared/datasources/datasource';\nimport { AnyDataSourceOptions } from '../../../datasource/shared/datasources/any-datasource.interface';\nimport { MapExtent, MapViewOptions } from '../../../map/shared/map.interface';\n\nexport interface LayerOptions {\n  isIgoInternalLayer?: boolean; // useful when mapOffline directive set the resolution of the layers.\n  source?: DataSource;\n  sourceOptions?: AnyDataSourceOptions;\n  title?: string;\n  id?: string;\n  alias?: string;\n  baseLayer?: boolean;\n  opacity?: number;\n  visible?: boolean;\n  extent?: MapExtent;\n  zIndex?: number;\n  messages?: Message[];\n  minResolution?: number;\n  maxResolution?: number;\n  minScaleDenom?: number;\n  maxScaleDenom?: number;\n  showInLayerList?: boolean;\n  removable?: boolean;\n  workspace?: GeoWorkspaceOptions;\n  legendOptions?: LegendOptions;\n  ol?: olLayer<olSource>;\n  tooltip?: TooltipContent;\n  _internal?: { [key: string]: string };\n  active?: boolean;\n  check?: boolean;\n  linkedLayers?: LayersLink;\n}\n\nexport interface GeoWorkspaceOptions {\n  srcId?: string;\n  workspaceId?: string;\n  minResolution?: number;\n  maxResolution?: number;\n  enabled?: boolean;\n  queryOptions?: GeoWorkspaceQueryOptions;\n  pageSize?: number;\n  pageSizeOptions?: number[];\n}\n\nexport interface GeoWorkspaceQueryOptions {\n  mapQueryOnOpenTab?: boolean;\n  tabQuery?: boolean;\n}\n\nexport interface LayersLink {\n  linkId: string;\n  links?: LayersLinkProperties[];\n}\nexport interface LayersLinkProperties {\n  bidirectionnal?: boolean;\n  linkedIds: string[];\n  syncedDelete: boolean;\n  properties: LinkedProperties[];\n}\n\nexport enum LinkedProperties {\n  OPACITY = 'opacity',\n  VISIBLE = 'visible',\n  OGCFILTERS = 'ogcFilters',\n  MINRESOLUTION = 'minResolution',\n  MAXRESOLUTION = 'maxResolution',\n  ZINDEX = 'zIndex',\n  TIMEFILTER = 'timeFilter'\n}\n\nexport interface GroupLayers {\n  title: string;\n  layers?: LayerOptions;\n  collapsed?: boolean;\n}\n\nexport interface TooltipContent {\n  type?: TooltipType;\n  text?: string;\n}\nexport enum TooltipType {\n  TITLE = 'title',\n  ABSTRACT = 'abstract',\n  CUSTOM = 'custom'\n}\n\nexport interface LegendOptions {\n  collapsed?: boolean;\n  display?: boolean;\n  url?: string;\n  html?: string;\n  stylesAvailable?: ItemStyleOptions[];\n}\n\nexport interface LegendMapViewOptions extends MapViewOptions{\n  scale?: number;\n  size?: [number, number];\n}\n\nexport interface ItemStyleOptions {\n  name: string;\n  title?: string;\n}\n\nexport interface OutputLayerLegend {\n  title: string;\n  url: string;\n  display: boolean;\n}\n","import { ArcGISRestDataSourceOptions } from './../datasource/shared/datasources/arcgisrest-datasource.interface';\nimport { Md5 } from 'ts-md5';\n\nimport { uuid } from '@igo2/utils';\n\nimport { AnyDataSourceOptions } from '../datasource/shared/datasources/any-datasource.interface';\nimport { DataSourceOptions } from '../datasource/shared/datasources/datasource.interface';\nimport { WMSDataSourceOptions } from '../datasource/shared/datasources/wms-datasource.interface';\nimport { WMTSDataSourceOptions } from '../datasource/shared/datasources/wmts-datasource.interface';\nimport { WFSDataSourceOptions } from '../datasource';\n\n/**\n * Generate a id from it's datasource options.\n * @param options Data source options\n * @returns A id\n */\nexport function generateIdFromSourceOptions(options: DataSourceOptions): string {\n  const generators = {\n    wms: generateWMSIdFromSourceOptions,\n    wmts: generateWMTSIdFromSourceOptions,\n    xyz: generateXYZIdFromSourceOptions,\n    feature: generateFeatureIdFromSourceOptions,\n    wfs: generateWfsIdFromSourceOptions,\n    arcgisrest: generateArcgisRestIdFromSourceOptions,\n    imagearcgisrest: generateArcgisRestIdFromSourceOptions,\n    tilearcgisrest: generateArcgisRestIdFromSourceOptions,\n    osm: (_options: AnyDataSourceOptions) => 'OSM',\n    tiledebug: (_options: AnyDataSourceOptions) => 'tiledebug'\n  };\n  const generator = generators[options.type] || generateId;\n  return generator(options);\n}\n\n/**\n * Generate a id from WMS data source options\n * @param options WMS data source options\n * @returns A md5 hash of the the url and layers\n */\nexport function generateWMSIdFromSourceOptions(options: WMSDataSourceOptions) {\n  const layers = options.params.LAYERS;\n  const url = standardizeUrl(options.url);\n  const chain = 'wms' + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from WMTS data source options\n * @param options WMTS data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWMTSIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  const layer = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = 'wmts' + url + layer;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from XYZ data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateXYZIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  const url = standardizeUrl(options.url);\n  const chain = 'xyz' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateFeatureIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  if (!options.url) { return generateId(options); }\n  const url = standardizeUrl(options.url);\n  const chain = 'feature' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWfsIdFromSourceOptions(options: WFSDataSourceOptions) {\n  if (!options.url || !options.params) { return generateId(options); }\n  const url = standardizeUrl(options.url);\n  const chain = 'wfs' + url + options.params.featureTypes;\n  return Md5.hashStr(chain) as string;\n}\n/**\n * Generate a id from ArcGIS Rest data source options\n * @param options ArcGIS Rest data source options\n * @returns A md5 hash of the url and layers\n */\nexport function generateArcgisRestIdFromSourceOptions(options: ArcGISRestDataSourceOptions) {\n  const layers = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = (options.type || 'arcgis') + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a unique id\n * @returns A uuid\n */\nexport function generateId(_options: AnyDataSourceOptions) {\n  return uuid();\n}\n\nexport function standardizeUrl(url: string): string {\n  const absUrl = url.charAt(0) === '/' ? window.location.origin + url : url;\n  const urlDecomposed = absUrl.split(/[?&]/);\n  let urlStandardized = urlDecomposed.shift();\n  const paramsToKeep = urlDecomposed.filter(p => p.length !== 0 && p.charAt(0) !== '_');\n  if (paramsToKeep.length) {\n    urlStandardized += '?' + paramsToKeep.join('&');\n  }\n  return urlStandardized;\n}\n","import olSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\nimport olClusterSource from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  DataSourceOptions,\n  Legend\n} from './datasource.interface';\n\nimport { DataService } from './data.service';\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\nimport { LegendMapViewOptions, LegendOptions } from '../../../layer/shared/layers/layer.interface';\n\nexport abstract class DataSource {\n\n  public id: string;\n  public ol: olSource | olVectorSource<OlGeometry> | olClusterSource ;\n  private legend: Legend[];\n\n  constructor(\n    public options: DataSourceOptions = {},\n    protected dataService?: DataService\n  ) {\n    this.options = options;\n    this.id = this.options.id ||this.generateId();\n    this.ol = this.createOlSource();\n  }\n\n  protected abstract createOlSource(): olSource;\n\n  protected generateId(): string {\n    return generateIdFromSourceOptions(this.options);\n  }\n\n  public getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    return this.legend ? this.legend : [];\n  }\n\n  public setLegend(options: LegendOptions): Legend[] {\n    if (options.url) {\n      this.legend = [{ url: options.url} ];\n    } else if (options.html) {\n      this.legend = [{ html: options.html} ];\n    } else {\n      this.legend = [];\n    }\n\n    return this.legend;\n  }\n\n  protected abstract onUnwatch();\n}\n","export enum OgcFilterOperatorType {\n    BasicNumericOperator = 'basicnumericoperator',\n    Basic = 'basic',\n    BasicAndSpatial = 'basicandspatial',\n    Spatial = 'spatial',\n    All = 'all',\n    Time = 'time'\n}\n\nexport enum OgcFilterOperator {\n    BBOX = 'BBox',\n    PropertyIsBetween = 'PropertyIsBetween',\n    Contains = 'Contains',\n    During = 'During',\n    PropertyIsEqualTo = 'PropertyIsEqualTo',\n    PropertyIsGreaterThan = 'PropertyIsGreaterThan',\n    PropertyIsGreaterThanOrEqualTo = 'PropertyIsGreaterThanOrEqualTo',\n    Intersects = 'Intersects',\n    PropertyIsNull = 'PropertyIsNull',\n    PropertyIsLessThan = 'PropertyIsLessThan',\n    PropertyIsLessThanOrEqualTo = 'PropertyIsLessThanOrEqualTo',\n    PropertyIsLike = 'PropertyIsLike',\n    PropertyIsNotEqualTo = 'PropertyIsNotEqualTo',\n    Within = 'Within',\n    And = 'And',\n    Or = 'Or',\n    Not = 'Not'\n}\n","import * as olfilter from 'ol/format/filter';\nimport olFormatWKT from 'ol/format/WKT';\nimport olFormatWFS, { WriteGetFeatureOptions } from 'ol/format/WFS';\nimport olGeometry from 'ol/geom/Geometry';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { uuid, ObjectUtils } from '@igo2/utils';\n\nimport {\n  OgcFilter,\n  IgoOgcFilterObject,\n  AnyBaseOgcFilterOptions,\n  OgcInterfaceFilterOptions,\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions,\n  IgoOgcSelector,\n  SelectorGroup,\n  OgcSelectorBundle\n} from './ogc-filter.interface';\nimport { OgcFilterOperatorType, OgcFilterOperator } from './ogc-filter.enum';\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport * as moment_ from 'moment';\nconst moment = moment_;\n\nexport class OgcFilterWriter {\n  private filterSequence: OgcInterfaceFilterOptions[] = [];\n  public operators = {\n    [OgcFilterOperator.PropertyIsEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsNotEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsLike as string]: {\n      spatial: false,\n      fieldRestrict: ['string']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsBetween as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.During as string]: { spatial: false, fieldRestrict: [] },\n    [OgcFilterOperator.PropertyIsNull as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Intersects as string]: {\n      spatial: true,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Within as string]: { spatial: true, fieldRestrict: [] },\n    [OgcFilterOperator.Contains as string]: { spatial: true, fieldRestrict: [] }\n  };\n\n  defineOgcFiltersDefaultOptions(\n    ogcFiltersOptions: OgcFiltersOptions,\n    fieldNameGeometry: string,\n    srcType?: string\n  ): OgcFiltersOptions {\n    let ogcFiltersDefaultValue = true; // default values for wfs.\n    if (srcType && srcType === 'wms') {\n      ogcFiltersDefaultValue = false;\n    }\n\n    ogcFiltersOptions = ogcFiltersOptions || {};\n    ogcFiltersOptions.enabled =\n      ogcFiltersOptions.enabled === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.enabled;\n    ogcFiltersOptions.editable =\n      ogcFiltersOptions.editable === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.editable;\n    ogcFiltersOptions.geometryName = fieldNameGeometry;\n\n    ogcFiltersOptions.advancedOgcFilters = true;\n    if (ogcFiltersOptions.enabled && (ogcFiltersOptions.pushButtons || ogcFiltersOptions.checkboxes\n      || ogcFiltersOptions.radioButtons || ogcFiltersOptions.select || ogcFiltersOptions.autocomplete)) {\n      ogcFiltersOptions.advancedOgcFilters = false;\n    }\n    return ogcFiltersOptions;\n  }\n\n  public buildFilter(\n    filters?: IgoOgcFilterObject,\n    extent?: [number, number, number, number],\n    proj?: olProjection,\n    fieldNameGeometry?: string,\n    options?: OgcFilterableDataSourceOptions\n  ): string {\n    let ourBboxFilter;\n    let enableBbox: boolean;\n    if (/intersects|contains|within/gi.test(JSON.stringify(filters))) {\n      enableBbox = false;\n    } else {\n      enableBbox = true;\n    }\n    if (filters) {\n      fieldNameGeometry =\n        (filters as any).geometryName !== undefined\n          ? (filters as any).geometryName\n          : fieldNameGeometry;\n    }\n    if (extent && filters) {\n      ourBboxFilter = olfilter.bbox(fieldNameGeometry, extent, proj.getCode());\n    }\n    let filterAssembly: OgcFilter;\n    if (filters) {\n      filters = this.checkIgoFiltersProperties(\n        filters,\n        fieldNameGeometry,\n        proj\n      );\n      if (extent && enableBbox) {\n        filterAssembly = olfilter.and(\n          ourBboxFilter,\n          this.bundleFilter(filters, options)\n        );\n      } else {\n        filterAssembly = this.bundleFilter(filters, options);\n      }\n    } else {\n      return 'bbox=' + extent.join(',') + ',' + proj.getCode();\n    }\n\n    const wfsOptions: WriteGetFeatureOptions = {\n      srsName: '',\n      featureNS: '',\n      featurePrefix: '',\n      featureTypes: ['featureTypes'],\n      filter: filterAssembly,\n      outputFormat: '',\n      geometryName: fieldNameGeometry\n    };\n\n    const query = new olFormatWFS().writeGetFeature(wfsOptions);\n    const str = new XMLSerializer().serializeToString(query);\n    const regexp1 = /typenames *=|typename *=\\\"featureTypes\\\" *>/gi;\n    const regexp2 = /<\\/Query><\\/GetFeature>/gi;\n\n    return 'filter=' + str.split(regexp1)[1].split(regexp2)[0];\n  }\n\n  private bundleFilter(\n    filterObject: any,\n    options?: OgcFilterableDataSourceOptions\n  ) {\n    if (filterObject instanceof Array) {\n      const logicalArray = [];\n      filterObject.forEach((element) => {\n        logicalArray.push(this.bundleFilter(element, options));\n      });\n      return logicalArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return this.createFilter(\n          {\n            operator: filterObject.logical,\n            logicalArray: this.bundleFilter(filterObject.filters, options)\n          },\n          options\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.createFilter(\n          filterObject as AnyBaseOgcFilterOptions,\n          options\n        );\n      }\n    }\n  }\n\n  private createFilter(\n    filterOptions,\n    options?: OgcFilterableDataSourceOptions\n  ): OgcFilter {\n    const operator = filterOptions.operator;\n    const logicalArray = filterOptions.logicalArray;\n\n    const wfsPropertyName = filterOptions.propertyName;\n    const wfsPattern = filterOptions.pattern;\n    const wfsMatchCase = filterOptions.matchCase\n      ? filterOptions.matchCase\n      : true;\n    const wfsWildCard = filterOptions.wildCard ? filterOptions.wildCard : '*';\n    const wfsSingleChar = filterOptions.singleChar\n      ? filterOptions.singleChar\n      : '.';\n    const wfsEscapeChar = filterOptions.escapeChar\n      ? filterOptions.escapeChar\n      : '!';\n\n    const wfsLowerBoundary = filterOptions.lowerBoundary;\n    const wfsUpperBoundary = filterOptions.upperBoundary;\n\n    const wfsGeometryName = filterOptions.geometryName;\n    const wfsExtent = filterOptions.extent;\n    const wfsWktGeometry = filterOptions.wkt_geometry;\n    const wfsSrsName = filterOptions.srsName\n      ? filterOptions.srsName\n      : 'EPSG:3857';\n\n    const wfsBegin = this.parseFilterOptionDate(\n      filterOptions.begin,\n      options ? options.minDate : undefined\n    );\n    const wfsEnd = this.parseFilterOptionDate(\n      filterOptions.end,\n      options ? options.maxDate : undefined\n    );\n\n    const wfsExpression = filterOptions.expression;\n\n    let geometry: olGeometry;\n    if (wfsWktGeometry) {\n      const wkt = new olFormatWKT();\n      geometry = wkt.readGeometry(wfsWktGeometry, {\n        dataProjection: wfsSrsName,\n        featureProjection: wfsSrsName || 'EPSG:3857'\n      });\n    }\n\n    switch (operator.toLowerCase()) {\n      case OgcFilterOperator.BBOX.toLowerCase():\n        return olfilter.bbox(wfsGeometryName, wfsExtent, wfsSrsName);\n      case OgcFilterOperator.PropertyIsBetween.toLowerCase():\n        return olfilter.between(\n          wfsPropertyName,\n          wfsLowerBoundary || 1e40*-1,\n          wfsUpperBoundary || 1e40\n        );\n      case OgcFilterOperator.Contains.toLowerCase():\n        return olfilter.contains(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.During.toLowerCase():\n        return olfilter.during(wfsPropertyName, wfsBegin, wfsEnd);\n      case OgcFilterOperator.PropertyIsEqualTo.toLowerCase():\n        return olfilter.equalTo(wfsPropertyName, wfsExpression, wfsMatchCase);\n      case OgcFilterOperator.PropertyIsGreaterThan.toLowerCase():\n        return olfilter.greaterThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo.toLowerCase():\n        return olfilter.greaterThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.Intersects.toLowerCase():\n        return olfilter.intersects(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.PropertyIsNull.toLowerCase():\n        return olfilter.isNull(wfsPropertyName);\n      case OgcFilterOperator.PropertyIsLessThan.toLowerCase():\n        return olfilter.lessThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo.toLowerCase():\n        return olfilter.lessThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLike.toLowerCase():\n        return olfilter.like(\n          wfsPropertyName,\n          wfsPattern ? wfsPattern.replace(/[()_]/gi, wfsSingleChar): wfsWildCard,\n          wfsWildCard,\n          wfsSingleChar,\n          wfsEscapeChar,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.PropertyIsNotEqualTo.toLowerCase():\n        return olfilter.notEqualTo(\n          wfsPropertyName,\n          wfsExpression,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.Within.toLowerCase():\n        return olfilter.within(wfsGeometryName, geometry, wfsSrsName);\n      // LOGICAL\n      case OgcFilterOperator.And.toLowerCase():\n        return olfilter.and.apply(null, logicalArray);\n      case OgcFilterOperator.Or.toLowerCase():\n        return olfilter.or.apply(null, logicalArray);\n      case OgcFilterOperator.Not.toLowerCase():\n        return olfilter.not.apply(null, logicalArray);\n\n      default:\n        return undefined;\n    }\n  }\n\n  public defineInterfaceFilterSequence(\n    filterObject: any,\n    geometryName,\n    logical = '',\n    level = -1\n  ): OgcInterfaceFilterOptions[] {\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            element,\n            geometryName,\n            logical,\n            level\n          )\n        );\n      });\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        level = level + 1;\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            filterObject.filters,\n            geometryName,\n            filterObject.logical,\n            level\n          )\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        this.filterSequence.push(\n          this.addInterfaceFilter(filterObject, geometryName, level, logical)\n        );\n      }\n    }\n    return this.filterSequence;\n  }\n\n  public computeAllowedOperators(\n    fields?: SourceFieldsOptionsParams[],\n    propertyName?: string,\n    defaultOperatorsType?: OgcFilterOperatorType\n  ) {\n    let effectiveOperators: {} = {};\n    let allowedOperators;\n    let fieldsHasSpatialOperator: boolean;\n    let includeContains: boolean;\n\n    if (fields && propertyName) {\n      const srcField = fields.find((field) => field.name === propertyName);\n      allowedOperators =\n        srcField && srcField.allowedOperatorsType\n          ? srcField.allowedOperatorsType\n          : defaultOperatorsType;\n    }\n\n    if (fields) {\n      fields.map((field) => {\n        if (!field.allowedOperatorsType) {\n          return;\n        }\n        const allowedOperatorsType = field.allowedOperatorsType.toLowerCase();\n        if (\n          allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.Spatial.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.BasicAndSpatial.toLowerCase()\n        ) {\n          fieldsHasSpatialOperator = true;\n          if (\n            allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase()\n          ) {\n            includeContains = true;\n          }\n        }\n      });\n    }\n\n    allowedOperators = allowedOperators\n      ? allowedOperators\n      : OgcFilterOperatorType.BasicAndSpatial;\n\n    switch (allowedOperators.toLowerCase()) {\n      case OgcFilterOperatorType.All:\n        effectiveOperators = this.operators;\n        break;\n      case OgcFilterOperatorType.Spatial:\n        effectiveOperators = {\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicAndSpatial:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.Basic:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          }\n        };\n        break;\n      case OgcFilterOperatorType.Time:\n        effectiveOperators = {\n          [OgcFilterOperator.During]: { spatial: false, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicNumericOperator:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsGreaterThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          }\n        };\n        break;\n      default:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n    }\n\n    if (fieldsHasSpatialOperator) {\n      (effectiveOperators as any).Intersects = {\n        spatial: true,\n        fieldRestrict: []\n      };\n      (effectiveOperators as any).Within = { spatial: true, fieldRestrict: [] };\n      if (includeContains) {\n        (effectiveOperators as any).Contains = {\n          spatial: true,\n          fieldRestrict: []\n        };\n      }\n    }\n\n    return effectiveOperators;\n  }\n\n  public addInterfaceFilter(\n    igoOgcFilterObject?,\n    geometryName?,\n    level = 0,\n    parentLogical = 'Or'\n  ): OgcInterfaceFilterOptions {\n    if (!igoOgcFilterObject) {\n      igoOgcFilterObject = { operator: 'PropertyIsEqualTo' };\n    }\n    const f = {\n      propertyName: '',\n      operator: '',\n      active: '',\n      filterid: uuid(),\n      step: '',\n      begin: '',\n      end: '',\n      sliderOptions: {},\n      lowerBoundary: '',\n      upperBoundary: '',\n      expression: '',\n      pattern: '',\n      wildCard: '*',\n      singleChar: '.',\n      escapeChar: '!',\n      matchCase: true,\n      igoSpatialSelector: '',\n      igoSNRC: '',\n      geometryName: '',\n      geometry: '',\n      wkt_geometry: '',\n      extent: '',\n      srsName: '',\n      parentLogical: '',\n      level: 0\n    };\n\n    return Object.assign(\n      f,\n      {\n        parentLogical,\n        level,\n        geometryName\n      },\n      igoOgcFilterObject\n    );\n  }\n\n  public checkIgoFiltersProperties(\n    filterObject: any,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterArray = [];\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        filterArray.push(\n          this.checkIgoFiltersProperties(\n            element,\n            fieldNameGeometry,\n            proj,\n            active\n          )\n        );\n      });\n      return filterArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return Object.assign(\n          {},\n          {\n            logical: filterObject.logical,\n            filters: this.checkIgoFiltersProperties(\n              filterObject.filters,\n              fieldNameGeometry,\n              proj,\n              active\n            )\n          }\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.addFilterProperties(\n          filterObject as OgcInterfaceFilterOptions,\n          fieldNameGeometry,\n          proj,\n          active\n        );\n      }\n    }\n  }\n\n  private addFilterProperties(\n    igoOgcFilterObject: OgcInterfaceFilterOptions,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterid = igoOgcFilterObject.hasOwnProperty('filterid')\n      ? igoOgcFilterObject.filterid\n      : uuid();\n    const status = igoOgcFilterObject.hasOwnProperty('active')\n      ? igoOgcFilterObject.active\n      : active;\n\n    const srsName = igoOgcFilterObject.hasOwnProperty('srsName')\n      ? igoOgcFilterObject.srsName\n      : proj\n      ? proj.getCode()\n      : 'EPSG:3857';\n\n    return Object.assign(\n      {},\n      {\n        filterid,\n        active: status,\n        igoSpatialSelector: 'fixedExtent',\n        srsName\n      },\n      igoOgcFilterObject,\n      { geometryName: fieldNameGeometry }\n    );\n  }\n\n  public rebuiltIgoOgcFilterObjectFromSequence(\n    sequence: OgcInterfaceFilterOptions[]\n  ): IgoOgcFilterObject {\n    if (sequence instanceof Array) {\n      if (sequence.length >= 1) {\n        let lastParentLogical = sequence[0].parentLogical;\n        let nextElement: any;\n        let logicalArray = [];\n        let lastProcessedFilter;\n        sequence.forEach((uiFilter) => {\n          const element = Object.assign({}, uiFilter);\n          const index = sequence.indexOf(uiFilter);\n          if (index >= 0 && index < sequence.length - 1) {\n            nextElement = sequence[index + 1];\n          } else {\n            nextElement = element;\n          }\n          delete element.active;\n          delete element.filterid;\n          delete element.parentLogical;\n          logicalArray.push(element);\n\n          if (sequence.length === 1) {\n            lastProcessedFilter = element;\n          } else if (lastParentLogical !== nextElement.parentLogical) {\n            if (logicalArray.length === 1) {\n              console.log(\n                'You must set at ' +\n                  'least two operator in a logical (' +\n                  lastParentLogical +\n                  ')'\n              );\n            } else {\n              lastProcessedFilter = Object.assign(\n                {},\n                { logical: lastParentLogical, filters: logicalArray }\n              );\n              logicalArray = [lastProcessedFilter];\n              lastParentLogical = nextElement.parentLogical;\n            }\n          }\n        });\n        return lastProcessedFilter;\n      } else {\n        return undefined;\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  private computeIgoSelector(selectors: IgoOgcSelector): IgoOgcSelector {\n    if (\n      selectors.groups.every((group) => group.computedSelectors !== undefined)\n    ) {\n      return selectors;\n    }\n    let selector: IgoOgcSelector;\n    if (selectors.groups && selectors.bundles) {\n      if (!selectors.bundles.every((bundle) => bundle.id !== undefined)) {\n        throw new Error(\n          'You must set an id for each of your bundles'\n        );\n      }\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups.forEach((group) => {\n        group.title = group.title ? group.title : group.name;\n        group.enabled = group.enabled ? group.enabled : false;\n        group.computedSelectors = ObjectUtils.copyDeep(\n          selector.bundles.filter((b) => group.ids.includes(b.id))\n        );\n      });\n    } else if (!selectors.groups && selectors.bundles) {\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups = [\n        {\n          title: 'group1',\n          name: 'group1',\n          computedSelectors: ObjectUtils.copyDeep(selector.bundles)\n        } as SelectorGroup\n      ];\n    } else {\n      selector = {\n        bundles: selectors as any,\n        groups: [\n          {\n            title: 'group1',\n            name: 'group1',\n            computedSelectors: ObjectUtils.copyDeep(\n              selectors\n            ) as OgcSelectorBundle[]\n          } as SelectorGroup\n        ],\n        selectorType: selector.selectorType\n      };\n    }\n    if (!selector.groups.find((selectorGroup) => selectorGroup.enabled)) {\n      selector.groups[0].enabled = true;\n    }\n    return selector;\n  }\n\n  public handleOgcFiltersAppliedValue(\n    options: OgcFilterableDataSourceOptions,\n    fieldNameGeometry: string,\n    extent?: [number, number, number, number],\n    proj?: olProjection\n  ): string {\n    const ogcFilters = options.ogcFilters;\n    if (!ogcFilters) {\n      return;\n    }\n    const conditions = [];\n    let filterQueryStringSelector = '';\n    let filterQueryStringAdvancedFilters = '';\n    if (ogcFilters.enabled && (ogcFilters.pushButtons || ogcFilters.checkboxes || ogcFilters.radioButtons || ogcFilters.select\n      || ogcFilters.autocomplete)) {\n      let selectors;\n      if (ogcFilters.pushButtons) {\n        selectors = ogcFilters.pushButtons;\n        const pushConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of pushConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.checkboxes) {\n        selectors = ogcFilters.checkboxes;\n        const checkboxConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of checkboxConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.radioButtons) {\n        selectors = ogcFilters.radioButtons;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const radioConditions = this.formatGroupAndFilter(ogcFilters, selectorsCorr);\n        for (const condition of radioConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.select) {\n        selectors = ogcFilters.select;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const selectConditions = this.formatGroupAndFilter(ogcFilters, selectorsCorr);\n        for (const condition of selectConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.autocomplete) {\n        selectors = ogcFilters.autocomplete;\n        const selectConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of selectConditions) {\n          conditions.push(condition);\n        }\n      }\n\n      if (conditions.length >= 1) {\n        filterQueryStringSelector = this.buildFilter(\n          conditions.length === 1\n            ? conditions[0]\n            : { logical: 'And', filters: conditions },\n          extent,\n          proj,\n          ogcFilters.geometryName\n        );\n      }\n    }\n    if (ogcFilters.enabled && ogcFilters.filters) {\n      ogcFilters.geometryName = ogcFilters.geometryName || fieldNameGeometry;\n      const igoFilters = ogcFilters.filters;\n      filterQueryStringAdvancedFilters = this.buildFilter(\n        igoFilters,\n        extent,\n        proj,\n        ogcFilters.geometryName,\n        options\n      );\n    }\n\n    let filterQueryString = ogcFilters.advancedOgcFilters\n      ? filterQueryStringAdvancedFilters\n      : filterQueryStringSelector;\n    if (options.type === 'wms') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.LAYERS\n      );\n    }\n    if (options.type === 'wfs') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.featureTypes\n      );\n    }\n\n    return filterQueryString;\n  }\n\n  public verifyMultipleEnableds(selectors) {\n    selectors.bundles.forEach(bundle => {\n      if (!bundle.multiple && bundle.selectors) {\n        const enableds = bundle.selectors.reduce((list, filter, index) => (filter.enabled) === true ? list.concat(index) : list, []);\n        if (enableds.length > 1) {\n          enableds.splice(0, 1);\n          enableds.forEach(index => {\n            bundle.selectors[index].enabled = false;\n          });\n        }\n      }\n    });\n    return selectors;\n  }\n\n  public formatGroupAndFilter(ogcFilters: OgcFiltersOptions, selectors) {\n    selectors = this.computeIgoSelector(\n      selectors\n    );\n    const selectorBundle = selectors.groups.find(\n      (g) => g.enabled\n    ).computedSelectors;\n    const conditions = [];\n    selectorBundle.map((bundle) => {\n      const bundleCondition = [];\n      const selectorsType = bundle.selectors as any;\n      if (!selectorsType) {\n        return;\n      }\n      selectorsType\n        .filter((ogcselector) => ogcselector.enabled === true)\n        .forEach((enabledSelector) => bundleCondition.push(enabledSelector.filters));\n      if (bundleCondition.length === 1) {\n        conditions.push(bundleCondition[0]);\n      } else if (bundleCondition.length > 1) {\n        conditions.push({\n          logical: bundle.logical,\n          filters: bundleCondition\n        });\n      }\n    });\n\n    if (selectors.selectorType === 'pushButton') {\n      ogcFilters.pushButtons = selectors;\n    } else if (selectors.selectorType === 'checkbox') {\n      ogcFilters.checkboxes = selectors;\n    } else if (selectors.selectorType === 'radioButton') {\n      ogcFilters.radioButtons = selectors;\n    } else if (selectors.selectorType === 'select') {\n      ogcFilters.select = selectors;\n    } else if (selectors.selectorType === 'autocomplete') {\n      ogcFilters.autocomplete = selectors;\n    }\n    return conditions;\n  }\n\n  public formatProcessedOgcFilter(\n    processedFilter: string,\n    layersOrTypenames: string\n  ): string {\n\n    if (!processedFilter) {return undefined;};\n    let appliedFilter = '';\n    if (processedFilter.length === 0 && layersOrTypenames.indexOf(',') === -1) {\n      appliedFilter = processedFilter;\n    } else {\n      layersOrTypenames.split(',').forEach((layerOrTypenames) => {\n        appliedFilter = `${appliedFilter}(${processedFilter.replace(\n          'filter=',\n          ''\n        )})`;\n      });\n    }\n    appliedFilter = appliedFilter.replace(/\\(\\)/g, '');\n    const filterValue =\n      appliedFilter.length > 0\n        ? appliedFilter.replace('filter=', '')\n        : undefined;\n    return filterValue;\n  }\n\n  public parseFilterOptionDate(value: string, defaultValue?: string): string {\n    if (!value) {\n      return defaultValue;\n    } else if (value === 'today') {\n      return undefined;\n    } else if (moment(value).isValid()) {\n      return value;\n    } else {\n      return undefined;\n    }\n  }\n}\n","export enum QueryFormat {\n  GML2 = 'gml2',\n  GML3 = 'gml3',\n  JSON = 'json',\n  GEOJSON = 'geojson',\n  GEOJSON2 = 'geojson2',\n  ESRIJSON = 'esrijson',\n  TEXT = 'text',\n  HTML = 'html',\n  HTMLGML2 = 'htmlgml2'\n}\n\nexport enum QueryFormatMimeType {\n  GML2 = 'application/vnd.ogc.gml',\n  GML3 = 'application/vnd.ogc.gml/3.1.1',\n  JSON = 'application/json',\n  GEOJSON = 'application/geojson',\n  GEOJSON2 = 'geojson',\n  ESRIJSON = 'application/json',\n  TEXT = 'text/plain',\n  HTML = 'text/html',\n  HTMLGML2 = 'text/html'\n}\n\nexport enum QueryHtmlTarget {\n  IFRAME = 'iframe',\n  BLANK = '_blank'\n}\n","import { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\n\nimport * as OlFormat from 'ol/format';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport olFormatGML32 from 'ol/format/GML32';\nimport olFormatOSMXML from 'ol/format/OSMXML';\nimport olProjection from 'ol/proj/Projection';\n\nexport const defaultEpsg = 'EPSG:3857';\nexport const defaultMaxFeatures = 5000;\nexport const defaultWfsVersion = '2.0.0';\nexport const defaultFieldNameGeometry = 'geometry';\nexport const gmlRegex = new RegExp(/(.*)?gml(.*)?/gi);\nexport const jsonRegex = new RegExp(/(.*)?json(.*)?/gi);\n\n\n/**\n * This method build the WFS URL based on the layer property.\n * @param options  WFSDataSourceOptions The common wfs datasource options interface\n * @param extent  An extent like array [number, number, number, number]\n * @param proj  olProjection\n * @param ogcFilters  OgcFiltersOptions\n * @returns A string representing the datasource options, based on filter and views\n */\nexport function buildUrl(\n  options: WFSDataSourceOptions,\n  extent,\n  proj: olProjection,\n  ogcFilters: OgcFiltersOptions,\n  randomParam?: boolean): string {\n  const paramsWFS = options.paramsWFS;\n  const queryStringValues = formatWFSQueryString(options, undefined, options.paramsWFS.srsName);\n  let igoFilters;\n  if (ogcFilters && ogcFilters.enabled) {\n    igoFilters = ogcFilters.filters;\n  }\n  const ogcFilterWriter = new OgcFilterWriter();\n  const filterOrBox = ogcFilterWriter.buildFilter(igoFilters, extent, proj, ogcFilters.geometryName, options);\n  let filterOrPush = ogcFilterWriter.handleOgcFiltersAppliedValue(options, ogcFilters.geometryName, extent, proj);\n\n  let prefix = 'filter';\n  if (!filterOrPush) {\n    prefix = 'bbox';\n    filterOrPush = extent.join(',') + ',' + proj.getCode();\n  }\n\n  paramsWFS.xmlFilter = ogcFilters.advancedOgcFilters ? filterOrBox : `${prefix}=${filterOrPush}`;\n  let baseUrl = queryStringValues.find(f => f.name === 'getfeature').value;\n  const patternFilter = /(filter|bbox)=.*/gi;\n  baseUrl = patternFilter.test(paramsWFS.xmlFilter) ? `${baseUrl}&${paramsWFS.xmlFilter}` : baseUrl;\n  options.download = Object.assign({}, options.download, { dynamicUrl: baseUrl });\n  if (randomParam) {\n    baseUrl += `$&_t${new Date().getTime()}`;\n  }\n  return baseUrl.replace(/&&/g, '&');\n}\n\n\n/**\n * This method build/standardize WFS call query params based on the layer property.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @param count  Number: Used to control the number of feature. Used to bypass whe wfs datasource options interface (maxFeatures)\n * @param epsg  String: Used to control the EPSG code (es: 'EPSG3857'). Used to bypass whe wfs datasource options interface (srsName)\n * @param properties  String: Used to control the queried fields  (WFS service).\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function formatWFSQueryString(\n  dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n  count?: number,\n  epsg?: string,\n  properties?: string,\n  startIndex: number = 0,\n  forceDefaultOutputFormat: boolean = false\n): { name: string; value: string }[] {\n  const versionWfs200 = '2.0.0'; // not the same usage as defaultWfsVersion.\n  const url = dataSourceOptions.urlWfs;\n  const paramsWFS = dataSourceOptions.paramsWFS;\n  const effectiveCount = count || defaultMaxFeatures;\n  const effectiveStartIndex = paramsWFS.version === versionWfs200 ? `startIndex=${startIndex}` : '';\n  const epsgCode = epsg || defaultEpsg;\n  let outputFormat = paramsWFS.outputFormat\n    ? `outputFormat=${paramsWFS.outputFormat}`\n    : '';\n  let version = paramsWFS.version\n    ? `version=${paramsWFS.version}`\n    : `version=${defaultWfsVersion}`;\n  const paramTypename =\n    paramsWFS.version === versionWfs200 ? 'typenames' : 'typename';\n  const featureTypes = `${paramTypename}=${paramsWFS.featureTypes}`;\n  const paramMaxFeatures =\n    paramsWFS.version === versionWfs200 ? 'count' : 'maxFeatures';\n  let cnt = count\n    ? `${paramMaxFeatures}=${effectiveCount}`\n    : paramsWFS.maxFeatures\n    ? `${paramMaxFeatures}=${paramsWFS.maxFeatures}`\n    : `${paramMaxFeatures}=${effectiveCount}`;\n  if (forceDefaultOutputFormat) {\n      outputFormat = '';\n      version = 'version=1.1.0';\n      cnt = cnt.replace('count', 'maxFeatures');\n    }\n\n  const srs = epsg\n    ? `srsname=${epsgCode}`\n    : paramsWFS.srsName\n    ? 'srsname=' + paramsWFS.srsName\n    : `srsname=${epsgCode}`;\n\n  let propertyName = '';\n  let valueReference = '';\n  if (properties) {\n    propertyName = `propertyName=${properties}`;\n    valueReference = `valueReference=${properties}`;\n  }\n  const sourceFields = dataSourceOptions.sourceFields;\n  if (!propertyName && sourceFields && sourceFields.length > 0) {\n    const fieldsNames = [];\n    dataSourceOptions.sourceFields.forEach(sourcefield => {\n      fieldsNames.push(sourcefield.name);\n    });\n    propertyName = `propertyName=${fieldsNames.join(',')},${\n      paramsWFS.fieldNameGeometry\n    }`;\n  }\n\n  const separator = url.indexOf('?') === -1 ? '?' : '&';\n  const getCapabilities = `${url}${separator}service=WFS&request=GetCapabilities&${version}`;\n  let getFeature = `${url}${separator}service=WFS&request=GetFeature&${version}&${featureTypes}&`;\n  getFeature += `${outputFormat}&${srs}&${cnt}&${propertyName}&${effectiveStartIndex}`;\n\n  let getpropertyvalue = `${url}?service=WFS&request=GetPropertyValue&version=${versionWfs200}&${featureTypes}&`;\n  getpropertyvalue += `&${cnt}&${valueReference}`;\n\n  return [\n    { name: 'outputformat', value: outputFormat },\n    { name: 'version', value: version },\n    { name: 'typename', value: featureTypes },\n    { name: 'count', value: cnt },\n    { name: 'srsname', value: srs },\n    { name: 'propertyname', value: propertyName },\n    { name: 'valuereference', value: valueReference },\n    { name: 'getcapabilities', value: getCapabilities.replace(/&&/g, '&') },\n    { name: 'getfeature', value: getFeature.replace(/&&/g, '&') },\n    { name: 'getpropertyvalue', value: getpropertyvalue.replace(/&&/g, '&') }\n  ];\n}\n\n/**\n * Validate/Modify layer's wfs options based on :\n * 1- an Openlayers's issue with GML provided from WFS. Refer to\n * https://github.com/openlayers/openlayers/pull/6400\n * 2- Set default values for optionals parameters.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function checkWfsParams(wfsDataSourceOptions, srcType?: string) {\n  if (srcType && srcType === 'wfs') {\n    // reassignation of params to paramsWFS and url to urlWFS to have a common interface with wms-wfs datasources\n    wfsDataSourceOptions.paramsWFS = wfsDataSourceOptions.params;\n  }\n\n  const paramsWFS = wfsDataSourceOptions.paramsWFS;\n  wfsDataSourceOptions.urlWfs =\n    wfsDataSourceOptions.urlWfs || wfsDataSourceOptions.url;\n\n  paramsWFS.version = paramsWFS.version || defaultWfsVersion;\n  paramsWFS.fieldNameGeometry =\n    paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n  paramsWFS.maxFeatures = paramsWFS.maxFeatures || defaultMaxFeatures;\n\n  let outputFormat;\n  if (paramsWFS.outputFormat) {\n    outputFormat = paramsWFS.outputFormat;\n  }\n\n  if (gmlRegex.test(outputFormat) || !outputFormat) {\n    paramsWFS.version = '1.1.0';\n  }\n  return Object.assign({}, wfsDataSourceOptions);\n}\n\nexport function getFormatFromOptions(\n  options: WFSDataSourceOptions | WMSDataSourceOptions\n) {\n  const wfsOptions = options as WFSDataSourceOptions;\n\n  let olFormatCls;\n  const outputFormat = wfsOptions.paramsWFS.outputFormat\n    ? wfsOptions.paramsWFS.outputFormat\n    : undefined;\n\n  if (!outputFormat) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  if (OlFormat[outputFormat]) {\n    olFormatCls = OlFormat[outputFormat];\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gml2')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ...{ gmlFormat: olFormatGML2 }});\n  } else if (outputFormat.toLowerCase().match('gml32')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ...{ gmlFormat: olFormatGML32 }});\n  } else if (outputFormat.toLowerCase().match('gml3')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ...{ gmlFormat: olFormatGML3 }});\n  } else if (outputFormat.toLowerCase().match('topojson')) {\n    olFormatCls = OlFormat.TopoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('geojson')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('esrijson')) {\n    olFormatCls = OlFormat.EsriJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('json')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gpx')) {\n    olFormatCls = OlFormat.GPX;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('WKT')) {\n    olFormatCls = OlFormat.WKT;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('osmxml')) {\n    olFormatCls = olFormatOSMXML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('kml')) {\n    olFormatCls = OlFormat.KML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  return new olFormatCls();\n}\n","import olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { WFSService } from './wfs.service';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport { OgcFilterableDataSourceOptions, OgcFiltersOptions, OgcFilterDuringOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nimport {\n  formatWFSQueryString,\n  checkWfsParams,\n  defaultFieldNameGeometry\n} from './wms-wfs.utils';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { LegendMapViewOptions } from '../../../layer/shared/layers/layer.interface';\nimport { BehaviorSubject } from 'rxjs';\nimport { TimeFilterableDataSourceOptions, TimeFilterOptions } from '../../../filter/shared/time-filter.interface';\n\nexport class WMSDataSource extends DataSource {\n  public ol: olSourceImageWMS;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  readonly ogcFilters$: BehaviorSubject<OgcFiltersOptions> = new BehaviorSubject(undefined);\n\n  set timeFilter(value: TimeFilterOptions ) {\n    (this.options as TimeFilterableDataSourceOptions).timeFilter = value;\n  }\n  get timeFilter(): TimeFilterOptions {\n    return (this.options as TimeFilterableDataSourceOptions).timeFilter;\n  }\n  readonly timeFilter$: BehaviorSubject<TimeFilterOptions> = new BehaviorSubject(undefined);\n\n  constructor(\n    public options: WMSDataSourceOptions,\n    protected wfsService: WFSService\n  ) {\n    super(options);\n    const sourceParams: any = options.params;\n\n    const dpi = sourceParams.DPI || 96;\n    sourceParams.DPI = dpi;\n    sourceParams.MAP_RESOLUTION = dpi;\n    sourceParams.FORMAT_OPTIONS = 'dpi:' + dpi;\n\n    if (options.refreshIntervalSec && options.refreshIntervalSec > 0) {\n      setInterval(() => {\n        this.refresh();\n      }, options.refreshIntervalSec * 1000); // Convert seconds to MS\n    }\n\n    let fieldNameGeometry = defaultFieldNameGeometry;\n\n    // ####   START if paramsWFS\n    if (options.paramsWFS) {\n      const wfsCheckup = checkWfsParams(options, 'wms');\n      ObjectUtils.mergeDeep(options.paramsWFS, wfsCheckup.paramsWFS);\n\n      fieldNameGeometry =\n        options.paramsWFS.fieldNameGeometry || fieldNameGeometry;\n\n      options.download = Object.assign({}, options.download, {\n        dynamicUrl: this.buildDynamicDownloadUrlFromParamsWFS(options)\n      });\n    } //  ####   END  if paramsWFS\n\n    if (!options.sourceFields || options.sourceFields.length === 0) {\n      options.sourceFields = [];\n    } else {\n      options.sourceFields.forEach(sourceField => {\n        sourceField.alias = sourceField.alias\n          ? sourceField.alias\n          : sourceField.name;\n        // to allow only a list of sourcefield with names\n      });\n    }\n    const initOgcFilters = (options as OgcFilterableDataSourceOptions)\n      .ogcFilters;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (!initOgcFilters) {\n      (options as OgcFilterableDataSourceOptions).ogcFilters = ogcFilterWriter.defineOgcFiltersDefaultOptions(\n        initOgcFilters,\n        fieldNameGeometry,\n        'wms'\n      );\n    } else {\n      initOgcFilters.advancedOgcFilters = (initOgcFilters.pushButtons || initOgcFilters.checkboxes\n        || initOgcFilters.radioButtons || initOgcFilters.select || initOgcFilters.autocomplete)\n        ? false\n        : true;\n      if (initOgcFilters.advancedOgcFilters && initOgcFilters.filters) {\n          const filterDuring = initOgcFilters.filters as OgcFilterDuringOptions;\n          if(filterDuring.calendarModeYear) {\n            initOgcFilters.advancedOgcFilters = false;\n          }\n      }\n      if (initOgcFilters.pushButtons){\n        initOgcFilters.pushButtons.selectorType = 'pushButton';\n      }\n      if (initOgcFilters.checkboxes){\n        initOgcFilters.checkboxes.selectorType = 'checkbox';\n      }\n      if (initOgcFilters.radioButtons){\n        initOgcFilters.radioButtons.selectorType = 'radioButton';\n      }\n      if (initOgcFilters.select){\n        initOgcFilters.select.selectorType = 'select';\n      }\n      if (initOgcFilters.autocomplete){\n        initOgcFilters.autocomplete.selectorType = 'autocomplete';\n      }\n    }\n\n    if (\n      sourceParams.LAYERS.split(',').length > 1 &&\n      initOgcFilters &&\n      initOgcFilters.enabled\n    ) {\n      console.log('*******************************');\n      console.log(\n        'BE CAREFULL, YOUR WMS LAYERS (' +\n          sourceParams.LAYERS +\n          ') MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! '\n      );\n      console.log('*******************************');\n    }\n\n    if (\n      options.paramsWFS &&\n      initOgcFilters &&\n      initOgcFilters.enabled &&\n      initOgcFilters.editable &&\n      (options.sourceFields || []).filter(sf => !sf.values).length > 0) {\n      this.wfsService.getSourceFieldsFromWFS(options);\n    }\n\n    const filterQueryString = ogcFilterWriter.handleOgcFiltersAppliedValue(\n      options,\n      fieldNameGeometry\n    );\n    sourceParams.FILTER = filterQueryString;\n    this.setOgcFilters(initOgcFilters, true);\n\n    const timeFilterableDataSourceOptions = (options as TimeFilterableDataSourceOptions);\n    if (\n      timeFilterableDataSourceOptions?.timeFilterable &&\n      timeFilterableDataSourceOptions?.timeFilter) {\n      this.setTimeFilter(timeFilterableDataSourceOptions.timeFilter, true);\n    }\n  }\n\n  refresh() {\n    this.ol.updateParams({ igoRefresh: Math.random() });\n  }\n\n  private buildDynamicDownloadUrlFromParamsWFS(asWFSDataSourceOptions) {\n    const queryStringValues = formatWFSQueryString(asWFSDataSourceOptions);\n    const downloadUrl = queryStringValues.find(f => f.name === 'getfeature')\n      .value;\n    return downloadUrl;\n  }\n\n  protected createOlSource(): olSourceImageWMS {\n    return new olSourceImageWMS(Object.assign({ratio: 1}, this.options));\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    if (triggerEvent) {\n      this.ogcFilters$.next(this.ogcFilters);\n    }\n  }\n\n  setTimeFilter(timeFilter: TimeFilterOptions, triggerEvent: boolean = false) {\n    this.timeFilter = timeFilter;\n    if (triggerEvent) {\n      this.timeFilter$.next(this.timeFilter);\n    }\n  }\n\n  getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    let legend = super.getLegend();\n    if (legend.length > 0 && (style === undefined && !view?.scale)) {\n      return legend;\n    }\n\n    let contentDependent = false;\n    let projParam;\n\n    if (view?.size && view?.extent && view?.projection && this.options.contentDependentLegend) {\n      projParam = this.params.VERSION === '1.3.0' || this.params.VERSION === undefined ? 'CRS' : 'SRS';\n      contentDependent = true;\n    }\n\n    const sourceParams = this.params;\n\n    let layers = [];\n    if (sourceParams.LAYERS !== undefined) {\n      layers = sourceParams.LAYERS.split(',');\n    }\n\n    const baseUrl = this.options.url.replace(/\\?$/, '');\n    const params = [\n      'REQUEST=GetLegendGraphic',\n      'SERVICE=WMS',\n      'FORMAT=image/png',\n      'SLD_VERSION=1.1.0',\n      `VERSION=${sourceParams.VERSION || '1.3.0'}`\n    ];\n    if (style !== undefined) {\n      params.push(`STYLE=${style}`);\n    }\n    if (view?.scale !== undefined) {\n      params.push(`SCALE=${view.scale}`);\n    }\n    if (contentDependent) {\n      params.push(`WIDTH=${view.size[0]}`);\n      params.push(`HEIGHT=${view.size[1]}`);\n      params.push(`BBOX=${view.extent.join(',')}`);\n      params.push(`${projParam}=${view.projection}`);\n    }\n\n    legend = layers.map((layer: string) => {\n      const separator = baseUrl.match(/\\?/) ? '&' : '?';\n      return {\n        url: `${baseUrl}${separator}${params.join('&')}&LAYER=${layer}`,\n        title: layers.length > 1 ? layer : undefined,\n        currentStyle: style === undefined ? undefined : style as string\n      };\n    });\n\n    return legend;\n  }\n\n  public onUnwatch() {}\n}\n","import { Watcher } from '@igo2/utils';\nimport { Layer } from '../shared/layers/layer';\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\nimport { DataSource } from '../../datasource/shared/datasources/datasource';\nimport { IgoMap } from '../../map/shared/map';\nimport { LayersLink, LinkedProperties } from '../shared/layers/layer.interface';\nimport { OgcFilterableDataSource, OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { TimeFilterableDataSource } from '../../filter/shared/time-filter.interface';\nimport { Subscription } from 'rxjs';\nimport { first } from 'rxjs/operators';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\n\nexport class LayerSyncWatcher extends Watcher {\n    private ogcFilters$$: Subscription;\n    private timeFilter$$: Subscription;\n\n    private ol: olLayer<olSource>;\n    private layer: Layer;\n    private dataSource: DataSource;\n    private map: IgoMap;\n    private ogcFilterWriter;\n\n    constructor(layer: Layer, map: IgoMap) {\n        super();\n        this.ol = layer.ol;\n        this.layer = layer;\n        this.dataSource = layer.options.source;\n        this.map = map;\n        this.ogcFilterWriter = new OgcFilterWriter();\n    }\n\n    protected watch() {\n\n        this.ol.on('propertychange', evt => this.transferCommonProperties(evt));\n        if ((this.dataSource as OgcFilterableDataSource).ogcFilters$) {\n            this.ogcFilters$$ = (this.dataSource as OgcFilterableDataSource).ogcFilters$\n                .subscribe(ogcFilters => this.transferOgcFiltersProperties(ogcFilters));\n        }\n        if ((this.dataSource as TimeFilterableDataSource).timeFilter$) {\n            this.timeFilter$$ = (this.dataSource as TimeFilterableDataSource).timeFilter$\n                .subscribe(timeFilter => this.transferTimeFilterProperties(timeFilter));\n        }\n        this.syncChildLayers();\n    }\n\n    protected unwatch() {\n        this.ol.un('propertychange', evt => this.transferCommonProperties(evt));\n        if (this.ogcFilters$$) { this.ogcFilters$$.unsubscribe(); }\n        if (this.timeFilter$$) { this.timeFilter$$.unsubscribe(); }\n    }\n\n\n    private syncChildLayers() {\n        // Force the sync the child layers with parent on the first load.\n        if (!this.map) {\n            return;\n        }\n        this.map.status$\n            .pipe(first())\n            .subscribe(() => {\n                this.map.layers\n                    .filter(layer => layer.options.linkedLayers?.links)\n                    .map(layer => {\n                        layer.options.linkedLayers.links.map(link => {\n                            if (link.properties?.indexOf(LinkedProperties.VISIBLE) !== -1) {\n                                layer.ol.set('visible', !(layer.visible), false);\n                                layer.ol.set('visible', !(layer.visible), false);\n                                layer.visible = layer.visible;\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.OPACITY) !== -1) {\n                                const baseOpacity = layer.ol.get('opacity');\n                                layer.ol.set('opacity', 0, false);\n                                layer.ol.set('opacity', baseOpacity, false);\n                                layer.opacity = layer.opacity;\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.MINRESOLUTION) !== -1) {\n                                const baseMinResolution = layer.ol.get('minResolution');\n                                layer.ol.set('minResolution', 0, false);\n                                layer.ol.set('minResolution', baseMinResolution, false);\n                                layer.minResolution = layer.minResolution;\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.MAXRESOLUTION) !== -1) {\n                                const baseMaxResolution = layer.ol.get('maxResolution');\n                                layer.ol.set('maxResolution', 0, false);\n                                layer.ol.set('maxResolution', baseMaxResolution, false);\n                                layer.minResolution = layer.minResolution;\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.OGCFILTERS) !== -1) {\n                                const ogcFilters$ = (layer.dataSource as OgcFilterableDataSource).ogcFilters$;\n                                ogcFilters$.next(ogcFilters$.value);\n                            }\n                            if (link.properties?.indexOf(LinkedProperties.TIMEFILTER) !== -1) {\n                                const timeFilter$ = (layer.dataSource as TimeFilterableDataSource).timeFilter$;\n                                timeFilter$.next(timeFilter$.value);\n                            }\n                        });\n                    });\n            });\n    }\n\n    private transferCommonProperties(layerChange) {\n        const key = layerChange.key;\n        const layerChangeProperties = layerChange.target.getProperties();\n        const newValue = layerChangeProperties[key];\n\n        if (['visible', 'opacity', 'minResolution', 'maxResolution'].indexOf(key) === -1) {\n            return;\n        }\n        const linkedLayers = layerChangeProperties.linkedLayers as LayersLink;\n        if (!linkedLayers) {\n            return;\n        }\n        const currentLinkedId = linkedLayers.linkId;\n        const currentLinks = linkedLayers.links;\n        const isParentLayer = currentLinks ? true : false;\n\n        if (isParentLayer) {\n            // search for child layers\n            const silent = true;\n            currentLinks.map(link => {\n                if (!link.properties || link.properties.indexOf(key) === -1) {\n                    return;\n                }\n                link.linkedIds.map(linkedId => {\n                    const layerToApply = this.map.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\n                    if (layerToApply) {\n                        layerToApply.ol.set(key, newValue, silent);\n                        if (key === 'visible') {\n                            layerToApply.visible$.next(newValue);\n                        }\n                    }\n                });\n            });\n        } else {\n            // search for parent layer\n            const silent = false;\n            this.map.layers.map(layer => {\n                if (layer.options.linkedLayers?.links) {\n                    layer.options.linkedLayers.links.map(l => {\n                        if (l.properties && l.properties.indexOf(key) !== -1 &&\n                            l.bidirectionnal !== false && l.linkedIds.indexOf(currentLinkedId) !== -1) {\n                            layer.ol.set(key, newValue, silent);\n                            if (key === 'visible') {\n                                layer.visible$.next(newValue);\n                            }\n                        }\n                    });\n                }\n            });\n        }\n    }\n\n    private transferOgcFiltersProperties(ogcFilters) {\n        const linkedLayers = this.ol.getProperties().linkedLayers as LayersLink;\n        if (!linkedLayers) {\n            return;\n        }\n        const currentLinkedId = linkedLayers.linkId;\n        const currentLinks = linkedLayers.links;\n        const isParentLayer = currentLinks ? true : false;\n        if (isParentLayer) {\n            // search for child layers\n            currentLinks.map(link => {\n                if (!link.properties || link.properties.indexOf(LinkedProperties.OGCFILTERS) === -1) {\n                    return;\n                }\n                link.linkedIds.map(linkedId => {\n                    const layerToApply = this.map.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\n                    if (layerToApply) {\n                        const layerType = layerToApply.ol.getProperties().sourceOptions.type;\n                        (layerToApply.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, false);\n                        if (layerType === 'wfs') {\n                            layerToApply.ol.getSource().refresh();\n                        }\n                        if (layerType === 'wms') {\n                            let appliedOgcFilter;\n                            if (this.ol.getProperties().sourceOptions.type === 'wfs') {\n                                appliedOgcFilter = this.ogcFilterWriter.handleOgcFiltersAppliedValue(\n                                    this.layer.dataSource.options as OgcFilterableDataSourceOptions,\n                                    (this.dataSource.options as any).fieldNameGeometry,\n                                    undefined,\n                                    this.map.viewController.getOlProjection()\n                                );\n                            } else if (this.ol.getProperties().sourceOptions.type === 'wms') {\n                                appliedOgcFilter = (this.dataSource as WMSDataSource).ol.getParams().FILTER;\n                            }\n                            (layerToApply.dataSource as WMSDataSource).ol.updateParams({ FILTER: appliedOgcFilter });\n                        }\n                    }\n                });\n            });\n        } else {\n            // search for parent layer\n            this.map.layers.map(layer => {\n                if (layer.options.linkedLayers?.links) {\n                    layer.options.linkedLayers.links.map(l => {\n                        if (l.properties && l.properties.indexOf(LinkedProperties.OGCFILTERS) !== -1 &&\n                            l.bidirectionnal !== false && l.linkedIds.indexOf(currentLinkedId) !== -1) {\n                            const layerType = layer.ol.getProperties().sourceOptions.type;\n                            if (layerType === 'wfs') {\n                                (layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\n                                layer.ol.getSource().refresh();\n                            }\n                            if (layerType === 'wms') {\n                                let appliedOgcFilter;\n                                if (this.ol.getProperties().sourceOptions.type === 'wfs') {\n                                    appliedOgcFilter = this.ogcFilterWriter.handleOgcFiltersAppliedValue(\n                                        layer.dataSource.options as OgcFilterableDataSourceOptions,\n                                        (this.dataSource.options as any).fieldNameGeometry,\n                                        undefined,\n                                        this.map.viewController.getOlProjection()\n                                    );\n\n                                } else if (this.ol.getProperties().sourceOptions.type === 'wms') {\n                                    appliedOgcFilter = (this.dataSource as WMSDataSource).ol.getParams().FILTER;\n                                }\n                                (layer.dataSource as WMSDataSource).ol.updateParams({ FILTER: appliedOgcFilter });\n                                (layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\n                            }\n                        }\n                    });\n                }\n            });\n        }\n    }\n\n    private transferTimeFilterProperties(timeFilter) {\n        const linkedLayers = this.ol.getProperties().linkedLayers as LayersLink;\n        if (!linkedLayers) {\n            return;\n        }\n        const currentLinkedId = linkedLayers.linkId;\n        const currentLinks = linkedLayers.links;\n        const isParentLayer = currentLinks ? true : false;\n        if (isParentLayer) {\n            // search for child layers\n            currentLinks.map(link => {\n                if (!link.properties || link.properties.indexOf(LinkedProperties.TIMEFILTER) === -1) {\n                    return;\n                }\n                link.linkedIds.map(linkedId => {\n                    const childLayer = this.map.layers.find(layer =>\n                        layer.dataSource instanceof WMSDataSource &&\n                        layer.options.linkedLayers?.linkId === linkedId);\n                    if (childLayer) {\n                        (childLayer.dataSource as TimeFilterableDataSource).setTimeFilter(timeFilter, false);\n                        const appliedTimeFilter = (this.ol.getSource() as olSourceImageWMS).getParams().TIME;\n                        (childLayer.dataSource as WMSDataSource).ol.updateParams({ TIME: appliedTimeFilter });\n                    }\n                });\n            });\n        } else {\n            // search for parent layer\n            this.map.layers\n                .filter(layer => layer.dataSource instanceof WMSDataSource)\n                .map(parentLayer => {\n                    if (parentLayer.options.linkedLayers?.links) {\n                        parentLayer.options.linkedLayers.links.map(l => {\n                            if (l.properties && l.properties.indexOf(LinkedProperties.TIMEFILTER) !== -1 &&\n                                l.bidirectionnal !== false && l.linkedIds.indexOf(currentLinkedId) !== -1) {\n                                const appliedTimeFilter = (this.ol.getSource() as olSourceImageWMS).getParams().TIME;\n                                (parentLayer.dataSource as WMSDataSource).ol.updateParams({ TIME: appliedTimeFilter });\n                                (parentLayer.dataSource as TimeFilterableDataSource).setTimeFilter(timeFilter, true);\n                            }\n                        });\n                    }\n                });\n        }\n    }\n}\n","import olSourceTile from 'ol/source/Tile';\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\n\nimport { TileLayer } from '../shared/layers/tile-layer';\nimport { VectorTileLayer } from '../shared/layers/vectortile-layer';\n\nexport class TileWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private source: olSourceTile;\n\n  constructor(layer: TileLayer | VectorTileLayer) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    this.source.on(`tileloadstart`, e => this.handleLoadStart(e));\n    this.source.on(`tileloadend`, e => this.handleLoadEnd(e));\n    this.source.on(`tileloaderror`, e => this.handleLoadEnd(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`tileloadstart`, e => this.handleLoadStart(e));\n    this.source.un(`tileloadend`, e => this.handleLoadEnd(e));\n    this.source.un(`tileloaderror`, e => this.handleLoadEnd(e));\n  }\n\n  private handleLoadStart(event: any) {\n    // This is to avoid increasing\n    // the number of loaded tiles if a tile was loading\n    // before subscribing to this watcher\n    if (!event.tile.__watchers__) {\n      event.tile.__watchers__ = [];\n    }\n    event.tile.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.tile.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.tile.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.tile.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import olSourceVector from 'ol/source/Vector';\nimport * as olformat from 'ol/format';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { FeatureDataSourceOptions } from './feature-datasource.interface';\n\nexport class FeatureDataSource extends DataSource {\n  public options: FeatureDataSourceOptions;\n  public ol: olSourceVector<OlGeometry>;\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const sourceOptions = {\n      format: this.getSourceFormatFromOptions(this.options)\n    };\n\n    return new olSourceVector(Object.assign(sourceOptions, this.options));\n  }\n\n  protected getSourceFormatFromOptions(options: FeatureDataSourceOptions) {\n    if (options.format) {\n      return options.format;\n    }\n    let olFormatCls;\n    const formatType = options.formatType;\n    if (!formatType) {\n      olFormatCls = olformat.GeoJSON;\n    } else {\n      olFormatCls = olformat[formatType];\n      if (olFormatCls === undefined) {\n        throw new Error('Invalid vector source format ${formatType}.');\n      }\n    }\n\n    const formatOptions = options.formatOptions;\n    let format;\n    if (formatOptions) {\n      format = new olFormatCls(formatOptions);\n    } else {\n      format = new olFormatCls();\n    }\n\n    return format;\n  }\n\n  public onUnwatch() {}\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n}\n","import olSourceCluster from 'ol/source/Cluster';\n\nimport { uuid } from '@igo2/utils';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { ClusterDataSourceOptions } from './cluster-datasource.interface';\n\nexport class ClusterDataSource extends FeatureDataSource {\n  public options: ClusterDataSourceOptions;\n  public ol: olSourceCluster;\n\n  protected createOlSource(): olSourceCluster {\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    this.options.source = super.createOlSource();\n    return new olSourceCluster(this.options);\n  }\n\n  protected generateId() {\n    return uuid();\n  }\n\n  public onUnwatch() {}\n}\n","import { uuid, Watcher, SubjectStatus } from '@igo2/utils';\n\nimport { VectorLayer } from '../shared/layers/vector-layer';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\n\nexport class VectorWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private layer: VectorLayer;\n\n  constructor(layer: VectorLayer) {\n    super();\n    this.layer = layer;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n     }\n\n    if (olSource.getUrl()) {\n      olSource.on(`featuresloadstart`, e => this.handleLoadStart(e));\n      olSource.on(`featuresloadend`, e => this.handleLoadEnd(e));\n      olSource.on(`featuresloaderror`, e => this.handleLoadEnd(e));\n    }\n\n  }\n\n  protected unwatch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n     }\n    if (olSource.getUrl()) {\n      olSource.un(`featuresloadstart`, e => this.handleLoadStart(e));\n      olSource.un(`featuresloadend`, e => this.handleLoadEnd(e));\n      olSource.un(`featuresloaderror`, e => this.handleLoadEnd(e));\n    }\n  }\n\n  private handleLoadStart(event: any) {\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event: any) {\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import * as olproj from 'ol/proj';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { MAC } from 'ol/has';\n\nimport { NumberUtils } from '@igo2/utils';\n\nimport { MapViewState } from './map.interface';\nimport { Projection } from './projection.interfaces';\n\n/**\n * This method extracts a coordinate tuple from a string.\n * @param str Any string\n * @param mapProjection string Map Projection\n * @param opts.forceNA boolean Force North America Zone\n * @returns object:\n *             lonLat: Coordinate,\n *             message: Message of error,\n *             radius: radius of the confience of coordinate,\n *             conf: confidence of the coordinate}\n */\nexport function stringToLonLat(\n  str: string,\n  mapProjection: string,\n  opts: { forceNA?: boolean } = {}\n): {\n  lonLat: [number, number] | undefined;\n  message: string;\n  radius: number | undefined;\n  conf: number | undefined;\n} {\n  let lonLat: [number, number];\n  let coordStr: string;\n  let negativeLon: string;\n  let degreesLon: string;\n  let minutesLon: string;\n  let secondsLon: string;\n  let directionLon: string;\n  let decimalLon: string;\n  let negativeLat: string;\n  let degreesLat: string;\n  let minutesLat: string;\n  let secondsLat: string;\n  let directionLat: string;\n  let decimalLat: string;\n  let zone: string;\n  let radius: string;\n  let conf: string;\n  let lon: any;\n  let lat: any;\n\n  const projectionPattern = '(\\\\s*;\\\\s*[\\\\d]{4,6})';\n  const toProjection = '4326';\n  let projectionStr: string;\n  const projectionRegex = new RegExp(projectionPattern, 'g');\n\n  const lonlatCoord = '([-+])?([\\\\d]{1,3})([,.](\\\\d+))?';\n  const lonLatPattern = `${lonlatCoord}[\\\\s,]+${lonlatCoord}`;\n  const lonLatRegex = new RegExp(`^${lonLatPattern}$`, 'g');\n\n  const dmsCoord =\n    '([0-9]{1,2})[:|]?\\\\s*([0-9]{1,2})?[:|\\'||]?\\\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\\\s*[\"||]?\\\\s*';\n  const dmsCoordPattern = `${dmsCoord}([N|S|E|W|O]),?\\\\s*${dmsCoord}([N|S|E|W|O])`;\n  const dmsRegex = new RegExp(`^${dmsCoordPattern}$`, 'gi');\n\n  const patternUtm =\n    '(UTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const utmRegex = new RegExp(`^${patternUtm}`, 'gi');\n\n  const patternMtm =\n    '(MTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const mtmRegex = new RegExp(`^${patternMtm}`, 'gi');\n\n  const ddCoord = '([-+])?(\\\\d{1,3})[,.](\\\\d+)';\n  const patternDd = `${ddCoord}\\\\s*[,]?\\\\s*${ddCoord}`;\n  const ddRegex = new RegExp(`^${patternDd}`, 'g');\n\n  const dmdCoord =\n    '([-+])?(\\\\d{1,3})[\\\\s,.]{1}(\\\\d{1,2})[\\\\s,.]{1}(\\\\d{1,2})[.,]?(\\\\d{1,5})?';\n  const patternDmd = `${dmdCoord}\\\\s*[,.]?\\\\s*${dmdCoord}`;\n  const dmdRegex = new RegExp(`^${patternDmd}`, 'g');\n\n /* eslint-disable max-len */\n  const patternBELL =\n    'LAT\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,2})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*LONG\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,3})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*UNC\\\\s*[\\\\s:]?\\\\s*(\\\\d+)\\\\s*CONF\\\\s*[\\\\s:]?\\\\s*(\\\\d{1,3})';\n  const bellRegex = new RegExp(`^${patternBELL}?`, 'gi');\n\n  const mmCoord = '([-+]?\\\\d+)[,.]?(\\\\d+)?';\n  const mmPattern = `${mmCoord}[\\\\s,]+${mmCoord}`;\n  const mmRegex = new RegExp(`^${mmPattern}$`, 'g');\n\n  let isXYCoords = false;\n\n  str = str.toLocaleUpperCase().trim();\n\n  // Extract projection\n  if (projectionRegex.test(str)) {\n    [coordStr, projectionStr] = str.split(';').map(s => s.trim());\n  } else {\n    coordStr = str;\n  }\n  if (lonLatRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      lon,\n      ,\n      decimalLon,\n      negativeLat,\n      lat,\n      ,\n      decimalLat\n    ] = coordStr.match(lonLatPattern);\n\n    lon = parseFloat((negativeLon ? negativeLon : '') + lon + '.' + decimalLon);\n    lat = parseFloat((negativeLat ? negativeLat : '') + lat + '.' + decimalLat);\n  } else if (dmsRegex.test(coordStr)) {\n    [\n      ,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      directionLon,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      directionLat\n    ] = coordStr.match(dmsCoordPattern);\n\n    if (directionLon === 'S' || directionLon === 'N') {\n      degreesLon = [degreesLat, (degreesLat = degreesLon)][0];\n      minutesLon = [minutesLat, (minutesLat = minutesLon)][0];\n      secondsLon = [secondsLat, (secondsLat = secondsLon)][0];\n      directionLon = [directionLat, (directionLat = directionLon)][0];\n    }\n\n    lon = convertDMSToDD(\n      parseFloat(degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat(degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (utmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternUtm);\n    const epsgUtm = Number(zone) < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgUtm,\n      'EPSG:4326'\n    );\n  } else if (mtmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternMtm);\n    const epsgMtm =\n      Number(zone) < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + Number(zone)}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgMtm,\n      'EPSG:4326'\n    );\n  } else if (dmdRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      decimalLat\n    ] = coordStr.match(patternDmd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (ddRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      decimalLat\n    ] = coordStr.match(patternDd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (bellRegex.test(coordStr)) {\n    [\n      ,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      ,\n      directionLat,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      ,\n      directionLon,\n      radius,\n      conf\n    ] = coordStr.match(patternBELL);\n\n    // Set default value for North America\n    if (!directionLon) {\n      directionLon = 'W';\n    }\n\n    // Check if real minutes or decimals\n    if (minutesLon && minutesLon.length > 2) {\n      lon = parseFloat(\n        (negativeLon ? negativeLon : '') + degreesLon + '.' + minutesLon\n      );\n    } else {\n      lon = convertDMSToDD(\n        parseFloat(degreesLon),\n        parseFloat(minutesLon),\n        parseFloat(secondsLon),\n        directionLon\n      );\n    }\n\n    if (minutesLat && minutesLat.length > 2) {\n      lat = parseFloat(\n        (negativeLat ? negativeLat : '') + degreesLat + '.' + minutesLat\n      );\n    } else {\n      lat = convertDMSToDD(\n        parseFloat(degreesLat),\n        parseFloat(minutesLat),\n        parseFloat(secondsLat),\n        directionLat\n      );\n    }\n  } else if (mmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, lon, decimalLon, lat, decimalLat] = coordStr.match(mmPattern);\n\n    if (decimalLon) {\n      lon = parseFloat(lon + '.' + decimalLon);\n    }\n\n    if (decimalLat) {\n      lat = parseFloat(lat + '.' + decimalLat);\n    }\n  } else {\n    return {\n      lonLat: undefined,\n      message: '',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n\n  if (opts.forceNA && !isXYCoords) {\n    // Set a negative coordinate for North America zone\n    if (lon > 0 && lat > 0) {\n      if (lon > lat) {\n        lon = -lon;\n      } else {\n        lat = -lat;\n      }\n    }\n\n    // Reverse coordinate to respect lonLat convention\n    if (lon > lat) {\n      lon = [lat, (lat = lon)][0];\n    }\n  }\n\n  lonLat = [Number(lon), Number(lat)] as [number, number];\n\n  // Reproject the coordinate if projection parameter have been set and coord is not 4326\n  if (\n    (projectionStr !== undefined && projectionStr !== toProjection) ||\n    (lonLat[0] > 180 || lonLat[0] < -180) ||\n    (lonLat[1] > 90 || lonLat[1] < -90)\n  ) {\n    const source = projectionStr ? 'EPSG:' + projectionStr : mapProjection;\n    const dest = 'EPSG:' + toProjection;\n\n    try {\n      lonLat = olproj.transform(lonLat, source, dest) as [number, number];\n    } catch (e) {\n      return {\n        lonLat: undefined,\n        message: 'Projection ' + source + ' not supported',\n        radius: undefined,\n        conf: undefined\n      };\n    }\n  }\n  if (Math.abs(lonLat[0]) <= 180 && Math.abs(lonLat[1]) <= 90) {\n    return {\n      lonLat,\n      message: '',\n      radius: radius ? parseInt(radius, 10) : undefined,\n      conf: conf ? parseInt(conf, 10) : undefined\n    };\n  } else {\n    return {\n      lonLat: undefined,\n      message: 'Coordinate out of Longitude/Latitude bounds',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n}\n\n/**\n * Convert degrees minutes seconds to dd\n * @param degrees Degrees\n * @param minutes Minutes\n * @param seconds Seconds\n * @param direction Direction\n */\nfunction convertDMSToDD(\n  degrees: number,\n  minutes: number,\n  seconds: number,\n  direction: string\n) {\n  minutes = minutes || 0;\n  seconds = seconds || 0;\n\n  const neg = degrees < 0;\n  let dd = Math.abs(degrees) + minutes / 60 + seconds / 3600;\n\n  if (neg || direction === 'S' || direction === 'W') {\n    dd = -dd;\n  } // Don't do anything for N or E\n  return dd;\n}\n\n/**\n * Convert dd to degrees minutes seconds\n * @param lonLatDD longitude and latitude in dd\n * @param decimal number of decimals for seconds\n * @returns longitude and latitude in dms\n */\nexport function convertDDToDMS(\n  lonLatDD: [number, number], decimal: number = 3\n): string[] {\n  const lonLatDMS = [];\n\n  lonLatDD.forEach(dd => {\n    const degrees = dd < 0 ? Math.ceil(dd) : Math.floor(dd);\n    const int = dd < 0 ? (degrees - dd) * 60 : (dd - degrees) * 60;\n    const minutes = Math.floor(int);\n    const seconds = ((int - minutes) * 60).toFixed(decimal);\n\n    lonLatDMS.push(`${degrees} ${minutes}' ${seconds}\"`);\n  });\n  return lonLatDMS;\n}\n\n/**\n * Return true of two view states are equal.\n * @param state1 View state\n * @param state2 View state\n * @returns True if the view states are equal\n */\nexport function viewStatesAreEqual(\n  state1: MapViewState,\n  state2: MapViewState\n): boolean {\n  if (state1 === undefined || state2 === undefined) {\n    return false;\n  }\n\n  const tolerance = 1 / 10000;\n  return (\n    state1.zoom === state2.zoom &&\n    Math.trunc(state1.center[0] / tolerance) ===\n      Math.trunc(state2.center[0] / tolerance) &&\n    Math.trunc(state1.center[1] / tolerance) ===\n      Math.trunc(state2.center[1] / tolerance)\n  );\n}\n\n/**\n * Format the scale to a human readable text\n * @param Scale of the map\n * @returns Human readable scale text\n */\nexport function formatScale(scale) {\n  scale = Math.round(scale);\n  if (scale < 10000) {\n    return scale + '';\n  }\n\n  scale = Math.round(scale / 1000);\n  if (scale < 1000) {\n    return scale + 'K';\n  }\n\n  scale = Math.round(scale / 1000);\n  return scale + 'M';\n}\n\n/**\n * Return the resolution from a scale denom\n * @param scale Scale denom\n * @param dpi DPI\n * @returns Resolution\n */\nexport function getResolutionFromScale(\n  scale: number,\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return scale / (inchesPerMeter * dpi);\n}\n\n/**\n * Return the resolution from a scale denom\n * @param Scale denom\n * @returns Resolution\n */\nexport function getScaleFromResolution(\n  resolution: number,\n  unit: string = 'm',\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return resolution * olproj.METERS_PER_UNIT[unit] * inchesPerMeter * dpi;\n}\n\n/**\n * Returns true if the CTRL key is pushed during an Ol MapBrowserPointerEvent\n * @param event OL MapBrowserPointerEvent\n * @returns Whether the CTRL key is pushed\n */\nexport function ctrlKeyDown(event: MapBrowserPointerEvent<any>): boolean {\n  const originalEvent = event.originalEvent;\n  return (\n    !originalEvent.altKey &&\n    (MAC ? originalEvent.metaKey : originalEvent.ctrlKey) &&\n    !originalEvent.shiftKey\n  );\n}\n\nexport function roundCoordTo(coord: [number, number], decimal: number = 3): [number, number] {\n  return [\n    NumberUtils.roundToNDecimal(coord[0], decimal),\n    NumberUtils.roundToNDecimal(coord[1], decimal)] as [number, number];\n}\n\n/**\n * Returns an array of converted coordinates.\n * Conversion is done for every configured projections\n * and for the current UTM zone and MTM zone.\n * @param lonLat [number, number] array of the coordinate to transform.\n * @param projections  Projection[] Array of destination projection.\n * @returns Returns an array of converted coordinates.\n */\nexport function lonLatConversion(\n  lonLat: [number, number],\n  projections: Projection[]\n): {\n  code: string;\n  alias: string;\n  coord: [number, number];\n  igo2CoordFormat: string;\n}[] {\n  const rawCoord3857 = olproj.transform(lonLat, 'EPSG:4326', 'EPSG:3857') as [number, number];\n  const convertedLonLat = [\n    {\n      code: 'EPSG:3857',\n      alias: 'Web Mercator',\n      coord: rawCoord3857,\n      igo2CoordFormat: `${roundCoordTo(rawCoord3857).join(', ')} ; 3857`\n    }\n  ];\n\n  // detect the current utm zone.\n  const utmZone = utmZoneFromLonLat(lonLat);\n  const epsgUtm = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n  const utmName = `UTM-${utmZone}`;\n  const rawCoordUtm = olproj.transform(lonLat, 'EPSG:4326', epsgUtm) as [number, number];\n  convertedLonLat.push({\n    code: epsgUtm,\n    alias: 'UTM',\n    coord: rawCoordUtm,\n    igo2CoordFormat: `${utmName} ${roundCoordTo(rawCoordUtm).join(', ')}`\n  });\n\n  // detect the current mtm zone.\n  const mtmZone = mtmZoneFromLonLat(lonLat);\n  if (mtmZone) {\n    const epsgMtm =\n      mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n    const mtmName = `MTM-${mtmZone}`;\n    const rawCoordMtm = olproj.transform(lonLat, 'EPSG:4326', epsgMtm) as [number, number];\n    convertedLonLat.push({\n      code: epsgMtm,\n      alias: 'MTM',\n      coord: rawCoordMtm,\n      igo2CoordFormat: `${mtmName} ${roundCoordTo(rawCoordMtm).join(', ')}`\n    });\n  }\n\n  projections.forEach(projection => {\n    const rawCoord = olproj.transform(lonLat, 'EPSG:4326', projection.code) as [number, number];\n    const numericEpsgCode = projection.code.split(':')[1];\n    convertedLonLat.push({\n      code: projection.code,\n      alias: projection.alias || projection.code,\n      coord: rawCoord,\n      igo2CoordFormat: `${roundCoordTo(rawCoord).join(\n        ', '\n      )} ; ${numericEpsgCode}`\n    });\n  });\n\n  return convertedLonLat;\n}\n\n/**\n * Detect the current utm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the UTM zone.\n * @returns number The UTM zone.\n */\nexport function utmZoneFromLonLat(lonLat: [number, number]) {\n  return Math.ceil((lonLat[0] + 180) / 6);\n}\n\n/**\n * Detect the current mtm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the MTM zone.\n * @returns number The MTM zone. Undefined if outside of the mtm application zone.\n */\nexport function mtmZoneFromLonLat(lonLat: [number, number]) {\n  const long = lonLat[0];\n  let mtmZone;\n  if (long < -51 && long > -54) {\n    mtmZone = 1;\n  }\n  if (long < -54 && long > -57) {\n    mtmZone = 2;\n  }\n  if (long < -57 && long > -60) {\n    mtmZone = 3;\n  }\n  if (long < -60 && long > -63) {\n    mtmZone = 4;\n  }\n  if (long < -63 && long > -66) {\n    mtmZone = 5;\n  }\n  if (long < -66 && long > -69) {\n    mtmZone = 6;\n  }\n  if (long < -69 && long > -72) {\n    mtmZone = 7;\n  }\n  if (long < -72 && long > -75) {\n    mtmZone = 8;\n  }\n  if (long < -75 && long > -78) {\n    mtmZone = 9;\n  }\n  if (long < -78 && long > -81) {\n    mtmZone = 10;\n  }\n  return mtmZone;\n}\n","import {\n  BehaviorSubject,\n  Observable,\n  Subject,\n  Subscription,\n  combineLatest\n} from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\n\nimport { AuthInterceptor } from '@igo2/auth';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { DataSource, Legend } from '../../../datasource';\nimport { IgoMap } from '../../../map/shared/map';\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\n\nimport { LayerOptions } from './layer.interface';\nimport { LayerSyncWatcher } from '../../utils/layerSync-watcher';\nimport { Message, MessageService } from '@igo2/core';\n\nexport abstract class Layer {\n  public collapsed: boolean;\n  public dataSource: DataSource;\n  public legend: Legend[];\n  public legendCollapsed: boolean = true;\n  public firstLoadComponent: boolean = true;\n  public map: IgoMap;\n  public ol: olLayer<olSource>;\n  public olLoadingProblem: boolean = false;\n  public status$: Subject<SubjectStatus>;\n  public hasBeenVisible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n  private hasBeenVisible$$: Subscription;\n  private resolution$$: Subscription;\n\n  /**\n   * Define if a layer is generated by code OR defined by layer/context user layer.\n   * Useful for filtering layers list in mapOffline.directive or in the sharemap...\n   * return false by default.\n   */\n  get isIgoInternalLayer(): boolean {\n    return this.options.isIgoInternalLayer || false;\n  }\n\n  get id(): string {\n    return this.options.id || this.dataSource.id;\n  }\n\n  get alias(): string {\n    return this.options.alias;\n  }\n\n  get title(): string {\n    return this.options.title;\n  }\n\n  set title(title: string) {\n    this.options.title = title;\n  }\n\n  get zIndex(): number {\n    return this.ol.getZIndex();\n  }\n\n  set zIndex(zIndex: number) {\n    this.ol.setZIndex(zIndex);\n  }\n\n  get baseLayer(): boolean {\n    return this.options.baseLayer;\n  }\n\n  set baseLayer(baseLayer: boolean) {\n    this.options.baseLayer = baseLayer;\n  }\n\n  get opacity(): number {\n    return this.ol.get('opacity');\n  }\n\n  set opacity(opacity: number) {\n    this.ol.setOpacity(opacity);\n  }\n\n  set isInResolutionsRange(value: boolean) {\n    this.isInResolutionsRange$.next(value);\n  }\n  get isInResolutionsRange(): boolean {\n    return this.isInResolutionsRange$.value;\n  }\n  readonly isInResolutionsRange$: BehaviorSubject<\n    boolean\n  > = new BehaviorSubject(false);\n\n  set maxResolution(value: number) {\n    this.ol.setMaxResolution(value || Infinity);\n    this.updateInResolutionsRange();\n  }\n  get maxResolution(): number {\n    return this.ol.getMaxResolution();\n  }\n\n  set minResolution(value: number) {\n    this.ol.setMinResolution(value || 0);\n    this.updateInResolutionsRange();\n  }\n  get minResolution(): number {\n    return this.ol.getMinResolution();\n  }\n\n  set visible(value: boolean) {\n    this.ol.setVisible(value);\n    this.visible$.next(value);\n    if (!this.hasBeenVisible$.value && value){\n      this.hasBeenVisible$.next(value);\n    }\n    if (this.options?.messages && value) {\n      this.options?.messages\n        .filter(m => m.options?.showOnEachLayerVisibility)\n        .map(message =>\n          this.showMessage(message)\n        );\n    }\n  }\n  get visible(): boolean {\n    return this.visible$.value;\n  }\n  readonly visible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  get displayed(): boolean {\n    return this.visible && this.isInResolutionsRange;\n  }\n  readonly displayed$: Observable<boolean> = combineLatest([\n    this.isInResolutionsRange$,\n    this.visible$\n  ]).pipe(map((bunch: [boolean, boolean]) => bunch[0] && bunch[1]));\n\n  get showInLayerList(): boolean {\n    return this.options.showInLayerList !== false;\n  }\n\n  private layerSyncWatcher: LayerSyncWatcher;\n\n  constructor(\n    public options: LayerOptions,\n    protected messageService?: MessageService,\n    protected authInterceptor?: AuthInterceptor\n  ) {\n    this.dataSource = options.source;\n\n    this.ol = this.createOlLayer();\n    if (options.zIndex !== undefined) {\n      this.zIndex = options.zIndex;\n    }\n\n    if (options.baseLayer && options.visible === undefined) {\n      options.visible = false;\n    }\n\n    this.maxResolution = options.maxResolution || getResolutionFromScale(Number(options.maxScaleDenom));\n    this.minResolution = options.minResolution || getResolutionFromScale(Number(options.minScaleDenom));\n\n    this.visible = options.visible === undefined ? true : options.visible;\n    this.opacity = options.opacity === undefined ? 1 : options.opacity;\n\n    if (\n      options.legendOptions &&\n      (options.legendOptions.url || options.legendOptions.html)\n    ) {\n      this.legend = this.dataSource.setLegend(options.legendOptions);\n    }\n\n    this.legendCollapsed = options.legendOptions\n      ? options.legendOptions.collapsed\n        ? options.legendOptions.collapsed\n        : true\n      : true;\n\n    this.ol.set('_layer', this, true);\n  }\n\n  protected abstract createOlLayer(): olLayer<olSource>;\n\n  setMap(igoMap: IgoMap | undefined) {\n    this.map = igoMap;\n\n    this.unobserveResolution();\n    if (igoMap !== undefined) {\n      this.observeResolution();\n      this.layerSyncWatcher = new LayerSyncWatcher(this, this.map);\n      this.layerSyncWatcher.subscribe(() => {});\n      this.hasBeenVisible$$ = this.hasBeenVisible$.subscribe(() => {\n        if (this.options.messages && this.visible) {\n          this.options.messages.map(message => {\n            this.showMessage(message);\n          });\n        }\n      });\n    } else {\n      this.layerSyncWatcher.unsubscribe();\n    }\n  }\n\n  private showMessage(message: Message) {\n    if (!this.messageService) {\n      return;\n    }\n    message.title = message.title;\n    message.text = message.text;\n    this.messageService.message(message as Message);\n  }\n\n  private observeResolution() {\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(() =>\n      this.updateInResolutionsRange()\n    );\n  }\n\n  private unobserveResolution() {\n    if (this.resolution$$ !== undefined) {\n      this.resolution$$.unsubscribe();\n      this.resolution$$ = undefined;\n    }\n  }\n\n  private updateInResolutionsRange() {\n    if (this.map !== undefined) {\n      const resolution = this.map.viewController.getResolution();\n      const minResolution = this.minResolution;\n      const maxResolution = this.maxResolution === undefined ? Infinity : this.maxResolution;\n      this.isInResolutionsRange = resolution >= minResolution && resolution <= maxResolution;\n    } else {\n      this.isInResolutionsRange = false;\n    }\n  }\n}\n","import olLayerVector from 'ol/layer/Vector';\nimport olSourceVector from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { unByKey } from 'ol/Observable';\nimport { easeOut } from 'ol/easing';\nimport { asArray as ColorAsArray } from 'ol/color';\nimport { getVectorContext } from 'ol/render';\nimport FormatType from 'ol/format/FormatType';\nimport olFeature from 'ol/Feature';\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\n\nimport { FeatureDataSource } from '../../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSource } from '../../../datasource/shared/datasources/wfs-datasource';\nimport { ArcGISRestDataSource } from '../../../datasource/shared/datasources/arcgisrest-datasource';\nimport { WebSocketDataSource } from '../../../datasource/shared/datasources/websocket-datasource';\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\n\nimport { VectorWatcher } from '../../utils';\nimport { IgoMap } from '../../../map';\nimport { Layer } from './layer';\nimport { VectorLayerOptions } from './vector-layer.interface';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core';\nimport { WFSDataSourceOptions } from '../../../datasource/shared/datasources/wfs-datasource.interface';\nimport { buildUrl, defaultMaxFeatures } from '../../../datasource/shared/datasources/wms-wfs.utils';\nimport { OgcFilterableDataSourceOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { GeoNetworkService, SimpleGetOptions } from '../../../offline/shared/geo-network.service';\nimport { catchError, concatMap, first } from 'rxjs/operators';\nimport { GeoDBService } from '../../../offline/geoDB/geoDB.service';\nimport { of } from 'rxjs';\nexport class VectorLayer extends Layer {\n  public dataSource:\n    | FeatureDataSource\n    | WFSDataSource\n    | ArcGISRestDataSource\n    | WebSocketDataSource\n    | ClusterDataSource;\n  public options: VectorLayerOptions;\n  public ol: olLayerVector<olSourceVector<OlGeometry>>;\n  private watcher: VectorWatcher;\n  private trackFeatureListenerId;\n\n  get browsable(): boolean {\n    return this.options.browsable !== false;\n  }\n\n  get exportable(): boolean {\n    return this.options.exportable !== false;\n  }\n\n  constructor(\n    options: VectorLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor,\n    private geoNetworkService?: GeoNetworkService,\n    private geoDBService?: GeoDBService\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new VectorWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVector<olSourceVector<OlGeometry>> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVector<OlGeometry>\n    });\n\n    if (this.options.animation) {\n      this.dataSource.ol.on(\n        'addfeature',\n        function(e) {\n          this.flash(e.feature);\n        }.bind(this)\n      );\n    }\n\n    if (this.options.trackFeature) {\n      this.enableTrackFeature(this.options.trackFeature);\n    }\n\n    const vector = new olLayerVector(olOptions);\n    const vectorSource = vector.getSource() as olSourceVector<OlGeometry>;\n    const url = vectorSource.getUrl();\n    if (url) {\n      let loader;\n      const wfsOptions = olOptions.sourceOptions as WFSDataSourceOptions;\n      if (wfsOptions?.type === 'wfs' && (wfsOptions.params || wfsOptions.paramsWFS)) {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customWFSLoader(\n            vectorSource,\n            wfsOptions,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      } else {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customLoader(\n            vectorSource,\n            url,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      }\n      if (loader) {\n        vectorSource.setLoader(loader);\n      }\n    }\n    return vector;\n  }\n\n  protected flash(feature) {\n    const start = new Date().getTime();\n    const listenerKey = this.ol.on('postrender', animate.bind(this));\n\n    function animate(event) {\n      const vectorContext = getVectorContext(event);\n      const frameState = event.frameState;\n      const flashGeom = feature.getGeometry().clone();\n      const elapsed = frameState.time - start;\n      const elapsedRatio = elapsed / this.options.animation.duration;\n      const opacity = easeOut(1 - elapsedRatio);\n      const newColor = ColorAsArray(this.options.animation.color || 'red');\n      newColor[3] = opacity;\n      let style = this.ol\n        .getStyleFunction()\n        .call(this, feature)\n        .find((style2) => {\n          return style2.getImage();\n        });\n      if (!style) {\n        style = this.ol.getStyleFunction().call(this, feature)[0];\n      }\n      const styleClone = style.clone();\n\n      switch (feature.getGeometry().getType()) {\n        case 'Point':\n          if(styleClone.getImage() !== null &&\n            typeof styleClone.getImage().getRadius === 'function'){\n            const radius =\n            easeOut(elapsedRatio) * (styleClone.getImage().getRadius() * 3);\n            styleClone.getImage().setRadius(radius);\n            styleClone.getImage().setOpacity(opacity);\n          }\n\n          break;\n        case 'LineString':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getStroke().setColor(newColor);\n            styleClone\n              .getImage()\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) *\n                  (styleClone.getImage().getStroke().getWidth() * 3)\n              );\n          }\n          if (styleClone.getStroke()) {\n            styleClone.getStroke().setColor(newColor);\n            styleClone\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) * (styleClone.getStroke().getWidth() * 3)\n              );\n          }\n          break;\n        case 'Polygon':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getFill().setColor(newColor);\n          }\n          if (styleClone.getFill()) {\n            styleClone.getFill().setColor(newColor);\n          }\n          break;\n      }\n\n      styleClone.setText('');\n      vectorContext.setStyle(styleClone);\n      vectorContext.drawGeometry(flashGeom);\n\n      if (elapsed > this.options.animation.duration) {\n        unByKey(listenerKey);\n        // remove last geometry\n        // there is a little flash before feature disappear, better solution ?\n        this.map.ol.render();\n        return;\n      }\n      // tell OpenLayers to continue postcompose animation\n      this.map.ol.render();\n    }\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  public onUnwatch() {\n    this.dataSource.onUnwatch();\n    this.stopAnimation();\n  }\n\n  public stopAnimation() {\n    this.dataSource.ol.un(\n      'addfeature',\n      function(e) {\n        if (this.visible) {\n          this.flash(e.feature);\n        }\n      }.bind(this)\n    );\n  }\n\n  public enableTrackFeature(id: string | number) {\n    this.trackFeatureListenerId = this.dataSource.ol.on(\n      'addfeature',\n      this.trackFeature.bind(this, id)\n    );\n  }\n  public centerMapOnFeature(id: string | number) {\n    const feat = this.dataSource.ol.getFeatureById(id);\n    if (feat) {\n      this.map.ol.getView().setCenter(feat.getGeometry().getCoordinates());\n    }\n  }\n\n  public trackFeature(id, feat) {\n    if (feat.feature.getId() === id && this.visible) {\n      this.centerMapOnFeature(id);\n    }\n  }\n\n  public disableTrackFeature(id?: string | number) {\n    unByKey(this.trackFeatureListenerId);\n  }\n\n  /**\n   * Custom loader for a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param options olOptions from source\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param proj the projection to retrieve the data\n   * @param success success callback\n   * @param failure failure callback\n   * @param randomParam random parameter to ensure cache is not causing problems in retrieving new data\n   */\n  public customWFSLoader(\n    vectorSource,\n    options,\n    interceptor,\n    extent,\n    resolution,\n    proj,\n    success,\n    failure,\n    randomParam?: boolean\n  ) {\n    {\n      const paramsWFS = options.paramsWFS;\n      const wfsProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : proj;\n      const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\n      paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\n      const url = buildUrl(\n        options,\n        currentExtent,\n        wfsProj,\n        (options as OgcFilterableDataSourceOptions).ogcFilters,\n        randomParam);\n      let startIndex = 0;\n      if (paramsWFS.version === '2.0.0' && paramsWFS.maxFeatures > defaultMaxFeatures) {\n        const nbOfFeature = 1000;\n        while (startIndex < paramsWFS.maxFeatures) {\n          let alteredUrl = url.replace('count=' + paramsWFS.maxFeatures, 'count=' + nbOfFeature);\n          alteredUrl = alteredUrl.replace('startIndex=0', '0');\n          alteredUrl += '&startIndex=' + startIndex;\n          alteredUrl.replace(/&&/g, '&');\n          this.getFeatures(vectorSource, interceptor, currentExtent, wfsProj, proj, alteredUrl, nbOfFeature, success, failure);\n          startIndex += nbOfFeature;\n        }\n      } else {\n        this.getFeatures(vectorSource, interceptor, currentExtent, wfsProj, proj, url, paramsWFS.maxFeatures, success, failure);\n      }\n    }\n  }\n\n\n  /**\n   * Custom loader to get feature from a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param dataProjection the projection of the retrieved data\n   * @param featureProjection the projection of the created features\n   * @param url the url string to retrieve the data\n   * @param threshold the threshold to manage \"more features\" (TODO)\n   * @param success success callback\n   * @param failure failure callback\n   */\n  private getFeatures(\n    vectorSource: olSourceVector<OlGeometry>,\n    interceptor,\n    extent,\n    dataProjection,\n    featureProjection,\n    url: string,\n    threshold: number,\n    success, failure) {\n\n    const idAssociatedCall = (this.dataSource as WFSDataSource).mostRecentIdCallOGCFilter;\n    const xhr = new XMLHttpRequest();\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', modifiedUrl);\n    if (interceptor) {\n      interceptor.interceptXhr(xhr, modifiedUrl);\n    }\n    const onError = () => {\n      vectorSource.removeLoadedExtent(extent);\n      failure();\n    };\n    xhr.onerror = onError;\n    xhr.onload = () => {\n      if (xhr.status === 200 && xhr.responseText.length > 0) {\n        const features =\n          vectorSource\n            .getFormat()\n            .readFeatures(xhr.responseText, { dataProjection, featureProjection }) as olFeature<OlGeometry>[];\n        // TODO Manage \"More feature\"\n        /*if (features.length === 0 || features.length < threshold ) {\n          console.log('No more data to download at this resolution');\n        }*/\n        // Avoids retrieving an older call that took longer to be process\n        if (idAssociatedCall === (this.dataSource as WFSDataSource).mostRecentIdCallOGCFilter)\n        {\n            vectorSource.addFeatures(features);\n            success(features);\n        }\n        else {\n            success([]);\n        }\n      } else {\n        onError();\n      }\n    };\n    xhr.send();\n  }\n\n  /**\n   * Custom loader for vector layer.\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param url the url string or function to retrieve the data\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param projection the projection to retrieve the data\n   */\n  private customLoader(\n    vectorSource,\n    url,\n    interceptor,\n    extent,\n    resolution,\n    projection,\n    success,\n    failure\n  ) {\n    const xhr = new XMLHttpRequest();\n    let modifiedUrl = url;\n    if (typeof url !== 'function') {\n      const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n      if (alteredUrlWithKeyAuth) {\n        modifiedUrl = alteredUrlWithKeyAuth;\n      }\n    } else {\n      modifiedUrl = url(extent, resolution, projection);\n    }\n\n    if (this.geoNetworkService && typeof url !== 'function') {\n      const format = vectorSource.getFormat();\n      const type = format.getType();\n\n      let responseType = type;\n      const onError = () => {\n        vectorSource.removeLoadedExtent(extent);\n        failure();\n      };\n\n      const options: SimpleGetOptions = { responseType };\n      this.geoNetworkService.geoDBService.get(url).pipe(concatMap(r =>\n        r ? of(r) : this.geoNetworkService.get(modifiedUrl, options)\n          .pipe(\n            first(),\n            catchError((res) => {\n              onError();\n              throw res;\n            })\n          )\n      ))\n      .subscribe((content) => {\n          if (content) {\n            const format = vectorSource.getFormat();\n            const type = format.getType();\n            let source;\n            if (type === FormatType.JSON || type === FormatType.TEXT) {\n              source = content;\n            } else if (type === FormatType.XML) {\n              source = content;\n              if (!source) {\n                source = new DOMParser().parseFromString(\n                  content,\n                  'application/xml'\n                );\n              }\n            } else if (type === FormatType.ARRAY_BUFFER) {\n              source = content;\n            }\n            if (source) {\n              const features = format.readFeatures(source, { extent, featureProjection: projection });\n              vectorSource.addFeatures(features, format.readProjection(source));\n              success(features);\n            } else {\n              onError();\n            }\n          }\n        });\n\n    } else {\n    xhr.open( 'GET', modifiedUrl);\n    const format = vectorSource.getFormat();\n    if (format.getType() === FormatType.ARRAY_BUFFER) {\n      xhr.responseType = 'arraybuffer';\n    }\n    if (interceptor) {\n      interceptor.interceptXhr(xhr, modifiedUrl);\n    }\n\n    const onError = () => {\n      vectorSource.removeLoadedExtent(extent);\n      failure();\n    };\n    xhr.onerror = onError;\n    xhr.onload = () => {\n      // status will be 0 for file:// urls\n      if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\n        const type = format.getType();\n        let source;\n        if (type === FormatType.JSON || type === FormatType.TEXT) {\n          source = xhr.responseText;\n        } else if (type === FormatType.XML) {\n          source = xhr.responseXML;\n          if (!source) {\n            source = new DOMParser().parseFromString(\n              xhr.responseText,\n              'application/xml'\n            );\n          }\n        } else if (type === FormatType.ARRAY_BUFFER) {\n          source = xhr.response;\n        }\n        if (source) {\n          const features = format.readFeatures(source, { extent, featureProjection: projection });\n          vectorSource.addFeatures(features, format.readProjection(source));\n          success(features);\n        } else {\n          onError();\n        }\n      } else {\n        onError();\n      }\n    };\n    xhr.send();\n  }\n  }\n}\n","import olSourceOSM from 'ol/source/OSM';\n\nimport { DataSource } from './datasource';\nimport { OSMDataSourceOptions } from './osm-datasource.interface';\n\nexport class OSMDataSource extends DataSource {\n  public options: OSMDataSourceOptions;\n  public ol: olSourceOSM;\n\n  protected createOlSource(): olSourceOSM {\n    if (!this.options.url) {\n      this.options.url = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';\n    }\n    return new olSourceOSM(this.options);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceXYZ from 'ol/source/XYZ';\n\nimport { DataSource } from './datasource';\nimport { XYZDataSourceOptions } from './xyz-datasource.interface';\n\nexport class XYZDataSource extends DataSource {\n  public options: XYZDataSourceOptions;\n  public ol: olSourceXYZ;\n\n  protected createOlSource(): olSourceXYZ {\n    return new olSourceXYZ(this.options);\n  }\n\n  public onUnwatch() {}\n\n}\n","import olSourceVector from 'ol/source/Vector';\nimport * as OlLoadingStrategy from 'ol/loadingstrategy';\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WFSService } from './wfs.service';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport { OgcFilterableDataSourceOptions, OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\nimport {\n  defaultFieldNameGeometry,\n  checkWfsParams,\n  getFormatFromOptions,\n  buildUrl\n} from './wms-wfs.utils';\nimport { BehaviorSubject } from 'rxjs';\nimport { AuthInterceptor } from '@igo2/auth';\n\nexport class WFSDataSource extends DataSource {\n  public ol: olSourceVector<OlGeometry>;\n  public mostRecentIdCallOGCFilter: number = 0;\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  readonly ogcFilters$: BehaviorSubject<OgcFiltersOptions> = new BehaviorSubject(undefined);\n\n  constructor(\n    public options: WFSDataSourceOptions,\n    protected wfsService: WFSService,\n    private authInterceptor?: AuthInterceptor\n  ) {\n    super(checkWfsParams(options, 'wfs'));\n\n    const ogcFilters = (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n    const fieldNameGeometry = this.options.paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n    const ogcFilterWriter = new OgcFilterWriter();\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters =\n      ogcFilterWriter.defineOgcFiltersDefaultOptions(ogcFilters, fieldNameGeometry);\n    if (\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.enabled &&\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.editable &&\n      (options.sourceFields || []).filter(sf => !sf.values).length > 0\n    ) {\n      this.wfsService.getSourceFieldsFromWFS(this.options);\n    }\n\n    if (ogcFilters?.pushButtons){\n      ogcFilters.pushButtons.selectorType = 'pushButton';\n    }\n    if (ogcFilters?.checkboxes){\n      ogcFilters.checkboxes.selectorType = 'checkbox';\n    }\n    if (ogcFilters?.radioButtons){\n      ogcFilters.radioButtons.selectorType = 'radioButton';\n    }\n    if (ogcFilters?.select){\n      ogcFilters.select.selectorType = 'select';\n    }\n    if (ogcFilters?.autocomplete){\n      ogcFilters.autocomplete.selectorType = 'autocomplete';\n    }\n\n    this.setOgcFilters((this.options as OgcFilterableDataSourceOptions).ogcFilters, true);\n  }\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const vectorSource = new olSourceVector({\n      format: getFormatFromOptions(this.options),\n      url: (extent, resolution, proj: olProjection) => {\n        const paramsWFS = this.options.paramsWFS;\n        const wfsProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : proj;\n        const ogcFilters = (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n        const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\n        paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\n        return buildUrl(this.options, currentExtent, wfsProj, ogcFilters);\n      },\n      strategy: OlLoadingStrategy.bbox\n    });\n    return vectorSource;\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    this.mostRecentIdCallOGCFilter += 1;\n    if (triggerEvent) {\n      this.ogcFilters$.next(this.ogcFilters);\n    }\n  }\n\n  public onUnwatch() { }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { combineLatest, Observable, of } from 'rxjs';\nimport olFeature from 'ol/Feature';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { DataService } from './data.service';\nimport { formatWFSQueryString,\n          gmlRegex,\n          defaultEpsg,\n          defaultMaxFeatures,\n          getFormatFromOptions} from './wms-wfs.utils';\nimport { concatMap } from 'rxjs/operators';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n@Injectable({\n  providedIn: 'root'\n})\nexport class WFSService extends DataService {\n  constructor(private http: HttpClient) {\n    super();\n  }\n\n  getData() {\n    console.log('This is defining a data service.');\n    return 'This is defining a data service.';\n  }\n\n  public getSourceFieldsFromWFS(dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions) {\n    if (!dataSourceOptions.sourceFields || dataSourceOptions.sourceFields.length === 0 ) {\n      dataSourceOptions.sourceFields = [];\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(getfeatureSourceField => {\n        dataSourceOptions.sourceFields = getfeatureSourceField;\n      });\n\n    } else {\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(getfeatureSourceField => {\n        dataSourceOptions.sourceFields.forEach(sourcefield => {\n          if (sourcefield.alias === undefined) {\n            sourcefield.alias = sourcefield.name; // to allow only a list of sourcefield with names\n          }\n          if (sourcefield.values === undefined || sourcefield.values.length === 0) {\n            sourcefield.values = getfeatureSourceField.find(sf => sf.name === sourcefield.name).values;\n          }\n        });\n      });\n    }\n  }\n\n  private wfsGetFeature(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n    nb: number = defaultMaxFeatures,\n    epsgCode: string = defaultEpsg,\n    propertyName?: string,\n    startIndex: number = 0,\n    forceDefaultOutputFormat: boolean = false\n  ): Observable<any> {\n    const queryStringValues = formatWFSQueryString(dataSourceOptions, nb, epsgCode, propertyName, startIndex, forceDefaultOutputFormat );\n    const baseUrl = queryStringValues.find(f => f.name === 'getfeature').value;\n    const outputFormat = dataSourceOptions.paramsWFS.outputFormat;\n    if (forceDefaultOutputFormat || gmlRegex.test(outputFormat) || !outputFormat) {\n      return this.http.get(baseUrl, { responseType: 'text' });\n    } else {\n      return this.http.get(baseUrl);\n    }\n  }\n\n  defineFieldAndValuefromWFS(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\n  ): Observable<any> {\n    return new Observable(d => {\n      const sourceFields = [];\n      let fieldList;\n      let fieldListWoGeom;\n      let fieldListWoGeomStr;\n      let olFormats;\n      let effectiveOlFormats;\n\n      olFormats = getFormatFromOptions(dataSourceOptions);\n      const gmlDataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions = JSON.parse(\n        JSON.stringify(dataSourceOptions)\n      );\n      delete gmlDataSourceOptions.paramsWFS.outputFormat;\n      delete (gmlDataSourceOptions as WFSDataSourceOptions).formatOptions;\n\n      effectiveOlFormats = getFormatFromOptions(gmlDataSourceOptions);\n      let sourceFieldsToRetrieveValues = dataSourceOptions.sourceFields?.filter(f => !f.values).map(f => f.name);\n\n      // Validate if the service manage no outputformat (wfs 1.0.0 and GML is the default return)\n      this.wfsGetFeature(dataSourceOptions, 1, undefined, undefined, 0, true).pipe(\n        concatMap(res => String(res).toLowerCase().includes('exception') ? of(false) : of(true)),\n        concatMap(allowGml => {\n          // If the service return GML (return no exception)\n          return this.wfsGetFeature(dataSourceOptions, 1).pipe(\n            concatMap(firstFeature => {\n              const features = olFormats.readFeatures(firstFeature);\n              fieldList = features[0].getKeys();\n              if (dataSourceOptions.sourceFields || dataSourceOptions.sourceFields.length === 0) {\n                sourceFieldsToRetrieveValues = fieldList;\n              }\n              fieldListWoGeom = fieldList.filter(\n                field =>\n                  sourceFieldsToRetrieveValues.includes(field) &&\n                  field !== features[0].getGeometryName() &&\n                  !field.match(/boundedby/gi)\n              );\n              fieldListWoGeomStr = fieldListWoGeom.join(',');\n              const processingArray = [];\n              let startIndex = 0;\n              // If the service do not allow gml return, dice the call in multiple\n              // calls by increment of chunkSize with the original outputFormat\n              if (\n                !allowGml && dataSourceOptions.paramsWFS.version === '2.0.0' &&\n                dataSourceOptions.paramsWFS.maxFeatures > defaultMaxFeatures) {\n                const chunkSize = 1000;\n                while (startIndex < dataSourceOptions.paramsWFS.maxFeatures) {\n                  processingArray.push(this.wfsGetFeature(\n                    dataSourceOptions,\n                    chunkSize,\n                    dataSourceOptions.paramsWFS.srsName,\n                    fieldListWoGeomStr,\n                    startIndex\n                  ));\n                  startIndex += chunkSize;\n                }\n                effectiveOlFormats = olFormats;\n              } else {\n                processingArray.push(this.wfsGetFeature(\n                  dataSourceOptions,\n                  dataSourceOptions.paramsWFS.maxFeatures || defaultMaxFeatures,\n                  dataSourceOptions.paramsWFS.srsName,\n                  fieldListWoGeomStr,\n                  0, true\n                ));\n              }\n              return combineLatest(processingArray);\n            })\n          );\n        })).subscribe((results) => {\n          let mfeatures: olFeature<OlGeometry>[] = [];\n          results.map((result) => {\n            const loopFeatures = effectiveOlFormats.readFeatures(result);\n            mfeatures = mfeatures.concat(loopFeatures);\n          });\n          this.built_properties_value(mfeatures).forEach(element => {\n            sourceFields.push(element);\n          });\n          d.next(sourceFields);\n          d.complete();\n        });\n    });\n  }\n\n  private built_properties_value(features: olFeature<OlGeometry>[]): string[] {\n    if (features.length === 0) {\n      return [];\n    }\n    const kv = Object.assign({}, features[0].getProperties());\n    delete kv[features[0].getGeometryName()];\n    delete kv.boundedBy;\n    const sourceFields = [];\n    for (const property in kv) {\n      if (kv.hasOwnProperty(property)) {\n        const fieldType =\n          typeof features[0].get(property) === 'object'\n            ? undefined\n            : typeof features[0].get(property);\n        sourceFields.push({\n          name: property,\n          alias: property,\n          type: fieldType,\n          values: [kv[property]]\n        });\n      }\n    }\n    features.every((element) => {\n      const featureProperties = element.getProperties();\n      for (const key in featureProperties) {\n        if (featureProperties.hasOwnProperty(key) && key in kv) {\n          sourceFields.filter(f => f.name === key).forEach(v => {\n            if (v.values.indexOf(featureProperties[key]) === -1) {\n              v.values.push(featureProperties[key]);\n            }\n          });\n        }\n      }\n      return true;\n    });\n    return sourceFields;\n  }\n}\n","import olTileGridWMTS from 'ol/tilegrid/WMTS';\nimport * as olproj from 'ol/proj';\nimport {\n  getTopLeft as extentGetTopLeft,\n  getWidth as extentGetWidth\n} from 'ol/extent.js';\n\nexport function createDefaultTileGrid(epsg?: string): olTileGridWMTS {\n  const projection = epsg ? olproj.get(epsg) : olproj.get('EPSG:3857');\n  const projectionExtent = projection.getExtent();\n  const size = extentGetWidth(projectionExtent) / 256;\n  const resolutions = new Array(20);\n  const matrixIds = new Array(20);\n  for (let z = 0; z < 20; ++z) {\n    resolutions[z] = size / Math.pow(2, z);\n    matrixIds[z] = z;\n  }\n\n  return new olTileGridWMTS({\n    origin: extentGetTopLeft(projectionExtent),\n    resolutions,\n    matrixIds\n  });\n}\n","import { Options } from 'ol/source/WMTS';\nimport olSourceWMTS from 'ol/source/WMTS';\n\nimport { createDefaultTileGrid } from '../../utils/tilegrid';\nimport { DataSource } from './datasource';\nimport { WMTSDataSourceOptions } from './wmts-datasource.interface';\n\nexport class WMTSDataSource extends DataSource {\n  public options: WMTSDataSourceOptions;\n  public ol: olSourceWMTS;\n\n  constructor(options: WMTSDataSourceOptions) {\n    super(options);\n  }\n\n  protected createOlSource(): olSourceWMTS {\n    const sourceOptions = Object.assign(\n      {\n        tileGrid: createDefaultTileGrid(this.options.projection as string)\n      },\n      this.options\n    ) as Options;\n\n    return new olSourceWMTS(sourceOptions);\n  }\n\n  public onUnwatch() {}\n\n}\n","import olSourceCarto from 'ol/source/CartoDB';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { CartoDataSourceOptions } from './carto-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\n\nexport class CartoDataSource extends DataSource {\n  public ol: olSourceCarto;\n  public options: CartoDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceCarto {\n    const crossOrigin = this.options.crossOrigin\n      ? this.options.crossOrigin\n      : 'anonymous';\n    const sourceOptions = Object.assign(\n      {\n        crossOrigin\n      },\n      this.options\n    );\n    return new olSourceCarto(sourceOptions);\n  }\n\n  getLegend(): Legend[] {\n    const legend = super.getLegend();\n    if (legend.length > 0) {\n      return legend;\n    }\n\n    let htmlString = '<table>';\n    if (this.options.config.layers[0].legend !== null) {\n      this.options.config.layers[0].legend.items.forEach(f => {\n        if (f.visible === true) {\n          htmlString +=\n            '<tr><td>' +\n            '<p><font size=\"5\" color=\"' +\n            f.value +\n            '\"> &#9679</font></p></td>' +\n            '<td>' +\n            f.name +\n            '</td></tr>';\n        }\n      });\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    } else {\n      // Try to build the legend from the cartocss options\n      const layerOptions = this.options.config.layers[0].options;\n      // All available cartocss style options\n      const types = [\n        'polygon-fill:',\n        'marker-fill:',\n        'shield-fill:',\n        'building-fill:',\n        'line-color:'\n      ];\n      for (const oneType of types) {\n        if (layerOptions.cartocss.includes(oneType)) {\n          const type = layerOptions.cartocss.split(oneType).pop();\n          const color = type.substr(0, type.indexOf(';'));\n          if (color.includes('ramp')) {\n            const colors = color.split(', (')[1].split(',');\n            const data = color.split(', (')[2].split(',');\n            for (let j = 0; j < colors.length; j++) {\n              colors[j] = colors[j].replace(/(\"|\\))/g, '');\n              data[j] = data[j].replace(/(\"|\\))/g, '');\n              if (data[j].replace(/\\s+/g, '') === '=') {\n                data[j] = 'Autres';\n              }\n              htmlString +=\n                '<tr><td>' +\n                '<p><font size=\"5\" color=\"' +\n                colors[j] +\n                '\"> &#9679</font></p></td>' +\n                '<td>' +\n                data[j] +\n                '</td></tr>';\n            }\n            break;\n          } else {\n            const title = layerOptions.layer_name\n              ? layerOptions.layer_name\n              : '';\n            htmlString +=\n              '<tr><td>' +\n              '<p><font size=\"5\" color=\"' +\n              color +\n              '\"> &#9679</font></p>' +\n              '</td><td>' +\n              title +\n              '</td></tr>';\n            break;\n          }\n        }\n      }\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    }\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceVector from 'ol/source/Vector';\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\nimport * as olloadingstrategy from 'ol/loadingstrategy';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { ArcGISRestDataSourceOptions } from './arcgisrest-datasource.interface';\n\nexport class ArcGISRestDataSource extends DataSource {\n  public ol: olSourceVector<OlGeometry>;\n  public options: ArcGISRestDataSourceOptions;\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const esrijsonFormat = new olFormatEsriJSON();\n    return new olSourceVector({\n      attributions: this.options.params.attributions,\n      overlaps: false,\n      format: esrijsonFormat,\n      url: function(extent, resolution, proj) {\n        const baseUrl = this.options.url + '/' + this.options.layer + '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        if (this.options.params.time) {\n          const time = `time=${this.options.params.time}`;\n          params.push(time);\n        }\n        if (this.options.params.customParams) {\n          this.options.params.customParams.forEach(element => {\n            params.push(element);\n          });\n        }\n        return `${baseUrl}?${params.join('&')}`;\n      }.bind(this),\n      strategy: olloadingstrategy.bbox\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || legend.length > 0) {\n      return legend;\n    }\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n    let src: string;\n    let label: string;\n    let svg: string;\n\n    if (legendInfo.legend) {\n      for (const legendElement of legendInfo.legend) {\n        src = this.htmlImgSrc(legendElement.contentType, legendElement.imageData);\n        label = legendElement.label ? legendElement.label.replace('<Null>', 'Null') : '';\n        htmlString +=\n          `<tr><td align='left'><img src=\"` +\n          src +\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      }\n    } else if (legendInfo.type === \"uniqueValue\") {\n      for (const legendElement of legendInfo.uniqueValueInfos) {\n        label = legendElement.label.replace('<Null>', 'Null');\n        if (legendElement.symbol.type === 'esriPMS') {\n          src = this.htmlImgSrc(legendElement.symbol.contentType, legendElement.symbol.imageData);\n          htmlString +=\n            `<tr><td align='left'><img src=\"` +\n            src +\n            `\" alt ='' /></td><td class=\"mat-typography\">` +\n            label +\n            '</td></tr>';\n        } else if (legendElement.symbol.type !== 'esriPMS') {\n          svg = this.createSVG(legendElement.symbol);\n          htmlString += `<tr><td align='left'>` + svg + `</td><td class=\"mat-typography\">` + label + '</td></tr>';\n        }\n      }\n    } else if (legendInfo.type === \"simple\") {\n      label = legendInfo.label ? legendInfo.label.replace('<Null>', 'Null') : '';\n      if (legendInfo.symbol.type === 'esriPMS') {\n        src = this.htmlImgSrc(legendInfo.symbol.contentType, legendInfo.symbol.imageData);\n        htmlString +=\n          `<tr><td align='left'><img src=\"` +\n          src +\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      } else if (legendInfo.symbol.type !== 'esriPMS') {\n        svg = this.createSVG(legendInfo.symbol);\n        htmlString += `<tr><td align='left'>` + svg + `</td><td class=\"mat-typography\">` + label + '</td></tr>';\n      }\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  htmlImgSrc(contentType: string, imageData: string): string {\n    return `data:${contentType};base64,${imageData}`;\n  }\n\n  createSVG(symbol): string {\n    let svg: string = '';\n\n    const color: Array<number> = symbol.color ? symbol.color : [0, 0, 0, 0];\n\n    if (symbol.type === 'esriSLS') {\n      const width: number = symbol.width ? symbol.width : 0;\n\n      const stroke: string = `stroke:rgba(` + color[0] + ',' + color[1] + ',' + color[2] + ',' + color[3] + ')';\n      const strokeWidth: string = `stroke-width:` + width;\n\n      if (symbol.style === 'esriSLSSolid') {\n        svg = `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` + stroke + ';' + strokeWidth + `\"/></svg>`;\n      } else if (symbol.style === 'esriSLSDash') {\n        const strokeDashArray: string = `stroke-dasharray=\"5,5\"`;\n        svg = `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` + stroke + ';' + strokeWidth + `\" `+ strokeDashArray + `/></svg>`;\n      }\n    } else if (symbol.style === 'esriSMSCircle' || symbol.style === 'esriSFSSolid') {\n      const outlineColor = symbol.outline.color;\n      const outlineWidth = symbol.outline.width;\n      const size = symbol.size;\n\n      const stroke = `stroke:rgba(` + outlineColor[0] + ',' + outlineColor[1] + ',' + outlineColor[2] + ',' + outlineColor[3] + ')';\n      const strokeWidth = `stroke-width:` + outlineWidth;\n      const fill = `fill:rgba(` + color[0] + ',' + color[1] + ',' + color[2] + ',' + color[3] + ')';\n\n      if (symbol.style === 'esriSMSCircle') {\n        svg = `<svg height=\"30\" width=\"30\"><circle cx=\"15\" cy=\"15\" r=\"` + size/2 + `\" style=\"` + stroke + ';' + strokeWidth + ';' + fill + `\"/></svg>`;\n      } else {\n        svg = `<svg height=\"30\" width=\"30\"><rect x=\"5\" y=\"5\" width=\"20\" height=\"20\" style =\"` + stroke + ';' + strokeWidth + ';' + fill + `\"/></svg>`;\n      }\n    }\n    return svg;\n  }\n\n  public onUnwatch() {}\n}\n","import ImageArcGISRest from 'ol/source/ImageArcGISRest';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { ArcGISRestImageDataSourceOptions } from './imagearcgisrest-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nexport class ImageArcGISRestDataSource extends DataSource {\n  public ol: ImageArcGISRest;\n  public options: ArcGISRestImageDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): ImageArcGISRest {\n    const params = this.options.layer === undefined ? this.options.params : Object.assign(\n      {LAYERS: `show:${this.options.layer}`},\n      this.options.params\n    );\n\n    if (typeof params.renderingRule === 'object') {\n      params.renderingRule = JSON.stringify(params.renderingRule);\n    }\n\n    return new ImageArcGISRest({\n      ratio: 1,\n      params,\n      url: this.options.url\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || this.options.layer === undefined || legend.length > 0) {\n      return legend;\n    }\n\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const legendElement of legendInfo.legend) {\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\n      const label = legendElement.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceTileArcGISRest from 'ol/source/TileArcGISRest';\nimport { Options } from 'ol/source/TileArcGISRest';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { TileArcGISRestDataSourceOptions } from './tilearcgisrest-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\n\nexport class TileArcGISRestDataSource extends DataSource {\n  public ol: olSourceTileArcGISRest;\n  public options: TileArcGISRestDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceTileArcGISRest {\n    return new olSourceTileArcGISRest(this.options as Options);\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || this.options.layer === undefined || legend.length > 0) {\n      return legend;\n    }\n\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const legendElement of legendInfo.legend) {\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\n      const label = legendElement.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import TileDebug from 'ol/source/TileDebug';\nimport TileGrid from 'ol/tilegrid/TileGrid';\n\nimport { DataSource } from './datasource';\nimport { TileDebugDataSourceOptions } from './tiledebug-datasource.interface';\n\nexport class TileDebugDataSource extends DataSource {\n  public options: TileDebugDataSourceOptions;\n  public ol: TileDebug;\n\n  protected createOlSource(): TileDebug {\n    const baseOptions = JSON.parse(JSON.stringify(this.options)); // to avoid to alter the original options\n    if (this.options.tileGrid) {\n      delete baseOptions.tileGrid;\n      baseOptions.tileGrid = new TileGrid(this.options.tileGrid);\n    }\n    return new TileDebug(baseOptions);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceVector from 'ol/source/Vector';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { WebSocketDataSourceOptions } from './websocket-datasource.interface';\n\nexport class WebSocketDataSource extends FeatureDataSource {\n  public ws: WebSocket;\n  public options: WebSocketDataSourceOptions;\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    this.createWebSocket();\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    return super.createOlSource();\n  }\n\n  private createWebSocket() {\n    this.ws = new WebSocket(this.options.url);\n    this.ws.onmessage = this.onMessage.bind(this);\n\n    if (this.options.onclose) {\n      this.ws.onclose = this.onClose.bind(this);\n    }\n\n    if (this.options.onerror) {\n      this.ws.onerror = this.onError.bind(this);\n    }\n\n    if (this.options.onopen) {\n      this.ws.onopen = this.onOpen.bind(this);\n    }\n  }\n\n  onMessage(event) {\n    const featureAdded = this.options.format.readFeature(event.data) as olFeature<OlGeometry>;\n\n    switch (this.options.onmessage) {\n      case 'update':\n        // ol don't add if same ID\n        const featureToRemove = this.ol.getFeatureById(featureAdded.getId());\n        if (featureToRemove) {\n          this.ol.removeFeature(featureToRemove);\n        }\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'delete':\n        this.ol.clear(true);\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'add':\n      default:\n        this.ol.addFeature(featureAdded);\n    }\n  }\n\n  onClose(event) {\n    // thrown message to user\n  }\n\n  onError(event) {\n    // thrown message to user\n  }\n\n  onOpen(event) {\n    // thrown message to user ?\n  }\n\n  public onUnwatch() {\n    this.ws.close();\n  }\n}\n","import { Md5 } from 'ts-md5';\nimport feature from 'ol/Feature';\nimport olSourceVectorTile from 'ol/source/VectorTile';\nimport olFormatMVT from 'ol/format/MVT';\n\nimport { uuid } from '@igo2/utils';\n\nimport { DataSource } from './datasource';\nimport { MVTDataSourceOptions } from './mvt-datasource.interface';\n\nexport class MVTDataSource extends DataSource {\n  public options: MVTDataSourceOptions;\n  public ol: olSourceVectorTile;\n\n  protected createOlSource(): olSourceVectorTile {\n    let mvtFormat;\n    if (this.options.featureClass === 'feature') {\n      mvtFormat = new olFormatMVT({featureClass: feature});\n    } else {\n      mvtFormat = new olFormatMVT();\n    }\n    this.options.format = mvtFormat;\n    return new olSourceVectorTile(this.options);\n  }\n\n  protected generateId() {\n    if (!this.options.url) {\n        return uuid();\n    }\n    const chain = 'mvt' + this.options.url;\n    return Md5.hashStr(chain) as string;\n  }\n\n  public onUnwatch() {}\n}\n","import * as olstyle from 'ol/style';\nimport * as olproj from 'ol/proj';\n\nexport class EsriStyleGenerator {\n  public _converters: any;\n  public _renderers: any;\n\n  constructor() {\n    this._converters = {};\n    this._converters.esriPMS = EsriStyleGenerator._convertEsriPMS;\n    this._converters.esriSFS = EsriStyleGenerator._convertEsriSFS;\n    this._converters.esriSLS = EsriStyleGenerator._convertEsriSLS;\n    this._converters.esriSMS = EsriStyleGenerator._convertEsriSMS;\n    this._converters.esriTS = EsriStyleGenerator._convertEsriTS;\n    this._renderers = {};\n    this._renderers.uniqueValue = this._renderUniqueValue;\n    this._renderers.simple = this._renderSimple;\n    this._renderers.classBreaks = this._renderClassBreaks;\n  }\n  static _convertPointToPixel(point) {\n    return point / 0.75;\n  }\n  static _transformColor(color): [number, number, number, number] {\n    // alpha channel is different, runs from 0-255 but in ol3 from 0-1\n    return [color[0], color[1], color[2], color[3] / 255];\n  }\n\n  static _getResolutionForScale(scale, units) {\n    const dpi = 96;\n    const mpu = olproj.METERS_PER_UNIT[units];\n    const inchesPerMeter = 39.3701;\n    return parseFloat(scale) / (mpu * inchesPerMeter * dpi);\n  }\n\n  /* convert an Esri Text Symbol */\n  static _convertEsriTS(symbol) {\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    const text = symbol.text !== undefined ? symbol.text : undefined;\n    return new olstyle.Style({\n      text: new olstyle.Text({\n        fill: new olstyle.Fill({\n          color: EsriStyleGenerator._transformColor(symbol.color)\n        }),\n        font:\n          symbol.font.style +\n          ' ' +\n          symbol.font.weight +\n          ' ' +\n          symbol.font.size +\n          ' px ' +\n          symbol.font.family,\n        textBaseline: symbol.verticalAlignment,\n        textAlign: symbol.horizontalAlignment,\n        offsetX: EsriStyleGenerator._convertPointToPixel(symbol.xoffset),\n        offsetY: EsriStyleGenerator._convertPointToPixel(symbol.yoffset),\n        rotation,\n        text\n      })\n    });\n  }\n  /* convert an Esri Picture Marker Symbol */\n  static _convertEsriPMS(symbol) {\n    const src = 'data:' + symbol.contentType + ';base64, ' + symbol.imageData;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n\n    return new olstyle.Style({\n      image: new olstyle.Icon({\n        src,\n        rotation\n      })\n    });\n  }\n  /* convert an Esri Simple Fill Symbol */\n  static _convertEsriSFS(symbol) {\n    // there is no support in openlayers currently for fill patterns, so style is not interpreted\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    return new olstyle.Style({\n      fill,\n      stroke\n    });\n  }\n  static _convertOutline(outline) {\n    let lineDash;\n    const color = EsriStyleGenerator._transformColor(outline.color);\n    if (outline.style === 'esriSLSDash') {\n      lineDash = [5];\n    } else if (outline.style === 'esriSLSDashDot') {\n      lineDash = [5, 5, 1, 2];\n    } else if (outline.style === 'esriSLSDashDotDot') {\n      lineDash = [5, 5, 1, 2, 1, 2];\n    } else if (outline.style === 'esriSLSDot') {\n      lineDash = [1, 2];\n    } else if (outline.style === 'esriSLSNull') {\n      // line not visible, make color fully transparent\n      color[3] = 0;\n    }\n    return new olstyle.Stroke({\n      color,\n      lineDash,\n      width: EsriStyleGenerator._convertPointToPixel(outline.width)\n    });\n  }\n  /* convert an Esri Simple Line Symbol */\n  static _convertEsriSLS(symbol) {\n    return new olstyle.Style({\n      stroke: EsriStyleGenerator._convertOutline(symbol)\n    });\n  }\n  static _transformAngle(angle) {\n    if (angle === 0 || angle === undefined) {\n      return undefined;\n    }\n    const normalRad = (angle * Math.PI) / 180;\n    const ol3Rad = -normalRad + Math.PI / 2;\n    if (ol3Rad < 0) {\n      return 2 * Math.PI + ol3Rad;\n    } else {\n      return ol3Rad;\n    }\n  }\n  /* convert an Esri Simple Marker Symbol */\n  static _convertEsriSMS(symbol) {\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    const radius = EsriStyleGenerator._convertPointToPixel(symbol.size) / 2;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    if (symbol.style === 'esriSMSCircle') {\n      return new olstyle.Style({\n        image: new olstyle.Circle({\n          radius,\n          fill,\n          stroke\n        })\n      });\n    } else if (symbol.style === 'esriSMSCross') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: 0,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSDiamond') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSSquare') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSX') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSTriangle') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 3,\n          radius,\n          angle: 0,\n          rotation\n        })\n      });\n    }\n  }\n\n  _convertLabelingInfo(labelingInfo, mapUnits) {\n    const styles = [];\n    for (let i = 0, ii = labelingInfo.length; i < ii; ++i) {\n      const labelExpression = labelingInfo[i].labelExpression;\n      // only limited support for label expressions\n      const field = labelExpression.substr(\n        labelExpression.indexOf('[') + 1,\n        labelExpression.indexOf(']') - 1\n      );\n      const symbol = labelingInfo[i].symbol;\n      const maxScale = labelingInfo[i].maxScale;\n      const minScale = labelingInfo[i].minScale;\n      let minResolution = null;\n      if (maxScale !== 0) {\n        minResolution = EsriStyleGenerator._getResolutionForScale(\n          maxScale,\n          mapUnits\n        );\n      }\n      let maxResolution = null;\n      if (minScale !== 0) {\n        maxResolution = EsriStyleGenerator._getResolutionForScale(\n          minScale,\n          mapUnits\n        );\n      }\n      const style = this._converters[symbol.type].call(this, symbol);\n      styles.push(\n        (() => {\n          return function(feature, resolution) {\n            let visible = true;\n            if (this.minResolution !== null && this.maxResolution !== null) {\n              visible =\n                resolution < this.maxResolution &&\n                resolution >= this.minResolution;\n            } else if (this.minResolution !== null) {\n              visible = resolution >= this.minResolution;\n            } else if (this.maxResolution !== null) {\n              visible = resolution < this.maxResolution;\n            }\n            if (visible) {\n              const value = feature.get(this.field);\n              this.style.getText().setText(value);\n              return [this.style];\n            }\n          };\n        })().bind({\n          minResolution,\n          maxResolution,\n          field,\n          style\n        })\n      );\n    }\n    return styles;\n  }\n\n  _renderSimple(renderer) {\n    const style = this._converters[renderer.symbol.type].call(\n      this,\n      renderer.symbol\n    );\n    return (() => {\n      return () => {\n        return [style];\n      };\n    })();\n  }\n  _renderClassBreaks(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    const defaultStyle = this._converters[defaultSymbol.type].call(\n      this,\n      defaultSymbol\n    );\n    const field = renderer.field;\n    const classes = [];\n    for (let i = 0, ii = renderer.classBreakInfos.length; i < ii; ++i) {\n      const classBreakInfo = renderer.classBreakInfos[i];\n      let min;\n      if (\n        classBreakInfo.classMinValue === null ||\n        classBreakInfo.classMinValue === undefined\n      ) {\n        if (i === 0) {\n          min = renderer.minValue;\n        } else {\n          min = renderer.classBreakInfos[i - 1].classMaxValue;\n        }\n      } else {\n        min = classBreakInfo.classMinValue;\n      }\n      const max = classBreakInfo.classMaxValue;\n      const symbol = classBreakInfo.symbol;\n      const style = this._converters[symbol.type].call(this, symbol);\n      classes.push({ min, max, style });\n    }\n    return (() => {\n      return (feature) => {\n        const value = feature.get(field);\n        for (let i = 0, ii = classes.length; i < ii; ++i) {\n          let condition;\n          if (i === 0) {\n            condition = value >= classes[i].min && value <= classes[i].max;\n          } else {\n            condition = value > classes[i].min && value <= classes[i].max;\n          }\n          if (condition) {\n            return [classes[i].style];\n          }\n        }\n        return [defaultStyle];\n      };\n    })();\n  }\n  _renderUniqueValue(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    let defaultStyle = [];\n    if (defaultSymbol) {\n      defaultStyle = [\n        this._converters[defaultSymbol.type].call(this, defaultSymbol)\n      ];\n    }\n    const field = renderer.field1;\n    const infos = renderer.uniqueValueInfos;\n    const me = this;\n    return (() => {\n      const hash = {};\n      for (let i = 0, ii = infos.length; i < ii; ++i) {\n        const info = infos[i];\n        const symbol = info.symbol;\n        hash[info.value] = [me._converters[symbol.type].call(me, symbol)];\n      }\n\n      return (feature) => {\n        const style = hash[feature.get(field)];\n        return style ? style : defaultStyle;\n      };\n    })();\n  }\n  generateStyle(layerInfo, mapUnits) {\n    const drawingInfo = layerInfo.drawingInfo;\n    let styleFunctions = [];\n    const drawingInfoStyle = this._renderers[drawingInfo.renderer.type].call(\n      this,\n      drawingInfo.renderer\n    );\n    if (drawingInfoStyle !== undefined) {\n      styleFunctions.push(drawingInfoStyle);\n    }\n    if (layerInfo.labelingInfo) {\n      const labelingInfoStyleFunctions = this._convertLabelingInfo(\n        layerInfo.labelingInfo,\n        mapUnits\n      );\n      styleFunctions = styleFunctions.concat(labelingInfoStyleFunctions);\n    }\n    if (styleFunctions.length === 1) {\n      return styleFunctions[0];\n    } else {\n      return (() => {\n        return (feature, resolution) => {\n          let styles = [];\n          for (let i = 0, ii = styleFunctions.length; i < ii; ++i) {\n            const result = styleFunctions[i].call(null, feature, resolution);\n            if (result) {\n              styles = styles.concat(result);\n            }\n          }\n          return styles;\n        };\n      })();\n    }\n  }\n}\n","export enum TimeFilterType {\n    DATE = 'date',\n    TIME = 'time',\n    DATETIME = 'datetime',\n    YEAR = 'year',\n}\n\nexport enum TimeFilterStyle {\n    CALENDAR = 'calendar',\n    SLIDER = 'slider',\n}\n","import { Injectable } from '@angular/core';\n\nimport { IgoMap } from './map';\n\n/**\n * MapService\n *\n * This service tracks the IgoMap instance, if any.\n * Currently, only one map instance is supported\n * but support for multiple maps may be added in the future.\n * This will impact other services such as the OverlayService\n * because these maps won't be sharing overlayed features.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapService {\n  private map: IgoMap;\n\n  constructor() {}\n\n  getMap(): IgoMap {\n    return this.map;\n  }\n\n  setMap(map: IgoMap) {\n    this.map = map;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport {\n  HttpClient,\n  HttpParams\n} from '@angular/common/http';\nimport { Observable, forkJoin, of } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { WMSCapabilities, WMTSCapabilities, EsriJSON } from 'ol/format';\nimport { optionsFromCapabilities } from 'ol/source/WMTS.js';\nimport olAttribution from 'ol/control/Attribution';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { MapService } from '../../map/shared/map.service';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\nimport { EsriStyleGenerator } from '../utils/esri-style-generator';\nimport {\n  QueryFormat,\n  QueryFormatMimeType\n} from '../../query/shared/query.enums';\n\nimport {\n  WMTSDataSourceOptions,\n  WMSDataSourceOptions,\n  CartoDataSourceOptions,\n  ArcGISRestDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions\n} from './datasources';\nimport {\n  LegendOptions,\n  ItemStyleOptions\n} from '../../layer/shared/layers/layer.interface';\nimport {\n  TimeFilterType,\n  TimeFilterStyle\n} from '../../filter/shared/time-filter.enum';\nimport * as olproj from 'ol/proj';\n\nexport enum TypeCapabilities {\n  wms = 'wms',\n  wmts = 'wmts',\n  arcgisrest = 'esriJSON',\n  imagearcgisrest = 'esriJSON',\n  tilearcgisrest = 'esriJSON'\n}\n\nexport type TypeCapabilitiesStrings = keyof typeof TypeCapabilities;\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CapabilitiesService {\n  private parsers = {\n    wms: new WMSCapabilities(),\n    wmts: new WMTSCapabilities(),\n    esriJSON: new EsriJSON()\n  };\n\n  constructor(private http: HttpClient, private mapService: MapService) {}\n\n  getWMSOptions(\n    baseOptions: WMSDataSourceOptions\n  ): Observable<WMSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = (baseOptions.params as any).VERSION;\n\n    return this.getCapabilities('wms', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n  }\n\n  getWMTSOptions(\n    baseOptions: WMTSDataSourceOptions\n  ): Observable<WMTSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = baseOptions.version;\n\n    const options = this.getCapabilities('wmts', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMTSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n    return options;\n  }\n\n  getCartoOptions(\n    baseOptions: CartoDataSourceOptions\n  ): Observable<CartoDataSourceOptions> {\n    const baseUrl =\n      'https://' +\n      baseOptions.account +\n      '.carto.com/api/v2/viz/' +\n      baseOptions.mapId +\n      '/viz.json';\n\n    return this.http\n      .jsonp(baseUrl, 'callback')\n      .pipe(\n        map((cartoOptions: any) =>\n          this.parseCartoOptions(baseOptions, cartoOptions)\n        )\n      );\n  }\n\n  getArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const modifiedUrl = baseOptions.url.replace('FeatureServer', 'MapServer');\n    const legendUrl = modifiedUrl + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities('arcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    const legend = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Feature Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseArcgisOptions(baseOptions, res[0], res[1], res[2]);\n      })\n    );\n  }\n\n  getImageArcgisOptions(\n    baseOptions: ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const modifiedUrl = baseOptions.url.replace('FeatureServer', 'MapServer');\n    const legendUrl = modifiedUrl + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities('imagearcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    const legend = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Image Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2]);\n      })\n    );\n  }\n\n  getTileArcgisOptions(\n    baseOptions: TileArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const legendUrl = baseOptions.url + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities('tilearcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    const legendInfo = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Tile Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legendInfo, serviceCapabilities]).pipe(\n      map((res: any) =>\n        this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2])\n      )\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getCapabilities(\n    service: TypeCapabilitiesStrings,\n    baseUrl: string,\n    version?: string\n  ): Observable<any> {\n    const params = new HttpParams({\n      fromObject: {\n        request: 'GetCapabilities',\n        service: service.toUpperCase(),\n        version: version || '1.3.0',\n        _i: 'true'\n      }\n    });\n\n    let request;\n    if (TypeCapabilities[service] === 'esriJSON') {\n      request = this.http.get(baseUrl + '?f=json');\n    } else {\n      request = this.http.get(baseUrl, {\n        params,\n        responseType: 'text'\n      });\n    }\n\n    return request.pipe(\n      map((res) => {\n        if (TypeCapabilities[service] === 'esriJSON') {\n          return res as object;\n        }\n        if (\n          String(res).toLowerCase().includes('serviceexception') &&\n          String(res).toLowerCase().includes('access denied')\n        ) {\n          throw {\n            error: {\n              message: 'Service error getCapabilities: Access is denied'\n            }\n          };\n        } else {\n          return this.parsers[service].read(res);\n        }\n      }),\n      catchError((e) => {\n        if (typeof e.error !== 'undefined') {\n          e.error.caught = true;\n        }\n        throw e;\n      })\n    );\n  }\n\n  private parseWMSOptions(\n    baseOptions: WMSDataSourceOptions,\n    capabilities: any\n  ): WMSDataSourceOptions {\n    const layers = (baseOptions.params as any).LAYERS;\n    const layer = this.findDataSourceInCapabilities(\n      capabilities.Capability.Layer,\n      layers\n    );\n\n    if (!layer) {\n      throw {\n        error: {\n          message: 'Layer not found'\n        }\n      };\n    }\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\n    const abstract = layer.Abstract ? layer.Abstract : undefined;\n    const keywordList = layer.KeywordList ? layer.KeywordList : undefined;\n    let queryable = layer.queryable;\n    const timeFilter = this.getTimeFilter(layer);\n    const timeFilterable = timeFilter && Object.keys(timeFilter).length > 0;\n    const legendOptions = layer.Style ? this.getStyle(layer.Style) : undefined;\n    let isExtentInGeographic = true;\n    if (layer.EX_GeographicBoundingBox) {\n      layer.EX_GeographicBoundingBox.forEach((coord, index) => {\n        if (index < 2 && (coord > 180 || coord < -180)) {\n          isExtentInGeographic = false;\n        }\n        if (index >= 2 && (coord > 90 || coord < -90)) {\n          isExtentInGeographic = false;\n        }\n      });\n    } else {\n      isExtentInGeographic = false;\n    }\n\n    const extent = isExtentInGeographic ?\n        olproj.transformExtent(layer.EX_GeographicBoundingBox, 'EPSG:4326', this.mapService.getMap().projection) :\n        undefined;\n\n    let queryFormat: QueryFormat;\n    const queryFormatMimeTypePriority = [\n      QueryFormatMimeType.GEOJSON,\n      QueryFormatMimeType.GEOJSON2,\n      QueryFormatMimeType.GML3,\n      QueryFormatMimeType.GML2,\n      QueryFormatMimeType.JSON,\n      QueryFormatMimeType.HTML\n    ];\n\n    for (const mimeType of queryFormatMimeTypePriority) {\n      if (\n        capabilities.Capability.Request.GetFeatureInfo.Format.indexOf(\n          mimeType\n        ) !== -1\n      ) {\n        const keyEnum = Object.keys(QueryFormatMimeType).find(\n          (key) => QueryFormatMimeType[key] === mimeType\n        );\n        queryFormat = QueryFormat[keyEnum];\n        break;\n      }\n    }\n    if (!queryFormat) {\n      queryable = false;\n    }\n\n    const options: WMSDataSourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title,\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        extent,\n        metadata: {\n          url: metadata ? metadata.OnlineResource : undefined,\n          extern: metadata ? true : undefined,\n          abstract,\n          keywordList\n        },\n        legendOptions\n      },\n      queryable,\n      queryFormat,\n      timeFilter: timeFilterable ? timeFilter : undefined,\n      timeFilterable: timeFilterable ? true : undefined,\n      minDate: timeFilterable ? timeFilter.min : undefined,\n      maxDate: timeFilterable ? timeFilter.max : undefined,\n      stepDate: timeFilterable ? timeFilter.step : undefined\n    });\n\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseWMTSOptions(\n    baseOptions: WMTSDataSourceOptions,\n    capabilities: any\n  ): WMTSDataSourceOptions {\n    // Put Title source in _layerOptionsFromSource. (For source & catalog in _layerOptionsFromSource, if not already on config)\n    const layer = capabilities.Contents.Layer.find(\n      (el) => el.Identifier === baseOptions.layer\n    );\n\n    const options = optionsFromCapabilities(capabilities, baseOptions);\n\n    const ouputOptions = Object.assign(options, baseOptions);\n    const sourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title\n      }\n    });\n\n    return ObjectUtils.mergeDeep(sourceOptions, ouputOptions);\n  }\n\n  private parseCartoOptions(\n    baseOptions: CartoDataSourceOptions,\n    cartoOptions: any\n  ): CartoDataSourceOptions {\n    const layers = [];\n    const params = cartoOptions.layers[1].options.layer_definition;\n    params.layers.forEach((element) => {\n      layers.push({\n        type: element.type.toLowerCase(),\n        options: element.options,\n        legend: element.legend\n      });\n    });\n    const options = ObjectUtils.removeUndefined({\n      config: {\n        version: params.version,\n        layers\n      }\n    });\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions,\n    arcgisOptions: any,\n    legend: any,\n    serviceCapabilities: any,\n  ): ArcGISRestDataSourceOptions {\n    const title = arcgisOptions.name;\n    let legendInfo: any;\n\n    if (legend.layers) {\n      legendInfo = legend.layers.find(x => x.layerName === title);\n    } else if (arcgisOptions.drawingInfo?.renderer) {\n      legendInfo = arcgisOptions.drawingInfo.renderer;\n    } else {\n      legendInfo = undefined;\n    }\n\n    let style;\n    if (arcgisOptions.drawingInfo) {\n      const styleGenerator = new EsriStyleGenerator();\n      const units = arcgisOptions.units === 'esriMeters' ? 'm' : 'degrees';\n      style = styleGenerator.generateStyle(arcgisOptions, units);\n    }\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        style,\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract: arcgisOptions.description || serviceCapabilities.serviceDescription\n        },\n      },\n      legendInfo,\n      timeFilter,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    options.attributions = attributions;\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseTileOrImageArcgisOptions(\n    baseOptions: TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions,\n    arcgisOptions: any,\n    legend: any,\n    serviceCapabilities: any\n  ): TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions {\n    const title = arcgisOptions.name;\n    const legendInfo = legend.layers ? legend.layers.find(x => x.layerName === title) : undefined;\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract: arcgisOptions.description || serviceCapabilities.serviceDescription\n        },\n      },\n      legendInfo,\n      timeFilter,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    options.attributions = attributions;\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private findDataSourceInCapabilities(layerArray, name): any {\n    if (Array.isArray(layerArray)) {\n      let layer;\n      layerArray.find((value) => {\n        layer = this.findDataSourceInCapabilities(value, name);\n        return layer !== undefined;\n      }, this);\n\n      return layer;\n    } else if (layerArray.Layer) {\n      return this.findDataSourceInCapabilities(layerArray.Layer, name);\n    } else {\n      if (layerArray.Name && layerArray.Name === name) {\n        return layerArray;\n      }\n      return undefined;\n    }\n  }\n\n  getTimeFilter(layer) {\n    let dimension;\n\n    if (layer.Dimension) {\n      const timeFilter: any = {};\n      dimension = layer.Dimension[0];\n\n      if (dimension.values) {\n        const minMaxDim = dimension.values.split('/');\n        timeFilter.min = minMaxDim[0] !== undefined ? minMaxDim[0] : undefined;\n        timeFilter.max = minMaxDim[1] !== undefined ? minMaxDim[1] : undefined;\n        timeFilter.step = minMaxDim[2] !== undefined ? minMaxDim[2] : undefined;\n      }\n\n      if (dimension.default) {\n        timeFilter.value = dimension.default;\n      }\n      return timeFilter;\n    }\n  }\n\n  getStyle(Style): LegendOptions {\n    const styleOptions: ItemStyleOptions[] = Style.map((style) => {\n      return {\n        name: style.Name,\n        title: style.Title\n      };\n    })\n      // Handle repeat the style \"default\" in output  (MapServer or OpenLayer)\n      .filter(\n        (item, index, self) =>\n          self.findIndex((i: ItemStyleOptions) => i.name === item.name) ===\n          index\n      );\n\n    const legendOptions: LegendOptions = {\n      stylesAvailable: styleOptions\n    } as LegendOptions;\n\n    return legendOptions;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport proj4 from 'proj4';\nimport * as olproj from 'ol/proj';\nimport * as olproj4 from 'ol/proj/proj4';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { Projection } from './projection.interfaces';\n\n/**\n * When injected, this service automatically registers and\n * projection defined in the application config. A custom projection\n * needs to be registered to be usable by OL.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ProjectionService {\n\n  constructor(private config: ConfigService) {\n    const projections = this.config.getConfig('projections') || [];\n    projections.forEach((projection: Projection) => {\n      projection.alias = projection.alias ? projection.alias : projection.code;\n      this.registerProjection(projection);\n    });\n\n    // register all utm zones\n    for (let utmZone = 1; utmZone < 61; utmZone++) {\n      const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n      const def = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;\n      const proj: Projection = { code, def, extent : undefined};\n      this.registerProjection(proj);\n    }\n\n    // register all mtm zones\n    for (let mtmZone = 1; mtmZone < 11; mtmZone++) {\n      const code = mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n      let lon0;\n      if (Number(mtmZone) <= 2) {\n        lon0 = -50 - Number(mtmZone) * 3;\n      } else if (Number(mtmZone) >= 12) {\n        lon0 = -81 - (Number(mtmZone) - 12) * 3;\n      } else {\n        lon0 = -49.5 - Number(mtmZone) * 3;\n      }\n      const def = `+proj=tmerc +lat_0=0 +lon_0=${lon0} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"`;\n      const proj: Projection = { code, def, extent : undefined};\n      this.registerProjection(proj);\n    }\n  }\n\n  /**\n   * Define a proj4 projection and register it in OL\n   * @param projection Projection\n   */\n  registerProjection(projection: Projection) {\n    proj4.defs(projection.code, projection.def);\n    olproj4.register(proj4);\n    if (projection.extent) {\n      olproj.get(projection.code).setExtent(projection.extent);\n    }\n  }\n\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { forkJoin, of, Observable, BehaviorSubject } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { CapabilitiesService } from './capabilities.service';\nimport { OptionsService } from './options/options.service';\nimport { WFSService } from './datasources/wfs.service';\nimport {\n  DataSource,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  XYZDataSource,\n  XYZDataSourceOptions,\n  TileDebugDataSource,\n  TileDebugDataSourceOptions,\n  WFSDataSource,\n  WFSDataSourceOptions,\n  WMTSDataSource,\n  WMTSDataSourceOptions,\n  WMSDataSource,\n  WMSDataSourceOptions,\n  CartoDataSource,\n  CartoDataSourceOptions,\n  ArcGISRestDataSource,\n  ArcGISRestDataSourceOptions,\n  ImageArcGISRestDataSource,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSource,\n  TileArcGISRestDataSourceOptions,\n  WebSocketDataSource,\n  AnyDataSourceOptions,\n  MVTDataSource,\n  MVTDataSourceOptions,\n  ClusterDataSource,\n  ClusterDataSourceOptions\n} from './datasources';\nimport { ObjectUtils } from '@igo2/utils';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { ProjectionService } from '../../map/shared/projection.service';\nimport { AuthInterceptor } from '@igo2/auth';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DataSourceService {\n  public datasources$ = new BehaviorSubject<DataSource[]>([]);\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    @Optional() private optionsService: OptionsService,\n    private wfsDataSourceService: WFSService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private projectionService: ProjectionService,\n    private authInterceptor?: AuthInterceptor\n  ) {}\n\n  createAsyncDataSource(context: AnyDataSourceOptions, detailedContextUri?: string): Observable<DataSource> {\n    if (!context.type) {\n      console.error(context);\n      throw new Error('Datasource needs a type');\n    }\n    let dataSource;\n    switch (context.type.toLowerCase()) {\n      case 'osm':\n        dataSource = this.createOSMDataSource(context as OSMDataSourceOptions);\n        break;\n      case 'vector':\n        dataSource = this.createFeatureDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'wfs':\n        dataSource = this.createWFSDataSource(context as WFSDataSourceOptions);\n        break;\n      case 'wms':\n        const wmsContext = context as WMSDataSourceOptions;\n        ObjectUtils.removeDuplicateCaseInsensitive(wmsContext.params);\n        dataSource = this.createWMSDataSource(wmsContext, detailedContextUri);\n        break;\n      case 'wmts':\n        dataSource = this.createWMTSDataSource(\n          context as WMTSDataSourceOptions\n        );\n        break;\n      case 'xyz':\n        dataSource = this.createXYZDataSource(context as XYZDataSourceOptions);\n        break;\n      case 'tiledebug':\n        dataSource = this.createTileDebugDataSource(context as TileDebugDataSource);\n        break;\n      case 'carto':\n        dataSource = this.createCartoDataSource(\n          context as CartoDataSourceOptions\n        );\n        break;\n      case 'arcgisrest':\n        dataSource = this.createArcGISRestDataSource(\n          context as ArcGISRestDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'imagearcgisrest':\n        dataSource = this.createArcGISRestImageDataSource(\n          context as ArcGISRestImageDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'websocket':\n        dataSource = this.createWebSocketDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'mvt':\n        dataSource = this.createMVTDataSource(context as MVTDataSourceOptions);\n        break;\n      case 'tilearcgisrest':\n        dataSource = this.createTileArcGISRestDataSource(\n          context as TileArcGISRestDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'cluster':\n        dataSource = this.createClusterDataSource(\n          context as ClusterDataSourceOptions\n        );\n        break;\n      default:\n        console.error(context);\n        throw new Error('Invalid datasource type');\n    }\n\n    this.datasources$.next(this.datasources$.value.concat([dataSource]));\n\n    return dataSource;\n  }\n\n  private createOSMDataSource(\n    context: OSMDataSourceOptions\n  ): Observable<OSMDataSource> {\n    return new Observable(d => d.next(new OSMDataSource(context)));\n  }\n\n  private createFeatureDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<FeatureDataSource> {\n    return new Observable(d => d.next(new FeatureDataSource(context)));\n  }\n\n  private createWebSocketDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<WebSocketDataSource> {\n    return new Observable(d => d.next(new WebSocketDataSource(context)));\n  }\n\n  private createWFSDataSource(\n    context: WFSDataSourceOptions\n  ): Observable<WFSDataSource> {\n    return new Observable(d =>\n      d.next(new WFSDataSource(context, this.wfsDataSourceService, this.authInterceptor))\n    );\n  }\n\n  private createWMSDataSource(context: WMSDataSourceOptions, detailedContextUri?: string): Observable<any> {\n    const observables = [];\n    if (context.optionsFromCapabilities) {\n      observables.push(\n        this.capabilitiesService.getWMSOptions(context).pipe(\n          catchError(e => {\n            const title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            const message = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailable',\n              { value: context.params.LAYERS }\n            );\n\n            this.messageService.error(message, title);\n            throw e;\n          })\n        )\n      );\n    }\n\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getWMSOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n\n    observables.push(of(context));\n\n    return forkJoin(observables).pipe(\n      map((options: WMSDataSourceOptions[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new WMSDataSource(optionsMerged, this.wfsDataSourceService);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createWMTSDataSource(\n    context: WMTSDataSourceOptions\n  ): Observable<WMTSDataSource> {\n    if (context.optionsFromCapabilities) {\n      return this.capabilitiesService.getWMTSOptions(context).pipe(\n        map((options: WMTSDataSourceOptions) => {\n          return options ? new WMTSDataSource(options) : undefined;\n        }),\n        catchError(() => {\n          const title = this.languageService.translate.instant(\n            'igo.geo.dataSource.unavailableTitle'\n          );\n          const message = this.languageService.translate.instant(\n            'igo.geo.dataSource.unavailable',\n            { value: context.layer }\n          );\n\n          this.messageService.error(message, title);\n          return of(undefined);\n        })\n      );\n    }\n\n    return new Observable(d => d.next(new WMTSDataSource(context)));\n  }\n\n  private createXYZDataSource(\n    context: XYZDataSourceOptions\n  ): Observable<XYZDataSource> {\n    return new Observable(d => d.next(new XYZDataSource(context)));\n  }\n\n  private createTileDebugDataSource(\n    context: TileDebugDataSourceOptions\n  ): Observable<TileDebugDataSource> {\n    return new Observable(d => d.next(new TileDebugDataSource(context)));\n  }\n\n  private createCartoDataSource(\n    context: CartoDataSourceOptions\n  ): Observable<CartoDataSource> {\n    if (context.mapId) {\n      return this.capabilitiesService\n        .getCartoOptions(context)\n        .pipe(\n          map((options: CartoDataSourceOptions) => new CartoDataSource(options))\n        );\n    }\n    return new Observable(d => d.next(new CartoDataSource(context)));\n  }\n\n  private createArcGISRestDataSource(\n    context: ArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestDataSource> {\n    const observables = [];\n    observables.push(this.capabilitiesService.getArcgisOptions(context).pipe(\n      catchError(e => {\n        const title = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        );\n        const message = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailable',\n          { value: context.layer }\n        );\n\n        this.messageService.error(message, title);\n        throw e;\n      })\n    ));\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createArcGISRestImageDataSource(\n    context: ArcGISRestImageDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestImageDataSourceOptions> {\n    const observables = [];\n\n    observables.push(this.capabilitiesService.getImageArcgisOptions(context).pipe(\n      catchError(e => {\n        const title = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        );\n        const message = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailable',\n          { value: context.params.LAYERS }\n        );\n\n        this.messageService.error(message, title);\n        throw e;\n      })\n    ));\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ImageArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ImageArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createTileArcGISRestDataSource(\n    context: TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<TileArcGISRestDataSource> {\n    const observables = [];\n    observables.push(this.capabilitiesService.getImageArcgisOptions(context).pipe(\n      catchError(e => {\n        const title = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        );\n        const message = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailable',\n          { value: context.params.LAYERS }\n        );\n\n        this.messageService.error(message, title);\n        throw e;\n      })\n    ));\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: TileArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new TileArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createMVTDataSource(\n    context: MVTDataSourceOptions\n  ): Observable<MVTDataSource> {\n    return new Observable(d => d.next(new MVTDataSource(context)));\n  }\n\n  private createClusterDataSource(\n    context: ClusterDataSourceOptions\n  ): Observable<ClusterDataSource> {\n    return new Observable(d => d.next(new ClusterDataSource(context)));\n  }\n}\n","import * as olextent from 'ol/extent';\nimport * as olproj from 'ol/proj';\nimport * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport OlGeometryLayout from 'ol/geom/GeometryLayout';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\nimport OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { uuid } from '@igo2/utils';\n\nimport {\n  EntityKey,\n  getEntityId,\n  getEntityTitle,\n  getEntityRevision,\n  getEntityIcon,\n  getEntityProperty\n} from '@igo2/common';\n\nimport { IgoMap } from '../../map';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource';\nimport { FEATURE, FeatureMotion } from './feature.enums';\nimport { Feature, FeatureGeometry } from './feature.interfaces';\nimport { FeatureStore } from './store';\n\n/**\n * Create an Openlayers feature object out of a feature definition.\n * The output object has a reference to the feature id.\n * @param feature Feature definition\n * @param projectionOut Feature object projection\n * @returns OpenLayers feature object\n */\nexport function featureToOl(\n  feature: Feature,\n  projectionOut: string,\n  getId?: (Feature) => EntityKey\n): OlFeature<OlGeometry> {\n  getId = getId ? getId : getEntityId;\n\n  const olFormat = new OlFormatGeoJSON();\n  const olFeature = olFormat.readFeature(feature, {\n    dataProjection: feature.projection,\n    featureProjection: projectionOut\n  });\n\n  olFeature.setId(getId(feature));\n\n  const title = getEntityTitle(feature);\n  if (title !== undefined) {\n    olFeature.set('_title', title, true);\n  }\n\n  if (feature.extent !== undefined) {\n    olFeature.set('_extent', feature.extent, true);\n  }\n\n  if (feature.projection !== undefined) {\n    olFeature.set('_projection', feature.projection, true);\n  }\n\n  const mapTitle = getEntityProperty(feature, 'meta.mapTitle');\n  if (mapTitle !== undefined) {\n    olFeature.set('_mapTitle', mapTitle, true);\n  }\n\n  olFeature.set('_entityRevision', getEntityRevision(feature), true);\n\n  const icon = getEntityIcon(feature);\n  if (icon !== undefined) {\n    olFeature.set('_icon', icon, true);\n  }\n\n  if (feature.meta && feature.meta.style) {\n    olFeature.set('_style', feature.meta.style, true);\n  }\n\n  if (feature.sourceId) {\n    olFeature.set('_sourceId', feature.sourceId, true);\n  }\n\n  return olFeature;\n}\n\nexport function renderFeatureFromOl(\n  olRenderFeature: OlRenderFeature,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let geom;\n  let title;\n  let exclude;\n  let excludeOffline;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    if (olLayer.get('sourceOptions')) {\n      exclude = olLayer.get('sourceOptions').excludeAttribute;\n      excludeOffline = olLayer.get('sourceOptions').excludeAttributeOffline;\n    }\n  } else {\n    title = olRenderFeature.get('_title');\n  }\n\n  const olFormat = new OlFormatGeoJSON();\n  const properties = olRenderFeature.getProperties();\n  const geometryType = olRenderFeature.getType();\n\n  if (geometryType === 'Polygon') {\n    const ends = olRenderFeature.getEnds() as number[];\n    geom = new OlPolygon(\n      olRenderFeature.getFlatCoordinates(),\n      OlGeometryLayout.XY,\n      ends\n    );\n  } else if (geometryType === 'Point') {\n    geom = new OlPoint(olRenderFeature.getFlatCoordinates(), OlGeometryLayout.XY);\n  } else if (geometryType === 'LineString') {\n    geom = new OlLineString(\n      olRenderFeature.getFlatCoordinates(),\n      OlGeometryLayout.XY\n    );\n  }\n\n  const geometry = olFormat.writeGeometryObject(geom, {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  const id = olRenderFeature.getId() ? olRenderFeature.getId() : uuid();\n  const mapTitle = olRenderFeature.get('_mapTitle');\n  const extent = olproj.transformExtent(olRenderFeature.getExtent(), projectionIn, projectionOut) as [number, number, number, number];\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent,\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olRenderFeature\n  };\n}\n/**\n * Create a feature object out of an OL feature\n * The output object has a reference to the feature id.\n * @param olFeature OL Feature\n * @param projectionIn OL feature projection\n * @param olLayer OL Layer\n * @param projectionOut Feature projection\n * @returns Feature\n */\nexport function featureFromOl(\n  olFeature: OlFeature<OlGeometry>,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let title;\n  let exclude;\n  let excludeOffline;\n  let idColumn; // for arcgisrest and tilearcgisrest source\n  const olFormat = new OlFormatGeoJSON();\n\n  const keys = olFeature.getKeys().filter((key: string) => {\n    return !key.startsWith('_') && key !== 'geometry';\n  });\n  const properties = keys.reduce((acc: object, key: string) => {\n    acc[key] = olFeature.get(key);\n    return acc;\n  }, {});\n\n  const geometry = olFormat.writeGeometryObject(olFeature.getGeometry(), {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    const sourceOptions = olLayer.get('sourceOptions');\n    if (sourceOptions) {\n      exclude = sourceOptions.excludeAttribute;\n      excludeOffline = sourceOptions.excludeAttributeOffline;\n      idColumn =\n        sourceOptions.idColumn ||\n        ((sourceOptions.type === 'arcgisrest' || sourceOptions.type === 'tilearcgisrest') ? 'OBJECTID' : undefined );\n    }\n  } else {\n    title = olFeature.get('_title');\n  }\n  const mapTitle = olFeature.get('_mapTitle');\n  const id = olFeature.getId() ? olFeature.getId() : olFeature.get(idColumn) ? olFeature.get(idColumn) : uuid();\n  const newFeature = olFeature.get('_newFeature');\n\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent: olFeature.get('_extent'),\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      revision: olFeature.getRevision(),\n      style: olFeature.get('_style'),\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olFeature\n  };\n}\n\n/**\n * Compute an OL feature extent in it's map projection\n * @param map Map\n * @param olFeature OL feature\n * @returns Extent in the map projection\n */\nexport function computeOlFeatureExtent(\n  map: IgoMap,\n  olFeature: OlFeature<OlGeometry>\n): [number, number, number, number] {\n  let olExtent = olextent.createEmpty();\n\n  const olFeatureExtent = olFeature.get('_extent');\n  const olFeatureProjection = olFeature.get('_projection');\n  if (olFeatureExtent !== undefined && olFeatureProjection !== undefined) {\n    olExtent = olproj.transformExtent(\n      olFeatureExtent,\n      olFeatureProjection,\n      map.projection\n    );\n  } else {\n    const olGeometry = olFeature.getGeometry();\n    if (olGeometry !== null) {\n      olExtent = olGeometry.getExtent();\n    }\n  }\n\n  return olExtent as [number, number, number, number];\n}\n\n/**\n * Compute a multiple OL features extent in their map projection\n * @param map Map\n * @param olFeatures OL features\n * @returns Extent in the map projection\n */\nexport function computeOlFeaturesExtent(\n  map: IgoMap,\n  olFeatures: OlFeature<OlGeometry>[]\n): [number, number, number, number] {\n  const extent = olextent.createEmpty();\n\n  olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const featureExtent = computeOlFeatureExtent(map, olFeature);\n    olextent.extend(extent, featureExtent);\n  });\n\n  return extent as [number, number, number, number];\n}\n\n/**\n * Scale an extent.\n * @param extent Extent\n * @param Scaling factors for top, right, bottom and left directions, in that order\n * @returns Scaled extent\n */\nexport function scaleExtent(\n  extent: [number, number, number, number],\n  scale: [number, number, number, number]\n): [number, number, number, number] {\n  const [width, height] = olextent.getSize(extent);\n  return [\n    scale[3] ? extent[0] - width * scale[3] : extent[0],\n    scale[2] ? extent[1] - height * scale[2] : extent[1],\n    scale[1] ? extent[2] + width * scale[1] : extent[2],\n    scale[0] ? extent[3] + height * scale[0] : extent[3]\n  ];\n}\n\n/**\n * Return true if features are out of view.\n * If features are too close to the edge, they are considered out of view.\n * We define the edge as 5% of the extent size.\n * @param map Map\n * @param featuresExtent The features's extent\n * @returns Return true if features are out of view\n */\nexport function featuresAreOutOfView(\n  map: IgoMap,\n  featuresExtent: [number, number, number, number]\n) {\n  const mapExtent = map.viewController.getExtent();\n  const edgeRatio = 0.05;\n  const scale = [-1, -1, -1, -1].map(x => x * edgeRatio);\n  const viewExtent = scaleExtent(mapExtent, scale as [\n    number,\n    number,\n    number,\n    number\n  ]);\n\n  return !olextent.containsExtent(viewExtent, featuresExtent);\n}\n\n/**\n * Return true if features are too deep into the view. This results\n * in features being too small.\n * Features are considered too small if their extent occupies less than\n * 1% of the map extent.\n * @param map Map\n * @param featuresExtent The features's extent\n * @param areaRatio The features extent to view extent acceptable ratio\n * @returns Return true if features are too deep in the view\n */\nexport function featuresAreTooDeepInView(\n  map: IgoMap,\n  featuresExtent: [number, number, number, number],\n  areaRatio?: number\n) {\n  // An area ratio of 0.004 means that the feature extent's width and height\n  // should be about 1/16 of the map extent's width and height\n  areaRatio = areaRatio ? areaRatio : 0.004;\n  const mapExtent = map.viewController.getExtent();\n  const mapExtentArea = olextent.getArea(mapExtent);\n  const featuresExtentArea = olextent.getArea(featuresExtent);\n\n  if (featuresExtentArea === 0 && map.viewController.getZoom() > 13) {\n    // In case it's a point\n    return false;\n  }\n\n  return featuresExtentArea / mapExtentArea < areaRatio;\n}\n\n/**\n * Fit view to include the features extent.\n * By default, this method will let the features occupy about 50% of the viewport.\n * @param map Map\n * @param olFeatures OL features\n * @param motion To motion to the new map view\n * @param scale If this is defined, the original view will be scaled\n *  by that factor before any logic is applied.\n */\nexport function moveToOlFeatures(\n  map: IgoMap,\n  olFeatures: OlFeature<OlGeometry>[],\n  motion: FeatureMotion = FeatureMotion.Default,\n  scale?: [number, number, number, number],\n  areaRatio?: number\n) {\n  const featuresExtent = computeOlFeaturesExtent(map, olFeatures);\n  let viewExtent = featuresExtent;\n  if (scale !== undefined) {\n    viewExtent = scaleExtent(viewExtent, scale);\n  }\n\n  if (motion === FeatureMotion.Zoom) {\n    map.viewController.zoomToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Move) {\n    map.viewController.moveToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Default) {\n    if (\n      featuresAreOutOfView(map, featuresExtent) ||\n      featuresAreTooDeepInView(map, featuresExtent, areaRatio)\n    ) {\n      map.viewController.zoomToExtent(viewExtent);\n    }\n  }\n}\n\n/**\n * Hide an OL feature\n * @param olFeature OL feature\n */\nexport function hideOlFeature(olFeature: OlFeature<OlGeometry>) {\n  olFeature.setStyle(new olstyle.Style({}));\n}\n\n/**\n * Try to bind a layer to a store if none is bound already.\n * The layer will also be added to the store's map.\n * If no layer is given to that function, a basic one will be created.\n * @param store The store to bind the layer\n * @param layer An optional VectorLayer\n */\nexport function tryBindStoreLayer(store: FeatureStore, layer?: VectorLayer) {\n  if (store.layer !== undefined) {\n    if (store.layer.map === undefined) {\n      store.map.addLayer(store.layer);\n    }\n    return;\n  }\n\n  layer = layer\n    ? layer\n    : new VectorLayer({\n        source: new FeatureDataSource()\n      });\n  store.bindLayer(layer);\n  if (store.layer.map === undefined) {\n    store.map.addLayer(store.layer);\n  }\n}\n\n/**\n * Compute a diff between a source array of Ol features and a target array\n * @param source Source array of OL features\n * @param starget Target array of OL features\n * @returns Features to add and remove\n */\nexport function computeOlFeaturesDiff(\n  source: OlFeature<OlGeometry>[],\n  target: OlFeature<OlGeometry>[]\n): {\n  add: OlFeature<OlGeometry>[];\n  remove: OlFeature<OlGeometry>[];\n} {\n  const olFeaturesMap = new Map();\n  target.forEach((olFeature: OlFeature<OlGeometry>) => {\n    olFeaturesMap.set(olFeature.getId(), olFeature);\n  });\n\n  const olFeaturesToRemove = [];\n  source.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const newOlFeature = olFeaturesMap.get(olFeature.getId());\n    if (newOlFeature === undefined) {\n      olFeaturesToRemove.push(olFeature);\n    } else if (\n      newOlFeature.get('_entityRevision') !== olFeature.get('_entityRevision')\n    ) {\n      olFeaturesToRemove.push(olFeature);\n    } else {\n      olFeaturesMap.delete(newOlFeature.getId());\n    }\n  });\n\n  const olFeaturesToAddIds = Array.from(olFeaturesMap.keys());\n  const olFeaturesToAdd = target.filter((olFeature: OlFeature<OlGeometry>) => {\n    return olFeaturesToAddIds.indexOf(olFeature.getId()) >= 0;\n  });\n\n  return {\n    add: olFeaturesToAdd,\n    remove: olFeaturesToRemove\n  };\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  getEntityId,\n  EntityKey,\n  EntityStore\n} from '@igo2/common';\n\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nimport { FeatureMotion } from './feature.enums';\nimport { Feature, FeatureStoreOptions } from './feature.interfaces';\nimport { computeOlFeaturesDiff, featureFromOl, featureToOl, moveToOlFeatures } from './feature.utils';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * features and the map layer to display them on. Synchronization\n * between the store and the layer is handled by strategies.\n */\nexport class FeatureStore<T extends Feature = Feature> extends EntityStore<T> {\n\n  /**\n   * Vector layer to display the features on\n   */\n  layer: VectorLayer;\n\n  /**\n   * The map the layer is bound to\n   */\n  readonly map: IgoMap;\n\n  /**\n   * The layer's data source\n   */\n  get source(): FeatureDataSource {\n    return this.layer ? this.layer.dataSource as FeatureDataSource : undefined;\n  }\n\n  constructor(entities: T[], options: FeatureStoreOptions) {\n    super(entities, options);\n    this.map = options.map;\n  }\n\n  /**\n   * Bind this store to a vector layer\n   * @param layer Vector layer\n   * @returns Feature store\n   */\n  bindLayer(layer: VectorLayer): FeatureStore {\n    this.layer = layer;\n    return this;\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible. Strategies\n   * make extensive use of that method.\n   * @param features Features\n   * @param motion Optional: The type of motion to perform\n   */\n  setLayerFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number,\n    getId?: (Feature) => EntityKey\n  ) {\n    getId = getId ? getId : getEntityId;\n    this.checkLayer();\n\n    const olFeatures = features\n      .map((feature: Feature) => featureToOl(feature, this.map.projection, getId));\n    this.setLayerOlFeatures(olFeatures, motion, viewScale, areaRatio);\n  }\n\n  /**\n   * Set the store's features from an array of OL features.\n   * @param olFeatures Ol features\n   */\n  setStoreOlFeatures(olFeatures: OlFeature<OlGeometry>[]) {\n    this.checkLayer();\n\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n      return featureFromOl(olFeature, this.layer.map.projection);\n    });\n    this.load(features as T[]);\n  }\n\n  /**\n   * Remove all features from the layer\n   */\n  clearLayer() {\n    this.checkLayer();\n    this.source.ol.clear();\n  }\n\n  /**\n   * Check wether a layer is bound or not and throw an error if not.\n   */\n  private checkLayer() {\n    if (this.layer === undefined) {\n      throw new Error('This FeatureStore is not bound to a layer.');\n    }\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible.\n   * @param features Openlayers feature objects\n   * @param motion Optional: The type of motion to perform\n   */\n  public setLayerOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number\n  ) {\n    const olSource = this.layer.ol.getSource();\n    const diff = computeOlFeaturesDiff(olSource.getFeatures(), olFeatures);\n    if (diff.remove.length > 0) {\n      this.removeOlFeaturesFromLayer(diff.remove);\n    }\n\n    if (diff.add.length > 0) {\n      this.addOlFeaturesToLayer(diff.add);\n    }\n\n    if (diff.add.length > 0) {\n      // If features are added, do a motion toward the newly added features\n      moveToOlFeatures(this.map, diff.add, motion, viewScale, areaRatio);\n    } else if (diff.remove.length > 0) {\n      // Else, do a motion toward all the features\n      moveToOlFeatures(this.map, olFeatures, motion, viewScale, areaRatio);\n    }\n  }\n\n  /**\n   * Add features to the the layer\n   * @param features Openlayers feature objects\n   */\n  private addOlFeaturesToLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n    });\n    this.source.ol.addFeatures(olFeatures);\n  }\n\n  /**\n   * Remove features from the the layer\n   * @param features Openlayers feature objects\n   */\n  private removeOlFeaturesFromLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      this.source.ol.removeFeature(olFeature);\n    });\n  }\n\n}\n","import * as olextent from 'ol/extent';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreInMapExtentStrategyOptions } from '../feature.interfaces';\nimport { Subscription } from 'rxjs';\nimport { skipWhile } from 'rxjs/operators';\n\n/**\n * This strategy maintain the store features updated while the map is moved.\n * The features's state inside the map are tagged inMapExtent = true;\n */\nexport class FeatureStoreInMapExtentStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private states$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapExtentStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$\n      .pipe(skipWhile((empty) => !empty))\n      .subscribe(() => this.updateEntitiesInExtent(store));\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInExtent(store);\n    this.states$$.push(store.layer.map.viewController.state$.subscribe(() => {\n      this.updateEntitiesInExtent(store);\n    }));\n  }\n\n  private updateEntitiesInExtent(store) {\n    if (store?.layer?.map?.viewController) {\n      store.state.updateAll({ inMapExtent: false });\n      const mapExtent = store.layer.map.viewController.getExtent();\n      let entitiesInMapExtent = [];\n      let entitiesWithNoGeom = [];\n      for (const entity of store.entities$.value) {\n        if (entity.ol) {\n          if (olextent.intersects(entity.ol.getGeometry().getExtent(), mapExtent)) {\n            entitiesInMapExtent.push(entity);\n          }\n        } else {\n          entitiesWithNoGeom.push(entity);\n        }\n      }\n      if (entitiesInMapExtent.length > 0) {\n        store.state.updateMany(entitiesInMapExtent, { inMapExtent: true }, false);\n      }\n      if (entitiesWithNoGeom.length > 0) {\n        store.state.updateMany(entitiesWithNoGeom, { inMapExtent: true }, false);\n      }\n    }\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.states$$.map(state => state.unsubscribe());\n    if (this.empty$$) { this.empty$$.unsubscribe(); }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreInMapResolutionStrategyOptions } from '../feature.interfaces';\nimport { Subscription } from 'rxjs';\n\n\n/**\n * This strategy maintain the store features updated while the map is scrolled.\n * The features's state inside the map's resolution are tagged inMapResolution = true;\n */\nexport class FeatureStoreInMapResolutionStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private resolution$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapResolutionStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$\n      .subscribe(() => this.updateEntitiesInResolution(store, store.layer.map.viewController.getResolution()));\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInResolution(store, store.layer.map.viewController.getResolution());\n    this.resolution$$.push(store.layer.map.viewController.resolution$.subscribe((res) => {\n      this.updateEntitiesInResolution(store, res);\n    }));\n  }\n\n  private updateEntitiesInResolution(store, mapResolution: number) {\n    if (mapResolution > store.layer.minResolution && mapResolution < store.layer.maxResolution) {\n      store.state.updateAll({ inMapResolution: true });\n    } else {\n      store.state.updateAll({ inMapResolution: false });\n    }\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.resolution$$.map(state => state.unsubscribe());\n    if (this.empty$$) { this.empty$$.unsubscribe(); }\n  }\n}\n","import { Subscription } from 'rxjs';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureMotion } from '../feature.enums';\nimport { Feature, FeatureStoreLoadingStrategyOptions } from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy loads a store's features into it's layer counterpart.\n * The store -> layer binding is a one-way binding. That means any entity\n * added to the store will be added to the layer but the opposite is false.\n *\n * Important: This strategy observes filtered entities, not raw entities. This\n * is not configurable yet.\n */\nexport class FeatureStoreLoadingStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's features\n   */\n  private stores$$ = new Map<FeatureStore, Subscription>();\n\n  private motion: FeatureMotion;\n\n  constructor(protected options: FeatureStoreLoadingStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for entities changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for entities changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Define the motion to apply on load\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for entities changes in a store.\n   * Important: Never observe a store's sorted entities. It makes no sense\n   * to display sorted entities (instead of unsorted) on a layer and it\n   * would potentially result in a lot of useless computation.\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    const subscription = store.view.all$()\n      .subscribe((features: Feature[]) => this.onFeaturesChange(features, store));\n    this.stores$$.set(store, subscription);\n  }\n\n  /**\n   * Stop watching for entities changes in a store.\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const subscription = this.stores$$.get(store);\n    if (subscription !== undefined) {\n      subscription.unsubscribe();\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for entities changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, Subscription]) => {\n      entries[1].unsubscribe();\n    });\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features into a layer or clear the layer if the array of features is empty.\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onFeaturesChange(features: Feature[], store: FeatureStore) {\n    if (features.length === 0) {\n      store.clearLayer();\n    } else {\n      store.setLayerFeatures(\n        features,\n        this.selectMotion(store),\n        this.options.viewScale,\n        this.options.areaRatio,\n        this.options.getFeatureId\n      );\n    }\n  }\n\n  /**\n   * Selects the best motion\n   * @param store A FeatureStore to apply the motion\n   * @returns The motion selected\n   */\n  private selectMotion(store: FeatureStore) {\n    if (this.motion !== undefined) { return this.motion; }\n\n    if (store.pristine === true) {\n      // If features have just been loaded into the store, move/zoom on them\n      return FeatureMotion.Default;\n    } else if (store.count > store.view.count) {\n      // If features have been filtered, move/zoom on the remaining ones\n      return FeatureMotion.Default;\n    } else {\n      // On insert, update or delete, do nothing\n      return FeatureMotion.None;\n    }\n  }\n}\n","import OlEvent from 'ol/events/Event';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreLoadingLayerStrategyOptions } from '../feature.interfaces';\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\n\n/**\n * This strategy loads a layer's features into it's store counterpart.\n * The layer -> store binding is a one-way binding. That means any OL feature\n * added to the layer will be added to the store but the opposite is false.\n *\n * Important: In it's current state, this strategy is to meant to be combined\n * with a standard Loading strategy and it would probably cause recursion issues.\n */\nexport class FeatureStoreLoadingLayerStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n\n  constructor(protected options: FeatureStoreLoadingLayerStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.onSourceChanges(store);\n    const olSource = store.layer.ol.getSource();\n    olSource.on('change', (event: OlEvent) => {\n      this.onSourceChanges(store);\n    });\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, string]) => {\n    });\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features from an OL source into a  store or clear the store if the source is empty\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onSourceChanges(store: FeatureStore) {\n    let olFeatures = store.layer.ol.getSource().getFeatures();\n\n    if (store.layer.dataSource instanceof ClusterDataSource) {\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\n        cluster.get('features')\n      );\n    }\n    if (olFeatures.length === 0) {\n      store.clear();\n    } else {\n      store.setStoreOlFeatures(olFeatures);\n    }\n  }\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlDragBoxInteraction, { DragBoxEvent } from 'ol/interaction/DragBox';\nimport { DragBoxEvent as OlDragBoxEvent } from 'ol/interaction/DragBox';\nimport { EventsKey } from 'ol/events';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\n\nimport { Subscription, combineLatest } from 'rxjs';\nimport { map, debounceTime, skip } from 'rxjs/operators';\n\nimport { EntityKey, EntityRecord, EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureDataSource } from '../../../datasource';\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../../map/shared/map';\nimport { ctrlKeyDown } from '../../../map/shared/map.utils';\n\nimport {\n  Feature,\n  FeatureStoreSelectionStrategyOptions\n} from '../feature.interfaces';\nimport { FeatureStore } from '../store';\nimport { FeatureMotion } from '../feature.enums';\n\nexport class OlDragSelectInteraction extends OlDragBoxInteraction {\n  constructor(options) {\n    super(options);\n  }\n}\n\n/**\n * This strategy synchronizes a store and a layer selected entities.\n * The store <-> layer binding is a two-way binding.\n *\n * In many cases, a single strategy bound to multiple stores\n * will yield better results that multiple strategies with each their\n * own store. In the latter scenario, a click on overlapping features\n * would trigger the strategy of each layer and they would cancel\n * each other as well as move the map view around needlessly.\n */\nexport class FeatureStoreSelectionStrategy extends EntityStoreStrategy {\n  /**\n   * Listener to the map click event that allows selecting a feature\n   * by clicking on the map\n   */\n  private mapClickListener;\n\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Subscription to all stores selected entities\n   */\n  private stores$$: Subscription;\n\n  private motion: FeatureMotion;\n\n  /**\n   * The map the layers belong to\n   */\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  /**\n   * A feature store that'll contain the selected features. It has it's own\n   * layer, shared by all the stores this staretgy is bound to.\n   */\n  get overlayStore(): FeatureStore {\n    return this._overlayStore;\n  }\n  private _overlayStore: FeatureStore;\n\n  constructor(protected options: FeatureStoreSelectionStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n    this._overlayStore = this.createOverlayStore();\n  }\n\n  /**\n   * Bind this strategy to a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Define the motion to apply on select\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Unselect all entities, from all stores\n   */\n  unselectAll() {\n    this.stores.forEach((store: FeatureStore) => {\n      store.state.updateAll({ selected: false });\n    });\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.overlayStore.source.ol.clear();\n    this.overlayStore.clear();\n  }\n\n  /**\n   * Deactivate the selection without removing the selection\n   * overlay.\n   */\n  deactivateSelection() {\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n    this.unwatchAll();\n  }\n\n  /**\n   * Add the overlay layer, setup the map click lsitener and\n   * start watching for stores selection\n   * @internal\n   */\n  protected doActivate() {\n    this.addOverlayLayer();\n    this.listenToMapClick();\n    if (this.options.dragBox === true) {\n      this.addDragBoxInteraction();\n    }\n    this.watchAll();\n  }\n\n  /**\n   * Remove the overlay layer, remove the map click lsitener and\n   * stop watching for stores selection\n   * @internal\n   */\n  protected doDeactivate() {\n    this.deactivateSelection();\n    this.removeOverlayLayer();\n  }\n\n  /**\n   * Create a single observable of all the stores. With a single observable,\n   * features can be added all at once to the overlay layer and a single\n   * motion can be performed. Multiple observable would have\n   * a cancelling effect on each other.\n   */\n  private watchAll() {\n    this.unwatchAll();\n\n    const stores$ = this.stores.map((store: FeatureStore) => {\n      return store.stateView\n        .manyBy$((record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        })\n        .pipe(\n          map((records: EntityRecord<Feature>[]) =>\n            records.map((record) => record.entity)\n          )\n        );\n    });\n    this.stores$$ = combineLatest(stores$)\n      .pipe(\n        debounceTime(5),\n        skip(1), // Skip intial selection\n        map((features: Array<Feature[]>) =>\n          features.reduce((a, b) => a.concat(b))\n        )\n      )\n      .subscribe((features: Feature[]) => this.onSelectFromStore(features));\n  }\n\n  /**\n   * Stop watching for selection in all stores.\n   */\n  private unwatchAll() {\n    if (this.stores$$ !== undefined) {\n      this.stores$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a 'singleclick' listener to the map that'll allow selecting\n   * features by clicking on the map. The selection will be performed\n   * only on the layers bound to this strategy.\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => {\n        this.onMapClick(event);\n      }\n    );\n  }\n\n  /**\n   * Remove the map click listener\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n  }\n\n  /**\n   * On map click, select feature at pixel\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onMapClick(event: MapBrowserPointerEvent<any>) {\n    const exclusive = !ctrlKeyDown(event);\n    const reverse = !exclusive;\n    const olFeatures = event.map.getFeaturesAtPixel(event.pixel, {\n      hitTolerance: this.options.hitTolerance || 0,\n      layerFilter: olLayer => {\n        const storeOlLayer = this.stores.find((store: FeatureStore) => {\n          return store.layer.ol === olLayer;\n        });\n        return storeOlLayer !== undefined;\n      }\n    }) as OlFeature<OlGeometry>[];\n    this.onSelectFromMap(olFeatures, exclusive, reverse);\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteraction;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteraction = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteraction === undefined) {\n      olDragSelectInteraction = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteraction);\n      this.olDragSelectInteraction = olDragSelectInteraction;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteraction.on(\n      'boxend',\n      (event: DragBoxEvent) => this.onDragBoxEnd(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n\n  /**\n   * On dragbox end, select features in drag box\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onDragBoxEnd(event: OlDragBoxEvent) {\n    const exclusive = !ctrlKeyDown(event.mapBrowserEvent);\n    const target = event.target as any;\n    const extent = target.getGeometry().getExtent();\n    const olFeatures = this.stores.reduce(\n      (acc: OlFeature<OlGeometry>[], store: FeatureStore) => {\n        const olSource = store.layer.ol.getSource();\n        acc.push(...olSource.getFeaturesInExtent(extent));\n        return acc;\n      },\n      []\n    );\n    this.onSelectFromMap(olFeatures, exclusive, false);\n  }\n\n  /**\n   * When features are selected from the store, add\n   * them to this startegy's overlay layer (select on map)\n   * @param features Store features\n   */\n  private onSelectFromStore(features: Feature[]) {\n    const motion = this.motion;\n    const olOverlayFeatures = this.overlayStore.layer.ol\n      .getSource()\n      .getFeatures();\n    const overlayFeaturesKeys = olOverlayFeatures.map((olFeature: OlFeature<OlGeometry>) =>\n      olFeature.getId()\n    );\n    const featuresKeys = features.map(this.overlayStore.getKey);\n\n    let doMotion;\n    if (features.length === 0) {\n      doMotion = false;\n    } else {\n      doMotion =\n        overlayFeaturesKeys.length !== featuresKeys.length ||\n        !overlayFeaturesKeys.every(\n          (key: EntityKey) => featuresKeys.indexOf(key) >= 0\n        );\n    }\n\n    this.overlayStore.setLayerFeatures(\n      features,\n      doMotion ? motion : FeatureMotion.None,\n      this.options.viewScale,\n      this.options.areaRatio,\n      this.options.getFeatureId\n    );\n  }\n\n  /**\n   * When features are selected from the map, also select them\n   * in their store.\n   * @param olFeatures OL feature objects\n   */\n  private onSelectFromMap(\n    olFeatures: OlFeature<OlGeometry>[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    const groupedFeatures = this.groupFeaturesByStore(olFeatures);\n\n    this.stores.forEach((store: FeatureStore) => {\n      const features = groupedFeatures.get(store);\n      if (features === undefined && exclusive === true) {\n        this.unselectAllFeaturesFromStore(store);\n      } else if (features === undefined && exclusive === false) {\n        // Do nothing\n      } else {\n        this.selectFeaturesFromStore(store, features, exclusive, reverse);\n      }\n    });\n  }\n\n  /**\n   * Select features in store\n   * @param store: Feature store\n   * @param features Features\n   */\n  private selectFeaturesFromStore(\n    store: FeatureStore,\n    features: Feature[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    if (reverse === true) {\n      store.state.reverseMany(features, ['selected']);\n    } else {\n      store.state.updateMany(features, { selected: true }, exclusive);\n    }\n  }\n\n  /**\n   * Unselect all features from store\n   * @param store: Feature store\n   */\n  private unselectAllFeaturesFromStore(store: FeatureStore) {\n    store.state.updateAll({ selected: false });\n  }\n\n  /**\n   * This method returns a store -> features mapping from a list\n   * of OL selected features. OL features keep a reference to the store\n   * they are from.\n   * @param olFeatures: OL feature objects\n   * @returns Store -> features mapping\n   */\n  private groupFeaturesByStore(\n    olFeatures: OlFeature<OlGeometry>[]\n  ): Map<FeatureStore, Feature[]> {\n    const groupedFeatures = new Map<FeatureStore, Feature[]>();\n    if (olFeatures === null || olFeatures === undefined) {\n      return groupedFeatures;\n    }\n\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      const store = olFeature.get('_featureStore');\n      if (store === undefined) {\n        return;\n      }\n\n      let features = groupedFeatures.get(store);\n      if (features === undefined) {\n        features = [];\n        groupedFeatures.set(store, features);\n      }\n\n      const feature = store.get(olFeature.getId());\n      if (feature !== undefined) {\n        features.push(feature);\n      }\n    });\n\n    return groupedFeatures;\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay store\n   */\n  private createOverlayStore(): FeatureStore {\n    const overlayLayer = this.options.layer\n      ? this.options.layer\n      : this.createOverlayLayer();\n    return new FeatureStore([], { map: this.map }).bindLayer(overlayLayer);\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay layer\n   */\n  private createOverlayLayer(): VectorLayer {\n    return new VectorLayer({\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      style: undefined,\n      showInLayerList: false,\n      exportable: false,\n      browsable: false\n    });\n  }\n\n  /**\n   * Add the overlay store's layer to the map to display the selected\n   * features.\n   */\n  private addOverlayLayer() {\n    if (this.overlayStore.layer.map === undefined) {\n      this.map.addLayer(this.overlayStore.layer);\n    }\n  }\n\n  /**\n   * Remove the overlay layer from the map\n   */\n  private removeOverlayLayer() {\n    this.overlayStore.source.ol.clear();\n    this.map.removeLayer(this.overlayStore.layer);\n  }\n}\n","import { FeatureStore } from './store';\nimport { FeatureStoreSelectionStrategy } from './strategies/selection';\nimport { FeatureStoreLoadingStrategy } from './strategies/loading';\n\n/**\n * Try to add a loading strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the loading strategy\n * @param strategy An optional loading strategy\n */\nexport function tryAddLoadingStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreLoadingStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreLoadingStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreLoadingStrategy);\n    return;\n  }\n\n  strategy = strategy ? strategy : new FeatureStoreLoadingStrategy({});\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n\n/**\n * Try to add a selection strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the selection strategy\n * @param [strategy] An optional selection strategy\n */\nexport function tryAddSelectionStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreSelectionStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreSelectionStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n    return;\n  }\n  strategy = strategy\n    ? strategy\n    : new FeatureStoreSelectionStrategy({\n        map: store.map\n      });\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n","import * as olstyle from 'ol/style';\nimport { asArray as ColorAsArray } from 'ol/color';\n\n/**\n * Create a marker style for points\n * @returns Style\n */\nexport function createOverlayMarkerStyle({\n  text,\n  opacity = 1,\n  markerColor = [0, 161, 222],\n  markerOutlineColor = [255, 255, 255]\n}: {\n  text?: string;\n  opacity?: number;\n  markerColor?: string | number[];\n  markerOutlineColor?: string | number[];\n} = {}): olstyle.Style {\n  let iconColor;\n  let svgIconColor;\n  let svgOutlineColor;\n  let svg;\n\n  const isIE = /msie\\s|trident\\/|edge\\//i.test(window.navigator.userAgent); // To fix IE11 svg bug (temporarly)\n\n  const newColor = ColorAsArray(markerColor).slice(0);\n  const newOutlineColor = ColorAsArray(markerOutlineColor).slice(0);\n\n  if (newColor.length === 4 && (typeof markerColor !== 'string' || /^#[0-9A-F]{8}$/i.test(markerColor as string))) {\n    opacity = newColor[3];\n  }\n\n  svgIconColor = `\"rgba(${newColor[0]},${newColor[1]},${newColor[2]},${opacity})\"`;\n  iconColor = markerColor;\n\n  svgOutlineColor = `\"rgb(${newOutlineColor[0]},${newOutlineColor[1]},${newOutlineColor[2]})\"`;\n\n  svg =\n    'data:image/svg+xml;utf8,<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" height=\"36\" width=\"36\" viewBox=\"0 0 36 36\">' +\n    '<path fill=' +\n    svgIconColor +\n    ' stroke=' +\n    svgOutlineColor +\n    ` stroke-width=\"2\" d=\"M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z\"></path>` +\n    '</svg>';\n\n  let src;\n  if (isIE) {\n    switch (markerColor) {\n      case 'blue' || [0, 161, 222] || '#00a1de':\n        iconColor = 'blue';\n        break;\n      case 'red' || '#f64139':\n        iconColor = 'red';\n        break;\n      case 'yellow' || '#ffd700':\n        iconColor = 'yellow';\n        break;\n      case 'green' || '#008000':\n        iconColor = 'green';\n        break;\n      default:\n        iconColor = 'blue';\n        break;\n    }\n    src = './assets/igo2/geo/icons/place_' + iconColor + '_36px.svg';\n  } else {\n    src = svg;\n  }\n\n  return new olstyle.Style({\n    image: new olstyle.Icon({\n      src: svg,\n      opacity,\n      imgSize: [36, 36], // for ie\n      anchor: [0.5, 0.92]\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import { Injectable } from '@angular/core';\n\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport { StyleByAttribute } from './vector-style.interface';\n\nimport { ClusterParam } from './clusterParam';\nimport { createOverlayMarkerStyle } from '../../overlay/shared/overlay-marker-style.utils';\nimport RenderFeature from 'ol/render/Feature';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleService {\n  public style: olstyle.Style;\n\n  /**\n   * Create a style based on a object as\n   * style: {\n   *       \"stroke\": {\n   *         \"color\": \"blue\",\n   *         \"lineDash\": [10, 5]\n   *       },\n   *       \"text\": {\n   *         \"minScaleDenom\": 50000,\n   *         \"maxScaleDenom\": 200000,\n   *         \"minResolution\": 100,\n   *         \"maxResolution\": 400,\n   *         \"attribute\": \"THE COLUMN NAME TO RETRIEVE THE LABEL VALUE\",\n   *         \"text\": \"MY HARCODED TEXT\",\n   *         \"stroke\": {\n   *           \"color\": \"blue\",\n   *           \"width\": 0.75\n   *         },\n   *         \"fill\": {\n   *           \"color\": \"black\"\n   *         },\n   *         \"font\": \"20px sans-serif\",\n   *         \"overflow\": true,\n   *         \"offsetX\": 10,\n   *         \"offsetY\": 20,\n   *         \"padding\": [2.5, 2.5, 2.5, 2.5]\n   *       },\n   *       \"width\": 5\n   *     }\n   *\n   * @param options\n   * @param feature feature to apply style on\n   * @param resolution current map resolution, to control label resolution range\n   * @returns\n   */\n  createStyle(options: { [key: string]: any }, feature?: RenderFeature | OlFeature<OlGeometry>, resolution?: number) {\n\n    if (!options) {\n      return createOverlayMarkerStyle();\n    }\n    if (typeof options === 'function' || options instanceof olstyle.Style) {\n      return options;\n    }\n    const parsedStyle = this.parseStyle('style', options);\n    if (parsedStyle.getText()) {\n      let labelMinResolution = 0;\n      let labelMaxResolution = Infinity;\n      if (options.text) {\n        const labelMinResolutionFromScale =\n          options.text?.minScaleDenom ? getResolutionFromScale(Number(options.text.minScaleDenom)) : undefined;\n        const labelMaxResolutionFromScale =\n          options.text?.maxScaleDenom ? getResolutionFromScale(Number(options.text.maxScaleDenom)) : undefined;\n        const minResolution = options.text?.minResolution ? options.text.minResolution : 0;\n        const maxResolution = options.text?.maxResolution ? options.text.maxResolution : Infinity;\n\n        labelMinResolution = labelMinResolutionFromScale || minResolution;\n        labelMaxResolution = labelMaxResolutionFromScale || maxResolution;\n      }\n      if (feature && resolution >= labelMinResolution && resolution <= labelMaxResolution) {\n        if (feature && options.text.attribute) {\n          parsedStyle.getText().setText(this.getLabel(feature, options.text.attribute));\n        }\n      } else {\n        parsedStyle.setText();\n      }\n    }\n    return parsedStyle;\n  }\n\n  private parseStyle(key: string, value: any) {\n    const styleOptions = {};\n    const olCls = this.getOlCls(key);\n\n    if (olCls && value instanceof Object) {\n      Object.keys(value).forEach(_key => {\n        const olKey = this.getOlKey(_key);\n        styleOptions[olKey] = this.parseStyle(_key, value[_key]);\n      });\n      return new olCls(styleOptions);\n    } else {\n      return value;\n    }\n  }\n\n  private getOlKey(key: any) {\n    let olKey;\n    switch (key.toLowerCase()) {\n      case 'circle':\n      case 'regularshape':\n      case 'icon':\n        olKey = 'image';\n        break;\n      default:\n        break;\n    }\n\n    return olKey || key;\n  }\n\n  private getOlCls(key: any) {\n    let olCls = olstyle[key.charAt(0).toUpperCase() + key.slice(1)];\n    if (key === 'regularshape') {\n      olCls = olstyle.RegularShape;\n    }\n    if (key === 'backgroundFill') {\n      olCls = olstyle.Fill;\n    }\n    if (key === 'backgroundStroke') {\n      olCls = olstyle.Stroke;\n    }\n\n    return olCls;\n  }\n\n  createStyleByAttribute(feature: RenderFeature | OlFeature<OlGeometry>, styleByAttribute: StyleByAttribute, resolution: number) {\n\n    let style;\n    const type = styleByAttribute.type ? styleByAttribute.type : this.guessTypeFeature(feature);\n    const attribute = styleByAttribute.attribute;\n    const data = styleByAttribute.data;\n    const stroke = styleByAttribute.stroke;\n    const width = styleByAttribute.width;\n    const fill = styleByAttribute.fill;\n    const anchor = styleByAttribute.anchor;\n    const radius = styleByAttribute.radius;\n    const icon = styleByAttribute.icon;\n    const scale = styleByAttribute.scale;\n    const size = data ? data.length : 0;\n    const label = styleByAttribute.label ? styleByAttribute.label.attribute : undefined;\n    const labelMinResolutionFromScale =\n      styleByAttribute.label?.minScaleDenom ? getResolutionFromScale(Number(styleByAttribute.label.minScaleDenom)) : undefined;\n    const labelMaxResolutionFromScale =\n      styleByAttribute.label?.maxScaleDenom ? getResolutionFromScale(Number(styleByAttribute.label.maxScaleDenom)) : undefined;\n    const minResolution = styleByAttribute.label?.minResolution ? styleByAttribute.label.minResolution : 0;\n    const maxResolution = styleByAttribute.label?.maxResolution ? styleByAttribute.label.maxResolution : Infinity;\n\n    const labelMinResolution = labelMinResolutionFromScale || minResolution;\n    const labelMaxResolution = labelMaxResolutionFromScale || maxResolution;\n\n    let labelStyle = styleByAttribute.label?.style ? this.parseStyle('text', styleByAttribute.label.style) : undefined;\n    if (!labelStyle && label) {\n        labelStyle = new olstyle.Text();\n    }\n    const baseStyle = styleByAttribute.baseStyle;\n\n    if (labelStyle) {\n      if (resolution >= labelMinResolution && resolution <= labelMaxResolution) {\n        labelStyle.setText(this.getLabel(feature, label));\n      } else {\n        labelStyle.setText('');\n      }\n    }\n\n    if (type === 'circle') {\n      for (let i = 0; i < size; i++) {\n        const val =\n          typeof feature.get(attribute) !== 'undefined' && feature.get(attribute) !== null\n            ? feature.get(attribute)\n            : '';\n        if (val === data[i] || val.toString().match(new RegExp(data[i], 'gmi'))) {\n          if (icon) {\n            style = [\n              new olstyle.Style({\n                image: new olstyle.Icon({\n                  color: fill ? fill[i] : undefined,\n                  src: icon[i],\n                  scale: scale ? scale[i] : 1,\n                  anchor: anchor ? anchor[i] : [0.5, 0.5]\n                }),\n                text: labelStyle instanceof olstyle.Text ? labelStyle : undefined\n              })\n            ];\n            return style;\n          }\n          style = [\n            new olstyle.Style({\n              image: new olstyle.Circle({\n                radius: radius ? radius[i] : 4,\n                stroke: new olstyle.Stroke({\n                  color: stroke ? stroke[i] : 'black',\n                  width: width ? width[i] : 1\n                }),\n                fill: new olstyle.Fill({\n                  color: fill ? fill[i] : 'black'\n                })\n              }),\n              text: labelStyle instanceof olstyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (!(feature as OlFeature<OlGeometry>).getStyle()) {\n        if (baseStyle) {\n          style = this.createStyle(baseStyle, feature, resolution);\n          if (labelStyle) {\n            style.setText(labelStyle);\n          }\n          return style;\n        }\n        style = [\n          new olstyle.Style({\n            image: new olstyle.Circle({\n              radius: 4,\n              stroke: new olstyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olstyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          })\n        ];\n        return style;\n      }\n    } else if (type === 'regular') {\n      for (let i = 0; i < size; i++) {\n        const val =\n        typeof feature.get(attribute) !== 'undefined' && feature.get(attribute) !== null\n            ? feature.get(attribute)\n            : '';\n        if (val === data[i] || val.toString().match(new RegExp(data[i], 'gmi'))) {\n          style = [\n            new olstyle.Style({\n              stroke: new olstyle.Stroke({\n                color: stroke ? stroke[i] : 'black',\n                width: width ? width[i] : 1\n              }),\n              fill: new olstyle.Fill({\n                color: fill ? fill[i] : 'rgba(255,255,255,0.4)'\n              }),\n              text: labelStyle instanceof olstyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (feature instanceof OlFeature) {\n        if (!feature.getStyle()) {\n          if (baseStyle) {\n            style = this.createStyle(baseStyle, feature, resolution);\n            if (labelStyle) {\n              style.setText(labelStyle);\n            }\n            return style;\n          }\n          style = [\n            new olstyle.Style({\n              stroke: new olstyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olstyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          ];\n          return style;\n        }\n      }\n    }\n  }\n\n  createClusterStyle(feature: RenderFeature | OlFeature<OlGeometry>, resolution: number, clusterParam: ClusterParam = {}, layerStyle) {\n    let style;\n    const size = feature.get('features').length;\n    if (size !== 1) {\n      if (clusterParam.clusterRanges) {\n        for (const r of clusterParam.clusterRanges) {\n          if (\n            (!r.minRadius || r.minRadius <= size) &&\n            (!r.maxRadius || r.maxRadius >= size)\n          ) {\n            style = this.createStyle(r.style) as olstyle.Circle;\n\n            if (r.showRange) {\n              const text = new olstyle.Text({\n                text: size.toString(),\n                fill: new olstyle.Fill({\n                  color: '#fff'\n                })\n              });\n              style.setText(text);\n            }\n\n            if (r.dynamicRadius) {\n              let clusterRadius: number;\n              const radiusMin = style.getRadius();\n              clusterRadius = 5 * Math.log(size);\n              if (clusterRadius < radiusMin) {\n                clusterRadius = radiusMin;\n              }\n              style.image_.setRadius(clusterRadius);\n            }\n            break;\n          }\n        }\n      }\n\n      if (!style) {\n        let clusterRadius: number;\n        if (clusterParam.radiusCalc) {\n          clusterRadius = clusterParam.radiusCalc(size);\n        } else {\n          const radiusMin = 6;\n          clusterRadius = 5 * Math.log(size);\n          if (clusterRadius < radiusMin) {\n            clusterRadius = radiusMin;\n          }\n        }\n\n        style = [\n          new olstyle.Style({\n            image: new olstyle.Circle({\n              radius: clusterRadius,\n              stroke: new olstyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olstyle.Fill({\n                color: 'rgba(24, 134, 45, 0.5)'\n              })\n            }),\n            text: new olstyle.Text({\n              text: size.toString(),\n              fill: new olstyle.Fill({\n                color: '#fff'\n              })\n            })\n          })\n        ];\n      }\n    } else {\n      style = this.createStyle(layerStyle, feature, resolution);\n    }\n    return style;\n  }\n\n  getLabel(feature, labelMatch): string {\n    let label = labelMatch;\n    if (!label) {\n      return;\n    }\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach(v => {\n      label = label.replace(v[0], feature.get(v[1]));\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.get(labelMatch) || labelMatch;\n    }\n\n    return label;\n  }\n\n  private guessTypeFeature(feature) {\n    switch (feature.getGeometry().getType()) {\n      case 'Point':\n      case 'MultiPoint':\n      case 'Circle':\n        return 'circle';\n      default:\n        return 'regular';\n    }\n  }\n}\n","import * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\n\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { createOverlayMarkerStyle } from './overlay-marker-style.utils';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n/**\n * Create an overlay layer and it's source\n * @returns Overlay layer\n */\nexport function createOverlayLayer(): VectorLayer {\n  const overlayDataSource = new FeatureDataSource();\n  return new VectorLayer({\n    title: 'Overlay',\n    zIndex: 300,\n    source: overlayDataSource,\n    style: createOverlayLayerStyle()\n  });\n}\n\n/**\n * Create an overlay style with markers for points and a basic stroke/fill\n * combination for lines and polygons\n * @returns Style function\n */\nfunction createOverlayLayerStyle(): (olFeature: OlFeature<OlGeometry>, resolution: number) => olstyle.Style {\n  const defaultStyle = createOverlayDefaultStyle();\n  const markerStyle = createOverlayMarkerStyle();\n\n  let style;\n\n  return (olFeature: OlFeature<OlGeometry>, resolution) => {\n    if (olFeature.getId() === 'bufferFeature') {\n      style = createBufferStyle(\n        olFeature.get('bufferStroke'),\n        2,\n        olFeature.get('bufferFill'),\n        olFeature.get('bufferText')\n      );\n      return style;\n    } else {\n      const customStyle = olFeature.get('_style');\n      if (customStyle) {\n        const styleService = new StyleService();\n        return styleService.createStyle(customStyle, olFeature, resolution);\n      }\n      const geometryType = olFeature.getGeometry().getType();\n      style = geometryType === 'Point' ? markerStyle : defaultStyle;\n      style.getText().setText(olFeature.get('_mapTitle'));\n      return style;\n    }\n  };\n}\n\n/**\n * Create a basic style for lines and polygons\n * @returns Style\n */\nexport function createOverlayDefaultStyle({\n  text,\n  strokeWidth = 2,\n  fillColor = [0, 161, 222, 0.3],\n  strokeColor = [0, 161, 222, 0.9],\n}: {\n  text?: string;\n  strokeWidth?: number;\n  fillColor?: string | number[];\n  strokeColor?: string | number[];\n} = {}): olstyle.Style {\n  const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n  const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeWithOpacity\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillWithOpacity\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n\nfunction createBufferStyle(\n  strokeRGBA: [number, number, number, number] = [0, 161, 222, 1],\n  strokeWidth: number = 2,\n  fillRGBA: [number, number, number, number] = [0, 161, 222, 0.15],\n  bufferRadius?\n): olstyle.Style {\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeRGBA\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillRGBA\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      font: '12px Calibri,sans-serif',\n      text: bufferRadius,\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  Feature,\n  FeatureMotion,\n  featureToOl,\n  moveToOlFeatures\n} from '../../feature/shared';\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\n\nimport { createOverlayLayer } from './overlay.utils';\n\n/**\n * This class is simply a shortcut for adding features to a map.\n * It does nothing more than a standard layer but it's shipped with\n * a defautl style based on the geometry type of the features it contains.\n * @todo Enhance that by using a FeatureStore and strategies.\n */\nexport class Overlay {\n  /**\n   * The map to add the layer to\n   */\n  private map: IgoMap;\n\n  /**\n   * Overlay layer\n   */\n  private layer: VectorLayer;\n\n  /**\n   * Overlay layer's data source\n   */\n  get dataSource(): FeatureDataSource {\n    return this.layer.dataSource as FeatureDataSource;\n  }\n\n  constructor(map?: IgoMap) {\n    this.layer = createOverlayLayer();\n    this.setMap(map);\n  }\n\n  /**\n   * Bind this to a map and add the overlay layer to that map\n   * @param map Map\n   */\n  setMap(map: IgoMap) {\n    if (map === undefined) {\n      if (this.map !== undefined) {\n        this.map.ol.removeLayer(this.layer.ol);\n      }\n    } else {\n      map.ol.addLayer(this.layer.ol);\n    }\n    this.map = map;\n  }\n\n  /**\n   * Set the overlay features and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   * @param sourceId Optional: Remove features of certain sourceId (ex: 'Map' for query features)\n   */\n  setFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    sourceId?: string\n  ) {\n    if (sourceId) {\n      for (const olFeature of this.dataSource.ol.getFeatures()) {\n        if (olFeature.get('_sourceId') === sourceId) {\n          this.removeOlFeature(olFeature);\n        }\n      }\n    } else {\n      this.clear();\n    }\n    this.addFeatures(features, motion);\n  }\n\n  /**\n   * Add a feature to the  overlay and, optionally, move to it\n   * @param feature Feature\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addFeature(feature: Feature, motion: FeatureMotion = FeatureMotion.Default) {\n    this.addFeatures([feature], motion);\n  }\n\n  /**\n   * Add features to the  overlay and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    const olFeatures = [];\n    features.forEach((feature: Feature) => {\n      const olFeature = featureToOl(feature, this.map.projection);\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry === null) {\n        return;\n      }\n      olFeatures.push(olFeature);\n    });\n\n    this.addOlFeatures(olFeatures, motion);\n  }\n\n  /**\n   * Add a OpenLayers feature to the  overlay and, optionally, move to it\n   * @param olFeature OpenLayers Feature\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeature(\n    olFeature: OlFeature<OlGeometry>,\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.addOlFeatures([olFeature], motion);\n  }\n\n  /**\n   * Add OpenLayers features to the overlay and, optionally, move to them\n   * @param olFeatures OpenLayers Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.dataSource.ol.addFeatures(olFeatures);\n    moveToOlFeatures(this.map, olFeatures, motion);\n  }\n\n  /**\n   * Remove a feature from the overlay\n   * @param feature Feature\n   */\n  removeFeature(feature: Feature) {\n    this.removeFeatures([feature]);\n  }\n\n  /**\n   * Remove features from the overlay\n   * @param features Features\n   */\n  removeFeatures(features: Feature[]) {\n    features.forEach((feature: Feature) => {\n      if (feature.meta) {\n        if (this.dataSource.ol.getFeatureById(feature.meta.id)) {\n          this.removeOlFeature(this.dataSource.ol.getFeatureById(feature.meta.id));\n        }\n      }\n    });\n  }\n\n  /**\n   * Remove an OpenLayers feature from the overlay\n   * @param olFeature OpenLayers Feature\n   */\n  removeOlFeature(olFeature: OlFeature<OlGeometry>) {\n    this.dataSource.ol.removeFeature(olFeature);\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.dataSource.ol.clear();\n  }\n}\n","import { Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { Watcher, SubjectStatus } from '@igo2/utils';\nimport { Layer } from '../../layer/shared/layers';\n\nexport class LayerWatcher extends Watcher {\n  private loaded = 0;\n  private loading = 0;\n  private layers: Layer[] = [];\n  private subscriptions: Subscription[] = [];\n\n  constructor() {\n    super();\n  }\n\n  watch() {}\n\n  unwatch() {\n    this.layers.forEach(layer => this.unwatchLayer(layer), this);\n  }\n\n  watchLayer(layer: Layer) {\n    if (layer.status$ === undefined) {\n      return;\n    }\n\n    this.layers.push(layer);\n\n    const layer$$ = layer.status$\n      .pipe(distinctUntilChanged())\n      .subscribe(status => {\n        if (status === SubjectStatus.Error) {\n          this.loading = 0;\n          this.loaded = -1;\n        }\n        if (status === SubjectStatus.Working) {\n          this.loading += 1;\n        } else if (status === SubjectStatus.Done) {\n          this.loaded += 1;\n        }\n\n        if (this.loaded >= this.loading) {\n          this.loading = this.loaded = 0;\n          this.status = SubjectStatus.Done;\n        } else if (this.loading > 0) {\n          this.status = SubjectStatus.Working;\n        }\n      });\n\n    this.subscriptions.push(layer$$);\n  }\n\n  unwatchLayer(layer: Layer) {\n    layer.status$.next(SubjectStatus.Done);\n    const index = this.layers.indexOf(layer);\n    if (index >= 0) {\n      const status = (layer as any).watcher.status;\n      if (\n        [SubjectStatus.Working, SubjectStatus.Waiting].indexOf(status) !== -1\n      ) {\n        this.loaded += 1;\n      }\n      this.subscriptions[index].unsubscribe();\n      this.subscriptions.splice(index, 1);\n      this.layers.splice(index, 1);\n      (layer as any).watcher.unwatch();\n    }\n  }\n}\n","export enum MapViewAction {\n  Move,\n  Zoom\n}\n","import { EventsKey } from 'ol/events';\nimport OlMap from 'ol/Map';\nimport { unByKey } from 'ol/Observable';\n\n/**\n * Base map controller\n */\nexport class MapController {\n\n  /**\n   * OL Map\n   */\n  protected olMap: OlMap;\n\n  /**\n   * Array of observer keys\n   */\n  protected observerKeys: EventsKey[] = [];\n\n  /**\n   * Return the OL map this controller is bound to\n   * @returns OL Map\n   */\n  getOlMap(): OlMap {\n    return this.olMap;\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap !== undefined && this.getOlMap() !== undefined) {\n      throw new Error('This controller is already bound to a map.');\n    }\n\n    if (olMap === undefined) {\n      this.teardownObservers();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    this.observerKeys.forEach((key: EventsKey) => unByKey(key));\n    this.observerKeys = [];\n  }\n\n}\n","import OlMap from 'ol/Map';\nimport OlMapEvent from 'ol/MapEvent';\n\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport * as oleasing from 'ol/easing';\nimport * as olproj from 'ol/proj';\nimport OlProjection from 'ol/proj/Projection';\nimport OlView from 'ol/View';\n\nimport { MapViewAction } from '../map.enums';\nimport { MapExtent, MapViewState } from '../map.interface';\nimport { getScaleFromResolution, viewStatesAreEqual } from '../map.utils';\nimport { MapController } from './controller';\nimport { EventsKey } from 'ol/events';\n\nexport interface MapViewControllerOptions {\n  stateHistory: boolean;\n}\n\n/**\n * Controller to handle map view interactions\n */\nexport class MapViewController extends MapController {\n  /**\n   * Observable of the current resolution\n   */\n  resolution$ = new BehaviorSubject<number>(undefined);\n\n  /**\n   * Observable of the current state\n   */\n  state$ = new BehaviorSubject<MapViewState>(undefined);\n\n  /**\n   * View Padding\n   * Values in the array are top, right, bottom and left padding.\n   */\n  padding = [0, 0, 0, 0];\n\n  /**\n   * Max zoom after set extent\n   */\n  maxZoomOnExtent = 19;\n\n  /**\n   * Max extent possible when zooming\n   */\n  maxLayerZoomExtent: MapExtent;\n\n  /**\n   * Extent stream\n   */\n  private extent$ = new Subject<{ extent: MapExtent; action: MapViewAction }>();\n\n  /**\n   * Subscription to the movement stream\n   */\n  private extent$$: Subscription;\n\n  /**\n   * History of states\n   */\n  private states: MapViewState[] = [];\n\n  /**\n   * Current state index\n   */\n  private stateIndex: number = 0;\n\n  /**\n   * Whether the view controller should keep the view's state history\n   */\n  get stateHistory(): boolean {\n    return this.options ? this.options.stateHistory === true : false;\n  }\n\n  /**\n   * OL View\n   */\n  get olView(): OlView {\n    return this.olMap.getView();\n  }\n\n  constructor(private options?: MapViewControllerOptions) {\n    super();\n  }\n\n  setPadding(padding: { top?: number, bottom?: number, left?: number, right?: number }) {\n    // Values in the array are top, right, bottom and left padding.\n    if (padding.top || padding.top === 0) {\n      this.padding[0] = padding.top;\n    }\n    if (padding.right || padding.right === 0) {\n      this.padding[1] = padding.right;\n    }\n    if (padding.bottom || padding.bottom === 0) {\n      this.padding[2] = padding.bottom;\n    }\n    if (padding.left || padding.left === 0) {\n      this.padding[3] = padding.left;\n    }\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    super.setOlMap(olMap);\n    this.setupObservers();\n  }\n\n  /**\n   * Observe move moveend and subscribe to the extent stream\n   */\n  setupObservers() {\n    if (this.stateHistory === true) {\n      this.observerKeys.push(\n        this.olMap.on('moveend', (event: OlMapEvent) => this.onMoveEnd(event)) as EventsKey\n      );\n    }\n\n    this.extent$$ = this.extent$\n      .pipe(debounceTime(25))\n      .subscribe((value: { extent: MapExtent; action: MapViewAction }) => {\n        this.setExtent(value.extent, value.action);\n      });\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    super.teardownObservers();\n    if (this.extent$$ !== undefined) {\n      this.extent$$.unsubscribe();\n      this.extent$$ = undefined;\n    }\n  }\n\n  /**\n   * Get the view's OL projection\n   * @returns OL projection\n   */\n  getOlProjection(): OlProjection {\n    return this.olView.getProjection();\n  }\n\n  /**\n   * Get the current map view center\n   * @param projection Output projection\n   * @returns Center\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    let center = this.olView.getCenter() as [number, number];\n    if (projection && center) {\n      center = olproj.transform(center, this.getOlProjection(), projection) as [number, number];\n    }\n    return center;\n  }\n\n  /**\n   * Get the current view extent\n   * @param projection Output projection\n   * @returns Extent\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    let extent = this.olView.calculateExtent(this.olMap.getSize());\n    if (projection && extent) {\n      extent = olproj.transformExtent(\n        extent,\n        this.getOlProjection(),\n        projection\n      );\n    }\n    return extent as [number, number, number, number];\n  }\n\n  /**\n   * Get the current scale\n   * @param dpi Dot per inches\n   * @returns View scale\n   */\n  getScale(dpi = 96) {\n    return getScaleFromResolution(\n      this.getResolution(),\n      this.getOlProjection().getUnits(),\n      dpi\n    );\n  }\n\n  /**\n   * Get the current resolution\n   * @returns Projection denominator\n   */\n  getResolution(): number {\n    return this.olView.getResolution();\n  }\n\n  /**\n   * Get the current zoom level\n   * @returns Zoom level\n   */\n  getZoom(): number {\n    return Math.round(this.olView.getZoom());\n  }\n\n  /**\n   * Zoom in\n   */\n  zoomIn() {\n    this.zoomTo(this.olView.getZoom() + 1);\n  }\n\n  /**\n   * Zoom out\n   */\n  zoomOut() {\n    this.zoomTo(this.olView.getZoom() - 1);\n  }\n\n  /**\n   * Zoom to specific zoom level\n   * @param zoom Zoom level\n   */\n  zoomTo(zoom: number) {\n    this.olView.cancelAnimations();\n    this.olView.animate({\n      zoom,\n      duration: 250,\n      easing: oleasing.easeOut\n    });\n  }\n\n  /**\n   * Move to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to move to\n   */\n  moveToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Move });\n  }\n\n  /**\n   * Zoom to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to zoom to\n   */\n  zoomToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Zoom });\n  }\n\n  /**\n   * Return the current view rotation\n   * @returns Rotation angle in degrees\n   */\n  getRotation(): number {\n    return this.olView.getRotation();\n  }\n\n  /**\n   * Reset the view rotation to 0\n   */\n  resetRotation() {\n    this.olView.animate({ rotation: 0 });\n  }\n\n  /**\n   * Whether the view has a previous state\n   * @returns True if the view has a previous state\n   */\n  hasPreviousState(): boolean {\n    return this.states.length > 1 && this.stateIndex > 0;\n  }\n\n  /**\n   * Whether the view has a next state\n   * @returns True if the view has a next state\n   */\n  hasNextState(): boolean {\n    return this.states.length > 1 && this.stateIndex < this.states.length - 1;\n  }\n\n  /**\n   * Restore the previous view state\n   */\n  previousState() {\n    if (this.hasPreviousState()) {\n      this.setStateIndex(this.stateIndex - 1);\n    }\n  }\n\n  /**\n   * Restore the next view state\n   */\n  nextState() {\n    if (this.hasNextState()) {\n      this.setStateIndex(this.stateIndex + 1);\n    }\n  }\n\n  /**\n   * Clear the state history\n   */\n  clearStateHistory() {\n    this.states = [];\n    this.stateIndex = 0;\n  }\n\n  /**\n   * Update the the view to it's intial state\n   */\n  setInitialState() {\n    if (this.states.length > 0) {\n      this.setStateIndex(0);\n    }\n  }\n\n  /**\n   * Move to the extent retrieved from the stream\n   * @param extent Extent\n   * @param action Either zoom or move\n   * @param animation With or without animation to the target extent.\n   */\n  private setExtent(\n    extent: MapExtent,\n    action: MapViewAction,\n    animation: boolean = true\n  ) {\n    const olView = this.olView;\n    olView.cancelAnimations();\n    const duration = animation ? 500 : 0;\n    const zoom = olView.getZoom();\n\n    const fromCenter = olView.getCenter();\n    const toCenter = [\n      extent[0] + (extent[2] - extent[0]) / 2,\n      extent[1] + (extent[3] - extent[1]) / 2\n    ];\n    const distCenter = Math.sqrt(\n      Math.pow(fromCenter[0] - toCenter[0], 2) +\n        Math.pow(fromCenter[1] - toCenter[1], 2)\n    );\n    const fromExtent = olView.calculateExtent();\n    const fromSize = Math.sqrt(\n      Math.pow(fromExtent[2] - fromExtent[0], 2) +\n        Math.pow(fromExtent[3] - fromExtent[1], 2)\n    );\n    const toSize = Math.sqrt(\n      Math.pow(extent[2] - extent[0], 2) + Math.pow(extent[3] - extent[1], 2)\n    );\n    const moySize = (toSize + fromSize) / 2;\n    const xSize = distCenter / moySize;\n\n    const maxZoom =\n      action === MapViewAction.Move || zoom > this.maxZoomOnExtent\n        ? zoom\n        : this.maxZoomOnExtent;\n\n    olView.fit(extent, {\n      size: this.olMap.getSize(),\n      maxZoom,\n      padding: this.padding,\n      duration: xSize > 4 ? 0 : duration,\n      callback: (isFinished: boolean) => {\n        if (!isFinished) {\n          olView.fit(extent, {\n            size: this.olMap.getSize(),\n            maxZoom,\n            padding: this.padding,\n            duration: xSize > 4 ? 0 : duration\n          });\n        }\n      }\n    });\n  }\n\n  /**\n   * Set the view state index\n   * @param index State index\n   */\n  private setStateIndex(index: number) {\n    this.stateIndex = index;\n    this.setState(this.states[index]);\n  }\n\n  /**\n   * Set the view state\n   * @param state View state\n   */\n  private setState(state: MapViewState) {\n    this.olView.animate({\n      resolution: state.resolution,\n      center: state.center,\n      duration: 0\n    });\n  }\n\n  /**\n   * On move end, get the view state and record it.\n   * @param event Map event\n   */\n  private onMoveEnd(event: OlMapEvent) {\n    const resolution = this.getResolution();\n    if (this.resolution$.value !== resolution) {\n      this.resolution$.next(resolution);\n    }\n\n    const state = {\n      resolution,\n      center: this.getCenter(),\n      zoom: this.getZoom()\n    };\n\n    if (this.stateHistory === true) {\n      const stateIndex = this.stateIndex;\n      const stateAtIndex =\n        this.states.length === 0 ? undefined : this.states[stateIndex];\n      if (!viewStatesAreEqual(state, stateAtIndex)) {\n        this.states = this.states.slice(0, stateIndex + 1).concat([state]);\n        this.stateIndex = this.states.length - 1;\n      }\n    }\n\n    this.state$.next(state);\n  }\n}\n","import OlMap from 'ol/Map';\nimport olGeolocation from 'ol/Geolocation';\nimport { BehaviorSubject, interval, Subscription } from 'rxjs';\n\nimport * as olproj from 'ol/proj';\nimport olFeature from 'ol/Feature';\nimport { MapController } from './controller';\nimport { Point, Polygon } from 'ol/geom';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport { IgoMap } from '../map';\nimport * as olstyle from 'ol/style';\nimport { Overlay } from '../../../overlay/shared/overlay';\nimport { FeatureMotion } from '../../../feature/shared/feature.enums';\nimport { StorageService, ConfigService } from '@igo2/core';\nimport { MapViewOptions } from '../map.interface';\nimport { switchMap } from 'rxjs/operators';\nexport interface MapGeolocationControllerOptions {\n  //  todo keepPositionHistory?: boolean;\n  projection: olproj.ProjectionLike\n  accuracyThreshold?: number;\n  followPosition?: boolean;\n  buffer?: GeolocationBuffer;\n}\nexport interface MapGeolocationState {\n  position: number[];\n  projection: string;\n  accuracy: number;\n  altitude: number;\n  altitudeAccuracy: number;\n  heading: number;\n  speed: number;\n  enableHighAccuracy: boolean;\n  timestamp: Date;\n}\nexport interface GeolocationBuffer {\n  bufferRadius?: number;\n  bufferStroke?: [number, number, number, number];\n  bufferFill?: [number, number, number, number];\n  showBufferRadius?: boolean;\n}\n\n\nenum GeolocationOverlayType {\n  Position = 'position',\n  Accuracy = 'accuracy',\n  Buffer= 'buffer'\n}\n\n/**\n * Controller to handle map view interactions\n */\nexport class MapGeolocationController extends MapController {\n\n  private subscriptions$$: Subscription[] = [];\n  private geolocationOverlay: Overlay;\n  private positionFeatureStyle: olstyle.Style | olstyle.Style[] = new olstyle.Style({\n    image: new olstyle.Circle({\n      radius: 6,\n      fill: new olstyle.Fill({\n        color: '#3399CC',\n      }),\n      stroke: new olstyle.Stroke({\n        color: '#fff',\n        width: 2,\n      }),\n    }),\n  })\n  private accuracyFeatureStyle: olstyle.Style | olstyle.Style[] = new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: 'rgba(120, 120, 120, 0.4)',\n      width: 1,\n    }),\n    fill: new olstyle.Fill({\n      color: 'rgba(120, 120, 120, 0.4)',\n    }),\n  })\n\n  private geolocation: olGeolocation;\n\n  /**\n   * Observable of the current emission interval of the position. In seconds\n   */\n   public readonly emissionIntervalSeconds$: BehaviorSubject<number> = new BehaviorSubject(5);\n\n  /**\n   * Observable of the current position\n   */\n  public readonly position$ = new BehaviorSubject<MapGeolocationState>(undefined);\n  /**\n   * Observable of the tracking state\n   */\n  public readonly tracking$ = new BehaviorSubject<boolean>(undefined);\n  /**\n   * Observable of the follow position state\n   */\n  public readonly followPosition$ = new BehaviorSubject<boolean>(undefined);\n\n\n  /**\n   * History of positions\n   */\n  // private positions: MapGeolocationState[] = [];\n\n  /**\n   * Whether the geolocate controller should keep the position history\n   */\n  /*\n  // todo: refine this method\n  set keepPositionHistory(value) {\n    this._keepPositionHistory = value;\n  }\n  get keepPositionHistory(): boolean {\n    return this._keepPositionHistory;\n  }\n  private _keepPositionHistory: boolean = this.options && this.options.keepPositionHistory ? this.options.keepPositionHistory : true;\n*/\n  /**\n   * Whether the geolocate should show a buffer around the current position\n   */\n   set buffer(value: GeolocationBuffer) {\n    this._buffer = value;\n    this.handleFeatureCreation(this.position$.value);\n  }\n   get buffer(): GeolocationBuffer {\n    return this._buffer;\n  }\n  private _buffer: GeolocationBuffer = this.options && this.options.buffer ? this.options.buffer : undefined;\n\n  /**\n   * Whether the geolocate controller accuracy threshold to store/show the position.\n   */\n  set accuracyThreshold(value: number) {\n    this._accuracyThreshold = value;\n    this.handleFeatureCreation(this.position$.value);\n  }\n\n  get accuracyThreshold(): number {\n    return this._accuracyThreshold;\n  }\n  private _accuracyThreshold = this.options && this.options.accuracyThreshold ? this.options.accuracyThreshold : 5000;\n\n\n  /**\n   * Whether the activate the geolocation.\n   */\n  get tracking() {\n    return this.geolocation.getTracking();\n  }\n\n  set tracking(value: boolean) {\n    this.geolocation.setTracking(value || false);\n    this.tracking$.next(value);\n    if (this.storageService && value !== undefined) {\n      this.storageService.set('geolocation.tracking', value);\n    }\n    if (!value) {\n      this.position$.next(undefined);\n    }\n  }\n\n    /**\n   * Whether the activate the view tracking of the current position\n   */\n  set followPosition(value: boolean) {\n    this._followPosition = value;\n    this.followPosition$.next(value);\n    if (this.configService?.getConfig('geolocate.followPosition') === false) {\n      this._followPosition = false;\n      this.followPosition$.next(false);\n    }\n    this.handleFeatureCreation(this.position$.value);\n    if (this.storageService && value !== undefined) {\n      this.storageService.set('geolocation.followPosition', value);\n    }\n  }\n\n  get followPosition() {\n    return this._followPosition;\n  }\n\n\n  private _followPosition = this.options && this.options.followPosition ? this.options.followPosition : false;\n\n\n  constructor(\n    private map: IgoMap,\n    private options?: MapGeolocationControllerOptions,\n    private storageService?: StorageService,\n    private configService?: ConfigService) {\n    super();\n    this.geolocationOverlay = new Overlay(this.map);\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    super.setOlMap(olMap);\n    this.setupObservers();\n  }\n\n  private deleteGeolocationFeatures() {\n    this.deleteFeatureByType(GeolocationOverlayType.Position);\n    this.deleteFeatureByType(GeolocationOverlayType.Accuracy);\n    this.deleteFeatureByType(GeolocationOverlayType.Buffer);\n  }\n\n  setupObservers() {\n    this.tracking$.subscribe(tracking => {\n      if (tracking) {\n        this.onPositionChange(true, true);\n      } else {\n        this.deleteGeolocationFeatures();\n      }\n    });\n\n    this.geolocation = new olGeolocation({\n      // enableHighAccuracy must be set to true to have the heading value.\n      trackingOptions: {\n        enableHighAccuracy: true,\n        maximumAge: 10000,\n        timeout: 600000\n      },\n      projection: this.options.projection,\n    });\n    let tracking = false;\n    this.subscriptions$$.push(this.emissionIntervalSeconds$\n      .pipe(switchMap(value => interval(value * 1000)))\n      .subscribe(() => {\n        if (tracking === this.tracking) {\n          this.onPositionChange(true);\n        } else {\n          tracking = this.tracking;\n          this.onPositionChange(true, true);\n        }\n      }));\n  }\n\n  public updateGeolocationOptions(options: MapViewOptions) {\n    if (!options) { return;}\n    // todo maybe a dedicated interface for geolocation should be defined instead of putting these inside the mapviewoptions?\n    let tracking = options.geolocate;\n    let followPosition = options.alwaysTracking;\n    if (this.storageService) {\n      const storedTracking = this.storageService.get('geolocation.tracking') as boolean;\n      if (storedTracking !== null && storedTracking !== undefined) {\n        tracking = storedTracking;\n      }\n\n      const storedFollowPosition = this.storageService.get('geolocation.followPosition') as boolean;\n      if (storedFollowPosition !== null && storedFollowPosition !== undefined) {\n        followPosition = storedFollowPosition;\n      }\n    }\n    this.tracking = tracking;\n    this.followPosition = followPosition;\n    this.buffer = options.buffer;\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    if (this.subscriptions$$.length) {\n      this.subscriptions$$.map(s => s.unsubscribe());\n    }\n    super.teardownObservers();\n  }\n\n  /**\n   * Clear the position  history\n   */\n  /*\n  // todo\n  clearPositionsHistory() {\n    this.positions = [];\n  }*/\n\n  /**\n   * On position change, get the position, show it on the map and record it.\n   * @param emitEvent Map event\n   */\n  private onPositionChange(emitEvent: boolean = false, zoomTo: boolean = false) {\n    if (!this.tracking) {\n      return;\n    }\n    const geolocateProperties = this.geolocation.getProperties();\n\n    if (geolocateProperties.accuracy > this.accuracyThreshold) {\n      console.warn('Poor geolocation accuracy. No position are stored/shown');\n      this.position$.next(undefined);\n      return;\n    }\n\n    const position: MapGeolocationState = {\n      position: geolocateProperties.position,\n      projection: this.geolocation.getProjection().getCode(),\n      accuracy: geolocateProperties.accuracy,\n      altitude: geolocateProperties.altitude,\n      altitudeAccuracy: geolocateProperties.altitudeAccuracy,\n      heading: geolocateProperties.heading,\n      speed: geolocateProperties.speed,\n      enableHighAccuracy: geolocateProperties.trackingOptions?.enableHighAccuracy ? true : false,\n      timestamp: new Date()\n    };\n    this.handleFeatureCreation(position, zoomTo);\n    if (emitEvent) {\n      this.position$.next(position);\n      /*if (this.keepPositionHistory === true) {\n        // handle position diff to store only true diff;\n        this.positions.push(position);\n      }*/\n    }\n  }\n\n  private deleteFeatureByType(type: GeolocationOverlayType) {\n    const featureById = this.geolocationOverlay.dataSource.ol.getFeatureById(type);\n    if (featureById) {\n      this.geolocationOverlay.dataSource.ol.removeFeature(featureById);\n    }\n\n  }\n\n  private handleFeatureCreation(position: MapGeolocationState, zoomTo: boolean = false) {\n    if (!position || !position.position) {\n      return;\n    }\n    this.deleteGeolocationFeatures();\n    const positionGeometry = new Point(position.position);\n    const accuracyGeometry = fromCircle(new OlCircle(position.position, position.accuracy || 0));\n\n    const positionFeature = new olFeature<Point>({ geometry: positionGeometry });\n    const accuracyFeature = new olFeature<Polygon>({ geometry: accuracyGeometry });\n\n    if (positionGeometry) {\n      let motion = this.followPosition ? FeatureMotion.Move : FeatureMotion.None;\n      if (zoomTo) {\n        motion = FeatureMotion.Zoom;\n      }\n      positionFeature.setId(GeolocationOverlayType.Position);\n      positionFeature.setStyle(this.positionFeatureStyle);\n      this.geolocationOverlay.addOlFeature(positionFeature, motion);\n      if (accuracyGeometry) {\n        accuracyFeature.setId(GeolocationOverlayType.Accuracy);\n        accuracyFeature.setStyle(this.accuracyFeatureStyle);\n        this.geolocationOverlay.addOlFeature(accuracyFeature, motion);\n      }\n      if (this.buffer) {\n        const bufferFeature = new olFeature(new OlCircle(position.position, this.buffer.bufferRadius));\n        const bufferStyle = new olstyle.Style({\n          stroke: new olstyle.Stroke({ width: 2, color: this.buffer.bufferStroke }),\n          fill: new olstyle.Fill({ color: this.buffer.bufferFill }),\n          text: new olstyle.Text({\n            textAlign: 'left',\n            offsetX: 10,\n            offsetY: -10,\n            font: '12px Calibri,sans-serif',\n            text: this.buffer.showBufferRadius ? `${this.buffer.bufferRadius}m` : '',\n            fill: new olstyle.Fill({ color: '#000' }),\n            stroke: new olstyle.Stroke({ color: '#fff', width: 3 })\n          })\n        });\n        bufferFeature.setId(GeolocationOverlayType.Buffer);\n        bufferFeature.setStyle(bufferStyle);\n        this.geolocationOverlay.addOlFeature(bufferFeature, motion);\n      }\n\n    }\n\n  }\n}\n","import olMap from 'ol/Map';\nimport olView from 'ol/View';\nimport olControlAttribution from 'ol/control/Attribution';\nimport olControlScaleLine from 'ol/control/ScaleLine';\nimport * as olproj from 'ol/proj';\nimport * as olproj4 from 'ol/proj/proj4';\nimport OlProjection from 'ol/proj/Projection';\nimport * as olinteraction from 'ol/interaction';\n\nimport proj4 from 'proj4';\nimport { BehaviorSubject, Subject } from 'rxjs';\n\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { Layer } from '../../layer/shared/layers';\nimport { Overlay } from '../../overlay/shared/overlay';\n\nimport { LayerWatcher } from '../utils/layer-watcher';\nimport {\n  MapViewOptions,\n  MapOptions,\n  MapAttributionOptions,\n  MapScaleLineOptions,\n  MapExtent,\n  MapControlsOptions\n} from './map.interface';\nimport { MapViewController } from './controllers/view';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { MapGeolocationController } from './controllers/geolocation';\nimport { StorageService, ConfigService } from '@igo2/core';\n\n// TODO: This class is messy. Clearly define it's scope and the map browser's.\n// Move some stuff into controllers.\nexport class IgoMap {\n  public ol: olMap;\n  public offlineButtonToggle$ = new BehaviorSubject<boolean>(false);\n  public layers$ = new BehaviorSubject<Layer[]>([]);\n  public status$: Subject<SubjectStatus>;\n  public overlay: Overlay;\n  public queryResultsOverlay: Overlay;\n  public searchResultsOverlay: Overlay;\n  public viewController: MapViewController;\n  public geolocationController: MapGeolocationController;\n  public swipeEnabled$ = new BehaviorSubject<boolean>(false);\n  public mapCenter$ = new BehaviorSubject<boolean>(false);\n  public selectedFeatures$ = new BehaviorSubject<Layer[]>(null);\n\n  public bufferDataSource: FeatureDataSource;\n\n  private layerWatcher: LayerWatcher;\n\n  private options: MapOptions;\n  private mapViewOptions: MapViewOptions;\n  private defaultOptions: Partial<MapOptions> = {\n    controls: { attribution: false }\n  };\n\n  get layers(): Layer[] {\n    return this.layers$.value;\n  }\n\n  get projection(): string {\n    return this.viewController.getOlProjection().getCode();\n  }\n\n  constructor(\n    options?: MapOptions,\n    private storageService?: StorageService,\n    private configService?: ConfigService) {\n    this.options = Object.assign({}, this.defaultOptions, options);\n    this.layerWatcher = new LayerWatcher();\n    this.status$ = this.layerWatcher.status$;\n    olproj4.register(proj4);\n    this.init();\n  }\n\n  init() {\n    const controls = [];\n    if (this.options.controls) {\n      if (this.options.controls.attribution) {\n        const attributionOpt = (this.options.controls.attribution === true\n          ? {}\n          : this.options.controls.attribution) as MapAttributionOptions;\n        controls.push(new olControlAttribution(attributionOpt));\n      }\n      if (this.options.controls.scaleLine) {\n        const scaleLineOpt = (this.options.controls.scaleLine === true\n          ? {}\n          : this.options.controls.scaleLine) as MapScaleLineOptions;\n        controls.push(new olControlScaleLine(scaleLineOpt));\n      }\n    }\n    let interactions = {};\n    if (this.options.interactions === false) {\n      interactions = {\n        altShiftDragRotate: false,\n        doubleClickZoom: false,\n        keyboard: false,\n        mouseWheelZoom: false,\n        shiftDragZoom: false,\n        dragPan: false,\n        pinchRotate: false,\n        pinchZoom: false\n      };\n    }\n\n    this.ol = new olMap({\n      interactions: olinteraction.defaults(interactions),\n      controls\n    });\n\n    this.setView(this.options.view || {});\n    this.viewController = new MapViewController({\n      stateHistory: true\n    });\n    this.viewController.setOlMap(this.ol);\n    this.overlay = new Overlay(this);\n    this.queryResultsOverlay = new Overlay(this);\n    this.searchResultsOverlay = new Overlay(this);\n    this.ol.once('rendercomplete', () => {\n      this.geolocationController = new MapGeolocationController(\n        this,\n        {\n          projection: this.viewController.getOlProjection()\n        },\n        this.storageService,\n        this.configService);\n      this.geolocationController.setOlMap(this.ol);\n      if (this.geolocationController) {\n        this.geolocationController.updateGeolocationOptions(this.mapViewOptions);\n      }\n  });\n  }\n\n  setTarget(id: string) {\n    this.ol.setTarget(id);\n    if (id !== undefined) {\n      this.layerWatcher.subscribe(() => { }, null);\n    } else {\n      this.layerWatcher.unsubscribe();\n    }\n  }\n\n  updateView(options: MapViewOptions) {\n    const currentView = this.ol.getView();\n    const viewOptions = Object.assign(\n      {\n        zoom: currentView.getZoom()\n      },\n      currentView.getProperties()\n    );\n\n    this.setView(Object.assign(viewOptions, options));\n    if (options.maxZoomOnExtent) {\n      this.viewController.maxZoomOnExtent = options.maxZoomOnExtent;\n    }\n    this.mapViewOptions = options;\n  }\n\n  /**\n   * Set the map view\n   * @param options Map view options\n   */\n  setView(options: MapViewOptions) {\n    if (this.viewController !== undefined) {\n      this.viewController.clearStateHistory();\n    }\n\n    options = Object.assign({ constrainResolution: true }, options);\n    const view = new olView(options);\n    this.ol.setView(view);\n\n    if (options) {\n      if (options.maxLayerZoomExtent) {\n        this.viewController.maxLayerZoomExtent = options.maxLayerZoomExtent;\n      }\n\n      if (options.center) {\n        const projection = view.getProjection().getCode();\n        const center = olproj.fromLonLat(options.center, projection);\n        view.setCenter(center);\n      }\n    }\n  }\n\n  updateControls(value: MapControlsOptions) {\n    if (value === undefined) {\n      return;\n    }\n\n    const controls = [];\n    if (value.attribution) {\n      const attributionOpt = (value.attribution === true\n        ? {}\n        : value.attribution) as MapAttributionOptions;\n      controls.push(new olControlAttribution(attributionOpt));\n    }\n    if (value.scaleLine) {\n      const scaleLineOpt = (value.scaleLine === true\n        ? {}\n        : value.scaleLine) as MapScaleLineOptions;\n      controls.push(new olControlScaleLine(scaleLineOpt));\n    }\n\n    const currentControls = Object.assign([], this.ol.getControls().getArray());\n    currentControls.forEach(control => {\n      this.ol.removeControl(control);\n    });\n    controls.forEach(control => {\n      this.ol.addControl(control);\n    });\n  }\n\n  /**\n   * Deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    return this.viewController.getCenter(projection);\n  }\n\n  /**\n   * Deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    return this.viewController.getExtent(projection);\n  }\n\n  // TODO: Move to ViewController and update every place it's used\n  getZoom(): number {\n    return this.viewController.getZoom();\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (!baseLayer) {\n      return;\n    }\n\n    for (const bl of this.getBaseLayers()) {\n      bl.visible = false;\n    }\n\n    baseLayer.visible = true;\n\n    this.viewController.olView.setMinZoom(\n      baseLayer.dataSource.options.minZoom || (this.options.view || {}).minZoom\n    );\n    this.viewController.olView.setMaxZoom(\n      baseLayer.dataSource.options.maxZoom || (this.options.view || {}).maxZoom\n    );\n  }\n\n  getBaseLayers(): Layer[] {\n    return this.layers.filter((layer: Layer) => layer.baseLayer === true);\n  }\n\n  getLayerById(id: string): Layer {\n    return this.layers.find((layer: Layer) => layer.id && layer.id === id);\n  }\n\n  getLayerByAlias(alias: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => layer.alias && layer.alias === alias\n    );\n  }\n\n  getLayerByOlUId(olUId: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => (layer.ol as any).ol_uid && (layer.ol as any).ol_uid === olUId\n    );\n  }\n\n  /**\n   * Add a single layer\n   * @param layer Layer to add\n   * @param push DEPRECATED\n   */\n  addLayer(layer: Layer, push = true) {\n    this.addLayers([layer]);\n  }\n\n  /**\n   * Add many layers\n   * @param layers Layers to add\n   * @param push DEPRECATED\n   */\n  addLayers(layers: Layer[], push = true) {\n    let offsetZIndex = 0;\n    let offsetBaseLayerZIndex = 0;\n    const addedLayers = layers\n      .map((layer: Layer) => {\n        if (!layer) { return; }\n        const offset = layer.zIndex\n          ? 0\n          : layer.baseLayer\n            ? offsetBaseLayerZIndex++\n            : offsetZIndex++;\n        return this.doAddLayer(layer, offset);\n      })\n      .filter((layer: Layer | undefined) => layer !== undefined);\n    this.setLayers([].concat(this.layers, addedLayers));\n  }\n\n  /**\n   * Remove a single layer\n   * @param layer Layer to remove\n   */\n  removeLayer(layer: Layer) {\n    this.removeLayers([layer]);\n  }\n\n  /**\n   * Remove many layers\n   * @param layers Layers to remove\n   */\n  removeLayers(layers: Layer[]) {\n    const newLayers = this.layers$.value.slice(0);\n    const layersToRemove = [];\n    layers.forEach((layer: Layer) => {\n      const index = newLayers.indexOf(layer);\n      if (index >= 0) {\n        layersToRemove.push(layer);\n        newLayers.splice(index, 1);\n        this.handleLinkedLayersDeletion(layer, layersToRemove);\n        layersToRemove.map(linkedLayer => {\n          layersToRemove.push(linkedLayer);\n          const linkedIndex = newLayers.indexOf(linkedLayer);\n          if (linkedIndex >= 0) {\n            newLayers.splice(linkedIndex, 1);\n          }\n        });\n      }\n    });\n\n    layersToRemove.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.setLayers(newLayers);\n  }\n\n  /**\n   * Build a list of linked layers to delete\n   * @param srcLayer Layer that has triggered the deletion\n   * @param layersToRemove list to append the layer to delete into\n   */\n  handleLinkedLayersDeletion(srcLayer: Layer, layersToRemove: Layer[]) {\n    const linkedLayers = srcLayer.options.linkedLayers;\n    if (!linkedLayers) {\n      return;\n    }\n    const currentLinkedId = linkedLayers.linkId;\n    const currentLinks = linkedLayers.links;\n    const isParentLayer = currentLinks ? true : false;\n    if (isParentLayer) {\n      // search for child layers\n      currentLinks.map(link => {\n        if (!link.syncedDelete) {\n          return;\n        }\n        link.linkedIds.map(linkedId => {\n          const layerToApply = this.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\n          if (layerToApply) {\n            layersToRemove.push(layerToApply);\n          }\n        });\n      });\n    } else {\n      // search for parent layer\n      this.layers.map(layer => {\n        if (layer.options.linkedLayers?.links) {\n          layer.options.linkedLayers.links.map(l => {\n            if (\n              l.syncedDelete && l.bidirectionnal !== false &&\n              l.linkedIds.indexOf(currentLinkedId) !== -1) {\n              layersToRemove.push(layer);\n              this.handleLinkedLayersDeletion(layer, layersToRemove);\n            }\n          });\n        }\n      });\n    }\n  }\n\n  /**\n   * Remove all layers\n   */\n  removeAllLayers() {\n    this.layers.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.layers$.next([]);\n  }\n\n  raiseLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index > 1) {\n      this.moveLayer(layer, index, index - 1);\n    }\n  }\n\n  raiseLayers(layers: Layer[]) {\n    for (const layer of layers) {\n      this.raiseLayer(layer);\n    }\n  }\n\n  lowerLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index < this.layers.length - 1) {\n      this.moveLayer(layer, index, index + 1);\n    }\n  }\n\n  lowerLayers(layers: Layer[]) {\n    const reverseLayers = layers.reverse();\n    for (const layer of reverseLayers) {\n      this.lowerLayer(layer);\n    }\n  }\n\n  moveLayer(layer: Layer, from: number, to: number) {\n    const layerTo = this.layers[to];\n    const zIndexTo = layerTo.zIndex;\n    const zIndexFrom = layer.zIndex;\n\n    if (layerTo.baseLayer || layer.baseLayer) {\n      return;\n    }\n\n    layer.zIndex = zIndexTo;\n    layerTo.zIndex = zIndexFrom;\n\n    this.layers[to] = layer;\n    this.layers[from] = layerTo;\n    this.layers$.next(this.layers.slice(0));\n  }\n\n  /**\n   * Add a layer to the OL map and start watching. If the layer is already\n   * added to this map, make it visible but don't add it one again.\n   * @param layer Layer\n   * @returns The layer added, if any\n   */\n  private doAddLayer(layer: Layer, offsetZIndex: number) {\n    if (layer.baseLayer && layer.visible) {\n      this.changeBaseLayer(layer);\n    }\n\n    const existingLayer = this.getLayerById(layer.id);\n    if (existingLayer !== undefined) {\n      existingLayer.visible = true;\n      return;\n    }\n\n    if (!layer.baseLayer && layer.zIndex) {\n      layer.zIndex += 10;\n    }\n\n    if (layer.zIndex === undefined || layer.zIndex === 0) {\n      const maxZIndex = Math.max(\n        layer.baseLayer ? 0 : 10,\n        ...this.layers\n          .filter(\n            (l) => l.baseLayer === layer.baseLayer && l.zIndex < 200 // zIndex > 200 = system layer\n          )\n          .map((l) => l.zIndex)\n      );\n      layer.zIndex = maxZIndex + 1 + offsetZIndex;\n    }\n\n    if (layer.baseLayer && layer.zIndex > 9) {\n      layer.zIndex = 10; // baselayer must have zIndex < 10\n    }\n\n    layer.setMap(this);\n    this.layerWatcher.watchLayer(layer);\n    this.ol.addLayer(layer.ol);\n\n    return layer;\n  }\n\n  /**\n   * Remove a layer from the OL map and stop watching\n   * @param layer Layer\n   */\n  private doRemoveLayer(layer: Layer) {\n    this.layerWatcher.unwatchLayer(layer);\n    this.ol.removeLayer(layer.ol);\n    layer.setMap(undefined);\n  }\n\n  /**\n   * Update the layers observable\n   * @param layers Layers\n   */\n  private setLayers(layers: Layer[]) {\n    this.layers$.next(this.sortLayersByZIndex(layers).slice(0));\n  }\n\n  /**\n   * Sort layers by descending zIndex\n   * @param layers Array of layers\n   * @returns The original array, sorted by zIndex\n   */\n  private sortLayersByZIndex(layers: Layer[]) {\n    // Sort by descending zIndex\n    return layers.sort(\n      (layer1: Layer, layer2: Layer) => layer2.zIndex - layer1.zIndex\n    );\n  }\n\n  /**\n   * Get layer index in the map's inenr array of layers\n   * @param layer Layer\n   * @returns The layer index\n   */\n  private getLayerIndex(layer: Layer) {\n    return this.layers.findIndex((_layer: Layer) => _layer === layer);\n  }\n\n  onOfflineToggle(offline: boolean) {\n    this.offlineButtonToggle$.next(offline);\n  }\n}\n","import {\n  Component,\n  Input,\n  OnInit,\n  AfterViewInit,\n  OnDestroy\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { SubjectStatus } from '@igo2/utils';\nimport { ActivityService } from '@igo2/core';\n\nimport { IgoMap } from '../shared/map';\nimport { MapControlsOptions, MapViewOptions } from '../shared/map.interface';\n\n@Component({\n  selector: 'igo-map-browser',\n  templateUrl: './map-browser.component.html',\n  styleUrls: ['./map-browser.component.scss']\n})\nexport class MapBrowserComponent implements OnInit, AfterViewInit, OnDestroy {\n  private activityId: string;\n  private status$$: Subscription;\n\n  @Input() map: IgoMap;\n\n  @Input()\n  get view(): MapViewOptions {\n    return this._view;\n  }\n  set view(value: MapViewOptions) {\n    this._view = value;\n    if (this.map !== undefined) {\n      this.map.updateView(value);\n    }\n  }\n  private _view: MapViewOptions;\n\n  get controls(): MapControlsOptions {\n    return this._controls;\n  }\n\n  set controls(value: MapControlsOptions) {\n    this._controls = value;\n    if (this.map !== undefined) {\n      this.map.updateControls(value);\n    }\n  }\n  private _controls: MapControlsOptions;\n\n  public id = `igo-map-target-${new Date().getTime()}`;\n\n  constructor(private activityService: ActivityService) {}\n\n  ngOnInit() {\n    this.status$$ = this.map.status$.subscribe(status =>\n      this.handleStatusChange(status)\n    );\n  }\n\n  ngAfterViewInit() {\n    this.map.setTarget(this.id);\n  }\n\n  ngOnDestroy() {\n    this.map.setTarget(undefined);\n    this.activityService.unregister(this.activityId);\n    this.status$$.unsubscribe();\n  }\n\n  private handleStatusChange(status: SubjectStatus) {\n    if (status === SubjectStatus.Working && this.activityId === undefined) {\n      this.activityId = this.activityService.register();\n    } else if (status === SubjectStatus.Done && this.activityId !== undefined) {\n      this.activityService.unregister(this.activityId);\n      this.activityId = undefined;\n    }\n  }\n}\n","<div [id]=\"id\" class=\"igo-map-browser-target\"></div>\n<ng-content></ng-content>\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  Self,\n  OnInit\n} from '@angular/core';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\n\nimport { transform } from 'ol/proj';\nimport { MediaService } from '@igo2/core';\nimport { unByKey } from 'ol/Observable';\n/**\n * This directive return the pointer coordinate (on click or pointermove)\n * in [longitude, latitude], delayed by in input (pointerMoveDelay)\n * to avoid too many emitted values.\n */\n@Directive({\n  selector: '[igoPointerPosition]'\n})\nexport class PointerPositionDirective implements OnInit, OnDestroy {\n\n  private lastTimeoutRequest;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * Delay before emitting an event\n   */\n  @Input() pointerPositionDelay: number = 1000;\n\n  /**\n   * Event emitted when the pointer move, delayed by pointerMoveDelay\n   */\n  @Output() pointerPositionCoord = new EventEmitter<[number, number]>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService\n  ) { }\n\n  /**\n   * Start listening to pointermove\n   * @internal\n   */\n  ngOnInit(): void {\n    this.listenToMapPointerMove();\n    this.listenToMapClick();\n  }\n\n  /**\n   * Stop listening to pointermove\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unlistenToMapClick();\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, this.pointerPositionDelay)\n    );\n  }\n\n  /**\n   * On map click\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, 0)\n    );\n  }\n\n  /**\n   * Stop listening for map pointermove\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * emit delayed coordinate (longitude, latitude array) based on pointerMoveDelay or on click\n   * @param event OL map browser pointer event\n   */\n  private onPointerEvent(event: MapBrowserPointerEvent<any>, delay: number) {\n    if (event.dragging || this.mediaService.isTouchScreen()) {return; }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n\n    const lonlat = transform(event.coordinate, this.mapProjection, 'EPSG:4326') as [number, number];\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.pointerPositionCoord.emit(lonlat);\n    }, delay);\n  }\n}\n","import olLayerImage from 'ol/layer/Image';\nimport olSourceImage from 'ol/source/Image';\n\nimport { AuthInterceptor } from '@igo2/auth';\n\nimport { ImageWatcher } from '../../utils';\nimport { IgoMap } from '../../../map';\n\nimport { WMSDataSource } from '../../../datasource/shared/datasources/wms-datasource';\n\nimport { Layer } from './layer';\nimport { ImageLayerOptions } from './image-layer.interface';\nimport { ImageArcGISRestDataSource } from '../../../datasource/shared/datasources/imagearcgisrest-datasource';\nimport { LanguageService, MessageService } from '@igo2/core';\n\nexport class ImageLayer extends Layer {\n  public dataSource: WMSDataSource | ImageArcGISRestDataSource;\n  public options: ImageLayerOptions;\n  public ol: olLayerImage<olSourceImage>;\n\n  private watcher: ImageWatcher;\n\n  constructor(\n    options: ImageLayerOptions,\n    public messageService: MessageService,\n    private languageService: LanguageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new ImageWatcher(this, this.messageService, this.languageService);\n    this.status$ = this.watcher.status$;\n    this.status$.subscribe(valStatus => {\n      if (valStatus === 0) {\n        this.olLoadingProblem = true;\n      }\n    });\n  }\n\n  protected createOlLayer(): olLayerImage<olSourceImage> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceImage\n    });\n\n    const image = new olLayerImage(olOptions);\n    if (this.authInterceptor) {\n      (image.getSource() as any).setImageLoadFunction((tile, src) => {\n        this.customLoader(tile, src, this.authInterceptor, this.messageService, this.languageService);\n      });\n    }\n\n    return image;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  private customLoader(tile, src: string, interceptor: AuthInterceptor, messageService: MessageService, languageService: LanguageService) {\n    const xhr = new XMLHttpRequest();\n\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(src);\n    let url = src;\n    if (alteredUrlWithKeyAuth) {\n      url = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', url);\n    const intercepted = interceptor.interceptXhr(xhr, url);\n    if (!intercepted) {\n      xhr.abort();\n      tile.getImage().src = url;\n      return;\n    }\n\n    xhr.responseType = 'arraybuffer';\n\n    xhr.onload = function() {\n      const arrayBufferView = new Uint8Array((this as any).response);\n      const responseString = new TextDecoder().decode(arrayBufferView);\n      if (responseString.includes('ServiceExceptionReport')) {\n        messageService.error(languageService.translate.instant(\n          'igo.geo.dataSource.optionsApiUnavailable'\n        ),\n        languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        ));\n      }\n      const blob = new Blob([arrayBufferView], { type: 'image/png' });\n      const urlCreator = window.URL;\n      const imageUrl = urlCreator.createObjectURL(blob);\n      tile.getImage().src = imageUrl;\n    };\n    xhr.send();\n  }\n}\n","import olLayerTile from 'ol/layer/Tile';\nimport olSourceTile from 'ol/source/Tile';\nimport Tile from 'ol/Tile';\n\nimport { TileWatcher } from '../../utils';\nimport { IgoMap } from '../../../map';\n\nimport { OSMDataSource } from '../../../datasource/shared/datasources/osm-datasource';\nimport { WMTSDataSource } from '../../../datasource/shared/datasources/wmts-datasource';\nimport { XYZDataSource } from '../../../datasource/shared/datasources/xyz-datasource';\nimport { CartoDataSource } from '../../../datasource/shared/datasources/carto-datasource';\nimport { TileArcGISRestDataSource } from '../../../datasource/shared/datasources/tilearcgisrest-datasource';\nimport { TileDebugDataSource } from '../../../datasource/shared/datasources/tiledebug-datasource';\n\nimport { Layer } from './layer';\nimport { TileLayerOptions } from './tile-layer.interface';\n\nimport { MessageService } from '@igo2/core';\nimport { AuthInterceptor } from '@igo2/auth';\nexport class TileLayer extends Layer {\n  public dataSource:\n    | OSMDataSource\n    | WMTSDataSource\n    | XYZDataSource\n    | TileDebugDataSource\n    | CartoDataSource\n    | TileArcGISRestDataSource;\n  public options: TileLayerOptions;\n  public ol: olLayerTile<olSourceTile>;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: TileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor) {\n    super(options, messageService);\n\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerTile<olSourceTile> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol\n    });\n    const tileLayer = new olLayerTile(olOptions);\n    const tileSource = tileLayer.getSource();\n    tileSource.setTileLoadFunction((tile: Tile, url: string) => {\n      this.customLoader(tile, url, this.authInterceptor);\n    });\n\n    return tileLayer;\n  }\n\n  /**\n   * Custom loader for tile layer.\n   * @internal\n   * @param tile the current tile\n   * @param url the url string or function to retrieve the data\n   */\n  customLoader(tile, url: string, interceptor: AuthInterceptor ) {\n\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    tile.getImage().src = modifiedUrl;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","import olLayerVectorTile from 'ol/layer/VectorTile';\nimport olSourceVectorTile from 'ol/source/VectorTile';\n\nimport { MVTDataSource } from '../../../datasource/shared/datasources/mvt-datasource';\n\nimport { Layer } from './layer';\nimport { VectorTileLayerOptions } from './vectortile-layer.interface';\nimport { TileWatcher } from '../../utils';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { IgoMap } from '../../../map';\nimport { MessageService } from '@igo2/core';\nimport VectorTile from 'ol/VectorTile';\n\nexport class VectorTileLayer extends Layer {\n  public dataSource: MVTDataSource;\n  public options: VectorTileLayerOptions;\n  public ol: olLayerVectorTile;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: VectorTileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVectorTile {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVectorTile\n    });\n\n    const vectorTile = new olLayerVectorTile(olOptions);\n    const vectorTileSource = vectorTile.getSource() as olSourceVectorTile;\n\n    vectorTileSource.setTileLoadFunction((tile: VectorTile, url: string) => {\n      const loader = this.customLoader(url, tile.getFormat(), this.authInterceptor, tile.onLoad.bind(tile));\n      if (loader) {\n        tile.setLoader(loader);\n      }\n    }\n    );\n\n    return vectorTile;\n  }\n\n  /**\n   * Custom loader for vector tile layer. Modified from the loadFeaturesXhr function in ol\\featureloader.js\n   * @internal\n   * @param url the url string or function to retrieve the data\n   * @param format the format of the tile\n   * @param interceptor the interceptor of the data\n   * @param success On success event action to trigger\n   * @param failure On failure event action to trigger TODO\n   */\n  customLoader(url, format, interceptor, success, failure?) {\n    return ((extent, resolution, projection) => {\n      const xhr = new XMLHttpRequest();\n      let modifiedUrl = url;\n      if (typeof url !== 'function') {\n        const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n        if (alteredUrlWithKeyAuth) {\n          modifiedUrl = alteredUrlWithKeyAuth;\n        }\n      } else {\n        modifiedUrl = url(extent, resolution, projection);\n      }\n      xhr.open( 'GET', modifiedUrl);\n      if (interceptor) {\n        interceptor.interceptXhr(xhr, modifiedUrl);\n      }\n\n      if (format.getType() === 'arraybuffer') {\n        xhr.responseType = 'arraybuffer';\n      }\n      xhr.onload = (event) => {\n        if (!xhr.status || xhr.status >= 200 && xhr.status < 300) {\n          const type = format.getType();\n          let source;\n          if (type === 'json' || type === 'text') {\n            source = xhr.responseText;\n          }\n          else if (type === 'xml') {\n            source = xhr.responseXML;\n            if (!source) {\n              source = new DOMParser().parseFromString(xhr.responseText, 'application/xml');\n            }\n          }\n          else if (type === 'arraybuffer') {\n            source = xhr.response;\n          }\n          if (source) {\n            success.call(this, format.readFeatures(source, {\n              extent,\n              featureProjection: projection\n            }), format.readProjection(source));\n          }\n          else {\n            // TODO\n            failure.call(this);\n          }\n        } else {\n          // TODO\n          failure.call(this);\n        }\n      };\n      xhr.onerror = () => {\n        // TODO\n        failure.call(this);\n      };\n      xhr.send();\n    });\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","import {\n  Directive,\n  Input,\n  OnDestroy,\n  Self,\n  OnInit,\n  HostListener\n} from '@angular/core'\n  ;\nimport olLayerVectorTile from 'ol/layer/VectorTile';\nimport olLayerVector from 'ol/layer/Vector';\n\nimport { Subscription } from 'rxjs';\nimport olVectorTileSource from 'ol/source/VectorTile';\n\nimport type { default as OlMapBrowserEvent } from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlFeature from 'ol/Feature';\nimport * as OlStyle from 'ol/style';\nimport * as OlGeom from 'ol/geom';\n\nimport { EntityStore } from '@igo2/common';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { VectorLayer, Layer, VectorTileLayer } from '../../layer/shared/layers';\nimport { take } from 'rxjs/operators';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\nimport { MediaService } from '@igo2/core';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { unByKey } from 'ol/Observable';\nimport RenderFeature from 'ol/render/Feature';\nimport { StyleByAttribute } from '../../layer/shared/vector-style.interface';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoHoverFeature]'\n})\nexport class HoverFeatureDirective implements OnInit, OnDestroy {\n\n  public store: FeatureStore<Feature>;\n  private pointerHoverFeatureStore: EntityStore<OlFeature<OlGeometry>> = new EntityStore<OlFeature<OlGeometry>>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n\n  private selectionLayer: olLayerVectorTile;\n  private selectionMVT = {};\n  private mvtStyleOptions: StyleByAttribute;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private singleClickMapListener;\n\n  private hoverFeatureId: string = 'hoverFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoHoverFeatureDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoHoverFeatureEnabled: boolean = false;\n\n  @HostListener('mouseout')\n  mouseout() {\n    clearTimeout(this.lastTimeoutRequest);\n    this.clearLayer();\n  }\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService,\n    private styleService: StyleService,\n  ) { }\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.listenToMapPointerMove();\n    this.subscribeToPointerStore();\n    this.listenToMapClick();\n\n    this.map.status$.pipe(take(1)).subscribe(() => {\n      this.store = new FeatureStore<Feature>([], { map: this.map });\n      this.initStore();\n    });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers: Layer[]) => {\n      if (this.store && !layers.find(l => l.id === 'hoverFeatureId')) {\n        this.initStore();\n      }\n    });\n\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'hoverFeatureId',\n      title: 'hoverFeature',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: hoverFeatureMarker\n    });\n    tryBindStoreLayer(store, layer);\n\n    this.selectionLayer = new olLayerVectorTile({\n      map: this.map.ol,\n      zIndex: 901,\n      renderMode: \"vector\",\n      declutter: true,\n      source: new olVectorTileSource({}),\n      style: (feature, resolution) => {\n        if (this.mvtStyleOptions && feature.getId() in this.selectionMVT) {\n          return this.createHoverStyle(feature, this.mvtStyleOptions, resolution);\n        }\n      }\n    });\n  }\n\n  createHoverStyle(feature: RenderFeature | OlFeature<OlGeometry>, hoverStyle: StyleByAttribute, resolution: number) {\n    const localHoverStyle = { ...hoverStyle };\n    let label = hoverStyle.label ? hoverStyle.label.attribute : undefined;\n    let hasLabelStyle = hoverStyle.label?.style ? true : false;\n\n    if (!feature.get('_isLabel')) {\n      localHoverStyle.label = undefined;\n      hasLabelStyle = false;\n      label = undefined;\n    } else {\n      // clear the style for label....\n      const size = localHoverStyle.data ? localHoverStyle.data.length : 0;\n      const radius = [];\n      const stroke = [];\n      const width = [];\n      const fill = [];\n      for (let i = 0; i < size; i++) {\n        radius.push(0);\n        stroke.push('rgba(255, 255, 255, 0)');\n        width.push(0);\n        fill.push('rgba(255, 255, 255, 0)');\n      }\n      localHoverStyle.radius = radius;\n      localHoverStyle.stroke = stroke;\n      localHoverStyle.width = width;\n      localHoverStyle.fill = fill;\n    }\n    if (!hasLabelStyle && label) {\n      localHoverStyle.label.style =\n      {\n        textAlign: 'left',\n        textBaseline: 'top',\n        font: '12px Calibri,sans-serif',\n        fill: { color: '#000' },\n        backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\n        backgroundStroke: { color: 'rgba(200, 200, 200, 0.75)', width: 2 },\n        stroke: { color: '#fff', width: 3 },\n        overflow: true,\n        offsetX: 10,\n        offsetY: 20,\n        padding: [2.5, 2.5, 2.5, 2.5]\n      };\n    }\n    return this.styleService.createStyleByAttribute(feature, localHoverStyle, resolution);\n  }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unlistenToMapSingleClick();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerHoverFeatureStore.entities$.subscribe(resultsUnderPointerPosition => {\n      this.entitiesToPointerOverlay(resultsUnderPointerPosition);\n    });\n  }\n\n  /**\n   * convert store entities to a pointer position overlay with label summary on.\n   * @param event OL map browser pointer event\n   */\n  private entitiesToPointerOverlay(resultsUnderPointerPosition: OlFeature<OlGeometry>[]) {\n\n    this.addFeatureOverlay(resultsUnderPointerPosition);\n\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: OlMapBrowserEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * On map singleclick\n   */\n  private listenToMapClick() {\n    this.singleClickMapListener = this.map.ol.on(\n      'singleclick',\n      (event: OlMapBrowserEvent<any>) => this.onMapSingleClickEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map singleclick\n   * @internal\n   */\n  private unlistenToMapSingleClick() {\n    unByKey(this.singleClickMapListener);\n    this.singleClickMapListener = undefined;\n  }\n\n  /**\n   * Trigger clear layer on singleclick.\n   * @param event OL map browser singleclick event\n   */\n  private onMapSingleClickEvent(event: OlMapBrowserEvent<any>) {\n    this.clearLayer();\n  }\n\n  /**\n   * Trigger hover when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: OlMapBrowserEvent<any>) {\n    if (\n      event.dragging || !this.igoHoverFeatureEnabled ||\n      this.mediaService.isTouchScreen()) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    this.clearLayer();\n    let maximumZindex = -Infinity;\n    let topMostOlLayer;\n    const pixel = this.map.ol.getPixelFromCoordinate(event.coordinate);\n    this.lastTimeoutRequest = setTimeout(() => {\n\n      // retrieve the topmost layer with feature to only apply the hover on this layer.\n      this.map.ol.forEachFeatureAtPixel(pixel, (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\n        if (!layerOL) {\n          return;\n        }\n        const igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid);\n        if (!this.canProcessHover(igoLayer as any)) {\n          return;\n        }\n        if (igoLayer.zIndex <= maximumZindex) {\n          return;\n        }\n        maximumZindex = igoLayer.zIndex;\n        topMostOlLayer = layerOL;\n\n      }, {\n        hitTolerance: 10, layerFilter: olLayer => olLayer instanceof olLayerVector || olLayer instanceof olLayerVectorTile\n      });\n      if (!topMostOlLayer) {\n        return;\n      }\n\n      this.clearLayer();\n      this.map.ol.forEachFeatureAtPixel(pixel, (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\n        if (mapFeature.get('hoverSummary') === undefined) {\n          let igoLayer;\n          if (layerOL instanceof olLayerVector) {\n            igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid) as VectorLayer;\n            if (!this.canProcessHover(igoLayer)) {\n              return;\n            }\n            let localOlFeature = this.handleRenderFeature(mapFeature);\n            this.setLayerStyleFromOptions(igoLayer, localOlFeature);\n            const featuresToLoad = [localOlFeature];\n            localOlFeature.set(\"_isLabel\", false);\n            const myLabelOlFeature = new OlFeature();\n            myLabelOlFeature.setProperties(localOlFeature.getProperties());\n            const labelGeom =\n              localOlFeature.getGeometry().getType() === 'Point' ? localOlFeature.getGeometry() : new OlGeom.Point(event.coordinate);\n            myLabelOlFeature.setGeometry(labelGeom);\n            myLabelOlFeature.setId(localOlFeature.getId());\n            myLabelOlFeature.set(\"_isLabel\", true);\n            this.setLayerStyleFromOptions(igoLayer, myLabelOlFeature);\n            featuresToLoad.push(myLabelOlFeature);\n            this.pointerHoverFeatureStore.load(featuresToLoad);\n            return true;\n          }\n          if (layerOL instanceof olLayerVectorTile) {\n            igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid) as VectorTileLayer;\n            if (!this.canProcessHover(igoLayer)) {\n              return;\n            }\n            if (igoLayer?.options?.styleByAttribute?.hoverStyle) {\n              this.mvtStyleOptions = igoLayer.options.styleByAttribute.hoverStyle;\n            } else if (igoLayer?.options?.hoverStyle) {\n              this.mvtStyleOptions = igoLayer.options.hoverStyle;\n            }\n            this.selectionLayer.setSource(layerOL.getSource());\n            layerOL.getFeatures(event.pixel).then((mvtFeatures: (RenderFeature | OlFeature<OlGeometry>)[]) => {\n              if (!mvtFeatures.length) {\n                this.selectionMVT = {};\n                this.selectionLayer.changed();\n                this.clearLayer();\n                return;\n              }\n              const feature = mvtFeatures[0];\n              if (!feature) {\n                this.clearLayer();\n                return;\n              }\n              let localOlFeature = this.handleRenderFeature(feature);\n              localOlFeature.set(\"_isLabel\", false);\n              const myLabelOlFeature = new OlFeature();\n              myLabelOlFeature.setProperties(localOlFeature.getProperties());\n              const labelGeom =\n              localOlFeature.getGeometry().getType() === 'Point' ? localOlFeature.getGeometry() : new OlGeom.Point(event.coordinate);\n              myLabelOlFeature.setGeometry(labelGeom);\n              myLabelOlFeature.setId(localOlFeature.getId());\n              myLabelOlFeature.set(\"_isLabel\", true);\n              this.setLayerStyleFromOptions(igoLayer, myLabelOlFeature);\n              this.pointerHoverFeatureStore.load([myLabelOlFeature]);\n              this.selectionMVT[feature.getId()] = localOlFeature;\n              this.selectionLayer.changed();\n            });\n          }\n        }\n        return true;\n      }, {\n        hitTolerance: 10, layerFilter: olLayer => olLayer === topMostOlLayer\n      });\n    }, this.igoHoverFeatureDelay);\n  }\n\n  canProcessHover(igoLayer: VectorLayer | VectorTileLayer): boolean {\n    if (!igoLayer) {\n      return false;\n    }\n    if (!igoLayer.visible) {\n      return false;\n    }\n    if (!igoLayer.options) {\n      return false;\n    }\n\n    if (!igoLayer.options.styleByAttribute && !igoLayer.options.hoverStyle) {\n      return false;\n    }\n\n    if (\n      (igoLayer.options.styleByAttribute && !igoLayer.options.styleByAttribute.hoverStyle) &&\n      !igoLayer.options.hoverStyle) {\n      return false;\n    }\n    return true;\n  }\n\n  handleRenderFeature(feature: RenderFeature | OlFeature<OlGeometry>): OlFeature<OlGeometry> {\n    let localFeature: OlFeature<OlGeometry>;\n    if (feature instanceof RenderFeature) {\n      localFeature = new OlFeature({\n        geometry: this.getGeometry(feature)\n      });\n      localFeature.setId(feature.getId());\n    } else if (feature instanceof OlFeature) {\n      localFeature = feature;\n    }\n    return localFeature;\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addFeatureOverlay(hoverEntity: OlFeature<OlGeometry>[]) {\n\n    if (hoverEntity.length > 0) {\n\n      const result = hoverEntity[0];\n      this.clearLayer();\n      const feature = new OlFeature({\n        geometry: result.getGeometry(),\n        meta: { id: this.hoverFeatureId },\n        hoverSummary: this.getHoverSummary(result.getProperties())\n      });\n\n      this.store.setLayerOlFeatures([feature], FeatureMotion.None);\n    }\n  }\n\n  private setLayerStyleFromOptions(igoLayer: VectorLayer | VectorTileLayer, feature: OlFeature<OlGeometry>) {\n    const resolution = this.store.layer.map.viewController.getResolution();\n    if (igoLayer?.options?.styleByAttribute?.hoverStyle) {\n      this.store.layer.ol.setStyle(this.createHoverStyle(feature, igoLayer.options.styleByAttribute.hoverStyle, resolution));\n      return;\n    }\n    if (igoLayer?.options?.hoverStyle) {\n      this.store.layer.ol.setStyle(this.createHoverStyle(feature, igoLayer.options.hoverStyle, resolution));\n    }\n  }\n\n  private getHoverSummary(properties): string {\n    let summary = '';\n    for (const [key, value] of Object.entries(properties)) {\n      if (!key.startsWith('_') && key !== 'geometry') {\n        summary += `${key}: ${value}` + '\\n';\n      }\n    }\n    return summary.length >= 2 ? summary.slice(0, -2) : summary;\n  }\n\n  private getGeometry(feature): OlGeom.Geometry {\n    let geom;\n    if (!feature.getOrientedFlatCoordinates) {\n      geom = feature.getGeometry();\n    } else {\n\n      const coords = feature.getOrientedFlatCoordinates();\n      const flatCoords = [];\n\n      coords.forEach((c, idx) => {\n        if (idx % 2 === 0) {\n          flatCoords.push([parseFloat(coords[idx]), parseFloat(coords[idx + 1])]);\n        }\n      });\n\n      // TODO: test MultiX\n      switch (feature.getType()) {\n        case 'Point':\n          geom = new OlGeom.Point(flatCoords);\n          break;\n        case 'Polygon':\n          geom = new OlGeom.Polygon([flatCoords]);\n          break;\n        case 'LineString':\n          geom = new OlGeom.LineString([flatCoords]);\n          break;\n      }\n    }\n\n    return geom;\n  }\n\n\n  /**\n   * Clear the pointer store features\n   */\n  private clearLayer() {\n    this.selectionMVT = {};\n    if (this.selectionLayer) {\n      this.selectionLayer.changed();\n    }\n    if (this.store) {\n      this.store.clearLayer();\n    }\n  }\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function hoverFeatureMarker(feature: OlFeature<OlGeom.Geometry>, resolution: number): OlStyle.Style[] {\n\n  const olStyleText = new OlStyle.Style({\n    text: new OlStyle.Text({\n      text: feature.get('hoverSummary'),\n      textAlign: 'left',\n      textBaseline: 'top',\n      font: '12px Calibri,sans-serif',\n      fill: new OlStyle.Fill({ color: '#000' }),\n      backgroundFill: new OlStyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n      backgroundStroke: new OlStyle.Stroke({ color: 'rgba(200, 200, 200, 0.75)', width: 2 }),\n      stroke: new OlStyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true,\n      offsetX: 10,\n      offsetY: 20,\n      padding: [2.5, 2.5, 2.5, 2.5]\n    })\n  });\n\n  const olStyle = [olStyleText];\n  switch (feature.getGeometry().getType()) {\n    case 'Point':\n      olStyle.push(new OlStyle.Style({\n        image: new OlStyle.Circle({\n          radius: 10,\n          stroke: new OlStyle.Stroke({\n            color: 'blue',\n            width: 3\n          })\n        })\n      }));\n      break;\n    default:\n      olStyle.push(new OlStyle.Style({\n        stroke: new OlStyle.Stroke({\n          color: 'white',\n          width: 5\n        })\n      }));\n      olStyle.push(new OlStyle.Style({\n        stroke: new OlStyle.Stroke({\n          color: 'blue',\n          width: 3\n        })\n      }));\n  }\n\n  return olStyle;\n\n}\n","import { Component, Input } from '@angular/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-zoom-button',\n  templateUrl: './zoom-button.component.html',\n  styleUrls: ['./zoom-button.component.scss']\n})\nexport class ZoomButtonComponent {\n\n  @Input() map: IgoMap;\n\n  @Input() color: string;\n\n  get zoom(): number { return this.map.viewController.getZoom(); }\n\n  get minZoom(): number { return this.map.viewController.olView.getMinZoom() || 1; }\n\n  get maxZoom(): number { return this.map.viewController.olView.getMaxZoom(); }\n\n  constructor() {}\n}\n","<div class=\"igo-zoom-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomIn' | translate: {zoom: zoom + 1}\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom >= maxZoom\"\n    (click)=\"map.viewController.zoomIn()\">\n    <mat-icon svgIcon=\"plus\"></mat-icon>\n  </button>\n\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomOut' | translate: {zoom: zoom - 1}\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom <= minZoom\"\n    (click)=\"map.viewController.zoomOut()\">\n    <mat-icon svgIcon=\"minus\"></mat-icon>\n  </button>\n</div>\n","<div class=\"igo-geolocate-button-container\" *ngIf=\"map.geolocationController\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.geolocate' | translate\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    (click)=\"onGeolocationClick()\">\n    <mat-icon svgIcon=\"{{icon$ | async}}\"></mat-icon>\n  </button>\n</div>\n","import { AfterContentInit, Component, Input, OnDestroy } from '@angular/core';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-geolocate-button',\n  templateUrl: './geolocate-button.component.html',\n  styleUrls: ['./geolocate-button.component.scss']\n})\nexport class GeolocateButtonComponent implements AfterContentInit, OnDestroy {\n\n  private tracking$$: Subscription;\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject('crosshairs-gps');\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  constructor() {}\n  ngAfterContentInit(): void {\n    this.map.ol.once('rendercomplete', () => {\n      this.tracking$$ =this.map.geolocationController.tracking$.subscribe(tracking => {\n        if (tracking) {\n          this.icon$.next('crosshairs-gps');\n        } else {\n          this.icon$.next('crosshairs');\n        }\n      });\n    });\n  }\n\n  ngOnDestroy(): void {\n    if (this.tracking$$) {\n      this.tracking$$.unsubscribe();\n    }\n  }\n\n  onGeolocationClick() {\n    const tracking = this.map.geolocationController.tracking;\n    this.map.geolocationController.tracking = tracking ? false : true;\n  }\n}\n","import { ConfigService } from '@igo2/core';\r\nimport { Component, Input } from '@angular/core';\r\nimport { IgoMap } from '../shared/map';\r\nimport { MapExtent } from '../shared/map.interface';\r\nimport * as olproj from 'ol/proj';\r\n/*\r\nButton to center the map to the home extent\r\n*/\r\n@Component({\r\n  selector: 'igo-home-extent-button',\r\n  templateUrl:'./home-extent-button.component.html',\r\n  styleUrls: ['./home-extent-button.component.scss'],\r\n})\r\nexport class HomeExtentButtonComponent {\r\n  @Input() map: IgoMap;\r\n  @Input() color: string;\r\n  @Input() extentOverride?: MapExtent\r\n  @Input() centerOverride?: [number, number];\r\n  @Input() zoomOverride?: number;\r\n\r\n  private homeExtentButtonExtent;\r\n  private homeExtentButtonCenter;\r\n  private homeExtentButtonZoom;\r\n\r\n constructor(public configService: ConfigService) {\r\n      this.computeHomeExtent();\r\n  }\r\n\r\n  computeHomeExtent() {\r\n    this.homeExtentButtonExtent = this.extentOverride || this.configService.getConfig('homeExtentButton.homeExtButtonExtent');\r\n    this.homeExtentButtonCenter = this.centerOverride || this.configService.getConfig('homeExtentButton.homeExtButtonCenter');\r\n    this.homeExtentButtonZoom = this.zoomOverride || this.configService.getConfig('homeExtentButton.homeExtButtonZoom');\r\n\r\n    // priority over extent if these 2 properties are defined;\r\n    if (this.centerOverride && this.zoomOverride) {\r\n      this.homeExtentButtonExtent = undefined;\r\n    }\r\n  }\r\n\r\n  onToggleClick() {\r\n    this.computeHomeExtent();\r\n    if (this.homeExtentButtonExtent) {\r\n      this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);\r\n    } else if (this.homeExtentButtonCenter && this.homeExtentButtonZoom) {\r\n      const center = olproj.fromLonLat(this.homeExtentButtonCenter, this.map.viewController.olView.getProjection().getCode());\r\n      this.map.viewController.olView.setCenter(center);\r\n      this.map.viewController.zoomTo(this.homeExtentButtonZoom);\r\n    }\r\n  }\r\n}\r\n","<div class=\"igo-home-extent-button-container\"><button\r\n    mat-icon-button\r\n    [matTooltip]=\"'igo.geo.mapButtons.home-extent' | translate\"\r\n            matTooltipPosition=\"left\"\r\n    [color]=\"color\"\r\n    (click)=\"onToggleClick()\"><mat-icon svgIcon = \"home-map-marker\"></mat-icon></button></div>\r\n","<div *ngIf=\"visible\" class=\"igo-wake-lock-button-container\">\n  <div>\n    <button \n      [color]=\"color\"\n      mat-icon-button\n      [matTooltip]=\"enabled ? ('igo.geo.mapButtons.preventSreenLock' | translate): ('igo.geo.mapButtons.letScreenLock' | translate)\"\n      matTooltipPosition=\"left\"\n      (click)=\"toggleWakeLock()\">\n      <mat-icon svgIcon=\"{{icon$ | async}}\"></mat-icon>\n    </button>\n  </div>\n</div>","import { Component, Input } from '@angular/core';\nimport { ConfigService, StorageService } from '@igo2/core';\nimport { BehaviorSubject } from 'rxjs';\nimport NoSleep from 'nosleep.js';\nimport { IgoMap } from '../shared/map';\nimport { userAgent } from '@igo2/utils';\n\n@Component({\n  selector: 'igo-wake-lock-button',\n  templateUrl: './wake-lock-button.component.html',\n  styleUrls: ['./wake-lock-button.component.scss']\n})\n\n/**\n * Prevent display sleep and enable wake lock in all Android and iOS web browsers.\n * On iOS, the Wake Lock API is not supported\n * https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API\n * On not supported browser, a fake video is used to keep the screen open.\n *\n * TODO: When the API will be supported by every browser, We should remove the NoSleep.js dependency\n * and replace it by a WakeLock API implementation.\n */\nexport class WakeLockButtonComponent {\n\n  @Input() color: string = 'primary';\n  @Input() map: IgoMap;\n  @Input()\n  get enabled(): boolean {\n    return this.storageService.get('wakeLockEnabled') as boolean;\n  }\n  set enabled(value: boolean) {\n    this.storageService.set('wakeLockEnabled', value);\n  }\n\n  private noSleep: NoSleep;\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject('sleep');\n  public visible = false;\n\n  constructor(\n    private config: ConfigService,\n    private storageService: StorageService\n  ) {\n    this.visible = this.config.getConfig('wakeLockApiButton') ? true : false;\n    this.noSleep = new NoSleep();\n    const nonWakeLockApiBrowser = userAgent.satisfies({\n      ie: '>0',\n      edge: '<84',\n      chrome: '<84',\n      firefox: '>0',\n      opera: '<70',\n      safari: '>0'\n    });\n    if (nonWakeLockApiBrowser) {\n      this.disableWakeLock();\n      this.enabled = false;\n      window.onblur = () => {\n        this.disableWakeLock();\n        this.enabled = false;\n    };\n    }\n    this.enabled ? this.enableWakeLock() : this.disableWakeLock();\n  }\n\n  /**\n   * Prevent display sleep and enable wake lock in all Android and iOS web browsers.\n   * On iOS, the Wake Lock API is not supported\n   * https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API\n   * On not supported browser, a fake video is used to keep the screen open.\n   */\n  private enableWakeLock() {\n    this.noSleep.enable();\n    this.enabled = true;\n    this.icon$.next('sleep-off');\n  }\n  /**\n   * Let display sleep\n   */\n  private disableWakeLock() {\n    this.noSleep.disable();\n    this.enabled = false;\n    this.icon$.next('sleep');\n  }\n\n  toggleWakeLock() {\n    if (this.enabled) {\n      this.disableWakeLock();\n    } else {\n      this.enableWakeLock();\n    }\n  }\n}\n","<div *ngIf=\"baseLayers.length > 0\"\n     class=\"igo-baselayers-switcher-container\"\n     [ngClass]=\"{'container-expand': expand}\"\n     [@baseLayerSwitcherState]=\"expand ? 'expand' : useStaticIcon ? 'collapseIcon' : 'collapseMap'\"\n     (@baseLayerSwitcherState.start)=\"showButton=false\"\n     (@baseLayerSwitcherState.done)=\"showButton=true\"\n     (click)=\"collapseOrExpand()\">\n\n     <div *ngIf=\"useStaticIcon && !expand && showButton\" class=\"igo-baselayers-switcher-button-container\">\n       <button\n         mat-icon-button\n         [matTooltip]=\"'igo.geo.mapButtons.baselayerSwitcher' | translate\"\n         matTooltipPosition=\"right\"\n         color=\"primary\">\n         <mat-icon svgIcon=\"image-multiple\"></mat-icon>\n       </button>\n     </div>\n\n     <igo-mini-basemap class=\"mat-typography\" *ngFor=\"let baseLayer of baseLayers; let i = index\"\n       [map]=\"map\"\n       [baseLayer]=\"baseLayer\"\n       [title]=\"(baseLayers.length > 2 && !expand) ? ('igo.geo.baselayersSwitcher.title' | translate) : baseLayer.title\"\n       [display]=\"expand || (i === 0 && !useStaticIcon)\"\n       [disabled]=\"!expand && baseLayers.length > 1\">\n     </igo-mini-basemap>\n\n    <div class=\"more-baselayers\">\n      <mat-icon class=\"material-icons mat-icon mat-list-avatar\" color=\"primary\" svgIcon=\"menu-down\"></mat-icon>\n    </div>\n\n</div>\n","import { Component, Input, AfterViewInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { MediaService, Media } from '@igo2/core';\nimport { Layer } from '../../layer';\nimport { IgoMap } from '../shared';\nimport { baseLayersSwitcherSlideInOut } from './baselayers-switcher.animation';\n\n@Component({\n  selector: 'igo-baselayers-switcher',\n  templateUrl: './baselayers-switcher.component.html',\n  styleUrls: ['./baselayers-switcher.component.scss'],\n  animations: [baseLayersSwitcherSlideInOut()]\n})\nexport class BaseLayersSwitcherComponent implements AfterViewInit, OnDestroy {\n  @Input() map: IgoMap;\n  @Input() useStaticIcon: boolean;\n\n  public _baseLayers: Layer[] = [];\n  public expand = false;\n  public showButton = true;\n\n  private layers$$: Subscription;\n\n  constructor(private mediaService: MediaService) {\n    const media = this.mediaService.media$.value;\n    if (media === Media.Mobile && this.useStaticIcon === undefined) {\n      this.useStaticIcon = true;\n    }\n  }\n\n  ngAfterViewInit() {\n    this.layers$$ = this.map.layers$.subscribe(arrayLayers => {\n      this._baseLayers = arrayLayers.filter(l => l.baseLayer);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n\n  collapseOrExpand() {\n    if (this.baseLayers.length > 1 || this.useStaticIcon) {\n      this.expand = !this.expand;\n    } else {\n      this.expand = false;\n    }\n  }\n\n  get baseLayers(): Layer[] {\n    const mapResolution = this.map.viewController.getResolution();\n    const mapZoom = this.map.viewController.getZoom();\n\n    const bl = this._baseLayers.filter(l => {\n      return (\n        (!l.options.maxResolution ||\n          mapResolution <= l.options.maxResolution) &&\n        (!l.options.minResolution || mapResolution >= l.options.minResolution) &&\n        (!l.options.source.options.maxZoom || mapZoom <= l.options.source.options.maxZoom) &&\n        (!l.options.source.options.minZoom || mapZoom >= l.options.source.options.minZoom)\n      );\n    });\n\n    const blHidden = bl.filter(l => !l.visible);\n    return blHidden.length + 1 === bl.length ? blHidden : bl;\n  }\n}\n","import {\n  trigger,\n  state,\n  style,\n  transition,\n  animate,\n  AnimationTriggerMetadata\n} from '@angular/animations';\n\nexport function baseLayersSwitcherSlideInOut(): AnimationTriggerMetadata {\n  return trigger('baseLayerSwitcherState', [\n    state(\n      'collapseIcon',\n      style({\n        height: '40px',\n        width: '40px',\n        overflow: 'hidden'\n      })\n    ),\n    state(\n      'collapseMap',\n      style({\n        height: '85px',\n        overflow: 'hidden'\n      })\n    ),\n    state(\n      'expand',\n      style({\n        overflow: 'hidden'\n      })\n    ),\n    transition('collapse => expand', animate('200ms')),\n    transition('expand => collapse', animate('200ms'))\n  ]);\n}\n","import { Injectable } from '@angular/core';\nimport { DBMode, NgxIndexedDBService } from 'ngx-indexed-db';\nimport { Observable, of, Subject } from 'rxjs';\nimport { concatMap, first, map, take } from 'rxjs/operators';\nimport { CompressionService } from '@igo2/core';\nimport { GeoDBData } from './geoDB.interface';\nimport { InsertSourceInsertDBEnum } from './geoDB.enums';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class GeoDBService {\n  readonly dbName: string = 'geoData';\n  public collisionsMap: Map<number, string[]> = new Map();\n  public _newTiles: number = 0;\n\n  constructor(\n    private ngxIndexedDBService: NgxIndexedDBService,\n    private compression: CompressionService\n  ) { }\n\n  /**\n   * Only blob can be will be compressed\n   * @param url\n   * @param regionID\n   * @param object object to handle\n   * @param insertSource type of event user or system\n   * @param insertEvent Name of the event where the insert has been triggered\n   * @returns\n   */\n  update(url: string, regionID: number, object: any, insertSource: InsertSourceInsertDBEnum, insertEvent: string): Observable<any> {\n    if (!object) {\n      return;\n    }\n    let compress = false;\n\n    const subject: Subject<GeoDBData> = new Subject();\n    let object$: Observable<any> = of(object);\n    if (object instanceof Blob) {\n      object$ = this.compression.compressBlob(object);\n      compress = true;\n    }\n    let geoDBData: GeoDBData;\n    object$.pipe(\n      first(),\n      concatMap(object => {\n        geoDBData = {\n          url,\n          regionID,\n          object: object,\n          compressed: compress,\n          insertSource,\n          insertEvent\n        };\n        return this.ngxIndexedDBService.getByID(this.dbName, url);\n      }),\n      concatMap((dbObject: GeoDBData) => {\n        if (!dbObject) {\n          this._newTiles++;\n          return this.ngxIndexedDBService.add(this.dbName, geoDBData);\n        } else {\n          const currentRegionID = dbObject.regionID;\n          if (currentRegionID !== regionID) {\n            const collisions = this.collisionsMap.get(currentRegionID);\n            if (collisions !== undefined) {\n              collisions.push(dbObject.url);\n              this.collisionsMap.set(currentRegionID, collisions);\n            } else {\n              this.collisionsMap.set(currentRegionID, [dbObject.url]);\n            }\n          }\n          return this.customUpdate(geoDBData);\n        }\n      })\n    ).subscribe((response) => {\n      subject.next(response);\n      subject.complete();\n    });\n    return subject;\n  }\n\n  private customUpdate(geoDBData: GeoDBData): Observable<GeoDBData> {\n    const subject: Subject<GeoDBData> = new Subject();\n    const deleteRequest = this.ngxIndexedDBService.deleteByKey(this.dbName, geoDBData.url);\n    deleteRequest.pipe(\n      concatMap(isDeleted => isDeleted ? this.ngxIndexedDBService.add(this.dbName, geoDBData) : of(undefined))\n    )\n    .subscribe(object => {\n      if (object) {\n        subject.next(object);\n      }\n      subject.complete();\n    });\n    return subject;\n  }\n\n  get(url: string): Observable<any> {\n    return this.ngxIndexedDBService.getByID(this.dbName, url).pipe(\n      map((data: GeoDBData) => {\n        if (data) {\n          const object = data.object;\n          if (!data.compressed) {\n            return object;\n          }\n          return this.compression.decompressBlob(object);\n        }\n      })\n    );\n  }\n\n  getRegionTileCountByID(id: number): Observable<number> {\n    const subject: Subject<number> = new Subject();\n    const dbRequest = this.getRegionByID(id)\n      .subscribe((tiles) => {\n        subject.next(tiles.length);\n        subject.complete();\n      });\n    return subject;\n  }\n\n  getRegionByID(id: number): Observable<any[]> {\n    if (!id) {\n      return;\n    }\n\n    const IDBKey: IDBKeyRange = IDBKeyRange.only(id);\n    const dbRequest = this.ngxIndexedDBService.getAllByIndex(this.dbName, 'regionID', IDBKey);\n    return dbRequest;\n  }\n\n  deleteByRegionID(id: number): Observable<any> {\n    if (!id) {\n      return;\n    }\n\n    const IDBKey: IDBKeyRange = IDBKeyRange.only(id);\n    const dbRequest = this.ngxIndexedDBService.getAllByIndex(this.dbName, 'regionID', IDBKey);\n    dbRequest.subscribe((tiles: GeoDBData[]) => {\n      tiles.forEach((tile) => {\n        this.ngxIndexedDBService.deleteByKey(this.dbName, tile.url);\n      });\n    });\n    return dbRequest;\n  }\n\n  openCursor(\n    keyRange: IDBKeyRange = IDBKeyRange.lowerBound(0),\n    mode: DBMode = DBMode.readonly\n  ) {\n    const request = this.ngxIndexedDBService.openCursorByIndex(this.dbName, 'regionID', keyRange, mode);\n    return request;\n  }\n\n  resetCounters() {\n    this.resetCollisionsMap();\n    this._newTiles = 0;\n  }\n\n  resetCollisionsMap() {\n    this.collisionsMap = new Map();\n  }\n\n  revertCollisions() {\n    for (const [regionID, collisions] of this.collisionsMap) {\n      for (const url of collisions) {\n        this.ngxIndexedDBService.getByKey(this.dbName, url)\n          .pipe(take(1))\n          .subscribe((dbObject: GeoDBData) => {\n            const updatedObject = dbObject;\n            updatedObject.regionID = regionID;\n            this.customUpdate(dbObject);\n          });\n      }\n    }\n  }\n\n  get newTiles(): number {\n    return this._newTiles;\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { ConnectionState, NetworkService } from '@igo2/core';\nimport { Observable } from 'rxjs';\nimport { GeoDBService } from '../geoDB/geoDB.service';\n\nexport enum ResponseType {\n  Arraybuffer= 'arraybuffer',\n  Blob= 'blob',\n  Text= 'text',\n  Json= 'json',\n}\nexport interface SimpleGetOptions {\n  responseType: ResponseType;\n  withCredentials?: boolean;\n}\n@Injectable({\n  providedIn: 'root'\n})\nexport class GeoNetworkService {\n  private networkOnline: boolean = true;\n  constructor(\n    private http: HttpClient,\n    public geoDBService: GeoDBService,\n    private networkService: NetworkService,\n  ) {\n    this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.networkOnline = state.connection;\n    });\n  }\n\n  get(url: string, simpleGetOptions: SimpleGetOptions): Observable<any> {\n    if (window.navigator.onLine && this.networkOnline) {\n      return this.getOnline(url, simpleGetOptions);\n    }\n    return this.getOffline(url);\n  }\n\n  private getOnline(url: string, simpleGetOptions: SimpleGetOptions): Observable<any> {\n    let request;\n    switch (simpleGetOptions.responseType) {\n      // TODO Ajuster pour autre formats\n      case 'arraybuffer':\n        request = this.http.get(url, { responseType: 'arraybuffer', withCredentials: simpleGetOptions.withCredentials });\n        break;\n      case 'blob':\n        request = this.http.get(url, { responseType: 'blob', withCredentials: simpleGetOptions.withCredentials });\n        break;\n      case 'text':\n        request = this.http.get(url, { responseType: 'text', withCredentials: simpleGetOptions.withCredentials });\n          break;\n      case 'json':\n        request = this.http.get(url, { responseType: 'json', withCredentials: simpleGetOptions.withCredentials });\n        break;\n      default:\n        request = this.http.get(url, { responseType: 'blob', withCredentials: simpleGetOptions.withCredentials });\n        break;\n    }\n    return request;\n  }\n\n  private getOffline(url: string): Observable<any> {\n    return this.geoDBService.get(url);\n  }\n\n  public isOnline() {\n    return this.networkOnline && window.navigator.onLine;\n  }\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, of } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport stylefunction from 'ol-mapbox-style/dist/stylefunction';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { Style } from 'ol/style';\n\nimport {\n  OSMDataSource,\n  FeatureDataSource,\n  XYZDataSource,\n  TileDebugDataSource,\n  WFSDataSource,\n  WMTSDataSource,\n  WMSDataSource,\n  CartoDataSource,\n  ImageArcGISRestDataSource,\n  ArcGISRestDataSource,\n  TileArcGISRestDataSource,\n  WebSocketDataSource,\n  MVTDataSource,\n  ClusterDataSource\n} from '../../datasource';\n\nimport { DataSourceService } from '../../datasource/shared/datasource.service';\n\nimport {\n  Layer,\n  ImageLayer,\n  ImageLayerOptions,\n  TileLayer,\n  TileLayerOptions,\n  VectorLayer,\n  VectorLayerOptions,\n  AnyLayerOptions,\n  VectorTileLayer,\n  VectorTileLayerOptions\n} from './layers';\n\nimport { computeMVTOptionsOnHover } from '../utils/layer.utils';\nimport { StyleService } from './style.service';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { GeoNetworkService } from '../../offline/shared/geo-network.service';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerService {\n  constructor(\n    private http: HttpClient,\n    private styleService: StyleService,\n    private dataSourceService: DataSourceService,\n    private geoNetwork: GeoNetworkService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    @Optional() private authInterceptor: AuthInterceptor\n  ) {}\n\n  createLayer(layerOptions: AnyLayerOptions): Layer {\n    if (!layerOptions.source) {\n      return;\n    }\n\n    if (\n      layerOptions.source.options &&\n      layerOptions.source.options._layerOptionsFromSource\n    ) {\n      layerOptions = ObjectUtils.mergeDeep(\n        layerOptions.source.options._layerOptionsFromSource,\n        layerOptions || {}\n      );\n    }\n\n    let layer;\n    switch (layerOptions.source.constructor) {\n      case OSMDataSource:\n      case WMTSDataSource:\n      case XYZDataSource:\n      case TileDebugDataSource:\n      case CartoDataSource:\n      case TileArcGISRestDataSource:\n        layer = this.createTileLayer(layerOptions as TileLayerOptions);\n        break;\n      case FeatureDataSource:\n      case WFSDataSource:\n      case ArcGISRestDataSource:\n      case WebSocketDataSource:\n      case ClusterDataSource:\n        layer = this.createVectorLayer(layerOptions as VectorLayerOptions);\n        break;\n      case ImageArcGISRestDataSource:\n      case WMSDataSource:\n        layer = this.createImageLayer(layerOptions as ImageLayerOptions);\n        break;\n      case MVTDataSource:\n        const _layerOptions = computeMVTOptionsOnHover(layerOptions);\n        layer = this.createVectorTileLayer(\n          _layerOptions as VectorTileLayerOptions\n        );\n        break;\n      default:\n        break;\n    }\n\n    return layer;\n  }\n\n  createAsyncLayer(_layerOptions: AnyLayerOptions, detailedContextUri?: string): Observable<Layer> {\n    const layerOptions = computeMVTOptionsOnHover(_layerOptions);\n    if (layerOptions.source) {\n      return new Observable(d => d.next(this.createLayer(layerOptions)));\n    }\n\n    return this.dataSourceService\n      .createAsyncDataSource(layerOptions.sourceOptions, detailedContextUri)\n      .pipe(\n        map(source => {\n          if (source === undefined) {\n            return undefined;\n          }\n          return this.createLayer(Object.assign(layerOptions, { source }));\n        })\n      );\n  }\n\n  private createImageLayer(layerOptions: ImageLayerOptions): ImageLayer {\n    return new ImageLayer(layerOptions, this.messageService, this.languageService, this.authInterceptor);\n  }\n\n  private createTileLayer(layerOptions: TileLayerOptions): TileLayer {\n    return new TileLayer(layerOptions, this.messageService, this.authInterceptor);\n  }\n\n  private createVectorLayer(layerOptions: VectorLayerOptions): VectorLayer {\n    let style: Style[] | Style | OlStyleLike;\n    let igoLayer: VectorLayer;\n    if (layerOptions.style !== undefined) {\n      style = (feature, resolution) => this.styleService.createStyle(layerOptions.style, feature, resolution);\n    }\n\n    if (layerOptions.source instanceof ArcGISRestDataSource) {\n      const source = layerOptions.source as ArcGISRestDataSource;\n      style = source.options.params.style;\n    } else if (layerOptions.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.styleByAttribute,\n          resolution\n        );\n      };\n      igoLayer = new VectorLayer(layerOptions, this.messageService, this.authInterceptor, this.geoNetwork);\n    }\n\n    if (layerOptions.source instanceof ClusterDataSource) {\n      const serviceStyle = this.styleService;\n      const baseStyle = layerOptions.clusterBaseStyle;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createClusterStyle(\n          feature,\n          resolution,\n          layerOptions.clusterParam,\n          baseStyle\n        );\n      };\n      igoLayer = new VectorLayer(layerOptions, this.messageService, this.authInterceptor, this.geoNetwork);\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!igoLayer) {\n      igoLayer = new VectorLayer(layerOptionsOl, this.messageService, this.authInterceptor, this.geoNetwork);\n    }\n\n    this.applyMapboxStyle(igoLayer, layerOptionsOl as any);\n\n    return igoLayer;\n  }\n\n  private createVectorTileLayer(\n    layerOptions: VectorTileLayerOptions\n  ): VectorTileLayer {\n    let style: Style[] | Style | OlStyleLike;\n    let igoLayer: VectorTileLayer;\n\n    if (layerOptions.style !== undefined) {\n      style = (feature, resolution) => this.styleService.createStyle(layerOptions.style, feature, resolution);\n    }\n\n    if (layerOptions.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.styleByAttribute,\n          resolution\n        );\n      };\n      igoLayer = new VectorTileLayer(layerOptions, this.messageService, this.authInterceptor);\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!igoLayer) {\n      igoLayer = new VectorTileLayer(layerOptionsOl, this.messageService, this.authInterceptor);\n    }\n\n    this.applyMapboxStyle(igoLayer, layerOptionsOl);\n    return igoLayer;\n  }\n\n  private applyMapboxStyle(layer: Layer, layerOptions: VectorTileLayerOptions) {\n    if (layerOptions.mapboxStyle) {\n      this.getStuff(layerOptions.mapboxStyle.url).subscribe(res => {\n        if (res.sprite){\n          const url = this.getAbsoluteUrl(layerOptions.mapboxStyle.url, res.sprite);\n          this.getStuff(url+'.json').subscribe(res2 => {\n            stylefunction(layer.ol, res, layerOptions.mapboxStyle.source, undefined, res2,\n              url+'.png');\n          });\n        } else {\n          stylefunction(layer.ol, res, layerOptions.mapboxStyle.source);\n        }\n      });\n    }\n  }\n\n  private getStuff(url: string) {\n    return this.http.get(url).pipe(\n      map((res: any) => res),\n      catchError(err => {\n        console.log('No style was found');\n        return of(err);\n      })\n    );\n  }\n\n  private getAbsoluteUrl(source, url) {\n    const r = new RegExp('^http|\\/\\/', 'i');\n    if(r.test(url)){\n      return url;\n    } else {\n      if ( source.substr(source.length -1) === \"/\"){\n        return source + url;\n      } else{\n        return source + \"/\" + url;\n      }\n    }\n  }\n\n}\n","<div class=\"igo-mini-basemap-container\">\n\n  <div *ngIf=\"display\" (click)=\"changeBaseLayer(baseLayer)\">\n    <igo-map-browser [map]=\"basemap\"></igo-map-browser>\n    <div *ngIf='title' class='igo-mini-basemap-title'> {{title}} </div>\n  </div>\n\n</div>\n","import {\n  Component,\n  Input,\n  AfterViewInit,\n  OnDestroy,\n  ApplicationRef\n} from '@angular/core';\n\nimport { Layer, LayerOptions } from '../../layer/shared';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { IgoMap } from '../shared';\n\nimport OlMap from 'ol/Map';\nimport OlView from 'ol/View';\n\n@Component({\n  selector: 'igo-mini-basemap',\n  templateUrl: './mini-basemap.component.html',\n  styleUrls: ['./mini-basemap.component.scss']\n})\nexport class MiniBaseMapComponent implements AfterViewInit, OnDestroy {\n\n  @Input() map: IgoMap;\n  @Input() disabled: boolean;\n  @Input() display: boolean;\n  @Input() title: string;\n\n  @Input()\n  get baseLayer(): Layer {\n    return this._baseLayer;\n  }\n  set baseLayer(value: Layer) {\n    this._baseLayer = value;\n    this.handleBaseLayerChanged(value);\n  }\n  private _baseLayer: Layer;\n\n  public basemap = new IgoMap({\n    controls: {},\n    interactions: false\n  });\n\n  constructor(\n    private layerService: LayerService,\n    private appRef: ApplicationRef\n  ) { }\n\n  ngAfterViewInit() {\n    this.handleMainMapViewChange(this.map.ol.getView());\n    this.map.viewController.olView.on('change', change => {\n      this.handleMainMapViewChange((change.target as OlView));\n    });\n    this.map.ol.on('pointerdrag', change => {\n      this.handleMainMapViewChange((change.target as OlMap).getView());\n    });\n  }\n\n  ngOnDestroy() {\n    this.map.viewController.olView.un('change', change => {\n      this.handleMainMapViewChange((change.target as OlView));\n    });\n    this.map.ol.un('pointerdrag', change => {\n      this.handleMainMapViewChange((change.target as OlMap).getView());\n    });\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (this.disabled) {\n      return;\n    }\n    this.map.changeBaseLayer(baseLayer);\n    this.appRef.tick();\n  }\n\n  private handleMainMapViewChange(mainMapView) {\n    const mainMapViewProperties = mainMapView.getProperties();\n    this.basemap.viewController.olView.setResolution(mainMapViewProperties.resolution);\n    this.basemap.viewController.olView.setRotation(mainMapViewProperties.rotation);\n    this.basemap.viewController.olView.setCenter(this.map.viewController.getCenter());\n  }\n\n  private handleBaseLayerChanged(baselayer: Layer) {\n    this.basemap.removeAllLayers();\n\n    const options: any = Object.assign(\n      Object.create(baselayer.options),\n      baselayer.options,\n      {\n        visible: true,\n        baseLayer: false\n      }\n    );\n\n    const layer = this.layerService.createLayer(options);\n    this.basemap.addLayer(layer);\n    this.handleLinkedBaseLayer(layer);\n  }\n\n  private handleLinkedBaseLayer(baselayer: Layer) {\n    const linkedLayers = baselayer.options.linkedLayers;\n    if (!linkedLayers) {\n      return;\n    }\n    const currentLinkedId = linkedLayers.linkId;\n    const currentLinks = linkedLayers.links;\n    const isParentLayer = currentLinks ? true : false;\n    if (isParentLayer && currentLinkedId === baselayer.options.linkedLayers.linkId) {\n      // search for child layers\n      currentLinks.map(link => {\n        link.linkedIds.map(linkedId => {\n          const layerToApply = this.map.layers.find(l => l.options.linkedLayers?.linkId === linkedId);\n          if (layerToApply) {\n            const linkedLayerOptions: any = Object.assign(\n              Object.create(layerToApply.options),\n              layerToApply.options,\n              {\n                zIndex: 9000,\n                visible: true,\n                baseLayer: false,\n              } as LayerOptions\n            );\n            this.basemap.addLayer(this.layerService.createLayer(linkedLayerOptions));\n          }\n        });\n      });\n    }\n  }\n}\n","<div *ngIf=\"rotated && !showIfNoRotation\" class=\"igo-rotation-button-container\"\n  [matTooltip]=\"rotated ? ('igo.geo.mapButtons.resetRotation' | translate): ('igo.geo.mapButtons.tipRotation' | translate)\"\n  matTooltipPosition=\"left\">\n  <button mat-icon-button matTooltipPosition=\"left\" [color]=\"color\" [disabled]=\"!rotated\"\n    (click)=\"map.viewController.resetRotation()\">\n    <mat-icon [ngStyle]=\"rotationStyle(map.viewController.getRotation())\" svgIcon=\"navigation\">\n    </mat-icon>\n  </button>\n</div>\n\n<div *ngIf=\"showIfNoRotation\" class=\"igo-rotation-button-container\"\n  [matTooltip]=\"rotated ? ('igo.geo.mapButtons.resetRotation' | translate): ('igo.geo.mapButtons.tipRotation' | translate)\"\n  matTooltipPosition=\"left\">\n  <button mat-icon-button matTooltipPosition=\"left\" [color]=\"color\" [disabled]=\"!rotated\"\n    (click)=\"map.viewController.resetRotation()\">\n    <mat-icon [ngStyle]=\"rotationStyle(map.viewController.getRotation())\" svgIcon=\"navigation\">\n    </mat-icon>\n  </button>\n</div>","import { Component, Input } from '@angular/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-rotation-button',\n  templateUrl: './rotation-button.component.html',\n  styleUrls: ['./rotation-button.component.scss']\n})\nexport class RotationButtonComponent {\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get showIfNoRotation(): boolean {\n    return this._showIfNoRotation;\n  }\n  set showIfNoRotation(value: boolean) {\n    this._showIfNoRotation = value;\n  }\n  private _showIfNoRotation: boolean;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  get rotated(): boolean {\n    return this.map.viewController.getRotation() !== 0;\n  }\n\n  constructor() {}\n\n  rotationStyle(radians): {} {\n    const rotation = 'rotate(' + radians + 'rad)';\n    return {\n      transform: rotation\n    };\n  }\n}\n","<div *ngIf=\"infoContent && infoContent.length\" class=\"infoSection\">\n    <pre>{{infoContent}}</pre>\n</div>","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'igo-info-section',\n  templateUrl: './info-section.component.html',\n  styleUrls: ['./info-section.component.scss']\n})\nexport class InfoSectionComponent {\n\n  @Input() infoContent: string = '';\n\n  constructor() {}\n\n}\n","export enum CatalogItemType {\n  Layer = 'layer',\n  Group = 'group'\n}\n\nexport enum TypeCatalog {\n  wms, wmts, baselayers, arcgisrest, tilearcgisrest, imagearcgisrest, composite\n}\n\nexport type TypeCatalogStrings = keyof typeof TypeCatalog;\n","import { Observable } from 'rxjs';\n\nimport { TooltipType } from '../../layer';\nimport { TimeFilterOptions } from '../../filter';\nimport { QueryFormat, QueryHtmlTarget } from '../../query';\n\nimport { ICatalog, ICompositeCatalog , CatalogItem, CatalogItemGroup } from './catalog.interface';\nimport { CatalogService } from './catalog.service';\nimport { TypeCatalog, TypeCatalogStrings } from './catalog.enum';\n\nexport abstract class Catalog implements ICatalog {\n\n    // ICatalog -----------------------------\n    id: string;\n    title: string;\n    url: string;\n    removable?: boolean;\n    externalProvider?: boolean;\n    abstract?: string;\n    forcedProperties?: any[];\n    items?: CatalogItem[];\n    type?: TypeCatalogStrings;\n    version?: string;\n    matrixSet?: string;\n    requestEncoding?: string;\n    regFilters?: string[];\n    groupImpose?: CatalogItemGroup;\n    groupSeparator?: string;\n    timeFilter?: TimeFilterOptions;\n    queryFormat?: QueryFormat;\n    queryHtmlTarget?: QueryHtmlTarget;\n    queryParams?: { [key: string]: string; };\n    sourceOptions?: { [key: string]: any; };\n    count?: number;\n    tooltipType?: TooltipType.ABSTRACT | TooltipType.TITLE;\n    sortDirection?: 'asc' | 'desc';\n    setCrossOriginAnonymous?: boolean;\n    showLegend?: boolean;\n    // ICatalog -----------------------------\n\n    protected catalogService: CatalogService;\n\n    constructor(options: Catalog, service: CatalogService) {\n        Object.assign(this, options);\n        this.catalogService = service;\n    }\n\n    public abstract collectCatalogItems(): Observable<CatalogItem[]>;\n}\n\nclass WMSCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.wms];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogWMSLayerItems(this);\n    }\n}\n\nclass WMTSCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.wmts];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogWMTSLayerItems(this);\n    }\n}\n\nclass BaselayersCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.baselayers];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItemGroup[]> {\n        return this.catalogService.loadCatalogBaseLayerItems(this);\n    }\n}\n\nclass ArcGISRestCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.arcgisrest];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems() {\n        return this.catalogService.loadCatalogArcGISRestItems(this);\n    }\n}\n\nclass TileOrImageArcGISRestCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService, typeCatalog: TypeCatalog) {\n        super(options, service);\n        this.type = TypeCatalog[TypeCatalog[typeCatalog]];\n    }\n\n    public collectCatalogItems() {\n        return this.catalogService.loadCatalogArcGISRestItems(this);\n    }\n}\n\nexport class CompositeCatalog extends Catalog implements ICompositeCatalog {\n    composite: ICatalog[];\n\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.composite];\n        this.type = TypeCatalog[sType];\n        this.url = null;\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogCompositeLayerItems(this);\n    }\n}\n\nexport class CatalogFactory {\n\n    public static createInstanceCatalog(options: Catalog, service: CatalogService): Catalog {\n\n        let catalog: Catalog;\n        if (options.hasOwnProperty('composite')) {\n            catalog = new CompositeCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.baselayers]) {\n            catalog = new BaselayersCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.arcgisrest]) {\n            catalog = new ArcGISRestCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.tilearcgisrest]) {\n            catalog = new TileOrImageArcGISRestCatalog(options, service, TypeCatalog.tilearcgisrest);\n        } else if (options.type === TypeCatalog[TypeCatalog.imagearcgisrest]) {\n            catalog = new TileOrImageArcGISRestCatalog(options, service, TypeCatalog.imagearcgisrest);\n        } else if (options.type === TypeCatalog[TypeCatalog.wmts]) {\n            catalog = new WMTSCatalog(options, service);\n        } else {\n            catalog = new WMSCatalog(options, service);\n        }\n\n        return catalog;\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, of } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\n\nimport * as striptags_ from 'striptags';\n\nimport * as olformat from 'ol/format';\nimport * as olextent from 'ol/extent';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\nimport olFeature from 'ol/Feature';\nimport * as olgeom from 'ol/geom';\n\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { uuid } from '@igo2/utils';\nimport { Feature, FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport {\n  WMSDataSource,\n  CartoDataSource,\n  TileArcGISRestDataSource,\n  WMSDataSourceOptions,\n  ImageArcGISRestDataSource\n} from '../../datasource';\n\nimport {\n  QueryFormat,\n  QueryFormatMimeType,\n  QueryHtmlTarget\n} from './query.enums';\nimport {\n  QueryOptions,\n  QueryableDataSource,\n  QueryableDataSourceOptions\n} from './query.interfaces';\nimport { MapExtent } from '../../map/shared/map.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class QueryService {\n  public queryEnabled = true;\n  public defaultFeatureCount = 20; // default feature count\n  public featureCount = 20; // feature count\n\n  private previousMessageIds = [];\n\n  constructor(\n    private http: HttpClient,\n    private messageService: MessageService,\n    private languageService: LanguageService) {}\n\n  query(layers: Layer[], options: QueryOptions): Observable<Feature[]>[] {\n    if (this.previousMessageIds.length) {\n      this.previousMessageIds.forEach(id => {\n        this.messageService.remove(id);\n      });\n    }\n    return layers\n      .filter((layer: Layer) => layer.visible && layer.isInResolutionsRange)\n      .map((layer: Layer) => this.queryLayer(layer, options));\n  }\n\n  queryLayer(layer: Layer, options: QueryOptions): Observable<Feature[]> {\n    const url = this.getQueryUrl(layer.dataSource, options, false, layer.map.viewController.getExtent());\n    if (!url) {\n      return of([]);\n    }\n\n    if (\n      (layer.dataSource as QueryableDataSource).options.queryFormat ===\n      QueryFormat.HTMLGML2\n    ) {\n      const urlGml = this.getQueryUrl(layer.dataSource, options, true);\n      return this.http.get(urlGml, { responseType: 'text' }).pipe(\n        mergeMap(gmlRes => {\n          const mergedGML = this.mergeGML(gmlRes, url, layer);\n          const imposedGeom = mergedGML[0];\n          const imposedProperties = mergedGML[1];\n          return this.http\n            .get(url, { responseType: 'text' })\n            .pipe(\n              map(res =>\n                this.extractData(res, layer, options, url, imposedGeom, imposedProperties)\n              )\n            );\n        })\n      );\n    }\n\n    const request = this.http.get(url, { responseType: 'text' });\n    return request.pipe(map(res => this.extractData(res, layer, options, url)));\n  }\n\n  private mergeGML(gmlRes, url, layer: Layer): [FeatureGeometry, { [key: string]: any }] {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(gmlRes);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      features = wmsParser.readFeatures(gmlRes);\n    }\n    const olmline = new olgeom.MultiLineString([]);\n    let pts;\n    const ptsArray = [];\n    let olmpoly = new olgeom.MultiPolygon([]);\n    let firstFeatureType;\n    const nbFeatures = features.length;\n\n    // Check if geometry intersect bbox\n    // for geoserver getfeatureinfo response in data projection, not call projection\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const bbox = bboxRaw.split(',');\n    const bboxExtent = olextent.createEmpty();\n    olextent.extend(bboxExtent, bbox);\n    const outBboxExtent = false;\n    let titleContent;\n    let queryTileField;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        queryTileField = dataSourceOptions.queryTitle;\n      }\n    }\n    features.map(feature => {\n\n      if (queryTileField) {\n        let queryTitleContent = feature.getProperties()[queryTileField];\n        if (queryTitleContent) {\n          titleContent = !titleContent ? queryTitleContent : `${titleContent},${queryTitleContent}`;\n        }\n      }\n      /*  if (!feature.getGeometry().simplify(100).intersectsExtent(bboxExtent)) {\n        outBboxExtent = true;\n        // TODO: Check to project the geometry?\n      }*/\n      const featureGeometryCoordinates = feature.getGeometry().getCoordinates();\n      const featureGeometryType = feature.getGeometry().getType();\n\n      if (!firstFeatureType && !outBboxExtent) {\n        firstFeatureType = featureGeometryType;\n      }\n      if (!outBboxExtent) {\n        switch (featureGeometryType) {\n          case 'Point':\n            if (nbFeatures === 1) {\n              pts = new olgeom.Point(featureGeometryCoordinates, 'XY');\n            } else {\n              ptsArray.push(featureGeometryCoordinates);\n            }\n            break;\n          case 'LineString':\n            olmline.appendLineString(\n              new olgeom.LineString(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'Polygon':\n            olmpoly.appendPolygon(\n              new olgeom.Polygon(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'MultiPolygon':\n            olmpoly = new olgeom.MultiPolygon(featureGeometryCoordinates, 'XY');\n            break;\n          default:\n            return;\n        }\n      }\n    });\n\n    let olmpts;\n    if (ptsArray.length === 0 && pts) {\n      olmpts = {\n        type: pts.getType(),\n        coordinates: pts.getCoordinates()\n      };\n    } else {\n      olmpts = {\n        type: 'Polygon',\n        coordinates: [this.convexHull(ptsArray)]\n      };\n    }\n\n    let returnGeometry;\n    switch (firstFeatureType) {\n      case 'LineString':\n        returnGeometry = {\n          type: olmline.getType(),\n          coordinates: olmline.getCoordinates()\n        };\n      case 'Point':\n        returnGeometry = olmpts;\n      case 'Polygon':\n        returnGeometry = {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n      case 'MultiPolygon':\n        returnGeometry = {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n    }\n    const imposedProperties = {};\n\n    if (queryTileField) {\n      imposedProperties[queryTileField] = titleContent;\n    }\n\n    return [ returnGeometry, imposedProperties];\n\n\n  }\n\n  cross(a, b, o) {\n    return (a[0] - o[0]) * (b[1] - o[1]) - (a[1] - o[1]) * (b[0] - o[0]);\n  }\n\n  /**\n   * @param points An array of [X, Y] coordinates\n   * This method is use instead of turf.js convexHull because Turf needs at least 3 point to make a hull.\n   * https://en.wikibooks.org/wiki/Algorithm_Implementation/Geometry/Convex_hull/Monotone_chain#JavaScript\n   */\n  convexHull(points) {\n    points.sort((a, b) => {\n      return a[0] === b[0] ? a[1] - b[1] : a[0] - b[0];\n    });\n\n    const lower = [];\n    for (const point of points) {\n      while (\n        lower.length >= 2 &&\n        this.cross(lower[lower.length - 2], lower[lower.length - 1], point) <= 0\n      ) {\n        lower.pop();\n      }\n      lower.push(point);\n    }\n\n    const upper = [];\n    for (let i = points.length - 1; i >= 0; i--) {\n      while (\n        upper.length >= 2 &&\n        this.cross(\n          upper[upper.length - 2],\n          upper[upper.length - 1],\n          points[i]\n        ) <= 0\n      ) {\n        upper.pop();\n      }\n      upper.push(points[i]);\n    }\n\n    upper.pop();\n    lower.pop();\n    return lower.concat(upper);\n  }\n\n  private extractData(\n    res,\n    layer: Layer,\n    options: QueryOptions,\n    url: string,\n    imposedGeometry?,\n    imposedProperties?: { [key: string]: any }\n  ): Feature[] {\n    const queryDataSource = layer.dataSource as QueryableDataSource;\n\n    const allowedFieldsAndAlias = this.getAllowedFieldsAndAlias(layer);\n    let features = [];\n    switch (queryDataSource.options.queryFormat) {\n      case QueryFormat.GML3:\n        features = this.extractGML3Data(\n          res,\n          layer.zIndex,\n          allowedFieldsAndAlias\n        );\n        break;\n      case QueryFormat.JSON:\n      case QueryFormat.GEOJSON:\n      case QueryFormat.GEOJSON2:\n        features = this.extractGeoJSONData(res, layer.zIndex, allowedFieldsAndAlias);\n        break;\n      case QueryFormat.ESRIJSON:\n        features = this.extractEsriJSONData(res, layer.zIndex, allowedFieldsAndAlias);\n        break;\n      case QueryFormat.TEXT:\n        features = this.extractTextData(res);\n        break;\n      case QueryFormat.HTML:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url\n        );\n        break;\n      case QueryFormat.HTMLGML2:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url,\n          imposedGeometry,\n          imposedProperties\n        );\n        break;\n      case QueryFormat.GML2:\n      default:\n        features = this.extractGML2Data(res, layer, allowedFieldsAndAlias);\n        break;\n    }\n\n    if (features.length > 0 && features[0].geometry === null) {\n      const geomToAdd = this.createGeometryFromUrlClick(url);\n\n      for (const feature of features) {\n        feature.geometry = geomToAdd;\n      }\n    }\n\n    const wmsDatasource = layer.dataSource as WMSDataSource;\n    const featureCount = wmsDatasource.params?.FEATURE_COUNT ?\n      new RegExp('FEATURE_COUNT=' + this.featureCount) :\n      new RegExp('FEATURE_COUNT=' + this.defaultFeatureCount);\n\n    if (\n      featureCount.test(url) &&\n      ((wmsDatasource.params?.FEATURE_COUNT && features.length === this.featureCount) ||\n      (!wmsDatasource.params?.FEATURE_COUNT && features.length === this.defaultFeatureCount))) {\n      this.languageService.translate.get('igo.geo.query.featureCountMax', {value: layer.title}).subscribe(message => {\n        const messageObj = this.messageService.info(message);\n        this.previousMessageIds.push(messageObj.toastId);\n      });\n    }\n\n    return features.map((feature: Feature, index: number) => {\n      const mapLabel = feature.properties[queryDataSource.mapLabel];\n\n      let exclude;\n      if (layer.options.sourceOptions?.type === 'wms') {\n        const sourceOptions = layer.options\n          .sourceOptions as WMSDataSourceOptions;\n        exclude = sourceOptions ? sourceOptions.excludeAttribute : undefined;\n      }\n\n      let title = this.getQueryTitle(feature, layer);\n      if (!title && features.length > 1) {\n        title = `${layer.title} (${index + 1})`;\n      } else if (!title) {\n        title = layer.title;\n      }\n\n      const meta = Object.assign({}, feature.meta || {}, {\n        id: uuid(),\n        title,\n        mapTitle: mapLabel,\n        sourceTitle: layer.title,\n        order: 1000 - layer.zIndex,\n        excludeAttribute: exclude\n      });\n\n      return Object.assign(feature, {\n        meta,\n        projection:\n          queryDataSource.options.type === 'carto'\n            ? 'EPSG:4326'\n            : options.projection\n      });\n    });\n  }\n\n  private createGeometryFromUrlClick(url) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const width = parseInt(searchParams.width, 10);\n    const height = parseInt(searchParams.height, 10);\n    const xPosition = parseInt(searchParams.i || searchParams.x, 10);\n    const yPosition = parseInt(searchParams.j || searchParams.y, 10);\n\n    const bbox = bboxRaw.split(',');\n    let threshold =\n      (Math.abs(parseFloat(bbox[0])) - Math.abs(parseFloat(bbox[2]))) * 0.05;\n\n    // for context in degree (EPSG:4326,4269...)\n    if (Math.abs(parseFloat(bbox[0])) < 180) {\n      threshold = 0.045;\n    }\n    const clickx =\n      parseFloat(bbox[0]) +\n      (Math.abs(parseFloat(bbox[0]) - parseFloat(bbox[2])) * xPosition) /\n        width -\n      threshold;\n    const clicky =\n      parseFloat(bbox[1]) +\n      (Math.abs(parseFloat(bbox[1]) - parseFloat(bbox[3])) * yPosition) /\n        height -\n      threshold;\n    const clickx1 = clickx + threshold * 2;\n    const clicky1 = clicky + threshold * 2;\n\n    const wktPoly =\n      'POLYGON((' +\n      clickx +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky +\n      '))';\n\n    const format = new olformat.WKT();\n    const tenPercentWidthGeom = format.readFeature(wktPoly);\n    const f = tenPercentWidthGeom.getGeometry() as any;\n\n    const newGeom = {\n      type: f.getType(),\n      coordinates: f.getCoordinates()\n    };\n\n    return newGeom;\n  }\n\n  private extractGML2Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(res);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      try {\n        features = wmsParser.readFeatures(res);\n      } catch (e) {\n        console.warn(\n          'query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.'\n        );\n      }\n    }\n\n    return features.map(feature =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGML3Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML3();\n    let features = [];\n    try {\n      features = parser.readFeatures(res);\n    } catch (e) {\n      console.warn('query.service: GML3 is not well supported');\n    }\n    return features.map(feature =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGeoJSONData(res, zIndex, allowedFieldsAndAlias?) {\n    let features = [];\n    try {\n      features = JSON.parse(res.replace(/(\\r|\\n)/g, ' ')).features;\n    } catch (e) {\n      console.warn('query.service: Unable to parse geojson', '\\n', res);\n    }\n    features.map(feature => feature.meta = {\n      id: uuid(),\n      order: 1000 - zIndex,\n      alias: allowedFieldsAndAlias\n    });\n    return features;\n  }\n\n  private extractEsriJSONData(res, zIndex, allowedFieldsAndAlias) {\n    if (res) {\n      try {\n        if (JSON.parse(res).error) {\n          return [];\n        }\n      } catch (e) {}\n    }\n    const parser = new olFormatEsriJSON();\n    const features = parser.readFeatures(res);\n\n    return features.map(feature => this.featureToResult(feature, zIndex, allowedFieldsAndAlias));\n  }\n\n  private extractTextData(res) {\n    // TODO\n    return [];\n  }\n\n  private extractHtmlData(\n    res,\n    htmlTarget: QueryHtmlTarget,\n    url,\n    imposedGeometry?,\n    imposedProperties?: { [key: string]: any }\n  ) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const projection = searchParams.crs || searchParams.srs || 'EPSG:3857';\n    const geomToAdd = this.createGeometryFromUrlClick(url);\n\n    if (\n      htmlTarget !== QueryHtmlTarget.BLANK &&\n      htmlTarget !== QueryHtmlTarget.IFRAME\n    ) {\n      htmlTarget = QueryHtmlTarget.IFRAME;\n    }\n\n    const bodyTagStart = res.toLowerCase().indexOf('<body>');\n    const bodyTagEnd = res.toLowerCase().lastIndexOf('</body>') + 7;\n    // replace \\r \\n  and ' ' with '' to validate if the body is really empty. Clear all the html tags from body\n    const striptags = striptags_;\n    const body = striptags(res.slice(bodyTagStart, bodyTagEnd).replace(/(\\r|\\n|\\s)/g, ''));\n    if (body === '' || res === '') {\n      return [];\n    }\n\n    return [\n      {\n        type: FEATURE,\n        projection,\n        properties: Object.assign({ target: htmlTarget, body: res, url }, imposedProperties),\n        geometry: imposedGeometry || geomToAdd\n      }\n    ];\n  }\n\n  private getQueryParams(url) {\n    const queryString = url.split('?');\n    if (!queryString[1]) {\n      return;\n    }\n    const pairs = queryString[1].split('&');\n\n    const result = {};\n    pairs.forEach(pair => {\n      pair = pair.split('=');\n      result[pair[0]] = decodeURIComponent(pair[1] || '');\n    });\n    return result;\n  }\n\n  public featureToResult(\n    featureOL: olFeature<olgeom.Geometry>,\n    zIndex: number,\n    allowedFieldsAndAlias?\n  ): Feature {\n    const featureGeometry = featureOL.getGeometry() as any;\n    const properties: any = Object.assign({}, featureOL.getProperties());\n    delete properties.geometry;\n    delete properties.GEOMETRIE;\n    delete properties.boundedBy;\n    delete properties.shape;\n    delete properties.SHAPE;\n    delete properties.the_geom;\n    delete properties.geom;\n\n    let geometry;\n    if (featureGeometry) {\n      geometry = {\n        type: featureGeometry.getType(),\n        coordinates: featureGeometry.getCoordinates()\n      };\n    }\n\n    return {\n      type: FEATURE,\n      projection: undefined,\n      properties,\n      geometry,\n      meta: {\n        id: uuid(),\n        order: 1000 - zIndex,\n        alias: allowedFieldsAndAlias\n      }\n    };\n  }\n\n  private getQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    forceGML2 = false,\n    mapExtent?: MapExtent\n  ): string {\n    let url;\n\n    if (datasource.options.queryUrl) {\n      return this.getCustomQueryUrl(datasource, options, mapExtent);\n    }\n\n    switch (datasource.constructor) {\n      case WMSDataSource:\n        const wmsDatasource = datasource as WMSDataSource;\n\n        const WMSGetFeatureInfoOptions = {\n          INFO_FORMAT:\n            wmsDatasource.params.INFO_FORMAT ||\n            this.getMimeInfoFormat(datasource.options.queryFormat),\n          QUERY_LAYERS: wmsDatasource.params.LAYERS,\n          FEATURE_COUNT: wmsDatasource.params.FEATURE_COUNT || this.defaultFeatureCount\n        };\n\n        if (wmsDatasource.params.FEATURE_COUNT) {\n          this.featureCount = wmsDatasource.params.FEATURE_COUNT;\n        }\n\n        if (forceGML2) {\n          WMSGetFeatureInfoOptions.INFO_FORMAT = this.getMimeInfoFormat(\n            QueryFormat.GML2\n          );\n        }\n\n        url = wmsDatasource.ol.getFeatureInfoUrl(\n          options.coordinates,\n          options.resolution,\n          options.projection,\n          WMSGetFeatureInfoOptions\n        );\n        // const wmsVersion =\n        //   wmsDatasource.params.VERSION ||\n        //   wmsDatasource.params.version ||\n        //   '1.3.0';\n        // if (wmsVersion !== '1.3.0') {\n        //   url = url.replace('&I=', '&X=');\n        //   url = url.replace('&J=', '&Y=');\n        // }\n        break;\n      case CartoDataSource:\n        const cartoDatasource = datasource as CartoDataSource;\n        const baseUrl =\n          'https://' +\n          cartoDatasource.options.account +\n          '.carto.com/api/v2/sql?';\n        const format = 'format=GeoJSON';\n        const sql =\n          '&q=' + cartoDatasource.options.config.layers[0].options.sql;\n        const clause =\n          ' WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(';\n        const meters = cartoDatasource.options.queryPrecision\n          ? cartoDatasource.options.queryPrecision\n          : '1000';\n        const coordinates =\n          options.coordinates[0] +\n          ',' +\n          options.coordinates[1] +\n          '),3857),' +\n          meters +\n          '))';\n\n        url = `${baseUrl}${format}${sql}${clause}${coordinates}`;\n        break;\n      case ImageArcGISRestDataSource:\n      case TileArcGISRestDataSource:\n        const tileArcGISRestDatasource = datasource as TileArcGISRestDataSource;\n        const deltaX = Math.abs(mapExtent[0] - mapExtent[2]);\n        const deltaY = Math.abs(mapExtent[1] - mapExtent[3]);\n        const maxDelta = deltaX > deltaY ? deltaX : deltaY;\n        const clickBuffer = maxDelta * 0.005;\n        const threshold = tileArcGISRestDatasource.options.queryPrecision ? tileArcGISRestDatasource.options.queryPrecision : clickBuffer;\n        const extent = olextent.buffer(\n          olextent.boundingExtent([options.coordinates]),\n          threshold\n        );\n        const serviceUrl =\n          tileArcGISRestDatasource.options.url +\n          '/' +\n          tileArcGISRestDatasource.options.layer +\n          '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        url = `${serviceUrl}?${params.join('&')}`;\n        break;\n      default:\n        break;\n    }\n\n    return url;\n  }\n\n  private getMimeInfoFormat(queryFormat: string) {\n    let mime = 'application/vnd.ogc.gml';\n    const keyEnum = Object.keys(QueryFormat).find(\n      key => QueryFormat[key] === queryFormat\n    );\n    if (keyEnum) {\n      mime = QueryFormatMimeType[keyEnum];\n    }\n\n    return mime;\n  }\n\n  getAllowedFieldsAndAlias(layer: any) {\n    let allowedFieldsAndAlias;\n    if (\n      layer.options?.source?.options?.sourceFields &&\n      layer.options.source.options.sourceFields.length >= 1\n    ) {\n      allowedFieldsAndAlias = {};\n      layer.options.source.options.sourceFields.forEach(sourceField => {\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\n        allowedFieldsAndAlias[sourceField.name] = alias;\n      });\n    }\n    return allowedFieldsAndAlias;\n  }\n\n  getQueryTitle(feature: Feature, layer: Layer): string {\n    let title;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\n      }\n    }\n\n    return title;\n  }\n\n  getLabelMatch(feature: Feature, labelMatch): string {\n    let label = labelMatch;\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach(v => {\n      label = label.replace(v[0], feature.properties[v[1]]);\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.properties[labelMatch] || labelMatch;\n    }\n\n    return label;\n  }\n\n  /**\n   * @param datasource QueryableDataSource\n   * @param options QueryOptions\n   * @mapExtent extent of the map when click event\n   *\n   */\n\n  getCustomQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    mapExtent?: MapExtent): string {\n\n      let url = datasource.options.queryUrl.replace(/\\{xmin\\}/g, mapExtent[0].toString())\n      .replace(/\\{ymin\\}/g, mapExtent[1].toString())\n      .replace(/\\{xmax\\}/g, mapExtent[2].toString())\n      .replace(/\\{ymax\\}/g, mapExtent[3].toString())\n      .replace(/\\{x\\}/g, options.coordinates[0].toString())\n      .replace(/\\{y\\}/g, options.coordinates[1].toString())\n      .replace(/\\{resolution\\}/g, options.resolution.toString())\n      .replace(/\\{srid\\}/g, options.projection.replace('EPSG:',''));\n\n      return url;\n    }\n}\n","import OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\n\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { QueryableDataSource } from './query.interfaces';\n\n/**\n * Whether a layer is queryable\n * @param layer Layer\n * @returns True if the layer s squeryable\n */\nexport function layerIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryable === true;\n}\n\n/**\n * Whether an OL layer is queryable\n * @param layer Layer\n * @returns True if the ol layer is queryable\n */\nexport function olLayerIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined ? false : layerIsQueryable(layer);\n}\n\n/**\n * Whether a layer's feature is queryable\n * @param layer Layer\n * @returns True if the layer's feature is queryable\n */\nexport function layerFeatureIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryLayerFeatures !== undefined ? (dataSource.options.queryLayerFeatures === true) : true;\n}\n\n/**\n * Whether an OL Vector layer is queryable\n * @param layer Layer\n * @returns True if the ol vector layer is queryable\n */\nexport function olLayerFeatureIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined ? false : (layerIsQueryable(layer) && layerFeatureIsQueryable(layer));\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  AfterViewInit,\n  Self\n} from '@angular/core';\n\nimport { Subscription, Observable, of, zip } from 'rxjs';\nimport { unByKey } from 'ol/Observable';\n\nimport OlFeature from 'ol/Feature';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { EventsKey } from 'ol/events';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { renderFeatureFromOl } from '../../feature/shared/feature.utils';\nimport { featureFromOl } from '../../feature/shared/feature.utils';\nimport { QueryService } from './query.service';\nimport { layerIsQueryable, olLayerFeatureIsQueryable } from './query.utils';\nimport { ctrlKeyDown } from '../../map/shared/map.utils';\nimport { OlDragSelectInteraction } from '../../feature/shared/strategies/selection';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { QueryableDataSourceOptions } from './query.interfaces';\n\n/**\n * This directive makes a map queryable with a click of with a drag box.\n * By default, all layers are queryable but this can ben controlled at\n * the layer level.\n */\n@Directive({\n  selector: '[igoQuery]'\n})\nexport class QueryDirective implements AfterViewInit, OnDestroy {\n  /**\n   * Subscriptions to ongoing queries\n   */\n  private queries$$: Subscription[] = [];\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * OL drag box interaction\n   */\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  /**\n   * Ol drag box \"end\" event key\n   */\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Whter to query features or not\n   */\n  @Input() queryFeatures: boolean = false;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesHitTolerance: number = 0;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesCondition: (olLayer: OlLayer<OlSource>) => boolean;\n\n  /**\n   * Whether all query should complete before emitting an event\n   */\n  @Input() waitForAllQueries: boolean = true;\n\n  /**\n   * Event emitted when a query (or all queries) complete\n   */\n  @Output() query = new EventEmitter<{\n    features: Feature[] | Feature[][];\n    event: MapBrowserPointerEvent<any>;\n  }>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return (this.component.map as any) as IgoMap;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private queryService: QueryService\n  ) {}\n\n  /**\n   * Start listening to click and drag box events\n   * @internal\n   */\n  ngAfterViewInit() {\n    this.listenToMapClick();\n    this.addDragBoxInteraction();\n  }\n\n  /**\n   * Stop listening to click and drag box events and cancel ongoind requests\n   * @internal\n   */\n  ngOnDestroy() {\n    this.cancelOngoingQueries();\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n  }\n\n  /**\n   * On map click, issue queries\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * Issue queries from a map event and emit events with the results\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    this.cancelOngoingQueries();\n    if (!this.queryService.queryEnabled) {\n      return;\n    }\n\n    const queries$ = [];\n    if (this.queryFeatures) {\n      queries$.push(this.doQueryFeatures(event));\n    }\n\n    const resolution = this.map.ol.getView().getResolution();\n    const queryLayers = this.map.layers.filter(layerIsQueryable);\n    queries$.push(\n      ...this.queryService.query(queryLayers, {\n        coordinates: event.coordinate as [number, number],\n        projection: this.map.projection,\n        resolution\n      })\n    );\n\n    if (queries$.length === 0) {\n      return;\n    }\n\n    if (this.waitForAllQueries) {\n      this.queries$$.push(\n        zip(...queries$).subscribe((results: Feature[][]) => {\n          const features = [].concat(...results);\n          this.query.emit({ features, event });\n        })\n      );\n    } else {\n      this.queries$$ = queries$.map((query$: Observable<Feature[]>) => {\n        return query$.subscribe((features: Feature[]) => {\n          this.query.emit({ features, event });\n        });\n      });\n    }\n  }\n\n  /**\n   * Query features already present on the map\n   * @param event OL map browser pointer event\n   */\n  private doQueryFeatures(\n    event: MapBrowserPointerEvent<any>\n  ): Observable<Feature[]> {\n    const clickedFeatures = [];\n\n    if (event.type === 'singleclick') {\n      this.map.ol.forEachFeatureAtPixel(\n        event.pixel,\n        (featureOL: OlFeature<OlGeometry>, layerOL: any) => {\n          const layer = this.map.getLayerById(layerOL.values_._layer.id);\n          if ((layer.dataSource.options as QueryableDataSourceOptions).queryFormatAsWms) {\n            return;\n          }\n          if (featureOL) {\n            if (featureOL.get('features')) {\n              for (const feature of featureOL.get('features')) {\n                const newFeature = featureFromOl(feature, this.map.projection);\n                newFeature.meta = {\n                  title: feature.values_.nom,\n                  id: layerOL.values_._layer.id + '.' + feature.id_,\n                  icon: feature.values_._icon,\n                  sourceTitle: layerOL.values_.title,\n                  alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                  // title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n                };\n                clickedFeatures.push(newFeature);\n              }\n            } else if (featureOL instanceof OlRenderFeature) {\n              const newFeature = renderFeatureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            } else {\n              const newFeature = featureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            }\n          }\n        },\n        {\n          hitTolerance: this.queryFeaturesHitTolerance || 0,\n          layerFilter: this.queryFeaturesCondition\n            ? this.queryFeaturesCondition\n            : olLayerFeatureIsQueryable\n        }\n      );\n    } else if (event.type === 'boxend') {\n      const target = event.target as any;\n      const dragExtent = target.getGeometry().getExtent();\n      this.map.layers\n        .filter(layerIsQueryable)\n        .filter(layer => layer instanceof VectorLayer && layer.visible)\n        .map(layer => {\n          const featuresOL = layer.dataSource.ol as olVectorSource<OlGeometry>;\n          featuresOL.forEachFeatureIntersectingExtent(dragExtent, (olFeature: any) => {\n            const newFeature: Feature = featureFromOl(olFeature, this.map.projection, layer.ol);\n            newFeature.meta = {\n              id: layer.id + '.' + olFeature.getId(),\n              icon: olFeature.values_._icon,\n              sourceTitle: layer.title,\n              alias: this.queryService.getAllowedFieldsAndAlias(layer),\n              title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n            };\n            clickedFeatures.push(newFeature);\n          });\n        });\n    }\n\n\n    return of(clickedFeatures);\n  }\n\n  /**\n   * Cancel ongoing requests, if any\n   */\n  private cancelOngoingQueries() {\n    this.queries$$.forEach((sub: Subscription) => sub.unsubscribe());\n    this.queries$$ = [];\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteractionOnQuery;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteractionOnQuery = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteractionOnQuery === undefined) {\n      olDragSelectInteractionOnQuery = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteractionOnQuery);\n      this.olDragSelectInteraction = olDragSelectInteractionOnQuery;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteractionOnQuery.on(\n      'boxend',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { StorageService } from '@igo2/core';\nimport { SearchResult } from '../search.interfaces';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions,\n  SearchSourceSettings\n} from './source.interfaces';\n\n/**\n * Base search source class\n */\nexport class SearchSource {\n  /**\n   * Search source ID\n   * @internal\n   */\n  static id = '';\n\n  /**\n   * Search source type\n   * @internal\n   */\n  static type = '';\n\n  /**\n   * Search source options\n   * @internal\n   */\n  protected options: SearchSourceOptions;\n\n  /**\n   * Get search source's id\n   * @returns Search source's id\n   */\n  getId(): string {\n    throw new Error('You have to implement the method \"getId\".');\n  }\n  /**\n   * Get search source's type\n   * @returns Search source's type\n   */\n  getType(): string {\n    throw new Error('You have to implement the method \"getType\".');\n  }\n\n  /**\n   * Get search source's default options\n   * @returns Search source default options\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    throw new Error('You have to implement the method \"getDefaultOptions\".');\n  }\n\n  /**\n   * Search source's title\n   */\n  get title(): string {\n    return this.options.title;\n  }\n\n  /**\n   * Whether the search source is available\n   */\n  get available(): boolean {\n    return this.options.available !== false;\n  }\n\n  /**\n   * Whether the search source is enabled\n   */\n  set enabled(value: boolean) {\n    this.options.enabled = value;\n  }\n  get enabled(): boolean {\n    return this.available && this.options.enabled !== false;\n  }\n\n  get showInPointerSummary(): boolean {\n    const showInPointerSummary = this.options.showInPointerSummary;\n    return showInPointerSummary ? showInPointerSummary : false;\n  }\n\n  get showInSettings(): boolean {\n    const showInSettings = this.options.showInSettings;\n    return showInSettings === undefined ? true : showInSettings;\n  }\n\n  /**\n   * Search url\n   */\n  get searchUrl(): string {\n    return this.options.searchUrl;\n  }\n\n  /**\n   * Search query params\n   */\n  get params(): { [key: string]: string } {\n    return this.options.params === undefined ? {} : this.options.params;\n  }\n\n  /**\n   * Search settings\n   */\n  get settings(): SearchSourceSettings[] {\n    return this.options.settings === undefined ? [] : this.options.settings;\n  }\n\n  /**\n   * Set params from selected settings\n   */\n  setParamFromSetting(setting: SearchSourceSettings, saveInStorage = true) {\n    switch (setting.type) {\n      case 'radiobutton':\n        setting.values.forEach(conf => {\n          if (conf.enabled) {\n            this.options.params = Object.assign(this.options.params || {}, {\n              [setting.name]: conf.value\n            });\n          }\n        });\n        break;\n      case 'checkbox':\n        let confValue = '';\n        setting.values\n          .filter(s => s.available !== false)\n          .forEach(conf => {\n            if (conf.enabled) {\n              confValue += conf.value + ',';\n            }\n          });\n        confValue = confValue.slice(0, -1);\n        this.options.params = Object.assign(this.options.params || {}, {\n          [setting.name]: confValue\n        });\n        break;\n    }\n\n    if (saveInStorage && this.storageService) {\n      this.storageService.set(\n        this.getId() + '.options',\n        {params: this.options.params}\n      );\n    }\n  }\n\n  /**\n   * Search results display order\n   */\n  get displayOrder(): number {\n    return this.options.order === undefined ? 99 : this.options.order;\n  }\n\n  constructor(options: SearchSourceOptions, private storageService?: StorageService) {\n    this.options = options;\n    if (this.storageService) {\n      const storageOptions = this.storageService.get(\n        this.getId() + '.options'\n      ) as object;\n      if (storageOptions) {\n        this.options = ObjectUtils.mergeDeep(this.options, storageOptions);\n      }\n    }\n\n    this.options = ObjectUtils.mergeDeep(this.getDefaultOptions(), this.options);\n\n\n    // Set Default Params from Settings\n    this.settings.forEach(setting => {\n      this.setParamFromSetting(setting, false);\n    });\n  }\n\n  /**\n   * Get hashtags valid\n   * @param hashtag hashtag from query\n   */\n  getHashtagsValid(term: string, settingsName: string): string[] {\n    const hashtags = term.match(/(#[A-Za-z+]+)/g);\n    if (!hashtags) {\n      return undefined;\n    }\n\n    const searchSourceSetting = this.getSettingsValues(settingsName);\n    const hashtagsValid = [];\n    hashtags.forEach(hashtag => {\n      searchSourceSetting.values.forEach(conf => {\n        const hashtagKey = hashtag.substring(1);\n        if (typeof conf.value === 'string') {\n          const types = conf.value\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n            .split(',');\n          const index = types.indexOf(\n            hashtagKey\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '')\n          );\n          if (index !== -1) {\n            hashtagsValid.push(types[index]);\n          }\n        }\n        if (conf.hashtags && conf.hashtags.indexOf(hashtagKey.toLowerCase()) !== -1) {\n          hashtagsValid.push(conf.value);\n        }\n      });\n    });\n\n    return hashtagsValid.filter((a, b) => hashtagsValid.indexOf(a) === b);\n  }\n\n  getSettingsValues(search: string): SearchSourceSettings {\n    return this.getDefaultOptions().settings.find(\n      (value: SearchSourceSettings) => {\n        return value.name === search;\n      }\n    );\n  }\n}\n\n/**\n * Search sources that allow searching by text implement this class\n */\nexport interface TextSearch {\n  /**\n   * Search by text\n   * @param term Text\n   * @param options Optional: TextSearchOptions\n   * @returns Observable or search results\n   */\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult[]>;\n}\n\n/**\n * Search sources that allow searching by coordinates implement this class\n */\nexport interface ReverseSearch {\n  /**\n   * Search by text\n   * @param lonLat Coordinates\n   * @param options Optional: ReverseSearchOptions\n   * @returns Observable or search results\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult[]>;\n}\n","import { Injectable, Inject } from '@angular/core';\n\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { SearchSourceOptions } from '../../search/shared/sources/source.interfaces';\n/**\n * Map search source. For now it has no search capability. All it does\n * is act as a placeholder for the map query results' \"search source\".\n */\n@Injectable()\nexport class QuerySearchSource extends SearchSource {\n  static id = 'map';\n  static type = FEATURE;\n\n  constructor(@Inject('options') options: SearchSourceOptions) {\n    super(options);\n  }\n\n  getId(): string {\n    return QuerySearchSource.id;\n  }\n\n  getType(): string {\n    return QuerySearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Carte'\n    };\n  }\n}\n","export class GoogleLinks {\n  static getGoogleMapsCoordLink(lon, lat) {\n    return 'https://www.google.com/maps?q=' + lat + ',' + lon;\n  }\n\n  static getGoogleStreetViewLink(lon, lat) {\n    return 'https://www.google.com/maps?q=&layer=c&cbll=' + lat + ',' + lon;\n  }\n\n  static getGoogleMapsNameLink(name) {\n    const encodedName = encodeURI(name);\n    return 'https://www.google.com/maps?q=' + encodedName;\n  }\n}\n","import type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\nimport olFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\n\nimport { createOverlayMarkerStyle } from '../overlay/shared/overlay-marker-style.utils';\nimport { createOverlayDefaultStyle } from '../overlay/shared/overlay.utils';\nimport { FeatureCommonVectorStyleOptions } from './commonVectorStyle.interface';\nimport { Feature } from '../feature';\n\n\n/**\n * Generate a style for selected features\n * @param feature The feature to generate the style\n * @returns A olStyle\n */\nexport function getCommonVectorSelectedStyle(\n  {\n    feature,\n    markerColor = [0, 161, 222],\n    markerOpacity = 1,\n    markerOutlineColor = [0, 255, 255],\n    fillColor,\n    fillOpacity = 0.15,\n    strokeColor = [0, 255, 255],\n    strokeOpacity = 0.5,\n    strokeWidth = 4\n  }: FeatureCommonVectorStyleOptions): olstyle.Style {\n\n  return getCommonVectorStyle({\n    feature,\n    markerColor,\n    markerOpacity,\n    markerOutlineColor,\n    fillColor,\n    fillOpacity,\n    strokeColor,\n    strokeOpacity,\n    strokeWidth\n  });\n}\n\n/**\n * Generate a basic style for features\n * @param feature The feature to generate the style\n * @returns A olStyle\n */\nexport function getCommonVectorStyle(\n  {\n    feature,\n    markerColor = [0, 161, 222],\n    markerOpacity = 0.5,\n    markerOutlineColor,\n    fillColor = [0, 161, 222],\n    fillOpacity = 0.15,\n    strokeColor = [0, 161, 222],\n    strokeOpacity = 0.5,\n    strokeWidth = 2\n  }: FeatureCommonVectorStyleOptions): olstyle.Style {\n\n  const isOlFeature = feature instanceof olFeature;\n  let geometry;\n  let text;\n  if (isOlFeature) {\n    feature = feature as olFeature<OlGeometry>;\n    geometry = feature.getGeometry();\n  } else {\n    feature = feature as Feature;\n    geometry = feature.geometry;\n    text = feature.meta.mapTitle;\n  }\n  const geometryType = isOlFeature ? geometry.getType() : geometry.type;\n\n  if (!geometry || geometryType === 'Point') {\n    const markerColorAsArray = ColorAsArray(markerColor).slice(0);\n    const markerColorRGB = markerColorAsArray.slice(0, 3);\n\n    if (markerColorAsArray.length === 4 &&\n        (typeof markerColor !== 'string' || /^#[0-9A-F]{8}$/i.test(markerColor as string))) {\n      markerOpacity = markerColorAsArray[3];\n    }\n\n    return createOverlayMarkerStyle({\n      text,\n      opacity: markerOpacity,\n      markerOutlineColor,\n      markerColor: markerColorRGB\n    });\n  } else {\n    const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n    const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n    if (!(fillWithOpacity.length === 4 &&\n        (typeof fillColor !== 'string' || /^#[0-9A-F]{8}$/i.test(fillColor as string)))) {\n      fillWithOpacity[3] = fillOpacity;\n    }\n\n    if (!(strokeWithOpacity.length === 4 &&\n        (typeof strokeColor !== 'string' || /^#[0-9A-F]{8}$/i.test(strokeColor as string)))) {\n      strokeWithOpacity[3] = strokeOpacity;\n    }\n\n    return createOverlayDefaultStyle({\n      text,\n      strokeWidth,\n      strokeColor: strokeWithOpacity,\n      fillColor: fillWithOpacity\n    });\n  }\n}\n","export class OsmLinks {\n  static getOpenStreetMapLink(lon, lat, zoom: number = 17) {\n    // return 'https://www.google.com/maps?q=' + lat + ',' + lon;\n    return `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=${zoom}/${lat}/${lon}`;\n  }\n\n  static getOpenStreetCamLink(lon, lat, zoom: number = 17) {\n    return `https://openstreetcam.org/map/@${lat},${lon},${zoom}z`;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { EMPTY, Observable, of, zip } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { uuid, ObjectUtils } from '@igo2/utils';\nimport { LanguageService, MessageService, ConfigService } from '@igo2/core';\nimport {\n  CapabilitiesService,\n  WMSDataSourceOptions,\n  WMSDataSourceOptionsParams,\n  WMTSDataSourceOptions,\n  ArcGISRestDataSourceOptions\n} from '../../datasource';\nimport { LayerOptions, ImageLayerOptions } from '../../layer';\nimport { getResolutionFromScale } from '../../map';\n\nimport {\n  CatalogItem,\n  CatalogItemLayer,\n  CatalogItemGroup,\n  ForcedProperty\n} from './catalog.interface';\nimport { Catalog, CatalogFactory, CompositeCatalog } from './catalog.abstract';\nimport { CatalogItemType, TypeCatalog } from './catalog.enum';\nimport { QueryFormat } from '../../query';\nimport { generateIdFromSourceOptions } from '../../utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CatalogService {\n  constructor(\n    private http: HttpClient,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private capabilitiesService: CapabilitiesService\n  ) {}\n\n  loadCatalogs(): Observable<Catalog[]> {\n    const contextConfig = this.config.getConfig('context') || {};\n    const catalogConfig = this.config.getConfig('catalog') || {};\n    const apiUrl = catalogConfig.url || contextConfig.url;\n    const catalogsFromConfig = catalogConfig.sources || [];\n\n    const observables$ = [];\n\n    if (apiUrl) {\n      // Base layers catalog\n      if (catalogConfig.baseLayers) {\n        const translate = this.languageService.translate;\n        const title = translate.instant('igo.geo.catalog.baseLayers');\n        const baseLayersCatalog = [\n          {\n            id: 'catalog.baselayers',\n            title,\n            url: `${apiUrl}/baselayers`,\n            type: 'baselayers'\n          }\n        ];\n        observables$.push(of(baseLayersCatalog));\n      }\n\n      // Catalogs from API\n      const catalogsFromApi$ = this.http\n        .get<Catalog[]>(`${apiUrl}/catalogs`)\n        .pipe(\n          map((catalogs) =>\n            catalogs.map((c: any) => Object.assign(c, c.options))\n          ),\n          catchError((_response: HttpErrorResponse) => EMPTY)\n        );\n      observables$.push(catalogsFromApi$);\n    }\n\n    // Catalogs from config\n    if (catalogsFromConfig.length > 0) {\n      observables$.push(\n        of(catalogsFromConfig).pipe(\n          map((catalogs: Catalog[]) =>\n            catalogs.map((c) => {\n              if (!c.id) {\n                c.id = uuid();\n              }\n              return c;\n            })\n          )\n        )\n      );\n    }\n\n    return zip(...observables$).pipe(\n      map((catalogs: Catalog[][]) => [].concat.apply([], catalogs))\n    ) as Observable<Catalog[]>;\n  }\n\n  loadCatalogItems(catalog: Catalog): Observable<CatalogItem[]> {\n    let newCatalog: Catalog;\n    newCatalog = CatalogFactory.createInstanceCatalog(catalog, this);\n    return newCatalog.collectCatalogItems();\n  }\n\n  loadCatalogBaseLayerItems(catalog: Catalog): Observable<CatalogItemGroup[]> {\n    return this.getCatalogBaseLayersOptions(catalog).pipe(\n      map((layersOptions: LayerOptions[]) => {\n        const items = layersOptions.map((layerOptions: LayerOptions) => {\n          return {\n            id: generateIdFromSourceOptions(layerOptions.sourceOptions),\n            title: layerOptions.title,\n            type: CatalogItemType.Layer,\n            externalProvider: catalog.externalProvider,\n            options: layerOptions\n          } as CatalogItemLayer;\n        });\n        return [\n          {\n            id: 'catalog.group.baselayers',\n            type: CatalogItemType.Group,\n            externalProvider: catalog.externalProvider,\n            title: catalog.title,\n            items\n          }\n        ];\n      })\n    );\n  }\n\n  private getCatalogBaseLayersOptions(\n    catalog: Catalog\n  ): Observable<LayerOptions[]> {\n    return this.http.get<LayerOptions[]>(catalog.url);\n  }\n\n  loadCatalogWMSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        const items = [];\n        if (!capabilities) {\n          return items;\n        }\n        if (capabilities.Service && capabilities.Service.Abstract && capabilities.Service.Abstract.length) {\n          catalog.abstract = capabilities.Service.Abstract;\n        }\n        const finalLayers = [];\n        this.flattenWmsCapabilities(capabilities.Capability.Layer, 0, finalLayers, catalog.groupSeparator);\n        const capabilitiesCapabilityLayer = Object.assign({}, capabilities.Capability.Layer);\n        capabilitiesCapabilityLayer.Layer = finalLayers.filter(f => f.Layer.length !== 0);\n        this.includeRecursiveItems(\n          catalog,\n          capabilitiesCapabilityLayer,\n          items\n        );\n        return items;\n      })\n    );\n  }\n\n  flattenWmsCapabilities(parent, level = 0, finalLayers, separator = ' / ') {\n    if (!finalLayers.includes(parent.Title)) {\n        const modifiedParent = Object.assign({}, parent);\n        modifiedParent.Layer = [];\n        finalLayers.push(modifiedParent);\n    }\n    for (const layer of parent.Layer) {\n        const modifiedLayer = Object.assign({}, layer);\n        if (level > 0) {\n          modifiedLayer.Title = parent.Title + separator + layer.Title;\n        }\n        if (layer.Layer) {\n            this.flattenWmsCapabilities(modifiedLayer, level + 1, finalLayers, separator);\n        } else {\n            finalLayers.find(ff => ff.Title === parent.Title).Layer.push(layer);\n         }\n    }\n}\n\n  loadCatalogWMTSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => this.getWMTSItems(catalog, capabilities))\n    );\n  }\n\n  loadCatalogArcGISRestItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        return this.getArcGISRESTItems(catalog, capabilities);\n      })\n    );\n  }\n\n  loadCatalogCompositeLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    const compositeCatalog = (catalog as CompositeCatalog).composite;\n\n    const catalogsFromInstance = [] as Catalog[];\n    compositeCatalog.map((component: Catalog) => {\n      component.sortDirection = catalog.sortDirection; // propagate sortDirection with parent value\n      catalogsFromInstance.push(\n        CatalogFactory.createInstanceCatalog(component, this)\n    );\n  }\n    );\n\n    // get CatalogItems for each original Catalog-----------------------------------------------------\n    const request1$ = [];\n    catalogsFromInstance.map((component: Catalog) =>\n      request1$.push(component.collectCatalogItems())\n    );\n\n    // integrate imposed group -----------------------------------------------------\n    let request2$ = [];\n\n    function flatDeepLayer(arr) {\n      return arr.reduce(\n        (acc, val) =>\n          acc.concat(\n            val.type === CatalogItemType.Group ? flatDeepLayer(val.items) : val\n          ),\n        []\n      );\n    }\n\n    if (\n      Object.keys(compositeCatalog).find((k) => compositeCatalog[k].groupImpose)\n    ) {\n      const pushImposeGroup = (item, index) => {\n        const c = catalogsFromInstance[index];\n        const outGroupImpose = Object.assign({}, c.groupImpose);\n        outGroupImpose.address = c.id;\n        outGroupImpose.type = CatalogItemType.Group;\n        outGroupImpose.externalProvider = c.externalProvider;\n        if (outGroupImpose.sortDirection === undefined) {\n          outGroupImpose.sortDirection = c.sortDirection;\n        }\n        outGroupImpose.items = [];\n\n        const flatLayer = flatDeepLayer(item);\n        flatLayer.map(\n          (v) => (v.address = `${outGroupImpose.address}.${outGroupImpose.id}`)\n        );\n        outGroupImpose.items = flatLayer;\n\n        return outGroupImpose;\n      };\n\n      request2$ = request1$.map((obs, idx) =>\n        obs.pipe(\n          map((items) =>\n            compositeCatalog[idx].groupImpose\n              ? pushImposeGroup(items, idx)\n              : items\n          )\n        )\n      );\n    } else {\n      request2$ = request1$;\n    }\n\n    // concat Group -----------------------------------------------------\n    const request3$ = zip(...request2$).pipe(\n      map(\n        (output: CatalogItem[]) => [].concat(...output) // [].concat.apply([], result1\n      )\n    );\n\n    // merge Group (first level only) -----------------------------------------------------\n    const groupByGroupId = (data, keyFn) =>\n      data.reduce((acc, group) => {\n        const groupId = keyFn(group);\n        const ind = acc.find((x) => x.id === groupId);\n\n        if (!ind) {\n          acc[acc.length] = group;\n        } else {\n          const ix = acc.indexOf(ind);\n          if (acc[ix].address.split('|').indexOf(group.address) === -1) {\n            acc[ix].address = `${acc[ix].address}|${group.address}`;\n          }\n          acc[ix].items.push(...group.items);\n        }\n        return acc;\n      }, []);\n\n    // merge Layer for each Level (catalog, group(recursive))\n    const recursiveGroupByLayerAddress = (items, keyFn) =>\n      items.reduce((acc, item, idx, arr) => {\n        const layerTitle = keyFn(item);\n        const outItem = Object.assign({}, item);\n\n        if (item.type === CatalogItemType.Layer) {\n          // same title, same address => result: only one item is kept\n\n          // same title, address diff\n          const indicesMatchTitle = [];\n          const indicesMatchNewMetadataUrl = []; // metadata\n          const diffAddress = arr.filter((x, i) => {\n            let bInd = false;\n            if (x.title === layerTitle && x.type === CatalogItemType.Layer) {\n              if (i !== idx && x.address !== item.address) {\n                bInd = true;\n              }\n              indicesMatchTitle.push(i);\n            }\n            return bInd;\n          }); // $& i !== idx\n\n          if (diffAddress.length > 0) {\n            let nPosition = indicesMatchTitle.findIndex((x) => x === idx) + 1;\n            outItem.title = `${item.title} (${nPosition})`; // source: ${item.address.split('.')[0]}\n            nPosition = indicesMatchNewMetadataUrl.findIndex((x) => x === idx) + 1;\n            outItem.newMetadataUrl = `${item.newMetadataUrl} (${nPosition})`; // source: ${item.address.split('.')[0]}\n          }\n\n          const exist = acc.find(\n            (x) => x.title === outItem.title && x.type === CatalogItemType.Layer\n          );\n          if (!exist) {\n            acc[acc.length] = outItem;\n          }\n        } else if (item.type === CatalogItemType.Group) {\n          outItem.items = recursiveGroupByLayerAddress(\n            item.items,\n            (layer) => layer.title\n          );\n          acc[acc.length] = outItem;\n        }\n\n        return acc;\n      }, []);\n\n    const request4$ = request3$.pipe(\n      map((output) => groupByGroupId(output, (group) => group.id)),\n      map((output) => [].concat(...output)),\n      map((data) => recursiveGroupByLayerAddress(data, (layer) => layer.title))\n    );\n\n    return request4$;\n  }\n\n  private getCatalogCapabilities(catalog: Catalog): Observable<any> {\n    const sType: string = TypeCatalog[catalog.type as string];\n    return this.capabilitiesService\n      .getCapabilities(sType as any, catalog.url, catalog.version)\n      .pipe(\n        catchError((e) => {\n          const title = this.languageService.translate.instant(\n            'igo.geo.catalog.unavailableTitle'\n          );\n          const message =\n          catalog.title ? this.languageService.translate.instant(\n            'igo.geo.catalog.unavailable',\n            { value: catalog.title }\n          ) : this.languageService.translate.instant(\n            'igo.geo.catalog.someUnavailable'\n          );\n\n          this.messageService.error(message, title);\n          console.error(e);\n          return of(undefined);\n        })\n      );\n  }\n\n  private computeForcedProperties(\n    layerNameFromCatalog: string,\n    forcedProperties: ForcedProperty[]): ForcedProperty {\n\n    if (!forcedProperties || forcedProperties.length === 0) {\n      return;\n    }\n    const returnProperty: ForcedProperty = {\n      layerName: layerNameFromCatalog,\n      title: undefined,\n      metadataUrl: undefined,\n      metadataAbstract: undefined,\n      metadataAbstractAll: undefined,\n      metadataUrlAll: undefined\n    };\n    //process wildcard before\n    // if there is a * wildcard\n    const forcedPropertiesForAllLayers = forcedProperties.find(f => f.layerName === '*');\n    if (forcedPropertiesForAllLayers) {\n      // metadataAbstractAll\n      if (forcedPropertiesForAllLayers.metadataAbstractAll) {\n        returnProperty.metadataAbstractAll = forcedPropertiesForAllLayers.metadataAbstractAll;\n      }\n      // metadataUrlAll\n      if (forcedPropertiesForAllLayers.metadataUrlAll) {\n        returnProperty.metadataUrlAll = forcedPropertiesForAllLayers.metadataUrlAll;\n      }\n    }\n    forcedProperties.map(forcedProperty => {\n      // if match found\n      if (layerNameFromCatalog === forcedProperty.layerName) {\n        // title\n        if (forcedProperty.title) {\n          returnProperty.title = forcedProperty.title;\n        }\n        // metadataUrl\n        if (forcedProperty.metadataUrl) {\n          returnProperty.metadataUrl = forcedProperty.metadataUrl;\n        }\n        // metadataAbstract\n        if (forcedProperty.metadataAbstract) {\n          returnProperty.metadataAbstract = forcedProperty.metadataAbstract;\n        }\n      }\n    });\n    return returnProperty;\n  }\n\n  /// WMS\n\n  private prepareCatalogItemLayer(layer, idParent, layersQueryFormat, catalog) {\n    const configuredQueryFormat = this.retrieveLayerInfoFormat(\n      layer.Name,\n      layersQueryFormat\n    );\n\n    const legendOptions =\n      catalog.showLegend && layer.Style\n        ? this.capabilitiesService.getStyle(layer.Style)\n        : undefined;\n\n    const params = Object.assign({}, catalog.queryParams, {\n      LAYERS: layer.Name,\n      VERSION: catalog.version\n    } as WMSDataSourceOptionsParams);\n\n    const baseSourceOptions = {\n      type: 'wms',\n      url: catalog.url,\n      crossOrigin: catalog.setCrossOriginAnonymous ? 'anonymous' : undefined,\n      queryFormat: configuredQueryFormat,\n      queryHtmlTarget:\n        configuredQueryFormat === QueryFormat.HTML ||\n        configuredQueryFormat === QueryFormat.HTMLGML2\n          ? 'iframe'\n          : undefined,\n      optionsFromCapabilities: true\n    };\n\n    const sourceOptions = Object.assign(\n      {},\n      baseSourceOptions,\n      catalog.sourceOptions,\n      { params }\n    ) as WMSDataSourceOptions;\n\n    const propertiesToForce = this.computeForcedProperties(layer.Name, catalog.forcedProperties);\n    let baseAbstract;\n    let extern = true;\n    if (layer.Abstract) {\n      baseAbstract = layer.Abstract;\n    } else if (!layer.Abstract && catalog.abstract) {\n      baseAbstract = catalog.abstract;\n    }\n    const layerOnlineResource = layer?.DataURL && layer?.DataURL.length >0 ? layer?.DataURL[0].OnlineResource : undefined;\n\n    let metadataUrl = propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll || layerOnlineResource;\n    let metadataAbstract = propertiesToForce?.metadataAbstract || propertiesToForce?.metadataAbstractAll || baseAbstract;\n\n    if (\n      !propertiesToForce?.metadataUrl &&\n      !propertiesToForce?.metadataUrlAll &&\n      (propertiesToForce?.metadataAbstract ||\n        propertiesToForce?.metadataAbstractAll)\n    ) {\n      extern = false;\n    }\n    if (propertiesToForce?.metadataAbstract && propertiesToForce?.metadataUrlAll) {\n      extern = false;\n    }\n\n    const layerPrepare = {\n      id: generateIdFromSourceOptions(sourceOptions),\n      type: CatalogItemType.Layer,\n      title: propertiesToForce?.title ? propertiesToForce.title : layer.Title,\n      address: idParent,\n      externalProvider: catalog.externalProvider || false,\n      options: {\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        metadata: {\n          url: metadataUrl,\n          extern,\n          abstract: metadataAbstract,\n          type: baseSourceOptions.type\n        },\n        legendOptions,\n        tooltip: { type: catalog.tooltipType },\n        sourceOptions\n      }\n    } as CatalogItem;\n\n    return ObjectUtils.removeUndefined(layerPrepare);\n  }\n\n  private prepareCatalogItemGroup(\n    itemListIn,\n    regexes,\n    idGroup,\n    layersQueryFormat,\n    catalog\n  ) {\n    const groupPrepare = {\n      id: idGroup,\n      type: CatalogItemType.Group,\n      title: itemListIn.Title,\n      address: catalog.id,\n      externalProvider: catalog.externalProvider || false,\n      sortDirection: catalog.sortDirection, // propagate sortDirection\n      items: itemListIn.Layer.reduce((items: CatalogItem[], layer: any) => {\n        if (layer.Layer !== undefined) {\n          // recursive, check next level\n          const idGroupItemNextLevel =\n            idGroup + `.group.${layer.Name || layer.Layer[0].Name}`;\n          const groupItem: CatalogItemGroup = this.prepareCatalogItemGroup(\n            layer,\n            regexes,\n            idGroupItemNextLevel,\n            layersQueryFormat,\n            catalog\n          );\n\n          items.push(groupItem);\n        } else {\n          if (this.testLayerRegexes(layer.Name, regexes) === false) {\n            return items;\n          }\n\n          const layerItem: CatalogItemLayer<ImageLayerOptions> = this.prepareCatalogItemLayer(\n            layer,\n            idGroup,\n            layersQueryFormat,\n            catalog\n          );\n\n          items.push(layerItem);\n        }\n        return items;\n      }, [])\n    };\n    return groupPrepare;\n  }\n\n  private includeRecursiveItems(\n    catalog: Catalog,\n    itemListIn: any,\n    itemsPrepare: CatalogItem[],\n    loopLevel: number = 0\n  ) {\n    // Dig all levels until last level (layer object are not defined on last level)\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n    if (!itemListIn.Layer) {\n      return;\n    }\n\n    for (const item of itemListIn.Layer) {\n      if (item.Layer !== undefined) {\n        // recursive, check next level\n        this.includeRecursiveItems(catalog, item, itemsPrepare, loopLevel + 1);\n        continue;\n      }\n\n      const layersQueryFormat = this.findCatalogInfoFormat(catalog);\n\n      // group(with layers) and layer(without group) level 1\n      if (loopLevel !== 0) {\n        // TODO: Slice that into multiple methods\n        // Define object of group layer\n        const idGroupItem = `catalog.group.${itemListIn.Name || item.Name}`;\n        const groupItem = this.prepareCatalogItemGroup(\n          itemListIn,\n          regexes,\n          idGroupItem,\n          layersQueryFormat,\n          catalog\n        );\n\n        if (groupItem.items.length !== 0) {\n          itemsPrepare.push(groupItem);\n        }\n\n        // Break the group (don't add a group of layer for each of their layer!)\n        break;\n      } else {\n        // layer without group\n        if (this.testLayerRegexes(item.Name, regexes) !== false) {\n          const layerItem = this.prepareCatalogItemLayer(\n            item,\n            catalog.id,\n            layersQueryFormat,\n            catalog\n          );\n          itemsPrepare.push(layerItem);\n        }\n      }\n    }\n  }\n\n  /// WMTS\n\n  private getWMTSItems(\n    catalog,\n    capabilities: { [key: string]: any }\n  ): CatalogItemLayer[] {\n    if (!capabilities) {\n      return [];\n    }\n    const layers = capabilities.Contents.Layer;\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    if (\n      capabilities.ServiceIdentification &&\n      capabilities.ServiceIdentification.Abstract &&\n      capabilities.ServiceIdentification.Abstract.length) {\n      catalog.abstract = capabilities.ServiceIdentification.Abstract;\n    }\n\n    return layers\n      .map((layer: any) => {\n\n        const propertiesToForce = this.computeForcedProperties(layer.Title, catalog.forcedProperties);\n        let extern = true;\n\n        let metadataUrl = propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll;\n        let metadataAbstract = propertiesToForce?.metadataAbstract || propertiesToForce?.metadataAbstractAll || catalog.abstract;\n\n        if (\n          !propertiesToForce?.metadataUrl &&\n          !propertiesToForce?.metadataUrlAll &&\n          (propertiesToForce?.metadataAbstract ||\n            propertiesToForce?.metadataAbstractAll)\n        ) {\n          extern = false;\n        }\n        if (propertiesToForce?.metadataAbstract && propertiesToForce?.metadataUrlAll) {\n          extern = false;\n        }\n\n\n      if (this.testLayerRegexes(layer.Identifier, regexes) === false) {\n        return undefined;\n      }\n      const params = Object.assign({}, catalog.queryParams, {\n        version: '1.0.0'\n      });\n      const baseSourceOptions = {\n        type: 'wmts',\n        url: catalog.url,\n        crossOrigin: catalog.setCrossOriginAnonymous\n          ? 'anonymous'\n          : undefined,\n        layer: layer.Identifier,\n        matrixSet: catalog.matrixSet,\n        optionsFromCapabilities: true,\n        requestEncoding: catalog.requestEncoding || 'KVP',\n        style: 'default'\n      } as WMTSDataSourceOptions;\n      const sourceOptions = Object.assign(\n        {},\n        baseSourceOptions,\n        catalog.sourceOptions,\n        { params }\n      ) as WMTSDataSourceOptions;\n\n      return ObjectUtils.removeUndefined({\n        id: generateIdFromSourceOptions(sourceOptions),\n        type: CatalogItemType.Layer,\n        title: propertiesToForce?.title ? propertiesToForce.title : layer.Title,\n        address: catalog.id,\n        externalProvider: catalog.externalProvider,\n        options: {\n          sourceOptions,\n          metadata: {\n            url: metadataUrl,\n            extern,\n            abstract: metadataAbstract,\n            type: baseSourceOptions.type\n          }\n        }\n      } as CatalogItem);\n    })\n    .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n}\n\n/// ERSI\n\n  private getArcGISRESTItems(\n    catalog,\n    capabilities\n  ): CatalogItemLayer[] {\n    if (!capabilities) {\n      return [];\n    }\n    const layers =\n    !capabilities.layers ? [] : capabilities.layers.filter(layer => !layer.type || layer.type === 'Feature Layer');\n    if (!capabilities.layers) {\n      this.messageService.error(\n        this.languageService.translate.instant('igo.geo.catalog.someUnavailable'),\n        this.languageService.translate.instant('igo.geo.catalog.unavailableTitle')\n      );\n    }\n\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    let abstract;\n    if (capabilities.serviceDescription && capabilities.serviceDescription.length) {\n      const regex = /(<([^>]+)>)/ig;\n      abstract = capabilities.serviceDescription.replace(regex, '');\n    }\n\n    return layers\n      .map((layer: any) => {\n\n        const propertiesToForce = this.computeForcedProperties(layer.name, catalog.forcedProperties);\n        let baseAbstract;\n        let extern = true;\n        if (layer.Abstract) {\n          baseAbstract = layer.Abstract;\n        } else if (!layer.Abstract && catalog.abstract) {\n          baseAbstract = catalog.abstract;\n        }\n\n        let metadataUrl = propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll;\n        let metadataAbstract = propertiesToForce?.metadataAbstract || propertiesToForce?.metadataAbstractAll || baseAbstract;\n\n        if (\n          !propertiesToForce?.metadataUrl &&\n          !propertiesToForce?.metadataUrlAll &&\n          (propertiesToForce?.metadataAbstract ||\n            propertiesToForce?.metadataAbstractAll)\n        ) {\n          extern = false;\n        }\n        if (propertiesToForce?.metadataAbstract && propertiesToForce?.metadataUrlAll) {\n          extern = false;\n        }\n\n        if (this.testLayerRegexes(layer.id, regexes) === false) {\n          return undefined;\n        }\n        const baseSourceOptions = {\n          type: TypeCatalog[catalog.type],\n          url: catalog.url,\n          crossOrigin: catalog.setCrossOriginAnonymous\n            ? 'anonymous'\n            : undefined,\n          layer: layer.id as string,\n          queryable: true,\n          queryFormat: 'esrijson',\n          matrixSet: catalog.matrixSet,\n          optionsFromCapabilities: true,\n          style: 'default'\n        } as ArcGISRestDataSourceOptions;\n        const sourceOptions = Object.assign(\n          {},\n          baseSourceOptions,\n          catalog.sourceOptions\n        ) as ArcGISRestDataSourceOptions;\n        return ObjectUtils.removeUndefined({\n          id: generateIdFromSourceOptions(sourceOptions),\n          type: CatalogItemType.Layer,\n          title: propertiesToForce?.title ? propertiesToForce.title : layer.name,\n          externalProvider: catalog.externalProvider,\n          address: catalog.id,\n          options: {\n            sourceOptions,\n            minResolution: getResolutionFromScale(layer.maxScale),\n            maxResolution: getResolutionFromScale(layer.minScale),\n            metadata: {\n              url: metadataUrl,\n              extern,\n              abstract: metadataAbstract,\n              type: baseSourceOptions.type\n            },\n          }\n        } as CatalogItem);\n      })\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n  }\n\n  private testLayerRegexes(layerName: string, regexes: RegExp[]): boolean {\n    if (regexes.length === 0) {\n      return true;\n    }\n    return regexes.find((regex: RegExp) => regex.test(layerName)) !== undefined;\n  }\n\n  private retrieveLayerInfoFormat(\n    layerNameFromCatalog: string,\n    layersQueryFormat: { layer: string; queryFormat: QueryFormat }[]\n  ): QueryFormat {\n    const currentLayerInfoFormat = layersQueryFormat.find(\n      (f) => f.layer === layerNameFromCatalog\n    );\n    const baseInfoFormat = layersQueryFormat.find((f) => f.layer === '*');\n    let queryFormat: QueryFormat;\n    if (currentLayerInfoFormat) {\n      queryFormat = currentLayerInfoFormat.queryFormat;\n    } else if (baseInfoFormat) {\n      queryFormat = baseInfoFormat.queryFormat;\n    }\n    return queryFormat;\n  }\n\n  private findCatalogInfoFormat(\n    catalog: Catalog\n  ): { layer: string; queryFormat: QueryFormat }[] {\n    const layersQueryFormat: { layer: string; queryFormat: QueryFormat }[] = [];\n    if (!catalog.queryFormat) {\n      return layersQueryFormat;\n    }\n    Object.keys(catalog.queryFormat).forEach((configuredInfoFormat) => {\n      if (catalog.queryFormat[configuredInfoFormat] instanceof Array) {\n        catalog.queryFormat[configuredInfoFormat].forEach((layerName) => {\n          if (\n            !layersQueryFormat.find((specific) => specific.layer === layerName)\n          ) {\n            layersQueryFormat.push({\n              layer: layerName,\n              queryFormat: configuredInfoFormat as QueryFormat\n            });\n          }\n        });\n      } else {\n        if (\n          !layersQueryFormat.find(\n            (specific) =>\n              specific.layer === catalog.queryFormat[configuredInfoFormat]\n          )\n        ) {\n          layersQueryFormat.push({\n            layer: catalog.queryFormat[configuredInfoFormat],\n            queryFormat: configuredInfoFormat as QueryFormat\n          });\n        }\n      }\n    });\n    return layersQueryFormat;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <igo-catalog-browser-group\n        [catalog]=\"catalog\"\n        [group]=\"item\"\n        [state]=\"store.state\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [collapsed]=\"(store.count === 1) ? false : true\"\n        [toggleCollapsed]=\"toggleCollapsedGroup\"\n        (addedChange)=\"onGroupAddedChange($event)\"\n        (layerAddedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-group>\n    </ng-container>\n\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"item\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"store.state.get(item).added\"\n        (addedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { zip, BehaviorSubject } from 'rxjs';\n\nimport { EntityStore, EntityStoreWatcher } from '@igo2/common';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { IgoMap } from '../../map';\n\nimport {\n  Catalog,\n  CatalogItem,\n  CatalogItemLayer,\n  CatalogItemGroup,\n  CatalogItemState,\n  CatalogItemType\n} from '../shared';\n\n/**\n * Component to browse a catalog's groups and layers and display them on a map.\n */\n@Component({\n  selector: 'igo-catalog-browser',\n  templateUrl: './catalog-browser.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserComponent implements OnInit, OnDestroy {\n  /**\n   * Catalog items store watcher\n   */\n  private watcher: EntityStoreWatcher<CatalogItem>;\n\n // private resolution$$: Subscription;\n\n  get resolution$(): BehaviorSubject<number> { return this.map.viewController.resolution$; }\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Store holding the catalog's items\n   */\n  @Input() store: EntityStore<CatalogItem, CatalogItemState>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Whether a group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsedGroup: boolean = true;\n\n  constructor(\n    private layerService: LayerService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    const currentItems = this.map.layers.map((layer: Layer) => {\n      return {\n        id: layer.options.source.id,\n        title: layer.title,\n        type: CatalogItemType.Layer\n      };\n    });\n    this.store.state.updateMany(currentItems, { added: true }, true);\n    if (this.catalog && this.catalog.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.catalog.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n      });\n    }\n\n    const catalogShowLegend = this.catalog ? this.catalog.showLegend : false;\n    this.catalogAllowLegend = catalogShowLegend ? catalogShowLegend : this.catalogAllowLegend;\n\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n  }\n\n  ngOnDestroy() {\n    this.watcher.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * When a layer is added or removed, add or remove it from the map\n   * @internal\n   * @param event Layer added event\n   */\n  onLayerAddedChange(event: { added: boolean; layer: CatalogItemLayer }) {\n    const layer = event.layer;\n    this.store.state.update(layer, { added: event.added }, false);\n    event.added ? this.addLayerToMap(layer) : this.removeLayerFromMap(layer);\n  }\n\n  /**\n   * When a froup is added or removed, add or remove it from the map\n   * @internal\n   * @param event Group added event\n   */\n  onGroupAddedChange(event: { added: boolean; group: CatalogItemGroup }) {\n    const group = event.group;\n    this.store.state.update(group, { added: event.added }, false);\n    event.added ? this.addGroupToMap(group) : this.removeGroupFromMap(group);\n  }\n\n  /**\n   * Add layer to map\n   * @param layer Catalog layer\n   */\n  private addLayerToMap(layer: CatalogItemLayer) {\n    this.addLayersToMap([layer]);\n  }\n\n  /**\n   * Remove layer from map\n   * @param layer Catalog layer\n   */\n  private removeLayerFromMap(layer: CatalogItemLayer) {\n    this.removeLayersFromMap([layer]);\n  }\n\n  /**\n   * Add multiple layers to map\n   * @param layers Catalog layers\n   */\n  private addLayersToMap(layers: CatalogItemLayer[]) {\n    const layers$ = layers.map((layer: CatalogItemLayer) => {\n      if (!layer.options.sourceOptions.optionsFromApi) {\n        layer.options.sourceOptions.optionsFromApi = true;\n      }\n      return this.layerService.createAsyncLayer(layer.options);\n    });\n\n    zip(...layers$).subscribe((oLayers: Layer[]) => {\n      this.store.state.updateMany(layers, { added: true });\n      this.map.addLayers(oLayers);\n    });\n  }\n\n  /**\n   * Remove multiple layers from map\n   * @param layers Catalog layers\n   */\n  private removeLayersFromMap(layers: CatalogItemLayer[]) {\n    layers.forEach((layer: CatalogItemLayer) => {\n      this.store.state.update(layer, { added: false });\n      if (layer.options.baseLayer === true) {\n        const oLayer = this.map.getLayerById(layer.options.id);\n        if (oLayer !== undefined) {\n          this.map.removeLayer(oLayer);\n        }\n      } else {\n        const oLayer = this.map.getLayerById(layer.id);\n        if (oLayer !== undefined) {\n          this.map.removeLayer(oLayer);\n        }\n      }\n    });\n  }\n\n  /**\n   * Sort the layers by title. asc or desc.\n   * @internal\n   */\n  private sortCatalogItemsByTitle(items: CatalogItem[], direction) {\n    const returnItem = items.sort((a, b) => {\n      const titleA = a.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      const titleB = b.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n\n      if (titleA < titleB) {\n        return -1;\n      }\n      if (titleA > titleB) {\n        return 1;\n      }\n      return 0;\n    });\n    switch (direction) {\n      case 'asc':\n        return returnItem;\n      case 'desc':\n        return returnItem.reverse();\n      default:\n        return items;\n    }\n  }\n\n  /**\n   * Add all the layers of a group to map\n   * @param group Catalog group\n   */\n  private addGroupToMap(group: CatalogItemGroup) {\n    let layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === false;\n    });\n    if (group.sortDirection !== undefined) {\n      layers = this.sortCatalogItemsByTitle(layers, group.sortDirection);\n    }\n    this.addLayersToMap(layers.reverse() as CatalogItemLayer[]);\n  }\n\n  /**\n   * Remove all the layers of a group from map\n   * @param group Catalog group\n   */\n  private removeGroupFromMap(group: CatalogItemGroup) {\n    const layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === true;\n    });\n    this.removeLayersFromMap(layers as CatalogItemLayer[]);\n  }\n}\n","<ng-container *ngIf=\"legendItems$ | async as items\">\n  <ng-container *ngIf=\"items.length; else noItems\">\n    <ng-container *ngFor=\"let item of items.slice().reverse()\" #renderedLegends>\n      <div *ngIf=\"getLegend; else noItems\">\n        <mat-list-item *ngIf=\"item.title\">\n          <mat-icon\n            id=\"legend-toggle\"\n            class=\"igo-chevron\"\n            mat-list-avatar\n            igoCollapse\n            [target]=\"legend\"\n            [collapsed]=\"(item.collapsed)\"\n            (toggle)=\"toggleLegendItem($event, item)\"\n            svgIcon=\"chevron-up\">\n          </mat-icon>\n          <h4 matLine>{{computeItemTitle(item) | async}} </h4>\n        </mat-list-item>\n        <div #legend class=\"igo-layer-legend\" [ngClass]=\"{'with-title': item.title}\">\n          <div *ngIf=\"currentStyle !== undefined\">\n              <mat-form-field>\n                <mat-select tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n                  [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" [(ngModel)]=\"currentStyle\"\n                  (selectionChange)=\"onChangeStyle()\">\n                  <mat-option *ngFor=\"let style of styles\" [value]=\"style.name\">{{style.title}}</mat-option>\n                </mat-select>\n            </mat-form-field>\n          </div>\n          <div *ngIf=\"!(item.collapsed)\">\n            <div *ngIf=\"item.url\">\n              <img #renderedLegend id=\"{{item.title}}\" (load)=\"onLoadImage(item.title)\"\n                src=\"{{[item.imgGraphValue]}}\"\n                alt=\"{{'igo.geo.layer.legend.loadingLegendText' | translate}}\">\n              <small *ngIf=\"imagesHeight[item.title]<16\">\n                  {{'igo.geo.layer.legend.noLegendScale' | translate}}\n              </small>\n            </div>\n            <div\n              [ngStyle]=\"item.style\"\n              [innerHTML]=\"item.html | sanitizeHtml\"\n              *ngIf=\"item.html\">\n            </div>\n          </div>\n        </div>\n      </div>\n    </ng-container>\n  </ng-container>\n\n  <ng-template #noItems>\n    <small>\n      {{'igo.geo.layer.legend.noLegendText' | translate}}\n    </small>\n  </ng-template>\n\n</ng-container>\n","import { HttpClient } from '@angular/common/http';\nimport { Component, Input, OnInit, OnDestroy, ChangeDetectionStrategy, ViewChildren, ElementRef, ChangeDetectorRef } from '@angular/core';\nimport type { QueryList } from '@angular/core';\n\nimport { Subscription, BehaviorSubject, of, Observable } from 'rxjs';\n\nimport { Legend } from '../../datasource/shared/datasources/datasource.interface';\nimport { Layer, ItemStyleOptions } from '../shared/layers';\nimport { LegendMapViewOptions } from '../shared/layers/layer.interface';\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { catchError, map } from 'rxjs/operators';\nimport { LanguageService, ConfigService } from '@igo2/core';\nimport { WMSDataSource, WMSDataSourceOptions } from '../../datasource';\nimport { SecureImagePipe } from '@igo2/common';\n\n@Component({\n  selector: 'igo-layer-legend',\n  templateUrl: './layer-legend.component.html',\n  styleUrls: ['./layer-legend.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendComponent implements OnInit, OnDestroy {\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  /**\n   * Observable of the legend items\n   */\n  legendItems$: BehaviorSubject<Legend[]> = new BehaviorSubject([]);\n\n  /**\n   * Subscription to the map's resolution\n   */\n  private state$$: Subscription;\n\n  /**\n   * The available styles\n   */\n  public styles;\n\n  /**\n   * The style used to make the legend\n   */\n  public currentStyle;\n\n  /**\n   * The scale used to make the legend\n   */\n  private scale: number = undefined;\n\n  /**\n   * The extent used to make the legend\n   */\n  private view: LegendMapViewOptions = undefined;\n  /**\n   * Get list of images display\n   */\n  @ViewChildren('renderedLegend') renderedLegends: QueryList<ElementRef>;\n\n  /**\n   * List of size of images displayed\n   */\n  public imagesHeight: { [srcKey: string]: number } = {};\n\n  /**\n   * Layer\n   */\n  @Input() layer: Layer;\n\n  /**\n   * if getLegendGraphic is authorized\n   */\n  public getLegend = true;\n\n  /**\n   * activeLegend\n   */\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private languageService: LanguageService,\n    private configService: ConfigService,\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * On init, subscribe to the map's resolution and update the legend accordingly\n   */\n  ngOnInit() {\n    let lastlLegend = this.layer.legend;\n    this.styles = this.listStyles();\n    const sourceOptions = this.layer.options.source.options as any;\n    if (sourceOptions && sourceOptions.params && sourceOptions.params.STYLES) {\n      // if a styles is provided into the layers wms params\n      this.currentStyle = this.styles.find(style => style.name === sourceOptions.params.STYLES).name;\n    } else if (!lastlLegend) {\n      // if no legend is manually provided\n      if (this.styles && this.styles.length > 1) {\n        this.currentStyle = this.styles[0].name;\n      }\n    } else if (this.styles && this.styles.length > 1) {\n      this.currentStyle = lastlLegend[0].currentStyle;\n    }\n    if (typeof this.layer.options.legendOptions !== 'undefined' && this.layer.options.legendOptions.display === false) {\n      lastlLegend = [];\n    } else {\n      lastlLegend = this.layer.dataSource.getLegend(this.currentStyle, this.view);\n    }\n\n    if (this.updateLegendOnResolutionChange || (sourceOptions as WMSDataSourceOptions).contentDependentLegend) {\n      const state$ = this.layer.map.viewController.state$;\n      this.state$$ = state$.subscribe(() => this.onViewControllerStateChange());\n    } else if (lastlLegend && lastlLegend.length !== 0) {\n      this.legendItems$.next(lastlLegend);\n      for (const legend of lastlLegend) {\n        this.getLegendGraphic(legend);\n      }\n    }\n  }\n\n  /**\n   * On destroy, unsubscribe to the map's view state\n   */\n  ngOnDestroy() {\n    if (this.state$$ !== undefined) {\n      this.state$$.unsubscribe();\n    }\n  }\n\n  getLegendGraphic(item: Legend) {\n    if (item.url) {\n      const secureIMG = new SecureImagePipe(this.http, this.configService);\n      secureIMG.transform(item.url).pipe(\n        catchError((err) => {\n          if (err.error) {\n            err.error.caught = true;\n            this.getLegend = false;\n            this.cdRef.detectChanges();\n            return err;\n          }\n        })\n        ).subscribe(obsLegGraph => {\n          const idx = this.legendItems$.value.findIndex(leg => leg.title === item.title);\n          const legendGraph = obsLegGraph as string;\n          this.legendItems$.value[idx].imgGraphValue = legendGraph;\n          this.cdRef.detectChanges();\n        }\n      );\n    }\n  }\n\n  toggleLegendItem(collapsed: boolean, item: Legend) {\n    item.collapsed = collapsed;\n  }\n\n  private transfertToggleLegendItem(newLegends: Legend[]): Legend[] {\n    const outLegends: Legend[] = newLegends;\n    const lastLegends = this.layer.legend;\n    for (let i = 0; i < lastLegends.length; i++) {\n      outLegends[i].collapsed = lastLegends[i].collapsed;\n   }\n    return outLegends;\n  }\n\n  computeItemTitle(layerLegend): Observable<string> {\n    const layerOptions = this.layer.dataSource.options as any;\n    if (layerOptions.type !== 'wms') {\n      return of(layerLegend.title);\n    }\n\n    const layers = layerOptions.params.LAYERS.split(',');\n    const localLayerOptions = JSON.parse(JSON.stringify(layerOptions)); // to avoid to alter the original options.\n    localLayerOptions.params.LAYERS = layers.find(layer => layer === layerLegend.title);\n    return this.capabilitiesService\n      .getWMSOptions(localLayerOptions)\n      .pipe(map(wmsDataSourceOptions => {\n        return wmsDataSourceOptions._layerOptionsFromSource.title;\n      }));\n  }\n\n  /**\n   * On resolution change, compute the effective scale level and update the\n   * legend accordingly.\n   * @param resolution Map resolution\n   */\n  private onViewControllerStateChange() {\n    this.view = {\n      resolution: this.layer.map.viewController.getResolution(),\n      extent: this.layer.map.viewController.getExtent(),\n      projection: this.layer.map.viewController.getOlProjection().getCode(),\n      scale: this.layer.map.viewController.getScale(),\n      size: this.layer.map.ol.getSize()\n    } as LegendMapViewOptions;\n    this.updateLegend();\n  }\n\n  /**\n   * Update the legend with scale level and style define\n   */\n  private updateLegend() {\n    let legendItems = this.layer.dataSource.getLegend(this.currentStyle, this.view);\n    if (this.layer.legend && this.layer.legend.length > 1) { legendItems = this.transfertToggleLegendItem(legendItems); }\n    this.layer.legend = legendItems;\n\n    if (legendItems.length === 0 && this.legendItems$.value.length === 0) {\n      return;\n    }\n    this.legendItems$.next(legendItems);\n    for (const legend of this.legendItems$.value) {\n      this.getLegendGraphic(legend);\n    }\n  }\n\n  private listStyles() {\n    const layerOptions = this.layer.options;\n    if (layerOptions && layerOptions.legendOptions) {\n      const translate = this.languageService.translate;\n      const title = translate.instant('igo.geo.layer.legend.default');\n      let stylesAvailable = [{ name: '', title } as ItemStyleOptions];\n      if (layerOptions.legendOptions.stylesAvailable) {\n        stylesAvailable = stylesAvailable.concat(layerOptions.legendOptions.stylesAvailable.filter(sA => (\n          sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !== 'default' &&\n          sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !== 'defaut')));\n      }\n      stylesAvailable.filter(sa => !sa.title).map((sa) => sa.title = sa.name);\n      stylesAvailable.map(s => s.title = s.title.charAt(0).toUpperCase() + s.title.slice(1).replace(/_/g, ' '));\n      return stylesAvailable;\n    }\n    return ;\n  }\n\n  onChangeStyle() {\n    this.updateLegend();\n    let STYLES = '';\n    if (this.layer.dataSource instanceof WMSDataSource) {\n      this.layer.dataSource.ol.getParams().LAYERS.split(',').map(layer =>\n        STYLES += this.currentStyle + ','\n      );\n      STYLES = STYLES.slice(0, -1);\n      this.layer.dataSource.ol.updateParams({ STYLES });\n    }\n  }\n\n  onLoadImage(id: string) {\n    let elemRef: HTMLImageElement;\n    if (this.renderedLegends.length === 1) {\n      elemRef = this.renderedLegends.first.nativeElement as HTMLImageElement;\n    } else {\n      elemRef = this.renderedLegends.find(renderedLegend => renderedLegend.nativeElement.id === id).nativeElement as HTMLImageElement;\n    }\n    this.imagesHeight[id] = elemRef.height;\n  }\n}\n","<mat-list-item>\n  <mat-icon *ngIf=\"haveGroup()\" mat-list-avatar svgIcon=\"blank\"></mat-icon>\n  <h4 mat-line matTooltipShowDelay=\"500\" [ngClass]=\"(catalogAllowLegend)?'igo-cataloglayer-title':''\" (click)=\"askForLegend($event)\" [matTooltip]=\"computeTitleTooltip()\">{{title}}</h4>\n\n    <button *ngIf=\"layer.externalProvider\"\n      disabled=\"true\"\n      mat-icon-button>\n    <mat-icon\n      class=\"igo-cataloglayer-external-icon\"\n      *ngIf=\"layer.externalProvider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.layer' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n      svgIcon=\"earth-arrow-right\">\n    </mat-icon>\n  </button>\n  <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n\n  <button\n    (mouseenter)=\"onMouseEvent($event)\" (mouseleave)=\"onMouseEvent($event)\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"computeTooltip() | translate\"\n    [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n    (click)=\"onToggleClick($event)\">\n    <mat-icon\n       matBadge=\"icon\"\n       igoMatBadgeIcon=\"eye-off\"\n       igoMatBadgeInverseColor=\"true\"\n       [matBadgeHidden]=\"isInResolutionsRange()\"\n       matBadgeDisabled=\"true\"\n       matBadgeSize=\"small\"\n       matBadgePosition=\"after\"\n       [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\">\n    </mat-icon>\n  </button>\n\n</mat-list-item>\n\n<div #legend class=\"igo-cataloglayer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"(layerLegendShown$ | async) && (igoLayer$ | async) && catalogAllowLegend\"\n    [layer]=\"igoLayer$ | async\">\n  </igo-layer-legend>\n</div>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\n\nimport { CatalogItemLayer } from '../shared';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { first } from 'rxjs/operators';\nimport { Layer, TooltipType } from '../../layer/shared/layers';\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\n\n/**\n * Catalog browser layer item\n */\n@Component({\n  selector: 'igo-catalog-browser-layer',\n  templateUrl: './catalog-browser-layer.component.html',\n  styleUrls: ['./catalog-browser-layer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserLayerComponent implements OnInit, OnDestroy {\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private isPreview$$: Subscription;\n  private lastTimeoutRequest;\n\n  public layerLegendShown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public igoLayer$ = new BehaviorSubject<Layer>(undefined);\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog layer\n   */\n  @Input() layer: CatalogItemLayer;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added = false;\n\n  /**\n   * Event emitted when the add/remove button is clicked\n   */\n  @Output() addedChange = new EventEmitter<{\n    added: boolean;\n    layer: CatalogItemLayer;\n  }>();\n\n  @Output() addedLayerIsPreview = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.layer);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.layer) || 'layers';\n  }\n\n  constructor(private layerService: LayerService ) {}\n\n  ngOnInit(): void {\n    this.isInResolutionsRange();\n    this.isPreview$$ = this.isPreview$.subscribe(value => this.addedLayerIsPreview.emit(value));\n  }\n\n  ngOnDestroy() {\n    this.isPreview$$.unsubscribe();\n  }\n\n  computeTitleTooltip(): string {\n      const layerOptions = this.layer.options;\n      if (!layerOptions.tooltip) {\n        return getEntityTitle(this.layer);\n      }\n      const layerTooltip = layerOptions.tooltip;\n      const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n      switch (layerOptions.tooltip.type) {\n        case TooltipType.TITLE:\n          return this.layer.title;\n        case TooltipType.ABSTRACT:\n          if (layerMetadata && layerMetadata.abstract) {\n            return layerMetadata.abstract;\n          } else {\n            return this.layer.title;\n          }\n        case TooltipType.CUSTOM:\n          if (layerTooltip && layerTooltip.text) {\n            return layerTooltip.text;\n          } else {\n            return this.layer.title;\n          }\n        default:\n          return this.layer.title;\n      }\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  askForLegend(event) {\n    this.layerLegendShown$.next(!this.layerLegendShown$.value);\n    this.layerService.createAsyncLayer(this.layer.options).pipe(first())\n    .subscribe(layer => this.igoLayer$.next(layer));\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    if (event.type === 'mouseenter' && this.mouseInsideAdd ) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove();\n          } else {\n            this.add();\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add();\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove();\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add() {\n    if (!this.added) {\n      this.added = true;\n      this.addedChange.emit({ added: true, layer: this.layer });\n    }\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private remove() {\n    if (this.added) {\n      this.added = false;\n      this.addedChange.emit({ added: false, layer: this.layer });\n    }\n  }\n\n  haveGroup(): boolean {\n    return !(!this.layer.address || this.layer.address.split('.').length === 1);\n  }\n\n  isInResolutionsRange(): boolean {\n    const minResolution = this.layer.options.minResolution || 0;\n    const maxResolution = this.layer.options.maxResolution || Infinity;\n    this.inRange$.next(\n      this.resolution >= minResolution && this.resolution <= maxResolution\n    );\n    return this.inRange$.value;\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      return this.isPreview$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : this.inRange$.value\n        ? 'igo.geo.catalog.layer.removeFromMap'\n        : 'igo.geo.catalog.layer.removeFromMapOutRange';\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n}\n","<mat-list-item>\n  <mat-icon\n    mat-list-avatar\n    svgIcon=\"chevron-up\"\n    igoCollapse\n    class=\"igo-chevron\"\n    [target]=\"items\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"onToggleCollapsed($event)\">\n  </mat-icon>\n\n  <h4 class=\"igo-catalog-group-title\" id=\"catalog-group-title\" mat-line matTooltipShowDelay=\"500\" [matTooltip]=\"title\" (click)=\"onTitleClick()\">{{title}}</h4>\n\n  <button *ngIf=\"group.externalProvider\"\n    disabled=\"true\"\n    mat-icon-button>\n    <mat-icon\n      class=\"igo-cataloggroup-external-icon\"\n      *ngIf=\"group.externalProvider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.group' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n      svgIcon=\"earth-arrow-right\">\n    </mat-icon>\n  </button>\n\n  <ng-container *ngIf=\"(added$ | async) && (preview$ | async) === false; else notadded\">\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.group.removeFromMap' | translate\"\n      color=\"warn\"\n      [disabled]=\"disabled$ | async\"\n      (click)=\"onToggleClick()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n  </ng-container>\n\n  <ng-template #notadded>\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.group.addToMap' | translate\"\n      [disabled]=\"disabled$ | async\"\n      (click)=\"onToggleClick()\">\n      <mat-icon svgIcon=\"plus\"></mat-icon>\n    </button>\n  </ng-template>\n</mat-list-item>\n\n<div #items>\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <!-- todo: add display ans manage CatalogItemGroup -->\n    </ng-container>\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"item\"\n        [resolution]=\"resolution\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"state.get(item).added\"\n        (addedLayerIsPreview)=\"onLayerPreview($event)\"\n        (addedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { EntityStore } from '@igo2/common';\nimport type { EntityStateManager } from '@igo2/common';\n\nimport {\n  Catalog,\n  CatalogItem,\n  CatalogItemGroup,\n  CatalogItemLayer,\n  CatalogItemState,\n  CatalogItemType\n} from '../shared';\n\n/**\n * Catalog browser group item\n */\n@Component({\n  selector: 'igo-catalog-browser-group',\n  templateUrl: './catalog-browser-group.component.html',\n  styleUrls: ['./catalog-browser-group.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserGroupComponent implements OnInit, OnDestroy {\n\n  /**\n   * Group's items store\n   * @internal\n   */\n  store = new EntityStore<CatalogItem, CatalogItemState>([]);\n\n  /**\n   * Whether all the layers of the group are added\n   * @internal\n   */\n  added$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  preview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Whether the toggle button is disabled\n   * @internal\n   */\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Catalog group\n   */\n  @Input() group: CatalogItemGroup;\n\n  /**\n   * Whether the group is collapsed\n   */\n  @Input() collapsed: boolean = true;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Whether the group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsed: boolean = true;\n\n  /**\n   * Parent catalog's items store state. Groups share a unique\n   * EntityState that tracks the group and it's layers state (whether they are added or not).\n   * Sharing a unique state would also allow us to expand this component to allow\n   * the selection of a layer while unselecting any layer already selected in another group.\n   * This could be useful to display some layer info before adding it, for example.\n   */\n  @Input() state: EntityStateManager<CatalogItem, CatalogItemState>;\n\n  /**\n   * Event emitted when the add/remove button of the group is clicked\n   */\n  @Output() addedChange = new EventEmitter<{\n    added: boolean;\n    group: CatalogItemGroup;\n  }>();\n\n  /**\n   * Event emitted when the add/remove button of a layer is clicked\n   */\n  @Output() layerAddedChange = new EventEmitter<{\n    added: boolean;\n    layer: CatalogItemLayer;\n  }>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return this.group.title;\n  }\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.load(this.group.items);\n    this.evaluateAdded();\n    this.evaluateDisabled(this.collapsed);\n    if (this.group.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.group.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n        });\n    }\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick() {\n    this.added$.value ? this.remove() : this.add();\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleCollapsed(collapsed: boolean) {\n    this.evaluateDisabled(collapsed);\n  }\n\n  /**\n   * When a layer is added or removed, evaluate if all the layers of the group\n   * are now added or removed. If so, consider that the group itself is added\n   * or removed.\n   * @internal\n   * @param event Layer added change event\n   */\n  onLayerAddedChange(event: { added: boolean; layer: CatalogItemLayer }) {\n    this.layerAddedChange.emit(event);\n    this.tryToggleGroup(event);\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add() {\n    this.added$.next(true);\n    this.addedChange.emit({\n      added: true,\n      group: this.group\n    });\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private remove() {\n    this.added$.next(false);\n    this.addedChange.emit({\n      added: false,\n      group: this.group\n    });\n  }\n\n  onLayerPreview(event) {\n    this.preview$.next(event);\n  }\n\n  /**\n   * If all the layers of the group added or removed, add or remove the group itself.\n   * @param event The last layer added change event to occur\n   */\n  private tryToggleGroup(event: { added: boolean; layer: CatalogItemLayer }) {\n    const added = event.added;\n    const layer = event.layer;\n\n    const layersAdded = this.store.view\n      .all()\n      .filter((item: CatalogItem) => item.id !== layer.id)\n      .map((item: CatalogItem) => this.state.get(item).added || false);\n\n    if (layersAdded.every(value => value === added)) {\n      added ? this.add() : this.remove();\n    } else if (this.added$.value === true) {\n      this.added$.next(false);\n    }\n  }\n\n  private evaluateAdded() {\n    const added = this.store.all().every((item: CatalogItem) => {\n      return (this.state.get(item).added || false) === true;\n    });\n    this.added$.next(added);\n  }\n\n  private evaluateDisabled(collapsed: boolean) {\n    let disabled = false;\n    if (this.toggleCollapsed === false) {\n      disabled = collapsed;\n    }\n    this.disabled$.next(disabled);\n  }\n\n  onTitleClick() {\n    this.collapsed = !this.collapsed;\n  }\n}\n","import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerListToolService {\n  public keyword: string;\n  public sortAlpha = false;\n  public onlyVisible = false;\n  public onlyInRange = false;\n  public keywordInitialized = false;\n  public sortedAlphaInitialized = false;\n  public onlyVisibleInitialized = false;\n  public onlyInRangeInitialized = false;\n\n  constructor() {}\n\n}\n","<mat-list-item class= \"igo-layer-list-item\">\n  <mat-checkbox *ngIf=\"selectionMode\"\n    class=\"layerCheck\"\n    mat-list-icon\n    (change)=\"check()\"\n    [checked]=\"layerCheck\">\n  </mat-checkbox>\n  <h4 (click)=\"toggleLegendOnClick()\" matLine class=\"igo-layer-title\" [matTooltip]=\"tooltipText\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n\n  <button *ngIf=\"!selectionMode\"\n    mat-icon-button\n    [color]=\"layer.visible ? 'primary' : 'default'\"\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"eyeTooltip | translate\"\n    (click)=\"toggleVisibility()\">\n    <mat-icon\n      matBadge=\"?\"\n      matBadgeColor=\"accent\"\n      matBadgeSize=\"small\"\n      matBadgePosition=\"after\"\n      [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n      [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n      [svgIcon]=\"(layer.visible$ | async) ? 'eye' : 'eye-off'\">\n    </mat-icon>\n  </button>\n\n  <button *ngIf=\"selectionMode\" class=\"selection-eye\"\n  mat-icon-button\n  [color]=\"layer.visible ? 'primary' : 'default'\"\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"layer.visible ?\n                ('igo.geo.layer.hideLayer' | translate) :\n                ('igo.geo.layer.showLayer' | translate)\"\n  (click)=\"toggleVisibility()\">\n  <mat-icon\n    matBadge=\"?\"\n    matBadgeColor=\"accent\"\n    matBadgeSize=\"small\"\n    matBadgePosition=\"after\"\n    [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n    [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n    [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n  </mat-icon>\n</button>\n\n  <button *ngIf=\"!selectionMode\"\n    class=\"actions-button\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]= \"'igo.geo.layer.moreOptions' | translate\"\n    mat-icon-button\n    color=\"primary\"\n    (click)=\"toggleLayerTool()\">\n    <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\n  </button>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"showLegend$ | async\"\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n  </igo-layer-legend>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  Renderer2,\n  ElementRef,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { layerIsQueryable } from '../../query/shared/query.utils';\nimport { Layer, TooltipType } from '../shared/layers';\nimport { NetworkService, ConnectionState } from '@igo2/core';\n\n@Component({\n  selector: 'igo-layer-item',\n  templateUrl: './layer-item.component.html',\n  styleUrls: ['./layer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerItemComponent implements OnInit, OnDestroy {\n  public focusedCls = 'igo-layer-item-focused';\n\n  @Input()\n  get activeLayer() {\n    return this._activeLayer;\n  }\n  set activeLayer(value) {\n    if (value && this.layer && value.id === this.layer.id && !this.selectionMode) {\n      this.layerTool$.next(true);\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n  }\n  private _activeLayer;\n\n  layerTool$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  queryBadgeHidden$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  @Input()\n  get selectAll() {\n    return this._selectAll;\n  }\n  set selectAll(value: boolean) {\n    this._selectAll = value;\n    if (value === true) {\n      this.layerCheck = true;\n    }\n  }\n  private _selectAll = false;\n\n  @Input() layerCheck;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n  private layers$$: Subscription;\n\n  layers$: BehaviorSubject<Layer> = new BehaviorSubject<Layer>(undefined);\n\n  @Input()\n  get layer() {\n    return this._layer;\n  }\n  set layer(value) {\n    this._layer = value;\n    this.layers$.next(value);\n  }\n  private _layer;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendIfVisible: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() orderable: boolean = true;\n\n  @Input() lowerDisabled: boolean = false;\n\n  @Input() raiseDisabled: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Input() selectionMode;\n\n  @Input() changeDetection;\n\n  get opacity() {\n    return this.layer.opacity * 100;\n  }\n  set opacity(opacity: number) {\n    this.layer.opacity = opacity / 100;\n  }\n\n  get eyeTooltip() {\n    if (this.inResolutionRange$.getValue() === false) {\n      return 'igo.geo.layer.notInResolution';\n    } else {\n      return this.layer.visible ? 'igo.geo.layer.hideLayer' : 'igo.geo.layer.showLayer';\n    }\n  }\n\n  @Output() action: EventEmitter<Layer> = new EventEmitter<Layer>(undefined);\n  @Output() checkbox = new EventEmitter<{\n    layer: Layer;\n    check: boolean;\n  }>();\n\n  constructor(\n    private networkService: NetworkService,\n    private renderer: Renderer2,\n    private elRef: ElementRef,\n    private cdRef: ChangeDetectorRef) {}\n\n  ngOnInit() {\n    if (\n      this.layer.visible &&\n      this.expandLegendIfVisible &&\n      this.layer.firstLoadComponent === true\n    ) {\n      this.layer.firstLoadComponent = false;\n      this.layer.legendCollapsed = false;\n    }\n    this.toggleLegend(this.layer.legendCollapsed);\n    this.updateQueryBadge();\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.state = state;\n      this.onResolutionChange();\n    });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layer && this.layer.options.active) {\n        this.layerTool$.next(true);\n        this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n      }\n    });\n\n    if (this.changeDetection) {\n      this.changeDetection.subscribe(() => this.cdRef.detectChanges());\n    }\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    this.toggleLegend(this.showLegend$.value);\n  }\n\n  toggleVisibility() {\n    this.layer.visible = !this.layer.visible;\n    if (this.toggleLegendOnVisibilityChange) {\n      this.toggleLegend(!this.layer.visible);\n    }\n    this.updateQueryBadge();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    if (\n      inResolutionRange === false &&\n      this.updateLegendOnResolutionChange === true\n    ) {\n      this.toggleLegend(true);\n    }\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n\n  private updateQueryBadge() {\n    const hidden =\n      this.queryBadge === false ||\n      this.layer.visible === false ||\n      !layerIsQueryable(this.layer);\n    this.queryBadgeHidden$.next(hidden);\n  }\n\n  toggleLayerTool() {\n    this.layerTool$.next(!this.layerTool$.getValue());\n    if (this.layerTool$.getValue() === true) {\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n    this.action.emit(this.layer);\n  }\n\n  public check() {\n    this.layerCheck = !this.layerCheck;\n    this.checkbox.emit({layer: this.layer, check: this.layerCheck});\n  }\n}\n","export enum LayerListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\nexport enum LayerListSelectVisibleEnum {\n  ALL_VISIBLE = 'ALL_VISIBLE',\n  ALL_HIDDEN = 'ALL_HIDDEN',\n  MIXED = 'MIXED',\n  NULL = 'NULL'\n}\n\nexport enum LayerListDisplacement {\n  Raise = 'raise',\n  Lower = 'lower',\n}\n","<mat-list>\n  <igo-layer-list-tool *ngIf=\"showToolbar$ | async\"\n    floatLabel=\"auto\"\n    [layersAreAllVisible]=\"layersAreAllVisible\"\n    [term]=\"layerFilterAndSortOptions.keyword\"\n    [onlyVisible]=\"layerFilterAndSortOptions.onlyVisible\"\n    [sortAlpha]=\"layerFilterAndSortOptions.sortAlpha\"\n    (appliedFilterAndSort)=\"onAppliedFilterAndSortChange($event)\"\n    (selection)=\"toggleSelectionMode($event)\">\n  </igo-layer-list-tool>\n</mat-list>\n\n<mat-list-item *ngIf=\"selection\" class=\"select-all\">\n  <mat-checkbox\n    class=\"select-all-checkbox mat-subheading-2\"\n    [color]=\"!selectAllCheck && layersChecked.length > 0 ? 'accent' : 'primary'\"\n    (change)=\"selectAll()\"\n    [checked]=\"selectAllCheck\"\n    [indeterminate]=\"!selectAllCheck && layersChecked.length > 0\"> {{selectAllCheck ? ('igo.geo.layer.deselectAll' | translate) : ('igo.geo.layer.selectAll' | translate)}}\n  </mat-checkbox>\n</mat-list-item>\n<mat-divider></mat-divider>\n\n<igo-list #igoList [ngClass]=\"{'igo-list-tools-multi': selection, 'igo-list-tools-single': (layerTool && !selection), 'igo-list-no-tools': (!layerTool && !selection)}\" [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n    <igo-layer-item *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n      igoListItem\n      [layer]=\"layer\"\n      [activeLayer]=\"activeLayer\"\n      [orderable]=\"orderable && !layer.baseLayer\"\n      [lowerDisabled]=\"getLowerLayer().id === layer.id\"\n      [raiseDisabled]=\"getUpperLayer().id === layer.id\"\n      [queryBadge]=\"queryBadge\"\n      [expandLegendIfVisible]=\"expandLegendOfVisibleLayers\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [selectionMode]=\"selection\"\n      [selectAll]=\"selectAllCheck\"\n      [layerCheck]=\"layer.options.check\"\n      [changeDetection]=\"layerItemChangeDetection$\"\n      (action)=\"toggleLayerTool($event)\"\n      (checkbox)=\"layersCheck($event)\">\n    </igo-layer-item>\n  </ng-template>\n</igo-list>\n\n<igo-panel *ngIf=\"!selection && layerTool && activeLayer\" class=\"igo-layer-actions-container\" [title]=\"activeLayer.title\">\n  <div class=\"igo-layer-button-group\">\n    <button\n      *ngIf=\"isLayerRemovable(activeLayer)\"\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.removeLayer' | translate\"\n      (click)=\"removeLayers()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterLowerLayer' | translate) : ('igo.geo.layer.lowerLayer' | translate)\"\n      [disabled]=\"lowerDisabled\"\n      (click)=\"moveActiveLayer(activeLayer,layerListDisplacement.Lower)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"lowerDisabled\"\n                svgIcon=\"arrow-down\"></mat-icon>\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterRaiseLayer' | translate) : ('igo.geo.layer.raiseLayer' | translate)\"\n      [disabled]=\"raiseDisabled\"\n      (click)=\"moveActiveLayer(activeLayer,layerListDisplacement.Raise)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"raiseDisabled\"\n                svgIcon=\"arrow-up\"></mat-icon>\n    </button>\n\n    <!-- <label>{{ 'igo.geo.layer.opacity' | translate }} </label> -->\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\">\n      <mat-icon [matBadge]=\"badgeOpacity\" matBadgeColor=\"primary\" matBadgeSize=\"medium\" svgIcon=\"opacity\"></mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\" class=\"mat-menu-opacity-slider\">\n      <div id=\"opacity-menu\">\n        <mat-slider\n          id=\"opacity-slider\"\n          color=\"primary\"\n          thumbLabel\n          tickInterval=\"5\"\n          step=\"5\"\n          [min]=\"0\"\n          [max]=\"100\"\n          [value]=\"opacity\"\n          (input)=\"changeOpacity($event)\"\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n          (click) = \"$event.stopPropagation()\"\n          matTooltipShowDelay=\"500\"\n          tooltip-position=\"below\">\n        </mat-slider>\n      </div>\n    </mat-menu>\n\n    <button\n      *ngIf=\"activeLayerIsValid(activeLayer)\"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayer' | translate\"\n      (click)=\"zoomLayerExtents(activeLayer)\">\n      <mat-icon matBadgeColor=\"primary\" matBadgeSize=\"medium\" svgIcon=\"magnify-scan\"></mat-icon>\n    </button>\n\n    <ng-container igoLayerItemToolbar\n      [ngTemplateOutlet]=\"templateLayerToolbar\"\n      [ngTemplateOutletContext]=\"{layer: activeLayer}\">\n    </ng-container>\n\n    <ng-content select=\"[igoLayerItemToolbar]\"></ng-content>\n  </div>\n</igo-panel>\n\n<igo-panel *ngIf=\"selection && layers.length > 0\" class=\"igo-layer-actions-container\" [title]=\"'igo.geo.layer.tools' | translate\">\n  <div class=\"actions-buttons-multi\">\n    <button\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"isAllLayersRemovable(layersChecked) ? ('igo.geo.layer.removeSelectedLayers' | translate) : 'igo.geo.layer.removeSelectedLayersRestriction' | translate\"\n      (click)=\"removeLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"'!'\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"isAllLayersRemovable(layersChecked)\"\n                svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"eye-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"statusSelectedLayersCheck === 'ALL_HIDDEN' ? ('igo.geo.layer.showSelectedLayers' | translate) : ('igo.geo.layer.hideSelectedLayers' | translate)\"\n      (click)=\"toggleVisibility(layersChecked)\">\n      <mat-icon\t[svgIcon]=\"(statusSelectedLayersCheck === 'ALL_HIDDEN') ? 'eye-off' : 'eye'\"></mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterLowerLayer' | translate) : ('igo.geo.layer.lowerLayer' | translate)\"\n      [disabled]=\"lowerDisabledSelection\"\n      (click)=\"lowerLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"lowerDisabledSelection\"\n                svgIcon=\"arrow-down\"></mat-icon>\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterRaiseLayer' | translate) : ('igo.geo.layer.raiseLayer' | translate)\"\n      [disabled]=\"raiseDisabledSelection\"\n      (click)=\"raiseLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"raiseDisabledSelection\"\n                svgIcon=\"arrow-up\"></mat-icon>\n    </button>\n\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\">\n      <mat-icon svgIcon=\"opacity\"></mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\"  class=\"mat-menu-opacity-slider\">\n      <div id=\"opacity-menu\">\n        <mat-slider *ngIf=\"layersChecked.length\"\n          id=\"opacity-slider\"\n          color=\"primary\"\n          thumbLabel\n          tickInterval=\"5\"\n          step=\"5\"\n          [min]=\"0\"\n          [max]=\"100\"\n          [(ngModel)]=\"checkOpacity\"\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n          matTooltipShowDelay=\"500\"\n          tooltip-position=\"below\"\n          (click) = \"$event.stopPropagation()\">\n        </mat-slider>\n      </div>\n    </mat-menu>\n\n    <button\n      *ngIf=\"layersChecked.length !== 0 && activeLayersAreValid(layersChecked)\"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayers' | translate\"\n      (click)=\"zoomLayersExtents(layersChecked)\">\n      <mat-icon svgIcon=\"magnify-scan\"></mat-icon>\n    </button>\n  </div>\n</igo-panel>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ContentChild,\n  OnInit,\n  OnDestroy,\n  Output,\n  EventEmitter,\n  ElementRef\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { LayerListControlsEnum, LayerListDisplacement } from './layer-list.enum';\nimport { LayerListSelectVisibleEnum } from './layer-list.enum';\nimport {\n  BehaviorSubject,\n  ReplaySubject,\n  Subscription,\n  EMPTY,\n  timer\n} from 'rxjs';\nimport { debounce } from 'rxjs/operators';\nimport {\n  MetadataOptions,\n  MetadataLayerOptions\n} from '../../metadata/shared/metadata.interface';\nimport { LayerListControlsOptions } from '../layer-list-tool/layer-list-tool.interface';\nimport { IgoMap } from '../../map/shared/map';\nimport { Layer } from '../shared/layers/layer';\nimport { LinkedProperties, LayersLink } from '../shared/layers/layer.interface';\nimport { MatSliderChange } from '@angular/material/slider';\nimport * as olextent from 'ol/extent';\n\n// TODO: This class could use a clean up. Also, some methods could be moved ealsewhere\n@Component({\n  selector: 'igo-layer-list',\n  templateUrl: './layer-list.component.html',\n  styleUrls: ['./layer-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerListComponent implements OnInit, OnDestroy {\n  orderable = true;\n  thresholdToFilterAndSort = 5;\n\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n\n  change$ = new ReplaySubject<void>(1);\n\n  showToolbar$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public layerTool: boolean;\n\n  public hideSelectedLayers: boolean = true;\n  activeLayer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\n\n  layersChecked: Layer[] = [];\n  public selection: boolean;\n\n  private change$$: Subscription;\n  private layers$$: Subscription;\n  public layerItemChangeDetection$ = new BehaviorSubject(undefined);\n\n  @ContentChild('igoLayerItemToolbar', /* TODO: add static flag */ {})\n  templateLayerToolbar: TemplateRef<any>;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = this.removeProblemLayerInList(value);\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n\n  set activeLayer(value: Layer) {\n    this._activeLayer = value;\n    this.activeLayer$.next(value);\n  }\n  get activeLayer(): Layer {\n    return this._activeLayer;\n  }\n  private _activeLayer: Layer;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input() layerFilterAndSortOptions: LayerListControlsOptions = {};\n\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n\n  get keyword(): string {\n    return this._keyword;\n  }\n  set keyword(value: string) {\n    this._keyword = value;\n    this.next();\n  }\n  private _keyword = undefined;\n\n  get onlyVisible(): boolean {\n    return this._onlyVisible;\n  }\n  set onlyVisible(value: boolean) {\n    this._onlyVisible = value;\n    this.next();\n  }\n  private _onlyVisible = false;\n\n  get sortAlpha(): boolean {\n    return this._sortedAlpha;\n  }\n  set sortAlpha(value: boolean) {\n    this._sortedAlpha = value;\n    this.next();\n  }\n  private _sortedAlpha = false;\n\n  get opacity() {\n    return Math.round(this.activeLayer$.getValue().opacity * 100);\n  }\n  set opacity(opacity: number) {\n    this.activeLayer$.getValue().opacity = opacity / 100;\n  }\n\n  get badgeOpacity() {\n    if (this.opacity === 100) {\n      return;\n    }\n    return this.opacity;\n  }\n\n  get raiseDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getUpperLayer().id === this.activeLayer.id ||\n      this.isUpperBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getLowerLayer().id === this.activeLayer.id ||\n      this.isLowerBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get raiseDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.raisableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.lowerableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get checkOpacity() {\n    return this.layersCheckedOpacity() * 100;\n  }\n  set checkOpacity(opacity: number) {\n    for (const layer of this.layersChecked) {\n      layer.opacity = opacity / 100;\n    }\n  }\n\n  get layerListDisplacement(): typeof LayerListDisplacement {\n    return LayerListDisplacement;\n  }\n\n  public toggleOpacity = false;\n\n  public selectAllCheck: boolean;\n  public selectAllCheck$ = new BehaviorSubject<boolean>(undefined);\n  private selectAllCheck$$: Subscription;\n\n  constructor(private elRef: ElementRef) { }\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.layers.length === 0 ? EMPTY : timer(50);\n        })\n      )\n      .subscribe(() => {\n        this.showToolbar$.next(this.computeShowToolbar());\n        this.layers$.next(this.computeLayers(this.layers.slice(0)));\n        this.appliedFilterAndSort.emit({\n          keyword: this.keyword,\n          sortAlpha: this.sortAlpha,\n          onlyVisible: this.onlyVisible\n        });\n      });\n\n    this.selectAllCheck$$ = this.selectAllCheck$.subscribe((value) => {\n      this.selectAllCheck = value;\n    });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layers) {\n        let checks = 0;\n        for (const layer of this.layers) {\n          layer.status$.subscribe(valStatus => {\n            if (valStatus === 0) {\n              this.map.removeLayer(layer);\n            }\n          });\n          if (layer.options.active) {\n            this.activeLayer = layer;\n            this.layerTool = true;\n          }\n          if (layer.options.check) {\n            checks += 1;\n          }\n        }\n        if (this.excludeBaseLayers) {\n          this.selectAllCheck =\n            checks ===\n              this.layers.filter(\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\n              ).length\n              ? true\n              : false;\n        } else {\n          this.selectAllCheck =\n            checks === this.layers.filter((lay) => lay.showInLayerList).length\n              ? true\n              : false;\n        }\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n    this.selectAllCheck$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  activeLayerIsValid(layer: Layer): boolean {\n    let valid = false;\n    const layerExtent = layer.options.extent;\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    if (layerExtent) {\n      if (maxLayerZoomExtent) {\n        valid = olextent.containsExtent(maxLayerZoomExtent, layerExtent);\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  activeLayersAreValid(layers: Layer[]): boolean {\n    let valid = false;\n    const layersExtent = olextent.createEmpty();\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent && !layerExtent.includes(Infinity)) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n\n    if (!olextent.isEmpty(layersExtent)) {\n      if (maxLayerZoomExtent) {\n        valid = (olextent.containsExtent(maxLayerZoomExtent, layersExtent));\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  zoomLayerExtents(layer: Layer) {\n    this.map.viewController.zoomToExtent(layer.options.extent);\n  }\n\n  zoomLayersExtents(layers: Layer[]) {\n    const layersExtent = olextent.createEmpty() as [number, number, number, number];\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n    this.map.viewController.zoomToExtent(layersExtent);\n  }\n\n  changeOpacity(event: MatSliderChange){\n    this.opacity = event.value;\n  }\n\n  clearKeyword() {\n    this.keyword = undefined;\n  }\n\n  getLowerLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex < current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isLowerBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index + 1] &&\n      this.layers[index + 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  getUpperLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex > current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isUpperBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index - 1] &&\n      this.layers[index - 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  moveActiveLayer(activeLayer: Layer, actiontype: LayerListDisplacement) {\n    const layersToMove = [activeLayer];\n    const sortedLayersToMove = [];\n    this.getLinkedLayers(activeLayer, layersToMove);\n    this.layers.map(layer => {\n      if (layersToMove.indexOf(layer) !== -1) {\n        sortedLayersToMove.push(layer);\n      }\n    });\n\n    if (actiontype === LayerListDisplacement.Raise) {\n      this.raiseLayers(sortedLayersToMove, false);\n    } else if (actiontype === LayerListDisplacement.Lower) {\n      this.lowerLayers(sortedLayersToMove, false);\n    }\n  }\n\n  private getLinkedLayers(activeLayer: Layer, layersList: Layer[]) {\n    const linkedLayers = activeLayer.options.linkedLayers as LayersLink;\n    if (!linkedLayers) {\n      return;\n    }\n    const currentLinkedId = linkedLayers.linkId;\n    const currentLinks = linkedLayers.links;\n    const isParentLayer = currentLinks ? true : false;\n\n    if (isParentLayer) {\n      // search for child layers\n      currentLinks.map(link => {\n        if (!link.properties || link.properties.indexOf(LinkedProperties.ZINDEX) === -1) {\n          return;\n        }\n        link.linkedIds.map(linkedId => {\n          const childLayer = this.layers.find(layer => layer.options.linkedLayers?.linkId === linkedId);\n          if (childLayer) {\n            if (!layersList.includes(childLayer)) {\n              layersList.push(childLayer);\n            }\n          }\n        });\n      });\n    } else {\n      // search for parent layer\n      this.layers.map(parentLayer => {\n        if (parentLayer.options.linkedLayers?.links) {\n          parentLayer.options.linkedLayers.links.map(l => {\n            if (\n              l.properties?.indexOf(LinkedProperties.ZINDEX) !== -1 &&\n              l.bidirectionnal !== false &&\n              l.linkedIds.indexOf(currentLinkedId) !== -1) {\n              layersList.push(parentLayer);\n              this.getLinkedLayers(parentLayer, layersList);\n            }\n          });\n        }\n      });\n    }\n  }\n\n  /*\n   * For selection mode disabled attribute\n   */\n  raisableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const previousLayer = this.layers[mapIndex - 1];\n      if (\n        previousLayer &&\n        previousLayer.baseLayer !== true &&\n        !layers.find((lay) => previousLayer.id === lay.id) &&\n        currentLayer.baseLayer !== true\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  raisableLayer(index: number) {\n    if (index < 1) {\n      return false;\n    }\n\n    if (this.layers[index - 1].options.check) {\n      return this.raisableLayer(index - 1);\n    }\n    return true;\n  }\n\n  raiseLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToRaise = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.raisableLayer(index)) {\n        layersToRaise.push(layer);\n      }\n    }\n    this.map.raiseLayers(layersToRaise);\n    if (fromUi) {\n      setTimeout(() => {\n        const elements = this.computeElementRef();\n        if (!this.isScrolledIntoView(elements[0], elements[1].offsetParent)) {\n          elements[0].scrollTop = elements[1].offsetParent.offsetTop;\n        }\n      }, 100);\n    }\n  }\n  /*\n   * For selection mode disabled attribute\n   */\n  lowerableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const nextLayer = this.layers[mapIndex + 1];\n      if (\n        nextLayer &&\n        nextLayer.baseLayer !== true &&\n        !layers.find((lay) => nextLayer.id === lay.id)\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  lowerableLayer(index: number) {\n    if (\n      index >\n      this.layers.filter((lay) => lay.baseLayer !== true).length - 2\n    ) {\n      return false;\n    }\n\n    if (this.layers[index + 1].options.check) {\n      return this.lowerableLayer(index + 1);\n    }\n    return true;\n  }\n\n  lowerLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToLower = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.lowerableLayer(index)) {\n        layersToLower.push(layer);\n      }\n    }\n    this.map.lowerLayers(layersToLower);\n    if (fromUi) {\n      setTimeout(() => {\n        const elements = this.computeElementRef('lower');\n        if (!this.isScrolledIntoView(elements[0], elements[1].offsetParent)) {\n          elements[0].scrollTop =\n            elements[1].offsetParent.offsetTop +\n            elements[1].offsetParent.offsetHeight -\n            elements[0].clientHeight;\n        }\n      }, 100);\n    }\n  }\n  private next() {\n    this.change$.next();\n  }\n\n  private computeLayers(layers: Layer[]): Layer[] {\n    let layersOut = this.filterLayers(layers);\n    if (this.sortAlpha) {\n      layersOut = this.sortLayersByTitle(layersOut);\n    } else {\n      layersOut = this.sortLayersByZindex(layersOut);\n    }\n    return layersOut;\n  }\n\n  onKeywordChange(term) {\n    this.keyword = term;\n  }\n\n  onAppliedFilterAndSortChange(appliedFilter: LayerListControlsOptions) {\n    this.keyword = appliedFilter.keyword;\n    this.onlyVisible = appliedFilter.onlyVisible;\n    this.sortAlpha = appliedFilter.sortAlpha;\n  }\n\n  private filterLayers(layers: Layer[]): Layer[] {\n    if (\n      this.layerFilterAndSortOptions.showToolbar === LayerListControlsEnum.never\n    ) {\n      return layers;\n    }\n    if (!this.keyword && !this.onlyVisible) {\n      return layers;\n    }\n\n    const keepLayerIds = layers.map((layer: Layer) => layer.id);\n\n    layers.forEach((layer: Layer) => {\n      const layerOptions = (layer.options as MetadataLayerOptions) || {};\n      const dataSourceOptions = layer.dataSource.options || {};\n      const metadata = layerOptions.metadata || ({} as MetadataOptions);\n      const keywords = metadata.keywordList || [];\n      const layerKeywords = keywords.map((kw: string) => {\n        return kw.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      });\n\n      if (this.keyword && layer.title) {\n        const localKeyword = this.keyword\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const layerTitle = layer.title\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const dataSourceType = dataSourceOptions.type || '';\n        const keywordRegex = new RegExp(localKeyword, 'gi');\n        const keywordInList =\n          layerKeywords.find((kw: string) => keywordRegex.test(kw)) !==\n          undefined;\n        if (\n          !keywordRegex.test(layerTitle) &&\n          !(this.keyword.toLowerCase() === dataSourceType.toLowerCase()) &&\n          !keywordInList\n        ) {\n          const index = keepLayerIds.indexOf(layer.id);\n          if (index > -1) {\n            keepLayerIds.splice(index, 1);\n          }\n        }\n      }\n\n      if (this.onlyVisible && layer.visible === false) {\n        const index = keepLayerIds.indexOf(layer.id);\n        if (index > -1) {\n          keepLayerIds.splice(index, 1);\n        }\n      }\n    });\n\n    return layers.filter(\n      (layer: Layer) => keepLayerIds.indexOf(layer.id) !== -1\n    );\n  }\n\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  private sortLayersByTitle(layers: Layer[]) {\n    return layers.sort((a, b) => {\n      if (this.normalize(a.title) < this.normalize(b.title)) {\n        return -1;\n      }\n      if (this.normalize(a.title) > this.normalize(b.title)) {\n        return 1;\n      }\n      return 0;\n    });\n  }\n\n  private normalize(str: string) {\n    return str\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .toLowerCase();\n  }\n\n  private computeShowToolbar(): boolean {\n    switch (this.layerFilterAndSortOptions.showToolbar) {\n      case LayerListControlsEnum.always:\n        return true;\n      case LayerListControlsEnum.never:\n        return false;\n      default:\n        if (\n          this.layers.length >= this.thresholdToFilterAndSort ||\n          this.keyword ||\n          this.onlyVisible\n        ) {\n          return true;\n        }\n        return false;\n    }\n  }\n\n  toggleLayerTool(layer) {\n    this.toggleOpacity = false;\n    if (this.layerTool && layer === this.activeLayer) {\n      this.layerTool = false;\n    } else {\n      this.layerTool = true;\n    }\n\n    for (const lay of this.layers) {\n      lay.options.active = false;\n    }\n    layer.options.active = true;\n    this.activeLayer = layer;\n  }\n\n  removeLayers(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      this.layersChecked = [];\n      for (const layer of layers) {\n        if (layer.options.removable !== false) {\n          layer.map.removeLayer(layer);\n        } else {\n          this.layersChecked.push(layer);\n        }\n      }\n    } else if (!layers && this.activeLayer.options.removable !== false) {\n      this.activeLayer.map.removeLayer(this.activeLayer);\n      this.layerTool = false;\n    }\n  }\n\n  toggleVisibility(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      for (const layer of layers) {\n        layer.visible = this.hideSelectedLayers;\n      }\n    }\n    this.layerItemChangeDetection$.next(true);\n  }\n\n  isLayerRemovable(layer: Layer): boolean {\n    return layer.options.removable !== false;\n  }\n\n  isAllLayersRemovable(layers: Layer[]): boolean {\n    return layers.every(l => this.isLayerRemovable(l));\n  }\n\n  get statusSelectedLayersCheck(): LayerListSelectVisibleEnum {\n    let statusSelectedLayers: LayerListSelectVisibleEnum =\n      LayerListSelectVisibleEnum.NULL;\n    let findTrue: boolean = false;\n    let findFalse: boolean = false;\n\n    if (this.layersChecked.length === 0) {\n      statusSelectedLayers = LayerListSelectVisibleEnum.NULL;\n    } else {\n      statusSelectedLayers = LayerListSelectVisibleEnum.MIXED;\n      this.hideSelectedLayers = false;\n\n      for (const layer2 of this.layersChecked) {\n        if (layer2.visible === true) {\n          findTrue = true;\n        }\n        if (layer2.visible === false) {\n          findFalse = true;\n        }\n      }\n\n      if (findTrue === true && findFalse === false) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_VISIBLE;\n      }\n      if (findTrue === false && findFalse === true) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_HIDDEN;\n        this.hideSelectedLayers = true;\n      }\n    }\n\n    return statusSelectedLayers;\n  }\n\n  layersCheck(event: { layer: Layer; check: boolean }) {\n    event.layer.options.check = event.check;\n    if (event.check === true) {\n      const eventMapIndex = this.layers.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      for (const layer of this.layersChecked) {\n        const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n        if (eventMapIndex < mapIndex) {\n          this.layersChecked.splice(\n            this.layersChecked.findIndex((lay) => layer.id === lay.id),\n            0,\n            event.layer\n          );\n\n          if (this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter(\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\n              ).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          } else if (!this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter((lay) => lay.showInLayerList).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          }\n          return;\n        }\n      }\n      this.layersChecked.push(event.layer);\n    } else {\n      const index = this.layersChecked.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      this.layersChecked.splice(index, 1);\n    }\n\n    if (this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter(\n          (lay) => lay.baseLayer !== true && lay.showInLayerList\n        ).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    } else if (!this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter((lay) => lay.showInLayerList).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    }\n  }\n\n  toggleSelectionMode(value: boolean) {\n    this.selection = value;\n    this.activeLayer = undefined;\n    if (value === true) {\n      this.layerTool = false;\n      for (const layer of this.layers) {\n        if (layer.options.check) {\n          this.layersChecked.push(layer);\n        }\n      }\n    }\n  }\n\n  layersCheckedOpacity(): any {\n    if (this.layersChecked.length > 1) {\n      return 1;\n    } else {\n      const opacity = [];\n      for (const layer of this.layersChecked) {\n        opacity.push(layer.opacity);\n      }\n      return opacity;\n    }\n  }\n\n  selectAll() {\n    if (!this.selectAllCheck) {\n      for (const layer of this.layers) {\n        if (\n          this.excludeBaseLayers &&\n          layer.baseLayer !== true &&\n          layer.showInLayerList\n        ) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        } else if (!this.excludeBaseLayers && layer.showInLayerList) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        }\n      }\n      this.selectAllCheck$.next(true);\n    } else {\n      for (const layer of this.layers) {\n        layer.options.check = false;\n      }\n      this.layersChecked = [];\n      this.selectAllCheck$.next(false);\n    }\n  }\n\n  isScrolledIntoView(elemSource, elem) {\n    const docViewTop = elemSource.scrollTop;\n    const docViewBottom = docViewTop + elemSource.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.clientHeight;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  computeElementRef(type?: string) {\n    const checkItems = this.elRef.nativeElement.getElementsByClassName(\n      'mat-checkbox-checked'\n    );\n    const checkItem =\n      type === 'lower'\n        ? this.elRef.nativeElement.getElementsByClassName(\n          'mat-checkbox-checked'\n        )[checkItems.length - 1]\n        : this.elRef.nativeElement.getElementsByClassName(\n          'mat-checkbox-checked'\n        )[0];\n    const igoList = this.elRef.nativeElement.getElementsByTagName(\n      'igo-list'\n    )[0];\n\n    return [igoList, checkItem];\n  }\n\n  removeProblemLayerInList(layersList: Layer[]): Layer[] {\n    for (const layer of layersList) {\n      if (layer.olLoadingProblem === true) {\n        this.map.removeLayer(layer);\n      }\n    }\n    return layersList;\n  }\n}\n","  <mat-list-item>\n      <mat-form-field class=\"inputFilter\" [floatLabel]=\"floatLabel\">\n        <input\n          matInput\n          [placeholder]=\"'igo.geo.layer.filterPlaceholder' | translate\"\n          [matTooltip]=\"'igo.geo.layer.subsetLayersListKeyword' | translate\"\n          matTooltipShowDelay=\"500\"\n          type=\"text\" [(ngModel)]=\"term\">\n        <button\n          mat-button\n          *ngIf=\"term\"\n          matSuffix\n          mat-icon-button\n          aria-label=\"Clear\"\n          color=\"warn\"\n          (click)=\"clearTerm()\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n        </button>\n      </mat-form-field>\n\n      <div [matTooltip]=\"sortAlpha ?\n      ('igo.geo.layer.sortMapOrder' | translate) :\n      ('igo.geo.layer.sortAlphabetically' | translate)\" matTooltipShowDelay=\"500\">\n        <button class=\"sort-alpha\" [color]=\"sortAlpha ? 'warn' : 'primary'\" mat-icon-button (click)=\"toggleSortAlpha()\">\n          <mat-icon [svgIcon]=\"sortAlpha ? 'sort-ascending' : 'sort-alphabetical-ascending'\"></mat-icon>\n        </button>\n      </div>\n\n       <div [matTooltip]=\"onlyVisible ?\n        ('igo.geo.layer.resetLayersList' | translate) :\n        ('igo.geo.layer.subsetLayersListOnlyVisible' | translate)\" matTooltipShowDelay=\"500\">\n         <button class=\"only-visible\" mat-icon-button [disabled]=\"layersAreAllVisible && !onlyVisible\"\n           [color]=\"onlyVisible ? 'warn' : 'primary'\" (click)=\"toggleOnlyVisible()\">\n           <mat-icon\n             matBadge=\"icon\"\n             igoMatBadgeIcon=\"eye\"\n             igoMatBadgeInverseColor=\"true\"\n             igoMatBadgeInheritColor=\"true\"\n             [svgIcon]=\"onlyVisible ? 'filter-remove' : 'filter'\">\n           </mat-icon>\n         </button>\n       </div>\n\n       <div [matTooltip]=\"selectionMode ?\n        ('igo.geo.layer.deactivateSelectionMode' | translate) :\n        ('igo.geo.layer.activateSelectionMode' | translate)\" matTooltipShowDelay=\"500\">\n         <button class=\"selection-mode\" mat-icon-button\n           color=\"primary\" (click)=\"toggleSelectionMode()\">\n           <mat-icon [svgIcon]=\"selectionMode ? 'checkbox-multiple-marked-outline' : 'checkbox-multiple-blank-outline'\"></mat-icon>\n         </button>\n       </div>\n\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit,\n  EventEmitter,\n  Output,\n  OnDestroy\n} from '@angular/core';\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LayerListControlsOptions } from './layer-list-tool.interface';\n\n@Component({\n  selector: 'igo-layer-list-tool',\n  templateUrl: './layer-list-tool.component.html',\n  styleUrls: ['./layer-list-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerListToolComponent implements OnInit, OnDestroy {\n  public onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public term$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n  onlyVisible$$: Subscription;\n  sortAlpha$$: Subscription;\n  term$$: Subscription;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input()\n  set onlyVisible(value: boolean) {\n    this.onlyVisible$.next(value);\n  }\n  get onlyVisible(): boolean {\n    return this.onlyVisible$.value;\n  }\n\n  @Input()\n  set sortAlpha(value: boolean) {\n    this.sortAlpha$.next(value);\n  }\n  get sortAlpha(): boolean {\n    return this.sortAlpha$.value;\n  }\n\n  @Input()\n  set term(value: string) {\n    this.term$.next(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n\n  public selectionMode = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n  @Output() selection = new EventEmitter<boolean>();\n\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe(keyword => {\n      this.appliedFilterAndSort.emit({\n        keyword,\n        onlyVisible: this.onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n\n    this.onlyVisible$$ = this.onlyVisible$.subscribe(onlyVisible => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n    this.sortAlpha$$ = this.sortAlpha$.subscribe(sortAlpha => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible: this.onlyVisible,\n        sortAlpha\n      });\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.onlyVisible$$.unsubscribe();\n    this.sortAlpha$$.unsubscribe();\n    this.term$$.unsubscribe();\n  }\n\n  clearTerm() {\n    this.term = undefined;\n  }\n  toggleSortAlpha() {\n    this.sortAlpha = !this.sortAlpha;\n  }\n\n  toggleOnlyVisible() {\n    this.onlyVisible = !this.onlyVisible;\n  }\n\n  toggleSelectionMode() {\n    this.selectionMode = !this.selectionMode;\n    this.selection.emit(this.selectionMode);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy, Optional } from '@angular/core';\nimport { Subscription, combineLatest } from 'rxjs';\n\nimport { RouteService } from '@igo2/core';\nimport { MapService } from '../../map/shared/map.service';\nimport { LayerListComponent } from './layer-list.component';\nimport { Layer } from '../shared/layers/layer';\nimport { map, debounceTime } from 'rxjs/operators';\n\n@Directive({\n  selector: '[igoLayerListBinding]'\n})\nexport class LayerListBindingDirective implements OnInit, OnDestroy {\n  private component: LayerListComponent;\n  private layersOrResolutionChange$$: Subscription;\n  layersVisibility$$: Subscription;\n\n  constructor(\n    @Self() component: LayerListComponent,\n    private mapService: MapService,\n    @Optional() private route: RouteService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    // this.component.layers = [];\n    this.layersOrResolutionChange$$ = combineLatest([\n      this.mapService.getMap().layers$,\n      this.mapService.getMap().viewController.resolution$]\n    ).pipe(\n      debounceTime(10)\n    ).subscribe((bunch: [Layer[], number]) => {\n      const shownLayers = bunch[0].filter((layer: Layer) => {\n        return layer.showInLayerList === true;\n      });\n      this.component.layers = shownLayers;\n      this.setLayersVisibilityStatus(shownLayers, this.component.excludeBaseLayers);\n    });\n  }\n\n  private setLayersVisibilityStatus(layers: Layer[], excludeBaseLayers: boolean) {\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n    this.layersVisibility$$ = combineLatest(layers\n      .filter(layer => layer.baseLayer !== excludeBaseLayers )\n      .map((layer: Layer) => layer.visible$))\n      .pipe(map((visibles: boolean[]) => visibles.every(Boolean)))\n      .subscribe((allLayersAreVisible: boolean) =>\n        this.component.layersAreAllVisible = allLayersAreVisible);\n  }\n\n  ngOnDestroy() {\n    this.layersOrResolutionChange$$.unsubscribe();\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n  }\n\n}\n","\n<div class=\"layer-legend-list-container\">\n  <mat-slide-toggle \n  tooltip-position=\"above\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.layer.legend.showAll' | translate\"\n  [checked]=\"showAllLegendsValue\" class=\"mat-typography\" \n  *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\" [labelPosition]=\"'before'\" (change)=\"toggleShowAllLegends($event.checked)\">\n    {{'igo.geo.layer.legend.showAll' | translate}}\n  </mat-slide-toggle>\n  <mat-divider *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"></mat-divider>\n  <igo-list [navigation]=\"false\" [selection]=\"false\">\n    <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n      <igo-layer-legend-item *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n          igoListItem [layer]=\"layer\"\n          [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n      </igo-layer-legend-item>\n    </ng-template>\n  </igo-list>\n  <p class=\"layers-empty mat-typography\" \n    *ngIf=\"!showAllLegendsValue && (layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async)===false && allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleWithShowAllButton' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\" \n    *ngIf=\"!showAllLegendsValue && (layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async) && allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\"\n    *ngIf=\"(layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async)===false && !allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisible' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\"\n    *ngIf=\"(layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async) && !allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleButZoom' | translate}} \n  </p>\n\n</div>","import { Component, Input, ChangeDetectionStrategy, OnInit, OnDestroy, EventEmitter, Output } from '@angular/core';\nimport { Layer } from '../shared';\nimport { BehaviorSubject, ReplaySubject, Subscription, EMPTY, timer } from 'rxjs';\nimport { debounce } from 'rxjs/operators';\n\n@Component({\n  selector: 'igo-layer-legend-list',\n  templateUrl: './layer-legend-list.component.html',\n  styleUrls: ['./layer-legend-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendListComponent implements OnInit, OnDestroy {\n  orderable = true;\n\n  hasVisibleOrInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  hasVisibleAndNotInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  layersInUi$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  showAllLegend: boolean = false;\n  public change$ = new ReplaySubject<void>(1);\n  private change$$: Subscription;\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() allowShowAllLegends: boolean = false;\n\n  @Input() showAllLegendsValue: boolean = false;\n\n  @Output() allLegendsShown = new EventEmitter<boolean>(false);\n\n  constructor() { }\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(debounce(() => {\n        return this.layers.length === 0 ? EMPTY : timer(50);\n      }))\n      .subscribe(() => {\n        const layers = this.computeShownLayers(this.layers.slice(0));\n        this.layers$.next(layers);\n        this.hasVisibleOrInRangeLayers$.next(\n          this.layers.slice(0)\n            .filter(layer => layer.baseLayer !== true)\n            .filter(layer => layer.visible$.value && layer.isInResolutionsRange$.value).length > 0\n        );\n        this.hasVisibleAndNotInRangeLayers$.next(\n          this.layers.slice(0)\n            .filter(layer => layer.baseLayer !== true)\n            .filter(layer => layer.visible$.value && !layer.isInResolutionsRange$.value).length > 0\n        );\n\n        this.layersInUi$.next(\n          this.layers.slice(0).filter(layer => layer.showInLayerList !== false && (!this.excludeBaseLayers || !layer.baseLayer))\n        );\n      });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n  }\n  private next() {\n    this.change$.next();\n  }\n  private computeShownLayers(layers: Layer[]) {\n    let shownLayers = layers.filter((layer: Layer) => layer.visible && layer.isInResolutionsRange);\n    if (this.showAllLegendsValue) {\n      shownLayers = layers;\n    }\n    return this.sortLayersByZindex(shownLayers);\n  }\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  toggleShowAllLegends(toggle: boolean) {\n      this.showAllLegendsValue = toggle;\n      this.next();\n      this.allLegendsShown.emit(toggle);\n  }\n}\n","<button *ngIf=\"options.trackFeature\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.layer.trackFeature' | translate\"\n  [color]=\"color\"\n  (click)=\"toggleTrackFeature()\">\n  <mat-icon svgIcon=\"crosshairs-gps\"></mat-icon>\n</button>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { VectorLayer } from '../shared/layers';\nimport { VectorLayerOptions } from '../shared/layers/vector-layer.interface';\n\n@Component({\n  selector: 'igo-track-feature-button',\n  templateUrl: './track-feature-button.component.html',\n  styleUrls: ['./track-feature-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TrackFeatureButtonComponent implements OnInit {\n\n  @Input() layer: VectorLayer;\n\n  @Input() trackFeature = false;\n\n  get options(): VectorLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n\n  public color: string = 'primary';\n\n  constructor() {}\n\n  ngOnInit() {\n    this.color = this.trackFeature ? 'primary' : 'basic';\n  }\n\n  toggleTrackFeature() {\n    if (this.trackFeature) {\n      this.layer.disableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'basic';\n    } else {\n      this.layer.enableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'primary';\n    }\n    this.trackFeature = !this.trackFeature;\n  }\n}\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { Layer, TooltipType } from '../shared/layers';\nimport { NetworkService, ConnectionState } from '@igo2/core';\n\n@Component({\n  selector: 'igo-layer-legend-item',\n  templateUrl: './layer-legend-item.component.html',\n  styleUrls: ['./layer-legend-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendItemComponent implements OnInit, OnDestroy {\n\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n\n  @Input() layer: Layer;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  constructor(private networkService: NetworkService) {}\n\n  ngOnInit() {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.state = state;\n      this.onResolutionChange();\n    });\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n}\n","<mat-list-item class= \"igo-layer-list-item\">\n  <h4 matLine class=\"igo-layer-title\" [matTooltip]=\"tooltipText\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n  </igo-layer-legend>\n</div>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatSliderModule } from '@angular/material/slider';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoListModule,\n  IgoCollapsibleModule,\n  IgoImageModule,\n  IgoPanelModule,\n  IgoMatBadgeIconModule,\n  IgoCustomHtmlModule\n} from '@igo2/common';\n\nimport { LayerService } from './shared/layer.service';\nimport { StyleService } from './shared/style.service';\nimport { LayerListToolService } from './layer-list-tool/layer-list-tool.service';\nimport { LayerItemComponent } from './layer-item/layer-item.component';\nimport { LayerLegendComponent } from './layer-legend/layer-legend.component';\nimport { LayerListComponent } from './layer-list/layer-list.component';\nimport { LayerListToolComponent } from './layer-list-tool/layer-list-tool.component';\nimport { LayerListBindingDirective } from './layer-list/layer-list-binding.directive';\nimport { LayerLegendListBindingDirective } from './layer-legend-list/layer-legend-list-binding.directive';\nimport { TrackFeatureButtonComponent } from './track-feature-button/track-feature-button.component';\nimport { LayerLegendListComponent } from './layer-legend-list/layer-legend-list.component';\nimport { LayerLegendItemComponent } from './layer-legend-item/layer-legend-item.component';\n\n@NgModule({\n  imports: [\n    MatInputModule,\n    MatFormFieldModule,\n    CommonModule,\n    FormsModule,\n    MatDividerModule,\n    MatMenuModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSlideToggleModule,\n    MatSelectModule,\n    MatTooltipModule,\n    MatListModule,\n    MatSliderModule,\n    MatBadgeModule,\n    MatCheckboxModule,\n    IgoLanguageModule,\n    IgoListModule,\n    IgoCollapsibleModule,\n    IgoImageModule,\n    IgoPanelModule,\n    IgoMatBadgeIconModule,\n    IgoCustomHtmlModule\n  ],\n  exports: [\n    LayerItemComponent,\n    LayerLegendItemComponent,\n    LayerLegendComponent,\n    LayerListComponent,\n    LayerListToolComponent,\n    LayerLegendListComponent,\n    LayerListBindingDirective,\n    LayerLegendListBindingDirective,\n    TrackFeatureButtonComponent\n  ],\n  declarations: [\n    LayerItemComponent,\n    LayerLegendItemComponent,\n    LayerLegendComponent,\n    LayerListComponent,\n    LayerListToolComponent,\n    LayerLegendListComponent,\n    LayerListBindingDirective,\n    LayerLegendListBindingDirective,\n    TrackFeatureButtonComponent\n  ]\n})\nexport class IgoLayerModule {\n  static forRoot(): ModuleWithProviders<IgoLayerModule> {\n    return {\n      ngModule: IgoLayerModule,\n      providers: [LayerService, StyleService, LayerListToolService]\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoMatBadgeIconModule,\n  IgoCollapsibleModule,\n  IgoListModule\n} from '@igo2/common';\n\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\nimport { CatalogBrowserComponent } from './catalog-browser.component';\nimport { CatalogBrowserLayerComponent } from './catalog-browser-layer.component';\nimport { CatalogBrowserGroupComponent } from './catalog-browser-group.component';\nimport { IgoLayerModule } from '../../layer/layer.module';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatButtonModule,\n    MatIconModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoMatBadgeIconModule,\n    IgoLanguageModule,\n    IgoListModule,\n    IgoCollapsibleModule,\n    IgoMetadataModule,\n    IgoLayerModule\n  ],\n  exports: [\n    CatalogBrowserComponent\n  ],\n  declarations: [\n    CatalogBrowserComponent,\n    CatalogBrowserGroupComponent,\n    CatalogBrowserLayerComponent\n  ]\n})\nexport class IgoCatalogBrowserModule {}\n","<h1 mat-dialog-title class=\"mat-typography\">{{'igo.geo.catalog.library.addTitle' | translate}}</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input type=\"text\" formControlName=\"title\" placeholder=\"{{'igo.geo.printForm.title' | translate}}\" matInput [matAutocomplete]=\"auto2\">\n        <mat-autocomplete #auto2=\"matAutocomplete\" (optionSelected)='changeUrlOrTitle($event.option.value)'>\n          <mat-option *ngFor=\"let predefinedCatalog of (predefinedCatalogsList$ | async)\" matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.title\" [value]=\"predefinedCatalog\">\n            {{predefinedCatalog.title}}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input type=\"text\" formControlName=\"url\" placeholder=\"URL\" matInput [matAutocomplete]=\"auto\">\n        <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)='changeUrlOrTitle($event.option.value)'>\n          <mat-option *ngFor=\"let predefinedCatalog of (predefinedCatalogsList$ | async)\" matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.url\" [value]=\"predefinedCatalog\">\n            {{predefinedCatalog.url}}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <mat-select\n          formControlName=\"type\"\n          placeholder=\"Type\">\n          <mat-option\n            *ngFor=\"let type of typeCapabilities\"\n            [value]=\"type\"\n            (click)=\"$event.stopPropagation()\">\n              <p mat-line>{{type}}</p>\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </form>\n  <span *ngIf=\"error && addedCatalog && emailAddress\">\n    <p class=\"error\">{{languageService.translate.instant('igo.geo.catalog.externalProvider.unavailableWithEmail', { value: addedCatalog.url, email: emailAddress })}}</p>\n  </span>\n  <span *ngIf=\"error && addedCatalog && !emailAddress\">\n    <p class=\"error\">{{languageService.translate.instant('igo.geo.catalog.unavailable', { value: addedCatalog.url })}}</p>\n  </span>\n</div>\n<div mat-dialog-actions style=\"justify-content: center\">\n  <div class=\"igo-form-button-group add-catalog-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      (click)=\"cancel()\">\n      {{'igo.geo.catalog.library.cancel' | translate}}\n    </button>\n    <button\n      id=\"addCatalogBtnDialog\"\n      mat-raised-button\n      type=\"button\"\n      color=\"primary\"\n      [disabled]=\"!form.valid\"\n      (click)=\"addCatalog(form.value)\">\n      {{'igo.geo.catalog.library.add' | translate}}\n    </button>\n  </div>\n</div>","import { LanguageService, ConfigService } from '@igo2/core';\nimport { Component, OnInit, OnDestroy, Optional, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { EntityStore } from '@igo2/common';\nimport { TypeCapabilities } from '../../datasource';\nimport { Catalog } from '../shared/catalog.abstract';\n\n@Component({\n  selector: 'igo-add-catalog-dialog',\n  templateUrl: './add-catalog-dialog.component.html',\n  styleUrls: ['./add-catalog-dialog.component.scss']\n})\nexport class AddCatalogDialogComponent implements OnInit, OnDestroy {\n  public form: FormGroup;\n  private defaultAddedCatalogType = 'wms';\n  private addedCatalogType$$: Subscription;\n  public predefinedCatalogsList$ = new BehaviorSubject<Catalog[]>([]);\n  typeCapabilities: string[];\n  predefinedCatalogs: Catalog[] = [];\n  store: EntityStore<Catalog>;\n  error = false;\n  addedCatalog: Catalog;\n  emailAddress: string;\n  private storeViewAll$$: Subscription;\n\n  constructor(\n    private formBuilder: FormBuilder,\n    public languageService: LanguageService,\n    private configService: ConfigService,\n    public dialogRef: MatDialogRef<AddCatalogDialogComponent>,\n    @Optional()\n    @Inject(MAT_DIALOG_DATA)\n    public data: { predefinedCatalogs: Catalog[]; store: EntityStore<Catalog>; error: boolean; addedCatalog: Catalog }\n  ) {\n    this.store = data.store;\n    this.predefinedCatalogs = data.predefinedCatalogs;\n    this.error = data.error;\n    this.addedCatalog = data.addedCatalog;\n    this.form = this.formBuilder.group({\n      id: ['', []],\n      title: ['', []],\n      url: ['', [Validators.required]],\n      type: [this.defaultAddedCatalogType, [Validators.required]]\n    });\n  }\n\n  ngOnInit() {\n    this.store.state.clear();\n    this.typeCapabilities = Object.keys(TypeCapabilities);\n\n    this.addedCatalogType$$ = this.form\n      .get('type')\n      .valueChanges.subscribe((value) => {\n        if (value === 'wmts') {\n          this.form.get('title').setValidators(Validators.required);\n        } else {\n          this.form.get('title').setValidators([]);\n        }\n        this.form.get('title').updateValueAndValidity();\n      });\n\n    this.computePredefinedCatalogList();\n    this.storeViewAll$$ = this.store.view\n      .all$()\n      .subscribe(() => this.computePredefinedCatalogList());\n\n    this.emailAddress = this.configService.getConfig('emailAddress');\n  }\n\n  ngOnDestroy() {\n    this.addedCatalogType$$.unsubscribe();\n    this.storeViewAll$$.unsubscribe();\n  }\n\n  changeUrlOrTitle(catalog: Catalog) {\n    this.form.patchValue(catalog);\n    this.error = false;\n    this.computePredefinedCatalogList();\n  }\n\n  computePredefinedCatalogList() {\n    this.predefinedCatalogsList$.next(\n      this.predefinedCatalogs.filter((c) => !this.store.get(c.id))\n    );\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    this.error = false;\n    this.dialogRef.close(addedCatalog);\n  }\n\n  cancel() {\n    this.error = false;\n    this.dialogRef.close();\n  }\n}\n","<igo-list [navigation]=\"false\">\n  <ng-template ngFor let-catalog [ngForOf]=\"getCatalogs() | async\">\n    <igo-catalog-library-item\n      igoListItem\n      color=\"accent\"\n      [map]=\"map\"\n      [catalog]=\"catalog\"\n      (catalogRemove)=\"onCatalogRemove(catalog)\"\n      (select)=\"onCatalogSelect(catalog)\">\n    </igo-catalog-library-item>\n  </ng-template>\n</igo-list>\n\n<div *ngIf=\"addCatalogAllowed\" class=btnAddCatalog>\n  <button\n    mat-raised-button\n    [matTooltip]=\"'igo.geo.catalog.library.addBtn' | translate\"\n    matTooltipPosition=\"above\"\n    color=\"primary\"\n    (click)=\"addCatalogDialog()\">\n    {{'igo.geo.catalog.library.addBtn' | translate}}\n    <mat-icon svgIcon=\"earth-plus\"></mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { EntityStore } from '@igo2/common';\nimport { LanguageService, MessageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\nimport { Observable, Subscription } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { Md5 } from 'ts-md5';\nimport { CapabilitiesService } from '../../datasource';\nimport { IgoMap } from '../../map';\nimport { standardizeUrl } from '../../utils/id-generator';\nimport { Catalog } from '../shared/catalog.abstract';\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\n\n/**\n * Component to browse a list of available catalogs\n */\n@Component({\n  selector: 'igo-catalog-library',\n  templateUrl: './catalog-library.component.html',\n  styleUrls: ['./catalog-library.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogLibaryComponent implements OnInit, OnDestroy {\n  /**\n   * Store holding the catalogs\n   */\n  @Input() store: EntityStore<Catalog>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() addCatalogAllowed: boolean = false;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() predefinedCatalogs: Catalog[] = [];\n\n  /**\n   * Event emitted a catalog is selected or unselected\n   */\n  @Output() catalogSelectChange = new EventEmitter<{\n    selected: boolean;\n    catalog: Catalog;\n  }>();\n\n  submitDisabled = true;\n  private addingCatalog$$: Subscription;\n\n  get addedCatalogs(): Catalog[] {\n    return (this.storageService.get('addedCatalogs') || []) as Catalog[];\n  }\n  set addedCatalogs(catalogs: Catalog[]) {\n    this.storageService.set('addedCatalogs', catalogs);\n  }\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private storageService: StorageService,\n    private dialog: MatDialog\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.state.clear();\n\n    this.predefinedCatalogs = this.predefinedCatalogs.map(c => {\n      c.id = Md5.hashStr(\n        (c.type || 'wms') + standardizeUrl(c.url)\n      ) as string;\n      c.title = c.title === '' || !c.title ? c.url : c.title;\n      return c;\n    });\n  }\n\n  getCatalogs(): Observable<Catalog[]> {\n    return this.store.view.all$();\n  }\n\n  /**\n   * When a catalog is selected, update it's state in the store\n   * and emit the catalog select change event\n   * @internal\n   */\n  onCatalogSelect(catalog: Catalog) {\n    this.store.state.update(\n      catalog,\n      {\n        selected: true,\n        focused: true\n      },\n      true\n    );\n    this.catalogSelectChange.emit({ selected: true, catalog });\n  }\n\n  private unsubscribeAddingCatalog() {\n    if (this.addingCatalog$$) {\n      this.addingCatalog$$.unsubscribe();\n    }\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    if (!addedCatalog) {\n      return;\n    }\n    let id = Md5.hashStr(\n      addedCatalog.type + standardizeUrl(addedCatalog.url)\n    ) as string;\n    const predefinedCatalog = this.predefinedCatalogs.find(\n      (c) => c.id === addedCatalog.id\n    );\n\n    if (predefinedCatalog) {\n      addedCatalog.version = predefinedCatalog.version;\n      addedCatalog.externalProvider = predefinedCatalog.externalProvider;\n      id = predefinedCatalog.id;\n    }\n\n    if (this.store.get(id)) {\n      const title = this.languageService.translate.instant(\n        'igo.geo.catalog.library.inlist.title'\n      );\n      const message = this.languageService.translate.instant(\n        'igo.geo.catalog.library.inlist.message'\n      );\n      this.messageService.alert(message, title);\n      return;\n    }\n    this.unsubscribeAddingCatalog();\n\n    this.addingCatalog$$ = this.capabilitiesService\n    .getCapabilities(addedCatalog.type as any, addedCatalog.url, addedCatalog.version)\n      .pipe(\n        catchError((e) => {\n          const title = this.languageService.translate.instant('igo.geo.catalog.unavailableTitle');\n          if (e.error) {\n            this.addCatalogDialog(true, addedCatalog);\n            e.error.caught = true;\n            return e;\n          }\n          const message = this.languageService.translate.instant('igo.geo.catalog.unavailable', { value: addedCatalog.url });\n          this.messageService.error(message, title);\n          throw e;\n        })\n      )\n      .subscribe((capabilities) => {\n        let title;\n        let version;\n        switch (addedCatalog.type) {\n          case 'wms':\n            title = addedCatalog.title || capabilities.Service.Title;\n            version = addedCatalog.version || capabilities.version;\n            break;\n          case 'arcgisrest':\n          case 'imagearcgisrest':\n          case 'tilearcgisrest':\n            title = addedCatalog.title || capabilities.mapName;\n            break;\n          case 'wmts':\n            title =\n              addedCatalog.title ||\n              capabilities.ServiceIdentification.ServiceType;\n            break;\n          default:\n            title = addedCatalog.title;\n        }\n\n        const catalogToAdd = ObjectUtils.removeUndefined(\n          Object.assign({},\n            predefinedCatalog,\n            ObjectUtils.removeUndefined({\n              id,\n              title,\n              url: addedCatalog.url,\n              type: addedCatalog.type || 'wms',\n              externalProvider: addedCatalog.externalProvider || false,\n              removable: true,\n              version\n            })) as Catalog);\n        this.store.insert(catalogToAdd);\n        const newCatalogs = this.addedCatalogs.slice(0);\n        newCatalogs.push(catalogToAdd);\n        this.addedCatalogs = newCatalogs;\n        this.unsubscribeAddingCatalog();\n      });\n  }\n\n  ngOnDestroy() {\n    this.unsubscribeAddingCatalog();\n  }\n\n  onCatalogRemove(catalog) {\n    this.store.delete(catalog);\n    this.addedCatalogs = this.addedCatalogs\n      .slice(0)\n      .filter((c) => c.id !== catalog.id);\n  }\n\n  addCatalogDialog(error?, addedCatalog?: Catalog) {\n    const dialogRef = this.dialog.open(AddCatalogDialogComponent, {\n      width: '700px',\n      data: {\n        predefinedCatalogs: this.predefinedCatalogs,\n        store: this.store,\n        error,\n        addedCatalog\n      }\n    });\n\n    dialogRef.afterClosed().subscribe((catalog) => {\n      this.addCatalog(catalog);\n    });\n  }\n}\n","<mat-list-item>\n  <h4 mat-line>\n    {{title}}\n  </h4>\n  <mat-icon\n    class=\"igo-external-provider\"\n    *ngIf=\"catalog.externalProvider\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.catalog.externalProvider.catalog' | translate\"\n    color=\"primary\"\n    (click)=\"$event.stopPropagation()\"\n    svgIcon=\"earth-arrow-right\">\n  </mat-icon>\n\n  <button\n  *ngIf=\"catalog.removable\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.catalog.library.remove' | translate\"\n  color=\"warn\"\n  (click)=\"removeCatalogFromLibrary($event)\">\n  <mat-icon svgIcon=\"delete\"></mat-icon>\n</button>\n\n<button\n  class=\"igo-blank\"\n  *ngIf=\"!catalog.removable\"\n  disabled=\"true\"\n  mat-icon-button>\n  <mat-icon svgIcon=\"blank\"></mat-icon>\n</button>\n</mat-list-item>\n","import { Component, Input, ChangeDetectionStrategy, Output, EventEmitter } from '@angular/core';\n\nimport { getEntityTitle } from '@igo2/common';\nimport { IgoMap } from '../../map';\nimport { Catalog } from '../shared/catalog.abstract';\n\n/**\n * Catalog library item\n */\n@Component({\n  selector: 'igo-catalog-library-item',\n  templateUrl: './catalog-library-item.component.html',\n  styleUrls: ['./catalog-library-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogLibaryItemComponent {\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  @Output() catalogRemove = new EventEmitter();\n\n  /**\n   * @internal\n   */\n  get title(): string { return getEntityTitle(this.catalog); }\n\n  removeCatalogFromLibrary(event) {\n    event.stopPropagation();\n    this.catalogRemove.emit();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoListModule } from '@igo2/common';\n\nimport { CatalogLibaryComponent, } from './catalog-library.component';\nimport { CatalogLibaryItemComponent } from './catalog-library-item.component';\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatDialogModule } from '@angular/material/dialog';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatBadgeModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoListModule,\n    IgoLanguageModule,\n    MatButtonModule,\n    MatFormFieldModule,\n    ReactiveFormsModule,\n    MatInputModule,\n    MatSelectModule,\n    MatAutocompleteModule,\n    MatDialogModule\n  ],\n  exports: [\n    CatalogLibaryComponent,\n    AddCatalogDialogComponent\n  ],\n  declarations: [\n    CatalogLibaryComponent,\n    CatalogLibaryItemComponent,\n    AddCatalogDialogComponent\n  ]\n})\nexport class IgoCatalogLibraryModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoListModule, IgoCollapsibleModule, IgoMatBadgeIconModule } from '@igo2/common';\n\nimport { IgoCatalogBrowserModule } from './catalog-browser/catalog-browser.module';\nimport { IgoCatalogLibraryModule } from './catalog-library/catalog-library.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatIconModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoMatBadgeIconModule,\n    IgoListModule,\n    IgoCollapsibleModule\n  ],\n  exports: [\n    IgoCatalogBrowserModule,\n    IgoCatalogLibraryModule\n  ],\n  declarations: []\n})\nexport class IgoCatalogModule {}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\nimport { TimeFilterableDataSource } from './time-filter.interface';\n\n@Pipe({\n  name: 'filterableDataSource'\n})\nexport class FilterableDataSourcePipe implements PipeTransform {\n  transform(value: Layer[], arg: string): Layer[] {\n    let layers;\n\n    if (arg === 'time') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as TimeFilterableDataSource;\n        return (\n          this.isTimeFilterable(datasource) &&\n          datasource.options.timeFilter !== undefined &&\n          Object.keys(datasource.options.timeFilter).length\n        );\n      });\n    }\n    if (arg === 'ogc') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as OgcFilterableDataSource;\n        return this.isOgcFilterable(datasource);\n      });\n    }\n    return layers;\n  }\n\n  private isTimeFilterable(dataSource: TimeFilterableDataSource) {\n    if (dataSource.options.type !== 'wms') {\n      return false;\n    }\n    return dataSource.options.timeFilterable;\n  }\n\n  private isOgcFilterable(dataSource: OgcFilterableDataSource): boolean {\n    let isOgcFilterable = false;\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      dataSource.options.ogcFilters.editable\n    ) {\n      isOgcFilterable = true;\n    }\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      (\n        dataSource.options.ogcFilters.pushButtons ||\n        dataSource.options.ogcFilters.checkboxes ||\n        dataSource.options.ogcFilters.radioButtons ||\n        dataSource.options.ogcFilters.select ||\n        dataSource.options.ogcFilters.autocomplete)) {\n        isOgcFilterable = true;\n    }\n    return isOgcFilterable;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { TileArcGISRestDataSource } from '../../datasource/shared/datasources/tilearcgisrest-datasource';\n\n@Injectable()\nexport class TimeFilterService {\n  constructor() {}\n\n  filterByDate(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    date: Date | [Date, Date]\n  ) {\n    let time;\n    let newdateform;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(date)) {\n      const dates = [];\n      if (date[0]) {\n        newdateformStart = this.reformatDateTime(date[0]);\n        dates.push(date[0]);\n      }\n      if (date[1]) {\n        newdateformEnd = this.reformatDateTime(date[1]);\n        dates.push(date[1]);\n      }\n      if (dates.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else if (date) {\n      newdateform = this.reformatDateTime(date);\n      time = newdateform;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  filterByYear(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    year: string | [string, string]\n  ) {\n    let time;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(year)) {\n      const years = [];\n      if (year[0]) {\n        newdateformStart = year[0];\n        years.push(year[0]);\n      }\n      if (year[1]) {\n        newdateformEnd = year[1];\n        years.push(year[1]);\n      }\n      if (years.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else { // to reset filter.\n      time = year;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  private reformatDateTime(value) {\n    const year = value.getFullYear();\n    let month = value.getMonth() + 1;\n    let day = value.getUTCDate();\n    let hour = value.getUTCHours();\n    let minute = value.getUTCMinutes();\n\n    if (Number(month) < 10) {\n      month = '0' + month;\n    }\n\n    if (Number(day) < 10) {\n      day = '0' + day;\n    }\n\n    if (Number(hour) < 10) {\n      hour = '0' + hour;\n    }\n\n    if (Number(minute) < 10) {\n      minute = '0' + minute;\n    }\n\n    return year + '-' + month + '-' + day + 'T' + hour + ':' + minute + ':00Z';\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from './ogc-filter';\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterService {\n  constructor() {}\n\n  public filterByOgc(wmsDatasource: WMSDataSource, filterString: string) {\n    const appliedFilter = new OgcFilterWriter().formatProcessedOgcFilter(filterString, wmsDatasource.options.params.LAYERS);\n    wmsDatasource.ol.updateParams({ FILTER: appliedFilter });\n  }\n\n  public setOgcWFSFiltersOptions(wfsDatasource: OgcFilterableDataSource) {\n    const options: any = wfsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.paramsWFS.fieldNameGeometry,\n        new olProjection({ code: options.paramsWFS.srsName }),\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters = ogcFilterWriter.defineInterfaceFilterSequence(\n          options.ogcFilters.filters,\n          options.paramsWFS.fieldNameGeometry\n        );\n      }\n    }\n  }\n\n  public setOgcWMSFiltersOptions(wmsDatasource: OgcFilterableDataSource) {\n    const options: any = wmsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.fieldNameGeometry,\n        undefined,\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters = ogcFilterWriter.defineInterfaceFilterSequence(\n          // With some wms server, this param must be set to make spatials call.\n          options.ogcFilters.filters,\n          options.fieldNameGeometry\n        );\n      }\n      this.filterByOgc(\n        wmsDatasource as WMSDataSource,\n        ogcFilterWriter.buildFilter(options.ogcFilters.filters,\n        undefined,\n        undefined,\n        undefined,\n        wmsDatasource.options\n        )\n      );\n      options.filtered = true;\n    } else {\n      options.ogcFilters.filters = undefined;\n      options.ogcFilters.interfaceOgcFilters = [];\n      options.filtered = false;\n    }\n  }\n}\n","export enum SpatialFilterQueryType {\n    AdmRegion = 'AdmRegion',\n    Mun = 'Mun',\n    Arrond = 'Arrond',\n    CircFed = 'CircFed',\n    CircProv = 'CircProv',\n    DirReg = 'DirReg',\n    MRC = 'MRC',\n    RegTour = 'RegTour'\n}\n\nexport enum SpatialFilterType {\n    Predefined = 'Predefined',\n    Polygon = 'Polygon',\n    Point = 'Point'\n}\n\nexport enum SpatialFilterItemType {\n    Address = 'Address',\n    Thematics = 'Thematics'\n}\n","import { Injectable } from '@angular/core';\n\nimport { HttpClient } from '@angular/common/http';\nimport { ConfigService, LanguageService } from '@igo2/core';\nimport { map } from 'rxjs/operators';\nimport { Observable } from 'rxjs';\nimport { Feature } from '../../feature/shared';\nimport {\n  SpatialFilterQueryType,\n  SpatialFilterItemType,\n  SpatialFilterType\n} from './spatial-filter.enum';\nimport { SpatialFilterThematic } from './spatial-filter.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SpatialFilterService {\n  public baseUrl: string = 'https://geoegl.msp.gouv.qc.ca/apis/terrapi/';\n\n  /*\n   * Type association with URL\n   */\n  public urlFilterList = {\n    AdmRegion: 'regadmin',\n    Arrond: 'arrondissements',\n    CircFed: 'circ-fed',\n    CircProv: 'circ-prov',\n    DirReg: 'dir-reg',\n    MRC: 'mrc',\n    Mun: 'municipalites',\n    RegTour: 'tourisme',\n    bornes: 'bornes-sumi',\n    hydro: 'hydro',\n    routes: 'routes'\n  };\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    private configService: ConfigService\n  ) {\n    this.baseUrl =\n      this.configService.getConfig('spatialFilter.url') || this.baseUrl;\n  }\n\n  getKeyByValue(object, value) {\n    return Object.keys(object).find(key => object[key] === value);\n  }\n\n  /*\n   * Loading data for spatial filter list component (NO GEOMETRY)\n   */\n  loadFilterList(type: SpatialFilterQueryType): Observable<Feature[]> {\n    const urlPath = type as string;\n    if (urlPath) {\n      return this.http\n        .get<{ features: Feature[] }>(\n          this.baseUrl + this.urlFilterList[urlPath]\n        )\n        .pipe(\n          map(featureCollection =>\n            featureCollection.features.map(f => {\n              f.meta = {\n                id: f.properties.code\n              };\n              return f;\n            })\n          )\n        );\n    }\n  }\n\n  /*\n   * Loading item list (STRING)\n   */\n  loadThematicsList() {\n    const url = 'types';\n    const items: SpatialFilterThematic[] = [];\n    return this.http.get(this.baseUrl + url).pipe(\n      map((types: string[]) => {\n        types.forEach(type => {\n          if (type.startsWith('lieux')) {\n            const item: SpatialFilterThematic = {\n              name: undefined,\n              source: type\n            };\n            let substr = type.substring(6, type.length);\n            let name = substr;\n            if (substr.includes('.')) {\n              const index = substr.indexOf('.');\n              name = substr.substring(index + 1, substr.length);\n              substr = substr.substring(0, index);\n            }\n            try {\n              item.name = this.languageService.translate.instant(\n                'igo.geo.terrapi.' + name\n              );\n            } catch (e) {\n              item.name = name.substring(0, 1).toUpperCase() + name.substring(1, name.length - 1);\n            }\n\n            try {\n              item.group = this.languageService.translate.instant(\n                'igo.geo.spatialFilter.group.' + substr\n              );\n            } catch (e) {\n              item.group = substr.substring(0, 1).toUpperCase() + substr.substring(1, name.length - 1);\n            }\n\n            items.push(item);\n          } else {\n            if (this.getKeyByValue(this.urlFilterList, type)) {\n              const item: SpatialFilterThematic = {\n                name: undefined,\n                source: type\n              };\n              const name = this.getKeyByValue(this.urlFilterList, type);\n              try {\n                item.name = this.languageService.translate.instant(\n                  'igo.geo.terrapi.' + name\n                );\n              } catch (e) {\n                item.name = name.substring(0, 1).toUpperCase() + name.substring(1, name.length - 1);\n              }\n              item.source = type;\n\n              items.push(item);\n            }\n          }\n        });\n        return items;\n      })\n    );\n  }\n\n  /*\n   * Loading data for spatial filter item component (Address or Thematics) depends on predefined zone or draw zone (feature)\n   */\n  loadFilterItem(\n    feature,\n    itemType: SpatialFilterItemType,\n    type?: SpatialFilterQueryType,\n    thematic?: SpatialFilterThematic,\n    buffer?: number\n  ) {\n    if (type) {\n      // Predefined type\n      const urlType = type as string;\n      const url = this.baseUrl + this.urlFilterList[urlType];\n      let urlItem = '';\n      if (itemType === SpatialFilterItemType.Address) {\n        urlItem = 'adresses';\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        urlItem = thematic.source;\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    } else {\n      // Draw type\n      const url = this.baseUrl + 'locate';\n      if (itemType === SpatialFilterItemType.Address) {\n        const urlItem = '?type=adresses';\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        const urlItem = '?type=' + thematic.source;\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    }\n  }\n\n  /*\n   * Get one territory by id (WITH GEOMETRY)\n   */\n  loadItemById(\n    feature: Feature,\n    type: SpatialFilterQueryType\n  ): Observable<Feature> {\n    const featureType = this.urlFilterList[type];\n    const featureCode = '/' + feature.properties.code;\n    if (featureType && featureCode) {\n      return this.http\n        .get<Feature>(this.baseUrl + featureType + featureCode, {\n          params: {\n            geometry: 'true'\n          }\n        })\n        .pipe(\n          map(f => {\n            f.meta = {\n              id: f.properties.code,\n              alias: f.properties.nom,\n              title: f.properties.nom\n            };\n            return f;\n          })\n        );\n    }\n  }\n\n  /*\n   * Get buffer geometry\n   */\n  loadBufferGeometry(\n    feature: Feature,\n    filterType: SpatialFilterType,\n    buffer?: number,\n    type?: SpatialFilterQueryType,\n  ): Observable<Feature> {\n    if (filterType === SpatialFilterType.Predefined) {\n      const featureType = this.urlFilterList[type];\n      const featureCode = '/' + feature.properties.code;\n      if (featureType && featureCode) {\n        return this.http\n          .get<Feature>(this.baseUrl + featureType + featureCode,\n            {\n              params: {\n                geometry: '100',\n                bufferOutput: buffer.toString()\n              }\n            }\n          )\n          .pipe(\n            map(f => {\n              f.meta = {\n                id: f.properties.code,\n                alias: f.properties.nom,\n                title: f.properties.nom\n              };\n              return f;\n            })\n          );\n      }\n    } else {\n      return this.http\n        .post<Feature>(this.baseUrl + 'geospatial/buffer?', {\n          buffer,\n          loc: JSON.stringify(feature)\n        })\n        .pipe(\n          map(f => {\n            return f;\n          })\n        );\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\n\nimport { MessageService, LanguageService } from '@igo2/core';\n\nimport { Layer } from '../../layer/shared';\nimport { OgcFilterWriter, OgcFilterableDataSourceOptions } from '../../filter/shared';\n\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DownloadService {\n\n  constructor(\n    private messageService: MessageService,\n    private languageService: LanguageService\n  ) {}\n\n  open(layer: Layer) {\n    const translate = this.languageService.translate;\n    const title = translate.instant('igo.geo.download.title');\n    this.messageService.success(\n      translate.instant('igo.geo.download.start'),\n      title\n    );\n\n    const DSOptions: DataSourceOptions = layer.dataSource.options;\n    if (Object.keys(DSOptions.download).length > 0) {\n      if (\n        DSOptions.download.dynamicUrl &&\n        DSOptions.download.url === undefined\n      ) {\n        let wfsOptions;\n        let currentProj = new olProjection({ code: layer.map.projection });\n        const paramsWFS = (layer.dataSource.options as any).paramsWFS;\n        if (paramsWFS && Object.keys(paramsWFS).length > 0\n        ) {\n          currentProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : currentProj;\n          wfsOptions = (layer.dataSource.options as any).paramsWFS;\n        } else {\n          wfsOptions = (layer.dataSource.options as any).params;\n        }\n\n        const currentExtent = olproj.transformExtent(\n          layer.map.viewController.getExtent(),\n          new olProjection({ code: layer.map.projection }),\n          currentProj\n        );\n        const outputFormatDownload =\n          wfsOptions.outputFormatDownload === undefined\n            ? wfsOptions.outputFormat === undefined ? '' : 'outputformat=' + wfsOptions.outputFormat\n            : 'outputformat=' + wfsOptions.outputFormatDownload;\n\n        const baseurl = DSOptions.download.dynamicUrl\n          .replace(/&?outputformat=[^&]*/gi, '')\n          .replace(/&?filter=[^&]*/gi, '')\n          .replace(/&?bbox=[^&]*/gi, '');\n\n        const ogcFilters = (layer.dataSource.options as OgcFilterableDataSourceOptions).ogcFilters;\n\n        let filterQueryString;\n        filterQueryString = new OgcFilterWriter()\n        .handleOgcFiltersAppliedValue(\n          layer.dataSource.options,\n          ogcFilters.geometryName,\n          currentExtent as [number, number, number, number],\n          currentProj);\n        if (!filterQueryString) {\n          // Prevent getting all the features for empty filter\n            filterQueryString = new OgcFilterWriter().buildFilter(\n            undefined,\n            currentExtent as [number, number, number, number],\n            currentProj,\n            ogcFilters.geometryName\n          );\n        } else {\n          filterQueryString = 'filter=' + encodeURIComponent(filterQueryString);\n        }\n        window.open(\n          `${baseurl}&${filterQueryString}&${outputFormatDownload}`,\n          '_blank'\n        );\n      } else if (DSOptions.download) {\n        window.open(DSOptions.download.url, '_blank');\n      }\n    }\n  }\n}\n","<button\n  *ngIf=\"options && options.download && (options.download['dynamicUrl'] || options.download['url']) \"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\n  [color]=\"color\"\n  (click)=\"openDownload(layer)\">\n  <mat-icon svgIcon=\"download\"></mat-icon>\n</button>\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { DownloadDataSourceOptions } from '../shared/download.interface';\nimport { DownloadService } from '../shared/download.service';\n\n@Component({\n  selector: 'igo-download-button',\n  templateUrl: './download-button.component.html',\n  styleUrls: ['./download-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DownloadButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(private downloadService: DownloadService) {}\n\n  openDownload(layer: Layer) {\n    this.downloadService.open(layer);\n  }\n\n  get options(): DownloadDataSourceOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.dataSource.options;\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { DownloadButtonComponent } from './download-button/download-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule\n  ],\n  exports: [DownloadButtonComponent],\n  declarations: [DownloadButtonComponent]\n})\nexport class IgoDownloadModule {\n  static forRoot(): ModuleWithProviders<IgoDownloadModule> {\n    return {\n      ngModule: IgoDownloadModule\n    };\n  }\n}\n","<table class=\"igo-striped mat-typography\" *ngIf=\"ready && feature && isObject(feature.properties) && feature.properties.target !== 'iframe'\">\n  <tbody>\n    <tr *ngFor=\"let property of filterFeatureProperties(feature) | keyvalue\">\n\n      <td *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\">\n        <mat-icon mat-list-avatar svgIcon=\"{{icon}}\"></mat-icon>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\">\n        <a href=\"{{property.value}}\" target='_blank' rel=\"noopener noreferrer\"> {{ 'igo.geo.targetHtmlUrl' | translate }} {{title}}</a>\n      </td>\n\n      <td id=\"keyValue\" *ngIf=\"feature.properties.target === undefined\">\n        {{property.key}}\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && !isUrl(property.value) && !isEmbeddedLink(property.value)\" [innerHTML]=\"property.value\">\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && isEmbeddedLink(property.value)\">\n        <u [ngStyle]=\"{'cursor': 'pointer', 'color': 'blue'}\" (click)=\"openSecureUrl(property.value)\">{{ getEmbeddedLinkText(property.value) }}</u>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && (isDoc(property.value) || isUrl(property.value)) && !isImg(property.value)\">\n        <u [ngStyle]=\"{'cursor': 'pointer', 'color': 'blue'}\" (click)=\"openSecureUrl(property.value)\">{{ 'igo.geo.targetHtmlUrl' | translate }}</u>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && isUrl(property.value) && isImg(property.value)\">\n        <a href=\"{{property.value}}\" target='_blank' (click)=\"openSecureUrl(property.value)\" rel=\"noopener noreferrer\">\n          <img src=\"{{(property.value | secureImage) |async}}\" width=\"225\" height=\"auto\">\n        </a>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && isObject(property.value)\" [innerHTML]=\"property.value | json\">\n      </td>\n\n    </tr>\n  </tbody>\n</table>\n\n<iframe *ngIf=\"isHtmlDisplay()\" [srcdoc]=\"htmlSanitizer(feature.properties)\" [src]=\"urlSanitizer(feature.properties.url)\"></iframe>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Output,\n  EventEmitter,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\n\nimport { userAgent } from '@igo2/utils';\nimport { NetworkService, ConnectionState, MessageService, LanguageService } from '@igo2/core';\nimport { ConfigService } from '@igo2/core';\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\nimport type { Toolbox } from '@igo2/common';\n\nimport { Feature } from '../shared';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { IgoMap } from '../../map/shared/map';\nimport { HttpClient } from '@angular/common/http';\n\n@Component({\n  selector: 'igo-feature-details',\n  templateUrl: './feature-details.component.html',\n  styleUrls: ['./feature-details.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\n\nexport class FeatureDetailsComponent implements OnInit, OnDestroy {\n  private state: ConnectionState;\n  private unsubscribe$ = new Subject<void>();\n  ready = false;\n\n  @Input()\n  get source(): SearchSource {\n    return this._source;\n  }\n  set source(value: SearchSource) {\n    this._source = value;\n    this.cdRef.detectChanges();\n  }\n\n  @Input() map: IgoMap;\n\n  @Input() toolbox: Toolbox;\n\n  @Input()\n  get feature(): Feature {\n    return this._feature;\n  }\n  set feature(value: Feature) {\n    this._feature = value;\n    this.cdRef.detectChanges();\n    this.selectFeature.emit();\n  }\n\n  private _feature: Feature;\n  private _source: SearchSource;\n\n  @Output() routeEvent = new EventEmitter<boolean>();\n  @Output() selectFeature = new EventEmitter<boolean>();\n  @Output() htmlDisplayEvent = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.feature);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.feature) || 'link';\n  }\n\n\n  constructor(\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef,\n    private sanitizer: DomSanitizer,\n    private networkService: NetworkService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private configService: ConfigService\n  ) {\n    this.networkService.currentState().pipe(takeUntil(this.unsubscribe$)).subscribe((state: ConnectionState) => {\n      this.state = state;\n    });\n  }\n\n  ngOnInit() {\n    this.ready = true;\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  urlSanitizer(value): SafeResourceUrl {\n    return this.sanitizer.bypassSecurityTrustResourceUrl(value);\n  }\n\n\n  isHtmlDisplay(): boolean {\n    if (this.feature && this.isObject(this.feature.properties) && this.feature.properties.target === 'iframe') {\n      this.htmlDisplayEvent.emit(true);\n      return true;\n    } else {\n      this.htmlDisplayEvent.emit(false);\n      return false;\n    }\n  }\n\n  htmlSanitizer(value): SafeResourceUrl {\n    if (!value.body || userAgent.getBrowserName() === 'Internet Explorer') {\n      return;\n    }\n    const regexBase = /<base href=\"[\\w:\\/\\.]+\">/;\n    if (!regexBase.test(value.body)) {\n      const url = new URL(value.url, window.location.origin);\n      value.body = value.body.replace('<head>', `<head><base href=\"${url.origin}\">`);\n    }\n\n    return this.sanitizer.bypassSecurityTrustHtml(value.body);\n  }\n\n  isObject(value) {\n    return typeof value === 'object';\n  }\n\n  openSecureUrl(value) {\n    let url: string;\n    const regexDepot = new RegExp(this.configService?.getConfig('depot.url') + '.*?(?=\"|$)');\n    const regexUrl = /https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&//=]*)/;\n\n    if (regexDepot.test(value)) {\n      url = value.match(regexDepot)[0];\n\n      this.http.get(url, {\n        responseType: 'blob'\n      })\n      .subscribe((docOrImage) => {\n        const fileUrl = URL.createObjectURL(docOrImage);\n        window.open(fileUrl, '_blank');\n        this.cdRef.detectChanges();\n      },\n      (error: Error) => {\n        const translate = this.languageService.translate;\n        const title = translate.instant('igo.geo.targetHtmlUrlUnauthorizedTitle');\n        const message = translate.instant('igo.geo.targetHtmlUrlUnauthorized');\n        this.messageService.error(message, title);\n      });\n    } else {\n      url = value.match(regexUrl)[0];\n      window.open(url, '_blank');\n    }\n  }\n\n  isUrl(value) {\n    if (typeof value === 'string') {\n      const regex = /^https?:\\/\\//;\n      return regex.test(value);\n    }\n  }\n\n  isDoc(value) {\n    if (typeof value === 'string') {\n      if (this.isUrl(value)) {\n        const regex = /(pdf|docx?|xlsx?)$/;\n        return regex.test(value.toLowerCase());\n      } else {\n        return false;\n      }\n    }\n  }\n\n  isImg(value) {\n    if (typeof value ==='string') {\n      if (this.isUrl(value)) {\n        const regex = /(jpe?g|png|gif)$/;\n        return regex.test(value.toLowerCase());\n      } else {\n        return false;\n      }\n    }\n  }\n\n  isEmbeddedLink(value) {\n    if (typeof value === 'string') {\n      const regex = /^<a/;\n      return regex.test(value);\n    }\n  }\n\n  getEmbeddedLinkText(value) {\n    const regex = /(?<=>).*?(?=<|$)/;\n    const text = value.match(regex)[0];\n    return text;\n  }\n\n  filterFeatureProperties(feature) {\n    const allowedFieldsAndAlias = feature.meta ? feature.meta.alias : undefined;\n    const properties = {};\n    let offlineButtonState;\n\n    if (this.map) {\n      this.map.offlineButtonToggle$.pipe(takeUntil(this.unsubscribe$)).subscribe(state => {\n        offlineButtonState = state;\n      });\n    }\n\n    if (feature.properties && feature.properties.Route && this.toolbox && !this.toolbox.getTool('directions')) {\n      delete feature.properties.Route;\n    }\n\n    if (allowedFieldsAndAlias) {\n      Object.keys(allowedFieldsAndAlias).forEach(field => {\n        properties[allowedFieldsAndAlias[field]] = feature.properties[field];\n      });\n      return properties;\n    } else if (offlineButtonState !== undefined) {\n      if (!offlineButtonState) {\n        if (this.state.connection && feature.meta && feature.meta.excludeAttribute) {\n          const excludeAttribute = feature.meta.excludeAttribute;\n          excludeAttribute.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        } else if (!this.state.connection && feature.meta && feature.meta.excludeAttributeOffline) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        }\n      } else {\n        if (feature.meta && feature.meta.excludeAttributeOffline) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        }\n      }\n    } else {\n      if (this.state.connection && feature.meta && feature.meta.excludeAttribute) {\n        const excludeAttribute = feature.meta.excludeAttribute;\n        excludeAttribute.forEach(attribute => {\n          delete feature.properties[attribute];\n        });\n      } else if (!this.state.connection && feature.meta && feature.meta.excludeAttributeOffline) {\n        const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n        excludeAttributeOffline.forEach(attribute => {\n          delete feature.properties[attribute];\n        });\n      }\n    }\n    return feature.properties;\n  }\n}\n","export enum GeometryType {\n    Point = 'Point',\n    LineString = 'LineString',\n    Polygon = 'Polygon',\n    Circle = 'Circle'\n}\n\nexport enum FontType {\n    Arial = 'Arial',\n    ArialBlack = 'Arial Black',\n    Verdana = 'Verdana',\n    Tahoma = 'Tahoma',\n    TrebuchetMS = 'Trebuchet MS',\n    Impact = 'Impact',\n    TimesNewRoman = 'Times New Roman',\n    Georgia = 'Georgia',\n    AmericanTypewriter = 'American Typewriter',\n    Courier = 'Courier',\n    LucidaConsole = 'Lucida Console',\n    BrushScriptMT = 'Brush Script MT',\n    ComicSansMS = 'Comic Sans MS'\n}\n","import OlCircle from 'ol/geom/Circle';\nimport OlPoint from 'ol/geom/Point';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\nimport OlLineString from 'ol/geom/LineString';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlPolygon from 'ol/geom/Polygon';\nimport BasicEvent from 'ol/events/Event';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport lineIntersect from '@turf/line-intersect';\nimport { lineString } from '@turf/helpers';\n\nimport {\n  GeometrySliceMultiPolygonError,\n  GeometrySliceLineStringError,\n  GeometrySliceTooManyIntersectionError\n } from './geometry.errors';\n\n/**\n * Create a default style for draw and modify interactions\n * @param color Style color (R, G, B)\n * @returns OL style\n */\nexport function createDrawInteractionStyle(color?: [number, number, number]): olstyle.Circle {\n  color = color || [0, 153, 255];\n  return new olstyle.Circle({\n    stroke: new olstyle.Stroke({\n      color: color.concat([1]),\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: color.concat([0.2])\n    }),\n    radius: 8\n  });\n}\n\n/**\n * Create a default style for drawing a hole\n * @returns OL style\n */\nexport function createDrawHoleInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color:  [0, 153, 255, 1],\n      width: 2\n    })\n  });\n}\n\n/**\n * Slice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function sliceOlGeometry(\n  olGeometry: OlLineString | OlPolygon,\n  olSlicer: OlLineString\n): Array<OlLineString | OlPolygon> {\n  if (olGeometry instanceof OlPolygon) {\n    return sliceOlPolygon(olGeometry, olSlicer);\n  } else if (olGeometry instanceof OlLineString) {\n    return sliceOlLineString(olGeometry, olSlicer);\n  }\n  return [];\n}\n\n/**\n * Slice OL LineString into one or more lines\n * @param olLineString OL line string\n * @param olSlicer Slicing line\n * @returns New OL line strings\n */\nexport function sliceOlLineString(olLineString: OlLineString, olSlicer: OlLineString): OlLineString[] {\n  return [];\n}\n\n/**\n * Slice OL Polygon into one or more polygons\n * @param olPolygon OL polygon\n * @param olSlicer Slicing line\n * @returns New OL polygons\n */\nexport function sliceOlPolygon(olPolygon: OlPolygon, olSlicer: OlLineString): OlPolygon[] {\n  if (olPolygon.getLinearRingCount() > 1) {\n    throw new GeometrySliceMultiPolygonError();\n  }\n\n  if (olSlicer.getCoordinates().length > 2) {\n    throw new GeometrySliceLineStringError();\n  }\n\n  const olGeoJSON = new OlGeoJSON();\n  const slicer = olGeoJSON.writeGeometryObject(olSlicer) as any;\n  const outerCoordinates = olPolygon.getLinearRing(0).getCoordinates();\n\n  const parts = [[], []];\n  let totalIntersectionCount = 0;\n  for (let i = 0, ii = outerCoordinates.length - 1; i < ii; i++) {\n    const segmentCoordinates = [outerCoordinates[i], outerCoordinates[i + 1]];\n    const segment = lineString(segmentCoordinates);\n    const intersections = lineIntersect(segment, slicer).features;\n\n    const intersectionCount = intersections.length;\n    totalIntersectionCount += intersectionCount;\n    if (intersectionCount > 1 || totalIntersectionCount > 2) {\n      throw new GeometrySliceTooManyIntersectionError();\n    }\n\n    parts[0].push(segmentCoordinates[0]);\n    if (intersectionCount === 1) {\n      const intersection = intersections[0].geometry.coordinates;\n      parts[0].push(intersection);\n      parts[1].push(intersection);\n      parts.reverse();\n    }\n  }\n\n  if (totalIntersectionCount <= 1) {\n    return [];\n  }\n\n  parts[0].push(parts[0][0]);\n  parts[1].push(parts[1][0]);\n\n  return [new OlPolygon([parts[0]]), new OlPolygon([parts[1]])];\n}\n\n/**\n * Splice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function addLinearRingToOlPolygon(olPolygon: OlPolygon, olLinearRing: OlLinearRing ) {\n  // TODO: make some validation and support updating an existing linear ring\n  olPolygon.appendLinearRing(olLinearRing);\n}\n\nexport function getMousePositionFromOlGeometryEvent(\n  olEvent: BasicEvent\n) {\n  const olGeometry = olEvent.target as OlGeometry;\n  if (olGeometry instanceof OlPolygon) {\n    return olGeometry.getFlatCoordinates().slice(-4, -2) as [number, number];\n  }\n  const olGeometryCast = olGeometry as OlPoint | OlLineString | OlCircle;\n  return olGeometryCast.getFlatCoordinates().slice(-2) as [number, number];\n}\n","/* eslint-disable */\n// See this issue: https://github.com/Microsoft/TypeScript/issues/13965\n// And the solution: https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\n// for an explanation as to why the prototype is set manually\n/* eslint-enable */\n\nexport class GeometrySliceError extends Error {}\n\nexport class GeometrySliceMultiPolygonError extends GeometrySliceError {\n  constructor() {\n    super('Can\\'t slice a MultiPolygon.');\n    Object.setPrototypeOf(this, GeometrySliceMultiPolygonError.prototype);\n  }\n}\n\nexport class GeometrySliceLineStringError extends GeometrySliceError {\n  constructor() {\n    super('Can\\'t slice with a line that has more than 2 points.');\n    Object.setPrototypeOf(this, GeometrySliceLineStringError.prototype);\n  }\n}\n\nexport class GeometrySliceTooManyIntersectionError extends GeometrySliceError {\n  constructor() {\n    super('More than 2 intersections found between the target polygon and the slicing line.');\n    Object.setPrototypeOf(this, GeometrySliceTooManyIntersectionError.prototype);\n  }\n}\n","import { EventsKey } from 'ol/events';\nimport OlMap from 'ol/Map';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlDraw from 'ol/interaction/Draw';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlModify from 'ol/interaction/Modify';\nimport OlSelect from 'ol/interaction/Select';\nimport BasicEvent from 'ol/events/Event';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport { SelectEvent as OlSelectEvent } from 'ol/interaction/Select';\nimport { unByKey } from 'ol/Observable';\nimport { doubleClick } from 'ol/events/condition';\n\nimport { Subject, Subscription, fromEvent, BehaviorSubject } from 'rxjs';\n\nimport { getMousePositionFromOlGeometryEvent } from '../geometry.utils';\n\nexport interface DrawControlOptions {\n  geometryType: typeof OlGeometryType | string;\n  drawingLayerSource?: OlVectorSource<OlGeometry>;\n  drawingLayer?: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  drawingLayerStyle?: OlStyleLike;\n  interactionStyle?: OlStyleLike;\n  maxPoints?: number;\n}\n\n/**\n * Control to draw entities\n */\nexport class DrawControl {\n  /**\n   * Draw start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw changes observable (while drawing)\n   */\n  public changes$: Subject<any> = new Subject();\n\n  /**\n   * Draw modify observable (modify drawn features)\n   */\n  public modify$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw select observable (modify drawn features)\n   */\n  public select$: Subject<any> = new Subject();\n\n  /**\n   * Draw abort observable (abort drawn features)\n   */\n     public abort$: Subject<any> = new Subject();\n\n  /**\n   * Freehand mode observable (defaults to false)\n   */\n  freehand$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  private keyDown$$: Subscription;\n\n  private olGeometryType: typeof OlGeometryType | undefined | string;\n  private olMap: OlMap;\n  private olDrawingLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  private olDrawInteraction: OlDraw;\n  private olSelectInteraction: OlSelect;\n  private olModifyInteraction: OlModify;\n  private onDrawStartKey: EventsKey;\n  private onDrawEndKey: EventsKey;\n  private onDrawAbortKey: EventsKey;\n  private onDrawKey: EventsKey;\n\n  private mousePosition: [number, number];\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olDrawingLayerSource(): OlVectorSource<OlGeometry> {\n    return this.olDrawingLayer.getSource();\n  }\n\n  constructor(private options: DrawControlOptions) {\n    this.olDrawingLayer = options.drawingLayer ? options.drawingLayer : this.createOlInnerOverlayLayer();\n    this.olGeometryType = this.options.geometryType;\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined, activateModifyAndSelect?: boolean) {\n    if (!olMap) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlInteractions();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n    this.addOlInteractions(activateModifyAndSelect);\n  }\n\n  /**\n   * Return the drawing layer source\n   */\n  getSource(): OlVectorSource<OlGeometry> {\n    return this.olDrawingLayerSource;\n  }\n\n  /**\n   * Set the current geometry type\n   * @param geometryType the geometry type\n   */\n  setGeometryType(geometryType: typeof OlGeometryType) {\n    this.olGeometryType = geometryType;\n  }\n\n  /**\n   * Create a drawing source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<OlVectorSource<OlGeometry>> {\n    return new OlVectorLayer({\n      source: this.options.drawingLayerSource ? this.options.drawingLayerSource : new OlVectorSource(),\n      style: this.options.drawingLayerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Clear the drawing layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer && this.olMap) {\n      this.olMap.removeLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Add the drawing layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer) {\n      this.olMap.addLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Clear the drawing layer source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (!this.options.drawingLayer && !this.options.drawingLayerSource) {\n      this.olDrawingLayerSource.clear(true);\n    }\n  }\n\n  /**\n   * Add interactions to the map an set up some listeners\n   */\n  addOlInteractions(activateModifyAndSelect?: boolean) {\n    // Create Draw interaction\n    let olDrawInteraction;\n    if (!this.freehand$.getValue()) {\n      olDrawInteraction = new OlDraw({\n        type: this.olGeometryType,\n        source: this.getSource(),\n        stopClick: true,\n        style: this.options.interactionStyle,\n        maxPoints: this.options.maxPoints,\n        freehand: false,\n        freehandCondition: () => false\n      });\n\n    } else {\n      if (this.olGeometryType === 'Point') {\n        olDrawInteraction = new OlDraw({\n          type: 'Circle',\n          source: this.getSource(),\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n\n      } else {\n        olDrawInteraction = new OlDraw({\n          type: this.olGeometryType,\n          source: this.getSource(),\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n      }\n    }\n\n    // Add Draw interaction to map and create listeners\n    this.olMap.addInteraction(olDrawInteraction);\n    this.olDrawInteraction = olDrawInteraction;\n\n    this.onDrawStartKey = olDrawInteraction.on('drawstart', (event: OlDrawEvent) => this.onDrawStart(event));\n    this.onDrawEndKey = olDrawInteraction.on('drawend', (event: OlDrawEvent) => this.onDrawEnd(event));\n    this.onDrawAbortKey = olDrawInteraction.on('drawabort', (event: OlDrawEvent) => this.abort$.next(event.feature.getGeometry()));\n\n    if (activateModifyAndSelect) {\n      // Create a Modify interaction, add it to map and create a listener\n      const olModifyInteraction = new OlModify({\n        source: this.getSource()\n      });\n\n      this.olMap.addInteraction(olModifyInteraction);\n      this.olModifyInteraction = olModifyInteraction;\n\n      // Create a select interaction and add it to map\n      if (!this.olSelectInteraction) {\n        const olSelectInteraction = new OlSelect({\n          condition: doubleClick,\n          style: undefined\n        });\n        this.olMap.addInteraction(olSelectInteraction);\n        this.olSelectInteraction = olSelectInteraction;\n\n        this.olSelectInteraction.on('select', (event: OlSelectEvent) => this.onSelect(event));\n      }\n    }\n  }\n\n  /**\n   * Remove interactions\n   */\n  private removeOlInteractions() {\n    this.unsubscribeKeyDown();\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey, this.onDrawAbortKey]);\n\n    if (this.olMap) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n\n    this.olDrawInteraction = undefined;\n    this.olModifyInteraction = undefined;\n  }\n\n  /**\n   * When drawing starts, clear the overlay and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.start$.next(olGeometry);\n    this.clearOlInnerOverlaySource();\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\n      this.changes$.next(olGeometryEvent.target);\n    });\n    this.subscribeKeyDown();\n  }\n\n  /**\n   * When drawing ends, update the drawing (feature) geometry observable and add\n   * @param event Draw event (drawend)\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    this.unsubscribeKeyDown();\n    unByKey(this.onDrawKey);\n    const olGeometry = event.feature.getGeometry();\n    olGeometry.on('change', () => {\n      this.modify$.next(olGeometry);\n    });\n    this.end$.next(olGeometry);\n  }\n\n  /**\n   * When a feature is selected, update the selected feature observable\n   * @param event Modify event (modifyend)\n   */\n  private onSelect(event: OlSelectEvent) {\n    if (event.selected.length === 1) {\n      this.select$.next(event.selected[0]);\n    }\n  }\n\n  /**\n   * Subscribe to key downs used as drawing interaction shorcuts\n   */\n  private subscribeKeyDown() {\n    this.unsubscribeKeyDown();\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe((event: KeyboardEvent) => {\n      // On Escape or 'c' keydowns, abort the current drawing\n      if (event.key === 'Escape') {\n        this.olDrawInteraction.abortDrawing();\n        return;\n      }\n\n      // On Backspace or 'u' keydowns, remove last vertex of current drawing\n      if (event.key === 'Backspace') {\n        this.olDrawInteraction.removeLastPoint();\n      }\n\n      // On Enter or 'f' keydowns, finish current drawing\n      if (event.key === 'Enter') {\n        this.olDrawInteraction.finishDrawing();\n      }\n\n      // On space bar key down, pan to the current mouse position\n      if (event.key === ' ') {\n        this.olMap.getView().animate({\n          center: this.mousePosition,\n          duration: 100\n        });\n        return;\n      }\n    });\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeKeyDown() {\n    if (this.keyDown$$) {\n      this.keyDown$$.unsubscribe();\n      this.keyDown$$ = undefined;\n    }\n  }\n}\n","import { Component, Inject, Input } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nexport interface DialogData {\n  label: string;\n}\n\n@Component({\n  selector: 'igo-draw-popup-component',\n  templateUrl: './draw-popup.component.html',\n  styleUrls: ['./draw-popup.component.scss']\n})\nexport class DrawPopupComponent {\n  @Input() confirmFlag: boolean = false;\n\n  constructor(\n    public dialogRef: MatDialogRef<DrawPopupComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: { currentLabel: string }\n  ) {}\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n  confirm(labelString: string) {\n    this.confirmFlag = true;\n    this.dialogRef.close(labelString);\n  }\n}\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">\n    {{ 'igo.geo.draw.dialogInstruction' | translate }}\n  </p>\n  <mat-form-field class=\"example-full-width\">\n    <input\n      #input\n      matInput\n      placeholder=\"{{ 'igo.geo.draw.dialogTitle' | translate }}\"\n      value=\"{{ data.currentLabel }}\"/>\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button (click)=\"cancelDrawing()\">\n    {{ 'igo.geo.draw.cancel' | translate }}\n  </button>\n  <button mat-raised-button color=\"primary\" (click)=\"confirm(input.value)\">\n    OK\n  </button>\n</div>\n","import { Component } from '@angular/core';\n\n@Component({\n  selector: 'igo-draw-shorcuts',\n  templateUrl: './draw-shorcuts.component.html',\n  styleUrls: ['./draw-shorcuts.component.scss']\n})\n\nexport class DrawShorcutsComponent {}\n","<mat-dialog-content>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-return\"></mat-icon>{{'igo.geo.draw.finish' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"backspace-outline\"></mat-icon>{{'igo.geo.draw.undo' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-esc\"></mat-icon>{{'igo.geo.draw.abort' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-space\"></mat-icon>{{'igo.geo.draw.move' | translate}}</span>\n  </div>\n</mat-dialog-content>\n<mat-dialog-actions class=\"shortcuts-close\">\n  <button mat-raised-button mat-dialog-close color=\"primary\">OK</button>\n</mat-dialog-actions>","\nexport const MEASURE_UNIT_AUTO = 'auto';\n\nexport enum MeasureType {\n  Length = 'length',\n  Area = 'area'\n}\n\nexport enum MeasureLengthUnit {\n  Meters = 'meters',\n  Kilometers = 'kilometers',\n  Miles = 'miles',\n  Feet = 'feet'\n}\n\nexport const MeasureLengthUnitAbbreviation = {\n  [MeasureLengthUnit.Meters]: 'm',\n  [MeasureLengthUnit.Kilometers]: 'km',\n  [MeasureLengthUnit.Miles]: 'mi',\n  [MeasureLengthUnit.Feet]: 'ft'\n};\n\nexport enum MeasureAreaUnit {\n  SquareMeters = 'squareMeters',\n  SquareKilometers = 'squareKilometers',\n  SquareMiles = 'squareMiles',\n  SquareFeet = 'squareFeet',\n  Hectares = 'hectares',\n  Acres = 'acres'\n}\n\nexport const MeasureAreaUnitAbbreviation = {\n  [MeasureAreaUnit.SquareMeters]: 'm',\n  [MeasureAreaUnit.SquareKilometers]: 'km',\n  [MeasureAreaUnit.SquareMiles]: 'mi',\n  [MeasureAreaUnit.SquareFeet]: 'ft',\n  [MeasureAreaUnit.Hectares]: 'ha',\n  [MeasureAreaUnit.Acres]: 'ac'\n};\n","import { LanguageService } from '@igo2/core';\nimport * as olstyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport OlOverlay from 'ol/Overlay';\nimport { getCenter as olGetCenter } from 'ol/extent';\nimport {\n  getLength as olGetLength,\n  getArea as olGetArea\n} from 'ol/sphere';\n\nimport { Measure } from './measure.interfaces';\nimport {\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation\n} from './measure.enum';\n\n/**\n * Convert value from meters to kilometers\n * @param value Value in meters\n * @returns Value in kilometers\n */\nexport function metersToKilometers(value: number): number {\n  return value * 0.001;\n}\n\n/**\n * Convert value from meters to feet\n * @param value Value in meters\n * @returns Value in feet\n */\nexport function metersToFeet(value: number): number {\n  return value * 3.2808;\n}\n\n/**\n * Convert value from meters to miles\n * @param value Value in meters\n * @returns Value in miles\n */\nexport function metersToMiles(value: number): number {\n  return value * 0.000621;\n}\n\n/**\n * Convert value from square meters to square kilometers\n * @param value Value in square meters\n * @returns Value in square kilometers\n */\nexport function squareMetersToSquareKilometers(value: number): number {\n  return value * 0.000001;\n}\n\n/**\n * Convert value from square meters to square miles\n * @param value Value in square meters\n * @returns Value in square miles\n */\nexport function squareMetersToSquareMiles(value: number): number {\n  return value * 0.0000003861;\n}\n\n/**\n * Convert value from square meters to square feet\n * @param value Value in square meters\n * @returns Value in square feet\n */\nexport function squareMetersToSquareFeet(value: number): number {\n  return value * 10.764;\n}\n\n/**\n * Convert value from square meters to hectares\n * @param value Value in square meters\n * @returns Value in hectares\n */\nexport function squareMetersToHectares(value: number): number {\n  return value * 0.0001;\n}\n\n/**\n * Convert value from square meters to acres\n * @param value Value in square meters\n * @returns Value in acres\n */\nexport function squareMetersToAcres(value: number): number {\n  return value * 0.00024711;\n}\n\n/**\n * Convert value from meters to the specified length unit\n * @param value Value in meters\n * @param unit Length unit\n * @returns Value in unit\n */\nexport function metersToUnit(value: number, unit: MeasureLengthUnit): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureLengthUnit.Meters, (val: number) => val],\n    [MeasureLengthUnit.Kilometers, metersToKilometers],\n    [MeasureLengthUnit.Miles, metersToMiles],\n    [MeasureLengthUnit.Feet, metersToFeet],\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * Convert value from square meters to the specified area unit\n * @param value Value in meters\n * @param unit Area unit\n * @returns Value in unit\n */\nexport function squareMetersToUnit(value: number, unit: MeasureAreaUnit): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureAreaUnit.SquareMeters, (val: number) => val],\n    [MeasureAreaUnit.SquareKilometers, squareMetersToSquareKilometers],\n    [MeasureAreaUnit.SquareMiles, squareMetersToSquareMiles],\n    [MeasureAreaUnit.SquareFeet, squareMetersToSquareFeet],\n    [MeasureAreaUnit.Hectares, squareMetersToHectares],\n    [MeasureAreaUnit.Acres, squareMetersToAcres],\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * This method format a measure to a readable format\n * @param measure Measure\n * @param options Formatting options\n * @returns Formatted measure\n */\nexport function formatMeasure(\n  measure: number,\n  options?: {\n    decimal?: number;\n    unit?: MeasureAreaUnit | MeasureLengthUnit;\n    unitAbbr?: boolean;\n    locale?: string;\n  },\n  languageService?: LanguageService) {\n  let decimal = options.decimal;\n  if (decimal === undefined || decimal < 0) {\n    decimal = 1;\n  }\n\n  const parts = [];\n  if (options.locale !== undefined) {\n    parts.push(measure.toLocaleString(options.locale, {\n      minimumFractionDigits: decimal,\n      maximumFractionDigits: decimal\n    }));\n  } else {\n    parts.push(measure.toFixed(decimal).toString());\n  }\n\n  if (options.unit !== undefined && options.unitAbbr === true) {\n    if (languageService) {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit] ?\n          languageService.translate.instant('igo.geo.measure.' + MeasureLengthUnitAbbreviation[options.unit]) :\n          languageService.translate.instant('igo.geo.measure.' + MeasureAreaUnitAbbreviation[options.unit])\n      );\n    } else {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit] || MeasureAreaUnitAbbreviation[options.unit]\n      );\n    }\n  }\n\n  return parts.filter(p => p !== undefined).join(' ');\n}\n\n/**\n * Compute best length measure unit for a given measure in meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestLengthUnit(value: number): MeasureLengthUnit {\n  let unit = MeasureLengthUnit.Meters;\n  let converted = value;\n  const possibleUnits = [MeasureLengthUnit.Kilometers];\n  while (converted > 1000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = metersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Compute best length measure unit for a given measure in square meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestAreaUnit(value: number): MeasureAreaUnit {\n  let unit = MeasureAreaUnit.SquareMeters;\n  let converted = value;\n  const possibleUnits = [MeasureAreaUnit.SquareKilometers];\n  while (converted > 1000000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = squareMetersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Create a default style for a measure interaction\n * @returns OL style\n */\nexport function createMeasureInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      lineDash: [10, 10],\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    }),\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke: new olstyle.Stroke({\n        color: '#ffcc33',\n      }),\n      fill: new olstyle.Fill({\n        color: 'rgba(255, 255, 255, 0.2)'\n      })\n    })\n  });\n}\n\n/**\n * Create a default style for a measure layer\n * @returns OL style\n */\nexport function createMeasureLayerStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    })\n  });\n}\n\n/**\n * Compute the length in meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Length in meters\n */\nexport function measureOlGeometryLength(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): number | undefined {\n  if (olGeometry instanceof OlPoint) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetLength(olGeometry, {projection});\n}\n\n/**\n * Compute the area in square meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Area in square meters\n */\nexport function measureOlGeometryArea(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): number | undefined {\n  if (olGeometry instanceof OlPoint || olGeometry instanceof OlLineString) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetArea(olGeometry, {projection});\n}\n\n/**\n * Compute the area (square meters), length (meters) and last length (meters)\n * of an OL geometry with a given projection.\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Computed measure\n */\nexport function measureOlGeometry(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): Measure {\n  const length = measureOlGeometryLength(olGeometry, projection);\n  const area = measureOlGeometryArea(olGeometry, projection);\n\n  const lengths = [];\n  const coordinates = olGeometry.getFlatCoordinates();\n  const coordinatesLength = coordinates.length;\n  for (let i = 0; i <= coordinatesLength - 4; i += 2) {\n    const olSegment = new OlLineString([\n      [coordinates[i], coordinates[i + 1]],\n      [coordinates[i + 2], coordinates[i + 3]]\n    ]);\n\n    lengths.push(measureOlGeometryLength(olSegment, projection));\n  }\n\n  return {\n    area,\n    length,\n    lengths\n  };\n}\n\n/**\n * Update an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nexport function updateOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n  } else {\n    olMidpoints = getOlGeometryMidpoints(olGeometry);\n    // TODO: handle multi geometries\n    const coordinates = olGeometry.getFlatCoordinates();\n    const midpointsLength = olMidpoints.length;\n    for (let i = 0; i < midpointsLength; i++) {\n      const j = i * 2;\n      const olSegment = new OlLineString([\n        [coordinates[j], coordinates[j + 1]],\n        [coordinates[j + 2], coordinates[j + 3]]\n      ]);\n\n      const midpointCoordinate = olSegment.getCoordinateAt(0.5);\n      const olMidpoint = olMidpoints[i];\n      if (olMidpoint !== undefined) {\n        olMidpoint.setCoordinates(midpointCoordinate);\n      } else {\n        olMidpoints[i] = new OlPoint(midpointCoordinate);\n      }\n    }\n  }\n  return olMidpoints;\n}\n\n/**\n * Clear an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n */\nexport function clearOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle) {\n  const olMidpoints = olGeometry.get('_midpoints') || [];\n  const midpointsLength = olMidpoints.length;\n  for (let i = 0; i < midpointsLength; i++) {\n    const olMidpoint = olMidpoints[i];\n    if (olMidpoint !== undefined) {\n      if (olMidpoint !== undefined) {\n        clearOlMidpointTooltip(olMidpoint);\n      }\n    }\n  }\n\n  olGeometry.set('_midpoints', undefined, true);\n\n  return olMidpoints;\n}\n\n/**\n * Return an array of  OL geometry midpoints, if any\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nfunction getOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint[] {\n  let expectedNumber;\n  if (olGeometry instanceof OlCircle) {\n    expectedNumber = 0;\n  } else {\n    expectedNumber = Math.max((olGeometry.getFlatCoordinates().length / 2) - 1, 0);\n  }\n  // TODO: This works but it's quite messy. If time permits,\n  // clean this. Maybe a Tooltip class could handle that\n  let olMidpoints = olGeometry.get('_midpoints');\n\n  if (olMidpoints === undefined) {\n    if (olGeometry instanceof OlPoint) {\n      olMidpoints = new Array(1);\n    } else {\n      olMidpoints = new Array(expectedNumber);\n    }\n    olGeometry.set('_midpoints', olMidpoints, true);\n    return olMidpoints;\n  }\n\n  if (expectedNumber === 0) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber === olMidpoints.length) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber > olMidpoints.length) {\n    olMidpoints.push(...new Array(expectedNumber - olMidpoints.length));\n    return olMidpoints;\n  }\n\n  for (let i = expectedNumber; i < olMidpoints.length; i++) {\n    const olMidpoint = olMidpoints[expectedNumber];\n    if (olMidpoint !== undefined) {\n      clearOlMidpointTooltip(olMidpoint);\n    }\n  }\n  olMidpoints.splice(expectedNumber);\n\n  return olMidpoints;\n}\n\n/**\n * Remove an OL midpoint's tooltip from the map\n * @param olMidpoint OL Point\n */\nfunction clearOlMidpointTooltip(olMidpoint: OlPoint) {\n  const olTooltip = olMidpoint.get('_tooltip');\n  if (olTooltip !== undefined) {\n    const olMap = olTooltip.getMap();\n    if (olMap !== undefined) {\n      olMap.removeOverlay(olTooltip);\n    }\n  }\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  let typeGeom = '';\n  if (olGeometry instanceof OlLineString) {\n  typeGeom = 'line-';\n  } else if (olGeometry instanceof OlPolygon) {\n    typeGeom = 'polygone-';\n    }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipAtPoint(olMidpoint, false, typeGeom);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipsAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olMidpoints = getOlGeometryMidpoints(olGeometry);\n  return olMidpoints.map((olMidpoint: OlPoint) => {\n    return olMidpoint ? olMidpoint.get('_tooltip') : undefined;\n  });\n}\n\n/**\n * Update an OL geometry center and return it\n * @param olGeometry OL Geometry\n * @returns OL point\n */\nexport function updateOlGeometryCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint {\n  let olCenter = olGeometry.get('_center');\n  const centerCoordinate = olGetCenter(olGeometry.getExtent());\n  if (olCenter !== undefined) {\n    olCenter.setCoordinates(centerCoordinate);\n  } else {\n    olCenter = new OlPoint(centerCoordinate);\n    olGeometry.set('_center', olCenter);\n  }\n\n  return olCenter;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipAtCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipAtPoint(olCenter, true);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipAtCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay {\n  const olCenter = olGeometry.get('_center');\n  return olCenter ? olCenter.get('_tooltip') : undefined;\n}\n\n/**\n * Get all the tooltips of an OL geometry\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getTooltipsOfOlGeometry(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olTooltips = [].concat(getOlTooltipsAtMidpoints(olGeometry) || []);\n  const olCenterTooltip = getOlTooltipAtCenter(olGeometry);\n  if (olCenterTooltip !== undefined) {\n    olTooltips.push(olCenterTooltip);\n  }\n  return olTooltips;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipAtPoint(olPoint: OlPoint, center: boolean = false, srcGeomType: string= ''): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: (center ?\n    [ 'igo-map-tooltip',\n      'igo-map-tooltip-measure', 'igo-map-tooltip-measure-area'] : ['igo-map-tooltip', 'igo-map-tooltip-measure',\n      `igo-map-tooltip-measure-${srcGeomType}segments`]).join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n","import * as Olstyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport OlOverlay from 'ol/Overlay';\nimport {\n  updateOlGeometryMidpoints,\n  updateOlGeometryCenter\n} from '../../measure/shared/measure.utils';\n\n\n/**\n * Create a default style\n * @param fillColor the fill color\n * @param strokeColor the stroke color\n * @param strokeWidth the stroke width\n * @param label a label\n * @returns OL style\n */\nexport function createInteractionStyle(fillColor?: string, strokeColor?: string, strokeWidth?: number, label?: string): Olstyle.Style {\n  return new Olstyle.Style({\n    stroke: new Olstyle.Stroke({\n      color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n      width: strokeWidth ? strokeWidth : 1\n    }),\n    fill: new Olstyle.Fill({\n      color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n    }),\n    image: new Olstyle.Circle({\n      radius: 5,\n      stroke: new Olstyle.Stroke({\n        color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n        width: strokeWidth ? strokeWidth : 1\n      }),\n      fill: new Olstyle.Fill({\n        color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n      })\n    })\n  });\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsDrawAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({_midpoints: olMidpoints}, true);\n  } else if (olGeometry instanceof OlCircle) {\n    const olMidpointPoint = new OlPoint(olGeometry.getCenter());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({_midpoints: olMidpoints}, true);\n  } else {\n    olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipDrawAtPoint(olMidpoint);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipDrawAtCenter(olGeometry: OlLineString | OlPolygon): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipDrawAtPoint(olCenter);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipDrawAtPoint(olPoint: OlPoint): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: [\n      'igo-map-tooltip',\n      'igo-map-tooltip-draw'\n    ].join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n","import { Injectable } from '@angular/core';\n\nimport * as OlStyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport { transform } from 'ol/proj';\nimport { MapService } from '../../map/shared/map.service';\nimport { FontType } from './draw.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DrawStyleService {\n  private fillColor = 'rgba(255,255,255,0.4)';\n  private strokeColor = 'rgba(143,7,7,1)';\n  private strokeWidth: number = 1;\n  private labelsAreShown = true;\n  private icon: string;\n  private fontSize: string = '20';\n  private fontStyle: string = FontType.Arial.toString();\n\n  constructor(private mapService: MapService) {}\n\n  getFillColor(): string {\n    return this.fillColor;\n  }\n\n  setFillColor(fillColor: string) {\n    this.fillColor = fillColor;\n  }\n\n  getStrokeColor(): string {\n    return this.strokeColor;\n  }\n\n  setStrokeColor(strokeColor: string) {\n    this.strokeColor = strokeColor;\n  }\n\n  getStrokeWidth(): number {\n    return this.strokeWidth;\n  }\n\n  getLabelsAreShown() {\n    return this.labelsAreShown;\n  }\n\n  toggleLabelsAreShown() {\n    this.labelsAreShown = !this.labelsAreShown;\n  }\n\n  setIcon(icon: string) {\n    this.icon = icon;\n  }\n\n  getIcon() {\n    return this.icon;\n  }\n\n  // To edit the label of drawing\n  getFontSize() {\n    return this.fontSize;\n  }\n\n  setFontSize(fontSize: string) {\n    this.fontSize = fontSize;\n  }\n\n  getFontStyle() {\n    return this.fontStyle;\n  }\n\n  setFontStyle(fontStyle: string) {\n    this.fontStyle = fontStyle;\n  }\n\n  createDrawingLayerStyle(\n    feature,\n    resolution,\n    labelsAreShown?: boolean,\n    icon?: string\n  ): OlStyle.Style {\n    let style;\n    let labelsAreOffset: boolean = false;\n    const proj = this.mapService.getMap().projection;\n    const geom = feature.getGeometry();\n    const fontSizeAndStyle = `${this.fontSize}px ${this.fontStyle}`;\n\n    if (geom instanceof OlPoint) {\n      labelsAreOffset = !labelsAreOffset;\n    }\n\n    // if feature is a circle\n    if (feature.get('rad')) {\n      const coordinates = transform(\n        feature.getGeometry().flatCoordinates,\n        proj,\n        'EPSG:4326'\n      );\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: fontSizeAndStyle,\n          overflow: true\n        }),\n        image: new OlStyle.Circle({\n          radius:\n            feature.get('rad') /\n            Math.cos((Math.PI / 180) * coordinates[1]) /\n            resolution,\n          stroke: new OlStyle.Stroke({\n            color: this.strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: this.fillColor\n          })\n        })\n      });\n      return style;\n      // if feature is an icon\n    } else if (icon) {\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          offsetY: -26,\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: fontSizeAndStyle,\n          overflow: true\n        }),\n        stroke: new OlStyle.Stroke({\n          color: this.strokeColor,\n          width: this.strokeWidth\n        }),\n        fill: new OlStyle.Fill({\n          color: this.fillColor\n        }),\n        image: new OlStyle.Icon({\n          src: icon\n        })\n      });\n      return style;\n      // if feature is a point, a linestring or a polygon\n    } else {\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: fontSizeAndStyle,\n          overflow: true,\n          offsetY: labelsAreOffset ? -15 : 0\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: this.strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill: new OlStyle.Fill({\n          color: this.fillColor\n        }),\n\n        image: new OlStyle.Circle({\n          radius: 5,\n          stroke: new OlStyle.Stroke({\n            color: this.strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: this.fillColor\n          })\n        })\n      });\n      return style;\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\n\n@Injectable({\n    providedIn: 'root'\n  })\nexport class DrawIconService {\n\n    protected icons: Array<string>;\n\n    constructor(\n      protected config: ConfigService\n    ) {\n        this.getIconsList();\n    }\n\n    getIcons() {\n        return this.icons;\n    }\n\n    getPath(): any {\n      return this.config.getConfig('drawingTool.icons') || [];\n    }\n\n    getIconsList() {\n      this.icons = this.getPath();\n    }\n}\n","<div>\n  <div class=\"geometry-type-toggle mat-typography\">\n    <mat-button-toggle-group (change)=\"onGeometryTypeChange($event.value)\" [value]=\"geometryType.Point\">\n\n      <mat-button-toggle [value]=\"geometryType.Point\">\n        {{ 'igo.geo.draw.' + geometryType.Point | translate }}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.LineString\">\n        {{ 'igo.geo.draw.' + geometryType.LineString | translate }}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Polygon\">\n        {{ 'igo.geo.draw.' + geometryType.Polygon | translate }}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Circle\">\n        {{ 'igo.geo.draw.' + geometryType.Circle | translate }}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"draw-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\">\n      {{ 'igo.geo.spatialFilter.drawControl' | translate }}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      [checked]=\"labelsAreShown\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleLabels()\">\n      {{ 'igo.geo.draw.toggleMapTooltips' | translate }}\n    </mat-slide-toggle>\n  </div>\n\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <div class=\"fill-color-picker mat-typography\">\n      <span>\n        <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square\"></mat-icon>\n        {{ 'igo.geo.draw.fill' | translate }}\n      </span>\n\n      <mat-form-field\n        class=\"fill-field\"\n        appearance=\"outline\"\n        floatLabel=\"always\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.draw.colorPicker' | translate\">\n        <mat-label>{{ fillColor }}</mat-label>\n\n        <input\n          formControlName=\"fill\"\n          matInput\n          type=\"text\"\n          [(colorPicker)]=\"fillColor\"\n          [style.background]=\"fillColor\"\n          [readonly]=\"true\"\n          [colorPicker]=\"fillColor\"\n          [cpWidth]=\"'200px'\"\n          [cpOutputFormat]=\"'rgba'\"\n          [cpPosition]=\"'bottom'\"\n          [cpPositionOffset]=\"'-75%'\"\n          [cpCancelButton]=\"true\"\n          [cpCancelButtonText]=\"'igo.geo.draw.cancel' | translate\"\n          [cpOKButton]=\"true\"\n          (colorPickerChange)=\"onColorChange(labelsAreShown, false)\"/>\n      </mat-form-field>\n    </div>\n\n    <div class=\"stroke-color-picker mat-typography\">\n      <span>\n        <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square-outline\"></mat-icon>\n        {{ 'igo.geo.draw.stroke' | translate }}\n      </span>\n\n      <mat-form-field\n        class=\"stroke-field\"\n        appearance=\"outline\"\n        floatLabel=\"always\"\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.draw.colorPicker' | translate\">\n        <mat-label>{{ strokeColor }}</mat-label>\n        <input\n          formControlName=\"stroke\"\n          matInput\n          type=\"text\"\n          [(colorPicker)]=\"strokeColor\"\n          [style.background]=\"strokeColor\"\n          [readonly]=\"true\"\n          [colorPicker]=\"strokeColor\"\n          [cpWidth]=\"'200px'\"\n          [cpPosition]=\"'bottom'\"\n          [cpPositionOffset]=\"'-75%'\"\n          [cpOutputFormat]=\"'rgba'\"\n          [cpCancelButton]=\"true\"\n          [cpCancelButtonText]=\"'igo.geo.draw.cancel' | translate\"\n          [cpOKButton]=\"true\"\n          (colorPickerChange)=\"onColorChange(labelsAreShown, false)\">\n      </mat-form-field>\n    </div>\n\n    <div>\n      <mat-form-field *ngIf=\"icons.length >= 1\">\n        <mat-label>{{ 'igo.geo.draw.icon' | translate }}</mat-label>\n        <mat-select>\n          <mat-select-trigger>\n            <div *ngIf=\"icon\" class=\"box\">\n              <img src=\"{{ icon }}\">\n            </div>\n          </mat-select-trigger>\n          <mat-option value=\"\" (click)=\"onIconChange()\">{{ 'igo.geo.draw.noIcon' | translate }}</mat-option>\n          <mat-option\n            *ngFor=\"let icon_html of icons\"\n            [value]=\"icon_html\"\n            (click)=\"onIconChange(icon_html)\">\n            <div class=\"box\">\n              <img src=\"{{ icon_html }}\">\n            </div>\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </form>\n\n\n  <div class=\"igo-form-font\">\n    <mat-form-field appearance=\"outline\" class=\"igo-form-fontSize\">\n      <mat-label>{{ 'igo.geo.draw.fontSize' | translate }}</mat-label>\n      <input\n        matInput\n        #testFontSize\n        type=\"number\"\n        placeholder=\"10\"\n        min=\"10\"\n        onkeydown=\"return event.keyCode !== 69\"\n        [value]=\"fontSize\"\n        (input)=\"\n          onFontChange(\n            labelsAreShown,\n            $event.target.value,\n            testFontStyle.value\n          )\"\n      />\n      <span matSuffix>px</span>\n    </mat-form-field>\n    <mat-form-field appearance=\"outline\" class=\"igo-form-fontStyle\">\n      <mat-label>{{ 'igo.geo.draw.fontStyle' | translate }}</mat-label>\n      <mat-select\n        #testFontStyle\n        [value]=\"fontStyle\"\n        (selectionChange)=\"onFontChange(labelsAreShown, testFontSize.value, $event.value)\">\n        <mat-option\n          *ngFor=\"let fontSelect of allFontStyles\"\n          [value]=\"fontSelect\">\n          {{ fontSelect }}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <mat-divider></mat-divider>\n  <div>\n    <button\n      *ngIf=\"store.count$.getValue() > 0\"\n      class=\"deleteBtn\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.draw.delete' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      (click)=\"deleteDrawings()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <igo-entity-table\n      #table\n      class=\"table-compact\"\n      [store]=\"store\"\n      [template]=\"tableTemplate\"\n      (dblclick)=\"editLabelDrawing()\">\n    </igo-entity-table>\n  </div>\n\n  <button\n    mat-icon-button\n    color=\"accent\"\n    disableRipple=\"true\"\n    (click)=\"openShorcutsDialog()\">\n    <mat-icon\n      class=\"shortcuts-icon\"\n      svgIcon=\"keyboard-outline\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.draw.shortcuts' | translate\">\n    </mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output\n} from '@angular/core';\n\nimport {\n  FEATURE,\n  FeatureStore,\n  FeatureStoreSelectionStrategy,\n  tryBindStoreLayer,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy,\n  FeatureMotion,\n  FeatureStoreLoadingStrategy,\n  featureToOl\n} from '../../feature';\n\nimport { LanguageService } from '@igo2/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { FontType, GeometryType } from '../shared/draw.enum';\nimport { IgoMap } from '../../map/shared/map';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { Draw, FeatureWithDraw } from '../shared/draw.interface';\nimport { FormGroup, FormBuilder } from '@angular/forms';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { DrawControl } from '../../geometry/shared/controls/draw';\nimport { EntityRecord, EntityTableTemplate } from '@igo2/common';\n\nimport * as OlStyle from 'ol/style';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlCircle from 'ol/geom/Circle';\nimport OlPoint from 'ol/geom/Point';\nimport OlFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlOverlay from 'ol/Overlay';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport { default as OlGeometry } from 'ol/geom/Geometry';\nimport { getDistance } from 'ol/sphere';\nimport { DrawStyleService } from '../shared/draw-style.service';\nimport { skip } from 'rxjs/operators';\nimport { DrawPopupComponent } from './draw-popup.component';\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\nimport { getTooltipsOfOlGeometry } from '../../measure/shared/measure.utils';\nimport { createInteractionStyle } from '../shared/draw.utils';\nimport { transform } from 'ol/proj';\nimport { DrawIconService } from '../shared/draw-icon.service';\n\n@Component({\n  selector: 'igo-draw',\n  templateUrl: './draw.component.html',\n  styleUrls: ['./draw.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DrawComponent implements OnInit, OnDestroy {\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate = {\n    selection: true,\n    selectMany: true,\n    selectionCheckbox: true,\n    sort: true,\n    columns: [{\n        name: 'Drawing',\n        title: this.languageService.translate.instant('igo.geo.draw.labels'),\n        valueAccessor: (feature: FeatureWithDraw) => {\n          return feature.properties.draw;\n        }\n      }]\n  };\n\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n\n  @Output() fillColor: string;\n  @Output() strokeColor: string;\n  @Output() strokeWidth: number;\n\n  @Output() fontSize: string;\n  @Output() fontStyle: string;\n  @Input() fontType: FontType;\n\n  @Input() map: IgoMap; // Map to draw on\n\n  @Input() store: FeatureStore<FeatureWithDraw>; // Drawing store\n\n  public draw$: BehaviorSubject<Draw> = new BehaviorSubject({}); // Observable of draw\n\n  private olDrawingLayerSource = new OlVectorSource();\n  private drawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private drawSelect$$: Subscription;\n  private olDrawingLayer: VectorLayer;\n  public selectedFeatures$: BehaviorSubject<FeatureWithDraw[]> =\n    new BehaviorSubject([]);\n  public fillForm: string;\n  public strokeForm: string;\n  public drawControlIsDisabled: boolean = true;\n  public drawControlIsActive: boolean = false;\n  public labelsAreShown: boolean;\n  private subscriptions$$: Subscription[] = [];\n\n  public fontSizeForm: string;\n  public fontStyleForm: string;\n  public position: string = 'bottom';\n  public form: FormGroup;\n  public icons: Array<string>;\n  public icon: string;\n\n  constructor(\n    private languageService: LanguageService,\n    private formBuilder: FormBuilder,\n    private drawStyleService: DrawStyleService,\n    private dialog: MatDialog,\n    private drawIconService: DrawIconService\n  ) {\n    this.buildForm();\n    this.fillColor = this.drawStyleService.getFillColor();\n    this.strokeColor = this.drawStyleService.getStrokeColor();\n    this.strokeWidth = this.drawStyleService.getStrokeWidth();\n    this.labelsAreShown = this.drawStyleService.getLabelsAreShown();\n    this.icons = this.drawIconService.getIcons();\n    this.icon = this.drawStyleService.getIcon();\n\n    this.fontSize = this.drawStyleService.getFontSize();\n    this.fontStyle = this.drawStyleService.getFontStyle();\n  }\n\n  // Initialize the store that will contain the entities and create the Draw control\n  ngOnInit() {\n    this.initStore();\n    this.drawControl = this.createDrawControl(\n      this.fillColor,\n      this.strokeColor,\n      this.strokeWidth\n    );\n    this.drawControl.setGeometryType(this.geometryType.Point as any);\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Remove the drawing layer and the interactions\n   * @internal\n   */\n  ngOnDestroy() {\n    this.drawControl.setOlMap(undefined);\n    this.subscriptions$$.map((s) => s.unsubscribe());\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(\n    fillColor?: string,\n    strokeColor?: string,\n    strokeWidth?: number\n  ) {\n    const drawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.olDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(\n        fillColor,\n        strokeColor,\n        strokeWidth\n      )\n    });\n    return drawControl;\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(geometryType: typeof OlGeometryType) {\n    this.drawControl.setGeometryType(geometryType);\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Store initialization, including drawing layer creation\n   */\n  private initStore() {\n    this.map.removeLayer(this.olDrawingLayer);\n    this.olDrawingLayer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'igo-draw-layer',\n      title: this.languageService.translate.instant('igo.geo.draw.drawing'),\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: (feature, resolution) => {\n        return this.drawStyleService.createDrawingLayerStyle(\n          feature,\n          resolution,\n          this.labelsAreShown,\n          this.icon\n        );\n      },\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: {\n        enabled: false\n      }\n    });\n    tryBindStoreLayer(this.store, this.olDrawingLayer);\n    tryAddLoadingStrategy(\n      this.store,\n      new FeatureStoreLoadingStrategy({\n        motion: FeatureMotion.None\n      })\n    );\n    tryAddSelectionStrategy(\n      this.store,\n      new FeatureStoreSelectionStrategy({\n        map: this.map,\n        motion: FeatureMotion.None,\n        many: true\n      })\n    );\n    this.store.layer.visible = true;\n    this.store.source.ol.on(\n      'removefeature',\n      (event: OlVectorSourceEvent<OlGeometry>) => {\n        const olGeometry = event.feature.getGeometry();\n        this.clearLabelsOfOlGeometry(olGeometry);\n      }\n    );\n    this.subscriptions$$.push(\n      this.store.stateView\n        .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n          return record.state.selected === true;\n        })\n        .pipe(\n          skip(1) // Skip initial emission\n        )\n        .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n          this.selectedFeatures$.next(records.map((record) => record.entity));\n        })\n    );\n    this.subscriptions$$.push(\n      this.store.count$.subscribe((cnt) => {\n        cnt >= 1\n          ? (this.store.layer.options.showInLayerList = true)\n          : (this.store.layer.options.showInLayerList = false);\n      })\n    );\n  }\n\n  /**\n   * Called when the user changes the color in a color picker\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param isAnIcon wheter the feature is an icon or not\n   */\n  onColorChange(labelsAreShown: boolean, isAnIcon: boolean) {\n    this.fillForm = this.fillColor;\n    this.strokeForm = this.strokeColor;\n    this.drawStyleService.setFillColor(this.fillColor);\n    this.drawStyleService.setStrokeColor(this.strokeColor);\n\n    if (isAnIcon) {\n      this.store.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createDrawingLayerStyle(\n          feature,\n          resolution,\n          labelsAreShown,\n          this.icon\n        );\n      });\n      this.icon = undefined;\n    } else {\n      this.store.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createDrawingLayerStyle(\n          feature,\n          resolution,\n          labelsAreShown\n        );\n      });\n    }\n    this.createDrawControl();\n  }\n\n  /**\n   * Called when the user toggles the Draw control is toggled\n   * @internal\n   */\n  onToggleDrawControl(toggleIsChecked: boolean) {\n    toggleIsChecked ? this.toggleDrawControl() : this.deactivateDrawControl();\n  }\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    this.activateDrawControl();\n  }\n\n  /**\n   * Open a dialog box to enter label and do something\n   * @param olGeometry geometry at draw end or selected geometry\n   * @param drawEnd event fired at drawEnd?\n   */\n  private openDialog(olGeometryFeature, isDrawEnd: boolean) {\n    setTimeout(() => {\n      // open the dialog box used to enter label\n      const dialogRef = this.dialog.open(DrawPopupComponent, {\n        disableClose: false,\n        data: { currentLabel: olGeometryFeature.get('draw') }\n      });\n\n      // when dialog box is closed, get label and set it to geometry\n      dialogRef.afterClosed().subscribe((label: string) => {\n        // checks if the user clicked ok\n        if (dialogRef.componentInstance.confirmFlag) {\n          this.updateLabelOfOlGeometry(olGeometryFeature, label);\n          // if event was fired at draw end\n          if (isDrawEnd) {\n            this.onDrawEnd(olGeometryFeature);\n            // if event was fired at select\n          } else {\n            this.onSelectDraw(olGeometryFeature, label);\n          }\n        }\n        // deletes the feature\n        else {\n          this.olDrawingLayerSource\n            .getFeatures()\n            .forEach((drawingLayerFeature) => {\n              const geometry = drawingLayerFeature.getGeometry() as any;\n              if (olGeometryFeature === geometry) {\n                this.olDrawingLayerSource.removeFeature(drawingLayerFeature);\n              }\n            });\n        }\n      });\n    }, 250);\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl() {\n    this.drawControlIsDisabled = false;\n    this.drawControlIsActive = true;\n    this.drawEnd$$ = this.drawControl.end$.subscribe(\n      (olGeometry: OlGeometry) => {\n        this.openDialog(olGeometry, true);\n      }\n    );\n\n    this.drawControl.modify$.subscribe((olGeometry: OlGeometry) => {\n      this.onModifyDraw(olGeometry);\n    });\n\n    if (!this.drawSelect$$) {\n      this.drawSelect$$ = this.drawControl.select$.subscribe(\n        (olFeature: OlFeature<OlGeometry>) => {\n          this.openDialog(olFeature, false);\n        }\n      );\n    }\n\n    this.drawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (!this.drawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.drawControl.setOlMap(undefined);\n    this.drawControlIsActive = false;\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlGeometry, radius?: number) {\n    this.addFeatureToStore(olGeometry, radius);\n    this.clearLabelsOfOlGeometry(olGeometry);\n    this.store.layer.ol.getSource().refresh();\n  }\n\n  private onModifyDraw(olGeometry) {\n    const entities = this.store.all();\n\n    entities.forEach((entity) => {\n      const entityId = entity.properties.id;\n\n      const olGeometryId = olGeometry.ol_uid;\n\n      if (entityId === olGeometryId) {\n        this.updateLabelOfOlGeometry(olGeometry, entity.properties.draw);\n        this.replaceFeatureInStore(entity, olGeometry);\n      }\n    });\n  }\n\n  private onSelectDraw(olFeature: OlFeature<OlGeometry>, label: string) {\n    const entities = this.store.all();\n\n    const olGeometry = olFeature.getGeometry() as any;\n    olGeometry.ol_uid = olFeature.get('id');\n\n    const olGeometryCoordinates = JSON.stringify(\n      olGeometry.getCoordinates()[0]\n    );\n\n    entities.forEach((entity) => {\n      const entityCoordinates = JSON.stringify(entity.geometry.coordinates[0]);\n\n      if (olGeometryCoordinates === entityCoordinates) {\n        const rad: number = entity.properties.rad\n          ? entity.properties.rad\n          : undefined;\n        this.updateLabelOfOlGeometry(olGeometry, label);\n        this.replaceFeatureInStore(entity, olGeometry, rad);\n      }\n    });\n  }\n\n  /**\n   * Add a feature with draw label to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(\n    olGeometry,\n    radius?: number,\n    feature?: FeatureWithDraw\n  ) {\n    let rad: number;\n    let center4326: Array<number>;\n    let point4326: Array<number>;\n    let lon4326: number;\n    let lat4326: number;\n    const featureId = feature ? feature.properties.id : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n\n    if (olGeometry instanceof OlCircle || radius) {\n      if (radius) {\n        rad = radius;\n      } else {\n        geometry.type = 'Point';\n        geometry.coordinates = olGeometry.getCenter();\n        const extent4326 = transform(\n          [\n            olGeometry.getFlatCoordinates()[2],\n            olGeometry.getFlatCoordinates()[3]\n          ],\n          projection,\n          'EPSG:4326'\n        );\n        center4326 = transform(\n          [\n            olGeometry.getFlatCoordinates()[0],\n            olGeometry.getFlatCoordinates()[1]\n          ],\n          projection,\n          'EPSG:4326'\n        );\n        lon4326 = center4326[0];\n        lat4326 = center4326[1];\n        rad = getDistance(center4326, extent4326);\n      }\n    }\n\n    if (olGeometry instanceof OlPoint) {\n      point4326 = transform(\n        olGeometry.getFlatCoordinates(),\n        projection,\n        'EPSG:4326'\n      );\n      lon4326 = point4326[0];\n      lat4326 = point4326[1];\n    }\n\n    this.store.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        draw: olGeometry.get('_label'),\n        longitude: lon4326 ? lon4326 : null,\n        latitude: lat4326 ? lat4326 : null,\n        rad: rad ? rad : null\n      },\n      meta: {\n        id: featureId\n      }\n    });\n  }\n\n  /**\n   * Replace the feature in the store\n   * @param entity the entity to replace\n   * @param olGeometry the new geometry to insert in the store\n   */\n  private replaceFeatureInStore(\n    entity,\n    olGeometry: OlGeometry,\n    radius?: number\n  ) {\n    this.store.delete(entity);\n    this.onDrawEnd(olGeometry, radius);\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [''],\n      stroke: ['']\n    });\n  }\n\n  deleteDrawings() {\n    this.store.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach((selectedFeature) => {\n      this.olDrawingLayerSource.getFeatures().forEach((drawingLayerFeature) => {\n        const geometry = drawingLayerFeature.getGeometry() as any;\n        if (selectedFeature.properties.id === geometry.ol_uid) {\n          this.olDrawingLayerSource.removeFeature(drawingLayerFeature);\n        }\n      });\n    });\n  }\n\n  /**\n   * Clear the tooltips of an OL geometry\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearLabelsOfOlGeometry(olGeometry) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (olTooltip && olTooltip.getMap()) {\n          this.map.ol.removeOverlay(olTooltip);\n        }\n      }\n    );\n  }\n\n  /**\n   * Called when the user toggles the labels toggle\n   */\n  onToggleLabels() {\n    this.drawStyleService.toggleLabelsAreShown();\n    this.labelsAreShown = !this.labelsAreShown;\n    this.icon\n      ? this.onColorChange(this.labelsAreShown, true)\n      : this.onColorChange(this.labelsAreShown, false);\n  }\n\n  /**\n   * Update the label of a geometry when a label is entered in a dialog box\n   * @param olGeometry the geometry\n   * @param label the label\n   */\n  private updateLabelOfOlGeometry(olGeometry: OlGeometry, label: string) {\n    olGeometry.setProperties(\n      {\n        _label: label\n      },\n      true\n    );\n  }\n\n  onIconChange(event?) {\n    this.icon = event;\n    this.drawStyleService.setIcon(this.icon);\n    this.store.layer.ol.setStyle((feature, resolution) => {\n      return this.drawStyleService.createDrawingLayerStyle(\n        feature,\n        resolution,\n        true,\n        this.icon\n      );\n    });\n  }\n\n  openShorcutsDialog() {\n    this.dialog.open(DrawShorcutsComponent);\n  }\n\n  /**\n   * Called when the user double-clicks the selected drawing\n   */\n  editLabelDrawing() {\n    const olGeometry = featureToOl(\n      this.selectedFeatures$.value[0],\n      this.map.ol.getView().getProjection().getCode()\n    );\n    this.openDialog(olGeometry, false);\n  }\n\n  /**\n   * Called when the user changes the font size or/and style\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param size the size of the font\n   * @param style the style of the font\n   */\n\n  onFontChange(labelsAreShown: boolean, size: string, style: FontType) {\n    this.drawStyleService.setFontSize(size);\n    this.drawStyleService.setFontStyle(style);\n\n    this.store.layer.ol.setStyle((feature, resolution) => {\n      return this.drawStyleService.createDrawingLayerStyle(\n        feature,\n        resolution,\n        labelsAreShown\n      );\n    });\n    this.createDrawControl();\n  }\n\n  get allFontStyles(): string[] {\n    return Object.values(FontType);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { ColorPickerModule } from 'ngx-color-picker';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoEntityTableModule } from '@igo2/common';\nimport { DrawComponent } from './draw.component';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { DrawPopupComponent } from './draw-popup.component';\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatListModule,\n    MatSelectModule,\n    MatSlideToggleModule,\n    MatDialogModule,\n    IgoLanguageModule,\n    IgoEntityTableModule,\n    ColorPickerModule\n  ],\n  declarations: [\n    DrawComponent,\n    DrawPopupComponent,\n    DrawShorcutsComponent\n  ],\n  exports: [\n    DrawComponent\n  ]\n})\nexport class IgoDrawModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule, IgoImageModule } from '@igo2/common';\n\nimport { FeatureDetailsComponent } from './feature-details.component';\nimport { FeatureDetailsDirective } from './feature-details.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    IgoLanguageModule,\n    IgoKeyValueModule,\n    IgoImageModule\n  ],\n  exports: [\n    FeatureDetailsComponent,\n    FeatureDetailsDirective],\n  declarations: [\n    FeatureDetailsComponent,\n    FeatureDetailsDirective]\n})\nexport class IgoFeatureDetailsModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFormModule } from '@igo2/common';\n\nimport { FeatureFormComponent } from './feature-form.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoFormModule\n  ],\n  exports: [\n    IgoFormModule,\n    FeatureFormComponent\n  ],\n  declarations: [\n    FeatureFormComponent\n  ]\n})\nexport class IgoFeatureFormModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFeatureDetailsModule } from './feature-details/feature-details.module';\nimport { IgoFeatureFormModule } from './feature-form/feature-form.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoFeatureDetailsModule,\n    IgoFeatureFormModule\n  ],\n  declarations: [],\n  providers: []\n})\nexport class IgoFeatureModule {}\n","import OlMap from 'ol/Map';\nimport OlFeature from 'ol/Feature';\nimport * as OlStyle from 'ol/style';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlModify from 'ol/interaction/Modify';\nimport OlTranslate from 'ol/interaction/Translate';\nimport OlDraw from 'ol/interaction/Draw';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlLineString from 'ol/geom/LineString';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlInteraction from 'ol/interaction/Interaction';\nimport OlDragBoxInteraction from 'ol/interaction/DragBox';\nimport MapBrowserEvent from 'ol/MapBrowserEvent';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport BasicEvent from 'ol/events/Event';\nimport { ModifyEvent as OlModifyEvent } from 'ol/interaction/Modify';\nimport { TranslateEvent as OlTranslateEvent } from 'ol/interaction/Translate';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport { unByKey } from 'ol/Observable';\n\nimport { Subject, Subscription, fromEvent } from 'rxjs';\n\nimport {\n  addLinearRingToOlPolygon,\n  createDrawHoleInteractionStyle,\n  getMousePositionFromOlGeometryEvent\n} from '../geometry.utils';\n\nexport interface ModifyControlOptions {\n  source?: OlVectorSource<any>;\n  layer?: OlVectorLayer<any>;\n  layerStyle?: OlStyleLike;\n  drawStyle?: OlStyleLike;\n  modify?: boolean;\n  translate?: boolean;\n}\n\n/**\n * Control to modify geometries\n */\nexport class ModifyControl {\n  /**\n   * Modify start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Modify end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Geometry changes observable\n   */\n  public changes$: Subject<OlGeometry> = new Subject();\n\n  private olMap: OlMap;\n  private olOverlayLayer: OlVectorLayer<any>;\n  public olModifyInteraction: OlModify;\n  private onModifyStartKey: any;\n  private onModifyEndKey: any;\n  private onModifyKey: any;\n  private olModifyInteractionIsActive: boolean = false;\n  private olTranslateInteraction: OlTranslate;\n  private onTranslateStartKey: any;\n  private onTranslateEndKey: any;\n  private onTranslateKey: any;\n  private olTranslateInteractionIsActive: boolean = false;\n  private olDrawInteraction: OlDraw;\n  private onDrawStartKey: any;\n  private onDrawEndKey: any;\n  private onDrawKey: any;\n  private olDrawInteractionIsActive: boolean = false;\n\n  private mousePosition: [number, number];\n\n  private keyDown$$: Subscription;\n  private drawKeyUp$$: Subscription;\n  private drawKeyDown$$: Subscription;\n\n  private removedOlInteractions: OlInteraction[] = [];\n  private olLinearRingsLayer: OlVectorLayer<any>;\n\n  // This is the geometry to test against when drawing holes\n  private olOuterGeometry: OlGeometry;\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<any> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  /**\n   * OL linear rings source\n   * @internal\n   */\n  get olLinearRingsSource(): OlVectorSource<any> {\n    return this.olLinearRingsLayer.getSource();\n  }\n\n  /**\n   * Whether a modify control should be available\n   */\n  private modify: boolean = true;\n\n  /**\n   * Whether a translate control should be available\n   */\n  private translate: boolean = true;\n\n  constructor(private options: ModifyControlOptions) {\n    if (options.modify !== undefined) {\n      this.modify = options.modify;\n    }\n    if (options.translate !== undefined) {\n      this.translate = options.translate;\n    }\n\n    if (options.layer !== undefined) {\n      this.olOverlayLayer = options.layer;\n    } else {\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\n    }\n    this.olLinearRingsLayer = this.createOlLinearRingsLayer();\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap === undefined) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlModifyInteraction();\n      this.removeOlTranslateInteraction();\n      this.removeOlDrawInteraction();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n\n    // The order in which these interactions\n    // are added is important\n    if (this.modify === true) {\n      this.addOlDrawInteraction();\n    }\n\n    if (this.translate === true) {\n      this.addOlTranslateInteraction();\n      this.activateTranslateInteraction();\n    }\n\n    if (this.modify === true) {\n      this.addOlModifyInteraction();\n      this.activateModifyInteraction();\n    }\n  }\n\n  /**\n   * Return the overlay source\n   */\n  getSource(): OlVectorSource<any> {\n    return this.olOverlaySource;\n  }\n\n  /**\n   * Add an OL geometry to the overlay and start modifying it\n   * @param olGeometry Ol Geometry\n   */\n  setOlGeometry(olGeometry: OlGeometry) {\n    const olFeature = new OlFeature({ geometry: olGeometry });\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create an overlay source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: this.options.source ? this.options.source : new OlVectorSource(),\n      style: this.options.layerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the overlay layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (this.options.layer === undefined) {\n      this.olMap.addLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (this.options.layer === undefined && this.olMap !== undefined) {\n      this.olMap.removeLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (this.options.layer === undefined && this.options.source === undefined) {\n      this.olOverlaySource.clear(true);\n    }\n  }\n\n  private createOlLinearRingsLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: new OlVectorSource(),\n      style: createDrawHoleInteractionStyle(),\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the linear rings layer\n   */\n  private addOlLinearRingsLayer() {\n    this.olMap.addLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings layer\n   */\n  private removeOlLinearRingsLayer() {\n    this.olMap.removeLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings source\n   */\n  private clearOlLinearRingsSource() {\n    this.olLinearRingsSource.clear(true);\n  }\n\n  /**\n   * Add a modify interaction to the map an set up some listeners\n   */\n  private addOlModifyInteraction() {\n    const olModifyInteraction = new OlModify({\n      source: this.olOverlaySource,\n      style: this.options.drawStyle as OlStyle.Style\n    });\n    this.olModifyInteraction = olModifyInteraction;\n  }\n\n  /**\n   * Remove the modify interaction\n   */\n  private removeOlModifyInteraction() {\n    if (this.olModifyInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateModifyInteraction();\n    this.olModifyInteraction = undefined;\n  }\n\n  private activateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === true) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = true;\n    this.onModifyStartKey = this.olModifyInteraction.on(\n      'modifystart',\n      (event: OlModifyEvent) => this.onModifyStart(event)\n    );\n    this.onModifyEndKey = this.olModifyInteraction.on(\n      'modifyend',\n      (event: OlModifyEvent) => this.onModifyEnd(event)\n    );\n    this.olMap.addInteraction(this.olModifyInteraction);\n  }\n\n  private deactivateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === false) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = false;\n\n    unByKey([this.onModifyStartKey, this.onModifyEndKey, this.onModifyKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n  }\n\n  /**\n   * When modifying starts, clear the overlay and start watching for changes\n   * @param event Modify start event\n   */\n  private onModifyStart(event: OlModifyEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onModifyKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        this.mousePosition = getMousePositionFromOlGeometryEvent(\n          olGeometryEvent\n        );\n        this.changes$.next(olGeometryEvent.target as OlLineString | OlCircle | OlPolygon);\n      }\n    );\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When modifying ends, update the geometry observable and stop watching for changes\n   * @param event Modify end event\n   */\n  private onModifyEnd(event: OlModifyEvent) {\n    unByKey(this.onModifyKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Subscribe to space key down to pan the map\n   */\n  private subscribeToKeyDown() {\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key === ' ') {\n          // On space bar, pan to the current mouse position\n          this.olMap.getView().animate({\n            center: this.mousePosition,\n            duration: 0\n          });\n          return;\n        }\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeToKeyDown() {\n    if (this.keyDown$$ !== undefined) {\n      this.keyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a translate interaction to the map an set up some listeners\n   */\n  private addOlTranslateInteraction() {\n    const olTranslateInteraction = new OlTranslate({\n      layers: [this.olOverlayLayer]\n    });\n    this.olTranslateInteraction = olTranslateInteraction;\n  }\n\n  /**\n   * Remove the translate interaction\n   */\n  private removeOlTranslateInteraction() {\n    if (this.olTranslateInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateTranslateInteraction();\n    this.olTranslateInteraction = undefined;\n  }\n\n  private activateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === true) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = true;\n    this.onTranslateStartKey = this.olTranslateInteraction.on(\n      'translatestart',\n      (event: OlTranslateEvent) => this.onTranslateStart(event)\n    );\n    this.onTranslateEndKey = this.olTranslateInteraction.on(\n      'translateend',\n      (event: OlTranslateEvent) => this.onTranslateEnd(event)\n    );\n    this.olMap.addInteraction(this.olTranslateInteraction);\n  }\n\n  private deactivateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === false) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = false;\n    unByKey([\n      this.onTranslateStartKey,\n      this.onTranslateEndKey,\n      this.onTranslateKey\n    ]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olTranslateInteraction);\n    }\n  }\n\n  /**\n   * When translation starts, clear the overlay and start watching for changes\n   * @param event Translate start event\n   */\n  private onTranslateStart(event: OlTranslateEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onTranslateKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        // this.changes$.next(olGeometryEvent.target);\n      }\n    );\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Translate end event\n   */\n  private onTranslateEnd(event: OlTranslateEvent) {\n    unByKey(this.onTranslateKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n  }\n\n  /**\n   * Add a draw interaction to the map an set up some listeners\n   */\n  private addOlDrawInteraction() {\n    const olDrawInteraction = new OlDraw({\n      type: 'Polygon',\n      source: this.olLinearRingsSource,\n      stopClick: true,\n      style: createDrawHoleInteractionStyle(),\n      condition: (event: MapBrowserEvent<any>) => {\n        const olOuterGeometry = this.olOuterGeometry || this.getOlGeometry();\n        const intersects = olOuterGeometry.intersectsCoordinate(\n          event.coordinate\n        );\n        return intersects;\n      }\n    });\n\n    this.olDrawInteraction = olDrawInteraction;\n    this.subscribeToDrawKeyDown();\n  }\n\n  /**\n   * Subscribe to CTRL key down to activate the draw control\n   */\n  private subscribeToDrawKeyDown() {\n    this.drawKeyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyDown();\n\n        const olGeometry = this.getOlGeometry();\n        if (!olGeometry || !(olGeometry instanceof OlPolygon)) {\n          return;\n        }\n\n        this.subscribeToDrawKeyUp();\n\n        this.deactivateModifyInteraction();\n        this.deactivateTranslateInteraction();\n        this.activateDrawInteraction();\n      }\n    );\n  }\n\n  /**\n   * Subscribe to CTRL key up to deactivate the draw control\n   */\n  private subscribeToDrawKeyUp() {\n    this.drawKeyUp$$ = fromEvent(document, 'keyup').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyUp();\n        this.unsubscribeToKeyDown();\n        this.deactivateDrawInteraction();\n\n        this.activateModifyInteraction();\n        if (this.translate === true) {\n          this.activateTranslateInteraction();\n        }\n        this.subscribeToDrawKeyDown();\n\n        this.olOuterGeometry = undefined;\n        this.clearOlLinearRingsSource();\n        this.end$.next(this.getOlGeometry());\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to draw key down\n   */\n  private unsubscribeToDrawKeyDown() {\n    if (this.drawKeyDown$$ !== undefined) {\n      this.drawKeyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Unsubscribe to key up\n   */\n  private unsubscribeToDrawKeyUp() {\n    if (this.drawKeyUp$$ !== undefined) {\n      this.drawKeyUp$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Remove the draw interaction\n   */\n  private removeOlDrawInteraction() {\n    if (this.olDrawInteraction === undefined) {\n      return;\n    }\n\n    this.unsubscribeToKeyDown();\n    this.unsubscribeToDrawKeyUp();\n    this.unsubscribeToDrawKeyDown();\n    this.deactivateDrawInteraction();\n    this.clearOlLinearRingsSource();\n    this.olDrawInteraction = undefined;\n  }\n\n  /**\n   * Activate the draw interaction\n   */\n  private activateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === true) {\n      return;\n    }\n\n    this.clearOlLinearRingsSource();\n    this.addOlLinearRingsLayer();\n\n    this.olMap.getInteractions().forEach((olInteraction: OlInteraction) => {\n      if (olInteraction instanceof OlDragBoxInteraction) {\n        this.olMap.removeInteraction(olInteraction);\n        this.removedOlInteractions.push(olInteraction);\n      }\n    });\n\n    this.olDrawInteractionIsActive = true;\n    this.onDrawStartKey = this.olDrawInteraction.on(\n      'drawstart',\n      (event: OlDrawEvent) => this.onDrawStart(event)\n    );\n    this.onDrawEndKey = this.olDrawInteraction.on(\n      'drawend',\n      (event: OlDrawEvent) => this.onDrawEnd(event)\n    );\n    this.olMap.addInteraction(this.olDrawInteraction);\n  }\n\n  /**\n   * Deactivate the draw interaction\n   */\n  private deactivateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === false) {\n      return;\n    }\n\n    this.removeOlLinearRingsLayer();\n\n    this.removedOlInteractions.forEach((olInteraction: OlInteraction) => {\n      this.olMap.addInteraction(olInteraction);\n    });\n    this.removedOlInteractions = [];\n\n    this.olDrawInteractionIsActive = false;\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n    }\n  }\n\n  /**\n   * When draw start, add a new linerar ring to the geometry and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.olOuterGeometry = this.getOlGeometry().clone();\n\n    const linearRingCoordinates = olGeometry.getLinearRing().getCoordinates();\n    this.addLinearRingToOlGeometry(linearRingCoordinates);\n    this.start$.next(this.getOlGeometry());\n\n    this.onDrawKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        this.mousePosition = getMousePositionFromOlGeometryEvent(\n          olGeometryEvent\n        );\n        const olGeometryTarget = olGeometryEvent.target as OlPolygon;\n        const _linearRingCoordinates = olGeometryTarget\n          .getLinearRing(0)\n          .getCoordinates();\n        this.updateLinearRingOfOlGeometry(_linearRingCoordinates);\n        this.changes$.next(this.getOlGeometry());\n      }\n    );\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Draw end event\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    unByKey(this.onDrawKey);\n    this.olOuterGeometry = undefined;\n\n    const linearRingCoordinates = event.feature\n      .getGeometry()\n      .getLinearRing()\n      .getCoordinates();\n    this.updateLinearRingOfOlGeometry(linearRingCoordinates);\n    this.clearOlLinearRingsSource();\n    this.end$.next(this.getOlGeometry());\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Add a linear ring to the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private addLinearRingToOlGeometry(coordinates: number[]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    const olLinearRing = new OlLinearRing(coordinates);\n    addLinearRingToOlPolygon(olGeometry, olLinearRing);\n  }\n\n  /**\n   * Update the last linear ring of the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private updateLinearRingOfOlGeometry(coordinates: number[][]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    // Remove the last linear ring (the one we are updating)\n    const olLinearRings = olGeometry.getLinearRings().slice(0, -1);\n    const newCoordinates = olLinearRings.map((olLinearRing: OlLinearRing) => {\n      return olLinearRing.getCoordinates();\n    });\n    newCoordinates.push(coordinates);\n    olGeometry.setCoordinates(newCoordinates);\n  }\n\n  /**\n   * Get the geometry being modified\n   * @returns OL Geometry\n   */\n  private getOlGeometry(): OlGeometry {\n    const olFeatures = this.olOverlaySource.getFeatures();\n    return olFeatures.length > 0 ? olFeatures[0].getGeometry() : undefined;\n  }\n}\n","export const LAYER = 'Layer';\n","<h3 mat-dialog-title>{{'igo.geo.measure.dialog.title' | translate}}</h3>\n\n<table *ngIf=\"data.length > 0\"\n  class=\"mat-typography\">\n  <thead>\n    <tr>\n      <th colspan=\"2\">{{'igo.geo.measure.dialog.length.title' | translate}}</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Meters}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInMeters' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Kilometers}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInKilometers' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Miles}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInMiles' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Feet}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInFeet' | translate}}</td>\n    </tr>\n  </tbody>\n</table>\n\n<table *ngIf=\"data.area > 0\"\n  class=\"mat-typography\">\n  <thead>\n    <tr>\n      <th colspan=\"2\">{{'igo.geo.measure.dialog.area.title' | translate}}</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.SquareMeters}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareMeters' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat:measureAreaUnit.SquareKilometers}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareKilometers' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.SquareMiles}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareMiles' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.Acres}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInAcres' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.Hectares}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInHectares' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{'igo.geo.measure.dialog.perimeterInMeters' | translate}}</td>\n      <td>{{data.perimeter | measureFormat: measureLengthUnit.Meters}}</td>\n    </tr>\n  </tbody>\n</table>\n","import { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { MeasurerDialogData } from '../shared/measure.interfaces';\n\nimport { MeasureAreaUnit, MeasureLengthUnit} from '../shared/measure.enum';\n\n@Component({\n  selector: 'igo-measurer-dialog',\n  templateUrl: 'measurer-dialog.component.html',\n  styleUrls: ['./measurer-dialog.component.scss']\n})\nexport class MeasurerDialogComponent {\n\n  measureAreaUnit = MeasureAreaUnit;\n\n  measureLengthUnit = MeasureLengthUnit;\n\n  constructor(\n    public dialogRef: MatDialogRef<MeasurerDialogComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: MeasurerDialogData\n  ) {}\n\n  onNoClick(): void {\n    this.dialogRef.close();\n  }\n\n}\n","<div>\n  <div class=\"measure-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      [value]=\"activeMeasureType\"\n      (change)=\"onMeasureTypeChange($event.value)\">\n      <mat-button-toggle [value]=\"measureType.Length\">\n        {{('igo.geo.measure.' + measureType.Length) | translate}}\n      </mat-button-toggle>\n      <mat-button-toggle [value]=\"measureType.Area\">\n        {{('igo.geo.measure.' + measureType.Area) | translate}}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"measure-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\">\n      {{'igo.geo.measure.toggleActive' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasLine$ | async)\"></mat-divider>\n\n    <mat-slide-toggle *ngIf=\"(hasLine$ | async)\"\n      [checked]=\"displayLines\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayLines($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayLines' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n    <mat-slide-toggle *ngIf=\"(hasArea$ | async)\"\n      [checked]=\"displayDistance\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayDistance($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayDistance' | translate}}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle *ngIf=\"(hasArea$ | async)\"\n      [checked]=\"displayAreas\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayAreas($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayAreas' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasArea$ | async)\"></mat-divider>\n\n    <mat-slide-toggle\n      [checked]=\"measureUnitsAuto\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleMeasureUnitsAuto($event.checked)\">\n      {{'igo.geo.measure.toggleAutoUnits' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <ng-container *ngIf=\"measure$ | async as measure\">\n    <igo-measurer-item *ngIf=\"activeMeasureType === measureType.Length || activeMeasureType === measureType.Area\"\n      [measureType]=\"measureType.Length\"\n      [measureUnit]=\"measureLengthUnit.Meters\"\n      [measure]=\"measure.length\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"(activeMeasureType === measureType.Area ? 'igo.geo.measure.perimeter' : 'igo.geo.measure.length') | translate\"\n      (measureUnitChange)=\"onLengthUnitChange($event)\">\n    </igo-measurer-item>\n\n    <igo-measurer-item *ngIf=\"activeMeasureType === measureType.Area\"\n      [measureType]=\"measureType.Area\"\n      [measureUnit]=\"measureAreaUnit.SquareMeters\"\n      [measure]=\"measure.area\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"'igo.geo.measure.area' | translate\"\n      (measureUnitChange)=\"onAreaUnitChange($event)\">\n    </igo-measurer-item>\n  </ng-container>\n\n  <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n  <div class=\"measure-store-buttons\">\n    <button *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.calculate.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"accent\"\n      (click)=\"onCalculateClick()\">\n      <mat-icon svgIcon=\"calculator\"></mat-icon>\n    </button>\n\n    <button *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.delete.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"warn\"\n      (click)=\"onDeleteClick()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <!--button\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.modify.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length !== 1\"\n      (click)=\"onModifyClick()\">\n      <mat-icon svgIcon=\"edit\"></mat-icon>\n    </button-->\n  </div>\n\n  <igo-entity-table\n    #table\n    class=\"table-compact\"\n    [store]=\"store\"\n    [template]=\"tableTemplate\">\n  </igo-entity-table>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  ViewChild\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skip } from 'rxjs/operators';\n\nimport OlStyle from 'ol/style/Style';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlVectorSource from 'ol/source/Vector';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlOverlay from 'ol/Overlay';\nimport { unByKey } from 'ol/Observable';\n\nimport { LanguageService, StorageScope, StorageService } from '@igo2/core';\nimport { EntityRecord, EntityTableTemplate } from '@igo2/common';\nimport type { EntityTableComponent } from '@igo2/common';\nimport { uuid } from '@igo2/utils';\n\nimport { FeatureDataSource } from '../../datasource';\nimport {\n  FEATURE,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  tryBindStoreLayer,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy\n} from '../../feature';\nimport { DrawControl, ModifyControl } from '../../geometry/shared';\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nimport { Measure, MeasurerDialogData, FeatureWithMeasure } from '../shared/measure.interfaces';\nimport {\n  MeasureType,\n  MeasureAreaUnit,\n  MeasureLengthUnit,\n} from '../shared/measure.enum';\nimport {\n  measureOlGeometry,\n  createMeasureInteractionStyle,\n  createMeasureLayerStyle,\n  updateOlTooltipsAtMidpoints,\n  updateOlTooltipAtCenter,\n  getTooltipsOfOlGeometry,\n  squareMetersToUnit,\n  metersToUnit,\n  formatMeasure\n} from '../shared/measure.utils';\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\n\n/**\n * Tool to measure lengths and areas\n */\n@Component({\n  selector: 'igo-measurer',\n  templateUrl: './measurer.component.html',\n  styleUrls: ['./measurer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MeasurerComponent implements OnInit, OnDestroy {\n\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate = {\n    selection: true,\n    selectMany: true,\n    selectionCheckbox: true,\n    sort: true,\n    columns: [\n      {\n        name: 'length',\n        title: this.languageService.translate.instant('igo.geo.measure.lengthHeader'),\n        valueAccessor: (localFeature: FeatureWithMeasure) => {\n          const unit = this.activeLengthUnit;\n          const measure = metersToUnit(localFeature.properties.measure.length, unit);\n          return formatMeasure(measure, {\n            decimal: 1,\n            unit,\n            unitAbbr: false,\n            locale: 'fr'\n          });\n        }\n      },\n      {\n        name: 'area',\n        title: this.languageService.translate.instant('igo.geo.measure.areaHeader'),\n        valueAccessor: (localFeature: FeatureWithMeasure) => {\n          const unit = this.activeAreaUnit;\n          const measure = squareMetersToUnit(localFeature.properties.measure.area, unit);\n          return measure ? formatMeasure(measure, {\n            decimal: 1,\n            unit,\n            unitAbbr: false,\n            locale: 'fr'\n          }) : '';\n        }\n      }\n    ]\n  };\n\n  private subscriptions$$: Subscription[] = [];\n\n  /**\n   * Reference to the MeasureType enum\n   * @internal\n   */\n  public measureType = MeasureType;\n\n  /**\n   * Reference to the AreaMeasureUnit enum\n   * @internal\n   */\n  public measureAreaUnit = MeasureAreaUnit;\n\n  /**\n   * Reference to the LengthMeasureUnit enum\n   * @internal\n   */\n  public measureLengthUnit = MeasureLengthUnit;\n\n  /**\n   * Whether measure units should be automatically determined\n   * @internal\n   */\n  public measureUnitsAuto: boolean = false;\n\n  /**\n   * Whether display of distances of areas\n   * @internal\n   */\n  public displayDistance: boolean = true;\n\n  /**\n   * Whether display of distances of lines\n   * @internal\n   */\n  public displayLines: boolean = true;\n\n  /**\n   * Whether display of areas\n   * @internal\n   */\n  public displayAreas: boolean = true;\n\n  /**\n   * Observable of line boolean\n   * @internal\n   */\n   public hasLine$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area boolean\n   * @internal\n   */\n  public hasArea$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area\n   * @internal\n   */\n  public measure$: BehaviorSubject<Measure> = new BehaviorSubject({});\n\n  /**\n   * Observable of selected features\n   * @internal\n   */\n  public selectedFeatures$: BehaviorSubject<FeatureWithMeasure[]> = new BehaviorSubject([]);\n\n  /**\n   * OL draw source\n   * @internal\n   */\n  public showTooltips: boolean = true;\n\n  /**\n   * Whether draw control toggle is disabled or not\n   * @internal\n   */\n  public drawControlIsDisabled: boolean = true;\n\n  /**\n   * Draw line control\n   */\n  private drawLineControl: DrawControl;\n\n  /**\n   * Draw polygon control\n   */\n  private drawPolygonControl: DrawControl;\n\n  /**\n   * Modify control\n   */\n  private modifyControl: ModifyControl;\n\n  /**\n   * Active OL geometry\n   */\n  private activeOlGeometry: OlLineString | OlPolygon;\n\n  /**\n   * Active mlength unit\n   */\n  private activeLengthUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  /**\n   * Active area unit\n   */\n  private activeAreaUnit: MeasureAreaUnit = MeasureAreaUnit.SquareMeters;\n\n  /**\n   * Feature added listener key\n   */\n  private onFeatureAddedKey;\n\n  /**\n   * Feature removed listener key\n   */\n  private onFeatureRemovedKey;\n\n  /**\n   * Active draw control\n   * @internal\n   */\n  private activeDrawControl: DrawControl;\n\n  /**\n   * Subscription to draw start\n   */\n  private drawStart$$: Subscription;\n\n  /**\n   * Subscription to draw end\n   */\n  private drawEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private drawChanges$$: Subscription;\n\n  /**\n   * Subscription to modify start\n   */\n  private modifyStart$$: Subscription;\n\n  /**\n   * Subscription to modify end\n   */\n  private modifyEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private modifyChanges$$: Subscription;\n\n  /**\n   * Subscription to measures selection\n   */\n  private selectedFeatures$$: Subscription;\n\n  /**\n   * OL draw source\n   */\n  private olDrawSource = new OlVectorSource();\n\n  /**\n   * The map to measure on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The measures store\n   */\n  @Input() store: FeatureStore<FeatureWithMeasure>;\n\n  /**\n   * Measure type\n   * @internal\n   */\n  @Input()\n  set activeMeasureType(value: MeasureType) { this.setActiveMeasureType(value); }\n  get activeMeasureType(): MeasureType { return this._activeMeasureType; }\n  private _activeMeasureType: MeasureType;\n\n  /**\n   * The minimum length a segment must have to display a tooltip.\n   * It also applies to area tooltips.\n   */\n  @Input() minSegmentLength: number = 10;\n\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\n\n  /**\n   * Wheter one of the draw control is active\n   * @internal\n   */\n  get drawControlIsActive(): boolean {\n    return this.activeDrawControl !== undefined;\n  }\n\n  get projection(): string {\n    return this.map.ol.getView().getProjection().getCode();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dialog: MatDialog,\n    private storageService: StorageService\n  ) {}\n\n  /**\n   * Add draw controls and activate one\n   * @internal\n   */\n  ngOnInit() {\n    this.initStore();\n    this.createDrawLineControl();\n    this.createDrawPolygonControl();\n    this.createModifyControl();\n    this.toggleDrawControl();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    this.checkDistanceAreaToggle();\n    this.setActiveMeasureType(MeasureType.Length);\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.setActiveMeasureType(undefined);\n    this.deactivateModifyControl();\n    this.freezeStore();\n    this.subscriptions$$.map(s => s.unsubscribe());\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onMeasureTypeChange(measureType: MeasureType) {\n    this.activeMeasureType = measureType;\n  }\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n  onToggleDrawControl(toggle: boolean) {\n    if (toggle === true) {\n      this.toggleDrawControl();\n    } else {\n      this.deactivateDrawControl();\n    }\n  }\n\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n   onToggleMeasureUnitsAuto(toggle: boolean) {\n    this.measureUnitsAuto = toggle;\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the areas\n   * @internal\n   */\n  onToggleDisplayDistance(toggle: boolean) {\n    this.displayDistance = toggle;\n    this.onDisplayDistance();\n    toggle ? (this.storageService.set('distanceToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('distanceToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the lines\n   * @internal\n   */\n  onToggleDisplayLines(toggle: boolean) {\n    this.displayLines = toggle;\n    this.onDisplayLines();\n    toggle ? (this.storageService.set('linesToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('linesToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onToggleDisplayAreas(toggle: boolean) {\n    this.displayAreas = toggle;\n    this.onDisplayAreas();\n    toggle ? (this.storageService.set('areasToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('areasToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Set display parametres in current values\n   * @internal\n   */\n  checkDistanceAreaToggle(){\n    if (this.storageService.get('distanceToggle') === false){\n      this.displayDistance = false;\n    }\n    if (this.storageService.get('linesToggle') === false){\n      this.displayLines = false;\n    }\n    if (this.storageService.get('areasToggle') === false){\n      this.displayAreas = false;\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of areas\n   * @internal\n   */\n  onDisplayDistance() {\n    if (this.displayDistance) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-polygone-segments')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-polygone-segments')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of lines\n   * @internal\n   */\n  onDisplayLines() {\n    if (this.displayLines) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-line-segments')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-line-segments')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onDisplayAreas() {\n    if (this.displayAreas) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-area')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-area')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onLengthUnitChange(unit: MeasureLengthUnit) {\n    this.activeLengthUnit = unit;\n    this.table.refresh();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    if (this.activeOlGeometry !== undefined) {\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onAreaUnitChange(unit: MeasureAreaUnit) {\n    this.activeAreaUnit = unit;\n    this.table.refresh();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    if (this.activeOlGeometry !== undefined) {\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n  }\n\n  onCalculateClick() {\n    const features = this.selectedFeatures$.value;\n    const area = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      return sum + localFeature.properties.measure.area || 0;\n    }, 0);\n    const length = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      if (localFeature.geometry.type === 'Polygon') {\n        return sum;\n      }\n      return sum + localFeature.properties.measure.length || 0;\n    }, 0);\n    const perimeter = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      if (localFeature.geometry.type === 'LineString') {\n        return sum;\n      }\n      return sum + localFeature.properties.measure.length || 0;\n    }, 0);\n\n    this.openDialog({\n      area,\n      length,\n      perimeter\n    });\n  }\n\n  onDeleteClick() {\n    this.store.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach(selectedFeature => {\n      this.olDrawSource.getFeatures().forEach(drawingLayerFeature => {\n        const geometry = drawingLayerFeature.getGeometry() as any;\n        if (selectedFeature.properties.id === geometry.ol_uid) {\n          this.olDrawSource.removeFeature(drawingLayerFeature);\n        }\n      });\n    });\n  }\n\n  onModifyClick() {\n    if (this.selectedFeatures$.value.length !== 1) { return; }\n\n    if (this.modifyControl.active === true) {\n      this.deactivateModifyControl();\n      this.toggleDrawControl();\n    } else {\n      const localFeature = this.selectedFeatures$.value[0];\n      const olFeatures = this.store.layer.ol.getSource().getFeatures();\n      const olFeature = olFeatures.find((_olFeature: OlFeature<OlGeometry>) => {\n        return _olFeature.get('id') === localFeature.properties.id;\n      });\n\n      if (olFeature !== undefined) {\n        this.deactivateDrawControl();\n        this.activateModifyControl();\n\n        const olGeometry = olFeature.getGeometry();\n        this.clearTooltipsOfOlGeometry(olGeometry as (OlLineString | OlPolygon));\n        this.modifyControl.setOlGeometry(olGeometry);\n      }\n    }\n  }\n\n  private openDialog(data: MeasurerDialogData): void {\n    this.dialog.open(MeasurerDialogComponent, {data});\n  }\n\n  /**\n   * Initialize the measure store and set up some listeners\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      title: this.languageService.translate.instant('igo.geo.measure.layerTitle'),\n      isIgoInternalLayer: true,\n      id: `igo-measures-${uuid()}`,\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: createMeasureLayerStyle(),\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: { enabled: false }\n    });\n    tryBindStoreLayer(store, layer);\n    store.layer.visible = true;\n    layer.visible$.subscribe(visible => {\n      if (visible) {\n        Array.from(document.getElementsByClassName('igo-map-tooltip-measure')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-measure-by-display'));\n      }\n      else {\n        Array.from(document.getElementsByClassName('igo-map-tooltip-measure')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-measure-by-display'));\n      }\n    });\n\n    tryAddLoadingStrategy(store);\n\n    tryAddSelectionStrategy(store, new FeatureStoreSelectionStrategy({\n      map: this.map,\n      many: true\n    }));\n\n    this.onFeatureAddedKey = store.source.ol.on('addfeature', (event: OlVectorSourceEvent<OlGeometry>) => {\n      const localFeature = event.feature;\n      const olGeometry = localFeature.getGeometry() as any;\n      this.updateMeasureOfOlGeometry(olGeometry, localFeature.get('measure'));\n      this.onDisplayDistance();\n    });\n\n    this.onFeatureRemovedKey = store.source.ol.on('removefeature', (event: OlVectorSourceEvent<OlGeometry>) => {\n      const olGeometry = event.feature.getGeometry() as any;\n      this.clearTooltipsOfOlGeometry(olGeometry);\n    });\n\n    this.selectedFeatures$$ = store.stateView.manyBy$((record: EntityRecord<FeatureWithMeasure>) => {\n      return record.state.selected === true;\n    }).pipe(\n      skip(1) // Skip initial emission\n    )\n    .subscribe((records: EntityRecord<FeatureWithMeasure>[]) => {\n      if (this.modifyControl.active === true) {\n        this.deactivateModifyControl();\n      }\n      this.selectedFeatures$.next(records.map(record => record.entity));\n    });\n\n    this.subscriptions$$.push(this.store.entities$.subscribe(objectsExists => {\n      if (objectsExists.find(objectExist => objectExist.geometry.type === 'Polygon')){\n        this.hasArea$.next(true);\n      } else {\n        this.hasArea$.next(false);\n      }\n\n      if (objectsExists.find(objectExist => objectExist.geometry.type === 'LineString')){\n        this.hasLine$.next(true);\n      } else {\n        this.hasLine$.next(false);\n      }\n    }));\n\n    this.subscriptions$$.push(this.store.count$.subscribe(cnt => {\n      cnt >= 1 ?\n        this.store.layer.options.showInLayerList = true :\n        this.store.layer.options.showInLayerList = false;\n    }));\n  }\n\n  /**\n   * Freeze any store, meaning the layer is removed, strategies are deactivated\n   * and some listener removed\n   * @internal\n   */\n  private freezeStore() {\n    const store = this.store;\n    this.selectedFeatures$$.unsubscribe();\n    unByKey(this.onFeatureAddedKey);\n    unByKey(this.onFeatureRemovedKey);\n    store.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    store.deactivateStrategyOfType(FeatureStoreSelectionStrategy);\n  }\n\n  /**\n   * Create a draw line control\n   */\n  private createDrawLineControl() {\n    this.drawLineControl = new DrawControl({\n      geometryType: 'LineString',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createDrawPolygonControl() {\n    this.drawPolygonControl = new DrawControl({\n      geometryType: 'Polygon',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createModifyControl() {\n    this.modifyControl = new ModifyControl({\n      source: this.olDrawSource,\n      drawStyle: createMeasureInteractionStyle(),\n      layerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Activate the right control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    // this.deactivateModifyControl();\n    if (this.activeMeasureType === MeasureType.Length) {\n      this.activateDrawControl(this.drawLineControl);\n    } else if (this.activeMeasureType === MeasureType.Area) {\n      this.activateDrawControl(this.drawPolygonControl);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param drawControl Draw control\n   */\n  private activateDrawControl(drawControl: DrawControl) {\n    this.drawControlIsDisabled = false;\n    this.activeDrawControl = drawControl;\n    this.drawStart$$ = drawControl.start$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawStart(olGeometry));\n    this.drawEnd$$ = drawControl.end$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawEnd(olGeometry));\n    this.drawChanges$$ = drawControl.changes$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawChanges(olGeometry));\n    this.drawChanges$$ = drawControl.abort$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => {\n        this.clearTooltipsOfOlGeometry(olGeometry);\n        this.clearMeasures();\n      });\n    drawControl.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (this.activeDrawControl === undefined) {\n      return;\n    }\n\n    this.olDrawSource.clear();\n    if (this.drawStart$$ !== undefined ) { this.drawStart$$.unsubscribe(); }\n    if (this.drawEnd$$ !== undefined ) { this.drawEnd$$.unsubscribe(); }\n    if (this.drawChanges$$ !== undefined ) { this.drawChanges$$.unsubscribe(); }\n\n    this.clearTooltipsOfOlSource(this.olDrawSource);\n    if (this.activeOlGeometry !== undefined) {\n      this.clearTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n    this.activeDrawControl.setOlMap(undefined);\n    this.activeDrawControl = undefined;\n    this.activeOlGeometry = undefined;\n  }\n\n  private setActiveMeasureType(measureType: MeasureType) {\n    this._activeMeasureType = measureType;\n    this.clearMeasures();\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawStart(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = olGeometry;\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = undefined;\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n    this.addFeatureToStore(olGeometry);\n    this.clearTooltipsOfOlGeometry(olGeometry);\n    this.olDrawSource.clear(true);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawChanges(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(olGeometry, Object.assign({}, measure, {\n      area: undefined // We don't want to display an area tooltip while drawing.\n    }));\n    this.measure$.next(measure);\n  }\n\n  /**\n   * Activate a given control\n   * @param modifyControl Modify control\n   */\n  private activateModifyControl() {\n    const selection = this.store.getStrategyOfType(FeatureStoreSelectionStrategy) as FeatureStoreSelectionStrategy;\n    selection.deactivate();\n    selection.clear();\n\n    this.modifyStart$$ = this.modifyControl.start$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyStart(olGeometry));\n    this.modifyEnd$$ = this.modifyControl.end$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyEnd(olGeometry));\n    this.modifyChanges$$ = this.modifyControl.changes$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyChanges(olGeometry));\n    this.modifyControl.setOlMap(this.map.ol);\n  }\n\n  /**\n   * Deactivate the active modify control\n   */\n  private deactivateModifyControl() {\n    if (this.modifyStart$$ !== undefined ) { this.modifyStart$$.unsubscribe(); }\n    if (this.modifyEnd$$ !== undefined ) { this.modifyEnd$$.unsubscribe(); }\n    if (this.modifyChanges$$ !== undefined ) { this.modifyChanges$$.unsubscribe(); }\n\n    if (this.activeOlGeometry !== undefined) {\n      if (this.selectedFeatures$.value.length === 1) {\n        const localFeature = this.selectedFeatures$.value[0];\n        this.addFeatureToStore(this.activeOlGeometry, localFeature);\n      }\n      this.finalizeMeasureOfOlGeometry(this.activeOlGeometry);\n    }\n\n    this.olDrawSource.clear();\n\n    this.store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n\n    this.activeOlGeometry = undefined;\n    this.modifyControl.setOlMap(undefined);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyStart(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawStart(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyChanges(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawChanges(olGeometry);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyEnd(olGeometry: OlLineString | OlPolygon) {\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n  }\n\n  private finalizeMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(olGeometry, measure);\n  }\n\n  /**\n   * Update measures observables\n   * @param olGeometry Ol linestring or polygon\n   * @param measure Measure\n   */\n  private updateMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon, measure: Measure) {\n    olGeometry.setProperties({_measure: measure}, true);\n    this.updateTooltipsOfOlGeometry(olGeometry);\n  }\n\n  /**\n   * Clear the measures observables\n   */\n  private clearMeasures() {\n    this.measure$.next({});\n  }\n\n  /**\n   * Add a feature with measures to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(olGeometry, localFeature?: FeatureWithMeasure) {\n    const featureId = localFeature ? localFeature.properties.id : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n    this.store.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        measure: olGeometry.get('_measure')\n      },\n      meta: {\n        id: featureId\n      }\n    });\n  }\n\n  /**\n   * Update all the tooltips of an OL geometry\n   * @param olGeometry OL Geometry\n   * @param lengths Lengths of the OL geometry's segments\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = olGeometry.get('_measure');\n    const lengths = measure.lengths;\n    const area = measure.area;\n\n    const olMidpointsTooltips = updateOlTooltipsAtMidpoints(olGeometry);\n    if (lengths.length === olMidpointsTooltips.length) {\n      for (let i = 0; i < olMidpointsTooltips.length; i++) {\n        const length = lengths[i];\n        if (length !== undefined) {\n          this.updateOlTooltip(\n            olMidpointsTooltips[i],\n            metersToUnit(length, this.activeLengthUnit),\n            this.activeLengthUnit,\n            MeasureType.Length\n          );\n        }\n      }\n    }\n\n    if (area !== undefined) {\n      this.updateOlTooltip(\n        updateOlTooltipAtCenter(olGeometry),\n        squareMetersToUnit(area, this.activeAreaUnit),\n        this.activeAreaUnit,\n        MeasureType.Area\n      );\n    }\n  }\n\n  /**\n   * Show the map tooltips of a geoemtry\n   */\n  private showTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\n      if (this.shouldShowTooltip(olTooltip)) {\n        this.map.ol.addOverlay(olTooltip);\n      }\n    });\n  }\n\n  /**\n   * Clear the tooltips of an OL geometrys\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\n      if (olTooltip !== undefined && olTooltip.getMap() !== undefined) {\n        this.map.ol.removeOverlay(olTooltip);\n      }\n    });\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private updateTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      this.updateTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private showTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      this.showTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Clear the map tooltips\n   * @param olDrawSource OL vector source\n   */\n  private clearTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry !== undefined) {\n        this.clearTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n      }\n    });\n  }\n\n  /**\n   * Update an OL tooltip properties and inner HTML and add it to the map if possible\n   * @param olTooltip OL tooltip\n   * @param measure The measure valeu ti display\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateOlTooltip(\n    olTooltip: OlOverlay,\n    measure: number,\n    unit: MeasureAreaUnit | MeasureLengthUnit,\n    type: MeasureType\n  ) {\n    olTooltip.setProperties({_measure: measure, _unit: unit, _type: type}, true);\n    olTooltip.getElement().innerHTML = this.computeTooltipInnerHTML(olTooltip);\n    if (this.shouldShowTooltip(olTooltip)) {\n      this.map.ol.addOverlay(olTooltip);\n    }\n  }\n\n  /**\n   * Compute a tooltip's content\n   * @param olTooltip OL overlay\n   * @returns Inner HTML\n   */\n  private computeTooltipInnerHTML(olTooltip: OlOverlay): string {\n    const properties = olTooltip.getProperties() as any;\n    return formatMeasure(properties._measure, {\n      decimal: 1,\n      unit: properties._unit,\n      unitAbbr: true,\n      locale: 'fr'\n    }, this.languageService);\n  }\n\n  /**\n   * Whether a tooltip should be showned based on the length\n   * of the segment it is bound to.\n   * @param olTooltip OL overlay\n   * @returns True if the tooltip should be shown\n   */\n  private shouldShowTooltip(olTooltip: OlOverlay): boolean {\n    if (this.showTooltips === false) {\n      return false;\n    }\n\n    const properties = olTooltip.getProperties() as any;\n    const measure = properties._measure;\n    if (measure === undefined) {\n      return false;\n    }\n\n    if (properties._unit === MeasureType.Length) {\n      const minSegmentLength = metersToUnit(this.minSegmentLength, properties._unit) || 0;\n      return measure > Math.max(minSegmentLength, 0);\n    }\n\n    return true;\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\nimport { metersToUnit, squareMetersToUnit, formatMeasure } from '../shared/measure.utils';\n\n/**\n * This pipe returns a measure converted from meters (or square meters)\n * to the specified unit. It also keeps a certain number of decimals.\n */\n@Pipe({\n  name: 'measureFormat'\n})\nexport class MeasureFormatPipe implements PipeTransform {\n\n  /**\n   * @ignore\n   */\n  transform(\n    value: number, unit: MeasureAreaUnit | MeasureLengthUnit,\n    unitAbbr: boolean = false,\n    decimal: number = 1\n  ): number {\n    let out;\n    if (Object.values(MeasureAreaUnit).indexOf(unit as MeasureAreaUnit) >= 0) {\n      out = squareMetersToUnit(value, unit as MeasureAreaUnit);\n    } else if (Object.values(MeasureLengthUnit).indexOf(unit as MeasureLengthUnit) >= 0) {\n      out = metersToUnit(value, unit as MeasureLengthUnit);\n    }\n\n    return out ? formatMeasure(out, {\n      decimal: 1,\n      unit,\n      unitAbbr,\n      locale: 'fr'\n    }) : out;\n  }\n}\n","import { DrawControlOptions } from './../shared/controls/draw';\nimport {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  Optional,\n  Self,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { NgControl, ControlValueAccessor } from '@angular/forms';\n\nimport { Subscription } from 'rxjs';\n\nimport * as OlStyle from 'ol/style';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlGeometry from 'ol/geom/Geometry';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport OlFeature from 'ol/Feature';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlOverlay from 'ol/Overlay';\nimport * as olproj from 'ol/proj';\nimport Point from 'ol/geom/Point';\n\nimport { IgoMap } from '../../map';\nimport {\n  MeasureLengthUnit,\n  updateOlGeometryMidpoints,\n  formatMeasure,\n  measureOlGeometry\n} from '../../measure';\nimport { DrawControl, ModifyControl, ModifyControlOptions } from '../shared/controls';\nimport { createDrawInteractionStyle } from '../shared/geometry.utils';\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\n\n/**\n * This input allows a user to draw a new geometry or to edit\n * an existing one on a map. A text input is also displayed in the\n * form with some instructions.\n * This is still WIP.\n */\n@Component({\n  selector: 'igo-geometry-form-field-input',\n  templateUrl: './geometry-form-field-input.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class GeometryFormFieldInputComponent implements OnInit, OnDestroy, ControlValueAccessor {\n\n  private olOverlayLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  private olGeoJSON = new OlGeoJSON();\n  private ready = false;\n\n  private drawControl: DrawControl;\n  private modifyControl: ModifyControl;\n  private defaultDrawStyleRadius: number;\n  private olGeometryEnds$$: Subscription;\n  private olGeometryChanges$$: Subscription;\n  private olTooltip = this.createMeasureTooltip();\n\n  /**\n   * Active control\n   * @internal\n   */\n  public activeControl: DrawControl | ModifyControl;\n\n  /**\n   * The map to draw the geometry on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The geometry type\n   */\n  @Input()\n  set geometryType(value: typeof OlGeometryType) {\n    this._geometryType = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get geometryType(): typeof OlGeometryType { return this._geometryType; }\n  private _geometryType: typeof OlGeometryType;\n\n  /**\n   * The drawGuide around the mouse pointer to help drawing\n   */\n  @Input() drawGuide: number = null;\n\n  /**\n   * Whether a measure tooltip should be displayed\n   */\n  @Input() measure: boolean = false;\n\n  /**\n   * Whether draw control should be active or not\n   */\n  @Input()\n  get drawControlIsActive(): boolean { return this._drawControlIsActive; }\n  set drawControlIsActive(value: boolean) {\n    this._drawControlIsActive = value;\n    if (this.ready === false) {\n      return;\n    }\n    this.deactivateControl();\n    if (!this._drawControlIsActive) {\n      return;\n    } else {\n      this.toggleControl();\n    }\n  }\n  private _drawControlIsActive: boolean = true;\n\n  /**\n   * Whether freehand draw control should be active or not\n   */\n  @Input()\n  get freehandDrawIsActive(): boolean { return this._freehandDrawIsActive; }\n  set freehandDrawIsActive(value: boolean) {\n    this._freehandDrawIsActive = value;\n    this.deactivateControl();\n\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n\n    if (this.ready === false) {\n      return;\n    }\n\n    if (!this.drawControlIsActive) {\n      return;\n    }\n    this.toggleControl();\n  }\n  private _freehandDrawIsActive: boolean;\n\n  /**\n   * Control options\n   */\n  @Input() controlOptions: {[key: string]: any} = {};\n\n  /**\n   * Style for the draw control (applies while the geometry is being drawn)\n   */\n  @Input()\n  set drawStyle(value: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle) {\n    if (value === undefined) {\n      value = createDrawInteractionStyle();\n    }\n    this._drawStyle = value;\n\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(value) as OlStyle.Circle;\n    if (olGuideStyle !== undefined) {\n      this.defaultDrawStyleRadius = olGuideStyle.getRadius();\n    } else {\n      this.defaultDrawStyleRadius = null;\n    }\n\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get drawStyle(): OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle { return this._drawStyle; }\n  private _drawStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle;\n\n  /**\n   * Style for the overlay layer (applies once the geometry is added to the map)\n   * If not specified, drawStyle applies\n   */\n  @Input()\n  set overlayStyle(value: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle) { this._overlayStyle = value; }\n  get overlayStyle(): OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle { return this._overlayStyle; }\n  private _overlayStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle;\n\n  /**\n   * The geometry value (GeoJSON)\n   * Implemented as part of ControlValueAccessor.\n   */\n  @Input()\n  set value(value: GeoJSONGeometry) {\n    this._value = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    if (value) {\n      this.addGeoJSONToOverlay(value);\n    } else {\n      this.olOverlaySource.clear(true);\n    }\n    this.onChange(value);\n    this.toggleControl();\n    this.cdRef.detectChanges();\n  }\n  get value(): GeoJSONGeometry { return this._value; }\n  private _value: GeoJSONGeometry;\n\n  /**\n   * The vector source to add the geometry to\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<OlGeometry> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  @Input()\n  set radius(value: any) {\n    if (this.ready === false) {\n      return;\n    }\n    if (this.modifyControl.getSource()) {\n      this.modifyControl.getSource().refresh();\n    }\n    if (this.freehandDrawIsActive) {\n      let olModify;\n      setTimeout(() => {\n        olModify = this.modifyControl.olModifyInteraction;\n        if (olModify) {\n          if (olModify.features_) {\n            olModify.features_.clear();\n            this.addGeoJSONToOverlay(this.value);\n          }\n        }\n      }, 0);\n    }\n  }\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    @Optional() @Self() public ngControl: NgControl\n  ) {\n    if (this.ngControl !== undefined) {\n      // Setting the value accessor directly (instead of using\n      // the providers) to avoid running into a circular import.\n      this.ngControl.valueAccessor = this;\n    }\n  }\n\n  /**\n   * Create an overlay layer, add the initial geometry to it (if any)\n   * and toggle the right interaction.\n   * @internal\n   */\n  ngOnInit() {\n    if (this.drawStyle === undefined) {\n      this.drawStyle = createDrawInteractionStyle();\n    }\n\n    if (this.overlayStyle === undefined) {\n      this.overlayStyle = this.drawStyle;\n    }\n\n    this.addOlOverlayLayer();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    if (this.value) {\n      this.addGeoJSONToOverlay(this.value);\n    }\n    this.toggleControl();\n\n    this.ready = true;\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    // This is mandatory when the form control is reused after\n    // this component has been destroyed. It seems like the control\n    // keeps a reference to this component even after it's destroyed\n    // and it attempts to set it's value\n    this.ready = false;\n\n    this.deactivateControl();\n    this.olOverlaySource.clear();\n    this.map.ol.removeLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  registerOnChange(fn: Function) {\n    this.onChange = fn;\n  }\n  private onChange: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  registerOnTouched(fn: Function) {\n    this.onTouched = fn;\n  }\n  private onTouched: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  writeValue(value: GeoJSONGeometry) {\n    this.value = value;\n  }\n\n  /**\n   * Add an overlay layer to the map\n   */\n  private addOlOverlayLayer() {\n    this.olOverlayLayer = new OlVectorLayer({\n      source: new OlVectorSource(),\n      zIndex: 500,\n      style: null\n    });\n    this.map.ol.addLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Create a draw control and subscribe to it's geometry\n   */\n  private createDrawControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      geometryType: this.geometryType || 'Point',\n      drawingLayer: this.olOverlayLayer,\n      interactionStyle: typeof this.drawStyle === 'function' ? this.drawStyle : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n        const style = this.drawStyle;\n        this.updateDrawStyleWithDrawGuide(style, resolution);\n        return style;\n      }\n    }) as DrawControlOptions;\n    this.drawControl = new DrawControl(controlOptions);\n  }\n\n  /**\n   * Create a modify control and subscribe to it's geometry\n   */\n  private createModifyControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      layer: this.olOverlayLayer,\n      drawStyle: typeof this.drawStyle === 'function' ? this.drawStyle : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n        const style = this.drawStyle;\n        this.updateDrawStyleWithDrawGuide(style, resolution);\n        return style;\n      }\n    }) as ModifyControlOptions;\n    this.modifyControl = new ModifyControl(controlOptions);\n  }\n\n  /**\n   * Toggle the proper control (draw or modify)\n   */\n  private toggleControl() {\n    let activate;\n    if (!this.value && this.geometryType) {\n      activate = this.drawControl;\n    } else {\n      activate = this.modifyControl;\n    }\n\n    // If the control that should be activated\n    // is not the same as the current active control,\n    // deactivate the current control and activate the new one\n    // Otherwise, do nothing and keep the current control active\n    if (activate !== this.activeControl) {\n      this.deactivateControl();\n      this.activateControl(activate);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param control Control\n   */\n  private activateControl(control: DrawControl | ModifyControl) {\n    this.activeControl = control;\n    this.olGeometryEnds$$ = control.end$\n      .subscribe((olGeometry: OlGeometry) => this.onOlGeometryEnds(olGeometry));\n    if (this.measure === true && control === this.drawControl) {\n      this.olGeometryChanges$$ = control.changes$\n        .subscribe((olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) => this.onOlGeometryChanges(olGeometry));\n    }\n    control.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active control\n   */\n  private deactivateControl() {\n    this.removeMeasureTooltip();\n    if (this.activeControl !== undefined) {\n      this.activeControl.setOlMap(undefined);\n    }\n    if (this.olGeometryEnds$$ !== undefined) {\n      this.olGeometryEnds$$.unsubscribe();\n    }\n    if (this.olGeometryChanges$$ !== undefined) {\n      this.olGeometryChanges$$.unsubscribe();\n    }\n    this.activeControl = undefined;\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryEnds(olGeometry: OlGeometry | undefined) {\n    this.removeMeasureTooltip();\n    this.setOlGeometry(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryChanges(olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) {\n    if (olGeometry.getType() !== 'Point') {\n      this.updateMeasureTooltip(olGeometry);\n    }\n  }\n\n  /**\n   * When drawing ends, convert the output value to GeoJSON and keep it.\n   * Restore the double click interaction.\n   * @param olGeometry OL geometry\n   */\n  private setOlGeometry(olGeometry: OlGeometry | undefined) {\n    let value;\n    if (olGeometry === undefined) {\n      return;\n    }\n\n    if (olGeometry.getType() === 'Circle') { // Because Circle doesn't exist as a GeoJSON object\n      olGeometry = this.circleToPoint(olGeometry);\n    }\n\n    value = this.olGeoJSON.writeGeometryObject(olGeometry, {\n      featureProjection: this.map.projection,\n      dataProjection: 'EPSG:4326'\n    });\n    if (olGeometry.get('radius')) {\n      value.radius = olGeometry.get('radius');\n      olGeometry.set('radius', value.radius);\n    }\n    this.writeValue(value);\n  }\n\n  private circleToPoint(olGeometry) {\n    const center = olGeometry.getCenter();\n    const coordinates = olproj.transform(center, this.map.projection, 'EPSG:4326');\n    const radius = Math.round(olGeometry.getRadius() * (Math.cos((Math.PI / 180) * coordinates[1])));\n\n    // Convert it to a point object\n    olGeometry = new Point(center);\n    olGeometry.set('radius', radius, true);\n    return olGeometry;\n  }\n\n  /**\n   * Add a GeoJSON geometry to the overlay\n   * @param geometry GeoJSON geometry\n   */\n  private addGeoJSONToOverlay(geometry: GeoJSONGeometry) {\n    const olGeometry = this.olGeoJSON.readGeometry(geometry, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: this.map.projection\n    });\n    const olFeature = new OlFeature({\n      geometry: olGeometry\n    });\n    olFeature.setStyle(this.overlayStyle as OlStyle.Style);\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create the measure tooltip\n   */\n  private createMeasureTooltip() {\n    return new OlOverlay({\n      element: document.createElement('div'),\n      offset: [-30, -10],\n      className: [\n        'igo-map-tooltip',\n        'igo-map-tooltip-measure'\n      ].join(' '),\n      stopEvent: false\n    });\n  }\n\n  /**\n   * Update the measure tooltip of an OL geometry\n   * @param olGeometry OL Geometry\n   */\n  private updateMeasureTooltip(olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) {\n    const measure = measureOlGeometry(olGeometry, this.map.projection);\n    const lengths = measure.lengths;\n    const lastIndex = olGeometry.getType() === 'Polygon' ? lengths.length - 2 : lengths.length - 1;\n    const lastLength = lengths[lastIndex];\n\n    const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n    const olLastMidpoint = olMidpoints[lastIndex];\n    if (olMidpoints.length === 0 || olLastMidpoint === undefined) {\n      this.removeMeasureTooltip();\n      return;\n    }\n\n    this.olTooltip.setPosition(olLastMidpoint.getFlatCoordinates());\n\n    const innerHtml = formatMeasure(lastLength, {\n      decimal: 1,\n      unit: MeasureLengthUnit.Meters,\n      unitAbbr: true,\n      locale: 'fr'\n    });\n    this.olTooltip.getElement().innerHTML = innerHtml;\n    if (this.olTooltip.getMap() === undefined) {\n      this.map.ol.addOverlay(this.olTooltip);\n    }\n  }\n\n  /**\n   * Remove the measure tooltip from the map\n   */\n  private removeMeasureTooltip() {\n    if (this.olTooltip.getMap && this.olTooltip.getMap() !== undefined) {\n      this.map.ol.removeOverlay(this.olTooltip);\n      this.olTooltip.setMap(undefined);\n    }\n  }\n\n  /**\n   * Adjust the draw style with the specified draw guide distance, if possible\n   * @param olStyle Draw style to update\n   * @param resolution Resolution (to make the screen size of symbol fit the drawGuide value)\n   */\n  private updateDrawStyleWithDrawGuide(\n    olStyle: OlStyle.Style |\n    ((feature, resolution) => OlStyle.Style) |\n    OlStyle.Circle,\n    resolution: number) {\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(olStyle) as OlStyle.Circle;\n    if (olGuideStyle === undefined) {\n      return;\n    }\n\n    const drawGuide = this.drawGuide;\n    let radius;\n    if (!drawGuide || drawGuide < 0) {\n      radius = this.defaultDrawStyleRadius;\n    } else {\n      radius = drawGuide > 0 ? drawGuide / resolution : drawGuide;\n    }\n    olGuideStyle.setRadius(radius);\n  }\n\n  /**\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\n   * @param olStyle The style on which to perform the check\n   */\n  private isStyleWithRadius(olStyle) {\n    return typeof olStyle !== 'function' && olStyle.setRadius;\n  }\n\n  /**\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\n   * @param olStyle The style on which to perform the check\n   */\n  private getGuideStyleFromDrawStyle(\n    olStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle |\n    OlStyle.Style[] | ((feature, resolution) => OlStyle.Style)[] | OlStyle.Circle[]\n  ) {\n    if (Array.isArray(olStyle)) {\n      olStyle = olStyle[0];\n    }\n    if (this.isStyleWithRadius(olStyle)) {\n      return olStyle;\n    }\n    return undefined;\n  }\n}\n","<ng-template></ng-template>","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { GeometryFormFieldComponent } from './geometry-form-field.component';\nimport { GeometryFormFieldInputComponent } from './geometry-form-field-input.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    IgoLanguageModule\n  ],\n  exports: [\n    GeometryFormFieldComponent,\n    GeometryFormFieldInputComponent\n  ],\n  declarations: [\n    GeometryFormFieldComponent,\n    GeometryFormFieldInputComponent\n  ]\n})\nexport class IgoGeometryFormFieldModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoGeometryFormFieldModule } from './geometry-form-field/geometry-form-field.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoGeometryFormFieldModule\n  ],\n  exports: [\n    IgoGeometryFormFieldModule\n  ],\n  declarations: [],\n  providers: []\n})\nexport class IgoGeometryModule {}\n","<button *ngIf=\"header && options.timeFilterable && options.timeFilter\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\">\n  <mat-icon [matBadge]=\"badge\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" svgIcon=\"history\"></mat-icon>\n</button>\n\n<div #ogcFilter class=\"igo-layer-actions-container\"\n*ngIf=\"header && options.timeFilterable && options.timeFilter\">\n  <igo-time-filter-item\n    *ngIf=\"timeFilterCollapse && options.timeFilter\"\n    igoListItem\n    [header]=\"false\"\n    [layer]=\"layer\">\n  </igo-time-filter-item>\n</div>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\nimport { TimeFilterableDataSourceOptions } from '../shared/time-filter.interface';\nimport { WMSDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\n\n@Component({\n  selector: 'igo-time-filter-button',\n  templateUrl: './time-filter-button.component.html',\n  styleUrls: ['./time-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TimeFilterButtonComponent implements OnInit {\n\n  public options: TimeFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.timeFilter as any;\n    if (filter && filter.enabled) {\n      return 1;\n    } else {\n      return;\n    }\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: IgoMap;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean = true;\n\n  public timeFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n  }\n}\n","<div *ngIf=\"style === 'calendar' && type !=='year'\">\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n    <mat-form-field>\n      <mat-datetimepicker-toggle [for]=\"datetimePicker\" matSuffix></mat-datetimepicker-toggle>\n      <mat-datetimepicker #datetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n      <input matInput autocomplete=\"false\"\n        placeholder=\"{{'igo.geo.timeFilter.date' | translate}}\"\n        [matDatetimepicker]=\"datetimePicker\"\n        [(ngModel)]=\"date\"\n        [min]=\"min\"\n        [max]=\"max\"\n        readonly=\"readonly\"\n        (dateChange)=\"handleDateChange($event)\">\n    </mat-form-field>\n\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle [for]=\"minDatetimePicker\" matSuffix></mat-datetimepicker-toggle>\n        <mat-datetimepicker #minDatetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n        <input matInput autocomplete=\"false\"\n          placeholder=\"{{'igo.geo.timeFilter.startDate' | translate}}\"\n          [matDatetimepicker]=\"minDatetimePicker\"\n          [(ngModel)]=\"startDate\"\n          [min]=\"min\"\n          [max]=\"getRangeMaxDate()\"\n          readonly=\"readonly\"\n          (input)=\"startDate\"\n          (dateChange)=\"handleDateChange($event)\">\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle [for]=\"maxDatetimePicker\" matSuffix></mat-datetimepicker-toggle>\n        <mat-datetimepicker #maxDatetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n        <input matInput autocomplete=\"false\"\n          placeholder=\"{{'igo.geo.timeFilter.endDate' | translate}}\"\n          [matDatetimepicker]=\"maxDatetimePicker\"\n          [(ngModel)]=\"endDate\"\n          [min]=\"getRangeMinDate()\"\n          [max]=\"max\"\n          readonly=\"readonly\"\n          (dateChange)=\"handleDateChange($event)\">\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n\n<div *ngIf=\"style === 'calendar' && type ==='year'\">\n\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n        <mat-form-field>\n            <mat-select placeholder=\"{{'igo.geo.timeFilter.date' | translate}}\" [(ngModel)]=\"year\" (selectionChange)=\"handleYearChange($event)\">\n                  <mat-option [value]=\"year\" *ngFor=\"let year of listYears\">{{year}}</mat-option>\n            </mat-select>\n        </mat-form-field>\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n        <mat-form-field>\n            <mat-select placeholder=\"{{'igo.geo.timeFilter.startDate' | translate}}\" [(ngModel)]=\"startYear\" (selectionChange)=\"handleYearChange($event)\">\n              <mat-option [value]=\"startYear\" *ngFor=\"let startYear of startListYears\">{{startYear}}</mat-option>\n            </mat-select>\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n    <mat-form-field>\n        <mat-select placeholder=\"{{'igo.geo.timeFilter.endDate' | translate}}\" [(ngModel)]=\"endYear\" (selectionChange)=\"handleYearChange($event)\">\n              <mat-option [value]=\"endYear\" *ngFor=\"let endYear of endListYears\">{{endYear}}</mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n\n</div>\n\n\n  <br>\n  <div *ngIf=\"!isRange && style === 'slider' && type === 'year'\" class=\"igo-col igo-col-100 igo-col-100-m mat-typography\">\n    <span>{{startYear}}</span>\n    <mat-slider\n        id=\"time-slider\"\n        tickInterval=\"auto\"\n        step=\"{{step}}\"\n        [min]=\"startYear\"\n        [max]=\"endYear\"\n        [value]=\"handleSliderValue()\"\n        [color]=\"color\"\n        thumbLabel\n        (input)=\"handleSliderYearChange($event)\"\n        (change)=\"handleSliderYearChange($event)\"\n        [disabled]= \"!options.enabled || !layer.visible\">\n    </mat-slider>\n    <span>{{endYear}}</span>\n    <p *ngIf= \"options.enabled\" class=\"date-below\">{{year}}</p>\n    <div #actions class=\"igo-layer-actions-container\">\n      <mat-slide-toggle (change)=\"toggleFilterState()\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" [color]=\"color\" [checked]=\"options.enabled\"\n        [disabled]=\"!layer.visible\">\n      </mat-slide-toggle>\n      <button [disabled]= \"!options.enabled  || !layer.visible\" mat-icon-button color=\"primary\" (click)=\"playYear($event)\">\n        <mat-icon svgIcon=\"{{playIcon}}\"></mat-icon>\n       </button>\n      <button [disabled]=\"!options.enabled  || !layer.visible\" mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n      </button>\n    </div>\n  </div>\n\n<div *ngIf=\"style === 'slider' && type !== 'year'\" class=\"igo-col igo-col-100 igo-col-100-m\">\n  <mat-slider\n      id=\"time-slider\"\n      tickInterval=\"auto\"\n      step=\"{{step}}\"\n      [min]=\"dateToNumber(min)\"\n      [max]=\"dateToNumber(max)\"\n      [value]=\"handleSliderValue()\"\n      thumbLabel\n      (input)=\"handleSliderDateChange($event)\"\n      (selectionChange)=\"handleSliderDateChange($event)\">\n  </mat-slider>\n  <p class=\"date-below\">{{handleSliderTooltip()}}</p>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n   <mat-icon svgIcon=\"{{playIcon}}\"></mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  OnInit,\n  Input,\n  Output,\n  EventEmitter,\n  ViewChild\n} from '@angular/core';\nimport { DateAdapter } from '@angular/material/core';\nimport { MatSlider } from '@angular/material/slider';\nimport * as moment from 'moment';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterOptions } from '../shared/time-filter.interface';\nimport { TimeFilterType, TimeFilterStyle } from '../shared/time-filter.enum';\n\n@Component({\n  selector: 'igo-time-filter-form',\n  templateUrl: './time-filter-form.component.html',\n  styleUrls: ['./time-filter-form.component.scss']\n})\nexport class TimeFilterFormComponent implements OnInit {\n  @Input() layer: Layer;\n\n  @Input() options: TimeFilterOptions;\n\n  public color = 'primary';\n  public date: Date;\n  public startDate: Date;\n  public endDate: Date;\n  public year: any;\n  public startYear: any;\n  public endYear: any;\n  public initStartYear: any;\n  public initEndYear: any;\n  public listYears: Array<string> = [];\n  public startListYears: Array<string> = [];\n  public endListYears: Array<string> = [];\n\n  @Input()\n  set currentValue(value: string) {\n    if (value) {\n      if (this.type !== TimeFilterType.YEAR) {\n        const valueArray = value.split('/');\n        if (valueArray.length > 0) {\n          const startDate = new Date(valueArray[0]);\n          const endDate = new Date(valueArray[1]);\n          if (!isNaN(startDate.valueOf())) {\n            this.startDate = startDate;\n          }\n          if (!isNaN(endDate.valueOf())) {\n            this.endDate = endDate;\n          }\n        }\n      }\n    }\n  }\n\n  public interval: any;\n  public playIcon = 'play-circle';\n  public resetIcon = 'replay';\n\n  @Output() change: EventEmitter<Date | [Date, Date]> = new EventEmitter();\n  @Output()\n  yearChange: EventEmitter<string | [string, string]> = new EventEmitter();\n  @ViewChild(MatSlider) mySlider;\n\n  get type(): TimeFilterType {\n    return this.options.type === undefined\n      ? TimeFilterType.DATE\n      : this.options.type;\n  }\n\n  get isRange(): boolean {\n    return this.options.range === undefined ||\n      this.options.style === TimeFilterStyle.SLIDER\n      ? false\n      : this.options.range;\n  }\n\n  get style(): TimeFilterStyle {\n    return this.options.style === undefined\n      ? TimeFilterStyle.SLIDER\n      : this.options.style;\n  }\n\n  get step(): number {\n    let step = 10800000;\n    if (this.options.step === undefined) {\n      switch (this.type) {\n        case TimeFilterType.DATE:\n        case TimeFilterType.DATETIME:\n          step = 10800000;\n          break;\n        case TimeFilterType.TIME:\n          step = 3600000;\n          break;\n        case TimeFilterType.YEAR:\n          step = 31536000000;\n          break;\n        default:\n          step = 10800000;\n      }\n    } else {\n      step = this.getStepDefinition(this.options.step);\n    }\n\n    return step;\n  }\n\n  get timeInterval(): number {\n    return this.options.timeInterval === undefined\n      ? 2000\n      : this.options.timeInterval;\n  }\n\n  get min(): Date {\n    if (this.options.min) {\n      const min = new Date(this.options.min);\n      return new Date(min.getTime() + min.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get max(): Date {\n    if (this.options.max) {\n      const max = new Date(this.options.max);\n      return new Date(max.getTime() + max.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get is(): boolean {\n    return this.options.range === undefined ? false : this.options.range;\n  }\n\n  constructor(private dateAdapter: DateAdapter<Date>) {\n    this.dateAdapter.setLocale('fr');\n  }\n\n  ngOnInit() {\n    if (this.startDate === undefined) {\n      this.startDate = new Date(this.min);\n    }\n    if (this.endDate === undefined) {\n      this.endDate = new Date(this.max);\n    }\n    if (this.startYear === undefined) {\n      this.startYear = new Date(this.startDate).getFullYear();\n      this.initStartYear = this.startYear;\n    }\n    if (this.endYear === undefined) {\n      this.endYear = new Date(this.endDate).getFullYear();\n      this.initEndYear = this.endYear;\n    }\n\n    if (!this.isRange) {\n      for (let i = this.startYear; i <= this.endYear + 1; i++) {\n        this.listYears.push(i);\n      }\n    } else {\n      for (let i = this.startYear; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      for (let i = this.startYear + 1; i <= this.endYear; i++) {\n        this.endListYears.push(i);\n      }\n    }\n    this.options.enabled =\n      this.options.enabled === undefined ? true : this.options.enabled;\n    this.checkFilterValue();\n    if (this.options.enabled) {\n      if (!this.isRange && this.style === 'slider' && this.type === 'year') {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.storeCurrentFilterValue();\n      this.yearChange.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  storeCurrentFilterValue() {\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.options.value = this.year.toString();\n    }\n  }\n\n  checkFilterValue() {\n    const olSource = this.layer.dataSource.ol as olSourceImageWMS;\n    const timeFromWms = olSource.getParams().TIME;\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.year = new Date(timeFromWms.toString()).getFullYear() + 1;\n      } else if (this.options.value) {\n        this.year = new Date(this.options.value.toString()).getFullYear() + 1;\n      } else {\n        this.year = new Date(this.min).getFullYear() + 1;\n      }\n    } else if (\n      this.isRange &&\n      this.style === TimeFilterStyle.CALENDAR &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.startYear = parseInt(timeFromWms.substr(0, 4), 10);\n        this.endYear = parseInt(timeFromWms.substr(5, 4), 10);\n        const newStartListYears: any[] = [];\n        const newEndListYears: any[] = [];\n        for (let i = this.initStartYear; i < this.endYear; i++) {\n          newStartListYears.push(i);\n        }\n        for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n          newEndListYears.push(i);\n        }\n        this.startListYears = newStartListYears;\n        this.endListYears = newEndListYears;\n      }\n    }\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n  }\n\n  handleDateChange(event: any) {\n    this.setupDateOutput();\n    this.applyTypeChange();\n\n    // Only if is range, use 2 dates to make the range\n    if (this.isRange) {\n      this.change.emit([this.startDate, this.endDate]);\n    } else {\n      this.change.emit(this.startDate);\n    }\n  }\n\n  handleYearChange(event: any) {\n    if (this.isRange) {\n      this.endListYears = [];\n      for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n        this.endListYears.push(i);\n      }\n      this.startListYears = [];\n      for (let i = this.initStartYear + 1; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      this.yearChange.emit([this.startYear, this.endYear]);\n    } else {\n      this.yearChange.emit(this.year);\n    }\n  }\n\n  handleListYearChange(event: any) {\n    this.handleYearChange([this.startYear, this.endYear]);\n  }\n\n  handleListYearStartChange(event: any) {\n    this.change.emit([this.startDate, this.endDate]);\n  }\n\n  dateToNumber(date: Date): number {\n    let newDate;\n    if (date) {\n      newDate = new Date(date);\n    } else {\n      newDate = new Date(this.min);\n    }\n\n    return newDate.getTime();\n  }\n\n  setSliderThumbLabel(label: string) {\n    const thumbLabel = this.findThumbLabel(\n      this.mySlider._elementRef.nativeElement.childNodes\n    );\n    if (thumbLabel) {\n      thumbLabel.textContent = label;\n    }\n  }\n\n  findThumbLabel(test: any[]): any {\n    let thumbLabel;\n\n    test.forEach(value => {\n      if (value.className === 'mat-slider-thumb-label-text') {\n        thumbLabel = value;\n      }\n\n      if (value.children.length > 0 && !thumbLabel) {\n        thumbLabel = this.findThumbLabel(value.childNodes);\n      }\n    }, this);\n    return thumbLabel;\n  }\n\n  toggleFilterState() {\n    this.options.enabled = !this.options.enabled;\n\n    if (this.options.enabled) {\n      if (\n        !this.isRange &&\n        TimeFilterStyle.SLIDER &&\n        this.type === TimeFilterType.YEAR\n      ) {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.stopFilter();\n      this.storeCurrentFilterValue();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  resetFilter(event: any) {\n    this.date = new Date(this.min);\n    this.year = this.date.getFullYear();\n    if (\n      !this.isRange &&\n      TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.yearChange.emit(this.year);\n    } else {\n      this.setupDateOutput();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(\n        that => {\n          let newMinDateNumber;\n          const maxDateNumber = new Date(that.max);\n\n          newMinDateNumber =\n            that.date === undefined ? that.min.getTime() : that.date.getTime();\n          newMinDateNumber += that.mySlider.step;\n          that.date = new Date(newMinDateNumber);\n\n          if (newMinDateNumber > maxDateNumber.getTime()) {\n            that.stopFilter();\n          }\n\n          that.handleDateChange({ value: that.date, date: that.date });\n        },\n        this.timeInterval,\n        this\n      );\n    }\n  }\n\n  playYear(event: any) {\n    if (\n      this.year + this.mySlider.step >\n      this.max.getFullYear() + this.mySlider.step\n    ) {\n      this.stopFilter();\n      this.resetFilter(event);\n    }\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(() => {\n        if (\n          (this.year + this.mySlider.step) > this.max.getFullYear()) {\n          this.stopFilter();\n        } else {\n          this.year = this.year + this.mySlider.step;\n        }\n        this.yearChange.emit(this.year);\n\n      }, this.timeInterval, this);\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n  }\n\n  handleSliderDateChange(event: any) {\n    this.date = new Date(event.value);\n    this.setSliderThumbLabel(this.handleSliderTooltip());\n    this.handleDateChange(event);\n  }\n\n  handleSliderYearChange(event: any) {\n    this.year = event.value;\n    this.yearChange.emit(this.year);\n  }\n\n  handleSliderValue(): number {\n    if (this.options.current === true || !this.min) {\n      const currentDate = new Date();\n      this.date = this.getRoundedDate(currentDate);\n    }\n    if (this.type === TimeFilterType.YEAR) {\n      return this.year;\n    } else {\n      return this.date === undefined ? this.min.getTime() : this.date.getTime();\n    }\n  }\n\n  handleSliderTooltip() {\n    let label: string;\n\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        label =\n          this.date === undefined\n            ? this.min.toDateString()\n            : this.date.toDateString();\n        break;\n      case TimeFilterType.TIME:\n        label =\n          this.date === undefined\n            ? this.min.toTimeString()\n            : this.date.toTimeString();\n        break;\n      // datetime\n      default:\n        label =\n          this.date === undefined\n            ? this.min.toUTCString()\n            : this.date.toUTCString();\n        break;\n    }\n\n    return label;\n  }\n\n  setupDateOutput() {\n    if (this.style === TimeFilterStyle.SLIDER) {\n      this.startDate = new Date(this.date);\n      this.startDate.setSeconds(-(this.step / 1000));\n      this.endDate = new Date(this.startDate);\n      this.endDate.setSeconds(this.step / 1000);\n    } else if (!this.isRange && !!this.date) {\n      this.endDate = new Date(this.date);\n      this.startDate = new Date(this.date);\n    } else if (this.isRange && (!!this.date || !this.date)) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    } else if (!this.date) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    }\n  }\n\n  applyTypeChange() {\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        if (this.startDate !== undefined || this.endDate !== undefined) {\n          this.startDate.setHours(0);\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setHours(23);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      case TimeFilterType.TIME:\n        if (this.style === TimeFilterStyle.CALENDAR) {\n          if (this.startDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.startDate.getHours();\n            const selectedMinute = this.startDate.getMinutes();\n            this.startDate = this.min;\n            this.startDate.setHours(selectedHour);\n            this.startDate.setMinutes(selectedMinute);\n          }\n\n          if (this.endDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.endDate.getHours();\n            const selectedMinute = this.endDate.getMinutes();\n            this.endDate = this.min;\n            this.endDate.setHours(selectedHour);\n            this.endDate.setMinutes(selectedMinute);\n          }\n        }\n\n        if (!this.isRange && this.step > 60 * 60 * 1000) {\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      // datetime\n      default:\n      // do nothing\n    }\n  }\n\n  getRangeMinDate(): Date {\n    return this.startDate === undefined ? this.min : this.startDate;\n  }\n\n  getRangeMaxDate(): Date {\n    return this.endDate === undefined ? this.max : this.endDate;\n  }\n\n  /**\n   * Round date at a certain time, 10 minutes by Default\n   * @param date - Date to Round\n   * @param atMinute - round to closest 'atMinute' minute, rounded 10 by default\n   * @return the rounded date\n   */\n  getRoundedDate(date, atMinute = 10) {\n    const coeff = 1000 * 60 * atMinute;\n    return new Date(Math.round(date.getTime() / coeff) * coeff);\n  }\n\n  /**\n   * Get the step (period) definition from the layer dimension tag\n   * @param step The step as ISO 8601 example: PT10M for 10 Minutes\n   * @return the duration in milliseconds\n   */\n  getStepDefinition(step) {\n    return moment.duration(step).asMilliseconds();\n  }\n}\n","<mat-list-item *ngIf=\"header\">\n  <mat-icon\n    class=\"igo-chevron\"\n    mat-list-avatar\n    igoCollapse\n    [target]=\"filters\"\n    [collapsed]=\"filtersCollapsed\"\n    (click)=\"toggleFiltersCollapsed()\"\n    svgIcon=\"chevron-up\" >\n  </mat-icon>\n  <h4 (click)=\"toggleLegendOnClick()\" [ngStyle]=\"{'cursor': filtersCollapsed ? 'default' : 'pointer'}\"  matLine>{{layer.title}}</h4>\n  \n  <button *ngIf=\"header\"\n    mat-icon-button\n    [color]=\"layer.visible ? 'primary' : 'default'\"\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"layer.visible ?\n                  ('igo.geo.layer.hideLayer' | translate) :\n                  ('igo.geo.layer.showLayer' | translate)\"\n    (click)=\"layer.visible = !layer.visible\">\n    <mat-icon\n      [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n      [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n    </mat-icon>\n  </button>\n\n</mat-list-item>\n\n<div #filters class=\"igo-datasource-filters-container\">\n  <div #legend class=\"igo-layer-legend-container\">\n    <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n    </igo-layer-legend>\n  </div>\n  <igo-time-filter-form\n    [layer]= \"layer\"\n    [options]=\"datasource.options.timeFilter\"\n    [currentValue]=\"datasource.options.params.TIME\"\n    (change)=\"handleDateChange($event)\"\n    (yearChange)=\"handleYearChange($event)\">\n  </igo-time-filter-form>\n</div>\n","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterableDataSource } from '../shared/time-filter.interface';\nimport { TimeFilterService } from '../shared/time-filter.service';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n@Component({\n  selector: 'igo-time-filter-item',\n  templateUrl: './time-filter-item.component.html',\n  styleUrls: ['./time-filter-item.component.scss']\n})\nexport class TimeFilterItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n\n  filtersCollapsed: boolean = false;\n\n  @Input() header: boolean = true;\n\n  @Input() layer: Layer;\n\n  get datasource(): TimeFilterableDataSource {\n    return this.layer.dataSource as TimeFilterableDataSource;\n  }\n  constructor(private timeFilterService: TimeFilterService) {}\n\n  ngOnInit(): void {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  handleYearChange(year: string | [string, string]) {\n    this.timeFilterService.filterByYear(this.datasource, year);\n  }\n\n  handleDateChange(date: Date | [Date, Date]) {\n    this.timeFilterService.filterByDate(this.datasource, date);\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'time'\">\n    <igo-time-filter-item [header]=\"true\" igoListItem [layer]=\"layer\"></igo-time-filter-item>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\n@Component({\n  selector: 'igo-time-filter-list',\n  templateUrl: './time-filter-list.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TimeFilterListComponent {\n  @Input()\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.cdRef.detectChanges();\n  }\n  private _layers: Layer[] = [];\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n}\n","import { Injectable } from '@angular/core';\n\nimport * as olproj from 'ol/proj';\nimport olWKT from 'ol/format/WKT';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WktService {\n  constructor() {}\n\n  public wktToFeature(wkt, wktProj, featureProj) {\n    return new olWKT().readFeature(wkt, {\n      dataProjection: wktProj,\n      featureProjection: featureProj\n    });\n  }\n  public extentToWkt(epsgTO, extent, extentProj) {\n    let currentExtent = olproj.transformExtent(extent, extentProj, epsgTO);\n    currentExtent = this.roundCoordinateArray(currentExtent, epsgTO, 0);\n    const wktPoly = `POLYGON((\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]}))`;\n    const wktLine = `LINESTRING(\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]})`;\n    const wktMultiPoints = `MULTIPOINT(\n        ${extent[0]} ${extent[1]},\n        ${extent[0]} ${extent[3]},\n        ${extent[2]} ${extent[3]},\n        ${extent[2]} ${extent[1]})`;\n    return {\n      wktPoly,\n      wktLine,\n      wktMultiPoints\n    };\n  }\n\n  private roundCoordinateArray(coordinateArray, projection, decimal = 0) {\n    const lproj = olproj.get(projection);\n    const units = lproj.getUnits();\n    const olUnits = ['ft', 'm', 'us-ft'];\n    if (olUnits.indexOf(units) !== -1) {\n      coordinateArray = this.roundArray(coordinateArray, decimal);\n    }\n    return coordinateArray;\n  }\n\n  private roundArray(array, decimal = 0) {\n    let x = 0;\n    while (x < array.length) {\n      array[x] = array[x].toFixed(decimal);\n      x++;\n    }\n    return array;\n  }\n\n  public snrcToWkt(snrc, epsgTO) {\n    snrc = snrc.toLowerCase();\n    let wktPoly;\n    const ew = {\n      1: { from: -56, to: -64 },\n      2: { from: -64, to: -72 },\n      3: { from: -72, to: -80 },\n      4: { from: -80, to: -88 },\n      5: { from: -88, to: -96 },\n      6: { from: -96, to: -104 },\n      7: { from: -104, to: -112 },\n      8: { from: -112, to: -120 },\n      9: { from: -120, to: -128 },\n      10: { from: -128, to: -136 }\n    };\n    const sn = {\n      1: { from: 44, to: 48 },\n      2: { from: 48, to: 52 },\n      3: { from: 52, to: 56 },\n      4: { from: 56, to: 60 },\n      5: { from: 60, to: 64 },\n      6: { from: 64, to: 68 },\n      7: { from: 68, to: 72 },\n      8: { from: 72, to: 76 },\n      9: { from: 76, to: -128 }\n    };\n    const snrc250kIndex = [\n      ['m', 'n', 'o', 'p'],\n      ['l', 'k', 'j', 'i'],\n      ['e', 'f', 'g', 'h'],\n      ['d', 'c', 'b', 'a']\n    ];\n\n    const snrc50kIndex = [\n      ['13', '14', '15', '16'],\n      ['12', '11', '10', '09'],\n      ['05', '06', '07', '08'],\n      ['04', '03', '02', '01']\n    ];\n    const checkSNRC50k = /\\d{2,3}[a-p][0,1][0-9]/gi;\n    const checkSNRC250k = /\\d{2,3}[a-p]/gi;\n    const checkSNRC1m = /\\d{2,3}/gi;\n\n    let snrc1m = false;\n    let snrc250k = false;\n    let snrc50k = false;\n\n    if (checkSNRC50k.test(snrc)) {\n      snrc50k = true;\n    } else {\n      if (checkSNRC250k.test(snrc)) {\n        snrc250k = true;\n      } else {\n        if (checkSNRC1m.test(snrc)) {\n          snrc1m = true;\n        }\n      }\n    }\n\n    if (snrc1m) {\n      snrc += 'a01';\n    } else if (snrc250k) {\n      snrc += '01';\n    }\n    if (/\\d{2,3}[a-p][0,1][0-9]/gi.test(snrc)) {\n      const regex1m = /(?=[a-p])/gi;\n      const ar1m = snrc.split(regex1m);\n      const part1m = ar1m[0];\n      const part250k = ar1m[1][0];\n      const part50k = ar1m[1].split(part250k)[1];\n      let separator = 1;\n      if (part1m.length === 3) {\n        separator = 2;\n      }\n      const partEW = part1m.substring(0, separator);\n      const partSN = part1m.substring(separator);\n      const unit1mEW = 8;\n      const unit1mSN = 4;\n      const unit250kEW = 2;\n      const unit250kSN = 1;\n      const unit50kEW = 0.5;\n      const unit50kSN = 0.25;\n      let index250kEW = 0;\n      let index250kSN = 0;\n      let index50kEW = 0;\n      let index50kSN = 0;\n      snrc250kIndex.forEach(element => {\n        if (element.indexOf(part250k) !== -1) {\n          index250kSN = snrc250kIndex.indexOf(element);\n          index250kEW = element.indexOf(part250k);\n        }\n      });\n      snrc50kIndex.forEach(element => {\n        if (element.indexOf(part50k) !== -1) {\n          index50kSN = snrc50kIndex.indexOf(element);\n          index50kEW = element.indexOf(part50k);\n        }\n      });\n\n      let increment250kEW = 0;\n      let increment250kSN = 0;\n      let increment50kEW = 0;\n      let increment50kSN = 0;\n      let unitPerTypeEW = unit1mEW;\n      let unitPerTypeSN = unit1mSN;\n      if (snrc250k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = 0;\n        increment50kSN = 0;\n        unitPerTypeEW = unit250kEW;\n        unitPerTypeSN = unit250kSN;\n      } else if (snrc50k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = index50kEW * unit50kEW;\n        increment50kSN = index50kSN * unit50kSN;\n        unitPerTypeEW = unit50kEW;\n        unitPerTypeSN = unit50kSN;\n      }\n\n      const coord: {ul?: any, lr?: any, ur?: any, ll?: any} = {\n        ul: [\n          ew[partEW].to + increment250kEW + increment50kEW,\n          sn[partSN].to - increment250kSN - increment50kSN\n        ]\n      };\n\n      coord.lr = [\n        coord.ul[0] + unitPerTypeEW,\n        coord.ul[1] - unitPerTypeSN\n      ];\n      coord.ur = [coord.ul[0], coord.ul[1] - unitPerTypeSN];\n      coord.ll = [coord.ul[0] + unitPerTypeEW, coord.ul[1]];\n\n      coord.ul = olproj.transform(\n        [coord.ul[0], coord.ul[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.lr = olproj.transform(\n        [coord.lr[0], coord.lr[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ur = olproj.transform(\n        [coord.ur[0], coord.ur[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ll = olproj.transform(\n        [coord.ll[0], coord.ll[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n\n      // Rounded coordinate to shorten url in get\n      coord.ul = this.roundCoordinateArray(coord.ul, epsgTO, 0);\n      coord.lr = this.roundCoordinateArray(coord.lr, epsgTO, 0);\n      coord.ur = this.roundCoordinateArray(coord.ur, epsgTO, 0);\n      coord.ll = this.roundCoordinateArray(coord.ll, epsgTO, 0);\n\n      wktPoly =\n        'POLYGON((' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        '))';\n      const wktLine =\n        'LINESTRING(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        ')';\n\n      const wktMultiPoints =\n        'MULTIPOINT(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' ')\n        ].join(',') +\n        ')';\n      return {\n        wktPoly,\n        wktLine,\n        wktMultiPoints\n      };\n    }\n  }\n}\n","<mat-checkbox\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n  (click)=\"$event.stopPropagation()\"\n  (change)=\"toggleFilterState($event)\"\n  [checked]=\"currentFilter.active\">\n</mat-checkbox>\n\n<mat-form-field\n  [ngClass]=\"{'logical': activeFilters.indexOf(currentFilter) !== 0 && currentFilter.active===true, 'logicalHidden': activeFilters.indexOf(currentFilter) === 0 || currentFilter.active!==true}\">\n  <mat-select\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.parentLogical\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.parentLogical ? (('igo.geo.operators.tooltip.'+ currentFilter.parentLogical) | translate) : ''\"\n    (selectionChange)=\"changeLogical($event.value)\">\n      <mat-option\n        [value]=ogcFilterOperator.And\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.And' | translate\">\n          {{'igo.geo.operators.And' | translate}}\n      </mat-option>\n      <mat-option\n        [value]=ogcFilterOperator.Or\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.Or' | translate\">\n          {{'igo.geo.operators.Or' | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\n  class=\"field\"\n  *ngIf=\"(currentFilterIsSpatial$ | async)===false && (fields$ | async) && (fields$| async).length > 0 && (fields$| async)[0].name !== ''\"\n  (mouseenter)=\"inputClearable = 'selectField'\"\n  (mouseleave)=\"inputClearable = undefined\"\n  [floatLabel]=\"floatLabel\">\n  <input\n  matInput\n  [placeholder]=\"'igo.geo.sourceFields.selectField' | translate\"\n  [disabled]=\"!currentFilter.active\"\n  [matAutocomplete]=\"autoCompleteField\"\n  [value]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ''\"\n  tooltip-position=\"above\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ('igo.geo.sourceFields.selectField' | translate)\"\n  (input)=\"updateFieldsList($event.target.value)\">\n  <mat-autocomplete #autoCompleteField=\"matAutocomplete\"\n  (optionSelected)='changeField($event.option.id)'>\n    <mat-option\n      *ngFor=\"let field of filteredFields$ | async\"\n      matTooltipShowDelay=\"500\"\n      [value]=\"field.alias\"\n      [id]=\"field.name\"\n      [matTooltip]=\"field.alias\">\n      {{field.alias}}\n    </mat-option>\n  </mat-autocomplete>\n  <button mat-button\n    *ngIf=\"currentFilter.propertyName && inputClearable === 'selectField' && currentFilter.active\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"clearSelectedField()\">\n        <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n</mat-form-field>\n\n\n<mat-form-field\n  [ngClass]=\"{'operator': (currentFilterIsSpatial$ | async)===false , 'dualInput': (currentFilterIsSpatial$ | async)}\"\n  [floatLabel]=\"floatLabel\">\n  <mat-select\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.operator ? (('igo.geo.operators.tooltip.'+ currentFilter.operator) | translate) : ('igo.geo.filter.selectOperator' | translate)\"\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.operator\"\n    (selectionChange)=\"changeOperator($event.value)\">\n      <mat-option\n        *ngFor=\"let operator of (ogcFilterOperators$ | async) | keyvalue\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"operator.key\"\n        [matTooltip]=\"('igo.geo.operators.tooltip.'+ operator.key) | translate\">\n          {{('igo.geo.operators.'+ operator.key) | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\nclass=\"spatialSelector\"\n*ngIf=\"currentFilterIsSpatial$ | async\">\n  <mat-select\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.igoSpatialSelector\"\n    (selectionChange)=\"changeSpatialSelector($event.value)\">\n      <mat-option\n        *ngFor=\"let igoSpatialSelector of igoSpatialSelectors\"\n        [value]=\"igoSpatialSelector.type\">\n          {{('igo.geo.spatialSelector.'+ igoSpatialSelector.type) | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\nclass=\"singleInput\"\n*ngIf=\"['expression','pattern'].indexOf(detectProperty()) !== -1\"\n(mouseenter)=\"inputClearable = 'selectProperty'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n    [disabled]=\"!currentFilter.active\"\n    [matAutocomplete]=\"autoCompleteValues\"\n    [value]=\"detectProperty() === 'expression' ? currentFilter.expression : currentFilter.pattern\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"detectProperty() === 'expression' ? currentFilter.expression || '' : currentFilter.pattern || ''\"\n    (input)=\"updateValuesList($event.target.value)\">\n  <mat-autocomplete #autoCompleteValues=\"matAutocomplete\"\n    (optionSelected)=\"changeProperty($event.option.value)\">\n    <mat-option\n      *ngFor=\"let value of filteredValues$ | async\"\n      matTooltipShowDelay=\"500\"\n      [value]=\"value\"\n      [matTooltip]=\"value\">\n      {{value}}\n    </mat-option>\n  </mat-autocomplete>\n  <button mat-button\n    *ngIf=\"isClearable() && inputClearable === 'selectProperty' && currentFilter.active\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"clearProperty()\">\n        <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n</mat-form-field>\n\n<div class=\"igo-layer-button-group\">\n  <button\n    mat-icon-button\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.filter.removeFilter' | translate\"\n    color=\"warn\"\n    (click)=\"deleteFilter()\">\n    <mat-icon svgIcon=\"delete\"></mat-icon>\n  </button>\n</div>\n\n<mat-form-field\nclass=\"snrc\"\n*ngIf=\"(currentFilterIsSpatial$ | async) && currentFilter.igoSpatialSelector === 'snrc'\"\n(mouseenter)=\"inputClearable = 'selectSNRC'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.filter.placeholderSnrc' | translate\"\n    [value]=\"currentFilter.igoSNRC\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.igoSNRC ? currentFilter.igoSNRC : ''\"\n    (input)=\"changeSNRC($event.target.value)\">\n  <button\n    mat-button\n    *ngIf=\"currentFilter.igoSNRC\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active && inputClearable === 'selectSNRC' && currentFilter.active\"\n    (click)=\"currentFilter.igoSNRC=''\">\n      <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n  </mat-form-field>\n\n  <ng-container *ngIf=\"(currentFilterIsSpatial$ | async) && currentFilter.igoSpatialSelector === 'fixedExtent'\">\n    <button\n    mat-button\n    [disabled]=\"!currentFilter.active\"\n    *ngIf=\"currentFilter.igoSpatialSelector === 'fixedExtent'\"\n    matSuffix\n    mat-icon-button\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"changeMapExtentGeometry()\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.spatialSelector.btnSetExtent' | translate\">\n      <mat-icon svgIcon=\"arrow-expand-all\"></mat-icon>\n  </button>\n</ng-container>\n\n<br/>\n\n<mat-form-field\nclass=\"dualInput\"\n*ngIf=\"!isTemporalOperator() && ['lowerBoundary','begin'].indexOf(detectProperty(1)) !== -1\"\n(mouseenter)=\"inputClearable = 'selectProperty1'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator1\"\n      type=\"number\"\n      [value]=\"detectProperty(1) === 'lowerBoundary' ? currentFilter.lowerBoundary : currentFilter.begin\"\n      (input)=\"updateValuesList($event.target.value,1)\">\n    <mat-autocomplete #autoDualValueOperator1=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value,1)\">\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\">\n        {{value}}\n      </mat-option>\n    </mat-autocomplete>\n    <button mat-button\n      *ngIf=\"isClearable(1) && inputClearable === 'selectProperty1' && currentFilter.active\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(1)\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n</mat-form-field>\n\n<mat-form-field\n  class=\"dualInput\"\n  *ngIf=\"!isTemporalOperator() && ['upperBoundary','end'].indexOf(detectProperty(2)) !== -1\"\n  (mouseenter)=\"inputClearable = 'selectProperty2'\"\n  (mouseleave)=\"inputClearable = undefined\"\n  [floatLabel]=\"floatLabel\">\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator2\"\n      type=\"number\"\n      [value]=\"detectProperty(2) === 'upperBoundary' ? currentFilter.upperBoundary : currentFilter.end\"\n      (input)=\"updateValuesList($event.target.value,2)\">\n    <mat-autocomplete #autoDualValueOperator2=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value,2)\">\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\">\n        {{value}}\n      </mat-option>\n    </mat-autocomplete>\n    <button mat-button\n      *ngIf=\"isClearable(2) && inputClearable === 'selectProperty2' && currentFilter.active\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(2)\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n</mat-form-field>\n\n<igo-ogc-filter-time *ngIf=\"isTemporalOperator()\"\n  [(datasource)]=\"datasource\"\n  [(currentFilter)]=\"currentFilter\"\n  (changeProperty)=\"changeProperty($event.value, $event.pos)\">\n</igo-ogc-filter-time>\n\n<!--\nTODO C'EST PERTINENT je crois\n<mat-form-field class=\"field\" *ngIf=\"!(currentFilterIsSpatial$ | async) && (fields$| async) && (fields$| async).length === 1 &&  (fields$| async)[0].name === ''\">\n<input [disabled]=\"!currentFilter.active\" matInput #fieldPerUser (keyup)=\"changeProperty(currentFilter,'propertyName',fieldPerUser.value)\"\n  (blur)=\"changeProperty(currentFilter,'propertyName',fieldPerUser.value)\" [(ngModel)]=\"currentFilter.propertyName\">\n<button mat-button *ngIf=\"currentFilter.propertyName\" matSuffix mat-icon-button aria-label=\"Clear\" (click)=\"currentFilter.propertyName=''\">\n  <mat-icon svgIcon=\"close\"></mat-icon>\n</button>\n</mat-form-field>\n\n\n\n<mat-checkbox labelPosition='before' (change)=\"changeCaseSensitive($event)\" [(ngModel)]=\"currentFilter.matchCase\">\n  {{('igo.geo.operators.caseSensitive') | translate}}\n</mat-checkbox>\n\n</mat-list-item> -->\n","import { Component, Input, OnInit } from '@angular/core';\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\n\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions\n} from '../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { WktService } from '../../wkt/shared/wkt.service';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\n\n@Component({\n  selector: 'igo-ogc-filter-form',\n  templateUrl: './ogc-filter-form.component.html',\n  styleUrls: ['./ogc-filter-form.component.scss']\n})\nexport class OgcFilterFormComponent implements OnInit {\n  ogcFilterOperator = OgcFilterOperator;\n  filteredValues$: Observable<string[]>;\n  filteredFields$: Observable<SourceFieldsOptionsParams[]>;\n  public allOgcFilterOperators;\n  public ogcFilterOperators$ = new BehaviorSubject<{ [key: string]: any }>(\n    undefined\n  );\n  public igoSpatialSelectors;\n  public value = '';\n  public inputOperator;\n  public selectedField$ = new BehaviorSubject<SourceFieldsOptionsParams>(\n    undefined\n  );\n  public fields$ = new BehaviorSubject<SourceFieldsOptionsParams[]>([]);\n  public color = 'primary';\n  public disabled;\n  public currentFilterIsSpatial$ = new BehaviorSubject<boolean>(false);\n  public defaultStepMillisecond = 6000;\n  public inputClearable: string;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() currentFilter: any;\n\n  set snrc(value: any) {\n    const checkSNRC50k = /^\\d{2}[a-l][0,1][0-9]$/gi;\n    const checkSNRC250k = /^\\d{2}[a-p]$/gi;\n    const checkSNRC1m = /^\\d{2}$/gi;\n    if (\n      checkSNRC1m.test(value) ||\n      checkSNRC250k.test(value) ||\n      checkSNRC50k.test(value)\n    ) {\n      this._snrc = value;\n      this.currentFilter.igoSNRC = value;\n    }\n  }\n\n  get snrc(): any {\n    return this._snrc;\n  }\n\n  private _snrc = '';\n\n  @Input() floatLabel: FloatLabelType = 'never';\n\n  get activeFilters() {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.active === true\n    );\n  }\n\n  get allowedOperators() {\n    return new OgcFilterWriter().computeAllowedOperators(\n      this.fields$.value,\n      this.currentFilter.propertyName,\n      this.datasource.options.ogcFilters.allowedOperatorsType\n    );\n  }\n\n  constructor(private wktService: WktService) {\n    // TODO: Filter permitted operator based on wfscapabilities\n    // Need to work on regex on XML capabilities because\n    // comaparison operator's name varies between WFS servers...\n    // Ex: IsNull vs PropertyIsNull vs IsNil ...\n    this.allOgcFilterOperators = new OgcFilterWriter().operators;\n    this.ogcFilterOperators$.next(this.allOgcFilterOperators);\n    this.igoSpatialSelectors = [\n      {\n        type: 'fixedExtent'\n      },\n      {\n        type: 'snrc'\n      }\n    ];\n    // TODO: selectFeature & drawFeature\n  }\n\n  ngOnInit() {\n\n    if ( this.datasource.options.sourceFields) {\n      const sFields = this.datasource.options.sourceFields.filter(\n        (sf) =>\n          sf.excludeFromOgcFilters === undefined || !sf.excludeFromOgcFilters\n      );\n      sFields.map((sfs) => {\n        if (sfs.values) {\n          sfs.values.sort();\n        }\n      });\n      this.fields$.next(sFields);\n    }\n\n    this.updateFieldsList();\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.updateValuesList();\n    this.selectedField$.subscribe((f) => {\n      this.ogcFilterOperators$.next(this.allowedOperators);\n      if (\n        Object.keys(this.allowedOperators).indexOf(\n          this.currentFilter.operator\n        ) === -1\n      ) {\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n      }\n      this.updateValuesList();\n    });\n    this.currentFilterIsSpatial();\n  }\n\n  updateFieldsList(value?: string) {\n    this.filteredFields$ =\n      value && value.length > 0 ? of(this._filterFields(value)) : this.fields$;\n    if (this.fields$.value.find((f) => f.name === value)) {\n      this.changeField(value);\n    }\n  }\n\n  updateValuesList(value?: string, pos?: number) {\n    this.filteredValues$ =\n      value && value.length > 0\n        ? of(this._filterValues(value))\n        : this.selectedField$.value\n        ? of(this.selectedField$.value.values)\n        : of([]);\n    if (value && value.length >= 1) {\n      this.changeProperty(value, pos);\n    }\n  }\n\n  private _filterFields(value: string): SourceFieldsOptionsParams[] {\n    const keywordRegex = new RegExp(\n      value.normalize('NFD').replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n    return this.fields$.value.filter((val) =>\n      keywordRegex.test(\n        val.alias.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\n      )\n    );\n  }\n\n  private _filterValues(value: string): string[] {\n    const keywordRegex = new RegExp(\n      value\n        .toString()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n    return this.selectedField$.value.values.filter((val) =>\n      val && keywordRegex.test(\n        val\n          .toString()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '')\n      )\n    );\n  }\n\n  clearSelectedField() {\n    this.currentFilter.propertyName = '';\n    this.selectedField$.next(undefined);\n    this.clearProperty();\n  }\n\n  isClearable(pos?: number) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return this.currentFilter[detectedProperty];\n    }\n  }\n  clearProperty(pos?: number) {\n    // this.autoCompleteInputValues.closePanel();\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return (this.currentFilter[detectedProperty] = '');\n    }\n  }\n\n  toggleFilterState(event) {\n    this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    ).active = event.checked;\n    this.refreshFilters();\n  }\n\n  deleteFilter() {\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    ogcFilters.interfaceOgcFilters = ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.filterid !== this.currentFilter.filterid\n    );\n    this.refreshFilters();\n  }\n\n  changeLogical(logical: string) {\n    this.currentFilter.parentLogical = logical;\n    this.refreshFilters();\n  }\n\n  changeOperator(operator: string) {\n    this.currentFilter.operator = operator;\n    this.currentFilterIsSpatial();\n\n    if (\n      this.currentFilterIsSpatial$.value &&\n      this.currentFilter.wkt_geometry.length === 0\n    ) {\n      this.changeSpatialSelector(this.currentFilter.igoSpatialSelector);\n    } else {\n      this.refreshFilters();\n    }\n  }\n\n  changeField(field: string) {\n    this.currentFilter.propertyName = field;\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.refreshFilters();\n  }\n\n  // Issue with mapserver 7.2 and Postgis layers. Fixed in 7.4\n  // Due to this issue, the checkbox is hide.\n  changeCaseSensitive(matchCase) {\n    this.currentFilter.matchCase = matchCase.checked;\n    this.refreshFilters();\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (f) => f.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if ( refreshFilter ) {\n        this.refreshFilters();\n      }\n    }\n  }\n\n  changeNumericProperty(value, pos: number) {\n    this.changeProperty(parseFloat(value), pos);\n  }\n\n  changeSpatialSelector(value: any) {\n    this.currentFilter.igoSpatialSelector = value;\n\n    if (value === 'fixedExtent') {\n      this.changeMapExtentGeometry(false);\n    }\n    this.currentFilterIsSpatial();\n    this.refreshFilters();\n  }\n\n  changeSNRC(value: any) {\n    this.snrc = value;\n    this.changeSNRCGeometry();\n  }\n\n  changeSNRCGeometry() {\n    const interfaceOgcFilter = this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.snrc && this.currentFilter.igoSpatialSelector === 'snrc') {\n      this.currentFilter.wkt_geometry = this.wktService.snrcToWkt(\n        this.snrc,\n        this.map.projection\n      ).wktPoly;\n    }\n    this.refreshFilters();\n  }\n\n  changeMapExtentGeometry(refresh: boolean = true) {\n    const interfaceOgcFilter = this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.currentFilter.igoSpatialSelector === 'fixedExtent') {\n      this.currentFilter.wkt_geometry = this.wktService.extentToWkt(\n        this.map.projection,\n        this.map.viewController.getExtent(),\n        this.map.projection\n      ).wktPoly;\n    }\n    if (refresh) {\n      this.refreshFilters();\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n          ? 'upperBoundary'\n          : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n          ? 'end'\n          : undefined;\n      default:\n        return;\n    }\n  }\n\n  private currentFilterIsSpatial() {\n    let isSpatial = false;\n    if (this.currentFilter) {\n      isSpatial =\n        [\n          OgcFilterOperator.Contains,\n          OgcFilterOperator.Intersects,\n          OgcFilterOperator.Within\n        ].indexOf(this.currentFilter.operator) !== -1;\n    }\n    this.currentFilterIsSpatial$.next(isSpatial);\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter.operator.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n}\n","<igo-ogc-filter-selection\n  *ngIf=\"!advancedOgcFilters\"\n  igoListItem\n  [refreshFilters]=\"refreshFunc\"\n  [datasource]=\"datasource\"\n  [map]=\"map\"\n  [currentFilter]=\"currentFilter\">\n</igo-ogc-filter-selection>\n\n<ng-template \n*ngIf=\"advancedOgcFilters && datasource.options.ogcFilters.editable\"\nngFor let-currentFilter \n[ngForOf]=\"datasource.options.ogcFilters.interfaceOgcFilters\">\n<igo-ogc-filter-form\n  [currentFilter]=\"currentFilter\"\n  [refreshFilters]=\"refreshFunc\"\n  [datasource]=\"datasource\"\n  [map]=\"map\">\n</igo-ogc-filter-form>\n</ng-template>","import { Component, Input } from '@angular/core';\nimport { OgcFilterableDataSource } from '../shared/ogc-filter.interface';\nimport { IgoMap } from '../../map';\n\n@Component({\n  selector: 'igo-ogc-filterable-form',\n  templateUrl: './ogc-filterable-form.component.html'\n})\nexport class OgcFilterableFormComponent {\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() refreshFilters: () => void;\n\n  get refreshFunc() {\n    return this.refreshFilters;\n  }\n\n  get advancedOgcFilters(): boolean {\n    if (this.datasource.options.ogcFilters) {\n      return this.datasource.options.ogcFilters.advancedOgcFilters;\n    }\n    return;\n  }\n\n  get currentFilter(): any {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters ?\n    this.datasource.options.ogcFilters.interfaceOgcFilters[0] : undefined;\n  }\n\n  public color = 'primary';\n\n  constructor() {}\n}\n","<mat-list-item>\n\n  <mat-icon\n    *ngIf=\"header\"\n    class=\"igo-chevron\"\n    mat-list-avatar\n    igoCollapse [target]=\"ogcFilters\"\n    [collapsed]=\"filtersCollapsed\"\n    (click)=\"toggleFiltersCollapsed()\"\n    svgIcon=\"chevron-up\">\n  </mat-icon>\n  <h4 (click)=\"toggleLegendOnClick()\" *ngIf=\"header\" [ngStyle]=\"{'cursor': filtersCollapsed ? 'default' : 'pointer'}\" matLine [matTooltip]=\"layer.title\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n    <button *ngIf=\"isAdvancedOgcFilters() && filtersAreEditable\" [disabled]=\"addFilterDisabled()\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.filter.addFilter' | translate\" [color]=\"color\" (click)=\"addFilterToSequence()\">\n      <mat-icon svgIcon=\"plus\"></mat-icon>\n    </button>\n    <button *ngIf=\"header\"\n      mat-icon-button\n      [color]=\"layer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"layer.visible ?\n                    ('igo.geo.layer.hideLayer' | translate) :\n                    ('igo.geo.layer.showLayer' | translate)\"\n      (click)=\"layer.visible = !layer.visible\">\n      <mat-icon\n        [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n        [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n      </mat-icon>\n    </button>\n</mat-list-item>\n\n<div #ogcFilters>\n    <div *ngIf=\"header\" #legend class=\"igo-layer-legend-container\">\n      <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n      </igo-layer-legend>\n    </div>\n  <igo-ogc-filterable-form [datasource]=\"datasource\" [map]=\"map\" [refreshFilters]=\"refreshFunc\">\n  </igo-ogc-filterable-form>\n\n  <section *ngIf=\"hasSelector && filtersAreEditable\" class=\"mat-typography advancedOgcFilters\">\n    <mat-divider></mat-divider>\n    <mat-checkbox labelPosition='before' (change)=\"changeOgcFilterType($event)\"\n      [(ngModel)]=\"datasource.options.ogcFilters.advancedOgcFilters\">\n      {{'igo.geo.filter.advancedOgcFilters' | translate}}\n    </mat-checkbox>\n  </section>\n</div>","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { WFSDataSourceOptionsParams } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\n\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions,\n  OgcInterfaceFilterOptions\n} from '../shared/ogc-filter.interface';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\nimport { IgoMap } from '../../map';\nimport { OgcFilterWriter } from '../shared/ogc-filter';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n@Component({\n  selector: 'igo-ogc-filterable-item',\n  templateUrl: './ogc-filterable-item.component.html',\n  styleUrls: ['./ogc-filterable-item.component.scss']\n})\nexport class OgcFilterableItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  private lastRunOgcFilter;\n  private defaultLogicalParent = OgcFilterOperator.And;\n  public hasActiveSpatialFilter = false;\n  public filtersAreEditable = true;\n  public filtersCollapsed = true;\n  public hasSelector: boolean = false;\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n  private ogcFilterWriter;\n\n  @Input() layer: Layer;\n\n  @Input() map: IgoMap;\n\n  @Input() header: boolean = true;\n\n  get refreshFunc() {\n    return this.refreshFilters.bind(this);\n  }\n\n  get datasource(): OgcFilterableDataSource {\n    return this.layer.dataSource as OgcFilterableDataSource;\n  }\n\n  constructor(private ogcFilterService: OGCFilterService) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n  }\n\n  ngOnInit() {\n    const ogcFilters = this.datasource.options.ogcFilters;\n    if (\n      (ogcFilters.pushButtons && ogcFilters.pushButtons.bundles.length > 0) ||\n      (ogcFilters.checkboxes && ogcFilters.checkboxes.bundles.length > 0) ||\n      (ogcFilters.radioButtons && ogcFilters.radioButtons.bundles.length > 0) ||\n      (ogcFilters.select && ogcFilters.select.bundles.length > 0) ||\n      (ogcFilters.autocomplete && ogcFilters.autocomplete.bundles.length > 0)) {\n      if (ogcFilters.advancedOgcFilters === undefined) {\n        ogcFilters.advancedOgcFilters = false;\n      }\n      this.hasSelector = true;\n    }\n\n    switch (this.datasource.options.type) {\n      case 'wms':\n        this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);\n        break;\n      case 'wfs':\n        this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource);\n        break;\n      default:\n        break;\n    }\n\n    if (ogcFilters) {\n      if (ogcFilters.interfaceOgcFilters) {\n        this.lastRunOgcFilter = JSON.parse(\n          JSON.stringify(ogcFilters.interfaceOgcFilters)\n        );\n        if (\n          ogcFilters.interfaceOgcFilters.filter(f => f.wkt_geometry).length >= 1\n        ) {\n          this.hasActiveSpatialFilter = true;\n        }\n      }\n\n      this.filtersAreEditable = ogcFilters.editable\n        ? ogcFilters.editable\n        : false;\n    }\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  addFilterToSequence() {\n    this.filtersCollapsed = false;\n    const interfaceOgcFilters: OgcInterfaceFilterOptions[] = this.datasource\n      .options.ogcFilters.interfaceOgcFilters;\n    const arr = interfaceOgcFilters || [];\n    const lastLevel = arr.length === 0 ? 0 : arr[arr.length - 1].level;\n    let firstFieldName = '';\n    const includedFields = this.datasource.options.sourceFields.filter(f => !f.excludeFromOgcFilters);\n    if (includedFields.length > 0) {\n      firstFieldName =\n        includedFields[0].name === undefined ? '' : includedFields[0].name;\n    }\n    let fieldNameGeometry;\n    const datasourceOptions = this.datasource\n      .options as WFSDataSourceOptionsParams;\n    if (datasourceOptions.fieldNameGeometry) {\n      fieldNameGeometry = datasourceOptions.fieldNameGeometry;\n    } else if (\n      (this.datasource.options as any).paramsWFS &&\n      (this.datasource.options as any).paramsWFS.fieldNameGeometry\n    ) {\n      fieldNameGeometry = (this.datasource.options as any).paramsWFS\n        .fieldNameGeometry;\n    }\n    const allowedOperators = this.ogcFilterWriter.computeAllowedOperators(\n      this.datasource.options.sourceFields,\n      firstFieldName,\n      this.datasource.options.ogcFilters.allowedOperatorsType);\n    const firstOperatorName = Object.keys(allowedOperators)[0];\n\n    arr.push(\n      this.ogcFilterWriter.addInterfaceFilter(\n        {\n          propertyName: firstFieldName,\n          operator: firstOperatorName,\n          active: true,\n          igoSpatialSelector: 'fixedExtent',\n          srsName: this.map.projection,\n        } as OgcInterfaceFilterOptions,\n        fieldNameGeometry,\n        lastLevel,\n        this.defaultLogicalParent\n      )\n    );\n    this.datasource.options.ogcFilters.interfaceOgcFilters = arr;\n  }\n\n  refreshFilters(force?: boolean) {\n    if (force === true) {\n      this.lastRunOgcFilter = undefined;\n    }\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    const activeFilters = ogcFilters.interfaceOgcFilters ?\n      ogcFilters.interfaceOgcFilters.filter(f => f.active === true) : [];\n    if (activeFilters.length === 0) {\n      ogcFilters.filters = undefined;\n      ogcFilters.filtered = false;\n    }\n    if (activeFilters.length > 1) {\n      activeFilters[0].parentLogical = activeFilters[1].parentLogical;\n    }\n    if (\n      activeFilters.filter(\n        af => ['Contains', 'Intersects', 'Within'].indexOf(af.operator) !== -1\n      ).length === 0\n    ) {\n      this.hasActiveSpatialFilter = false;\n    } else {\n      this.hasActiveSpatialFilter = true;\n    }\n\n    if (\n      !(JSON.stringify(this.lastRunOgcFilter) === JSON.stringify(activeFilters))\n    ) {\n      if (this.layer.dataSource.options.type === 'wfs') {\n        const ogcDataSource: any = this.layer.dataSource;\n        const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n        ogcLayer.filters = this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n          activeFilters\n        );\n        this.layer.dataSource.ol.refresh();\n      } else if (\n        this.layer.dataSource.options.type === 'wms' &&\n        ogcFilters.enabled\n      ) {\n        let rebuildFilter = '';\n        if (activeFilters.length >= 1) {\n          const ogcDataSource: any = this.layer.dataSource;\n          const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n          ogcLayer.filters = this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n            activeFilters\n          );\n          rebuildFilter = this.ogcFilterWriter.buildFilter(\n            ogcLayer.filters,\n            undefined,\n            undefined,\n            (this.layer.dataSource.options as any).fieldNameGeometry,\n            ogcDataSource.options\n          );\n        }\n        this.ogcFilterService.filterByOgc(\n          this.datasource as WMSDataSource,\n          rebuildFilter\n        );\n        this.datasource.options.ogcFilters.filtered =\n          activeFilters.length === 0 ? false : true;\n      }\n\n      this.lastRunOgcFilter = JSON.parse(JSON.stringify(activeFilters));\n    } else {\n      // identical filter. Nothing triggered\n    }\n    (this.layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  public isAdvancedOgcFilters(): boolean {\n    return this.datasource.options.ogcFilters.advancedOgcFilters;\n  }\n\n  public addFilterDisabled(): boolean {\n    return (\n      !this.datasource.options.sourceFields ||\n      this.datasource.options.sourceFields.length === 0\n    );\n  }\n\n  private changeOgcFiltersAdvancedOgcFilters(value: boolean) {\n    this.datasource.options.ogcFilters.advancedOgcFilters = value;\n  }\n\n  changeOgcFilterType(isAdvancedOgcFilters) {\n    this.changeOgcFiltersAdvancedOgcFilters(isAdvancedOgcFilters.checked);\n    if (isAdvancedOgcFilters.checked) {\n      this.refreshFilters(true);\n    }\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'ogc'\">\n    <igo-ogc-filterable-item igoListItem [header]=\"true\" [layer]=\"layer\" \n    [map]=\"layer.map\" ></igo-ogc-filterable-item>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\n\n@Component({\n  selector: 'igo-ogc-filterable-list',\n  templateUrl: './ogc-filterable-list.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterableListComponent {\n\n  @Input() layers: Layer[];\n\n  @Input() map: IgoMap;\n\n  constructor() {}\n}\n","<button\n  *ngIf=\"header && options.ogcFilters && options.ogcFilters.enabled &&\n  (options.ogcFilters.pushButtons || options.ogcFilters.checkboxes || options.ogcFilters.radioButtons || options.ogcFilters.select || options.ogcFilters.autocomplete\n    || options.ogcFilters.editable)\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\">\n  <mat-icon [matBadge]=\"badge\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" svgIcon=\"filter\"></mat-icon>\n</button>\n\n<div #ogcFilter class=\"igo-layer-actions-container\"\n*ngIf=\"options.ogcFilters && options.ogcFilters.enabled &&\n(options.ogcFilters.pushButtons || options.ogcFilters.checkboxes || options.ogcFilters.radioButtons || options.ogcFilters.select || options.ogcFilters.autocomplete\n  || options.ogcFilters.editable)\">\n  <igo-ogc-filterable-item\n    *ngIf=\"ogcFilterCollapse && options.ogcFilters.enabled\"\n    igoListItem\n    [header]=\"false\"\n    [map]=\"layer.map\"\n    [layer]=\"layer\">\n  </igo-ogc-filterable-item>\n</div>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\nimport { OgcFilterableDataSourceOptions, IgoOgcSelector } from '../shared/ogc-filter.interface';\n\n@Component({\n  selector: 'igo-ogc-filter-button',\n  templateUrl: './ogc-filter-button.component.html',\n  styleUrls: ['./ogc-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterButtonComponent implements OnInit {\n\n  public options: OgcFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.ogcFilters as any;\n    let cnt = 0;\n    if (filter && !filter.advancedOgcFilters) {\n      if (filter.pushButtons) {\n        const pushButtons = filter.pushButtons as IgoOgcSelector;\n        const currentPushButtonGroup = pushButtons.groups.find(gr => gr.enabled);\n        let cntPushButtons = 0;\n        if (currentPushButtonGroup) {\n          currentPushButtonGroup.computedSelectors?.map(cb => cntPushButtons += (cb.selectors as any)?.filter(\n            button => button.enabled).length);\n        }\n        cnt += cntPushButtons;\n      }\n      if (filter.checkboxes) {\n        const checkboxes = filter.checkboxes as IgoOgcSelector;\n        const currentCheckboxGroup = checkboxes.groups.find(gr => gr.enabled);\n        let cntCheckboxes = 0;\n        if (currentCheckboxGroup) {\n          currentCheckboxGroup.computedSelectors?.map(cb => cntCheckboxes += (cb.selectors as any)?.filter(\n            checkbox => checkbox.enabled).length);\n        }\n        cnt += cntCheckboxes;\n      }\n      if (filter.radioButtons) {\n        const radioButtons = filter.radioButtons as IgoOgcSelector;\n        const currentRadioButtonsGroup = radioButtons.groups.find(gr => gr.enabled);\n        let cntRadioButtons = 0;\n        if (currentRadioButtonsGroup) {\n          currentRadioButtonsGroup.computedSelectors?.map(cb => cntRadioButtons += (cb.selectors as any)?.filter(\n            radio => radio.enabled).length);\n        }\n        cnt += cntRadioButtons;\n      }\n      if (filter.select) {\n        const select = filter.select as IgoOgcSelector;\n        const currentSelectGroup = select.groups.find(gr => gr.enabled);\n        let cntSelect = 0;\n        if (currentSelectGroup) {\n          currentSelectGroup.computedSelectors?.map(cb => cntSelect += (cb.selectors as any)?.filter(\n            multi => multi.enabled).length);\n        }\n        cnt += cntSelect;\n      }\n      if (filter.autocomplete) {\n        const autocomplete = filter.autocomplete as IgoOgcSelector;\n        const currentAutocompleteGroup = autocomplete.groups.find(gr => gr.enabled);\n        let cntAutocomplete = 0;\n        if (currentAutocompleteGroup) {\n          currentAutocompleteGroup.computedSelectors?.map(cb => cntAutocomplete += (cb.selectors as any)?.filter(\n            autocomplete => autocomplete.enabled).length);\n        }\n        cnt += cntAutocomplete;\n      }\n    } else if (filter && filter.filters && !filter.filters.filters) {\n      return 1;\n    } else if (filter && filter.filters && filter.filters.filters) {\n      return filter.filters.filters.length;\n    }\n    if (filter.filters && filter.filters.operator === 'During' && filter.filters.active &&\n      filter.interfaceOgcFilters && filter.interfaceOgcFilters[0].active) {\n      const filterActiveValue = filter.interfaceOgcFilters[0];\n      if (filter.filters.calendarModeYear) {\n        // year mode check just year\n        if ((filterActiveValue.begin.substring(0,4) !== this.options.minDate.substring(0,4) ) ||\n        (filterActiveValue.end.substring(0,4) !== this.options.maxDate.substring(0,4) )) {\n          cnt += 1;\n        }\n      } else if ((filterActiveValue.begin !== this.options.minDate) || (filterActiveValue.end !== this.options.maxDate)) {\n        cnt += 1;\n      }\n    }\n    return cnt > 0 ? cnt : undefined;\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource.options as OgcFilterableDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: IgoMap;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean;\n\n  public ogcFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource.options as OgcFilterableDataSourceOptions;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport * as moment_ from 'moment';\nconst moment = moment_;\n\nimport {\n    OgcFilterableDataSource\n  } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterTimeService {\n\n    readonly defaultStepMillisecond = 60000;\n\n    constructor() {}\n\n    step(datasource: OgcFilterableDataSource, currentFilter): string {\n    return datasource.options.stepDate\n      ? datasource.options.stepDate\n      : currentFilter.step;\n    }\n\n    stepMillisecond(dataSource: OgcFilterableDataSource, currentFilter): number {\n        const step = moment.duration(this.step(dataSource, currentFilter)).asMilliseconds();\n        return step === 0 ? this.defaultStepMillisecond : step;\n    }\n\n    stepIsYearDuration(step: string) {\n        const year = moment.duration(step);\n        return (\n            year.years() !== 0 &&\n            year.months() === 0 &&\n            year.weeks() === 0 &&\n            year.days() === 0 &&\n            year.hours() === 0 &&\n            year.minutes() === 0\n        );\n    }\n\n    stepIsMonthDuration(step: string) {\n        const month = moment.duration(step);\n        return (\n            month.months() !== 0 &&\n            month.weeks() === 0 &&\n            month.days() === 0 &&\n            month.hours() === 0 &&\n            month.minutes() === 0\n        );\n    }\n\n    stepIsWeekDuration(step: string) {\n        const week = moment.duration(step);\n        return (\n            week.weeks() !== 0 &&\n            week.days() === 7 &&\n            week.hours() === 0 &&\n            week.minutes() === 0\n        );\n    }\n\n    stepIsDayDuration(step: string) {\n        const day = moment.duration(step);\n        return day.days() !== 0 && day.hours() === 0 && day.minutes() === 0;\n    }\n\n    stepIsHourDuration(step: string) {\n        const hour = moment.duration(step);\n        return hour.hours() !== 0 && hour.minutes() === 0;\n    }\n\n    stepIsMinuteDuration(step: string) {\n        const minute = moment.duration(step);\n        return minute.minutes() !== 0;\n    }\n\n    dateToNumber(date: Date): number {\n        let newDate = new Date();\n        if (date) {\n          newDate = new Date(date);\n        }\n        return newDate.getTime();\n    }\n\n    public addStep(value, stepMillisecond) {\n        return moment(value).add(stepMillisecond, 'milliseconds').toDate();\n    }\n\n    public subtractStep(value, stepMillisecond) {\n        return moment(value).subtract(stepMillisecond, 'milliseconds').toDate();\n    }\n}\n","<form [formGroup]=\"form\">\n  <div *ngFor=\"let selector of ogcFiltersSelectors\">\n    <div class=\"pushButtonGroups\" *ngIf=\"selector.selectorType === 'pushButton'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getPushButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"pushButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentPushButtonsGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getPushButtonsGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentPushButtonsGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <mat-button-toggle-group\n          formControlName=\"pushButtons\" class=\"mat-typography\" appearance=\"legacy\" vertical={{bundleIsVertical(bundle)}} multiple=\"true\">\n          <mat-button-toggle *ngFor=\"let ogcPushButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcPushButton)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\" matTooltipClass=\"material-tooltip\"\n            [ngStyle]=\"getButtonColor(ogcPushButton)\"\n            [checked]=\"ogcPushButton.enabled\" (change)=\"onSelectionChange(ogcPushButton, selector.selectorType)\"\n            [value]=\"ogcPushButton\">{{ogcPushButton.title}}\n          </mat-button-toggle>\n        </mat-button-toggle-group>\n      </ng-container>\n    </div>\n\n    <div class=\"checkboxGroups\" *ngIf=\"selector.selectorType === 'checkbox'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getCheckboxesGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"checkboxesGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentCheckboxesGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getCheckboxesGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentCheckboxesGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <div class=\"checkboxes mat-typography\">\n          <mat-checkbox *ngFor=\"let ogcCheckbox of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcCheckbox)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcCheckbox.enabled\" (change)=\"onSelectionChange(ogcCheckbox, selector.selectorType)\"\n            [value]=\"ogcCheckbox\">{{ogcCheckbox.title}}\n          </mat-checkbox>\n        </div>\n        <p *ngIf=\"isLessResults(bundle, 'checkbox') || isMoreResults(bundle, 'checkbox')\">\n          <u *ngIf=\"isLessResults(bundle, 'checkbox')\"\n            class=\"lessResults mat-typography\"\n            (click)=\"displayLessResults('checkbox')\">{{ 'igo.geo.filter.displayLessResults' | translate }}\n          </u>\n          <u *ngIf=\"isMoreResults(bundle, 'checkbox')\"\n            class=\"moreResults mat-typography\"\n            (click)=\"displayMoreResults('checkbox')\">{{ 'igo.geo.filter.displayMoreResults' | translate }}\n          </u>\n        </p>\n      </ng-container>\n    </div>\n\n    <div class=\"radioButtonGroups\" *ngIf=\"selector.selectorType === 'radioButton'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getRadioButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"radioButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentRadioButtonsGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getRadioButtonsGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentRadioButtonsGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <mat-radio-group\n          formControlName=\"radioButtons\" class=\"mat-typography\">\n          <mat-radio-button *ngIf=\"bundle.unfiltered\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            (change)=\"emptyRadioButtons()\">{{ 'igo.geo.filter.resetFilters' | translate }}\n          </mat-radio-button>\n          <mat-radio-button *ngFor=\"let ogcRadioButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcRadioButton)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcRadioButton.enabled\" (change)=\"onSelectionChange(ogcRadioButton, selector.selectorType)\"\n            [value]=\"ogcRadioButton\">{{ogcRadioButton.title}}\n          </mat-radio-button>\n          <p *ngIf=\"isLessResults(bundle, 'radio') || isMoreResults(bundle, 'radio')\">\n            <u *ngIf=\"isLessResults(bundle, 'radio')\"\n              class=\"lessResults mat-typography\"\n              (click)=\"displayLessResults('radio')\">{{ 'igo.geo.filter.displayLessResults' | translate }}\n            </u>\n            <u *ngIf=\"isMoreResults(bundle, 'radio')\"\n              class=\"moreResults mat-typography\"\n              (click)=\"displayMoreResults('radio')\">{{ 'igo.geo.filter.displayMoreResults' | translate }}\n            </u>\n          </p>\n        </mat-radio-group>\n      </ng-container>\n    </div>\n\n    <div class=\"selectGroups\" *ngIf=\"selector.selectorType === 'select'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getSelectGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"selectGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentSelectGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getSelectGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentSelectGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <div class=\"groupsSelector\">\n          <mat-button *ngIf=\"bundle.unfiltered && !bundle.multiple\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            (click)=\"emptySelect()\">\n            <mat-icon svgIcon=\"filter-remove\"></mat-icon>\n          </mat-button>\n          <mat-form-field [style.width.%]=\"bundle.width ? bundle.width : undefined\">\n            <div *ngIf=\"bundle.multiple; else notMulti\">\n              <mat-select\n                #selection [multiple]=\"bundle.multiple\" [placeholder]=\"bundle.title\" formControlName=\"selectMulti\">\n                <div class=\"checkboxes mat-typography\">\n                  <mat-checkbox *ngIf=\"bundle.multiple\"\n                    [(ngModel)]=\"selectAllSelected\" [ngModelOptions]=\"{standalone: true}\"\n                    (change)=\"toggleAllSelection()\">Tous\n                  </mat-checkbox>\n                </div>\n                <mat-option *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\" tooltip-position=\"below\" matTooltipDelay=\"500\" matTooltipClass=\"material-tooltip\"\n                  (onSelectionChange)=\"selectOptionClick($event.source.value, bundle, $event)\"\n                  [value]=\"ogcSelect\">{{ogcSelect.title}}\n                </mat-option>\n              </mat-select>\n            </div>\n            <ng-template #notMulti>\n              <mat-select\n                [placeholder]=\"bundle.title\" formControlName=\"select\">\n                <mat-option *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\" tooltip-position=\"below\" matTooltipDelay=\"500\" matTooltipClass=\"material-tooltip\"\n                  [value]=\"ogcSelect\" (onSelectionChange)=\"selectOptionClick($event.source.value, bundle)\">{{ogcSelect.title}}\n                </mat-option>\n              </mat-select>\n            </ng-template>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n\n    <div class=\"autocompleteGroups\" *ngIf=\"selector.selectorType === 'autocomplete'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getAutocompleteGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"autocompleteGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentAutocompleteGroup\">\n            <mat-option *ngFor=\"let autocompleteGroup of getAutocompleteGroups()\"\n              [value]=\"autocompleteGroup\">{{autocompleteGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentAutocompleteGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <div class=\"groupsSelector\">\n          <mat-button *ngIf=\"bundle.unfiltered\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            (click)=\"emptyAutocomplete()\">\n            <mat-icon svgIcon=\"filter-remove\"></mat-icon>\n          </mat-button>\n          <mat-form-field *ngIf=\"filteredOgcAutocomplete[bundle.id]\" [style.width.%]=\"bundle.width ? bundle.width : undefined\">\n            <input matInput type=\"text\" formControlName=\"autocomplete\" #autocomplete class=\"autocomplete\"\n              [matAutocomplete]=\"auto\" [placeholder]=\"bundle.title\">\n              <mat-autocomplete #auto=\"matAutocomplete\" #autocomplete (optionSelected)=\"autocompleteOptionClick($event.option.value)\"\n              [displayWith]=\"displayFn\">\n                <mat-option *ngFor=\"let ogcAutocomplete of filteredOgcAutocomplete[bundle.id] | async\" [value]=\"ogcAutocomplete\">\n                  {{ ogcAutocomplete.value }}\n                </mat-option>\n              </mat-autocomplete>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n  </div>\n</form>\n\n<div *ngIf=\"isTemporalOperator()\">\n  <mat-divider></mat-divider>\n  <h4 *ngIf=\"!currentFilter.title\">{{ 'igo.geo.filter.reportingDate' | translate }}</h4>\n  <h4 *ngIf=\"currentFilter.title\">{{ currentFilter.title }}</h4>\n  <igo-ogc-filter-time\n    [(datasource)]=\"datasource\"\n    [(currentFilter)]=\"currentFilter\"\n    (changeProperty)=\"changeProperty($event.value, $event.pos)\">\n  </igo-ogc-filter-time>\n</div>","import {\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnInit,\n  ViewChild\n} from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport { DOMService, DOMValue } from '@igo2/common';\n\nimport {\n  OgcFilterableDataSource,\n  IgoOgcFilterObject,\n  OgcPushButton,\n  OgcSelectorBundle,\n  SelectorGroup\n\n} from '../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { IgoMap } from '../../map';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\nimport { debounceTime, map } from 'rxjs/operators';\nimport { OgcFilterOperator } from '../shared/ogc-filter.enum';\nimport { MatSelect } from '@angular/material/select';\nimport { MatOption } from '@angular/material/core';\nimport { BehaviorSubject, Observable } from 'rxjs';\n\n@Component({\n  selector: 'igo-ogc-filter-selection',\n  templateUrl: './ogc-filter-selection.component.html',\n  styleUrls: ['./ogc-filter-selection.component.scss'],\n  providers: [ DOMService ]\n})\nexport class OgcFilterSelectionComponent implements OnInit {\n\n  @ViewChild('selection') sel: MatSelect;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() checkboxesIndex = 5;\n  @Input() radioButtonsIndex = 5;\n  @Input() baseIndex = 5;\n\n  @Input()\n  get currentFilter(): any {\n    return this._currentFilter;\n  }\n  set currentFilter(value) {\n    this._currentFilter = value;\n    if (this._currentFilter?.sliderOptions) {\n      this._currentFilter.sliderOptions.enabled = false; // remove slider toggle (animation temporelle)\n    }\n  }\n  private _currentFilter: any;\n\n  public ogcFilterOperator = OgcFilterOperator;\n\n  public form: FormGroup;\n  private ogcFilterWriter: OgcFilterWriter;\n  public color = 'primary';\n  public selectAllSelected = false;\n  public selectEnabled$ = new BehaviorSubject(undefined);\n  public selectEnableds$ = new BehaviorSubject([]);\n  public autocompleteEnabled$ = new BehaviorSubject(undefined);\n  public filteredOgcAutocomplete = {};\n\n  public applyFiltersTimeout;\n\n  get ogcFiltersSelectors() {\n    const ogcSelector = [];\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.pushButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.checkboxes);\n    }\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.radioButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.select) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.select);\n    }\n    if (this.datasource?.options?.ogcFilters?.autocomplete) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.autocomplete);\n    }\n    ogcSelector.sort((a, b) => {\n      if (a.order < b.order) {\n        return -1;\n      }\n      if (a.order > b.order) {\n        return 1;\n      }\n      return 0;\n    });\n    return ogcSelector;\n  }\n\n  get currentPushButtonsGroup() {\n    return this.form.get('pushButtonsGroup').value;\n  }\n  set currentPushButtonsGroup(value) {\n    this.form.patchValue({ pushButtonsGroup: value });\n  }\n\n  get currentCheckboxesGroup() {\n    return this.form.get('checkboxesGroup').value;\n  }\n  set currentCheckboxesGroup(value) {\n    this.form.patchValue({ checkboxesGroup: value });\n  }\n\n  get currentRadioButtonsGroup() {\n    return this.form.get('radioButtonsGroup').value;\n  }\n  set currentRadioButtonsGroup(value) {\n    this.form.patchValue({ radioButtonsGroup: value });\n  }\n\n  get currentSelectGroup() {\n    return this.form.get('selectGroup').value;\n  }\n  set currentSelectGroup(value) {\n    this.form.patchValue({ selectGroup: value });\n    this.cdRef.detectChanges();\n  }\n\n  get currentAutocompleteGroup() {\n    return this.form.get('autocompleteGroup').value;\n  }\n  set currentAutocompleteGroup(value) {\n    this.form.patchValue({ autocompleteGroup: value });\n    this.cdRef.detectChanges();\n  }\n\n  get selectEnabled() {\n    return this.selectEnabled$.value;\n  }\n\n  set selectEnabled(value) {\n    this.selectEnabled$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors?.forEach(selector => {\n        value === selector ? selector.enabled = true : selector.enabled = false;\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  get selectEnableds() {\n    return this.selectEnableds$.value;\n  }\n\n  set selectEnableds(value) {\n    this.selectEnableds$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors?.forEach(selector => {\n        value.includes(selector) ? selector.enabled = true : selector.enabled = false;\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  get autocompleteEnabled() {\n    return this.autocompleteEnabled$.value;\n  }\n\n  set autocompleteEnabled(value) {\n    this.autocompleteEnabled$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentAutocompleteGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors?.forEach(selector => {\n        value === selector.title ? selector.enabled = true : selector.enabled = false;\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  constructor(\n    private ogcFilterService: OGCFilterService,\n    private formBuilder: FormBuilder,\n    private domService: DOMService,\n    private configService: ConfigService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n    this.buildForm();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      pushButtons: ['', [Validators.required]],\n      radioButtons: ['', [Validators.required]],\n      pushButtonsGroup: ['', [Validators.required]],\n      checkboxesGroup: ['', [Validators.required]],\n      radioButtonsGroup: ['', [Validators.required]],\n      selectGroup: ['', [Validators.required]],\n      select: ['', [Validators.required]],\n      selectMulti: ['', [Validators.required]],\n      autocompleteGroup: ['', [Validators.required]],\n      autocomplete: ['', [Validators.required]]\n    });\n  }\n\n  getPushButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      return this.datasource.options.ogcFilters.pushButtons.groups;\n    }\n  }\n\n  getCheckboxesGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      return this.datasource.options.ogcFilters.checkboxes.groups;\n    }\n  }\n\n  getRadioButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      return this.datasource.options.ogcFilters.radioButtons.groups;\n    }\n  }\n\n  getSelectGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.select) {\n      return this.datasource.options.ogcFilters.select.groups;\n    }\n  }\n\n  getAutocompleteGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.autocomplete) {\n      return this.datasource.options.ogcFilters.autocomplete.groups;\n    }\n  }\n\n  async ngOnInit() {\n    if (this.datasource.options.ogcFilters) {\n      if (this.datasource.options.ogcFilters.pushButtons) {\n        this.currentPushButtonsGroup =\n          this.datasource.options.ogcFilters.pushButtons.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.pushButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.checkboxes) {\n        this.currentCheckboxesGroup =\n          this.datasource.options.ogcFilters.checkboxes.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.checkboxes.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.radioButtons) {\n        this.currentRadioButtonsGroup =\n          this.datasource.options.ogcFilters.radioButtons.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.radioButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.select) {\n        this.currentSelectGroup =\n          this.datasource.options.ogcFilters.select.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.select.groups[0];\n        this.getSelectEnabled();\n        await this.getSelectDomValues();\n      }\n      if (this.datasource.options.ogcFilters.autocomplete) {\n        this.currentAutocompleteGroup =\n          this.datasource.options.ogcFilters.autocomplete.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.autocomplete.groups[0];\n        this.getAutocompleteEnabled();\n        await this.getAutocompleteDomValues();\n      }\n      this.applyFilters();\n    }\n\n    this.form\n    .get('pushButtonsGroup')\n    .valueChanges\n    .pipe(debounceTime(750))\n    .subscribe(() => {\n      this.onPushButtonsChangeGroup();\n      this.applyFilters();\n      });\n    this.form\n    .get('checkboxesGroup')\n    .valueChanges\n    .pipe(debounceTime(750))\n    .subscribe(() => {\n      this.onCheckboxesChangeGroup();\n      this.applyFilters();\n      });\n    this.form\n      .get('radioButtonsGroup')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onRadioButtonsChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('selectGroup')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onSelectChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('autocompleteGroup')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onAutocompleteChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('pushButtons')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n    this.form\n      .get('radioButtons')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n  }\n\n  private getSelectEnabled() {\n    const enableds = [];\n    let enabled;\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      if (compSelect.multiple) {\n        compSelect.selectors?.forEach(selector => {\n          if (selector.enabled) {\n            enableds.push(selector);\n          }\n        });\n        this.selectEnableds = enableds;\n        this.form.controls['selectMulti'].setValue(enableds);\n      } else {\n        compSelect.selectors?.forEach(selector => {\n          if (selector.enabled) {\n            enabled = selector;\n          }\n        });\n        this.form.controls['select'].reset(enabled);\n        this.selectEnabled$.subscribe((value) => {\n          if (this.form.controls['select'].value !== value) {\n            this.form.controls['select'].setValue(value);\n          }\n        });\n        this.selectEnabled = enabled;\n      }\n    });\n  }\n\n  private getAutocompleteEnabled() {\n    let enabled;\n    this.currentAutocompleteGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors?.forEach(selector => {\n        if (selector.enabled) {\n          const dom = {\n            id: selector.filters.expression,\n            value: selector.title\n          };\n          enabled = selector.title;\n          this.form.controls['autocomplete'].setValue(dom);\n        }\n      });\n      this.autocompleteEnabled = enabled;\n    });\n  }\n\n  getToolTip(selector): string {\n    let toolTip;\n    if (selector.tooltip) {\n      if (Array.isArray(selector.tooltip)) {\n        toolTip = selector.tooltip.join('\\n');\n      } else {\n        toolTip = selector.tooltip;\n      }\n    }\n    return toolTip || '';\n  }\n\n  async getSelectDomValues() {\n    for (const bundle of this.datasource.options.ogcFilters.select.bundles) {\n      if (bundle.domSelectors) {\n        let domValues;\n        for (const domSelector of bundle.domSelectors) {\n          let filterDOM;\n          for (const domOptions of this.configService.getConfig('dom')) {\n            if (domSelector.id === domOptions.id || domSelector.name === domOptions.name) {\n              filterDOM = {\n                id: domOptions.id,\n                url: domOptions.url,\n                name: domOptions.name,\n                values: domOptions.values\n              };\n            }\n          }\n          filterDOM.url ? domValues = await this.domService.getDom(filterDOM) as DOMValue[] :\n            domValues = filterDOM.values;\n\n          if (domValues) {\n            let newBundle = bundle;\n            newBundle.selectors = [];\n            let selector;\n            for (const value of domValues) {\n              if (bundle.multiple) {\n                let enabled;\n                this.selectEnableds?.find(sel => sel.title === value.value) ? enabled = true : enabled = false;\n                selector = {\n                  title: value.value,\n                  enabled,\n                  filters: {\n                    operator: domSelector.operator,\n                    propertyName: domSelector.propertyName,\n                    expression: value.id,\n                  }\n                };\n              } else {\n                selector = {\n                  title: value.value,\n                  enabled: this.selectEnabled?.title === value.value ?\n                    true : false,\n                  filters: {\n                    operator: domSelector.operator,\n                    propertyName: domSelector.propertyName,\n                    expression: value.id,\n                  }\n                };\n              }\n              newBundle.selectors.push(selector);\n            }\n            this.getSelectGroups().find(group => group.ids.includes(newBundle.id)).computedSelectors\n              .find(comp => comp.title === newBundle.title).selectors = newBundle.selectors;\n          }\n        }\n        this.getSelectEnabled();\n      }\n    }\n  }\n\n  async getAutocompleteDomValues() {\n    for (const bundle of this.datasource.options.ogcFilters.autocomplete.bundles) {\n      if (bundle.domSelectors) {\n        let domValues;\n        for (const domSelector of bundle.domSelectors) {\n          let filterDOM;\n          for (const domOptions of this.configService.getConfig('dom')) {\n            if (domSelector.id === domOptions.id || domSelector.name === domOptions.name) {\n              filterDOM = {\n                id: domOptions.id,\n                url: domOptions.url,\n                name: domOptions.name,\n                values: domOptions.values\n              };\n            }\n          }\n          filterDOM.url ? domValues = await this.domService.getDom(filterDOM) as DOMValue[] :\n            domValues = filterDOM.values;\n\n          if (domValues) {\n            let newBundle = bundle;\n            newBundle.selectors = [];\n            let selector;\n            for (const value of domValues) {\n              selector = {\n                title: value.value,\n                enabled: this.autocompleteEnabled && this.autocompleteEnabled === value.value ?\n                  true : false,\n                filters: {\n                  operator: domSelector.operator,\n                  propertyName: domSelector.propertyName,\n                  expression: value.id,\n                }\n              };\n              newBundle.selectors.push(selector);\n            }\n            this.getAutocompleteGroups().find(group => group.ids.includes(newBundle.id)).computedSelectors\n              .find(comp => comp.title === newBundle.title).selectors = newBundle.selectors;\n          }\n        }\n\n        this.filteredOgcAutocomplete[bundle.id] = new Observable<any[]>();\n        this.cdRef.detectChanges();\n        this.filteredOgcAutocomplete[bundle.id] = this.form.controls['autocomplete'].valueChanges.pipe(\n          map(value => {\n            if (value.length) {\n              return domValues?.filter((option) => {\n                const filterNormalized = value ? value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '') : '';\n                const featureNameNormalized = option.value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n                return featureNameNormalized.includes(filterNormalized);\n              });\n            }\n          })\n        );\n      }\n    }\n  }\n\n  // getButtonStyle(pb: OgcPushButton): {} {\n\n  //   let styles;\n  //   if (pb.color) {\n  //     styles = {\n  //       'background-color': pb.enabled ? `rgba(${pb.color})` : `rgba(255,255,255,0)`\n  //     };\n  //   } else {\n  //     styles = {\n  //       'background-color': pb.enabled ? 'accent': `rgba(255,255,255,0)`,\n  //       'color': pb.enabled ? `rgba(0,0,0,0.9)` : `rgba(33,33,33,0.38)`\n  //     }\n  //   }\n  //   return styles;\n  // }\n\n  getButtonColor(pushButton: OgcPushButton): {} {\n    let styles;\n    if (pushButton.color && pushButton.enabled) {\n      styles = {\n        'background-color': `rgba(${pushButton.color})`\n      };\n    }\n    return styles;\n  }\n\n  bundleIsVertical(bundle: OgcSelectorBundle): boolean {\n    return bundle.vertical ? bundle.vertical : false;\n  }\n\n  private onPushButtonsChangeGroup() {\n    this.getPushButtonsGroups().map(group => group.enabled = false);\n    this.getPushButtonsGroups().find(group => group === this.currentPushButtonsGroup).enabled = true;\n  }\n\n  private onCheckboxesChangeGroup() {\n    this.getCheckboxesGroups().map(group => group.enabled = false);\n    this.getCheckboxesGroups().find(group => group === this.currentCheckboxesGroup).enabled = true;\n  }\n\n  private onRadioButtonsChangeGroup() {\n    this.getRadioButtonsGroups().map(group => group.enabled = false);\n    this.getRadioButtonsGroups().find(group => group === this.currentRadioButtonsGroup).enabled = true;\n  }\n\n  private onSelectChangeGroup() {\n    this.getSelectGroups().map(group => group.enabled = false);\n    this.getSelectGroups().find(group => group === this.currentSelectGroup).enabled = true;\n  }\n\n  private onAutocompleteChangeGroup() {\n    this.getAutocompleteGroups().map(group => group.enabled = false);\n    this.getAutocompleteGroups().find(group => group === this.currentAutocompleteGroup).enabled = true;\n  }\n\n  onSelectionChange(currentOgcSelection?, selectorType?) {\n    clearTimeout(this.applyFiltersTimeout);\n    if (selectorType === 'radioButton') {\n      this.emptyRadioButtons();\n    }\n\n    if (currentOgcSelection) {\n      currentOgcSelection.enabled = !currentOgcSelection.enabled;\n    }\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  emptyRadioButtons() {\n    this.currentRadioButtonsGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors.map(selector => selector.enabled = false);\n\n      this.applyFiltersTimeout = setTimeout(() => {\n        this.applyFilters();\n      }, 750);\n   });\n  }\n\n  emptySelect() {\n    this.selectEnabled = undefined;\n  }\n\n  emptyAutocomplete() {\n    this.autocompleteEnabled = undefined;\n    this.form.controls['autocomplete'].setValue('');\n    this.form.controls['autocomplete'].markAsUntouched();\n  }\n\n  toggleAllSelection() {\n    if (this.selectAllSelected) {\n      const enableds = [];\n      this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n        compSelect.selectors?.forEach(selector => {\n          enableds.push(selector);\n        });\n      });\n      this.sel.options.forEach((item: MatOption) => item.select());\n      this.selectEnableds = enableds;\n    } else {\n      this.sel.options.forEach((item: MatOption) => item.deselect());\n      this.selectEnableds = [];\n    }\n  }\n\n  selectOptionClick(value, bundle, event?) {\n    if (bundle.multiple) {\n      const enableds = this.selectEnableds;\n      let newStatus = true;\n      this.sel.options.forEach((item: MatOption) => {\n        if (!item.selected) {\n          newStatus = false;\n        }\n      });\n      this.selectAllSelected = newStatus;\n      if (event.isUserInput) {\n        if (enableds.length) {\n          for (const enabled of enableds) {\n            if (enabled.title === value.title) {\n              if (enabled.enabled && value.enabled) {\n                enableds.splice(enableds.indexOf(enabled), 1);\n                this.selectEnableds = enableds;\n                break;\n              }\n            } else if (enableds.indexOf(enabled) === enableds.length - 1) {\n              enableds.push(value);\n              this.selectEnableds = enableds;\n              break;\n            }\n          }\n        } else {\n          enableds.push(value);\n          this.selectEnableds = enableds;\n        }\n      }\n    } else {\n      this.selectEnabled = value;\n    }\n  }\n\n  autocompleteOptionClick(value) {\n    this.autocompleteEnabled = value.value;\n  }\n\n  displayFn(dom): string {\n    return dom ? dom.value : undefined;\n  }\n\n  private applyFilters() {\n    let filterQueryString = '';\n    const conditions = [];\n    const currentGroups = [this.currentPushButtonsGroup, this.currentCheckboxesGroup,\n      this.currentRadioButtonsGroup, this.currentSelectGroup, this.currentAutocompleteGroup];\n    for (const currentGroup of currentGroups) {\n      if (currentGroup.computedSelectors) {\n        currentGroup.computedSelectors.map(selectorBundle => {\n          const bundleCondition = [];\n          selectorBundle.selectors?.filter(ogcSelector => ogcSelector.enabled === true)\n          .forEach(enabledSelector => bundleCondition.push(enabledSelector.filters));\n          if (bundleCondition.length >= 1 ) {\n            if (bundleCondition.length === 1) {\n              conditions.push(bundleCondition[0]);\n            } else {\n              conditions.push({logical: selectorBundle.logical, filters: bundleCondition});\n            }\n          }\n        });\n      }\n    }\n    if (this.isTemporalOperator() && this._currentFilter.active) {\n      conditions.push(this.datasource.options.ogcFilters.interfaceOgcFilters[0]);\n    }\n    if (conditions.length >= 1) {\n      filterQueryString = this.ogcFilterWriter\n        .buildFilter(conditions.length === 1 ?\n          conditions[0] : {logical: 'And', filters: conditions } as IgoOgcFilterObject);\n    }\n    if (this.datasource.options.type === 'wms') {\n      this.ogcFilterService.filterByOgc(this.datasource as WMSDataSource, filterQueryString );\n    }\n    if (this.datasource.options.type === 'wfs') {\n      // TODO: Check how to prevent wfs to refresh when filter icon is pushed...\n      this.datasource.ol.refresh();\n    }\n    this.datasource.setOgcFilters(this.datasource.options.ogcFilters, true);\n  }\n\n  isMoreResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index = type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return selectorsLength > index;\n  }\n\n  displayMoreResults(type) {\n    type === 'radio' ? this.radioButtonsIndex += 5 : this.checkboxesIndex += 5;\n    return;\n  }\n\n  isLessResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index = type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return this.baseIndex !== index && selectorsLength > this.baseIndex;\n  }\n\n  displayLessResults(type) {\n    type === 'radio' ? this.radioButtonsIndex = this.baseIndex : this.checkboxesIndex = this.baseIndex;\n    return;\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter?.operator?.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        filter => filter.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if ( refreshFilter ) {\n        this.applyFilters();\n      }\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n          ? 'upperBoundary'\n          : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n          ? 'end'\n          : undefined;\n      default:\n        return;\n    }\n  }\n}\n","<mat-tab-group\n  [selectedIndex]=\"selectedTypeIndex.value\"\n  (selectedIndexChange)=\"selectedTypeIndex.setValue($event)\"\n  (selectedTabChange)=\"onTypeChange($event)\">\n\n  <mat-tab [label]=\"'igo.geo.spatialFilter.predefined' |translate\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.spatialFilter.searchLabel' | translate}}</mat-label>\n      <mat-select (selectionChange)=\"onSelectionChange()\" [(value)]=\"selectedQueryType\">\n        <mat-option *ngFor=\"let queryType of queryType\" [value]=\"queryType\">\n          {{('igo.geo.terrapi.' + queryType) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <igo-spatial-filter-list\n      [store]=\"store\"\n      [queryType]=\"selectedQueryType\"\n      [zone]=\"zone\"\n      [layers]=\"layers\"\n      (zoneChange)=\"zoneChange.emit($event)\"\n      (zoneWithBufferChange)=\"zoneWithBufferChange.emit($event)\"\n      (bufferChange)=\"bufferChange.emit($event)\"\n      (measureUnitChange)=\"measureUnitChange.emit($event)\">\n    </igo-spatial-filter-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.geo.spatialFilter.draw' |translate\">\n    <div class=\"spatial-type-toggle\">\n      <mat-button-toggle-group\n        [value]=\"activeDrawType\"\n        (change)=\"onDrawTypeChange($event.value)\">\n        <mat-button-toggle [value]=\"spatialType.Polygon\" [matTooltip]=\"'igo.geo.spatialFilter.drawPolygon' |translate\">\n            <mat-icon svgIcon=\"pentagon-outline\"></mat-icon>\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"spatialType.Point\" [matTooltip]=\"'igo.geo.spatialFilter.drawCircle' |translate\">\n            <mat-icon svgIcon=\"record-circle-outline\"></mat-icon>\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n  </mat-tab>\n\n</mat-tab-group>\n","import {\n  Component,\n  Input,\n  OnInit,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { SpatialFilterQueryType, SpatialFilterType } from '../../shared/spatial-filter.enum';\nimport { FormControl } from '@angular/forms';\nimport { EntityStore } from '@igo2/common';\nimport { Feature } from '../../../feature';\nimport { MeasureLengthUnit } from '../../../measure';\nimport { Layer } from '../../../layer';\n\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'igo-spatial-filter-type',\n  templateUrl: './spatial-filter-type.component.html',\n  styleUrls: ['./spatial-filter-type.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterTypeComponent implements OnInit {\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  public queryType: string[] = ['Arrond', 'CircFed', 'CircProv', 'DirReg', 'Mun', 'MRC', 'AdmRegion', 'RegTour'];\n  public selectedTypeIndex = new FormControl(0);\n\n  /**\n   * Reference to the SpatialFIlterType enum\n   * @internal\n   */\n  public spatialType = SpatialFilterType;\n\n  public activeDrawType: SpatialFilterType = this.spatialType.Polygon;\n\n  @Input() selectedQueryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() layers: Layer[] = [];\n\n  public type: SpatialFilterType;\n\n  @Output() eventType = new EventEmitter<SpatialFilterType>();\n\n  @Output() eventQueryType = new EventEmitter<SpatialFilterQueryType>();\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  constructor() {}\n\n  ngOnInit() {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = this.spatialType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onTypeChange(event) {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = SpatialFilterType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onDrawTypeChange(spatialType: SpatialFilterType) {\n    this.activeDrawType = spatialType;\n    this.eventType.emit(this.activeDrawType);\n  }\n\n  onSelectionChange() {\n    this.eventQueryType.emit(this.selectedQueryType);\n    this.zoneChange.emit(undefined);\n  }\n}\n","<form class=\"form-list\">\n    <mat-form-field class=\"zone-list\">\n        <input #input type=\"text\" placeholder=\"{{'igo.geo.spatialFilter.listLabel' |translate}}\" matInput\n        [formControl]=\"formControl\" [matAutocomplete]=\"auto\">\n        <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)=\"onZoneChange($event.option.value)\"\n        [displayWith]=\"displayFn\">\n            <mat-option *ngFor=\"let entities of this.store.view.all$() | async\" [value]=\"entities\">\n                {{entities.properties.nom}}\n            </mat-option>\n        </mat-autocomplete>\n    </mat-form-field>\n<form>\n\n<div class=\"buffer-div\">\n    <form class=\"buffer-form\">\n        <mat-form-field class=\"buffer\">\n            <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.buffer' | translate}}\" [formControl]=\"bufferFormControl\"\n            [value]=\"0\" [readonly]=\"!zone\">\n        </mat-form-field>\n    </form>\n\n    <mat-form-field class=\"unit-field\">\n        <mat-select\n        [value]=\"measureUnit\"\n        (selectionChange)=\"onMeasureUnitChange($event.value)\">\n        <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n            {{('igo.geo.measure.' + measureUnit) | translate}}\n        </mat-option>\n        </mat-select>\n    </mat-form-field>\n</div>\n","import { debounceTime, distinctUntilChanged } from 'rxjs/operators';\nimport { EntityStore } from '@igo2/common';\nimport { SpatialFilterService } from './../../shared/spatial-filter.service';\nimport { SpatialFilterQueryType, SpatialFilterType } from './../../shared/spatial-filter.enum';\nimport {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { FormControl } from '@angular/forms';\nimport { Feature } from '../../../feature';\nimport { MeasureLengthUnit } from '../../../measure/shared';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { Layer } from '../../../layer';\n\n@Component({\n  selector: 'igo-spatial-filter-list',\n  templateUrl: './spatial-filter-list.component.html',\n  styleUrls: ['./spatial-filter-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterListComponent implements OnInit, OnDestroy {\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  @Input()\n  get queryType(): SpatialFilterQueryType {\n    return this._queryType;\n  }\n  set queryType(queryType: SpatialFilterQueryType) {\n    this.formControl.setValue('');\n    this._queryType = queryType;\n  }\n  private _queryType: SpatialFilterQueryType;\n\n  @Input()\n  get zone() {\n    return this._zone;\n  }\n  set zone(value) {\n    this._zone = value;\n    if (!value) {\n      this.zoneWithBuffer = undefined;\n      this.bufferFormControl.setValue(0);\n    }\n  }\n  private _zone;\n\n  @Input() layers: Layer[] = [];\n\n  public zoneWithBuffer;\n  public selectedZone: any;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  public formControl = new FormControl();\n\n  public bufferFormControl = new FormControl();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  formValueChanges$$: Subscription;\n  bufferValueChanges$$: Subscription;\n\n  constructor(\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService,\n    private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe((value) => {\n      if (value.length) {\n        this.store.view.filter((feature) => {\n          const filterNormalized = value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n          const featureNameNormalized = feature.properties.nom.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n          return featureNameNormalized.includes(filterNormalized);\n        });\n      }\n    });\n\n    this.bufferValueChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(\n        debounceTime(500),\n        distinctUntilChanged()\n      )\n      .subscribe((value) => {\n        if (this.measureUnit === MeasureLengthUnit.Meters && value > 0 && value <= 100000) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.selectedZone,\n            SpatialFilterType.Predefined,\n            value,\n            this.queryType\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (this.measureUnit === MeasureLengthUnit.Kilometers && value > 0 && value <= 100) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.selectedZone,\n            SpatialFilterType.Predefined,\n            value * 1000,\n            this.queryType\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (value === 0 && this.layers.length > 0) {\n          this.bufferChange.emit(value);\n          this.zoneWithBufferChange.emit(this.selectedZone);\n        } else if (\n            value < 0 ||\n            (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n            (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)) {\n            this.bufferFormControl.setValue(0);\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.bufferAlert'),\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n        }\n    });\n  }\n\n  ngOnDestroy() {\n    this.formValueChanges$$.unsubscribe();\n  }\n\n  displayFn(feature?: Feature): string | undefined {\n    return feature ? feature.properties.nom : undefined;\n  }\n\n  onZoneChange(feature) {\n    if (feature && this.queryType) {\n      this.spatialFilterService.loadItemById(feature, this.queryType)\n      .subscribe((featureGeom: Feature) => {\n        this.selectedZone = featureGeom;\n        this.zoneChange.emit(featureGeom);\n      });\n    }\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      this.measureUnit === MeasureLengthUnit.Meters ?\n        this.bufferFormControl.setValue(this.bufferFormControl.value * 1000) :\n        this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\n    }\n  }\n}\n","<igo-geometry-form-field-input\n  [formControl]=\"formControl\"\n  [map]=\"map\"\n  [geometryType]=\"geometryType\"\n  [drawGuide]=\"drawGuide$ | async\"\n  [measure]=\"measure\"\n  [drawControlIsActive]=\"drawControlIsActive\"\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\n  [drawStyle]=\"drawStyle$ | async\"\n  [overlayStyle]=\"overlayStyle$ | async\"\n  [radius]=\"radius\">\n</igo-geometry-form-field-input>\n\n<div class=\"header\">\n    <mat-slide-toggle *ngIf=\"!isPredefined()\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onDrawControlChange()\">\n      {{'igo.geo.spatialFilter.drawControl' | translate}}\n    </mat-slide-toggle>\n    <mat-slide-toggle *ngIf=\"!isPredefined()\"\n      [checked]=\"freehandDrawIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onfreehandControlChange()\">\n      {{'igo.geo.spatialFilter.freehandControl' | translate}}\n    </mat-slide-toggle>\n</div>\n\n<div class=\"buffer-unit\" *ngIf=\"isPolygon()\">\n  <form class=\"buffer-form\">\n    <mat-form-field class=\"buffer\">\n      <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.buffer' | translate}}\" [formControl]=\"bufferFormControl\"\n      [value]=\"0\" [readonly]=\"this.formControl.value === null\">\n    </mat-form-field>\n  </form>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n    [value]=\"measureUnit\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n        {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<div class=\"radius-unit\" *ngIf=\"isPoint()\">\n  <form class=\"radius-form\">\n    <mat-form-field class=\"radius\">\n      <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.radius' | translate}}\" [formControl]=\"radiusFormControl\"\n      [value]=\"1000\" (input)=\"getRadius()\" [readonly]=\"this.freehandDrawIsActive && this.formControl.value === null\">\n    </mat-form-field>\n  </form>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n    [value]=\"measureUnit\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n        {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<mat-label class=\"title mat-typography\">{{'igo.geo.spatialFilter.search' | translate}} : </mat-label>\n<mat-radio-group [value]=\"selectedItemType\">\n    <mat-radio-button *ngFor=\"let item of itemType\"\n      [value]=\"item\"\n      (change)=\"onItemTypeChange($event)\">\n      {{'igo.geo.spatialFilter.' + item | translate}}\n    </mat-radio-button>\n</mat-radio-group>\n\n<div class=\"thematics\" *ngIf=\"(selectedItemType==='Thematics' && !tableTemplate) || (selectedItemType==='Thematics' && tableTemplate && !listIsVisible)\">\n  <mat-table>\n      <!-- Name Column -->\n      <ng-container matColumnDef=\"name\">\n        <mat-header-cell *matHeaderCellDef class=\"thematics-header\">{{'igo.geo.spatialFilter.Thematics' | translate}}</mat-header-cell>\n      </ng-container>\n\n      <!-- Select Column -->\n      <ng-container matColumnDef=\"select\">\n        <mat-header-cell *matHeaderCellDef class=\"checks-header\">\n          <mat-checkbox (change)=\"$event ? masterToggle() : null\"\n                        [checked]=\"isAllSelected()\"\n                        [indeterminate]=\"selectedThematics.hasValue() && !isAllSelected()\">\n          </mat-checkbox>\n        </mat-header-cell>\n    </ng-container>\n\n    <mat-header-row *matHeaderRowDef=\"displayedColumns\"></mat-header-row>\n    <mat-row *matRowDef=\"let row; columns: displayedColumns;\"></mat-row>\n\n  </mat-table>\n\n  <mat-tree [dataSource]=\"dataSource\" [treeControl]=\"treeControl\">\n    <!-- This is the tree node template for leaf nodes -->\n    <mat-tree-node *matTreeNodeDef=\"let node\" matTreeNodeToggle>\n      <li class=\"mat-tree-node\">\n        <!-- use a disabled button to provide padding for tree leaf -->\n        <button mat-icon-button disabled></button>\n        {{node.name}}\n        <mat-checkbox class=\"tree-check\" (click)=\"$event.stopPropagation()\"\n                      (change)=\"$event ? onToggleChange(node) : null\"\n                      [checked]=\"selectedThematics.isSelected(node)\">\n        </mat-checkbox>\n      </li>\n    </mat-tree-node>\n\n    <!-- This is the tree node template for expandable nodes -->\n    <mat-nested-tree-node *matTreeNodeDef=\"let node; when: hasChild\">\n        <div class=\"mat-tree-node\">\n          <button mat-icon-button\n            (click)=\"onToggleClick(node)\">\n            <mat-icon [svgIcon]=\"treeControl.isExpanded(node) ? 'chevron-down' : 'chevron-right'\"></mat-icon>\n          </button>\n          {{node.name}}\n          <mat-checkbox class=\"tree-check-2\" (change)=\"$event ? childrensToggle(node) : null\"\n                        [checked]=\"isAllSelected(node)\"\n                        [indeterminate]=\"hasChildrenSelected(node) && !isAllSelected(node)\">\n          </mat-checkbox>\n        </div>\n        <ul class=\"tree-ul\" [class.example-tree-invisible]=\"!treeControl.isExpanded(node)\">\n          <ng-container matTreeNodeOutlet></ng-container>\n        </ul>\n    </mat-nested-tree-node>\n\n  </mat-tree>\n</div>\n\n<div class=\"buttons\">\n\n  <button *ngIf=\"isPredefined()\" mat-raised-button class=\"clear-search-button\" [disabled]=\"disabledClearSearch()\"\n    (click)=\"clearSearch()\">\n      {{'igo.geo.spatialFilter.clearSearch' | translate}}\n  </button>\n\n  <button *ngIf=\"isPolygon() || isPoint()\" mat-raised-button class=\"clear-form-button\" [disabled]=\"this.formControl.value === null\"\n    (click)=\"clearDrawZone()\">\n    {{'igo.geo.spatialFilter.clearForm' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"search-button\" [disabled]=\"disableSearchButton()\" color=\"primary\"\n    (click)=\"toggleSearchButton()\">\n    {{'igo.geo.spatialFilter.goSearch' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"remove-button\" [disabled]=\"allLayers.length === 0\" (click)=\"clearButton()\">\n    {{'igo.geo.spatialFilter.removeLayer' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"export-button\" [disabled]=\"!store.entities$.getValue().length\" (click)=\"export.emit()\">\n    {{'igo.geo.spatialFilter.exportLayer' | translate}}\n  </button>\n\n</div>\n\n<button\n  class=\"chevron-down\"\n  *ngIf=\"store.all().length && tableTemplate && !listIsVisible\"\n  mat-icon-button\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.spatialFilter.showSearchResults' | translate\"\n  (click)=\"toggleVisibleList()\">\n  <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n</button>\n\n<div class=\"results\" *ngIf=\"store.all().length && tableTemplate && listIsVisible\">\n  <button\n    *ngIf=\"listIsVisible\"\n    mat-icon-button\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.spatialFilter.hideSearchResults' | translate\"\n    (click)=\"toggleVisibleList()\">\n  <mat-icon svgIcon=\"chevron-up\"></mat-icon>\n  </button>\n  <igo-entity-table\n    class=\"results-list\"\n    [template]=\"tableTemplate\"\n    [store]=\"store\"\n    (entitySelectChange)=\"entityChange.emit($event)\">\n  </igo-entity-table>\n</div>\n","import OlFeature from 'ol/Feature';\nimport {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { SpatialFilterQueryType, SpatialFilterType } from '../../shared/spatial-filter.enum';\nimport { SelectionModel } from '@angular/cdk/collections';\nimport { IgoMap } from '../../../map';\nimport { SpatialFilterItemType } from './../../shared/spatial-filter.enum';\nimport { Feature } from './../../../feature/shared/feature.interfaces';\nimport { FormControl } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { GeoJSONGeometry } from '../../../geometry/shared/geometry.interfaces';\nimport * as olStyle from 'ol/style';\nimport * as olproj from 'ol/proj';\nimport OlPoint from 'ol/geom/Point';\nimport { MatTreeNestedDataSource } from '@angular/material/tree';\nimport { SpatialFilterService } from '../../shared/spatial-filter.service';\nimport { MeasureLengthUnit } from '../../../measure';\nimport { EntityStore, EntityStoreFilterSelectionStrategy, EntityTableColumnRenderer, EntityTableTemplate } from '@igo2/common';\nimport { Layer, VectorLayer } from '../../../layer/shared';\nimport { NestedTreeControl } from '@angular/cdk/tree';\nimport { SpatialFilterThematic } from './../../shared/spatial-filter.interface';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { FeatureMotion, FeatureStoreSelectionStrategy } from '../../../feature';\nimport { FeatureDataSource } from '../../../datasource/shared';\n\n/**\n * Spatial-Filter-Item (search parameters)\n */\n@Component({\n  selector: 'igo-spatial-filter-item',\n  templateUrl: './spatial-filter-item.component.html',\n  styleUrls: ['./spatial-filter-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterItemComponent implements OnDestroy, OnInit {\n\n  @Input() map: IgoMap;\n\n  @Input()\n  get type(): SpatialFilterType {\n    return this._type;\n  }\n  set type(type: SpatialFilterType) {\n    this._type = type;\n    const index = this.geometryTypes.findIndex(geom => geom === this.type);\n    this.geometryType = this.geometryTypes[index];\n    this.formControl.reset();\n    this.radius = undefined;\n    this.drawGuide$.next(null);\n    this.drawStyle$.next(undefined);\n\n    // Necessary to keep reference to the geometry form field input\n    if (this.type === SpatialFilterType.Predefined) {\n      const geojson: GeoJSONGeometry = {\n        type: 'Point',\n        coordinates: ''\n      };\n      this.formControl.setValue(geojson);\n    }\n\n    // Necessary to apply the right style when geometry type is Point\n    if (this.type === SpatialFilterType.Point) {\n      this.radius = 1000; // Base radius\n      this.radiusFormControl.setValue(this.radius);\n      this.PointStyle = (feature: OlFeature<OlGeometry>, resolution: number) => {\n        const geom = feature.getGeometry() as OlPoint;\n        const coordinates = olproj.transform(geom.getCoordinates(), this.map.projection, 'EPSG:4326');\n        return new olStyle.Style ({\n          image: new olStyle.Circle ({\n            radius: this.radius / (Math.cos((Math.PI / 180) * coordinates[1])) / resolution, // Latitude correction\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          })\n        });\n      };\n      this.overlayStyle = this.PointStyle;\n      this.drawStyle$.next(this.overlayStyle);\n    } else {\n      // If geometry types is Polygon\n      this.radius = undefined;\n      this.PolyStyle = () => {\n        return new olStyle.Style ({\n          stroke: new olStyle.Stroke({\n            width: 2,\n            color: 'rgba(0, 153, 255)'\n          }),\n          fill: new olStyle.Fill({\n            color: 'rgba(0, 153, 255, 0.2)'\n          })\n        });\n      };\n      const color = [0, 153, 255];\n      const drawStyle = () => {\n        return new olStyle.Style({\n          image: new olStyle.Circle ({\n            radius: 8,\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          }),\n          stroke: new olStyle.Stroke({\n            color: color.concat([1]),\n            width: 2\n          }),\n          fill:  new olStyle.Fill({\n            color: color.concat([0.2])\n          })\n        });\n      };\n      this.overlayStyle = this.PolyStyle;\n      this.drawStyle$.next(drawStyle);\n    }\n    this.overlayStyle$.next(this.overlayStyle);\n  }\n  private _type: SpatialFilterType;\n\n  @Input() queryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() loading;\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n    this._store.entities$.subscribe(() => { this.cdRef.detectChanges(); });\n  }\n  private _store: EntityStore<Feature>;\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Input() layers: Layer[] = [];\n\n  @Input() allLayers: Layer[] = [];\n\n  @Input()\n  get thematicLength(): number {\n    return this._thematicLength;\n  }\n  set thematicLength(value: number) {\n    this._thematicLength = value;\n  }\n  private _thematicLength: number;\n\n  @Output() toggleSearch = new EventEmitter();\n\n  @Output() itemTypeChange = new EventEmitter<SpatialFilterItemType>();\n\n  @Output() thematicChange = new EventEmitter<SpatialFilterThematic[]>();\n\n  @Output() drawZoneEvent = new EventEmitter<Feature>();\n\n  @Output() bufferEvent = new EventEmitter<number>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  @Output() radiusEvent = new EventEmitter<number>();\n  @Output() freehandControl = new EventEmitter<boolean>();\n\n  @Output() clearButtonEvent = new EventEmitter();\n\n  @Output() clearSearchEvent = new EventEmitter();\n\n  @Output() export = new EventEmitter();\n\n  @Output() openWorkspace = new EventEmitter();\n  @Output() entityChange = new EventEmitter<any>();\n\n  public itemType: SpatialFilterItemType[] = [SpatialFilterItemType.Address, SpatialFilterItemType.Thematics];\n  public selectedItemType: SpatialFilterItemType = SpatialFilterItemType.Address;\n  public selectedSourceAddress;\n\n  treeControl: NestedTreeControl<SpatialFilterThematic> = new NestedTreeControl<SpatialFilterThematic>(node => node.children);\n\n  // For thematics and results tables\n  public displayedColumns: string[] = ['name', 'select'];\n  public childrens: SpatialFilterThematic[] = [];\n  public groups: string[] = [];\n  public thematics: SpatialFilterThematic[] = [];\n  public dataSource = new MatTreeNestedDataSource<SpatialFilterThematic>();\n  public selectedThematics = new SelectionModel<SpatialFilterThematic>(true, []);\n\n  // For geometry form field input\n  value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(undefined);\n  drawGuide$: BehaviorSubject<number> = new BehaviorSubject(null);\n  overlayStyle$: BehaviorSubject<olStyle.Style | ((feature, resolution) => olStyle.Style)> = new BehaviorSubject(undefined);\n  drawStyle$: BehaviorSubject<olStyle.Style | ((feature, resolution) => olStyle.Style)> = new BehaviorSubject(undefined);\n\n  private value$$: Subscription;\n  private radiusChanges$$: Subscription;\n  private bufferChanges$$: Subscription;\n\n  public formControl = new FormControl();\n  public geometryType: typeof OlGeometryType | string;\n  public geometryTypeField = false;\n  public geometryTypes: string[] = ['Point', 'Polygon'];\n  public drawGuideField = false;\n  public drawGuide: number = null;\n  public drawGuidePlaceholder = '';\n  public measure = false;\n  public drawControlIsActive = true;\n  public freehandDrawIsActive = false;\n  public drawStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public drawZone;\n  public overlayStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PointStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PolyStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n\n  public radius: number;\n  public buffer: number = 0;\n  public radiusFormControl = new FormControl();\n  public bufferFormControl = new FormControl();\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  public zoneWithBuffer;\n\n  public listIsVisible = true;\n  public tableTemplate: EntityTableTemplate;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService,\n    private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.spatialFilterService.loadThematicsList()\n    .subscribe((items: SpatialFilterThematic[]) => {\n      for (const item of items) {\n        this.childrens.push(item);\n        this.childrens.sort((a, b) => {\n          return a.name.localeCompare(b.name);\n        });\n      }\n      this.groups.push(this.languageService.translate.instant('igo.geo.terrapi.limites'));\n      const limits: SpatialFilterThematic = {\n        name: this.groups[0],\n        children: []\n      };\n      this.thematics.push(limits);\n      this.childrens.forEach(child => {\n        if (child.group && (this.groups.indexOf(child.group) === -1)) {\n          this.groups.push(child.group);\n          const thematic: SpatialFilterThematic = {\n            name: child.group,\n            children: []\n          };\n          this.thematics.push(thematic);\n        }\n\n        if (!child.group) {\n          if (\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.AdmRegion') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.Mun') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.Arrond') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.CircFed') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.CircProv') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.DirReg') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.MRC') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.RegTour')) {\n              child.group = limits.name;\n          } else if (child.name === this.languageService.translate.instant('igo.geo.terrapi.routes')) {\n            child.group = this.languageService.translate.instant('igo.geo.spatialFilter.group.transport');\n          } else {\n            const thematic: SpatialFilterThematic = {\n              name: child.name,\n              children: [],\n              source: child.source\n            };\n            this.thematics.push(thematic);\n          }\n        }\n        this.thematics.sort((a, b) => {\n          return a.name.localeCompare(b.name);\n        });\n      });\n      this.thematics.forEach(thematic => {\n        for (const child of this.childrens) {\n          if (child.group === thematic.name) {\n            thematic.children.push(child);\n          }\n        }\n      });\n    });\n\n    this.dataSource.data = this.thematics;\n\n    this.drawGuide$.next(null);\n    this.value$.next(this.formControl.value ? this.formControl.value : undefined);\n    this.value$$ = this.formControl.valueChanges.subscribe((value: GeoJSONGeometry) => {\n      if (value) {\n        this.value$.next(value);\n        this.drawZone = this.formControl.value as Feature;\n        if (this.buffer !== 0) {\n          this.drawZoneEvent.emit(this.drawZone);\n          this.bufferFormControl.setValue(this.buffer);\n        }\n      } else {\n        this.value$.next(undefined);\n        this.drawZone = undefined;\n      }\n    });\n\n    this.value$.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.radiusChanges$$ = this.radiusFormControl.valueChanges.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.bufferChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(\n        debounceTime(500)\n      )\n      .subscribe((value) => {\n        if (this.measureUnit === MeasureLengthUnit.Meters && value > 0 && value <= 100000) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.drawZone,\n            SpatialFilterType.Polygon,\n            value\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (this.measureUnit === MeasureLengthUnit.Kilometers && value > 0 && value <= 100) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.drawZone,\n            SpatialFilterType.Polygon,\n            value * 1000\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (value === 0) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.drawZoneEvent.emit(this.drawZone);\n        } else if (\n          value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)) {\n            this.bufferFormControl.setValue(0);\n            this.buffer = 0;\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.bufferAlert'),\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n        }\n    });\n\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map: this.map,\n      hitTolerance: 15,\n      motion: FeatureMotion.Default,\n      many: true,\n      dragBox: true\n    });\n\n    this.store.addStrategy(selectionStrategy, true);\n    this.store.addStrategy(selectedRecordStrategy, false);\n  }\n\n  /**\n   * Unsubscribe to the value stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.value$$.unsubscribe();\n    this.radiusChanges$$.unsubscribe();\n    this.bufferChanges$$.unsubscribe();\n    this.cdRef.detach();\n    if (this.radiusChanges$$) {\n      this.radiusChanges$$.unsubscribe();\n    }\n    if (this.value$$) {\n      this.value$$.unsubscribe();\n    }\n  }\n\n  onItemTypeChange(event) {\n    this.selectedItemType = event.value;\n    this.itemTypeChange.emit(this.selectedItemType);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      if (this.isPolygon()) {\n        this.measureUnit === MeasureLengthUnit.Meters ?\n          this.bufferFormControl.setValue(this.bufferFormControl.value * 1000) :\n          this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\n      } else if (this.isPoint()) {\n        this.measureUnit === MeasureLengthUnit.Meters ?\n          this.radiusFormControl.setValue(this.radiusFormControl.value * 1000) :\n          this.radiusFormControl.setValue(this.radiusFormControl.value / 1000);\n      }\n    }\n  }\n\n  isPredefined() {\n    return this.type === SpatialFilterType.Predefined;\n  }\n\n  isPolygon() {\n    return this.type === SpatialFilterType.Polygon;\n  }\n\n  isPoint() {\n    return this.type === SpatialFilterType.Point;\n  }\n\n  hasChild(_: number, node: SpatialFilterThematic) {\n    if (node.children) {\n      return node.children.length;\n    }\n    return false;\n  }\n\n  onToggleClick(node: SpatialFilterThematic) {\n    this.treeControl.isExpanded(node) ? this.treeControl.collapse(node) : this.treeControl.expand(node);\n  }\n\n  isAllSelected(node?: SpatialFilterThematic) {\n    let numSelected;\n    let numNodes = 0;\n    if (!node) {\n      numSelected = this.selectedThematics.selected.length;\n      this.thematics.forEach(thematic => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          numNodes++;\n        }\n      });\n      this.childrens.forEach(children => {\n        if (!this.thematics.find(thematic => thematic.source === children.source)) {\n          numNodes++;\n        }\n      });\n    } else {\n      numSelected = node.children.length;\n      node.children.forEach(children => {\n        if (this.selectedThematics.selected.find(thematic => thematic === children)) {\n          numNodes++;\n        }\n      });\n    }\n\n    if (numNodes >= 1) {\n      return numSelected === numNodes;\n    } else {\n      return false;\n    }\n  }\n\n  hasChildrenSelected(node: SpatialFilterThematic) {\n    let bool = false;\n    node.children.forEach(child => {\n      if (this.selectedThematics.selected.find(thematic => thematic.source === child.source)) {\n        bool = true;\n      }\n    });\n    return bool;\n  }\n\n  /**\n   * Apply header checkbox\n   */\n  masterToggle() {\n    this.isAllSelected() ?\n      this.selectedThematics.clear() :\n      this.selectAll();\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n\n    if (this.isAllSelected()) {\n      this.thematics.forEach(thematic => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.expand(thematic);\n        }\n      });\n    } else {\n      this.thematics.forEach(thematic => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.collapse(thematic);\n        }\n      });\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  selectAll(node?: SpatialFilterThematic) {\n    if (!node) {\n      this.thematics.forEach(thematic => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          this.selectedThematics.select(thematic);\n        }\n      });\n      this.childrens.forEach(children => {\n        if (!this.selectedThematics.selected.find(thematic => thematic.source === children.source)) {\n          this.selectedThematics.select(children);\n        }\n      });\n    } else {\n      if (this.hasChild(0, node)) {\n        node.children.forEach(children => this.selectedThematics.select(children));\n      }\n    }\n  }\n\n  childrensToggle(node: SpatialFilterThematic) {\n    this.isAllSelected(node) ?\n    node.children.forEach(child => this.selectedThematics.deselect(child)) :\n    this.selectAll(node);\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.treeControl.expand(node);\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  /**\n   * Apply changes to the thematics selected tree and emit event\n   */\n  onToggleChange(nodeSelected: SpatialFilterThematic) {\n    let selected = false;\n    if (this.selectedThematics.selected.find(thematic => thematic.source === nodeSelected.source) !== undefined) {\n      selected = true;\n    }\n\n    this.childrens.forEach(children => {\n      if (children === nodeSelected && selected === false) {\n        this.selectedThematics.select(children);\n      }\n      if (children === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(children);\n      }\n    });\n    this.thematics.forEach(thematic => {\n      if (thematic === nodeSelected && selected === false) {\n        this.selectedThematics.select(thematic);\n      }\n      if (thematic === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(thematic);\n      }\n    });\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  onDrawControlChange() {\n    this.drawControlIsActive = !this.drawControlIsActive;\n  }\n\n  onfreehandControlChange() {\n    this.freehandDrawIsActive = !this.freehandDrawIsActive;\n    this.freehandControl.emit(this.freehandDrawIsActive);\n  }\n\n  /**\n   * Launch search button\n   */\n  toggleSearchButton() {\n    if (!this.isPredefined()) {\n      if (this.buffer > 0) {\n        this.zoneWithBuffer.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.zoneWithBuffer.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.zoneWithBuffer);\n      } else {\n        this.drawZone.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.drawZone.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.drawZone);\n      }\n    }\n    if (this.isPoint()) {\n      this.radiusEvent.emit(this.radius);\n    } else if (this.isPolygon()) {\n      this.bufferEvent.emit(this.buffer);\n    }\n    this.toggleSearch.emit();\n    this.store.entities$.pipe(\n      debounceTime(500)\n    ).subscribe((value) => {\n      if (value.length && this.layers.length === this.thematicLength + 1) {\n        this.openWorkspace.emit();\n        this.createTableTemplate();\n      }\n    });\n  }\n\n  /**\n   * Launch clear button (clear store and map layers)\n   */\n  clearButton() {\n    this.loading = true;\n    if (this.store) {\n      this.store.clear();\n    }\n    if (this.isPoint() || this.isPolygon()) {\n      this.drawZone = undefined;\n      this.formControl.reset();\n    }\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.clearButtonEvent.emit();\n    this.loading = false;\n    this.tableTemplate = undefined;\n  }\n\n  clearDrawZone() {\n    this.formControl.reset();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n  }\n\n  /**\n   * Launch clear search (clear field if type is predefined)\n   */\n  clearSearch() {\n    this.selectedThematics.clear();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.thematicChange.emit([]);\n    this.clearSearchEvent.emit();\n  }\n\n  /**\n   * Verify conditions of incomplete fields or busy service\n   */\n  disableSearchButton(): boolean {\n    if (this.type === SpatialFilterType.Predefined) {\n      if (this.selectedItemType === SpatialFilterItemType.Address) {\n        if (this.queryType !== undefined && this.zone !== undefined) {\n          return this.loading;\n        }\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (this.queryType !== undefined && this.zone !== undefined && this.selectedThematics.selected.length > 0) {\n          return this.loading;\n        }\n      }\n    }\n    if (this.type === SpatialFilterType.Polygon || this.type === SpatialFilterType.Point) {\n      if (this.selectedItemType === SpatialFilterItemType.Address && this.formControl.value !== null) {\n        return this.loading;\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (this.selectedThematics.selected.length > 0 && this.formControl.value !== null) {\n          return this.loading;\n        }\n      }\n    }\n    return true;\n  }\n\n  disabledClearSearch() {\n    let disable = true;\n    this.selectedItemType === SpatialFilterItemType.Address ?\n      disable = this.queryType === undefined :\n      disable = this.queryType === undefined && this.selectedThematics.selected.length === 0;\n\n    return disable;\n  }\n\n  /**\n   * Manage radius value at user change\n   */\n  getRadius() {\n    let formValue;\n    if (this.formControl.value !== null) {\n      this.measureUnit === MeasureLengthUnit.Meters ?\n        formValue = this.formControl.value.radius :\n        formValue = this.formControl.value.radius / 1000;\n    } else {\n      formValue = undefined;\n    }\n\n    if (this.type === SpatialFilterType.Point) {\n      if (!this.freehandDrawIsActive) {\n        if (\n          this.radiusFormControl.value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && this.radiusFormControl.value >= 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && this.radiusFormControl.value >= 100)) {\n          this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.radiusAlert'),\n            this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n          this.radius = 1000;\n          this.measureUnit === MeasureLengthUnit.Meters ?\n            this.radiusFormControl.setValue(this.radius) :\n            this.radiusFormControl.setValue(this.radius / 1000);\n          this.drawGuide$.next(this.radius);\n          return;\n        }\n      } else {\n        if (formValue) {\n          if (formValue >= 100000) {\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.radiusAlert'),\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n            this.formControl.reset();\n            return;\n          }\n          if (formValue !== this.radiusFormControl.value) {\n            this.radiusFormControl.setValue(formValue);\n            return;\n          }\n        }\n      }\n      if (this.measureUnit === MeasureLengthUnit.Meters) {\n        this.radius = this.radiusFormControl.value;\n        this.drawGuide$.next(this.radius);\n      } else {\n        this.radius = this.radiusFormControl.value * 1000;\n        this.drawGuide$.next(this.radius * 1000);\n      }\n      this.overlayStyle$.next(this.PointStyle);\n      this.drawStyle$.next(this.PointStyle);\n    }\n  }\n\n  toggleVisibleList() {\n    this.listIsVisible = !this.listIsVisible;\n  }\n\n  private createTableTemplate() {\n    const typeColumn = {\n      name: 'meta.title',\n      title: this.languageService.translate.instant('igo.geo.spatialFilter.type'),\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\n    };\n    const nameColumn = {\n      name: 'properties.nom',\n      title: this.languageService.translate.instant('igo.geo.spatialFilter.searchResults'),\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\n    };\n    const columns = [typeColumn, nameColumn];\n\n    this.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n}\n","<div class=\"datetime-container\">\n  <mat-slide-toggle \n    *ngIf=\"this.currentFilter.sliderOptions?.enabled\"\n    [(ngModel)]=\"sliderMode\"\n    (change)=\"modeChange($event)\">\n    {{'igo.geo.filter.sliderModeTitle' | translate}}\n  </mat-slide-toggle>\n\n  <div class=\"slider-container\" *ngIf=\"sliderMode\">\n    <igo-ogc-filter-time-slider\n      [begin]=\"beginValue\"\n      [max]=\"this.restrictedToStep() ? this.maxDate : this.endValue\"\n      [currentFilter]=\"currentFilter\" \n      [datasource]=\"datasource\"\n      (changeProperty)=\"changePropertyByPass($event)\"\n    >\n    </igo-ogc-filter-time-slider>\n    \n  </div>\n\n  <div *ngIf=\"!sliderMode\">\n\n    <div class=\"year-input-container\" *ngIf=\"calendarTypeYear\">\n      <!-- to emulate a year-picker, 2 input: first input to show user just year and second input hiden and bind \n        with the datepicker  -->\n      <mat-form-field  class=\"year-input\">\n        <mat-label>{{'igo.geo.timeFilter.startYear'| translate}}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{onlyYearBegin}}\"\n          (change)= \"yearOnlyInputChange($event, beginDatepicker, 'begin')\"\n          [disabled]= \"filterStateDisable\"\n          >\n        <mat-datepicker-toggle matSuffix [for]=\"beginDatepicker\" [disabled]=\"filterStateDisable\"></mat-datepicker-toggle>\n  \n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #beginDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"beginValue\"\n          (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n          >\n        </mat-datepicker>\n\n        <input #beginYear\n          class= \"year-input-hide\"\n          matInput\n          [matDatepicker]=\"beginDatepicker\"\n          enabled= false\n          readonly= true\n          [value]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n          [min]=\"handleDate(datasource.options.minDate)\"\n          [max]=\"(endValue && (!restrictedToStep()))?endValue:handleDate(datasource.options.maxDate)\"\n          >\n      </mat-form-field>\n\n      <mat-form-field  class=\"year-input\">\n        <mat-label>{{'igo.geo.timeFilter.endYear'| translate}}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{onlyYearEnd}}\"\n          (change)= \"yearOnlyInputChange($event, endDatepicker, 'end')\"\n          [disabled] = \"filterStateDisable\">\n        <mat-datepicker-toggle matSuffix [for]=\"endDatepicker\" [disabled]=\"filterStateDisable\"></mat-datepicker-toggle>\n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #endDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"endValue\"\n          (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n          >\n        </mat-datepicker>\n\n        <input #endYear\n          class= \"year-input-hide\"\n          matInput\n          [matDatepicker]=\"endDatepicker\"\n          enabled= false\n          readonly= true\n          [value]=\"endValue?endValue:handleDate(datasource.options.maxDate)\"\n          [min]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n          [max]=\"handleDate(datasource.options.maxDate)\"\n          >\n      </mat-form-field>\n      <button class=\"reset-button\" \n        mat-icon-button\n        color=\"primary\" \n        (click)=\"resetFilter()\" \n        [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" \n        [disabled]= \"filterStateDisable\">\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n      </button>\n      <mat-slide-toggle \n        class='toggle-filter-state' \n        (change)=\"toggleFilterState()\" \n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" \n        tooltip-position=\"below\" \n        matTooltipShowDelay=\"500\"\n        [checked]=\"!filterStateDisable\">\n      </mat-slide-toggle>\n\n    </div>\n\n    <div class=\"datetime-input-container\" *ngIf=\"calendarType()!=='year'\">\n      <div class=\"datetime-input\">\n        <mat-form-field class=\"date-input\">\n          <mat-datepicker-toggle matSuffix [for]=\"beginDatepicker\" [disabled]= \"filterStateDisable\"></mat-datepicker-toggle>\n          <input #begin\n            matInput\n            [matDatepicker]=\"beginDatepicker\"\n            [placeholder]=\"'igo.geo.timeFilter.startDate' | translate\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (dateChange)=\"changeTemporalProperty(begin.value, 1)\"\n            [matDatepickerFilter]=\"dateFilter.bind(this, 'begin')\"\n            [value]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n            [min]=\"handleDate(datasource.options.minDate)\"\n            [max]=\"(endValue && (!restrictedToStep()))?endValue:handleDate(datasource.options.maxDate)\" \n            [disabled]= \"filterStateDisable\">\n          <span class=\"filler\"></span>\n          <mat-datepicker\n            #beginDatepicker\n            [startView]=\"calendarView()\"\n            [startAt]=\"beginValue\"\n            (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n            (monthSelected)=\"monthSelected($event, beginDatepicker, 'begin')\">\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div class=\"time-input\">\n          <mat-form-field class=\"hour-input\" *ngIf=\"calendarType()==='datetime'\">\n            <mat-label>{{'igo.geo.timeFilter.hour' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"beginHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\">\n              <mat-option *ngFor=\"let hour of beginHours\" [value]=\"hour\">{{hour}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" *ngIf=\"calendarType()==='datetime'\">\n            <mat-label>{{'igo.geo.timeFilter.minute' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"beginMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\">\n              <mat-option *ngFor=\"let minute of beginMinutes\" [value]=\"minute\">{{minute}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <div class=\"datetime-input\" *ngIf=\"!restrictedToStep()\">\n        <mat-form-field class=\"date-input\">\n          <mat-datepicker-toggle matSuffix [for]=\"endDatepicker\" [disabled]= \"filterStateDisable\"></mat-datepicker-toggle>\n            <input #end\n              matInput\n              [matDatepicker]=\"endDatepicker\"\n              [placeholder]=\"'igo.geo.timeFilter.endDate' | translate\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (dateChange)=\"changeTemporalProperty(end.value, 2)\"\n              [matDatepickerFilter]=\"dateFilter.bind(this, 'end')\"\n              [value]=\"endValue?endValue:handleDate(datasource.options.maxDate)\"\n              [min]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n              [max]=\"handleDate(datasource.options.maxDate)\" \n              [disabled]= \"filterStateDisable\">\n            <span class=\"filler\"></span>\n            <mat-datepicker #endDatepicker\n              [startView]=\"calendarView()\"\n              [startAt]=\"endValue\"\n              (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n              (monthSelected)=\"monthSelected($event, endDatepicker, 'end')\">\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div class=\"time-input\">\n          <mat-form-field class=\"hour-input\" *ngIf=\"calendarType()==='datetime'\" >\n            <mat-label>{{'igo.geo.timeFilter.hour' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"endHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\">\n              <mat-option *ngFor=\"let hour of endHours\" [value]=\"hour\">{{hour}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" *ngIf=\"calendarType()==='datetime'\">\n            <mat-label>{{'igo.geo.timeFilter.minute' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"endMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\">\n              <mat-option *ngFor=\"let minute of endMinutes\" [value]=\"minute\">{{minute}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <button class=\"reset-button\" \n        mat-icon-button color=\"primary\"\n        (click)=\"resetFilter()\" \n        [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" \n        [disabled]= \"filterStateDisable\">\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n      </button>\n      <mat-slide-toggle \n        class=\"toggle-filter-state\" \n        (change)=\"toggleFilterState()\" \n        tooltip-position=\"below\" \n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" \n        [checked]= \"!filterStateDisable\">\n      </mat-slide-toggle>\n    </div>\n  </div>\n</div>\n","import {\n  Component,\n  Input,\n  ViewChild,\n  ElementRef,\n  Output,\n  EventEmitter,\n  OnInit\n} from '@angular/core';\nimport { FormControl } from '@angular/forms';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\nimport {\n  OgcFilterableDataSourceOptions,\n  OgcFilterableDataSource,\n  OgcFilterDuringOptions\n} from '../shared/ogc-filter.interface';\n\nimport * as moment_ from 'moment';\nconst moment = moment_;\n\n@Component({\n  selector: 'igo-ogc-filter-time',\n  templateUrl: './ogc-filter-time.component.html',\n  styleUrls: ['./ogc-filter-time.component.scss']\n})\nexport class OgcFilterTimeComponent implements OnInit {\n  @Input() datasource: OgcFilterableDataSource;\n  @Input() currentFilter: any;\n  @Output() changeProperty: EventEmitter<{\n    value: string;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n\n  beginHours: number[];\n  endHours: number[];\n  beginMinutes: number[];\n  endMinutes: number[];\n  beginHourFormControl = new FormControl();\n  beginMinuteFormControl = new FormControl();\n  endHourFormControl = new FormControl();\n  endMinuteFormControl = new FormControl();\n  _beginValue: Date;\n  _endValue: Date;\n  readonly _defaultMin: string = '1900-01-01';\n  readonly _defaultMax: string = '2052-01-06';\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderModeEnabled: boolean = true;\n  ogcFilterOperator = OgcFilterOperator;\n  public sliderMode = false;\n\n  readonly defaultStepMillisecond = 60000;\n  public options: OgcFilterableDataSourceOptions;\n\n  public onlyYearBegin: number;\n  public onlyYearEnd: number;\n  public calendarTypeYear = false;\n  public resetIcon = 'replay';\n  public filterStateDisable: boolean;\n\n  @ViewChild('endDatepickerTime') endDatepickerTime: ElementRef;\n  @ViewChild('beginDatepickerTime') beginDatepickerTime: ElementRef;\n  @ViewChild('beginTime') beginTime: HTMLInputElement;\n  @ViewChild('endTime') endTime: HTMLInputElement;\n\n  get step(): string {\n    return this.datasource.options.stepDate\n      ? this.datasource.options.stepDate\n      : this.currentFilter.step;\n  }\n\n  get stepMilliseconds(): number {\n    const step = moment.duration(this.step).asMilliseconds();\n    return step === 0 ? this.defaultStepMillisecond : step;\n  }\n\n  set beginValue(begin: Date) {\n    this._beginValue = begin;\n  }\n\n  get beginValue(): Date {\n    return this._beginValue;\n  }\n\n  set endValue(end: Date) {\n    this._endValue = end;\n  }\n\n  get endValue(): Date {\n    return this._endValue;\n  }\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? 2000\n      : this.currentFilter.sliderInterval;\n  }\n\n  get maxDate(): string {\n    return this.datasource.options.maxDate ? this.datasource.options.maxDate : this._defaultMax;\n  }\n\n  get displayFormat(): string {\n    return this.currentFilter.displayFormat ? this.currentFilter.displayFormat : this._defaultDisplayFormat;\n  }\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {}\n\n  ngOnInit(){\n    if (this.currentFilter.sliderOptions) {\n      this.currentFilter.sliderOptions.enabled = this.currentFilter.sliderOptions.enabled !== undefined ?\n        this.currentFilter.sliderOptions.enabled : this._defaultSliderModeEnabled;\n    }\n    this.beginValue = this.parseFilter(this.handleMin());\n    this.endValue = this.parseFilter(this.handleMax());\n\n    this.onlyYearBegin = this.beginValue.getUTCFullYear();\n    this.onlyYearEnd = this.endValue.getUTCFullYear();\n    this.calendarTypeYear = this.isCalendarYearMode();\n    this.setFilterStateDisable();\n    this.updateHoursMinutesArray();\n    // update value for now value\n    this.updateValues();\n  }\n\n  parseFilter(filter): Date {\n    if (!filter){\n      return new Date();\n    } else if ( isNaN( new Date(filter).getTime() ) ){\n      if (filter.search('now') >= 0 ){\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if (filter.match(/\\+/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.search('+') + 1, interval.index),\n            10\n          );\n          return moment().add(intervalInt, interval[0]).toDate();\n        }\n        if (filter.match(/\\-/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.search('-') + 1, interval.index),\n            10\n          );\n          return moment().subtract(intervalInt, interval[0]).toDate();\n        }\n        return new Date();\n      }\n      if (filter.search('today') >= 0){\n        const _now = moment().endOf('day').toDate();\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if ( filter.match(/\\+/) ) {\n          const intervalInt = parseInt( filter.substring(filter.search('+') + 1, interval.index), 10 );\n          return moment(_now).add(intervalInt, interval[0]).toDate();\n        }\n        if ( filter.match(/\\-/) ) {\n          const intervalInt = parseInt(filter.substring(filter.search('-') + 1, interval.index), 10);\n          return moment(_now).subtract(intervalInt, interval[0]).toDate();\n        }\n        return _now;\n      }\n      return new Date();\n    }\n    if (this.currentFilter.calendarModeYear) {\n      const date = this.getDateFromStringWithoutTime(filter);\n      return date;\n    } else {\n      return filter ? new Date(filter) : new Date();\n    }\n  }\n\n  changeTemporalProperty(value, position?, refreshFilter = true) {\n    let valueTmp = this.getDateTime(value, position);\n    if (this.isCalendarYearMode()) {\n      let dateStringFromYearNotime;\n      if (position === 1) {\n        this.beginValue = value;\n        this.onlyYearBegin = this.beginValue.getFullYear();\n        dateStringFromYearNotime = `${this.onlyYearBegin}-01-01`;\n      } else {\n        this.endValue = value;\n        this.onlyYearEnd = this.endValue.getFullYear();\n        dateStringFromYearNotime = `${this.onlyYearEnd}-01-01`;\n      }\n      // call service with string date without time\n      this.changeProperty.next({ value: dateStringFromYearNotime, pos: position, refreshFilter });\n      return;\n    }\n    if (position === 2 && this.calendarType() === 'date' && !this.sliderMode) {\n      /* Above month: see yearSelected or monthSelected */\n      valueTmp = moment(valueTmp).endOf('day').toDate();\n    }\n\n    if (position === 1) {\n      this.beginValue = valueTmp;\n      if (this.restrictedToStep()) {\n        this.changeTemporalProperty(this.ogcFilterTimeService.addStep(valueTmp, this.stepMilliseconds), 2, refreshFilter);\n      }\n    } else {\n      this.endValue = valueTmp;\n    }\n    this.updateHoursMinutesArray();\n    this.changeProperty.next({ value: valueTmp.toISOString(), pos: position, refreshFilter });\n  }\n\n  handleDate(value): Date {\n    if (!value || value === '') {\n      return undefined;\n    }\n    if (typeof(value) === 'string' && this.currentFilter.calendarModeYear) {\n      return this.getDateFromStringWithoutTime(value);\n    }\n    return new Date(value);\n  }\n\n  calendarType() {\n    if (this.currentFilter.calendarModeYear) {\n      return 'year';\n    }\n    if (this.stepMilliseconds < 86400000) {\n      return 'datetime';\n    }\n    return 'date';\n  }\n\n  isCalendarYearMode(): boolean {\n    if (this.calendarType() === 'year') {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  yearOnlyInputChange(changeEvent, datePicker?: any, property?: string) {\n    const year = changeEvent.target.value;\n    const date = this.getDateFromStringWithoutTime(year);\n    this.yearSelected(date, datePicker, property);\n  }\n\n  yearSelected(year, datePicker?: any, property?: string, refreshFilter = true) {\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        // change value 01 jan to 31 dec same year\n        year = moment(year).endOf('year').toDate();\n      } else if (property === 'begin' && this.restrictedToStep() && !this.calendarTypeYear) {\n        this.yearSelected(year, undefined, 'end');\n      }\n      this.changeTemporalProperty(year, property === 'begin' ? 1 : 2, refreshFilter);\n    }\n  }\n\n  monthSelected(month, datePicker?: any, property?: string, refreshFilter = true) {\n    if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        month = moment(month).endOf('month').toDate();\n      } else if (property === 'begin' && this.restrictedToStep()) {\n        this.monthSelected(month, undefined, 'end');\n      }\n      this.changeTemporalProperty(month, property === 'begin' ? 1 : 2, refreshFilter);\n    }\n  }\n\n  calendarView() {\n    const test = this.stepMilliseconds;\n    const diff = Math.abs(\n      this.parseFilter(this.currentFilter.end).getTime() -\n        this.parseFilter(this.currentFilter.begin).getTime()\n    );\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      return 'multi-year';\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      return 'year';\n    } else if (test < 86400000 && diff < 86400000) {\n      return 'clock';\n    } else {\n      return 'month';\n    }\n  }\n\n  dateFilter(type: string, date: string): boolean {\n    const dateValue = new Date(date);\n    const diff = dateValue.getTime() - new Date(this.handleMin()).getTime();\n\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(moment(this.handleMin()), 'years', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'years', true);\n        return (monthDiffPlus1 % moment.duration(this.step).asYears()) === 0;\n      } else if ( type === 'begin' ) {\n        return (monthDiff % moment.duration(this.step).asYears()) === 0;\n      }\n    }\n    else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(moment(this.handleMin()), 'months', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'months', true);\n        return (monthDiffPlus1 % moment.duration(this.step).asMonths()) === 0;\n      } else if ( type === 'begin' ) {\n        return (monthDiff % moment.duration(this.step).asMonths()) === 0;\n      }\n    } else if (this.ogcFilterTimeService.stepIsWeekDuration(this.step)) {\n      const weekDiff = moment(dateValue).diff(moment(this.handleMin()), 'weeks', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const weekDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'weeks', true);\n        return (weekDiffPlus1 % moment.duration(this.step).asWeeks()) === 0;\n      } else if ( type === 'begin' ) {\n        return (weekDiff % moment.duration(this.step).asWeeks()) === 0;\n      }\n    } else if (this.ogcFilterTimeService.stepIsDayDuration(this.step)) {\n      const dayDiff = moment(dateValue).diff(moment(this.handleMin()), 'days', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const dayDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'days', true);\n        const _mod = (dayDiffPlus1 % moment.duration(this.step).asDays());\n        return (_mod < 0.0000001 && _mod > -0.0000001) || _mod === 0 ; // 1 millisecond = 1.1574074074074076e-8\n      } else if ( type === 'begin' ) {\n        const _mod = ((dayDiff % moment.duration(this.step).asDays()) + 1);\n        return (_mod < 0.0000001 && _mod > -0.0000001 && _mod !== 0) || _mod === 1 ; // 1 millisecond = 1.1574074074074076e-8\n      }\n    } else if ( this.ogcFilterTimeService.stepIsHourDuration(this.step) ) {\n      const hourDiff = moment(dateValue).diff(moment(this.handleMin()), 'hours', true);\n      return (hourDiff % moment.duration(this.step).asHours()) === 0;\n\n    } else if ( this.ogcFilterTimeService.stepIsMinuteDuration(this.step) ) {\n      return true;\n    }\n\n    return diff % this.stepMilliseconds === 0;\n  }\n\n  getDateTime(date, pos) {\n    const valuetmp = new Date(date);\n    let valuetmp2;\n    if (!this.sliderMode) {\n      switch (pos) {\n        case 1: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n            this.beginHourFormControl.value,\n            this.beginMinuteFormControl.value\n            );\n            break;\n          }\n        }\n        case 2: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n              this.endHourFormControl.value,\n              this.endMinuteFormControl.value\n            );\n            break;\n          }\n        }\n      }\n    }\n    return new Date(valuetmp2 ? valuetmp2 : valuetmp);\n  }\n\n  handleMinuteIncrement() {\n    if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\n      if (this.stepMilliseconds < 3600000) {\n        return this.stepMilliseconds / 1000 === 60 ? 1 : this.stepMilliseconds / 1000;\n      } else {\n        return (this.stepMilliseconds % 3600000) / 60;\n      }\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return 60;\n    }\n    return 1;\n  }\n\n  handleHourIncrement() {\n    if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return this.stepMilliseconds / 1000 / 60 / 60;\n    }\n    return 1;\n  }\n\n  fullBeginHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginHours = Array.from(\n        {\n          length:\n            (this.endHourFormControl.value - 0) / this.handleHourIncrement() + 1\n        },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    } else {\n      this.beginHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.beginHourFormControl.setValue(this.beginValue.getHours());\n  }\n\n  fullEndHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endHours = Array.from(\n        {\n          length:\n            (23 - this.beginHourFormControl.value) /\n              this.handleHourIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginHourFormControl.value + i * this.handleHourIncrement()\n      );\n    } else {\n      this.endHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.endHourFormControl.setValue(this.endValue.getHours());\n  }\n\n  fullBeginMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginMinutes = Array.from(\n        {\n          length:\n            (this.endMinuteFormControl.value - 0) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.beginMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.beginMinuteFormControl.setValue(this.beginValue.getMinutes());\n  }\n\n  fullEndMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endMinutes = Array.from(\n        {\n          length:\n            (59 - this.beginMinuteFormControl.value) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginMinuteFormControl.value + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.endMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.endMinuteFormControl.setValue(this.endValue.getMinutes());\n  }\n\n  updateHoursMinutesArray() {\n    const beginTmp = new Date(this.beginValue);\n    const endTmp = new Date(this.endValue);\n    if (beginTmp.setHours(0, 0) === endTmp.setHours(0, 0)) {\n      this.fullBeginHoursArray(true);\n      this.fullEndHoursArray(true);\n      if (this.beginValue.getHours() === this.endValue.getHours()) {\n        this.fullBeginMinutesArray(true);\n        this.fullEndMinutesArray(true);\n      }\n    } else {\n      this.fullBeginHoursArray();\n      this.fullEndHoursArray();\n      this.fullBeginMinutesArray();\n      this.fullEndMinutesArray();\n    }\n  }\n\n  private updateValues() {\n    this.changeTemporalProperty(this.beginValue, 1, false);\n    this.changeTemporalProperty(this.endValue, 2, true);\n  }\n\n  public restrictedToStep(): boolean {\n    return this.currentFilter.restrictToStep\n      ? this.currentFilter.restrictToStep : false;\n  }\n\n  public handleMin() {\n    return this.currentFilter.begin ? this.currentFilter.begin :\n              (this.datasource.options.minDate ? this.datasource.options.minDate : this._defaultMin);\n  }\n\n  public handleMax() {\n    return this.currentFilter.end ? this.currentFilter.end :\n              (this.datasource.options.maxDate ? this.datasource.options.maxDate : this._defaultMax);\n  }\n\n  changePropertyByPass(event) {\n    this.changeProperty.next(event);\n  }\n\n  modeChange(event) {\n    if (!event.checked) {\n      this.updateValues();\n    }\n  }\n\n  setFilterStateDisable() {\n    if (this.currentFilter) {\n      this.filterStateDisable = !this.currentFilter.active;\n    } else {\n      this.filterStateDisable = false;\n    }\n    if(this.calendarType() === 'datetime') {\n      if (this.filterStateDisable === true) {\n        this.beginHourFormControl.disable();\n        this.beginMinuteFormControl.disable();\n        this.endHourFormControl.disable();\n        this.endMinuteFormControl.disable();\n      } else {\n        this.beginHourFormControl.enable();\n        this.beginMinuteFormControl.enable();\n        this.endHourFormControl.enable();\n        this.endMinuteFormControl.enable();\n      }\n    }\n  }\n  getDateFromStringWithoutTime(stringDate: string): Date {\n    // warning create date with no time make a date UTC with TZ and the date create maybe not the same year, month and day\n    // exemple:\n    // new Date('2022-01-01') -> Fri Dec 31 2021 19:00:00 GMT-0500 (heure normale de lEst nord-amricain)\n    // to create same date as string, add time 00 in the creation\n    // new Date('2022-01-01 00:00:00') -> Sat Jan 01 2022 00:00:00 GMT-0500 (heure normale de lEst nord-amricain)\n    let year;\n    let month = '01';\n    let day = '01';\n    if (stringDate.length === 10) {\n       const dateItems = stringDate.split('-');\n        if (dateItems.length !== 3) {\n          throw new Error('Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY');\n        } else {\n          year = dateItems[0];\n          month = dateItems[1];\n          day = dateItems[2];\n        }\n    } else if (stringDate.length === 4) {\n      year = stringDate;\n    } else {\n      return new Date(stringDate);\n    }\n    return new Date(`${year}-${month}-${day} 00:00:00`);\n  }\n\n  resetFilter() {\n    let filterOriginConfig = this.datasource.options.ogcFilters.filters as OgcFilterDuringOptions;\n\n    let minDefaultDate;\n    let maxDefaultDate;\n    let minDefaultISOString;\n    let maxDefaultISOString;\n\n    if (this.calendarTypeYear) {\n      if (filterOriginConfig.end === 'today') {\n        let todayDateStringNoTime = new Date().toLocaleDateString('en-CA'); // '2022-02-13'\n        maxDefaultISOString = `${todayDateStringNoTime.substring(0,4)}-01-01`;\n      } else {\n        maxDefaultISOString = `${filterOriginConfig.end.substring(0,4)}-01-01`;\n      }\n      minDefaultISOString = `${filterOriginConfig.begin.substring(0,4)}-01-01`;\n      minDefaultDate = this.getDateFromStringWithoutTime(minDefaultISOString);\n      maxDefaultDate = this.getDateFromStringWithoutTime(maxDefaultISOString);\n    } else {\n      minDefaultDate = this.parseFilter(filterOriginConfig.begin);\n      maxDefaultDate = this.parseFilter(filterOriginConfig.end);\n      minDefaultISOString = minDefaultDate.toISOString();\n      maxDefaultISOString = maxDefaultDate.toISOString();\n    }\n\n    if ((this.currentFilter.begin !== minDefaultISOString ) ||\n    (this.currentFilter.end !== maxDefaultISOString)) {\n      this.beginValue = minDefaultDate;\n      this.endValue = maxDefaultDate;\n      this.updateValues();\n    }\n  }\n\n  toggleFilterState() {\n    if (this.currentFilter.active === true) {\n      this.currentFilter.active = false;\n    } else {\n      this.currentFilter.active = true;\n    }\n    this.setFilterStateDisable();\n    this.updateValues();\n  }\n}\n","import {\n  Component,\n  Input,\n  ViewChild,\n  Output,\n  EventEmitter,\n  OnInit\n} from '@angular/core';\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\n\nimport * as moment_ from 'moment';\nimport { MatSlider } from '@angular/material/slider';\nconst moment = moment_;\n\n@Component({\n  selector: 'igo-ogc-filter-time-slider',\n  templateUrl: './ogc-filter-time-slider.component.html',\n  styleUrls: ['./ogc-filter-time-slider.component.scss']\n})\nexport class OgcFilterTimeSliderComponent implements OnInit {\n  @Input() currentFilter: any;\n  @Input() begin: any;\n  @Input() max: any;\n  @Input() datasource: any;\n  @Output() changeProperty: EventEmitter<{\n    value: any;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n  @ViewChild(MatSlider) slider: MatSlider;\n\n  interval;\n  sliderValue: number = 1;\n  calculatedStep: number = 0;\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderInterval: number = 2000;\n  public playIcon = 'play-circle';\n  public resetIcon = 'replay';\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? this._defaultSliderInterval\n      : this.currentFilter.sliderInterval;\n  }\n\n  get displayFormat(): string {\n    if (this.currentFilter.sliderOptions?.displayFormat){\n      return this.currentFilter.sliderOptions.displayFormat;\n    }\n    if (this.currentFilter.displayFormat) {\n      return this.currentFilter.displayFormat;\n    }\n    return this._defaultDisplayFormat;\n  }\n\n  get beginMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.begin);\n  }\n\n  get maxMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.max);\n  }\n\n  get stepMillisecond(): number {\n    return this.ogcFilterTimeService.stepMillisecond(this.datasource, this.currentFilter);\n  }\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {\n    this.sliderDisplayWith = this.sliderDisplayWith.bind(this);\n  }\n\n  ngOnInit(){\n    this.calculateStep();\n    this.handleSliderInput({value: 1});\n  }\n\n  sliderDisplayWith(value) {\n    let dateTmp = new Date(this.beginMillisecond + ((value - 1) * this.stepMillisecond));\n\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter))) {\n      const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).years();\n      dateTmp = moment(this.beginMillisecond).add((value - 1) * toAdd, 'year').toDate();\n    } else if ( this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter))) {\n      const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).months();\n      dateTmp = moment(this.beginMillisecond).add((value - 1) * toAdd, 'month').toDate();\n    }\n\n    return moment(dateTmp).format(this.displayFormat);\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(\n        that => {\n\n          if (this.slider.value < this.calculatedStep) {\n            const _increment = '_increment';\n            const _emitInputEvent = '_emitInputEvent';\n            this.slider[_increment](1);\n            this.slider[_emitInputEvent]();\n          } else {\n            this.stopFilter();\n          }\n        },\n        this.sliderInterval,\n        this\n      );\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n  }\n\n  resetFilter(event: any) {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n    this.slider.value = 1;\n    const _increment = '_increment';\n    const _emitInputEvent = '_emitInputEvent';\n    this.slider[_emitInputEvent]();\n  }\n\n  handleSliderInput(matSliderChange) {\n    if (matSliderChange) {\n\n      if ( this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n        const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).years();\n        const dateBeginTmp = moment(this.beginMillisecond).add((matSliderChange.value - 1) * toAdd, 'year').toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'year').toDate();\n        this.changeProperty.next({value: moment(dateBeginTmp).toDate().toISOString(),\n                                    pos: 1, refreshFilter: false});\n        this.changeProperty.next({value: moment(dateEndTmp).toDate().toISOString(),\n                                    pos: 2, refreshFilter: true});\n\n      } else if ( this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n        const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).months();\n        const dateBeginTmp = moment(this.beginMillisecond).add((matSliderChange.value - 1) * toAdd, 'month').toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'month').toDate();\n        this.changeProperty.next({value: moment(dateBeginTmp).startOf('month').toDate().toISOString(),\n                                    pos: 1, refreshFilter: false});\n        this.changeProperty.next({value: moment(dateEndTmp).toDate().toISOString(),\n                                    pos: 2, refreshFilter: true});\n\n      } else if ( this.ogcFilterTimeService.stepIsDayDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ||\n          this.ogcFilterTimeService.stepIsHourDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ||\n          this.ogcFilterTimeService.stepIsMinuteDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n            const dateTmp = new Date(this.beginMillisecond + (this.stepMillisecond * (matSliderChange.value - 1)));\n            this.changeProperty.next({value: dateTmp.toISOString(), pos: 1, refreshFilter: false});\n            this.changeProperty.next({value: new Date(this.ogcFilterTimeService.addStep(dateTmp.toISOString(),\n                                        this.stepMillisecond)).toISOString(),\n                                        pos: 2, refreshFilter: true});\n      }\n    }\n  }\n\n  calculateStep(){\n    for (let i = 1; (this.maxMillisecond - (this.beginMillisecond + (i * this.stepMillisecond))) >= -1; i++) {\n      this.calculatedStep = i;\n    }\n  }\n\n}\n","<div class=\"slider-container\">\n  <mat-slider\n    id=\"time-slider\"\n    [step]=\"1\"\n    [min]=\"1\"\n    [max]=\"calculatedStep\"\n    [(ngModel)]=\"sliderValue\"\n    [displayWith]=\"sliderDisplayWith\"\n    (input)=\"handleSliderInput($event)\"\n    thumbLabel\n    >\n  </mat-slider>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n    <mat-icon [svgIcon]=\"playIcon\"></mat-icon>\n  </button>\n  <button mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\n    <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n  </button>\n  \n</div>","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule, MatNativeDateModule, MAT_DATE_LOCALE } from '@angular/material/core';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatSliderModule } from '@angular/material/slider';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatTreeModule } from '@angular/material/tree';\n\nimport {\n  MatDatetimepickerModule,\n  MatNativeDatetimeModule\n} from '@mat-datetimepicker/core';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoCollapsibleModule,\n  IgoListModule,\n  IgoKeyValueModule,\n  IgoEntityModule,\n  IgoDOMModule\n} from '@igo2/common';\nimport { IgoGeometryModule } from './../geometry/geometry.module';\n\nimport { FilterableDataSourcePipe } from './shared/filterable-datasource.pipe';\nimport { IgoLayerModule } from '../layer/layer.module';\nimport { TimeFilterButtonComponent } from './time-filter-button/time-filter-button.component';\nimport { TimeFilterFormComponent } from './time-filter-form/time-filter-form.component';\nimport { TimeFilterItemComponent } from './time-filter-item/time-filter-item.component';\nimport { TimeFilterListBindingDirective } from './time-filter-list/time-filter-list-binding.directive';\nimport { TimeFilterListComponent } from './time-filter-list/time-filter-list.component';\nimport { TimeFilterService } from './shared/time-filter.service';\n\nimport { OgcFilterFormComponent } from './ogc-filter-form/ogc-filter-form.component';\nimport { OgcFilterableFormComponent } from './ogc-filterable-form/ogc-filterable-form.component';\nimport { OgcFilterableItemComponent } from './ogc-filterable-item/ogc-filterable-item.component';\nimport { OgcFilterableListBindingDirective } from './ogc-filterable-list/ogc-filterable-list-binding.directive';\nimport { OgcFilterableListComponent } from './ogc-filterable-list/ogc-filterable-list.component';\nimport { OgcFilterButtonComponent } from './ogc-filter-button/ogc-filter-button.component';\nimport { OGCFilterService } from './shared/ogc-filter.service';\nimport { OGCFilterTimeService } from './shared/ogc-filter-time.service';\nimport { OgcFilterSelectionComponent } from './ogc-filter-selection/ogc-filter-selection.component';\n\nimport { SpatialFilterTypeComponent } from './spatial-filter/spatial-filter-type/spatial-filter-type.component';\nimport { SpatialFilterListComponent } from './spatial-filter/spatial-filter-list/spatial-filter-list.component';\nimport { SpatialFilterItemComponent } from './spatial-filter/spatial-filter-item/spatial-filter-item.component';\nimport { SpatialFilterService } from './shared/spatial-filter.service';\nimport { OgcFilterTimeComponent } from './ogc-filter-time/ogc-filter-time.component';\nimport { OgcFilterTimeSliderComponent } from './ogc-filter-time/ogc-filter-time-slider.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatAutocompleteModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTabsModule,\n    MatRadioModule,\n    MatMenuModule,\n    MatTableModule,\n    MatTreeModule,\n    MatButtonToggleModule,\n    MatCheckboxModule,\n    MatSliderModule,\n    MatSlideToggleModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatOptionModule,\n    MatSelectModule,\n    MatListModule,\n    MatTooltipModule,\n    MatDatepickerModule,\n    MatNativeDateModule,\n    MatDatetimepickerModule,\n    MatNativeDatetimeModule,\n    IgoLanguageModule,\n    IgoLayerModule,\n    IgoCollapsibleModule,\n    IgoListModule,\n    IgoEntityModule,\n    IgoDOMModule,\n    IgoKeyValueModule,\n    IgoGeometryModule,\n    MatBadgeModule\n  ],\n  exports: [\n    FilterableDataSourcePipe,\n    TimeFilterButtonComponent,\n    TimeFilterFormComponent,\n    TimeFilterItemComponent,\n    TimeFilterListComponent,\n    TimeFilterListBindingDirective,\n    OgcFilterFormComponent,\n    OgcFilterButtonComponent,\n    OgcFilterSelectionComponent,\n    OgcFilterableFormComponent,\n    OgcFilterableItemComponent,\n    OgcFilterableListComponent,\n    OgcFilterableListBindingDirective,\n    SpatialFilterTypeComponent,\n    SpatialFilterListComponent,\n    SpatialFilterItemComponent,\n    OgcFilterTimeComponent,\n    OgcFilterTimeSliderComponent\n  ],\n  declarations: [\n    FilterableDataSourcePipe,\n    TimeFilterButtonComponent,\n    TimeFilterFormComponent,\n    TimeFilterItemComponent,\n    TimeFilterListComponent,\n    TimeFilterListBindingDirective,\n    OgcFilterFormComponent,\n    OgcFilterButtonComponent,\n    OgcFilterSelectionComponent,\n    OgcFilterableFormComponent,\n    OgcFilterableItemComponent,\n    OgcFilterableListComponent,\n    OgcFilterableListBindingDirective,\n    SpatialFilterTypeComponent,\n    SpatialFilterListComponent,\n    SpatialFilterItemComponent,\n    OgcFilterTimeComponent,\n    OgcFilterTimeSliderComponent\n  ],\n  providers: [TimeFilterService, OGCFilterService, OGCFilterTimeService, SpatialFilterService]\n})\nexport class IgoFilterModule {\n  static forRoot(): ModuleWithProviders<IgoFilterModule> {\n    return {\n      ngModule: IgoFilterModule,\n      providers: [\n        {\n          provide: MAT_DATE_LOCALE,\n          useValue: 'fr-FR'\n        }\n      ]\n    };\n  }\n}\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const ExportFormat = strEnum(['URL', 'GeoJSON', 'GML', 'GPX', 'KML', 'Shapefile', 'CSVcomma', 'CSVsemicolon']);\nexport type ExportFormat = keyof typeof ExportFormat;\n\nexport const EncodingFormat = strEnum(['UTF8', 'LATIN1']);\nexport type EncodingFormat = keyof typeof EncodingFormat;\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport { downloadContent } from '@igo2/utils';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport * as olformat from 'ol/format';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport {encode} from 'windows-1252';\n\nimport { ExportFormat, EncodingFormat } from './export.type';\n\nimport {\n  ExportInvalidFileError,\n  ExportNothingToExportError\n} from './export.errors';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ExportService {\n  static ogreFormats = {\n    GML: 'gml',\n    GPX: 'gpx',\n    KML: 'kml',\n    Shapefile: 'ESRI Shapefile',\n    CSVcomma: 'CSVcomma',\n    CSVsemicolon: 'CSVsemicolon'\n  };\n\n  static noOgreFallbacks = ['GML', 'GPX', 'KML'];\n\n  private ogreUrl: string;\n  private aggregateInComment: boolean = true;\n\n  constructor(private config: ConfigService) {\n    this.ogreUrl = this.config.getConfig('importExport.url');\n    const gpxAggregateInComment = this.config.getConfig(\n      'importExport.gpxAggregateInComment'\n    );\n    if (gpxAggregateInComment !== undefined) {\n      this.aggregateInComment = gpxAggregateInComment;\n    }\n  }\n\n  export(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<void> {\n    const exportOlFeatures = this.generateFeature(olFeatures, format);\n\n    return this.exportAsync(exportOlFeatures, format, title, encoding, projectionIn, projectionOut);\n  }\n\n  private generateFeature(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat\n  ): OlFeature<OlGeometry>[] {\n    if (format === ExportFormat.GPX && this.aggregateInComment) {\n      return this.generateAggregatedFeature(olFeatures);\n    }\n\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      const keys = olFeature\n        .getKeys()\n        .filter((key: string) => !key.startsWith('_'));\n      const properties = keys.reduce(\n        (acc: object, key: string) => {\n          acc[key] = olFeature.get(key);\n          return acc;\n        },\n        { geometry: olFeature.getGeometry() }\n      );\n      return new OlFeature(properties);\n    });\n  }\n\n  private generateAggregatedFeature(olFeatures: OlFeature<OlGeometry>[]): OlFeature<OlGeometry>[] {\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      const keys = olFeature.getKeys().filter((key: string) => !key.startsWith('_'));\n      let comment: string = '';\n      const properties = keys.reduce((acc: object, key: string) => {\n        if (key && key !== 'geometry') {\n          key === 'id' && olFeature.get('draw') ? comment += key + ':' + olFeature.get('draw') + '   \\r\\n'\n          : comment += key + ':' + olFeature.get(key) + '   \\r\\n';\n        }\n        acc[key] = olFeature.get(key);\n        return acc;\n      },\n      {\n        geometry: olFeature.getGeometry()\n      });\n      const newFeature = new OlFeature(properties);\n      newFeature.set('name', olFeature.getId());\n      newFeature.set('cmt', comment);\n\n      return newFeature;\n    });\n  }\n\n  private exportAsync(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<void> {\n    const doExport = (observer: Observer<void>) => {\n      const nothingToExport = this.nothingToExport(olFeatures, format);\n      if (nothingToExport) {\n        observer.error(new ExportNothingToExportError());\n        return;\n      }\n\n      const ogreFormats = Object.keys(ExportService.ogreFormats);\n      if (ogreFormats.indexOf(format) >= 0) {\n        if (!this.ogreUrl) {\n          if (ExportService.noOgreFallbacks.indexOf(format) >= 0) {\n            this.exportToFile(olFeatures, observer, format, title, projectionIn, projectionOut);\n          } else {\n            observer.error(new ExportInvalidFileError());\n          }\n          return;\n        }\n        this.exportWithOgre(olFeatures, observer, format, title, encoding, projectionIn, projectionOut);\n      } else {\n        this.exportToFile(olFeatures, observer, format, title, projectionIn, projectionOut);\n      }\n    };\n\n    return new Observable(doExport);\n  }\n\n  protected exportToFile(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: ExportFormat,\n    title: string,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const olFormat = new olformat[format]();\n    const featuresText = olFormat.writeFeatures(olFeatures, {\n      dataProjection: projectionOut,\n      featureProjection: projectionIn,\n      featureType: 'feature',\n      featureNS: 'http://example.com/feature'\n    });\n\n    const fileName = `${title}.${format.toLowerCase()}`;\n\n    downloadContent(featuresText, 'text/plain;charset=utf-8', fileName);\n    observer.complete();\n  }\n\n  private exportWithOgre(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: string,\n    title: string,\n    encodingType: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    let featuresText: string = new olformat.GeoJSON().writeFeatures(\n      olFeatures,\n      {\n        dataProjection: projectionOut,\n        featureProjection: projectionIn\n      }\n    );\n\n    const url = `${this.ogreUrl}/convertJson`;\n    const form = document.createElement('form');\n    form.style.display = 'none';\n    document.body.appendChild(form);\n    form.setAttribute('method', 'post');\n    form.setAttribute('target', '_blank');\n    form.setAttribute('action', url);\n\n    if (encodingType === EncodingFormat.UTF8) {\n      form.acceptCharset = 'UTF-8';\n      form.enctype = 'application/x-www-form-urlencoded; charset=utf-8;';\n    } else if (encodingType === EncodingFormat.LATIN1) {\n      const enctype = 'ISO-8859-1';\n      const featuresJson = JSON.parse(featuresText);\n      featuresJson.features.map(f => {\n        const encodedProperties = String.fromCharCode\n          .apply(null, encode(JSON.stringify(f.properties), { mode: 'replacement' }));\n        f.properties = JSON.parse(encodedProperties);\n      });\n      featuresText = JSON.stringify(featuresJson);\n      const encoding = document.createElement('input');\n      encoding.setAttribute('type', 'hidden');\n      encoding.setAttribute('name', 'encoding');\n      encoding.setAttribute('value', enctype);\n      form.appendChild(encoding);\n    }\n\n    if (format === 'CSVsemicolon') {\n      const options = document.createElement('input');\n      options.setAttribute('type', 'hidden');\n      options.setAttribute('name', 'lco');\n      options.setAttribute('value', 'SEPARATOR=SEMICOLON');\n      form.appendChild(options);\n    }\n\n    const geojsonField = document.createElement('input');\n    geojsonField.setAttribute('type', 'hidden');\n    geojsonField.setAttribute('name', 'json');\n    geojsonField.setAttribute('value', featuresText);\n    form.appendChild(geojsonField);\n\n    const outputNameField = document.createElement('input');\n    let outputName = format === 'Shapefile' ? `${title}.zip` : `${title}.${format.toLowerCase()}`;\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      outputName = `${title}.csv`;\n    }\n    outputName = outputName.replace(' ', '_');\n    outputName = outputName.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n    outputNameField.setAttribute('type', 'hidden');\n    outputNameField.setAttribute('name', 'outputName');\n    outputNameField.setAttribute('value', outputName);\n    form.appendChild(outputNameField);\n\n    let ogreFormat = ExportService.ogreFormats[format];\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      ogreFormat = 'CSV';\n    }\n    const outputFormatField = document.createElement('input');\n    outputFormatField.setAttribute('type', 'hidden');\n    outputFormatField.setAttribute('name', 'format');\n    outputFormatField.setAttribute('value', ogreFormat);\n    form.appendChild(outputFormatField);\n\n    form.submit();\n    document.body.removeChild(form);\n\n    observer.complete();\n  }\n\n  private nothingToExport(olFeatures: OlFeature<OlGeometry>[], format: string): boolean {\n    if (olFeatures.length === 0) {\n      return true;\n    }\n    if (format === 'GPX') {\n      const pointOrLine = olFeatures.find(olFeature => {\n        return (\n          ['Point', 'LineString', 'MultiLineString'].indexOf(olFeature.getGeometry().getType()) >= 0\n        );\n      });\n      return pointOrLine === undefined;\n    }\n    return false;\n  }\n}\n","/**\n * Trigger download of a file\n *\n * @param content File content\n * @param mimeType File mime type\n * @param fileName File name\n */\nexport function downloadContent(content: string, mimeType: string, fileName: string) {\n  const uri = `data:${mimeType},${encodeURIComponent(content)}`;\n  downloadFromUri(uri, fileName);\n}\n\n/**\n * Trigger download of a file\n *\n * @param content File content\n * @param mimeType File mime type\n * @param fileName File name\n */\nexport function downloadFromUri(uri: string, fileName: string) {\n  const element = document.createElement('a');\n  element.setAttribute('href', uri);\n  element.setAttribute('download', fileName);\n  element.style.display = 'none';\n  document.body.appendChild(element);\n\n  element.click();\n\n  document.body.removeChild(element);\n}\n","import * as olStyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { MessageService, LanguageService } from '@igo2/core';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { FeatureDataSourceOptions } from '../../datasource/shared/datasources/feature-datasource.interface';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  featureToOl,\n  moveToOlFeatures\n} from '../../feature/shared/feature.utils';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { StyleByAttribute } from '../../layer/shared/vector-style.interface';\nimport { StyleListService } from '../style-list/style-list.service';\nimport { ClusterParam } from '../../layer/shared/clusterParam';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { ClusterDataSourceOptions } from '../../datasource/shared/datasources/cluster-datasource.interface';\nimport { uuid } from '@igo2/utils';\n\nexport function addLayerAndFeaturesToMap(\n  features: Feature[],\n  map: IgoMap,\n  layerTitle: string\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n    type: 'vector',\n    queryable: true\n  };\n  const source = new FeatureDataSource(sourceOptions);\n  source.ol.addFeatures(olFeatures);\n  const layer = new VectorLayer({\n    title: layerTitle,\n    isIgoInternalLayer: true,\n    source,\n    style: createImportedLayerRandomStyle()\n  });\n  map.addLayer(layer);\n  moveToOlFeatures(map, olFeatures);\n\n  return layer;\n}\n\nexport function addLayerAndFeaturesStyledToMap(\n  features: Feature[],\n  map: IgoMap,\n  layerTitle: string,\n  styleListService: StyleListService,\n  styleService: StyleService,\n  layerId?: string,\n  imposedSourceOptions?,\n  imposedLayerOptions?,\n  zoomTo: boolean = true\n\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n  let style;\n  let distance: number;\n\n  if (\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\n  ) {\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\n      layerTitle.toString() + '.styleByAttribute'\n    );\n\n    style = (feature, resolution) => {\n      return styleService.createStyleByAttribute(feature, styleByAttribute, resolution);\n    };\n  } else if (\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      layerTitle.toString() + '.clusterParam'\n    );\n    distance = styleListService.getStyleList(\n      layerTitle.toString() + '.distance'\n    );\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList(layerTitle.toString() + '.clusterStyle'), feature, resolution\n      );\n      return styleService.createClusterStyle(feature, resolution, clusterParam, baseStyle);\n    };\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\n    style = (feature, resolution) => styleService.createStyle(\n      styleListService.getStyleList(layerTitle.toString() + '.style'), feature, resolution\n    );\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      'default.clusterParam'\n    );\n    distance = styleListService.getStyleList('default.distance');\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList('default.clusterStyle'), feature, resolution\n      );\n      return styleService.createClusterStyle(feature, resolution, clusterParam, baseStyle);\n    };\n  } else {\n    style = (feature, resolution) => styleService.createStyle(\n      styleListService.getStyleList('default.style'), feature, resolution\n    );\n  }\n\n  let source;\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\n    const sourceOptions: ClusterDataSourceOptions &\n      QueryableDataSourceOptions = {\n      distance,\n      type: 'cluster',\n      queryable: true\n    };\n    source = new ClusterDataSource(Object.assign(sourceOptions, imposedSourceOptions));\n    source.ol.source.addFeatures(olFeatures);\n  } else if (styleListService.getStyleList(layerTitle.toString())) {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n      type: 'vector',\n      queryable: true\n    };\n    source = new FeatureDataSource(Object.assign(sourceOptions, imposedSourceOptions));\n    source.ol.addFeatures(olFeatures);\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const sourceOptions: ClusterDataSourceOptions &\n      QueryableDataSourceOptions = {\n      distance,\n      type: 'cluster',\n      queryable: true\n    };\n    source = new ClusterDataSource(Object.assign(sourceOptions, imposedSourceOptions));\n    source.ol.source.addFeatures(olFeatures);\n  } else {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n      type: 'vector',\n      queryable: true\n    };\n    source = new FeatureDataSource(Object.assign(sourceOptions, imposedSourceOptions));\n    source.ol.addFeatures(olFeatures);\n  }\n\n  const layer = new VectorLayer(\n    Object.assign({\n      title: layerTitle,\n      id: layerId || uuid(),\n      isIgoInternalLayer: true,\n      source,\n      style\n    }, imposedLayerOptions));\n  map.addLayer(layer);\n  if (zoomTo){\n    moveToOlFeatures(map, olFeatures);\n  }\n  return layer;\n}\n\nexport function handleFileImportSuccess(\n  file: File,\n  features: Feature[],\n  map: IgoMap,\n  messageService: MessageService,\n  languageService: LanguageService,\n  styleListService?: StyleListService,\n  styleService?: StyleService\n) {\n  if (features.length === 0) {\n    handleNothingToImportError(file, messageService, languageService);\n    return;\n  }\n\n  const layerTitle = computeLayerTitleFromFile(file);\n\n  if (!styleListService) {\n    addLayerAndFeaturesToMap(features, map, layerTitle);\n  } else {\n    addLayerAndFeaturesStyledToMap(\n      features,\n      map,\n      layerTitle,\n      styleListService,\n      styleService\n    );\n  }\n\n  const translate = languageService.translate;\n  const messageTitle = translate.instant('igo.geo.dropGeoFile.success.title');\n  const message = translate.instant('igo.geo.dropGeoFile.success.text', {\n    value: layerTitle\n  });\n  messageService.success(message, messageTitle);\n}\n\nexport function handleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService,\n  sizeMb?: number\n) {\n  sizeMb = sizeMb ? sizeMb : 30;\n  const errMapping = {\n    'Invalid file': handleInvalidFileImportError,\n    'File is too large': handleSizeFileImportError,\n    'Failed to read file': handleUnreadbleFileImportError,\n    'Invalid SRS definition': handleSRSImportError,\n    'Error 500 with OGRE': handleOgreServerImportError\n  };\n  errMapping[error.message](\n    file,\n    error,\n    messageService,\n    languageService,\n    sizeMb\n  );\n}\n\nexport function handleInvalidFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.invalid.title');\n  const message = translate.instant('igo.geo.dropGeoFile.invalid.text', {\n    value: file.name,\n    mimeType: file.type\n  });\n  messageService.error(message, title);\n}\n\nexport function handleUnreadbleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.unreadable.title');\n  const message = translate.instant('igo.geo.dropGeoFile.unreadable.text', {\n    value: file.name\n  });\n  messageService.error(message, title);\n}\n\nexport function handleSizeFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService,\n  sizeMb: number\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.tooLarge.title');\n  const message = translate.instant('igo.geo.dropGeoFile.tooLarge.text', {\n    value: file.name,\n    size: sizeMb\n  });\n  messageService.error(message, title);\n}\n\nexport function handleNothingToImportError(\n  file: File,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.empty.title');\n  const message = translate.instant('igo.geo.dropGeoFile.empty.text', {\n    value: file.name,\n    mimeType: file.type\n  });\n  messageService.error(message, title);\n}\n\nexport function handleSRSImportError(\n  file: File,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.invalidSRS.title');\n  const message = translate.instant('igo.geo.dropGeoFile.invalidSRS.text', {\n    value: file.name,\n    mimeType: file.type\n  });\n  messageService.error(message, title);\n}\n\nexport function handleOgreServerImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const title = languageService.translate.instant('igo.geo.dropGeoFile.ogreServer.title');\n  const message = languageService.translate.instant('igo.geo.dropGeoFile.ogreServer.text');\n  messageService.error(message, title);\n}\n\nexport function getFileExtension(file: File): string {\n  return file.name\n    .split('.')\n    .pop()\n    .toLowerCase();\n}\n\nexport function computeLayerTitleFromFile(file: File): string {\n  return file.name.substr(0, file.name.lastIndexOf('.'));\n}\nfunction createImportedLayerRandomStyle(): (olFeature: OlFeature<OlGeometry>) => olStyle.Style {\n  const r = Math.floor(Math.random() * 255);\n  const g = Math.floor(Math.random() * 255);\n  const b = Math.floor(Math.random() * 255);\n  const stroke = new olStyle.Stroke({\n    color: [r, g, b, 1],\n    width: 2\n  });\n  const fill = new olStyle.Fill({\n    color: [r, g, b, 0.4]\n  });\n\n  return (olFeature: OlFeature<OlGeometry>) => {\n      const customStyle = olFeature.get('_style');\n      if (customStyle) {\n        const styleService = new StyleService();\n        return styleService.createStyle(customStyle);\n      }\n\n      const style = new olStyle.Style({\n        stroke,\n        fill,\n        image: new olStyle.Circle({\n          radius: 5,\n          stroke,\n          fill\n        }),\n        text: olFeature.get('_mapTitle') ? new olStyle.Text({\n          text: olFeature.get('_mapTitle').toString(),\n          offsetX: 5,\n          offsetY: -5,\n          font: '12px Calibri,sans-serif',\n          fill: new olStyle.Fill({ color: '#000' }),\n          stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\n          overflow: true\n        }): undefined\n      });\n      return style;\n  };\n}\n\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n      super('Failed to read file');\n      Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n      super('Nothing to import');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n      super('File is too large');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n      super('Invalid SRS definition');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportOgreServerError extends ImportError {\n  constructor() {\n      super('Error 500 with OGRE');\n      Object.setPrototypeOf(this, ImportOgreServerError.prototype);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\nimport { uuid } from '@igo2/utils';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport * as olformat from 'ol/format';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  ImportInvalidFileError,\n  ImportUnreadableFileError,\n  ImportSizeError,\n  ImportSRSError,\n  ImportOgreServerError\n} from './import.errors';\nimport { computeLayerTitleFromFile, getFileExtension } from './import.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ImportService {\n  static allowedMimeTypes = [\n    'application/gml+xml',\n    'application/vnd.google-earth.kml+xml',\n    'application/gpx+xml',\n    'application/json'\n  ];\n\n  static allowedZipMimeTypes = [\n    'application/zip',\n    'application/x-zip-compressed',\n    'application/x-zip'\n  ];\n\n  static allowedExtensions = ['geojson', 'kml', 'gpx', 'json', 'gml'];\n\n  private ogreUrl: string;\n  private clientSideFileSizeMax: number;\n\n  constructor(private http: HttpClient, private config: ConfigService) {\n    this.ogreUrl = this.config.getConfig('importExport.url');\n    const configFileSizeMb = this.config.getConfig('importExport.clientSideFileSizeMaxMb');\n    this.clientSideFileSizeMax = (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n  }\n\n  import(\n    file: File,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<Feature[]> {\n    return this.importAsync(file, projectionIn, projectionOut);\n  }\n\n  private getFileImporter(\n    file: File\n  ): (\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) => void {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n    const allowedMimeTypes = [\n      ...ImportService.allowedMimeTypes,\n      ...ImportService.allowedZipMimeTypes\n    ];\n    const allowedExtensions = ImportService.allowedExtensions;\n\n    if (\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\n      allowedExtensions.indexOf(extension) < 0\n    ) {\n      return undefined;\n    } else if (\n      mimeType === 'application/json' ||\n      ['json', 'geojson', 'kml', 'gpx'].indexOf(extension) >= 0\n    ) {\n      return this.importFile;\n    } else if (this.ogreUrl !== undefined) {\n      return this.importFileWithOgre;\n    }\n\n    return undefined;\n  }\n\n  private importAsync(\n    file: File,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<Feature[]> {\n    const doImport = (observer: Observer<Feature[]>) => {\n      if (file.size >= this.clientSideFileSizeMax) {\n        observer.error(new ImportSizeError());\n        return;\n      }\n      const importer = this.getFileImporter(file);\n      if (importer === undefined) {\n        observer.error(new ImportInvalidFileError());\n        return;\n      }\n\n      importer.call(this, file, observer, projectionIn, projectionOut);\n    };\n\n    return new Observable(doImport);\n  }\n\n  private importFile(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const reader = new FileReader();\n\n    reader.onload = (event: any) => {\n      try {\n        const features = this.parseFeaturesFromFile(\n          file,\n          event.target.result,\n          projectionIn,\n          projectionOut\n        );\n        observer.next(features);\n      } catch (e) {\n        observer.error(new ImportUnreadableFileError());\n      }\n\n      observer.complete();\n    };\n\n    reader.onerror = evt => {\n      observer.error(new ImportUnreadableFileError());\n    };\n\n    reader.readAsText(file, 'UTF-8');\n  }\n\n  private importFileWithOgre(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const url = `${this.ogreUrl}/convert`;\n    const formData = new FormData();\n    formData.append('upload', file);\n    formData.append('sourceSrs', projectionIn);\n    formData.append('targetSrs', projectionOut);\n    formData.append('formatOutput', 'GEOJSON');\n    formData.append('skipFailures', '');\n\n    this.http.post(url, formData, { headers: new HttpHeaders() })\n    .subscribe(\n      (response: { errors?: string[] } | object | null) => {\n        if (response === null) {\n          observer.error(new ImportUnreadableFileError());\n          return;\n        }\n\n        const errors = (response as any).errors || [];\n        if (errors.length > 0) {\n          observer.error(new ImportUnreadableFileError());\n        } else {\n          const features = this.parseFeaturesFromGeoJSON(\n            file,\n            response,\n            projectionOut\n          );\n          observer.next(features);\n          observer.complete();\n        }\n      },\n      (error: any) => {\n        error.error.caught = true;\n        const errMsg = error.error.msg || '';\n        if (errMsg === 'No valid files found') {\n          observer.error(new ImportInvalidFileError());\n        } else if (errMsg && errMsg.startWith('ERROR 1: Failed to process SRS definition')\n        ) {\n          observer.error(new ImportSRSError());\n        } else if (error.status === 500) {\n          observer.error(new ImportOgreServerError());\n        } else {\n          observer.error(new ImportUnreadableFileError());\n        }\n      }\n    );\n  }\n\n  private parseFeaturesFromFile(\n    file: File,\n    data: string,\n    projectionIn: string,\n    projectionOut: string\n  ): Feature[] {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n\n    const GeoJSON = new olformat.GeoJSON();\n\n    let format;\n    if (mimeType === 'application/vnd.google-earth.kml+xml') {\n      format = new olformat.KML();\n    } else if (mimeType === 'application/gml+xml') {\n      format = new olformat.GML();\n    } else if (mimeType === 'application/gpx+xml') {\n      format = new olformat.GPX();\n    } else {\n      switch (extension) {\n        case 'kml':\n          format = new olformat.KML();\n          break;\n        case 'gpx':\n          format = new olformat.GPX();\n          break;\n        case 'gml':\n          format = new olformat.GML();\n          break;\n        default:\n          format = GeoJSON;\n          break;\n      }\n    }\n\n    const olFeatures = format.readFeatures(data, {\n      dataProjection: projectionIn,\n      featureProjection: projectionOut\n    });\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(GeoJSON.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features;\n  }\n\n  private parseFeaturesFromGeoJSON(\n    file: File,\n    data: object,\n    projectionOut: string\n  ): Feature[] {\n    const olFormat = new olformat.GeoJSON();\n    const olFeatures = olFormat.readFeatures(data);\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(olFormat.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features as Feature[];\n  }\n}\n","import { Injectable, Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { StyleListOptions } from './style-list.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleListService {\n  private styleList: object = {};\n\n  constructor(private injector: Injector) {}\n\n  /**\n   * Use to get the data found in styleList file\n   */\n  public getStyleList(key: string): any {\n    return ObjectUtils.resolve(this.styleList, key);\n  }\n\n  /**\n   * This method loads \"[path]\" to get all styleList's variables\n   */\n  public load(options: StyleListOptions) {\n    const baseStyleList = options.default || {};\n    if (!options.path) {\n      this.styleList = baseStyleList;\n      return true;\n    }\n\n    const http = this.injector.get(HttpClient);\n\n    return new Promise((resolve, _reject) => {\n      http\n        .get(options.path)\n        .pipe(\n          catchError((error: any): any => {\n            console.log(`StyleList file ${options.path} could not be read`);\n            resolve(true);\n            return throwError(error.error || 'Server error');\n          })\n        )\n        .subscribe((styleListResponse: object) => {\n          this.styleList = ObjectUtils.mergeDeep(baseStyleList, styleListResponse);\n          resolve(true);\n        });\n    });\n  }\n}\n","<div class=\"import-export-toggle mat-typography\">\n  <mat-button-toggle-group\n        [value]=\"selectedMode\"\n        (change)=\"onImportExportChange($event)\">\n        <mat-button-toggle [value]=\"'import'\">\n          {{'igo.geo.importExportForm.importTabTitle' | translate}}\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"'export'\">\n          {{'igo.geo.importExportForm.exportTabTitle' | translate}}\n        </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<form class=\"igo-form\" [formGroup]=\"importForm\" *ngIf=\"selectedMode === 'import'\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.importProjPlaceholder' | translate}}</mat-label>\n      <mat-select\n        [(value)]=\"inputProj\">\n        <mat-option\n          *ngFor=\"let projection of (projections$ | async)\"\n          [value]=\"projection\"\n          (click)=\"$event.stopPropagation()\">\n          <p mat-line *ngIf=\"projection.translateKey\">{{('igo.geo.importExportForm.projections.' + projection.translateKey) | translate: projection}}</p>\n          <p mat-line *ngIf=\"!projection.translateKey\">{{projection.alias}}</p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"importForm.invalid ? ('igo.geo.importExportForm.projections.choose' | translate) : ('igo.geo.importExportForm.importButton' | translate)\"\n    class=\"igo-form-button-group\">\n    <button\n      [disabled]=\"importForm.invalid || (loading$ | async)\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"fileInput.click()\">\n        {{'igo.geo.importExportForm.importButton' | translate}}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n    <input\n      hidden\n      #fileInput\n      type=\"file\"\n      [style.display]=\"'none'\"\n      (click)=\"fileInput.value = null\"\n      (change)=\"importFiles($event.target.files)\">\n  </div>\n</form>\n<section class=\"mat-typography\" *ngIf=\"selectedMode === 'import'\">\n  <h4>{{'igo.geo.importExportForm.importClarifications' | translate}}</h4>\n  <ul>\n    <li>{{'igo.geo.importExportForm.importSizeMax' | translate: {size: fileSizeMb} }}</li>\n    <li>{{'igo.geo.importExportForm.importFormatAuthorized' | translate}}</li>\n    <li>{{'igo.geo.importExportForm.importShpZip' | translate}}</li>\n  </ul>\n</section>\n\n<section class=\"mat-typography\" *ngIf=\"(exportableLayers$ | async).length === 0 && selectedMode === 'export'\">\n  <h4>{{'igo.geo.importExportForm.exportNoLayersExportable' | translate}}</h4>\n</section>\n\n<form class=\"igo-form\" [formGroup]=\"form\" *ngIf=\"(exportableLayers$ | async).length > 0 && selectedMode === 'export'\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.exportLayerPlaceholder' | translate}}</mat-label>\n      <mat-select\n        [(value)]=\"layers\" multiple>\n        <mat-select-trigger>\n          {{layers.length ? getLayerTitleById(layers[0]) : ''}}\n          <span *ngIf=\"layers.length > 1\" class=\"export-select-trigger\">\n            (+{{layers.length - 1}} {{(layers?.length === 2 ? 'igo.geo.importExportForm.other' : 'igo.geo.importExportForm.others') | translate }})\n          </span>\n        </mat-select-trigger>\n        <mat-option\n          *ngFor=\"let layer of (exportableLayers$ | async)\"\n          [ngClass]=\"{'igo-export-layer-mat-option': layerHasSelectedFeatures(layer)}\"\n          [value]=\"layer.id\"\n          (click)=\"$event.stopPropagation()\">\n          <p mat-line>{{layer.title}}</p>\n          <p mat-line>\n            <mat-slide-toggle *ngIf=\"layerHasSelectedFeatures(layer)\"\n              [labelPosition]=\"'after'\"\n              (click)=\"onlySelectedClick($event,layer.id)\"\n              (checked)=\"inLayersIdToExportSelectionOnly(layer)\"\n              (change)=\"onlySelected($event,layer.id)\">\n              <small>{{'igo.geo.importExportForm.exportSelectedFeature' | translate}}</small>\n            </mat-slide-toggle>\n          </p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.exportFormatPlaceholder' | translate}}</mat-label>\n      <mat-select\n        formControlName=\"format\">\n        <ng-container *ngIf=\"(formats$ | async).length !== 0\">\n          <mat-option *ngFor=\"let format of (formats$ | async) | keyvalue\" [value]=\"format.key\">\n            {{'igo.geo.export.format.' + format.value | translate}}\n          </mat-option>\n        </ng-container>\n        <mat-option *ngIf=\"(formats$ | async).length === 0\" disabled=\"true\">\n          {{'igo.geo.export.noFormat.title' | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" *ngIf=\"forceNaming && form.value.format !== 'URL'\">\n    <mat-form-field>\n        <input matInput formControlName=\"name\" placeholder=\"{{'igo.geo.importExportForm.exportFileNamePlaceholder' | translate}}\">\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" *ngIf=\"form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon'\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.encodingPlaceholder' | translate}}</mat-label>\n      <mat-select\n        formControlName=\"encoding\">\n        <ng-container *ngIf=\"(encodings$ | async).length !== 0\">\n          <mat-option *ngFor=\"let encoding of (encodings$ | async) | keyvalue\" [value]=\"encoding.key\">\n            {{'igo.geo.export.encoding.' + encoding.value | translate}}\n          </mat-option>\n        </ng-container>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"export-combine-layers mat-typography\" *ngIf=\"layers.length > 1 && (form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon')\">\n    <mat-slide-toggle\n        formControlName=\"combineLayers\"\n        [labelPosition]=\"'before'\">\n          {{'igo.geo.importExportForm.exportCombineResults' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"export-separator mat-typography\" *ngIf=\"layers.length > 1 && (form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon') && form.value.combineLayers\">\n    <mat-slide-toggle\n        formControlName=\"separator\"\n        [labelPosition]=\"'before'\">\n          {{'igo.geo.importExportForm.exportSeparator' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"export-options mat-typography\" *ngIf=\"form.value.format !== 'URL'\">\n    <mat-slide-toggle\n        formControlName=\"featureInMapExtent\"\n        [labelPosition]=\"'before'\">\n          {{'igo.geo.importExportForm.exportFeatureInExtent' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (loading$ | async)\"\n      (click)=\"handleExportFormSubmit(form.value)\">\n      {{form.value.format !== 'URL'  ? ('igo.geo.importExportForm.exportButton' | translate): (form.value.layers.length > 1  ? ('igo.geo.importExportForm.exportButtonLinks' | translate): ('igo.geo.importExportForm.exportButtonLink' | translate))}}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n  </div>\n\n</form>\n","import {\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  EventEmitter,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { FormGroup, FormBuilder, Validators } from '@angular/forms';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport {\n  MessageService,\n  LanguageService,\n  ConfigService,\n  StorageService\n} from '@igo2/core';\nimport { strEnum } from '@igo2/utils';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { IgoMap } from '../../map/shared/map';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\nimport olPoint from 'ol/geom/Point';\nimport { circular } from 'ol/geom/Polygon';\n\nimport {\n  handleFileExportError,\n  handleFileExportSuccess\n} from '../shared/export.utils';\nimport { ExportOptions } from '../shared/export.interface';\nimport { ExportFormat, EncodingFormat } from '../shared/export.type';\nimport { ExportService } from '../shared/export.service';\nimport { ImportService } from '../shared/import.service';\nimport {\n  handleFileImportSuccess,\n  handleFileImportError\n} from '../shared/import.utils';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { StyleListService } from '../style-list/style-list.service';\nimport { skipWhile } from 'rxjs/operators';\nimport { EntityRecord, Workspace } from '@igo2/common';\nimport type { WorkspaceStore } from '@igo2/common';\nimport { WfsWorkspace } from '../../workspace/shared/wfs-workspace';\nimport { EditionWorkspace } from '../../workspace/shared/edition-workspace';\nimport { FeatureWorkspace } from '../../workspace/shared/feature-workspace';\nimport { MatSlideToggleChange } from '@angular/material/slide-toggle';\nimport { InputProjections, ProjectionsLimitationsOptions } from '../../map/';\nimport { DownloadService } from '../../download/shared/download.service';\nimport { computeProjectionsConstraints } from '../../map';\n\nimport olVectorSource from 'ol/source/Vector';\nimport olClusterSource from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Component({\n  selector: 'igo-import-export',\n  templateUrl: './import-export.component.html',\n  styleUrls: ['./import-export.component.scss']\n})\nexport class ImportExportComponent implements OnDestroy, OnInit {\n  public form: FormGroup;\n  public importForm: FormGroup;\n  public formats$ = new BehaviorSubject(undefined);\n  public encodings$ = new BehaviorSubject(undefined);\n  public exportableLayers$: BehaviorSubject<AnyLayer[]> = new BehaviorSubject(\n    []\n  );\n  public loading$ = new BehaviorSubject(false);\n  public forceNaming = false;\n  public controlFormat = 'format';\n\n  private layers$$: Subscription;\n  private exportableLayers$$: Subscription;\n  private formats$$: Subscription;\n  private encodings$$: Subscription;\n  private formLayer$$: Subscription;\n  private exportOptions$$: Subscription;\n\n\n  private espgCodeRegex = new RegExp('^\\\\d{4,6}');\n  private clientSideFileSizeMax: number;\n  public fileSizeMb: number;\n\n  public projections$: BehaviorSubject<InputProjections[]> = new BehaviorSubject([]);\n  private projectionsConstraints: ProjectionsLimitationsOptions;\n\n  public popupChecked: boolean = false;\n\n  private previousLayerSpecs$: BehaviorSubject<\n    {\n      id: string;\n      visible: boolean;\n      opacity: number;\n      queryable: boolean;\n    }[]\n  > = new BehaviorSubject(undefined);\n\n  @Input() selectFirstProj: boolean = false;\n\n  @Input() map: IgoMap;\n\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\n  @Input()\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\n    this._projectionsLimitations = value;\n    this.computeProjections();\n  }\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\n    return this._projectionsLimitations || {};\n  }\n\n  /**\n   * Store that holds the available workspaces.\n   */\n  @Input() store: WorkspaceStore;\n\n  @Input() selectedMode = 'import';\n\n  @Output() selectMode = new EventEmitter<string>();\n\n  @Input() exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\n    undefined\n  );\n\n  @Output() exportOptionsChange = new EventEmitter<ExportOptions>();\n\n  get layers() {\n    return this.form.get('layers').value;\n  }\n  set layers(value) {\n    this.form.patchValue({ layers: value });\n  }\n\n  get inputProj() {\n    return this.importForm.get('inputProj').value;\n  }\n  set inputProj(value) {\n    this.importForm.patchValue({ inputProj: value });\n  }\n\n  get popupAllowed(): boolean {\n    return this.storageService.get('importExportPopupAllowed') as boolean || false;\n  }\n\n  set popupAllowed(value: boolean) {\n    this.storageService.set('importExportPopupAllowed', value);\n  }\n\n  constructor(\n    private importService: ImportService,\n    private exportService: ExportService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    private formBuilder: FormBuilder,\n    private config: ConfigService,\n    private cdRef: ChangeDetectorRef,\n    private storageService: StorageService,\n    private downloadService: DownloadService\n  ) {\n    this.loadConfig();\n    this.buildForm();\n    this.computeProjections();\n  }\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      this.exportableLayers$.next(\n        layers.filter((layer: Layer) => {\n          return (\n            (layer instanceof VectorLayer && layer.exportable === true) ||\n            (layer.dataSource.options.download &&\n              layer.dataSource.options.download.url)\n          );\n        }) as AnyLayer[]\n      );\n    });\n    const configFileSizeMb = this.config.getConfig(\n      'importExport.clientSideFileSizeMaxMb'\n    );\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\n\n    this.exportOptions$$ = this.exportOptions$\n      .pipe(skipWhile((exportOptions) => !exportOptions))\n      .subscribe((exportOptions) => {\n        this.form.patchValue(exportOptions, { emitEvent: true });\n        if (exportOptions.layers) {\n          this.computeFormats(\n            exportOptions.layers.map((l) => this.map.getLayerById(l))\n          );\n        }\n      });\n    this.formLayer$$ = this.form\n      .get('format')\n      .valueChanges\n      .subscribe((format) => {\n        const ogreFormats = Object.keys(ExportService.ogreFormats);\n        if (\n          !this.popupChecked &&\n          this.form.get('layers').value?.length > 1 &&\n          (ogreFormats.indexOf(format) >= 0 || format === ExportFormat.URL)) {\n          if (!this.handlePopup(true)) {\n            this.form.patchValue({ format: undefined }, { emitEvent: false });\n          }\n        }\n      });\n\n    this.formLayer$$ = this.form\n      .get('layers')\n      .valueChanges.subscribe((layersId) => {\n        this.handlePreviousLayerSpecs();\n        const selectedLayers = layersId instanceof Array ? layersId : [layersId];\n        this.form.patchValue({ layers: selectedLayers }, { emitEvent: false });\n        const layers = selectedLayers.map((l) => this.map.getLayerById(l));\n        this.computeFormats(layers);\n\n        if (\n          Object.keys(this.formats$.value).indexOf(this.form.value.format) ===\n          -1\n        ) {\n          this.form.patchValue({ format: undefined });\n        }\n\n        this.loading$.next(true);\n        const previousSpecs: {\n          id: string;\n          visible: boolean;\n          opacity: number;\n          queryable: boolean;\n        }[] = [];\n        layers.forEach((layer) => {\n          if (\n            layer instanceof VectorLayer &&\n            layer.dataSource.ol.getFeatures().length === 0\n          ) {\n            previousSpecs.push({\n              id: layer.id,\n              visible: layer.visible,\n              opacity: layer.opacity,\n              queryable: (layer as any).queryable\n            });\n            layer.opacity = 0;\n            layer.visible = true;\n          }\n        });\n\n        this.previousLayerSpecs$.next(previousSpecs);\n        setTimeout(() => {\n          this.loading$.next(false);\n        }, 500);\n      });\n\n    this.formats$$ = this.formats$\n      .pipe(skipWhile((formats) => !formats))\n      .subscribe((formats) => {\n        if (Object.keys(formats).length === 1) {\n          this.form.patchValue({ format: formats[Object.keys(formats)[0]] });\n        }\n      });\n\n    this.encodings$$ = this.encodings$\n      .pipe(skipWhile((encodings) => !encodings))\n      .subscribe((encodings) => {\n        if (Object.keys(encodings).length === 1) {\n          this.form.patchValue({ encoding: encodings[Object.keys(encodings)[0]] });\n        }\n      });\n\n    this.exportableLayers$$ = this.exportableLayers$\n      .pipe(skipWhile((layers) => !layers))\n      .subscribe((layers) => {\n        if (layers.length === 1) {\n          this.form.patchValue({ layers: layers[0].id });\n        }\n      });\n\n    this.form.controls[this.controlFormat].valueChanges.subscribe((format) => {\n      if (format === ExportFormat.CSVcomma || format === ExportFormat.CSVsemicolon) {\n        this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      } else {\n        this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      }\n      this.cdRef.detectChanges();\n    });\n\n    if (this.selectFirstProj) {\n      if (this.projections$.value.length === 0) {\n        this.importForm.patchValue({ inputProj: { translateKey: 'nad83', alias: 'NAD83', code: 'EPSG:4326', zone: '' } });\n      } else {\n        this.importForm.patchValue({ inputProj: this.projections$.value[0] });\n      }\n    } else {\n      this.importForm.patchValue({ inputProj: undefined });\n    }\n  }\n\n  private computeProjections() {\n    this.projectionsConstraints = computeProjectionsConstraints(this.projectionsLimitations);\n    const projections: InputProjections[] = [];\n\n    if (this.projectionsConstraints.nad83) {\n      projections.push({ translateKey: 'nad83', alias: 'NAD83', code: 'EPSG:4269', zone: '' });\n    }\n    if (this.projectionsConstraints.wgs84) {\n      projections.push({ translateKey: 'wgs84', alias: 'WGS84', code: 'EPSG:4326', zone: '' });\n    }\n    if (this.projectionsConstraints.webMercator) {\n      projections.push({ translateKey: 'webMercator', alias: 'Web Mercator', code: 'EPSG:3857', zone: '' });\n    }\n\n    if (this.projectionsConstraints.mtm) {\n      // all mtm zones\n      const minZone = this.projectionsConstraints.mtmZone.minZone;\n      const maxZone = this.projectionsConstraints.mtmZone.maxZone;\n\n      for (let mtmZone = minZone; mtmZone <= maxZone; mtmZone++) {\n        const code = mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n        projections.push({ translateKey: 'mtm', alias: `MTM ${mtmZone}`, code, zone: `${mtmZone}` });\n      }\n    }\n\n    if (this.projectionsConstraints.utm) {\n      // all utm zones\n      const minZone = this.projectionsConstraints.utmZone.minZone;\n      const maxZone = this.projectionsConstraints.utmZone.maxZone;\n\n      for (let utmZone = minZone; utmZone <= maxZone; utmZone++) {\n        const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n        projections.push({ translateKey: 'utm', alias: `UTM ${utmZone}`, code, zone: `${utmZone}` });\n      }\n    }\n\n    let configProjection = [];\n    if (this.projectionsConstraints.projFromConfig) {\n      configProjection = this.config.getConfig('projections') || [];\n    }\n\n    this.projections$.next(configProjection.concat(projections));\n  }\n\n  private getWorkspaceByLayerId(id: string): Workspace {\n    const wksFromLayerId = this.store\n      .all()\n      .find(workspace => (workspace as WfsWorkspace | FeatureWorkspace | EditionWorkspace).layer.id === id);\n    if (wksFromLayerId) {\n      return wksFromLayerId;\n    }\n    return;\n  }\n\n  public getLayerTitleById(id): string {\n    return this.map.getLayerById(id)?.title;\n  }\n\n\n  layerHasSelectedFeatures(layer: Layer): boolean {\n    const wksFromLayer = this.getWorkspaceByLayerId(layer.id);\n    if (wksFromLayer) {\n      const recs = wksFromLayer.entityStore.stateView\n        .firstBy((record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        });\n      return recs ? true : false;\n    }\n  }\n\n  public onlySelected(event: MatSlideToggleChange, id: string) {\n    let layersWithSelection = this.form.value.layersWithSelection;\n    if (event.checked) {\n      layersWithSelection.push(id);\n    } else {\n      layersWithSelection = layersWithSelection.filter(layerId => layerId !== id);\n    }\n    this.form.patchValue({ layersWithSelection });\n  }\n\n  public onlySelectedClick(event, id: string) {\n    if (this.form.value.layers.find(layerId => layerId === id)) {\n      event.stopPropagation();\n    }\n  }\n\n  public inLayersIdToExportSelectionOnly(layer: Layer): boolean {\n    return this.form.value.layersWithSelection.find(layerId => layerId === layer.id) ? true : false;\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.exportableLayers$$.unsubscribe();\n    this.formats$$.unsubscribe();\n    this.encodings$$.unsubscribe();\n    this.formLayer$$.unsubscribe();\n    if (this.exportOptions$$) {\n      this.exportOptions$$.unsubscribe();\n    }\n    this.exportOptionsChange.emit(this.form.value);\n    this.handlePreviousLayerSpecs();\n  }\n\n  private handlePreviousLayerSpecs() {\n    const previousSpecs = this.previousLayerSpecs$.value;\n    if (previousSpecs && previousSpecs.length) {\n      previousSpecs.forEach((specs) => {\n        const previousLayer = this.map.getLayerById(specs.id);\n        previousLayer.visible = specs.visible;\n        previousLayer.opacity = specs.opacity;\n        (previousLayer as any).queryable = specs.queryable;\n      });\n    }\n    this.previousLayerSpecs$.next(undefined);\n  }\n\n  importFiles(files: File[]) {\n    let inputProj = this.inputProj.code;\n    if (this.espgCodeRegex.test(inputProj)) {\n      inputProj = `EPSG:${inputProj}`;\n    }\n\n    this.loading$.next(true);\n    for (const file of files) {\n      this.importService.import(file, inputProj).subscribe(\n        (features: Feature[]) => this.onFileImportSuccess(file, features),\n        (error: Error) => this.onFileImportError(file, error),\n        () => {\n          this.loading$.next(false);\n        }\n      );\n    }\n  }\n\n  handlePopup(preCheck: boolean = true): boolean {\n    const p1 = window.open('', 'popup', 'width=1, height=1');\n    p1.close();\n    const p2 = window.open('', 'popup', 'width=1, height=1');\n    if (!p2 || p2.closed || typeof p2.closed === 'undefined' || p2 === null) {\n      this.onPopupBlockedError(preCheck);\n      this.popupAllowed = false;\n    } else {\n      p2.close();\n      this.popupAllowed = true;\n      this.popupChecked = true;\n    }\n    return this.popupAllowed;\n  }\n\n  handleExportFormSubmit(data: ExportOptions) {\n    this.loading$.next(true);\n\n    const ogreFormats = Object.keys(ExportService.ogreFormats);\n    if (!this.popupChecked && data.layers.length > 1 &&\n      (ogreFormats.indexOf(data.format) >= 0 || data.format === ExportFormat.URL) && !this.popupAllowed) {\n      this.handlePopup();\n    }\n\n    let geomTypesCSV: { geometryType: string, features: any[] }[] = [];\n    let featuresCSV: any[] = [];\n    let filename: string = \"\";\n\n    for (const [layerIndex, layer] of data.layers.entries()) {\n      const lay = this.map.getLayerById(layer);\n      if (!(data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma)\n      || !data.combineLayers || data.layers.length === 1) {\n        filename = lay.title;\n        if (data.name) {\n          filename = data.name;\n        }\n      } else {\n        filename = this.languageService.translate.instant('igo.geo.export.combinedLayers');\n      }\n      const dSOptions: DataSourceOptions = lay.dataSource.options;\n      if (data.format === ExportFormat.URL && dSOptions.download && (dSOptions.download.url || dSOptions.download.dynamicUrl)) {\n        setTimeout(() => {\n          // better look an feel\n          const url = dSOptions.download.url || dSOptions.download.dynamicUrl;\n          url.match(/service=wfs/gi) ? this.downloadService.open(lay) : window.open(url , '_blank');\n          this.loading$.next(false);\n        }, 500);\n        return;\n      }\n      const wks = this.getWorkspaceByLayerId(layer);\n      let olFeatures;\n      if (wks && wks.entityStore && wks.entityStore.stateView.all().length) {\n\n        if (data.layersWithSelection.indexOf(layer) !== -1 && data.featureInMapExtent) {\n          // Only export selected feature && into map extent\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent && e.state.selected).map(e => (e.entity as Feature).ol);\n        } else if (data.layersWithSelection.indexOf(layer) !== -1 && !data.featureInMapExtent) {\n          // Only export selected feature &&  (into map extent OR not)\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.selected).map(e => (e.entity as Feature).ol);\n        } else if (data.featureInMapExtent) {\n          // Only into map extent\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent).map(e => (e.entity as Feature).ol);\n        } else {\n          // All features\n          olFeatures = wks.entityStore.stateView.all().map(e => (e.entity as Feature).ol);\n        }\n      }\n      else {\n        const ol = lay.dataSource.ol as olVectorSource<OlGeometry> | olClusterSource ;\n        if (data.featureInMapExtent) {\n          olFeatures = ol.getFeaturesInExtent(\n            lay.map.viewController.getExtent()\n          );\n        } else {\n          olFeatures = ol.getFeatures();\n        }\n        if (lay.dataSource instanceof ClusterDataSource) {\n          olFeatures = olFeatures.flatMap((cluster: any) =>\n            cluster.get('features')\n          );\n        }\n      }\n\n      const translate = this.languageService.translate;\n      let geomTypes: { geometryType: string, features: any[] }[] = [];\n      if (data.format === ExportFormat.Shapefile || data.format === ExportFormat.GPX) {\n        olFeatures.forEach((olFeature) => {\n          const featureGeomType = olFeature.getGeometry().getType();\n          const currentGeomType = geomTypes.find(geomType => geomType.geometryType === featureGeomType);\n          if (currentGeomType) {\n            currentGeomType.features.push(olFeature);\n          } else {\n            geomTypes.push({ geometryType: featureGeomType, features: [olFeature] });\n          }\n        });\n      } else {\n        geomTypes = [{ geometryType: '', features: olFeatures }];\n      }\n\n      geomTypes.forEach(geomType => {\n        geomType.features.forEach(feature => {\n          const radius: number = feature.get('rad');\n          if (radius) {\n            const center4326: Array<number> = [feature.get('longitude'), feature.get('latitude')];\n            const circle = circular(center4326, radius, 500);\n            circle.transform('EPSG:4326', feature.get('_projection'));\n            feature.setGeometry(circle);\n          }\n        });\n      });\n\n      if (data.format === ExportFormat.GPX) {\n        const gpxFeatureCnt = geomTypes.length;\n        geomTypes = geomTypes.filter(geomType => ['LineString', 'Point'].includes(geomType.geometryType));\n        const gpxFeatureCntPointOrPoly = geomTypes.length;\n        if (gpxFeatureCnt > gpxFeatureCntPointOrPoly) {\n          const title = translate.instant('igo.geo.export.gpx.error.poly.title');\n          const message = translate.instant('igo.geo.export.gpx.error.poly.text');\n          this.messageService.error(message, title, { timeOut: 20000 });\n        }\n      } else if ((data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma) && data.combineLayers) {\n        geomTypes.forEach(geomType => geomTypesCSV.push(geomType));\n\n        if (layerIndex !== data.layers.length - 1) {\n          continue;\n        } else {\n          let previousFeature = undefined;\n          geomTypesCSV.forEach(geomType => {\n            geomType.features.forEach(currentFeature => {\n              if (data.separator) {\n                if (previousFeature) {\n                  if (currentFeature.get('_featureStore').layer.options.title !==\n                  previousFeature.get('_featureStore').layer.options.title) {\n                    const titleEmptyRows = this.createTitleEmptyRows(previousFeature, currentFeature);\n                    featuresCSV.push(titleEmptyRows[2]);\n                    featuresCSV.push(titleEmptyRows[0]);\n                    featuresCSV.push(titleEmptyRows[1]);\n                  }\n                } else {\n                  const titleEmptyRows = this.createTitleEmptyRows(currentFeature, currentFeature);\n                  featuresCSV.push(titleEmptyRows[0]);\n                }\n              }\n              featuresCSV.push(currentFeature);\n              previousFeature = currentFeature;\n            });\n          });\n        }\n      }\n\n      if (geomTypes.length === 0) {\n        this.loading$.next(false);\n        const title = translate.instant('igo.geo.export.nothing.title');\n        const message = translate.instant('igo.geo.export.nothing.text');\n        this.messageService.error(message, title, { timeOut: 20000 });\n\n      } else {\n        if (!(data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma) || !data.combineLayers) {\n          geomTypes.map(geomType =>\n            this.exportService.export(geomType.features, data.format, filename + geomType.geometryType, data.encoding, this.map.projection)\n            .subscribe(\n              () => {},\n              (error: Error) => this.onFileExportError(error),\n              () => {\n                this.onFileExportSuccess();\n\n                geomType.features.forEach(feature => {\n                  this.circleToPoint(feature);\n                });\n\n                this.loading$.next(false);\n            }\n          ));\n        }\n      }\n    };\n    if ((data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma) && data.combineLayers) {\n      this.exportService.export(featuresCSV, data.format, filename, data.encoding, this.map.projection)\n      .subscribe(\n        () => {},\n        (error: Error) => this.onFileExportError(error),\n        () => {\n          this.onFileExportSuccess();\n\n          featuresCSV.forEach(feature => {\n            this.circleToPoint(feature);\n          });\n\n          this.loading$.next(false);\n        }\n      );\n    }\n  }\n\n  private createTitleEmptyRows(previousFeature, currentFeature) {\n    const titleRow = currentFeature.clone();\n    const headerRow = currentFeature.clone();\n    const emptyRow = currentFeature.clone();\n    const previousFeatureKeys: Array<string> = previousFeature.getKeys();\n    let firstKeyPrevious: string = '';\n    for (const key in previousFeatureKeys) {\n      if (previousFeatureKeys[key] !== 'geometry') {\n        firstKeyPrevious = previousFeatureKeys[key];\n        break;\n      }\n    }\n\n    const currentFeatureKeys: Array<string> = currentFeature.getKeys();\n    let firstKeyCurrent: string = '';\n    for (const key in currentFeatureKeys) {\n      if (currentFeatureKeys[key] !== 'geometry') {\n        firstKeyCurrent = currentFeatureKeys[key];\n        break;\n      }\n    }\n    const allKeys: Array<string> = currentFeature.getKeys();\n    previousFeatureKeys.forEach(previousKey => {\n      if (allKeys.includes(previousKey) && previousKey !== firstKeyPrevious) {\n        allKeys.push(previousKey);\n      }\n    });\n    allKeys.unshift(firstKeyPrevious);\n\n    let firstKeyAll: string = '';\n    for (const key in allKeys) {\n      if (allKeys[key] !== 'geometry') {\n        firstKeyAll = allKeys[key];\n        break;\n      }\n    }\n    allKeys.forEach(key => {\n      const sameKeys: boolean = previousFeatureKeys.length === currentFeatureKeys.length &&\n      previousFeatureKeys.every((value, index) => value === currentFeatureKeys[index]);\n      if (key === firstKeyAll && !sameKeys) {\n        titleRow.set(key, currentFeature.get('_featureStore').layer.options.title + \" ===============>\", true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key === firstKeyAll && sameKeys) {\n        titleRow.set(key, currentFeature.get('_featureStore').layer.options.title, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key === firstKeyCurrent) {\n        titleRow.set(key, currentFeature.get('_featureStore').layer.options.title, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key !== 'geometry') {\n        titleRow.unset(key, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else {\n        titleRow.unset(key, true);\n        emptyRow.unset(key, true);\n      }\n\n      if (!(currentFeatureKeys.includes(key))) {\n        headerRow.unset(key, true);\n      }\n    });\n    const titleEmptyRows = [titleRow, headerRow, emptyRow];\n    return titleEmptyRows;\n  }\n\n  private circleToPoint(feature) {\n    const radius: number = feature.get('rad');\n\n    if (radius) {\n      const point = new olPoint([feature.get('longitude'), feature.get('latitude')]);\n      point.transform('EPSG:4326', feature.get('_projection'));\n      feature.setGeometry(point);\n    }\n  }\n\n  private buildForm() {\n    this.importForm = this.formBuilder.group({\n      inputProj: ['', [Validators.required]]\n    });\n\n    if (this.forceNaming) {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        combineLayers: [true, [Validators.required]],\n        separator: [false, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]],\n        name: ['', [Validators.required]]\n      });\n    } else {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        combineLayers: [true, [Validators.required]],\n        separator: [false, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]],\n      });\n    }\n  }\n\n  private onFileImportSuccess(file: File, features: Feature[]) {\n    if (!this.config.getConfig('importWithStyle')) {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.messageService,\n        this.languageService\n      );\n    } else {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.messageService,\n        this.languageService,\n        this.styleListService,\n        this.styleService\n      );\n    }\n  }\n\n  private onFileImportError(file: File, error: Error) {\n    this.loading$.next(false);\n    handleFileImportError(\n      file,\n      error,\n      this.messageService,\n      this.languageService,\n      this.fileSizeMb\n    );\n  }\n\n  private onPopupBlockedError(preCheck: boolean = true) {\n    this.loading$.next(false);\n    const translate = this.languageService.translate;\n    const title = translate.instant('igo.geo.export.popupBlocked.title');\n    const extraMessage = preCheck ?\n      translate.instant('igo.geo.export.popupBlocked.selectAgain') :\n      translate.instant('igo.geo.export.popupBlocked.retry');\n    const message = translate.instant('igo.geo.export.popupBlocked.text', { extraMessage });\n    this.messageService.error(message, title, { timeOut: 20000 });\n  }\n\n  private onFileExportError(error: Error) {\n    this.loading$.next(false);\n    handleFileExportError(error, this.messageService, this.languageService);\n  }\n\n  private loadConfig() {\n    if (this.config.getConfig('importExport.forceNaming') !== undefined) {\n      this.forceNaming = this.config.getConfig('importExport.forceNaming');\n    }\n    this.computeFormats();\n    this.loadEncodings();\n  }\n\n  public encodingDefaultValue(format: ExportFormat) {\n    if (format === ExportFormat.CSVcomma || format === ExportFormat.CSVsemicolon) {\n      this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      return EncodingFormat.LATIN1;\n    } else {\n      this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      return EncodingFormat.UTF8;\n    }\n  }\n\n  private loadEncodings() {\n    this.encodings$.next(EncodingFormat);\n  }\n\n  private computeFormats(layers?: AnyLayer[]) {\n    let appliedformats: string[] = Object.keys(ExportFormat);\n    const formatsType = {\n      onlyUrl: false,\n      onlyVector: false,\n      vectorAndUrl: false,\n      customList: false\n    };\n    const customList = [];\n    if (layers && layers.length) {\n      layers.forEach((layer) => {\n        if (!layer) {\n          return;\n        }\n        if (layer.dataSource.options.download?.allowedFormats) {\n          formatsType.customList = true;\n          customList.push({layer: layer.title, formats: this.validateListFormat(layer.dataSource.options.download.allowedFormats)});\n        } else if (\n          !(layer instanceof VectorLayer) &&\n          layer.dataSource.options.download &&\n          layer.dataSource.options.download.url\n        ) {\n          formatsType.onlyUrl = true;\n        } else if (\n          layer.dataSource.options.download &&\n          (layer.dataSource.options.download.url || layer.dataSource.options.download.dynamicUrl)\n        ) {\n          formatsType.vectorAndUrl = true;\n        } else if (layer instanceof VectorLayer) {\n          formatsType.onlyVector = true;\n        }\n      });\n\n      if (formatsType.onlyUrl === true && formatsType.onlyVector === false) {\n        appliedformats = ['URL'];\n      } else if (\n        formatsType.onlyVector === true &&\n        formatsType.onlyUrl === false\n      ) {\n        this.computeFormats(); // reset\n        if (ExportFormat.URL in this.formats$.value) {\n          const keys = Object.keys(this.formats$.value).filter(\n            (key) => key !== 'URL'\n          );\n          appliedformats = keys;\n        }\n      } else if (\n        formatsType.vectorAndUrl === true &&\n        formatsType.onlyUrl === false &&\n        formatsType.onlyVector === false\n      ) {\n        this.computeFormats(); // reset\n        if (!(ExportFormat.URL in this.formats$.value)) {\n          const keys = Object.keys(this.formats$.value);\n          keys.push('URL');\n          appliedformats = keys;\n        }\n      }\n    }\n    if (this.config.getConfig('importExport.formats') !== undefined) {\n      const validatedListFormat = this.validateListFormat(\n        this.config.getConfig('importExport.formats')\n      );\n      appliedformats = validatedListFormat;\n    }\n    if (formatsType.customList) {\n      let commonFormats;\n      const layersWithCustomFormats = [];\n      let previousCustomListFormats = customList[0].formats;\n      customList.map(list => {\n        layersWithCustomFormats.push(list.layer);\n        commonFormats = list.formats.filter(value => previousCustomListFormats.includes(value));\n        previousCustomListFormats = list.formats;\n      });\n      const finalFormats = commonFormats.filter(value => appliedformats.includes(value));\n      if (finalFormats.length > 0) {\n        this.formats$.next(strEnum(finalFormats));\n\n        if (layers && layers.length) {\n          if (layers.length > 1) {\n            this.messageService.alert(\n              this.languageService.translate.instant('igo.geo.export.customList.text', { value: layersWithCustomFormats.join() }),\n              this.languageService.translate.instant('igo.geo.export.customList.title')\n            );\n          }\n        }\n      } else {\n        this.formats$.next([]);\n        this.messageService.alert(\n          this.languageService.translate.instant('igo.geo.export.noFormat.text'),\n          this.languageService.translate.instant('igo.geo.export.noFormat.title')\n        );\n      }\n      return;\n    } else {\n      this.formats$.next(strEnum(appliedformats));\n    }\n  }\n\n  private validateListFormat(formats: string[]): string[] {\n    return formats\n      .filter((format) => {\n        if (\n          format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GPX.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.KML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.Shapefile.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.URL.toUpperCase()\n        ) {\n          return format;\n        }\n      })\n      .map((format) => {\n        if (format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase()) {\n          format = ExportFormat.CSVcomma;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase()) {\n          format = ExportFormat.CSVsemicolon;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GML.toUpperCase()) {\n          format = ExportFormat.GML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GPX.toUpperCase()) {\n          format = ExportFormat.GPX;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase()) {\n          format = ExportFormat.GeoJSON;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.KML.toUpperCase()) {\n          format = ExportFormat.KML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.Shapefile.toUpperCase()) {\n          format = ExportFormat.Shapefile;\n          return format;\n        }\n\n        if (format.toUpperCase() === ExportFormat.URL.toUpperCase()) {\n          format = ExportFormat.URL;\n          return format;\n        }\n      });\n  }\n\n  public modeChanged(mode) {\n    this.selectMode.emit(mode);\n  }\n\n  private onFileExportSuccess() {\n    handleFileExportSuccess(this.messageService, this.languageService);\n  }\n\n  onImportExportChange(event) {\n    this.selectedMode = event.value;\n  }\n}\n","import { ProjectionsLimitationsOptions } from './projection.interfaces';\n\n/**\n * Return a number of zone MTM for a longitude for province of Quebec only\n * @param lon number\n * @returns zone\n */\nexport function zoneMtm(lon: number): number {\n    let lonMin = -54;\n    const lonMax = -81;\n    if (lon < lonMax || lon > lonMin) {\n      return 0;\n    }\n    else {\n      const deltaLon = 3;\n      let zone = 2;\n      while (Math.abs(lon - lonMin) > deltaLon) {\n        lonMin = lonMin - deltaLon;\n        zone++;\n      }\n      return zone;\n    }\n  }\n/**\n * Return a number of zone UTM for a longitude\n * @param lon number\n * @returns zone\n */\nexport function zoneUtm(lon: number): number {\n  let lonMin = -180;\n  const lonMax = 180;\n  const deltaLon = 6;\n  let zone = 1;\n  while (Math.abs(lon - lonMin) > deltaLon) {\n    lonMin = lonMin + deltaLon;\n    zone++;\n  }\n  return zone;\n}\n\n/**\n * Compute the contraints of projections\n * @param projectionsLimitations: ProjectionsLimitationsOptions\n * @returns projectionsContraints: ProjectionsLimitationsOptions\n */\nexport function computeProjectionsConstraints(\n    projectionsLimitations: ProjectionsLimitationsOptions):\n    ProjectionsLimitationsOptions {\n    const mtmZone = projectionsLimitations.mtmZone;\n    const utmZone = projectionsLimitations.utmZone;\n    const projectionsConstraints = {\n        projFromConfig: projectionsLimitations.projFromConfig === false ? false : true,\n        nad83: projectionsLimitations.nad83 === false ? false : true,\n        wgs84: projectionsLimitations.wgs84 === false ? false : true,\n        webMercator: projectionsLimitations.webMercator === false ? false : true,\n        utm: projectionsLimitations.utm === false ? false : true,\n        mtm: projectionsLimitations.mtm === false ? false : true,\n        utmZone: {\n        minZone: utmZone && utmZone.minZone ? utmZone.minZone : 17,\n        maxZone: utmZone && utmZone.maxZone ? utmZone.maxZone : 21,\n        },\n        mtmZone: {\n        minZone: mtmZone && mtmZone.minZone ? mtmZone.minZone : 2,\n        maxZone: mtmZone && mtmZone.maxZone ? mtmZone.maxZone : 10,\n        }\n    };\n    return projectionsConstraints;\n  }\n","import {\n  getEntityProperty,\n  EntityTableColumn,\n  EntityTableColumnRenderer\n} from '@igo2/common';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { downloadContent } from '@igo2/utils';\n\nimport { ExportNothingToExportError } from './export.errors';\n\nexport function handleFileExportError(\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  if (error instanceof ExportNothingToExportError) {\n    handleNothingToExportError(messageService, languageService);\n    return;\n  }\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.export.failed.title');\n  const message = translate.instant('igo.geo.export.failed.text');\n  messageService.error(message, title);\n}\n\nexport function handleFileExportSuccess(\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.export.success.title');\n  const message = translate.instant('igo.geo.export.success.text');\n  messageService.success(message, title);\n}\n\nexport function handleNothingToExportError(\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.export.nothing.title');\n  const message = translate.instant('igo.geo.export.nothing.text');\n  messageService.error(message, title);\n}\n\n/**\n * Export array to CSV\n *\n * @param rows Array of arrays to export as CSV\n * @param separator Cell separator\n */\nexport function exportToCSV(rows: any[][], fileName: string, separator: string = ';') {\n  const lines = rows.map((row: any[][], index: number) => row.join(separator));\n  const csvContent = lines.join('\\n');\n  downloadContent(csvContent, 'text/csv;charset=utf-8', fileName);\n}\n\n/**\n * Return an array of values from an array of entities.\n *\n * @param entities Array of entities\n * @param scolumns Columns definition of the output data\n */\nexport function entitiesToRowData(entities: object[], columns: EntityTableColumn[]) {\n  return entities.map((entity: object) => {\n    return columns.map((column: EntityTableColumn) => {\n      let valueAccessor;\n      if (column.renderer === undefined || column.renderer === EntityTableColumnRenderer.Default) {\n        valueAccessor = column.valueAccessor;\n      }\n      valueAccessor = valueAccessor ? valueAccessor : getEntityProperty;\n      return valueAccessor(entity, column.name);\n    });\n  });\n}\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\n\nimport { StyleListService } from './style-list.service';\nimport { StyleListOptions } from './style-list.interface';\n\nexport let STYLELIST_OPTIONS = new InjectionToken<StyleListOptions>('styleListOptions');\n\nexport function provideStyleListOptions(options: StyleListOptions) {\n  return {\n    provide: STYLELIST_OPTIONS,\n    useValue: options\n  };\n}\n\nexport function styleListFactory(\n  styleListService: StyleListService,\n  options: StyleListOptions\n) {\n  return () => styleListService.load(options);\n}\n\nexport function provideStyleListLoader() {\n  return {\n    provide: APP_INITIALIZER,\n    useFactory: styleListFactory,\n    multi: true,\n    deps: [StyleListService, STYLELIST_OPTIONS]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { provideStyleListOptions, provideStyleListLoader } from './style-list.provider';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoStyleListModule {\n  static forRoot(): ModuleWithProviders<IgoStyleListModule> {\n    return {\n      ngModule: IgoStyleListModule,\n      providers: [provideStyleListOptions({}), provideStyleListLoader()]\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule, IgoDrapDropModule, IgoSpinnerModule } from '@igo2/common';\n\nimport { ExportButtonComponent } from './export-button/export-button.component';\nimport { ImportExportComponent } from './import-export/import-export.component';\nimport { DropGeoFileDirective } from './shared/drop-geo-file.directive';\nimport { IgoStyleListModule } from './style-list/style-list.module';\n\n@NgModule({\n  imports: [\n    MatIconModule,\n    MatTooltipModule,\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatTabsModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSlideToggleModule,\n    IgoLanguageModule,\n    IgoSpinnerModule,\n    IgoKeyValueModule,\n    IgoDrapDropModule,\n    IgoStyleListModule.forRoot()\n  ],\n  exports: [ImportExportComponent, DropGeoFileDirective, IgoStyleListModule, ExportButtonComponent],\n  declarations: [ImportExportComponent, DropGeoFileDirective, ExportButtonComponent]\n})\nexport class IgoImportExportModule {\n  static forRoot(): ModuleWithProviders<IgoImportExportModule> {\n    return {\n      ngModule: IgoImportExportModule\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoConfirmDialogModule } from '@igo2/common';\nimport { MapBrowserComponent } from './map-browser/map-browser.component';\nimport { ZoomButtonComponent } from './zoom-button/zoom-button.component';\nimport { GeolocateButtonComponent } from './geolocate-button/geolocate-button.component';\nimport { HomeExtentButtonComponent } from './home-extent-button/home-extent-button.component';\nimport { RotationButtonComponent } from './rotation-button/rotation-button.component';\nimport { BaseLayersSwitcherComponent } from './baselayers-switcher/baselayers-switcher.component';\nimport { MiniBaseMapComponent } from './baselayers-switcher/mini-basemap.component';\nimport { MapOfflineDirective } from './shared/mapOffline.directive';\nimport { OfflineButtonComponent } from './offline-button/offline-button.component';\nimport { WakeLockButtonComponent } from './wake-lock-button/wake-lock-button.component';\nimport { PointerPositionDirective } from './shared/map-pointer-position.directive';\nimport { HoverFeatureDirective } from './shared/hover-feature.directive';\nimport { SwipeControlComponent } from './swipe-control/swipe-control.component';\nimport { MapCenterComponent } from './map-center/map-center.component';\nimport { MenuButtonComponent } from './menu-button/menu-button.component';\nimport { InfoSectionComponent } from './info-section/info-section.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoConfirmDialogModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule\n  ],\n  exports: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    GeolocateButtonComponent,\n    HomeExtentButtonComponent,\n    RotationButtonComponent,\n    InfoSectionComponent,\n    BaseLayersSwitcherComponent,\n    MiniBaseMapComponent,\n    MapOfflineDirective,\n    OfflineButtonComponent,\n    WakeLockButtonComponent,\n    PointerPositionDirective,\n    HoverFeatureDirective,\n    SwipeControlComponent,\n    MapCenterComponent,\n    MenuButtonComponent\n  ],\n  declarations: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    GeolocateButtonComponent,\n    HomeExtentButtonComponent,\n    RotationButtonComponent,\n    InfoSectionComponent,\n    BaseLayersSwitcherComponent,\n    MiniBaseMapComponent,\n    MapOfflineDirective,\n    OfflineButtonComponent,\n    WakeLockButtonComponent,\n    PointerPositionDirective,\n    HoverFeatureDirective,\n    SwipeControlComponent,\n    MapCenterComponent,\n    MenuButtonComponent\n  ]\n})\nexport class IgoMapModule {}\n","<mat-form-field\n  class=\"measure-field\"\n  appearance=\"outline\"\n  floatLabel=\"always\">\n  <mat-label>{{placeholder}}</mat-label>\n  <input\n    matInput\n    [readonly]=\"true\"\n    [value]=\"((measure$ | async) || 0) | measureFormat: measureUnit\">\n</mat-form-field>\n<mat-form-field class=\"unit-field\">\n  <mat-select\n    [value]=\"measureUnit\"\n    [disabled]=\"auto\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n      {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n  </mat-select>\n</mat-form-field>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport {\n  MeasureType,\n  MeasureAreaUnit,\n  MeasureLengthUnit\n} from '../shared/measure.enum';\nimport { computeBestAreaUnit, computeBestLengthUnit } from '../shared/measure.utils';\n\n/**\n * Measurer item\n */\n@Component({\n  selector: 'igo-measurer-item',\n  templateUrl: './measurer-item.component.html',\n  styleUrls: ['./measurer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MeasurerItemComponent implements OnDestroy {\n\n  /**\n   * Measure observable\n   * @internal\n   */\n  public measure$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the measure observable when the auto mode is on\n   * @internal\n   */\n  public measure$$: Subscription;\n\n  /**\n   * Measure type\n   */\n  @Input() measureType: MeasureType;\n\n  /**\n   * Measure unit\n   */\n  @Input() measureUnit: MeasureAreaUnit | MeasureLengthUnit;\n\n  /**\n   * Measure\n   */\n  @Input()\n  set measure(value: number) {\n    this.measure$.next(value);\n  }\n  get measure(): number { return this.measure$.value; }\n\n  /**\n   * Whther measure units should be automatically determined\n   */\n  @Input()\n  set auto(value: boolean) { this.toggleAutoUnit(value); }\n  get auto(): boolean { return this._auto; }\n  private _auto: boolean = false;\n\n  /**\n   * Placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Event emitted when the measure unit changes\n   */\n  @Output() measureUnitChange = new EventEmitter<MeasureAreaUnit | MeasureLengthUnit>();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    if (this.measureType === MeasureType.Area) {\n      return Object.values(MeasureAreaUnit);\n    }\n    return Object.values(MeasureLengthUnit);\n  }\n\n  constructor() {}\n\n  /**\n   * Toggle the auto unit off\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toggleAutoUnit(false);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureAreaUnit | MeasureLengthUnit) {\n    this.measureUnit = unit;\n    this.measureUnitChange.emit(unit);\n  }\n\n  private toggleAutoUnit(toggle: boolean) {\n    if (this.measure$$ !== undefined) {\n      this.measure$$.unsubscribe();\n    }\n    if (toggle === true) {\n      this.measure$$ = this.measure$.subscribe((measure: number) => {\n        this.computeBestMeasureUnit(measure);\n      });\n    }\n    this._auto = toggle;\n  }\n\n  private computeBestMeasureUnit(measure: number) {\n    let measureUnit = this.measureUnit;\n    if (this.measureType === MeasureType.Area) {\n      measureUnit = computeBestAreaUnit(measure);\n    } else if (this.measureType === MeasureType.Length) {\n      measureUnit = computeBestLengthUnit(measure);\n    }\n    if (measureUnit !== this.measureUnit) {\n      this.onMeasureUnitChange(measureUnit);\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatDividerModule } from '@angular/material/divider';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoEntityTableModule } from '@igo2/common';\n\nimport { MeasureFormatPipe } from './measure-format.pipe';\nimport { MeasurerItemComponent } from './measurer-item.component';\nimport { MeasurerComponent } from './measurer.component';\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    MatSlideToggleModule,\n    MatDividerModule,\n    IgoLanguageModule,\n    IgoEntityTableModule\n  ],\n  declarations: [\n    MeasureFormatPipe,\n    MeasurerItemComponent,\n    MeasurerComponent,\n    MeasurerDialogComponent\n  ],\n  exports: [\n    MeasureFormatPipe,\n    MeasurerComponent\n  ]\n})\nexport class IgoMeasurerModule {}\n","import { NgModule } from '@angular/core';\n\nimport { IgoMeasurerModule } from './measurer/measurer.module';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [\n    IgoMeasurerModule\n  ]\n})\nexport class IgoMeasureModule {}\n","export enum OverlayAction {\n    None,\n    Move,\n    Zoom,\n    ZoomIfOutMapExtent\n  }\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport { OverlayAction } from './overlay.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class OverlayService {\n  public features$ = new BehaviorSubject<[Feature[], OverlayAction]>([\n    [],\n    undefined\n  ]);\n\n  constructor() {}\n\n  setFeatures(features: Feature[], action: OverlayAction = OverlayAction.None) {\n    this.features$.next([features, action]);\n  }\n\n  clear() {\n    this.features$.next([[], OverlayAction.None]);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport { OverlayService } from '../shared/overlay.service';\nimport { OverlayAction } from '../shared/overlay.enum';\n\n@Directive({\n  selector: '[igoOverlay]'\n})\nexport class OverlayDirective implements OnInit, OnDestroy {\n  private features$$: Subscription;\n  private format = new olFormatGeoJSON();\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private overlayService: OverlayService\n  ) {}\n\n  ngOnInit() {\n    this.features$$ = this.overlayService.features$.subscribe(res =>\n      this.handleFeatures(res[0], res[1])\n    );\n  }\n\n  ngOnDestroy() {\n    this.features$$.unsubscribe();\n  }\n\n  private handleFeatures(features: Feature[], action: OverlayAction) {}\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\n\nimport { OverlayDirective } from './shared/overlay.directive';\n\n@NgModule({\n  imports: [],\n  exports: [OverlayDirective],\n  declarations: [OverlayDirective]\n})\nexport class IgoOverlayModule {\n  static forRoot(): ModuleWithProviders<IgoOverlayModule> {\n    return {\n      ngModule: IgoOverlayModule\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { Observable, Subject, forkJoin } from 'rxjs';\nimport { map as rxMap } from 'rxjs/operators';\n\nimport { saveAs } from 'file-saver';\nimport jspdf from 'jspdf';\nimport html2canvas from 'html2canvas';\nimport * as JSZip from 'jszip';\n\nimport { SubjectStatus } from '@igo2/utils';\nimport { SecureImagePipe } from '@igo2/common';\nimport { MessageService, ActivityService, LanguageService, ConfigService } from '@igo2/core';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { formatScale } from '../../map/shared/map.utils';\nimport { LegendMapViewOptions } from '../../layer/shared/layers/layer.interface';\nimport { getLayersLegends } from '../../layer/utils/outputLegend';\n\nimport { PrintOptions } from './print.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PrintService {\n  zipFile: JSZip;\n  nbFileToProcess: number;\n  activityId: string;\n  constructor(\n    private http: HttpClient,\n    private messageService: MessageService,\n    private activityService: ActivityService,\n    private languageService: LanguageService,\n    private configService: ConfigService\n  ) {}\n\n  print(map: IgoMap, options: PrintOptions): Subject<any> {\n    const status$ = new Subject();\n\n    const paperFormat: string = options.paperFormat;\n    const resolution = +options.resolution; // Default is 96\n    const orientation = options.orientation;\n    const legendPostion = options.legendPosition;\n\n    this.activityId = this.activityService.register();\n    const doc = new jspdf({\n      orientation,\n      format: paperFormat.toLowerCase()\n    });\n\n    const dimensions = [\n      doc.internal.pageSize.width,\n      doc.internal.pageSize.height\n    ];\n\n    const margins = [10, 10, 10, 10];\n    const width = dimensions[0] - margins[3] - margins[1];\n    const height = dimensions[1] - margins[0] - margins[2];\n    const size = [width, height];\n    let titleSizeResults = [0, 0];\n\n    if (options.title !== undefined) {\n      titleSizeResults = this.getTitleSize(options.title, width, height, doc); // return : size(pt) and left margin (mm)\n      this.addTitle(doc, options.title, titleSizeResults[0], margins[3] + titleSizeResults[1], titleSizeResults[0] * (25.4 / 72));\n    }\n    if (options.subtitle !== undefined) {\n      let subtitleSizeResult = 0;\n      const titleH = titleSizeResults[0];\n      subtitleSizeResult = this.getSubTitleSize(options.subtitle, width, height, doc); // return : size(pt) and left margin (mm)\n      this.addSubTitle(doc, options.subtitle, titleH * 0.7, margins[3] + subtitleSizeResult, titleH * 1.7 * (25.4 / 72));\n      margins[0] = margins[0] + titleSizeResults[0] * 0.7 * (25.4 / 72);\n    }\n    if (options.showProjection === true || options.showScale === true) {\n      this.addProjScale(\n        doc,\n        map,\n        resolution,\n        options.showProjection,\n        options.showScale\n        );\n    }\n    if (options.comment !== '') {\n      this.addComment(doc, options.comment);\n    }\n\n    this.addMap(doc, map, resolution, size, margins).subscribe(\n      async (status: SubjectStatus) => {\n        if (status === SubjectStatus.Done) {\n          await this.addScale(doc, map, margins);\n          await this.handleMeasureLayer(doc, map, margins);\n          if (options.legendPosition !== 'none') {\n            if (['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(options.legendPosition) > -1 ) {\n              await this.addLegendSamePage(doc, map, margins, resolution, options.legendPosition);\n            } else if (options.legendPosition === 'newpage') {\n              await this.addLegend(doc, map, margins, resolution);\n            }\n          } else {\n            await this.saveDoc(doc);\n          }\n        }\n\n        if (status === SubjectStatus.Done || status === SubjectStatus.Error) {\n          this.activityService.unregister(this.activityId);\n          status$.next(SubjectStatus.Done);\n        }\n      }\n    );\n\n    return status$;\n  }\n\n  /**\n   * Add measure overlay on the map on the document when the measure layer is present\n   * @param  doc - Pdf document where measure tooltip will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async handleMeasureLayer(\n    doc: jspdf,\n    map: IgoMap,\n    margins: Array<number>\n  ) {\n    if (map.layers.find(layer => layer.visible && layer.id.startsWith('igo-measures-'))) {\n      let canvasOverlayHTMLMeasures;\n      const mapOverlayMeasuresHTML = map.ol.getOverlayContainer();\n      await html2canvas(mapOverlayMeasuresHTML, {\n        scale: 1,\n        backgroundColor: null\n      }).then(e => {\n        canvasOverlayHTMLMeasures = e;\n      });\n      this.addCanvas(doc, canvasOverlayHTMLMeasures, margins); // this adds measure overlays\n    }\n  }\n\n  /**\n   * Get html code for all layers legend\n   * @param  map IgoMap\n   * @param  width The width that the legend need to be\n   * @return Html code for the legend\n   */\n  getLayersLegendHtml(\n    map: IgoMap,\n    width: number,\n    resolution: number\n  ): Observable<string> {\n    return new Observable((observer) => {\n      let html = '';\n      const legends = getLayersLegends(\n        map.layers,\n        {\n          resolution: map.viewController.getResolution(),\n          extent: map.viewController.getExtent(),\n          projection: map.viewController.getOlProjection().getCode(),\n          // scale: map.viewController.getScale(resolution),\n          size: map.ol.getSize()\n        } as LegendMapViewOptions\n      );\n      if (legends.filter(l => l.display === true).length === 0) {\n        observer.next(html);\n        observer.complete();\n        return;\n      }\n      // Define important style to be sure that all container is convert\n      // to image not just visible part\n      html += '<style media=\"screen\" type=\"text/css\">';\n      html += '.html2canvas-container { width: ' + width + 'mm !important; height: 2000px !important; }';\n      html += 'table.tableLegend {table-layout: auto;}';\n      html += 'div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}';\n      html += '</style>';\n      // The font size will also be lowered afterwards (globally along the legend size)\n      // this allows having a good relative font size here and to keep ajusting the legend size\n      // while keeping good relative font size\n      html += '<font size=\"3\" face=\"Times\" >';\n      html += '<div class=\"styleLegend\">';\n      html += '<table class=\"tableLegend\" >';\n\n      // For each legend, define an html table cell\n      const images$ = legends.filter(l => l.display).map((legend) =>\n        this.getDataImage(legend.url).pipe(\n          rxMap((dataImage) => {\n            let htmlImg = '<tr><td>' + legend.title.toUpperCase() + '</td></tr>';\n            htmlImg += '<tr><td><img src=\"' + dataImage + '\"></td></tr>';\n            return htmlImg;\n          })\n        )\n      );\n      forkJoin(images$).subscribe((dataImages) => {\n        html = dataImages.reduce((acc, current) => (acc += current), html);\n        html += '</table>';\n        html += '</div>';\n        observer.next(html);\n        observer.complete();\n      });\n    });\n  }\n\n  getDataImage(url: string): Observable<string> {\n    const secureIMG = new SecureImagePipe(this.http, this.configService);\n    return secureIMG.transform(url);\n  }\n\n  /**\n   * Get all the legend in a single image\n   * * @param  format - Image format. default value to \"png\"\n   * @return The image of the legend\n   */\n  async getLayersLegendImage(\n    map,\n    format: string = 'png',\n    doZipFile: boolean,\n    resolution: number\n  ) {\n    const status$ = new Subject();\n    // Get html code for the legend\n    const width = 200; // milimeters unit, originally define for document pdf\n    let html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    format = format.toLowerCase();\n\n    // If no legend show No LEGEND in an image\n    if (html.length === 0) {\n      html = '<font size=\"12\" face=\"Courier New\" >';\n      html += '<div align=\"center\"><b>NO LEGEND</b></div>';\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n\n    if (canvas) {\n      let status = SubjectStatus.Done;\n      try {\n        if (!doZipFile) {\n          // Save the canvas as file\n          this.saveCanvasImageAsFile(canvas, 'legendImage', format);\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(canvas, 'legendImage' + '.' + format);\n        }\n        div.parentNode.removeChild(div); // remove temp div (IE)\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n      status$.next(status);\n    }\n\n    return status$;\n  }\n\n  getTitleSize(title: string, pageWidth: number, pageHeight: number, doc: jspdf) {\n    const pdfResolution = 96;\n    const titleSize = Math.round(2 * (pageHeight + 145) * 0.05) / 2;\n    doc.setFont('Times', 'bold');\n    const width = doc.getTextWidth(title);\n\n    const titleWidth = doc.getStringUnitWidth(title) * titleSize / doc.internal.scaleFactor;\n    const titleTailleMinimale = Math.round( 2 * (pageHeight + 150 ) * 0.037) / 2;\n    let titleFontSize = 0;\n\n    let titleMarginLeft;\n    if (titleWidth >= (pageWidth)) {\n      titleMarginLeft = 0;\n      titleFontSize = Math.round(((pageWidth / title.length) * pdfResolution) / 25.4);\n      // If the formula to find the font size gives below the defined minimum size\n      if (titleFontSize < titleTailleMinimale) {\n        titleFontSize = titleTailleMinimale;\n      }\n    } else {\n      titleMarginLeft = (pageWidth - titleWidth) / 2 ;\n      titleFontSize = titleSize;\n    }\n    return [titleFontSize, titleMarginLeft];\n  }\n\n  getSubTitleSize(subtitle: string, pageWidth: number, pageHeight: number, doc: jspdf) {\n    const subtitleSize = 0.7 * Math.round(2 * (pageHeight + 145) * 0.05) / 2; // 70% of the title's font size\n\n    doc.setFont('Times', 'bold');\n\n    const subtitleWidth = doc.getStringUnitWidth(subtitle) * subtitleSize / doc.internal.scaleFactor;\n\n    let subtitleMarginLeft;\n    if (subtitleWidth >= (pageWidth)) {\n      subtitleMarginLeft = 0;\n    } else {\n      subtitleMarginLeft = (pageWidth - subtitleWidth) / 2 ;\n    }\n    return subtitleMarginLeft;\n  }\n\n  private addTitle(doc: jspdf, title: string, titleFontSize: number, titleMarginLeft: number, titleMarginTop: number) {\n    doc.setFont('Times', 'bold');\n    doc.setFontSize(titleFontSize);\n    doc.text(title, titleMarginLeft, titleMarginTop);\n  }\n\n  private addSubTitle(doc: jspdf, subtitle: string, subtitleFontSize: number, subtitleMarginLeft: number, subtitleMarginTop: number) {\n    doc.setFont('Times', 'bold');\n    doc.setFontSize(subtitleFontSize);\n    doc.text(subtitle, subtitleMarginLeft, subtitleMarginTop);\n  }\n  /**\n   * Add comment to the document\n   * * @param  doc - pdf document\n   * * @param  comment - Comment to add in the document\n   * * @param  size - Size of the document\n   */\n  private addComment(doc: jspdf, comment: string) {\n    const commentSize = 16;\n    const commentMarginLeft = 20;\n    const marginBottom = 5;\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\n\n    doc.setFont('courier');\n    doc.setFontSize(commentSize);\n    doc.text(comment, commentMarginLeft, heightPixels);\n  }\n  /**\n   * Add projection and/or scale to the document\n   * @param  doc - pdf document\n   * @param  map - Map of the app\n   * @param  dpi - DPI resolution of the document\n   * @param  projection - Bool to indicate if projection need to be added\n   * @param  scale - Bool to indicate if scale need to be added\n   */\n  private addProjScale(\n    doc: jspdf,\n    map: IgoMap,\n    dpi: number,\n    projection: boolean,\n    scale: boolean\n  ) {\n    const translate = this.languageService.translate;\n    const projScaleSize = 16;\n    const projScaleMarginLeft = 20;\n    const marginBottom = 15;\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\n\n    let textProjScale: string = '';\n    if (projection === true) {\n      const projText = translate.instant('igo.geo.printForm.projection');\n      textProjScale += projText + ': ' + map.projection;\n    }\n    if (scale === true) {\n      if (projection === true) {\n        textProjScale += '   ';\n      }\n      const scaleText = translate.instant('igo.geo.printForm.scale');\n      const mapScale = map.viewController.getScale(dpi);\n      textProjScale += scaleText + ': ~ 1 / ' + formatScale(mapScale);\n    }\n    doc.setFont('courier');\n    doc.setFontSize(projScaleSize);\n    doc.text(textProjScale, projScaleMarginLeft, heightPixels);\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async addLegend(\n    doc: jspdf,\n    map: IgoMap,\n    margins: Array<number>,\n    resolution: number\n  ) {\n    // Get html code for the legend\n    const width = doc.internal.pageSize.width;\n    const html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveDoc(doc);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n\n    if (canvas) {\n      const pourcentageReduction = 0.85;\n      const imageSize = [pourcentageReduction * (25.4 * canvas.width) / resolution, pourcentageReduction\n        * (25.4 * canvas.height) / resolution];\n      let imgData;\n      doc.addPage();\n      imgData = canvas.toDataURL('image/png');\n      doc.addImage(imgData, 'PNG', 10, 10, imageSize[0], imageSize[1]);\n      div.parentNode.removeChild(div); // remove temp div (IE style)\n    }\n\n    await this.saveDoc(doc);\n\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n     private async addLegendSamePage(\n      doc: jspdf,\n      map: IgoMap,\n      margins: Array<number>,\n      resolution: number,\n      legendPosition: string\n    ) {\n      // Get html code for the legend\n      const width = doc.internal.pageSize.width;\n      const html = await this.getLayersLegendHtml(\n        map,\n        width,\n        resolution\n      ).toPromise();\n      // If no legend, save the map directly\n      if (html === '') {\n        await this.saveDoc(doc);\n        return true;\n      }\n      // Create div to contain html code for legend\n      const div = window.document.createElement('div');\n      div.style.position = 'absolute';\n      div.style.top = '0';\n      // Add html code to convert in the new window\n      window.document.body.appendChild(div);\n      div.innerHTML = html;\n      await this.timeout(1);\n      const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n        console.log(e);\n      });\n      let marginsLegend;\n      if (canvas) {\n        const pourcentageReduction = 0.85;\n        const imageSize = [pourcentageReduction * (25.4 * canvas.width) / resolution,\n           pourcentageReduction * (25.4 * canvas.height) / resolution];\n        // Move the legend to the correct position on the page\n        if ( legendPosition === 'bottomright') {\n          marginsLegend = [doc.internal.pageSize.height - margins[2] - imageSize[1], margins[1],\n           margins[2], doc.internal.pageSize.width - margins[1] - imageSize[0]];\n        } else if (legendPosition === 'topright') {\n          marginsLegend = [margins[0], margins[1], doc.internal.pageSize.height - margins[0] - imageSize[1],\n          doc.internal.pageSize.width - margins[1] - imageSize[0] ];\n        } else if (legendPosition === 'bottomleft') {\n          // When the legend is in the bottom left, raise the legend slightly upward so that attributions are visible\n          marginsLegend = [doc.internal.pageSize.height - margins[2] - imageSize[1] - 15,\n          doc.internal.pageSize.width - margins[3] - imageSize[0], margins[2] + 15, margins[3] ];\n        } else if (legendPosition === 'topleft') {\n          marginsLegend = [margins[0], doc.internal.pageSize.width - margins[3] - imageSize[0],\n           doc.internal.pageSize.height - margins[0] - imageSize[1], margins[3] ];\n        }\n        this.addCanvas(doc, canvas, marginsLegend); // this adds the legend\n        div.parentNode.removeChild(div); // remove temp div (IE style)\n        await this.saveDoc(doc);\n      }\n    }\n\n  /**\n   * Add scale and attributions on the map on the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async addScale(\n    doc: jspdf,\n    map: IgoMap,\n    margins: Array<number>\n    ) {\n      const mapSize = map.ol.getSize();\n      const extent = map.ol.getView().calculateExtent(mapSize);\n      // Get the scale and attribution\n      // we use cloneNode to modify the nodes to print without modifying it on the page, using deep:true to get children\n      let canvasOverlayHTML;\n      const mapOverlayHTML = map.ol.getOverlayContainerStopEvent();\n      // Remove the UI buttons from the nodes\n      const OverlayHTMLButtons = mapOverlayHTML.getElementsByTagName('button');\n      const OverlayHTMLButtonsarr = Array.from(OverlayHTMLButtons);\n      for (const OverlayHTMLButton of OverlayHTMLButtonsarr) {\n        OverlayHTMLButton.setAttribute('data-html2canvas-ignore', 'true');\n      }\n      // Change the styles of hyperlink in the printed version\n      // Transform the Overlay into a canvas\n      // scale is necessary to make it in google chrome\n      // background as null because otherwise it is white and cover the map\n      // allowtaint is to allow rendering images in the attributions\n      // useCORS: true pour permettre de renderer les images (ne marche pas en local)\n      const canvas = await html2canvas(mapOverlayHTML, {\n        scale: 1,\n        backgroundColor: null,\n        allowTaint: true,\n        useCORS: true,\n      }).then( e => {\n        canvasOverlayHTML = e;\n      });\n      this.addCanvas(doc, canvasOverlayHTML, margins); // this adds scales and attributions\n }\n\n  defineNbFileToProcess(nbFileToProcess) {\n    this.nbFileToProcess = nbFileToProcess;\n  }\n\n  private timeout(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n\n  private addCanvas(\n    doc: jspdf,\n    canvas: HTMLCanvasElement,\n    margins: Array<number>\n  ) {\n    let image;\n    if (canvas) {\n      image = canvas.toDataURL('image/png');\n    }\n\n    if (image !== undefined) {\n      const imageSize = this.getImageSizeToFitPdf(doc, canvas, margins);\n      doc.addImage(\n        image,\n        'PNG',\n        margins[3],\n        margins[0],\n        imageSize[0],\n        imageSize[1]\n      );\n      doc.rect(margins[3], margins[0], imageSize[0], imageSize[1]);\n    }\n  }\n\n  // TODO fix printing with image resolution\n  private addMap(\n    doc: jspdf,\n    map: IgoMap,\n    resolution: number,\n    size: Array<number>,\n    margins: Array<number>\n  ) {\n    const status$ = new Subject();\n\n    const mapSize = map.ol.getSize();\n    const extent = map.ol.getView().calculateExtent(mapSize);\n\n    const widthPixels = Math.round((size[0] * resolution) / 25.4);\n    const heightPixels = Math.round((size[1] * resolution) / 25.4);\n\n    let timeout;\n\n    map.ol.once('rendercomplete', (event: any) => {\n      const canvases = event.target.getViewport().getElementsByTagName('canvas');\n      const mapStatus$$ = map.status$.subscribe((mapStatus: SubjectStatus) => {\n        clearTimeout(timeout);\n\n        if (mapStatus !== SubjectStatus.Done) {\n          return;\n        }\n\n        mapStatus$$.unsubscribe();\n\n        let status = SubjectStatus.Done;\n        try {\n          for (const canvas of canvases) {\n            if (canvas.width !== 0) {\n              this.addCanvas(doc, canvas, margins);\n            }\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error(\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageBody'\n            ),\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageHeader'\n            )\n          );\n        }\n        this.renderMap(map, mapSize, extent);\n        status$.next(status);\n      });\n\n      // If no loading as started after 200ms, then probably no loading\n      // is required.\n      timeout = window.setTimeout(() => {\n        mapStatus$$.unsubscribe();\n\n        let status = SubjectStatus.Done;\n        try {\n          for (const canvas of canvases) {\n            if (canvas.width !== 0) {\n              this.addCanvas(doc, canvas, margins);\n            }\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error(\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageBody'\n            ),\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageHeader'\n            )\n          );\n        }\n        this.renderMap(map, mapSize, extent);\n        status$.next(status);\n      }, 200);\n    });\n\n    this.renderMap(map, [widthPixels, heightPixels], extent);\n\n    return status$;\n  }\n\n  /**\n   * Download an image of the map with addition of informations\n   * @param  map - Map of the app\n   * @param  format - Image format. default value to \"png\"\n   * @param  projection - Indicate if projection need to be add. Default to false\n   * @param  scale - Indicate if scale need to be add. Default to false\n   * @param  legend - Indicate if the legend of layers need to be download. Default to false\n   * @param  title - Title to add for the map - Default to blank\n   * @param  subtitle - Subtitle to add for the map - Default to blank\n   * @param  comment - Comment to add for the map - Default to blank\n   * @param  doZipFile - Indicate if we do a zip with the file\n   * @return Image file of the map with extension format given as parameter\n   */\n  downloadMapImage(\n    map: IgoMap,\n    resolution: number,\n    format = 'png',\n    projection = false,\n    scale = false,\n    legend = false,\n    title = '',\n    subtitle = '',\n    comment = '',\n    doZipFile = true\n  ) {\n    const status$ = new Subject();\n    // const resolution = map.ol.getView().getResolution();\n    this.activityId = this.activityService.register();\n    const translate = this.languageService.translate;\n    map.ol.once('rendercomplete', (event: any) => {\n      format = format.toLowerCase();\n      const oldCanvas = event.target\n        .getViewport()\n        .getElementsByTagName('canvas')[0];\n      const newCanvas = document.createElement('canvas');\n      const newContext = newCanvas.getContext('2d');\n      // Postion in height to set the canvas in new canvas\n      let positionHCanvas = 0;\n      // Position in width to set the Proj/Scale in new canvas\n      let positionWProjScale = 10;\n      // Get height/width of map canvas\n      const width = oldCanvas.width;\n      let height = oldCanvas.height;\n      // Set Font to calculate comment width\n      newContext.font = '20px Calibri';\n      const commentWidth = newContext.measureText(comment).width;\n      // Add height for title if defined\n      height = title !== '' ? height + 30 : height;\n      // Add height for title if defined\n      height = subtitle !== '' ? height + 30 : height;\n      // Add height for projection or scale (same line) if defined\n      height = projection !== false || scale !== false ? height + 30 : height;\n      const positionHProjScale = height - 10;\n      // Define number of line depending of the comment length\n      const commentNbLine = Math.ceil(commentWidth / width);\n      // Add height for multiline comment if defined\n      height = comment !== '' ? height + commentNbLine * 30 : height;\n      let positionHComment = height - commentNbLine * 20 + 5;\n      // Set the new canvas with the new calculated size\n      newCanvas.width = width;\n      newCanvas.height = height;\n      // Patch Jpeg default black background to white\n      if (format === 'jpeg') {\n        newContext.fillStyle = '#ffffff';\n        newContext.fillRect(0, 0, width, height);\n        newContext.fillStyle = '#000000';\n      }\n      // If a title need to be added to canvas\n      if (title !== '') {\n        // Set font for title\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 30;\n        newContext.textAlign = 'center';\n        newContext.fillText(title, width / 2, 20, width * 0.9);\n      }\n      if (subtitle !== '') {\n        // Set font for subtitle\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 60;\n        newContext.textAlign = 'center';\n        newContext.fillText(subtitle, width / 2, 50, width * 0.9);\n      }\n      // Set font for next section\n      newContext.font = '20px Calibri';\n      // If projection need to be added to canvas\n      if (projection !== false) {\n        const projText = translate.instant('igo.geo.printForm.projection');\n        newContext.textAlign = 'start';\n        newContext.fillText(\n          projText + ': ' + map.projection,\n          positionWProjScale,\n          positionHProjScale\n        );\n        positionWProjScale += 200; // Width position change for scale position\n      }\n\n      // If scale need to be added to canvas\n      if (scale !== false) {\n        const scaleText = translate.instant('igo.geo.printForm.scale');\n        const mapScale = map.viewController.getScale(resolution);\n        newContext.textAlign = 'start';\n        newContext.fillText(\n          scaleText + ': ~ 1 / ' + formatScale(mapScale),\n          positionWProjScale,\n          positionHProjScale\n        );\n      }\n      // If a comment need to be added to canvas\n      if (comment !== '') {\n        newContext.textAlign = 'center';\n        // If only one line, no need to multiline the comment\n        if (commentNbLine === 1) {\n          newContext.fillText(comment, width / 2, positionHComment);\n        } else {\n          // Separate the setenses to be approx. the same length\n          const nbCommentChar = comment.length;\n          const CommentLengthToCut = Math.floor(nbCommentChar / commentNbLine);\n          let commentCurrentLine = '';\n          let positionFirstCutChar = 0;\n          let positionLastBlank;\n          // Loop for the number of line calculated\n          for (let i = 0; i < commentNbLine; i++) {\n            // For all line except last\n            if (commentNbLine - 1 > i) {\n              // Get comment current line to find the right place tu cut comment\n              commentCurrentLine = comment.substr(\n                positionFirstCutChar,\n                CommentLengthToCut\n              );\n              // Cut the setence at blank\n              positionLastBlank = commentCurrentLine.lastIndexOf(' ');\n              newContext.fillText(\n                commentCurrentLine.substr(0, positionLastBlank),\n                width / 2,\n                positionHComment\n              );\n              positionFirstCutChar += positionLastBlank;\n              // Go to next line for insertion\n              positionHComment += 20;\n            } else {\n              // Don't cut last part\n              newContext.fillText(\n                comment.substr(positionFirstCutChar),\n                width / 2,\n                positionHComment\n              );\n            }\n          }\n        }\n      }\n      // Add map to new canvas\n      newContext.drawImage(oldCanvas, 0, positionHCanvas);\n\n      let status = SubjectStatus.Done;\n      let fileNameWithExt = 'map.' + format;\n      if (format.toLowerCase() === 'tiff') {\n        fileNameWithExt = 'map' + map.projection.replace(':', '_') + '.' + format;\n      }\n\n      try {\n        // Save the canvas as file\n        if (!doZipFile) {\n          this.saveCanvasImageAsFile(newCanvas, fileNameWithExt, format);\n        } else if (format.toLowerCase() === 'tiff') {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(newCanvas, fileNameWithExt);\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(newCanvas, fileNameWithExt);\n        }\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n\n      status$.next(status);\n\n      if (format.toLowerCase() === 'tiff') {\n        const tfwFileNameWithExt = fileNameWithExt.substring(0, fileNameWithExt.toLowerCase().indexOf('.tiff')) + '.tfw';\n        const tiwContent = this.getWorldFileInformation(map);\n        const blob = new Blob([tiwContent], {\n          type: 'text/plain;charset=utf-8'\n        });\n        if (!doZipFile) {\n          // saveAs automaticly replace ':' for '_'\n          saveAs(blob, tfwFileNameWithExt);\n          this.saveFileProcessing();\n        } else {\n          // Add the canvas to zip\n          this.addFileToZip(tfwFileNameWithExt,blob);\n        }\n      }\n    });\n    map.ol.renderSync();\n\n    return status$;\n  }\n\n  private renderMap(map, size, extent) {\n    map.ol.updateSize();\n    map.ol.renderSync();\n  }\n\n  /**\n   * Save document\n   * @param  doc - Document to save\n   */\n  protected async saveDoc(doc: jspdf) {\n    await doc.save('map.pdf', { returnPromise: true });\n  }\n\n  /**\n   * Calculate the best Image size to fit in pdf\n   * @param doc - Pdf Document\n   * @param canvas - Canvas of image\n   * @param margins - Page margins\n   */\n  private getImageSizeToFitPdf(doc, canvas, margins) {\n    // Define variable to calculate best size to fit in one page\n    const pageHeight =\n      doc.internal.pageSize.getHeight() - (margins[0] + margins[2]);\n    const pageWidth =\n      doc.internal.pageSize.getWidth() - (margins[1] + margins[3]);\n    const canHeight = canvas.height;\n    const canWidth = canvas.width;\n    const heightRatio = canHeight / pageHeight;\n    const widthRatio = canWidth / pageWidth;\n    const maxRatio = heightRatio > widthRatio ? heightRatio : widthRatio;\n    const imgHeigh = maxRatio > 1 ? canHeight / maxRatio : canHeight;\n    const imgWidth = maxRatio > 1 ? canWidth / maxRatio : canWidth;\n\n    return [imgWidth, imgHeigh];\n  }\n\n  /**\n   * Get a world file information for tiff\n   * @param  map - Map of the app\n   */\n  private getWorldFileInformation(map) {\n    const currentResolution = map.viewController.getResolution();\n    const currentExtent = map.viewController.getExtent(); // Return [minx, miny, maxx, maxy]\n    return [\n      currentResolution,\n      0,\n      0,\n      -currentResolution,\n      currentExtent[0] + currentResolution / 0.5,\n      currentExtent[3] - currentResolution / 0.5\n    ].join('\\n');\n  }\n\n  /**\n   * Save canvas image as file\n   * @param canvas - Canvas to save\n   * @param name - Name of the file\n   * @param format - file format\n   */\n  private saveCanvasImageAsFile(canvas, nameWithExt, format) {\n    const blobFormat = 'image/' + format;\n    const that = this;\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      // If navigator is Internet Explorer\n      if (navigator.msSaveBlob) {\n        navigator.msSaveBlob(canvas.msToBlob(), nameWithExt);\n        this.saveFileProcessing();\n      } else {\n        canvas.toBlob((blob) => {\n          // download image\n          saveAs(blob, nameWithExt);\n          that.saveFileProcessing();\n        }, blobFormat);\n      }\n    } catch (err) {\n      this.messageService.error(\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageBody'\n        ),\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageHeader'\n        )\n      );\n    }\n  }\n\n  /**\n   * Add file to a zip\n   * @param canvas - File to add to the zip\n   * @param  name -Name of the fileoverview\n   */\n  private generateCanvaFileToZip(canvas, name) {\n    const blobFormat = 'image/' + 'jpeg';\n    const that = this;\n    if (\n      !this.hasOwnProperty('zipFile') ||\n      typeof this.zipFile === 'undefined'\n    ) {\n      this.zipFile = new JSZip();\n    }\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      if (navigator.msSaveBlob) {\n        this.addFileToZip(name, canvas.msToBlob());\n      } else {\n        canvas.toBlob((blob) => {\n          that.addFileToZip(name, blob);\n        }, blobFormat);\n      }\n    } catch (err) {\n      this.messageService.error(\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageBody'\n        ),\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageHeader'\n        )\n      );\n    }\n  }\n\n  /**\n   * Add file to zip, if all file are zipped, download\n   * @param name - Name of the files\n   * @param blob - Contain of file\n   */\n  private addFileToZip(name, blob) {\n    // add file to zip\n    this.zipFile.file(name, blob);\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Download zip file\n      this.getZipFile();\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  private saveFileProcessing() {\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  /**\n   * Get the zipped file\n   * @return Retun a zip file\n   */\n  private getZipFile() {\n    const that = this;\n    this.zipFile.generateAsync({ type: 'blob' }).then((blob) => {\n      // 1) generate the zip file\n      saveAs(blob, 'map.zip');\n      delete that.zipFile;\n    });\n  }\n}\n","import { Layer } from '../shared/layers/layer';\nimport { LegendMapViewOptions, OutputLayerLegend } from '../shared/layers/layer.interface';\n\n/**\n * Get all the layers legend\n * @return Array of legend\n */\nexport function getLayersLegends(layers: Layer[], view?: LegendMapViewOptions): OutputLayerLegend[] {\n  const legends = [];\n\n  for (const layer of layers) {\n    const legendOptions = layer.options.legendOptions;\n    if (layer.visible === false) { continue; }\n\n    const legendUrls = layer.dataSource.getLegend(undefined, view) || [];\n    for (const legendUrl of legendUrls) {\n      if (legendUrl.url === undefined) { continue; }\n\n      // Add legend info to the list\n      legends.push({\n        title: layer.title || '',\n        url: legendUrl.url,\n        display: legendOptions?.display === undefined ? true : legendOptions.display\n      });\n    }\n  }\n\n  return legends;\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const PrintOutputFormat = strEnum(['Pdf', 'Image']);\n\nexport type PrintOutputFormat = keyof typeof PrintOutputFormat;\n\nexport const PrintPaperFormat = strEnum([\n  'A0',\n  'A1',\n  'A2',\n  'A3',\n  'A4',\n  'A5',\n  'Letter',\n  'Legal'\n]);\nexport type PrintPaperFormat = keyof typeof PrintPaperFormat;\n\nexport const PrintOrientation = strEnum(['landscape', 'portrait']);\nexport type PrintOrientation = keyof typeof PrintOrientation;\n\nexport const PrintResolution = strEnum(['72', '96', '150', '300']);\nexport type PrintResolution = keyof typeof PrintResolution;\n\nexport const PrintSaveImageFormat = strEnum([\n  'Bmp',\n  'Gif',\n  'Jpeg',\n  'Png',\n  'Tiff'\n]);\nexport type PrintSaveImageFormat = keyof typeof PrintSaveImageFormat;\n\nexport const PrintLegendPosition = strEnum([\n  'none',\n  'topright',\n  'topleft',\n  'bottomleft',\n  'bottomright',\n  'newpage'\n]);\nexport type PrintLegendPosition = keyof typeof PrintLegendPosition;\n","<form class=\"igo-form\" [formGroup]=\"form\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"title\"\n        placeholder=\"{{'igo.geo.printForm.title' | translate}}\">\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"subtitle\"\n        placeholder=\"{{'igo.geo.printForm.subtitle' | translate}}\">\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"comment\"\n        placeholder=\"{{'igo.geo.printForm.comment' | translate}}\">\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <div class=\"print-slide-toggle-container mat-typography\">\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showProjection\"\n        [labelPosition]=\"'before'\">\n        {{'igo.geo.printForm.showProjection' | translate}}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showScale\"\n        [labelPosition]=\"'before'\">\n        {{'igo.geo.printForm.showScale' | translate}}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"doZipFile\"\n        [labelPosition]=\"'before'\"\n        [style.display]=\"isPrintService ? 'none' : ''\">\n        {{'igo.geo.printForm.doZipFile' | translate}}\n      </mat-slide-toggle>\n    </div>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"legendPosition\"\n        placeholder=\"{{'igo.geo.printForm.legendPosition' | translate}}\">\n        <mat-option *ngFor=\"let legendPosition of legendPositions | keyvalue \" [value]=\"legendPosition.key\">\n            {{'igo.geo.printForm.legendPositions.' + legendPosition.value | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-select (selectionChange)=\"toggleImageSaveProp()\"\n        formControlName=\"outputFormat\"\n        placeholder=\"{{'igo.geo.printForm.outputFormat' | translate}}\">\n        <mat-option *ngFor=\"let outputFormat of outputFormats | keyvalue \" [value]=\"outputFormat.key\">\n            {{outputFormat.value}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'block' : 'none'\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"paperFormat\"\n        placeholder=\"{{'igo.geo.printForm.paperFormat' | translate}}\">\n        <mat-option *ngFor=\"let paperFormat of paperFormats | keyvalue \" [value]=\"paperFormat.key\">\n          {{('igo.geo.printForm.paperFormats.' + paperFormat.value) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'none' : 'block'\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"imageFormat\"\n        placeholder=\"{{'igo.geo.printForm.imageFormat' | translate}}\">\n        <mat-option *ngFor=\"let imageFormat of imageFormats | keyvalue \" [value]=\"imageFormat.key\">\n          {{imageFormat.value}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" style=\"display: none;\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"resolution\"\n        placeholder=\"{{'igo.geo.printForm.resolution' | translate}}\">\n        <mat-option *ngFor=\"let resolution of resolutions | keyvalue \" [value]=\"resolution.key\">\n          {{resolution.value + ' PPI'}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'block' : 'none'\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"orientation\"\n        placeholder=\"{{'igo.geo.printForm.orientation' | translate}}\">\n        <mat-option *ngFor=\"let orientation of orientations | keyvalue \" [value]=\"orientation.key\">\n          {{('igo.geo.printForm.' + orientation.value) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-form-button-group print-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (disabled$ | async)\"\n      (click)=\"handleFormSubmit(form.value, form.valid)\">\n      {{'igo.geo.printForm.saveBtn' | translate}}\n    </button>\n  </div>\n\n</form>\n","import { Component, Input, Output, EventEmitter, OnInit } from '@angular/core';\nimport {\n  FormGroup,\n  FormBuilder,\n  FormControl,\n  Validators\n} from '@angular/forms';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { PrintOptions } from '../shared/print.interface';\n\nimport {\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintOrientation,\n  PrintResolution,\n  PrintSaveImageFormat,\n  PrintLegendPosition\n} from '../shared/print.type';\n\n@Component({\n  selector: 'igo-print-form',\n  templateUrl: './print-form.component.html',\n  styleUrls: ['./print-form.component.scss']\n})\nexport class PrintFormComponent implements OnInit {\n  public form: FormGroup;\n  public outputFormats = PrintOutputFormat;\n  public paperFormats = PrintPaperFormat;\n  public orientations = PrintOrientation;\n  public resolutions = PrintResolution;\n  public imageFormats = PrintSaveImageFormat;\n  public legendPositions = PrintLegendPosition;\n  public isPrintService = true;\n\n  @Input() disabled$: BehaviorSubject<boolean>;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this.imageFormatField.value;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this.imageFormatField.setValue(value || PrintSaveImageFormat.Jpeg, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this.outputFormatField.value;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this.outputFormatField.setValue(value || PrintOutputFormat.Pdf, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this.paperFormatField.value;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this.paperFormatField.setValue(value || PrintPaperFormat.Letter, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this.orientationField.value;\n  }\n  set orientation(value: PrintOrientation) {\n    this.orientationField.setValue(value || PrintOrientation.landscape, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this.resolutionField.value;\n  }\n  set resolution(value: PrintResolution) {\n    this.resolutionField.setValue(value || PrintResolution['96'], {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this.legendPositionField.value;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this.legendPositionField.setValue(value || PrintLegendPosition.none, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get title(): string {\n    return this.titleField.value;\n  }\n  set title(value: string) {\n    this.titleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get subtitle(): string {\n    return this.subtitleField.value;\n  }\n  set subtitle(value: string) {\n    this.subtitleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get comment(): string {\n    return this.commentField.value;\n  }\n  set comment(value: string) {\n    this.commentField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showProjection(): boolean {\n    return this.showProjectionField.value;\n  }\n  set showProjection(value: boolean) {\n    this.showProjectionField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showScale(): boolean {\n    return this.showScaleField.value;\n  }\n  set showScale(value: boolean) {\n    this.showScaleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showLegend(): boolean {\n    return this.showLegendField.value;\n  }\n  set showLegend(value: boolean) {\n    this.showLegendField.setValue(value, { onlySelf: true });\n  }\n\n  @Input()\n  get doZipFile(): boolean {\n    return this.doZipFileField.value;\n  }\n  set doZipFile(value: boolean) {\n    this.doZipFileField.setValue(value, { onlySelf: true });\n  }\n\n  get outputFormatField() {\n    return (this.form.controls as any).outputFormat as FormControl;\n  }\n\n  get paperFormatField() {\n    return (this.form.controls as any).paperFormat as FormControl;\n  }\n\n  get imageFormatField() {\n    return (this.form.controls as any).imageFormat as FormControl;\n  }\n\n  get orientationField() {\n    return (this.form.controls as any).orientation as FormControl;\n  }\n\n  get resolutionField() {\n    return (this.form.controls as any).resolution as FormControl;\n  }\n\n  get commentField() {\n    return (this.form.controls as any).comment as FormControl;\n  }\n\n  get showProjectionField() {\n    return (this.form.controls as any).showProjection as FormControl;\n  }\n\n  get showScaleField() {\n    return (this.form.controls as any).showScale as FormControl;\n  }\n\n  get showLegendField() {\n    return (this.form.controls as any).showLegend as FormControl;\n  }\n\n  get doZipFileField() {\n    return (this.form.controls as any).doZipFile as FormControl;\n  }\n\n  get titleField() {\n    return (this.form.controls as any).title as FormControl;\n  }\n\n  get subtitleField() {\n    return (this.form.controls as any).subtitle as FormControl;\n  }\n\n  get legendPositionField() {\n    return (this.form.controls as any).legendPosition as FormControl;\n  }\n\n  @Output() submit: EventEmitter<PrintOptions> = new EventEmitter();\n\n  constructor(private formBuilder: FormBuilder) {\n    this.form = this.formBuilder.group({\n      title: ['', []],\n      subtitle: ['', []],\n      comment: ['', []],\n      outputFormat: ['', [Validators.required]],\n      paperFormat: ['', [Validators.required]],\n      imageFormat: [ '', [Validators.required]],\n      resolution: ['', [Validators.required]],\n      orientation: ['', [Validators.required]],\n      legendPosition: ['', [Validators.required]],\n      showProjection: false,\n      showScale: false,\n      showLegend: false,\n      doZipFile: [{hidden: this.isPrintService }]\n    });\n  }\n\n  ngOnInit() {\n    this.doZipFileField.setValue(false);\n  }\n\n  handleFormSubmit(data: PrintOptions, isValid: boolean) {\n    data.isPrintService = this.isPrintService;\n    if (isValid) {\n      this.submit.emit(data);\n    }\n  }\n\n  toggleImageSaveProp() {\n    if (this.outputFormatField.value === 'Image') {\n      this.isPrintService = false;\n    } else {\n      this.isPrintService = true;\n    }\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { PrintOptions } from '../shared/print.interface';\n\nimport {\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintOrientation,\n  PrintResolution,\n  PrintSaveImageFormat,\n  PrintLegendPosition\n} from '../shared/print.type';\n\nimport { PrintService } from '../shared/print.service';\n\n@Component({\n  selector: 'igo-print',\n  templateUrl: './print.component.html'\n})\nexport class PrintComponent {\n  public disabled$ = new BehaviorSubject(false);\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this._outputFormat;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this._outputFormat = value;\n  }\n  private _outputFormat: PrintOutputFormat;\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this._paperFormat;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this._paperFormat = value;\n  }\n  private _paperFormat: PrintPaperFormat;\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this._orientation;\n  }\n  set orientation(value: PrintOrientation) {\n    this._orientation = value;\n  }\n  private _orientation: PrintOrientation;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this._imageFormat;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this._imageFormat = value;\n  }\n  private _imageFormat: PrintSaveImageFormat;\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this._legendPosition;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this._legendPosition = value;\n  }\n  private _legendPosition: PrintLegendPosition;\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this._resolution;\n  }\n  set resolution(value: PrintResolution) {\n    this._resolution = value;\n  }\n  private _resolution: PrintResolution;\n\n  constructor(private printService: PrintService) {}\n\n  handleFormSubmit(data: PrintOptions) {\n\n    this.disabled$.next(true);\n\n    if (data.isPrintService === true) {\n      this.printService\n        .print(this.map, data)\n        .pipe(take(1))\n        .subscribe(() => {\n          this.disabled$.next(false);\n        });\n    } else {\n      let nbFileToProcess = 1;\n\n      if (data.showLegend) {\n        nbFileToProcess++;\n      }\n      if (data.imageFormat.toLowerCase() === 'tiff') {\n        nbFileToProcess++;\n      }\n\n      this.printService.defineNbFileToProcess(nbFileToProcess);\n\n      const resolution = +data.resolution;\n\n      let nbRequests = data.showLegend ? 2 : 1;\n      this.printService\n        .downloadMapImage(\n          this.map,\n          resolution,\n          data.imageFormat,\n          data.showProjection,\n          data.showScale,\n          data.showLegend,\n          data.title,\n          data.subtitle,\n          data.comment,\n          data.doZipFile\n        )\n        .pipe(take(1))\n        .subscribe(() => {\n          nbRequests--;\n          if (!nbRequests) {\n            this.disabled$.next(false);\n          }\n        });\n      if (data.showLegend) {\n        this.printService\n          .getLayersLegendImage(\n            this.map,\n            data.imageFormat,\n            data.doZipFile,\n            +resolution\n          )\n          .then(() => {\n            nbRequests--;\n            if (!nbRequests) {\n              this.disabled$.next(false);\n            }\n          });\n      }\n    }\n  }\n}\n","<igo-print-form\n  [outputFormat]=\"outputFormat\"\n  [paperFormat]=\"paperFormat\"\n  [orientation]=\"orientation\"\n  [imageFormat]=\"imageFormat\"\n  [resolution]=\"resolution\"\n  [legendPosition]=\"legendPosition\"\n  [disabled$]=\"disabled$\"\n  (submit)=\"handleFormSubmit($event)\">\n</igo-print-form>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule } from '@igo2/common';\n\nimport { PrintComponent } from './print/print.component';\nimport { PrintFormComponent } from './print-form/print-form.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatInputModule,\n    MatFormFieldModule,\n    MatSlideToggleModule,\n    IgoLanguageModule,\n    IgoKeyValueModule\n  ],\n  exports: [PrintComponent, PrintFormComponent],\n  declarations: [PrintComponent, PrintFormComponent]\n})\nexport class IgoPrintModule {}\n","import { ConfigService } from '@igo2/core';\n\nimport { SearchSource } from '../../search/shared/sources/source';\n\nimport { QuerySearchSource } from './query-search-source';\n\n/**\n * Map search source factory\n * @ignore\n */\nexport function querySearchSourceFactory(config: ConfigService) {\n  return new QuerySearchSource(\n    config.getConfig(`searchSources.${QuerySearchSource.id}`) || {}\n  );\n}\n\n/**\n * Function that returns a provider for the map search source\n */\nexport function provideQuerySearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: querySearchSourceFactory,\n    multi: true,\n    deps: [ConfigService]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoLanguageModule, IgoMessageModule } from '@igo2/core';\n\nimport { QueryDirective } from './shared/query.directive';\nimport { QueryService } from './shared/query.service';\nimport { provideQuerySearchSource } from './shared/query-search-source.providers';\n\n@NgModule({\n  imports: [CommonModule, IgoLanguageModule, IgoMessageModule],\n  exports: [QueryDirective],\n  declarations: [QueryDirective],\n  providers: [QueryService]\n})\nexport class IgoQueryModule {\n  static forRoot(): ModuleWithProviders<IgoQueryModule> {\n    return {\n      ngModule: IgoQueryModule,\n      providers: [provideQuerySearchSource()]\n    };\n  }\n}\n","import { DirectionsSource } from '../directions-sources/directions-source';\n\nexport class DirectionsSourceService {\n  constructor(public sources: DirectionsSource[]) {}\n}\n\nexport function directionsSourceServiceFactory(sources: DirectionsSource[]) {\n  return new DirectionsSourceService(sources);\n}\n\nexport function provideDirectionsSourceService() {\n  return {\n    provide: DirectionsSourceService,\n    useFactory: directionsSourceServiceFactory,\n    deps: [DirectionsSource]\n  };\n}\n","export enum DirectionsFormat {\n  GeoJSON,\n  JSON\n}\nexport enum SourceDirectionsType {\n  Route = 'route',\n  Trip = 'trip'\n}\n\nexport enum ProposalType {\n  Coord = 'coord',\n  Text = 'text'\n}\n\nexport enum DirectionType {\n  Stop = 'stop',\n  Route = 'route',\n  Vertex = 'vertex'\n}\n\nexport enum DirectionRelativePositionType {\n  Start = 'start',\n  Intermediate = 'intermediate',\n  End = 'end'\n}\n","import olFeature from 'ol/Feature';\nimport * as olStyle from 'ol/style';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olGeom from 'ol/geom';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olProj from 'ol/proj';\n\nimport { uuid, NumberUtils } from '@igo2/utils';\n\nimport { Direction, FeatureWithDirection, FeatureWithStop, Stop } from './directions.interface';\nimport { createOverlayMarkerStyle } from '../../overlay/shared/overlay-marker-style.utils';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { tryAddLoadingStrategy } from '../../feature/shared/strategies.utils';\nimport { FeatureStoreLoadingStrategy } from '../../feature/shared/strategies/loading';\nimport { FEATURE, FeatureMotion } from '../../feature/shared/feature.enums';\nimport { LanguageService } from '@igo2/core';\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { DirectionRelativePositionType, DirectionType } from './directions.enum';\nimport { RoutesFeatureStore, StepFeatureStore, StopsFeatureStore, StopsStore } from './store';\n\n/**\n * Function that updat the sort of the list base on the provided field.\n * @param source stop store\n * @param direction asc / desc sort order\n * @param field the field to use to sort the view\n */\nexport function updateStoreSorting(stopsStore: StopsStore, direction: 'asc' | 'desc' = 'asc', field = 'position') {\n  stopsStore.view.sort({\n    direction,\n    valueAccessor: (entity: Stop) => entity[field]\n  });\n}\n\nexport function computeRelativePosition(index: number, totalLength): DirectionRelativePositionType {\n  let relativePosition = DirectionRelativePositionType.Intermediate;\n  if (index === 0) {\n    relativePosition = DirectionRelativePositionType.Start;\n  } else if (index === totalLength - 1) {\n    relativePosition = DirectionRelativePositionType.End;\n  }\n  return relativePosition;\n}\n\nexport function computeStopsPosition(stopsStore: StopsStore) {\n\n  const stopsToComputePosition = [...stopsStore.all()];\n  stopsToComputePosition.sort((a, b) => a.position - b.position);\n  stopsToComputePosition.map((stop, i) => {\n    stop.position = i;\n    stop.relativePosition = computeRelativePosition(stop.position, stopsToComputePosition.length);\n  });\n  if (stopsToComputePosition) {\n    stopsStore.updateMany(stopsToComputePosition);\n  }\n}\n\n/**\n * Function that add a stop to the stop store. Stop are always added before the last stop.\n * @param stopsStore stop store as an EntityStore\n */\nexport function addStopToStore(stopsStore: StopsStore): Stop {\n\n  const id = uuid();\n  const stops = stopsStore.all();\n  let positions: number[];\n  if (stopsStore.count === 0) {\n    positions = [0];\n  } else {\n    positions = stops.map(stop => stop.position);\n  }\n  const maxPosition: number = Math.max(...positions);\n  const insertPosition: number = maxPosition;\n  const lastPosition: number = maxPosition + 1;\n\n  const stopToUpdate = stopsStore.all().find(stop => stop.position === maxPosition);\n  if (stopToUpdate) {\n    stopToUpdate.position = lastPosition;\n    stopToUpdate.relativePosition = computeRelativePosition(lastPosition, stopsStore.count + 1);\n  }\n\n  stopsStore.insert({ id, position: insertPosition, relativePosition: computeRelativePosition(insertPosition, stopsStore.count + 1) });\n\n  updateStoreSorting(stopsStore);\n  return stopsStore.get(id);\n}\n\nexport function removeStopFromStore(stopsStore: StopsStore, stop: Stop) {\n  stopsStore.delete(stop);\n  computeStopsPosition(stopsStore);\n}\n\n/**\n * Create a style for the directions stops and routes\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function directionsStyle(\n  feature: olFeature<OlGeometry>,\n  resolution: number\n): olStyle.Style | olStyle.Style[] {\n  const vertexStyle = [\n    new olStyle.Style({\n      geometry: feature.getGeometry(),\n      image: new olStyle.Circle({\n        radius: 7,\n        stroke: new olStyle.Stroke({ color: '#FF0000', width: 3 })\n      })\n    })\n  ];\n\n  const stopStyle = createOverlayMarkerStyle({\n    text: feature.get('stopText'),\n    opacity: feature.get('stopOpacity'),\n    markerColor: feature.get('stopColor'),\n    markerOutlineColor: [255, 255, 255]\n  });\n\n  const routeStyle = [\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({ color: `rgba(106, 121, 130, ${feature.get('active') ? 0.75 : 0})`, width: 10 })\n    }),\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({ color: `rgba(79, 169, 221, ${feature.get('active') ? 0.75 : 0})`, width: 6 })\n    })\n  ];\n\n  if (feature.get('type') === DirectionType.Stop) {\n    return stopStyle;\n  }\n  if (feature.get('type') === 'vertex') {\n    return vertexStyle;\n  }\n  if (feature.get('type') === DirectionType.Route) {\n    return routeStyle;\n  }\n}\n\nexport function initStopsFeatureStore(stopsFeatureStore: StopsFeatureStore, languageService: LanguageService) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stopsLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-stops-layer',\n    title: languageService.translate.instant('igo.geo.directionsForm.stopLayer'),\n    zIndex: 911,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-stops-layer',\n      links: [\n        {\n          bidirectionnal: false,\n          syncedDelete: true,\n          linkedIds: ['igo-direction-route-layer'],\n          properties: []\n        }\n      ]\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stopsFeatureStore, stopsLayer);\n  stopsFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stopsFeatureStore, loadingStrategy);\n}\n\nexport function initRoutesFeatureStore(routesFeatureStore: RoutesFeatureStore, languageService: LanguageService) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const routeLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-route-layer',\n    title: languageService.translate.instant('igo.geo.directionsForm.routeLayer'),\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(routesFeatureStore, routeLayer);\n  routesFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(routesFeatureStore, loadingStrategy);\n}\n\nexport function initStepFeatureStore(stepFeatureStore: StepFeatureStore) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stepLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-step-layer',\n    title: '',\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: false,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: false,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stepFeatureStore, stepLayer);\n  stepFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stepFeatureStore, loadingStrategy);\n}\n\n\nexport function addStopToStopsFeatureStore(\n  stop: Stop,\n  stopsStore: StopsStore,\n  stopsFeatureStore: StopsFeatureStore,\n  projection: string,\n  languageService: LanguageService) {\n  let stopColor;\n  let stopText;\n\n\n  switch (stop.relativePosition) {\n    case DirectionRelativePositionType.Start:\n      stopColor = '#008000';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.start');\n      break;\n    case DirectionRelativePositionType.End:\n      stopColor = '#f64139';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.end');\n      break;\n    default:\n      stopColor = '#ffd700';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.intermediate') + ' #' + stop.position;\n      break;\n  }\n\n  const geometry = new olGeom.Point(\n    olProj.transform(stop.coordinates, projection, stopsFeatureStore.map.projection)\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: stopsFeatureStore.map.projection,\n    dataProjection: stopsFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n  const previousStop = stopsFeatureStore.get(stop.id);\n  const previousStopRevision = previousStop ? previousStop.meta.revision : 0;\n\n  const stopFeatureStore: FeatureWithStop = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: stopsFeatureStore.map.projection,\n    properties: {\n      id: stop.id,\n      type: DirectionType.Stop,\n      stopText,\n      stopColor,\n      stopOpacity: 1,\n      stop\n    },\n    meta: {\n      id: stop.id,\n      revision: previousStopRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  stopsFeatureStore.update(stopFeatureStore);\n}\n\nexport function addDirectionToRoutesFeatureStore(\n  routesFeatureStore: RoutesFeatureStore,\n  direction: Direction,\n  projection: string,\n  active: boolean = false,\n  moveToExtent = false) {\n  const geom = direction.geometry.coordinates;\n  const geometry4326 = new olGeom.LineString(geom);\n  const geometry = geometry4326.transform(\n    projection,\n    routesFeatureStore.map.projection\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: routesFeatureStore.map.projection,\n    dataProjection: routesFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n\n  const previousRoute = routesFeatureStore.get(direction.id);\n  const previousRouteRevision = previousRoute\n    ? previousRoute.meta.revision\n    : 0;\n\n  const routeFeatureStore: FeatureWithDirection = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: routesFeatureStore.map.projection,\n    properties: {\n      id: direction.id,\n      type: DirectionType.Route,\n      active,\n      direction\n    },\n    meta: {\n      id: direction.id,\n      revision: previousRouteRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  routesFeatureStore.update(routeFeatureStore);\n}\n\nexport function formatDistance(distance: number): string {\n  if (distance === 0) {\n    return;\n  }\n  if (distance >= 100000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 1000, 1) + ' km';\n  }\n  if (distance >= 10000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km';\n  }\n  if (distance >= 1000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km';\n  }\n  return NumberUtils.roundToNDecimal(distance, 0) + ' m';\n}\n\nexport function formatDuration(duration: number): string {\n  if (duration >= 3600) {\n    const hour = Math.floor(duration / 3600);\n    const minute = Math.round((duration / 3600 - hour) * 60);\n    if (minute === 60) {\n      return hour + 1 + ' h';\n    }\n    return hour + ' h ' + minute + ' min';\n  }\n\n  if (duration >= 60) {\n    return Math.round(duration / 60) + ' min';\n  }\n  return duration + ' s';\n}\n\nexport function formatInstruction(\n  type,\n  modifier,\n  route,\n  direction,\n  stepPosition,\n  exit,\n  languageService: LanguageService,\n  lastStep = false\n) {\n  const translate = languageService.translate;\n  let directive;\n  let image = 'forward';\n  let cssClass = 'rotate-270';\n  const translatedDirection = translateBearing(direction, languageService);\n  const translatedModifier = translateModifier(modifier, languageService);\n  const prefix = modifier === 'straight' ? '' : translate.instant('igo.geo.directions.modifier.prefix');\n\n  let aggregatedDirection = prefix + translatedModifier;\n\n\n  if (modifier?.search('slight') >= 0) {\n    aggregatedDirection = translatedModifier;\n  }\n\n  if (modifier === 'uturn') {\n    image = 'forward';\n    cssClass = 'rotate-90';\n  } else if (modifier === 'sharp right') {\n    image = 'subdirectory-arrow-right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'right') {\n    image = 'subdirectory-arrow-right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'slight right') {\n    image = 'forward';\n    cssClass = 'rotate-290';\n  } else if (modifier === 'straight') {\n    image = 'forward';\n  } else if (modifier === 'slight left') {\n    image = 'forward';\n    cssClass = 'rotate-250';\n  } else if (modifier === 'left') {\n    image = 'subdirectory-arrow-left';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'sharp left') {\n    image = 'subdirectory-arrow-left';\n    cssClass = 'icon-flipped';\n  }\n\n  if (type === 'turn') {\n    if (modifier === 'straight') {\n      directive = translate.instant('igo.geo.directions.turn.straight', { route });\n    } else if (modifier === 'uturn') {\n      directive = translate.instant('igo.geo.directions.turn.uturn', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.turn.else', { route, aggregatedDirection, translatedModifier });\n    }\n  } else if (type === 'new name') {\n    directive = translate.instant('igo.geo.directions.new name', { route, translatedDirection });\n    image = 'compass';\n    cssClass = '';\n  } else if (type === 'depart') {\n    directive = translate.instant('igo.geo.directions.depart', { route, translatedDirection });\n    image = 'compass';\n    cssClass = '';\n  } else if (type === 'arrive') {\n    if (lastStep) {\n      const coma = !translatedModifier ? '' : ', ';\n      aggregatedDirection = !translatedModifier ? '' : aggregatedDirection;\n      directive = translate.instant('igo.geo.directions.arrive.lastStep', { coma, aggregatedDirection });\n    } else {\n      directive = translate.instant('igo.geo.directions.arrive.intermediate', { route });\n      image = 'map-marker';\n      cssClass = '';\n    }\n  } else if (type === 'merge') {\n    directive = translate.instant('igo.geo.directions.merge', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'on ramp') {\n    directive = translate.instant('igo.geo.directions.on ramp', { aggregatedDirection });\n  } else if (type === 'off ramp') {\n    directive = translate.instant('igo.geo.directions.off ramp', { aggregatedDirection });\n  } else if (type === 'fork') {\n    if (modifier.search('left') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.left', { route });\n    } else if (modifier.search('right') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.right', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.fork.else', { route });\n    }\n  } else if (type === 'end of road') {\n    directive = translate.instant('igo.geo.directions.end of road', { translatedModifier, route });\n  } else if (type === 'use lane') {\n    directive = translate.instant('igo.geo.directions.use lane');\n  } else if (type === 'continue' && modifier !== 'uturn') {\n    directive = translate.instant('igo.geo.directions.continue.notUturn', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'roundabout') {\n    const cntSuffix = exit === 1 ?\n      translate.instant('igo.geo.directions.cntSuffix.first') :\n      translate.instant('igo.geo.directions.cntSuffix.secondAndMore');\n    directive = translate.instant('igo.geo.directions.roundabout', { exit, cntSuffix, route });\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'rotary') {\n    directive = translate.instant('igo.geo.directions.rotary');\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'roundabout turn') {\n    directive = translate.instant('igo.geo.directions.roundabout turn');\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'exit roundabout') {\n    directive = translate.instant('igo.geo.directions.exit roundabout', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'notification') {\n    directive = translate.instant('igo.geo.directions.notification');\n  } else if (modifier === 'uturn') {\n    directive = translate.instant('igo.geo.directions.uturnText', { translatedDirection, route });\n  } else {\n    directive = translate.instant('igo.geo.directions.unknown');\n  }\n\n  image = lastStep ? 'flag-variant' : image;\n  cssClass = lastStep ? '' : cssClass;\n  image = stepPosition === 0 ? 'compass' : image;\n  cssClass = stepPosition === 0 ? '' : cssClass;\n\n  return { instruction: directive, image, cssClass };\n}\n\nexport function translateModifier(modifier, languageService: LanguageService) {\n  const translate = languageService.translate;\n  if (modifier === 'uturn') {\n    return translate.instant('igo.geo.directions.uturn');\n  } else if (modifier === 'sharp right') {\n    return translate.instant('igo.geo.directions.sharp right');\n  } else if (modifier === 'right') {\n    return translate.instant('igo.geo.directions.right');\n  } else if (modifier === 'slight right') {\n    return translate.instant('igo.geo.directions.slight right');\n  } else if (modifier === 'sharp left') {\n    return languageService.translate.instant('igo.geo.directions.sharp left');\n  } else if (modifier === 'left') {\n    return languageService.translate.instant('igo.geo.directions.left');\n  } else if (modifier === 'slight left') {\n    return languageService.translate.instant('igo.geo.directions.slight left');\n  } else if (modifier === 'straight') {\n    return languageService.translate.instant('igo.geo.directions.straight');\n  } else {\n    return modifier;\n  }\n}\n\nexport function translateBearing(bearing: number, languageService: LanguageService) {\n  const translate = languageService.translate;\n  if (bearing >= 337 || bearing < 23) {\n    return translate.instant('igo.geo.cardinalPoints.n');\n  } else if (bearing < 67) {\n    return translate.instant('igo.geo.cardinalPoints.ne');\n  } else if (bearing < 113) {\n    return translate.instant('igo.geo.cardinalPoints.e');\n  } else if (bearing < 157) {\n    return translate.instant('igo.geo.cardinalPoints.se');\n  } else if (bearing < 203) {\n    return translate.instant('igo.geo.cardinalPoints.s');\n  } else if (bearing < 247) {\n    return translate.instant('igo.geo.cardinalPoints.sw');\n  } else if (bearing < 293) {\n    return translate.instant('igo.geo.cardinalPoints.w');\n  } else if (bearing < 337) {\n    return translate.instant('igo.geo.cardinalPoints.nw');\n  } else {\n    return;\n  }\n}\n\n\n","<div cdkDropList class=\"stops-list\" (cdkDropListDropped)=\"drop($event)\">\n  <div touchleave  \n  (touchenter)=\"onStopEnter(stop)\"\n  (touchleave)=\"onStopLeave()\"\n  (mouseover)=\"onStopEnter(stop)\"\n  (mouseleave)=\"onStopLeave()\"\n  (cdkDragStarted)=\"stopIsDragged=true\"\n  (cdkDragEnded)=\"stopIsDragged=false\"\n  cdkDragLockAxis=\"y\" class=\"stop-box mat-typography\" *ngFor=\"let stop of stopsStore.view.all$() | async; let i = index;\" cdkDrag>\n    <div [ngClass]=\"getNgClass(stop)\">\n      <mat-form-field>\n        <input id=\"{{stop.id}}\" type=\"text\"\n            [placeholder]=\"getPlaceholder(stop)\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"stop.text\"\n            aria-label=\"Number\"\n            matInput\n            (focus)=\"onInputFocus(stop)\"\n            [(ngModel)]=\"stop.text\"\n            (keyup)=\"setStopText($event,stop)\"\n            (keydown.enter)=\"$event.preventDefault()\"\n            [matAutocomplete]=\"auto\">\n        <button \n            mat-button \n            *ngIf=\"(stop.text || stop.coordinates) && stopWithHover && stop.id===stopWithHover.id\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"'igo.geo.directionsForm.clearStop' | translate\"\n            matSuffix mat-icon-button color=\"warn\" aria-label=\"Clear\" (click)=\"clearStop(stop)\">\n            <mat-icon svgIcon=\"close\"></mat-icon>\n        </button>\n      \n        <mat-autocomplete [displayWith]=\"getOptionText\" #auto=\"matAutocomplete\" (optionSelected)=\"chooseProposal($event,stop)\">\n          <mat-optgroup *ngFor=\"let source of stop.searchProposals\" [label]=\"source.source.title\" [disabled]=\"source.source.enabled === false\">\n          <mat-option *ngFor=\"let result of source.results\" [value]=\"result\" \n          matTooltipShowDelay=\"500\" [matTooltip]=\"result.meta ? result.meta.title : ''\">\n            {{ result.meta ? result.meta.title : '' }}\n          </mat-option>\n          </mat-optgroup>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n\n\n\n\n    <div class=\"igo-form-button-group\" *ngIf=\"!stopIsDragged && stopWithHover && stop.id === stopWithHover.id\">\n      <button class=\"swipe-vertical\" cdkDragHandle mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.moveStop' | translate\" color=\"primary\">\n        <mat-icon svgIcon=\"gesture-swipe-vertical\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"(stopsStore.count$ | async)> 2\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\" color=\"warn\" (click)=\"removeStop(stop)\">\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n      <button *ngIf=\"(stopsStore.count$ | async)<= 2\" disabled=\"true\" mat-icon-button tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\" color=\"warn\">\n        <mat-icon svgIcon=\"blank\"></mat-icon>\n      </button>\n    </div>\n  </div>\n</div>","import { Component, EventEmitter, Input, OnDestroy, Output } from '@angular/core';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\n\nimport * as olProj from 'ol/proj';\nimport * as olObservable from 'ol/Observable';\n\nimport { Stop } from '../shared/directions.interface';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport pointOnFeature from '@turf/point-on-feature';\nimport { computeRelativePosition, removeStopFromStore, updateStoreSorting } from '../shared/directions.utils';\nimport { MatAutocomplete } from '@angular/material/autocomplete';\nimport { MatOption } from '@angular/material/core';\nimport { StopsFeatureStore, StopsStore } from '../shared/store';\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { LanguageService } from '@igo2/core';\nimport { DirectionRelativePositionType } from '../shared/directions.enum';\n\n@Component({\n  selector: 'igo-directions-inputs',\n  templateUrl: './directions-inputs.component.html',\n  styleUrls: ['./directions-inputs.component.scss']\n})\nexport class DirectionsInputsComponent implements OnDestroy {\n\n  private readonly invalidKeys = ['Control', 'Shift', 'Alt'];\n  private onMapClickEventKeys = [];\n  public stopWithHover: Stop;\n  public stopIsDragged: boolean = false;\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() projection: string;\n  @Input() coordRoundedDecimals: number = 6;\n\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n\n  @Output() stopInputHasFocus: EventEmitter<boolean> = new EventEmitter<boolean>(false);\n  constructor(private languageService: LanguageService) { }\n\n  ngOnDestroy(): void {\n    this.unlistenMapSingleClick();\n  }\n  onStopEnter(stop: Stop) {\n    this.stopWithHover = stop;\n  }\n  onStopLeave() {\n    this.stopWithHover = undefined;\n  }\n\n  getOptionText(option) {\n    if (option instanceof Object) {\n      return option?.meta ? option.meta.title : '';\n    }\n    return option;\n  }\n\n  chooseProposal(event: { source: MatAutocomplete, option: MatOption }, stop: Stop) {\n    const result: Feature = event.option.value;\n    if (result) {\n      let geomCoord;\n      const geom = result.geometry;\n      if (geom.type === 'Point') {\n        geomCoord = geom.coordinates;\n      } else {\n        const point = pointOnFeature(result.geometry);\n        geomCoord = [\n          point.geometry.coordinates[0],\n          point.geometry.coordinates[1]\n        ];\n      }\n      if (geomCoord) {\n        stop.coordinates = geomCoord;\n        stop.text = result.meta.title;\n        this.stopsStore.update(stop);\n      }\n    }\n  }\n\n  setStopText(event: KeyboardEvent, stop: Stop) {\n    this.unlistenMapSingleClick();\n    const term = (event.target as HTMLInputElement).value;\n    if (term.length === 0) {\n      this.clearStop(stop);\n    } else if (this.validateTerm(term)) {\n      stop.text = term;\n      this.stopsStore.update(stop);\n    }\n  }\n\n  validateTerm(term: string) {\n    if (\n      this.keyIsValid(term) &&\n      (term.length >= this.length || term.length === 0)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  private keyIsValid(key: string) {\n    return this.invalidKeys.find(value => value === key) === undefined;\n  }\n\n  getNgClass(stop: Stop): string {\n    if (!this.stopWithHover) {\n      return 'igo-input-container';\n    } else if (stop.id === this.stopWithHover.id) {\n      return 'igo-input-container reduce';\n    } else {\n      return 'igo-input-container';\n    }\n  }\n\n  getPlaceholder(stop: Stop): string {\n    let extra = '';\n    if (stop.relativePosition) {\n      if (stop.relativePosition === DirectionRelativePositionType.Intermediate) {\n        extra = ' #' + stop.position;\n      }\n      return this.languageService.translate.instant('igo.geo.directionsForm.' + stop.relativePosition) + extra;\n    } else {\n      return '';\n    }\n  }\n\n  removeStop(stop: Stop) {\n    removeStopFromStore(this.stopsStore, stop);\n  }\n\n  clearStop(stop: Stop) {\n    this.stopsStore.update({ id: stop.id, relativePosition: stop.relativePosition, position: stop.position });\n  }\n\n  drop(event: CdkDragDrop<string[]>) {\n    this.moveStops(event.previousIndex, event.currentIndex);\n  }\n\n  private moveStops(fromIndex, toIndex) {\n    if (fromIndex !== toIndex) {\n      const stops = [...this.stopsStore.view.all()];\n      moveItemInArray(stops, fromIndex, toIndex);\n      stops.map((stop, i) => {\n        stop.relativePosition = computeRelativePosition(i, stops.length);\n        stop.position = i;\n      });\n      this.stopsStore.updateMany(stops);\n      updateStoreSorting(this.stopsStore);\n    }\n  }\n\n  onInputFocus(stop: Stop) {\n    if (!stop.text || stop.text?.length === 0) {\n      this.unlistenMapSingleClick();\n      this.stopInputHasFocus.emit(true);\n      this.listenMapSingleClick(stop);\n    }\n  }\n\n  private listenMapSingleClick(stop: Stop) {\n    const key = this.stopsFeatureStore.layer.map.ol.once('singleclick', event => {\n      const clickCoordinates = olProj.transform(\n        event.coordinate,\n        this.stopsFeatureStore.layer.map.projection,\n        this.projection\n      );\n      const roundedCoord = roundCoordTo(clickCoordinates as [number, number], this.coordRoundedDecimals);\n      stop.text = roundedCoord.join(',');\n      stop.coordinates = roundedCoord;\n      this.stopsStore.update(stop);\n      setTimeout(() => {\n        this.stopInputHasFocus.emit(false);\n      }, 500);\n    });\n    this.onMapClickEventKeys.push(key);\n  }\n\n  private unlistenMapSingleClick() {\n    this.onMapClickEventKeys.map(key => {\n      olObservable.unByKey(key);\n    });\n    this.onMapClickEventKeys = [];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\n\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsSource } from '../directions-sources/directions-source';\nimport { DirectionsSourceService } from './directions-source.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DirectionsService {\n  constructor(private directionsSourceService: DirectionsSourceService) {}\n\n  route(coordinates: [number, number][], directionsOptions: DirectionOptions = {}): Observable<Direction[]>[] {\n    if (coordinates.length === 0) {\n      return;\n    }\n    return this.directionsSourceService.sources\n      .filter((source: DirectionsSource) => source.enabled)\n      .map((source: DirectionsSource) => this.routeSource(source, coordinates, directionsOptions));\n  }\n\n  routeSource(\n    source: DirectionsSource,\n    coordinates: [number, number][],\n    directionsOptions: DirectionOptions = {}\n  ): Observable<Direction[]> {\n    const request = source.route(coordinates, directionsOptions );\n    return request;\n  }\n}\n","import { FEATURE } from '../../feature/shared/feature.enums';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { SearchSource } from './sources/source';\nimport { SearchResult } from './search.interfaces';\n\n/**\n * Function that checks whether a search source implements TextSearch\n * @param source Search source\n * @returns True if the search source implements TextSearch\n */\nexport function sourceCanSearch(source: SearchSource): boolean {\n  return (source as any).search !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch\n * @param source Search source\n * @returns True if the search source implements ReverseSearch\n */\nexport function sourceCanReverseSearch(source: SearchSource): boolean {\n  return (source as any).reverseSearch !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch AND is shown in the pointer summary\n * @param source Search source\n * @returns True if the search source implements ReverseSearch AND is shown in the pointer summary\n */\nexport function sourceCanReverseSearchAsSummary(source: SearchSource): boolean {\n  return (source as any).reverseSearch !== undefined && source.showInPointerSummary === true;\n}\n\n/**\n * Return a search result out of an Feature. This is used to adapt\n * the IGO query module to the new Feature/SearchResult interfaces\n * @param feature feature\n * @param source Search source\n * @returns SearchResult\n */\nexport function featureToSearchResult(\n  feature: Feature,\n  source: SearchSource\n): SearchResult<Feature> {\n  feature.sourceId = source.getId();\n  return {\n    source,\n    data: feature,\n    meta: {\n      dataType: FEATURE,\n      id: feature.meta.id as string,\n      title: feature.meta.title,\n      icon: feature.meta.icon || 'map-marker'\n    }\n  };\n}\n\nexport function findDiff(str1: string, str2: string){\n  let diff = '';\n  str2.split('').forEach((val, i) => {\n    if (val !== str1.charAt(i)) {\n      diff += val;\n    }\n  });\n  return diff;\n}\n\n\n/**\n * Return a score calculation based on \"from\" term with the \"to\" term,\n * where the perfect match is 100 and a total difference is 0 or under.\n * @param from string\n * @param to string\n * @param caseSensitive boolean\n * @returns number\n */\nexport function computeTermSimilarity(from, to, caseSensitive: boolean = false): number {\n  if (!from || !to) {\n    return 0;\n  }\n  const termFrom = caseSensitive ? from : from.toLowerCase();\n  const termTo = caseSensitive ? to : to.toLowerCase();\n  const fromToDiff = findDiff(termFrom, termTo);\n  const toFromDiff = findDiff(termTo, termFrom);\n  const totalDiff = fromToDiff + toFromDiff;\n\n  let delta = 0;\n  if (totalDiff.length) {\n    delta = totalDiff.length / termFrom.length * 100;\n  }\n\n  return 100 - Math.floor(delta);\n}\n","import { SearchSource } from './sources/source';\nimport { SearchSourceSettings } from './sources/source.interfaces';\n\n/**\n * Service where all available search sources are registered.\n */\nexport class SearchSourceService {\n\n  constructor(private sources: SearchSource[]) {}\n\n  /**\n   * Return available search sources\n   * @returns Search sources\n   */\n  getSources(): SearchSource[] {\n    return this.sources;\n  }\n\n  /**\n   * Return enabled search sources\n   * @returns Search sources\n   */\n  getEnabledSources(): SearchSource[] {\n    return this.getSources().filter(\n      (source: SearchSource) => source.enabled === true\n    );\n  }\n\n  /**\n   * Enable search sources of given type\n   * @param type Search type\n   * @todo It would be better to track the enabled search sources\n   *  without updating their 'enabled' property.\n   */\n  enableSourcesByType(type: string) {\n    this.getSources().forEach((source: SearchSource) => {\n      if ((source.constructor as typeof SearchSource).type === type) {\n        source.enabled = true;\n      } else {\n        source.enabled = false;\n      }\n    });\n  }\n\n  /**\n   * Set Param from the selected settings\n   * @param source search-source\n   * @param setting settings\n   */\n  setParamFromSetting(source: SearchSource, setting: SearchSourceSettings) {\n    source.setParamFromSetting(setting);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { stringToLonLat } from '../../map';\nimport { MapService } from '../../map/shared/map.service';\n\nimport { SearchSource, TextSearch, ReverseSearch } from './sources/source';\nimport {\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './sources/source.interfaces';\nimport { SearchSourceService } from './search-source.service';\nimport { Research } from './search.interfaces';\nimport {\n  sourceCanSearch,\n  sourceCanReverseSearch,\n  sourceCanReverseSearchAsSummary\n} from './search.utils';\n\n/**\n * This service perform researches in all the search sources enabled.\n * It returns Research objects who's 'request' property needs to be\n * subscribed to in order to trigger the research. This services has\n * keeps internal state of the researches it performed\n * and the results they yielded.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class SearchService {\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mapService: MapService\n  ) {}\n\n  /**\n   * Perform a research by text\n   * @param term Any text\n   * @returns Researches\n   */\n  search(term: string, options: TextSearchOptions = {}): Research[] {\n    if (!this.termIsValid(term)) {\n      return [];\n    }\n\n    const proj = this.mapService.getMap()?.projection || 'EPSG:3857';\n    const response = stringToLonLat(term, proj, {\n      forceNA: options.forceNA\n    });\n    if (response.lonLat) {\n      return this.reverseSearch(response.lonLat, { distance: response.radius, conf: response.conf });\n    } else if (response.message) {\n      console.log(response.message);\n    }\n\n    options.extent = this.mapService\n      .getMap()\n      ?.viewController.getExtent('EPSG:4326');\n\n    let sources;\n\n    if (options.getEnabledOnly || options.getEnabledOnly === undefined) {\n      sources = this.searchSourceService.getEnabledSources();\n    } else {\n      sources = this.searchSourceService.getSources();\n    }\n\n    if (options.sourceId) {\n      sources = sources.filter((source) => source.getId() === options.sourceId);\n    } else if (options.searchType) {\n      sources = sources.filter(\n        (source) => source.getType() === options.searchType\n      );\n    }\n\n    sources = sources.filter(sourceCanSearch);\n    return this.searchSources(sources, term, options);\n  }\n\n  /**\n   * Perform a research by lon/lat\n   * @param lonLat Any lon/lat coordinates\n   * @returns Researches\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions,\n    asPointerSummary: boolean = false\n  ) {\n    const reverseSourceFonction = asPointerSummary\n      ? sourceCanReverseSearchAsSummary\n      : sourceCanReverseSearch;\n    const sources = this.searchSourceService\n      .getEnabledSources()\n      .filter(reverseSourceFonction);\n    return this.reverseSearchSources(sources, lonLat, options || {});\n  }\n\n  /**\n   * Create a text research out of all given search sources\n   * @param sources Search sources that implement TextSearch\n   * @param term Search term\n   * @returns Observable of Researches\n   */\n  private searchSources(\n    sources: SearchSource[],\n    term: string,\n    options: TextSearchOptions\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: ((source as any) as TextSearch).search(term, options),\n        reverse: false,\n        source\n      };\n    });\n  }\n\n  /**\n   * Create a reverse research out of all given search sources\n   * @param sources Search sources that implement ReverseSearch\n   * @param lonLat Any lon/lat coordinates\n   * @returns Observable of Researches\n   */\n  private reverseSearchSources(\n    sources: SearchSource[],\n    lonLat: [number, number],\n    options: ReverseSearchOptions\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: ((source as any) as ReverseSearch).reverseSearch(\n          lonLat,\n          options\n        ),\n        reverse: true,\n        source\n      };\n    });\n  }\n\n  /**\n   * Validate that a search term is valid\n   * @param term Search term\n   * @returns True if the search term is valid\n   */\n  private termIsValid(term: string): boolean {\n    return typeof term === 'string' && term !== '';\n  }\n}\n","<div class=\"igo-form-button-group\">\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.directionsForm.addStop' | translate\" color=\"primary\" (click)=\"addStop()\">\n    <mat-icon svgIcon=\"map-marker-plus\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1 || (stopsStore.count$ | async)>=1\"\n    [matTooltip]=\"'igo.geo.directionsForm.resetDirectionsBtn' | translate\" color=\"warn\" (click)=\"resetStops()\">\n    <mat-icon svgIcon=\"file-restore\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"zoomRoute()\"\n    [matTooltip]=\"'igo.geo.directionsForm.zoomRoute' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"magnify-plus-outline\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"copyDirectionsToClipboard()\"\n    [matTooltip]=\"'igo.geo.directionsForm.copy' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"content-copy\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"copyLinkToClipboard()\" \n    [matTooltip]=\"'igo.geo.directionsForm.link' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"link\"></mat-icon>\n  </button>\n</div>","import { Component, Input, Optional } from '@angular/core';\nimport { LanguageService, MessageService, RouteService } from '@igo2/core';\nimport { Clipboard } from '@igo2/utils';\nimport { Subject } from 'rxjs';\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { FeatureWithDirection } from '../shared/directions.interface';\n\nimport { addStopToStore, formatDistance, formatDuration, formatInstruction } from '../shared/directions.utils';\nimport { RoutesFeatureStore, StopsStore } from '../shared/store';\n\n@Component({\n  selector: 'igo-directions-buttons',\n  templateUrl: './directions-buttons.component.html',\n  styleUrls: ['./directions-buttons.component.scss']\n})\nexport class DirectionsButtonsComponent {\n\n  get activeRoute() {\n    return this.routesFeatureStore.all().find(route => route.properties.active);\n  }\n  @Input() contextUri: string;\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n  @Input() stopsStore: StopsStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  constructor(\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    @Optional() private route: RouteService) { }\n\n  resetStops() {\n    this.stopsStore.clearStops();\n  }\n\n  // stop are always added before the last stop.\n  addStop(): void {\n    addStopToStore(this.stopsStore);\n  }\n\n\n  copyLinkToClipboard() {\n    const successful = Clipboard.copy(this.getUrl());\n    if (successful) {\n      const translate = this.languageService.translate;\n      const title = translate.instant(\n        'igo.geo.directionsForm.dialog.copyTitle'\n      );\n      const msg = translate.instant(\n        'igo.geo.directionsForm.dialog.copyMsgLink'\n      );\n      this.messageService.success(msg, title);\n    }\n  }\n\n  zoomRoute() {\n    this.zoomToActiveRoute$.next();\n  }\n\n  copyDirectionsToClipboard() {\n    const directionsBody = this.directionsToText();\n    const successful = Clipboard.copy(directionsBody);\n    if (successful) {\n      const translate = this.languageService.translate;\n      const title = translate.instant(\n        'igo.geo.directionsForm.dialog.copyTitle'\n      );\n      const msg = translate.instant('igo.geo.directionsForm.dialog.copyMsg');\n      this.messageService.success(msg, title);\n    }\n  }\n\n  private directionsToText() {\n    const indent = '\\t';\n    let activeRouteDirective =\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.instructions'\n      ) + ':\\n';\n    let wayPointList = '';\n    const summary =\n      this.languageService.translate.instant('igo.geo.directionsForm.summary') +\n      ': \\n' +\n      indent +\n      this.activeRoute.properties.direction.title +\n      '\\n' +\n      indent +\n      formatDistance(this.activeRoute.properties.direction.distance) +\n      '\\n' +\n      indent +\n      formatDuration(this.activeRoute.properties.direction.duration) +\n      '\\n\\n' +\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.stopsList'\n      ) +\n      ':\\n';\n\n    const url =\n      this.languageService.translate.instant('igo.geo.directionsForm.link') +\n      ':\\n' +\n      indent +\n      this.getUrl();\n\n    let wayPointsCnt = 1;\n    this.stopsStore.view.all().forEach(stop => {\n      let coord = '';\n      let stopText = '';\n      if (stop.text !== roundCoordTo(stop.coordinates).join(',')) {\n        stopText = stop.text;\n        coord = ` ( ${roundCoordTo(stop.coordinates).join(',')} )`;\n      } else {\n        stopText = roundCoordTo(stop.coordinates).join(\n          ','\n        );\n      }\n\n      wayPointList =\n        wayPointList +\n        indent +\n        wayPointsCnt.toLocaleString() +\n        '. ' +\n        stopText +\n        coord +\n        '\\n';\n      wayPointsCnt++;\n    });\n\n    let localCnt = 0;\n    this.activeRoute.properties.direction.steps.forEach(step => {\n      const instruction = this.formatStep(step, localCnt).instruction;\n      const distance =\n        formatDistance(step.distance) === undefined\n          ? ''\n          : ' (' + formatDistance(step.distance) + ')';\n      activeRouteDirective =\n        activeRouteDirective +\n        indent +\n        (localCnt + 1).toLocaleString() +\n        '. ' +\n        instruction +\n        distance +\n        '\\n';\n      localCnt++;\n    });\n\n    const directionsBody =\n      summary + wayPointList + '\\n' + url + '\\n\\n' + activeRouteDirective;\n\n    return directionsBody;\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeRoute.properties.direction.steps.length - 1\n    );\n  }\n\n  private getUrl() {\n    if (!this.route) {\n      return;\n    }\n    let context = '';\n    if (this.contextUri) {\n      context = `context=${this.contextUri}&`;\n    }\n\n    const pos = this.routesFeatureStore.all()\n    .map((direction: FeatureWithDirection) => direction.properties.id).indexOf(this.activeRoute.properties.id);\n    let routingOptions = '';\n    if (pos !== 0) {\n      const routingOptionsKey = this.route.options.directionsOptionsKey;\n      routingOptions = `&${routingOptionsKey}=result:${pos}`;\n    }\n    const directionsKey = this.route.options.directionsCoordKey;\n    const stopsCoordinates = this.stopsStore.view.all().map(stop => roundCoordTo(stop.coordinates, 6));\n    let directionsUrl = '';\n    if (stopsCoordinates.length >= 2) {\n      directionsUrl = `${directionsKey}=${stopsCoordinates.join(';')}`;\n      return `${location.origin}${location.pathname}?${context}tool=directions&sidenav=1&${directionsUrl}${routingOptions}`;\n    }\n    return;\n  }\n}\n","<div class=\"igo-input-container\" *ngIf=\"directions && activeDirection\">\n    <mat-form-field *ngIf=\"directions && directions.length > 1\">\n        <mat-select placeholder=\"{{'igo.geo.directionsForm.drivingOptions' | translate}}\"\n            (selectionChange)=\"changeRoute()\" [(ngModel)]=\"activeDirection\">\n            <mat-option *ngFor=\"let direction of directions; let cnt = index;\" [value]=\"direction\">\n                Option {{cnt + 1}} : {{formatDistance(direction.distance)}}\n                ({{formatDuration(direction.duration)}})\n            </mat-option>\n        </mat-select>\n    </mat-form-field>\n\n    <mat-divider *ngIf=\"directions && directions.length === 0\"></mat-divider>\n\n    <mat-list (mouseleave)=\"onStepsListBlur()\">\n        <h2 mat-header class=\"igo-route-title mat-typography\">{{activeDirection.title}}</h2>\n        <h2 mat-subheader>{{formatDistance(activeDirection.distance)}}, {{formatDuration(activeDirection.duration)}}</h2>\n        <mat-list-item class=\"igo-steps\" \n            (mouseenter)=\"showSegment(step)\" \n            (click)=\"showSegment(step,true)\" \n            *ngFor=\"let step of activeDirection.steps; let cnt = index;\" igoListItem>\n            <mat-icon [ngClass]=\"formatStep(step,cnt).cssClass\" mat-list-icon svgIcon=\"{{formatStep(step,cnt).image}}\">\n            </mat-icon>\n\n            <h4 mat-line>{{cnt +1}}. {{formatStep(step,cnt).instruction}}</h4>\n            <h4 mat-line class=\"right\">{{formatDistance(step.distance)}}</h4>\n        </mat-list-item>\n\n        <mat-divider></mat-divider>\n\n    </mat-list>\n\n</div>","import { ChangeDetectorRef, Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport { LanguageService } from '@igo2/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { Direction, FeatureWithStep, IgoStep } from '../shared/directions.interface';\nimport { formatDistance, formatDuration, formatInstruction } from '../shared/directions.utils';\nimport { RoutesFeatureStore, StepFeatureStore } from '../shared/store';\n\nimport olFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olGeom from 'ol/geom';\n\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { DirectionType } from '../shared/directions.enum';\n\n@Component({\n  selector: 'igo-directions-results',\n  templateUrl: './directions-results.component.html',\n  styleUrls: ['./directions-results.component.scss']\n})\nexport class DirectionsResultsComponent implements OnInit, OnDestroy {\n\n  public activeDirection: Direction;\n  public directions: Direction[];\n\n  private entities$$: Subscription;\n\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n\n  constructor(\n    private languageService: LanguageService,\n    private cdRef: ChangeDetectorRef\n  ) { }\n\n  ngOnInit(): void {\n    this.entities$$ = this.routesFeatureStore.entities$\n      .pipe(debounceTime(200))\n      .subscribe(entities => {\n        const activeFeatureWithDirection = entities.find(entity => entity.properties.active);\n        this.directions = entities.map(entity => entity.properties.direction);\n        if (activeFeatureWithDirection) {\n          this.activeDirection = activeFeatureWithDirection.properties.direction;\n        } else {\n          this.activeDirection = undefined;\n        }\n        this.cdRef.detectChanges();\n      });\n  }\n\n  ngOnDestroy(): void {\n    this.entities$$.unsubscribe();\n  }\n\n  changeRoute() {\n    this.routesFeatureStore.entities$.value.map(entity =>\n      entity.properties.active = !entity.properties.active\n    );\n    this.routesFeatureStore.layer.ol.getSource().getFeatures().map(feature =>\n      feature.set('active', !feature.get('active'))\n    );\n  }\n\n  formatDistance(distance: number): string {\n    return formatDistance(distance);\n  }\n\n  formatDuration(duration: number): string {\n    return formatDuration(duration);\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeDirection.steps.length - 1\n    );\n  }\n\n  onStepsListBlur() {\n    this.stepFeatureStore.clear();\n  }\n\n  showSegment(step: IgoStep, zoomToExtent = false) {\n    this.showRouteSegmentGeometry(step, zoomToExtent);\n  }\n\n  showRouteSegmentGeometry(step: IgoStep, zoomToExtent = false) {\n\n    const coordinates = step.geometry.coordinates;\n    const vertexId = 'vertex';\n    const geometry4326 = new olGeom.LineString(coordinates);\n    const geometryMapProjection = geometry4326.transform(\n      'EPSG:4326',\n      this.stepFeatureStore.layer.map.projection\n    );\n    const routeSegmentCoordinates = (geometryMapProjection as any).getCoordinates();\n    const lastPoint = routeSegmentCoordinates[0];\n\n    const geometry = new olGeom.Point(lastPoint);\n    const feature = new olFeature({ geometry });\n\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.stepFeatureStore.layer.map.projection,\n      dataProjection: this.stepFeatureStore.layer.map.projection\n    }) as FeatureGeometry;\n\n    const previousVertex = this.stepFeatureStore.get(vertexId);\n    const previousVertexRevision = previousVertex\n      ? previousVertex.meta.revision\n      : 0;\n\n    const stepFeature: FeatureWithStep = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.stepFeatureStore.layer.map.projection,\n      properties: {\n        id: vertexId,\n        step,\n        type: DirectionType.Vertex\n      },\n      meta: {\n        id: vertexId,\n        revision: previousVertexRevision + 1\n      },\n      ol: feature\n    };\n    this.stepFeatureStore.update(stepFeature);\n    if (zoomToExtent) {\n      this.stepFeatureStore.layer.map.viewController.zoomToExtent(feature.getGeometry().getExtent() as [number, number, number, number]);\n    }\n  }\n\n}\n","import { ChangeDetectorRef, Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { debounceTime, distinctUntilChanged, map } from 'rxjs/operators';\n\nimport { LanguageService } from '@igo2/core';\nimport { EntityStoreWatcher } from '@igo2/common';\n\nimport * as olCondition from 'ol/events/condition';\nimport * as olInteraction from 'ol/interaction';\nimport * as olProj from 'ol/proj';\nimport { TranslateEvent } from 'ol/interaction/Translate';\nimport Collection from 'ol/Collection';\nimport { SelectEvent } from 'ol/interaction/Select';\n\nimport { DirectionOptions, FeatureWithStopProperties, Stop } from './shared/directions.interface';\nimport { Subject, Subscription } from 'rxjs';\nimport { addDirectionToRoutesFeatureStore, addStopToStopsFeatureStore, addStopToStore,\n  initRoutesFeatureStore, initStepFeatureStore, initStopsFeatureStore, updateStoreSorting } from './shared/directions.utils';\nimport { Feature } from '../feature/shared/feature.interfaces';\nimport { DirectionsService } from './shared/directions.service';\nimport { DirectionType, ProposalType } from './shared/directions.enum';\nimport { roundCoordTo, stringToLonLat } from '../map';\nimport { SearchService } from '../search/shared/search.service';\nimport { ChangeUtils, ObjectUtils } from '@igo2/utils';\nimport { RoutesFeatureStore, StepFeatureStore, StopsFeatureStore, StopsStore } from './shared/store';\nimport { FeatureStoreLoadingStrategy } from '../feature/shared/strategies/loading';\nimport { Research, SearchResult } from '../search/shared/search.interfaces';\nimport { QueryService } from '../query/shared/query.service';\n\n@Component({\n  selector: 'igo-directions',\n  templateUrl: './directions.component.html',\n  styleUrls: ['./directions.component.scss']\n})\nexport class DirectionsComponent implements OnInit, OnDestroy {\n\n  private watcher: EntityStoreWatcher<Stop>;\n\n  public projection: string = 'EPSG:4326';\n\n  private zoomRoute$$: Subscription;\n  private storeEmpty$$: Subscription;\n  private storeChange$$: Subscription;\n  private routesQueries$$: Subscription[] = [];\n\n  private selectStopInteraction: olInteraction.Select;\n  private translateStop: olInteraction.Translate;\n  private selectedRoute;\n  private focusOnStop: boolean = false;\n  private isTranslating: boolean = false;\n\n  public previousStops: Stop[] = [];\n\n  private searchs$$: Subscription[] = [];\n\n  @Input() contextUri: string;\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n  @Input() coordRoundedDecimals: number = 6;\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private languageService: LanguageService,\n    private directionsService: DirectionsService,\n    private searchService: SearchService,\n    private queryService: QueryService\n  ) { }\n\n\n  ngOnInit(): void {\n    this.queryService.queryEnabled = false;\n    this.initEntityStores();\n    setTimeout(() => {\n      initStopsFeatureStore(this.stopsFeatureStore, this.languageService);\n      initRoutesFeatureStore(this.routesFeatureStore, this.languageService);\n      initStepFeatureStore(this.stepFeatureStore);\n      this.initOlInteraction();\n    }, 1);\n\n  }\n\n  ngOnDestroy(): void {\n    this.queryService.queryEnabled = true;\n    this.storeEmpty$$.unsubscribe();\n    this.storeChange$$.unsubscribe();\n    this.routesQueries$$.map((u) => u.unsubscribe());\n    this.zoomRoute$$.unsubscribe();\n    this.freezeStores();\n  }\n\n  private freezeStores() {\n    this.stopsFeatureStore.layer.map.ol.removeInteraction(this.selectStopInteraction);\n    this.stopsFeatureStore.layer.map.ol.removeInteraction(this.translateStop);\n    this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute);\n    this.stopsFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    this.routesFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    this.stepFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n  }\n\n  private initEntityStores() {\n    this.watcher = new EntityStoreWatcher(this.stopsStore, this.cdRef);\n    this.monitorEmptyEntityStore();\n    this.monitorEntityStoreChange();\n    this.monitorActiveRouteZoom();\n  }\n\n  private monitorActiveRouteZoom() {\n    this.zoomRoute$$ = this.zoomToActiveRoute$.subscribe(() => {\n      if (this.routesFeatureStore.count >= 1) {\n        const activeRoute = this.routesFeatureStore.all().find(route => route.properties.active);\n\n        if (activeRoute) {\n          activeRoute.ol.getGeometry();\n          const routeExtent = activeRoute.ol.getGeometry().getExtent();\n          this.routesFeatureStore.layer.map.viewController.zoomToExtent(routeExtent as [number, number, number, number]);\n        }\n      }\n    });\n  }\n\n  private initOlInteraction() {\n    this.selectStopInteraction = new olInteraction.Select({\n      layers: [this.stopsFeatureStore.layer.ol],\n      hitTolerance: 7,\n      condition: (event) => {\n        return event.type === 'pointermove' && !event.dragging;\n      }\n    });\n\n    this.translateStop = new olInteraction.Translate({\n      features: this.selectStopInteraction.getFeatures()\n    });\n    this.translateStop.on('translating', (evt: TranslateEvent) => {\n      this.isTranslating = true;\n      this.executeStopTranslation(evt.features);\n    });\n    this.translateStop.on('translateend', (evt: TranslateEvent) => {\n      this.isTranslating = false;\n      this.executeStopTranslation(evt.features);\n    });\n\n    this.selectedRoute = new olInteraction.Select({\n      layers: [this.routesFeatureStore.layer.ol],\n      condition: olCondition.click,\n      hitTolerance: 7,\n      filter: feature => {\n        return feature.get('type') === DirectionType.Route &&\n          feature.get('active') &&\n          !this.isTranslating;\n      }\n    });\n    this.selectedRoute.on('select', (evt: SelectEvent) => {\n      if (this.focusOnStop === false) {\n        const selectCoordinates = roundCoordTo(\n          olProj.transform(\n            (evt as any).mapBrowserEvent.coordinate,\n            this.routesFeatureStore.layer.map.projection,\n            this.projection\n          ) as [number, number], this.coordRoundedDecimals);\n        const addedStop = addStopToStore(this.stopsStore);\n        addedStop.text = selectCoordinates.join(',');\n        addedStop.coordinates = [selectCoordinates[0], selectCoordinates[1]];\n      }\n    });\n\n    this.stopsFeatureStore.layer.map.ol.addInteraction(this.selectStopInteraction);\n    this.stopsFeatureStore.layer.map.ol.addInteraction(this.translateStop);\n    this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\n  }\n\n  onStopInputHasFocusChange(stopInputHasFocus: boolean) {\n    stopInputHasFocus ?\n      this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute) :\n      this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\n  }\n\n  private executeStopTranslation(\n    features: Collection<any>\n  ) {\n    if (features.getLength() === 0) {\n      return;\n    }\n    const firstFeature = features.getArray()[0];\n    const translatedStopId = firstFeature.getId();\n\n    const translationCoordinates = olProj.transform(\n      firstFeature.getGeometry().getCoordinates(),\n      this.stopsFeatureStore.layer.map.projection,\n      this.projection\n    );\n    const translatedStop = this.stopsStore.get(translatedStopId);\n    const roundedCoord = roundCoordTo(translationCoordinates as [number, number], this.coordRoundedDecimals);\n    translatedStop.coordinates = roundedCoord;\n    translatedStop.text = roundedCoord.join(',');\n    this.stopsStore.update(translatedStop);\n  }\n\n\n  private monitorEmptyEntityStore() {\n    // Watch if the store is empty to reset it\n    this.storeEmpty$$ = this.stopsStore.count$\n      .pipe(\n        distinctUntilChanged()\n      ).subscribe((count) => {\n        if (count < 2) {\n          addStopToStore(this.stopsStore);\n          if (this.stopsStore.count === 2) {\n            this.stopsStore.storeInitialized$.next(true);\n            return;\n          }\n          this.stopsStore.storeInitialized$.next(false);\n        }\n        this.routesQueries$$.map((u) => u.unsubscribe());\n      });\n  }\n\n  private monitorEntityStoreChange() {\n    this.storeChange$$ = this.stopsStore.entities$\n      .pipe(debounceTime(this.debounce))\n      .subscribe((stops: Stop[]) => {\n        this.handleStopDiff(stops);\n        updateStoreSorting(this.stopsStore);\n        this.handleStopsFeature();\n        this.getRoutes(this.isTranslating);\n      });\n  }\n\n  cancelSearch() {\n    this.searchs$$.map(s => s.unsubscribe());\n  }\n\n  private handleStopDiff(stops: Stop[]) {\n    const simplifiedStops = stops.map((stop: Stop) => {\n      return ObjectUtils.removeUndefined({ ...{ id: stop.id, text: stop.text, coordinates: stop.coordinates } });\n    });\n    const diff = ChangeUtils.findChanges(this.previousStops, simplifiedStops, ['coordinates']);\n    const stopIdToProcess = diff.added.concat(diff.modified);\n    if (stopIdToProcess) {\n      stopIdToProcess.map((change) => {\n        const changedStop = (change.newValue as Stop);\n        if (changedStop) {\n          const stop: Stop = this.stopsStore.get(changedStop.id);\n          const term = stop.text;\n          if (!term || term.length === 0) {\n            return;\n          }\n          const response = stringToLonLat(term, this.stopsFeatureStore.layer.map.projection);\n          let researches: Research[];\n          let isCoord = false;\n          if (response.lonLat) {\n            isCoord = true;\n          }\n          researches = this.searchService.search(term, { searchType: 'Feature' });\n          this.cancelSearch();\n          const requests$ = researches.map(res => res.request\n            .pipe(map((results: SearchResult[]) => results.filter(r =>\n              isCoord ? r.data.geometry.type === 'Point' && r.data.geometry : r.data.geometry)))\n\n          );\n          this.searchs$$ = requests$.map((request) => {\n            return request.pipe(map((results: SearchResult[]) => results.filter(r =>\n              isCoord ? r.data.geometry.type === 'Point' && r.data.geometry : r.data.geometry)))\n              .subscribe((res: SearchResult[]) => {\n                if (res.length > 0) {\n                  const source = res[0].source;\n                  const meta = res[0].meta;\n                  const results = res.map(r => r.data);\n                  if (!stop.searchProposals) {\n                    stop.searchProposals = [];\n                  }\n                  stop.searchProposals = stop.searchProposals.filter(sp => sp.type === (isCoord ? ProposalType.Coord : ProposalType.Text));\n                  let storedSource = stop.searchProposals.find(sp => sp.source === source);\n                  if (storedSource) {\n                    storedSource.results = results;\n                  } else {\n                    stop.searchProposals.push({\n                      type: isCoord ? ProposalType.Coord : ProposalType.Text,\n                      source,\n                      meta,\n                      results\n                    });\n                  }\n                }\n                this.cdRef.detectChanges();\n              });\n          });\n        }\n      });\n    }\n    this.previousStops = simplifiedStops;\n  }\n\n  private handleStopsFeature() {\n    const stops = this.stopsStore.all();\n    const stopsWithCoordinates = stops.filter(stop => stop.coordinates);\n    stopsWithCoordinates.map(stop => this.addStopOverlay(stop));\n    this.stopsFeatureStore.all().map(\n      (stopFeature: Feature<FeatureWithStopProperties>) => {\n        if (!this.stopsStore.get(stopFeature.properties.id)) {\n          this.stopsFeatureStore.delete(stopFeature);\n        }\n      });\n    const stopsWithoutCoordinates = stops.filter(stop => !stop.coordinates);\n    stopsWithoutCoordinates.map(stop => {\n      const stopFeature = this.stopsFeatureStore.get(stop.id);\n      if (stopFeature) {\n        this.stopsFeatureStore.delete(stopFeature);\n      }\n    });\n  }\n\n  private getRoutes(isOverview: boolean = false) {\n    const stopsWithCoordinates = this.stopsStore.view\n      .all()\n      .filter(stop => stop.coordinates);\n    if (stopsWithCoordinates.length < 2) {\n      this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n      return;\n    }\n\n    const roundedCoordinates = stopsWithCoordinates.map((stop) => {\n      const roundedCoord = roundCoordTo(stop.coordinates, this.coordRoundedDecimals);\n      return roundedCoord;\n    });\n    const overviewDirectionsOptions: DirectionOptions = {\n      overview: true,\n      steps: false,\n      alternatives: false,\n      continue_straight: false\n    };\n    this.routesQueries$$.map((u) => u.unsubscribe());\n    const routeResponse = this.directionsService.route(\n      roundedCoordinates,\n      isOverview ? overviewDirectionsOptions : undefined\n    );\n    if (routeResponse) {\n      routeResponse.map(res =>\n        this.routesQueries$$.push(\n          res.subscribe(directions => {\n            this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n            directions.map(direction =>\n              addDirectionToRoutesFeatureStore(\n                this.routesFeatureStore,\n                direction,\n                this.projection,\n                direction === directions[0] ? true : false)\n            );\n          })\n        )\n      );\n    }\n  }\n\n  public addStopOverlay(stop: Stop) {\n    addStopToStopsFeatureStore(stop, this.stopsStore, this.stopsFeatureStore, this.projection, this.languageService);\n  }\n}\n","<igo-directions-buttons [contextUri]=\"contextUri\" [zoomToActiveRoute$]=\"zoomToActiveRoute$\" [routesFeatureStore]=\"routesFeatureStore\" [stopsStore]=\"stopsStore\"></igo-directions-buttons>\n\n<igo-directions-inputs (stopInputHasFocus)=\"onStopInputHasFocusChange($event)\" [coordRoundedDecimals]=\"coordRoundedDecimals\" [projection]=\"projection\" [stopsFeatureStore]=\"stopsFeatureStore\" [stopsStore]=\"stopsStore\" [debounce]=\"debounce\" [length]=\"length\"></igo-directions-inputs>\n<br>\n<igo-directions-results [stepFeatureStore]=\"stepFeatureStore\" [routesFeatureStore]=\"routesFeatureStore\"></igo-directions-results>","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { provideDirectionsSourceService } from './shared/directions-source.service';\nimport { DragDropModule } from '@angular/cdk/drag-drop';\nimport { DirectionsInputsComponent } from './directions-inputs/directions-inputs.component';\nimport { DirectionsComponent } from './directions.component';\nimport { DirectionsButtonsComponent } from './directions-buttons/directions-buttons.component';\nimport { DirectionsResultsComponent } from './directions-results/directions-results.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    DragDropModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatListModule,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatOptionModule,\n    MatSelectModule,\n    MatTooltipModule,\n    MatAutocompleteModule,\n    IgoLanguageModule\n  ],\n  exports: [\n    DirectionsComponent,\n    DirectionsInputsComponent,\n    DirectionsButtonsComponent,\n    DirectionsResultsComponent\n  ],\n  declarations: [\n     DirectionsComponent,\n    DirectionsInputsComponent,\n    DirectionsButtonsComponent,\n    DirectionsResultsComponent\n  ],\n  providers: [provideDirectionsSourceService()]\n})\nexport class IgoDirectionsModule {\n  static forRoot(): ModuleWithProviders<IgoDirectionsModule> {\n    return {\n      ngModule: IgoDirectionsModule\n    };\n  }\n}\n","import { SearchSource } from './sources/source';\nimport { SearchSourceService } from './search-source.service';\n\n/**\n * Search source factory\n * @ignore\n */\nexport function searchSourceServiceFactory(sources: SearchSource[]) {\n  return new SearchSourceService(sources);\n}\n\n/**\n * Function that returns a provider for the SearchSource service\n */\nexport function provideSearchSourceService() {\n  return {\n    provide: SearchSourceService,\n    useFactory: searchSourceServiceFactory,\n    deps: [SearchSource]\n  };\n}\n","import { Injectable, Inject, Injector } from '@angular/core';\nimport { HttpClient, HttpParams, HttpParameterCodec } from '@angular/common/http';\n\nimport { Observable, of, BehaviorSubject } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { AuthService } from '@igo2/auth';\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport pointOnFeature from '@turf/point-on-feature';\n\nimport { FEATURE, Feature } from '../../../feature';\nimport { GoogleLinks } from './../../../utils/googleLinks';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch, ReverseSearch } from './source';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './source.interfaces';\nimport {\n  IChercheData,\n  IChercheResponse,\n  IChercheReverseData,\n  IChercheReverseResponse\n} from './icherche.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class IChercheSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n\n// Fix the \"+\" is replaced with space \" \" in a query string\n// https://github.com/angular/angular/issues/11058\nexport class IgoHttpParameterCodec implements HttpParameterCodec {\n  encodeKey(key: string): string {\n    return encodeURIComponent(key);\n  }\n\n  encodeValue(value: string): string {\n    return encodeURIComponent(value);\n  }\n\n  decodeKey(key: string): string {\n    return decodeURIComponent(key);\n  }\n\n  decodeValue(value: string): string {\n    return decodeURIComponent(value);\n  }\n}\n\n/**\n * ICherche search source\n */\n@Injectable()\nexport class IChercheSearchSource extends SearchSource implements TextSearch {\n  static id = 'icherche';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  private hashtagsLieuxToKeep = [];\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    @Inject(IChercheSearchResultFormatter)\n    private formatter: IChercheSearchResultFormatter,\n    injector: Injector\n  ) {\n    super(options, storageService);\n\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe((title) => this.title$.next(title));\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n  }\n\n  getId(): string {\n    return IChercheSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n\n    const types = this.options.params?.type\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n        : [\n            'adresses',\n            'codes-postaux',\n            'routes',\n            'intersections',\n            'municipalites',\n            'mrc',\n            'regadmin',\n            'lieux'\n          ];\n\n    return {\n      title: 'igo.geo.search.icherche.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1,\n              hashtags: ['adresse']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldAddress',\n              value: 'anciennes-adresses',\n              enabled: types.indexOf('anciennes-adresses') !== -1,\n              hashtags: ['anciennes-adresses']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.postalCode',\n              value: 'codes-postaux',\n              enabled: types.indexOf('codes-postaux') !== -1,\n              hashtags: ['code-postal']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              hashtags: ['route']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.intersection',\n              value: 'intersections',\n              enabled: types.indexOf('intersections') !== -1,\n              hashtags: ['intersection', '+']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1,\n              hashtags: ['municipalit', 'mun']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldCity',\n              value: 'anciennes-municipalites',\n              enabled: types.indexOf('anciennes-municipalites') !== -1,\n              hashtags: ['anciennes-municipalites']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1,\n              hashtags: ['mrc']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1,\n              hashtags: ['rgion-administrative', 'regadmin']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.entreprise',\n              value: 'entreprises',\n              enabled: types.indexOf('entreprises') !== -1,\n              available: false,\n              hashtags: ['entreprise']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.place',\n              value: 'lieux',\n              enabled: types.indexOf('lieux') !== -1,\n              hashtags: ['lieu']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.exit',\n              value: 'sorties-autoroute',\n              enabled: types.indexOf('sorties-autoroute') !== -1,\n              hashtags: ['sortie', 'sorties', 'exit']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.km',\n              value: 'bornes-km',\n              enabled: types.indexOf('bornes-km') !== -1,\n              hashtags: ['borne', 'bornes', 'repre', 'km']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.gcc',\n              value: 'bornes-gcc',\n              enabled: types.indexOf('bornes-gcc') !== -1,\n              hashtags: ['borne', 'bornes', 'repre', 'gcc', 'ccg']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cn',\n              value: 'bornes-cn',\n              enabled: types.indexOf('bornes-cn') !== -1,\n              hashtags: ['borne', 'bornes', 'cn']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.sumi',\n              value: 'bornes-sumi',\n              enabled: types.indexOf('bornes-sumi') !== -1,\n              hashtags: ['borne', 'bornes', 'sumi']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.hq',\n              value: 'hq',\n              enabled: types.indexOf('hq') !== -1,\n              hashtags: ['hq']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cadastre',\n              value: 'cadastre',\n              enabled: types.indexOf('cadastre') !== -1,\n              hashtags: ['cadastre']\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'ecmax',\n          name: 'ecmax',\n          values: [\n            {\n              title: '10 %',\n              value: 10,\n              enabled: ecmax === 10\n            },\n            {\n              title: '30 %',\n              value: 30,\n              enabled: ecmax === 30 || !ecmax\n            },\n            {\n              title: '50 %',\n              value: 50,\n              enabled: ecmax === 50\n            },\n            {\n              title: '75 %',\n              value: 75,\n              enabled: ecmax === 75\n            },\n            {\n              title: '100 %',\n              value: 100,\n              enabled: ecmax === 100\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'loc',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.map',\n              value: 'true',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.quebec',\n              value: 'false',\n              enabled: true\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(term, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n\n    return this.http.get(`${this.searchUrl}/geocode`, { params }).pipe(\n      map((response: IChercheResponse) => this.extractResults(response, term)),\n      catchError((err) => {\n        err.error.toDisplay = true;\n        err.error.title = this.languageService.translate.instant(\n          this.getDefaultOptions().title\n        );\n        throw err;\n      })\n    );\n  }\n\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          const regex = new RegExp(`^${v.value}(\\\\.|$)`);\n          const typesMatched = types.filter((value) => regex.test(value));\n          v.available = typesMatched.length > 0;\n          if (v.value === 'lieux') {\n            this.hashtagsLieuxToKeep = [\n              ...(new Set(\n                typesMatched\n                  .map((t) => t.split('.'))\n                  .reduce((a, b) => a.concat(b))\n                  .filter((t) => t !== 'lieux')\n              ) as any)\n            ];\n          }\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    const queryParams: any = Object.assign(\n      {\n        geometry: true,\n        bbox: true,\n        icon: true,\n        type:\n          'adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi'\n      },\n      this.params,\n      this.computeOptionsParam(term, options || {}).params,\n      {\n        q: this.computeTerm(term),\n        page: options.page\n      }\n    );\n\n    if (queryParams.loc === 'true') {\n      const [xMin, yMin, xMax, yMax] = options.extent;\n      queryParams.loc = `${xMin},${yMin};${xMax},${yMin};${xMax},${yMax};${xMin},${yMax};${xMin},${yMin}`;\n    } else if (queryParams.loc === 'false') {\n      delete queryParams.loc;\n    }\n\n    if (/#[A-Za-z]+/.test(queryParams.q)) {\n      queryParams.type = 'lieux';\n    }\n\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(queryParams),\n      encoder: new IgoHttpParameterCodec()\n    });\n  }\n\n  private extractResults(response: IChercheResponse, term: string): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheData) => {\n      return this.formatter.formatResult(this.dataToResult(data, term, response));\n    });\n  }\n\n  private dataToResult(\n    data: IChercheData,\n    term: string,\n    response?: IChercheResponse\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.highlight.title || data.properties.nom;\n    const subtitleHtml = data.highlight.title2\n      ? ' <small> ' + data.highlight.title2 + '</small>'\n      : '';\n    const subtitleHtml2 = data.highlight.title3\n      ? '<br><small> ' + data.highlight.title3 + '</small>'\n      : '';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml + subtitleHtml2,\n        icon: data.icon || 'map-marker',\n        score: data.score || computeTermSimilarity(term.trim(), data.properties.nom),\n        nextPage:\n          response.features.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheSearchSource.propertiesBlacklist\n    );\n\n    if (!data.geometry) {\n      return Object.assign({ type: data.index }, properties);\n    }\n\n    const googleLinksProperties: {\n      GoogleMaps: string;\n      GoogleStreetView?: string;\n    } = {\n      GoogleMaps: ''\n    };\n\n    let googleMaps;\n    if (data.geometry.type === 'Point') {\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        data.geometry.coordinates[0],\n        data.geometry.coordinates[1]\n      );\n    } else {\n      const point = pointOnFeature(data.geometry);\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        point.geometry.coordinates[0],\n        point.geometry.coordinates[1]\n      );\n    }\n\n    let googleMapsNom;\n    if (data.index === 'routes') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + data.properties.municipalite\n      );\n    } else if (data.index === 'municipalites') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + 'ville'\n      );\n    } else if (data.index === 'mrc') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        'mrc+' + data.properties.nom\n      );\n    } else if (data.index === 'regadmin') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ',+QC'\n      );\n    } else {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom || data.highlight.title\n      );\n    }\n\n    googleLinksProperties.GoogleMaps =\n      '<a href=' +\n      googleMaps +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\n      '</a> <br /> <a href=' +\n      googleMapsNom +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByName') +\n      '</a>';\n\n    if (data.geometry.type === 'Point') {\n      googleLinksProperties.GoogleStreetView = GoogleLinks.getGoogleStreetViewLink(\n        data.geometry.coordinates[0],\n        data.geometry.coordinates[1]\n      );\n    }\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(\n      { type: data.index },\n      properties,\n      googleLinksProperties,\n      routing\n    );\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    // Keep hashtags for \"lieux\"\n    const hashtags = term.match(/(#[A-Za-z]+)/g) || [];\n    let keep = false;\n    keep = hashtags.some((hashtag) => {\n      const hashtagKey = hashtag.substring(1);\n      return this.hashtagsLieuxToKeep.some(\n        (h) =>\n          h\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '') ===\n          hashtagKey\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n      );\n    });\n\n    if (!keep) {\n      term = term.replace(/(#[A-Za-z]+)/g, '');\n    }\n\n    return term.replace(/[^\\w- !\\-\\+\\(\\)\\.\\/,'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n}\n\n/**\n * IChercheReverse search source\n */\n@Injectable()\nexport class IChercheReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'icherchereverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    injector: Injector,\n  ) {\n    super(options, storageService);\n\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe((title) => this.title$.next(title));\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n  }\n\n  getId(): string {\n    return IChercheReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const types =\n      this.options.params && this.options.params.type\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n        : ['adresses', 'municipalites', 'mrc', 'regadmin'];\n\n    return {\n      title: 'igo.geo.search.ichercheReverse.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              available: false\n            },\n            {\n              title: 'igo.geo.search.icherche.type.district',\n              value: 'arrondissements',\n              enabled: types.indexOf('arrondissements') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'radius',\n          name: 'bufferInput',\n          values: [\n            {\n              title: '100 m',\n              value: 100,\n              enabled: !this.options.distance || this.options.distance === 100\n            },\n            {\n              title: '500 m',\n              value: 500,\n              enabled: this.options.distance === 500\n            },\n            {\n              title: '1 km',\n              value: 1000,\n              enabled: this.options.distance === 1000\n            },\n            {\n              title: '2 km',\n              value: 2000,\n              enabled: this.options.distance === 2000\n            },\n            {\n              title: '5 km',\n              value: 5000,\n              enabled: this.options.distance === 5000\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    return this.http.get(`${this.searchUrl}/locate`, { params }).pipe(\n      map((response: IChercheReverseResponse) => {\n        return this.extractResults(response);\n      })\n    );\n  }\n\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          v.available = types.indexOf(v.value as string) > -1;\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    if (options.distance || this.options.distance) {\n      options.params = Object.assign(options.params || {}, {\n        bufferInput: options.distance || this.options.distance\n      });\n    }\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          loc: lonLat.join(','),\n          sort: 'distance',\n          geometry: true,\n          icon: true\n        },\n        options.params || {},\n        this.params\n      )\n    });\n  }\n\n  private extractResults(\n    response: IChercheReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private getSubtitle(data: IChercheReverseData) {\n    if (!this.settings.length) {\n      return '';\n    }\n    let subtitle = '';\n    switch (data.properties.type) {\n      case 'arrondissements':\n        subtitle = data.properties.municipalite + ' (Arrondissement)';\n        break;\n      default:\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        const type = typeSetting.values.find(\n          (t) => t.value === data.properties.type\n        );\n        if (type) {\n          subtitle = this.languageService.translate.instant(type.title);\n        }\n    }\n    return subtitle;\n  }\n\n  private dataToResult(data: IChercheReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.properties.nom;\n    const subtitleHtml = ' <small> ' + this.getSubtitle(data) + '</small>';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.icon || 'map-marker',\n        pointerSummaryTitle: this.getSubtitle(data)+ ': ' + data.properties.nom\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheReverseData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheReverseSearchSource.propertiesBlacklist\n    );\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(properties, routing);\n  }\n\n  private computeExtent(\n    data: IChercheReverseData\n  ): [number, number, number, number] | undefined {\n    return data.bbox\n      ? [data.bbox[0], data.bbox[2], data.bbox[1], data.bbox[3]]\n      : undefined;\n  }\n}\n","import { Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  IChercheSearchSource,\n  IChercheSearchResultFormatter,\n  IChercheReverseSearchSource\n} from './icherche';\n\n/**\n * ICherche search result formatter factory\n * @ignore\n */\nexport function defaultIChercheSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new IChercheSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ICherche search result formatter\n */\nexport function provideDefaultIChercheSearchResultFormatter() {\n  return {\n    provide: IChercheSearchResultFormatter,\n    useFactory: defaultIChercheSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ICherche search source factory\n * @ignore\n */\nexport function ichercheSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: IChercheSearchResultFormatter,\n  injector: Injector\n) {\n  return new IChercheSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheSearchSource.id}`),\n    formatter,\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the ICherche search source\n */\nexport function provideIChercheSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheSearchSourceFactory,\n    multi: true,\n    deps: [\n      HttpClient,\n      LanguageService,\n      StorageService,\n      ConfigService,\n      IChercheSearchResultFormatter,\n      Injector\n    ]\n  };\n}\n\n/**\n * IChercheReverse search source factory\n * @ignore\n */\nexport function ichercheReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  injector: Injector\n) {\n  return new IChercheReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheReverseSearchSource.id}`),\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the IChercheReverse search source\n */\nexport function provideIChercheReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, Injector]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport * as olproj from 'ol/proj';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport * as olformat from 'ol/format';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, ReverseSearch } from './source';\nimport { SearchSourceOptions, ReverseSearchOptions } from './source.interfaces';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { GoogleLinks } from '../../../utils/googleLinks';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { lonLatConversion, roundCoordTo, convertDDToDMS } from '../../../map/shared/map.utils';\nimport { OsmLinks } from '../../../utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class CoordinatesSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n/**\n * CoordinatesReverse search source\n */\n@Injectable()\nexport class CoordinatesReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'coordinatesreverse';\n  static type = FEATURE;\n\n  private projections;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    @Inject('options') options: SearchSourceOptions,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('projections') projections: Projection[],\n  ) {\n    super(options, storageService);\n    this.projections = projections;\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe(title => this.title$.next(title));\n  }\n\n  getId(): string {\n    return CoordinatesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return CoordinatesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'igo.geo.search.coordinates.name',\n      order: 1,\n      showInSettings: false\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param options options of ReverseSearchOptions (distance, conf, zoom, params)\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    return of([this.dataToResult(lonLat, options)]);\n  }\n\n  private dataToResult(data: [number, number], options: ReverseSearchOptions): SearchResult<Feature> {\n    const dataDMS = convertDDToDMS(data);\n    const convertedCoord = lonLatConversion(data, this.projections);\n    const coords = convertedCoord.reduce((obj, item) => (\n      obj[item.alias] = item.igo2CoordFormat, obj), {});\n\n    const roundedCoordString = roundCoordTo(data, 6).join(', ');\n    const roundedCoordStringDMS = dataDMS.join(', ');\n\n    let geometry: FeatureGeometry = {\n      type: 'Point',\n      coordinates: [data[0], data[1]]\n    };\n\n    const properties = {};\n    let subtitleHtml = '';\n    if (options.distance) {\n      const radiusKey = this.languageService.translate.instant('igo.geo.search.coordinates.radius');\n      properties[radiusKey] = options.distance;\n      subtitleHtml = '<br><small>Rayon: ' + options.distance + ' m</small>';\n\n      // Create polygon\n      const center = olproj.transform([data[0], data[1]], 'EPSG:4326', 'EPSG:3857');\n      const circleGeometry = new OlCircle(center, options.distance);\n      const polygonGeometry = fromCircle(circleGeometry);\n      const writer = new olformat.GeoJSON();\n      geometry = JSON.parse(writer.writeGeometry(polygonGeometry.transform('EPSG:3857', 'EPSG:4326')));\n    }\n\n    if (options.conf) {\n      const confKey = this.languageService.translate.instant('igo.geo.search.coordinates.conf');\n      properties[confKey] = options.conf;\n      subtitleHtml += subtitleHtml === '' ? '<br>' : '<small> - </small>';\n      subtitleHtml += '<small>Confiance: ' + options.conf + '%</small>';\n    }\n\n    const coordKey = this.languageService.translate.instant('igo.geo.search.coordinates.coord');\n    properties[coordKey] = roundedCoordString;\n\n    const coordKeyDMS = this.languageService.translate.instant('igo.geo.search.coordinates.coordDMS');\n    properties[coordKeyDMS] = roundedCoordStringDMS;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent: undefined,\n        properties: Object.assign(\n          properties,\n          coords,\n          {\n            GoogleMaps: GoogleLinks.getGoogleMapsCoordLink(data[0], data[1]),\n            GoogleStreetView: GoogleLinks.getGoogleStreetViewLink(\n              data[0],\n              data[1]\n            ),\n            OpenStreetMap: OsmLinks.getOpenStreetMapLink(data[0], data[1], 14),\n            Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n          }\n        ),\n        meta: {\n          id: data[0].toString() + ',' + data[1].toString(),\n          title: roundedCoordString\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id: data[0].toString() + ',' + data[1].toString(),\n        title: roundedCoordString,\n        titleHtml: roundedCoordString + subtitleHtml,\n        icon: 'map-marker',\n        score: 100, // every coord exists\n      }\n    };\n  }\n}\n","import { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  CoordinatesReverseSearchSource,\n  CoordinatesSearchResultFormatter\n} from './coordinates';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { ProjectionService } from '../../../map/shared/projection.service';\n\n/**\n * ICherche search result formatter factory\n * @ignore\n */\nexport function defaultCoordinatesSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new CoordinatesSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ICherche search result formatter\n */\nexport function provideDefaultCoordinatesSearchResultFormatter() {\n  return {\n    provide: CoordinatesSearchResultFormatter,\n    useFactory: defaultCoordinatesSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * CoordinatesReverse search source factory\n * @ignore\n */\nexport function CoordinatesReverseSearchSourceFactory(\n  config: ConfigService,\n  languageService: LanguageService,\n  storageService: StorageService,\n  _projectionService: ProjectionService\n) {\n  return new CoordinatesReverseSearchSource(\n    config.getConfig(`searchSources.${CoordinatesReverseSearchSource.id}`),\n    languageService,\n    storageService,\n    (config.getConfig('projections') as Projection[]) || []\n  );\n}\n\n/**\n * Function that returns a provider for the IChercheReverse search source\n */\nexport function provideCoordinatesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: CoordinatesReverseSearchSourceFactory,\n    multi: true,\n    deps: [ConfigService, LanguageService, StorageService, ProjectionService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\nimport { LAYER } from '../../../layer';\nimport { QueryableDataSourceOptions, QueryFormat } from '../../../query';\nimport { QueryHtmlTarget } from './../../../query/shared/query.enums';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { TextSearchOptions } from './source.interfaces';\nimport {\n  ILayerSearchSourceOptions,\n  ILayerData,\n  ILayerItemResponse,\n  ILayerServiceResponse,\n  ILayerDataSource\n} from './ilayer.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class ILayerSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(data: ILayerData): ILayerData {\n    const allowedKey = [\n      'title',\n      'abstract',\n      'groupTitle',\n      'metadataUrl',\n      'downloadUrl',\n      'urlInfo',\n      'name'\n    ];\n\n    const property = Object.entries(data.properties)\n      .filter(([key]) => allowedKey.indexOf(key) !== -1)\n      .reduce((out: { [key: string]: any }, entries: [string, any]) => {\n        const [key, value] = entries;\n        let newKey;\n        try {\n          newKey = this.languageService.translate.instant(\n            'igo.geo.search.ilayer.properties.' + key\n          );\n        } catch (e) {\n          newKey = key;\n        }\n        out[newKey] = value ? value : '';\n        return out;\n      }, {});\n\n    const dataR = Object.assign({}, data);\n    dataR.properties = property as ILayerDataSource;\n\n    return dataR;\n  }\n}\n\n/**\n * ILayer search source\n */\n@Injectable()\nexport class ILayerSearchSource extends SearchSource implements TextSearch {\n  static id = 'ilayer';\n  static type = LAYER;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: ILayerSearchSourceOptions,\n    @Inject(ILayerSearchResultFormatter)\n    private formatter: ILayerSearchResultFormatter\n  ) {\n    super(options, storageService);\n    this.languageService.translate\n      .get(this.options.title)\n      .subscribe(title => this.title$.next(title));\n  }\n\n  getId(): string {\n    return ILayerSearchSource.id;\n  }\n\n  getType(): string {\n    return ILayerSearchSource.type;\n  }\n\n  protected getDefaultOptions(): ILayerSearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n    return {\n      title: 'igo.geo.search.ilayer.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.ilayer.type.layer',\n              value: 'layer',\n              enabled: true,\n              hashtags: ['layer', 'layers', 'couche', 'couches']\n            },\n            {\n              title: 'igo.geo.search.ilayer.type.groupLayer',\n              value: 'group',\n              enabled: false,\n              hashtags: ['gr-layer', 'gr-layers', 'gr-couche', 'gr-couches']\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'ecmax',\n          name: 'ecmax',\n          values: [\n            {\n              title: '10 %',\n              value: 10,\n              enabled: ecmax === 10\n            },\n            {\n              title: '30 %',\n              value: 30,\n              enabled: ecmax === 30\n            },\n            {\n              title: '50 %',\n              value: 50,\n              enabled: ecmax === 50 || !ecmax\n            },\n            {\n              title: '75 %',\n              value: 75,\n              enabled: ecmax === 75\n            },\n            {\n              title: '100 %',\n              value: 100,\n              enabled: ecmax === 100\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a layer by name or keyword\n   * @param term Layer name or keyword\n   * @returns Observable of <SearchResult<LayerOptions>[]\n   */\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q') || !params.get('type')) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(\n        map((response: ILayerServiceResponse) => this.extractResults(response, term))\n      );\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(\n        Object.assign(\n          {\n            q: this.computeTerm(term)\n          },\n          this.params,\n          this.computeOptionsParam(term, options || {}).params,\n          {\n            page: options.page\n          }\n        )\n      )\n    });\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    return term.replace(/(#[^\\s]*)/g, '').replace(/[^\\w- !\\-\\(\\),'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n\n  private extractResults(\n    response: ILayerServiceResponse, term: string\n  ): SearchResult<ILayerItemResponse>[] {\n    return response.items.map((data: ILayerData) =>\n    this.dataToResult(data, term, response)\n    );\n  }\n\n  private dataToResult(\n    data: ILayerData,\n    term: string,\n    response?: ILayerServiceResponse\n  ): SearchResult<ILayerItemResponse> {\n    const layerOptions = this.computeLayerOptions(data);\n\n    const titleHtml = data.highlight.title || data.properties.title;\n    const groupTitle = data.highlight.groupTitle || data.properties.groupTitle;\n    const subtitleHtml = groupTitle\n      ? ' <small style=\"color: #6f6969\"> ' + groupTitle + '</small>'\n      : '';\n\n    return {\n      source: this,\n      meta: {\n        dataType: LAYER,\n        id: [this.getId(), data.properties.id].join('.'),\n        title: data.properties.title,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.properties.type === 'Layer' ? 'layers' : 'map',\n        score: data.score || computeTermSimilarity(term.trim(), data.properties.name),\n        nextPage:\n          response.items.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      },\n      data: layerOptions\n    };\n  }\n\n  private computeLayerOptions(data: ILayerData): ILayerItemResponse {\n    const url = data.properties.url;\n    const queryParams: QueryableDataSourceOptions = this.extractQueryParamsFromSourceUrl(\n      url\n    );\n    return ObjectUtils.removeUndefined({\n      sourceOptions: {\n        id: data.properties.id,\n        type: data.properties.format,\n        url,\n        queryFormat: queryParams.queryFormat,\n        queryHtmlTarget: queryParams.queryHtmlTarget,\n        params: data.properties.format === 'wms' ? {LAYERS: data.properties.name} : undefined,\n        layer: data.properties.format === 'wms' ? undefined : data.properties.name,\n        optionsFromCapabilities: true,\n        crossOrigin: 'anonymous'\n      },\n      title: data.properties.title,\n      maxResolution: getResolutionFromScale(\n        Number(data.properties.maxScaleDenom)\n      ),\n      minResolution: getResolutionFromScale(\n        Number(data.properties.minScaleDenom)\n      ),\n      metadata: {\n        url: data.properties.metadataUrl,\n        extern: data.properties.metadataUrl ? true : undefined,\n        abstract: data.properties.abstract || undefined\n      },\n      properties: this.formatter.formatResult(data).properties\n    });\n  }\n\n  private extractQueryParamsFromSourceUrl(\n    url: string\n  ): { queryFormat: QueryFormat; queryHtmlTarget: QueryHtmlTarget } {\n    let queryFormat;\n    let queryHtmlTarget;\n    const formatOpt = (this.options as ILayerSearchSourceOptions).queryFormat;\n    if (formatOpt) {\n      for (const key of Object.keys(formatOpt)) {\n        const value = formatOpt[key];\n        if (value === '*') {\n          queryFormat = QueryFormat[key.toUpperCase()];\n          break;\n        }\n\n        const urls = ((value as any) as { urls: string[] }).urls;\n        if (Array.isArray(urls)) {\n          urls.forEach(urlOpt => {\n            if (url.indexOf(urlOpt) !== -1) {\n              queryFormat = QueryFormat[key.toUpperCase()];\n            }\n          });\n          break;\n        }\n      }\n\n      if (\n        queryFormat === QueryFormat.HTML ||\n        queryFormat === QueryFormat.HTMLGML2\n      ) {\n        queryHtmlTarget = 'iframe';\n      }\n    }\n\n    return {\n      queryFormat,\n      queryHtmlTarget\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { ILayerSearchSource, ILayerSearchResultFormatter } from './ilayer';\n\n/**\n * ILayer search result formatter factory\n * @ignore\n */\nexport function ilayerSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new ILayerSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ILayer search result formatter\n */\nexport function provideILayerSearchResultFormatter() {\n  return {\n    provide: ILayerSearchResultFormatter,\n    useFactory: ilayerSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ILayer search source factory\n * @ignore\n */\nexport function ilayerSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: ILayerSearchResultFormatter\n) {\n  return new ILayerSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${ILayerSearchSource.id}`),\n    formatter\n  );\n}\n\n/**\n * Function that returns a provider for the ILayer search source\n */\nexport function provideILayerSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ilayerSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, ILayerSearchResultFormatter]\n  };\n}\n","import { FEATURE } from '../../feature';\nimport { LAYER } from '../../layer';\n\nexport const SEARCH_TYPES = [FEATURE, LAYER];\n","<div class=\"igo-search-selector\">\n  <button\n    mat-icon-button\n    class=\"igo-search-selector-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSelectorMenu\">\n    <mat-icon svgIcon=\"menu-down\"></mat-icon>\n  </button>\n\n  <mat-menu\n    #searchSelectorMenu=\"matMenu\"\n    class=\"no-border-radius\"\n    xPosition=\"before\"\n    yPosition=\"above\">\n    <mat-radio-group\n      class=\"igo-search-selector-radio-group\"\n      [value]=\"searchType$ | async\"\n      (change)=\"onSearchTypeChange($event.value)\">\n      <mat-radio-button *ngFor=\"let searchType of searchTypes\" [value]=\"searchType\">\n        {{getSearchTypeTitle(searchType) | translate}}\n      </mat-radio-button>\n    </mat-radio-group>\n  </mat-menu>\n\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { SEARCH_TYPES } from '../shared/search.enums';\nimport { SearchSourceService } from '../shared/search-source.service';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-selector',\n  templateUrl: './search-selector.component.html',\n  styleUrls: ['./search-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchSelectorComponent implements OnInit, OnDestroy {\n\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  /**\n   * The search type enabled\n   */\n  @Input()\n  set searchType(value: string) { this.setSearchType(value); }\n  get searchType(): string { return this.searchType$.value; }\n\n  /**\n   * Event emitted when the enabled search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  constructor(private searchSourceService: SearchSourceService) {}\n\n  ngOnInit() {\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n  }\n\n  ngOnDestroy() {\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * Enable the selected search type\n   * @param searchType Search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Get a search type's title. The title\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Search type\n   * @internal\n   */\n  getSearchTypeTitle(searchType: string) {\n    return `igo.geo.search.${searchType.toLowerCase()}.title`;\n  }\n\n  /**\n   * Emit an event and enable the search sources of the given type.\n   * @param searchType Search type\n   */\n  private setSearchType(searchType: string | undefined) {\n    this.searchType$.next(searchType);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchSourceService.enableSourcesByType(searchType);\n    this.searchTypeChange.emit(searchType);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { SearchSelectorComponent } from './search-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatTabsModule,\n    MatCheckboxModule,\n    IgoLanguageModule\n  ],\n  exports: [SearchSelectorComponent],\n  declarations: [SearchSelectorComponent]\n})\nexport class IgoSearchSelectorModule {}\n","<div class=\"igo-search-settings\">\n\n  <button\n    mat-icon-button\n    class=\"igo-search-settings-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSettingsMenu\">\n    <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n  </button>\n  <mat-menu\n    #searchSettingsMenu=\"matMenu\"\n    class=\"no-border-radius\">\n    <div class=\"checkAllButton\" *ngIf=\"getSearchSources().length>4\">\n      <button mat-raised-button\n        (click)=\"checkUncheckAllSources($event)\">{{!searchSourcesAllEnabled  ? ('igo.geo.search.searchSources.unselectAll' | translate): ('igo.geo.search.searchSources.selectAll' | translate)}}</button>\n    </div>\n      <ng-container *ngFor=\"let source of getSearchSources()\">\n        <span class=\"igo-search-settings-search-source\">\n          <mat-checkbox\n            class=\"igo-search-settings-checkbox\"\n            [checked]=\"source.enabled\"\n            [value]=\"source\"\n            (click)=\"$event.stopPropagation()\"\n            (change)=\"onCheckSearchSource($event, source)\">\n          </mat-checkbox>\n          <button *ngIf=\"source.settings.length>0\"\n            [matMenuTriggerFor]=\"sub_menu\"\n            mat-menu-item>{{source.title}}\n          </button>\n          <button\n            mat-menu-item\n            *ngIf=\"source.settings.length===0\">\n            {{source.title}}\n          </button>\n        </span>\n          <mat-menu #sub_menu=\"matMenu\">\n            <ng-container *ngFor=\"let setting of source.settings\">\n              <button\n                  mat-menu-item\n                  [matMenuTriggerFor]=\"test_sub_menu\">\n                {{'igo.geo.search.searchSources.settings.'+ setting.title | translate}}\n              </button>\n              <mat-menu #test_sub_menu=\"matMenu\"\n                [ngSwitch]=\"setting.type\"\n                yPosition=\"above\">\n                <span *ngSwitchCase=\"'radiobutton'\">\n                  <mat-radio-group\n                    class=\"igo-search-settings-radio-group\"\n                    [value]=\"setting\">\n                    <mat-radio-button *ngFor=\"let settingValue of setting.values\"\n                      class=\"mat-typography\"\n                      [value]=\"settingValue\"\n                      [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                      [checked]=\"settingValue.enabled\"\n                      (click)=\"$event.stopPropagation()\"\n                      (change)=\"settingsValueCheckedRadioButton($event, source, setting, settingValue)\">\n                      {{settingValue.title | translate}}\n                    </mat-radio-button>\n                  </mat-radio-group>\n                </span>\n                <span *ngSwitchCase=\"'checkbox'\">\n                  <div class=\"checkAllButton\" *ngIf=\"setting.values.length>3\">\n                    <button mat-raised-button\n                      (click)=\"checkUncheckAll($event, source, setting)\">{{setting.allEnabled || setting.allEnabled === undefined  ? ('igo.geo.search.searchSources.settings.unselectAll' | translate): ('igo.geo.search.searchSources.settings.selectAll' | translate)}}</button>\n                  </div>\n                  <mat-checkbox *ngFor=\"let settingValue of getAvailableValues(setting)\"\n                    class=\"mat-menu-item\"\n                    [style.display]=\"displayBlock\"\n                    [checked]=\"settingValue.enabled\"\n                    [value]=\"setting\"\n                    [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                    (click)=\"$event.stopPropagation()\"\n                    (change)=\"settingsValueCheckedCheckbox($event, source, setting, settingValue)\">\n                    {{settingValue.title | translate}}\n                  </mat-checkbox>\n                </span>\n              </mat-menu>\n            </ng-container>\n          </mat-menu>\n      </ng-container>\n      <span *ngIf=\"hasPointerReverseSearchSource && !isTouchScreen\">\n        <mat-divider></mat-divider>\n        <span class=\"pointer-summary-slide-toggle-container mat-typography\">\n          <mat-slide-toggle class=\"pointer-summary-option\" (change)=\"changePointerReverseSearch($event)\" tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.search.pointerSearchSummary.tooltip' | translate\"\n            (click)=\"$event.stopPropagation()\" [checked]=\"pointerSummaryEnabled\" [labelPosition]=\"'after'\">\n            {{'igo.geo.search.pointerSearchSummary.title' | translate}}\n          </mat-slide-toggle>\n          <mat-slide-toggle class=\"pointer-summary-option\" (change)=\"changeSearchResultsGeometry($event)\" tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.search.searchResultsGeometry.tooltip' | translate\"\n            (click)=\"$event.stopPropagation()\" [checked]=\"searchResultsGeometryEnabled\" [labelPosition]=\"'after'\">\n            {{'igo.geo.search.searchResultsGeometry.title' | translate}}\n          </mat-slide-toggle>\n        </span>\n      </span>\n  </mat-menu>\n</div>\n","import { MatCheckboxChange } from '@angular/material/checkbox';\nimport { MatRadioChange } from '@angular/material/radio';\n\nimport {\n  Component,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  HostListener,\n  Input\n} from '@angular/core';\n\nimport { SearchSourceService } from '../shared/search-source.service';\nimport { SearchSource } from '../shared/sources/source';\nimport {\n  SearchSourceSettings,\n  SettingOptions\n} from '../shared/sources/source.interfaces';\nimport {\n  sourceCanReverseSearchAsSummary,\n  sourceCanSearch,\n  sourceCanReverseSearch\n} from '../shared/search.utils';\nimport { MediaService, StorageService } from '@igo2/core';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-settings',\n  templateUrl: './search-settings.component.html',\n  styleUrls: ['./search-settings.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchSettingsComponent implements OnInit {\n  public hasPointerReverseSearchSource: boolean = false;\n  public searchSourcesAllEnabled: boolean = false;\n\n  public buffer = [];\n  public lastKeyTime = Date.now();\n\n  public displayBlock = 'block';\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n\n  /**\n   * Event emitted when the enabled search source changes\n   */\n  @Output() searchSourceChange = new EventEmitter<SearchSource>();\n\n  /**\n   * Event emitted when the pointer summary is activated\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry summary is changed\n   */\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n  @HostListener('document:keydown', ['$event'])\n  handleKeyboardEvent(event: KeyboardEvent) {\n    if (event.key === 'F2') {\n      this.pointerSummaryEnabled = !this.pointerSummaryEnabled;\n      this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n    }\n  }\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService,\n    private storageService: StorageService\n  ) {}\n\n  ngOnInit(): void {\n    this.hasPointerReverseSearchSource = this.hasReverseSearchSourcesForPointerSummary();\n  }\n\n  /**\n   * Get all search sources\n   * @internal\n   */\n  getSearchSources(): SearchSource[] {\n    const textSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n\n    const reverseSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanReverseSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n    const sources = textSearchSources.concat(reverseSearchSources);\n    this.computeSourcesCheckAllBehavior(sources);\n    return sources;\n  }\n\n  /**\n   * Get all search sources usable for pointer summary\n   * @internal\n   */\n  hasReverseSearchSourcesForPointerSummary(): boolean {\n    if (\n      this.searchSourceService\n        .getEnabledSources()\n        .filter(sourceCanReverseSearchAsSummary).length\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Triggered when a setting is checked (checkbox style)\n   * @internal\n   */\n  settingsValueCheckedCheckbox(\n    event: MatCheckboxChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    settingValue.enabled = event.checked;\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (settings)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSettingCheckAllBehavior(setting: SearchSourceSettings) {\n    if (setting.allEnabled === undefined) {\n      if (setting.values.find((settingValue) => settingValue.enabled)) {\n        setting.allEnabled = false;\n      } else {\n        setting.allEnabled = true;\n      }\n    } else {\n      setting.allEnabled = !setting.allEnabled;\n    }\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (sources)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSourcesCheckAllBehavior(sources: SearchSource[]) {\n    const enabledSourcesCnt = sources.filter((source) => source.enabled).length;\n    const disabledSourcesCnt = sources.filter((source) => !source.enabled)\n      .length;\n    this.searchSourcesAllEnabled =\n      enabledSourcesCnt >= disabledSourcesCnt ? false : true;\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAll(event, source: SearchSource, setting: SearchSourceSettings) {\n    event.stopPropagation();\n    this.computeSettingCheckAllBehavior(setting);\n    setting.values.forEach((settingValue) => {\n      settingValue.enabled = setting.allEnabled;\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAllSources(event) {\n    event.stopPropagation();\n    this.getSearchSources().map((source) => {\n      source.enabled = this.searchSourcesAllEnabled;\n      this.searchSourceChange.emit(source);\n    });\n  }\n\n  /**\n   * Triggered when a setting is checked (radiobutton style)\n   * @internal\n   */\n  settingsValueCheckedRadioButton(\n    event: MatRadioChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    setting.values.forEach((conf) => {\n      if (conf.value !== settingValue.value) {\n        conf.enabled = !event.source.checked;\n      } else {\n        conf.enabled = event.source.checked;\n      }\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  onCheckSearchSource(event: MatCheckboxChange, source: SearchSource) {\n    source.enabled = event.checked;\n    const storage = (this.storageService.get(source.getId() + '.options') || {}) as SettingOptions;\n    storage.enabled = source.enabled;\n    this.storageService.set(\n      source.getId() + '.options',\n      storage\n    );\n    this.searchSourceChange.emit(source);\n  }\n\n  getAvailableValues(setting: SearchSourceSettings) {\n    return setting.values.filter((s) => s.available !== false);\n  }\n\n  getAvailableHashtagsValues(setting: SettingOptions) {\n    if (setting.hashtags) {\n      return setting.hashtags.map((h) => '#' + h).join(', ');\n    }\n    return;\n  }\n\n  stopPropagation(event) {\n    event.stopPropagation();\n  }\n\n  changePointerReverseSearch(event) {\n    this.pointerSummaryEnabled = event.checked;\n    this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n  }\n\n  changeSearchResultsGeometry(event) {\n    this.searchResultsGeometryEnabled = event.checked;\n    this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { SearchSettingsComponent } from './search-settings.component';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\n/**\n * @ignore\n */\n@NgModule({\n  declarations: [SearchSettingsComponent],\n  imports: [\n    CommonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatCheckboxModule,\n    MatDividerModule,\n    MatSlideToggleModule,\n    IgoLanguageModule\n  ],\n  exports: [SearchSettingsComponent]\n})\nexport class IgoSearchSettingsModule { }\n","<div class=\"igo-search-bar-container\" [ngClass]=\"{empty: empty$ | async}\">\n  <mat-form-field [floatLabel]=\"floatLabel\" [appearance]=\"appearance\">\n    <mat-label *ngIf=\"label\">{{label}}</mat-label>\n    <input\n      #input\n      matInput\n      autocomplete=\"off\"\n      [ngClass]=\"{'hasSearchIcon': searchIcon}\"\n      [disabled]=\"disabled$ | async\"\n      [placeholder]=\"placeholder ? placeholder : (placeholder$ | async) ? (placeholder$.value | translate) : undefined\"\n      [value]=\"term$ | async\"\n      (keyup)=\"onKeyup($event)\"\n      (touchend)=\"onKeyup($event)\">\n  </mat-form-field>\n\n  <div class=\"search-bar-buttons\">\n    <button\n      mat-icon-button\n      [color]=\"color\"\n      *ngIf=\"searchIcon !== undefined\">\n      <mat-icon svgIcon=\"{{searchIcon}}\"></mat-icon>\n    </button>\n\n    <button\n      *ngIf=\"(empty$ | async)===false\"\n      mat-icon-button\n      [color]=\"color\"\n      (click)=\"onClearButtonClick()\">\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n\n    <igo-search-selector\n      *ngIf=\"searchSelector\"\n      [searchTypes]=\"searchTypes\"\n      [searchType]=\"searchType$ | async\"\n      (searchTypeChange)=\"onSearchTypeChange($event)\">\n    </igo-search-selector>\n\n    <igo-search-settings\n      *ngIf=\"searchSettings\"\n      [pointerSummaryEnabled]=\"pointerSummaryEnabled\"\n      (pointerSummaryStatus)=\"pointerSummaryStatus.emit($event)\"\n      [searchResultsGeometryEnabled]=\"searchResultsGeometryEnabled\"\n      (searchResultsGeometryStatus)=\"searchResultsGeometryStatus.emit($event)\"\n      (searchSourceChange)=\"onSearchSettingsChange()\">\n    </igo-search-settings>\n  </div>\n</div>\n","import {\n  Component,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Input,\n  Output,\n  EventEmitter,\n  ViewChild,\n  ElementRef\n} from '@angular/core';\nimport {\n  FloatLabelType,\n  MatFormFieldAppearance\n} from '@angular/material/form-field';\nimport { BehaviorSubject, Subscription, EMPTY, timer } from 'rxjs';\nimport { debounce, distinctUntilChanged } from 'rxjs/operators';\n\nimport { LanguageService } from '@igo2/core';\nimport { EntityStore } from '@igo2/common';\n\nimport { SEARCH_TYPES } from '../shared/search.enums';\nimport { SearchResult, Research } from '../shared/search.interfaces';\nimport { SearchService } from '../shared/search.service';\nimport { SearchSourceService } from '../shared/search-source.service';\n\n/**\n * Searchbar that triggers a research in all search sources enabled.\n * If the store input is defined, the search results will be loaded\n * into that store. An event is always emitted when a research is completed.\n */\n@Component({\n  selector: 'igo-search-bar',\n  templateUrl: './search-bar.component.html',\n  styleUrls: ['./search-bar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchBarComponent implements OnInit, OnDestroy {\n  /**\n   * Invalid keys\n   */\n  static invalidKeys = [\n    'Control',\n    'Shift',\n    'Alt',\n    'ArrowDown',\n    'ArrowUp',\n    'ArrowRight',\n    'ArrowLeft'\n  ];\n\n  readonly placeholder$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.search.placeholder'\n  );\n\n  readonly empty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  /**\n   * Subscription to the ssearch bar term\n   */\n  private term$$: Subscription;\n\n  /**\n   * Search term stream\n   */\n  private stream$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Subscription to the search term stream\n   */\n  private stream$$: Subscription;\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  private researches$$: Subscription[];\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  /**\n   * Search term\n   */\n  @Input()\n  set searchType(value: string) {\n    this.setSearchType(value);\n  }\n  get searchType(): string {\n    return this.searchType$.value;\n  }\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Event emitted when the pointer summary is activated by the searchbar setting\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry setting is changed\n   */\n   @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Search term\n   */\n  @Input()\n  set term(value: string) {\n    this.setTerm(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n  readonly term$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Whether this component is disabled\n   */\n  @Input()\n  set disabled(value: boolean) {\n    this.disabled$.next(value);\n  }\n  get disabled(): boolean {\n    return this.disabled$.value;\n  }\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n  /**\n   * Whether a float label should be displayed\n   */\n  @Input() floatLabel: FloatLabelType = 'never';\n\n  @Input() appearance: MatFormFieldAppearance = 'legacy';\n\n  @Input() placeholder: string;\n\n  @Input() label: string;\n\n  /**\n   * Icons color (search and clear)\n   */\n  @Input() color = 'primary';\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Debounce time between each keystroke\n   */\n  @Input() debounce = 200;\n\n  /**\n   * Minimum term length required to trigger a research\n   */\n  @Input() minLength = 2;\n\n  /**\n   * Search icon\n   */\n  @Input() searchIcon: string;\n\n  /**\n   * Search Selector\n   */\n  @Input() searchSelector = false;\n\n  /**\n   * Search Settings\n   */\n  @Input() searchSettings = false;\n\n  /**\n   * Force coordinates in north america\n   */\n  @Input() forceNA = false;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * Event emitted when the search term changes\n   */\n  @Output() searchTermChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when a research is completed\n   */\n  @Output() search = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() clearFeature = new EventEmitter();\n\n  /**\n   * Event emitted when the search settings changes\n   */\n  @Output() searchSettingsChange = new EventEmitter();\n\n  /**\n   * Input element\n   * @internal\n   */\n  @ViewChild('input', { static: true }) input: ElementRef;\n\n  /**\n   * Whether the search bar is empty\n   * @internal\n   */\n  get empty(): boolean {\n    return this.term.length === 0;\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService\n  ) {}\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe((term: string) => {\n      this.empty$.next(term === undefined || term.length === 0);\n    });\n\n    this.stream$$ = this.stream$\n      .pipe(\n        debounce((term: string) => (term === '' ? EMPTY : timer(this.debounce)))\n      )\n      .subscribe((term: string) => this.onSetTerm(term));\n\n    this.handlePlaceholder();\n\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n  }\n\n  /**\n   * Unsubscribe to the search term stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.term$$.unsubscribe();\n    this.stream$$.unsubscribe();\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * When a user types, validates the key and send it into the\n   * stream if it's valid\n   * @param event Keyboard event\n   * @internal\n   */\n  onKeyup(event: KeyboardEvent) {\n    const key = event.key;\n    if (!this.keyIsValid(key)) {\n      return;\n    }\n    const term = (event.target as HTMLInputElement).value;\n    this.setTerm(term);\n  }\n\n  /**\n   * Clear the stream and the input\n   * @internal\n   */\n  onClearButtonClick() {\n    this.clear();\n    this.clearFeature.emit();\n  }\n\n  /**\n   * Update search type\n   * @param searchType Enabled search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Update the placeholder with the enabled search type. The placeholder\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Enabled search type\n   * @internal\n   */\n  setSearchType(searchType: string) {\n    this.searchType$.next(searchType);\n  }\n\n  onSearchSettingsChange() {\n    this.doSearch(this.term);\n    this.searchSettingsChange.emit();\n    this.handlePlaceholder();\n  }\n\n  /**\n   * Send the term into the stream only if this component is not disabled\n   * @param term Search term\n   */\n  setTerm(term: string) {\n    if (this.disabled) {\n      return;\n    }\n\n    term = term || '';\n\n    if (term !== this.term) {\n      this.term$.next(term);\n    }\n\n    const slug = term.replace(/(#[^\\s]*)/g, '').trim();\n    if (slug.length >= this.minLength || slug.length === 0) {\n      this.stream$.next(term);\n    }\n  }\n\n  /**\n   * Clear the stream and the input\n   */\n  private clear() {\n    this.term$.next('');\n    this.stream$.next('');\n    this.input.nativeElement.focus();\n  }\n\n  /**\n   * Validate if a given key stroke is a valid input\n   */\n  private keyIsValid(key: string) {\n    return SearchBarComponent.invalidKeys.indexOf(key) === -1;\n  }\n\n  /**\n   * When the search term changes, emit an event and trigger a\n   * research in every enabled search sources.\n   * @param term Search term\n   */\n  private onSetTerm(term: string | undefined) {\n    this.searchTermChange.emit(term);\n    this.doSearch(term);\n  }\n\n  private handlePlaceholder() {\n    const searchTypes = [\n      ...new Set(\n        this.searchSourceService\n          .getEnabledSources()\n          .filter((ss) => !['map', 'coordinatesreverse'].includes(ss.getId()))\n          .map((ss) => ss.getType())\n      )\n    ];\n\n    let placeholder = `igo.geo.search.placeholder`;\n    if (searchTypes.length === 1) {\n      placeholder = `igo.geo.search.${searchTypes[0].toLowerCase()}.placeholder`;\n    } else if (searchTypes.length === 0) {\n      placeholder = `igo.geo.search.emptyType.placeholder`;\n    }\n    this.placeholder$.next(placeholder);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchTypeChange.emit(searchType);\n\n    const placeholder = `igo.geo.search.${searchType.toLowerCase()}.placeholder`;\n    this.placeholder$.next(placeholder);\n\n    this.setTerm(this.term);\n  }\n\n  /**\n   * Execute the search\n   * @param term Search term\n   */\n  private doSearch(rawTerm: string | undefined) {\n    if (this.researches$$) {\n      this.researches$$.map((research) => research.unsubscribe());\n      this.researches$$ = undefined;\n    }\n\n    let terms;\n    if (this.termSplitter && rawTerm.match(new RegExp(this.termSplitter, 'g'))) {\n      terms = rawTerm.split(this.termSplitter).filter((t) => t.length >= this.minLength);\n      if (this.store) {\n        this.store.clear();\n      }\n    } else {\n      terms = [rawTerm];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      const slug = term ? term.replace(/(#[^\\s]*)/g, '').trim() : '';\n      if (slug === '') {\n        if (this.store !== undefined) {\n          this.store.clear();\n        }\n        return;\n      }\n\n      researches = researches.concat(this.searchService.search(term, {\n        forceNA: this.forceNA\n      }));\n    });\n    this.researches$$ = researches.map((research) => {\n      return research.request.subscribe((results: SearchResult[]) => {\n        this.onResearchCompleted(research, results);\n      });\n    });\n  }\n\n  /**\n   * When a research  is completed, emit an event and update\n   * the store's items.\n   * @param research Research\n   * @param results Research results\n   */\n  private onResearchCompleted(research: Research, results: SearchResult[]) {\n    this.search.emit({ research, results });\n\n    if (this.store !== undefined) {\n      const newResults = this.store\n        .all()\n        .filter((result) => result.source !== research.source)\n        .concat(results);\n      this.store.updateMany(newResults);\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoSearchSelectorModule } from '../search-selector/search-selector.module';\nimport { IgoSearchSettingsModule } from '../search-settings/search-settings.module';\nimport { SearchBarComponent } from './search-bar.component';\nimport { SearchUrlParamDirective } from './search-url-param.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatFormFieldModule,\n    MatInputModule,\n    IgoLanguageModule,\n    IgoSearchSelectorModule,\n    IgoSearchSettingsModule\n  ],\n  exports: [\n    SearchBarComponent,\n  ],\n  declarations: [\n    SearchBarComponent,\n    SearchUrlParamDirective\n  ]\n})\nexport class IgoSearchBarModule {}\n","<mat-list-item>\n  <mat-icon *ngIf=\"icon\" mat-list-avatar svgIcon=\"{{showIcons ? icon : 'blank'}}\"></mat-icon>\n\n  <h4 matLine *ngIf=\"titleHtml\" [innerHtml]=\"titleHtml\" matTooltipShowDelay=\"500\" [matTooltip]=\"tooltipHtml\" matTooltipClass=\"search-result-tooltip\"></h4>\n  <h4 matLine *ngIf=\"!titleHtml\" matTooltipShowDelay=\"500\" [matTooltip]=\"title\">{{title}}</h4>\n\n  <button *ngIf=\"withZoomButton\"\n    igoStopPropagation\n    mat-icon-button\n    (click)=\"onZoomHandler()\">\n    <mat-icon svgIcon=\"magnify\"></mat-icon>\n  </button>\n\n  <ng-content\n    select=[igoSearchItemToolbar]>\n  </ng-content>\n\n</mat-list-item>\n","import { Component, Input, ChangeDetectionStrategy, EventEmitter, Output } from '@angular/core';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport {\n  getEntityTitle,\n  getEntityTitleHtml,\n  getEntityIcon\n} from '@igo2/common';\n\nimport { SearchResult } from '../shared/search.interfaces';\nimport { FeatureMotion, moveToOlFeatures } from '../../feature';\nimport { IgoMap } from '../../map';\n\n/**\n * Search results list item\n */\n@Component({\n  selector: 'igo-search-results-item',\n  templateUrl: './search-results-item.component.html',\n  styleUrls: ['./search-results-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultsItemComponent {\n  /**\n   * Search result item\n   */\n  @Input() result: SearchResult;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search result title\n   * @internal\n   */\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  @Output() zoomEvent = new EventEmitter<boolean>();\n\n  private format = new olFormatGeoJSON();\n\n  get title(): string {\n    return getEntityTitle(this.result);\n  }\n\n  /**\n   * Search result HTML title\n   * @internal\n   */\n  get titleHtml(): string {\n    return getEntityTitleHtml(this.result);\n  }\n\n  /**\n   * Search result tooltip\n   * @internal\n   */\n  get tooltipHtml(): string {\n    return this.titleHtml\n      .replace(/<small?[^>]+(>|$)/g, '\\n')\n      .replace(/<\\/?[^>]+(>|$)/g, '');\n  }\n\n  /**\n   * Search result icon\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.result);\n  }\n\n  constructor() {}\n\n  onZoomHandler() {\n    const olFeature = this.format.readFeature(this.result.data, {\n      dataProjection: this.result.data.projection,\n      featureProjection: this.map.projection\n    });\n    moveToOlFeatures(this.map, [olFeature], FeatureMotion.Default);\n  }\n}\n","<igo-list [navigation]=\"true\">\n  <ng-template\n    #groupTemplate\n    ngFor let-group\n    [ngForOf]=\"results$ | async\">\n\n    <igo-collapsible [class]=\"group.source.getId()\"\n      *ngIf=\"mode === searchResultMode.Grouped; else flatTemplate\"\n      [title]=\"computeGroupTitle(group)\"\n      [collapsed]=\"collapsed[group.source.title]\"\n      (toggle)=\"collapsed[group.source.title] = $event\">\n      <ng-container *ngTemplateOutlet=\"storeItemTemplate; context: {results: group.results}\"></ng-container>\n    </igo-collapsible>\n\n    <ng-template #flatTemplate>\n      <ng-container *ngTemplateOutlet=\"storeItemTemplate; context: {results: group.results}\"></ng-container>\n    </ng-template>\n\n    <ng-template #storeItemTemplate let-results=\"results\">\n      <ng-template ngFor let-result [ngForOf]=\"results\">\n        <igo-search-results-item\n          igoListItem\n          color=\"accent\"\n          [map]=\"map\"\n          [result]=\"result\"\n          [showIcons]=\"showIcons\"\n          [withZoomButton]=\"withZoomButton\"\n          [focused]=\"store.state.get(result).focused\"\n          [selected]=\"store.state.get(result).selected\"\n          (focus)=\"resultFocus.emit(result)\"\n          (unfocus)=\"resultUnfocus.emit(result)\"\n          (select)=\"onResultSelect(result)\"\n          (mouseenter)=\"resultFocus.emit(result)\"\n          (mouseleave)=\"resultUnfocus.emit(result)\">\n\n          <ng-container igoSearchItemToolbar\n            [ngTemplateOutlet]=\"templateSearchToolbar\"\n            [ngTemplateOutletContext]=\"{result: result}\">\n          </ng-container>\n\n        </igo-search-results-item>\n      </ng-template>\n      <span class=\"moreResults mat-typography\" *ngIf=\"isMoreResults(group)\" (click)=\"displayMoreResults(group)\">\n        <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\n      </span>\n    </ng-template>\n\n  </ng-template>\n\n</igo-list>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ContentChild,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { Observable, EMPTY, timer, BehaviorSubject, Subscription } from 'rxjs';\nimport { debounce, map } from 'rxjs/operators';\n\nimport { EntityState, EntityStore, EntityStoreFilterCustomFuncStrategy, EntityStoreWatcher } from '@igo2/common';\n\nimport { IgoMap } from '../../map';\n\nimport { TextSearchOptions } from '../shared/sources/source.interfaces';\nimport { SearchService } from '../shared/search.service';\nimport { SearchResult, Research } from '../shared/search.interfaces';\nimport { SearchSource } from '../shared/sources/source';\n\nexport enum SearchResultMode {\n  Grouped = 'grouped',\n  Flat = 'flat'\n}\n\n/**\n * List of search results with focus and selection capabilities.\n * This component is dumb and only emits events.\n */\n@Component({\n  selector: 'igo-search-results',\n  templateUrl: './search-results.component.html',\n  styleUrls: ['./search-results.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultsComponent implements OnInit, OnDestroy {\n  /**\n   * Reference to the SearchResultMode enum\n   * @internal\n   */\n  public searchResultMode = SearchResultMode;\n\n  /**\n   * Search results store watcher\n   */\n  private watcher: EntityStoreWatcher<SearchResult>;\n\n  private settingsChange$$: Subscription;\n\n  public pageIterator: {sourceId: string}[] = [];\n\n  public collapsed: {sourceId: string}[] = [];\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Search results display mode\n   */\n  @Input() mode: SearchResultMode = SearchResultMode.Grouped;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  /**\n   * Search term\n   */\n  @Input()\n  get term(): string {\n    return this._term;\n  }\n  set term(value: string) {\n    this._term = value;\n    this.pageIterator = [];\n  }\n  public _term: string;\n\n  @Input() settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Event emitted when a result is focused\n   */\n  @Output() resultFocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is unfocused\n   */\n  @Output() resultUnfocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is selected\n   */\n  @Output() resultSelect = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a research is completed after displaying more results is clicked\n   */\n  @Output() moreResults = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Events emitted when a result is focus or unfocus by mouse event\n   */\n  @Output() resultMouseenter = new EventEmitter<SearchResult>();\n  @Output() resultMouseleave = new EventEmitter<SearchResult>();\n\n  @ContentChild('igoSearchItemToolbar', /* TODO: add static flag */ {}) templateSearchToolbar: TemplateRef<any>;\n\n  get results$(): Observable<{source: SearchSource; results: SearchResult[]}[]> {\n    if (this._results$ === undefined) {\n      this._results$ = this.liftResults();\n    }\n    return this._results$;\n  }\n  private _results$: Observable<\n    {source: SearchSource; results: SearchResult[]}[]\n  >;\n\n  constructor(private cdRef: ChangeDetectorRef,\n              private searchService: SearchService) {}\n\n  /**\n   * Bind the search results store to the watcher\n   * @internal\n   */\n  ngOnInit() {\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n    this.settingsChange$$ = this.settingsChange$.subscribe(() => {\n      this.pageIterator = [];\n    });\n  }\n\n  /**\n   * Unbind the search results store from the watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n    this.settingsChange$$.unsubscribe();\n  }\n\n  /**\n   * Compute a group title\n   * @param group Search results group\n   * @returns Group title\n   * @internal\n   */\n  computeGroupTitle(group: {source: SearchSource; results: SearchResult[]}): string {\n    const parts = [group.source.title];\n    const count = group.results.length;\n    if (count > 1) {\n      parts.push(`(${count})`);\n    }\n    return parts.join(' ');\n  }\n\n  /**\n   * When a result is selected, update it's state in the store and emit\n   * an event. A selected result is also considered focused\n   * @param result Search result\n   * @internal\n   */\n  onResultSelect(result: SearchResult) {\n    if (this.store.state.get(result)) {\n      if (this.store.state.get(result).selected === true) {\n        return;\n      }\n    }\n    this.store.state.update(result, {focused: true, selected: true}, true);\n    this.resultSelect.emit(result);\n  }\n\n  /**\n   * Return an observable of the search results, grouped by search source\n   * @returns Observable of grouped search results\n   * @internal\n   */\n   private liftResults(): Observable<{source: SearchSource; results: SearchResult[]}[]> {\n    return this.store.stateView.all$().pipe(\n      debounce((results: {entity: SearchResult, state: EntityState}[]) => {\n        return results.length === 0 ? EMPTY : timer(200);\n      }),\n      map((results: {entity: SearchResult, state: EntityState}[]) => {\n        return this.groupResults(results.map(r => r.entity).sort(this.sortByOrder));\n      })\n    );\n  }\n\n  /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\n    return r1.source.displayOrder - r2.source.displayOrder;\n  }\n\n  /**\n   * Group results by search source\n   * @param results Search results from all sources\n   * @returns Search results grouped by source\n   */\n  private groupResults(results: SearchResult[]): {source: SearchSource; results: SearchResult[]}[] {\n    const grouped = new Map<SearchSource, SearchResult[]>();\n    results.forEach((result: SearchResult) => {\n      const source = result.source;\n      let sourceResults = grouped.get(source);\n      if (sourceResults === undefined) {\n        sourceResults = [];\n        grouped.set(source, sourceResults);\n      }\n      sourceResults.push(result);\n    });\n\n    return Array.from(grouped.keys()).map((source: SearchSource) => {\n      if (this.pageIterator[source.getId()] === undefined) {\n        this.pageIterator[source.getId()] = 1;\n      }\n      return {source, results: grouped.get(source)};\n    });\n  }\n\n  isMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\n    // getStrategyOfType is to avoid display more result based on a filtered state\n    const stategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n    const active = stategy?.active || false;\n    return !active && group.results &&\n      group.results[group.results.length - 1].meta.nextPage === true;\n  }\n\n  displayMoreResults(group: {source: SearchSource; results: SearchResult[]}) {\n    const options: TextSearchOptions = {\n      sourceId: group.source.getId(),\n      page: ++this.pageIterator[group.source.getId()]\n    };\n\n    let terms;\n    if (this.termSplitter && this.term.match(new RegExp(this.termSplitter, 'g'))) {\n      terms = this.term.split(this.termSplitter);\n    } else {\n      terms = [this.term];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      researches = researches.concat(this.searchService.search(term, options));\n    });\n\n    researches.map(research => {\n      research.request.subscribe((results: SearchResult[]) => {\n        const newResults = group.results.concat(results);\n        if (!results.length) {\n          newResults[newResults.length - 1].meta.nextPage = false;\n        }\n        this.moreResults.emit({research, results: newResults});\n      });\n    });\n    return;\n  }\n}\n","<button\nigoStopPropagation\n(mouseenter)=\"onMouseEvent($event)\" (mouseleave)=\"onMouseEvent($event)\"\n*ngIf=\"layer.meta.dataType === 'Layer'\"\nmat-icon-button\ntooltip-position=\"below\"\nmatTooltipShowDelay=\"500\"\n[matTooltip]=\"(tooltip$ | async) | translate\"\n[color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n(click)=\"onToggleClick($event)\">\n<mat-icon\n  matBadge=\"icon\"\n  igoMatBadgeIcon=\"eye-off\"\n  igoMatBadgeInverseColor=\"true\"\n  [matBadgeHidden]=\"(inRange$ | async)\"\n  matBadgeDisabled=\"true\"\n  matBadgeSize=\"small\"\n  matBadgePosition=\"after\"\n  [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\">\n</mat-icon>\n</button>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { SearchResult } from '../shared/search.interfaces';\nimport { IgoMap } from '../../map/shared/map';\nimport { LayerOptions } from '../../layer/shared/layers/layer.interface';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { LAYER } from '../../layer/shared/layer.enums';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'igo-search-add-button',\n  templateUrl: './search-results-add-button.component.html',\n  styleUrls: ['./search-results-add-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultAddButtonComponent implements OnInit, OnDestroy {\n  public tooltip$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.catalog.layer.addToMap'\n  );\n\n  private resolution$$: Subscription;\n\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  private layersSubcriptions = [];\n\n  private lastTimeoutRequest;\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() layer: SearchResult;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added: boolean;\n\n  /**\n   * The map to add the search result layer to\n   */\n  @Input() map: IgoMap;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(private layerService: LayerService) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit(): void {\n    if (this.layer.meta.dataType === 'Layer') {\n      this.added =\n        this.map.layers.findIndex(\n          lay => lay.id === this.layer.data.sourceOptions.id\n        ) !== -1;\n    }\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(value => {\n      this.isInResolutionsRange(value);\n      this.tooltip$.next(this.computeTooltip());\n    });\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n\n    if (event.type === 'mouseenter' && this.mouseInsideAdd ) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove();\n          } else {\n            this.add();\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add();\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove();\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  private add() {\n    if (!this.added) {\n      this.added = true;\n      this.addLayerToMap();\n    }\n  }\n\n  private remove() {\n    if (this.added) {\n      this.added = false;\n      this.removeLayerFromMap();\n      this.layersSubcriptions.map(s => s.unsubscribe());\n      this.layersSubcriptions = [];\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private addLayerToMap() {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const layerOptions = (this.layer as SearchResult<LayerOptions>).data;\n    if (layerOptions.sourceOptions.optionsFromApi === undefined) {\n      layerOptions.sourceOptions.optionsFromApi = true;\n    }\n    this.layersSubcriptions.push(\n      this.layerService\n        .createAsyncLayer(layerOptions)\n        .subscribe(layer => this.map.addLayer(layer))\n    );\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private removeLayerFromMap() {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\n    this.map.removeLayer(oLayer);\n  }\n\n  isInResolutionsRange(resolution: number) {\n    const minResolution = this.layer.data.minResolution || 0;\n    const maxResolution = this.layer.data.maxResolution || Infinity;\n    this.inRange$.next(\n      resolution >= minResolution && resolution <= maxResolution\n    );\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.removeFromMap'\n        : 'igo.geo.catalog.layer.removeFromMapOutRange';\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport {\n  IgoCollapsibleModule,\n  IgoListModule,\n  IgoMatBadgeIconModule,\n  IgoStopPropagationModule\n} from '@igo2/common';\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\nimport { SearchResultsComponent } from './search-results.component';\nimport { SearchResultsItemComponent } from './search-results-item.component';\nimport { SearchResultAddButtonComponent } from './search-results-add-button.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatListModule,\n    MatButtonModule,\n    IgoCollapsibleModule,\n    IgoListModule,\n    IgoStopPropagationModule,\n    IgoLanguageModule,\n    IgoMatBadgeIconModule,\n    IgoMetadataModule,\n  ],\n  exports: [\n    SearchResultsComponent,\n    SearchResultAddButtonComponent\n  ],\n  declarations: [\n    SearchResultsComponent,\n    SearchResultsItemComponent,\n    SearchResultAddButtonComponent\n  ]\n})\nexport class IgoSearchResultsModule {}\n","import { FeatureGeometry } from './../../feature/shared/feature.interfaces';\nimport {\n  Directive,\n  Input,\n  OnDestroy,\n  Self,\n  OnInit,\n  AfterContentChecked\n} from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { SearchService } from './search.service';\n\nimport olFeature from 'ol/Feature';\nimport { transform } from 'ol/proj';\nimport * as olstyle from 'ol/style';\nimport * as olgeom from 'ol/geom';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { SearchResult, Research } from './search.interfaces';\nimport { EntityStore } from '@igo2/common';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { take } from 'rxjs/operators';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureMotion, FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSourceService } from './search-source.service';\nimport { sourceCanReverseSearchAsSummary } from './search.utils';\nimport { MediaService } from '@igo2/core';\nimport { unByKey } from 'ol/Observable';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoSearchPointerSummary]'\n})\nexport class SearchPointerSummaryDirective implements OnInit, OnDestroy, AfterContentChecked {\n\n  public store: FeatureStore<Feature>;\n  private lonLat: [number, number];\n  private pointerSearchStore: EntityStore<SearchResult> = new EntityStore<SearchResult>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n  private reverseSearch$$: Subscription[] = [];\n  private hasPointerReverseSearchSource: boolean = false;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private searchPointerSummaryFeatureId: string = 'searchPointerSummaryFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoSearchPointerSummaryDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoSearchPointerSummaryEnabled: boolean = false;\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService\n  ) { }\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.listenToMapPointerMove();\n    this.subscribeToPointerStore();\n\n    this.map.status$.pipe(take(1)).subscribe(() => {\n      this.store = new FeatureStore<Feature>([], {map: this.map});\n      this.initStore();\n    });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      if (this.store && !layers.find(l => l.id === 'searchPointerSummaryId')) {\n        this.initStore();\n      }\n    });\n\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id : 'searchPointerSummaryId',\n      title: 'searchPointerSummary',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: pointerPositionSummaryMarker\n    });\n    tryBindStoreLayer(store, layer);\n  }\n\n  ngAfterContentChecked(): void {\n      if (!this.searchSourceService.getEnabledSources().filter(sourceCanReverseSearchAsSummary).length) {\n        this.hasPointerReverseSearchSource = false;\n      } else {\n        this.hasPointerReverseSearchSource = true;\n      }\n    }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unsubscribeReverseSearch();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerSearchStore.entities$.subscribe(resultsUnderPointerPosition => {\n      this.entitiesToPointerOverlay(resultsUnderPointerPosition);\n    });\n  }\n\n  /**\n   * Build an object based on the closest feature by type (base on type and distance properties )\n   * @param results SearchResult[]\n   * @returns OL style function\n   */\n  private computeSummaryClosestFeature(results: SearchResult[]): {} {\n    const closestResultByType = {};\n\n    results.map(result => {\n      if (result.data.properties.type && result.data.properties.distance >= 0) {\n        if (closestResultByType.hasOwnProperty(result.data.properties.type)) {\n          const prevDistance = closestResultByType[result.data.properties.type].distance;\n          if (result.data.properties.distance < prevDistance) {\n            const title = result.meta.pointerSummaryTitle || result.meta.title;\n            closestResultByType[result.data.properties.type] = { distance: result.data.properties.distance, title };\n          }\n        } else {\n          const title = result.meta.pointerSummaryTitle || result.meta.title;\n          closestResultByType[result.data.properties.type] = { distance: result.data.properties.distance, title };\n        }\n      }\n    });\n\n    return closestResultByType;\n  }\n\n  /**\n   * convert store entities to a pointer position overlay with label summary on.\n   * @param event OL map browser pointer event\n   */\n  private entitiesToPointerOverlay(resultsUnderPointerPosition: SearchResult[]) {\n    const closestResultByType = this.computeSummaryClosestFeature(resultsUnderPointerPosition);\n    const summarizedClosestType = Object.keys(closestResultByType);\n    const processedSummarizedClosestType = [];\n    const summary = [];\n    resultsUnderPointerPosition.map(result => {\n      const typeIndex = summarizedClosestType.indexOf(result.data.properties.type);\n      if (typeIndex !== -1) {\n        summary.push(closestResultByType[result.data.properties.type].title);\n        summarizedClosestType.splice(typeIndex, 1);\n        processedSummarizedClosestType.push(result.data.properties.type);\n      } else {\n        if (processedSummarizedClosestType.indexOf(result.data.properties.type) === -1) {\n          summary.push(result.meta.pointerSummaryTitle || result.meta.title);\n        }\n      }\n    });\n    if (summary.length) {\n      this.addPointerOverlay(summary.join('\\n'));\n    }\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n  /**\n   * Unsubscribe to reverse seatch store.\n   * @internal\n   */\n  unsubscribeReverseSearch() {\n    this.reverseSearch$$.map(s => s.unsubscribe());\n    this.reverseSearch$$ = [];\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Trigger reverse search when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    if (\n      event.dragging || !this.igoSearchPointerSummaryEnabled ||\n      !this.hasPointerReverseSearchSource || this.mediaService.isTouchScreen()) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n      this.clearLayer();\n      this.unsubscribeReverseSearch();\n    }\n\n    this.lonLat = transform(event.coordinate, this.mapProjection, 'EPSG:4326') as [number, number];\n\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.onSearchCoordinate();\n    }, this.igoSearchPointerSummaryDelay);\n  }\n\n    /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n     private sortByOrder(r1: SearchResult, r2: SearchResult) {\n      return r1.source.displayOrder - r2.source.displayOrder;\n    }\n\n  private onSearchCoordinate() {\n    this.pointerSearchStore.clear();\n    const results = this.searchService.reverseSearch(this.lonLat, { params: { geometry: 'false', icon: 'false' } }, true);\n\n    for (const i in results) {\n      if (results.length > 0) {\n        this.reverseSearch$$.push(\n          results[i].request.subscribe((_results: SearchResult<Feature>[]) => {\n            this.onSearch({ research: results[i], results: _results });\n          }));\n      }\n    }\n  }\n\n  private onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    const newResults = this.pointerSearchStore.all()\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n    this.pointerSearchStore.load(newResults.sort(this.sortByOrder));\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addPointerOverlay(text: string) {\n    this.clearLayer();\n\n    const geometry = new olgeom.Point(\n      transform(this.lonLat, 'EPSG:4326', this.mapProjection)\n    );\n    const feature = new olFeature({ geometry });\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.mapProjection,\n      dataProjection: this.mapProjection\n    }) as FeatureGeometry;\n\n    const f: Feature = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.mapProjection,\n      properties: {\n        id: this.searchPointerSummaryFeatureId,\n        pointerSummary: text\n      },\n      meta: {\n        id: this.searchPointerSummaryFeatureId\n      },\n      ol: feature\n    };\n    this.store.setLayerFeatures([f], FeatureMotion.None);\n  }\n\n/**\n * Clear the pointer store features\n */\nprivate clearLayer() {\n  if (this.store) {\n    this.store.clearLayer();\n  }\n}\n\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function pointerPositionSummaryMarker(feature: olFeature<OlGeometry>, resolution: number): olstyle.Style {\n  return new olstyle.Style({\n    image: new olstyle.Icon({\n      src: './assets/igo2/geo/icons/cross_black_18px.svg',\n      imgSize: [18, 18], // for ie\n    }),\n\n    text: new olstyle.Text({\n      text: feature.get('pointerSummary'),\n      textAlign: 'left',\n      textBaseline: 'bottom',\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      backgroundFill: new olstyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n      backgroundStroke: new olstyle.Stroke({ color: 'rgba(200, 200, 200, 0.75)', width: 2 }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true,\n      offsetX: 10,\n      offsetY: -10,\n      padding: [2.5, 2.5, 2.5, 2.5]\n    })\n  });\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { SearchService } from './shared/search.service';\nimport { provideSearchSourceService } from './shared/search-source-service.providers';\nimport { provideDefaultIChercheSearchResultFormatter } from './shared/sources/icherche.providers';\nimport { provideDefaultCoordinatesSearchResultFormatter } from './shared/sources/coordinates.providers';\nimport { provideILayerSearchResultFormatter } from './shared/sources/ilayer.providers';\n\nimport { IgoSearchBarModule } from './search-bar/search-bar.module';\nimport { IgoSearchSelectorModule } from './search-selector/search-selector.module';\nimport { IgoSearchResultsModule } from './search-results/search-results.module';\nimport { IgoSearchSettingsModule } from './search-settings/search-settings.module';\nimport { SearchPointerSummaryDirective } from './shared/search-pointer-summary.directive';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule\n  ],\n  exports: [\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule,\n    SearchPointerSummaryDirective\n  ],\n  declarations: [SearchPointerSummaryDirective]\n})\nexport class IgoSearchModule {\n  static forRoot(): ModuleWithProviders<IgoSearchModule> {\n    return {\n      ngModule: IgoSearchModule,\n      providers: [\n        SearchService,\n        provideSearchSourceService(),\n        provideDefaultIChercheSearchResultFormatter(),\n        provideDefaultCoordinatesSearchResultFormatter(),\n        provideILayerSearchResultFormatter()\n      ]\n    };\n  }\n}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { OnUpdateInputs, WidgetComponent } from '@igo2/common';\n\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { IgoMap } from '../../../map/shared/map';\n\n@Component({\n  selector: 'igo-ogc-filter',\n  templateUrl: './ogc-filter.component.html',\n  styleUrls: ['./ogc-filter.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterComponent implements OnUpdateInputs, WidgetComponent {\n\n  @Input() layer: Layer;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Event emitted on complete\n   */\n  @Output() complete = new EventEmitter<void>();\n\n  /**\n   * Event emitted on cancel\n   */\n  @Output() cancel = new EventEmitter<void>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Implemented as part of OnUpdateInputs\n   */\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * On close, emit the cancel event\n   */\n  onClose() {\n    this.cancel.emit();\n  }\n\n}\n","<igo-ogc-filterable-item\n  igoListItem\n  [layer]=\"layer\"\n  [header]=\"false\" \n  [map]=\"map\" >\n</igo-ogc-filterable-item>","import { InjectionToken } from '@angular/core';\n\nimport { Widget, WidgetService } from '@igo2/common';\n\nimport { OgcFilterComponent } from './ogc-filter/ogc-filter.component';\n\nexport const OgcFilterWidget = new InjectionToken<Widget>('OgcFilterWidget');\n\nexport function ogcFilterWidgetFactory(widgetService: WidgetService): Widget {\n  return widgetService.create(OgcFilterComponent);\n}\n\nexport function provideOgcFilterWidget() {\n  return {\n    provide: OgcFilterWidget,\n    useFactory: ogcFilterWidgetFactory,\n    deps: [WidgetService]\n  };\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoFilterModule } from '../../../filter/filter.module';\nimport { OgcFilterComponent } from './ogc-filter.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    IgoFilterModule\n  ],\n  exports: [OgcFilterComponent],\n  declarations: [OgcFilterComponent]\n})\nexport class IgoOgcFilterModule {}\n","import {\n  Workspace,\n  WorkspaceOptions\n} from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nexport interface WfsWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class WfsWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  constructor(protected options: WfsWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n\n  public getLayerWksOptionTabQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\n      return this.layer.options.workspace.queryOptions.tabQuery;\n    }\n    return true;\n  }\n\n  public getLayerWksOptionMapQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined) {\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\n    }\n    return true;\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport {\n  ActionStore,\n  EntityTableTemplate,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityRecord,\n  EntityStoreStrategyFuncOptions,\n  EntityStoreFilterSelectionStrategy,\n  EntityTableColumnRenderer\n} from '@igo2/common';\n\nimport {\n  FeatureStore,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureStoreInMapExtentStrategy,\n  Feature,\n  FeatureMotion,\n  FeatureStoreInMapResolutionStrategy\n} from '../../feature';\nimport { VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams, FeatureDataSource, RelationOptions } from '../../datasource';\nimport { getCommonVectorSelectedStyle} from '../../utils';\n\nimport { WfsWorkspace } from './wfs-workspace';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { StorageService, ConfigService } from '@igo2/core';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n@Injectable({\n  providedIn: 'root'\n})\nexport class WfsWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(private storageService: StorageService, private configService: ConfigService) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): WfsWorkspace {\n    if (layer.options.workspace?.enabled === false || layer.dataSource.options.edition) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace,\n      {\n        srcId: layer.id,\n        workspaceId: layer.id,\n        enabled: true\n      } as GeoWorkspaceOptions);\n\n    const wks = new WfsWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    this.createTableTemplate(wks, layer);\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], {map});\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle= this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(Object.assign({}, {feature}, confQueryOverlayStyle.selection || {}));\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: WfsWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n        .filter(\n          col => !col.startsWith('_') &&\n          col !== 'geometry' &&\n          col !== ol.getGeometryName() &&\n          !col.match(/boundedby/gi))\n        .map(key => {\n          return {\n            name: `properties.${key}`,\n            title: key,\n            renderer: EntityTableColumnRenderer.UnsanitizedHTML\n          };\n        });\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n        tooltip: field.tooltip\n      };\n    });\n\n    const relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n            this.ws$.next(relation.title);\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport {\n  ActionStore,\n  EntityRecord,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  EntityStoreStrategyFuncOptions,\n  EntityTableColumnRenderer,\n  EntityTableTemplate } from '@igo2/common';\nimport { StorageService, ConfigService } from '@igo2/core';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { RelationOptions, SourceFieldsOptionsParams, WMSDataSource } from '../../datasource';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy } from '../../feature';\n\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport { ImageLayer, LayerService, LayersLinkProperties, LinkedProperties, VectorLayer } from '../../layer';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { WfsWorkspace } from './wfs-workspace';\nimport { getCommonVectorSelectedStyle} from '../../utils';\n\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WmsWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(\n    private layerService: LayerService,\n    private storageService: StorageService,\n    private styleService: StyleService,\n    private configService: ConfigService) { }\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): WfsWorkspace {\n    if (\n      !layer.options.workspace ||\n      map.layers.find(lay => lay.id === layer.id + '.WfsWorkspaceTableDest') ||\n      layer.dataSource.options.edition) {\n      return;\n    }\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource ;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      bidirectionnal: true,\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [\n        LinkedProperties.ZINDEX,\n        LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n       linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if ((dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(JSON.stringify(layer.options.linkedLayers.links));\n    }\n    clonedLinks.push(linkProperties);\n\n    layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId ? layer.options.linkedLayers.linkId : wmsLinkId,\n      layer.options.linkedLayers.links = clonedLinks;\n    interface WFSoptions extends WFSDataSourceOptions, OgcFilterableDataSourceOptions { }\n\n    let wks;\n    let wksLayerOption = {\n      srcId: layer.id,\n      workspaceId: undefined,\n      enabled: false,\n      queryOptions: {\n        mapQueryOnOpenTab: layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n        tabQuery: layer.options.workspace?.queryOptions?.tabQuery\n      },\n      pageSize: layer.options.workspace?.pageSize,\n      pageSizeOptions: layer.options.workspace?.pageSizeOptions\n    };\n\n    this.layerService\n      .createAsyncLayer({\n        isIgoInternalLayer: true,\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: wksLayerOption,\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution: layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution: layer.options.workspace?.maxResolution || layer.maxResolution || Infinity,\n        style: this.styleService.createStyle(\n          {\n            fill: {\n              \"color\": \"rgba(255, 255, 255, 0.01)\"\n            },\n            stroke: {\n              \"color\": \"rgba(255, 255, 255, 0.01)\"\n            },\n            circle: {\n              fill: {\n                color: \"rgba(255, 255, 255, 0.01)\"\n              },\n              stroke: {\n                color: \"rgba(255, 255, 255, 0.01)\"\n              },\n              radius: 5\n            }\n          }),\n        sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          relations: dataSource.options.relations,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions).queryTitle,\n          queryFormatAsWms: layer.options.workspace?.enabled ? (dataSource.options as QueryableDataSourceOptions).queryFormatAsWms : true,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters$.value, {enabled: hasOgcFilters}),\n          sourceFields: dataSource.options.sourceFields || undefined\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties({ linkedLayers: { linkId: layer.options.linkedLayers.linkId, links: clonedLinks } }, false);\n        workspaceLayer.dataSource.ol.refresh();\n\n        if (!layer.options.workspace?.enabled) {\n          return;\n        }\n        wks = new WfsWorkspace({\n          id: layer.id,\n          title: layer.title,\n          layer: workspaceLayer,\n          map,\n          entityStore: this.createFeatureStore(workspaceLayer, map),\n          actionStore: new ActionStore([]),\n          meta: {\n            tableTemplate: undefined\n          }\n        });\n        this.createTableTemplate(wks, workspaceLayer);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace,\n          {\n            enabled: true,\n            srcId: layer.id,\n            workspaceId: workspaceLayer.id,\n            queryOptions: {\n              mapQueryOnOpenTab: layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n              tabQuery: layer.options.workspace?.queryOptions?.tabQuery\n            },\n            pageSize: layer.options.workspace?.pageSize,\n            pageSizeOptions: layer.options.workspace?.pageSizeOptions\n          } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle= this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(Object.assign({}, {feature}, confQueryOverlayStyle.selection || {}));\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: WfsWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n          .filter(\n            col => !col.startsWith('_') &&\n              col !== 'geometry' &&\n              col !== ol.getGeometryName() &&\n              !col.match(/boundedby/gi))\n          .map(key => {\n            return {\n              name: `properties.${key}`,\n              title: key,\n              renderer: EntityTableColumnRenderer.UnsanitizedHTML\n            };\n          });\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n        tooltip: field.tooltip\n      };\n    });\n\n    const relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n            this.ws$.next(relation.title);\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { LanguageService } from '@igo2/core';\nimport { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nexport interface DialogData {\n  type: string;\n  cancel: boolean;\n}\n\n@Component({\n    selector: 'igo-confirmation-popup-component',\n    templateUrl: './confirmation-popup.component.html',\n    styleUrls: ['./confirmation-popup.component.scss']\n  })\n  export class ConfirmationPopupComponent {\n\n    constructor(\n      public dialogRef: MatDialogRef<ConfirmationPopupComponent>,\n      public languageService: LanguageService,\n      @Inject(MAT_DIALOG_DATA) public data: {type: string, cancel: boolean}) {}\n\n    cancelAction() {\n      this.data.cancel = true;\n      this.dialogRef.close(this.data.cancel);\n    }\n\n    confirmedAction() {\n      this.data.cancel = false;\n      this.dialogRef.close(this.data.cancel);\n    }\n  }\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">{{data.type === 'add' ?\n    languageService.translate.instant('igo.geo.workspace.addConfirmation') :\n    languageService.translate.instant('igo.geo.workspace.deleteConfirmation')}}</p>\n</div>\n<div mat-dialog-actions>\n  <button\n    mat-raised-button\n    color=\"primary\"\n    (click)=\"confirmedAction()\">Ok\n  </button>\n  <button\n    mat-raised-button\n    (click)=\"cancelAction()\">{{languageService.translate.instant('igo.geo.workspace.cancel')}}\n  </button>\n</div>","import { MatDialog } from '@angular/material/dialog';\nimport {\n  Workspace,\n  WorkspaceOptions,\n  EntityRecord\n} from '@igo2/common';\nimport { ConfigService } from '@igo2/core';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { ImageLayer, VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\nimport { EditionWorkspaceService } from './edition-workspace.service';\nimport { ConfirmationPopupComponent } from '../confirmation-popup/confirmation-popup.component';\nimport { DrawControl } from '../../geometry';\nimport { createInteractionStyle, GeometryType } from '../../draw';\nimport { featureToOl } from '../../feature';\n\nimport type { default as OlGeometryType } from 'ol/geom/GeometryType';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlVectorSource from 'ol/source/Vector';\nimport * as OlStyle from 'ol/style';\nimport OlModify from 'ol/interaction/Modify';\nimport Collection from 'ol/Collection';\nimport OlFeature from 'ol/Feature';\nimport { FeatureDataSource } from '../../datasource/shared';\n\nexport interface EditionWorkspaceOptions extends WorkspaceOptions {\n  layer: ImageLayer | VectorLayer;\n  map: IgoMap;\n}\n\nexport class EditionWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): ImageLayer | VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  private drawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private olDrawingLayerSource = new OlVectorSource();\n  private olDrawingLayer: VectorLayer;\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n  public modify; // Reference to the ol interaction\n\n  public modifyStyle = new OlStyle.Style({\n    stroke: new OlStyle.Stroke({\n      color: 'rgba(255,255,255,1)',\n      width: 1\n    }),\n    fill: new OlStyle.Fill({\n      color: 'rgba(0,161,222,1)'\n    }),\n    image: new OlStyle.Circle({\n      radius: 7,\n      stroke: new OlStyle.Stroke({\n        color: 'rgba(255,255,255,1)',\n        width: 1\n      }),\n      fill: new OlStyle.Fill({\n        color: 'rgba(0,161,222,1)'\n      })\n    })\n  });\n\n  private newFeaturefilterClauseFunc = (record: EntityRecord<object>) => {\n    return record.state.newFeature === true;\n  };\n\n  private editFeaturefilterClauseFunc = (record: EntityRecord<object>) => {\n    return record.state.edit === true;\n  };\n\n  public fillColor: string;\n  public strokeColor: string;\n  public strokeWidth: number;\n\n  constructor(\n    protected options: EditionWorkspaceOptions,\n    private editionWorkspaceService: EditionWorkspaceService,\n    private dialog: MatDialog,\n    private configService: ConfigService) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n\n    this.drawControl = this.createDrawControl();\n    this.drawControl.setGeometryType(this.geometryType.Point as any);\n\n    this.map.removeLayer(this.olDrawingLayer);\n\n    this.olDrawingLayer = new VectorLayer({\n      id: 'igo-draw-layer',\n      title: 'edition',\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      workspace: {\n        enabled: false\n      },\n    });\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n\n  deleteFeature(feature, workspace) {\n    setTimeout(() => {\n      const dialogRef = this.dialog.open(ConfirmationPopupComponent, {\n        disableClose: false,\n        data: {type: 'delete'}\n    });\n\n      dialogRef.afterClosed().subscribe(result => {\n        if (result === false) {\n          const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\n          const deleteUrl = workspace.layer.dataSource.options.edition.deleteUrl;\n          let id;\n          let url;\n          if (baseUrl) {\n            url = this.configService.getConfig('edition.url') + baseUrl + '?' + deleteUrl;\n          } else {\n            url = this.configService.getConfig('edition.url') + deleteUrl;\n          }\n\n          for (const column of workspace.meta.tableTemplate.columns) {\n            for (const property in feature.properties) {\n              let columnName = column.name;\n              if (columnName.includes('properties.')) {\n                columnName = columnName.split('.')[1];\n              }\n              if (columnName === property && column.primary === true) {\n                id = feature.properties[property];\n              }\n            }\n          }\n          if (url) {\n            url += id;\n            this.editionWorkspaceService.deleteFeature(workspace, url);\n          }\n        }\n      });\n    }, 250);\n  }\n\n  editFeature(feature, workspace: EditionWorkspace) {\n    feature.edition = true;\n    let id;\n    let find = false;\n    const editionOpt = workspace.layer.dataSource.options.edition;\n    for (const column of workspace.meta.tableTemplate.columns ) {\n\n      // Update domain list\n      if (column.type === 'list' || column.type === 'autocomplete') {\n        this.editionWorkspaceService.getDomainValues(column.relation).subscribe(result => {\n          column.domainValues = result;\n        });\n      }\n      if (find === false) {\n        for (const property in feature.properties) {\n          let columnName = column.name;\n          if (columnName.includes('properties.')) {\n            columnName = columnName.split('.')[1];\n          }\n          if (columnName === property && column.primary === true) {\n            id = feature.properties[property];\n            find = true;\n            break;\n          }\n        }\n      }\n    }\n    if (id) {\n      feature.original_properties = JSON.parse(JSON.stringify(feature.properties));\n      feature.original_geometry = feature.geometry;\n      feature.idkey = id;\n      workspace.entityStore.state.updateAll({ edit: false });\n      workspace.entityStore.stateView.filter(this.editFeaturefilterClauseFunc);\n      this.addFeatureToStore(feature, workspace);\n    } else {\n      // Only for edition with it's own geometry\n      if (!feature.newFeature && editionOpt.geomType) {\n        feature.newFeature = true;\n        this.editionWorkspaceService.adding$.next(true);\n        workspace.entityStore.state.updateAll({ newFeature: false });\n        workspace.entityStore.stateView.filter(this.newFeaturefilterClauseFunc);\n        if (editionOpt.addWithDraw) {\n          const geometryType = editionOpt.geomType;\n          this.onGeometryTypeChange(geometryType, feature, workspace);\n        } else {\n          workspace.entityStore.insert(feature);\n          workspace.entityStore.state.update(feature, { newFeature: true }, true);\n        }\n      }\n    }\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(fillColor?: string, strokeColor?: string, strokeWidth?: number) {\n    const drawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.olDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(fillColor, strokeColor, strokeWidth),\n    });\n\n    return drawControl;\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(geometryType: typeof OlGeometryType, feature, workspace: EditionWorkspace) {\n      this.drawControl.setGeometryType(geometryType);\n      this.toggleDrawControl(feature, workspace);\n    }\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl(feature, workspace: EditionWorkspace) {\n    this.deactivateDrawControl();\n    this.activateDrawControl(feature, workspace);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  public deactivateDrawControl() {\n    if (!this.drawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.drawControl.setOlMap(undefined);\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl(feature, workspace: EditionWorkspace) {\n    this.drawEnd$$ = this.drawControl.end$.subscribe((olGeometry: OlGeometry) => {\n      this.addFeatureToStore(feature, workspace, olGeometry);\n    });\n\n    this.drawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * Add a feature to layer. The loading strategy of the layer\n   * will trigger and add the feature to the workspace store.\n   * @internal\n   */\n  private addFeatureToStore(feature, workspace: EditionWorkspace, olGeometry?: OlGeometry) {\n    const projection = this.map.ol.getView().getProjection();\n    let geometry = feature.geometry;\n\n    // If an olGeometry is passed, it means that it is a new feature\n    if (olGeometry) {\n      workspace.entityStore.insert(feature);\n      workspace.entityStore.state.update(feature, { newFeature: true }, true);\n      geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n        featureProjection: projection,\n        dataProjection: 'EPSG:4326'\n      }) as any;\n\n      feature.geometry = geometry;\n    } else {\n      workspace.entityStore.state.update(feature, { edit: true }, true);\n    }\n\n    feature.projection = 'EPSG:4326';\n\n    const featureOl = featureToOl(feature, projection.getCode());\n\n    this.olDrawingLayer.dataSource.ol.clear();\n    this.olDrawingLayer.dataSource.ol.addFeature(featureOl);\n    this.map.addLayer(this.olDrawingLayer);\n\n    this.deactivateDrawControl();\n    this.createModifyInteraction(featureOl, feature, workspace);\n  }\n\n  /**\n   * Delete drawings layer and source from the map AND feature from the entity store.\n   * Layer refresh will automatically add the new feature into the store.\n   */\n  deleteDrawings() {\n    this.map.removeLayer(this.olDrawingLayer);\n    this.olDrawingLayerSource.clear();\n    this.map.ol.removeInteraction(this.modify);\n  }\n\n  /**\n   * Create a modify interaction to allow a geometry change one feature at the time (drag and drop)\n   */\n  createModifyInteraction(olFeature: OlFeature<OlGeometry>, feature, workspace: EditionWorkspace) {\n    this.map.ol.removeInteraction(this.modify);\n    const olCollection = new Collection([olFeature], { unique: true });\n    this.modify = new OlModify({\n      features: olCollection\n    });\n\n    this.map.ol.addInteraction(this.modify);\n    olCollection.forEach(feature => {\n      feature.setStyle(this.modifyStyle);\n    });\n\n    this.modify.on('modifyend', (event) => {\n      const olGeometry = event.features.getArray()[0]?.getGeometry();\n      if (olGeometry) {\n        this.addFeatureToStore(feature, workspace, olGeometry);\n      }\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse, HttpHeaders } from '@angular/common/http';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport {\n  ActionStore,\n  EntityRecord,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  EntityStoreStrategyFuncOptions,\n  EntityTableColumnRenderer,\n  EntityTableTemplate,\n  EntityTableButton} from '@igo2/common';\nimport { ConfigService, LanguageService, MessageService, StorageService } from '@igo2/core';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { catchError, map, skipWhile, take } from 'rxjs/operators';\nimport { RelationOptions, SourceFieldsOptionsParams, WMSDataSource } from '../../datasource';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy} from '../../feature';\n\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport { ImageLayer, LayerService, LayersLinkProperties, LinkedProperties, VectorLayer } from '../../layer';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { EditionWorkspace } from './edition-workspace';\n\nimport olFeature from 'ol/Feature';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { BehaviorSubject, Observable, throwError } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EditionWorkspaceService {\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n  public adding$ = new BehaviorSubject<boolean>(false);\n  public relationLayers$ = new BehaviorSubject<ImageLayer[] | VectorLayer[]>(undefined);\n  public rowsInMapExtentCheckCondition$ = new BehaviorSubject<boolean>(true);\n  public loading = false;\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    private layerService: LayerService,\n    private storageService: StorageService,\n    private configService: ConfigService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private http: HttpClient,\n    private dialog: MatDialog,\n    private styleService: StyleService,\n    public authInterceptor?: AuthInterceptor) { }\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): EditionWorkspace {\n    if (layer.options.workspace?.enabled !== true || layer.dataSource.options.edition.enabled !== true) {\n      return;\n    }\n    let wksConfig;\n    if (layer.options.workspace) {\n      wksConfig = layer.options.workspace;\n    } else {\n      wksConfig = {};\n    }\n    wksConfig.srcId = layer.id;\n    wksConfig.workspaceId = layer.id;\n    wksConfig.enabled = true;\n    wksConfig.pageSize = layer.options.workspace?.pageSize;\n    wksConfig.pageSizeOptions = layer.options.workspace?.pageSizeOptions;\n\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource ;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      bidirectionnal: true,\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [\n        LinkedProperties.ZINDEX,\n        LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n       linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if ((dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(JSON.stringify(layer.options.linkedLayers.links));\n    }\n    clonedLinks.push(linkProperties);\n\n    layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId ? layer.options.linkedLayers.linkId : wmsLinkId,\n      layer.options.linkedLayers.links = clonedLinks;\n    interface WFSoptions extends WFSDataSourceOptions, OgcFilterableDataSourceOptions { }\n    let wks;\n    this.layerService\n      .createAsyncLayer({\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: {\n          srcId: layer.id,\n          workspaceId: undefined,\n          enabled: false,\n          queryOptions: {\n            mapQueryOnOpenTab: layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n            tabQuery: false\n          },\n          pageSize: layer.options.workspace?.pageSize,\n          pageSizeOptions: layer.options.workspace?.pageSizeOptions\n        },\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution: layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution: layer.options.workspace?.maxResolution || layer.maxResolution || Infinity,\n        style: this.styleService.createStyle(\n          {\n            fill: {\n              \"color\": \"rgba(255, 255, 255, 0.01)\"\n            },\n            stroke: {\n              \"color\": \"rgba(255, 255, 255, 0.01)\"\n            },\n            circle: {\n              fill: {\n                color: \"rgba(255, 255, 255, 0.01)\"\n              },\n              stroke: {\n                color: \"rgba(255, 255, 255, 0.01)\"\n              },\n              radius: 5\n            }\n          }),\n          sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          relations: dataSource.options.relations,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions).queryTitle,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters$.value, {enabled: hasOgcFilters}),\n          sourceFields: dataSource.options.sourceFields || undefined,\n          edition: dataSource.options.edition\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties({ linkedLayers: { linkId: layer.options.linkedLayers.linkId, links: clonedLinks } }, false);\n        workspaceLayer.dataSource.ol.refresh();\n\n        wks = new EditionWorkspace({\n          id: layer.id,\n          title: layer.title,\n          layer: workspaceLayer,\n          map,\n          entityStore: this.createFeatureStore(workspaceLayer, map),\n          actionStore: new ActionStore([]),\n          meta: {\n            tableTemplate: undefined\n          }\n        }, this, this.dialog, this.configService);\n        this.createTableTemplate(wks, workspaceLayer);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace,\n          {\n            wksConfig\n          } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: EditionWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    let rendererType = EntityTableColumnRenderer.UnsanitizedHTML;\n    let buttons = [];\n    let columns = [];\n    let relationsColumn = [];\n\n    buttons = [{\n      name: 'edition',\n      title: undefined,\n      renderer: EntityTableColumnRenderer.ButtonGroup,\n      primary: false,\n      valueAccessor: () => {\n        return [{\n          editMode: false,\n          icon: 'pencil',\n          color: 'primary',\n          disabled: layer.dataSource.options.edition.modifyButton === false ? true : false,\n          click: (feature) => { workspace.editFeature(feature, workspace); }\n        },\n        {\n          editMode: false,\n          icon: 'delete',\n          color: 'warn',\n          disabled: layer.dataSource.options.edition.deleteButton === false ? true : false,\n          click: (feature) => { workspace.deleteFeature(feature, workspace); }\n        },\n        {\n          editMode: true,\n          icon: 'check',\n          color: 'primary',\n          disabled: this.loading,\n          click: (feature) => { this.saveFeature(feature, workspace); }\n        },\n        {\n          editMode: true,\n          icon: 'alpha-x',\n          color: 'primary',\n          disabled: this.loading,\n          click: (feature) => { this.cancelEdit(workspace, feature); }\n        }] as EntityTableButton[];\n      }\n    }];\n\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n          .filter(\n            col => !col.startsWith('_') &&\n              col !== 'geometry' &&\n              col !== ol.getGeometryName() &&\n              !col.match(/boundedby/gi))\n          .map(key => {\n            return {\n              name: `properties.${key}`,\n              title: key,\n              renderer: rendererType,\n            };\n          });\n        workspace.meta.tableTemplate = {\n          selection: false,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n\n    columns = fields.map((field: SourceFieldsOptionsParams) => {\n\n      let column = {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: rendererType,\n        valueAccessor: undefined,\n        cellClassFunc: () => {\n          const cellClass = {};\n          if (field.type) {\n            cellClass[`class_${field.type}`] = true;\n            return cellClass;\n          }\n        },\n        primary: field.primary === true ? true : false,\n        visible: field.visible,\n        validation: field.validation,\n        linkColumnForce: field.linkColumnForce,\n        type: field.type,\n        domainValues: undefined,\n        relation: undefined,\n        multiple: field.multiple,\n        step: field.step,\n        tooltip: field.tooltip\n      };\n\n      if (field.type === 'list' || field.type === 'autocomplete') {\n        this.getDomainValues(field.relation).subscribe(result => {\n          column.domainValues = result;\n          column.relation = field.relation;\n        });\n      }\n      return column;\n    });\n\n    relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n          if (this.adding$.getValue() === false) {\n            this.ws$.next(relation.title);\n          }\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    columns.push(...buttons);\n\n    workspace.meta.tableTemplate = {\n      selection: false,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n\n  public saveFeature(feature, workspace: EditionWorkspace) {\n    if (!this.validateFeature(feature, workspace)){\n      return false;\n    }\n\n    this.sanitizeParameter(feature, workspace);\n\n    let url = this.configService.getConfig('edition.url');\n\n    if (workspace.layer.dataSource.options.edition.baseUrl) {\n      url += workspace.layer.dataSource.options.edition.baseUrl;\n    }\n\n    if (feature.newFeature) {\n      url += workspace.layer.dataSource.options.edition.addUrl;\n\n      const addHeaders = workspace.layer.dataSource.options.edition.addHeaders;\n      const headers = new HttpHeaders(addHeaders);\n\n      this.addFeature(feature, workspace, url, headers);\n    } else {\n      if (workspace.layer.dataSource.options.edition.modifyProtocol !== \"post\") {\n        url += '?' + workspace.layer.dataSource.options.edition.modifyUrl + feature.idkey;\n      }\n      else {\n        url += workspace.layer.dataSource.options.edition.modifyUrl;\n      }\n\n      const protocole = workspace.layer.dataSource.options.edition.modifyProtocol;\n      const modifyHeaders = workspace.layer.dataSource.options.edition.modifyHeaders;\n      const headers = new HttpHeaders(modifyHeaders);\n\n      this.modifyFeature(feature, workspace, url, headers, protocole);\n    }\n  }\n\n  public addFeature(feature, workspace: EditionWorkspace, url: string, headers: {[key: string]: any}) {\n    // TODO: adapt to any kind of geometry\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\n      //feature.properties[geom] = feature.geometry;\n      feature.properties[\"longitude\"] = feature.geometry.coordinates[0];\n      feature.properties[\"latitude\"] = feature.geometry.coordinates[1];\n    }\n\n    for (const property in feature.properties) {\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\n        if ((sf.name === property && sf.validation?.readonly) || (sf.name === property && sf.validation?.send === false)) {\n          delete feature.properties[property];\n        }\n      }\n    }\n\n    this.loading = true;\n    this.http.post(`${url}`, feature.properties, { headers: headers }).subscribe(\n      () => {\n        this.loading = false;\n        workspace.entityStore.stateView.clear();\n        workspace.deleteDrawings();\n        workspace.entityStore.delete(feature);\n\n        const message = this.languageService.translate.instant(\n          'igo.geo.workspace.addSuccess'\n        );\n        this.messageService.success(message);\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n        this.adding$.next(false);\n        this.rowsInMapExtentCheckCondition$.next(true);\n      },\n      error => {\n        this.loading = false;\n        error.error.caught = true;\n        const genericErrorMessage = this.languageService.translate.instant(\n          'igo.geo.workspace.addError'\n        );\n        const messages = workspace.layer.dataSource.options.edition.messages;\n        if (messages) {\n          let text;\n          messages.forEach(message => {\n            const key = Object.keys(message)[0];\n            if (error.error.message.includes(key)) {\n              text = message[key];\n              this.messageService.error(text);\n            }\n          });\n          if (!text) {\n            this.messageService.error(genericErrorMessage);\n          }\n        } else {\n          this.messageService.error(genericErrorMessage);\n        }\n      }\n    );\n  }\n\n  public deleteFeature(workspace: EditionWorkspace, url: string) {\n    this.loading = true;\n    this.http.delete(`${url}`, {}).subscribe(\n      () => {\n        this.loading = false;\n        const message = this.languageService.translate.instant(\n          'igo.geo.workspace.deleteSuccess'\n        );\n        this.messageService.success(message);\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n        for (const relation of workspace.layer.options.sourceOptions.relations) {\n          workspace.map.layers.forEach((layer) => {\n            if (layer.title === relation.title) {\n              layer.dataSource.ol.refresh();\n            }\n          });\n        }\n      },\n      error => {\n        this.loading = false;\n        error.error.caught = true;\n          const genericErrorMessage = this.languageService.translate.instant(\n            'igo.geo.workspace.addError'\n          );\n          const messages = workspace.layer.dataSource.options.edition.messages;\n          if (messages) {\n            let text;\n            messages.forEach(message => {\n              const key = Object.keys(message)[0];\n              if (error.error.message.includes(key)) {\n                text = message[key];\n                this.messageService.error(text);\n              }\n            });\n            if (!text) {\n              this.messageService.error(genericErrorMessage);\n            }\n          } else {\n            this.messageService.error(genericErrorMessage);\n          }\n      }\n    );\n  }\n\n  public modifyFeature(feature, workspace: EditionWorkspace, url: string, headers: {[key: string]: any}, protocole = 'patch' ) {\n    //TODO: adapt to any kind of geometry\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\n      //feature.properties[geom] = feature.geometry;\n      feature.properties[\"longitude\"] = feature.geometry.coordinates[0];\n      feature.properties[\"latitude\"] = feature.geometry.coordinates[1];\n    }\n\n    for (const property in feature.properties) {\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\n        if ((sf.name === property && sf.validation?.readonly) || (sf.name === property && sf.validation?.send === false)\n          || property === 'boundedBy') {\n          delete feature.properties[property];\n        }\n      }\n    }\n\n    this.loading = true;\n    this.http[protocole](`${url}`, feature.properties, { headers: headers }).subscribe(\n      () => {\n        this.loading = false;\n        this.cancelEdit(workspace, feature, true);\n\n        const message = this.languageService.translate.instant(\n          'igo.geo.workspace.modifySuccess'\n        );\n        this.messageService.success(message);\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n\n        let relationLayers = [];\n        for (const relation of workspace.layer.options.sourceOptions.relations) {\n          workspace.map.layers.forEach((layer) => {\n            if (layer.title === relation.title) {\n              relationLayers.push(layer);\n              layer.dataSource.ol.refresh();\n            }\n          });\n        }\n        this.relationLayers$.next(relationLayers);\n      },\n      error => {\n        this.loading = false;\n        error.error.caught = true;\n        const genericErrorMessage = this.languageService.translate.instant(\n          'igo.geo.workspace.addError'\n        );\n        const messages = workspace.layer.dataSource.options.edition.messages;\n        if (messages) {\n          let text;\n          messages.forEach(message => {\n            const key = Object.keys(message)[0];\n            if (error.error.message.includes(key)) {\n              text = message[key];\n              this.messageService.error(text);\n            }\n          });\n          if (!text) {\n            this.messageService.error(genericErrorMessage);\n          }\n        } else {\n          this.messageService.error(genericErrorMessage);\n        }\n      }\n    );\n  }\n\n  cancelEdit(workspace: EditionWorkspace, feature, fromSave = false) {\n    feature.edition = false;\n    this.adding$.next(false);\n    workspace.deleteDrawings();\n    workspace.entityStore.stateView.clear();\n\n    if (feature.newFeature) {\n      workspace.entityStore.delete(feature);\n      workspace.deactivateDrawControl();\n\n      this.rowsInMapExtentCheckCondition$.next(true);\n    } else {\n      if (!fromSave) {\n        feature.properties = feature.original_properties;\n        feature.geometry = feature.original_geometry;\n      }\n      delete feature.original_properties;\n      delete feature.original_geometry;\n    }\n  }\n\n  getDomainValues(relation: RelationOptions): Observable<any> {\n    let url = relation.url;\n    if (!url) {\n      url = this.configService.getConfig('edition.url') + relation.table;\n    }\n\n    return this.http.get<any>(url).pipe(\n      map(result => {\n        return result;\n      }),\n      catchError((err: HttpErrorResponse) => {\n        err.error.caught = true;\n        return throwError(err);\n      })\n    );\n  }\n\n  /*\n   * Refresh both wms and wfs layer\n   * A new wfs loader is used to ensure cache is not retrieving old data\n   * WMS params are updated to ensure layer is correctly refreshed\n   */\n  refreshMap(layer: VectorLayer, map: IgoMap) {\n    const wfsOlLayer = layer.dataSource.ol;\n    const loader = (extent, resolution, proj, success, failure) => {\n      layer.customWFSLoader(\n        layer.ol.getSource(),\n        layer.options.sourceOptions,\n        this.authInterceptor,\n        extent,\n        resolution,\n        proj,\n        success,\n        failure,\n        true\n      );\n    };\n    wfsOlLayer.setLoader(loader);\n    wfsOlLayer.refresh();\n\n    for (const lay of map.layers) {\n      if (\n        lay.id !== layer.id &&\n        lay.options.linkedLayers?.linkId.includes(layer.id.substr(0, layer.id.indexOf('.') - 1)) &&\n        lay.options.linkedLayers?.linkId.includes('WmsWorkspaceTableSrc')\n      )\n        {\n          const wmsOlLayer = lay.dataSource.ol as olSourceImageWMS;\n          let params = wmsOlLayer.getParams();\n          params._t = new Date().getTime();\n          wmsOlLayer.updateParams(params);\n        }\n    }\n  }\n\n  validateFeature(feature, workspace: EditionWorkspace) {\n    const translate = this.languageService.translate;\n    let message ;\n    let key;\n    let valid = true;\n    workspace.meta.tableTemplate.columns.forEach(column => {\n      if (column.hasOwnProperty('validation') && column.validation) {\n        key = getColumnKeyWithoutPropertiesTag(column.name);\n        Object.keys( column.validation).forEach((type) => {\n          switch (type) {\n            case 'mandatory': {\n              if (column.validation[type] && (!feature.properties.hasOwnProperty(key) || !feature.properties[key])) {\n                valid = false;\n                  message = translate.instant('igo.geo.formValidation.mandatory',\n                  {\n                    column: column.title\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            case 'minValue': {\n              if (feature.properties.hasOwnProperty(key) && feature.properties[key] && feature.properties[key] < column.validation[type]) {\n                valid = false;\n                message = translate.instant('igo.geo.formValidation.minValue',\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            case 'maxValue': {\n              if (feature.properties.hasOwnProperty(key) && feature.properties[key] && feature.properties[key] > column.validation[type]) {\n                valid = false;\n                message = translate.instant('igo.geo.formValidation.maxValue',\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            case 'minLength': {\n              if (\n                feature.properties.hasOwnProperty(key) && feature.properties[key] &&\n                feature.properties[key].length < column.validation[type])\n              {\n                valid = false;\n                message = translate.instant('igo.geo.formValidation.minLength',\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            case 'maxLength': {\n              if (\n                feature.properties.hasOwnProperty(key) && feature.properties[key] &&\n                feature.properties[key].length > column.validation[type])\n              {\n                valid = false;\n                message = translate.instant('igo.geo.formValidation.maxLength',\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            }\n          });\n      }\n    });\n    return valid;\n  }\n\n  sanitizeParameter(feature, workspace: EditionWorkspace) {\n    workspace.meta.tableTemplate.columns.forEach(column => {\n      if (column.type === 'list' && feature.properties[getColumnKeyWithoutPropertiesTag(column.name)]) {\n        feature.properties[getColumnKeyWithoutPropertiesTag(column.name)] =\n          feature.properties[getColumnKeyWithoutPropertiesTag(column.name)].toString();\n      }\n\n    });\n  }\n\n}\n\nfunction getColumnKeyWithoutPropertiesTag(column: string) {\n  if (column.includes('properties.')) {\n    return column.split('.')[1];\n  }\n  return column;\n}\n","import {\n  Workspace,\n  WorkspaceOptions\n} from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nexport interface FeatureWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class FeatureWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  constructor(protected options: FeatureWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n\n  public getLayerWksOptionTabQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\n      return this.layer.options.workspace.queryOptions.tabQuery;\n    }\n    return true;\n  }\n\n  public getLayerWksOptionMapQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined) {\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\n    }\n    return true;\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport {\n  ActionStore,\n  EntityTableTemplate,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityRecord,\n  EntityStoreStrategyFuncOptions,\n  EntityStoreFilterSelectionStrategy,\n  EntityTableColumnRenderer\n} from '@igo2/common';\n\nimport {\n  FeatureStore,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureStoreInMapExtentStrategy,\n  Feature,\n  FeatureMotion,\n  FeatureStoreInMapResolutionStrategy\n} from '../../feature';\nimport { VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams, FeatureDataSource, RelationOptions } from '../../datasource';\nimport { getCommonVectorSelectedStyle} from '../../utils';\n\nimport { FeatureWorkspace } from './feature-workspace';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { ConfigService, StorageService } from '@igo2/core';\n\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FeatureWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(private storageService: StorageService, private configService: ConfigService) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): FeatureWorkspace {\n    if (layer.options.workspace?.enabled === false || layer.dataSource.options.edition) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace,\n      {\n        srcId: layer.id,\n        workspaceId: layer.id,\n        enabled: true\n      } as GeoWorkspaceOptions);\n\n\n    const wks = new FeatureWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    this.createTableTemplate(wks, layer);\n    return wks;\n\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], {map});\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle= this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(Object.assign({}, {feature}, confQueryOverlayStyle.selection || {}));\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: FeatureWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n        .filter(\n          col => !col.startsWith('_') &&\n          col !== 'geometry' &&\n          col !== ol.getGeometryName() &&\n          !col.match(/boundedby/gi))\n        .map(key => {\n          return {\n            name: `properties.${key}`,\n            title: key,\n            renderer: EntityTableColumnRenderer.UnsanitizedHTML\n          };\n        });\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n        tooltip: field.tooltip\n      };\n    });\n\n    const relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n            this.ws$.next(relation.title);\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { Directive, Input, OnInit, OnDestroy, Output, EventEmitter } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { Workspace, WorkspaceStore, WorkspaceSelectorComponent } from '@igo2/common';\n\nimport { Layer, ImageLayer, VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\nimport { WFSDataSource, WMSDataSource, FeatureDataSource } from '../../datasource';\nimport { OgcFilterableDataSourceOptions } from '../../filter';\n\nimport { WfsWorkspaceService } from '../shared/wfs-workspace.service';\nimport { WmsWorkspaceService } from '../shared/wms-workspace.service';\nimport { EditionWorkspaceService } from '../shared/edition-workspace.service';\nimport { FeatureWorkspaceService } from '../shared/feature-workspace.service';\nimport { FeatureStoreInMapExtentStrategy } from '../../feature/shared/strategies/in-map-extent';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\n\n@Directive({\n  selector: '[igoWorkspaceSelector]'\n})\nexport class WorkspaceSelectorDirective implements OnInit, OnDestroy {\n\n  private layers$$: Subscription;\n  private entities$$: Subscription[] = [];\n\n  @Input() map: IgoMap;\n\n  @Output() changeWorkspace = new EventEmitter<string>();\n  @Output() disableSwitch = new EventEmitter<boolean>();\n  @Output() relationLayers = new EventEmitter<ImageLayer[] | VectorLayer[]>();\n  @Output() rowsInMapExtentCheckCondition = new EventEmitter<boolean>();\n\n  get workspaceStore(): WorkspaceStore {\n    return this.component.store;\n  }\n\n  constructor(\n    private component: WorkspaceSelectorComponent,\n    private wfsWorkspaceService: WfsWorkspaceService,\n    private wmsWorkspaceService: WmsWorkspaceService,\n    private editionWorkspaceService: EditionWorkspaceService,\n    private featureWorkspaceService: FeatureWorkspaceService\n  ) {}\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$\n      .pipe(debounceTime(50))\n      .subscribe((layers: Layer[]) =>\n        this.onLayersChange(layers)\n      );\n\n    this.featureWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.wmsWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.wfsWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.editionWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.editionWorkspaceService.adding$.subscribe((adding) => { this.disableSwitch.emit(adding); });\n    this.editionWorkspaceService.relationLayers$.subscribe((layers) => { this.relationLayers.emit(layers); });\n    this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe((condition) => {\n      this.rowsInMapExtentCheckCondition.emit(condition);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.entities$$.map(entities => entities.unsubscribe());\n  }\n\n  private onLayersChange(layers: Layer[]) {\n    const editableLayers = layers.filter((layer: Layer) =>\n      this.layerIsEditable(layer)\n    );\n    const editableLayersIds = editableLayers.map((layer: Layer) => layer.id);\n\n    const workspacesToAdd = editableLayers\n      .map((layer: VectorLayer) => this.getOrCreateWorkspace(layer))\n      .filter((workspace: Workspace | undefined) => workspace !== undefined);\n\n    const workspacesToRemove = this.workspaceStore.all()\n      .filter((workspace: Workspace) => {\n        return editableLayersIds.indexOf(workspace.id) < 0;\n      });\n\n    if (workspacesToRemove.length > 0) {\n      workspacesToRemove.forEach((workspace: Workspace) => {\n        workspace.entityStore.deactivateStrategyOfType(FeatureStoreInMapExtentStrategy);\n        workspace.deactivate();\n      });\n      this.workspaceStore.state.updateMany(workspacesToRemove, {active: false, selected: false});\n      this.workspaceStore.deleteMany(workspacesToRemove);\n    }\n\n    if (workspacesToAdd.length > 0) {\n      this.workspaceStore.insertMany(workspacesToAdd);\n    }\n  }\n\n  private getOrCreateWorkspace(layer: VectorLayer | ImageLayer): Workspace | undefined {\n    const workspace = this.workspaceStore.get(layer.id);\n    if (workspace !== undefined) {\n      return;\n    }\n    if (layer.dataSource instanceof WFSDataSource && layer.dataSource.options.edition?.enabled !== true) {\n      const wfsWks = this.wfsWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\n      return wfsWks;\n    } else if (layer.dataSource instanceof WMSDataSource && layer.dataSource.options.edition?.enabled !== true) {\n      if (!layer.dataSource.options.paramsWFS) { return; }\n      const wmsWks = this.wmsWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\n      wmsWks?.inResolutionRange$.subscribe((inResolutionRange) => {\n        (layer.dataSource.options as QueryableDataSourceOptions).queryable = !inResolutionRange;\n        (wmsWks.layer.dataSource.options as QueryableDataSourceOptions).queryable = inResolutionRange;\n      });\n      return wmsWks;\n    } else if (\n        layer.dataSource instanceof FeatureDataSource &&\n        (layer as VectorLayer).exportable === true &&\n        layer.dataSource.options.edition?.enabled !== true) {\n      const featureWks = this.featureWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\n      return featureWks;\n    } else if (layer.dataSource instanceof WMSDataSource && layer.dataSource.options.edition?.enabled === true) {\n      const editionWks = this.editionWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\n      return editionWks;\n    }\n\n    return;\n  }\n\n  private layerIsEditable(layer: Layer): boolean {\n    const dataSource = layer.dataSource;\n    if (dataSource instanceof WFSDataSource) {\n      return true;\n    }\n    if (dataSource instanceof FeatureDataSource) {\n      return true;\n    }\n    if (dataSource instanceof WMSDataSource) {\n      const dataSourceOptions = (dataSource.options ||\n        {}) as OgcFilterableDataSourceOptions;\n      return (dataSourceOptions.ogcFilters?.enabled || dataSource.options.paramsWFS?.featureTypes !== undefined);\n    }\n\n    return false;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { WorkspaceSelectorDirective } from './workspace-selector.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n   WorkspaceSelectorDirective\n  ],\n  declarations: [\n    WorkspaceSelectorDirective\n  ]\n})\nexport class IgoWorkspaceSelectorModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { WorkspaceUpdatorDirective } from './workspace-updator.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n   WorkspaceUpdatorDirective\n  ],\n  declarations: [\n    WorkspaceUpdatorDirective\n  ]\n})\nexport class IgoWorkspaceUpdatorModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { ConfirmationPopupComponent } from './confirmation-popup.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    MatDialogModule,\n    MatButtonToggleModule\n  ],\n  exports: [ConfirmationPopupComponent],\n  declarations: [ConfirmationPopupComponent]\n})\nexport class IgoConfirmationPopupModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { IgoWidgetModule } from '@igo2/common';\n\nimport { provideOgcFilterWidget } from './widgets/widgets';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoOgcFilterModule } from './widgets/ogc-filter/ogc-filter.module';\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\nimport { IgoWorkspaceUpdatorModule } from './workspace-updator/workspace-updator.module';\nimport { IgoConfirmationPopupModule } from './confirmation-popup/confirmation-popup.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoWidgetModule,\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceUpdatorModule,\n    IgoOgcFilterModule,\n    MatDialogModule\n  ],\n  exports: [\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceUpdatorModule,\n    IgoOgcFilterModule,\n    IgoConfirmationPopupModule\n  ],\n  declarations: [],\n  providers: [\n    provideOgcFilterWidget()\n  ]\n})\nexport class IgoGeoWorkspaceModule {}\n","import { EntityStore } from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureWithDirection, FeatureWithStep, FeatureWithStop, Stop } from './directions.interface';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * stops.\n */\nexport class StopsStore extends EntityStore<Stop> {\n\n    public storeInitialized$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n    public clearStops() {\n        this.storeInitialized$.next(false);\n        this.clear();\n    }\n\n}\n\nexport class StopsFeatureStore extends FeatureStore<FeatureWithStop> {\n\n}\nexport class RoutesFeatureStore extends FeatureStore<FeatureWithDirection> {\n\n}\nexport class StepFeatureStore extends FeatureStore<FeatureWithStep> {\n\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Cacheable } from 'ts-cacheable';\n\nimport { uuid } from '@igo2/utils';\nimport { ConfigService } from '@igo2/core';\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsFormat, SourceDirectionsType } from '../shared/directions.enum';\n\nimport { DirectionsSource } from './directions-source';\nimport { DirectionsSourceOptions } from './directions-source.interface';\n\n@Injectable()\nexport class OsrmDirectionsSource extends DirectionsSource {\n  get enabled(): boolean {\n    return this.options.enabled !== false;\n  }\n  set enabled(value: boolean) {\n    this.options.enabled = value;\n  }\n  static _name = 'OSRM Qubec';\n  private directionsUrl =\n    'https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/';\n  private options: DirectionsSourceOptions;\n\n  constructor(private http: HttpClient, private config: ConfigService) {\n    super();\n    this.options = this.config.getConfig('directionsSources.osrm') || {};\n    this.directionsUrl = this.options.url || this.directionsUrl;\n  }\n\n  getName(): string {\n    return OsrmDirectionsSource._name;\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  route(coordinates: [number, number][], directionsOptions: DirectionOptions = {}): Observable<Direction[]> {\n    const directionsParams = this.getRouteParams(directionsOptions);\n    return this.http\n      .get<JSON[]>(this.directionsUrl + coordinates.join(';'), {\n        params: directionsParams\n      })\n      .pipe(map(res => this.extractRoutesData(res)));\n  }\n\n  private extractRoutesData(response): Direction[] {\n    const routeResponse = [];\n    response.routes.forEach(route => {\n      routeResponse.push(this.formatRoute(route, response.waypoints));\n    });\n    return routeResponse;\n  }\n\n  private getRouteParams(directionsOptions: DirectionOptions = {}): HttpParams {\n\n    directionsOptions.alternatives = directionsOptions.alternatives !== undefined ? directionsOptions.alternatives : true;\n    directionsOptions.steps = directionsOptions.steps !== undefined ? directionsOptions.steps : true;\n    directionsOptions.geometries = directionsOptions.geometries !== undefined ? directionsOptions.geometries : 'geojson';\n    directionsOptions.overview = directionsOptions.overview !== undefined ? directionsOptions.overview : false;\n    directionsOptions.continue_straight = directionsOptions.continue_straight !== undefined ? directionsOptions.continue_straight : false;\n\n    return new HttpParams({\n      fromObject: {\n        alternatives: directionsOptions.alternatives ? 'true' : 'false',\n        overview: directionsOptions.overview ? 'simplified' : 'full',\n        steps: directionsOptions.steps ? 'true' : 'false',\n        geometries: directionsOptions.geometries ? directionsOptions.geometries : 'geojson',\n        continue_straight: directionsOptions.continue_straight ? 'true' : 'false',\n      }\n    });\n  }\n\n  private formatRoute(roadNetworkRoute: any, waypoints: any): Direction {\n    const stepsUI = [];\n    roadNetworkRoute.legs.forEach(leg => {\n      leg.steps.forEach(step => {\n        stepsUI.push(step);\n      });\n    });\n    return {\n      id: uuid(),\n      title: roadNetworkRoute.legs[0].summary,\n      source: OsrmDirectionsSource._name,\n      sourceType: SourceDirectionsType.Route,\n      order: 1,\n      format: DirectionsFormat.GeoJSON,\n      icon: 'directions',\n      projection: 'EPSG:4326',\n      waypoints,\n      distance: roadNetworkRoute.distance,\n      duration: roadNetworkRoute.duration,\n      geometry: roadNetworkRoute.geometry,\n      legs: roadNetworkRoute.legs,\n      steps: stepsUI,\n      weight: roadNetworkRoute.weight,\n      weight_name: roadNetworkRoute.weight_name\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { DirectionsSource } from './directions-source';\nimport { OsrmDirectionsSource } from './osrm-directions-source';\n\nexport function osrmDirectionsSourcesFactory(\n  http: HttpClient,\n  config: ConfigService\n) {\n  return new OsrmDirectionsSource(http, config);\n}\n\nexport function provideOsrmDirectionsSource() {\n  return {\n    provide: DirectionsSource,\n    useFactory: osrmDirectionsSourcesFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport olWKT from 'ol/format/WKT';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n/**\n * Cadastre search source\n */\n@Injectable()\nexport class CadastreSearchSource extends SearchSource implements TextSearch {\n  static id = 'cadastre';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return CadastreSearchSource.id;\n  }\n\n  getType(): string {\n    return CadastreSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Cadastre (Qubec)',\n      searchUrl: 'https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?'\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    term = term.endsWith(',') ? term.slice(0, -1) : term;\n    term = term.startsWith(',') ? term.substr(1) : term;\n    term = term.replace(/ /g, '');\n\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('numero') || !params.get('numero').match(/^[0-9,]+$/g)) {\n      return of([]);\n    }\n    return this.http\n      .get(this.searchUrl, { params, responseType: 'text' })\n      .pipe(map((response: string) => this.extractResults(response, term)));\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          numero: term,\n          epsg: '4326'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(response: string, term: string): SearchResult<Feature>[] {\n    return response\n      .split('<br />')\n      .filter((lot: string) => lot.length > 0)\n      .map((lot: string) => this.dataToResult(lot, term));\n  }\n\n  private dataToResult(data: string, term: string): SearchResult<Feature> {\n    const lot = data.split(';');\n    const numero = lot[0];\n    const wkt = lot[7];\n    const geometry = this.computeGeometry(wkt);\n\n    const properties = {\n      NoLot: numero,\n      Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n    };\n    const id = [this.getId(), 'cadastre', numero].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: numero,\n        score: computeTermSimilarity(term.trim(), numero),\n        icon: 'map-marker'\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        properties,\n        meta: {\n          id,\n          title: numero\n        }\n      }\n    };\n  }\n\n  private computeGeometry(wkt: string): FeatureGeometry {\n    const feature = new olWKT().readFeature(wkt, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: 'EPSG:4326'\n    });\n    return {\n      type: feature.getGeometry().getType(),\n      coordinates: feature.getGeometry().getCoordinates()\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { CadastreSearchSource } from './cadastre';\n\n/**\n * Cadastre search source factory\n * @ignore\n */\nexport function cadastreSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new CadastreSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${CadastreSearchSource.id}`),\n  );\n}\n\n/**\n * Function that returns a provider for the Cadastre search source\n */\nexport function provideCadastreSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: cadastreSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { StorageService } from '@igo2/core';\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\nimport { NominatimData } from './nominatim.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n/**\n * Nominatim search source\n */\n@Injectable()\nexport class NominatimSearchSource extends SearchSource implements TextSearch {\n  static id = 'nominatim';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    @Inject('options') options: SearchSourceOptions,\n    storageService: StorageService\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return NominatimSearchSource.id;\n  }\n\n  getType(): string {\n    return NominatimSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Nominatim (OSM)',\n      searchUrl: 'https://nominatim.openstreetmap.org/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'amenity',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.type.food',\n              value:\n                'bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.health',\n              value:\n                'baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.entertainment',\n              value:\n                'arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium \\\n                          ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.finance',\n              value: 'atm,bank,bureau_de_change',\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '10',\n              value: 10,\n              enabled: true\n            },\n            {\n              title: '20',\n              value: 20,\n              enabled: false\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'countrycodes',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.country.canada',\n              value: 'CA',\n              enabled: true\n            },\n            {\n              title: 'igo.geo.search.nominatim.country.all',\n              value: null,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'multiple object',\n          name: 'dedupe',\n          values: [\n            {\n              title: 'igo.geo.search.searchSources.settings.true',\n              value: 0,\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.searchSources.settings.false',\n              value: 1,\n              enabled: true\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q')) {\n      return of([]);\n    }\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(map((response: NominatimData[]) => this.extractResults(response, term)));\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          q: this.computeTerm(term),\n          format: 'json'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(response: NominatimData[], term: string): SearchResult<Feature>[] {\n    return response.map((data: NominatimData) => this.dataToResult(data, term));\n  }\n\n  private dataToResult(data: NominatimData, term: string): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const geometry = this.computeGeometry(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), 'place', data.place_id].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.display_name,\n        icon: 'map-marker',\n        score: computeTermSimilarity(term.trim(), data.display_name)\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.display_name\n        }\n      }\n    };\n  }\n\n  private computeProperties(data: NominatimData): { [key: string]: any } {\n    return {\n      display_name: data.display_name,\n      place_id: data.place_id,\n      osm_type: data.osm_type,\n      class: data.class,\n      type: data.type\n    };\n  }\n\n  private computeGeometry(data: NominatimData): FeatureGeometry {\n    return {\n      type: 'Point',\n      coordinates: [parseFloat(data.lon), parseFloat(data.lat)]\n    };\n  }\n\n  private computeExtent(data: NominatimData): [number, number, number, number] {\n    return [\n      parseFloat(data.boundingbox[2]),\n      parseFloat(data.boundingbox[0]),\n      parseFloat(data.boundingbox[3]),\n      parseFloat(data.boundingbox[1])\n    ];\n  }\n\n  private computeTerm(term: string): string {\n    return this.computeTermTags(term);\n  }\n\n  /**\n   * Add hashtag from query in Nominatim's format (+[])\n   * @param term Query with hashtag\n   */\n  private computeTermTags(term: string): string {\n    const hashtags = super.getHashtagsValid(term, 'amenity');\n    if (!hashtags) {\n      return this.computeTermSettings(term);\n    }\n\n    if (!hashtags.length) {\n      return null;\n    }\n\n    term = term.replace(/(#[^\\s]*)/g, '');\n    hashtags.forEach(tag => {\n      term += '+[' + tag + ']';\n    });\n\n    return term;\n  }\n\n  /**\n   * Add hashtag from settings in Nominatim's format (+[])\n   * @param term Query\n   */\n  private computeTermSettings(term: string): string {\n    this.options.settings.forEach(settings => {\n      if (settings.name === 'amenity') {\n        settings.values.forEach(conf => {\n          if (conf.enabled && typeof conf.value === 'string') {\n            const splitted = conf.value.split(',');\n            splitted.forEach(value => {\n              term += '+[' + value + ']';\n            });\n          }\n        });\n      }\n    });\n    return term;\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { NominatimSearchSource } from './nominatim';\n\n/**\n * Nominatim search source factory\n * @ignore\n */\nexport function nominatimSearchSourceFactory(\n  http: HttpClient,\n  config: ConfigService,\n  storageService: StorageService\n) {\n  return new NominatimSearchSource(\n    http,\n    config.getConfig(`searchSources.${NominatimSearchSource.id}`),\n    storageService\n  );\n}\n\n/**\n * Function that returns a provider for the Nominatim search source\n */\nexport function provideNominatimSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: nominatimSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService, StorageService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { FEATURE, Feature } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch, ReverseSearch } from './source';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './source.interfaces';\nimport {\n  StoredQueriesData,\n  StoredQueriesResponse,\n  StoredQueriesReverseData,\n  StoredQueriesReverseResponse,\n  StoredQueriesSearchSourceOptions,\n  StoredQueriesFields,\n  StoredQueriesReverseSearchSourceOptions\n} from './storedqueries.interfaces';\n\nimport * as olformat from 'ol/format';\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n/**\n * StoredQueries search source\n */\n@Injectable()\nexport class StoredQueriesSearchSource extends SearchSource\n  implements TextSearch {\n  static id = 'storedqueries';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [\n    'boundedBy',\n    'id',\n    'coord_x',\n    'coord_y'\n  ];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions = options as StoredQueriesSearchSourceOptions;\n    if (this.storedQueriesOptions && !this.storedQueriesOptions.available) {\n      return;\n    }\n\n    const defaultStoredqueryId = 'rtss';\n    const defaultFieldSplitter: StoredQueriesFields[] = [\n      { name: 'rtss', defaultValue: '-99' },\n      { name: 'chainage', defaultValue: '0', splitPrefix: '\\\\+' }\n    ];\n    const defaultOutputformat = 'text/xml; subtype=gml/3.1.1';\n    const defaultSrsname = 'EPSG:4326';\n    const defaultResultTitle = 'title';\n\n    if (!this.storedQueriesOptions) {\n      console.log(\n        ' No configuration for this search source (storedqueries). You will use the default values'\n      );\n      this.storedQueriesOptions = {\n        storedquery_id: defaultStoredqueryId,\n        fields: defaultFieldSplitter,\n        outputformat: defaultOutputformat,\n        srsname: defaultSrsname,\n        resultTitle: defaultResultTitle\n      };\n      this.resultTitle = defaultResultTitle;\n      console.log('Default values', this.storedQueriesOptions);\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.fields) {\n      throw new Error(\n        'Stored Queries :You have to set \"fields\" into options. ex: fields: {\"name\": \"rtss\", \"defaultValue\": \"-99\"}'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n\n    const storedQueryId = this.storedQueriesOptions.storedquery_id.toLowerCase();\n    if (\n      storedQueryId.includes('getfeaturebyid') &&\n      this.storedQueriesOptions.outputformat\n        .toLowerCase()\n        .includes('getfeaturebyid')\n    ) {\n      let err =\n        'You must set a geojson format for your stored query. This is due to an openlayers issue)';\n      err += ' (wfs 1.1.0 & gml 3.1.1 limitation)';\n      throw new Error(err);\n    }\n\n    if (!(this.storedQueriesOptions.fields instanceof Array)) {\n      this.storedQueriesOptions.fields = [this.storedQueriesOptions.fields];\n    }\n\n    this.multipleFieldsQuery =\n      this.storedQueriesOptions.fields.length > 1 ? true : false;\n\n    this.storedQueriesOptions.fields.forEach((field, index) => {\n      if (this.multipleFieldsQuery && !field.splitPrefix && index !== 0) {\n        throw new Error(\n          'Stored Queries :You must set a field spliter into your field definition (optional for the first one!)'\n        );\n      }\n      if (!field.defaultValue) {\n        throw new Error(\n          'Stored Queries :You must set a field default value into your field definition'\n        );\n      }\n    });\n\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  // URL CALL EXAMPLES:\n  //  GetFeatureById (mandatory storedquery for wfs server) (outputformat must be in geojson)\n /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=2.0.0&request=GetFeature&storedquery_id=urn:ogc:def:query:OGC-WFS::GetFeatureById&srsname=epsg:4326&outputformat=geojson&ID=a_num_route.132\n  //  Custom StoredQuery\n /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=rtss&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&rtss=0013801110000c&chainage=12\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const storedqueriesParams = this.termSplitter(\n      term,\n      this.storedQueriesOptions.fields\n    );\n    const params = this.computeRequestParams(\n      options || {},\n      storedqueriesParams\n    );\n    this.options.params = this.options.params ? this.options.params : {};\n    this.options.params.page = options.page ? String(options.page) : '1';\n\n    if (\n      new RegExp('.*?gml.*?', 'i').test(this.storedQueriesOptions.outputformat)\n    ) {\n      return this.http\n        .get(this.searchUrl, { params, responseType: 'text' })\n        .pipe(\n          map(response => {\n            let resultArray = this.extractResults(this.extractWFSData(response), term);\n            resultArray.sort((a, b) =>\n              (a.meta.score > b.meta.score) ? 1 :\n              (a.meta.score === b.meta.score) ? ((a.meta.titleHtml < b.meta.titleHtml) ? 1 : -1) : -1);\n            resultArray.reverse();\n            if (resultArray.length > Number(this.options.params.limit)) {\n              const idxEnd = Number(this.options.params.limit) * Number(this.options.params.page);\n              const resultTotLenght = resultArray.length;\n              resultArray = resultArray.slice(0, idxEnd);\n              if (idxEnd < resultTotLenght) {\n                resultArray[resultArray.length - 1 ].meta.nextPage = true;\n              } else {\n                resultArray[resultArray.length - 1 ].meta.nextPage = false;\n              }\n            }\n            return resultArray;\n          })\n        );\n    } else {\n      return this.http.get(this.searchUrl, { params }).pipe(\n        map(response => {\n          return this.extractResults(this.extractWFSData(response), term);\n        })\n      );\n    }\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private termSplitter(term: string, fields: StoredQueriesFields[]): {} {\n    const splittedTerm = {};\n    let remainingTerm = term;\n    let cnt = 0;\n\n    // Used to build the default values\n    fields.forEach(field => {\n      splittedTerm[field.name] = field.defaultValue;\n      const splitterRegex = new RegExp(field.splitPrefix + '(.+)', 'i');\n      if (splitterRegex.test(remainingTerm)) {\n        cnt = field.splitPrefix ? (cnt += 1) : cnt;\n        remainingTerm = remainingTerm.split(splitterRegex)[1];\n      }\n    });\n    if (cnt === 0) {\n      splittedTerm[fields[0].name] = term;\n      return splittedTerm;\n    }\n    remainingTerm = term;\n    const localFields = [...fields].reverse();\n    localFields.forEach(field => {\n      const splitterRegex = new RegExp(field.splitPrefix || '' + '(.+)', 'i');\n      if (remainingTerm || remainingTerm !== '') {\n        const values = remainingTerm.split(splitterRegex);\n        remainingTerm = values[0];\n        if (values[1]) {\n          splittedTerm[field.name] = values[1].trim();\n        }\n      }\n    });\n    return splittedTerm;\n  }\n\n  private computeRequestParams(\n    options: TextSearchOptions,\n    queryParams\n  ): HttpParams {\n    const wfsversion = this.storedQueriesOptions.storedquery_id\n      .toLowerCase()\n      .includes('getfeaturebyid')\n      ? '2.0.0'\n      : '1.1.0';\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'wfs',\n          version: wfsversion,\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        queryParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesResponse, term: string\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesData) => {\n      return this.dataToResult(data, term);\n    });\n  }\n\n  private dataToResult(data: StoredQueriesData, term: string): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        // extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.title,\n        titleHtml: data.properties[title],\n        icon: 'map-marker',\n        score: (data.properties.title) ?\n        computeTermSimilarity(term.trim(), data.properties.title) :\n        computeTermSimilarity(term.trim(), data.properties[title]),\n\n      }\n    };\n  }\n\n  private computeProperties(data: StoredQueriesData): { [key: string]: any } {\n    const properties = Object.assign(\n      {},\n      ObjectUtils.removeKeys(\n        data.properties,\n        StoredQueriesSearchSource.propertiesBlacklist\n      ),\n      { Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>' }\n    );\n    return properties;\n  }\n}\n\n/**\n * StoredQueriesReverse search source\n */\n\n// EXAMPLE CALLS\n /* eslint-disable max-len */\n// https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=lim_adm&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&long=-71.292469&lat=46.748107\n//\n\n@Injectable()\nexport class StoredQueriesReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'storedqueriesreverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesReverseSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions = options as StoredQueriesReverseSearchSourceOptions;\n\n    if (!this.storedQueriesOptions || (this.storedQueriesOptions && !this.storedQueriesOptions.available) ) {\n      return;\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.longField) {\n      throw new Error(\n        'Stored Queries :You have to set \"longField\" to map the longitude coordinate to the query params.'\n      );\n    }\n    if (!this.storedQueriesOptions.latField) {\n      throw new Error(\n        'Stored Queries :You have to set \"latField\" to map the latitude coordinate to the query params.'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries (reverse)',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n\n    if (\n      new RegExp('.*?gml.*?', 'i').test(this.storedQueriesOptions.outputformat)\n    ) {\n      return this.http\n        .get(this.searchUrl, { params, responseType: 'text' })\n        .pipe(\n          map(response => {\n            return this.extractResults(this.extractWFSData(response));\n          })\n        );\n    } else {\n      return this.http.get(this.searchUrl, { params }).pipe(\n        map(response => {\n          return this.extractResults(this.extractWFSData(response));\n        })\n      );\n    }\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    const longLatParams = {};\n    longLatParams[this.storedQueriesOptions.longField] = lonLat[0];\n    longLatParams[this.storedQueriesOptions.latField] = lonLat[1];\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'WFS',\n          version: '1.1.0',\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        longLatParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private dataToResult(data: StoredQueriesReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties[title],\n        icon: 'map-marker'\n      }\n    };\n  }\n\n  private computeProperties(\n    data: StoredQueriesReverseData\n  ): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      StoredQueriesReverseSearchSource.propertiesBlacklist\n    );\n    const routing = {\n      Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n    };\n    return Object.assign(properties, { type: data.properties.doc_type }, routing);\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  StoredQueriesSearchSource,\n  StoredQueriesReverseSearchSource\n} from './storedqueries';\n\n/**\n * StoredQueries search source factory\n * @ignore\n */\nexport function storedqueriesSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new StoredQueriesSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${StoredQueriesSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the StoredQueries search source\n */\nexport function provideStoredQueriesSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: storedqueriesSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n\n/**\n * StoredQueriesReverse search source factory\n * @ignore\n */\n\nexport function storedqueriesReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new StoredQueriesReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${StoredQueriesReverseSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the StoredQueriesReverse search source\n */\nexport function provideStoredQueriesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: storedqueriesReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n","import { WfsWorkspace } from './wfs-workspace';\nimport { FeatureWorkspace } from './feature-workspace';\nimport { EditionWorkspace } from './edition-workspace';\nimport { Observable } from 'rxjs';\nimport { EntityStoreFilterCustomFuncStrategy, EntityRecord } from '@igo2/common';\nimport { map } from 'rxjs/operators';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { StorageScope } from '@igo2/core';\n\n\nexport function getRowsInMapExtent(layerId, storageService): boolean {\n  return storageService.get(`workspace.rowsInMapExtent.${layerId}`) as boolean || true;\n}\n\nexport function setRowsInMapExtent(value, layerId, storageService) {\n  storageService.set(`workspace.rowsInMapExtent.${layerId}`, value, StorageScope.SESSION);\n}\n\nexport function getSelectedOnly(layerId, storageService): boolean {\n  return storageService.get(`workspace.selectedOnly.${layerId}`) as boolean || false;\n}\n\nexport function setSelectedOnly(value, layerId, storageService) {\n  storageService.set(`workspace.selectedOnly.${layerId}`, value, StorageScope.SESSION);\n}\n\nexport function mapExtentStrategyActiveToolTip(ws: WfsWorkspace | FeatureWorkspace | EditionWorkspace): Observable<string> {\n  return ws.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy).active$.pipe(\n    map((active: boolean) => active ? 'igo.geo.workspace.inMapExtent.active.tooltip' : 'igo.geo.workspace.inMapExtent.inactive.tooltip')\n  );\n}\n\nexport function noElementSelected(ws: WfsWorkspace | FeatureWorkspace | EditionWorkspace): Observable<boolean> {\n  return ws.entityStore.stateView.manyBy$((record: EntityRecord<Feature>) => {\n    return record.state.selected === true;\n  }).pipe(\n    map((entities: EntityRecord<Feature>[]) => entities.length >= 1)\n  );\n}\n\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/simple-map\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\"\n  igoPointerPosition\n  [pointerPositionDelay]=\"pointerCoordDelay\"\n  (pointerPositionCoord)=\"onPointerMove($event)\">\n    <igo-info-section [infoContent]=\"pointerCoord\"></igo-info-section>\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-home-extent-button [map]=\"map\" color=\"primary\"></igo-home-extent-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"true\" color=\"primary\"></igo-rotation-button>\n    <igo-wake-lock-button [map]=\"map\" color=\"primary\"></igo-wake-lock-button>\n  </igo-map-browser>\n\n</mat-card>\n\n<p *ngIf=\"!isTouchScreen\">{{pointerCoord}}</p>","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppSimpleMapComponent } from './simple-map.component';\n\nconst routes: Routes = [\n  {\n    path: 'simple-map',\n    component: AppSimpleMapComponent\n  }\n];\n\nexport const AppSimpleMapRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService, MediaService } from '@igo2/core';\nimport { IgoMap, DataSourceService, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-simple-map',\n  templateUrl: './simple-map.component.html',\n  styleUrls: ['./simple-map.component.scss']\n})\nexport class AppSimpleMapComponent {\n  public pointerCoord;\n  public pointerCoordDelay: number = 0;\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6,\n    rotation: 0.75\n  };\n\n  get media() {\n    return this.mediaService.getMedia();\n  }\n\n  get isTouchScreen() {\n    return this.mediaService.isTouchScreen();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mediaService: MediaService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n\n  onPointerMove(event) {\n    this.pointerCoord = event;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule } from '@igo2/geo';\n\nimport { AppSimpleMapComponent } from './simple-map.component';\nimport { AppSimpleMapRoutingModule } from './simple-map-routing.module';\nimport { CommonModule } from '@angular/common';\n\n@NgModule({\n  declarations: [AppSimpleMapComponent],\n  imports: [\n    CommonModule,\n    AppSimpleMapRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMapModule\n  ],\n  exports: [AppSimpleMapComponent]\n})\nexport class AppSimpleMapModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/layer\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Layers\">\n    <igo-layer-list\n    [map]=\"map\"\n    [layers]=\"map.layers\"\n    [expandLegendOfVisibleLayers]=\"false\"\n    floatLabel=\"never\"\n    [queryBadge]=\"true\">\n\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n        <igo-download-button [layer]=\"layer\"></igo-download-button>\n        <igo-ogc-filter-button [header]=\"true\" [layer]=\"layer\"></igo-ogc-filter-button>\n        <igo-time-filter-button [header]=\"true\" [layer]=\"layer\"></igo-time-filter-button>\n        <igo-track-feature-button [layer]=\"layer\" [trackFeature]=\"true\"></igo-track-feature-button>\n      </ng-template>\n\n    </igo-layer-list>\n  </igo-panel>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppLayerComponent } from './layer.component';\n\nconst routes: Routes = [\n  {\n    path: 'layer',\n    component: AppLayerComponent\n  }\n];\n\nexport const AppLayerRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WMSDataSourceOptions,\n  LayerOptions,\n  WFSDataSourceOptions,\n  OgcFilterableDataSourceOptions,\n  MetadataLayerOptions\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-layer',\n  templateUrl: './layer.component.html',\n  styleUrls: ['./layer.component.scss']\n})\nexport class AppLayerComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    maxLayerZoomExtent: [-11000000, 4500000, -4500000, 10000000],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            visible: true,\n            baseLayer: true,\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const wfsDatasource: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '10043'\n        }\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasource)\n      .subscribe(dataSource => {\n        const layer: LayerOptions = {\n          title: 'WFS ',\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    const wfsDatasourceCustomEPSG: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: 'geojson_utf8',\n        srsName: 'EPSG:32198',\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '12072'\n        }\n      },\n      formatOptions: {\n        dataProjection: 'EPSG:32198'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourceCustomEPSG)\n      .subscribe(dataSource => {\n        const layer: LayerOptions = {\n          title: 'WFS (Custom EPSG)',\n          visible: true,\n          source: dataSource,\n          removable: false\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'parc_routier',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Rseau routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'lieu habit',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'lieuhabite',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'sh_dis_eco',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'sh_dis_eco',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'nurc:Arc_Sample_Parent',\n        visible: false,\n        legendOptions: {\n          // collapsed: false,\n          display: true,\n          // url: 'https://v.seloger.com/s/width/1144/visuels/0/m/l/4/0ml42xbt1n3itaboek3qec5dtskdgw6nlscu7j69k.jpg',\n          stylesAvailable: [\n            { name: 'rain', title: 'Pluie' },\n            { name: 'raster', title: 'Dfaut' }\n          ] //\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://demo.geo-solutions.it/geoserver/ows',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'nurc:Arc_Sample', // , test:Linea_costa\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Avertissements routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'evenements',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    const datasource: WMSDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      refreshIntervalSec: 15,\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      }\n    };\n\n    interface LayerOptionsWithMetadata\n      extends LayerOptions,\n        MetadataLayerOptions {}\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe(dataSource => {\n        const layer: LayerOptionsWithMetadata = {\n          title: 'Embcle',\n          source: dataSource,\n          metadata: {\n            url:\n              'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\n            extern: true\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoFilterModule,\n  IgoMetadataModule,\n  IgoDownloadModule\n} from '@igo2/geo';\n\nimport { AppLayerComponent } from './layer.component';\nimport { AppLayerRoutingModule } from './layer-routing.module';\n\n@NgModule({\n  declarations: [AppLayerComponent],\n  imports: [\n    AppLayerRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoFilterModule,\n    IgoMetadataModule,\n    IgoDownloadModule\n  ],\n  exports: [AppLayerComponent]\n})\nexport class AppLayerModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppLegendComponent } from './legend.component';\n\nconst routes: Routes = [\n  {\n    path: 'legend',\n    component: AppLegendComponent\n  }\n];\n\nexport const AppLegendRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WMSDataSourceOptions,\n  LayerOptions,\n  WFSDataSourceOptions,\n  OgcFilterableDataSourceOptions,\n  MetadataLayerOptions\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-legend',\n  templateUrl: './legend.component.html',\n  styleUrls: ['./legend.component.scss']\n})\nexport class AppLegendComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            visible: true,\n            baseLayer: true,\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const wfsDatasource: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '10043'\n        }\n      }\n    };\n\n    this.layerService\n    .createAsyncLayer({\n      title: 'legend with display:false',\n      visible: true,\n      legendOptions: {\n        display: false,\n        html: 'test html'\n      },\n      sourceOptions: {\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n        optionsFromCapabilities: true,\n        params: {\n          LAYERS: 'sh_dis_eco',\n          VERSION: '1.3.0'\n        }\n      }\n    })\n    .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n    .createAsyncLayer({\n      title: 'legend in html',\n      visible: true,\n      legendOptions: {\n        display: true,\n        html: '<h2 style=\"background-color: blue;\">HTML lgende</h2>'\n      },\n      sourceOptions: {\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n        optionsFromCapabilities: false,\n        params: {\n          LAYERS: 'sh_sreg_eco',\n          VERSION: '1.3.0'\n        }\n      }\n    })\n    .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n    .createAsyncLayer({\n      title: 'legend with url param',\n      visible: true,\n      legendOptions: {\n        url: `data:image/jpeg;base64,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`\n\n      },\n      sourceOptions: {\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n        optionsFromCapabilities: true,\n        params: {\n          LAYERS: 'sh_reg_eco',\n          VERSION: '1.3.0'\n        }\n      }\n    })\n    .subscribe(l => this.map.addLayer(l));\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasource)\n      .subscribe(dataSource => {\n        const layer: LayerOptions = {\n          title: 'WFS ',\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'MELS_CS_ANGLO_S',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Rseau routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'lieu habit',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'lieuhabite',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: '2 styles nurc:Arc_Sample_Parent',\n        visible: true,\n        legendOptions: {\n          // collapsed: false,\n          display: true,\n          // url: 'https://v.seloger.com/s/width/1144/visuels/0/m/l/4/0ml42xbt1n3itaboek3qec5dtskdgw6nlscu7j69k.jpg',\n          stylesAvailable: [\n            { name: 'rain', title: 'Pluie' },\n            { name: 'raster', title: 'Dfaut' }\n          ] //\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://demo.geo-solutions.it/geoserver/ows',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'nurc:Arc_Sample', // , test:Linea_costa\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Avertissements routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'evenements',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    const datasource: WMSDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      refreshIntervalSec: 15,\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      }\n    };\n\n    interface LayerOptionsWithMetadata\n      extends LayerOptions,\n        MetadataLayerOptions {}\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe(dataSource => {\n        const layer: LayerOptionsWithMetadata = {\n          title: 'Embcle',\n          visible: true,\n          source: dataSource,\n          metadata: {\n            url:\n              'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\n            extern: true\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map with a legend list</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/layer\">code of this\n      example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Legends\">\n    <igo-layer-legend-list [layers]=\"map.layers\"\n    [excludeBaseLayers]=\"true\"\n    [allowShowAllLegends]=\"true\"\n    [updateLegendOnResolutionChange]=\"false\"\n    [showAllLegendsValue]=\"false\">\n  </igo-layer-legend-list>\n\n  </igo-panel>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoFilterModule,\n  IgoMetadataModule,\n  IgoDownloadModule\n} from '@igo2/geo';\n\nimport { AppLegendComponent } from './legend.component';\nimport { AppLegendRoutingModule } from './legend-routing.module';\n\n@NgModule({\n  declarations: [AppLegendComponent],\n  imports: [\n    AppLegendRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoFilterModule,\n    IgoMetadataModule,\n    IgoDownloadModule\n  ],\n  exports: [AppLegendComponent]\n})\nexport class AppLegendModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppOverlayComponent } from './overlay.component';\n\nconst routes: Routes = [\n  {\n    path: 'overlay',\n    component: AppOverlayComponent\n  }\n];\n\nexport const AppOverlayRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, AfterViewInit } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  FEATURE,\n  Feature,\n  FeatureMotion\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-overlay',\n  templateUrl: './overlay.component.html',\n  styleUrls: ['./overlay.component.scss']\n})\nexport class AppOverlayComponent implements OnInit, AfterViewInit {\n  public map = new IgoMap({\n    overlay: true,\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit() {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n\n  ngAfterViewInit() {\n    const feature1: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 1\n      },\n      properties: {},\n      geometry: {\n        type: 'Point',\n        coordinates: [-73, 46.6]\n      }\n    };\n\n    const feature2: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 2\n      },\n      properties: {},\n      geometry: {\n        type: 'LineString',\n        coordinates: [[-72, 47.8], [-73.5, 47.4], [-72.4, 48.6]]\n      }\n    };\n\n    const feature3: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 3\n      },\n      properties: {},\n      geometry: {\n        type: 'Polygon',\n        coordinates: [[[-71, 46.8], [-73, 47], [-71.2, 46.6]]]\n      }\n    };\n\n    this.map.overlay.setFeatures(\n      [feature1, feature2, feature3],\n      FeatureMotion.None\n    );\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Overlay</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/overlay\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule, IgoOverlayModule } from '@igo2/geo';\n\nimport { AppOverlayComponent } from './overlay.component';\nimport { AppOverlayRoutingModule } from './overlay-routing.module';\n\n@NgModule({\n  declarations: [AppOverlayComponent],\n  imports: [\n    AppOverlayRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMapModule,\n    IgoOverlayModule\n  ],\n  exports: [AppOverlayComponent]\n})\nexport class AppOverlayModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Geometry Form</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/form\">code of this example</a>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-form\n    *ngIf=\"form$ | async as form\"\n    [form]=\"form\"\n    [formData]=\"data$ | async\"\n    (submitForm)=\"onSubmit($event)\">\n\n    <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n    <div formButtons>\n      <button\n        mat-stroked-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"fillForm()\">\n        Fill Form\n      </button>\n      <button\n        mat-stroked-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"clearForm()\">\n        Clear Form\n      </button>\n      <button\n        mat-flat-button\n        type=\"submit\"\n        color=\"primary\"\n        [disabled]=\"submitDisabled\">\n        Submit\n      </button>\n    </div>\n  </igo-form>\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppGeometryComponent } from './geometry.component';\n\nconst routes: Routes = [\n  {\n    path: 'geometry',\n    component: AppGeometryComponent\n  }\n];\n\nexport const AppGeometryRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport * as olstyle from 'ol/style';\n\nimport { LanguageService } from '@igo2/core';\nimport { Form, FormService } from '@igo2/common';\nimport { IgoMap, DataSourceService, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-geometry',\n  templateUrl: './geometry.component.html',\n  styleUrls: ['./geometry.component.scss']\n})\nexport class AppGeometryComponent implements OnInit, OnDestroy {\n\n  map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  view = {\n    center: [-73, 47.2],\n    zoom: 15\n  };\n\n  form$ = new BehaviorSubject<Form>(undefined);\n\n  data$ = new BehaviorSubject<{[key: string]: any}>(undefined);\n\n  submitDisabled = true;\n\n  private valueChanges$$: Subscription;\n\n  constructor(\n    private languageService: LanguageService,\n    private formService: FormService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit() {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    const fieldConfigs = [\n      {\n        name: 'geometry',\n        title: 'Geometry',\n        options: {\n          validator: Validators.required\n        },\n        type: 'geometry',\n        inputs: {\n          map: this.map,\n          geometryTypeField: true,\n          geometryType: 'Polygon',\n          drawGuideField: true,\n          drawGuide: 50,\n          drawGuidePlaceholder: 'Draw Guide',\n          drawStyle: new olstyle.Style({\n            stroke: new olstyle.Stroke({\n              color: [255, 0, 0, 1],\n              width: 2\n            }),\n            fill:  new olstyle.Fill({\n              color: [255, 0, 0, 0.2]\n            }),\n            image: new olstyle.Circle({\n              radius: 8,\n              stroke: new olstyle.Stroke({\n                color: [255, 0, 0, 1]\n              }),\n              fill: new olstyle.Fill({\n                color: [255, 0, 0, 0.2]\n              })\n            })\n          })\n        }\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        options: {\n          validator: Validators.required\n        }\n      }\n    ];\n\n    const fields = fieldConfigs.map((config) => this.formService.field(config));\n    const form = this.formService.form([], [this.formService.group({name: 'info'}, fields)]);\n\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\n      this.submitDisabled = !form.control.valid;\n    });\n\n    this.form$.next(form);\n  }\n\n  ngOnDestroy() {\n    this.valueChanges$$.unsubscribe();\n  }\n\n  fillForm() {\n    this.data$.next({\n      name: 'Place',\n      geometry: JSON.stringify({type: 'Polygon', coordinates: [[\n        [-106, 42],\n        [-107, 31],\n        [-81, 32],\n        [-82, 42],\n        [-106, 42]\n      ]]})\n    });\n  }\n\n  clearForm() {\n    this.form$.value.control.reset();\n  }\n\n  onSubmit(data: {[key: string]: any}) {\n    alert(JSON.stringify(data));\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoFormModule } from '@igo2/common';\nimport { IgoGeometryModule, IgoMapModule } from '@igo2/geo';\n\nimport { AppGeometryComponent } from './geometry.component';\nimport { AppGeometryRoutingModule } from './geometry-routing.module';\n\n@NgModule({\n  declarations: [AppGeometryComponent],\n  imports: [\n    CommonModule,\n    AppGeometryRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoFormModule,\n    IgoGeometryModule,\n    IgoMapModule\n  ],\n  exports: [AppGeometryComponent]\n})\nexport class AppGeometryModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppFeatureComponent } from './feature.component';\n\nconst routes: Routes = [\n  {\n    path: 'feature',\n    component: AppFeatureComponent\n  }\n];\n\nexport const AppFeatureRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  VectorLayer,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureMotion\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-feature',\n  templateUrl: './feature.component.html',\n  styleUrls: ['./feature.component.scss']\n})\nexport class AppFeatureComponent implements OnInit, OnDestroy {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  public tableTemplate = {\n    selection: true,\n    selectMany: true,\n    sort: true,\n    columns: [\n      {\n        name: 'properties.id',\n        title: 'ID'\n      },\n      {\n        name: 'properties.name',\n        title: 'Name'\n      },\n      {\n        name: 'properties.description',\n        title: 'Description'\n      }\n    ]\n  };\n\n  public store = new FeatureStore([], { map: this.map });\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit() {\n    const loadingStrategy = new FeatureStoreLoadingStrategy({});\n    this.store.addStrategy(loadingStrategy);\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      map: this.map,\n      motion: FeatureMotion.Default\n    });\n    this.store.addStrategy(selectionStrategy);\n\n    this.store.load([\n      {\n        meta: { id: 1 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-72, 47.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 1,\n          name: 'Name 1',\n          description: 'Description 1'\n        }\n      },\n      {\n        meta: { id: 4 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-71, 46.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 4,\n          name: 'Name 4',\n          description: 'Description 4'\n        }\n      },{\n        meta: { id: 5 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-73, 45.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 5,\n          name: 'Name 5',\n          description: 'Description 5'\n        }\n      },\n      {\n        meta: { id: 2 },\n        type: 'Feature',\n        geometry: {\n          type: 'LineString',\n          coordinates: [[-72, 47.8], [-73.5, 47.4], [-72.4, 48.6]]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 2,\n          name: 'Name 2',\n          description: 'Description 2'\n        }\n      },\n      {\n        meta: { id: 3 },\n        type: 'Feature',\n        geometry: {\n          type: 'Polygon',\n          coordinates: [[[-71, 46.8], [-73, 47], [-71.2, 46.6]]]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 3,\n          name: 'Name 3',\n          description: 'Description 3'\n        }\n      }\n    ]);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'MVT test',\n        visible: true,\n        sourceOptions: {\n          type: 'mvt',\n          url:\n            'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\n          queryable: true\n        },\n        mapboxStyle: {\n          url: 'assets/mapboxStyleExample-vectortile.json',\n          source: 'ahocevar'\n        }\n      } as any)\n      .subscribe(l => this.map.addLayer(l));\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector'\n      })\n      .subscribe(dataSource => {\n        const layer = this.layerService.createLayer({\n          title: 'Vector Layer',\n          source: dataSource,\n          animation: {\n            duration: 2000\n          },\n          mapboxStyle: {\n            url: 'assets/mapboxStyleExample-feature.json',\n            source: 'source_nameX'\n          }\n        }) as VectorLayer;\n        this.map.addLayer(layer);\n        this.store.bindLayer(layer);\n        loadingStrategy.activate();\n        selectionStrategy.activate();\n      });\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Feature</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geom/feature\">code of this example</a>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-entity-table\n    [store]=\"store\"\n    [template]=\"tableTemplate\">\n  </igo-entity-table>\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule, IgoEntityTableModule } from '@igo2/common';\nimport { IgoMapModule, IgoFeatureModule } from '@igo2/geo';\n\nimport { AppFeatureComponent } from './feature.component';\nimport { AppFeatureRoutingModule } from './feature-routing.module';\n\n@NgModule({\n  declarations: [AppFeatureComponent],\n  imports: [\n    AppFeatureRoutingModule,\n    CommonModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoEntityTableModule,\n    IgoMapModule,\n    IgoFeatureModule\n  ],\n  exports: [AppFeatureComponent]\n})\nexport class AppFeatureModule {}\n","import { Routes, RouterModule } from '@angular/router';\nimport { AppHoverComponent } from './hover.component';\n\nconst routes: Routes = [\n  {\n    path: 'hover',\n    component: AppHoverComponent\n  }\n];\n\nexport const AppHoverRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService, MediaService } from '@igo2/core';\nimport { IgoMap, DataSourceService, LayerService, WFSDataSourceOptions, VectorLayerOptions, WFSDataSource } from '@igo2/geo';\n\n@Component({\n  selector: 'app-hover',\n  templateUrl: './hover.component.html',\n  styleUrls: ['./hover.component.scss']\n})\nexport class AppHoverComponent {\n  public selected;\n  public pointerCoord;\n  public pointerCoordDelay: number = 0;\n  public pointerHoverFeatureDelay: number = 0;\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 8,\n    projection: 'EPSG:3857'\n  };\n\n\n  get media() {\n    return this.mediaService.getMedia();\n  }\n\n  get isTouchScreen() {\n    return this.mediaService.isTouchScreen();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mediaService: MediaService\n  ) {\n\n    this.dataSourceService\n    .createAsyncDataSource({\n      type: 'wmts',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts',\n      layer: 'carte_gouv_qc_public',\n      matrixSet: 'EPSG_3857',\n      version: '1.3.0'\n    })\n    .subscribe(dataSource => {\n      this.map.addLayer(\n        this.layerService.createLayer({\n          title: 'Quebec',\n          visible: true,\n          baseLayer: true,\n          source: dataSource\n        })\n      );\n    });\n\n    interface WFSDataOptions\n      extends WFSDataSourceOptions {}\n\n    const wfsDatasourcePolygon: WFSDataOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'adn_bassin_n1_public_v',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '3.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourcePolygon)\n      .subscribe((dataSource: WFSDataSource) => {\n        const layer: VectorLayerOptions = {\n          title: 'WFS (polygon)',\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    const wfsDatasourcePoint: WFSDataOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'CASERNE',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourcePoint)\n      .subscribe((dataSource: WFSDataSource) => {\n        const layer: VectorLayerOptions = {\n          title: 'WFS (point)',\n          visible: true,\n          source: dataSource,\n          styleByAttribute: {\n            attribute: 'en_caserne',\n            data: ['true', 'false'],\n            stroke: ['red', 'blue'],\n            fill: ['#ffffff', '#ffffff'],\n            radius: [7, 7],\n            width: [2, 2]\n          },\n          hoverStyle: {\n            label: {\n              attribute: 'Caserne: ${nom_service_incendie}\\n Mun: ${ville}',\n              style: {\n                textAlign: 'left',\n                textBaseline: 'top',\n                font: '12px Calibri,sans-serif',\n                fill: { color: '#000' },\n                backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\n                backgroundStroke: { color: 'rgba(200, 200, 200, 0.75)', width: 2 },\n                stroke: { color: '#fff', width: 3 },\n                overflow: true,\n                offsetX: 20,\n                offsetY: 10,\n                padding: [2.5, 2.5, 2.5, 2.5]\n              }\n            },\n            baseStyle: {\n              circle: {\n                stroke: {\n                  color: 'orange',\n                  width: 5\n                },\n                width: [5],\n                radius: 15\n              }\n            }\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Hover</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/hover\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\"\n  igoHoverFeature\n  [igoHoverFeatureDelay]=\"pointerHoverFeatureDelay\"\n  [igoHoverFeatureEnabled]=\"true\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-home-extent-button [map]=\"map\" color=\"primary\"></igo-home-extent-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"true\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule } from '@igo2/geo';\n\nimport { AppHoverComponent } from './hover.component';\nimport { AppHoverRoutingModule } from './hover-routing.module';\nimport { CommonModule } from '@angular/common';\n\n@NgModule({\n  declarations: [AppHoverComponent],\n  imports: [\n    CommonModule,\n    AppHoverRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMapModule\n  ],\n  exports: [AppHoverComponent]\n})\nexport class AppHoverModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppMeasureComponent } from './measure.component';\n\nconst routes: Routes = [\n  {\n    path: 'measure',\n    component: AppMeasureComponent\n  }\n];\n\nexport const AppMeasureRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  FeatureStore,\n  FeatureWithMeasure\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-measure',\n  templateUrl: './measure.component.html',\n  styleUrls: ['./measure.component.scss']\n})\nexport class AppMeasureComponent {\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6,\n    projection: 'EPSG:3857'\n  };\n\n  public store = new FeatureStore<FeatureWithMeasure>([], {map: this.map});\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/measure\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-measurer [store]=\"store\" [map]=\"map\"></igo-measurer>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule, IgoMeasureModule } from '@igo2/geo';\n\nimport { AppMeasureComponent } from './measure.component';\nimport { AppMeasureRoutingModule } from './measure-routing.module';\n\n@NgModule({\n  declarations: [AppMeasureComponent],\n  imports: [\n    AppMeasureRoutingModule,\n    MatCardModule,\n    IgoMapModule,\n    IgoMeasureModule\n  ],\n  exports: [AppMeasureComponent]\n})\nexport class AppMeasureModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppDrawComponent } from './draw.component';\n\nconst routes: Routes = [\n  {\n    path: 'draw',\n    component: AppDrawComponent\n  }\n];\n\nexport const AppDrawRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  FeatureStore,\n  FeatureWithDraw,\n  MapService\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-draw',\n  templateUrl: './draw.component.html',\n  styleUrls: ['./draw.component.scss']\n})\nexport class AppDrawComponent {\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6,\n    projection: 'EPSG:3857'\n  };\n\n  public store = new FeatureStore<FeatureWithDraw>([], {map: this.map});\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mapService: MapService\n  ) {\n    this.mapService.setMap(this.map);\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/draw\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-draw [store]=\"store\" [map]=\"map\"></igo-draw>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule, IgoDrawModule } from '@igo2/geo';\n\nimport { AppDrawComponent } from './draw.component';\nimport { AppDrawRoutingModule } from './draw-routing.module';\n\n@NgModule({\n  declarations: [AppDrawComponent],\n  imports: [\n    AppDrawRoutingModule,\n    MatCardModule,\n    IgoMapModule,\n    IgoDrawModule\n  ],\n  exports: [AppDrawComponent]\n})\nexport class AppDrawModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Query</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/query\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser\n    [map]=\"map\"\n    [view]=\"view\"\n    igoOverlay\n    igoQuery\n    [queryFeatures]=\"true\"\n    (query)=\"handleQueryResults($event)\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Details\">\n    <ng-container *ngIf=\"feature$ | async as feature\">\n      <h1>Query Title : <span style=\"background-color: #e0e0e0;\">{{getTitle(feature)}}</span></h1>\n      <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n    </ng-container>\n  </igo-panel>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppQueryComponent } from './query.component';\n\nconst routes: Routes = [\n  {\n    path: 'query',\n    component: AppQueryComponent\n  }\n];\n\nexport const AppQueryRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport olFeature from 'ol/Feature';\nimport olPoint from 'ol/geom/Point';\nimport olPolygon from 'ol/geom/Polygon';\nimport olLineString from 'ol/geom/LineString';\nimport * as olproj from 'ol/proj';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  FeatureDataSource,\n  DataSourceService,\n  LayerService,\n  OverlayService,\n  Feature,\n  QueryableDataSourceOptions,\n  QueryFormat,\n  QueryHtmlTarget,\n  SearchResult,\n  FeatureMotion\n} from '@igo2/geo';\n\nimport { getEntityTitle } from '@igo2/common';\n\n@Component({\n  selector: 'app-query',\n  templateUrl: './query.component.html',\n  styleUrls: ['./query.component.scss']\n})\nexport class AppQueryComponent {\n  public feature$ = new BehaviorSubject<Feature>(undefined);\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private overlayService: OverlayService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n        queryable: true,\n        queryTitle: 'num_rts',\n        params: {\n          layers: 'bgr_v_sous_route_res_sup_act',\n          version: '1.3.0'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n        queryable: true,\n        queryFormat: QueryFormat.HTMLGML2,\n        queryHtmlTarget: QueryHtmlTarget.IFRAME,\n        params: {\n          layers: 'bgr_v_sous_route_res_sup_act',\n          version: '1.3.0'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS html with a pre call in GML',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector',\n        queryable: true,\n        queryTitle: 'So beautiful ${name}',\n        sourceFields: [\n          { name: 'name', alias: 'Alias name' },\n          { name: 'description', alias: 'Alias description' }\n        ]\n      } as QueryableDataSourceOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Vector Layer',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n        this.addFeatures(dataSource as FeatureDataSource);\n      });\n  }\n\n  addFeatures(dataSource: FeatureDataSource) {\n    const feature1 = new olFeature({\n      name: 'feature1',\n      geometry: new olLineString([\n        olproj.transform([-72, 47.8], 'EPSG:4326', 'EPSG:3857'),\n        olproj.transform([-73.5, 47.4], 'EPSG:4326', 'EPSG:3857'),\n        olproj.transform([-72.4, 48.6], 'EPSG:4326', 'EPSG:3857')\n      ]),\n    });\n\n    const feature2 = new olFeature({\n      name: 'feature2',\n      geometry: new olPoint(\n        olproj.transform([-73, 46.6], 'EPSG:4326', 'EPSG:3857')\n      ),\n    });\n\n    const feature3 = new olFeature({\n      name: 'feature3',\n      geometry: new olPolygon([\n        [\n          olproj.transform([-71, 46.8], 'EPSG:4326', 'EPSG:3857'),\n          olproj.transform([-73, 47], 'EPSG:4326', 'EPSG:3857'),\n          olproj.transform([-71.2, 46.6], 'EPSG:4326', 'EPSG:3857')\n        ]\n      ]),\n    });\n\n    dataSource.ol.addFeatures([feature1, feature2, feature3]);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Vector tile with custom getfeatureinfo url',\n        visible: true,\n        sourceOptions: {\n          type: 'mvt',\n          url:\n            'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\n          queryable: true,\n          queryUrl: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=SDA_REGION_S_20K&LAYERS=SDA_REGION_S_20K&DPI=96&MAP_RESOLUTION=96&FORMAT_OPTIONS=dpi%3A96&INFO_FORMAT=geojson&FEATURE_COUNT=5&I=50&J=50&CRS=EPSG:{srid}&STYLES=&WIDTH=101&HEIGHT=101&BBOX={xmin},{ymin},{xmax},{ymax}',\n          queryLayerFeatures: false,\n          queryFormat: 'geojson'\n        },\n        mapboxStyle: {\n          url: 'assets/mapboxStyleExample-vectortile.json',\n          source: 'ahocevar'\n        }\n      } as any)\n      .subscribe(l => this.map.addLayer(l));\n\n\n      this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/incendie.fcgi',\n        queryable: true,\n        queryUrl: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=SDA_MUNIC_S_20K&LAYERS=SDA_MUNIC_S_20K&DPI=96&MAP_RESOLUTION=96&FORMAT_OPTIONS=dpi%3A96&INFO_FORMAT=geojson&FEATURE_COUNT=5&I=50&J=50&CRS=EPSG:{srid}&STYLES=&WIDTH=101&HEIGHT=101&BBOX={xmin},{ymin},{xmax},{ymax}',\n        queryFormat: 'geojson',\n        params: {\n          layers: 'caserne',\n          version: '1.3.0'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS with custom getfeatureinfo url',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n      });\n\n  }\n\n  handleQueryResults(results) {\n    const features: Feature[] = results.features;\n    let feature: Feature;\n    if (features.length && features[0]) {\n      feature = features[0];\n      this.feature$.next(feature);\n      this.map.queryResultsOverlay.setFeatures([feature], FeatureMotion.None);\n    }\n\n  }\n\n  getTitle(result: SearchResult) {\n    return getEntityTitle(result);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoOverlayModule,\n  IgoQueryModule,\n  IgoFeatureModule\n} from '@igo2/geo';\n\nimport { AppQueryComponent } from './query.component';\nimport { AppQueryRoutingModule } from './query-routing.module';\n\n@NgModule({\n  declarations: [AppQueryComponent],\n  imports: [\n    AppQueryRoutingModule,\n    CommonModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoOverlayModule,\n    IgoQueryModule,\n    IgoFeatureModule\n  ],\n  exports: [AppQueryComponent]\n})\nexport class AppQueryModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppCatalogComponent } from './catalog.component';\n\nconst routes: Routes = [\n  {\n    path: 'catalog',\n    component: AppCatalogComponent\n  }\n];\n\nexport const AppCatalogRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit } from '@angular/core';\n\nimport { LanguageService, ConfigService, StorageService } from '@igo2/core';\nimport { IgoMap, LayerService, Catalog, CatalogItem, CatalogService } from '@igo2/geo';\nimport { EntityStore } from '@igo2/common';\n\n@Component({\n  selector: 'app-catalog',\n  templateUrl: './catalog.component.html',\n  styleUrls: ['./catalog.component.scss']\n})\nexport class AppCatalogComponent implements OnInit {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  public catalogStore = new EntityStore<Catalog>([]);\n\n  public catalogItemStore = new EntityStore<CatalogItem>([]);\n\n  constructor(\n    private configService: ConfigService,\n    private languageService: LanguageService,\n    private layerService: LayerService,\n    private catalogService: CatalogService,\n    private storageService: StorageService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe(layer => this.map.addLayer(layer));\n\n    this.loadCatalogs();\n  }\n\n  /**\n   * When the selected catalog changes, toggle the the CatalogBrowser tool.\n   * @internal\n   * @param event Select event\n   */\n  onCatalogSelectChange(event: {selected: boolean; catalog: Catalog}) {\n    this.loadCatalogItems(event.catalog);\n  }\n\n  /**\n   * Get all the available catalogs from the CatalogService and\n   * load them into the store.\n   */\n  private loadCatalogs() {\n    this.catalogService.loadCatalogs()\n      .subscribe((catalogs: Catalog[]) => {\n        this.catalogStore.clear();\n        this.catalogStore.load(catalogs.concat((this.storageService.get('addedCatalogs') || []) as Catalog[]));\n      });\n  }\n\n  /**\n   * Get the selected catalog's items from the CatalogService and\n   * load them into the store.\n   * @param catalog Selected catalog\n   */\n  private loadCatalogItems(catalog: Catalog) {\n    this.catalogService.loadCatalogItems(catalog)\n      .subscribe((items: CatalogItem[]) => {\n        this.catalogItemStore.clear();\n        this.catalogItemStore.load(items);\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Catalog</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: ConfigService, LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/catalog\">code of this example</a><br>\n    See catalog section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Catalog Library\">\n    <igo-catalog-library\n      [store]=\"catalogStore\"\n      (catalogSelectChange)=\"onCatalogSelectChange($event)\">\n    </igo-catalog-library>\n  </igo-panel>\n\n  <igo-panel title=\"Catalog Browser\">\n    <igo-catalog-browser\n      [store]=\"catalogItemStore\"\n      [map]=\"map\">\n    </igo-catalog-browser>\n  </igo-panel>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoConfigModule, provideConfigOptions } from '@igo2/core';\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoCatalogModule } from '@igo2/geo';\n\nimport { environment } from '../../../environments/environment';\nimport { AppCatalogComponent } from './catalog.component';\nimport { AppCatalogRoutingModule } from './catalog-routing.module';\n\n@NgModule({\n  declarations: [AppCatalogComponent],\n  imports: [\n    CommonModule,\n    AppCatalogRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    IgoConfigModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoCatalogModule\n  ],\n  exports: [AppCatalogComponent],\n  providers: [\n    provideConfigOptions({\n      default: environment.igo\n    })\n  ]\n})\nexport class AppCatalogModule {}\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid context');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n      super('Failed to read file');\n      Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n      super('Nothing to import');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n      super('File is too large');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n      super('Invalid SRS definition');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n","export enum TypePermission {\n  null,\n  read,\n  write\n}\n\nexport enum Scope {\n  public,\n  protected,\n  private\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\n\nimport { BehaviorSubject, Observable, of, Subject } from 'rxjs';\nimport {\n  map,\n  tap,\n  catchError,\n  debounceTime,\n  mergeMap,\n  first,\n  skip\n} from 'rxjs/operators';\n\nimport olPoint from 'ol/geom/Point';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport Cluster from 'ol/source/Cluster';\nimport olVectorSource from 'ol/source/Vector';\n\nimport { Tool } from '@igo2/common';\nimport { uuid, ObjectUtils } from '@igo2/utils';\nimport {\n  ConfigService,\n  RouteService,\n  Message,\n  MessageService,\n  LanguageService,\n  StorageService\n} from '@igo2/core';\n\nimport { AuthService } from '@igo2/auth';\nimport type { IgoMap, Layer } from '@igo2/geo';\n\nimport { TypePermission } from './context.enum';\nimport {\n  ContextsList,\n  ContextServiceOptions,\n  Context,\n  DetailedContext,\n  ContextMapView,\n  ContextPermission,\n  ContextProfils\n} from './context.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextService {\n  public context$ = new BehaviorSubject<DetailedContext>(undefined);\n  public contexts$ = new BehaviorSubject<ContextsList>({ ours: [] });\n  public defaultContextId$ = new BehaviorSubject<string>(undefined);\n  public editedContext$ = new BehaviorSubject<DetailedContext>(undefined);\n  public importedContext: Array<DetailedContext> = [];\n  public toolsChanged$ = new Subject<DetailedContext>();\n  private mapViewFromRoute: ContextMapView = {};\n  private options: ContextServiceOptions;\n  private baseUrl: string;\n\n  // Until the ContextService is completely refactored, this is needed\n  // to track the current tools\n  private tools: Tool[];\n  private toolbar: string[];\n\n  get defaultContextUri(): string {\n    return this.storageService.get('favorite.context.uri') as string || this._defaultContextUri || this.options.defaultContextUri;\n  }\n  set defaultContextUri(uri: string) {\n    this._defaultContextUri = uri;\n  }\n  private _defaultContextUri: string;\n\n  constructor(\n    private http: HttpClient,\n    private authService: AuthService,\n    private languageService: LanguageService,\n    private config: ConfigService,\n    private messageService: MessageService,\n    private storageService: StorageService,\n    @Optional() private route: RouteService\n  ) {\n    this.options = Object.assign(\n      {\n        basePath: 'contexts',\n        contextListFile: '_contexts.json',\n        defaultContextUri: '_default'\n      },\n      this.config.getConfig('context')\n    );\n\n    this.baseUrl = this.options.url;\n\n    this.readParamsFromRoute();\n\n    if (this.authService.hasAuthService) {\n      this.authService.logged$.subscribe((logged) => {\n        if (logged) {\n          this.contexts$.pipe(skip(1), first()).subscribe((c) => {\n            this.handleContextsChange();\n          });\n          this.loadContexts();\n        }\n      });\n    } else {\n      this.loadContexts();\n      this.handleContextsChange(false);\n    }\n  }\n\n  get(permissions?: string[], hidden?: boolean): Observable<ContextsList> {\n    let url = this.baseUrl + '/contexts';\n    if (permissions && this.authService.authenticated) {\n      url += '?permission=' + permissions.join();\n      if (hidden) {\n        url += '&hidden=true';\n      }\n    }\n    return this.http.get<ContextsList>(url);\n  }\n\n  getById(id: string): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.get<Context>(url);\n  }\n\n  getDetails(id: string): Observable<DetailedContext> {\n    const url = `${this.baseUrl}/contexts/${id}/details`;\n    return this.http.get<DetailedContext>(url).pipe(\n      catchError((res) => {\n        this.handleError(res, id);\n        throw res;\n      })\n    );\n  }\n\n  getDefault(): Observable<DetailedContext> {\n    if (this.authService.authenticated) {\n      const url = this.baseUrl + '/contexts/default';\n      return this.http.get<DetailedContext>(url).pipe(\n        tap((context) => {\n          this.defaultContextId$.next(context.id);\n        })\n      );\n    } else {\n      const uri = this.storageService.get('favorite.context.uri') as string;\n      this.defaultContextId$.next(uri);\n      return this.getContextByUri(uri);\n    }\n\n  }\n\n  getProfilByUser(): Observable<ContextProfils[]> {\n    if (this.baseUrl) {\n      const url = this.baseUrl + '/profils?';\n      return this.http.get<ContextProfils[]>(url);\n    }\n    return of([]);\n  }\n\n  setDefault(id: string): Observable<any> {\n    if (this.authService.authenticated) {\n      const url = this.baseUrl + '/contexts/default';\n      return this.http.post(url, { defaultContextId: id });\n    } else {\n      this.storageService.set('favorite.context.uri', id);\n      return of(undefined);\n    }\n  }\n\n  hideContext(id: string) {\n    const url = this.baseUrl + '/contexts/' + id + '/hide';\n    return this.http.post(url, {});\n  }\n\n  showContext(id: string) {\n    const url = this.baseUrl + '/contexts/' + id + '/show';\n    return this.http.post(url, {});\n  }\n\n  delete(id: string, imported = false): Observable<void> {\n    const contexts: ContextsList = { ours: [] };\n    Object.keys(this.contexts$.value).forEach(\n      (key) =>\n        (contexts[key] = this.contexts$.value[key].filter((c) => c.id !== id))\n    );\n\n    if (imported) {\n      this.importedContext = this.importedContext.filter((c) => c.id !== id);\n      return of(this.contexts$.next(contexts));\n    }\n\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.delete<void>(url).pipe(\n      tap((res) => {\n        this.contexts$.next(contexts);\n      })\n    );\n  }\n\n  create(context: DetailedContext): Observable<Context> {\n    const url = this.baseUrl + '/contexts';\n    return this.http.post<Context>(url, context).pipe(\n      map((contextCreated) => {\n        if (this.authService.authenticated) {\n          contextCreated.permission = TypePermission[TypePermission.write];\n        } else {\n          contextCreated.permission = TypePermission[TypePermission.read];\n        }\n        this.contexts$.value.ours.unshift(contextCreated);\n        this.contexts$.next(this.contexts$.value);\n        return contextCreated;\n      })\n    );\n  }\n\n  clone(id: string, properties = {}): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id + '/clone';\n    return this.http.post<Context>(url, properties).pipe(\n      map((contextCloned) => {\n        contextCloned.permission = TypePermission[TypePermission.write];\n        this.contexts$.value.ours.unshift(contextCloned);\n        this.contexts$.next(this.contexts$.value);\n        return contextCloned;\n      })\n    );\n  }\n\n  update(id: string, context: Context): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.patch<Context>(url, context);\n  }\n\n  // =================================================================\n\n  addToolAssociation(contextId: string, toolId: string): Observable<void> {\n    const url = `${this.baseUrl}/contexts/${contextId}/tools`;\n    const association = {\n      toolId\n    };\n    return this.http.post<void>(url, association);\n  }\n\n  deleteToolAssociation(contextId: string, toolId: string): Observable<any> {\n    const url = `${this.baseUrl}/contexts/${contextId}/tools/${toolId}`;\n    return this.http.delete(url);\n  }\n\n  getPermissions(id: string): Observable<ContextPermission[]> {\n    const url = this.baseUrl + '/contexts/' + id + '/permissions';\n    return this.http.get<ContextPermission[]>(url);\n  }\n\n  addPermissionAssociation(\n    contextId: string,\n    profil: string,\n    type: TypePermission\n  ): Observable<ContextPermission[]> {\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions`;\n    const association = {\n      profil,\n      typePermission: type\n    };\n\n    return this.http.post<ContextPermission[]>(url, association).pipe(\n      catchError((res) => {\n        this.handleError(res, undefined, true);\n        throw [res]; // TODO Not sure about this.\n      })\n    );\n  }\n\n  deletePermissionAssociation(\n    contextId: string,\n    permissionId: string\n  ): Observable<void> {\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions/${permissionId}`;\n    return this.http.delete<void>(url);\n  }\n\n  // ======================================================================\n\n  getLocalContexts(): Observable<ContextsList> {\n    const url = this.getPath(this.options.contextListFile);\n    return this.http.get<ContextsList>(url).pipe(\n      map((res: any) => {\n        return { ours: res };\n      })\n    );\n  }\n\n  getLocalContext(uri: string): Observable<DetailedContext> {\n    const url = this.getPath(`${uri}.json`);\n    return this.http.get<DetailedContext>(url).pipe(\n      mergeMap((res) => {\n        if (!res.base) {\n          return of(res);\n        }\n        const urlBase = this.getPath(`${res.base}.json`);\n        return this.http.get<DetailedContext>(urlBase).pipe(\n          map((resBase: DetailedContext) => {\n            const resMerge = res;\n            resMerge.map = ObjectUtils.mergeDeep(resBase.map, res.map);\n            resMerge.layers = (resBase.layers || [])\n              .concat(res.layers || [])\n              .reverse()\n              .filter(\n                (l, index, self) =>\n                  !l.id || self.findIndex((l2) => l2.id === l.id) === index\n              )\n              .reverse();\n            resMerge.toolbar = res.toolbar || resBase.toolbar;\n            resMerge.message = res.message || resBase.message;\n            resMerge.messages = res.messages || resBase.messages;\n            resMerge.tools = (res.tools || [])\n              .concat(resBase.tools || [])\n              .filter(\n                (t, index, self) =>\n                  self.findIndex((t2) => t2.name === t.name) === index\n              );\n            return resMerge;\n          }),\n          catchError((err) => {\n            this.handleError(err, uri);\n            throw err;\n          })\n        );\n      }),\n      catchError((err2) => {\n        this.handleError(err2, uri);\n        throw err2;\n      })\n    );\n  }\n\n  loadContexts(permissions?: string[], hidden?: boolean) {\n    let request;\n    if (this.baseUrl) {\n      request = this.get(permissions, hidden);\n    } else {\n      request = this.getLocalContexts();\n    }\n    request.subscribe((contexts) => {\n      contexts.ours = this.importedContext.concat(contexts.ours);\n      this.contexts$.next(contexts);\n    });\n  }\n\n  loadDefaultContext() {\n    const loadFct = (direct = false) => {\n      if (!direct && this.baseUrl && this.authService.authenticated) {\n        this.getDefault().subscribe(\n          (_context: DetailedContext) => {\n            this.defaultContextUri = _context.uri;\n            this.addContextToList(_context);\n            this.setContext(_context);\n          },\n          () => {\n            this.defaultContextId$.next(undefined);\n            this.loadContext(this.defaultContextUri);\n          }\n        );\n      } else {\n        this.loadContext(this.defaultContextUri);\n      }\n    };\n\n    if (this.route && this.route.options.contextKey) {\n      this.route.queryParams.pipe(debounceTime(100)).subscribe((params) => {\n        const contextParam = params[this.route.options.contextKey as string];\n        let direct = false;\n        if (contextParam) {\n          this.defaultContextUri = contextParam;\n          direct = true;\n        }\n        loadFct(direct);\n      });\n    } else {\n      loadFct();\n    }\n  }\n\n  loadContext(uri: string) {\n    const context = this.context$.value;\n\n    if (context && context.uri === uri) {\n      return;\n    }\n\n    this.getContextByUri(uri)\n      .pipe(first())\n      .subscribe(\n        (_context: DetailedContext) => {\n          this.addContextToList(_context);\n          this.setContext(_context);\n        },\n        (err) => {\n          if (uri !== this.options.defaultContextUri) {\n            this.loadContext(this.options.defaultContextUri);\n          }\n        }\n      );\n  }\n\n  setContext(context: DetailedContext) {\n    this.handleContextMessage(context);\n    const currentContext = this.context$.value;\n    if (currentContext && context && context.id === currentContext.id) {\n      if (context.map.view.keepCurrentView === undefined) {\n        context.map.view.keepCurrentView = true;\n      }\n      this.context$.next(context);\n      return;\n    }\n\n    if (!context.map) {\n      context.map = { view: {} };\n    }\n\n    Object.assign(context.map.view, this.mapViewFromRoute);\n\n    this.context$.next(context);\n  }\n\n  loadEditedContext(uri: string) {\n    this.getContextByUri(uri).subscribe((_context: DetailedContext) => {\n      this.setEditedContext(_context);\n    });\n  }\n\n  setEditedContext(context: DetailedContext) {\n    this.editedContext$.next(context);\n  }\n\n  getContextFromMap(igoMap: IgoMap, empty?: boolean): DetailedContext {\n    const view = igoMap.ol.getView();\n    const proj = view.getProjection().getCode();\n    const center: any = new olPoint(view.getCenter()).transform(\n      proj,\n      'EPSG:4326'\n    );\n\n    const context = {\n      uri: uuid(),\n      title: '',\n      scope: 'private',\n      map: {\n        view: {\n          center: center.getCoordinates(),\n          zoom: view.getZoom(),\n          projection: proj,\n          maxZoomOnExtent: igoMap.viewController.maxZoomOnExtent\n        }\n      },\n      layers: [],\n      tools: []\n    };\n\n    let layers = [];\n    if (empty === true) {\n      layers = igoMap.layers$\n        .getValue()\n        .filter(\n          (lay) =>\n            lay.baseLayer === true ||\n            lay.options.id === 'searchPointerSummaryId'\n        )\n        .sort((a, b) => a.zIndex - b.zIndex);\n    } else {\n      layers = igoMap.layers$.getValue().filter(lay => !lay.id.includes('WfsWorkspaceTableDest')).sort((a, b) => a.zIndex - b.zIndex);\n    }\n\n    let i = 0;\n    for (const l of layers) {\n      const layer: any = l;\n      const opts = {\n        id: layer.options.id ? String(layer.options.id) : undefined,\n        layerOptions: {\n          title: layer.options.title,\n          zIndex: ++i,\n          visible: layer.visible\n        },\n        sourceOptions: {\n          type: layer.dataSource.options.type,\n          params: layer.dataSource.options.params,\n          url: layer.dataSource.options.url,\n          queryable: layer.queryable\n        }\n      };\n      if (opts.sourceOptions.type) {\n        context.layers.push(opts);\n      }\n    }\n\n    context.tools = this.tools.map((tool) => {\n      return { id: String(tool.id), global: tool.global };\n    });\n\n    return context;\n  }\n\n  getContextFromLayers(\n    igoMap: IgoMap,\n    layers: Layer[],\n    name: string\n  ): DetailedContext {\n    const currentContext = this.context$.getValue();\n    const view = igoMap.ol.getView();\n    const proj = view.getProjection().getCode();\n    const center: any = new olPoint(view.getCenter()).transform(\n      proj,\n      'EPSG:4326'\n    );\n\n    const context = {\n      uri: name,\n      title: name,\n      map: {\n        view: {\n          center: center.getCoordinates(),\n          zoom: view.getZoom(),\n          projection: proj\n        }\n      },\n      layers: [],\n      toolbar: [],\n      tools: [],\n      extraFeatures: []\n    };\n\n    const currentLayers = igoMap.layers$.getValue();\n    context.layers = currentLayers\n      .filter((l) => l.baseLayer)\n      .map((l) => {\n        return {\n          baseLayer: true,\n          sourceOptions: l.options.sourceOptions,\n          title: l.options.title,\n          visible: l.visible\n        };\n      });\n\n    layers.forEach((layer) => {\n      const layerFound = currentContext.layers.find(\n        (contextLayer) =>\n          layer.id === contextLayer.source.id && !contextLayer.baseLayer\n      );\n\n      if (layerFound) {\n        let layerStyle = layerFound[`style`];\n        if (layerFound[`styleByAttribute`]) {\n          layerStyle = undefined;\n        } else if (layerFound[`clusterBaseStyle`]) {\n          layerStyle = undefined;\n          delete layerFound.sourceOptions[`source`];\n          delete layerFound.sourceOptions[`format`];\n        }\n        const opts = {\n          baseLayer: layerFound.baseLayer,\n          title: layer.options.title,\n          zIndex: layer.zIndex,\n          styleByAttribute: layerFound[`styleByAttribute`],\n          clusterBaseStyle: layerFound[`clusterBaseStyle`],\n          style: layerStyle,\n          clusterParam: layerFound[`clusterParam`],\n          visible: layer.visible,\n          opacity: layer.opacity,\n          sourceOptions: layerFound.sourceOptions\n        };\n        context.layers.push(opts);\n      } else {\n        if (!(layer.ol.getSource() instanceof olVectorSource)) {\n          const catalogLayer = layer.options;\n          catalogLayer.zIndex = layer.zIndex;\n          delete catalogLayer.source;\n          context.layers.push(catalogLayer);\n        } else {\n          let features;\n          const writer = new GeoJSON();\n          if (layer.ol.getSource() instanceof Cluster) {\n            const clusterSource = layer.ol.getSource() as Cluster;\n            features = writer.writeFeatures(\n              clusterSource.getFeatures(),\n              {\n                dataProjection: 'EPSG:4326',\n                featureProjection: 'EPSG:3857'\n              }\n            );\n          } else {\n            const source = layer.ol.getSource() as any;\n            features = writer.writeFeatures(\n              source.getFeatures(),\n              {\n                dataProjection: 'EPSG:4326',\n                featureProjection: 'EPSG:3857'\n              }\n            );\n          }\n          features = JSON.parse(features);\n          features.name = layer.options.title;\n          context.extraFeatures.push(features);\n        }\n      }\n    });\n\n    context.toolbar = this.toolbar;\n    context.tools = this.tools;\n\n    return context;\n  }\n\n  setTools(tools: Tool[]) {\n    this.tools = tools;\n  }\n\n  setToolbar(toolbar: string[]) {\n    this.toolbar = toolbar;\n  }\n\n  private handleContextMessage(context: DetailedContext) {\n    if (this.context$.value && context.uri && this.context$.value.uri !== context.uri) {\n      this.messageService.removeAllAreNotError();\n    }\n\n    context.messages = context.messages ? context.messages : [];\n    context.messages.push(context.message);\n    context.messages.map(message => {\n      if (message) {\n        message.title = message.title\n          ? this.languageService.translate.instant(message.title)\n          : undefined;\n        message.text = message.text\n          ? this.languageService.translate.instant(message.text)\n          : undefined;\n        this.messageService.message(message as Message);\n      }\n    });\n  }\n\n  private getContextByUri(uri: string): Observable<DetailedContext> {\n    if (this.baseUrl) {\n      let contextToLoad;\n      for (const key of Object.keys(this.contexts$.value)) {\n        contextToLoad = this.contexts$.value[key].find((c) => {\n          return c.uri === uri;\n        });\n        if (contextToLoad) {\n          break;\n        }\n      }\n\n      if (contextToLoad && contextToLoad.imported) {\n        return of(contextToLoad);\n      }\n\n      // TODO : use always id or uri\n      const id = contextToLoad ? contextToLoad.id : uri;\n      return this.getDetails(id);\n    }\n\n    const importedContext = this.contexts$.value.ours.find((currentContext) => {\n      return currentContext.uri === uri && currentContext.imported === true;\n    });\n\n    if (importedContext) {\n      return of(importedContext);\n    } else {\n      return this.getLocalContext(uri);\n    }\n  }\n\n  getContextLayers(igoMap: IgoMap) {\n    const layers: Layer[] = [];\n    const mapLayers = igoMap.layers$.getValue();\n    mapLayers.forEach((layer) => {\n      if (!layer.baseLayer && layer.options.id !== 'searchPointerSummaryId') {\n        layers.push(layer);\n      }\n    });\n    return layers;\n  }\n\n  private readParamsFromRoute() {\n    if (!this.route) {\n      return;\n    }\n\n    this.route.queryParams.subscribe((params) => {\n      const centerKey = this.route.options.centerKey;\n      if (centerKey && params[centerKey as string]) {\n        const centerParams = params[centerKey as string];\n        this.mapViewFromRoute.center = centerParams.split(',').map(Number);\n      }\n\n      const projectionKey = this.route.options.projectionKey;\n      if (projectionKey && params[projectionKey as string]) {\n        const projectionParam = params[projectionKey as string];\n        this.mapViewFromRoute.projection = projectionParam;\n      }\n\n      const zoomKey = this.route.options.zoomKey;\n      if (zoomKey && params[zoomKey as string]) {\n        const zoomParam = params[zoomKey as string];\n        this.mapViewFromRoute.zoom = Number(zoomParam);\n      }\n    });\n  }\n\n  private getPath(file: string) {\n    const basePath = this.options.basePath.replace(/\\/$/, '');\n\n    return `${basePath}/${file}`;\n  }\n\n  private handleError(\n    error: HttpErrorResponse,\n    uri: string,\n    permissionError?: boolean\n  ) {\n    const context = this.contexts$.value.ours.find((obj) => obj.uri === uri);\n    const titleContext = context ? context.title : uri;\n    error.error.title = this.languageService.translate.instant(\n      'igo.context.contextManager.invalid.title'\n    );\n\n    error.error.message = this.languageService.translate.instant(\n      'igo.context.contextManager.invalid.text',\n      { value: titleContext }\n    );\n\n    error.error.toDisplay = true;\n\n    if (permissionError) {\n      error.error.title = this.languageService.translate.instant(\n        'igo.context.contextManager.errors.addPermissionTitle'\n      );\n      error.error.message = this.languageService.translate.instant(\n        'igo.context.contextManager.errors.addPermission'\n      );\n    }\n    this.messageService.error(error.error.message, error.error.title);\n  }\n\n  private handleContextsChange(\n    keepCurrentContext = true\n  ) {\n    const context = this.context$.value;\n    const editedContext = this.editedContext$.value;\n    if (!context || context.uri === this.options.defaultContextUri) {\n      keepCurrentContext = false;\n    }\n    if (!keepCurrentContext || !this.findContext(context)) {\n      this.defaultContextUri = undefined;\n      this.loadDefaultContext();\n    } else {\n      this.getContextByUri(context.uri)\n        .pipe(first())\n        .subscribe(\n          (newContext: DetailedContext) => {\n            this.toolsChanged$.next(newContext);\n          }\n        );\n\n      if (this.baseUrl && this.authService.authenticated) {\n        this.getDefault().subscribe();\n      }\n    }\n    const editedFound = this.findContext(editedContext);\n    if (!editedFound || editedFound.permission !== 'write') {\n      this.setEditedContext(undefined);\n    }\n  }\n\n  private addContextToList(context: Context) {\n    const contextFound = this.findContext(context);\n    if (!contextFound) {\n      const contextSimplifie = {\n        id: context.id,\n        uri: context.uri,\n        title: context.title,\n        scope: context.scope,\n        permission: TypePermission[TypePermission.read]\n      };\n\n      if (this.contexts$.value && this.contexts$.value.public) {\n        this.contexts$.value.public.push(contextSimplifie);\n        this.contexts$.next(this.contexts$.value);\n      }\n    }\n  }\n\n  private findContext(context: Context) {\n    if (!context) {\n      return false;\n    }\n\n    const contexts = this.contexts$.value;\n    let found;\n    for (const key of Object.keys(contexts)) {\n      const value = contexts[key];\n      found = value.find(\n        (c) =>\n          (context.id && c.id === context.id) ||\n          (context.uri && c.uri === context.uri)\n      );\n      if (found) {\n        break;\n      }\n    }\n\n    return found;\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { ContextImportExportComponent } from './context-import-export/context-import-export.component';\nimport { IgoSpinnerModule } from '@igo2/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\n@NgModule({\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatDividerModule,\n    MatTabsModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatCheckboxModule,\n    IgoLanguageModule,\n    IgoSpinnerModule,\n    MatTooltipModule,\n  ],\n  exports: [\n    ContextImportExportComponent\n  ],\n  declarations: [\n    ContextImportExportComponent\n  ]\n})\nexport class IgoContextImportExportModule {\n  static forRoot(): ModuleWithProviders<IgoContextImportExportModule> {\n    return {\n      ngModule: IgoContextImportExportModule\n    };\n  }\n}\n","import { Directive, OnInit, OnDestroy } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { filter } from 'rxjs/operators';\n\nimport { MapViewOptions, MapBrowserComponent, MapControlsOptions, MapScaleLineOptions } from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { ContextService } from './context.service';\nimport { DetailedContext, ContextMapView } from './context.interface';\nimport { MediaService } from '@igo2/core';\n\n@Directive({\n  selector: '[igoMapContext]'\n})\nexport class MapContextDirective implements OnInit, OnDestroy {\n  private component: MapBrowserComponent;\n  private context$$: Subscription;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    component: MapBrowserComponent,\n    private contextService: ContextService,\n    private mediaService: MediaService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.context$$ = this.contextService.context$\n      .pipe(filter(context => context !== undefined))\n      .subscribe(context => this.handleContextChange(context));\n  }\n\n  ngOnDestroy() {\n    this.context$$.unsubscribe();\n  }\n\n  private handleContextChange(context: DetailedContext) {\n    if (context.map === undefined) {\n      return;\n    }\n\n    // This creates a new ol.Map when the context changes. Doing that\n    // allows the print tool to work properly even when the map's canvas\n    // has been tainted (CORS) with the layers of another context. This could\n    // have some side effects such as unbinding all listeners on the first map.\n    // A better solution would be to create a new map (preview) before\n    // printing and avoid the tainted canvas issue. This will come later so\n    // this snippet of code is kept here in case it takes too long becomes\n    // an issue\n\n    // const target = this.component.map.ol.getTarget();\n    // this.component.map.ol.setTarget(undefined);\n    // this.component.map.init();\n    // this.component.map.ol.setTarget(target);\n\n    const viewContext: ContextMapView = context.map.view;\n    if (!this.component.view || viewContext.keepCurrentView !== true) {\n      this.component.view = viewContext as MapViewOptions;\n    }\n    if (this.component.map.geolocationController) {\n      this.component.map.geolocationController.updateGeolocationOptions(viewContext);\n    }\n\n    const controlsContext: MapControlsOptions = context.map.controls;\n    if (!this.component.controls && controlsContext) {\n      if (this.mediaService.isMobile()) {\n        if (typeof(controlsContext.scaleLine) !== 'boolean') {\n          const scaleLineOption = controlsContext.scaleLine as MapScaleLineOptions;\n          if (!scaleLineOption.minWidth) {\n            scaleLineOption.minWidth = Math.min(64, scaleLineOption.minWidth);\n            controlsContext.scaleLine = scaleLineOption;\n          }\n        }\n      }\n      this.component.controls = controlsContext;\n    }\n  }\n}\n","import { Directive, OnInit, OnDestroy, Optional, Input } from '@angular/core';\n\nimport { Subscription, merge } from 'rxjs';\nimport { buffer, debounceTime, filter } from 'rxjs/operators';\n\nimport { RouteService, ConfigService } from '@igo2/core';\nimport {\n  MapBrowserComponent,\n  Layer,\n  LayerService,\n  LayerOptions,\n  StyleListService,\n  StyleService\n} from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { ContextService } from './context.service';\nimport { DetailedContext } from './context.interface';\nimport {\n  addImportedFeaturesToMap,\n  addImportedFeaturesStyledToMap\n} from '../../context-import-export/shared/context-import.utils';\nimport GeoJSON from 'ol/format/GeoJSON';\n\n@Directive({\n  selector: '[igoLayerContext]'\n})\nexport class LayerContextDirective implements OnInit, OnDestroy {\n  private context$$: Subscription;\n  private queryParams: any;\n\n  private contextLayers: Layer[] = [];\n\n  @Input() removeLayersOnContextChange: boolean = true;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    private component: MapBrowserComponent,\n    private contextService: ContextService,\n    private layerService: LayerService,\n    private configService: ConfigService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    @Optional() private route: RouteService\n  ) {}\n\n  ngOnInit() {\n    this.context$$ = this.contextService.context$\n      .pipe(filter((context) => context !== undefined))\n      .subscribe((context) => this.handleContextChange(context));\n\n    if (\n      this.route &&\n      this.route.options.visibleOnLayersKey &&\n      this.route.options.visibleOffLayersKey &&\n      this.route.options.contextKey\n    ) {\n      const queryParams$$ = this.route.queryParams.subscribe((params) => {\n        if (Object.keys(params).length > 0) {\n          this.queryParams = params;\n          queryParams$$.unsubscribe();\n        }\n      });\n    }\n  }\n\n  ngOnDestroy() {\n    this.context$$.unsubscribe();\n  }\n\n  private handleContextChange(context: DetailedContext) {\n    if (context.layers === undefined) {\n      return;\n    }\n    if (this.removeLayersOnContextChange === true) {\n      this.map.removeAllLayers();\n    } else {\n      this.map.removeLayers(this.contextLayers);\n    }\n    this.contextLayers = [];\n\n    const layersAndIndex$ = merge(\n      ...context.layers.map((layerOptions: LayerOptions, index: number) => {\n        return this.layerService.createAsyncLayer(layerOptions, context.uri);\n      })\n    );\n\n    layersAndIndex$\n      .pipe(buffer(layersAndIndex$.pipe(debounceTime(500))))\n      .subscribe((layers: Layer[]) => {\n        layers = layers\n          .filter((layer: Layer) => layer !== undefined)\n          .map((layer) => {\n            layer.visible = this.computeLayerVisibilityFromUrl(layer);\n            layer.zIndex = layer.zIndex;\n\n            return layer;\n          });\n\n        this.contextLayers.concat(layers);\n        this.map.addLayers(layers);\n\n        if (context.extraFeatures) {\n          context.extraFeatures.forEach((featureCollection) => {\n            const format = new GeoJSON();\n            const title = featureCollection.name;\n            featureCollection = JSON.stringify(featureCollection);\n            featureCollection = format.readFeatures(featureCollection, {\n              dataProjection: 'EPSG:4326',\n              featureProjection: 'EPSG:3857'\n            });\n            if (!this.configService.getConfig('importWithStyle')) {\n              addImportedFeaturesToMap(featureCollection, this.map, title);\n            } else {\n              addImportedFeaturesStyledToMap(\n                featureCollection,\n                this.map,\n                title,\n                this.styleListService,\n                this.styleService\n              );\n            }\n          });\n        }\n      });\n  }\n\n  private computeLayerVisibilityFromUrl(layer: Layer): boolean {\n    const params = this.queryParams;\n    const currentContext = this.contextService.context$.value.uri;\n    const currentLayerid: string = layer.id;\n\n    let visible = layer.visible;\n    if (!params || !currentLayerid) {\n      return visible;\n    }\n\n    const contextParams = params[this.route.options.contextKey as string];\n    if (contextParams === currentContext || !contextParams) {\n      let visibleOnLayersParams = '';\n      let visibleOffLayersParams = '';\n      let visiblelayers: string[] = [];\n      let invisiblelayers: string[] = [];\n\n      if (\n        this.route.options.visibleOnLayersKey &&\n        params[this.route.options.visibleOnLayersKey as string]\n      ) {\n        visibleOnLayersParams =\n          params[this.route.options.visibleOnLayersKey as string];\n      }\n      if (\n        this.route.options.visibleOffLayersKey &&\n        params[this.route.options.visibleOffLayersKey as string]\n      ) {\n        visibleOffLayersParams =\n          params[this.route.options.visibleOffLayersKey as string];\n      }\n\n      /* This order is important because to control whichever\n       the order of * param. First whe open and close everything.*/\n      if (visibleOnLayersParams === '*') {\n        visible = true;\n      }\n      if (visibleOffLayersParams === '*') {\n        visible = false;\n      }\n\n      // After, managing named layer by id (context.json OR id from datasource)\n      visiblelayers = visibleOnLayersParams.split(',');\n      invisiblelayers = visibleOffLayersParams.split(',');\n      if (visiblelayers.indexOf(currentLayerid) > -1 || visiblelayers.indexOf(currentLayerid.toString()) > -1) {\n        visible = true;\n      }\n      if (invisiblelayers.indexOf(currentLayerid) > -1 || invisiblelayers.indexOf(currentLayerid.toString()) > -1) {\n        visible = false;\n      }\n    }\n\n    return visible;\n  }\n}\n","import * as olStyle from 'ol/style';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  IgoMap,\n  VectorLayer,\n  QueryableDataSourceOptions,\n  StyleService,\n  StyleListService,\n  StyleByAttribute,\n  ClusterParam,\n  ClusterDataSourceOptions,\n  ClusterDataSource\n} from '@igo2/geo';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\nimport { ContextService } from '../../context-manager/shared/context.service';\nimport OlFeature from 'ol/Feature';\n\nexport function handleFileImportSuccess(\n  file: File,\n  context: DetailedContext,\n  messageService: MessageService,\n  languageService: LanguageService,\n  contextService: ContextService\n) {\n  if (Object.keys(context).length <= 0) {\n    handleNothingToImportError(file, messageService, languageService);\n    return;\n  }\n\n  const contextTitle = computeLayerTitleFromFile(file);\n\n  addContextToContextList(context, contextTitle, contextService);\n\n  const translate = languageService.translate;\n  const messageTitle = translate.instant(\n    'igo.context.contextImportExport.import.success.title'\n  );\n  const message = translate.instant(\n    'igo.context.contextImportExport.import.success.text',\n    {\n      value: contextTitle\n    }\n  );\n  messageService.success(message, messageTitle);\n}\n\nexport function handleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService,\n  sizeMb?: number\n) {\n  sizeMb = sizeMb ? sizeMb : 30;\n  const errMapping = {\n    'Invalid file': handleInvalidFileImportError,\n    'File is too large': handleSizeFileImportError,\n    'Failed to read file': handleUnreadbleFileImportError\n  };\n  errMapping[error.message](\n    file,\n    error,\n    messageService,\n    languageService,\n    sizeMb\n  );\n}\n\nexport function handleInvalidFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant(\n    'igo.context.contextImportExport.import.invalid.title'\n  );\n  const message = translate.instant(\n    'igo.context.contextImportExport.import.invalid.text',\n    {\n      value: file.name,\n      mimeType: file.type\n    }\n  );\n  messageService.error(message, title);\n}\n\nexport function handleSizeFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService,\n  sizeMb: number\n) {\n  const translate = languageService.translate;\n  const title = translate.instant(\n    'igo.context.contextImportExport.import.tooLarge.title'\n  );\n  const message = translate.instant(\n    'igo.context.contextImportExport.import.tooLarge.text',\n    {\n      value: file.name,\n      size: sizeMb\n    }\n  );\n  messageService.error(message, title);\n}\n\nexport function handleUnreadbleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant(\n    'igo.context.contextImportExport.import.unreadable.title'\n  );\n  const message = translate.instant(\n    'igo.context.contextImportExport.import.unreadable.text',\n    {\n      value: file.name\n    }\n  );\n  messageService.error(message, title);\n}\n\nexport function handleNothingToImportError(\n  file: File,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant(\n    'igo.context.contextImportExport.import.empty.title'\n  );\n  const message = translate.instant(\n    'igo.context.contextImportExport.import.empty.text',\n    {\n      value: file.name\n    }\n  );\n  messageService.error(message, title);\n}\n\nexport function addContextToContextList(\n  context: DetailedContext,\n  contextTitle: string,\n  contextService: ContextService\n) {\n  context.title = contextTitle;\n  context.imported = true;\n  contextService.contexts$.value.ours.unshift(context);\n  contextService.contexts$.next(contextService.contexts$.value);\n  contextService.importedContext.unshift(context);\n  contextService.loadContext(context.uri);\n}\n\nexport function getFileExtension(file: File): string {\n  return file.name.split('.').pop().toLowerCase();\n}\n\nexport function computeLayerTitleFromFile(file: File): string {\n  return file.name.substr(0, file.name.lastIndexOf('.'));\n}\n\nexport function addImportedFeaturesToMap(\n  olFeatures: OlFeature<OlGeometry>[],\n  map: IgoMap,\n  layerTitle: string\n): VectorLayer {\n  const r = Math.floor(Math.random() * 255);\n  const g = Math.floor(Math.random() * 255);\n  const b = Math.floor(Math.random() * 255);\n  const stroke = new olStyle.Stroke({\n    color: [r, g, b, 1],\n    width: 2\n  });\n\n  const fill = new olStyle.Fill({\n    color: [r, g, b, 0.4]\n  });\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n    type: 'vector',\n    queryable: true\n  };\n  const source = new FeatureDataSource(sourceOptions);\n  source.ol.addFeatures(olFeatures);\n  const layer = new VectorLayer({\n    title: layerTitle,\n    isIgoInternalLayer: true,\n    source,\n    style: new olStyle.Style({\n      stroke,\n      fill,\n      image: new olStyle.Circle({\n        radius: 5,\n        stroke,\n        fill\n      })\n    })\n  });\n  map.addLayer(layer);\n\n  return layer;\n}\n\nexport function addImportedFeaturesStyledToMap(\n  olFeatures: OlFeature<OlGeometry>[],\n  map: IgoMap,\n  layerTitle: string,\n  styleListService: StyleListService,\n  styleService: StyleService\n): VectorLayer {\n  let style;\n  let distance: number;\n\n  if (\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\n  ) {\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\n      layerTitle.toString() + '.styleByAttribute'\n    );\n\n    style = (feature, resolution) => {\n      return styleService.createStyleByAttribute(feature, styleByAttribute, resolution);\n    };\n  } else if (\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      layerTitle.toString() + '.clusterParam'\n    );\n    distance = styleListService.getStyleList(\n      layerTitle.toString() + '.distance'\n    );\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList(layerTitle.toString() + '.clusterStyle'), feature, resolution\n      );\n      return styleService.createClusterStyle(feature, resolution, clusterParam, baseStyle);\n    };\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\n    style = (feature, resolution) => styleService.createStyle(\n      styleListService.getStyleList(layerTitle.toString() + '.style'), feature, resolution\n    );\n  } else {\n    style = (feature, resolution) => styleService.createStyle(\n      styleListService.getStyleList('default.style'), feature, resolution\n    );\n  }\n  let source;\n\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\n    const sourceOptions: ClusterDataSourceOptions &\n      QueryableDataSourceOptions = {\n      distance,\n      type: 'cluster',\n      queryable: true\n    };\n    source = new ClusterDataSource(sourceOptions);\n    source.ol.source.addFeatures(olFeatures);\n  } else {\n    const sourceOptions: FeatureDataSourceOptions &\n      QueryableDataSourceOptions = {\n      type: 'vector',\n      queryable: true\n    };\n    source = new FeatureDataSource(sourceOptions);\n    source.ol.addFeatures(olFeatures);\n  }\n\n  const layer = new VectorLayer({\n    title: layerTitle,\n    isIgoInternalLayer: true,\n    source,\n    style\n  });\n  map.addLayer(layer);\n\n  return layer;\n}\n","export enum ContextListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\n","import { Component } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\n@Component({\n  selector: 'igo-bookmark-dialog',\n  templateUrl: './bookmark-dialog.component.html'\n})\nexport class BookmarkDialogComponent {\n  public title: string;\n\n  constructor(public dialogRef: MatDialogRef<BookmarkDialogComponent>) {}\n}\n","<h1 mat-dialog-title class=\"mat-typography\">{{ 'igo.context.bookmarkButton.dialog.title' |translate }}</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <mat-form-field>\n    <input matInput required autocomplete=\"off\"\n      maxlength=\"128\"\n      [placeholder]=\"'igo.context.bookmarkButton.dialog.placeholder' |translate\"\n      [(ngModel)]=\"title\">\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button mat-button color=\"primary\"\n         [disabled]=\"!title\"\n         (click)=\"dialogRef.close(title)\">\n    {{'igo.common.confirmDialog.confirmBtn' | translate}}\n  </button>\n  <button mat-button\n          (click)=\"dialogRef.close(false)\">\n    {{'igo.common.confirmDialog.cancelBtn' |translate}}\n  </button>\n</div>\n","<mat-list-item\n  class=\"mat-list-item\"\n  [ngClass]=\"{'mat-list-item-light': hidden}\">\n  <button mat-list-avatar\n    *ngIf=\"auth.authenticated\"\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"auth.authenticated ? ('igo.context.contextManager.favorite' | translate) : ''\"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\">\n    <mat-icon *ngIf=\"!context.iconImage\" svgIcon=\"{{context.icon ? context.icon : context.scope === 'public' ? 'earth' : 'star'}}\"></mat-icon>\n    <img *ngIf=\"context.iconImage\" [src]=\"context.iconImage\">\n  </button>\n  <button mat-list-avatar\n    *ngIf=\"!auth.authenticated && showFavorite\"\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"'igo.context.contextManager.favorite' | translate\"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\">\n    <mat-icon svgIcon=\"star\"></mat-icon>\n  </button>\n  <h4 matLine>{{context.title}}</h4>\n\n  <div *ngIf=\"auth.authenticated\"\n       igoStopPropagation\n       class=\"igo-actions-container\">\n\n     <button *ngIf=\"collapsed && selected && (context.permission === typePermission[typePermission.write] || context.imported)\"\n       class=\"save-button\"\n       mat-icon-button\n       [matTooltip]=\"'igo.context.contextManager.save' | translate\"\n       matTooltipShowDelay=\"500\"\n       [color]=\"color\"\n       (click)=\"save.emit(context)\">\n       <mat-icon svgIcon=\"content-save\"></mat-icon>\n     </button>\n\n    <div #actions class=\"igo-actions-expand-container\">\n\n      <button *ngIf=\"canShare && !context.imported\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.managePermissions' | translate\"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"managePermissions.emit(context)\">\n        <mat-icon svgIcon=\"account-arrow-right\"></mat-icon>\n      </button>\n\n      <!--button\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.manageTools' | translate\"\n        [color]=\"color\"\n        (click)=\"manageTools.emit(context)\">\n        <mat-icon svgIcon=\"widgets\"></mat-icon>\n      </button-->\n\n      <button *ngIf=\"!context.imported\"\n        class=\"clone-button\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.clone' | translate\"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"clone.emit(context)\">\n        <mat-icon svgIcon=\"content-copy\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"context.permission === typePermission[typePermission.write] && !context.imported\"\n        class=\"edit-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.edit' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"edit.emit(context)\">\n        <mat-icon svgIcon=\"pencil\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"!context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.hide' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"hide.emit(context)\">\n        <mat-icon svgIcon=\"eye\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.show' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"show.emit(context)\">\n        <mat-icon svgIcon=\"eye-off\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"context.permission === typePermission[typePermission.write] || context.imported\"\n        class=\"delete-button\"\n        mat-icon-button\n        color=\"warn\"\n        [matTooltip]=\"'igo.context.contextManager.delete' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"delete.emit(context)\">\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n    </div>\n\n    <button\n      class=\"actions-button\"\n      mat-icon-button\n      igoCollapse\n      [color]=\"color\"\n      [target]=\"actions\"\n      [collapsed]=collapsed\n      (click)=\"collapsed = !collapsed\">\n      <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\n    </button>\n\n  </div>\n\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { StorageService } from '@igo2/core';\nimport { AuthService } from '@igo2/auth';\nimport { TypePermission } from '../shared/context.enum';\nimport { DetailedContext } from '../shared/context.interface';\n\n@Component({\n  selector: 'igo-context-item',\n  templateUrl: './context-item.component.html',\n  styleUrls: ['./context-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ContextItemComponent {\n  public typePermission = TypePermission;\n  public color = 'primary';\n  public collapsed = true;\n\n  @Input() showFavorite: boolean = true;\n  @Input() context: DetailedContext;\n  @Input() default: boolean;\n  @Input() selected: boolean;\n\n  @Output() edit = new EventEmitter<DetailedContext>();\n  @Output() delete = new EventEmitter<DetailedContext>();\n  @Output() save = new EventEmitter<DetailedContext>();\n  @Output() clone = new EventEmitter<DetailedContext>();\n  @Output() hide = new EventEmitter<DetailedContext>();\n  @Output() show = new EventEmitter<DetailedContext>();\n  @Output() favorite = new EventEmitter<DetailedContext>();\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\n  @Output() manageTools = new EventEmitter<DetailedContext>();\n\n  get hidden(): boolean {\n    return this.context.hidden;\n  }\n\n  get canShare(): boolean {\n    return this.storageService.get('canShare') === true;\n  }\n\n  constructor(\n    public auth: AuthService,\n    private storageService: StorageService\n  ) {}\n\n  favoriteClick(context: DetailedContext) {\n    this.favorite.emit(context);\n  }\n}\n","<igo-list [navigation]=\"true\">\n  <mat-form-field *ngIf=\"showFilter()\" [ngClass]=\"auth.authenticated && configService.getConfig('context') ? 'context-filter-min-width' : 'context-filter-max-width'\">\n    <input\n      matInput\n      type=\"text\"\n      [placeholder]=\"'igo.context.contextManager.filterPlaceHolder' | translate\"\n      [(ngModel)]=\"term\">\n    <button\n      mat-button\n      mat-icon-button\n      matSuffix\n      class=\"clear-button\"\n      *ngIf=\"term.length\"\n      aria-label=\"Clear\"\n      color=\"warn\"\n      (click)=\"clearFilter()\">\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <button\n  *ngIf=\"!sortedAlpha\"\n  class=\"sort-alpha\"\n  mat-icon-button\n  [matTooltip]=\"'igo.context.contextManager.sortAlphabetically' | translate\"\n  matTooltipShowDelay=\"500\"\n  (click)=\"toggleSort(true)\">\n  <mat-icon color=\"primary\" svgIcon=\"sort-alphabetical-variant\"></mat-icon>\n  </button>\n  <button\n    *ngIf=\"sortedAlpha\"\n    class=\"sort-alpha\"\n    mat-icon-button\n    [matTooltip]=\"'igo.context.contextManager.sortContextOrder' | translate\"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleSort(false)\">\n    <mat-icon color=\"warn\" svgIcon=\"sort-variant-remove\"></mat-icon>\n  </button>\n\n  <igo-actionbar *ngIf=\"auth.authenticated && configService.getConfig('context')\"\n    class=\"add-context-button\"\n    [iconColor]=\"color\"\n    [store]=\"actionStore\"\n    [withIcon]=\"true\"\n    icon=\"plus\"\n    [withTitle]=\"actionbarMode === 'overlay'\"\n    [horizontal]=\"false\"\n    [mode]=\"actionbarMode\">\n  </igo-actionbar>\n\n  <button *ngIf=\"auth.authenticated && configService.getConfig('context')\"\n    class=\"users-filter\"\n    mat-icon-button\n    [matTooltip]=\"'igo.context.contextManager.filterUser' | translate\"\n    matTooltipShowDelay=\"500\"\n    [matMenuTriggerFor]=\"accountMenu\">\n    <mat-icon color=\"primary\" svgIcon=\"filter-menu\"></mat-icon>\n  </button>\n\n  <mat-menu #accountMenu=\"matMenu\">\n    <ng-container *ngFor=\"let user of users\">\n      <span class=\"profilsMenu\">\n        <mat-checkbox\n          class=\"mat-menu-item\"\n          [checked]=\"getPermission(user).checked\"\n          [indeterminate]=\"getPermission(user).indeterminate\"\n          (click)=\"$event.stopPropagation()\"\n          (change)=\"userSelection(user)\">\n        </mat-checkbox>\n        <button *ngIf=\"user.childs\"\n          [matMenuTriggerFor]=\"subAccountMenu\"\n          mat-menu-item>\n          {{user.title}}\n        </button>\n        <button\n          mat-menu-item\n          *ngIf=\"!user.childs\">\n          {{user.title}}\n        </button>\n      </span>\n\n      <mat-menu #subAccountMenu=\"matMenu\">\n        <mat-checkbox *ngFor=\"let child of user.childs\"\n          class=\"mat-menu-item\"\n          [checked]=\"getPermission(child).checked\"\n          (click)=\"$event.stopPropagation()\"\n          (change)=\"userSelection(child, user)\">\n          {{child.title}}\n        </mat-checkbox>\n      </mat-menu>\n    </ng-container>\n\n    <span class=\"profilsMenu\">\n      <mat-checkbox\n        class=\"mat-menu-item\"\n        [checked]=\"showHidden\"\n        (click)=\"$event.stopPropagation()\"\n        (change)=\"showHiddenContexts.emit()\">\n      </mat-checkbox>\n      <button mat-menu-item>\n        {{ 'igo.context.contextManager.showHidden' | translate }}\n      </button>\n    </span>\n  </mat-menu>\n\n  <ng-template ngFor let-groupContexts [ngForOf]=\"contexts$ | async | keyvalue\">\n\n    <igo-collapsible *ngIf=\"groupContexts.value.length && auth.authenticated\" [title]=\"titleMapping[groupContexts.key] | translate\"\n      [collapsed]=\"collapsed[titleMapping[groupContexts.key]]\" (toggle)=\"collapsed[titleMapping[groupContexts.key]] = $event\">\n\n      <ng-template ngFor let-context [ngForOf]=\"groupContexts.value\">\n        <igo-context-item\n          igoListItem\n          color=\"accent\"\n          [selected]=\"selectedContext && selectedContext.uri === context.uri\"\n          [context]=\"context\"\n          [default]=\"context.id && this.defaultContextId && this.defaultContextId === context.id\"\n          (edit)=\"edit.emit(context)\"\n          (delete)=\"delete.emit(context)\"\n          (clone)=\"clone.emit(context)\"\n          (save)=\"save.emit(context)\"\n          (hide)=\"hideContext(context)\"\n          (show)=\"showContext(context)\"\n          (favorite)=\"favorite.emit(context)\"\n          (manageTools)=\"manageTools.emit(context)\"\n          (managePermissions)=\"managePermissions.emit(context)\"\n          (select)=\"select.emit(context)\"\n          (unselect)=\"unselect.emit(context)\">\n        </igo-context-item>\n      </ng-template>\n\n    </igo-collapsible>\n\n    <ng-template *ngIf=\"groupContexts.value.length && !auth.authenticated\" ngFor let-context [ngForOf]=\"groupContexts.value\">\n      <igo-context-item\n        igoListItem\n        color=\"accent\"\n        [showFavorite]=\"configService.getConfig('favoriteContext4NonAuthenticated')\"\n        [selected]=\"selectedContext && selectedContext.uri === context.uri\"\n        [context]=\"context\"\n        [default]=\"configService.getConfig('context') ? defaultContextId === context.id : defaultContextId === context.uri\"\n        (favorite)=\"favorite.emit(context)\"\n        (select)=\"select.emit(context)\"\n        (unselect)=\"unselect.emit(context)\">\n      </igo-context-item>\n    </ng-template>\n\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectorRef,\n  OnInit,\n  ChangeDetectionStrategy,\n  OnDestroy\n} from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\nimport type { IgoMap } from '@igo2/geo';\n\nimport {\n  DetailedContext,\n  ContextsList,\n  ContextUserPermission,\n  ContextProfils\n} from '../shared/context.interface';\nimport { ContextListControlsEnum } from './context-list.enum';\nimport {\n  Subscription,\n  BehaviorSubject,\n  ReplaySubject,\n  EMPTY,\n  timer\n} from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { MatDialog } from '@angular/material/dialog';\nimport { BookmarkDialogComponent } from '../../context-map-button/bookmark-button/bookmark-dialog.component';\nimport { debounce } from 'rxjs/operators';\nimport { ActionStore, ActionbarMode } from '@igo2/common';\nimport { ContextService } from '../shared/context.service';\n\n@Component({\n  selector: 'igo-context-list',\n  templateUrl: './context-list.component.html',\n  styleUrls: ['./context-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ContextListComponent implements OnInit, OnDestroy {\n  private contextsInitial: ContextsList = { ours: [] };\n  contexts$: BehaviorSubject<ContextsList> = new BehaviorSubject(\n    this.contextsInitial\n  );\n\n  change$ = new ReplaySubject<void>(1);\n\n  private change$$: Subscription;\n\n  @Input()\n  get contexts(): ContextsList {\n    return this._contexts;\n  }\n  set contexts(value: ContextsList) {\n    this._contexts = value;\n    this.cdRef.detectChanges();\n    this.next();\n  }\n  private _contexts: ContextsList = { ours: [] };\n\n  @Input()\n  get selectedContext(): DetailedContext {\n    return this._selectedContext;\n  }\n  set selectedContext(value: DetailedContext) {\n    this._selectedContext = value;\n    this.cdRef.detectChanges();\n  }\n  private _selectedContext: DetailedContext;\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get defaultContextId(): string {\n    return this.configService.getConfig('context') ? this._defaultContextId :\n      this.storageService.get('favorite.context.uri') as string || this._defaultContextId;\n  }\n  set defaultContextId(value: string) {\n    this._defaultContextId = value;\n  }\n  private _defaultContextId: string;\n\n  public collapsed: { contextScope }[] = [];\n\n  @Output() select = new EventEmitter<DetailedContext>();\n  @Output() unselect = new EventEmitter<DetailedContext>();\n  @Output() edit = new EventEmitter<DetailedContext>();\n  @Output() delete = new EventEmitter<DetailedContext>();\n  @Output() save = new EventEmitter<DetailedContext>();\n  @Output() clone = new EventEmitter<DetailedContext>();\n  @Output() create = new EventEmitter<{ title: string; empty: boolean }>();\n  @Output() hide = new EventEmitter<DetailedContext>();\n  @Output() show = new EventEmitter<DetailedContext>();\n  @Output() showHiddenContexts = new EventEmitter<boolean>();\n  @Output() favorite = new EventEmitter<DetailedContext>();\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\n  @Output() manageTools = new EventEmitter<DetailedContext>();\n  @Output() filterPermissionsChanged = new EventEmitter<\n    ContextUserPermission[]\n  >();\n\n  public titleMapping = {\n    ours: 'igo.context.contextManager.ourContexts',\n    shared: 'igo.context.contextManager.sharedContexts',\n    public: 'igo.context.contextManager.publicContexts'\n  };\n\n  public users: ContextProfils[];\n  public permissions: ContextUserPermission[] = [];\n\n  public actionStore = new ActionStore([]);\n  public actionbarMode = ActionbarMode.Overlay;\n\n  public color = 'primary';\n\n  public showHidden = false;\n\n  /**\n   * Context filter term\n   */\n  @Input()\n  set term(value: string) {\n    this._term = value;\n    this.next();\n  }\n  get term(): string {\n    return this._term;\n  }\n  public _term: string = '';\n\n  get sortedAlpha(): boolean {\n    return this._sortedAlpha;\n  }\n  set sortedAlpha(value: boolean) {\n    this._sortedAlpha = value;\n    this.next();\n  }\n  private _sortedAlpha: boolean = undefined;\n\n  public showContextFilter = ContextListControlsEnum.always;\n\n  public thresholdToFilter = 5;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private contextService: ContextService,\n    public configService: ConfigService,\n    public auth: AuthService,\n    private dialog: MatDialog,\n    private languageService: LanguageService,\n    private storageService: StorageService\n  ) {}\n\n  ngOnInit() {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.contexts.ours.length === 0 ? EMPTY : timer(50);\n        })\n      )\n      .subscribe(() => {\n        this.contexts$.next(this.filterContextsList(this.contexts));\n      });\n\n    this.actionStore.load([\n      {\n        id: 'emptyContext',\n        title: this.languageService.translate.instant(\n          'igo.context.contextManager.emptyContext'\n        ),\n        icon: 'map-outline',\n        tooltip: this.languageService.translate.instant(\n          'igo.context.contextManager.emptyContextTooltip'\n        ),\n        handler: () => {\n          this.createContext(true);\n        }\n      },\n      {\n        id: 'contextFromMap',\n        title: this.languageService.translate.instant(\n          'igo.context.contextManager.contextMap'\n        ),\n        icon: 'map-check',\n        tooltip: this.languageService.translate.instant(\n          'igo.context.contextManager.contextMapTooltip'\n        ),\n        handler: () => {\n          this.createContext(false);\n        }\n      }\n    ]);\n  }\n\n  private next() {\n    this.change$.next();\n  }\n\n  private filterContextsList(contexts: ContextsList) {\n    if (this.term === '') {\n      if (this.sortedAlpha) {\n        contexts = this.sortContextsList(contexts);\n      }\n      return contexts;\n    } else {\n      const ours = contexts.ours.filter((context) => {\n        const filterNormalized = this.term\n          .toLowerCase()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const contextTitleNormalized = context.title\n          .toLowerCase()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        return contextTitleNormalized.includes(filterNormalized);\n      });\n\n      let updateContexts: ContextsList = {\n        ours\n      };\n\n      if (this.contexts.public) {\n        const publics = contexts.public.filter((context) => {\n          const filterNormalized = this.term\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          const contextTitleNormalized = context.title\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          return contextTitleNormalized.includes(filterNormalized);\n        });\n        updateContexts.public = publics;\n      }\n\n      if (this.contexts.shared) {\n        const shared = contexts.shared.filter((context) => {\n          const filterNormalized = this.term\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          const contextTitleNormalized = context.title\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          return contextTitleNormalized.includes(filterNormalized);\n        });\n        updateContexts.shared = shared;\n      }\n\n      if (this.sortedAlpha) {\n        updateContexts = this.sortContextsList(updateContexts);\n      }\n      return updateContexts;\n    }\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n  }\n\n  public showFilter() {\n    switch (this.showContextFilter) {\n      case ContextListControlsEnum.always:\n        return true;\n      case ContextListControlsEnum.never:\n        return false;\n      default:\n        let totalLength = this.contexts.ours.length;\n        this.contexts.public\n          ? (totalLength += this.contexts.public.length)\n          : (totalLength += 0);\n        this.contexts.shared\n          ? (totalLength += this.contexts.shared.length)\n          : (totalLength += 0);\n        if (totalLength >= this.thresholdToFilter) {\n          return true;\n        }\n        return false;\n    }\n  }\n\n  sortContextsList(contexts: ContextsList) {\n    if (contexts) {\n      const contextsList = JSON.parse(JSON.stringify(contexts));\n      contextsList.ours.sort((a, b) => {\n        if (this.normalize(a.title) < this.normalize(b.title)) {\n          return -1;\n        }\n        if (this.normalize(a.title) > this.normalize(b.title)) {\n          return 1;\n        }\n        return 0;\n      });\n\n      if (contextsList.shared) {\n        contextsList.shared.sort((a, b) => {\n          if (this.normalize(a.title) < this.normalize(b.title)) {\n            return -1;\n          }\n          if (this.normalize(a.title) > this.normalize(b.title)) {\n            return 1;\n          }\n          return 0;\n        });\n      } else if (contextsList.public) {\n        contextsList.public.sort((a, b) => {\n          if (this.normalize(a.title) < this.normalize(b.title)) {\n            return -1;\n          }\n          if (this.normalize(a.title) > this.normalize(b.title)) {\n            return 1;\n          }\n          return 0;\n        });\n      }\n      return contextsList;\n    }\n  }\n\n  normalize(str: string) {\n    return str\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .toLowerCase();\n  }\n\n  toggleSort(sortAlpha: boolean) {\n    this.sortedAlpha = sortAlpha;\n  }\n\n  clearFilter() {\n    this.term = '';\n  }\n\n  createContext(empty?: boolean) {\n    this.dialog\n      .open(BookmarkDialogComponent, { disableClose: false })\n      .afterClosed()\n      .pipe(take(1))\n      .subscribe((title: string) => {\n        if (title) {\n          this.create.emit({ title, empty });\n        }\n      });\n  }\n\n  getPermission(user?): ContextUserPermission {\n    if (user) {\n      const permission = this.permissions.find((p) => p.name === user.name);\n      return permission;\n    }\n  }\n\n  userSelection(user, parent?) {\n    const permission = this.getPermission(user);\n    if (permission) {\n      permission.checked = !permission.checked;\n      this.storageService.set(\n        'contexts.permissions.' + permission.name,\n        permission.checked\n      );\n      permission.indeterminate = false;\n    }\n\n    if (parent) {\n      let indeterminate = false;\n\n      for (const c of parent.childs) {\n        const cPermission = this.getPermission(c);\n        if (cPermission.checked !== permission.checked) {\n          indeterminate = true;\n          break;\n        }\n      }\n      const parentPermission = this.getPermission(parent);\n      if (parentPermission) {\n        parentPermission.checked = permission.checked;\n        this.storageService.set(\n          'contexts.permissions.' + parentPermission.name,\n          permission.checked\n        );\n        parentPermission.indeterminate = indeterminate;\n      }\n    }\n\n    if (user.childs) {\n      for (const c of user.childs) {\n        const childrenPermission = this.getPermission(c);\n        if (\n          childrenPermission &&\n          childrenPermission.checked !== permission.checked\n        ) {\n          childrenPermission.checked = permission.checked;\n          this.storageService.set(\n            'contexts.permissions.' + childrenPermission.name,\n            permission.checked\n          );\n        }\n      }\n    }\n\n    this.filterPermissionsChanged.emit(this.permissions);\n  }\n\n  hideContext(context: DetailedContext) {\n    context.hidden = true;\n    if (!this.showHidden) {\n      const contexts: ContextsList = { ours: [], shared: [], public: [] };\n      contexts.ours = this.contexts.ours.filter((c) => c.id !== context.id);\n      contexts.shared = this.contexts.shared.filter((c) => c.id !== context.id);\n      contexts.public = this.contexts.public.filter((c) => c.id !== context.id);\n      this.contexts = contexts;\n    }\n    this.hide.emit(context);\n  }\n\n  showContext(context: DetailedContext) {\n    context.hidden = false;\n    this.show.emit(context);\n  }\n}\n","import {\n  Directive,\n  Self,\n  OnInit,\n  OnDestroy,\n  HostListener,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { MessageService, LanguageService, StorageService } from '@igo2/core';\nimport { AuthService } from '@igo2/auth';\nimport { ConfirmDialogService } from '@igo2/common';\nimport { MapService } from '@igo2/geo';\n\nimport {\n  Context,\n  DetailedContext,\n  ContextsList,\n  ContextUserPermission\n} from '../shared/context.interface';\nimport { ContextService } from '../shared/context.service';\nimport { ContextListComponent } from './context-list.component';\n\n@Directive({\n  selector: '[igoContextListBinding]'\n})\nexport class ContextListBindingDirective implements OnInit, OnDestroy {\n  private component: ContextListComponent;\n  private contexts$$: Subscription;\n  private selectedContext$$: Subscription;\n  private defaultContextId$$: Subscription;\n  private previousMessageId;\n\n  @HostListener('select', ['$event'])\n  onSelect(context: Context) {\n    this.contextService.loadContext(context.uri);\n  }\n\n  @HostListener('edit', ['$event'])\n  onEdit(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('save', ['$event'])\n  onSave(context: Context) {\n    const map = this.mapService.getMap();\n    const contextFromMap = this.contextService.getContextFromMap(map);\n\n    const msgSuccess = () => {\n      const translate = this.languageService.translate;\n      const message = translate.instant(\n        'igo.context.contextManager.dialog.saveMsg',\n        {\n          value: context.title\n        }\n      );\n      const title = translate.instant(\n        'igo.context.contextManager.dialog.saveTitle'\n      );\n      this.messageService.success(message, title);\n    };\n\n    if (context.imported) {\n      contextFromMap.title = context.title;\n      this.contextService.delete(context.id, true);\n      this.contextService.create(contextFromMap).subscribe((contextCreated) => {\n        this.contextService.loadContext(contextCreated.uri);\n        msgSuccess();\n      });\n      return;\n    }\n\n    const changes: any = {\n      layers: contextFromMap.layers,\n      map: {\n        view: contextFromMap.map.view\n      }\n    };\n\n    this.contextService.update(context.id, changes).subscribe(() => {\n      msgSuccess();\n    });\n  }\n\n  @HostListener('favorite', ['$event'])\n  onFavorite(context: Context) {\n    if (!context.id) {\n      context.id = context.uri;\n    }\n    this.contextService.setDefault(context.id).subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      this.contextService.defaultContextId$.next(context.id);\n      const translate = this.languageService.translate;\n      const message = translate.instant(\n        'igo.context.contextManager.dialog.favoriteMsg',\n        {\n          value: context.title\n        }\n      );\n      const title = translate.instant(\n        'igo.context.contextManager.dialog.favoriteTitle'\n      );\n      const messageObj = this.messageService.success(message, title);\n      this.previousMessageId = messageObj.toastId;\n      this.cdRef.detectChanges();\n    });\n  }\n\n  @HostListener('manageTools', ['$event'])\n  onManageTools(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('managePermissions', ['$event'])\n  onManagePermissions(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('delete', ['$event'])\n  onDelete(context: Context) {\n    const translate = this.languageService.translate;\n    this.confirmDialogService\n      .open(\n        translate.instant('igo.context.contextManager.dialog.confirmDelete')\n      )\n      .subscribe((confirm) => {\n        if (confirm) {\n          this.contextService\n            .delete(context.id, context.imported)\n            .subscribe(() => {\n              const message = translate.instant(\n                'igo.context.contextManager.dialog.deleteMsg',\n                {\n                  value: context.title\n                }\n              );\n              const title = translate.instant(\n                'igo.context.contextManager.dialog.deleteTitle'\n              );\n              this.messageService.info(message, title);\n            });\n        }\n      });\n  }\n\n  @HostListener('clone', ['$event'])\n  onClone(context: DetailedContext) {\n    const properties = {\n      title: context.title + '-copy',\n      uri: context.uri + '-copy'\n    };\n    this.contextService.clone(context.id, properties).subscribe(() => {\n      const translate = this.languageService.translate;\n      const message = translate.instant(\n        'igo.context.contextManager.dialog.cloneMsg',\n        {\n          value: context.title\n        }\n      );\n      const title = translate.instant(\n        'igo.context.contextManager.dialog.cloneTitle'\n      );\n      this.messageService.success(message, title);\n    });\n  }\n\n  @HostListener('create', ['$event'])\n  onCreate(opts: { title: string; empty: boolean }) {\n    const { title, empty } = opts;\n    const context = this.contextService.getContextFromMap(\n      this.component.map,\n      empty\n    );\n    context.title = title;\n    this.contextService.create(context).subscribe(() => {\n      const translate = this.languageService.translate;\n      const titleD = translate.instant(\n        'igo.context.bookmarkButton.dialog.createTitle'\n      );\n      const message = translate.instant(\n        'igo.context.bookmarkButton.dialog.createMsg',\n        {\n          value: context.title\n        }\n      );\n      this.messageService.success(message, titleD);\n      this.contextService.loadContext(context.uri);\n    });\n  }\n\n  @HostListener('filterPermissionsChanged')\n  loadContexts() {\n    const permissions = ['none'];\n    for (const p of this.component.permissions) {\n      if (p.checked === true || p.indeterminate === true) {\n        permissions.push(p.name);\n      }\n    }\n    this.component.showHidden\n      ? this.contextService.loadContexts(permissions, true)\n      : this.contextService.loadContexts(permissions, false);\n  }\n\n  @HostListener('showHiddenContexts')\n  showHiddenContexts() {\n    this.component.showHidden = !this.component.showHidden;\n    this.storageService.set('contexts.showHidden', this.component.showHidden);\n    this.loadContexts();\n  }\n\n  @HostListener('show', ['$event'])\n  onShowContext(context: DetailedContext) {\n    this.contextService.showContext(context.id).subscribe();\n  }\n\n  @HostListener('hide', ['$event'])\n  onHideContext(context: DetailedContext) {\n    this.contextService.hideContext(context.id).subscribe();\n  }\n\n  constructor(\n    @Self() component: ContextListComponent,\n    private contextService: ContextService,\n    private mapService: MapService,\n    private languageService: LanguageService,\n    private confirmDialogService: ConfirmDialogService,\n    private messageService: MessageService,\n    private auth: AuthService,\n    private storageService: StorageService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input contexts\n    this.component.contexts = { ours: [] };\n    this.component.showHidden = this.storageService.get(\n      'contexts.showHidden'\n    ) as boolean;\n\n    this.contexts$$ = this.contextService.contexts$.subscribe((contexts) =>\n      this.handleContextsChange(contexts)\n    );\n\n    this.defaultContextId$$ = this.contextService.defaultContextId$.subscribe(\n      (id) => {\n        this.component.defaultContextId = id;\n      }\n    );\n    const storedContextUri = this.storageService.get('favorite.context.uri') as string;\n    if (storedContextUri && !this.auth.authenticated) {\n      this.contextService.defaultContextId$.next(storedContextUri);\n    }\n\n    // See feature-list.component for an explanation about the debounce time\n    this.selectedContext$$ = this.contextService.context$\n      .pipe(debounceTime(100))\n      .subscribe((context) => (this.component.selectedContext = context));\n\n    this.auth.authenticate$.subscribe((authenticate) => {\n      if (authenticate) {\n        this.contextService.getProfilByUser().subscribe((profils) => {\n          this.component.users = profils;\n          this.component.permissions = [];\n          const profilsAcc = this.component.users.reduce((acc, cur) => {\n            acc = acc.concat(cur);\n            acc = cur.childs ? acc.concat(cur.childs) : acc;\n            return acc;\n          }, []);\n\n          for (const user of profilsAcc) {\n            const permission: ContextUserPermission = {\n              name: user.name,\n              checked: this.storageService.get(\n                'contexts.permissions.' + user.name\n              ) as boolean\n            };\n            if (permission.checked === null) {\n              permission.checked = true;\n            }\n            this.component.permissions.push(permission);\n          }\n\n          const permissions = ['none'];\n          for (const p of this.component.permissions) {\n            if (p.checked === true || p.indeterminate === true) {\n              permissions.push(p.name);\n            }\n          }\n\n          this.component.showHidden\n            ? this.contextService.loadContexts(permissions, true)\n            : this.contextService.loadContexts(permissions, false);\n        });\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.contexts$$.unsubscribe();\n    this.selectedContext$$.unsubscribe();\n    this.defaultContextId$$.unsubscribe();\n  }\n\n  private handleContextsChange(contexts: ContextsList) {\n    this.component.contexts = contexts;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, EMPTY } from 'rxjs';\n\nimport { ConfigService } from '@igo2/core';\nimport { Poi } from './poi.interface';\n\n@Injectable()\nexport class PoiService {\n  private baseUrl: string;\n\n  constructor(private http: HttpClient, private config: ConfigService) {\n    this.baseUrl = this.config.getConfig('context.url');\n  }\n\n  get(): Observable<Poi[]> {\n    if (!this.baseUrl) {\n      return EMPTY;\n    }\n\n    const url = this.baseUrl + '/pois';\n    return this.http.get<Poi[]>(url);\n  }\n\n  delete(id: string): Observable<void> {\n    const url = this.baseUrl + '/pois/' + id;\n    return this.http.delete<void>(url);\n  }\n\n  create(context: Poi): Observable<Poi> {\n    const url = this.baseUrl + '/pois';\n    return this.http.post<Poi>(url, context);\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoConfirmDialogModule, IgoStopPropagationModule } from '@igo2/common';\nimport { IgoAuthModule } from '@igo2/auth';\n\nimport { BookmarkButtonComponent } from './bookmark-button/bookmark-button.component';\nimport { BookmarkDialogComponent } from './bookmark-button/bookmark-dialog.component';\nimport { PoiButtonComponent } from './poi-button/poi-button.component';\nimport { PoiDialogComponent } from './poi-button/poi-dialog.component';\nimport { PoiService } from './poi-button/shared/poi.service';\nimport { UserDialogComponent } from './user-button/user-dialog.component';\nimport { UserButtonComponent } from './user-button/user-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoConfirmDialogModule,\n    IgoStopPropagationModule,\n    IgoAuthModule,\n    FormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatDialogModule,\n    MatInputModule\n  ],\n  exports: [BookmarkButtonComponent, PoiButtonComponent, UserButtonComponent, BookmarkDialogComponent],\n  declarations: [\n    BookmarkButtonComponent,\n    BookmarkDialogComponent,\n    PoiButtonComponent,\n    PoiDialogComponent,\n    UserButtonComponent,\n    UserDialogComponent\n  ],\n  providers: [PoiService]\n})\nexport class IgoContextMapButtonModule {\n  static forRoot(): ModuleWithProviders<IgoContextMapButtonModule> {\n    return {\n      ngModule: IgoContextMapButtonModule\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoAuthModule } from '@igo2/auth';\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoListModule,\n  IgoKeyValueModule,\n  IgoCollapsibleModule,\n  IgoStopPropagationModule,\n  IgoActionbarModule\n} from '@igo2/common';\n\nimport { MapContextDirective } from './shared/map-context.directive';\nimport { LayerContextDirective } from './shared/layer-context.directive';\nimport { ContextListComponent } from './context-list/context-list.component';\nimport { ContextListBindingDirective } from './context-list/context-list-binding.directive';\nimport { ContextItemComponent } from './context-item/context-item.component';\nimport { ContextFormComponent } from './context-form/context-form.component';\nimport { ContextEditComponent } from './context-edit/context-edit.component';\nimport { ContextEditBindingDirective } from './context-edit/context-edit-binding.directive';\nimport { ContextPermissionsComponent } from './context-permissions/context-permissions.component';\nimport { ContextPermissionsBindingDirective } from './context-permissions/context-permissions-binding.directive';\nimport { IgoContextMapButtonModule } from '../context-map-button/context-map-button.module';\nimport { IgoContextImportExportModule } from '../context-import-export/context-import-export.module';\n\nconst CONTEXT_DIRECTIVES = [\n  MapContextDirective,\n  LayerContextDirective\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    MatListModule,\n    MatCheckboxModule,\n    MatRadioModule,\n    MatDialogModule,\n    MatMenuModule,\n    MatOptionModule,\n    MatAutocompleteModule,\n    IgoAuthModule,\n    IgoListModule,\n    IgoKeyValueModule,\n    IgoCollapsibleModule,\n    IgoStopPropagationModule,\n    IgoLanguageModule,\n    IgoContextImportExportModule,\n    IgoContextMapButtonModule,\n    IgoActionbarModule\n  ],\n  exports: [\n    ContextListComponent,\n    ContextListBindingDirective,\n    ContextItemComponent,\n    ContextFormComponent,\n    ContextEditComponent,\n    ContextEditBindingDirective,\n    ContextPermissionsComponent,\n    ContextPermissionsBindingDirective,\n\n    ...CONTEXT_DIRECTIVES\n  ],\n  declarations: [\n    ContextListComponent,\n    ContextListBindingDirective,\n    ContextItemComponent,\n    ContextFormComponent,\n    ContextEditComponent,\n    ContextEditBindingDirective,\n    ContextPermissionsComponent,\n    ContextPermissionsBindingDirective,\n\n    ...CONTEXT_DIRECTIVES\n  ]\n})\nexport class IgoContextManagerModule {\n  static forRoot(): ModuleWithProviders<IgoContextManagerModule> {\n    return {\n      ngModule: IgoContextManagerModule\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\nimport { ExportOptions } from '@igo2/geo';\n\nexport enum ImportExportType {\n  layer = 'layer',\n  context = 'context'\n}\n\nexport enum ImportExportMode {\n  import = 'import',\n  export = 'export'\n}\n\n/**\n * Service that holds the state of the importExport module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ImportExportState {\n\n  readonly importExportType$: BehaviorSubject<ImportExportType> = new BehaviorSubject(ImportExportType.layer);\n  readonly selectedMode$: BehaviorSubject<ImportExportMode> = new BehaviorSubject(ImportExportMode.import);\n  readonly exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(undefined);\n\n  setImportExportType(type: ImportExportType) {\n    this.importExportType$.next(type);\n  }\n\n  setMode(mode: ImportExportMode) {\n    this.selectedMode$.next(mode);\n  }\n\n  setsExportOptions(exportOptions: ExportOptions) {\n      this.exportOptions$.next(exportOptions);\n    }\n\n}\n","import { Injectable } from '@angular/core';\n\nimport { Toolbox, ToolService } from '@igo2/common';\n\nimport { ExportOptions } from '@igo2/geo';\nimport { BehaviorSubject } from 'rxjs';\nimport { ImportExportMode, ImportExportState } from '../import-export/import-export.state';\n\n/**\n * Service that holds the state of the search module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ToolState {\n  get toolbox(): Toolbox {\n    return this.toolService.toolbox;\n  }\n\n  public openSidenav$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  constructor(\n    private toolService: ToolService,\n    private importExportState: ImportExportState\n    ) {}\n\n    toolToActivateFromOptions(toolToActivate: { tool: string; options: {[key: string]: any} }) {\n    if (!toolToActivate) { return; }\n    if (toolToActivate.tool === 'importExport') {\n      let exportOptions: ExportOptions = this.importExportState.exportOptions$.value;\n      if (!exportOptions) {\n        exportOptions = {\n          layers: toolToActivate.options.layers,\n          featureInMapExtent: toolToActivate.options.featureInMapExtent\n        };\n      } else {\n        exportOptions.layers = toolToActivate.options.layers;\n        exportOptions.featureInMapExtent = toolToActivate.options.featureInMapExtent;\n      }\n      this.importExportState.setsExportOptions(exportOptions);\n      this.importExportState.setMode(ImportExportMode.export);\n    }\n\n    if (this.toolbox.getTool(toolToActivate.tool)) {\n      this.toolbox.activateTool(toolToActivate.tool);\n      this.openSidenav$.next(true);\n    }\n  }\n}\n","import {\n    FeatureMotion,\n    FeatureStoreSelectionStrategy,\n    FeatureWorkspace,\n    WfsWorkspace,\n    EditionWorkspace\n} from '@igo2/geo';\n\n\nexport function handleZoomAuto(workspace: FeatureWorkspace | WfsWorkspace | EditionWorkspace, storageService) {\n    const zoomStrategy = workspace.entityStore\n        .getStrategyOfType(FeatureStoreSelectionStrategy) as FeatureStoreSelectionStrategy;\n    zoomStrategy.setMotion(storageService.get('zoomAuto') as boolean ? FeatureMotion.Default : FeatureMotion.None);\n}\n\n\n","import { Injectable } from '@angular/core';\n\nimport { StorageService } from '@igo2/core';\n\n/**\n * Service that holds the state of storage service\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageState {\n  get storageService(): StorageService {\n    return this.igoStorageService;\n  }\n\n  constructor(private igoStorageService: StorageService) {}\n}\n","import { Injectable, OnDestroy } from '@angular/core';\n\nimport {\n  Action,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy\n} from '@igo2/common';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport {\n  FeatureWorkspace,\n  mapExtentStrategyActiveToolTip,\n  noElementSelected,\n  ExportOptions\n} from '@igo2/geo';\nimport { StorageService, StorageServiceEvent, StorageServiceEventEnum, LanguageService, MediaService} from '@igo2/core';\nimport { StorageState } from '../../storage/storage.state';\nimport { map, skipWhile } from 'rxjs/operators';\nimport { ToolState } from '../../tool/tool.state';\nimport { handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FeatureActionsService implements OnDestroy {\n\n  public maximize$: BehaviorSubject<boolean> = new BehaviorSubject(\n    this.storageService.get('workspaceMaximize') as boolean\n  );\n\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private toolState: ToolState,\n    private mediaService: MediaService\n  ) {}\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: FeatureWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n      );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: FeatureWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(\n        skipWhile(\n          (storageChange: StorageServiceEvent) =>\n            storageChange.key !== 'zoomAuto' || storageChange.event === StorageServiceEventEnum.CLEARED\n        )\n      )\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    return [\n      {\n        id: 'zoomAuto',\n        checkbox: true,\n        title: 'igo.integration.workspace.zoomAuto.title',\n        tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\n        checkCondition: this.zoomAuto$,\n        handler: () => {\n          handleZoomAuto(workspace, this.storageService);\n          this.storageService.set(\n            'zoomAuto',\n            !this.storageService.get('zoomAuto') as boolean\n          );\n        }\n      },\n      {\n        id: 'filterInMapExtent',\n        checkbox: true,\n        title: 'igo.integration.workspace.inMapExtent.title',\n        tooltip: mapExtentStrategyActiveToolTip(workspace),\n        checkCondition: rowsInMapExtentCheckCondition$,\n        handler: () => rowsInMapExtentCheckCondition$.next(!rowsInMapExtentCheckCondition$.value)\n      },\n      {\n        id: 'selectedOnly',\n        checkbox: true,\n        title: 'igo.integration.workspace.selected.title',\n        tooltip: 'igo.integration.workspace.selected.tooltip',\n        checkCondition: selectOnlyCheckCondition$,\n        handler: () => selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\n      },\n      {\n        id: 'clearselection',\n        icon: 'select-off',\n        title: 'igo.integration.workspace.clearSelection.title',\n        tooltip: 'igo.integration.workspace.clearSelection.tooltip',\n        handler: (ws: FeatureWorkspace) => {\n          ws.entityStore.state.updateMany(ws.entityStore.view.all(), {\n            selected: false\n          });\n        },\n        args: [workspace],\n        availability: (ws: FeatureWorkspace) => noElementSelected(ws)\n      },\n      {\n        id: 'featureDownload',\n        icon: 'file-export',\n        title: 'igo.integration.workspace.download.title',\n        tooltip: 'igo.integration.workspace.download.tooltip',\n        handler: (ws: FeatureWorkspace) => {\n          const filterStrategy = ws.entityStore.getStrategyOfType(\n            EntityStoreFilterCustomFuncStrategy\n          );\n          const filterSelectionStrategy = ws.entityStore.getStrategyOfType(\n            EntityStoreFilterSelectionStrategy\n          );\n          const layersWithSelection = filterSelectionStrategy.active\n            ? [ws.layer.id]\n            : [];\n          this.toolState.toolToActivateFromOptions({\n            tool: 'importExport',\n            options: {\n              layers: [ws.layer.id],\n              featureInMapExtent: filterStrategy.active,\n              layersWithSelection\n            } as ExportOptions\n          });\n        },\n        args: [workspace]\n      },\n      {\n        id: 'maximize',\n        title: this.languageService.translate.instant('igo.integration.workspace.maximize'),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.maximizeTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => !v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          if (!this.mediaService.isMobile()) {\n            this.maximize$.next(true);\n          }\n        },\n      },\n      {\n        id: 'standardExtent',\n        title: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtent'\n        ),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtentTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          this.maximize$.next(false);\n        }\n      }\n    ];\n  }\n}\n","import { Inject, Injectable, OnDestroy } from '@angular/core';\n\nimport {\n  Action,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  Widget\n} from '@igo2/common';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport {\n  WfsWorkspace,\n  mapExtentStrategyActiveToolTip,\n  noElementSelected,\n  ExportOptions,\n  OgcFilterWidget,\n  OgcFilterableDataSource,\n} from '@igo2/geo';\nimport { StorageService, StorageServiceEvent, StorageServiceEventEnum, LanguageService, MediaService} from '@igo2/core';\nimport { StorageState } from '../../storage/storage.state';\nimport { map, skipWhile } from 'rxjs/operators';\nimport { ToolState } from '../../tool/tool.state';\nimport { handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WfsActionsService implements OnDestroy {\n\n  public maximize$: BehaviorSubject<boolean> = new BehaviorSubject(\n    this.storageService.get('workspaceMaximize') as boolean\n  );\n\n  selectOnlyCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  // rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    @Inject(OgcFilterWidget) private ogcFilterWidget: Widget,\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private mediaService: MediaService,\n    private toolState: ToolState) {}\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: WfsWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n      );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: WfsWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(skipWhile((storageChange: StorageServiceEvent) =>\n        storageChange?.key !== 'zoomAuto' || storageChange?.event === StorageServiceEventEnum.CLEARED))\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    const actions = [\n      {\n        id: 'zoomAuto',\n        checkbox: true,\n        title: 'igo.integration.workspace.zoomAuto.title',\n        tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\n        checkCondition: this.zoomAuto$,\n        handler: () => {\n          handleZoomAuto(workspace, this.storageService);\n          this.storageService.set('zoomAuto', !this.storageService.get('zoomAuto') as boolean);\n        }\n      },\n      {\n        id: 'filterInMapExtent',\n        checkbox: true,\n        title: 'igo.integration.workspace.inMapExtent.title',\n        tooltip: mapExtentStrategyActiveToolTip(workspace),\n        checkCondition: rowsInMapExtentCheckCondition$,\n        handler: () => rowsInMapExtentCheckCondition$.next(!rowsInMapExtentCheckCondition$.value)\n      },\n      {\n        id: 'selectedOnly',\n        checkbox: true,\n        title: 'igo.integration.workspace.selected.title',\n        tooltip: 'igo.integration.workspace.selected.title',\n        checkCondition: selectOnlyCheckCondition$,\n        handler: () => selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\n      },\n      {\n        id: 'clearselection',\n        icon: 'select-off',\n        title: 'igo.integration.workspace.clearSelection.title',\n        tooltip: 'igo.integration.workspace.clearSelection.tooltip',\n        handler: (ws: WfsWorkspace) => {\n          ws.entityStore.state.updateMany(ws.entityStore.view.all(), { selected: false });\n        },\n        args: [workspace],\n        availability: (ws: WfsWorkspace) => noElementSelected(ws)\n      },\n      {\n        id: 'wfsDownload',\n        icon: 'file-export',\n        title: 'igo.integration.workspace.download.title',\n        tooltip: 'igo.integration.workspace.download.tooltip',\n        handler: (ws: WfsWorkspace) => {\n          const filterStrategy = ws.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n          const filterSelectionStrategy = ws.entityStore.getStrategyOfType(EntityStoreFilterSelectionStrategy);\n          const layersWithSelection = filterSelectionStrategy.active ? [ws.layer.id] : [];\n          this.toolState.toolToActivateFromOptions({\n            tool: 'importExport',\n            options: { layers: [ws.layer.id], featureInMapExtent: filterStrategy.active, layersWithSelection } as ExportOptions\n          });\n        },\n        args: [workspace]\n      },\n      {\n        id: 'ogcFilter',\n        icon: 'filter',\n        title: 'igo.integration.workspace.ogcFilter.title',\n        tooltip: 'igo.integration.workspace.ogcFilter.tooltip',\n        handler: (widget: Widget, ws: WfsWorkspace) => {\n          ws.activateWidget(widget, {\n            map: ws.map,\n            layer: ws.layer\n          });\n        },\n        args: [this.ogcFilterWidget, workspace]\n      },\n      {\n        id: 'maximize',\n        title: this.languageService.translate.instant('igo.integration.workspace.maximize'),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.maximizeTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => !v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          if (!this.mediaService.isMobile()) {\n            this.maximize$.next(true);\n          }\n        },\n      },\n      {\n        id: 'standardExtent',\n        title: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtent'\n        ),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtentTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          this.maximize$.next(false);\n        }\n      }\n    ];\n    return (workspace.layer.dataSource as OgcFilterableDataSource).ogcFilters$?.value?.enabled ?\n    actions : actions.filter(action => action.id !== 'ogcFilter');\n  }\n}\n","import { Inject, Injectable, OnDestroy } from '@angular/core';\n\nimport {\n  Action,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  Widget\n} from '@igo2/common';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport {\n  EditionWorkspace,\n  mapExtentStrategyActiveToolTip,\n  noElementSelected,\n  ExportOptions,\n  OgcFilterWidget,\n  OgcFilterableDataSource,\n} from '@igo2/geo';\nimport { StorageService, StorageServiceEvent, StorageServiceEventEnum, LanguageService, MediaService} from '@igo2/core';\nimport { StorageState } from '../../storage/storage.state';\nimport { map, skipWhile } from 'rxjs/operators';\nimport { ToolState } from '../../tool/tool.state';\nimport { handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EditionActionsService implements OnDestroy {\n\n  public maximize$: BehaviorSubject<boolean> = new BehaviorSubject(\n    this.storageService.get('workspaceMaximize') as boolean\n  );\n\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    @Inject(OgcFilterWidget) private ogcFilterWidget: Widget,\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private mediaService: MediaService,\n    private toolState: ToolState) {}\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: EditionWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n      );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: EditionWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(skipWhile((storageChange: StorageServiceEvent) =>\n        storageChange?.key !== 'zoomAuto' || storageChange?.event === StorageServiceEventEnum.CLEARED))\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    const actions = [\n      {\n        id: 'zoomAuto',\n        checkbox: true,\n        title: 'igo.integration.workspace.zoomAuto.title',\n        tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\n        checkCondition: this.zoomAuto$,\n        handler: () => {\n          handleZoomAuto(workspace, this.storageService);\n          this.storageService.set('zoomAuto', !this.storageService.get('zoomAuto') as boolean);\n        }\n      },\n      {\n        id: 'filterInMapExtent',\n        checkbox: true,\n        title: 'igo.integration.workspace.inMapExtent.title',\n        tooltip: mapExtentStrategyActiveToolTip(workspace),\n        checkCondition: rowsInMapExtentCheckCondition$,\n        handler: () => rowsInMapExtentCheckCondition$.next(!rowsInMapExtentCheckCondition$.value)\n      },\n      {\n        id: 'selectedOnly',\n        checkbox: true,\n        title: 'igo.integration.workspace.selected.title',\n        tooltip: 'igo.integration.workspace.selected.title',\n        checkCondition: selectOnlyCheckCondition$,\n        handler: () => selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\n      },\n      {\n        id: 'clearselection',\n        icon: 'select-off',\n        title: 'igo.integration.workspace.clearSelection.title',\n        tooltip: 'igo.integration.workspace.clearSelection.tooltip',\n        handler: (ws: EditionWorkspace) => {\n          ws.entityStore.state.updateMany(ws.entityStore.view.all(), { selected: false });\n        },\n        args: [workspace],\n        availability: (ws: EditionWorkspace) => noElementSelected(ws)\n      },\n      {\n        id: 'wfsDownload',\n        icon: 'file-export',\n        title: 'igo.integration.workspace.download.title',\n        tooltip: 'igo.integration.workspace.download.tooltip',\n        handler: (ws: EditionWorkspace) => {\n          const filterStrategy = ws.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n          const filterSelectionStrategy = ws.entityStore.getStrategyOfType(EntityStoreFilterSelectionStrategy);\n          const layersWithSelection = filterSelectionStrategy.active ? [ws.layer.id] : [];\n          this.toolState.toolToActivateFromOptions({\n            tool: 'importExport',\n            options: { layers: [ws.layer.id], featureInMapExtent: filterStrategy.active, layersWithSelection } as ExportOptions\n          });\n        },\n        args: [workspace]\n      },\n      {\n        id: 'ogcFilter',\n        icon: 'filter',\n        title: 'igo.integration.workspace.ogcFilter.title',\n        tooltip: 'igo.integration.workspace.ogcFilter.tooltip',\n        handler: (widget: Widget, ws: EditionWorkspace) => {\n          ws.activateWidget(widget, {\n            map: ws.map,\n            layer: ws.layer\n          });\n        },\n        args: [this.ogcFilterWidget, workspace]\n      },\n      {\n        id: 'maximize',\n        title: this.languageService.translate.instant('igo.integration.workspace.maximize'),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.maximizeTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => !v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          if (!this.mediaService.isMobile()) {\n            this.maximize$.next(true);\n          }\n        },\n      },\n      {\n        id: 'standardExtent',\n        title: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtent'\n        ),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtentTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          this.maximize$.next(false);\n        }\n      }\n    ];\n    return (workspace.layer.dataSource as OgcFilterableDataSource).ogcFilters$?.value?.enabled ?\n    actions : actions.filter(action => action.id !== 'ogcFilter');\n  }\n}\n","import { Injectable, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject, Subscription, Observable, of } from 'rxjs';\n\nimport {\n  EntityRecord,\n  Workspace,\n  WorkspaceStore,\n  Widget,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  EntityState } from '@igo2/common';\nimport { WfsWorkspace, FeatureWorkspace, EditionWorkspace } from '@igo2/geo';\nimport { FeatureActionsService } from './shared/feature-actions.service';\nimport { WfsActionsService } from './shared/wfs-actions.service';\nimport { StorageService } from '@igo2/core';\nimport { EditionActionsService } from './shared/edition-actions.service';\n\n/**\n * Service that holds the state of the workspace module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class WorkspaceState implements OnDestroy {\n\n  public workspacePanelExpanded: boolean = false;\n\n  readonly workspaceEnabled$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n  readonly rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(true);\n  readonly selectOnlyCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n\n  readonly workspaceMaximize$: BehaviorSubject<boolean> = new BehaviorSubject(\n    this.storageService.get('workspaceMaximize') as boolean\n  );\n  private actionMaximize$$: Subscription[] = [];\n\n  private rowsInMapExtentCheckCondition$$: Subscription;\n  private selectOnlyCheckCondition$$: Subscription;\n\n  /** Subscription to the active workspace */\n  private activeWorkspace$$: Subscription;\n\n  /** Subscription to the active workspace widget */\n  private activeWorkspaceWidget$$: Subscription;\n\n  /** Active widget observable. Only one may be active for all available workspaces */\n  readonly activeWorkspaceWidget$: BehaviorSubject<Widget> = new BehaviorSubject<Widget>(undefined);\n\n  /**\n   * Observable of the active workspace\n   */\n  public workspace$ = new BehaviorSubject<Workspace>(undefined);\n\n  /**\n   * Store that holds all the available workspaces\n   */\n  get store(): WorkspaceStore { return this._store; }\n  private _store: WorkspaceStore;\n\n  get workspaceSelection() {\n    if (this.workspace$.value) {\n    return this.workspace$.value?.entityStore.stateView.manyBy((r) => r.state.selected === true);\n    } else {\n      return [];\n    }\n  }\n\n  get workspaceSelection$(): Observable<EntityRecord<object, EntityState>[]> {\n    if (this.workspace$.value) {\n      return this.workspace$.value?.entityStore?.stateView.manyBy$((r) => r.state.selected === true);\n    } else {\n      return of([]);\n    }\n  }\n\n  constructor(\n    private featureActionsService: FeatureActionsService,\n    private wfsActionsService: WfsActionsService,\n    private editionActionsService: EditionActionsService,\n    private storageService: StorageService\n  ) {\n    this.initWorkspaces();\n  }\n\n  /**\n   * Initialize the workspace store. Each time a workspace is activated,\n   * subscribe to it's active widget. Tracking the active widget is useful\n   * to make sure only one widget is active at a time.\n   */\n  private initWorkspaces() {\n    this._store = new WorkspaceStore([]);\n    this._store.stateView\n      .firstBy$((record: EntityRecord<Workspace>) => record.state.active === true)\n      .subscribe((record: EntityRecord<Workspace>) => {\n        const workspace = record ? record.entity : undefined;\n        this.workspace$.next(workspace);\n      });\n\n    this._store.stateView.all$()\n    .subscribe((workspaces: EntityRecord<Workspace>[]) => {\n      workspaces.map((wks: EntityRecord<Workspace>) => {\n        if (wks.entity.actionStore.empty) {\n          if (wks.entity instanceof WfsWorkspace) {\n            this.wfsActionsService.loadActions(\n              wks.entity,\n              this.rowsInMapExtentCheckCondition$,\n              this.selectOnlyCheckCondition$);\n          } else if (wks.entity instanceof FeatureWorkspace) {\n            this.featureActionsService.loadActions(\n              wks.entity,\n              this.rowsInMapExtentCheckCondition$,\n              this.selectOnlyCheckCondition$);\n          } else if (wks.entity instanceof EditionWorkspace) {\n            this.editionActionsService.loadActions(\n              wks.entity,\n              this.rowsInMapExtentCheckCondition$,\n              this.selectOnlyCheckCondition$);\n          }\n        }\n\n      });\n    });\n\n    this.actionMaximize$$.push(this.featureActionsService.maximize$.subscribe(maximized => {\n      this.setWorkspaceIsMaximized(maximized);\n    }));\n\n    this.actionMaximize$$.push(this.wfsActionsService.maximize$.subscribe(maximized => {\n      this.setWorkspaceIsMaximized(maximized);\n    }));\n\n    this.actionMaximize$$.push(this.editionActionsService.maximize$.subscribe(maximized => {\n      this.setWorkspaceIsMaximized(maximized);\n    }));\n\n    this.activeWorkspace$$ = this.workspace$\n      .subscribe((workspace: Workspace) => {\n        if (this.activeWorkspaceWidget$$ !== undefined) {\n          this.activeWorkspaceWidget$$.unsubscribe();\n          this.activeWorkspaceWidget$$ = undefined;\n        }\n\n        if (workspace !== undefined) {\n          this.activeWorkspaceWidget$$ = workspace.widget$\n            .subscribe((widget: Widget) => this.activeWorkspaceWidget$.next(widget));\n        }\n      });\n\n    this.rowsInMapExtentCheckCondition$$ = this.rowsInMapExtentCheckCondition$.subscribe((rowsInMapExtent) => {\n      this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\n        if (!wks.entity.actionStore.empty) {\n          const filterStrategy = wks.entity.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n          if (filterStrategy) {\n            if (rowsInMapExtent) {\n              filterStrategy.activate();\n            } else {\n              filterStrategy.deactivate();\n            }\n          }\n        }\n      });\n    });\n\n    this.selectOnlyCheckCondition$$ = this.selectOnlyCheckCondition$.subscribe((selectOnly) => {\n      this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\n        if (!wks.entity.actionStore.empty) {\n          const filterStrategy = wks.entity.entityStore.getStrategyOfType(EntityStoreFilterSelectionStrategy);\n          if (filterStrategy) {\n            if (selectOnly) {\n              filterStrategy.activate();\n            } else {\n              filterStrategy.deactivate();\n            }\n          }\n        }\n      });\n    });\n  }\n\n  private setWorkspaceIsMaximized(maximized: boolean) {\n    this.storageService.set('workspaceMaximize', maximized);\n    this.workspaceMaximize$.next(maximized);\n  }\n\n  public setActiveWorkspaceById(id: string) {\n    const wksFromId = this.store\n    .all()\n    .find(workspace => workspace.id === id);\n    if (wksFromId) {\n      this.store.activateWorkspace(wksFromId);\n    }\n  }\n\n  public setActiveWorkspaceByTitle(title: string) {\n    const wksFromTitle = this.store\n      .all()\n      .find(workspace => workspace.title === title);\n    if (wksFromTitle) {\n      this.store.activateWorkspace(wksFromTitle);\n    }\n  }\n\n  /**\n   * Teardown all the workspaces\n   * @internal\n   */\n  ngOnDestroy() {\n    this.teardownWorkspaces();\n    this.actionMaximize$$.map(a => a.unsubscribe());\n    if (this.rowsInMapExtentCheckCondition$$) {\n      this.selectOnlyCheckCondition$$.unsubscribe();\n    }\n    if (this.selectOnlyCheckCondition$$) {\n      this.selectOnlyCheckCondition$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Teardown the workspace store and any subscribers\n   */\n  private teardownWorkspaces() {\n    this.store.clear();\n    if (this.activeWorkspaceWidget$$ !== undefined) {\n      this.activeWorkspaceWidget$$.unsubscribe();\n    }\n    if (this.activeWorkspace$$ !== undefined) {\n      this.activeWorkspace$$.unsubscribe();\n    }\n  }\n\n}\n","import { Injectable } from '@angular/core';\n\nimport { EntityRecord, EntityStore, EntityStoreFilterCustomFuncStrategy, EntityStoreStrategyFuncOptions } from '@igo2/common';\nimport { ConfigService, StorageService } from '@igo2/core';\nimport { SearchResult, SearchSourceService, SearchSource, CommonVectorStyleOptions } from '@igo2/geo';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n/**\n * Service that holds the state of the search module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class SearchState {\n  public searchOverlayStyle: CommonVectorStyleOptions = {};\n  public searchOverlayStyleSelection: CommonVectorStyleOptions = {};\n  public searchOverlayStyleFocus: CommonVectorStyleOptions = {};\n\n  public focusedOrResolution$$: Subscription;\n  public selectedOrResolution$$: Subscription;\n\n  readonly searchTermSplitter$: BehaviorSubject<string> = new BehaviorSubject('|');\n\n  readonly searchTerm$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly searchDisabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly searchResultsGeometryEnabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly searchSettingsChange$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  readonly selectedResult$: BehaviorSubject<SearchResult> = new BehaviorSubject(undefined);\n\n  /**\n   * Store that holds the search results\n   */\n  readonly store: EntityStore<SearchResult> = new EntityStore<SearchResult>([]);\n\n  /**\n   * Search types currently enabled in the search source service\n   */\n  get searchTypes(): string[] {\n    return this.searchSourceService\n      .getEnabledSources()\n      .map((source: SearchSource) => (source.constructor as any).type);\n  }\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private storageService: StorageService,\n    private configService: ConfigService) {\n    const searchOverlayStyle = this.configService.getConfig('searchOverlayStyle') as {\n      base?: CommonVectorStyleOptions,\n      selection?: CommonVectorStyleOptions,\n      focus?: CommonVectorStyleOptions\n    };\n    if (searchOverlayStyle) {\n      this.searchOverlayStyle = searchOverlayStyle.base;\n      this.searchOverlayStyleSelection = searchOverlayStyle.selection;\n      this.searchOverlayStyleFocus = searchOverlayStyle.focus;\n    }\n\n    const searchResultsGeometryEnabled = this.storageService.get('searchResultsGeometryEnabled') as boolean;\n    if (searchResultsGeometryEnabled) {\n      this.searchResultsGeometryEnabled$.next(searchResultsGeometryEnabled);\n    }\n    this.store.addStrategy(this.createCustomFilterTermStrategy(), false);\n  }\n\n  private createCustomFilterTermStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<SearchResult>) => {\n      return record.entity.meta.score === 100;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n\n  /**\n   * Activate custom strategy\n   *\n   */\n  activateCustomFilterTermStrategy() {\n    const strategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n    if (strategy !== undefined) {\n      strategy.activate();\n    }\n  }\n\n  /**\n   * Deactivate custom strategy\n   *\n   */\n  deactivateCustomFilterTermStrategy() {\n    const strategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n    if (strategy !== undefined) {\n      strategy.deactivate();\n    }\n  }\n\n  enableSearch() {\n    this.searchDisabled$.next(false);\n  }\n\n  disableSearch() {\n    this.searchDisabled$.next(true);\n  }\n\n  setSearchTerm(searchTerm: string) {\n    this.searchTerm$.next(searchTerm);\n  }\n\n  setSearchType(searchType: string) {\n    this.searchSourceService.enableSourcesByType(searchType);\n    this.searchType$.next(searchType);\n  }\n\n  setSearchSettingsChange() {\n    this.searchSettingsChange$.next(true);\n  }\n\n  setSelectedResult(result: SearchResult) {\n    this.selectedResult$.next(result);\n  }\n\n  setSearchResultsGeometryStatus(value) {\n    this.storageService.set('searchResultsGeometryEnabled', value);\n    this.searchResultsGeometryEnabled$.next(value);\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { IgoSearchModule } from '@igo2/geo';\n\nimport { SearchBarBindingDirective } from './search-bar-binding.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [IgoSearchModule],\n  declarations: [SearchBarBindingDirective],\n  exports: [SearchBarBindingDirective],\n})\nexport class IgoAppSearchBarModule {}\n","import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoFlexibleModule, IgoCustomHtmlModule, IgoPanelModule } from '@igo2/common';\nimport {\n  IgoFeatureModule,\n  IgoSearchModule,\n  IgoFeatureDetailsModule\n} from '@igo2/geo';\n\nimport { SearchResultsToolComponent } from './search-results-tool.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatBadgeModule,\n    MatTooltipModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    IgoFeatureModule,\n    IgoSearchModule,\n    IgoFlexibleModule,\n    IgoPanelModule,\n    IgoFeatureDetailsModule,\n    IgoCustomHtmlModule\n  ],\n  declarations: [SearchResultsToolComponent],\n  exports: [SearchResultsToolComponent],\n  schemas: [CUSTOM_ELEMENTS_SCHEMA]\n})\nexport class IgoAppSearchResultsToolModule {}\n","import { NgModule } from '@angular/core';\n\nimport { IgoAppSearchBarModule } from './search-bar/search-bar.module';\nimport { IgoAppSearchResultsToolModule } from './search-results-tool/search-results-tool.module';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [\n   IgoAppSearchBarModule,\n   IgoAppSearchResultsToolModule\n  ],\n})\nexport class IgoAppSearchModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Search</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: ConfigService, LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/search\">code of this example</a><br>\n    See search section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\n    <hr>\n    <br>\n    <span *ngIf=\"!isTouchScreen\" title=\"Details\">\n      F2 activate/deactivate the pointer location.\n    </span>\n  </mat-card-content>\n\n  <igo-map-browser #mapBrowser [map]=\"map\" [view]=\"view\" igoOverlay [igoContextMenu]=actionbarMenu\n\n    igoSearchPointerSummary\n    [igoSearchPointerSummaryDelay]=\"500\"\n    [igoSearchPointerSummaryEnabled]=\"igoSearchPointerSummaryEnabled\"\n    (menuPosition)=\"onContextMenuOpen($event)\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Search\">\n    <igo-search-bar\n      (pointerSummaryStatus)=\"onPointerSummaryStatusChange($event)\"\n      [searchSettings]=\"true\"\n      [store]=\"searchStore\"\n      [termSplitter]=\"termSplitter\"\n      (searchTermChange)=\"onSearchTermChange($event)\"\n      (search)=\"onSearch($event)\"\n      (clearFeature)=\"removeFeatureFromMap()\"\n      (searchSettingsChange)=\"onSearchSettingsChange()\">\n    </igo-search-bar>\n\n    <igo-search-results\n      [store]=\"searchStore\"\n      [term]=\"term\"\n      [termSplitter]=\"termSplitter\"\n      placeholder=\"false\"\n      [settingsChange$]=\"settingsChange$\"\n      (resultFocus)=\"onResultFocus($event)\"\n      (resultSelect)=\"onResultFocus($event)\"\n      (moreResults)=\"onSearch($event)\">\n        <ng-template #igoSearchItemToolbar let-result=\"result\">\n          <igo-search-add-button\n            [map]=\"map\"\n            [layer]=\"result\">\n          </igo-search-add-button>\n        </ng-template>\n    </igo-search-results>\n\n  </igo-panel>\n\n  <igo-panel *ngIf=\"selectedFeature\" title=\"Details\">\n    <igo-feature-details [feature]=\"selectedFeature\"></igo-feature-details>\n  </igo-panel>\n\n</mat-card>\n\n<ng-template #actionbarMenu>\n  <igo-actionbar\n    [store]=\"store\"\n    [withIcon]=\"false\"\n    [horizontal]=\"true\"\n    [mode]=\"'context'\">\n  </igo-actionbar>\n</ng-template>\n\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppSearchComponent } from './search.component';\n\nconst routes: Routes = [\n  {\n    path: 'search',\n    component: AppSearchComponent\n  }\n];\n\nexport const AppSearchRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { BehaviorSubject } from 'rxjs';\nimport {\n  Component,\n  ElementRef,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport * as proj from 'ol/proj';\n\nimport { LanguageService, MediaService } from '@igo2/core';\nimport { EntityStore, ActionStore } from '@igo2/common';\nimport {\n  FEATURE,\n  Feature,\n  FeatureMotion,\n  GoogleLinks,\n  IgoMap,\n  LayerService,\n  MapService,\n  Layer,\n  ProjectionService,\n  Research,\n  SearchResult,\n  SearchService\n} from '@igo2/geo';\n\nimport { SearchState } from '@igo2/integration';\n\n@Component({\n  selector: 'app-search',\n  templateUrl: './search.component.html',\n  styleUrls: ['./search.component.scss']\n})\nexport class AppSearchComponent implements OnInit, OnDestroy {\n  public store = new ActionStore([]);\n\n  public igoSearchPointerSummaryEnabled: boolean = false;\n\n  public termSplitter: string = '|';\n\n  public map = new IgoMap({\n    overlay: true,\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  public osmLayer: Layer;\n\n  @ViewChild('mapBrowser', { read: ElementRef, static: true }) mapBrowser: ElementRef;\n\n  public lonlat;\n  public mapProjection: string;\n  public term: string;\n\n  public settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  get searchStore(): EntityStore<SearchResult> {\n    return this.searchState.store;\n  }\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  public selectedFeature: Feature;\n\n  constructor(\n    private languageService: LanguageService,\n    private projectionService: ProjectionService,\n    private mapService: MapService,\n    private layerService: LayerService,\n    private searchState: SearchState,\n    private searchService: SearchService,\n    private mediaService: MediaService\n  ) {\n    this.mapService.setMap(this.map);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe(layer => {\n        this.osmLayer = layer;\n        this.map.addLayer(layer);\n      });\n  }\n\n  onPointerSummaryStatusChange(value) {\n    this.igoSearchPointerSummaryEnabled = value;\n  }\n\n  onSearchTermChange(term = '') {\n    this.term = term;\n    const termWithoutHashtag = term.replace(/(#[^\\s]*)/g, '').trim();\n    if (termWithoutHashtag.length < 2) {\n      this.searchStore.clear();\n      this.selectedFeature = undefined;\n    }\n  }\n\n  onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    this.searchStore.state.updateAll({ focused: false, selected: false });\n    const newResults = this.searchStore.entities$.value\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n    this.searchStore.updateMany(newResults);\n  }\n\n  onSearchSettingsChange() {\n    this.settingsChange$.next(true);\n  }\n\n  /**\n   * Try to add a feature to the map when it's being focused\n   * @internal\n   * @param result A search result that could be a feature\n   */\n  onResultFocus(result: SearchResult) {\n    this.tryAddFeatureToMap(result);\n    this.selectedFeature = (result as SearchResult<Feature>).data;\n  }\n\n  /**\n   * Try to add a feature to the map overlay\n   * @param layer A search result that could be a feature\n   */\n  private tryAddFeatureToMap(layer: SearchResult) {\n    if (layer.meta.dataType !== FEATURE) {\n      return undefined;\n    }\n\n    // Somethimes features have no geometry. It happens with some GetFeatureInfo\n    if (layer.data.geometry === undefined) {\n      return;\n    }\n\n    this.map.searchResultsOverlay.setFeatures(\n      [layer.data] as Feature[],\n      FeatureMotion.Default\n    );\n  }\n\n  ngOnInit() {\n    this.store.load([\n      {\n        id: 'coordinates',\n        title: 'coordinates',\n        handler: this.onSearchCoordinate.bind(this)\n      },\n      {\n        id: 'googleMaps',\n        title: 'googleMap',\n        handler: this.onOpenGoogleMaps.bind(this),\n        args: ['1']\n      },\n      {\n        id: 'googleStreetView',\n        title: 'googleStreetView',\n        handler: this.onOpenGoogleStreetView.bind(this)\n      }\n    ]);\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  /*\n   * Remove a feature to the map overlay\n   */\n  removeFeatureFromMap() {\n    this.map.searchResultsOverlay.clear();\n  }\n\n  onContextMenuOpen(event: { x: number; y: number }) {\n    const position = this.mapPosition(event);\n    const coord = this.mapService.getMap().ol.getCoordinateFromPixel(position);\n    this.mapProjection = this.mapService.getMap().projection;\n    this.lonlat = proj.transform(coord, this.mapProjection, 'EPSG:4326');\n  }\n\n  mapPosition(event: { x: number; y: number }) {\n    const contextmenuPoint = event;\n    contextmenuPoint.y =\n      contextmenuPoint.y -\n      this.mapBrowser.nativeElement.getBoundingClientRect().top +\n      window.scrollY;\n    contextmenuPoint.x =\n      contextmenuPoint.x -\n      this.mapBrowser.nativeElement.getBoundingClientRect().left +\n      window.scrollX;\n    const position = [contextmenuPoint.x, contextmenuPoint.y];\n    return position;\n  }\n\n  onPointerSearch(event) {\n    this.lonlat = event;\n    this.onSearchCoordinate();\n  }\n\n  onSearchCoordinate() {\n    this.searchStore.clear();\n    const results = this.searchService.reverseSearch(this.lonlat);\n\n    for (const i in results) {\n      if (results.length > 0) {\n        results[i].request.subscribe((_results: SearchResult<Feature>[]) => {\n          this.onSearch({ research: results[i], results: _results });\n        });\n      }\n    }\n  }\n\n  onOpenGoogleMaps() {\n    window.open(GoogleLinks.getGoogleMapsCoordLink(this.lonlat[0], this.lonlat[1]));\n  }\n\n  onOpenGoogleStreetView() {\n    window.open(\n      GoogleLinks.getGoogleStreetViewLink(this.lonlat[0], this.lonlat[1])\n    );\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoMessageModule } from '@igo2/core';\n\nimport {\n  IgoPanelModule,\n  IgoActionbarModule,\n  IgoContextMenuModule\n} from '@igo2/common';\n\nimport {\n  IgoFeatureModule,\n  IgoMapModule,\n  IgoSearchModule,\n  provideIChercheSearchSource,\n  provideILayerSearchSource,\n  provideNominatimSearchSource,\n  provideIChercheReverseSearchSource,\n  provideCoordinatesReverseSearchSource,\n  provideCadastreSearchSource,\n  provideStoredQueriesSearchSource,\n  provideStoredQueriesReverseSearchSource\n} from '@igo2/geo';\n\nimport { IgoAppSearchModule } from '@igo2/integration';\n\nimport { AppSearchComponent } from './search.component';\nimport { AppSearchRoutingModule } from './search-routing.module';\n\n@NgModule({\n  declarations: [AppSearchComponent],\n  imports: [\n    CommonModule,\n    AppSearchRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    IgoMessageModule.forRoot(),\n    IgoPanelModule,\n    IgoMapModule,\n    IgoSearchModule.forRoot(),\n    IgoAppSearchModule,\n    IgoActionbarModule,\n    IgoContextMenuModule,\n    IgoFeatureModule\n  ],\n  exports: [AppSearchComponent],\n  providers: [\n    provideCoordinatesReverseSearchSource(),\n    provideCadastreSearchSource(),\n    provideIChercheSearchSource(),\n    provideILayerSearchSource(),\n    provideNominatimSearchSource(),\n    provideIChercheReverseSearchSource(),\n    provideStoredQueriesSearchSource(),\n    provideStoredQueriesReverseSearchSource()\n  ]\n})\nexport class AppSearchModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppPrintComponent } from './print.component';\n\nconst routes: Routes = [\n  {\n    path: 'print',\n    component: AppPrintComponent\n  }\n];\n\nexport const AppPrintRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { IgoMap, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-print',\n  templateUrl: './print.component.html',\n  styleUrls: ['./print.component.scss']\n})\nexport class AppPrintComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: false\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 9\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private layerService: LayerService\n  ) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'Quebec Base Map',\n        sourceOptions: {\n          type: 'wmts',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts',\n          layer: 'carte_gouv_qc_ro',\n          matrixSet: 'EPSG_3857',\n          version: '1.3.0',\n          crossOrigin: 'anonymous',\n          attributions: \" <a href='http://www.droitauteur.gouv.qc.ca/copyright.php' target='_blank'><img src='https://geoegl.msp.gouv.qc.ca/gouvouvert/public/images/quebec/gouv_qc_logo.png' width='64' height='14'>Gouvernement du Qubec</a> / <a href='https://www.igouverte.org/' target='_blank'>IGO2</a>\"\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'School board',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          params: {\n            LAYERS: 'MELS_CS_ANGLO_S',\n            VERSION: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n    //\n    this.layerService\n      .createAsyncLayer({\n        title: 'Embacle',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          params: {\n            LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n            VERSION: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    // this.layerService\n    //   .createAsyncLayer({\n    //     title: 'Geomet',\n    //     sourceOptions: {\n    //       type: 'wms',\n    //       url: 'http://geo.weather.gc.ca/geomet/?lang=fr',\n    //       params: {\n    //         LAYERS: 'RADAR_1KM_RDBR',\n    //         VERSION: '1.3.0'\n    //       },\n    //       crossOrigin: 'anonymous'\n    //     }\n    //   })\n    //   .subscribe(l => this.map.addLayer(l));\n\n    /*\n        //CORS error if activate (for test)\n        this.layerService\n          .createAsyncLayer({\n            title: 'Geomet',\n            sourceOptions: {\n              type: 'wms',\n              url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wms',\n              params: {\n                layers: 'swtq',\n                version: '1.3.0',\n              }\n            }\n          })\n          .subscribe(l => this.map.addLayer(l));\n    */\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Print</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/print\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-home-extent-button [map]=\"map\" color=\"primary\"></igo-home-extent-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"false\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n  <igo-print [map]=\"map\"></igo-print>\n\n</mat-card>\n\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport { IgoMapModule, IgoPrintModule } from '@igo2/geo';\n\nimport { AppPrintComponent } from './print.component';\nimport { AppPrintRoutingModule } from './print-routing.module';\n\n@NgModule({\n  declarations: [AppPrintComponent],\n  imports: [\n    AppPrintRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoPrintModule\n  ],\n  exports: [AppPrintComponent]\n})\nexport class AppPrintModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppImportExportComponent } from './import-export.component';\n\nconst routes: Routes = [\n  {\n    path: 'import-export',\n    component: AppImportExportComponent\n  }\n];\n\nexport const AppImportExportRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { IgoMap, LayerService } from '@igo2/geo';\nimport { WorkspaceStore } from '@igo2/common';\n\n@Component({\n  selector: 'app-import-export',\n  templateUrl: './import-export.component.html',\n  styleUrls: ['./import-export.component.scss']\n})\nexport class AppImportExportComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 9\n  };\n\n  public store = new WorkspaceStore([]);\n\n  constructor(\n    private languageService: LanguageService,\n    private layerService: LayerService\n  ) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Import / Export</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/import-export\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-import-export [store]=\"store\" [map]=\"map\"></igo-import-export>\n\n</mat-card>\n\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport {\n  IgoMapModule,\n  IgoImportExportModule,\n  provideStyleListOptions\n} from '@igo2/geo';\n\nimport { AppImportExportComponent } from './import-export.component';\nimport { AppImportExportRoutingModule } from './import-export-routing.module';\n\n@NgModule({\n  declarations: [AppImportExportComponent],\n  imports: [\n    AppImportExportRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoImportExportModule\n  ],\n  exports: [AppImportExportComponent],\n  providers: [\n    provideStyleListOptions({\n      path: './assets/import-style.json'\n    })\n  ]\n})\nexport class AppImportExport {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppDirectionsComponent } from './directions.component';\n\nconst routes: Routes = [\n  {\n    path: 'directions',\n    component: AppDirectionsComponent\n  }\n];\n\nexport const AppDirectionsRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  LayerService,\n  MapService,\n  ProjectionService,\n  StopsStore,\n  StopsFeatureStore,\n  RoutesFeatureStore,\n  StepFeatureStore\n} from '@igo2/geo';\nimport { Subject } from 'rxjs';\n\n@Component({\n  selector: 'app-directions',\n  templateUrl: './directions.component.html',\n  styleUrls: ['./directions.component.scss']\n})\nexport class AppDirectionsComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 9,\n    geolocate: false\n  };\n\n  public stopsStore: StopsStore = new StopsStore([]);\n  public stopsFeatureStore: StopsFeatureStore = new StopsFeatureStore([], { map: this.map });\n  public stepFeatureStore: StepFeatureStore = new StepFeatureStore([], { map: this.map });\n  public routesFeatureStore: RoutesFeatureStore = new RoutesFeatureStore([], { map: this.map });\n  public zoomToActiveRoute$: Subject<void> = new Subject();\n\n  constructor(\n    private projectionService: ProjectionService,\n    private languageService: LanguageService,\n    private layerService: LayerService,\n    private mapService: MapService\n  ) {\n    this.mapService.setMap(this.map);\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Directions</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/directions\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-home-extent-button [map]=\"map\" color=\"primary\"></igo-home-extent-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"false\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n  <igo-directions\n    [stopsStore]=\"stopsStore\"\n    [stopsFeatureStore]=\"stopsFeatureStore\"\n    [stepFeatureStore]=\"stepFeatureStore\"\n    [routesFeatureStore]=\"routesFeatureStore\"\n    [zoomToActiveRoute$]=\"zoomToActiveRoute$\">  \n  </igo-directions>\n\n\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport {\n  IgoMapModule,\n  IgoDirectionsModule,\n  provideOsrmDirectionsSource\n} from '@igo2/geo';\n\nimport { AppDirectionsComponent } from './directions.component';\nimport { AppDirectionsRoutingModule } from './directions-routing.module';\n\n@NgModule({\n  declarations: [AppDirectionsComponent],\n  imports: [\n    AppDirectionsRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoDirectionsModule\n  ],\n  exports: [AppDirectionsComponent],\n  providers: [provideOsrmDirectionsSource()]\n})\nexport class AppDirectionsModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppTimeFilterComponent } from './time-filter.component';\n\nconst routes: Routes = [\n  {\n    path: 'time-filter',\n    component: AppTimeFilterComponent\n  }\n];\n\nexport const AppTimeFilterRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  TimeFilterableDataSourceOptions,\n  TimeFilterType,\n  TimeFilterStyle\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-time-filter',\n  templateUrl: './time-filter.component.html',\n  styleUrls: ['./time-filter.component.scss']\n})\nexport class AppTimeFilterComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    // const datasource: TimeFilterableDataSourceOptions = {\n    //   type: 'wms',\n    //   url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\n    //   params: {\n    //     layers: 'vg_observation_v_inondation_embacle_wmst',\n    //     version: '1.3.0'\n    //   },\n    //   timeFilterable: true,\n    //   timeFilter: {\n    //     min: '2017-01-01',\n    //     max: '2018-01-01',\n    //     range: true,\n    //     type: TimeFilterType.DATETIME,\n    //     style: TimeFilterStyle.SLIDER,\n    //     step: 86400000,\n    //     timeInterval: 2000\n    //   }\n    // };\n\n    const datasourceYear: TimeFilterableDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      },\n      timeFilterable: true,\n      timeFilter: {\n        min: '2013',\n        max: '2019',\n        range: false,\n        type: TimeFilterType.YEAR,\n        style: TimeFilterStyle.SLIDER,\n        step: 1,\n        timeInterval: 2000\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceYear)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embcle YEAR',\n            visible: true,\n            source: dataSource\n          })\n        );\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Time filter</mat-card-title>\n  <mat-card-content>\n    <li>npm install --save moment@2.22.2</li>\n    <li>npm install --save @mat-datetimepicker/core@3.0.0-beta.0</li>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/time-filter\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Layers\">\n    <igo-time-filter-list [layers]=\"map.layers\"></igo-time-filter-list>\n  </igo-panel>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoFilterModule } from '@igo2/geo';\n\nimport { AppTimeFilterComponent } from './time-filter.component';\nimport { AppTimeFilterRoutingModule } from './time-filter-routing.module';\n\n@NgModule({\n  declarations: [AppTimeFilterComponent],\n  imports: [\n    AppTimeFilterRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoFilterModule\n  ],\n  exports: [AppTimeFilterComponent]\n})\nexport class AppTimeFilterModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppOgcFilterComponent } from './ogc-filter.component';\n\nconst routes: Routes = [\n  {\n    path: 'ogc-filter',\n    component: AppOgcFilterComponent\n  }\n];\n\nexport const AppOgcFilterRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WMSDataSourceOptions,\n  WFSDataSourceOptions,\n  WFSDataSourceOptionsParams,\n  OgcFilterableDataSourceOptions,\n  AnyBaseOgcFilterOptions,\n  OgcFilterOperatorType,\n  OgcFilterDuringOptions\n} from '@igo2/geo';\n\nimport {Fill, Stroke, Circle, Style} from 'ol/style';\n\n@Component({\n  selector: 'app-ogc-filter',\n  templateUrl: './ogc-filter.component.html',\n  styleUrls: ['./ogc-filter.component.scss']\n})\nexport class AppOgcFilterComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const datasource: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'code_municipalite', alias: '# de la municipalite' },\n        { name: 'date_observation', excludeFromOgcFilters: true },\n        { name: 'urgence', values: ['immdiate', 'inconnue'] }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          logical: 'Or',\n          filters: [\n            {\n              operator: 'PropertyIsEqualTo',\n              propertyName: 'code_municipalite',\n              expression: '10043'\n            },\n            {\n              operator: 'Intersects',\n              geometryName: 'the_geom',\n              wkt_geometry: `MULTIPOLYGON(((\n              -8379441.158019895 5844447.897707146,\n              -8379441.158019895 5936172.331649357,\n              -8134842.66750733 5936172.331649357,\n              -8134842.66750733 5844447.897707146,\n              -8379441.158019895 5844447.897707146\n            ), (\n              -8015003 5942074,\n              -8015003 5780349,\n              -7792364 5780349,\n              -7792364 5942074,\n              -8015003 5942074\n            )))`\n            }\n          ] as AnyBaseOgcFilterOptions[]\n        }\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embcle (PropertyIsEqualTo OR Intersects)',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'orange',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilter: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2016-01-21T00:00:00-05:00',\n            end: '2016-01-26T00:00:00-05:00'\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2016-02-10T00:00:00-05:00',\n      stepDate: 'P2D'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilter)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embcle (During, Step: P2D)',\n            id: '1',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'red',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n\n    const datasourceDuringFilterTime: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2016-01-01T04:00:00-05:00',\n            end: '2016-01-12T16:00:00-05:00'\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2016-02-14T20:00:00-05:00',\n      stepDate: 'PT4H'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTime)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embcle (During, Step: PT4H)',\n            id: '2',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'blue',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeMonth: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2016-01-01T00:00:00-05:00',\n            end: '2016-03-31T00:00:00-05:00',\n            displayFormat: 'MMMM'\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2018-12-31T00:00:00-05:00',\n      stepDate: 'P1M'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeMonth)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embcle (During, Step: P1M)',\n            id: '3',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'yellow',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeYear: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2014-01-01T00:00:00-05:00',\n            end: '2019-12-31T00:00:00-05:00',\n            sliderOptions: {\n              interval: 2000,\n              displayFormat: 'YY'\n            },\n            displayFormat: 'YYYY'\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2014-01-01T00:00:00-05:00',\n      maxDate: '2019-12-31T00:00:00-05:00',\n      stepDate: 'P1Y'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeYear)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embcle (During, Step: P1Y)',\n            id: '4',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'green',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeInterval: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: 'today - 2 days', // \"now\" can also be used. Instead of midnight, the current time will be used\n            end: 'today', // \"now\" can also be used. Instead of midnight, the current time will be used\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2025-12-31T00:00:00-05:00',\n      stepDate: 'P1D'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeInterval)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embcle (During, Interval from Now, Step: P1D)',\n            id: '5',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'black',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeRestrictedToStep: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2019-01-01 00:00:00',\n            restrictToStep: true\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2025-12-31T00:00:00-05:00',\n      stepDate: 'P1M'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeRestrictedToStep)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embcle (During, RestrictToStep, Step: P1M)',\n            id: '6',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'black'\n                }),\n                stroke: new Stroke({\n                  color: 'red',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const wmsOgcFilterOptions: WMSoptions = {\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n        optionsFromCapabilities: true,\n        params: {\n          LAYERS: 'vg_observation_v_inondation23avril2017_wmst',\n          VERSION: '1.3.0'\n        },\n        sourceFields: [\n          { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n        ],\n        ogcFilters: {\n          enabled: true,\n          editable: true,\n          filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation'\n          } as OgcFilterDuringOptions,\n          allowedOperatorsType: OgcFilterOperatorType.Time\n        }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wmsOgcFilterOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Inondation (During, optionsFromCapabilities)',\n            source: dataSource\n          })\n        );\n      });\n\n    interface WMSoptions\n      extends WMSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const filterableWMSwithPushButtons: WMSoptions = {\n      type: 'wms',\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      params: {\n        LAYERS: 'radars_photos',\n        VERSION: '1.3.0'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        pushButtons: {\n          selectorType: 'pushButton',\n          order: 2,\n          groups : [\n            {title: 'Nom du group1 - push', name: '1 - push', ids : ['id1']},\n          ],\n          bundles: [\n            {\n              id: 'id1',\n              title: 'Rgions',\n              logical: 'Or',\n              vertical: true,\n              selectors: [\n                {\n                  title: 'Montral & Laval',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    logical: 'Or',\n                    filters: [\n                      {\n                        operator: 'PropertyIsEqualTo',\n                        propertyName: 'region',\n                        expression: 'Montral'\n                      },\n                      {\n                        operator: 'PropertyIsEqualTo',\n                        propertyName: 'region',\n                        expression: 'Laval'\n                      }\n                    ]\n                  }\n                },\n                {\n                  title: 'Outside Montral & Laval',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    logical: 'And',\n                    filters: [\n                      {\n                        operator: 'PropertyIsNotEqualTo',\n                        propertyName: 'region',\n                        expression: 'Montral'\n                      },\n                      {\n                        operator: 'PropertyIsNotEqualTo',\n                        propertyName: 'region',\n                        expression: 'Laval'\n                      }\n                    ]\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        checkboxes: {\n          selectorType: 'checkbox',\n          order: 1,\n          groups : [\n            {title: 'Nom du group1 - checkbox', name: '1 - checkbox', ids : ['id1']},\n          ],\n          bundles: [\n            {\n              id: 'id1',\n              title: 'Type de radar photo',\n              logical: 'Or',\n              selectors: [\n                {\n                  title: 'Radar photo fixe',\n                  enabled: true,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo fixe'\n                  }\n                },\n                {\n                  title: 'Radar photo mobile',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo mobile'\n                  }\n                },\n                {\n                  title: 'Radar photo fixe + feu rouge',\n                  enabled: false,\n                  color: '0,200,0',\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo fixe et surveillance au feu rouge'\n                  }\n                },\n                {\n                  title: 'Radar feu rouge',\n                  enabled: false,\n                  color: '255,0,0',\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Appareil de surveillance au feu rouge'\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        allowedOperatorsType: OgcFilterOperatorType.Basic\n        },\n      paramsWFS: {\n        featureTypes: 'radars_photos',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '1.1.0',\n        outputFormat: 'geojson',\n        outputFormatDownload: 'shp'\n      } as WFSDataSourceOptionsParams\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(filterableWMSwithPushButtons)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Filterable WMS layers with predefined filters (push buttons)',\n            source: dataSource\n          })\n        );\n      });\n\n    // const datasourceWmsWith2Layers: WMSoptions = {\n    //   type: 'wms',\n    //   url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n    //   urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n    //   params: {\n    //     layers: 'stations_meteoroutieres,histo_stations_meteoroutieres',\n    //     version: '1.3.0'\n    //   },\n    //   ogcFilters: {\n    //     enabled: true,\n    //     editable: true\n    //   },\n    //   paramsWFS: {\n    //     featureTypes: 'histo_stations_meteoroutieres',\n    //     fieldNameGeometry: 'geometry',\n    //     maxFeatures: 10000,\n    //     version: '1.1.0',\n    //     outputFormat: 'geojson',\n    //     outputFormatDownload: 'shp'\n    //   } as WFSDataSourceOptionsParams\n    // };\n    //\n    // this.dataSourceService\n    //   .createAsyncDataSource(datasourceWmsWith2Layers)\n    //   .subscribe(dataSource => {\n    //     this.map.addLayer(\n    //       this.layerService.createLayer({\n    //         title: 'Layer build from 2 WMS layers',\n    //         source: dataSource\n    //       })\n    //     );\n    //   });\n\n    // const datasourceWms: WMSoptions = {\n    //   type: 'wms',\n    //   url: '/geoserver/wms',\n    //   urlWfs: '/geoserver/wfs',\n    //   params: {\n    //     LAYERS: 'water_areas',\n    //     VERSION: '1.3.0'\n    //   },\n    //   ogcFilters: {\n    //     enabled: true,\n    //     editable: true,\n    //     filters: {\n    //       operator: 'PropertyIsEqualTo',\n    //       propertyName: 'waterway',\n    //       expression: 'riverbank'\n    //     }\n    //   },\n    //   sourceFields: [\n    //     { name: 'waterway', alias: 'Chemin d eau' },\n    //     { name: 'osm_id' },\n    //     { name: 'landuse', values: ['yes', 'no'] }\n    //   ],\n    //   paramsWFS: {\n    //     featureTypes: 'water_areas',\n    //     fieldNameGeometry: 'the_geom',\n    //     maxFeatures: 10000,\n    //     version: '1.1.0',\n    //     outputFormat: 'application/json',\n    //     outputFormatDownload: 'application/vnd.google-earth.kml+xml'\n    //   } as WFSDataSourceOptionsParams\n    // };\n    //\n    // this.dataSourceService\n    //   .createAsyncDataSource(datasourceWms)\n    //   .subscribe(dataSource => {\n    //     this.map.addLayer(\n    //       this.layerService.createLayer({\n    //         title: 'Geoserver water_areas',\n    //         source: dataSource\n    //       })\n    //     );\n    //   });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Ogc filter</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/ogc-filter\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Layers\">\n    <igo-ogc-filterable-list [map]=\"map\" [layers]=\"map.layers\">\n\n    </igo-ogc-filterable-list>\n  </igo-panel>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoFilterModule } from '@igo2/geo';\n\nimport { AppOgcFilterComponent } from './ogc-filter.component';\nimport { AppOgcFilterRoutingModule } from './ogc-filter-routing.module';\n\n@NgModule({\n  declarations: [AppOgcFilterComponent],\n  imports: [\n    AppOgcFilterRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoFilterModule\n  ],\n  exports: [AppOgcFilterComponent]\n})\nexport class AppOgcFilterModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Spatial filter</mat-card-title>\n  <mat-card-content>\n    <li>npm install --save moment@2.22.2</li>\n    <li>npm install --save @mat-datetimepicker/core@3.0.0-beta.0</li>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/spatial-filter\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser\n    [map]=\"map\"\n    [view]=\"view\"\n    igoOverlay igoQuery\n    (query)=\"handleQueryResults($event)\"\n    [queryFeatures]=\"true\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Spatial Filter\">\n    <igo-spatial-filter-type\n      [store]=\"spatialListStore\"\n      [selectedQueryType]=\"queryType\"\n      [zone]=\"zone\"\n      (eventType)=\"getOutputType($event)\"\n      (eventQueryType)=\"getOutputQueryType($event)\"\n      (zoneChange)=\"onZoneChange($event)\">\n    </igo-spatial-filter-type>\n\n    <igo-spatial-filter-item\n      [type]=\"type\"\n      [queryType]=\"queryType\"\n      [map]=\"map\"\n      [zone]=\"zone\"\n      [loading]=\"loading\"\n      [store]=\"store\"\n      [layers]=\"layers\"\n      (radiusEvent)=\"radius = $event\"\n      (freehandControl)=\"freehandDrawIsActive = $event\"\n      (drawZoneEvent)=\"zone = $event\"\n      (itemTypeChange)=\"itemType = $event\"\n      (thematicChange)=\"thematics = $event\"\n      (toggleSearch)=\"getOutputToggleSearch()\"\n      (clearButtonEvent)=\"layers = $event\"\n      (clearSearchEvent)=\"getOutputClearSearch()\">\n    </igo-spatial-filter-item>\n  </igo-panel>\n\n  <igo-panel title=\"Details\">\n    <ng-container *ngIf=\"selectedFeature$ | async as feature\">\n      <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n    </ng-container>\n  </igo-panel>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppSpatialFilterComponent } from './spatial-filter.component';\n\nconst routes: Routes = [\n  {\n    path: 'spatial-filter',\n    component: AppSpatialFilterComponent\n  }\n];\n\nexport const AppSpatialFilterRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, Input } from '@angular/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  Feature,\n  moveToOlFeatures,\n  FeatureMotion,\n  ClusterDataSource,\n  featureToOl,\n  DataSource,\n  QueryableDataSourceOptions,\n  Layer,\n  SpatialFilterService,\n  SpatialFilterQueryType,\n  SpatialFilterType,\n  SpatialFilterItemType,\n  SpatialFilterThematic\n} from '@igo2/geo';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { EntityStore } from '@igo2/common';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\nimport { BehaviorSubject } from 'rxjs';\nimport * as olstyle from 'ol/style';\nimport olSourceCluster from 'ol/source/Cluster';\nimport olSourceVector from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Component({\n  selector: 'app-spatial-filter',\n  templateUrl: './spatial-filter.component.html',\n  styleUrls: ['./spatial-filter.component.scss']\n})\nexport class AppSpatialFilterComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  view = {\n    center: [-71.9, 46.9],\n    zoom: 10\n  };\n\n  @Input() type: SpatialFilterType;\n  @Input() itemType: SpatialFilterItemType = SpatialFilterItemType.Address;\n  @Input() freehandDrawIsActive: boolean;\n\n  public layers: Layer[] = [];\n\n  public queryType: SpatialFilterQueryType;\n  public thematics: SpatialFilterThematic[];\n  public zone: Feature;\n  public radius: number;\n\n  public selectedFeature$: BehaviorSubject<Feature> = new BehaviorSubject(\n    undefined\n  );\n\n  private format = new olFormatGeoJSON();\n\n  public store = new EntityStore<Feature>([]); // Store to print results at the end\n\n  public spatialListStore = new EntityStore<Feature>([]);\n\n  public loading = false;\n\n  constructor(\n    private spatialFilterService: SpatialFilterService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private messageService: MessageService,\n    private languageService: LanguageService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource,\n            baseLayer: true,\n            visible: true\n          })\n        );\n      });\n  }\n\n  getOutputType(event: SpatialFilterType) {\n    this.type = event;\n    this.queryType = undefined;\n    this.radius = undefined;\n  }\n\n  getOutputQueryType(event: SpatialFilterQueryType) {\n    this.queryType = event;\n    if (this.queryType) {\n      this.loadFilterList();\n    }\n  }\n\n  private loadFilterList() {\n    this.spatialFilterService\n      .loadFilterList(this.queryType)\n      .subscribe((features: Feature[]) => {\n        features.sort((a, b) => {\n          if (a.properties.nom < b.properties.nom) {\n            return -1;\n          }\n          if (a.properties.nom > b.properties.nom) {\n            return 1;\n          }\n          return 0;\n        });\n        this.spatialListStore.clear();\n        this.spatialListStore.load(features);\n      });\n  }\n\n  getOutputToggleSearch() {\n    this.loadThematics();\n  }\n\n  getOutputClearSearch() {\n    this.zone = undefined;\n    this.queryType = undefined;\n  }\n\n  private loadThematics() {\n    this.loading = true;\n    this.tryAddFeaturesToMap([this.zone]);\n    if (!this.thematics) {\n      const theme: SpatialFilterThematic = {\n        name: ''\n      };\n      this.thematics = [theme];\n    }\n    if (this.type === SpatialFilterType.Polygon) {\n      this.radius = undefined;\n    }\n    this.thematics.forEach(thematic => {\n      this.spatialFilterService\n        .loadFilterItem(\n          this.zone,\n          this.itemType,\n          this.queryType,\n          thematic,\n          this.radius\n        )\n        .subscribe((features: Feature[]) => {\n          this.store.insertMany(features);\n          const featuresPoint: Feature[] = [];\n          const featuresLinePoly: Feature[] = [];\n          let idPoint;\n          let idLinePoly;\n          features.forEach(feature => {\n            if (feature.geometry.type === 'Point') {\n              featuresPoint.push(feature);\n              idPoint = feature.meta.id;\n            } else {\n              featuresLinePoly.push(feature);\n              idLinePoly = feature.meta.id;\n            }\n          });\n          this.tryAddPointToMap(featuresPoint, idPoint);\n          this.tryAddLayerToMap(featuresLinePoly, idLinePoly);\n          this.loading = false;\n          if (features.length >= 10000) {\n            this.messageService.alert(\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.maxSizeAlert'\n              ),\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.warning'\n              ),\n              { timeOut: 10000 }\n            );\n          }\n          if (!features.length) {\n            this.messageService.alert(\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.zeroResults'\n              ),\n              this.languageService.translate.instant(\n                'igo.geo.spatialFilter.warning'\n              ),\n              { timeOut: 10000 }\n            );\n          }\n        });\n    });\n  }\n\n  onZoneChange(feature: Feature) {\n    this.zone = feature;\n    if (feature) {\n      this.tryAddFeaturesToMap([feature]);\n      this.zoomToFeatureExtent(feature);\n    }\n  }\n\n  /**\n   * Try to add zone feature to the map overlay\n   */\n  public tryAddFeaturesToMap(features: Feature[]) {\n    let i = 1;\n    for (const feature of features) {\n      if (this.type === SpatialFilterType.Predefined) {\n        for (const layer of this.map.layers) {\n          if (\n            layer.options._internal &&\n            layer.options._internal.code === feature.properties.code\n          ) {\n            return;\n          }\n          if (layer.title.startsWith('Zone')) {\n            this.map.removeLayer(layer);\n          }\n        }\n      }\n      for (const layer of this.map.layers) {\n        if (layer.title.startsWith('Zone')) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .subscribe((dataSource: DataSource) => {\n          const olLayer = this.layerService.createLayer({\n            title: ('Zone ' + i) as string,\n            _internal: {\n              code:\n                this.type === SpatialFilterType.Predefined\n                  ? feature.properties.code\n                  : undefined\n            },\n            source: dataSource,\n            visible: true,\n            style: (_feature, resolution) => {\n              const coordinates = (features[0] as any).coordinates;\n              return new olstyle.Style({\n                image: new olstyle.Circle({\n                  radius: coordinates\n                    ? this.radius /\n                      Math.cos((Math.PI / 180) * coordinates[1]) /\n                      resolution\n                    : undefined,\n                  fill: new olstyle.Fill({\n                    color: 'rgba(200, 200, 20, 0.2)'\n                  }),\n                  stroke: new olstyle.Stroke({\n                    width: 1,\n                    color: 'orange'\n                  })\n                }),\n                stroke: new olstyle.Stroke({\n                  width: 1,\n                  color: 'orange'\n                }),\n                fill: new olstyle.Fill({\n                  color: 'rgba(200, 200, 20, 0.2)'\n                })\n              });\n            }\n          });\n          const featuresOl = features.map(f => {\n            return featureToOl(f, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceVector<OlGeometry> | olSourceCluster;\n          ol.addFeatures(featuresOl);\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n        });\n    }\n  }\n\n  /**\n   * Try to point features to the map\n   * Necessary to create clusters\n   */\n  private tryAddPointToMap(features: Feature[], id) {\n    let i = 1;\n    if (features.length >= 1) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.map.layers) {\n        if (layer.title.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'cluster',\n          id,\n          queryable: true,\n          distance: 120,\n          meta: {\n            title: 'Cluster'\n          }\n        } as QueryableDataSourceOptions)\n        .subscribe((dataSource: ClusterDataSource) => {\n          const olLayer = this.layerService.createLayer({\n            title: (features[0].meta.title + ' ' + i) as string,\n            source: dataSource,\n            visible: true,\n            clusterParam: {\n              clusterRanges: [{ minRadius: 1, maxRadius: 5, style: {} }]\n            }\n          });\n          const featuresOl = features.map(feature => {\n            return featureToOl(feature, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceCluster;\n          ol.getSource().addFeatures(featuresOl);\n          if (this.map.layers.find(layer => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.map.layers.find(layer => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title + ' ' + i) as string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n        });\n    }\n  }\n\n  /**\n   * Try to add line or polygon features to the map\n   */\n  private tryAddLayerToMap(features: Feature[], id) {\n    let i = 1;\n    if (features.length > 1) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.map.layers) {\n        if (layer.title.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          id,\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .subscribe((dataSource: DataSource) => {\n          const olLayer = this.layerService.createLayer({\n            title: (features[0].meta.title + ' ' + i) as string,\n            source: dataSource,\n            visible: true\n          });\n          const featuresOl = features.map(feature => {\n            return featureToOl(feature, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceVector<OlGeometry> | olSourceCluster;\n          ol.addFeatures(featuresOl);\n          if (this.map.layers.find(layer => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.map.layers.find(layer => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title + ' ' + i) as string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n        });\n    }\n  }\n\n  zoomToFeatureExtent(feature) {\n    if (feature) {\n      const olFeature = this.format.readFeature(feature, {\n        dataProjection: feature.projection,\n        featureProjection: this.map.projection\n      });\n      moveToOlFeatures(this.map, [olFeature], FeatureMotion.Zoom);\n    }\n  }\n\n  /**\n   * Permit the query action on one item result\n   */\n  handleQueryResults(results) {\n    const features: Feature[] = results.features;\n    let feature;\n    if (features.length) {\n      feature = features[0];\n    }\n    this.selectedFeature$.next(feature);\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule, IgoFormModule } from '@igo2/common';\nimport { IgoMapModule, IgoFilterModule, IgoQueryModule, IgoFeatureModule, IgoFeatureDetailsModule } from '@igo2/geo';\nimport { IgoMessageModule } from '@igo2/core';\n\nimport { AppSpatialFilterComponent } from './spatial-filter.component';\nimport { AppSpatialFilterRoutingModule } from './spatial-filter-routing.module';\n\n@NgModule({\n  declarations: [AppSpatialFilterComponent],\n  imports: [\n    AppSpatialFilterRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoMessageModule,\n    IgoQueryModule,\n    IgoFeatureModule,\n    IgoFeatureDetailsModule,\n    IgoFilterModule,\n    IgoFormModule,\n    CommonModule\n  ],\n  exports: [AppSpatialFilterComponent]\n})\nexport class AppSpatialFilterModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Workspace</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/workspace\">code of this example</a>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-workspace-selector\n    igoWorkspaceSelector\n    [store]=\"workspaceStore\"\n    [map]=\"map\">\n  </igo-workspace-selector>\n\n  <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\n    <igo-entity-table-paginator\n      *ngIf=\"workspace.inResolutionRange$ | async\"\n      [store]=\"workspace.entityStore\"\n      [paginatorOptions]=\"paginatorOptions\"\n      [entitySortChange$]=\"entitySortChange$\"\n      (paginatorChange)=\"paginatorChange($event)\">\n    </igo-entity-table-paginator>\n  </ng-container>\n\n  <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\n    <igo-actionbar\n      *ngIf=\"workspace.actionStore\"\n      [store]=\"workspace.actionStore\"\n      [horizontal]=\"true\"\n      [withToggleButton]=\"true\"\n      [withTitle]=\"true\"\n      [mode]=\"actionbarMode\">\n    </igo-actionbar>\n\n    <igo-entity-table\n      *ngIf=\"workspace.entityStore && workspace.meta && workspace.meta.tableTemplate && (workspace.inResolutionRange$ | async)\"\n      class=\"table-compact table-centered\"\n      [paginator]=\"workspacePaginator\"\n      [scrollBehavior]=\"scrollBehavior\"\n      [store]=\"workspace.entityStore\"\n      [template]=\"workspace.meta.tableTemplate\">\n    </igo-entity-table>\n    <mat-card-content\n    *ngIf=\"(workspace.inResolutionRange$ | async) === false\">\n      No data available at this scale. Please zoom in. \n    </mat-card-content>\n\n    <igo-workspace-widget-outlet [workspace]=\"workspace\"></igo-workspace-widget-outlet>\n\n  </ng-container>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppWorkspaceComponent } from './workspace.component';\n\nconst routes: Routes = [\n  {\n    path: 'workspace',\n    component: AppWorkspaceComponent\n  }\n];\n\nexport const AppWorkspaceRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit } from '@angular/core';\n\nimport { Observable, BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  ActionbarMode,\n  EntityRecord,\n  EntityTableScrollBehavior,\n  Workspace,\n  WorkspaceStore,\n  EntityTablePaginatorOptions\n} from '@igo2/common';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WFSDataSourceOptions\n} from '@igo2/geo';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { WorkspaceState } from '@igo2/integration';\n\n@Component({\n  selector: 'app-workspace',\n  templateUrl: './workspace.component.html',\n  styleUrls: ['./workspace.component.scss']\n})\nexport class AppWorkspaceComponent implements OnInit {\n\n  public workspacePaginator: MatPaginator;\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public paginatorOptions: EntityTablePaginatorOptions = {\n    pageSize: 5, // Number of items to display on a page.\n    pageSizeOptions: [1, 5, 10, 15, 30, 50, 100], // The set of provided page size options to display to the user.\n    showFirstLastButtons: true // Whether to show the first/last buttons UI to the user.\n  };\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-72, 47.2],\n    zoom: 5\n  };\n\n  get workspaceStore(): WorkspaceStore {\n    return this.workspaceState.store;\n  }\n\n  public selectedWorkspace$: Observable<Workspace>;\n\n  public actionbarMode = ActionbarMode.Overlay;\n\n  public scrollBehavior = EntityTableScrollBehavior.Instant;\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    public workspaceState: WorkspaceState,\n  ) {}\n\n  ngOnInit() {\n    this.selectedWorkspace$ = this.workspaceStore.stateView\n      .firstBy$(\n        (record: EntityRecord<Workspace>) => record.state.selected === true\n      )\n      .pipe(\n        map((record: EntityRecord<Workspace>) => {\n          const entity = record === undefined ? undefined : record.entity;\n          if (entity) {\n            // In fact, the download action is not fully functionnal into the igo2-lib demo\n            // The reason why it's has been remove is that this button trigger a tool (importExport)\n            // and this tool is not available in the igo2-lib demo.\n            // This is why it's has been removed frome the actions's list.\n            // Refer to the igo2 demo at https://infra-geo-ouverte.github.io/igo2/\n            entity.actionStore.view.filter((action) => {\n              return action.id !== 'wfsDownload';\n            });\n          }\n          return entity;\n\n        })\n      );\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    // const wmsDataSourceOptions = {\n    //   type: 'wms',\n    //   url: 'https://ahocevar.com/geoserver/wms',\n    //   urlWfs: 'https://ahocevar.com/geoserver/wfs',\n    //   params: {\n    //     LAYERS: 'water_areas',\n    //     VERSION: '1.3.0'\n    //   },\n    //   paramsWFS: {\n    //     featureTypes: 'water_areas',\n    //     fieldNameGeometry: 'the_geom',\n    //     maxFeatures: 10000,\n    //     version: '1.1.0',\n    //     outputFormat: 'application/json',\n    //     outputFormatDownload: 'application/vnd.google-earth.kml+xml'\n    //   },\n    //   sourceFields: [\n    //     {name: 'waterway', alias: 'Chemin d eau'},\n    //     {name: 'osm_id'},\n    //     {name: 'landuse'}\n    //   ],\n    //   ogcFilters: {\n    //     enabled: true,\n    //     editable: true\n    //   },\n    //   serverType: 'geoserver'\n    // };\n    //\n    // this.dataSourceService\n    //   .createAsyncDataSource(wmsDataSourceOptions as OgcFilterableDataSourceOptions)\n    //   .subscribe(dataSource => {\n    //     const layer = {\n    //       optionsFromCapabilities: true,\n    //       title: 'WMS Geoserver filterable ',\n    //       visible: true,\n    //       source: dataSource\n    //     };\n    //     this.map.addLayer(this.layerService.createLayer(layer));\n    //   });\n\n    const wfsDataSourceOptions: WFSDataSourceOptions = {\n      type: 'wfs',\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      params: {\n        featureTypes: 'etablissement_mtq',\n        fieldNameGeometry: 'geometry',\n        version: '2.0.0',\n        outputFormat: 'geojson'\n      },\n      sourceFields: [\n        { name: 'idetablis', alias: 'ID' },\n        { name: 'nometablis', alias: 'Name' },\n        { name: 'typetablis', alias: 'Type' }\n      ]\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDataSourceOptions)\n      .subscribe(dataSource => {\n        const layer = {\n          title: 'Simple WFS ',\n          maxResolution: 3000,\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.workspacePaginator = event;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport {\n  IgoActionModule,\n  IgoEntityModule,\n  IgoWorkspaceModule,\n  IgoPanelModule\n} from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoGeoWorkspaceModule\n} from '@igo2/geo';\n\nimport { AppWorkspaceComponent } from './workspace.component';\nimport { AppWorkspaceRoutingModule } from './workspace-routing.module';\n\n@NgModule({\n  declarations: [AppWorkspaceComponent],\n  imports: [\n    CommonModule,\n    AppWorkspaceRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoActionModule,\n    IgoEntityModule,\n    IgoWorkspaceModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoGeoWorkspaceModule\n  ],\n  exports: [AppWorkspaceComponent]\n})\nexport class AppWorkspaceModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Context</mat-card-title>\n  <mat-card-content>\n    <p>* Dependencies: LanguageService</p>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/context/context\">code of this example</a><br>\n    See <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/contexts\"> contexts</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser\n    igoMapContext\n    igoLayerContext\n    [map]=\"map\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-home-extent-button [map]=\"map\" color=\"primary\"></igo-home-extent-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"true\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Contexts list\">\n    <igo-context-list igoContextListBinding [map]=\"map\"></igo-context-list>\n  </igo-panel>\n\n  <igo-panel title=\"Layers\">\n    <igo-layer-list igoLayerListBinding [map]=\"map\">\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n      </ng-template>\n    </igo-layer-list>\n  </igo-panel>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppContextComponent } from './context.component';\n\nconst routes: Routes = [\n  {\n    path: 'context',\n    component: AppContextComponent\n  }\n];\n\nexport const AppContextRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { IgoMap, OverlayService, MapService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-context',\n  templateUrl: './context.component.html',\n  styleUrls: ['./context.component.scss']\n})\nexport class AppContextComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private mapService: MapService,\n    private overlayService: OverlayService\n  ) {\n    this.mapService.setMap(this.map);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\nimport { HttpClientJsonpModule } from '@angular/common/http';\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoMetadataModule,\n  IgoOverlayModule,\n  IgoQueryModule,\n  IgoFeatureModule\n} from '@igo2/geo';\nimport { IgoContextManagerModule } from '@igo2/context';\n\nimport { AppContextComponent } from './context.component';\nimport { AppContextRoutingModule } from './context-routing.module';\n\n@NgModule({\n  declarations: [AppContextComponent],\n  imports: [\n    HttpClientJsonpModule,\n    AppContextRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoMetadataModule,\n    IgoOverlayModule,\n    IgoQueryModule,\n    IgoFeatureModule,\n    IgoContextManagerModule\n  ],\n  exports: [AppContextComponent]\n})\nexport class AppContextModule {}\n","import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\n\nconst routes: Routes = [\n  { path: '', redirectTo: '/home', pathMatch: 'full' },\n  { path: '**', redirectTo: '/home' }\n];\n\n@NgModule({\n  imports: [RouterModule.forRoot(routes, { useHash: true })],\n  exports: [RouterModule]\n})\nexport class AppRoutingModule {}\n","import { MediaMatcher } from '@angular/cdk/layout';\nimport {\n  ChangeDetectorRef,\n  Component,\n  OnDestroy,\n  Renderer2\n} from '@angular/core';\n\nimport { userAgent } from '@igo2/utils';\nimport { version } from '@igo2/core';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.scss']\n})\nexport class AppComponent implements OnDestroy {\n  mobileQuery: MediaQueryList;\n\n  public title = 'IGO';\n  public version = version;\n  private themeClass = 'deeppurple-theme';\n  private _mobileQueryListener: () => void;\n\n  constructor(\n    private changeDetectorRef: ChangeDetectorRef,\n    private media: MediaMatcher,\n    private renderer: Renderer2\n  ) {\n    this.mobileQuery = media.matchMedia('(max-width: 600px)');\n    this._mobileQueryListener = () => changeDetectorRef.detectChanges();\n    this.mobileQuery.addEventListener('change', this._mobileQueryListener);\n\n    this.renderer.addClass(document.body, this.themeClass);\n\n    this.detectOldBrowser();\n  }\n\n  ngOnDestroy(): void {\n    this.mobileQuery.removeEventListener('change', this._mobileQueryListener);\n  }\n\n  private detectOldBrowser() {\n    const oldBrowser = userAgent.satisfies({\n      ie: '<11',\n      chrome: '<64',\n      firefox: '<60'\n    });\n\n    if (oldBrowser) {\n      console.log('Very old browser ! ', userAgent.getBrowser());\n    }\n  }\n}\n","<div class=\"example-container\" [class.example-is-mobile]=\"mobileQuery.matches\">\n  <mat-toolbar color=\"primary\" class=\"example-toolbar\">\n    <button mat-icon-button (click)=\"snav.toggle()\"><mat-icon svgIcon=\"menu\"></mat-icon></button>\n    <h1>{{title}}</h1>\n    <h5>{{version.lib}}</h5>\n  </mat-toolbar>\n\n  <mat-sidenav-container class=\"example-sidenav-container\" [style.marginTop.px]=\"mobileQuery.matches ? 56 : 0\">\n    <mat-sidenav #snav opened=\"true\" [mode]=\"mobileQuery.matches ? 'over' : 'side'\" [fixedInViewport]=\"mobileQuery.matches\" fixedTopGap=\"56\">\n      <mat-nav-list>\n        <a mat-list-item routerLink=\".\">Home</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"activity\">Activity</a>\n        <a mat-list-item routerLink=\"config\">Config</a>\n        <a mat-list-item routerLink=\"language\">Language</a>\n        <a mat-list-item routerLink=\"media\">Media</a>\n        <a mat-list-item routerLink=\"message\">Message</a>\n        <a mat-list-item routerLink=\"request\">Request</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"auth-form\">Authentification</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"action\">Action</a>\n        <a mat-list-item routerLink=\"dynamic-component\">Dynamic Component</a>\n        <a mat-list-item routerLink=\"entity-table\">Entity Table</a>\n        <a mat-list-item routerLink=\"entity-selector\">Entity Selector</a>\n        <a mat-list-item routerLink=\"form\">Form</a>\n        <a mat-list-item routerLink=\"table\">Table</a>\n        <a mat-list-item routerLink=\"tool\">Tool</a>\n        <a mat-list-item routerLink=\"widget\">Widget</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"simple-map\">Simple map</a>\n        <a mat-list-item routerLink=\"layer\">Layer</a>\n        <a mat-list-item routerLink=\"legend\">Legend</a>\n        <a mat-list-item routerLink=\"overlay\">Overlay</a>\n        <a mat-list-item routerLink=\"geometry\">Geometry</a>\n        <a mat-list-item routerLink=\"feature\">Feature</a>\n        <a mat-list-item routerLink=\"hover\">Hover</a>\n        <a mat-list-item routerLink=\"measure\">Measure</a>\n        <a mat-list-item routerLink=\"draw\">Draw</a>\n        <a mat-list-item routerLink=\"query\">Query</a>\n        <a mat-list-item routerLink=\"catalog\">Catalog</a>\n        <a mat-list-item routerLink=\"search\">Search</a>\n        <a mat-list-item routerLink=\"print\">Print</a>\n        <a mat-list-item routerLink=\"import-export\">Import/Export</a>\n        <a mat-list-item routerLink=\"directions\">Directions</a>\n        <a mat-list-item routerLink=\"time-filter\">Time filter</a>\n        <a mat-list-item routerLink=\"ogc-filter\">OGC filter</a>\n        <a mat-list-item routerLink=\"spatial-filter\">Spatial filter</a>\n        <a mat-list-item routerLink=\"workspace\">Workspace</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"context\">Context</a>\n\n      </mat-nav-list>\n    </mat-sidenav>\n\n    <mat-sidenav-content>\n      <router-outlet></router-outlet>\n    </mat-sidenav-content>\n\n  </mat-sidenav-container>\n</div>\n","import { BrowserModule, DomSanitizer } from '@angular/platform-browser';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\nimport { APP_INITIALIZER, NgModule } from '@angular/core';\nimport { HammerModule } from '@angular/platform-browser';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconRegistry, MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSidenavModule } from '@angular/material/sidenav';\nimport { MatToolbarModule } from '@angular/material/toolbar';\nimport { AppHomeModule } from './core/home/home.module';\nimport { AppActivityModule } from './core/activity/activity.module';\nimport { AppConfigModule } from './core/config/config.module';\nimport { AppLanguageModule } from './core/language/language.module';\nimport { AppMediaModule } from './core/media/media.module';\nimport { AppMessageModule } from './core/message/message.module';\nimport { AppRequestModule } from './core/request/request.module';\n\nimport { AppActionModule } from './common/action/action.module';\nimport { AppDynamicComponentModule } from './common/dynamic-component/dynamic-component.module';\nimport { AppEntityTableModule } from './common/entity-table/entity-table.module';\nimport { AppEntitySelectorModule } from './common/entity-selector/entity-selector.module';\nimport { AppFormModule } from './common/form/form.module';\nimport { AppTableModule } from './common/table/table.module';\nimport { AppToolModule } from './common/tool/tool.module';\nimport { AppWidgetModule } from './common/widget/widget.module';\n\nimport { AppAuthFormModule } from './auth/auth-form/auth-form.module';\n\nimport { AppSimpleMapModule } from './geo/simple-map/simple-map.module';\nimport { AppLayerModule } from './geo/layer/layer.module';\nimport { AppLegendModule } from './geo/legend/legend.module';\nimport { AppOverlayModule } from './geo/overlay/overlay.module';\nimport { AppGeometryModule } from './geo/geometry/geometry.module';\nimport { AppFeatureModule } from './geo/feature/feature.module';\nimport { AppHoverModule } from './geo/hover/hover.module';\nimport { AppMeasureModule } from './geo/measure/measure.module';\nimport { AppDrawModule } from './geo/draw/draw.module';\nimport { AppQueryModule } from './geo/query/query.module';\nimport { AppCatalogModule } from './geo/catalog/catalog.module';\nimport { AppSearchModule } from './geo/search/search.module';\nimport { AppPrintModule } from './geo/print/print.module';\nimport { AppImportExport } from './geo/import-export/import-export.module';\nimport { AppDirectionsModule } from './geo/directions/directions.module';\nimport { AppTimeFilterModule } from './geo/time-filter/time-filter.module';\nimport { AppOgcFilterModule } from './geo/ogc-filter/ogc-filter.module';\nimport { AppSpatialFilterModule } from './geo/spatial-filter/spatial-filter.module';\nimport { AppWorkspaceModule } from './geo/workspace/workspace.module';\n\nimport { AppContextModule } from './context/context/context.module';\n\nimport { AppRoutingModule } from './app-routing.module';\nimport { AppComponent } from './app.component';\nimport { IgoCoreModule, LanguageService } from '@igo2/core';\n\n@NgModule({\n  declarations: [AppComponent],\n  imports: [\n    IgoCoreModule,\n    BrowserModule,\n    BrowserAnimationsModule,\n    MatSidenavModule,\n    MatToolbarModule,\n    MatButtonModule,\n    MatIconModule,\n    MatListModule,\n\n    AppHomeModule,\n    AppActivityModule,\n    AppConfigModule,\n    AppLanguageModule,\n    AppMediaModule,\n    AppMessageModule,\n    AppRequestModule,\n\n    AppActionModule,\n    AppDynamicComponentModule,\n    AppEntityTableModule,\n    AppEntitySelectorModule,\n    AppFormModule,\n    AppTableModule,\n    AppToolModule,\n    AppWidgetModule,\n\n    AppAuthFormModule,\n\n    AppSimpleMapModule,\n    AppLayerModule,\n    AppLegendModule,\n    AppOverlayModule,\n    AppGeometryModule,\n    AppFeatureModule,\n    AppHoverModule,\n    AppMeasureModule,\n    AppDrawModule,\n    AppQueryModule,\n    AppCatalogModule,\n    AppSearchModule,\n    AppPrintModule,\n    AppImportExport,\n    AppDirectionsModule,\n    AppTimeFilterModule,\n    AppOgcFilterModule,\n    AppSpatialFilterModule,\n    AppWorkspaceModule,\n\n    AppContextModule,\n\n    AppRoutingModule,\n\n    HammerModule\n  ],\n  providers: [\n    {provide: APP_INITIALIZER, useFactory: appInitializerFactory, deps: [LanguageService], multi: true},\n  ],\n  bootstrap: [AppComponent]\n})\nexport class AppModule {\n  constructor(matIconRegistry: MatIconRegistry, domSanitizer: DomSanitizer) {\n    matIconRegistry.addSvgIconSet(\n      domSanitizer.bypassSecurityTrustResourceUrl(\n        './assets/igo2/core/icons/mdi.svg'\n      )\n    );\n  }\n}\n\nexport function appInitializerFactory(languageService: LanguageService) {\n  return () => new Promise<any>((resolve: any) => {\n      languageService.translate.getTranslation(languageService.getLanguage()).subscribe(() => {\n        console.info(`Successfully initialized '${languageService.getLanguage()}' language.'`);\n      }, err => {\n        console.error(`Problem with '${languageService.getLanguage()}' language initialization.'`);\n      }, () => {\n        resolve(null);\n      });\n  });\n}\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nimport 'hammerjs';\n\nif (environment.production) {\n  enableProdMode();\n}\n\nplatformBrowserDynamic()\n  .bootstrapModule(AppModule)\n  .catch(err => console.log(err));\n","var map = {\n\t\"./af\": 62275,\n\t\"./af.js\": 62275,\n\t\"./ar\": 90857,\n\t\"./ar-dz\": 11218,\n\t\"./ar-dz.js\": 11218,\n\t\"./ar-kw\": 14754,\n\t\"./ar-kw.js\": 14754,\n\t\"./ar-ly\": 66680,\n\t\"./ar-ly.js\": 66680,\n\t\"./ar-ma\": 92178,\n\t\"./ar-ma.js\": 92178,\n\t\"./ar-sa\": 56522,\n\t\"./ar-sa.js\": 56522,\n\t\"./ar-tn\": 95682,\n\t\"./ar-tn.js\": 95682,\n\t\"./ar.js\": 90857,\n\t\"./az\": 70164,\n\t\"./az.js\": 70164,\n\t\"./be\": 79774,\n\t\"./be.js\": 79774,\n\t\"./bg\": 60947,\n\t\"./bg.js\": 60947,\n\t\"./bm\": 21832,\n\t\"./bm.js\": 21832,\n\t\"./bn\": 89650,\n\t\"./bn-bd\": 74477,\n\t\"./bn-bd.js\": 74477,\n\t\"./bn.js\": 89650,\n\t\"./bo\": 66005,\n\t\"./bo.js\": 66005,\n\t\"./br\": 98492,\n\t\"./br.js\": 98492,\n\t\"./bs\": 70534,\n\t\"./bs.js\": 70534,\n\t\"./ca\": 52061,\n\t\"./ca.js\": 52061,\n\t\"./cs\": 84737,\n\t\"./cs.js\": 84737,\n\t\"./cv\": 61167,\n\t\"./cv.js\": 61167,\n\t\"./cy\": 77996,\n\t\"./cy.js\": 77996,\n\t\"./da\": 9528,\n\t\"./da.js\": 9528,\n\t\"./de\": 14540,\n\t\"./de-at\": 49430,\n\t\"./de-at.js\": 49430,\n\t\"./de-ch\": 67978,\n\t\"./de-ch.js\": 67978,\n\t\"./de.js\": 14540,\n\t\"./dv\": 83426,\n\t\"./dv.js\": 83426,\n\t\"./el\": 6616,\n\t\"./el.js\": 6616,\n\t\"./en-au\": 63816,\n\t\"./en-au.js\": 63816,\n\t\"./en-ca\": 32162,\n\t\"./en-ca.js\": 32162,\n\t\"./en-gb\": 83305,\n\t\"./en-gb.js\": 83305,\n\t\"./en-ie\": 61954,\n\t\"./en-ie.js\": 61954,\n\t\"./en-il\": 43060,\n\t\"./en-il.js\": 43060,\n\t\"./en-in\": 59923,\n\t\"./en-in.js\": 59923,\n\t\"./en-nz\": 13540,\n\t\"./en-nz.js\": 13540,\n\t\"./en-sg\": 16505,\n\t\"./en-sg.js\": 16505,\n\t\"./eo\": 41907,\n\t\"./eo.js\": 41907,\n\t\"./es\": 86640,\n\t\"./es-do\": 41246,\n\t\"./es-do.js\": 41246,\n\t\"./es-mx\": 56131,\n\t\"./es-mx.js\": 56131,\n\t\"./es-us\": 36430,\n\t\"./es-us.js\": 36430,\n\t\"./es.js\": 86640,\n\t\"./et\": 62551,\n\t\"./et.js\": 62551,\n\t\"./eu\": 32711,\n\t\"./eu.js\": 32711,\n\t\"./fa\": 54572,\n\t\"./fa.js\": 54572,\n\t\"./fi\": 33390,\n\t\"./fi.js\": 33390,\n\t\"./fil\": 87860,\n\t\"./fil.js\": 87860,\n\t\"./fo\": 48216,\n\t\"./fo.js\": 48216,\n\t\"./fr\": 99291,\n\t\"./fr-ca\": 98527,\n\t\"./fr-ca.js\": 98527,\n\t\"./fr-ch\": 58407,\n\t\"./fr-ch.js\": 58407,\n\t\"./fr.js\": 99291,\n\t\"./fy\": 47054,\n\t\"./fy.js\": 47054,\n\t\"./ga\": 49540,\n\t\"./ga.js\": 49540,\n\t\"./gd\": 73917,\n\t\"./gd.js\": 73917,\n\t\"./gl\": 51486,\n\t\"./gl.js\": 51486,\n\t\"./gom-deva\": 56245,\n\t\"./gom-deva.js\": 56245,\n\t\"./gom-latn\": 48868,\n\t\"./gom-latn.js\": 48868,\n\t\"./gu\": 59652,\n\t\"./gu.js\": 59652,\n\t\"./he\": 89019,\n\t\"./he.js\": 89019,\n\t\"./hi\": 42040,\n\t\"./hi.js\": 42040,\n\t\"./hr\": 63402,\n\t\"./hr.js\": 63402,\n\t\"./hu\": 79322,\n\t\"./hu.js\": 79322,\n\t\"./hy-am\": 27609,\n\t\"./hy-am.js\": 27609,\n\t\"./id\": 57942,\n\t\"./id.js\": 57942,\n\t\"./is\": 98275,\n\t\"./is.js\": 98275,\n\t\"./it\": 73053,\n\t\"./it-ch\": 4378,\n\t\"./it-ch.js\": 4378,\n\t\"./it.js\": 73053,\n\t\"./ja\": 46176,\n\t\"./ja.js\": 46176,\n\t\"./jv\": 679,\n\t\"./jv.js\": 679,\n\t\"./ka\": 92726,\n\t\"./ka.js\": 92726,\n\t\"./kk\": 72953,\n\t\"./kk.js\": 72953,\n\t\"./km\": 86957,\n\t\"./km.js\": 86957,\n\t\"./kn\": 59181,\n\t\"./kn.js\": 59181,\n\t\"./ko\": 47148,\n\t\"./ko.js\": 47148,\n\t\"./ku\": 27752,\n\t\"./ku.js\": 27752,\n\t\"./ky\": 65675,\n\t\"./ky.js\": 65675,\n\t\"./lb\": 41263,\n\t\"./lb.js\": 41263,\n\t\"./lo\": 65746,\n\t\"./lo.js\": 65746,\n\t\"./lt\": 11143,\n\t\"./lt.js\": 11143,\n\t\"./lv\": 38753,\n\t\"./lv.js\": 38753,\n\t\"./me\": 44054,\n\t\"./me.js\": 44054,\n\t\"./mi\": 31573,\n\t\"./mi.js\": 31573,\n\t\"./mk\": 30202,\n\t\"./mk.js\": 30202,\n\t\"./ml\": 68523,\n\t\"./ml.js\": 68523,\n\t\"./mn\": 79794,\n\t\"./mn.js\": 79794,\n\t\"./mr\": 56681,\n\t\"./mr.js\": 56681,\n\t\"./ms\": 56975,\n\t\"./ms-my\": 39859,\n\t\"./ms-my.js\": 39859,\n\t\"./ms.js\": 56975,\n\t\"./mt\": 3691,\n\t\"./mt.js\": 3691,\n\t\"./my\": 5152,\n\t\"./my.js\": 5152,\n\t\"./nb\": 7607,\n\t\"./nb.js\": 7607,\n\t\"./ne\": 21526,\n\t\"./ne.js\": 21526,\n\t\"./nl\": 86368,\n\t\"./nl-be\": 40076,\n\t\"./nl-be.js\": 40076,\n\t\"./nl.js\": 86368,\n\t\"./nn\": 68420,\n\t\"./nn.js\": 68420,\n\t\"./oc-lnc\": 51906,\n\t\"./oc-lnc.js\": 51906,\n\t\"./pa-in\": 94504,\n\t\"./pa-in.js\": 94504,\n\t\"./pl\": 54721,\n\t\"./pl.js\": 54721,\n\t\"./pt\": 74645,\n\t\"./pt-br\": 54548,\n\t\"./pt-br.js\": 54548,\n\t\"./pt.js\": 74645,\n\t\"./ro\": 71977,\n\t\"./ro.js\": 71977,\n\t\"./ru\": 26042,\n\t\"./ru.js\": 26042,\n\t\"./sd\": 78849,\n\t\"./sd.js\": 78849,\n\t\"./se\": 27739,\n\t\"./se.js\": 27739,\n\t\"./si\": 50084,\n\t\"./si.js\": 50084,\n\t\"./sk\": 92449,\n\t\"./sk.js\": 92449,\n\t\"./sl\": 23086,\n\t\"./sl.js\": 23086,\n\t\"./sq\": 33139,\n\t\"./sq.js\": 33139,\n\t\"./sr\": 30607,\n\t\"./sr-cyrl\": 30063,\n\t\"./sr-cyrl.js\": 30063,\n\t\"./sr.js\": 30607,\n\t\"./ss\": 40131,\n\t\"./ss.js\": 40131,\n\t\"./sv\": 21665,\n\t\"./sv.js\": 21665,\n\t\"./sw\": 5642,\n\t\"./sw.js\": 5642,\n\t\"./ta\": 33622,\n\t\"./ta.js\": 33622,\n\t\"./te\": 74825,\n\t\"./te.js\": 74825,\n\t\"./tet\": 48336,\n\t\"./tet.js\": 48336,\n\t\"./tg\": 39238,\n\t\"./tg.js\": 39238,\n\t\"./th\": 99463,\n\t\"./th.js\": 99463,\n\t\"./tk\": 39986,\n\t\"./tk.js\": 39986,\n\t\"./tl-ph\": 29672,\n\t\"./tl-ph.js\": 29672,\n\t\"./tlh\": 40043,\n\t\"./tlh.js\": 40043,\n\t\"./tr\": 51212,\n\t\"./tr.js\": 51212,\n\t\"./tzl\": 50110,\n\t\"./tzl.js\": 50110,\n\t\"./tzm\": 80482,\n\t\"./tzm-latn\": 38309,\n\t\"./tzm-latn.js\": 38309,\n\t\"./tzm.js\": 80482,\n\t\"./ug-cn\": 42495,\n\t\"./ug-cn.js\": 42495,\n\t\"./uk\": 54157,\n\t\"./uk.js\": 54157,\n\t\"./ur\": 80984,\n\t\"./ur.js\": 80984,\n\t\"./uz\": 64141,\n\t\"./uz-latn\": 43662,\n\t\"./uz-latn.js\": 43662,\n\t\"./uz.js\": 64141,\n\t\"./vi\": 12607,\n\t\"./vi.js\": 12607,\n\t\"./x-pseudo\": 66460,\n\t\"./x-pseudo.js\": 66460,\n\t\"./yo\": 92948,\n\t\"./yo.js\": 92948,\n\t\"./zh-cn\": 62658,\n\t\"./zh-cn.js\": 62658,\n\t\"./zh-hk\": 39352,\n\t\"./zh-hk.js\": 39352,\n\t\"./zh-mo\": 38274,\n\t\"./zh-mo.js\": 38274,\n\t\"./zh-tw\": 98451,\n\t\"./zh-tw.js\": 98451\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 46700;"]}