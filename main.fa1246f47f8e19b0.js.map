{"version":3,"file":"main.fa1246f47f8e19b0.js","mappings":"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UAAW,EACXC,kBAAmB,EACnBC,6BAA6B,GAkExB,IAAMC,GAAb,MAAM,MAAOA,EACX7yL,YAAYjO,EAAkCC,GAC5CD,EAAgBE,cACdD,EAAaE,+BACX,oCAGL,+CAPU2gM,GAAS/rM,mDAAT+rM,EAASC,WAFRhB,mCAJD,CACT,CAAC5qM,QAASiC,MAAiBC,WAAY2pM,GAAuBzpM,KAAM,CAAC4C,GAAkB7E,OAAO,GAC9F,CAAEH,QAAS8rM,KAA6BlqM,SAAU0pM,KACnD55K,SAzDC9mB,GACAi3H,MACAC,MACAiqE,MACAC,MACA59K,KACAC,KACAG,MAEAqf,GACAK,GACAmC,GACAK,GACAO,GACAG,GACAM,GAEAM,GACAM,GACAK,GACAK,GACAc,GACAM,GACAS,GACAO,GAEA+N,GAEAywI,GACAG,GACAG,GACAK,GACAG,GACAG,GACAG,GACAG,GACAG,GACAQ,GACAQ,GACAiQ,GACAU,GACAG,GACAG,GACAI,GACAK,GACA6B,GACAM,GAEAG,GAEAI,GAEAuB,SAQSN,CAAb,KAUM,YAAgCjmM,GACpC,MAAO,IAAM,IAAI1E,QAAcC,IAC3ByE,EAAgBT,UAAUinM,eAAexmM,EAAgBP,eAAejH,UAAU,KAChFmD,QAAQ8G,KAAK,6BAA6BzC,EAAgBP,4BAA1D,EACCyd,IACDvhB,QAAQD,MAAM,iBAAiBsE,EAAgBP,2CAA/C,EACC,KACDlE,EAAQ,KAAD,EALT,EAQL,UCzIGktC,gBACFg+J,WAGFC,QACGC,gBAAgBV,IAChBtvJ,MAAMz5B,GAAOvhB,QAAQC,IAAIshB,GAF5B,oBCZA,QACA,aACA,gBACA,WACA,eACA,kBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,cACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,YACA,eACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,gBACA,mBACA,eACA,kBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,mBACA,gBACA,WACA,cACA,aACA,gBACA,aACA,gBACA,YACA,eACA,mBACA,sBACA,kBACA,qBACA,aACA,gBACA,aACA,gBACA,WACA,cACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,iBACA,oBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,mBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,cACA,iBACA,aACA,gBACA,aACA,gBACA,aACA,gBACA,gBACA,mBACA,cACA,iBACA,aACA,gBACA,cACA,iBACA,cACA,kBACA,qBACA,iBACA,gBACA,mBACA,aACA,gBACA,aACA,gBACA,aACA,kBACA,qBACA,gBACA,aACA,gBACA,mBACA,sBACA,aACA,gBACA,gBACA,mBACA,gBACA,mBACA,gBACA,mBACA,gBACA,oBAIA,cACA,YACA,WACA,CACA,eACA,eACA,8CACA,gCACA0pL,CACA,CACA,YACA,CACAz5L,kBACA,sBACA,EACAA,aACA05L,aACA15L","names":["Base64","s","i","charCodeAt","this","ALPHA","indexOf","charAt","b10","pads","imax","length","x","String","PADCHAR","getByte64","push","fromCharCode","join","getByte","userAgent","Bowser","window","navigator","Clipboard","element","successful","textArea","createTextArea","selectText","copyTextToClipboard","destroyTextArea","text","document","createElement","value","body","appendChild","removeChild","getOSName","oldContentEditable","contentEditable","oldReadOnly","readOnly","range","createRange","selection","getSelection","contenteditable","readonly","selectNodeContents","removeAllRanges","addRange","setSelectionRange","select","compareVersion","execCommand","StringUtils","s1","s2","p","arguments","toString","changeData","getChanges","nextS","slice","mtc","ins","sbs","nextThis","del","diff","l","m","match","slen","o","fis","isThisLonger","c","longer","shorter","bi","split","len","cd","fil","sub","rc","getMatchingSubstring","rotateArray","b","array","n","res","Array","Jo","ChangeType","ChangeUtils","obj1","obj2","ignoreKeys","items","added","deleted","modified","u","obj1Clone","obj2Clone","fromItem","index","findIndex","id","change","type","DELETED","toItem","splice","fromItemClone","JSON","parse","stringify","toItemClone","keysChanged","compareObject","undefined","MODIFIED","oldValue","newValue","map","ADDED","itemAdded","baseKey","keys","Set","Object","forEach","keyString","key","isArray","concat","r","ObjectUtils","obj","keysArray","replace","current","shift","item","Date","target","source","ignoreUndefined","output","assign","isObject","filter","mergeDeep","src","prop","hasOwnProperty","copyDeep","summaryCapitalizeObject","capitalizeObject","upperCaseCount","property","upperCaseProperty","toUpperCase","count","capitalizedProperty","capitalizedPropertyObject","singlePossibility","paramClosestToLowercase","f","toLowerCase","reduce","prev","y","removeUndefined","removeNull","a","direction","nullsFirst","nullScore","ax","bx","_","$1","$2","Infinity","an","bn","nn","localeCompare","obj1Props","getOwnPropertyNames","obj2Props","_obj","NumberUtils","num","decimal","roundFactor","Math","pow","round","create","random","substring","S4","SubjectStatus","Oe","Watcher","Subject","_status","status$","next","callback","scope","watch","status$$","pipe","distinctUntilChanged","subscribe","status","handleStatusChange","call","unwatch","unsubscribe","Waiting","ActivityService","BehaviorSubject","ids","uuid","counter$","factory","ActivityInterceptor","activityService","req","activity","headers","get","actReq","clone","delete","handle","register","finalize","unregister","i0","IgoActivityModule","ngModule","providers","provide","HTTP_INTERCEPTORS","useClass","multi","Fl","lib","releaseDate","ConfigService","injector","config","options","baseConfig","default","path","http","HttpClient","Promise","resolve","_reject","catchError","error","console","log","throwError","configResponse","version","CONFIG_OPTIONS","InjectionToken","useValue","configService","load","IgoConfigModule","provideConfigOptions","APP_INITIALIZER","useFactory","configFactory","deps","LanguageLoader","prefix","suffix","t","lang","igoLocale$","getConfig","appLocale$","combineLatest","translations","acc","loader","TranslateLoader","defaultLanguageLoader","IgoMissingTranslationHandler","params","translateService","langs","Error","substr","IgoLanguageModule","provideDefaultLanguageLoader","TranslateModule","missingTranslationHandler","MissingTranslationHandler","IgoMessageModule","CommonModule","ToastrModule","positionClass","timeOut","extendedTimeOut","messageClass","closeButton","progressBar","enableHtml","tapToDismiss","maxOpened","preventDuplicates","resetTimeoutOnDuplicate","countDuplicates","includeTitleDuplicates","Sn","MessageType","LanguageService","translate","getBrowserLang","getLanguage","setDefaultLang","language$","language","use","reloadLang","MessageService","languageService","activeMessageTranslations","debounceTime","toastr","toasts","activeMessageTranslation","find","amt","toast","toastId","translatedTextInterpolateParams","textInterpolateParams","translatedTitleInterpolateParams","titleInterpolateParams","k","instant","forkJoin","textKey","titleKey","first","toastRef","componentInstance","message","title","ToastrService","httpError","caught","messageType","toastrConfig","iconClasses","messages$","currentDate","from","to","showIcon","handleTemplate","messageShown","SUCCESS","success","ERROR","INFO","info","SHOW","show","ALERT","WARNING","alert","handleNgxToastr","translatedTitlenterpolateParams","activeToast","translatedTitle","warning","remove","mess","template","html","Injector","ErrorInterceptor","originalReq","interceptError","errorContainer","handleError","handleCaughtError","handleUncaughtError","HttpErrorResponse","errorObj","statusText","url","toDisplay","messageService","IgoErrorModule","parentModule","dbConfig","name","objectStoresMeta","store","storeConfig","keyPath","autoIncrement","storeSchema","keypath","unique","IgoCoreModule","matIconRegistry","domSanitizer","addSvgIconSet","bypassSecurityTrustResourceUrl","HttpClientModule","forRoot","NgxIndexedDBModule","ROUTE_SERVICE_OPTIONS","RouteService","router","route","centerKey","zoomKey","projectionKey","contextKey","searchKey","visibleOnLayersKey","visibleOffLayersKey","directionsCoordKey","directionsOptionsKey","toolKey","wmsUrlKey","wmsLayersKey","wmtsUrlKey","wmtsLayersKey","arcgisUrlKey","arcgisLayersKey","iarcgisUrlKey","iarcgisLayersKey","tarcgisUrlKey","tarcgisLayersKey","vectorKey","decodeURIComponent","location","search","includes","queryParams","pair","navigate","on","Media","wn","MediaOrientation","MediaService","breakpointObserver","observe","Breakpoints","matches","media$","Mobile","orientation$","Landscape","Portrait","Tablet","Desktop","documentElement","getMedia","qe","StorageScope","Tn","StorageServiceEventEnum","StorageService","SESSION","sessionStorage","getItem","LOCAL","localStorage","_a","previousValue","setItem","currentValue","storageChange$","event","removeItem","REMOVED","clear","CLEARED","v","endposition","CompressionService","Map","generateBase64Index","base64Index","set","indexBase64","blob","Observable","observer","reader","FileReader","readAsDataURL","onload","base64","result","valueOf","text64","compressed","compressStringBase64","object","compressedData","decompressed","decompressStringBase64","byteCharacters","atob","byteNumbers","byteArray","Uint8Array","Blob","out","bits","chr","rem","j","getNumber","NetworkService","EventEmitter","connection","onLine","checkNetworkState","onlineSubscription","fromEvent","previousMessageId","messageObj","state","emitEvent","offlineSubscription","stateChangeEventEmitter","emit","e","reportState","startWith","st","EntityTableColumnRenderer","Uo","EntityTableScrollBehavior","Ai","EntityTableSelectionState","entity","safeObject","meta","getEntityProperty","idProperty","titleProperty","icon","iconProperty","EntityStateManager","ReplaySubject","getKey","getEntityId","size","setMany","entities","changes","exclusive","updateMany","updateManyExclusive","reverseMany","currentState","reversedChanges","reverseChanges","allKeys","getAllKeys","some","changeKey","entries","bunch","storeKeys","change$","EntityView","source$","lifted","joins","getKey$","count$","empty$","_index","values$","clause","values","sort","values$$","filter$","filterIndex","filters$","sort$","liftJoinedSource","liftSource","skip","processValues","setValues","sources$","joinData","computeJoinedValue","joinIndex","filters","filterValues","sortValues","clauses","every","v1","v2","valueAccessor","generateIndex","empty","EntityStore","_pristine","strategies","getProperty","createStateManager","view","createDataView","stateView","createStateView","lift","entities$","pristine","updateCount","softClear","destroy","insertMany","deleteMany","strategy","activate","existingStrategy","_strategy","constructor","bindStore","unbindStore","getStrategyOfType","deactivate","all$","currentRecord","statesAreTheSame","revision","ref","createIndex","record","newState","currentStateIsEmpty","newStateIsEmpty","EntityStoreWatcher","cdRef","setChangeDetector","setStore","teardownObservers","innerStateIndex","setupObservers","detectChanges","entities$$","onEntitiesChange","state$$","onStateChange","changesDetected","storeIndex","innerIndex","storeValue","innerValue","EntityStoreStrategy","stores","active$","active","doDeactivate","doActivate","EntityStoreFilterCustomFuncStrategy","filterStore","unfilterStore","filterAll","unfilterAll","addFilter","filterClauseFunc","filterId","removeFilter","EntityStoreFilterSelectionStrategy","has","selected","ctx_r0","EntitySelectorComponent","titleAccessor","getEntityTitle","emptyText","multiAllText","multiNoneText","disabled","watcher","selected$$","manyBy$","records","onSelectFromStore","multiSelect","_value","multiSelectValue","all","emptyValue","updateAll","selectedChange","selected$","updateMultiToggleWithEntities","multiText$","selectors","ctx","StopPropagationDirective","stopPropagation","onClick","EntityTablePaginatorComponent","mediaService","hidePageSize","pageIndex","pageSize","showFirstLastButtons","paginationLabelTranslation$$","rangeLabel","page","of","label","startIndex","endIndex","max","min","unsubscribeAll","count$$","emitPaginator","entitySortChange$$","entitySortChange$","paginator","firstPage","initPaginatorOptions","translateLabels","paginatorOptions","_b","_c","pageSizeOptions","_d","isMobile","_e","_f","_intl","firstPageLabel","getRangeLabel","itemsPerPageLabel","lastPageLabel","nextPageLabel","previousPageLabel","paginatorChange","MatPaginator","ImageErrorDirective","el","errorImageUrl","hideError","nativeElement","style","display","onError","EntityTableRowDirective","renderer","selectOnClick","highlightSelection","_selected","Auto","toggleSelected","scroll","addCls","selectedCls","highlightedCls","removeCls","scrollIntoView","scrollMode","behavior","block","inline","cls","addClass","removeClass","SanitizeHtmlPipe","_sanitizer","bypassSecurityTrustHtml","pure","SecureImagePipe","HttpHeaders","activityInterceptor","regexDepot","RegExp","test","responseType","err","switchMap","onloadend","complete","__decorate","Cacheable","maxCacheCount","onToggleRows","$event","ctx_r13","onShiftToggleRow","record_r11","onDateChange","onChange","onValueChange","onBooleanValueChange","onSelectValueChange","onAutocompleteValueChange","onButtonClick","EntityTableComponent","formBuilder","_focusMonitor","_elementRef","ngControl","_parentForm","_controlName","_defaultErrorStateMatcher","dateAdapter","UntypedFormGroup","filteredOptions","entityTableColumnRenderer","entityTableSelectionState","sortNullsFirst","withPaginator","MatTableDataSource","setLocale","_paginator","dataSource","columns","column","visible","selectionCheckbox","selectMany","fixedHeader","tableHeight","handleDatasource","getColumnKeyWithoutPropertiesTag","properties","checked","formGroup","controls","setValue","option","viewValue","moment","format","validation","mandatory","setControl","control","multiple","parseInt","valueChanges","domainValues","filterNormalized","normalize","formControlValue","isEdition","linkColumnForce","date","utc","newKey","getValidationAttributeValue","disable","unsubscribeStore","selection$$","firstSelected","firstSelectedStateviewPosition","pageMax","pageToReach","floor","selectionState$","computeSelectionState","dataSource$$","enableEdit","data","getValue","entitySortChange","lastRecordCheckedKey","entityClick","update","entitySelectChange","toggle","onToggleRow","selectNode","stopImmediatePropagation","recordIndex","lastRecordChecked","indexes","apply","_record","selectedRecords","selectionCount","None","All","Some","sortable","isUrl","pop","Boolean","list_id","Number","list_option","edition","validationType","Default","func","headerClassFunc","Function","rowClassFunc","tableFunc","cellClassFunc","columnFunc","clickFunc","MatFormFieldControl","useExisting","Jn","ActionbarMode","action","ActionbarItemComponent","color","withTitle","withIcon","withTooltip","disabled$","noDisplay$","args","ngClass","ngClass$$","updateNgClass","isObservable","icon$$","updateIcon","checkCondition","checkCondition$$","updateCheckCondition","tooltip","tooltip$$","updateTooltip","availability","availability$$","available","disabled$$","display$$","noDisplay","noDisplay$$","trigger","ngClass$","tooltip$","checkCondition$","icon$","scrollUp","onTriggerAction","scrollDown","ctx_r1","ActionbarComponent","overlay","elRef","actionbarMode","collapsed","handler","Dock","withToggleButton","horizontal","iconColor","scrollActive","xPosition","yPosition","_overlayClass","clientHeight","scrollHeight","scrollTop","scrollBy","IgoActionbarModule","MatButtonModule","MatIconModule","MatTooltipModule","MatMenuModule","MatListModule","MatCardModule","MatCheckboxModule","IgoActionModule","IgoBadgeIconDirective","hidden","inverseColor","inheritColor","getNamedSvgIcon","svgObj","svg","updateSvg","updateHidden","updateDisabled","updateColor","backgroundColor","querySelector","badge","alignItems","justifyContent","innerHTML","background","getComputedStyle","getPropertyValue","originalColor","IgoMatBadgeIconModule","MatBadgeModule","ClickoutDirective","contains","clickout","handleMouseClick","IgoClickoutModule","CollapseDirective","_collapsed","_target","collapseTarget","expandTarget","click","CollapsibleComponent","_title","IgoCollapsibleModule","ConfirmDialogComponent","dialogRef","ConfirmDialogService","dialog","open","disableClose","confirmMessage","afterClosed","IgoConfirmDialogModule","imports","MatDialogModule","ContextMenuDirective","viewContainerRef","elementRef","TouchEvent","touches","pageX","pageY","MouseEvent","close","preventDefault","menuPosition","overlayRef","positionStrategy","position","flexibleConnectedTo","withPositions","originX","originY","overlayX","overlayY","scrollStrategy","scrollStrategies","attach","TemplatePortal","menuContext","$implicit","clickTarget","overlayElement","take","dispose","onContextMenu","LongPressDirective","touchDuration","onlyIOS","touchTimeout","setTimeout","longpress","touchEnd","clearTimeout","touchend","IgoContextMenuModule","CustomHtmlComponent","_html","IgoCustomHtmlModule","MatInputModule","DOMService","dom","response","toPromise","IgoDOMModule","IgoDrapDropModule","DynamicComponent","componentFactory","subscriptions","inputs","inputs$$","subscribers","componentRef","createComponent","updateInputs","updateSubscribers","unobserveAllInputs","instance","propName","unobserveInput","inputValue","observeInput","setInputValue","onUpdateInputs","prototype","getPrototypeOf","descriptor","getOwnPropertyDescriptor","outputs","emitter","subscriber","_subscriber","observable","DynamicComponentService","resolver","componentCls","resolveComponentFactory","DynamicOutletComponent","dynamicComponentService","component","eq","inputsAreEquivalents","subscribersAreEquivalents","dynamicComponent","renderComponent","setTarget","ViewContainerRef","IgoDynamicOutletModule","IgoDynamicComponentModule","IgoFlexibleModule","FormComponent","autocomplete","buttons","children","formData","setData","submitForm","getData","getAllFormFields","form","groups","group","fields","field","updateDataWithFormField","reset","IgoFormFormModule","FormsModule","ReactiveFormsModule","FormService","addControl","validator","validators","getValidators","setValidators","partial","validatorOption","validatorStr","getValidator","Validators","FormFieldService","FormFieldComponent","formFieldService","fieldInputs","fieldSubscribers","getFieldByType","errors","fieldOptions","placeholder","disableSwitch","formControl","required","IgoFormFieldModule","MatFormFieldModule","MatSelectModule","FormGroupComponent","colSpan","cols","colspan","getFieldColSpan","messages","errorMessages","getControlErrorMessage","IgoFormGroupModule","IgoFormModule","IgoEntitySelectorModule","IgoStopPropagationModule","IgoEntityTablePaginatorModule","MatPaginatorModule","IgoImageModule","IgoEntityTableModule","MatTableModule","MatAutocompleteModule","MatSortModule","MatDatepickerModule","IgoEntityModule","InteractiveTourLoader","jsonURL","getPathToConfigFile","getJSON","allToursOptions","toolName","nameInConfigFile","InteractiveTourService","interactiveTourLoader","shepherdService","nextIndex","isAppHaveTour","loadConfigTour","haveTour","getTourOptionData","stepConfig","conditions","buttonKind","classes","actionName","self","nbTry","checkExist","setInterval","getCurrentStep","attachTo","cancel","clearInterval","currentStepElement","getElement","querySelectorAll","classList","add","header","stepsArray","steps","progress","className","innerText","insertBefore","tour","service","nextStep","checkNext","_setupModal","step","actionConfig","condition","getAction","executeAction","waitFor","maxTry","maxWait","shepherdSteps","popperOptions","modifiers","offset","beforeShowPromise","executeActionPromise","previousStep","beforeChange","beforeShow","getButtons","noBackButton","class","highlightClass","scrollTo","scrollToElement","canClickTarget","disableInteraction","when","onShow","hide","onHide","defaultStepOptions","cancelIcon","enabled","getShepherdSteps","modal","confirmCancel","addSteps","tourObject","addProgress","start","Toolbox","activeToolHistory","tool","setToolbar","toolbar","initStore","activeTool$$","tools","toolbar$","getTool","deactivateTool","activateTool","clearActiveToolHistory","firstBy$","setActiveTool","activeTool$","ToolService","toolbox","setTools","getTools","startInteractiveTour","InteractiveTourComponent","interactiveTourService","toolService","tourToStart","styleButton","activeToolName","isActiveTool","isToolHaveTourConfig","getTourToStart","inMobileAndShow","isToolHaveTour","isTourDisplayInMobile","disabledTourButton","startTour","IgoInteractiveTourModule","KeyValuePipe","keyValues","IgoKeyValueModule","ListItemDirective","_color","_focused","_disabled","beforeFocus","beforeUnfocus","toggleFocusedClass","focus","unfocus","beforeSelect","beforeUnselect","toggleSelectedClass","unselect","beforeDisable","beforeEnable","toggleDisabledClass","enable","offsetTop","focused","focusedCls","disabledCls","ListComponent","_navigation","_selection","_selectedItem","focusedItem","_focusedItem","navigationEnabled","enableNavigation","listItems","init","listItems$$","toArray","igoList","getFocusedIndex","isScrolledIntoView","offsetHeight","selectedItem","navigation","getOffsetTop","elem","docViewTop","elemTop","findSelectedItem","findFocusedItem","item2","handleItemBeforeSelect","handleItemSelect","handleItemBeforeFocus","handleItemFocus","focusPrevious","focusNext","handleKeyboardEvent","disableNavigation","IgoListModule","PanelComponent","_withHeader","cursorPointer","IgoPanelModule","SpinnerComponent","shown$","shown","SpinnerActivityDirective","spinner","counter$$","IgoSpinnerModule","MatProgressSpinnerModule","TableDataSource","_database","_model","_sort","_filterChange","merge","dataChange","sortChange","getFilteredData","getSortedData","filterable","propertyA","propertyB","DataSource","Di","TableActionColor","ctx_r14","handleClickAction","TableComponent","_hasFIlterInput","SelectionModel","database","model","displayedColumns","displayed","unshift","actions","changed","colorId","row","isAllSelected","MatSort","IgoTableModule","CdkTableModule","ActionStore","Vo","ToolboxColor","speed","transform","transition","animate","ToolboxComponent","White","Grey","Primary","toolbar$$","onToolbarChange","onActiveToolChange","actionStore","animating$","onAnimate","animation$","_tool","_toolbox","activeTool","toolActivated","childrenToolActivated","parent","unAnimate","animating$$","animation","toolSlideInOut","changeDetection","IgoToolboxModule","IgoToolModule","WidgetOutletComponent","onCancel","onComplete","destroyWidget","baseSubscribers","baseSubscriber","widget","IgoWidgetOutletModule","WidgetService","widgetCls","IgoWidgetModule","WorkspaceSelectorComponent","workspace","activateWorkspace","IgoWorkspaceSelectorModule","WorkspaceWidgetOutletComponent","widget$","widgetInputs$","widgetSubscribers$","deactivateWidget","IgoWorkspaceWidgetOutletModule","IgoWorkspaceModule","TableDatabase","copiedData","compType","WorkspaceStore","activeWorkspace$","deactivateWorkspace","Workspace","entityStore","AppHomeRoutingModule","RouterModule","AppHomeComponent","AppHomeModule","AppActivityRoutingModule","AppActivityComponent","idsActivity","counter","AppActivityModule","environment","production","igo","projections","code","alias","def","extent","auth","intern","allowAnonymous","interactiveTour","tourInMobile","importExport","catalog","sources","queryFormat","queryHtmlTarget","regFilters","tooltipType","searchSources","storedqueriesreverse","nominatim","icherche","searchUrl","order","limit","coordinatesreverse","showInPointerSummary","icherchereverse","ilayer","AppConfigRoutingModule","AppConfigComponent","configLanguage","AppConfigModule","AppLanguageRoutingModule","AppLanguageComponent","changeLanguage","setLanguage","AppLanguageModule","AppMediaRoutingModule","AppMediaComponent","media","orientation","getOrientation","isTouchScreen","AppMediaModule","AppMessageRoutingModule","AppMessageComponent","AppMessageModule","AppRequestRoutingModule","AppRequestComponent","callHttp","rep","callHttpError","AppRequestModule","AppActionRoutingModule","AppActionComponent","ngOnInit","added$","ngOnDestroy","AppActionModule","AppSalutationComponent","AppExplanationComponent","AppDynamicComponentRoutingModule","AppDynamicComponentComponent","toggleComponent","AppDynamicComponentModule","AppEntityTableRoutingModule","AppEntityTableComponent","description","image","AppEntityTableModule","AppEntitySelectorRoutingModule","AppEntitySelectorComponent","getTitle","onSelectedChange","AppEntitySelectorModule","AppFormRoutingModule","AppFormComponent","formService","fieldConfigs","choices","valueChanges$$","submitDisabled","valid","form$","fillForm","data$","clearForm","onSubmit","AppFormModule","AppTableRoutingModule","AppTableComponent","showName","handleSelect","rows","AppTableModule","AppSalutationToolComponent","ToolComponent","ChangeDetectorRef","AppAboutToolComponent","AppToolRoutingModule","AppToolComponent","panelTitle","activateSalutationTool","AppToolModule","AppSalutationWidgetComponent","AppWidgetRoutingModule","AppWidgetComponent","widgetService","onWidgetComplete","onWidgetCancel","AppWidgetModule","TokenService","token","tokenKey","jwtDecode","jwt","decode","currentTime","getTime","exp","AuthService","tokenService","languageForce","anonymous","authenticate$","authenticated","logged$","globalCacheBusterNotifier","username","password","myHeader","encodePassword","loginCall","infosUser","typeConnection","post","tap","isExpired","isAuthenticated","redirectUrl","loginRoute","navigateByUrl","homeRoute","user","patch","isAnonymous","decodeToken","isAdmin","tokenDecoded","locale","expiredAlert","AuthGoogleComponent","authService","appRef","apiKey","clientId","loadSDKGoogle","loadPlatform","warn","gapi","auth2","getAuthInstance","signIn","signOut","initClient","client","discoveryDocs","then","handleSignOutClick","updateTextButton","isSignedIn","listen","updateSigninStatus","loginGoogle","getToken","access_token","btn","loginWithToken","tick","login","fjs","getElementsByTagName","js","handleClientLoad","parentNode","loginAnonymous","AuthInternComponent","fb","_allowAnonymous","loading","errorMsg","AuthFacebookComponent","appId","loadSDKFacebook","FB","Event","statusChangeCallback","loginFacebook","authResponse","accessToken","getElementById","subscribeEvents","AuthMicrosoftComponent","msalService","msalGuardConfig","PublicClientApplication","cache","cacheLocation","broadcastService","MsalBroadcastService","inProgress$","InteractionStatus","takeUntil","_destroying$","checkAccount","loginPopup","getConf","authRequest","setActiveAccount","account","acquireTokenSilent","tokenId","idToken","catch","__awaiter","InteractionRequiredAuthError","acquireTokenPopup","conf","MSAL_GUARD_CONFIG","MsalServiceb2c","hash","redirectHash","initializeWrapperLibrary","WrapperSKU","initialize","request","acquireTokenRedirect","silentRequest","handleRedirectPromise","loginRedirect","logoutRequest","logout","logoutRedirect","logoutPopup","ssoSilent","logger","getLogger","setLogger","MSAL_INSTANCE","MsalBroadcastServiceb2c","msalInstance","_msalSubject","msalSubject$","asObservable","_inProgress","addEventCallback","EventMessageUtils","verbose","eventType","AuthMicrosoftb2cComponent","browserAuthOptions","onLogin","home","AuthFormComponent","_backgroundDisable","_hasAlreadyConnectedDiv","_hasLogoutDiv","_showAlreadyConnectedDiv","_showLogoutDiv","isLogoutRoute","hasAlreadyConnectedDiv","hasLogoutDiv","analyzeRoute","getName","goToRedirectUrl","logoutRoute","firstName","sourceId","events","NavigationStart","changeEvent","currentRoute","isLoginRoute","AuthInterceptor","refreshInProgress","trustHosts","hostname","withCredentials","handleHostsWithCredentials","hostWithKey","handleHostsAuthByKey","refreshToken","href","host","authHeader","authReq","hashUser","Md5","xhr","setRequestHeader","urlDecomposed","urlWithKeyAdded","paramsToKeep","reqUrl","hostsWithCredentials","hostWithCredentials","domainRegFilters","hostsWithAuthByKey","hostWithAuthByKey","keyProperty","keyValue","msConf","redirectUri","authority","interactionType","InteractionType","scopes","loginHint","MSALConfigFactoryb2c","MSALAngularConfigFactoryb2c","MSALConfigFactory","MSALAngularConfigFactory","MsalService","AuthStorageService","userIgo","preference","g","mergePreference","IgoAuthModule","provideAuthMicrosoft","MsalModule","AppAuthFormRoutingModule","AppAuthFormComponent","AppAuthFormModule","MetadataService","metadata","extern","openMetadata","MetadataButtonComponent","metadataService","_layer","abstract","MetadataAbstractComponent","layerTitle","layer","MAT_DIALOG_DATA","IgoMetadataModule","FEATURE","le","FeatureMotion","ImageWatcher","loaded","ol","handleLoadStart","handleLoadEnd","handleLoadError","un","__watchers__","watcherIndex","params_","LAYERS","layerOptions","sourceOptions","styleByAttribute","hoverStyle","featureClass","TileWatcher","tile","wms","generateWMSIdFromSourceOptions","wmts","generateWMTSIdFromSourceOptions","xyz","generateXYZIdFromSourceOptions","feature","generateFeatureIdFromSourceOptions","wfs","generateWfsIdFromSourceOptions","arcgisrest","generateArcgisRestIdFromSourceOptions","imagearcgisrest","tilearcgisrest","osm","_options","tiledebug","generateId","layers","standardizeUrl","featureTypes","origin","urlStandardized","dataService","createOlSource","generateIdFromSourceOptions","legend","FeatureDataSource","getSourceFormatFromOptions","olSourceVector","olFormatCls","formatType","olformat","formatOptions","queryTitle","ClusterDataSource","olSourceCluster","VectorWatcher","olSource","getUrl","str","mapProjection","lonLat","coordStr","negativeLon","degreesLon","minutesLon","secondsLon","directionLon","decimalLon","negativeLat","degreesLat","minutesLat","secondsLat","directionLat","decimalLat","zone","radius","lon","lat","projectionStr","opts","projectionPattern","toProjection","projectionRegex","lonlatCoord","lonLatPattern","lonLatRegex","dmsCoord","dmsCoordPattern","dmsRegex","patternUtm","utmRegex","patternMtm","mtmRegex","ddCoord","patternDd","ddRegex","dmdCoord","patternDmd","dmdRegex","patternBELL","bellRegex","mmCoord","mmPattern","mmRegex","isXYCoords","toLocaleUpperCase","trim","ed","wi","parseFloat","ho","convertDMSToDD","Cl","epsgUtm","bA","olproj","td","Sl","epsgMtm","wA","nd","Dn","Ti","dn","Sa","forceNA","dest","abs","degrees","minutes","seconds","neg","dd","lonLatDD","lonLatDMS","ceil","int","toFixed","scale","dpi","inchesPerMeter","resolution","unit","originalEvent","altKey","MAC","metaKey","ctrlKey","shiftKey","coord","Layer","authInterceptor","legendCollapsed","firstLoadComponent","olLoadingProblem","displayed$","isInResolutionsRange$","visible$","createOlLayer","zIndex","baseLayer","maxResolution","getResolutionFromScale","maxScaleDenom","minResolution","minScaleDenom","opacity","legendOptions","setLegend","isIgoInternalLayer","getZIndex","setZIndex","setOpacity","getMaxResolution","setMaxResolution","updateInResolutionsRange","getMinResolution","setMinResolution","setVisible","hasBeenVisible$","showMessage","isInResolutionsRange","showInLayerList","igoMap","unobserveResolution","observeResolution","hasBeenVisible$$","resolution$$","viewController","resolution$","getResolution","ct","OgcFilterOperatorType","Q","OgcFilterOperator","OgcFilterWriter","filterSequence","PropertyIsEqualTo","spatial","fieldRestrict","PropertyIsNotEqualTo","PropertyIsLike","PropertyIsGreaterThan","PropertyIsGreaterThanOrEqualTo","PropertyIsLessThan","PropertyIsLessThanOrEqualTo","PropertyIsBetween","During","PropertyIsNull","Intersects","Within","Contains","ogcFiltersOptions","fieldNameGeometry","srcType","ogcFiltersDefaultValue","editable","geometryName","advancedOgcFilters","pushButtons","checkboxes","radioButtons","proj","ourBboxFilter","enableBbox","olfilter","getCode","checkIgoFiltersProperties","wfsOptions","srsName","featureNS","featurePrefix","bundleFilter","outputFormat","query","olFormatWFS","writeGetFeature","XMLSerializer","serializeToString","filterObject","logicalArray","createFilter","operator","logical","filterOptions","geometry","wfsPropertyName","propertyName","wfsPattern","pattern","wfsMatchCase","matchCase","wfsWildCard","wildCard","wfsSingleChar","singleChar","wfsEscapeChar","escapeChar","wfsLowerBoundary","lowerBoundary","wfsUpperBoundary","upperBoundary","wfsGeometryName","wfsExtent","wfsWktGeometry","wkt_geometry","wfsSrsName","wfsBegin","parseFilterOptionDate","begin","minDate","wfsEnd","end","maxDate","wfsExpression","expression","olFormatWKT","readGeometry","dataProjection","featureProjection","BBOX","And","Or","Not","level","defineInterfaceFilterSequence","addInterfaceFilter","defaultOperatorsType","allowedOperators","fieldsHasSpatialOperator","includeContains","effectiveOperators","srcField","allowedOperatorsType","Spatial","BasicAndSpatial","operators","Basic","Time","BasicNumericOperator","igoOgcFilterObject","parentLogical","filterid","sliderOptions","igoSpatialSelector","igoSNRC","filterArray","addFilterProperties","sequence","nextElement","lastProcessedFilter","lastParentLogical","uiFilter","computedSelectors","selector","bundles","bundle","selectorType","selectorGroup","ogcFilters","filterQueryStringSelector","filterQueryStringAdvancedFilters","pushConditions","formatGroupAndFilter","checkboxConditions","A","selectorsCorr","verifyMultipleEnableds","radioConditions","Z","H","selectConditions","D","Y","ie","buildFilter","filterQueryString","formatProcessedOgcFilter","enableds","list","selectorBundle","computeIgoSelector","bundleCondition","selectorsType","ogcselector","enabledSelector","processedFilter","layersOrTypenames","appliedFilter","layerOrTypenames","filterValue","defaultValue","isValid","defaultEpsg","defaultMaxFeatures","defaultWfsVersion","defaultFieldNameGeometry","gmlRegex","randomParam","igoFilters","paramsWFS","queryStringValues","formatWFSQueryString","ogcFilterWriter","filterOrBox","filterOrPush","handleOgcFiltersAppliedValue","xmlFilter","baseUrl","download","dynamicUrl","dataSourceOptions","epsg","forceDefaultOutputFormat","versionWfs200","urlWfs","effectiveCount","effectiveStartIndex","epsgCode","paramTypename","paramMaxFeatures","cnt","maxFeatures","srs","valueReference","sourceFields","fieldsNames","sourcefield","separator","getCapabilities","getFeature","getpropertyvalue","wfsDataSourceOptions","OlFormat","gmlFormat","olFormatGML2","olFormatGML32","olFormatGML3","olFormatOSMXML","VectorLayer","geoNetworkService","geoDBService","browsable","exportable","olOptions","flash","bind","trackFeature","enableTrackFeature","vector","olLayerVector","vectorSource","getSource","failure","customWFSLoader","customLoader","setLoader","listenerKey","vectorContext","getVectorContext","frameState","flashGeom","getGeometry","elapsed","time","elapsedRatio","duration","easeOut","newColor","ColorAsArray","getStyleFunction","style2","getImage","styleClone","getType","getRadius","setRadius","getStroke","setColor","setWidth","getWidth","getFill","setText","setStyle","drawGeometry","unByKey","render","onUnwatch","stopAnimation","trackFeatureListenerId","feat","getFeatureById","getView","setCenter","getCoordinates","getId","centerMapOnFeature","interceptor","wfsProj","olProjection","currentExtent","buildUrl","nbOfFeature","alteredUrl","getFeatures","threshold","idAssociatedCall","mostRecentIdCallOGCFilter","XMLHttpRequest","alteredUrlWithKeyAuth","alterUrlWithKeyAuth","modifiedUrl","interceptXhr","removeLoadedExtent","onerror","responseText","features","getFormat","readFeatures","addFeatures","send","projection","concatMap","content","q","DOMParser","parseFromString","readProjection","I","responseXML","DataService","OSMDataSource","olSourceOSM","XYZDataSource","olSourceXYZ","WFSDataSource","wfsService","checkWfsParams","defineOgcFiltersDefaultOptions","sf","getSourceFieldsFromWFS","setOgcFilters","getFormatFromOptions","OlLoadingStrategy","triggerEvent","notify","WFSService","defineFieldAndValuefromWFS","getfeatureSourceField","nb","fieldList","fieldListWoGeom","fieldListWoGeomStr","olFormats","effectiveOlFormats","gmlDataSourceOptions","sourceFieldsToRetrieveValues","wfsGetFeature","firstFeature","getKeys","getGeometryName","processingArray","allowGml","results","mfeatures","loopFeatures","built_properties_value","d","kv","getProperties","boundedBy","fieldType","featureProperties","it","QueryFormat","cn","QueryFormatMimeType","vn","QueryHtmlTarget","WMSDataSource","sourceParams","DPI","MAP_RESOLUTION","FORMAT_OPTIONS","refreshIntervalSec","refresh","wfsCheckup","buildDynamicDownloadUrlFromParamsWFS","sourceField","initOgcFilters","calendarModeYear","FILTER","updateParams","timeFilterable","timeFilter","setTimeFilter","mapLabel","BLANK","igoRefresh","asWFSDataSourceOptions","olSourceImageWMS","ratio","timeFilter$","projParam","contentDependent","contentDependentLegend","VERSION","currentStyle","projectionExtent","getExtent","extentGetWidth","resolutions","matrixIds","z","olTileGridWMTS","extentGetTopLeft","WMTSDataSource","tileGrid","createDefaultTileGrid","olSourceWMTS","CartoDataSource","crossOrigin","olSourceCarto","htmlString","oneType","cartocss","colors","layer_name","ArcGISRestDataSource","esrijsonFormat","olFormatEsriJSON","attributions","overlaps","encodeURIComponent","customParams","olloadingstrategy","legendInfo","legendElement","htmlImgSrc","contentType","imageData","uniqueValueInfos","h","symbol","createSVG","stroke","strokeWidth","width","outlineColor","outline","fill","ImageArcGISRestDataSource","renderingRule","ImageArcGISRest","layerId","TileArcGISRestDataSource","olSourceTileArcGISRest","TileDebugDataSource","baseOptions","TileGrid","TileDebug","WebSocketDataSource","createWebSocket","ws","WebSocket","onmessage","onMessage","onclose","onClose","onopen","onOpen","featureAdded","readFeature","featureToRemove","removeFeature","addFeature","MVTDataSource","mvtFormat","olFormatMVT","olSourceVectorTile","EsriStyleGenerator","_converters","esriPMS","_convertEsriPMS","esriSFS","_convertEsriSFS","esriSLS","_convertEsriSLS","esriSMS","_convertEsriSMS","esriTS","_convertEsriTS","_renderers","uniqueValue","_renderUniqueValue","simple","_renderSimple","classBreaks","_renderClassBreaks","labelingInfo","mapUnits","styles","ii","labelExpression","maxScale","minScale","_getResolutionForScale","getText","defaultSymbol","defaultStyle","classBreakInfos","classBreakInfo","classMinValue","minValue","classMaxValue","field1","infos","me","layerInfo","drawingInfo","styleFunctions","drawingInfoStyle","labelingInfoStyleFunctions","_convertLabelingInfo","point","units","mpu","rotation","_transformAngle","angle","olstyle","_transformColor","font","weight","family","textBaseline","verticalAlignment","textAlign","horizontalAlignment","offsetX","_convertPointToPixel","xoffset","offsetY","yoffset","_convertOutline","lineDash","ol3Rad","PI","points","radius2","ft","TimeFilterType","Ut","TimeFilterStyle","MapService","ci","TypeCapabilities","CapabilitiesService","mapService","WMSCapabilities","WMTSCapabilities","esriJSON","EsriJSON","capabilities","parseWMSOptions","parseWMTSOptions","jsonp","mapId","cartoOptions","parseCartoOptions","serviceCapabilities","arcgisOptions","parseArcgisOptions","legendUrl","parseTileOrImageArcgisOptions","HttpParams","fromObject","_i","parsers","read","findDataSourceInCapabilities","Capability","DataURL","Abstract","keywordList","KeywordList","queryable","getTimeFilter","Style","getStyle","isExtentInGeographic","EX_GeographicBoundingBox","getMap","w","mimeType","Request","GetFeatureInfo","Format","keyEnum","T","GEOJSON","GEOJSON2","GML3","GML2","HTML","_layerOptionsFromSource","Title","MaxScaleDenominator","MinScaleDenominator","OnlineResource","stepDate","Contents","Identifier","optionsFromCapabilities","ouputOptions","layer_definition","generateStyle","timeExtent","olAttribution","copyrightText","timeInfo","setTime","toUTCString","DATETIME","CALENDAR","serviceDescription","displayField","layerName","layerArray","Name","dimension","Dimension","minMaxDim","stylesAvailable","OptionsService","ProjectionService","registerProjection","utmZone","mtmZone","lon0","proj4","olproj4","setExtent","DataSourceService","capabilitiesService","optionsService","wfsDataSourceService","projectionService","context","detailedContextUri","createOSMDataSource","createFeatureDataSource","createWFSDataSource","wmsContext","createWMSDataSource","createWMTSDataSource","createXYZDataSource","createTileDebugDataSource","createCartoDataSource","createArcGISRestDataSource","createArcGISRestImageDataSource","createWebSocketDataSource","createMVTDataSource","createTileArcGISRestDataSource","createClusterDataSource","datasources$","observables","getWMSOptions","optionsFromApi","optionsMerged","getWMTSOptions","getCartoOptions","getArcgisOptions","getArcgisRestOptions","getImageArcgisOptions","projectionOut","olFeature","OlFormatGeoJSON","setId","mapTitle","getEntityRevision","getEntityIcon","projectionIn","olLayer","exclude","excludeOffline","idColumn","olFormat","startsWith","writeGeometryObject","excludeAttribute","excludeAttributeOffline","getRevision","olFeatures","olextent","featureExtent","olExtent","olFeatureExtent","olFeatureProjection","olGeometry","computeOlFeatureExtent","height","featuresExtent","viewExtent","scaleExtent","areaRatio","mapExtent","mapExtentArea","featuresExtentArea","getZoom","motion","computeOlFeaturesExtent","Zoom","zoomToExtent","Move","moveToExtent","featuresAreOutOfView","featuresAreTooDeepInView","bindLayer","addLayer","olFeaturesMap","olFeaturesToRemove","newOlFeature","olFeaturesToAddIds","FeatureStore","viewScale","checkLayer","featureToOl","setLayerOlFeatures","featureFromOl","computeOlFeaturesDiff","removeOlFeaturesFromLayer","addOlFeaturesToLayer","moveToOlFeatures","FeatureStoreInMapExtentStrategy","states$$","watchStore","empty$$","skipWhile","updateEntitiesInExtent","unwatchStore","unwatchAll","stores$$","state$","inMapExtent","entitiesInMapExtent","entitiesWithNoGeom","FeatureStoreInMapResolutionStrategy","updateEntitiesInResolution","mapResolution","inMapResolution","FeatureStoreLoadingStrategy","setMotion","subscription","onFeaturesChange","clearLayer","setLayerFeatures","selectMotion","getFeatureId","FeatureStoreLoadingLayerStrategy","onSourceChanges","flatMap","cluster","setStoreOlFeatures","OlDragSelectInteraction","OlDragBoxInteraction","FeatureStoreSelectionStrategy","_overlayStore","createOverlayStore","overlayStore","unlistenToMapClick","removeDragBoxInteraction","addOverlayLayer","listenToMapClick","dragBox","addDragBoxInteraction","watchAll","deactivateSelection","removeOverlayLayer","stores$","mapClickListener","onMapClick","ctrlKeyDown","reverse","getFeaturesAtPixel","pixel","hitTolerance","layerFilter","onSelectFromMap","olDragSelectInteraction","olInteractions","getInteractions","getArray","olInteraction","addInteraction","olDragSelectInteractionEndKey","onDragBoxEnd","removeInteraction","mapBrowserEvent","getFeaturesInExtent","doMotion","overlayFeaturesKeys","featuresKeys","groupedFeatures","groupFeaturesByStore","unselectAllFeaturesFromStore","selectFeaturesFromStore","overlayLayer","createOverlayLayer","removeLayer","addStrategy","activateStrategyOfType","markerColor","markerOutlineColor","isIE","newOutlineColor","imgSize","anchor","overflow","StyleService","createOverlayMarkerStyle","parsedStyle","parseStyle","labelMinResolution","labelMaxResolution","labelMinResolutionFromScale","labelMaxResolutionFromScale","attribute","getLabel","styleOptions","olCls","getOlCls","olKey","getOlKey","_key","guessTypeFeature","labelStyle","baseStyle","val","createStyle","OlFeature","clusterParam","layerStyle","clusterRanges","minRadius","maxRadius","showRange","dynamicRadius","clusterRadius","radiusMin","image_","radiusCalc","labelMatch","labelToGet","matchAll","createOverlayDefaultStyle","markerStyle","fillRGBA","bufferRadius","createBufferStyle","customStyle","geometryType","fillColor","strokeColor","fillWithOpacity","strokeWithOpacity","Overlay","overlayDataSource","createOverlayLayerStyle","setMap","removeOlFeature","addOlFeatures","removeFeatures","nt","LinkedProperties","TooltipType","ImageLayer","valStatus","olLayerImage","setImageLoadFunction","abort","arrayBufferView","TextDecoder","imageUrl","URL","createObjectURL","TileLayer","tileLayer","olLayerTile","tileSource","setTileLoadFunction","VectorTileLayer","vectorTile","olLayerVectorTile","vectorTileSource","onLoad","LayerWatcher","propertyChange$","unwatchLayer","TIMEFILTER","OGCFILTERS","VISIBLE","OPACITY","MINRESOLUTION","MAXRESOLUTION","setPropertyChange","evt","layer$$","di","MapViewAction","MapController","observerKeys","olMap","getOlMap","MapViewController","padding","maxZoomOnExtent","states","stateIndex","stateHistory","top","right","bottom","left","onMoveEnd","extent$$","extent$","rotation$","getRotation","olView","getProjection","center","getCenter","getOlProjection","calculateExtent","getSize","getScaleFromResolution","getUnits","zoomTo","zoom","cancelAnimations","easing","oleasing","hasPreviousState","setStateIndex","hasNextState","fromCenter","toCenter","distCenter","sqrt","fromExtent","fromSize","toSize","moySize","xSize","maxZoom","fit","isFinished","setState","state1","state2","tolerance","trunc","viewStatesAreEqual","GeolocationOverlayType","MapGeolocationController","storageService","subscriptions$$","_buffer","buffer","_accuracyThreshold","accuracyThreshold","_followPosition","followPosition","geolocationOverlay","handleFeatureCreation","position$","geolocation","getTracking","setTracking","tracking$","followPosition$","deleteFeatureByType","Position","Accuracy","Buffer","tracking","onPositionChange","deleteGeolocationFeatures","olGeolocation","trackingOptions","enableHighAccuracy","maximumAge","timeout","emissionIntervalSeconds$","interval","geolocate","alwaysTracking","storedTracking","storedFollowPosition","geolocateProperties","accuracy","altitude","altitudeAccuracy","heading","timestamp","featureById","positionGeometry","Point","accuracyGeometry","fromCircle","OlCircle","positionFeature","accuracyFeature","positionFeatureStyle","addOlFeature","accuracyFeatureStyle","bufferFeature","bufferStyle","bufferStroke","bufferFill","showBufferRadius","linkedLayers","linkId","layerToUse","parentLayer","hasParentLayer","getDirectParentLayerByProperty","hasLinkWithProperty","layerLLOptions","getLinkedLayersOptions","links","layerHasLinkWithProperty","currentLinkId","parents","pl","linkedIds","link","getIgoLayerByLinkId","lid","knownChildLayers","childLayers","getDirectChildLayersByProperty","cl","getAllChildLayersByProperty","syncedDelete","getDirectChildLayersByDeletion","getAllChildLayersByDeletion","rootLayersByProperty","plbp","getRootParentByProperty","layersId","IgoMap","attribution","defaultOptions","layerWatcher","layers$","olControlAttribution","scaleLine","olControlScaleLine","interactions","altShiftDragRotate","doubleClickZoom","keyboard","mouseWheelZoom","shiftDragZoom","dragPan","pinchRotate","pinchZoom","olinteraction","setView","setOlMap","queryResultsOverlay","searchResultsOverlay","once","geolocationController","updateGeolocationOptions","mapViewOptions","initLayerSyncFromRootParentLayers","monitorRotation","pc","propertyChange","initiatorIgoLayer","isLayerProperty","isDatasourceProperty","rootParentByProperty","clbp","resolutionPropertyHasChanged","initiatorIgoLayerSourceType","initiatorIgoLayerOgcFilterableDataSourceOptions","getUid","lLayerType","appliedOgcFilter","getParams","appliedTimeFilter","TIME","handleLayerPropertyChange","currentView","viewOptions","clearStateHistory","constrainResolution","maxLayerZoomExtent","getControls","removeControl","getBaseLayers","setMinZoom","minZoom","setMaxZoom","olUId","getLayerByOlUId","addLayers","offsetZIndex","offsetBaseLayerZIndex","addedLayers","doAddLayer","setLayers","removeLayers","newLayers","layersToRemove","handleLinkedLayersDeletion","linkedIndex","linkedLayer","doRemoveLayer","srcLayer","rootParentByDeletion","getDirectParentLayerByDeletion","hasLinkWithSyncedDelete","layerHasLinkDeletion","getRootParentByDeletion","clbd","getLayerIndex","moveLayer","raiseLayer","reverseLayers","lowerLayer","layerTo","zIndexFrom","changeBaseLayer","existingLayer","getLayerById","maxZIndex","watchLayer","sortLayersByZIndex","layer1","layer2","offline","offlineButtonToggle$","MapBrowserComponent","_view","updateView","_controls","updateControls","activityId","PointerPositionDirective","pointerPositionDelay","listenToMapPointerMove","unlistenToMapPointerMove","pointerMoveListener","onPointerEvent","delay","dragging","lastTimeoutRequest","lonlat","coordinate","pointerPositionCoord","HoverFeatureDirective","styleService","selectionMVT","hoverFeatureId","igoHoverFeatureDelay","igoHoverFeatureEnabled","subscribeToPointerStore","layers$$","tryBindStoreLayer","hoverFeatureMarker","selectionLayer","renderMode","declutter","olVectorTileSource","mvtStyleOptions","createHoverStyle","localHoverStyle","hasLabelStyle","backgroundFill","backgroundStroke","createStyleByAttribute","unsubscribeToPointerStore","unlistenToMapSingleClick","store$$","pointerHoverFeatureStore","addFeatureOverlay","resultsUnderPointerPosition","onMapEvent","singleClickMapListener","onMapSingleClickEvent","topMostOlLayer","maximumZindex","getPixelFromCoordinate","forEachFeatureAtPixel","mapFeature","layerOL","igoLayer","ol_uid","canProcessHover","localOlFeature","handleRenderFeature","setLayerStyleFromOptions","featuresToLoad","myLabelOlFeature","setProperties","labelGeom","OlGeom","setGeometry","setSource","mvtFeatures","localFeature","RenderFeature","hoverEntity","hoverSummary","getHoverSummary","summary","geom","getOrientedFlatCoordinates","coords","flatCoords","idx","mouseout","olStyle","OlStyle","ZoomButtonComponent","getMinZoom","getMaxZoom","onGeolocationClick","GeolocateButtonComponent","_map","tracking$$","HomeExtentButtonComponent","computeHomeExtent","homeExtentButtonExtent","extentOverride","homeExtentButtonCenter","centerOverride","homeExtentButtonZoom","zoomOverride","toggleWakeLock","WakeLockButtonComponent","noSleep","NoSleep","edge","chrome","firefox","opera","safari","disableWakeLock","onblur","enableWakeLock","collapseOrExpand","BaseLayersSwitcherComponent","_baseLayers","expand","showButton","useStaticIcon","arrayLayers","baseLayers","mapZoom","bl","blHidden","GeoDBService","ngxIndexedDBService","compression","dbName","_newData","regionID","insertSource","insertEvent","geoDBData","compress","subject","object$","compressBlob","getByID","dbObject","currentRegionID","collisions","collisionsMap","customUpdate","deleteRequest","deleteByKey","isDeleted","decompressBlob","getRegionByID","datas","IDBKey","IDBKeyRange","only","getAllByIndex","dbRequest","keyRange","lowerBound","mode","DBMode","openCursorByIndex","resetCollisionsMap","getByKey","GeoNetworkService","networkService","networkOnline","simpleGetOptions","getOnline","getOffline","LayerService","dataSourceService","geoNetwork","createTileLayer","createVectorLayer","createImageLayer","_layerOptions","computeMVTOptionsOnHover","createVectorTileLayer","createLayer","createAsyncDataSource","serviceStyle","clusterBaseStyle","createClusterStyle","layerOptionsOl","applyMapboxStyle","mapboxStyle","getStuff","sprite","getAbsoluteUrl","stylefunction","res2","MiniBaseMapComponent","layerService","basemap","_display","_baseLayer","handleBaseLayerChanged","handleMainMapViewChange","mainMapView","mainMapViewProperties","setResolution","setRotation","baselayer","removeAllLayers","handleLinkedBaseLayer","currentLinks","layerToApply","linkedId","linkedLayerOptions","RotationButtonComponent","azimuthRounded","rotationRounded","currentStyle$","radians","deg","bearingToAzimuth","rotated$","InfoSectionComponent","infoContent","wt","CatalogItemType","De","TypeCatalog","Catalog","catalogService","WMSCatalog","loadCatalogWMSLayerItems","WMTSCatalog","loadCatalogWMTSLayerItems","BaselayersCatalog","baselayers","loadCatalogBaseLayerItems","ArcGISRestCatalog","loadCatalogArcGISRestItems","TileOrImageArcGISRestCatalog","typeCatalog","CompositeCatalog","composite","loadCatalogCompositeLayerItems","CatalogFactory","QueryService","queryEnabled","previousMessageIds","queryLayer","getQueryUrl","getScale","HTMLGML2","urlGml","mergeMap","mergedGML","mergeGML","gmlRes","imposedGeom","imposedProperties","extractData","urlGmls","checkScaleAndResolution","requestDataForHTMLGML2","checkScale","checkResolution","pts","firstFeatureType","titleContent","queryTileField","olmpts","returnGeometry","olmline","olgeom","ptsArray","olmpoly","nbFeatures","bbox","getQueryParams","bboxExtent","queryTitleContent","featureGeometryCoordinates","featureGeometryType","appendLineString","appendPolygon","coordinates","convexHull","lower","cross","upper","imposedGeometry","queryDataSource","allowedFieldsAndAlias","getAllowedFieldsAndAlias","extractGML3Data","extractGeoJSONData","ESRIJSON","extractEsriJSONData","TEXT","extractTextData","extractHtmlData","extractGML2Data","geomToAdd","createGeometryFromUrlClick","wmsDatasource","FEATURE_COUNT","featureCount","defaultFeatureCount","E","getQueryTitle","sourceTitle","searchParams","bboxRaw","clickx","clicky","clickx1","clicky1","wktPoly","wmsParser","featureToResult","parser","htmlTarget","crs","IFRAME","bodyTagStart","bodyTagEnd","lastIndexOf","striptags","queryString","pairs","featureOL","featureGeometry","GEOMETRIE","shape","SHAPE","SHAPE_S","SHAPE_L","SHAPE_P","the_geom","geom32198","datasource","forceGML2","queryUrls","getCustomQueryUrl","WMSGetFeatureInfoOptions","INFO_FORMAT","getMimeInfoFormat","QUERY_LAYERS","getFeatureInfoUrl","cartoDatasource","sql","meters","queryPrecision","tileArcGISRestDatasource","deltaX","deltaY","maxDelta","clickBuffer","serviceUrl","mime","getLabelMatch","layerIsQueryable","queryLayerFeatures","layerFeatureIsQueryable","QueryDirective","queryService","queries$$","queryFeatures","queryFeaturesHitTolerance","waitForAllQueries","cancelOngoingQueries","queries$","doQueryFeatures","queryLayers","zip","query$","clickedFeatures","values_","queryFormatAsWms","newFeature","nom","id_","_icon","OlRenderFeature","olRenderFeature","ends","getEnds","OlPolygon","getFlatCoordinates","OlPoint","OlLineString","renderFeatureFromOl","queryFeaturesCondition","olLayerFeatureIsQueryable","dragExtent","forEachFeatureIntersectingExtent","olDragSelectInteractionOnQuery","SearchSource","storageOptions","getDefaultOptions","settings","setParamFromSetting","setting","showInSettings","saveInStorage","confValue","term","settingsName","hashtags","searchSourceSetting","getSettingsValues","hashtagsValid","hashtagKey","hashtag","types","QuerySearchSource","GoogleLinks","encodeURI","markerOpacity","fillOpacity","strokeOpacity","isOlFeature","markerColorAsArray","markerColorRGB","getCommonVectorStyle","OsmLinks","CatalogService","contextConfig","catalogConfig","apiUrl","catalogsFromConfig","observables$","baseLayersCatalog","catalogsFromApi$","catalogs","_response","EMPTY","newCatalog","createInstanceCatalog","collectCatalogItems","getCatalogBaseLayersOptions","layersOptions","externalProvider","Group","getCatalogCapabilities","Service","finalLayers","flattenWmsCapabilities","groupSeparator","capabilitiesCapabilityLayer","includeRecursiveItems","modifiedParent","modifiedLayer","ff","getWMTSItems","getArcGISRESTItems","compositeCatalog","catalogsFromInstance","sortDirection","request1$","request2$","arr","flatDeepLayer","groupImpose","pushImposeGroup","outGroupImpose","address","flatLayer","obs","request3$","recursiveGroupByLayerAddress","keyFn","outItem","indicesMatchTitle","bInd","nPosition","newMetadataUrl","groupId","ind","ix","layerNameFromCatalog","forcedProperties","returnProperty","metadataUrl","metadataAbstract","metadataAbstractAll","metadataUrlAll","forcedPropertiesForAllLayers","forcedProperty","idParent","layersQueryFormat","baseAbstract","configuredQueryFormat","retrieveLayerInfoFormat","showLegend","baseSourceOptions","setCrossOriginAnonymous","propertiesToForce","computeForcedProperties","layerPrepare","itemListIn","regexes","idGroup","idGroupItemNextLevel","groupItem","prepareCatalogItemGroup","testLayerRegexes","layerItem","prepareCatalogItemLayer","itemsPrepare","loopLevel","findCatalogInfoFormat","idGroupItem","ServiceIdentification","matrixSet","requestEncoding","regex","currentLayerInfoFormat","baseInfoFormat","configuredInfoFormat","specific","onLayerAddedChange","CatalogBrowserComponent","catalogAllowLegend","toggleCollapsedGroup","currentItems","addLayerToMap","removeLayerFromMap","addGroupToMap","removeGroupFromMap","addLayersToMap","removeLayersFromMap","profils","security","createAsyncLayer","oLayers","oLayer","returnItem","titleA","titleB","isLayer","sortCatalogItemsByTitle","toggleLegendItem","style_r18","onChangeStyle","onLoadImage","LayerLegendComponent","updateLegendOnResolutionChange","imagesHeight","getLegend","lastlLegend","listStyles","STYLES","onViewControllerStateChange","legendItems$","getLegendGraphic","leg","imgGraphValue","obsLegGraph","newLegends","outLegends","lastLegends","layerLegend","localLayerOptions","wmsDataSourceOptions","updateLegend","legendItems","transfertToggleLegendItem","sA","sa","elemRef","renderedLegends","renderedLegend","CatalogBrowserLayerComponent","mouseInsideAdd","isPreview$$","isPreview$","addedLayerIsPreview","isVisible","layerTooltip","layerMetadata","TITLE","ABSTRACT","CUSTOM","onToggleClick","layerLegendShown$","igoLayer$","addedChange","isNaN","inRange$","isVisible$","CatalogBrowserGroupComponent","toggleCollapsed","evaluateAdded","evaluateDisabled","layerAddedChange","tryToggleGroup","preview$","LayerListToolService","sortAlpha","onlyVisible","onlyInRange","keywordInitialized","sortedAlphaInitialized","onlyVisibleInitialized","onlyInRangeInitialized","check","toggleVisibility","toggleLayerTool","LayerItemComponent","_selectAll","toggleLegendOnVisibilityChange","expandLegendIfVisible","orderable","lowerDisabled","raiseDisabled","queryBadge","_activeLayer","selectionMode","layerTool$","layerCheck","inResolutionRange$","toggleLegend","updateQueryBadge","onResolutionChange","tooltipText","computeTooltip","network$$","showLegend$","inResolutionRange","queryBadgeHidden$","checkbox","vt","LayerListControlsEnum","uo","LayerListSelectVisibleEnum","mi","LayerListDisplacement","selectAll","zoomLayerExtents","changeOpacity","zoomLayersExtents","lowerLayers","raiseLayers","LayerListComponent","thresholdToFilterAndSort","hideSelectedLayers","layersChecked","layersAreAllVisible","ogcButton","timeButton","floatLabel","layerFilterAndSortOptions","excludeBaseLayers","expandLegendOfVisibleLayers","_keyword","_onlyVisible","_sortedAlpha","toggleOpacity","_layers","removeProblemLayerInList","activeLayer$","activeLayer","getUpperLayer","isUpperBaselayer","getLowerLayer","isLowerBaselayer","raisableLayers","selectAllCheck","lowerableLayers","layersCheckedOpacity","change$$","debounce","timer","showToolbar$","computeShowToolbar","computeLayers","appliedFilterAndSort","keyword","selectAllCheck$$","selectAllCheck$","checks","layerTool","lay","showButtonZoomToExtent","layerExtent","layersExtent","actiontype","fromUi","sortedLayersToMove","ZINDEX","layersToMove","Raise","Lower","base","mapIndex","currentLayer","previousLayer","raisableLayer","layersToRaise","targetToScroll","checkItems","getElementsByClassName","itemFocused","nextLayer","lowerableLayer","layersToLower","layersOut","filterLayers","sortLayersByTitle","sortLayersByZindex","showToolbar","never","keepLayerIds","layerKeywords","kw","localKeyword","dataSourceType","keywordRegex","keywordInList","always","removable","layerItemChangeDetection$","isLayerRemovable","statusSelectedLayers","NULL","findTrue","findFalse","MIXED","ALL_VISIBLE","ALL_HIDDEN","eventMapIndex","elemSource","layersList","clearTerm","LayerListToolComponent","onlyVisible$","sortAlpha$","term$","term$$","onlyVisible$$","sortAlpha$$","LayerListBindingDirective","layersOrResolutionChange$$","shownLayers","setLayersVisibilityStatus","layersVisibility$$","visibles","allLayersAreVisible","toggleShowAllLegends","LayerLegendListComponent","showAllLegend","allowShowAllLegends","showAllLegendsValue","computeShownLayers","hasVisibleOrInRangeLayers$","hasVisibleAndNotInRangeLayers$","layersInUi$","allLegendsShown","toggleTrackFeature","TrackFeatureButtonComponent","disableTrackFeature","LayerLegendItemComponent","Ye","GeometryType","Fn","FontType","ge","LabelType","po","CoordinatesUnit","DrawIconService","getIconsList","icons","getPath","tn","MeasureType","ce","MeasureLengthUnit","Zn","Meters","Kilometers","Miles","Feet","ri","ot","MeasureAreaUnit","go","SquareMeters","SquareKilometers","SquareMiles","SquareFeet","Hectares","Acres","io","conversion","metersToKilometers","metersToMiles","metersToFeet","squareMetersToSquareKilometers","squareMetersToSquareMiles","squareMetersToSquareFeet","squareMetersToHectares","squareMetersToAcres","measure","parts","toLocaleString","minimumFractionDigits","maximumFractionDigits","unitAbbr","MeasureLengthUnitAbbreviation","MeasureAreaUnitAbbreviation","olGetLength","olGetArea","measureOlGeometryLength","area","measureOlGeometryArea","lengths","coordinatesLength","olSegment","olMidpoints","olMidpointPoint","getOlGeometryMidpoints","midpointsLength","midpointCoordinate","getCoordinateAt","olMidpoint","setCoordinates","expectedNumber","clearOlMidpointTooltip","olTooltip","removeOverlay","olTooltips","getOlTooltipsAtMidpoints","olCenterTooltip","olCenter","getOlTooltipAtCenter","olPoint","srcGeomType","OlOverlay","stopEvent","setPosition","Olstyle","DecimalDegree","roundCoordTo","roundCoordToString","DegreesMinutesSeconds","convertDDToDMS","DrawStyleService","labelsAreShown","fontSize","Arial","fontStyle","fontSizeAndStyle","labelsAreOffset","flatCoordinates","cos","openSecureUrl","ctx_r8","FeatureDetailsComponent","sanitizer","ready","unsubscribe$","_source","_feature","selectFeature","htmlDisplayEvent","docOrImage","fileUrl","isEmbeddedLink","div","getAttribute","offlineButtonState","Route","olEvent","DrawControl","olDrawingLayer","drawingLayer","createOlInnerOverlayLayer","olGeometryType","olInteractionStyle","interactionStyle","predefinedRadius$","radiusCercle","activateModifyAndSelect","clearOlInnerOverlaySource","removeOlInnerOverlayLayer","removeOlInteractions","addOlInnerOverlayLayer","addOlInteractions","olDrawingLayerSource","OlVectorLayer","drawingLayerSource","OlVectorSource","drawingLayerStyle","olDrawInteraction","freehand$","OlDraw","maxPoints","freehand","ispredefinedRadius$","stopClick","freehandCondition","onDrawStartKey","onDrawStart","onDrawEndKey","onDrawEnd","onDrawAbortKey","abort$","olModifyInteraction","OlModify","olSelectInteraction","OlSelect","doubleClick","onSelect","unsubscribeKeyDown","onDrawKey","start$","olGeometryEvent","mousePosition","getMousePositionFromOlGeometryEvent","changes$","subscribeKeyDown","radiusDrawEnd$","modify$","end$","select$","keyDown$$","removeLastPoint","finishDrawing","abortDrawing","onLabelTypeChange","onChangeCoordinateUnit","onChangeLengthUnit","onChangeAreaUnit","cancelDrawing","confirm","DrawPopupComponent","confirmFlag","Custom","labelType","arrayBuiltInType","currentLabel","labelLength","longitudeLatitude","Circle","longitude","latitude","longlatDD","coordinatesInDD","point4326","currentCoordinates","LineString","lengthInMeters","currentLength","Polygon","areaInMetersSquare","currentArea","circularPolygon","Coordinates","Predefined","coordinatesMeasureUnit","Length","lengthMeasureUnit","Area","areaMeasureUnit","buildArrayType","input","labelFlag","measureUnit","polygonCheck","lengthUnit","metersToUnit","areaUnit","squareMetersToUnit","coordinatesUnit","DDtoDMS","selectOptions","currentOption","getLength","DrawShorcutsComponent","DrawLayerPopupComponent","labelString","onToggleFreehandMode","onMeasureUnitChange","deleteDrawings","onIconChange","openStyleModalDialog","DrawComponent","drawStyleService","drawIconService","draw","editMode","editLabelDrawing","_stores","_drawControls","layerCounterID","draw$","drawControlIsDisabled","drawControlIsActive","freehandMode","UntypedFormControl","Subscription","isCreatingNewLayer","buildForm","getFillColor","getStrokeColor","getStrokeWidth","getLabelsAreShown","getIcons","getIcon","getFontSize","getFontStyle","_activeDrawingLayer","activeStore","activeDrawingLayer","activeDrawControl","drawControls","dc","deactivateDrawControl","allLayers","selectedFeatures$","onLayerChange","createDrawControl","setGeometryType","toggleDrawControl","drawControlsEvent","layersIDEvent","radiusFormControlChange$$","radiusFormControl","changeRadius","activeDrawingLayerSource","createInteractionStyle","newTitle","isNewLayer","StyleModalComponent","autoFocus","onFontChange","onColorChange","onOffsetLabelChange","isDrawEnd","updateLabelOfOlGeometry","updateLabelType","updateMeasureUnit","updateFontSizeAndStyle","updateFillAndStrokeColor","updateOffset","onSelectDraw","updateHeightTable","drawingLayerFeature","addFeatureToStore","clearLabelsOfOlGeometry","longLat","radiusLabel","olGeometryLength","lengthLabel","circleArea","areaLabel","olGeometryArea","drawingStyle","replaceFeatureInStore","labelTypeAndUnit","olGeometryCoordinates","entityCoordinates","rad","center4326","lon4326","lat4326","featureId","OlGeoJSON","extent4326","getDistance","setLayerExtent","currGeometryType","onToggleLabels","activeLayerChange","selectionChange","olGeometryFeature","openDrawDialog","selectedFeature","toggleLabelsAreShown","elementStyle","toggleIsChecked","isCircle","setOlInteractionStyle","currLayer","setupLayer","numberId","createIndividualElementStyle","tryAddLoadingStrategy","tryAddSelectionStrategy","many","isAnIcon","setFontSize","setFontStyle","setIcon","_label","fontStyle_","fillColor_","strokeColor_","offsetX_","offsetY_","typeOfLabel","labelType_","measureUnit_","getOffsetX","numberOfDrawings","tableTemplate","activateDrawControl","getTooltipsOfOlGeometry","drawEnd$$","onModifyDraw","drawSelect$$","getGeometryType","radiusMeters","selectedMeasureUnit","linestringOnly","buildStyleData","styleModalData","getOffsetY","IgoLayerModule","MatDividerModule","MatSlideToggleModule","MatSliderModule","ColorPickerModule","IgoCatalogBrowserModule","type_r9","ctx_r5","ctx_r6","AddCatalogDialogComponent","defaultAddedCatalogType","predefinedCatalogs","addedCatalog","typeCapabilities","addedCatalogType$$","updateValueAndValidity","computePredefinedCatalogList","storeViewAll$$","emailAddress","patchValue","predefinedCatalogsList$","addCatalogDialog","CatalogLibaryComponent","addCatalogAllowed","catalogSelectChange","addingCatalog$$","predefinedCatalog","unsubscribeAddingCatalog","mapName","ServiceType","catalogToAdd","insert","newCatalogs","addedCatalogs","addCatalog","removeCatalogFromLibrary","CatalogLibaryItemComponent","catalogRemove","IgoCatalogLibraryModule","IgoCatalogModule","FilterableDataSourcePipe","arg","isTimeFilterable","isOgcFilterable","TimeFilterService","newdateformStart","newdateformEnd","dates","reformatDateTime","year","years","getFullYear","month","getMonth","day","getUTCDate","hour","getUTCHours","minute","getUTCMinutes","OGCFilterService","filterString","wfsDatasource","interfaceOgcFilters","filterByOgc","filtered","Le","SpatialFilterType","Dt","SpatialFilterItemType","SpatialFilterService","AdmRegion","Arrond","CircFed","CircProv","DirReg","MRC","Mun","RegTour","bornes","hydro","routes","urlFilterList","featureCollection","getKeyByValue","itemType","thematic","Address","bufferInput","simplified","loc","featureType","featureCode","filterType","bufferOutput","DownloadService","DSOptions","currentProj","outputFormatDownload","baseurl","openDownload","DownloadButtonComponent","downloadService","IgoDownloadModule","IgoDrawModule","MatButtonToggleModule","BrowserModule","BrowserAnimationsModule","MatRadioModule","IgoFeatureDetailsModule","IgoFeatureFormModule","IgoFeatureModule","ModifyControl","olModifyInteractionIsActive","olTranslateInteractionIsActive","olDrawInteractionIsActive","removedOlInteractions","modify","olOverlayLayer","olLinearRingsLayer","createOlLinearRingsLayer","removeOlModifyInteraction","removeOlTranslateInteraction","removeOlDrawInteraction","addOlDrawInteraction","addOlTranslateInteraction","activateTranslateInteraction","addOlModifyInteraction","activateModifyInteraction","olOverlaySource","createDrawHoleInteractionStyle","olLinearRingsSource","drawStyle","deactivateModifyInteraction","onModifyStartKey","onModifyStart","onModifyEndKey","onModifyEnd","onModifyKey","subscribeToKeyDown","unsubscribeToKeyDown","olTranslateInteraction","OlTranslate","deactivateTranslateInteraction","onTranslateStartKey","onTranslateStart","onTranslateEndKey","onTranslateEnd","onTranslateKey","olOuterGeometry","getOlGeometry","intersectsCoordinate","subscribeToDrawKeyDown","drawKeyDown$$","unsubscribeToDrawKeyDown","subscribeToDrawKeyUp","activateDrawInteraction","drawKeyUp$$","unsubscribeToDrawKeyUp","deactivateDrawInteraction","clearOlLinearRingsSource","addOlLinearRingsLayer","removeOlLinearRingsLayer","linearRingCoordinates","getLinearRing","addLinearRingToOlGeometry","_linearRingCoordinates","updateLinearRingOfOlGeometry","olPolygon","olLinearRing","appendLinearRing","addLinearRingToOlPolygon","OlLinearRing","newCoordinates","getLinearRings","LAYER","MeasurerDialogComponent","measureAreaUnit","measureLengthUnit","onToggleDisplayLines","onToggleDisplayDistance","onToggleDisplayAreas","onLengthUnitChange","onAreaUnitChange","onCalculateClick","onDeleteClick","MeasurerComponent","activeLengthUnit","formatMeasure","activeAreaUnit","measureType","measureUnitsAuto","displayDistance","displayLines","displayAreas","showTooltips","minSegmentLength","_activeMeasureType","setActiveMeasureType","createDrawLineControl","createDrawPolygonControl","createModifyControl","updateTooltipsOfOlSource","checkDistanceAreaToggle","deactivateModifyControl","freezeStore","activeMeasureType","onDisplayDistance","onDisplayLines","onDisplayAreas","table","activeOlGeometry","updateTooltipsOfOlGeometry","sum","perimeter","openDialog","olDrawSource","modifyControl","_olFeature","activateModifyControl","clearTooltipsOfOlGeometry","setOlGeometry","onFeatureAddedKey","updateMeasureOfOlGeometry","onFeatureRemovedKey","selectedFeatures$$","objectsExists","objectExist","hasArea$","hasLine$","deactivateStrategyOfType","drawLineControl","createMeasureInteractionStyle","drawPolygonControl","drawControl","drawStart$$","drawChanges$$","onDrawChanges","clearMeasures","clearTooltipsOfOlSource","finalizeMeasureOfOlGeometry","measureOlGeometry","measure$","modifyStart$$","modifyEnd$$","modifyChanges$$","onModifyChanges","_measure","olMidpointsTooltips","updateOlGeometryMidpoints","typeGeom","createOlTooltipAtPoint","updateOlTooltipsAtMidpoints","updateOlTooltip","centerCoordinate","olGetCenter","updateOlGeometryCenter","updateOlTooltipAtCenter","shouldShowTooltip","addOverlay","forEachFeature","showTooltipsOfOlGeometry","_unit","_type","computeTooltipInnerHTML","MeasureFormatPipe","GeometryFormFieldInputComponent","createMeasureTooltip","drawGuide","_drawControlIsActive","controlOptions","_geometryType","deactivateControl","freehandDrawIsActive","toggleControl","_freehandDrawIsActive","_predefinedRadius","_drawStyle","createDrawInteractionStyle","olGuideStyle","getGuideStyleFromDrawStyle","defaultDrawStyleRadius","_overlayStyle","addGeoJSONToOverlay","olModify","features_","overlayStyle","addOlOverlayLayer","fn","onTouched","updateDrawStyleWithDrawGuide","activeControl","activateControl","olGeometryEnds$$","onOlGeometryEnds","olGeometryChanges$$","onOlGeometryChanges","removeMeasureTooltip","updateMeasureTooltip","circleToPoint","olGeoJSON","writeValue","lastIndex","lastLength","olLastMidpoint","innerHtml","isStyleWithRadius","IgoGeometryFormFieldModule","IgoGeometryModule","TimeFilterButtonComponent","timeFilterCollapse","handleDateChange","year_r21","handleYearChange","startYear_r27","endYear_r28","ctx_r34","toggleFilterState","playYear","resetFilter","ctx_r2","playFilter","ctx_r3","TimeFilterFormComponent","listYears","startListYears","endListYears","playIcon","resetIcon","YEAR","valueArray","startDate","endDate","DATE","SLIDER","getStepDefinition","timeInterval","getTimezoneOffset","startYear","initStartYear","endYear","initEndYear","isRange","checkFilterValue","yearChange","storeCurrentFilterValue","timeFromWms","newStartListYears","newEndListYears","setupDateOutput","applyTypeChange","thumbLabel","findThumbLabel","mySlider","childNodes","textContent","stopFilter","newMinDateNumber","maxDateNumber","that","setSliderThumbLabel","handleSliderTooltip","getRoundedDate","toDateString","toTimeString","setSeconds","setHours","setMinutes","getDay","selectedHour","getHours","selectedMinute","getMinutes","atMinute","coeff","asMilliseconds","MatSlider","toggleFiltersCollapsed","toggleLegendOnClick","TimeFilterItemComponent","timeFilterService","filtersCollapsed","filterByYear","filterByDate","TimeFilterListComponent","WktService","wkt","wktProj","featureProj","olWKT","epsgTO","extentProj","roundCoordinateArray","wktLine","wktMultiPoints","coordinateArray","lproj","olUnits","roundArray","snrc","snrc250kIndex","snrc50kIndex","snrc1m","snrc250k","snrc50k","ar1m","part1m","part250k","part50k","partEW","partSN","index250kEW","index250kSN","index50kEW","index50kSN","increment250kEW","increment250kSN","increment50kEW","increment50kSN","unitPerTypeEW","unitPerTypeSN","ul","lr","ur","ll","clearSelectedField","updateFieldsList","changeField","changeSpatialSelector","clearProperty","updateValuesList","changeProperty","changeSNRC","changeMapExtentGeometry","OgcFilterFormComponent","wktService","ogcFilterOperator","defaultStepMillisecond","_snrc","allOgcFilterOperators","ogcFilterOperators$","igoSpatialSelectors","currentFilter","computeAllowedOperators","fields$","sFields","excludeFromOgcFilters","sfs","selectedField$","currentFilterIsSpatial","filteredFields$","_filterFields","pos","filteredValues$","_filterValues","detectedProperty","detectProperty","refreshFilters","currentFilterIsSpatial$","refreshFilter","changeSNRCGeometry","snrcToWkt","interfaceOgcFilter","extentToWkt","isSpatial","OgcFilterableFormComponent","addFilterToSequence","changeOgcFilterType","OgcFilterableItemComponent","ogcFilterService","hasActiveSpatialFilter","filtersAreEditable","hasSelector","setOgcWMSFiltersOptions","setOgcWFSFiltersOptions","lastRunOgcFilter","lastLevel","firstFieldName","includedFields","datasourceOptions","firstOperatorName","defaultLogicalParent","force","activeFilters","af","rebuiltIgoOgcFilterObjectFromSequence","rebuildFilter","ogcDataSource","ogcLayer","isAdvancedOgcFilters","changeOgcFiltersAdvancedOgcFilters","OgcFilterableListComponent","OgcFilterButtonComponent","ogcFilterCollapse","currentPushButtonGroup","gr","cntPushButtons","button","currentCheckboxGroup","cntCheckboxes","currentRadioButtonsGroup","cntRadioButtons","radio","currentSelectGroup","cntSelect","currentAutocompleteGroup","cntAutocomplete","filterActiveValue","OGCFilterTimeService","months","weeks","days","hours","week","newDate","stepMillisecond","toDate","subtract","onSelectionChange","bundle_r14","bundle_r26","emptyRadioButtons","bundle_r46","emptySelect","toggleAllSelection","selectOptionClick","bundle_r69","emptyAutocomplete","autocompleteOptionClick","bundle_r99","ctx_r113","OgcFilterSelectionComponent","domService","checkboxesIndex","radioButtonsIndex","baseIndex","selectAllSelected","filteredOgcAutocomplete","_currentFilter","ogcSelector","_g","_h","_j","_k","_l","_m","_o","_p","_q","_r","_s","_u","_v","_w","_x","_y","_z","_0","pe","ue","_1","_2","_3","se","_4","_5","_6","pushButtonsGroup","checkboxesGroup","radioButtonsGroup","selectGroup","autocompleteGroup","selectEnabled$","applyFiltersTimeout","applyFilters","selectEnableds$","autocompleteEnabled$","selectMulti","currentPushButtonsGroup","currentCheckboxesGroup","getSelectEnabled","getSelectDomValues","getAutocompleteEnabled","getAutocompleteDomValues","onPushButtonsChangeGroup","onCheckboxesChangeGroup","onRadioButtonsChangeGroup","onSelectChangeGroup","onAutocompleteChangeGroup","compSelect","selectEnableds","selectEnabled","autocompleteEnabled","toolTip","domSelectors","domValues","domSelector","filterDOM","domOptions","getDom","newBundle","sel","getSelectGroups","comp","getAutocompleteGroups","pushButton","vertical","getPushButtonsGroups","getCheckboxesGroups","getRadioButtonsGroups","currentOgcSelection","markAsUntouched","deselect","newStatus","isUserInput","currentGroup","isTemporalOperator","selectorsLength","decls","SpatialFilterTypeComponent","spatialType","_store","selectedTypeIndex","activeDrawType","eventQueryType","selectedQueryType","zoneChange","zoneWithBufferChange","bufferChange","SpatialFilterListComponent","spatialFilterService","_queryType","queryType","_zone","zoneWithBuffer","bufferFormControl","formValueChanges$$","bufferValueChanges$$","loadBufferGeometry","selectedZone","featureGeom","loadItemById","measureUnitChange","onDrawControlChange","onfreehandControlChange","onItemTypeChange","ctx_r37","clearSearch","clearDrawZone","toggleVisibleList","entityChange","SpatialFilterItemComponent","Thematics","NestedTreeControl","node","childrens","thematics","MatTreeNestedDataSource","selectedThematics","geometryTypeField","drawGuideField","drawGuidePlaceholder","listIsVisible","geometryTypes","drawGuide$","drawStyle$","PointStyle","PolyStyle","overlayStyle$","_thematicLength","loadThematicsList","limits","child","value$","value$$","drawZone","drawZoneEvent","radiusChanges$$","bufferChanges$$","bufferEvent","selectedRecordStrategy","selectionStrategy","detach","selectedItemType","itemTypeChange","isPolygon","isPoint","treeControl","isExpanded","collapse","numSelected","numNodes","bool","selectedThematicsName","hasChild","thematicChange","nodeSelected","freehandControl","predefinedRadius","isPredefined","radiusEvent","toggleSearch","thematicLength","openWorkspace","createTableTemplate","clearButtonEvent","clearSearchEvent","formValue","typeColumn","nameColumn","modeChange","changePropertyByPass","hour_r27","minute_r31","hour_r39","minute_r43","monthSelected","OgcFilterTimeComponent","ogcFilterTimeService","_defaultMin","_defaultMax","_defaultDisplayFormat","_defaultSliderModeEnabled","sliderMode","calendarTypeYear","_beginValue","_endValue","sliderInterval","displayFormat","beginValue","parseFilter","handleMin","endValue","handleMax","onlyYearBegin","getUTCFullYear","onlyYearEnd","isCalendarYearMode","setFilterStateDisable","updateHoursMinutesArray","updateValues","dateFilter","filterBeginFunction","filterEndFunction","intervalInt","_now","endOf","getDateFromStringWithoutTime","dateStringFromYearNotime","valueTmp","getDateTime","calendarType","restrictedToStep","changeTemporalProperty","addStep","stepMilliseconds","toISOString","datePicker","yearSelected","stepIsYearDuration","stepIsMonthDuration","dateValue","monthDiff","dateValuePlus1","monthDiffPlus1","asYears","asMonths","stepIsWeekDuration","weekDiff","weekDiffPlus1","asWeeks","stepIsDayDuration","dayDiff","_mod","asDays","stepIsHourDuration","hourDiff","asHours","stepIsMinuteDuration","valuetmp2","valuetmp","beginHourFormControl","beginMinuteFormControl","endHourFormControl","endMinuteFormControl","checkEndValue","beginHours","handleHourIncrement","endHours","beginMinutes","handleMinuteIncrement","endMinutes","beginTmp","endTmp","fullBeginHoursArray","fullEndHoursArray","fullBeginMinutesArray","fullEndMinutesArray","restrictToStep","filterStateDisable","stringDate","dateItems","minDefaultDate","maxDefaultDate","minDefaultISOString","maxDefaultISOString","filterOriginConfig","todayDateStringNoTime","toLocaleDateString","OgcFilterTimeSliderComponent","sliderValue","calculatedStep","_defaultSliderInterval","sliderDisplayWith","dateToNumber","calculateStep","handleSliderInput","dateTmp","beginMillisecond","toAdd","slider","_increment","_emitInputEvent","matSliderChange","dateBeginTmp","dateEndTmp","startOf","maxMillisecond","IgoFilterModule","MAT_DATE_LOCALE","MatTabsModule","MatTreeModule","MatOptionModule","MatNativeDateModule","MatDatetimepickerModule","MatNativeDatetimeModule","ExportError","ExportInvalidFileError","setPrototypeOf","ExportNothingToExportError","strEnum","EncodingFormat","ExportService","aggregateInComment","ogreUrl","gpxAggregateInComment","encoding","exportOlFeatures","generateFeature","exportAsync","excludePrefix","ExportFormat","GPX","generateAggregatedFeature","comment","nothingToExport","ogreFormats","noOgreFallbacks","exportToFile","exportWithOgre","fileName","uri","setAttribute","downloadFromUri","downloadContent","writeFeatures","encodingType","featuresText","UTF8","acceptCharset","enctype","LATIN1","featuresJson","encodedProperties","encode","geojsonField","outputNameField","outputName","ogreFormat","outputFormatField","submit","GML","KML","Shapefile","CSVcomma","CSVsemicolon","file","styleListService","computeLayerTitleFromFile","imposedSourceOptions","imposedLayerOptions","distance","getStyleList","addLayerAndFeaturesStyledToMap","createImportedLayerRandomStyle","addLayerAndFeaturesToMap","messageTitle","handleNothingToImportError","sizeMb","ImportError","ImportInvalidFileError","ImportUnreadableFileError","ImportNothingToImportError","ImportSizeError","ImportSRSError","ImportOgreServerError","ImportService","importConfig","clientSideFileSizeMax","clientSideFileSizeMaxMb","formats","allowedExtensions","formatExtensionAssociation","importAsync","extension","getFileExtension","zipMimeTypes","allowedZipMimeTypes","allowedMimeTypes","importFile","importFileWithOgre","importer","getFileImporter","parseFeaturesFromFile","readAsText","FormData","append","parseFeaturesFromGeoJSON","errMsg","msg","GeoJSON","writeFeatureObject","StyleListService","styleList","baseStyleList","styleListResponse","projection_r6","inLayersIdToExportSelectionOnly","layer_r29","handleExportFormSubmit","ImportExportComponent","importService","exportService","forceNaming","controlFormat","popupChecked","selectFirstProj","_projectionsLimitations","selectedMode","loadConfig","computeProjections","importHtmlClarifications","exportHtmlClarifications","importForm","inputProj","exportableLayers$","configFileSizeMb","fileSizeMb","exportOptions$$","exportOptions$","exportOptions","computeFormats","formLayer$$","handlePopup","handlePreviousLayerSpecs","selectedLayers","formats$","loading$","previousSpecs","previousLayerSpecs$","formats$$","encodings$$","encodings$","encodings","exportableLayers$$","projections$","translateKey","projectionsConstraints","projectionsLimitations","projFromConfig","nad83","wgs84","webMercator","utm","mtm","minZone","maxZone","computeProjectionsConstraints","configProjection","wksFromLayerId","wksFromLayer","getWorkspaceByLayerId","firstBy","layersWithSelection","exportOptionsChange","specs","files","espgCodeRegex","import","onFileImportSuccess","onFileImportError","preCheck","p1","p2","closed","onPopupBlockedError","popupAllowed","geomTypesCSV","featuresCSV","filename","layerIndex","combineLayers","dSOptions","wks","featureInMapExtent","geomTypes","featureGeomType","currentGeomType","geomType","circle","circular","previousFeature","currentFeature","titleEmptyRows","createTitleEmptyRows","export","onFileExportError","onFileExportSuccess","titleRow","headerRow","emptyRow","previousFeatureKeys","firstKeyPrevious","currentFeatureKeys","firstKeyCurrent","previousKey","firstKeyAll","sameKeys","unset","handleFileImportSuccess","handleInvalidFileImportError","handleSizeFileImportError","handleUnreadbleFileImportError","handleSRSImportError","handleOgreServerImportError","handleFileImportError","extraMessage","handleNothingToExportError","handleFileExportError","loadEncodings","appliedformats","formatsType","onlyUrl","onlyVector","vectorAndUrl","customList","validateListFormat","allowedFormats","validatedListFormat","commonFormats","layersWithCustomFormats","previousCustomListFormats","finalFormats","selectMode","handleFileExportSuccess","STYLELIST_OPTIONS","IgoStyleListModule","provideStyleListOptions","styleListFactory","IgoImportExportModule","IgoMapModule","MeasurerItemComponent","_auto","toggleAutoUnit","measure$$","computeBestMeasureUnit","converted","possibleUnits","computeBestAreaUnit","computeBestLengthUnit","IgoMeasurerModule","IgoMeasureModule","OverlayAction","OverlayService","features$","OverlayDirective","overlayService","olFormatGeoJSON","features$$","handleFeatures","IgoOverlayModule","jsPDFAPI","setGeoArea","pdfExt","geoExt","minx","maxx","maxy","miny","bounds","bbox_obj","internal","newAdditionalObject","bounds_obj","proj_obj","objId","title_obj","bbox_id","write","PrintService","titleFont","titleFontStyle","subtitleFont","subtitleFontStyle","commentFont","commentFontStyle","commentFontSize","paperFormat","GeoPdfPlugin","jsPDF","titleSizes","subtitleSizes","doc","dimensions","margins","fontSizeInPt","getTextPdfObjectSizeAndMarg","TEXTPDFFONT","addTextInPdfDoc","marginLeft","subtitle","showProjection","showScale","addProjScale","addComment","addMap","addScale","handleMeasureLayer","addGeoRef","imgSizeAdded","legendPosition","addLegendSamePage","addLegend","saveDoc","docHeight","getHeight","pdf_extents","pdf_units2points","mapOverlayMeasuresHTML","getOverlayContainer","html2canvas","canvasOverlayHTMLMeasures","addCanvas","legends","legendUrls","getLayersLegends","images$","getDataImage","rxMap","dataImage","htmlImg","dataImages","doZipFile","getLayersLegendHtml","useCORS","canvas","generateCanvaFileToZip","saveCanvasImageAsFile","pageWidth","setFont","textMarginLeft","textDimensions","getTextDimensions","textToAdd","textFont","textFontStyle","textFontSize","textMarginTop","heightPixels","textProjScale","formatScale","imageSize","addPage","imgData","toDataURL","addImage","pourcentageReduction","marginsLegend","mapSize","mapOverlayHTML","getOverlayContainerStopEvent","OverlayHTMLButtons","OverlayHTMLButtonsarr","allowTaint","canvasOverlayHTML","nbFileToProcess","ms","getImageSizeToFitPdf","rect","widthPixels","canvases","getViewport","mapStatus$$","mapStatus","renderMap","oldCanvas","newCanvas","newContext","getContext","positionHCanvas","commentWidth","measureText","positionHProjScale","commentNbLine","positionHComment","fillStyle","fillRect","fillText","projectionScaleText","projText","scaleText","mapScale","CommentLengthToCut","commentCurrentLine","positionFirstCutChar","positionLastBlank","drawImage","addLegendToImage","fileNameWithExt","tfwFileNameWithExt","tiwContent","getWorldFileInformation","addFileToZip","saveAs","saveFileProcessing","renderSync","canvasLegend","canvasHeight","canvasWidth","legendHeight","legendWidth","legendX","legendY","strokeRect","updateSize","save","returnPromise","pageHeight","canHeight","canWidth","heightRatio","widthRatio","maxRatio","currentResolution","nameWithExt","blobFormat","msSaveBlob","msToBlob","toBlob","zipFile","JSZip","getZipFile","generateAsync","PrintOutputFormat","PrintPaperFormat","PrintOrientation","zu","PrintSaveImageFormat","PrintLegendPosition","PrintFormComponent","outputFormats","paperFormats","orientations","PrintResolution","imageFormats","legendPositions","isPrintService","imageFormat","imageFormatField","Jpeg","onlySelf","Pdf","paperFormatField","Letter","orientationField","landscape","resolutionField","legendPositionField","none","titleField","subtitleField","commentField","showProjectionField","showScaleField","showLegendField","doZipFileField","PrintComponent","printService","_outputFormat","_paperFormat","_orientation","_imageFormat","_legendPosition","_resolution","print","defineNbFileToProcess","nbRequests","downloadMapImage","getLayersLegendImage","IgoPrintModule","IgoQueryModule","querySearchSourceFactory","DirectionsSource","DirectionsSourceService","DirectionsFormat","ua","pa","SourceDirectionsType","Ro","ProposalType","qn","DirectionType","Qn","DirectionRelativePositionType","stopsStore","totalLength","relativePosition","Intermediate","Start","End","positions","stops","stop","maxPosition","insertPosition","lastPosition","stopToUpdate","computeRelativePosition","updateStoreSorting","vertexStyle","stopStyle","routeStyle","Stop","routesFeatureStore","geometry4326","olGeom","geojsonGeom","previousRoute","previousRouteRevision","routeFeatureStore","modifier","stepPosition","exit","directive","lastStep","cssClass","translatedDirection","translateBearing","translatedModifier","translateModifier","aggregatedDirection","coma","cntSuffix","instruction","bearing","clearStop","removeStop","onStopEnter","onStopLeave","stop_r1","setStopText","chooseProposal","DirectionsInputsComponent","invalidKeys","onMapClickEventKeys","stopIsDragged","coordRoundedDecimals","unlistenMapSingleClick","stopWithHover","geomCoord","pointOnFeature","validateTerm","keyIsValid","extra","stopsToComputePosition","computeStopsPosition","removeStopFromStore","moveStops","previousIndex","currentIndex","fromIndex","toIndex","moveItemInArray","stopInputHasFocus","listenMapSingleClick","stopsFeatureStore","roundedCoord","olProj","olObservable","DirectionsService","directionsSourceService","directionsOptions","routeSource","reverseSearch","str1","str2","caseSensitive","termFrom","termTo","fromToDiff","findDiff","toFromDiff","totalDiff","delta","SearchSourceService","getSources","SearchService","searchSourceService","termIsValid","stringToLonLat","getEnabledOnly","getEnabledSources","searchType","sourceCanSearch","asPointerSummary","reverseSourceFonction","sourceCanReverseSearchAsSummary","sourceCanReverseSearch","reverseSearchCoordsFormat","reverseSearchSources","resetStops","zoomRoute","copyDirectionsToClipboard","copyLinkToClipboard","DirectionsButtonsComponent","clearStops","addStopToStore","zoomToActiveRoute$","directionsBody","directionsToText","indent","activeRouteDirective","wayPointList","activeRoute","formatDistance","formatDuration","wayPointsCnt","stopText","localCnt","formatStep","formatInstruction","maneuver","bearing_after","contextUri","routingOptions","directionsKey","stopsCoordinates","directionsUrl","pathname","showSegment","onStepsListBlur","DirectionsResultsComponent","activeFeatureWithDirection","directions","activeDirection","stepFeatureStore","showRouteSegmentGeometry","vertexId","geometryMapProjection","routeSegmentCoordinates","lastPoint","previousVertex","previousVertexRevision","stepFeature","Vertex","DirectionsComponent","directionsService","searchService","routesQueries$$","focusOnStop","isTranslating","previousStops","searchs$$","initEntityStores","loadingStrategy","directionsStyle","initStopsFeatureStore","initRoutesFeatureStore","initStepFeatureStore","initOlInteraction","storeEmpty$$","storeChange$$","zoomRoute$$","freezeStores","selectStopInteraction","translateStop","selectedRoute","monitorEmptyEntityStore","monitorEntityStoreChange","monitorActiveRouteZoom","routeExtent","executeStopTranslation","olCondition","selectCoordinates","addedStop","translatedStopId","translationCoordinates","translatedStop","storeInitialized$","handleStopDiff","handleStopsFeature","getRoutes","simplifiedStops","stopIdToProcess","changedStop","researches","isCoord","cancelSearch","requests$","searchProposals","sp","Coord","Text","storedSource","addStopOverlay","stopFeature","isOverview","stopsWithCoordinates","roundedCoordinates","overviewDirectionsOptions","overview","alternatives","continue_straight","routeResponse","addDirectionToRoutesFeatureStore","stopColor","previousStop","stopFeatureStore","stopOpacity","addStopToStopsFeatureStore","IgoDirectionsModule","directionsSourceServiceFactory","DragDropModule","IChercheSearchResultFormatter","IgoHttpParameterCodec","IChercheSearchSource","formatter","hashtagsLieuxToKeep","getAllowedTypes","title$","ecmax","computeRequestParams","extractResults","typeSetting","typesMatched","computeOptionsParam","computeTerm","xMin","yMin","xMax","yMax","encoder","formatResult","dataToResult","computeProperties","dataType","titleHtml","highlight","title2","title3","score","computeTermSimilarity","nextPage","propertiesBlacklist","googleMaps","googleMapsNom","googleLinksProperties","GoogleMaps","getGoogleMapsCoordLink","getGoogleMapsNameLink","municipalite","GoogleStreetView","getGoogleStreetViewLink","routing","keep","IChercheReverseSearchSource","computeExtent","subtitleHtml","getSubtitle","pointerSummaryTitle","CoordinatesSearchResultFormatter","CoordinatesReverseSearchSource","reverseSearchCoordsFormatEnabled","dataDMS","rawCoord3857","convertedLonLat","igo2CoordFormat","utmZoneFromLonLat","utmName","rawCoordUtm","long","mtmZoneFromLonLat","mtmName","rawCoordMtm","rawCoord","numericEpsgCode","lonLatConversion","roundedCoordString","roundedCoordStringDMS","circleGeometry","polygonGeometry","writer","writeGeometry","OpenStreetMap","getOpenStreetMapLink","_projectionService","ILayerSearchResultFormatter","allowedKey","dataR","ILayerSearchSource","computeSearchRequestParams","computeLayerOptions","groupTitle","extractQueryParamsFromSourceUrl","formatOpt","urls","urlOpt","SEARCH_TYPES","SearchSelectorComponent","searchTypes","searchType$","setSearchType","searchType$$","onSetSearchType","enableSourcesByType","searchTypeChange","IgoSearchSelectorModule","checkUncheckAllSources","checkUncheckAll","setting_r13","changePointerReverseSearch","changeSearchResultsGeometry","SearchSettingsComponent","hasPointerReverseSearchSource","searchSourcesAllEnabled","now","displayBlock","pointerSummaryEnabled","searchResultsGeometryEnabled","pointerSummaryStatus","hasReverseSearchSourcesForPointerSummary","textSearchSources","computeSourcesCheckAllBehavior","settingValue","searchSourceChange","allEnabled","enabledSourcesCnt","disabledSourcesCnt","computeSettingCheckAllBehavior","getSearchSources","storage","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","IgoSearchSettingsModule","onClearButtonClick","onSearchTypeChange","SearchBarComponent","showSearchButton","_reverseSearchCoordsFormatEnabled","appearance","termSplitter","minLength","searchSelector","searchSettings","setTerm","stream$$","stream$","onSetTerm","handlePlaceholder","configValue","clearFeature","doSearch","searchSettingsChange","reverseCoordEvent","slug","searchTermChange","ss","placeholder$","rawTerm","terms","researches$$","research","onResearchCompleted","newResults","onKeyup","IgoSearchBarModule","onZoomHandler","SearchResultsItemComponent","withZoomButton","titleHtmlProperty","getEntityTitleHtml","group_r2","resultFocus","resultUnfocus","displayMoreResults","SearchResultMode","mr","SearchResultsComponent","showResultsCount","searchResultMode","pageIterator","Grouped","_term","_results$","liftResults","settingsChange$$","settingsChange$","resultSelect","groupResults","sortByOrder","r1","r2","displayOrder","grouped","sourceResults","stategy","moreResults","layer_r2","SaveFeatureDialogComponent","filteredLayers","onMouseEvent","addFeatureToLayer","SearchResultAddButtonComponent","layersSubcriptions","searchLayer","IgoSearchResultsModule","SearchPointerSummaryDirective","reverseSearch$$","searchPointerSummaryFeatureId","igoSearchPointerSummaryDelay","igoSearchPointerSummaryEnabled","pointerPositionSummaryMarker","unsubscribeReverseSearch","pointerSearchStore","entitiesToPointerOverlay","closestResultByType","computeSummaryClosestFeature","summarizedClosestType","processedSummarizedClosestType","typeIndex","addPointerOverlay","onSearchCoordinate","_results","onSearch","pointerSummary","IgoSearchModule","searchSourceServiceFactory","defaultIChercheSearchResultFormatterFactory","defaultCoordinatesSearchResultFormatterFactory","ilayerSearchResultFormatterFactory","OgcFilterComponent","OgcFilterWidget","IgoOgcFilterModule","WfsWorkspace","queryOptions","tabQuery","mapQueryOnOpenTab","WfsWorkspaceService","srcId","workspaceId","createFeatureStore","inMapExtentStrategy","inMapResolutionStrategy","confQueryOverlayStyle","getCommonVectorSelectedStyle","zoomAuto","createFilterInMapExtentOrResolutionStrategy","relations","relationsColumn","relation","ws$","class_icon","columnsFromFeatures","col","WmsWorkspaceService","wmsLinkId","wfsLinkId","linkProperties","hasOgcFilters","clonedLinks","wksLayerOption","workspaceLayer","Fe","ConfirmationPopupComponent","EditionWorkspace","editionWorkspaceService","edit","deleteUrl","columnName","primary","deleteFeature","editionOpt","getDomainValues","original_properties","original_geometry","idkey","editFeaturefilterClauseFunc","adding$","newFeaturefilterClauseFunc","addWithDraw","onGeometryTypeChange","featureOl","createModifyInteraction","olCollection","Collection","modifyStyle","EditionWorkspaceService","WKT","wksConfig","rendererType","modifyButton","editFeature","deleteButton","saveFeature","cancelEdit","cellClass","validateFeature","sanitizeParameter","addUrl","addHeaders","modifyProtocol","modifyUrl","protocole","modifyHeaders","modifyFeature","hasGeometry","projDest","geomDatabaseProj","wktFormat","geoJsonFormat","refreshMap","rowsInMapExtentCheckCondition$","genericErrorMessage","removeZ","relationLayers","relationLayers$","fromSave","wfsOlLayer","wmsOlLayer","_t","FeatureWorkspace","FeatureWorkspaceService","WorkspaceSelectorDirective","wfsWorkspaceService","wmsWorkspaceService","featureWorkspaceService","onLayersChange","changeWorkspace","adding","rowsInMapExtentCheckCondition","editableLayers","layerIsEditable","editableLayersIds","workspacesToAdd","getOrCreateWorkspace","workspacesToRemove","workspaceStore","createWorkspace","wmsWks","IgoWorkspaceUpdatorModule","IgoConfirmationPopupModule","IgoGeoWorkspaceModule","ogcFilterWidgetFactory","StopsStore","StopsFeatureStore","RoutesFeatureStore","StepFeatureStore","OsrmDirectionsSource","_name","directionsParams","getRouteParams","extractRoutesData","formatRoute","waypoints","geometries","roadNetworkRoute","stepsUI","legs","sourceType","weight_name","NominatimSearchSource","computeGeometry","place_id","display_name","osm_type","boundingbox","computeTermTags","tag","computeTermSettings","StoredQueriesSearchSource","storedQueriesOptions","defaultResultTitle","storedquery_id","splitPrefix","outputformat","srsname","resultTitle","multipleFieldsQuery","storedqueriesParams","resultArray","extractWFSData","idxEnd","resultTotLenght","patternGml3","geojson","wfsfeatures","splittedTerm","remainingTerm","splitterRegex","wfsversion","StoredQueriesReverseSearchSource","longField","latField","longLatParams","doc_type","AppSimpleMapRoutingModule","AppSimpleMapComponent","onPointerMove","pointerCoord","AppSimpleMapModule","AppLayerRoutingModule","AppLayerComponent","AppLayerModule","AppLegendRoutingModule","AppLegendComponent","AppLegendModule","AppOverlayRoutingModule","AppOverlayComponent","ngAfterViewInit","setFeatures","AppOverlayModule","AppGeometryRoutingModule","AppGeometryComponent","AppGeometryModule","AppFeatureRoutingModule","AppFeatureComponent","AppFeatureModule","AppHoverRoutingModule","AppHoverComponent","AppHoverModule","AppMeasureRoutingModule","AppMeasureComponent","AppMeasureModule","AppDrawRoutingModule","AppDrawComponent","AppDrawModule","AppQueryRoutingModule","AppQueryComponent","feature1","olLineString","feature2","feature3","handleQueryResults","AppQueryModule","AppCatalogRoutingModule","AppCatalogComponent","loadCatalogs","catalogStore","onCatalogSelectChange","loadCatalogItems","catalogItemStore","AppCatalogModule","Vt","TypePermission","ContextService","contexts$","ours","importedContext","mapViewFromRoute","basePath","contextListFile","defaultContextUri","readParamsFromRoute","hasAuthService","logged","handleContextsChange","loadContexts","_defaultContextUri","permissions","defaultContextId$","getContextByUri","defaultContextId","imported","contexts","contextCreated","permission","contextCloned","contextId","toolId","profil","typePermission","permissionId","urlBase","resBase","resMerge","l2","t2","err2","getLocalContexts","loadFct","direct","getDefault","_context","addContextToList","setContext","loadContext","contextParam","context$","handleContextMessage","currentContext","keepCurrentView","setEditedContext","editedContext$","global","extraFeatures","currentLayers","layerFound","contextLayer","olVectorSource","Cluster","cleanedOlFeatures","catalogLayer","removeAllAreNotError","contextToLoad","getDetails","getLocalContext","mapLayers","permissionError","titleContext","keepCurrentContext","editedContext","findContext","toolsChanged$","loadDefaultContext","editedFound","public","found","IgoContextImportExportModule","MapContextDirective","contextService","context$$","handleContextChange","viewContext","controlsContext","scaleLineOption","minWidth","LayerContextDirective","contextLayers","removeLayersOnContextChange","queryParams$$","layersAndIndex$","computeLayerVisibilityFromUrl","addImportedFeaturesStyledToMap","addImportedFeaturesToMap","currentLayerid","contextParams","visibleOnLayersParams","visibleOffLayersParams","visiblelayers","invisiblelayers","ContextListControlsEnum","BookmarkDialogComponent","favoriteClick","managePermissions","ContextItemComponent","showFavorite","favorite","clearFilter","manageTools","ContextListComponent","contextsInitial","shared","showHidden","thresholdToFilter","_contexts","_selectedContext","_defaultContextId","filterContextsList","createContext","sortedAlpha","sortContextsList","updateContexts","publics","showContextFilter","contextsList","getPermission","indeterminate","childs","parentPermission","childrenPermission","filterPermissionsChanged","ContextListBindingDirective","confirmDialogService","loadEditedContext","contextFromMap","getContextFromMap","msgSuccess","setDefault","titleD","showContext","hideContext","contexts$$","defaultContextId$$","storedContextUri","selectedContext$$","selectedContext","authenticate","getProfilByUser","users","profilsAcc","cur","onFavorite","onManageTools","onManagePermissions","showHiddenContexts","onShowContext","onHideContext","PoiService","IgoContextMapButtonModule","IgoContextManagerModule","ImportExportType","In","ImportExportMode","ImportExportState","importExportType$","selectedMode$","ToolState","importExportState","toolToActivate","setsExportOptions","setMode","openSidenav$","StorageState","igoStorageService","FeatureActionsService","storageState","toolState","storageChange$$","selectOnlyCheckCondition$","buildActions","zoomAuto$","storageChange","handleZoomAuto","mapExtentStrategyActiveToolTip","noElementSelected","filterStrategy","filterSelectionStrategy","toolToActivateFromOptions","maximize$","WfsActionsService","ogcFilterWidget","activateWidget","EditionActionsService","WorkspaceState","featureActionsService","wfsActionsService","editionActionsService","workspacePanelExpanded","actionMaximize$$","initWorkspaces","workspace$","manyBy","workspaces","loadActions","setWorkspaceIsMaximized","maximized","activeWorkspace$$","activeWorkspaceWidget$$","activeWorkspaceWidget$","rowsInMapExtentCheckCondition$$","rowsInMapExtent","selectOnlyCheckCondition$$","selectOnly","workspaceMaximize$","wksFromId","wksFromTitle","teardownWorkspaces","SearchState","searchOverlayStyle","searchOverlayStyleSelection","searchOverlayStyleFocus","searchResultsGeometryEnabled$","createCustomFilterTermStrategy","searchDisabled$","searchTerm","searchTerm$","searchSettingsChange$","selectedResult$","IgoAppSearchBarModule","IgoAppSearchResultsToolModule","IgoAppSearchModule","AppSearchRoutingModule","AppSearchComponent","searchState","osmLayer","igoReverseSearchCoordsFormatEnabled","searchStore","onPointerSummaryStatusChange","onSearchTermChange","setSearchTerm","termWithoutHashtag","onReverseCoordsFormatStatusChange","onSearchSettingsChange","onResultFocus","tryAddFeatureToMap","searchCoordinate","openGoogleMaps","openGoogleStreetView","removeFeatureFromMap","onContextMenuOpen","mapPosition","getCoordinateFromPixel","contextmenuPoint","mapBrowser","getBoundingClientRect","scrollY","scrollX","ElementRef","AppSearchModule","CoordinatesReverseSearchSourceFactory","ichercheSearchSourceFactory","ilayerSearchSourceFactory","nominatimSearchSourceFactory","ichercheReverseSearchSourceFactory","storedqueriesSearchSourceFactory","storedqueriesReverseSearchSourceFactory","AppPrintRoutingModule","AppPrintComponent","AppPrintModule","AppImportExportRoutingModule","AppImportExportComponent","AppImportExport","AppDirectionsRoutingModule","AppDirectionsComponent","AppDirectionsModule","osrmDirectionsSourcesFactory","AppTimeFilterRoutingModule","AppTimeFilterComponent","AppTimeFilterModule","AppOgcFilterRoutingModule","AppOgcFilterComponent","Fill","Stroke","AppOgcFilterModule","AppSpatialFilterRoutingModule","AppSpatialFilterComponent","getOutputType","getOutputQueryType","loadFilterList","spatialListStore","getOutputToggleSearch","loadThematics","getOutputClearSearch","clearMap","activeLayers","iterator","zeroResults","tryAddFeaturesToMap","loadFilterItem","featuresPoint","featuresLinePoly","idPoint","idLinePoly","tryAddPointToMap","tryAddLayerToMap","onZoneChange","zoomToFeatureExtent","_internal","featuresOl","createSvgIcon","pushLayer","xmlSerializer","AppSpatialFilterModule","AppWorkspaceRoutingModule","AppWorkspaceComponent","workspaceState","selectedWorkspace$","workspacePaginator","AppWorkspaceModule","AppContextRoutingModule","AppContextComponent","AppContextModule","HttpClientJsonpModule","redirectTo","pathMatch","AppRoutingModule","useHash","AppComponent","changeDetectorRef","mobileQuery","matchMedia","_mobileQueryListener","addEventListener","themeClass","detectOldBrowser","removeEventListener","oldBrowser","defaultTooltipOptions","showDelay","hideDelay","touchendHideDelay","disableTooltipInteractivity","AppModule","bootstrap","appInitializerFactory","MAT_TOOLTIP_DEFAULT_OPTIONS","MatSidenavModule","MatToolbarModule","HammerModule","getTranslation","enableProdMode","__NgCli_bootstrap_1","bootstrapModule","O","vo"],"sourceRoot":"webpack:///","sources":["./packages/utils/src/lib/base64.ts","./packages/utils/src/lib/user-agent.ts","./packages/utils/src/lib/clipboard.ts","./packages/utils/src/lib/string-utils.ts","./packages/utils/src/lib/change.interface.ts","./packages/utils/src/lib/change.ts","./packages/utils/src/lib/object-utils.ts","./packages/utils/src/lib/number-utils.ts","./packages/utils/src/lib/strenum.ts","./packages/utils/src/lib/uuid.ts","./packages/utils/src/lib/watcher.ts","./packages/core/src/lib/activity/activity.service.ts","./packages/core/src/lib/activity/activity.interceptor.ts","./packages/core/src/lib/activity/activity.module.ts","./packages/core/src/lib/config/version.ts","./packages/core/src/lib/config/config.service.ts","./packages/core/src/lib/config/config.provider.ts","./packages/core/src/lib/config/config.module.ts","./packages/core/src/lib/language/shared/language.loader.ts","./packages/core/src/lib/language/shared/language.provider.ts","./packages/core/src/lib/language/shared/missing-translation.guard.ts","./packages/core/src/lib/language/language.module.ts","./packages/core/src/lib/message/message.module.ts","./packages/core/src/lib/message/shared/message.enum.ts","./packages/core/src/lib/language/shared/language.service.ts","./packages/core/src/lib/message/shared/message.service.ts","./packages/core/src/lib/request/error.interceptor.ts","./packages/core/src/lib/request/error.module.ts","./packages/core/src/lib/core.module.ts","./packages/core/src/lib/route/route.service.ts","./packages/core/src/lib/media/media.enum.ts","./packages/core/src/lib/media/media.service.ts","./packages/core/src/lib/storage/storage.interface.ts","./packages/core/src/lib/storage/storage.service.ts","./packages/core/src/lib/compression/compression.service.ts","./packages/core/src/lib/network/network.service.ts","./packages/common/src/lib/entity/shared/entity.enums.ts","./packages/common/src/lib/entity/shared/entity.utils.ts","./packages/common/src/lib/entity/shared/state.ts","./packages/common/src/lib/entity/shared/view.ts","./packages/common/src/lib/entity/shared/store.ts","./packages/common/src/lib/entity/shared/watcher.ts","./packages/common/src/lib/entity/shared/strategies/strategy.ts","./packages/common/src/lib/entity/shared/strategies/filter-custom-function.ts","./packages/common/src/lib/entity/shared/strategies/filter-selection.ts","./packages/common/src/lib/entity/entity-selector/entity-selector.component.html","./packages/common/src/lib/entity/entity-selector/entity-selector.component.ts","./packages/common/src/lib/stop-propagation/stop-propagation.directive.ts","./packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.component.ts","./packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.component.html","./packages/common/src/lib/image/image-error.directive.ts","./packages/common/src/lib/entity/entity-table/entity-table-row.directive.ts","./packages/common/src/lib/custom-html/custom-html.pipe.ts","./packages/common/src/lib/image/secure-image.pipe.ts","./packages/common/src/lib/entity/entity-table/entity-table.component.html","./packages/common/src/lib/entity/entity-table/entity-table.component.ts","./packages/common/src/lib/action/shared/action.enums.ts","./packages/common/src/lib/action/actionbar/actionbar-item.component.html","./packages/common/src/lib/action/actionbar/actionbar-item.component.ts","./packages/common/src/lib/action/actionbar/actionbar.component.html","./packages/common/src/lib/action/actionbar/actionbar.component.ts","./packages/common/src/lib/action/actionbar/actionbar.module.ts","./packages/common/src/lib/action/action.module.ts","./packages/common/src/lib/badge-icon/badge-icon.directive.ts","./packages/common/src/lib/badge-icon/badge-icon.module.ts","./packages/common/src/lib/clickout/clickout.directive.ts","./packages/common/src/lib/clickout/clickout.module.ts","./packages/common/src/lib/collapsible/collapse.directive.ts","./packages/common/src/lib/collapsible/collapsible.component.ts","./packages/common/src/lib/collapsible/collapsible.component.html","./packages/common/src/lib/collapsible/collapsible.module.ts","./packages/common/src/lib/confirm-dialog/confirm-dialog.component.ts","./packages/common/src/lib/confirm-dialog/confirm-dialog.component.html","./packages/common/src/lib/confirm-dialog/confirm-dialog.service.ts","./packages/common/src/lib/confirm-dialog/confirm-dialog.module.ts","./packages/common/src/lib/context-menu/context-menu.directive.ts","./packages/common/src/lib/context-menu/long-press.directive.ts","./packages/common/src/lib/context-menu/context-menu.module.ts","./packages/common/src/lib/custom-html/custom-html.component.ts","./packages/common/src/lib/custom-html/custom-html.component.html","./packages/common/src/lib/custom-html/custom-html.module.ts","./packages/common/src/lib/dom/dom.service.ts","./packages/common/src/lib/dom/dom.module.ts","./packages/common/src/lib/drag-drop/drag-drop.module.ts","./packages/common/src/lib/dynamic-component/shared/dynamic-component.ts","./packages/common/src/lib/dynamic-component/shared/dynamic-component.service.ts","./packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.component.ts","./packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.component.html","./packages/common/src/lib/dynamic-component/dynamic-outlet/dynamic-outlet.module.ts","./packages/common/src/lib/dynamic-component/dynamic-component.module.ts","./packages/common/src/lib/flexible/flexible.module.ts","./packages/common/src/lib/form/form/form.component.ts","./packages/common/src/lib/form/shared/form.utils.ts","./packages/common/src/lib/form/form/form.component.html","./packages/common/src/lib/form/form/form.module.ts","./packages/common/src/lib/form/shared/form.service.ts","./packages/common/src/lib/form/shared/form-field.service.ts","./packages/common/src/lib/form/form-field/form-field.component.html","./packages/common/src/lib/form/form-field/form-field.component.ts","./packages/common/src/lib/form/form-field/form-field.module.ts","./packages/common/src/lib/form/form-group/form-group.component.html","./packages/common/src/lib/form/form-group/form-group.component.ts","./packages/common/src/lib/form/form-group/form-group.module.ts","./packages/common/src/lib/form/form.module.ts","./packages/common/src/lib/entity/entity-selector/entity-selector.module.ts","./packages/common/src/lib/stop-propagation/stop-propagation.module.ts","./packages/common/src/lib/entity/entity-table-paginator/entity-table-paginator.module.ts","./packages/common/src/lib/image/image.module.ts","./packages/common/src/lib/entity/entity-table/entity-table.module.ts","./packages/common/src/lib/entity/entity.module.ts","./packages/common/src/lib/interactive-tour/interactive-tour.loader.ts","./packages/common/src/lib/interactive-tour/interactive-tour.service.ts","./packages/common/src/lib/tool/shared/toolbox.ts","./packages/common/src/lib/tool/shared/tool.service.ts","./packages/common/src/lib/interactive-tour/interactive-tour.component.html","./packages/common/src/lib/interactive-tour/interactive-tour.component.ts","./packages/common/src/lib/interactive-tour/interactive-tour.module.ts","./packages/common/src/lib/keyvalue/keyvalue.pipe.ts","./packages/common/src/lib/keyvalue/keyvalue.module.ts","./packages/common/src/lib/list/list-item.directive.ts","./packages/common/src/lib/list/list.component.ts","./packages/common/src/lib/list/list.component.html","./packages/common/src/lib/list/list.module.ts","./packages/common/src/lib/panel/panel.component.html","./packages/common/src/lib/panel/panel.component.ts","./packages/common/src/lib/panel/panel.module.ts","./packages/common/src/lib/spinner/spinner.component.ts","./packages/common/src/lib/spinner/spinner.component.html","./packages/common/src/lib/spinner/spinner-activity.directive.ts","./packages/common/src/lib/spinner/spinner.module.ts","./packages/common/src/lib/table/table-datasource.ts","./packages/common/src/lib/table/table-action-color.enum.ts","./packages/common/src/lib/table/table.component.html","./packages/common/src/lib/table/table.component.ts","./packages/common/src/lib/table/table.module.ts","./packages/common/src/lib/action/shared/store.ts","./packages/common/src/lib/tool/shared/toolbox.enums.ts","./packages/common/src/lib/tool/toolbox/toolbox.animation.ts","./packages/common/src/lib/tool/toolbox/toolbox.component.html","./packages/common/src/lib/tool/toolbox/toolbox.component.ts","./packages/common/src/lib/tool/toolbox/toolbox.module.ts","./packages/common/src/lib/tool/tool.module.ts","./packages/common/src/lib/widget/widget-outlet/widget-outlet.component.html","./packages/common/src/lib/widget/widget-outlet/widget-outlet.component.ts","./packages/common/src/lib/widget/widget-outlet/widget-outlet.module.ts","./packages/common/src/lib/widget/shared/widget.service.ts","./packages/common/src/lib/widget/widget.module.ts","./packages/common/src/lib/workspace/workspace-selector/workspace-selector.component.ts","./packages/common/src/lib/workspace/workspace-selector/workspace-selector.component.html","./packages/common/src/lib/workspace/workspace-selector/workspace-selector.module.ts","./packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.component.html","./packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.component.ts","./packages/common/src/lib/workspace/workspace-widget-outlet/workspace-widget-outlet.module.ts","./packages/common/src/lib/workspace/workspace.module.ts","./packages/common/src/lib/table/table-database.ts","./packages/common/src/lib/tool/shared/tool-component.ts","./packages/common/src/lib/workspace/shared/store.ts","./packages/common/src/lib/workspace/shared/workspace.ts","./demo/src/app/core/home/home-routing.module.ts","./demo/src/app/core/home/home.component.ts","./demo/src/app/core/home/home.component.html","./demo/src/app/core/home/home.module.ts","./demo/src/app/core/activity/activity-routing.module.ts","./demo/src/app/core/activity/activity.component.ts","./demo/src/app/core/activity/activity.component.html","./demo/src/app/core/activity/activity.module.ts","./demo/src/environments/environment.prod.ts","./demo/src/app/core/config/config-routing.module.ts","./demo/src/app/core/config/config.component.ts","./demo/src/app/core/config/config.component.html","./demo/src/app/core/config/config.module.ts","./demo/src/app/core/language/language-routing.module.ts","./demo/src/app/core/language/language.component.ts","./demo/src/app/core/language/language.component.html","./demo/src/app/core/language/language.module.ts","./demo/src/app/core/media/media-routing.module.ts","./demo/src/app/core/media/media.component.ts","./demo/src/app/core/media/media.component.html","./demo/src/app/core/media/media.module.ts","./demo/src/app/core/message/message-routing.module.ts","./demo/src/app/core/message/message.component.ts","./demo/src/app/core/message/message.component.html","./demo/src/app/core/message/message.module.ts","./demo/src/app/core/request/request-routing.module.ts","./demo/src/app/core/request/request.component.ts","./demo/src/app/core/request/request.component.html","./demo/src/app/core/request/request.module.ts","./demo/src/app/common/action/action.component.html","./demo/src/app/common/action/action-routing.module.ts","./demo/src/app/common/action/action.component.ts","./demo/src/app/common/action/action.module.ts","./demo/src/app/common/dynamic-component/dynamic-component.component.ts","./demo/src/app/common/dynamic-component/dynamic-component-routing.module.ts","./demo/src/app/common/dynamic-component/dynamic-component.component.html","./demo/src/app/common/dynamic-component/dynamic-component.module.ts","./demo/src/app/common/entity-table/entity-table-routing.module.ts","./demo/src/app/common/entity-table/entity-table.component.ts","./demo/src/app/common/entity-table/entity-table.component.html","./demo/src/app/common/entity-table/entity-table.module.ts","./demo/src/app/common/entity-selector/entity-selector.component.html","./demo/src/app/common/entity-selector/entity-selector-routing.module.ts","./demo/src/app/common/entity-selector/entity-selector.component.ts","./demo/src/app/common/entity-selector/entity-selector.module.ts","./demo/src/app/common/form/form.component.html","./demo/src/app/common/form/form-routing.module.ts","./demo/src/app/common/form/form.component.ts","./demo/src/app/common/form/form.module.ts","./demo/src/app/common/table/table-routing.module.ts","./demo/src/app/common/table/table.component.ts","./demo/src/app/common/table/table.component.html","./demo/src/app/common/table/table.module.ts","./demo/src/app/common/tool/tool.component.html","./demo/src/app/common/tool/tool.component.ts","./demo/src/app/common/tool/tool-routing.module.ts","./demo/src/app/common/tool/tool.module.ts","./demo/src/app/common/widget/widget.component.ts","./demo/src/app/common/widget/widget-routing.module.ts","./demo/src/app/common/widget/widget.component.html","./demo/src/app/common/widget/widget.module.ts","./packages/auth/src/lib/shared/token.service.ts","./packages/auth/src/lib/shared/auth.service.ts","./packages/auth/src/lib/auth-form/auth-google.component.ts","./packages/auth/src/lib/auth-form/auth-google.component.html","./packages/auth/src/lib/auth-form/auth-intern.component.html","./packages/auth/src/lib/auth-form/auth-intern.component.ts","./packages/auth/src/lib/auth-form/auth-facebook.component.ts","./packages/auth/src/lib/auth-form/auth-facebook.component.html","./packages/auth/src/lib/auth-form/auth-microsoft.component.ts","./packages/auth/src/lib/auth-form/auth-microsoft.component.html","./packages/auth/src/lib/shared/auth-msalServiceb2c.service..ts","./packages/auth/src/lib/shared/auth-msalBroadcastServiceb2c.service.ts","./packages/auth/src/lib/auth-form/auth-microsoftb2c.component.ts","./packages/auth/src/lib/auth-form/auth-microsoftb2c.component.html","./packages/auth/src/lib/auth-form/auth-form.component.html","./packages/auth/src/lib/auth-form/auth-form.component.ts","./packages/auth/src/lib/shared/auth.interceptor.ts","./packages/auth/src/lib/shared/auth-microsoft.provider.ts","./packages/auth/src/lib/shared/storage.service.ts","./packages/auth/src/lib/auth.module.ts","./demo/src/app/auth/auth-form/auth-form-routing.module.ts","./demo/src/app/auth/auth-form/auth-form.component.ts","./demo/src/app/auth/auth-form/auth-form.component.html","./demo/src/app/auth/auth-form/auth-form.module.ts","./packages/geo/src/lib/metadata/shared/metadata.service.ts","./packages/geo/src/lib/metadata/metadata-button/metadata-button.component.html","./packages/geo/src/lib/metadata/metadata-button/metadata-abstract.component.html","./packages/geo/src/lib/metadata/metadata-button/metadata-button.component.ts","./packages/geo/src/lib/metadata/metadata.module.ts","./packages/geo/src/lib/feature/shared/feature.enums.ts","./packages/geo/src/lib/layer/utils/image-watcher.ts","./packages/geo/src/lib/layer/utils/layer.utils.ts","./packages/geo/src/lib/layer/utils/tile-watcher.ts","./packages/geo/src/lib/utils/id-generator.ts","./packages/geo/src/lib/datasource/shared/datasources/datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/feature-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/cluster-datasource.ts","./packages/geo/src/lib/layer/utils/vector-watcher.ts","./packages/geo/src/lib/map/shared/map.utils.ts","./packages/geo/src/lib/layer/shared/layers/layer.ts","./packages/geo/src/lib/filter/shared/ogc-filter.enum.ts","./packages/geo/src/lib/filter/shared/ogc-filter.ts","./packages/geo/src/lib/datasource/shared/datasources/wms-wfs.utils.ts","./packages/geo/src/lib/layer/shared/layers/vector-layer.ts","./packages/geo/src/lib/datasource/shared/datasources/data.service.ts","./packages/geo/src/lib/datasource/shared/datasources/osm-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/xyz-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/wfs-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/wfs.service.ts","./packages/geo/src/lib/query/shared/query.enums.ts","./packages/geo/src/lib/datasource/shared/datasources/wms-datasource.ts","./packages/geo/src/lib/datasource/utils/tilegrid.ts","./packages/geo/src/lib/datasource/shared/datasources/wmts-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/carto-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/arcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/imagearcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/tilearcgisrest-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/tiledebug-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/websocket-datasource.ts","./packages/geo/src/lib/datasource/shared/datasources/mvt-datasource.ts","./packages/geo/src/lib/datasource/utils/esri-style-generator.ts","./packages/geo/src/lib/filter/shared/time-filter.enum.ts","./packages/geo/src/lib/map/shared/map.service.ts","./packages/geo/src/lib/datasource/shared/capabilities.service.ts","./packages/geo/src/lib/datasource/shared/options/options.service.ts","./packages/geo/src/lib/map/shared/projection.service.ts","./packages/geo/src/lib/datasource/shared/datasource.service.ts","./packages/geo/src/lib/feature/shared/feature.utils.ts","./packages/geo/src/lib/feature/shared/store.ts","./packages/geo/src/lib/feature/shared/strategies/in-map-extent.ts","./packages/geo/src/lib/feature/shared/strategies/in-map-resolution.ts","./packages/geo/src/lib/feature/shared/strategies/loading.ts","./packages/geo/src/lib/feature/shared/strategies/loading-layer.ts","./packages/geo/src/lib/feature/shared/strategies/selection.ts","./packages/geo/src/lib/feature/shared/strategies.utils.ts","./packages/geo/src/lib/overlay/shared/overlay-marker-style.utils.ts","./packages/geo/src/lib/layer/shared/style.service.ts","./packages/geo/src/lib/overlay/shared/overlay.utils.ts","./packages/geo/src/lib/overlay/shared/overlay.ts","./packages/geo/src/lib/layer/shared/layers/layer.interface.ts","./packages/geo/src/lib/layer/shared/layers/image-layer.ts","./packages/geo/src/lib/layer/shared/layers/tile-layer.ts","./packages/geo/src/lib/layer/shared/layers/vectortile-layer.ts","./packages/geo/src/lib/map/utils/layer-watcher.ts","./packages/geo/src/lib/map/shared/map.enums.ts","./packages/geo/src/lib/map/shared/controllers/controller.ts","./packages/geo/src/lib/map/shared/controllers/view.ts","./packages/geo/src/lib/map/shared/controllers/geolocation.ts","./packages/geo/src/lib/map/shared/linkedLayers.utils.ts","./packages/geo/src/lib/map/shared/map.ts","./packages/geo/src/lib/map/map-browser/map-browser.component.ts","./packages/geo/src/lib/map/map-browser/map-browser.component.html","./packages/geo/src/lib/map/shared/map-pointer-position.directive.ts","./packages/geo/src/lib/map/shared/hover-feature.directive.ts","./packages/geo/src/lib/map/zoom-button/zoom-button.component.ts","./packages/geo/src/lib/map/zoom-button/zoom-button.component.html","./packages/geo/src/lib/map/geolocate-button/geolocate-button.component.html","./packages/geo/src/lib/map/geolocate-button/geolocate-button.component.ts","./packages/geo/src/lib/map/home-extent-button/home-extent-button.component.ts","./packages/geo/src/lib/map/home-extent-button/home-extent-button.component.html","./packages/geo/src/lib/map/wake-lock-button/wake-lock-button.component.html","./packages/geo/src/lib/map/wake-lock-button/wake-lock-button.component.ts","./packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.html","./packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.component.ts","./packages/geo/src/lib/map/baselayers-switcher/baselayers-switcher.animation.ts","./packages/geo/src/lib/offline/geoDB/geoDB.service.ts","./packages/geo/src/lib/offline/shared/geo-network.service.ts","./packages/geo/src/lib/layer/shared/layer.service.ts","./packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.html","./packages/geo/src/lib/map/baselayers-switcher/mini-basemap.component.ts","./packages/geo/src/lib/map/rotation-button/rotation-button.component.html","./packages/geo/src/lib/map/rotation-button/rotation-button.component.ts","./packages/geo/src/lib/map/info-section/info-section.component.html","./packages/geo/src/lib/map/info-section/info-section.component.ts","./packages/geo/src/lib/catalog/shared/catalog.enum.ts","./packages/geo/src/lib/catalog/shared/catalog.abstract.ts","./packages/geo/src/lib/query/shared/query.service.ts","./packages/geo/src/lib/query/shared/query.utils.ts","./packages/geo/src/lib/query/shared/query.directive.ts","./packages/geo/src/lib/search/shared/sources/source.ts","./packages/geo/src/lib/query/shared/query-search-source.ts","./packages/geo/src/lib/utils/googleLinks.ts","./packages/geo/src/lib/utils/commonVectorStyle.ts","./packages/geo/src/lib/utils/osmLinks.ts","./packages/geo/src/lib/catalog/shared/catalog.service.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.component.ts","./packages/geo/src/lib/layer/layer-legend/layer-legend.component.html","./packages/geo/src/lib/layer/layer-legend/layer-legend.component.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-layer.component.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.html","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser-group.component.ts","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.service.ts","./packages/geo/src/lib/layer/layer-item/layer-item.component.html","./packages/geo/src/lib/layer/layer-item/layer-item.component.ts","./packages/geo/src/lib/layer/layer-list/layer-list.enum.ts","./packages/geo/src/lib/layer/layer-list/layer-list.component.html","./packages/geo/src/lib/layer/layer-list/layer-list.component.ts","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.html","./packages/geo/src/lib/layer/layer-list-tool/layer-list-tool.component.ts","./packages/geo/src/lib/layer/layer-list/layer-list-binding.directive.ts","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.html","./packages/geo/src/lib/layer/layer-legend-list/layer-legend-list.component.ts","./packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.html","./packages/geo/src/lib/layer/track-feature-button/track-feature-button.component.ts","./packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.ts","./packages/geo/src/lib/layer/layer-legend-item/layer-legend-item.component.html","./packages/geo/src/lib/draw/shared/draw.enum.ts","./packages/geo/src/lib/draw/shared/draw-icon.service.ts","./packages/geo/src/lib/measure/shared/measure.enum.ts","./packages/geo/src/lib/measure/shared/measure.utils.ts","./packages/geo/src/lib/draw/shared/draw.utils.ts","./packages/geo/src/lib/draw/shared/draw-style.service.ts","./packages/geo/src/lib/feature/feature-details/feature-details.component.html","./packages/geo/src/lib/feature/feature-details/feature-details.component.ts","./packages/geo/src/lib/geometry/shared/geometry.utils.ts","./packages/geo/src/lib/geometry/shared/geometry.errors.ts","./packages/geo/src/lib/geometry/shared/controls/draw.ts","./packages/geo/src/lib/draw/draw/draw-popup.component.html","./packages/geo/src/lib/draw/draw/draw-popup.component.ts","./packages/geo/src/lib/draw/draw/draw-shorcuts.component.ts","./packages/geo/src/lib/draw/draw/draw-shorcuts.component.html","./packages/geo/src/lib/draw/draw/draw-layer-popup.component.ts","./packages/geo/src/lib/draw/draw/draw-layer-popup.component.html","./packages/geo/src/lib/draw/draw/draw.component.html","./packages/geo/src/lib/draw/draw/draw.component.ts","./packages/geo/src/lib/layer/style-modal/style-modal.component.html","./packages/geo/src/lib/layer/style-modal/style-modal.component.ts","./packages/geo/src/lib/layer/layer.module.ts","./packages/geo/src/lib/catalog/catalog-browser/catalog-browser.module.ts","./packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.html","./packages/geo/src/lib/catalog/catalog-library/add-catalog-dialog.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library.component.html","./packages/geo/src/lib/catalog/catalog-library/catalog-library.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.html","./packages/geo/src/lib/catalog/catalog-library/catalog-library-item.component.ts","./packages/geo/src/lib/catalog/catalog-library/catalog-library.module.ts","./packages/geo/src/lib/catalog/catalog.module.ts","./packages/geo/src/lib/filter/shared/filterable-datasource.pipe.ts","./packages/geo/src/lib/filter/shared/time-filter.service.ts","./packages/geo/src/lib/filter/shared/ogc-filter.service.ts","./packages/geo/src/lib/filter/shared/spatial-filter.enum.ts","./packages/geo/src/lib/filter/shared/spatial-filter.service.ts","./packages/geo/src/lib/download/shared/download.service.ts","./packages/geo/src/lib/download/download-button/download-button.component.html","./packages/geo/src/lib/download/download-button/download-button.component.ts","./packages/geo/src/lib/download/download.module.ts","./packages/geo/src/lib/draw/draw/draw.module.ts","./packages/geo/src/lib/feature/feature-details/feature-details.module.ts","./packages/geo/src/lib/feature/feature-form/feature-form.module.ts","./packages/geo/src/lib/feature/feature.module.ts","./packages/geo/src/lib/geometry/shared/controls/modify.ts","./packages/geo/src/lib/layer/shared/layer.enums.ts","./packages/geo/src/lib/measure/measurer/measurer-dialog.component.html","./packages/geo/src/lib/measure/measurer/measurer-dialog.component.ts","./packages/geo/src/lib/measure/measurer/measurer.component.html","./packages/geo/src/lib/measure/measurer/measurer.component.ts","./packages/geo/src/lib/measure/measurer/measure-format.pipe.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.ts","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field-input.component.html","./packages/geo/src/lib/geometry/geometry-form-field/geometry-form-field.module.ts","./packages/geo/src/lib/geometry/geometry.module.ts","./packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.html","./packages/geo/src/lib/filter/time-filter-button/time-filter-button.component.ts","./packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.html","./packages/geo/src/lib/filter/time-filter-form/time-filter-form.component.ts","./packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.html","./packages/geo/src/lib/filter/time-filter-item/time-filter-item.component.ts","./packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.html","./packages/geo/src/lib/filter/time-filter-list/time-filter-list.component.ts","./packages/geo/src/lib/wkt/shared/wkt.service.ts","./packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.html","./packages/geo/src/lib/filter/ogc-filter-form/ogc-filter-form.component.ts","./packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.html","./packages/geo/src/lib/filter/ogc-filterable-form/ogc-filterable-form.component.ts","./packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.html","./packages/geo/src/lib/filter/ogc-filterable-item/ogc-filterable-item.component.ts","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.html","./packages/geo/src/lib/filter/ogc-filterable-list/ogc-filterable-list.component.ts","./packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.html","./packages/geo/src/lib/filter/ogc-filter-button/ogc-filter-button.component.ts","./packages/geo/src/lib/filter/shared/ogc-filter-time.service.ts","./packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.html","./packages/geo/src/lib/filter/ogc-filter-selection/ogc-filter-selection.component.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-type/spatial-filter-type.component.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-list/spatial-filter-list.component.ts","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.html","./packages/geo/src/lib/filter/spatial-filter/spatial-filter-item/spatial-filter-item.component.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.html","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time.component.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.ts","./packages/geo/src/lib/filter/ogc-filter-time/ogc-filter-time-slider.component.html","./packages/geo/src/lib/filter/filter.module.ts","./packages/geo/src/lib/import-export/shared/export.errors.ts","./packages/geo/src/lib/import-export/shared/export.type.ts","./packages/geo/src/lib/import-export/shared/export.service.ts","./packages/utils/src/lib/file.ts","./packages/geo/src/lib/import-export/shared/import.utils.ts","./packages/geo/src/lib/import-export/shared/import.errors.ts","./packages/geo/src/lib/import-export/shared/import.service.ts","./packages/geo/src/lib/import-export/style-list/style-list.service.ts","./packages/geo/src/lib/import-export/import-export/import-export.component.html","./packages/geo/src/lib/import-export/import-export/import-export.component.ts","./packages/geo/src/lib/map/shared/projection.utils.ts","./packages/geo/src/lib/import-export/shared/export.utils.ts","./packages/geo/src/lib/import-export/style-list/style-list.provider.ts","./packages/geo/src/lib/import-export/style-list/style-list.module.ts","./packages/geo/src/lib/import-export/import-export.module.ts","./packages/geo/src/lib/map/map.module.ts","./packages/geo/src/lib/measure/measurer/measurer-item.component.html","./packages/geo/src/lib/measure/measurer/measurer-item.component.ts","./packages/geo/src/lib/measure/measurer/measurer.module.ts","./packages/geo/src/lib/measure/measure.module.ts","./packages/geo/src/lib/overlay/shared/overlay.enum.ts","./packages/geo/src/lib/overlay/shared/overlay.service.ts","./packages/geo/src/lib/overlay/shared/overlay.directive.ts","./packages/geo/src/lib/overlay/overlay.module.ts","./packages/geo/src/lib/print/shared/geopdf.ts","./packages/geo/src/lib/print/shared/print.service.ts","./packages/geo/src/lib/layer/utils/outputLegend.ts","./packages/geo/src/lib/print/shared/print.type.ts","./packages/geo/src/lib/print/print-form/print-form.component.html","./packages/geo/src/lib/print/print-form/print-form.component.ts","./packages/geo/src/lib/print/print/print.component.ts","./packages/geo/src/lib/print/print/print.component.html","./packages/geo/src/lib/print/print.module.ts","./packages/geo/src/lib/query/shared/query-search-source.providers.ts","./packages/geo/src/lib/query/query.module.ts","./packages/geo/src/lib/directions/directions-sources/directions-source.ts","./packages/geo/src/lib/directions/shared/directions-source.service.ts","./packages/geo/src/lib/directions/shared/directions.enum.ts","./packages/geo/src/lib/directions/shared/directions.utils.ts","./packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.html","./packages/geo/src/lib/directions/directions-inputs/directions-inputs.component.ts","./packages/geo/src/lib/directions/shared/directions.service.ts","./packages/geo/src/lib/search/shared/search.utils.ts","./packages/geo/src/lib/search/shared/search-source.service.ts","./packages/geo/src/lib/search/shared/search.service.ts","./packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.html","./packages/geo/src/lib/directions/directions-buttons/directions-buttons.component.ts","./packages/geo/src/lib/directions/directions-results/directions-results.component.html","./packages/geo/src/lib/directions/directions-results/directions-results.component.ts","./packages/geo/src/lib/directions/directions.component.ts","./packages/geo/src/lib/directions/directions.component.html","./packages/geo/src/lib/directions/directions.module.ts","./packages/geo/src/lib/search/shared/search-source-service.providers.ts","./packages/geo/src/lib/search/shared/sources/icherche.ts","./packages/geo/src/lib/search/shared/sources/icherche.providers.ts","./packages/geo/src/lib/search/shared/sources/coordinates.ts","./packages/geo/src/lib/search/shared/sources/coordinates.providers.ts","./packages/geo/src/lib/search/shared/sources/ilayer.ts","./packages/geo/src/lib/search/shared/sources/ilayer.providers.ts","./packages/geo/src/lib/search/shared/search.enums.ts","./packages/geo/src/lib/search/search-selector/search-selector.component.html","./packages/geo/src/lib/search/search-selector/search-selector.component.ts","./packages/geo/src/lib/search/search-selector/search-selector.module.ts","./packages/geo/src/lib/search/search-settings/search-settings.component.html","./packages/geo/src/lib/search/search-settings/search-settings.component.ts","./packages/geo/src/lib/search/search-settings/search-settings.module.ts","./packages/geo/src/lib/search/search-bar/search-bar.component.html","./packages/geo/src/lib/search/search-bar/search-bar.component.ts","./packages/geo/src/lib/search/search-bar/search-bar.module.ts","./packages/geo/src/lib/search/search-results/search-results-item.component.html","./packages/geo/src/lib/search/search-results/search-results-item.component.ts","./packages/geo/src/lib/search/search-results/search-results.component.html","./packages/geo/src/lib/search/search-results/search-results.component.ts","./packages/geo/src/lib/search/search-results/save-feature-dialog.component.html","./packages/geo/src/lib/search/search-results/save-feature-dialog.component.ts","./packages/geo/src/lib/search/search-results/search-results-add-button.component.html","./packages/geo/src/lib/search/search-results/search-results-add-button.component.ts","./packages/geo/src/lib/search/search-results/search-results.module.ts","./packages/geo/src/lib/search/shared/search-pointer-summary.directive.ts","./packages/geo/src/lib/search/search.module.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.component.html","./packages/geo/src/lib/workspace/widgets/widgets.ts","./packages/geo/src/lib/workspace/widgets/ogc-filter/ogc-filter.module.ts","./packages/geo/src/lib/workspace/shared/wfs-workspace.ts","./packages/geo/src/lib/workspace/shared/wfs-workspace.service.ts","./packages/geo/src/lib/workspace/shared/wms-workspace.service.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.component.html","./packages/geo/src/lib/workspace/shared/edition-workspace.ts","./packages/geo/src/lib/workspace/shared/edition-workspace.service.ts","./packages/geo/src/lib/workspace/shared/feature-workspace.ts","./packages/geo/src/lib/workspace/shared/feature-workspace.service.ts","./packages/geo/src/lib/workspace/workspace-selector/workspace-selector.directive.ts","./packages/geo/src/lib/workspace/workspace-selector/workspace-selector.module.ts","./packages/geo/src/lib/workspace/workspace-updator/workspace-updator.module.ts","./packages/geo/src/lib/workspace/confirmation-popup/confirmation-popup.module.ts","./packages/geo/src/lib/workspace/workspace.module.ts","./packages/geo/src/lib/directions/shared/store.ts","./packages/geo/src/lib/directions/directions-sources/osrm-directions-source.ts","./packages/geo/src/lib/directions/directions-sources/directions-source.provider.ts","./packages/geo/src/lib/search/shared/sources/nominatim.ts","./packages/geo/src/lib/search/shared/sources/nominatim.providers.ts","./packages/geo/src/lib/search/shared/sources/storedqueries.ts","./packages/geo/src/lib/search/shared/sources/storedqueries.providers.ts","./packages/geo/src/lib/workspace/shared/workspace.utils.ts","./demo/src/app/geo/simple-map/simple-map.component.html","./demo/src/app/geo/simple-map/simple-map-routing.module.ts","./demo/src/app/geo/simple-map/simple-map.component.ts","./demo/src/app/geo/simple-map/simple-map.module.ts","./demo/src/app/geo/layer/layer.component.html","./demo/src/app/geo/layer/layer-routing.module.ts","./demo/src/app/geo/layer/layer.component.ts","./demo/src/app/geo/layer/layer.module.ts","./demo/src/app/geo/legend/legend-routing.module.ts","./demo/src/app/geo/legend/legend.component.ts","./demo/src/app/geo/legend/legend.component.html","./demo/src/app/geo/legend/legend.module.ts","./demo/src/app/geo/overlay/overlay-routing.module.ts","./demo/src/app/geo/overlay/overlay.component.ts","./demo/src/app/geo/overlay/overlay.component.html","./demo/src/app/geo/overlay/overlay.module.ts","./demo/src/app/geo/geometry/geometry.component.html","./demo/src/app/geo/geometry/geometry-routing.module.ts","./demo/src/app/geo/geometry/geometry.component.ts","./demo/src/app/geo/geometry/geometry.module.ts","./demo/src/app/geo/feature/feature-routing.module.ts","./demo/src/app/geo/feature/feature.component.ts","./demo/src/app/geo/feature/feature.component.html","./demo/src/app/geo/feature/feature.module.ts","./demo/src/app/geo/hover/hover-routing.module.ts","./demo/src/app/geo/hover/hover.component.ts","./demo/src/app/geo/hover/hover.component.html","./demo/src/app/geo/hover/hover.module.ts","./demo/src/app/geo/measure/measure-routing.module.ts","./demo/src/app/geo/measure/measure.component.ts","./demo/src/app/geo/measure/measure.component.html","./demo/src/app/geo/measure/measure.module.ts","./demo/src/app/geo/draw/draw-routing.module.ts","./demo/src/app/geo/draw/draw.component.ts","./demo/src/app/geo/draw/draw.component.html","./demo/src/app/geo/draw/draw.module.ts","./demo/src/app/geo/query/query.component.html","./demo/src/app/geo/query/query-routing.module.ts","./demo/src/app/geo/query/query.component.ts","./demo/src/app/geo/query/query.module.ts","./demo/src/app/geo/catalog/catalog-routing.module.ts","./demo/src/app/geo/catalog/catalog.component.ts","./demo/src/app/geo/catalog/catalog.component.html","./demo/src/app/geo/catalog/catalog.module.ts","./packages/context/src/lib/context-import-export/shared/context-export.errors.ts","./packages/context/src/lib/context-import-export/shared/context-import.errors.ts","./packages/context/src/lib/context-manager/shared/context.enum.ts","./packages/context/src/lib/context-manager/shared/context.service.ts","./packages/context/src/lib/context-import-export/context-import-export.module.ts","./packages/context/src/lib/context-manager/shared/map-context.directive.ts","./packages/context/src/lib/context-manager/shared/layer-context.directive.ts","./packages/context/src/lib/context-import-export/shared/context-import.utils.ts","./packages/context/src/lib/context-manager/context-list/context-list.enum.ts","./packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.ts","./packages/context/src/lib/context-map-button/bookmark-button/bookmark-dialog.component.html","./packages/context/src/lib/context-manager/context-item/context-item.component.html","./packages/context/src/lib/context-manager/context-item/context-item.component.ts","./packages/context/src/lib/context-manager/context-list/context-list.component.html","./packages/context/src/lib/context-manager/context-list/context-list.component.ts","./packages/context/src/lib/context-manager/context-list/context-list-binding.directive.ts","./packages/context/src/lib/context-map-button/poi-button/shared/poi.service.ts","./packages/context/src/lib/context-map-button/context-map-button.module.ts","./packages/context/src/lib/context-manager/context-manager.module.ts","./packages/integration/src/lib/import-export/import-export.state.ts","./packages/integration/src/lib/tool/tool.state.ts","./packages/integration/src/lib/workspace/shared/workspace.utils.ts","./packages/integration/src/lib/storage/storage.state.ts","./packages/integration/src/lib/workspace/shared/feature-actions.service.ts","./packages/integration/src/lib/workspace/shared/wfs-actions.service.ts","./packages/integration/src/lib/workspace/shared/edition-actions.service.ts","./packages/integration/src/lib/workspace/workspace.state.ts","./packages/integration/src/lib/search/search.state.ts","./packages/integration/src/lib/search/search-bar/search-bar.module.ts","./packages/integration/src/lib/search/search-results-tool/search-results-tool.module.ts","./packages/integration/src/lib/search/search.module.ts","./demo/src/app/geo/search/search.component.html","./demo/src/app/geo/search/search-routing.module.ts","./demo/src/app/geo/search/search.component.ts","./demo/src/app/geo/search/search.module.ts","./demo/src/app/geo/print/print-routing.module.ts","./demo/src/app/geo/print/print.component.ts","./demo/src/app/geo/print/print.component.html","./demo/src/app/geo/print/print.module.ts","./demo/src/app/geo/import-export/import-export-routing.module.ts","./demo/src/app/geo/import-export/import-export.component.ts","./demo/src/app/geo/import-export/import-export.component.html","./demo/src/app/geo/import-export/import-export.module.ts","./demo/src/app/geo/directions/directions-routing.module.ts","./demo/src/app/geo/directions/directions.component.ts","./demo/src/app/geo/directions/directions.component.html","./demo/src/app/geo/directions/directions.module.ts","./demo/src/app/geo/time-filter/time-filter-routing.module.ts","./demo/src/app/geo/time-filter/time-filter.component.ts","./demo/src/app/geo/time-filter/time-filter.component.html","./demo/src/app/geo/time-filter/time-filter.module.ts","./demo/src/app/geo/ogc-filter/ogc-filter-routing.module.ts","./demo/src/app/geo/ogc-filter/ogc-filter.component.ts","./demo/src/app/geo/ogc-filter/ogc-filter.component.html","./demo/src/app/geo/ogc-filter/ogc-filter.module.ts","./demo/src/app/geo/spatial-filter/spatial-filter.component.html","./demo/src/app/geo/spatial-filter/spatial-filter-routing.module.ts","./demo/src/app/geo/spatial-filter/spatial-filter.component.ts","./demo/src/app/geo/spatial-filter/spatial-filter.module.ts","./demo/src/app/geo/workspace/workspace.component.html","./demo/src/app/geo/workspace/workspace-routing.module.ts","./demo/src/app/geo/workspace/workspace.component.ts","./demo/src/app/geo/workspace/workspace.module.ts","./demo/src/app/context/context/context.component.html","./demo/src/app/context/context/context-routing.module.ts","./demo/src/app/context/context/context.component.ts","./demo/src/app/context/context/context.module.ts","./demo/src/app/app-routing.module.ts","./demo/src/app/app.component.ts","./demo/src/app/app.component.html","./demo/src/app/app.module.ts","./demo/src/main.ts","./node_modules/moment/locale/ sync ^\\.\\/.*$"],"sourcesContent":["/* eslint-disable */\n\nconst ALPHA =\n  'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\nexport class Base64 {\n  private static PADCHAR: string = '=';\n  private static ALPHA: string = ALPHA;\n\n  private static getByte(s: string, i: number): number {\n    const x = s.charCodeAt(i);\n    return x;\n  }\n\n  private static getByte64(s: string, i: number): number {\n    const idx = this.ALPHA.indexOf(s.charAt(i));\n    return idx;\n  }\n\n  public static decode(s: string): string {\n    let pads = 0,\n      i,\n      b10,\n      imax = s.length,\n      x = [];\n\n    s = String(s);\n\n    if (imax === 0) {\n      return s;\n    }\n\n    if (s.charAt(imax - 1) === this.PADCHAR) {\n      pads = 1;\n      if (s.charAt(imax - 2) === this.PADCHAR) {\n        pads = 2;\n      }\n      imax -= 4;\n    }\n\n    for (i = 0; i < imax; i += 4) {\n      b10 =\n        (this.getByte64(s, i) << 18) |\n        (this.getByte64(s, i + 1) << 12) |\n        (this.getByte64(s, i + 2) << 6) |\n        this.getByte64(s, i + 3);\n      x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255, b10 & 255));\n    }\n\n    switch (pads) {\n      case 1:\n        b10 =\n          (this.getByte64(s, i) << 18) |\n          (this.getByte64(s, i + 1) << 12) |\n          (this.getByte64(s, i + 2) << 6);\n        x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 255));\n        break;\n      case 2:\n        b10 = (this.getByte64(s, i) << 18) | (this.getByte64(s, i + 1) << 12);\n        x.push(String.fromCharCode(b10 >> 16));\n        break;\n    }\n\n    return x.join('');\n  }\n\n  public static encode(s: string): string {\n    s = String(s);\n\n    let i,\n      b10,\n      x = [],\n      imax = s.length - s.length % 3;\n\n    if (s.length === 0) {\n      return s;\n    }\n\n    for (i = 0; i < imax; i += 3) {\n      b10 =\n        (this.getByte(s, i) << 16) |\n        (this.getByte(s, i + 1) << 8) |\n        this.getByte(s, i + 2);\n      x.push(this.ALPHA.charAt(b10 >> 18));\n      x.push(this.ALPHA.charAt((b10 >> 12) & 63));\n      x.push(this.ALPHA.charAt((b10 >> 6) & 63));\n      x.push(this.ALPHA.charAt(b10 & 63));\n    }\n\n    switch (s.length - imax) {\n      case 1:\n        b10 = this.getByte(s, i) << 16;\n        x.push(\n          this.ALPHA.charAt(b10 >> 18) +\n            this.ALPHA.charAt((b10 >> 12) & 63) +\n            this.PADCHAR +\n            this.PADCHAR\n        );\n        break;\n      case 2:\n        b10 = (this.getByte(s, i) << 16) | (this.getByte(s, i + 1) << 8);\n        x.push(\n          this.ALPHA.charAt(b10 >> 18) +\n            this.ALPHA.charAt((b10 >> 12) & 63) +\n            this.ALPHA.charAt((b10 >> 6) & 63) +\n            this.PADCHAR\n        );\n        break;\n    }\n\n    return x.join('');\n  }\n}\n","import * as Bowser from 'bowser';\n\nexport interface UserAgent extends Bowser.Parser.Parser {\n  compareVersion: (version: string) => boolean;\n}\n\nexport const userAgent = Bowser.getParser(\n  window.navigator.userAgent\n) as UserAgent;\n","import { userAgent } from './user-agent';\n\nexport class Clipboard {\n  static copy(element: HTMLTextAreaElement | string): boolean {\n    let successful = false;\n    if (typeof element === 'string') {\n      const textArea = Clipboard.createTextArea(element);\n      Clipboard.selectText(textArea);\n      successful = Clipboard.copyTextToClipboard();\n      Clipboard.destroyTextArea(textArea);\n    } else {\n      Clipboard.selectText(element);\n      successful = Clipboard.copyTextToClipboard();\n    }\n    return successful;\n  }\n\n  private static createTextArea(text: string): HTMLTextAreaElement {\n    const textArea = document.createElement('textArea') as HTMLTextAreaElement;\n    textArea.value = text;\n    document.body.appendChild(textArea);\n    return textArea;\n  }\n\n  private static destroyTextArea(textArea) {\n    document.body.removeChild(textArea);\n  }\n\n  private static selectText(textArea) {\n    if (userAgent.getOSName() === 'iOS') {\n      const oldContentEditable = textArea.contentEditable;\n      const oldReadOnly = textArea.readOnly;\n      const range = document.createRange();\n      const selection = window.getSelection();\n\n      textArea.contenteditable = true;\n      textArea.readonly = false;\n      range.selectNodeContents(textArea);\n      selection.removeAllRanges();\n      selection.addRange(range);\n      textArea.setSelectionRange(0, 999999);\n      textArea.contentEditable = oldContentEditable;\n      textArea.readOnly = oldReadOnly;\n    } else {\n      textArea.select();\n    }\n  }\n\n  private static copyTextToClipboard(): boolean {\n    if (!(userAgent.getOSName() === 'iOS' && userAgent.compareVersion('<10'))) {\n      return document.execCommand('copy');\n    }\n    return false;\n  }\n}\n","export class StringUtils {\n  static diff(s1: string, s2: string, p = 4): string {\n    if (!s1 && !s2) {\n      return '';\n    }\n    if (!s1) {\n      return '<span class=\"inserted\">' + s2 + '</span>';\n    }\n    if (!s2) {\n      return '<span class=\"deleted\">' + s1 + '</span>';\n    }\n    s1 = s1.toString();\n    s2 = s2.toString();\n    const changeData = StringUtils.getChanges(s1, s2, '', p);\n    const nextS = s2.slice(\n      changeData.mtc.length + changeData.ins.length + changeData.sbs.length\n    ); // remaining part of \"s\"\n    const nextThis = s1.slice(\n      changeData.mtc.length + changeData.del.length + changeData.sbs.length\n    ); // remaining part of \"this\"\n    let result = ''; // the glorious result\n    if (changeData.del.length > 0) {\n      changeData.del = '<span class=\"deleted\">' + changeData.del + '</span>';\n    }\n    if (changeData.ins.length > 0) {\n      changeData.ins = '<span class=\"inserted\">' + changeData.ins + '</span>';\n    }\n    result = changeData.mtc + changeData.del + changeData.ins + changeData.sbs;\n    result +=\n      nextThis !== '' || nextS !== ''\n        ? StringUtils.diff(nextThis, nextS, p)\n        : '';\n    return result;\n  }\n\n  private static getMatchingSubstring(s, l, m) {\n    // returns the first matching substring in-between the two strings\n    let i = 0;\n    let match = false;\n    const slen = s.length;\n    const o = { fis: slen, mtc: m, sbs: '' }; // temporary object used to construct the cd (change data) object\n\n    while (i < slen) {\n      l[i] === s[i]\n        ? match\n          ? (o.sbs += s[i]) // o.sbs holds the matching substring itsef\n          : ((match = true), (o.fis = i), (o.sbs = s[i]))\n        : match\n          ? (i = slen) // stop after the first found substring\n          : (i = i);\n      ++i;\n    }\n    return o;\n  }\n\n  private static getChanges(s1, s2, m, p) {\n    const isThisLonger = s1.length >= s1.length ? true : false;\n    let [longer, shorter] = isThisLonger ? [s1, s2] : [s2, s1]; // assignment of longer and shorter by es6 destructuring\n    let bi = 0; // base index designating the index of first mismacthing character in both strings\n\n    while (shorter[bi] === longer[bi] && bi < shorter.length) {\n      ++bi;\n    } // make bi the index of first mismatching character\n    longer = longer.split('').slice(bi); // as the longer string will be rotated it is converted into array\n    shorter = shorter.slice(bi); // shorter and longer now starts from the first mismatching character\n\n    const len = longer.length; // length of the longer string\n    let cd: any = {\n      fis: shorter.length, // the index of matching string in the shorter string\n      fil: len, // the index of matching string in the longer string\n      sbs: '', // the matching substring itself\n      mtc: m + s2.slice(0, bi)\n    }; // if exists mtc holds the matching string at the front\n    let sub: any = { sbs: '' }; // returned substring per 1 character rotation of the longer string\n\n    if (shorter !== '') {\n      for (let rc = 0; rc < len && sub.sbs.length < p; rc++) {\n        // rc -> rotate count, p -> precision factor\n        sub = StringUtils.getMatchingSubstring(\n          shorter,\n          StringUtils.rotateArray(longer, rc),\n          cd.mtc\n        ); // rotate longer string 1 char and get substring\n        sub.fil =\n          rc < len - sub.fis\n            ? sub.fis + rc // mismatch is longer than the mismatch in short\n            : sub.fis - len + rc; // mismatch is shorter than the mismatch in short\n        if (sub.sbs.length > cd.sbs.length) {\n          cd = sub; // only keep the one with the longest substring.\n        }\n      }\n    }\n    // insert the mismatching delete subsrt and insert substr to the cd object and attach the previous substring\n    [cd.del, cd.ins] = isThisLonger\n      ? [longer.slice(0, cd.fil).join(''), shorter.slice(0, cd.fis)]\n      : [shorter.slice(0, cd.fis), longer.slice(0, cd.fil).join('')];\n    return cd.del.indexOf(' ') === -1 ||\n      cd.ins.indexOf(' ') === -1 ||\n      cd.del === '' ||\n      cd.ins === '' ||\n      cd.sbs === ''\n      ? cd\n      : StringUtils.getChanges(cd.del, cd.ins, cd.mtc, p);\n  }\n\n  private static rotateArray(array, n) {\n    const len = array.length;\n    const res = new Array(array.length);\n    if (n % len === 0) {\n      return array.slice();\n    } else {\n      for (let i = 0; i < len; i++) {\n        res[i] = array[(i + (len + (n % len))) % len];\n      }\n    }\n    return res;\n  }\n}\n","export enum ChangeType {\n  ADDED = 'added',\n  DELETED = 'deleted',\n  MODIFIED = 'modified'\n}\n\nexport interface Change {\n  type: ChangeType;\n  keysChanged?: {\n    key: string;\n    newValue: any;\n    oldValue: any;\n  }[];\n}\n\nexport interface GroupingChanges {\n  added: ChangeItem[];\n  deleted: ChangeItem[];\n  modified: ChangeItem[];\n}\n\nexport interface ChangeItem {\n  change: Change;\n  value: any;\n  oldValue?: any;\n  newValue?: any;\n}\n","import { StringUtils } from './string-utils';\nimport { GroupingChanges, ChangeType } from './change.interface';\n\nexport class ChangeUtils {\n  static findChanges(\n    obj1: any[],\n    obj2: any[],\n    ignoreKeys: string[] = []\n  ): GroupingChanges {\n    const items: GroupingChanges = {\n      added: [],\n      deleted: [],\n      modified: []\n    };\n\n    if (!obj1 || !obj2) {\n      return items;\n    }\n\n    const obj1Clone: any = [...obj1];\n    const obj2Clone: any = [...obj2];\n\n    for (const fromItem of obj1Clone) {\n      const index = obj2Clone.findIndex(s => s.id === fromItem.id);\n\n      if (index === -1) {\n        items.deleted.push({\n          change: { type: ChangeType.DELETED },\n          value: fromItem\n        });\n        continue;\n      }\n\n      const toItem = obj2Clone.splice(index, 1)[0];\n      const fromItemClone = JSON.parse(JSON.stringify(fromItem));\n      const toItemClone = JSON.parse(JSON.stringify(toItem));\n\n      const keysChanged = ChangeUtils.compareObject(\n        fromItemClone,\n        toItemClone,\n        undefined,\n        ignoreKeys\n      );\n\n      if (keysChanged.length) {\n        items.modified.push({\n          change: {\n            type: ChangeType.MODIFIED,\n            keysChanged\n          },\n          value: fromItemClone,\n          oldValue: fromItem,\n          newValue: toItem\n        });\n      }\n    }\n\n    items.added = obj2Clone.map(itemAdded => {\n      return {\n        change: { type: ChangeType.ADDED },\n        value: itemAdded\n      };\n    });\n\n    return items;\n  }\n\n  private static compareObject(fromItem, toItem, baseKey?, ignoreKeys = []) {\n    const fromItemClone = JSON.parse(JSON.stringify(fromItem));\n    const toItemClone = JSON.parse(JSON.stringify(toItem));\n\n    const keys: any = new Set([\n      ...Object.keys(fromItem),\n      ...Object.keys(toItem)\n    ]);\n    let keysChanged = [];\n    keys.forEach(key => {\n      const keyString = baseKey ? `${baseKey}.${key}` : key;\n      if (ignoreKeys.indexOf(keyString) !== -1) {\n        return;\n      }\n\n      if (Array.isArray(fromItem[key])) {\n        fromItem[key] = fromItem[key].join(',<br>');\n      }\n      if (Array.isArray(toItem[key])) {\n        toItem[key] = toItem[key].join(',<br>');\n      }\n\n      if (\n        typeof fromItem[key] === 'object' &&\n        typeof toItem[key] === 'object' &&\n        fromItem[key] !== null &&\n        toItem[key] !== null\n      ) {\n        keysChanged = keysChanged.concat(\n          this.compareObject(fromItem[key], toItem[key], keyString)\n        );\n      } else {\n        if (fromItem[key] !== toItem[key]) {\n          keysChanged.push({\n            key: keyString,\n            oldValue: fromItemClone[key],\n            newValue: toItemClone[key]\n          });\n          fromItem[key] = StringUtils.diff(fromItem[key], toItem[key]);\n        }\n      }\n    });\n\n    return keysChanged;\n  }\n}\n","export class ObjectUtils {\n  static resolve(obj: object, key: string): any {\n    const keysArray = key\n      .replace(/\\[/g, '.')\n      .replace(/\\]/g, '')\n      .split('.');\n    let current = obj;\n    while (keysArray.length) {\n      if (typeof current !== 'object') {\n        return undefined;\n      }\n      current = current[keysArray.shift()];\n    }\n\n    return current;\n  }\n\n  static isObject(item: object) {\n    return (\n      item &&\n      typeof item === 'object' &&\n      !Array.isArray(item) &&\n      item !== null &&\n      !(item instanceof Date)\n    );\n  }\n\n  static mergeDeep(\n    target: object,\n    source: object,\n    ignoreUndefined = false\n  ): any {\n    const output = Object.assign({}, target);\n    if (ObjectUtils.isObject(target) && ObjectUtils.isObject(source)) {\n      Object.keys(source)\n        .filter(key => !ignoreUndefined || source[key] !== undefined)\n        .forEach(key => {\n          if (ObjectUtils.isObject(source[key])) {\n            if (!(key in target)) {\n              Object.assign(output, { [key]: source[key] });\n            } else {\n              output[key] = ObjectUtils.mergeDeep(\n                target[key],\n                source[key],\n                ignoreUndefined\n              );\n            }\n          } else {\n            Object.assign(output, { [key]: source[key] });\n          }\n        });\n    }\n    return output;\n  }\n\n  static copyDeep(src): any {\n    const target = Array.isArray(src) ? [] : {};\n    for (const prop in src) {\n      if (src.hasOwnProperty(prop)) {\n        const value = src[prop];\n        if (value && typeof value === 'object') {\n          target[prop] = this.copyDeep(value);\n        } else {\n          target[prop] = value;\n        }\n      }\n    }\n    return target;\n  }\n\n  static removeDuplicateCaseInsensitive(obj: object) {\n    const summaryCapitalizeObject = {};\n    const capitalizeObject = {};\n    const upperCaseCount = [];\n\n    for (const property in obj) {\n      if (obj.hasOwnProperty(property)) {\n        const upperCaseProperty = property.toUpperCase();\n        if (!summaryCapitalizeObject.hasOwnProperty(upperCaseProperty)) {\n          summaryCapitalizeObject[upperCaseProperty] = [\n            { [property]: obj[property] }\n          ];\n        } else {\n          summaryCapitalizeObject[upperCaseProperty].push({\n            [property]: obj[property]\n          });\n        }\n        // counting the number of uppercase lettersMna\n        upperCaseCount.push({\n          key: property,\n          count: property.replace(/[^A-Z]/g, '').length\n        });\n      }\n    }\n    for (const capitalizedProperty in summaryCapitalizeObject) {\n      if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\n        if (summaryCapitalizeObject.hasOwnProperty(capitalizedProperty)) {\n          const capitalizedPropertyObject =\n            summaryCapitalizeObject[capitalizedProperty];\n          if (capitalizedPropertyObject.length === 1) {\n            // for single params (no duplicates)\n            const singlePossibility = capitalizedPropertyObject[0];\n            capitalizeObject[capitalizedProperty] =\n              singlePossibility[Object.keys(singlePossibility)[0]];\n          } else if (capitalizedPropertyObject.length > 1) {\n            // defining the closest to lowercase property\n            const paramClosestToLowercase = upperCaseCount\n              .filter(\n                f => f.key.toLowerCase() === capitalizedProperty.toLowerCase()\n              )\n              .reduce((prev, current) => {\n                return prev.y < current.y ? prev : current;\n              });\n            capitalizeObject[paramClosestToLowercase.key.toUpperCase()] =\n              obj[paramClosestToLowercase.key];\n          }\n        }\n      }\n    }\n    for (const property in obj) {\n      if (obj.hasOwnProperty(property)) {\n        delete obj[property];\n      }\n    }\n\n    for (const property in capitalizeObject) {\n      if (capitalizeObject.hasOwnProperty(property)) {\n        obj[property] = capitalizeObject[property];\n      }\n    }\n  }\n\n  static removeUndefined(obj: object): any {\n    const output = {};\n    if (ObjectUtils.isObject(obj)) {\n      Object.keys(obj)\n        .filter(key => obj[key] !== undefined)\n        .forEach(key => {\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\n            output[key] = ObjectUtils.removeUndefined(obj[key]);\n          } else {\n            output[key] = obj[key];\n          }\n        });\n\n      return output;\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map(o => ObjectUtils.removeUndefined(o));\n    }\n\n    return obj;\n  }\n\n  static removeNull(obj: object): any {\n    const output = {};\n    if (ObjectUtils.isObject(obj)) {\n      Object.keys(obj)\n        .filter(key => obj[key] !== null)\n        .forEach(key => {\n          if (ObjectUtils.isObject(obj[key]) || Array.isArray(obj[key])) {\n            output[key] = ObjectUtils.removeNull(obj[key]);\n          } else {\n            output[key] = obj[key];\n          }\n        });\n\n      return output;\n    }\n\n    if (Array.isArray(obj)) {\n      return obj.map(o => ObjectUtils.removeNull(o));\n    }\n\n    return obj;\n  }\n\n  static naturalCompare(a, b, direction = 'asc', nullsFirst?: boolean) {\n    if (direction === 'desc') {\n      b = [a, (a = b)][0];\n    }\n\n    // nullsFirst = undefined : end if direction = 'asc', first if direction = 'desc'\n    // nullsFirst = true : always first\n    // nullsFirst = false : always end\n    if (\n      a === null ||\n      a === '' ||\n      a === undefined ||\n      b === null ||\n      b === '' ||\n      b === undefined\n    ) {\n      const nullScore =\n        a === b\n          ? 0\n          : a === undefined\n          ? 3\n          : b === undefined\n          ? -3\n          : a === null\n          ? 2\n          : b === null\n          ? -2\n          : a === ''\n          ? 1\n          : -1;\n      if (direction === 'desc') {\n        return nullsFirst !== false ? nullScore : nullScore * -1;\n      }\n      return nullsFirst === true ? nullScore * -1 : nullScore;\n    }\n\n    const ax = [];\n    const bx = [];\n    a = '' + a;\n    b = '' + b;\n\n    a.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\n      ax.push([$1 || Infinity, $2 || '']);\n    });\n\n    b.replace(/(\\d+)|(\\D+)/g, (_, $1, $2) => {\n      bx.push([$1 || Infinity, $2 || '']);\n    });\n\n    while (ax.length && bx.length) {\n      const an = ax.shift();\n      const bn = bx.shift();\n      const nn = an[0] - bn[0] || an[1].localeCompare(bn[1]);\n      if (nn) {\n        return nn;\n      }\n    }\n\n    return ax.length - bx.length;\n  }\n\n  /**\n   * Return true if two object are equivalent.\n   * Objects are considered equivalent if they have the same properties and\n   * if all of their properties (first-level only) share the same value.\n   * @param obj1 First object\n   * @param obj2 Second object\n   * @returns Whether two objects arer equivalent\n   */\n  static objectsAreEquivalent(obj1: object, obj2: object): boolean {\n    if (obj1 === obj2) {\n      return true;\n    }\n\n    const obj1Props = Object.getOwnPropertyNames(obj1);\n    const obj2Props = Object.getOwnPropertyNames(obj2);\n    if (obj1Props.length !== obj2Props.length) {\n      return false;\n    }\n\n    for (const prop of obj1Props) {\n      if (obj1[prop] !== obj2[prop]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Return a new object with an array of keys removed\n   * @param obj Source object\n   * @param keys Keys to remove\n   * @returns A new object\n   */\n  static removeKeys(obj: object, keys: string[]): object {\n    const newObj = Object.keys(obj)\n      .filter(key => keys.indexOf(key) < 0)\n      .reduce((_obj, key) => {\n        _obj[key] = obj[key];\n        return _obj;\n      }, {});\n\n    return newObj;\n  }\n}\n","export class NumberUtils {\n    static roundToNDecimal(num: number, decimal: number = 3): number {\n        const roundFactor = Math.pow(10, decimal);\n        return Math.round((num) * roundFactor) / roundFactor;\n    }\n}\n","/** Utility function to create a K:V from a list of strings */\nexport function strEnum<T extends string>(o: Array<T>): { [K in T]: K } {\n  return o.reduce((res, key) => {\n    res[key] = key;\n    return res;\n  }, Object.create(null));\n}\n","export function S4() {\n  // eslint-disable-next-line no-bitwise\n  return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n}\n\nexport function uuid() {\n  const id = `${S4()}${S4()}-${S4()}-${S4()}-${S4()}-${S4()}${S4()}${S4()}`;\n  return id.toLowerCase();\n}\n","import { Subject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nexport enum SubjectStatus {\n  Error = 0,\n  Done = 1,\n  Working = 2,\n  Waiting = 3\n}\n\nexport abstract class Watcher {\n  public status$ = new Subject<SubjectStatus>();\n  protected status$$: Subscription;\n\n  get status(): SubjectStatus {\n    return this._status;\n  }\n  set status(value: SubjectStatus) {\n    this._status = value;\n    this.status$.next(value);\n  }\n  private _status: SubjectStatus;\n\n  protected abstract watch();\n\n  protected abstract unwatch();\n\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  subscribe(callback: Function, scope?: any) {\n    this.watch();\n\n    this.status$$ = this.status$\n      .pipe(distinctUntilChanged())\n      .subscribe((status: SubjectStatus) => {\n        this.handleStatusChange(status);\n        callback.call(scope, this);\n      });\n  }\n\n  unsubscribe() {\n    this.unwatch();\n    if (this.status$$ !== undefined) {\n      this.status$$.unsubscribe();\n      this.status$$ = undefined;\n    }\n    this.status = SubjectStatus.Waiting;\n  }\n\n  protected handleStatusChange(status: SubjectStatus) {}\n}\n","import { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { uuid } from '@igo2/utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ActivityService {\n  public counter$ = new BehaviorSubject<number>(0);\n\n  private ids: string[] = [];\n\n  constructor() {}\n\n  register(): string {\n    const id = uuid();\n    this.ids.push(id);\n    this.counter$.next(this.ids.length);\n\n    return id;\n  }\n\n  unregister(id: string) {\n    const index = this.ids.indexOf(id);\n    if (index === -1) {\n      return;\n    }\n    this.ids.splice(index, 1);\n\n    this.counter$.next(this.ids.length);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport {\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpRequest\n} from '@angular/common/http';\n\nimport { Observable } from 'rxjs';\nimport { finalize } from 'rxjs/operators';\n\nimport { ActivityService } from './activity.service';\n\n@Injectable()\nexport class ActivityInterceptor implements HttpInterceptor {\n  constructor(private activityService: ActivityService) {}\n\n  intercept(\n    req: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const activity = req.headers.get('activityInterceptor');\n    if (activity) {\n      const actReq = req.clone({\n        headers: req.headers.delete('activityInterceptor')\n      });\n      if (activity === 'false') {\n        return next.handle(actReq);\n      }\n    }\n\n    const id = this.activityService.register();\n\n    return next.handle(req).pipe(\n      finalize(() => {\n        this.activityService.unregister(id);\n      })\n    );\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\n\nimport { ActivityInterceptor } from './activity.interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoActivityModule {\n  static forRoot(): ModuleWithProviders<IgoActivityModule> {\n    return {\n      ngModule: IgoActivityModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: ActivityInterceptor,\n          multi: true\n        }\n      ]\n    };\n  }\n}\n","export interface Version {\n  lib: string;\n  releaseDate: number;\n}\n\nexport const version: Version = {\n  lib: '1.14.2',\n  releaseDate: 1678893574991\n};\n","import { Injectable, Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { ConfigOptions } from './config.interface';\nimport { version } from './version';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ConfigService {\n  private config: object = {};\n\n  constructor(private injector: Injector) {}\n\n  /**\n   * Use to get the data found in config file\n   */\n  public getConfig(key: string): any {\n    return ObjectUtils.resolve(this.config, key);\n  }\n\n  /**\n   * This method loads \"[path]\" to get all config's variables\n   */\n  public load(options: ConfigOptions) {\n    const baseConfig = options.default || {};\n    if (!options.path) {\n      this.config = baseConfig;\n      return true;\n    }\n\n    const http = this.injector.get(HttpClient);\n\n    return new Promise((resolve, _reject) => {\n      http\n        .get(options.path)\n        .pipe(\n          catchError((error: any): any => {\n            console.log(`Configuration file ${options.path} could not be read`);\n            resolve(true);\n            return throwError(error.error || 'Server error');\n          })\n        )\n        .subscribe((configResponse: object) => {\n          this.config = ObjectUtils.mergeDeep(\n            ObjectUtils.mergeDeep({ version }, baseConfig),\n            configResponse\n          );\n          resolve(true);\n        });\n    });\n  }\n}\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\n\nimport { ConfigService } from './config.service';\nimport { ConfigOptions } from './config.interface';\n\nexport let CONFIG_OPTIONS = new InjectionToken<ConfigOptions>('configOptions');\n\nexport function provideConfigOptions(options: ConfigOptions) {\n  return {\n    provide: CONFIG_OPTIONS,\n    useValue: options\n  };\n}\n\nexport function configFactory(\n  configService: ConfigService,\n  options: ConfigOptions\n) {\n  return () => configService.load(options);\n}\n\nexport function provideConfigLoader() {\n  return {\n    provide: APP_INITIALIZER,\n    useFactory: configFactory,\n    multi: true,\n    deps: [ConfigService, CONFIG_OPTIONS]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { provideConfigOptions, provideConfigLoader } from './config.provider';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoConfigModule {\n  static forRoot(): ModuleWithProviders<IgoConfigModule> {\n    return {\n      ngModule: IgoConfigModule,\n      providers: [provideConfigOptions({}), provideConfigLoader()]\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { TranslateLoader } from '@ngx-translate/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { ConfigService } from '../../config/config.service';\n\ndeclare function require(arg: string): any;\n\nexport class LanguageLoader implements TranslateLoader {\n  constructor(\n    private http: HttpClient,\n    private prefix?: string | string[],\n    private suffix: string = '.json',\n    private config?: ConfigService\n  ) {}\n\n  public getTranslation(lang: string): any {\n    const igoLocale$ = this.http.get(`locale/libs_locale/${lang}.json`);\n\n    if (this.config && !this.prefix) {\n      const prefix = this.config.getConfig('language.prefix');\n      this.prefix = !prefix || Array.isArray(prefix) ? prefix : [prefix];\n    }\n\n    if (!this.prefix || this.prefix.length === 0) {\n      return igoLocale$;\n    }\n\n    const appLocale$ = (this.prefix as string[]).map((prefix) =>\n      this.http.get(`${prefix}${lang}${this.suffix}`)\n    );\n\n    const locale$ = combineLatest([igoLocale$, ...appLocale$]);\n\n    return locale$.pipe(\n      map((translations) => {\n        return translations.reduce(\n          (acc, current) => ObjectUtils.mergeDeep(acc, current),\n          {}\n        );\n      })\n    );\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { TranslateLoader } from '@ngx-translate/core';\n\nimport { ConfigService } from '../../config/config.service';\nimport { LanguageLoader } from './language.loader';\n\nexport function defaultLanguageLoader(\n  http: HttpClient,\n  config?: ConfigService\n) {\n  return new LanguageLoader(http, undefined, undefined, config);\n}\n\nexport function provideLanguageLoader(loader?) {\n  return {\n    provide: TranslateLoader,\n    useFactory: loader || defaultLanguageLoader,\n    deps: [HttpClient]\n  };\n}\n\nexport function provideDefaultLanguageLoader(loader?) {\n  return {\n    provide: TranslateLoader,\n    useFactory: loader || defaultLanguageLoader,\n    deps: [HttpClient, ConfigService]\n  };\n}\n","import {\n  MissingTranslationHandler,\n  MissingTranslationHandlerParams\n} from '@ngx-translate/core';\n\nexport class IgoMissingTranslationHandler implements MissingTranslationHandler {\n  handle(params: MissingTranslationHandlerParams) {\n    if (!params.translateService.langs.length) {\n      const error =\n        'Translations are not yet loaded. \\\n         Check that the LanguageService is injected.';\n      throw new Error(error);\n    }\n\n    if (params.key.substr(0, 4) === 'igo.') {\n      throw new Error(`The Key \"${params.key}\" is missing in locale file.`);\n    } else {\n      return params.key;\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport {\n  TranslateModule,\n  MissingTranslationHandler\n} from '@ngx-translate/core';\n\nimport { provideDefaultLanguageLoader } from './shared/language.provider';\nimport { IgoMissingTranslationHandler } from './shared/missing-translation.guard';\n\n@NgModule({\n  imports: [\n    TranslateModule.forRoot({\n      missingTranslationHandler: {\n        provide: MissingTranslationHandler,\n        useClass: IgoMissingTranslationHandler\n      }\n    })\n  ],\n  declarations: [],\n  exports: [TranslateModule]\n})\nexport class IgoLanguageModule {\n  static forRoot(): ModuleWithProviders<IgoLanguageModule> {\n    return {\n      ngModule: IgoLanguageModule,\n      providers: [provideDefaultLanguageLoader()]\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { GlobalConfig, ToastrModule } from 'ngx-toastr';\n\n@NgModule({\n  imports: [CommonModule,\n    ToastrModule.forRoot({\n      positionClass: 'toast-bottom-right',\n      timeOut: 10000,\n      extendedTimeOut: 10000,\n      messageClass: 'toast-message mat-typography',\n      closeButton: true,\n      progressBar: true,\n      enableHtml: true,\n      tapToDismiss: true,\n      maxOpened: 4,\n      preventDuplicates: true,\n      resetTimeoutOnDuplicate: true,\n      countDuplicates: false,\n      includeTitleDuplicates: true\n    } as GlobalConfig)],\n  declarations: [],\n  exports: []\n})\nexport class IgoMessageModule {\n  static forRoot(): ModuleWithProviders<IgoMessageModule> {\n    return {\n      ngModule: IgoMessageModule,\n      providers: []\n    };\n  }\n}\n","export enum MessageType {\n  ERROR = 'error',\n  ALERT = 'warning', // todo delete (transition to ngx-toastr)\n  WARNING = 'warning',\n  INFO = 'info',\n  SUCCESS = 'success',\n  SHOW = 'show'\n}\n","import { Injectable } from '@angular/core';\nimport { TranslateService } from '@ngx-translate/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LanguageService {\n  private language: string = this.translate.getBrowserLang();\n  readonly language$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  constructor(public translate: TranslateService) {\n    const lang = this.getLanguage();\n    this.translate.setDefaultLang(lang);\n    this.language$.next(lang);\n  }\n\n  public getLanguage(): string {\n    return this.language.match(/en|fr/) ? this.language : 'en';\n  }\n\n  public setLanguage(language: string) {\n    this.language = language.match(/en|fr/) ? language : 'en';\n    combineLatest([this.translate.use(this.language), this.translate.reloadLang(this.language)]).subscribe(() => {\n      this.language$.next(this.language);\n    });\n  }\n}\n","import { Injectable, Inject, Injector } from '@angular/core';\nimport { HttpErrorResponse } from '@angular/common/http';\nimport { BehaviorSubject, forkJoin } from 'rxjs';\n\nimport { ConfigService } from '../../config/config.service';\n\nimport { Message, MessageOptions } from './message.interface';\nimport { ActiveToast, IndividualConfig, ToastrService } from 'ngx-toastr';\nimport { MessageType } from './message.enum';\nimport { LanguageService } from '../../language/shared/language.service';\nimport { debounceTime, first } from 'rxjs/operators';\n\ninterface ActiveMessageTranslation {\n  id: number;\n  titleKey: string;\n  textKey: string;\n  textInterpolateParams?: Object\n  titleInterpolateParams?: Object\n}\n@Injectable({\n  providedIn: 'root'\n})\nexport class MessageService {\n  public messages$ = new BehaviorSubject<Message[]>([]);\n  private options: MessageOptions;\n  private activeMessageTranslations: ActiveMessageTranslation[] = [];\n\n  constructor(\n    @Inject(Injector) private injector: Injector,\n    private configService: ConfigService,\n    private languageService: LanguageService\n  ) {\n    this.options = this.configService.getConfig('message') || {};\n    this.languageService.language$.pipe(debounceTime(500)).subscribe(r => {\n      if (this.toastr.toasts.length === 0) {\n        this.activeMessageTranslations = [];\n      }\n      this.toastr.toasts.map(toast => {\n        const activeMessageTranslation = this.activeMessageTranslations.find(amt => amt.id === toast.toastId);\n        if (activeMessageTranslation) {\n          const translatedTextInterpolateParams = {...activeMessageTranslation.textInterpolateParams};\n          const translatedTitleInterpolateParams = {...activeMessageTranslation.titleInterpolateParams};\n\n          if (activeMessageTranslation.textInterpolateParams) {\n            Object.keys(activeMessageTranslation.textInterpolateParams).map(k => {\n              translatedTextInterpolateParams[k] =\n                this.languageService.translate.instant(activeMessageTranslation.textInterpolateParams[k]);\n            });\n          }\n          if (activeMessageTranslation.titleInterpolateParams) {\n            Object.keys(activeMessageTranslation.titleInterpolateParams).map(k => {\n              translatedTitleInterpolateParams[k] =\n                this.languageService.translate.instant(activeMessageTranslation.titleInterpolateParams[k]);\n            });\n          }\n\n\n          forkJoin([\n          this.languageService.translate.get(activeMessageTranslation.textKey, translatedTextInterpolateParams),\n          this.languageService.translate.get(activeMessageTranslation.titleKey, translatedTitleInterpolateParams)\n        ]).pipe(first()).subscribe((res: [string, string]) => {\n          toast.toastRef.componentInstance.message = res[0];\n          toast.toastRef.componentInstance.title = res[1];\n        });\n        }\n      });\n    });\n  }\n\n  private get toastr(): ToastrService {\n    return this.injector.get(ToastrService);\n  }\n\n  showError(httpError: HttpErrorResponse) {\n    httpError.error.caught = true;\n    return this.error(httpError.error.message, httpError.error.title);\n  }\n\n  message(message: Message) {\n    const messageType = message.type;\n    this.toastr.toastrConfig.iconClasses[messageType] = `toast-${messageType}`;\n\n    this.messages$.next(this.messages$.value.concat([message]));\n\n    message.options = message.options || {} as MessageOptions;\n    const currentDate = new Date();\n\n    message.options.from = message.options.from ? message.options.from : new Date('1 jan 1900');\n    message.options.to = message.options.to ? message.options.to : new Date('1 jan 3000');\n    if (typeof message.options.from === 'string') {\n      message.options.from = new Date(Date.parse(message.options.from.replace(/-/g, ' ')));\n    }\n    if (typeof message.options.to === 'string') {\n      message.options.to = new Date(Date.parse(message.options.to.replace(/-/g, ' ')));\n    }\n    if (currentDate > message.options.from && currentDate < message.options.to) {\n      if (message.showIcon === false) {\n        this.toastr.toastrConfig.iconClasses[messageType] = `toast-${messageType} toast-no-icon`;\n      }\n      message = this.handleTemplate(message);\n\n      if (message.text) {\n        let messageShown: ActiveToast<any>;\n        switch (message.type) {\n          case MessageType.SUCCESS:\n            messageShown = this.success(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams);\n            break;\n          case MessageType.ERROR:\n            messageShown = this.error(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams);\n            break;\n          case MessageType.INFO:\n            messageShown = this.info(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams);\n            break;\n          case MessageType.SHOW:\n            messageShown = this.show(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams);\n            break;\n          case MessageType.ALERT:\n          case MessageType.WARNING:\n            messageShown = this.alert(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams);\n            break;\n          default:\n            messageShown = this.info(\n              message.text,\n              message.title,\n              message.options,\n              message.textInterpolateParams,\n              message.titleInterpolateParams);\n            break;\n        }\n        message.options.id = messageShown.toastId;\n      }\n    }\n  }\n\n  success(\n    text: string,\n    title: string = 'igo.core.message.success',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object): ActiveToast<any> {\n    return this.handleNgxToastr('success', text, title, options, textInterpolateParams, titleInterpolateParams);\n  }\n\n  error(\n    text: string,\n    title: string = 'igo.core.message.error',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object): ActiveToast<any> {\n    return this.handleNgxToastr('error', text, title, options, textInterpolateParams, titleInterpolateParams);\n  }\n\n  info(\n    text: string,\n    title: string = 'igo.core.message.info',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object): ActiveToast<any> {\n    return this.handleNgxToastr('info', text, title, options, textInterpolateParams, titleInterpolateParams);\n  }\n\n  alert(\n    text: string,\n    title: string = 'igo.core.message.alert',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object): ActiveToast<any> {\n    return this.handleNgxToastr('alert', text, title, options, textInterpolateParams, titleInterpolateParams);\n  }\n\n  show(\n    text: string,\n    title: string = 'igo.core.message.info',\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object): ActiveToast<any> {\n    return this.handleNgxToastr('show', text, title, options, textInterpolateParams, titleInterpolateParams);\n  }\n\n  private handleNgxToastr(\n    type: 'alert' | 'info' | 'error' | 'success' | 'show',\n    text: string,\n    title: string,\n    options: Partial<IndividualConfig> = {},\n    textInterpolateParams?: Object,\n    titleInterpolateParams?: Object): ActiveToast<any> {\n\n    const translatedTextInterpolateParams = {...textInterpolateParams};\n    const translatedTitlenterpolateParams = {...titleInterpolateParams};\n\n    if (textInterpolateParams) {\n      Object.keys(textInterpolateParams).map(k => {\n        translatedTextInterpolateParams[k] =\n          this.languageService.translate.instant(textInterpolateParams[k]);\n      });\n    }\n    if (titleInterpolateParams) {\n      Object.keys(titleInterpolateParams).map(k => {\n        translatedTitlenterpolateParams[k] =\n          this.languageService.translate.instant(titleInterpolateParams[k]);\n      });\n    }\n\n\n    const message = this.languageService.translate.instant(text, translatedTextInterpolateParams);\n    const translatedTitle = this.languageService.translate.instant(title, translatedTitlenterpolateParams);\n\n    let activeToast;\n    switch (type) {\n      case 'success':\n        activeToast = this.toastr.success(message, translatedTitle, options);\n        break;\n      case 'error':\n        activeToast = this.toastr.error(message, translatedTitle, options);\n        break;\n      case 'show':\n      case 'info':\n        activeToast = this.toastr.info(message, translatedTitle, options);\n        break;\n      case 'alert':\n        activeToast = this.toastr.warning(message, translatedTitle, options);\n        break;\n    }\n    this.activeMessageTranslations.push({\n      id: activeToast.toastId,\n      titleKey: title,\n      textKey: text,\n      textInterpolateParams,\n      titleInterpolateParams });\n    return activeToast;\n\n  }\n\n  remove(id?: number) {\n    this.toastr.remove(id);\n  }\n\n  removeAllAreNotError() {\n    for (const mess of this.messages$.value) {\n      if (mess.type !== MessageType.ERROR) {\n        this.remove(mess.options.id);\n      }\n    }\n  }\n\n  private handleTemplate(message: Message): Message {\n    if (!this.options.template || message.html) {\n      return message;\n    }\n\n    let html = this.options.template;\n    html = html.replace('${text}', message.text);\n    html = html.replace('${title}', message.title);\n\n    message.html = undefined;\n    message.text = html;\n    message.title = undefined;\n    return message;\n  }\n}\n","import { Injectable, Injector } from '@angular/core';\nimport {\n  HttpInterceptor,\n  HttpHandler,\n  HttpRequest,\n  HttpEvent,\n  HttpErrorResponse\n} from '@angular/common/http';\n\nimport { Observable, throwError } from 'rxjs';\nimport { catchError, finalize } from 'rxjs/operators';\n\nimport { MessageService } from '../message/shared/message.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ErrorInterceptor implements HttpInterceptor {\n  constructor(\n    private injector: Injector\n  ) {}\n\n  intercept(\n    originalReq: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const interceptError = originalReq.headers.get('interceptError');\n    const req = originalReq.clone({\n      headers: originalReq.headers.delete('interceptError')\n    });\n    if (interceptError === 'false') {\n      return next.handle(req);\n    }\n    const errorContainer = { httpError: undefined };\n    return next.handle(req).pipe(\n      catchError(error => this.handleError(error, errorContainer)),\n      finalize(() => {\n        this.handleCaughtError(errorContainer);\n        this.handleUncaughtError(errorContainer);\n      })\n    );\n  }\n\n  private handleError(\n    httpError: HttpErrorResponse,\n    errorContainer: { httpError: HttpErrorResponse }\n  ) {\n    if (httpError instanceof HttpErrorResponse) {\n      const errorObj = httpError.error === 'object' ? httpError.error : {};\n      errorObj.message = httpError.error.message || httpError.statusText;\n      errorObj.caught = false;\n\n      httpError = new HttpErrorResponse({\n        error: errorObj,\n        headers: httpError.headers,\n        status: httpError.status,\n        statusText: httpError.statusText,\n        url: httpError.url\n      });\n    }\n\n    errorContainer.httpError = httpError;\n    return throwError(httpError);\n  }\n\n  private handleCaughtError(errorContainer: { httpError: HttpErrorResponse }) {\n    const httpError = errorContainer.httpError;\n    if (httpError && httpError.error.toDisplay) {\n      httpError.error.caught = true;\n      const messageService = this.injector.get(MessageService);\n       messageService.error(httpError.error.message, httpError.error.title);\n    }\n  }\n\n  private handleUncaughtError(errorContainer: {\n    httpError: HttpErrorResponse;\n  }) {\n    const httpError = errorContainer.httpError;\n    if (httpError && !httpError.error.caught) {\n      const messageService = this.injector.get(MessageService);\n      httpError.error.caught = true;\n      messageService.error('igo.core.errors.uncaught.message', 'igo.core.errors.uncaught.title');\n    }\n  }\n}\n","import {\n  NgModule,\n  ModuleWithProviders,\n  Optional,\n  SkipSelf\n} from '@angular/core';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\n\nimport { ErrorInterceptor } from './error.interceptor';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoErrorModule {\n  static forRoot(): ModuleWithProviders<IgoErrorModule> {\n    return {\n      ngModule: IgoErrorModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: ErrorInterceptor,\n          multi: true\n        }\n      ]\n    };\n  }\n\n  constructor(@Optional() @SkipSelf() parentModule: IgoErrorModule) {\n    if (parentModule) {\n      throw new Error(\n        'IgoErrorModule is already loaded. Import it in the AppModule only'\n      );\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { HttpClientModule } from '@angular/common/http';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { MatIconRegistry } from '@angular/material/icon';\n\nimport { IgoActivityModule } from './activity/activity.module';\nimport { IgoConfigModule } from './config/config.module';\nimport { IgoLanguageModule } from './language/language.module';\nimport { IgoMessageModule } from './message/message.module';\nimport { IgoErrorModule } from './request/error.module';\nimport { DBConfig, NgxIndexedDBModule } from 'ngx-indexed-db';\n\nconst dbConfig: DBConfig = {\n  name: 'igo2DB',\n  version: 1,\n  objectStoresMeta: [{\n    store: 'geoData',\n    storeConfig: { keyPath: 'url', autoIncrement: false },\n    storeSchema: [\n      { name: 'regionID', keypath: 'regionID', options: { unique: false }}\n    ]\n  }]\n};\n@NgModule({\n  imports: [\n    CommonModule,\n    HttpClientModule,\n    IgoActivityModule.forRoot(),\n    IgoConfigModule.forRoot(),\n    IgoErrorModule.forRoot(),\n    IgoLanguageModule.forRoot(),\n    IgoMessageModule.forRoot(),\n    NgxIndexedDBModule.forRoot(dbConfig)\n  ],\n  declarations: [],\n  exports: [\n    IgoActivityModule,\n    IgoConfigModule,\n    IgoErrorModule,\n    IgoLanguageModule,\n    IgoMessageModule\n  ]\n})\nexport class IgoCoreModule {\n  static forRoot(): ModuleWithProviders<IgoCoreModule> {\n    return {\n      ngModule: IgoCoreModule,\n      providers: []\n    };\n  }\n\n  constructor(matIconRegistry: MatIconRegistry, domSanitizer: DomSanitizer) {\n    matIconRegistry.addSvgIconSet(\n      domSanitizer.bypassSecurityTrustResourceUrl(\n        './assets/igo2/core/icons/mdi.svg'\n      )\n    );\n  }\n}\n","import { Injectable, Inject, InjectionToken, Optional } from '@angular/core';\nimport { ActivatedRoute, Params, Router } from '@angular/router';\nimport { Observable } from 'rxjs';\n\nimport { RouteServiceOptions } from './route.interface';\n\nexport let ROUTE_SERVICE_OPTIONS = new InjectionToken<RouteServiceOptions>(\n  'routeServiceOptions'\n);\n\nexport function provideRouteServiceOptions(options: RouteServiceOptions) {\n  return {\n    provide: ROUTE_SERVICE_OPTIONS,\n    useValue: options\n  };\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class RouteService {\n  public options: RouteServiceOptions;\n\n  constructor(\n    private router: Router,\n    public route: ActivatedRoute,\n    @Inject(ROUTE_SERVICE_OPTIONS)\n    @Optional()\n    options: RouteServiceOptions\n  ) {\n    const defaultOptions = {\n      centerKey: 'center',\n      zoomKey: 'zoom',\n      projectionKey: 'projection',\n      contextKey: 'context',\n      searchKey: 'search',\n      visibleOnLayersKey: 'visiblelayers',\n      visibleOffLayersKey: 'invisiblelayers',\n      directionsCoordKey: 'routing',\n      directionsOptionsKey: 'routingOptions',\n      toolKey: 'tool',\n      wmsUrlKey: 'wmsUrl',\n      wmsLayersKey:  'wmsLayers',\n      wmtsUrlKey: 'wmtsUrl',\n      wmtsLayersKey:  'wmtsLayers',\n      arcgisUrlKey: 'arcgisUrl',\n      arcgisLayersKey:  'arcgisLayers',\n      iarcgisUrlKey: 'iarcgisUrl',\n      iarcgisLayersKey:  'iarcgisLayers',\n      tarcgisUrlKey: 'tarcgisUrl',\n      tarcgisLayersKey:  'tarcgisLayers',\n      vectorKey: 'vector'\n    };\n    this.options = Object.assign({}, defaultOptions, options);\n  }\n\n  get queryParams(): Observable<Params> {\n    let url = decodeURIComponent(location.search);\n    if (url.includes('er=')) {\n      url = url.replace('er', '&center');\n      const queryParams: any = url\n      .slice(1)\n      .split('&')\n      .map(p => p.split('='))\n      .reduce((obj, pair) => {\n        const [key, value] = pair.map(decodeURIComponent);\n        obj[key] = value;\n        return obj;\n      }, {});\n      this.router.navigate([], { queryParams });\n    }\n    return this.route.queryParams;\n  }\n}\n","export enum Media {\n  Mobile = 'mobile',\n  Tablet = 'tablet',\n  Desktop = 'desktop'\n}\n\nexport enum MediaOrientation {\n  Portrait = 'portrait',\n  Landscape = 'landscape'\n}\n","import { Injectable } from '@angular/core';\nimport { Breakpoints, BreakpointObserver } from '@angular/cdk/layout';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Media, MediaOrientation } from './media.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MediaService {\n  public media$ = new BehaviorSubject<Media>(undefined);\n  public orientation$ = new BehaviorSubject<MediaOrientation>(undefined);\n\n  constructor(breakpointObserver: BreakpointObserver) {\n    breakpointObserver\n      .observe([Breakpoints.HandsetLandscape])\n      .subscribe(res => {\n        if (res.matches) {\n          this.media$.next(Media.Mobile);\n          this.orientation$.next(MediaOrientation.Landscape);\n        }\n      });\n\n    breakpointObserver.observe([Breakpoints.HandsetPortrait]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Mobile);\n        this.orientation$.next(MediaOrientation.Portrait);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.TabletLandscape]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Tablet);\n        this.orientation$.next(MediaOrientation.Landscape);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.TabletPortrait]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Tablet);\n        this.orientation$.next(MediaOrientation.Portrait);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.WebLandscape]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Desktop);\n        this.orientation$.next(MediaOrientation.Landscape);\n      }\n    });\n\n    breakpointObserver.observe([Breakpoints.WebPortrait]).subscribe(res => {\n      if (res.matches) {\n        this.media$.next(Media.Desktop);\n        this.orientation$.next(MediaOrientation.Portrait);\n      }\n    });\n  }\n\n  getMedia(): Media {\n    return this.media$.value;\n  }\n\n  getOrientation(): MediaOrientation {\n    return this.orientation$.value;\n  }\n\n  isTouchScreen(): boolean {\n    return 'ontouchstart' in document.documentElement ? true : false;\n  }\n\n  isMobile(): boolean {\n    const media = this.getMedia();\n    return media === 'mobile';\n  }\n\n  isDesktop(): boolean {\n    const media = this.getMedia();\n    return media === 'desktop';\n  }\n}\n","export enum StorageScope {\n  SESSION = 'Session',\n  LOCAL = 'Local'\n}\n\nexport interface StorageOptions {\n  key: string;\n}\n\nexport interface StorageServiceEvent {\n  key?: string;\n  scope: StorageScope;\n  event: StorageServiceEventEnum;\n  previousValue?: any;\n  currentValue?: any;\n}\n\nexport enum StorageServiceEventEnum {\n  ADDED = 'Added',\n  MODIFIED = 'Modified',\n  REMOVED = 'Removed',\n  CLEARED = 'Cleared'\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '../config/config.service';\nimport { StorageScope, StorageOptions, StorageServiceEvent, StorageServiceEventEnum } from './storage.interface';\nimport { BehaviorSubject } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageService {\n  protected options: StorageOptions;\n\n  public storageChange$: BehaviorSubject<StorageServiceEvent> = new BehaviorSubject(undefined);\n\n  constructor(private config: ConfigService) {\n    this.options = this.config.getConfig('storage') || { key: 'igo' };\n  }\n  /**\n   * Use to get the data found in storage file\n   */\n  get(key: string, scope?: StorageScope): string | object | boolean | number {\n    let value: any;\n\n    if (!scope || scope === StorageScope.SESSION) {\n      value = sessionStorage.getItem(`${this.options.key}.${key}`);\n    }\n\n    if (scope === StorageScope.LOCAL || (!value && !scope)) {\n      value = localStorage.getItem(`${this.options.key}.${key}`);\n    }\n\n    if (value) {\n      try {\n        value = JSON.parse(value);\n      } catch {\n        value = value;\n      }\n    }\n\n    return value;\n  }\n\n  set(\n    key: string,\n    value: string | object | boolean | number,\n    scope: StorageScope = StorageScope.LOCAL\n  ) {\n    const previousValue = this.get(key, scope);\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.setItem(\n        `${this.options.key}.${key}`,\n        JSON.stringify(value)\n      );\n    } else {\n      localStorage.setItem(`${this.options.key}.${key}`, JSON.stringify(value));\n    }\n    const currentValue = this.get(key, scope);\n\n    if (currentValue !== previousValue) {\n      this.storageChange$.next({\n        key, scope,\n        event: previousValue !== undefined ? StorageServiceEventEnum.MODIFIED : StorageServiceEventEnum.ADDED,\n        previousValue,\n        currentValue\n      });\n    }\n  }\n\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\n    const previousValue = this.get(key, scope);\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.removeItem(`${this.options.key}.${key}`);\n    } else {\n      localStorage.removeItem(`${this.options.key}.${key}`);\n    }\n    this.storageChange$.next({key, scope, event: StorageServiceEventEnum.REMOVED, previousValue });\n  }\n\n  clear(scope: StorageScope = StorageScope.LOCAL) {\n    if (scope === StorageScope.SESSION) {\n      sessionStorage.clear();\n    } else {\n      localStorage.clear();\n    }\n    this.storageChange$.next({scope, event: StorageServiceEventEnum.CLEARED });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable, Observer } from 'rxjs';\nimport { CompressedData } from './compressedData.interface';\n\nfunction getNumber(v: number, endposition: number, length: number) {\n  /* tslint:disable:no-bitwise*/\n  const mask = ((1 << length) - 1);\n  return (v >> endposition) & mask;\n  /* tslint:enable:no-bitwise*/\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CompressionService {\n  private base64Index = new Map<string, number>();\n  private indexBase64 = new Map<number, string>();\n\n  constructor() {\n    this.generateBase64Index();\n  }\n\n  private generateBase64Index() {\n    // https://fr.wikipedia.org/wiki/Base64\n    // A-Z => [0, 25]\n    for (let i = 0; i < 26; i++) {\n      this.base64Index.set(String.fromCharCode('A'.charCodeAt(0) + i), i);\n      this.indexBase64.set(i, String.fromCharCode('A'.charCodeAt(0) + i));\n    }\n    // a-z => [26, 51]\n    for (let i = 0; i < 26; i++) {\n      this.base64Index.set(String.fromCharCode('a'.charCodeAt(0) + i), i + 26);\n      this.indexBase64.set(i + 26, String.fromCharCode('a'.charCodeAt(0) + i));\n    }\n    // 0-9 => [52, 61]\n    for (let i = 0; i < 10; i++) {\n      this.base64Index.set(String.fromCharCode('0'.charCodeAt(0) + i), i + 52);\n      this.indexBase64.set(i + 52, String.fromCharCode('0'.charCodeAt(0) + i));\n    }\n    // + / => [62, 63]\n    this.base64Index.set('+', 62);\n    this.base64Index.set('/', 63);\n    this.indexBase64.set(62, '+');\n    this.indexBase64.set(63, '/');\n  }\n\n  compressBlob(blob: Blob): Observable<CompressedData> {\n    if (!blob) {\n      return;\n    }\n\n    const observable = new Observable((observer: Observer<CompressedData>) => {\n      const reader = new FileReader();\n      reader.readAsDataURL(blob);\n      reader.onload = () => {\n        const base64 = reader.result.valueOf() as string;\n        const text64 = base64.substr(base64.indexOf(',') + 1);\n        const compressed = this.compressStringBase64(text64);\n        const compressedData: CompressedData = { length: text64.length,\n                                                 type: blob.type,\n                                                 object: compressed };\n        observer.next(compressedData);\n      };\n    });\n    return observable;\n  }\n\n  decompressBlob(compressedData: CompressedData): Blob {\n    /* tslint:disable:no-bitwise*/\n    const object = compressedData.object;\n    const length = compressedData.length;\n    const decompressed: string = this.decompressStringBase64(object, length);\n    const byteCharacters = atob(decompressed);\n    const byteNumbers = new Array(byteCharacters.length);\n    for (let i = 0; i < byteCharacters.length; i++) {\n        byteNumbers[i] = byteCharacters.charCodeAt(i);\n    }\n    const byteArray = new Uint8Array(byteNumbers);\n    const blob = new Blob([byteArray], {type: compressedData.type});\n    /* tslint:enable:no-bitwise*/\n    return blob;\n  }\n\n  private compressStringBase64(s: string): string {\n    /* tslint:disable:no-bitwise*/\n    let out = '';\n    let bits = 16;\n    let chr = 0;\n    let rem = 0;\n    for (const c of s) {\n      const value = this.base64Index.get(c);\n      if (bits > 6) {\n        bits -= 6;\n        chr += value << bits;\n      } else {\n        rem = 6 - bits;\n        chr += value >> rem;\n        out += String.fromCharCode(chr);\n        chr = (value) << (16 - rem);\n        bits = 16 - rem;\n      }\n    }\n    if (s.length % 8 !== 0) {\n      out += String.fromCharCode(chr);\n    }\n    /* tslint:enable:no-bitwise*/\n    return String.fromCharCode(9731) + out;\n  }\n\n  private decompressStringBase64(c: string, length: number): string {\n     /* tslint:disable:no-bitwise*/\n    if (!c) {\n      return;\n    }\n\n    if (c.charCodeAt(0) !== 9731) {\n      return c;\n    }\n\n    let chr = 0;\n    let rem = 0;\n    let bits = 16;\n    let out = '';\n    let j = 1;\n    let value = c.charCodeAt(j);\n    for (let i = 0; i < length; i++) {\n      if (bits > 6) {\n        bits -= 6;\n        chr = getNumber(value, bits, 6);\n        out += this.indexBase64.get(chr);\n      } else {\n        rem = 6 - bits;\n        chr = getNumber(value, 0, bits) << rem;\n        value = c.charCodeAt(++j);\n        chr += getNumber(value, 16 - rem, rem);\n        out += this.indexBase64.get(chr);\n        bits = 16 - rem;\n      }\n    }\n    return out;\n    /* tslint:enable:no-bitwise*/\n  }\n}\n","import { Injectable, EventEmitter, OnDestroy, Injector } from '@angular/core';\nimport { Observable, Subscription, fromEvent } from 'rxjs';\nimport { debounceTime, startWith } from 'rxjs/operators';\n\nimport { MessageService } from '../message/shared/message.service';\nimport { LanguageService } from '../language/shared/language.service';\nimport { ConnectionState } from './network.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NetworkService implements OnDestroy {\n  private stateChangeEventEmitter = new EventEmitter<ConnectionState>();\n  private onlineSubscription: Subscription;\n  private offlineSubscription: Subscription;\n  private previousMessageId;\n\n  private state: ConnectionState = {\n    connection: window.navigator.onLine\n  };\n\n  constructor(\n    private messageService: MessageService,\n    private injector: Injector\n  ) {\n      this.checkNetworkState();\n  }\n\n  private checkNetworkState() {\n    this.onlineSubscription = fromEvent(window, 'online').subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      const translate = this.injector.get(LanguageService).translate;\n      const message = translate.instant('igo.core.network.online.message');\n      const title = translate.instant('igo.core.network.online.title');\n      const messageObj = this.messageService.info(message, title);\n      this.previousMessageId = messageObj.toastId;\n      this.state.connection = true;\n      this.emitEvent();\n    });\n\n    this.offlineSubscription = fromEvent(window, 'offline').subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      const translate = this.injector.get(LanguageService).translate;\n      const message = translate.instant('igo.core.network.offline.message');\n      const title = translate.instant('igo.core.network.offline.title');\n      const messageObj = this.messageService.info(message, title);\n      this.previousMessageId = messageObj.toastId;\n      this.state.connection = false;\n      this.emitEvent();\n    });\n  }\n\n  private emitEvent() {\n    this.stateChangeEventEmitter.emit(this.state);\n  }\n\n  ngOnDestroy(): void {\n    try {\n      this.offlineSubscription.unsubscribe();\n      this.onlineSubscription.unsubscribe();\n    } catch (e) {}\n  }\n\n  currentState(reportState = true): Observable<ConnectionState> {\n    return reportState\n      ? this.stateChangeEventEmitter.pipe(\n          debounceTime(300),\n          startWith(this.state)\n        )\n      : this.stateChangeEventEmitter.pipe(debounceTime(300));\n  }\n}\n","export enum EntityOperationType {\n  Insert = 'Insert',\n  Update = 'Update',\n  Delete = 'Delete'\n}\n\nexport enum EntityTableColumnRenderer {\n  Default = 'Default',\n  HTML = 'HTML',\n  UnsanitizedHTML = 'UnsanitizedHTML',\n  Editable = 'Editable',\n  Icon = 'Icon',\n  ButtonGroup = 'ButtonGroup'\n}\n\nexport enum EntityTableScrollBehavior {\n  Auto = 'auto',\n  Instant = 'instant',\n  Smooth = 'smooth'\n}\n\nexport enum EntityTableSelectionState {\n  None = 'None',\n  All = 'All',\n  Some = 'Some'\n}\n","import { t } from 'typy';\n\nimport { EntityKey } from './entity.interfaces';\n\n/**\n * Get an entity's named property. Nested properties are supported\n * with the dotted notation. (i.e 'author.name')\n *\n * Note: this method is a 'best attempt' at getting an entity's property.\n * It fits the most common cases but you might need to explicitely define\n * a property getter when using an EntityStore, for example.\n * @param entity Entity\n * @param property Property name\n * @returns Property value\n */\nexport function getEntityProperty(entity: object, property: string): any {\n  return t(entity, property).safeObject;\n}\n\n/**\n * Get an entity's id. An entity's id can be one of:\n * 'entity.meta.id', 'entity.meta.idProperty' or 'entity.id'.\n *\n * Note: See the note in the 'getEntityProperty' documentation.\n * @param entity Entity\n * @returns Entity id\n */\nexport function getEntityId(entity: object): EntityKey {\n  const meta = (entity as any).meta || {};\n  return meta.id ? meta.id : getEntityProperty(entity, meta.idProperty || 'id');\n}\n\n/**\n * Get an entity's title. An entity's title can be one of:\n * 'entity.meta.title', 'entity.meta.titleProperty' or 'entity.title'.\n * @param entity Entity\n * @returns Entity title\n */\nexport function getEntityTitle(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.title ? meta.title : getEntityProperty(entity, meta.titleProperty || 'title');\n}\n\n/**\n * Get an entity's HTML title. An entity's HTML title can be one of:\n * 'entity.meta.titleHtml', 'entity.meta.titleHtmlProperty' or 'entity.titleHtml'.\n * @param entity Entity\n * @returns Entity HTML title\n */\nexport function getEntityTitleHtml(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.titleHtml ? meta.titleHtml : getEntityProperty(entity, meta.titleHtmlProperty || 'titleHtml');\n}\n\n/**\n * Get an entity's icon. An entity's icon can be one of:\n * 'entity.meta.icon', 'entity.meta.iconProperty' or 'entity.icon'.\n * @param entity Entity\n * @returns Entity icon\n */\nexport function getEntityIcon(entity: object): string {\n  const meta = (entity as any).meta || {};\n  return meta.icon ? meta.icon : getEntityProperty(entity, meta.iconProperty || 'icon');\n}\n\n/**\n * Get an entity's revision.\n * @param entity Entity\n * @returns Entity revision\n */\nexport function getEntityRevision(entity: object): number {\n  const meta = (entity as any).meta || {};\n  return meta.revision || 0;\n}\n","import { ReplaySubject } from 'rxjs';\n\nimport { EntityKey, EntityState, EntityStateManagerOptions } from './entity.interfaces';\nimport { getEntityId } from './entity.utils';\nimport { EntityStore } from './store';\n\n/**\n * This class is used to track a store's entities state\n */\nexport class EntityStateManager<E extends object, S extends EntityState = EntityState> {\n\n  /**\n   * State index\n   */\n  readonly index = new Map<EntityKey, S>();\n\n  /**\n   * Change emitter\n   */\n  readonly change$ = new ReplaySubject<void>(1);\n\n  /**\n   * Method to get an entity's id\n   */\n  readonly getKey: (E) => EntityKey;\n\n  private store: EntityStore<object> | undefined;\n\n  constructor(options: EntityStateManagerOptions = {}) {\n    this.store = options.store ? options.store : undefined;\n    this.getKey = options.getKey\n      ? options.getKey\n      : (this.store ? this.store.getKey : getEntityId);\n    this.next();\n  }\n\n  /**\n   * Clear state\n   */\n  clear() {\n    if (this.index.size > 0) {\n      this.index.clear();\n      this.next();\n    }\n  }\n\n  /**\n   * Get an entity's state\n   * @param entity Entity\n   * @returns State\n   */\n  get(entity: E): S {\n    return (this.index.get(this.getKey(entity)) || {}) as S;\n  }\n\n  /**\n   * Set an entity's state\n   * @param entity Entity\n   * @param state State\n   */\n  set(entity: E, state: S) {\n    this.setMany([entity], state);\n  }\n\n  /**\n   * Set many entitie's state\n   * @param entitie Entities\n   * @param state State\n   */\n  setMany(entities: E[], state: S) {\n    entities.forEach((entity: E) => {\n      this.index.set(this.getKey(entity), Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Set state of all entities that already have a state. This is not\n   * the same as setting the state of all the store's entities.\n   * @param state State\n   */\n  setAll(state: S) {\n    Array.from(this.index.keys()).forEach((key: EntityKey) => {\n      this.index.set(key, Object.assign({}, state));\n    });\n    this.next();\n  }\n\n  /**\n   * Update an entity's state\n   * @param entity Entity\n   * @param changes State changes\n   */\n  update(entity: E, changes: Partial<S>, exclusive = false) {\n    this.updateMany([entity], changes, exclusive);\n  }\n\n  /**\n   * Update many entitie's state\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  updateMany(entities: E[], changes: Partial<S>, exclusive = false) {\n    if (exclusive === true) {\n      return this.updateManyExclusive(entities, changes);\n    }\n\n    entities.forEach((entity: E) => {\n      const state = Object.assign({}, this.get(entity), changes);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Reversee an entity's state\n   * @param entity Entity\n   * @param keys State keys to reverse\n   */\n  reverse(entity: E, keys: string[]) {\n    this.reverseMany([entity], keys);\n  }\n\n  /**\n   * Reverse many entitie's state\n   * @param entitie Entities\n   * @param keys State keys to reverse\n   */\n  reverseMany(entities: E[], keys: string[]) {\n    entities.forEach((entity: E) => {\n      const currentState = this.get(entity);\n      const changes = keys.reduce((acc: {[key: string]: boolean}, key: string) => {\n        acc[key] = currentState[key] || false;\n        return acc;\n      }, {}) as Partial<S>;\n      const reversedChanges = this.reverseChanges(changes);\n      const state = Object.assign({}, currentState, reversedChanges);\n      this.index.set(this.getKey(entity), state);\n    });\n    this.next();\n  }\n\n  /**\n   * Update state of all entities that already have a state. This is not\n   * the same as updating the state of all the store's entities.\n   * @param changes State\n   */\n  updateAll(changes: Partial<S>) {\n    const allKeys = this.getAllKeys();\n    Array.from(allKeys).forEach((key: EntityKey) => {\n      const state = Object.assign({}, this.index.get(key), changes);\n      this.index.set(key, state);\n    });\n    this.next();\n  }\n\n  /**\n   * When some state changes are flagged as 'exclusive', reverse\n   * the state of all other entities. Changes are reversable when\n   * they are boolean.\n   * @param entitie Entities\n   * @param changes State changes\n   */\n  private updateManyExclusive(entities: E[], changes: Partial<S>) {\n    const reverseChanges = this.reverseChanges(changes);\n\n    const keys = entities.map((entity: E) => this.getKey(entity));\n    const allKeys = new Set(keys.concat(Array.from(this.getAllKeys())));\n    allKeys.forEach((key: EntityKey) => {\n      const state = this.index.get(key) || {} as S;\n\n      if (keys.indexOf(key) >= 0) {\n        this.index.set(key, Object.assign({}, state, changes));\n      } else {\n        // Update only if the reverse changes would modify\n        // a key already present in the current state\n        const shouldUpdate = Object.keys(reverseChanges).some((changeKey: string) => {\n          return state[changeKey] !== undefined &&\n            state[changeKey] !== reverseChanges[changeKey];\n        });\n        if (shouldUpdate === true) {\n          this.index.set(key, Object.assign({}, state, reverseChanges));\n        }\n      }\n    });\n\n    this.next();\n  }\n\n  /**\n   * Compute a 'reversed' version of some state changes.\n   * Changes are reversable when they are boolean.\n   * @param changes State changes\n   * @returns Reversed state changes\n   */\n  private reverseChanges(changes: Partial<S>): Partial<S> {\n    return Object.entries(changes).reduce((reverseChanges: Partial<S>, bunch: [string, any]) => {\n      const [changeKey, value] = bunch;\n      if (typeof value === typeof true) {\n        (reverseChanges as object)[changeKey] = !value;\n      }\n      return reverseChanges;\n    }, {});\n  }\n\n  /**\n   * Return all the keys in that state and in the store it's bound to, if any.\n   * @returns Set of keys\n   */\n  private getAllKeys(): Set<EntityKey> {\n    const storeKeys = this.store ? Array.from(this.store.index.keys()) : [];\n    return new Set(Array.from(this.index.keys()).concat(storeKeys));\n  }\n\n  /**\n   * Emit 'change' event\n   */\n  private next() {\n    this.change$.next();\n  }\n\n}\n","import { BehaviorSubject, Observable, Subscription, combineLatest } from 'rxjs';\nimport { debounceTime, map, skip } from 'rxjs/operators';\n\nimport { ObjectUtils, uuid } from '@igo2/utils';\nimport {\n  EntityKey,\n  EntityFilterClause,\n  EntitySortClause,\n  EntityJoinClause\n} from './entity.interfaces';\n\n/**\n * An entity view streams entities from an observable source. These entities\n * can be filtered or sorted without affecting the source. A view can also\n * combine data from multiple sources, joined together.\n */\nexport class EntityView<E extends object, V extends object = E> {\n\n  /**\n   * Observable stream of values\n   */\n  readonly values$ = new BehaviorSubject<V[]>([]);\n\n  /**\n   * Subscription to the source (and joined sources) values\n   */\n  private values$$: Subscription;\n\n  /**\n   * Whether this view has been lifted\n   */\n  private lifted = false;\n\n  /**\n   * Join clauses\n   */\n  private joins: EntityJoinClause[] = [];\n\n  /**\n   * Observable of a filter clause\n   */\n  private filter$ = new BehaviorSubject(undefined);\n\n  /**\n   * Observable of filter clauses\n   */\n  private filters$: BehaviorSubject<EntityFilterClause[]> = new BehaviorSubject([]);\n\n  /**\n   * Filters index\n   */\n  private filterIndex: Map<string, EntityFilterClause> = new Map();\n\n  /**\n   * Observable of a sort clause\n   */\n  private sort$ = new BehaviorSubject(undefined);\n\n  /**\n   * Method for indexing\n   */\n  get getKey(): (V) => EntityKey { return this.getKey$.value; }\n  private getKey$: BehaviorSubject<(V) => EntityKey> = new BehaviorSubject(undefined);\n\n  /**\n   * Number of entities\n   */\n  readonly count$ = new BehaviorSubject<number>(0);\n  get count(): number { return this.count$.value; }\n\n  /**\n   * Whether the store is empty\n   */\n  readonly empty$ = new BehaviorSubject<boolean>(true);\n  get empty(): boolean { return this.empty$.value; }\n\n  /**\n   * Store index\n   */\n  get index(): Map<EntityKey, V> { return this._index; }\n  private _index: Map<EntityKey, V>;\n\n  constructor(private source$: BehaviorSubject<E[]>) {}\n\n  /**\n   * Get a value from the view by key\n   * @param key Key\n   * @returns Value\n   */\n  get(key: EntityKey): V {\n    if (this._index === undefined) {\n      throw new Error('This view has no index, therefore, this method is unavailable.');\n    }\n    return this.index.get(key);\n  }\n\n  /**\n   * Get all the values\n   * @returns Array of values\n   */\n  all(): V[] {\n    return this.values$.value;\n  }\n\n  /**\n   * Observe all the values\n   * @returns Observable of values\n   */\n  all$(): BehaviorSubject<V[]> {\n    return this.values$;\n  }\n\n  /**\n   * Get the first value that respects a criteria\n   * @returns A value\n   */\n  firstBy(clause: EntityFilterClause<V>): V {\n    return this.values$.value.find(clause);\n  }\n\n  /**\n   * Observe the first value that respects a criteria\n   * @returns Observable of a value\n   */\n  firstBy$(clause: EntityFilterClause<V>): Observable<V> {\n    return this.values$.pipe(map((values: V[]) => values.find(clause)));\n  }\n\n  /**\n   * Get all the values that respect a criteria\n   * @returns Array of values\n   */\n  manyBy(clause: EntityFilterClause<V>): V[] {\n    return this.values$.value.filter(clause);\n  }\n\n  /**\n   * Observe all the values that respect a criteria\n   * @returns Observable of values\n   */\n  manyBy$(clause: EntityFilterClause<V>): Observable<V[]> {\n    return this.values$.pipe(map((values: V[]) => values.filter(clause)));\n  }\n\n  /**\n   * Clear the filter and sort and unsubscribe from the source\n   */\n  clear() {\n    this.filter(undefined);\n    this.sort(undefined);\n  }\n\n  destroy() {\n    if (this.values$$ !== undefined) {\n      this.values$$.unsubscribe();\n    }\n    this.clear();\n  }\n\n  /**\n   * Create an index\n   * @param getKey Method to get a value's id\n   * @returns The view\n   */\n  createIndex(getKey: (E) => EntityKey): EntityView<E, V> {\n    this._index = new Map();\n    this.getKey$.next(getKey);\n    return this;\n  }\n\n  /**\n   * Join another source to the stream (chainable)\n   * @param clause Join clause\n   * @returns The view\n   */\n  join(clause: EntityJoinClause): EntityView<E, V> {\n    if (this.lifted === true) {\n      throw new Error('This view has already been lifted, therefore, no join is allowed.');\n    }\n    this.joins.push(clause);\n    return this;\n  }\n\n  /**\n   * Filter values (chainable)\n   * @param clause Filter clause\n   * @returns The view\n   */\n  filter(clause: EntityFilterClause<V>): EntityView<E, V> {\n    this.filter$.next(clause);\n    return this;\n  }\n\n  /**\n   * @param clause Filter clause\n   * @returns The filter id\n   */\n  addFilter(clause: EntityFilterClause<V>): string {\n    const id = uuid();\n    this.filterIndex.set(id, clause);\n    this.filters$.next(Array.from(this.filterIndex.values()));\n    return id;\n  }\n\n  /**\n   * Remove a filter by id\n   * @param clause Filter clause\n   */\n  removeFilter(id: string) {\n    this.filterIndex.delete(id);\n    this.filters$.next(Array.from(this.filterIndex.values()));\n  }\n\n  /**\n   * Sort values (chainable)\n   * @param clauseSort clause\n   * @returns The view\n   */\n  sort(clause: EntitySortClause<V>): EntityView<E, V> {\n    this.sort$.next(clause);\n    return this;\n  }\n\n  /**\n   * Create the final observable\n   * @returns Observable\n   */\n  lift() {\n    this.lifted = true;\n    const source$ = this.joins.length > 0 ? this.liftJoinedSource() : this.liftSource();\n    const observables$ = [\n      source$,\n      this.filters$,\n      this.filter$,\n      this.sort$,\n      this.getKey$\n    ];\n\n    this.values$$ = combineLatest(observables$)\n      .pipe(skip(1), debounceTime(5))\n      .subscribe((bunch: any[]) => {\n        const [_values, filters, filter, sort, getKey] = bunch;\n        const values = this.processValues(_values, filters, filter, sort);\n        const generateIndex = getKey !== undefined;\n        this.setValues(values, generateIndex);\n      });\n  }\n\n  /**\n   * Create the source observable when no joins are defined\n   * @returns Observable\n   */\n  private liftSource(): Observable<V[]> {\n    return this.source$ as any as Observable<V[]>;\n  }\n\n  /**\n   * Create the source observable when joins are defined\n   * @returns Observable\n   */\n  private liftJoinedSource(): Observable<V[]> {\n    const sources$ = [this.source$, combineLatest(\n      this.joins.map((join: EntityJoinClause) => join.source)\n    )];\n\n    return combineLatest(sources$)\n      .pipe(\n        map((bunch: [E[], any[]]) => {\n          const [entities, joinData] = bunch;\n          return entities.reduce((values: V[], entity: E) => {\n            const value = this.computeJoinedValue(entity, joinData);\n            if (value !== undefined) {\n              values.push(value);\n            }\n            return values;\n          }, []);\n        })\n      );\n  }\n\n  /**\n   * Apply joins to a source's entity and return the final value\n   * @returns Final value\n   */\n  private computeJoinedValue(entity: E, joinData: any[]): V | undefined {\n    let value = entity as Partial<V>;\n    let joinIndex = 0;\n    while (value !== undefined && joinIndex < this.joins.length) {\n      value = this.joins[joinIndex].reduce(value, joinData[joinIndex]);\n      joinIndex += 1;\n    }\n    return value as V;\n  }\n\n  /**\n   * Filter and sort values before streaming them\n   * @param values Values\n   * @param filters Filter clauses\n   * @param filter Filter clause\n   * @param sort Sort clause\n   * @returns Filtered and sorted values\n   */\n  private processValues(\n    values: V[], filters: EntityFilterClause[], filter: EntityFilterClause, sort: EntitySortClause\n  ): V[] {\n    values = values.slice(0);\n    values = this.filterValues(values, filters.concat([filter]));\n    values = this.sortValues(values, sort);\n    return values;\n  }\n\n  /**\n   * Filter values\n   * @param values Values\n   * @param filters Filter clauses\n   * @returns Filtered values\n   */\n  private filterValues(values: V[], clauses: EntityFilterClause[]): V[] {\n    if (clauses.length === 0) { return values; }\n\n    return values\n      .filter((value: V) => {\n        return clauses\n          .filter((clause: EntityFilterClause) => clause !== undefined)\n          .every((clause: EntityFilterClause) => clause(value));\n      });\n  }\n\n  /**\n   * Sort values\n   * @param values Values\n   * @param sort Sort clause\n   * @returns Sorted values\n   */\n  private sortValues(values: V[], clause: EntitySortClause): V[] {\n    if (clause === undefined) { return values; }\n    return values.sort((v1: V, v2: V) => {\n      return ObjectUtils.naturalCompare(\n        clause.valueAccessor(v1),\n        clause.valueAccessor(v2),\n        clause.direction,\n        clause.nullsFirst\n      );\n    });\n  }\n\n  /**\n   * Set value and optionally generate an index\n   * @param values Values\n   * @param generateIndex boolean\n   */\n  private setValues(values: V[], generateIndex: boolean) {\n    if (generateIndex === true) {\n      this._index = this.generateIndex(values);\n    }\n\n    this.values$.next(values);\n\n    const count = values.length;\n    const empty = count === 0;\n    this.count$.next(count);\n    this.empty$.next(empty);\n  }\n\n  /**\n   * Generate a complete index of all the values\n   * @param entities Entities\n   * @returns Index\n   */\n  private generateIndex(values: V[]): Map<EntityKey, V> {\n    const entries = values.map((value: V) => [this.getKey(value), value]);\n    return new Map(entries as [EntityKey, V][]);\n  }\n}\n","import { BehaviorSubject } from 'rxjs';\n\nimport { EntityStateManager } from './state';\nimport { EntityView } from './view';\nimport { EntityKey, EntityState, EntityRecord, EntityStoreOptions } from './entity.interfaces';\nimport { getEntityId, getEntityProperty } from './entity.utils';\nimport { EntityStoreStrategy } from './strategies/strategy';\n\n/**\n * An entity store class holds any number of entities\n * as well as their state. It can be observed, filtered and sorted and\n * provides methods to insert, update or delete entities.\n */\nexport class EntityStore<E extends object = object, S extends EntityState = EntityState> {\n\n  /**\n   * Observable of the raw entities\n   */\n  readonly entities$ = new BehaviorSubject<E[]>([]);\n\n  /**\n   * Number of entities\n   */\n  readonly count$ = new BehaviorSubject<number>(0);\n  get count(): number { return this.count$.value; }\n\n  /**\n   * Whether the store is empty\n   */\n  readonly empty$ = new BehaviorSubject<boolean>(true);\n  get empty(): boolean { return this.empty$.value; }\n\n  /**\n   * Entity store state\n   */\n  readonly state: EntityStateManager<E, S>;\n\n  /**\n   * View of all the entities\n   */\n  readonly view: EntityView<E>;\n\n  /**\n   * View of all the entities and their state\n   */\n  readonly stateView: EntityView<E, EntityRecord<E, S>>;\n\n  /**\n   * Method to get an entity's id\n   */\n  readonly getKey: (E) => EntityKey;\n\n  /**\n   * Method to get an entity's named property\n   */\n  readonly getProperty: (E, prop: string) => any;\n\n  /**\n   * Store index\n   */\n  get index(): Map<EntityKey, E> { return this._index; }\n  private _index: Map<EntityKey, E>;\n\n  /**\n   * Store index\n   */\n  get pristine(): boolean { return this._pristine; }\n  private _pristine: boolean = true;\n\n  /**\n   * Strategies\n   */\n  private strategies: EntityStoreStrategy[] = [];\n\n  constructor(entities: E[], options: EntityStoreOptions = {}) {\n    this.getKey = options.getKey ? options.getKey : getEntityId;\n    this.getProperty = options.getProperty ? options.getProperty : getEntityProperty;\n\n    this.state = this.createStateManager();\n    this.view = this.createDataView();\n    this.stateView = this.createStateView();\n\n    this.view.lift();\n    this.stateView.lift();\n\n    if (entities.length > 0) {\n      this.load(entities);\n    } else {\n      this._index = this.generateIndex(entities);\n    }\n  }\n\n  /**\n   * Get an entity from the store by key\n   * @param key Key\n   * @returns Entity\n   */\n  get(key: EntityKey): E {\n    return this.index.get(key);\n  }\n\n  /**\n   * Get all entities in the store\n   * @returns Array of entities\n   */\n  all(): E[] {\n    return this.entities$.value;\n  }\n\n  /**\n   * Set this store's entities\n   * @param entities Entities\n   */\n  load(entities: E[], pristine: boolean = true) {\n    this._index = this.generateIndex(entities);\n    this._pristine = pristine;\n    this.next();\n  }\n\n  /**\n   * Clear the store's entities but keep the state and views intact.\n   * Views won't return any data but future data will be subject to the\n   * current views filter and sort\n   */\n  softClear() {\n    if (this.index && this.index.size > 0) {\n      this.index.clear();\n      this._pristine = true;\n      this.next();\n    } else if (this.index) {\n      this.updateCount();\n    }\n  }\n\n  /**\n   * Clear the store's entities, state and views\n   */\n  clear() {\n    this.stateView.clear();\n    this.view.clear();\n    this.state.clear();\n    this.softClear();\n  }\n\n  destroy() {\n    this.stateView.destroy();\n    this.view.destroy();\n    this.clear();\n  }\n\n  /**\n   * Insert an entity into the store\n   * @param entity Entity\n   */\n  insert(entity: E) {\n    this.insertMany([entity]);\n  }\n\n  /**\n   * Insert many entities into the store\n   * @param entities Entities\n   */\n  insertMany(entities: E[]) {\n    entities.forEach((entity: E) => this.index.set(this.getKey(entity), entity));\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Update or insert an entity into the store\n   * @param entity Entity\n   */\n  update(entity: E) {\n    this.updateMany([entity]);\n  }\n\n  /**\n   * Update or insert many entities into the store\n   * @param entities Entities\n   */\n  updateMany(entities: E[]) {\n    entities.forEach((entity: E) => this.index.set(this.getKey(entity), entity));\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Delete an entity from the store\n   * @param entity Entity\n   */\n  delete(entity: E) {\n    this.deleteMany([entity]);\n  }\n\n  /**\n   * Delete many entities from the store\n   * @param entities Entities\n   */\n  deleteMany(entities: E[]) {\n    entities.forEach((entity: E) => this.index.delete(this.getKey(entity)));\n    this._pristine = false;\n    this.next();\n  }\n\n  /**\n   * Add a strategy to this store\n   * @param strategy Entity store strategy\n   * @returns Entity store\n   */\n  addStrategy(strategy: EntityStoreStrategy, activate: boolean = false): EntityStore {\n    const existingStrategy = this.strategies.find((_strategy: EntityStoreStrategy) => {\n      return strategy.constructor === _strategy.constructor;\n    });\n    if (existingStrategy !== undefined) {\n      throw new Error('A strategy of this type already exists on that EntityStore.');\n    }\n\n    this.strategies.push(strategy);\n    strategy.bindStore(this);\n\n    if (activate === true) {\n      strategy.activate();\n    }\n\n    return this;\n  }\n\n  /**\n   * Remove a strategy from this store\n   * @param strategy Entity store strategy\n   * @returns Entity store\n   */\n  removeStrategy(strategy: EntityStoreStrategy): EntityStore {\n    const index = this.strategies.indexOf(strategy);\n    if (index >= 0) {\n      this.strategies.splice(index, 1);\n      strategy.unbindStore(this);\n    }\n    return this;\n  }\n\n  /**\n   * Return strategies of a given type\n   * @param type Entity store strategy class\n   * @returns Strategies\n   */\n  getStrategyOfType(type: typeof EntityStoreStrategy): EntityStoreStrategy {\n    return this.strategies.find((strategy: EntityStoreStrategy) => {\n      return strategy instanceof type;\n    });\n  }\n\n  /**\n   * Activate strategies of a given type\n   * @param type Entity store strategy class\n   */\n  activateStrategyOfType(type: typeof EntityStoreStrategy) {\n    const strategy = this.getStrategyOfType(type);\n    if (strategy !== undefined) {\n      strategy.activate();\n    }\n  }\n\n  /**\n   * Deactivate strategies of a given type\n   * @param type Entity store strategy class\n   */\n  deactivateStrategyOfType(type: typeof EntityStoreStrategy) {\n    const strategy = this.getStrategyOfType(type);\n    if (strategy !== undefined) {\n      strategy.deactivate();\n    }\n  }\n\n  /**\n   * Generate a complete index of all the entities\n   * @param entities Entities\n   * @returns Index\n   */\n  private generateIndex(entities: E[]): Map<EntityKey, E> {\n    const entries = entities.map((entity: E) => [this.getKey(entity), entity]);\n    return new Map(entries as [EntityKey, E][]);\n  }\n\n  /**\n   * Push the index's entities into the entities$ observable\n   */\n  private next() {\n    this.entities$.next(Array.from(this.index.values()));\n    this.updateCount();\n  }\n\n  /**\n   * Update the store's count and empty\n   */\n  private updateCount() {\n    const count = this.index.size;\n    const empty = count === 0;\n    this.count$.next(count);\n    this.empty$.next(empty);\n  }\n\n  /**\n   * Create the entity state manager\n   * @returns EntityStateManager\n   */\n  private createStateManager() {\n    return new EntityStateManager<E, S>({store: this});\n  }\n\n  /**\n   * Create the data view\n   * @returns EntityView<E>\n   */\n  private createDataView() {\n    return new EntityView<E>(this.entities$);\n  }\n\n  /**\n   * Create the state view\n   * @returns EntityView<EntityRecord<E>>\n   */\n  private createStateView() {\n    return new EntityView<E, EntityRecord<E, S>>(this.view.all$())\n      .join({\n        source: this.state.change$,\n        reduce: (entity: E): EntityRecord<E, S> => {\n          const key = this.getKey(entity);\n          const state = this.state.get(entity);\n          const currentRecord = this.stateView.get(key);\n\n          if (\n            currentRecord !== undefined &&\n            currentRecord.entity === entity &&\n            this.statesAreTheSame(currentRecord.state, state)\n          ) {\n            return currentRecord;\n          }\n\n          const revision = currentRecord ? currentRecord.revision + 1 : 1;\n          const ref = `${key}-${revision}`;\n          return {entity, state, revision, ref};\n        }\n      })\n      .createIndex((record: EntityRecord<E, S>) => this.getKey(record.entity));\n  }\n\n  private statesAreTheSame(currentState: S, newState: S): boolean {\n    if (currentState === newState) {\n      return true;\n    }\n\n    const currentStateIsEmpty = Object.keys(currentState).length === 0;\n    const newStateIsEmpty = Object.keys(newState).length === 0;\n    return currentStateIsEmpty && newStateIsEmpty;\n  }\n\n}\n","import { ChangeDetectorRef } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { skip } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { EntityKey } from './entity.interfaces';\n\nimport { EntityStore } from './store';\n\n/**\n * This class is used to synchronize a component's changes\n * detection with an EntityStore changes. For example, it is frequent\n * to have a component subscribe to a store's selected entity and, at the same time,\n * this component provides a way to select an entity with, let's say, a click.\n *\n * This class automatically handles those case and triggers the compoent's\n * change detection when needed.\n *\n * Note: If the component observes the store's stateView, a workspace is\n * probably not required because the stateView catches any changes to the\n * entities and their state.\n */\nexport class EntityStoreWatcher<E extends object> {\n\n  /**\n   * Component change detector\n   */\n  private cdRef: ChangeDetectorRef;\n\n  /**\n   * Entity store\n   */\n  private store: EntityStore<E>;\n\n  /**\n   * Component inner state\n   */\n  private innerStateIndex = new Map<EntityKey, {[key: string]: any}>();\n\n  /**\n   * Subscription to the store's entities\n   */\n  private entities$$: Subscription;\n\n  /**\n   * Subscription to the store's state\n   */\n  private state$$: Subscription;\n\n  constructor(store?: EntityStore<E>, cdRef?: ChangeDetectorRef) {\n    this.setChangeDetector(cdRef);\n    this.setStore(store);\n  }\n\n  destroy() {\n    this.setChangeDetector(undefined);\n    this.setStore(undefined);\n  }\n\n  /**\n   * Bind this workspace to a store and start watching for changes\n   * @param store Entity store\n   */\n  setStore(store?: EntityStore<E>) {\n    if (store === undefined) {\n      this.teardownObservers();\n      this.innerStateIndex.clear();\n      this.store = undefined;\n      return;\n    }\n\n    this.setStore(undefined);\n    this.store = store;\n    this.setupObservers();\n    this.detectChanges();\n  }\n\n  /**\n   * Bind this workspace to a component's change detector\n   * @param cdRef Change detector\n   */\n  setChangeDetector(cdRef?: ChangeDetectorRef) {\n    this.cdRef = cdRef;\n  }\n\n  /**\n   * Set up observers on a store's entities and their state\n   * @param store Entity store\n   */\n  private setupObservers() {\n    this.teardownObservers();\n\n    this.entities$$ = this.store.entities$\n      .subscribe((entities: E[]) => this.onEntitiesChange(entities));\n\n    this.state$$ = this.store.state.change$\n      .pipe(skip(1))\n      .subscribe(() => this.onStateChange());\n  }\n\n  /**\n   * Teardown store observers\n   */\n  private teardownObservers() {\n    if (this.entities$$ !== undefined) {\n      this.entities$$.unsubscribe();\n    }\n    if (this.state$$ !== undefined) {\n      this.state$$.unsubscribe();\n    }\n    this.entities$$ = undefined;\n    this.state$$ = undefined;\n  }\n\n  /**\n   * When the entities change, always trigger the changes detection\n   */\n  private onEntitiesChange(entities: E[]) {\n    this.detectChanges();\n  }\n\n  /**\n   * When the entities state change, trigger the change detection\n   * only if the component has not handled these changes yet. For example,\n   * the component might have initiated thoses changes itself.\n   */\n  private onStateChange() {\n    let changesDetected = false;\n    const storeIndex = this.store.state.index;\n    const innerIndex = this.innerStateIndex;\n\n    if (storeIndex.size !== innerIndex.size) {\n      changesDetected = this.detectChanges();\n    }\n\n    const storeKeys = Array.from(storeIndex.keys());\n    for (const key of storeKeys) {\n      const storeValue = storeIndex.get(key);\n      const innerValue = innerIndex.get(key);\n      if (changesDetected === false) {\n        if (innerValue === undefined) {\n          changesDetected = this.detectChanges();\n        } else if (!ObjectUtils.objectsAreEquivalent(storeValue, innerValue)) {\n          changesDetected = this.detectChanges();\n        }\n      }\n\n      this.innerStateIndex.set(key, Object.assign({}, storeValue));\n    }\n  }\n\n  /**\n   * Trigger the change detection of the workspace is bound to a change detector\n   */\n  private detectChanges() {\n    if (this.cdRef !== undefined) {\n      this.cdRef.detectChanges();\n    }\n    return true;\n  }\n\n}\n","import { BehaviorSubject } from 'rxjs';\n\nimport { EntityStoreStrategyOptions } from '../entity.interfaces';\nimport { EntityStore } from '../store';\n\n/**\n * Entity store strategies. They can do pretty much anything during a store's\n * lifetime. For example, they may act as triggers when something happens.\n * Sharing a strategy is a good idea when multiple strategies would have\n * on cancelling effect on each other.\n *\n * At creation, strategy is inactive and needs to be manually activated.\n */\nexport class EntityStoreStrategy {\n\n  /**\n   * Feature store\n   * @internal\n   */\n  protected stores: EntityStore[] = [];\n\n  /**\n   * Whether this strategy is active\n   * @internal\n   */\n  get active(): boolean { return this.active$.value; }\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  constructor(protected options: EntityStoreStrategyOptions = {}) {\n    this.options = options;\n  }\n\n  /**\n   * Activate the strategy. If it's already active, it'll be deactivated\n   * and activated again.\n   */\n  activate() {\n    if (this.active === true) {\n      this.doDeactivate();\n    }\n    this.active$.next(true);\n    this.doActivate();\n  }\n\n  /**\n   * Activate the strategy. If it's already active, it'll be deactivated\n   * and activated again.\n   */\n  deactivate() {\n    this.active$.next(false);\n    this.doDeactivate();\n  }\n\n  /**\n   * Bind this strategy to a store\n   * @param store Feature store\n   */\n  bindStore(store: EntityStore) {\n    if (this.stores.indexOf(store) < 0) {\n      this.stores.push(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from store\n   * @param store Feature store\n   */\n  unbindStore(store: EntityStore) {\n    const index = this.stores.indexOf(store);\n    if (index >= 0) {\n      this.stores.splice(index, 1);\n    }\n  }\n\n  /**\n   * Do the stataegy activation\n   * @internal\n   */\n  protected doActivate() {}\n\n  /**\n   * Do the strategy deactivation\n   * @internal\n   */\n  protected doDeactivate() {}\n\n}\n","import { EntityStoreStrategyFuncOptions } from '../entity.interfaces';\nimport { EntityStore } from '../store';\nimport { EntityStoreStrategy } from './strategy';\n\n/**\n * When active, this strategy filters a store's stateView to return\n * selected entities only.\n */\nexport class EntityStoreFilterCustomFuncStrategy extends EntityStoreStrategy {\n\n  constructor(protected options: EntityStoreStrategyFuncOptions) {\n    super(options);\n  }\n\n  /**\n   * Store / filter ids map\n   */\n  private filters: Map<EntityStore, string> = new Map();\n\n  /**\n   * Bind this strategy to a store and start filtering it\n   * @param store Entity store\n   */\n  bindStore(store: EntityStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.filterStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop filtering it\n   * @param store Entity store\n   */\n  unbindStore(store: EntityStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unfilterStore(store);\n    }\n  }\n\n  /**\n   * Start filtering all stores\n   * @internal\n   */\n  protected doActivate() {\n    this.filterAll();\n  }\n\n  /**\n   * Stop filtering all stores\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unfilterAll();\n  }\n\n  /**\n   * Filter all stores\n   */\n  private filterAll() {\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\n  }\n\n  /**\n   * Unfilter all stores\n   */\n  private unfilterAll() {\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\n  }\n\n  /**\n   * Filter a store and add it to the filters map\n   */\n  private filterStore(store: EntityStore) {\n    this.filters.set(store, store.stateView.addFilter(this.options.filterClauseFunc));\n  }\n\n  /**\n   * Unfilter a store and delete it from the filters map\n   */\n  private unfilterStore(store: EntityStore) {\n    const filterId = this.filters.get(store);\n    if (filterId === undefined) {\n      return;\n    }\n\n    store.stateView.removeFilter(filterId);\n    this.filters.delete(store);\n  }\n}\n","import { EntityRecord } from '../entity.interfaces';\nimport { EntityStore } from '../store';\nimport { EntityStoreStrategy } from './strategy';\n\n/**\n * When active, this strategy filters a store's stateView to return\n * selected entities only.\n */\nexport class EntityStoreFilterSelectionStrategy extends EntityStoreStrategy {\n\n  /**\n   * Store / filter ids map\n   */\n  private filters: Map<EntityStore, string> = new Map();\n\n  /**\n   * Bind this strategy to a store and start filtering it\n   * @param store Entity store\n   */\n  bindStore(store: EntityStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.filterStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop filtering it\n   * @param store Entity store\n   */\n  unbindStore(store: EntityStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unfilterStore(store);\n    }\n  }\n\n  /**\n   * Start filtering all stores\n   * @internal\n   */\n  protected doActivate() {\n    this.filterAll();\n  }\n\n  /**\n   * Stop filtering all stores\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unfilterAll();\n  }\n\n  /**\n   * Filter all stores\n   */\n  private filterAll() {\n    this.stores.forEach((store: EntityStore) => this.filterStore(store));\n  }\n\n  /**\n   * Unfilter all stores\n   */\n  private unfilterAll() {\n    this.stores.forEach((store: EntityStore) => this.unfilterStore(store));\n  }\n\n  /**\n   * Filter a store and add it to the filters map\n   */\n  private filterStore(store: EntityStore) {\n    if (this.filters.has(store)) {\n      return;\n    }\n\n    const filter = (record: EntityRecord<object>) => {\n      return record.state.selected === true;\n    };\n    this.filters.set(store, store.stateView.addFilter(filter));\n  }\n\n  /**\n   * Unfilter a store and delete it from the filters map\n   */\n  private unfilterStore(store: EntityStore) {\n    const filterId = this.filters.get(store);\n    if (filterId === undefined) {\n      return;\n    }\n\n    store.stateView.removeFilter(filterId);\n    this.filters.delete(store);\n  }\n}\n","<mat-form-field class=\"igo-entity-selector\">\n  <mat-select\n    [disabled]=\"disabled\"\n    [value]=\"selected$ | async\"\n    [multiple]=\"multi\"\n    [placeholder]=\"placeholder\"\n    (selectionChange)=\"onSelectionChange($event)\">\n    <mat-option *ngIf=\"emptyText !== undefined && multi === false\" [value]=\"emptyValue\">{{emptyText}}</mat-option>\n    <mat-option *ngIf=\"multi === true\" [value]=\"multiSelectValue\">{{multiText$ | async}}</mat-option>\n    <ng-template ngFor let-record [ngForOf]=\"store.stateView.all$() | async\">\n      <mat-option [value]=\"record.entity\">\n        {{titleAccessor(record.entity)}}\n      </mat-option>\n    </ng-template>\n  </mat-select>\n</mat-form-field>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { EntityRecord } from '../shared/entity.interfaces';\nimport { EntityStore } from '../shared/store';\nimport { EntityStoreWatcher } from '../shared/watcher';\nimport { getEntityTitle } from '../shared/entity.utils';\n\n@Component({\n  selector: 'igo-entity-selector',\n  templateUrl: './entity-selector.component.html',\n  styleUrls: ['./entity-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class EntitySelectorComponent implements OnInit, OnDestroy {\n\n  /**\n   * The selected entity\n   * @internal\n   */\n  readonly selected$ = new BehaviorSubject<object>(undefined);\n\n  /**\n   * The current multi select option text\n   * @internal\n   */\n  readonly multiText$ = new BehaviorSubject<string>(undefined);\n\n  readonly multiSelectValue = {id: 'IGO_MULTI_SELECT'};\n\n  readonly emptyValue = {id: 'IGO_EMPTY_SELECT'};\n\n  /**\n   * Subscription to the selected entity\n   */\n  private selected$$: Subscription;\n\n  /**\n   * Store watcher\n   */\n  private watcher: EntityStoreWatcher<object>;\n\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Title accessor\n   */\n  @Input() titleAccessor: (object) => string = getEntityTitle;\n\n  /**\n   * Text to display when nothing is selected\n   */\n  @Input() emptyText: string = undefined;\n\n  /**\n   * Wheter selecting many entities is allowed\n   */\n  @Input() multi: boolean = false;\n\n  /**\n   * Text to display for the select all option\n   */\n  @Input() multiAllText: string = 'All';\n\n  /**\n   * Text to display for the select none option\n   */\n  @Input() multiNoneText: string = 'None';\n\n  /**\n   * Field placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Wheter the selector is disabled or not\n   */\n  @Input() disabled: boolean = false;\n\n  /**\n   * Event emitted when the selection changes\n   */\n  @Output() selectedChange = new EventEmitter<{\n    selected: boolean;\n    value: object | object[];\n  }>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Create a store watcher and subscribe to the selected entity\n   * @internal\n   */\n  ngOnInit() {\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n    this.selected$$ = this.store.stateView\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\n      .subscribe((records: EntityRecord<object>[]) => {\n        const entities = records.map((record: EntityRecord<object>) => record.entity);\n        this.onSelectFromStore(entities);\n      });\n  }\n\n  /**\n   * Unsubscribe to the selected entity and destroy the store watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n    this.selected$$.unsubscribe();\n  }\n\n  /**\n   * On selection change, update the store's state and emit an event\n   * @internal\n   */\n  onSelectionChange(event: {value: object | undefined}) {\n    const values = event.value instanceof Array ? event.value : [event.value];\n\n    const multiSelect = values.find((_value: object) => _value === this.multiSelectValue);\n    let entities = values.filter((_value: object) => _value !== this.multiSelectValue);\n    if (multiSelect !== undefined) {\n      if (entities.length === this.store.count) {\n        entities = [];\n      } else if (entities.length < this.store.count) {\n        entities = this.store.all();\n      }\n    }\n\n    entities = entities.filter((entity: object) => entity !== this.emptyValue);\n    if (entities.length === 0) {\n      this.store.state.updateAll({selected: false});\n    } else {\n      this.store.state.updateMany(entities, {selected: true}, true);\n    }\n\n    const value = this.multi ? entities : event.value;\n    this.selectedChange.emit({selected: true, value});\n  }\n\n  private onSelectFromStore(entities: object[]) {\n    if (this.multi === true) {\n      this.selected$.next(entities);\n    } else {\n      const entity = entities.length > 0 ? entities[0] : undefined;\n      this.selected$.next(entity);\n    }\n\n    this.updateMultiToggleWithEntities(entities);\n  }\n\n  private updateMultiToggleWithEntities(entities: object[]) {\n    if (entities.length === this.store.count && this.multiText$.value !== this.multiNoneText) {\n      this.multiText$.next(this.multiNoneText);\n    } else if (entities.length < this.store.count && this.multiText$.value !== this.multiAllText) {\n      this.multiText$.next(this.multiAllText);\n    }\n  }\n\n}\n","import { Directive, HostListener } from '@angular/core';\n\n@Directive({\n  selector: '[igoStopPropagation]'\n})\nexport class StopPropagationDirective {\n  @HostListener('click', ['$event'])\n  public onClick(event: any): void {\n    event.stopPropagation();\n  }\n}\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnChanges,\n  ViewChild,\n  Output,\n  EventEmitter,\n  OnDestroy\n} from '@angular/core';\n\nimport {\n  EntityStore\n} from '../shared';\nimport { MatPaginator, PageEvent } from '@angular/material/paginator';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LanguageService, MediaService } from '@igo2/core';\nimport { EntityTablePaginatorOptions } from './entity-table-paginator.interface';\n\n@Component({\n  selector: 'igo-entity-table-paginator',\n  templateUrl: './entity-table-paginator.component.html',\n  styleUrls: ['./entity-table-paginator.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class EntityTablePaginatorComponent implements OnChanges, OnDestroy {\n\n  public disabled: boolean = false;\n  public hidePageSize: boolean = false;\n  public pageIndex: number = 0;\n  public pageSize: number = 50;\n  public pageSizeOptions: number[] = [5, 10, 20, 50, 100, 200];\n  public showFirstLastButtons: boolean = true;\n  private count$$: Subscription;\n  private entitySortChange$$: Subscription;\n  private paginationLabelTranslation$$: Subscription[] = [];\n\n  @Input() entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Paginator options\n   */\n  @Input()\n  paginatorOptions: EntityTablePaginatorOptions;\n\n  /**\n   * Event emitted when the paginator changes the page size or page index.\n   */\n  @Output() page: EventEmitter<PageEvent>;\n\n  public length: number = 0;\n\n  /**\n   * Paginator emitted.\n   */\n  @Output() paginatorChange: EventEmitter<MatPaginator> = new EventEmitter<MatPaginator>();\n\n  constructor(private languageService: LanguageService, private mediaService: MediaService) {}\n\n  @ViewChild(MatPaginator, { static: true }) paginator: MatPaginator;\n\n  ngOnChanges() {\n    this.unsubscribeAll();\n    this.count$$ = this.store.stateView.count$.subscribe((count) => {\n      this.length = count;\n      this.emitPaginator();\n    });\n    this.entitySortChange$$ = this.entitySortChange$.subscribe(() => {\n      if (this.paginator) {\n        this.paginator.firstPage();\n      }\n    });\n    this.initPaginatorOptions();\n    this.translateLabels();\n  }\n\n  initPaginatorOptions() {\n    this.disabled = this.paginatorOptions?.disabled || this.disabled;\n    this.pageIndex = this.paginatorOptions?.pageIndex || this.pageIndex;\n    this.pageSize = this.paginatorOptions?.pageSize || this.pageSize;\n    this.pageSizeOptions = this.paginatorOptions?.pageSizeOptions || this.pageSizeOptions;\n    if (this.mediaService.isMobile()) {\n      this.showFirstLastButtons = false;\n      this.hidePageSize = true;\n    } else {\n      this.showFirstLastButtons = this.paginatorOptions?.showFirstLastButtons || this.showFirstLastButtons;\n      this.hidePageSize = this.paginatorOptions?.hidePageSize || this.hidePageSize;\n    }\n  }\n\n  translateLabels() {\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.firstPageLabel').subscribe((label: string) => {\n        this.paginator._intl.firstPageLabel = label;\n      }));\n\n    this.paginator._intl.getRangeLabel = this.rangeLabel;\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.itemsPerPageLabel').subscribe((label: string) => {\n        this.paginator._intl.itemsPerPageLabel = label;\n      }));\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.lastPageLabel').subscribe((label: string) => {\n        this.paginator._intl.lastPageLabel = label;\n      }));\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.nextPageLabel').subscribe((label: string) => {\n        this.paginator._intl.nextPageLabel = label;\n      }));\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.previousPageLabel').subscribe((label: string) => {\n        this.paginator._intl.previousPageLabel = label;\n      }));\n  }\n\n  rangeLabel = (page: number, pageSize: number, length: number) => {\n    const of: BehaviorSubject<string> = new BehaviorSubject('');\n\n    this.paginationLabelTranslation$$.push(\n      this.languageService.translate.get('igo.common.paginator.of').subscribe((label: string) => {\n        of.next(label);\n      }));\n    if (length === 0 || pageSize === 0) { return `0 ${of.value} ${length}`; }\n    length = Math.max(length, 0);\n    const startIndex = page * pageSize;\n    const endIndex = startIndex < length ?\n        Math.min(startIndex + pageSize, length) :\n        startIndex + pageSize;\n    return `${startIndex + 1} - ${endIndex} ${of.value} ${length}`;\n  };\n\n  private unsubscribeAll() {\n    this.paginationLabelTranslation$$.map(sub => sub.unsubscribe());\n    if (this.count$$) { this.count$$.unsubscribe(); }\n    if (this.entitySortChange$$) { this.entitySortChange$$.unsubscribe(); }\n  }\n\n  ngOnDestroy(): void {\n    this.unsubscribeAll();\n  }\n\n  emitPaginator() {\n    this.paginatorChange.emit(this.paginator);\n  }\n}\n","<mat-paginator \n  [disabled]=\"disabled\"\n  [hidePageSize]=\"hidePageSize\"\n  [length]=\"length\"\n  [pageIndex]=\"pageIndex\"\n  [pageSize]=\"pageSize\"\n  [pageSizeOptions]=\"pageSizeOptions\"\n  [showFirstLastButtons]=\"showFirstLastButtons\"\n  (page)=\"emitPaginator()\">\n</mat-paginator>\n","import {\n  Directive,\n  HostListener,\n  Input,\n  ElementRef\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoImageError]'\n})\nexport class ImageErrorDirective {\n\n  @Input() errorImageUrl: string = './assets/igo2/common/images/na.png';\n  @Input() hideError: boolean = false;\n\n  constructor(private el: ElementRef) {}\n\n  @HostListener(\"error\", ['$event'])\n  public onError(event: any): void {\n    if (this.hideError) {\n      this.el.nativeElement.style.display = \"none\";\n    } else {\n      event.target.src = this.errorImageUrl;\n    }\n\n  }\n\n}\n","import {\n  Directive,\n  Input,\n  ElementRef,\n  Renderer2,\n  EventEmitter,\n  Output,\n  HostListener\n} from '@angular/core';\n\nimport scrollIntoView from 'scroll-into-view-if-needed';\n\nimport { EntityTableScrollBehavior } from '../shared/entity.enums';\n\n/**\n * Directive that handles an entity table row click and selection.\n */\n@Directive({\n  selector: '[igoEntityTableRow]'\n})\nexport class EntityTableRowDirective {\n\n  /**\n   * Class added to a selected row\n   */\n  static selectedCls = 'igo-entity-table-row-selected';\n\n  /**\n   * Class added to a highlighted row\n   */\n  static highlightedCls = 'igo-entity-table-row-highlighted';\n\n  /**\n   * Whether a row supports selection\n   */\n  @Input() selection = false;\n\n  /**\n   * Whether clicking a row should select it (if selection is true)\n   */\n  @Input() selectOnClick: boolean = true;\n\n  /**\n   * Whether the selected row should be highlighted\n   */\n  @Input() highlightSelection: boolean = true;\n\n  /**\n   * Whether a row is selected\n   */\n  @Input()\n  set selected(value: boolean) {\n    if (this.selection === false) { return; }\n    if (value === this._selected) { return; }\n\n    this.toggleSelected(value);\n    this.scroll();\n  }\n  get selected(): boolean {\n    return this._selected;\n  }\n  private _selected = false;\n\n  /**\n   * Scroll behavior on selection\n   */\n  @Input()\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\n\n  /**\n   * Event emitted when a row is selected\n   */\n  @Output() select = new EventEmitter<EntityTableRowDirective>();\n\n  /**\n   * When a row is clicked, select it if it's supported\n   * @ignore\n   */\n  @HostListener('click')\n  onClick() {\n    if (this.selection === false || this.selectOnClick === false) {\n      return;\n    }\n\n    this.toggleSelected(true);\n    this.select.emit(this);\n  }\n\n  constructor(private renderer: Renderer2, private el: ElementRef) {}\n\n  /**\n   * Select a row and add or remove the selected class from it\n   * @param selected Whether the row should be selected\n   */\n  private toggleSelected(selected: boolean) {\n    this._selected = selected;\n    if (selected === true) {\n      this.addCls(EntityTableRowDirective.selectedCls);\n      if (this.highlightSelection === true) {\n        this.addCls(EntityTableRowDirective.highlightedCls);\n      }\n    } else {\n      this.removeCls(EntityTableRowDirective.selectedCls);\n      this.removeCls(EntityTableRowDirective.highlightedCls);\n    }\n  }\n\n  /**\n   * Scroll to the selected row\n   */\n  private scroll() {\n    if (this._selected === true) {\n      scrollIntoView(this.el.nativeElement, {\n        scrollMode: 'if-needed',\n        behavior: 'smooth',\n        block: 'end',\n        inline: 'nearest'\n      });\n    }\n  }\n\n  /**\n   * Add the selected CSS class\n   */\n  private addCls(cls: string) {\n    this.renderer.addClass(this.el.nativeElement, cls);\n  }\n\n  /**\n   * Remove the selected CSS class\n   */\n  private removeCls(cls: string) {\n    this.renderer.removeClass(this.el.nativeElement, cls);\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml } from '@angular/platform-browser';\n\n@Pipe({ name: 'sanitizeHtml' })\nexport class SanitizeHtmlPipe implements PipeTransform {\n  constructor(private _sanitizer: DomSanitizer) {\n  }\n  transform(v: string): SafeHtml {\n    return this._sanitizer.bypassSecurityTrustHtml(v);\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\n\nimport { Cacheable } from 'ts-cacheable';\nimport { Observable } from 'rxjs';\nimport { catchError, switchMap } from 'rxjs/operators';\nimport { ConfigService } from '@igo2/core';\n\n@Pipe({\n  name: 'secureImage'\n})\nexport class SecureImagePipe implements PipeTransform {\n  constructor(\n    private http: HttpClient,\n    private configService?: ConfigService) {}\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  transform(url: string): Observable<string> {\n    const headers = new HttpHeaders({\n      'Content-Type': 'text/plain',\n      activityInterceptor: 'false',\n      interceptError: 'false'\n    });\n\n    const regexDepot = new RegExp(this.configService?.getConfig('depot.url') + '.*?(?=\"|$)');\n    if (regexDepot.test(url)) {\n      url = url.match(regexDepot)[0];\n    }\n\n    return this.http\n      .get(url, {\n        headers,\n        responseType: 'blob'\n      })\n      .pipe(\n        catchError((err) => {\n          err.error.caught = true;\n          err.error.toDisplay = false;\n          throw err;\n        }),\n        switchMap((blob) => {\n          return new Observable((observer) => {\n            const reader = new FileReader();\n            reader.readAsDataURL(blob);\n            reader.onloadend = () => {\n              observer.next(reader.result);\n              observer.complete();\n            };\n          });\n        })\n      ) as Observable<string>;\n  }\n}\n","<div class=\"table-container\" [ngStyle]=\"{'height': tableHeight}\">\n  <table mat-table matSort [ngClass]=\"getTableClass()\" [dataSource]=\"dataSource\" [trackBy]=\"getTrackByFunction()\" (matSortChange)=\"onSort($event)\">\n      <ng-container matColumnDef=\"selectionCheckbox\" class=\"mat-cell-checkbox\">\n          <th mat-header-cell *matHeaderCellDef>\n              <ng-container *ngIf=\"selectMany\">\n                  <ng-container *ngIf=\"selectionState$ | async as selectionState\">\n                      <mat-checkbox (change)=\"onToggleRows($event.checked)\" [checked]=\"selectionState === entityTableSelectionState.All\"\n                      [indeterminate]=\"selectionState === entityTableSelectionState.Some\">\n                      </mat-checkbox>\n                  </ng-container>\n              </ng-container>\n          </th>\n          <td mat-cell *matCellDef=\"let record\">\n              <mat-checkbox (mousedown)=\"$event.shiftKey ? $event.preventDefault() : null\" (click)=\"$event.shiftKey ?\n              onShiftToggleRow(!rowIsSelected(record), record, $event) : $event.stopPropagation()\" (change)=\"onToggleRow($event.checked,record)\"\n              [checked]=\"rowIsSelected(record)\">\n              </mat-checkbox>\n          </td>\n      </ng-container>\n\n      <ng-container [matColumnDef]=\"column.name\" *ngFor=\"let column of template.columns\">\n          <ng-container *ngIf=\"columnIsSortable(column)\">\n              <th mat-header-cell *matHeaderCellDef mat-sort-header [matTooltip]=\"column.tooltip ? column.tooltip : undefined\">\n                  {{column.title}}\n              </th>\n          </ng-container>\n\n          <ng-container *ngIf=\"!columnIsSortable(column)\">\n              <th mat-header-cell *matHeaderCellDef [matTooltip]=\"column.tooltip ? column.tooltip : undefined\">\n                  {{column.title}}\n              </th>\n          </ng-container>\n\n          <ng-container *ngIf=\"getColumnRenderer(column) as columnRenderer\">\n              <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.Default\">\n                  <ng-container *matCellDef=\"let record\">\n                      <td mat-cell class=\"mat-cell-text\" *ngIf=\"!isUrl(getValue(record, column));else isAnUrlDefault\" [ngClass]=\"getCellClass(record, column)\">\n                          {{getValue(record, column)}}\n                      </td>\n                      <ng-template #isAnUrlDefault>\n                          <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                              <a href=\"{{getValue(record, column)}}\" target='_blank' rel=\"noopener noreferrer\" (click)=\"$event.stopPropagation()\">\n                                  <img igoImageError *ngIf=\"isImg(getValue(record, column));else notImg\" src=\"{{(getValue(record, column) | secureImage) | async}}\" width=\"50\" heigth=\"auto\">\n                                  <ng-template #notImg><span>{{\n                    'igo.common.entity-table.targetHtmlUrl' | translate }}\n                  </span></ng-template>\n                              </a>\n                          </td>\n                      </ng-template>\n                  </ng-container>\n              </ng-container>\n              <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.HTML\">\n                  <ng-container *matCellDef=\"let record\">\n                      <td mat-cell class=\"mat-cell-text\" *ngIf=\"!isUrl(getValue(record, column));else isAnUrlHTML\" [ngClass]=\"getCellClass(record, column)\"\n                      [innerHTML]=\"getValue(record, column)\">\n                      </td>\n                      <ng-template #isAnUrlHTML>\n                          <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                              <a href=\"{{getValue(record, column)}}\" target='_blank' rel=\"noopener noreferrer\" (click)=\"$event.stopPropagation()\">\n                                  <img igoImageError *ngIf=\"isImg(getValue(record, column));else notImg\" src=\"{{(getValue(record, column) | secureImage) | async}}\" width=\"50\" heigth=\"auto\">\n                                  <ng-template #notImg><span>{{ 'igo.geo.targetHtmlUrl' |\n                    translate }} </span></ng-template>\n                              </a>\n                          </td>\n                      </ng-template>\n                  </ng-container>\n              </ng-container>\n              <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.UnsanitizedHTML\">\n                  <ng-container *matCellDef=\"let record\">\n                      <td mat-cell class=\"mat-cell-text edition\" [formGroup]=\"formGroup\" *ngIf=\"isEdition(record);else isUnsanitizedHTML\"\n                      [ngClass]=\"getCellClass(record, column)\">\n                          <div class=\"date-picker\" *ngIf=\"column.type === 'date'\">\n                              <mat-datepicker-toggle matSuffix [for]=\"picker\"></mat-datepicker-toggle>\n                              <input matInput [matDatepicker]=\"picker\" [formControlName]=\"column.name\" value=\"{{getValue(record, column)}}\"\n                              (dateChange)=\"onDateChange(column.name, record, $event)\">\n                              <mat-datepicker #picker></mat-datepicker>\n                          </div>\n                          <input matInput type=\"time\" *ngIf=\"column.type === 'time'\" [formControlName]=\"column.name\" step=\"900\" (focus)=\"column.onFocus($event)\"\n                          (keypress)=\"column.onChange($event)\" (blur)=\"column.onBlur($event)\">\n                          <input matInput type=\"number\" class=\"class_number_edition\" *ngIf=\"column.type === 'number'\" [formControlName]=\"column.name\" step=\"{{column.step}}\"\n                          value=\"{{getValue(record,column)}}\" (input)=\"onValueChange(column.name, record, $event)\"\n                          readonly=\"{{getValidationAttributeValue(column, 'readonly')}}\" required=\"{{getValidationAttributeValue(column, 'mandatory')}}\"\n                          min=\"{{getValidationAttributeValue(column, 'minValue')}}\" max=\"{{getValidationAttributeValue(column, 'maxValue')}}\">\n                          <input matInput type=\"text\" *ngIf=\"!column.type || column.type ==='string'\" [formControlName]=\"column.name\"\n                          value=\"{{getValue(record, column)}}\" (input)=\"onValueChange(column.name, record, $event)\"\n                          readonly=\"{{getValidationAttributeValue(column, 'readonly')}}\" required=\"{{getValidationAttributeValue(column, 'mandatory')}}\">\n                          <mat-checkbox *ngIf=\"column.type === 'boolean'\" [formControlName]=\"column.name\" [checked]=\"getValue(record,column)\"\n                          (change)=\"onBooleanValueChange(column.name, record,$event)\"></mat-checkbox>\n                          <mat-select *ngIf=\"column.type === 'list'\" required=\"{{getValidationAttributeValue(column, 'mandatory')}}\"\n                          [formControlName]=\"column.name\" [multiple]=\"column.multiple\" (selectionChange)=\"onSelectValueChange(column.name, record, $event)\"\n                          [value]=\"getValue(record, column)\">\n                              <mat-option *ngFor=\"let option of column.domainValues\" [value]=\"option.id\" [disabled]=\"option.disabled\">\n                                  {{ option.value }}\n                              </mat-option>\n                          </mat-select>\n                          <input matInput type=\"text\" [formControlName]=\"column.name\" *ngIf=\"column.type === 'autocomplete'\" [matAutocomplete]=\"auto\"\n                            required=\"{{getValidationAttributeValue(column, 'mandatory')}}\" value=\"{{getValue(record, column)}}\"\n                            readonly=\"{{getValidationAttributeValue(column, 'readonly')}}\">\n                                <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)=\"onAutocompleteValueChange(column, record, $event)\"\n                                panelWidth=\"430px\">\n                                    <mat-option *ngFor=\"let option of filteredOptions[column.name] | async\"\n                                        [value]=\"option.id\">\n                                        {{ option.value }}\n                                    </mat-option>\n                                </mat-autocomplete>\n                      </td>\n                      <ng-template #isUnsanitizedHTML>\n                          <td mat-cell class=\"mat-cell-text\" *ngIf=\"!isUrl(getValue(record, column));else isAnUrlUnsanitizedHTML\" [ngClass]=\"getCellClass(record, column)\"\n                          [innerHTML]=\"getValue(record, column) | sanitizeHtml\">\n                          </td>\n                          <ng-template #isAnUrlUnsanitizedHTML>\n                              <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                                  <a href=\"{{getValue(record, column)}}\" target='_blank' rel=\"noopener noreferrer\" (click)=\"$event.stopPropagation()\">\n                                      <img igoImageError *ngIf=\"isImg(getValue(record, column));else notImg\" src=\"{{(getValue(record, column) | secureImage) | async}}\" width=\"50\" heigth=\"auto\">\n                                      <ng-template #notImg><span>{{ 'igo.geo.targetHtmlUrl' | translate }} </span></ng-template>\n                                  </a>\n                              </td>\n                          </ng-template>\n                      </ng-template>\n                  </ng-container>\n              </ng-container>\n              <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.Icon\">\n                  <td mat-cell *matCellDef=\"let record\" class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                      <mat-icon *ngIf=\"column.onClick\" svgIcon=\"{{getValue(record, column)|| column.icon}}\" (click)=\"column.onClick($event)\"></mat-icon>\n                      <mat-icon *ngIf=\"!column.onClick\" svgIcon=\"{{getValue(record, column)|| column.icon}}\"></mat-icon>\n                  </td>\n              </ng-container>\n              <ng-container *ngIf=\"columnRenderer === entityTableColumnRenderer.ButtonGroup\">\n                  <ng-container *matCellDef=\"let record\">\n                      <td mat-cell class=\"mat-cell-text\" [ngClass]=\"getCellClass(record, column)\">\n                          <span *ngFor=\"let button of getValue(record, column)\">\n                              <ng-container *ngIf=\"isEdition(record) === button.editMode || button.editMode === undefined\">\n                                  <button *ngIf=\"button.style === 'mat-icon-button'\" igoStopPropagation mat-icon-button\n                                      [color]=\"button.color\" (mousedown)=\"onButtonClick(button.click, record)\" [disabled]=\"button.disabled\">\n                                      <mat-icon svgIcon=\"{{button.icon}}\"></mat-icon>\n                                  </button>\n                                  <button *ngIf=\"button.style !== 'mat-icon-button'\" igoStopPropagation mat-mini-fab\n                                      [color]=\"button.color\" (mousedown)=\"onButtonClick(button.click, record)\" [disabled]=\"button.disabled\">\n                                      <mat-icon svgIcon=\"{{button.icon}}\"></mat-icon>\n                                  </button>\n                              </ng-container>\n                          </span>\n                      </td>\n                  </ng-container>\n              </ng-container>\n          </ng-container>\n      </ng-container>\n\n      <tr mat-header-row *matHeaderRowDef=\"headers; sticky: fixedHeader\" [ngClass]=\"getHeaderClass()\">\n      </tr>\n      <tr mat-row igoEntityTableRow *matRowDef=\"let record; columns: headers;\" [scrollBehavior]=\"scrollBehavior\" [ngClass]=\"getRowClass(record)\" [selection]=\"selection\" [selected]=\"rowIsSelected(record)\" (select)=\"onRowSelect(record)\" (click)=\"onRowClick(record)\">\n      </tr>\n  </table>\n  <igo-entity-table-paginator *ngIf=\"withPaginator\" [store]=\"store\" [paginatorOptions]=\"paginatorOptions\" [entitySortChange$]=\"entitySortChange$\" (paginatorChange)=\"paginatorChange($event)\">\n  </igo-entity-table-paginator>\n</div>","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy,\n  OnChanges,\n  SimpleChanges,\n  ElementRef,\n  Optional,\n  Self\n} from '@angular/core';\n\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\n\nimport {\n  EntityKey,\n  EntityRecord,\n  EntityState,\n  EntityStore,\n  EntityTableTemplate,\n  EntityTableColumn,\n  EntityTableColumnRenderer,\n  EntityTableSelectionState,\n  EntityTableScrollBehavior\n} from '../shared';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { MatTableDataSource } from '@angular/material/table';\nimport { EntityTablePaginatorOptions } from '../entity-table-paginator/entity-table-paginator.interface';\nimport { MatFormFieldControl } from '@angular/material/form-field';\nimport { UntypedFormBuilder, NgControl, NgForm, FormControlName, UntypedFormGroup } from '@angular/forms';\nimport { FocusMonitor } from '@angular/cdk/a11y';\nimport { DateAdapter, ErrorStateMatcher } from '@angular/material/core';\nimport { map } from 'rxjs/operators';\nimport { default as moment } from 'moment';\n\n@Component({\n  selector: 'igo-entity-table',\n  templateUrl: './entity-table.component.html',\n  styleUrls: ['./entity-table.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [{ provide: MatFormFieldControl, useExisting: EntityTableComponent }]\n})\nexport class EntityTableComponent implements OnInit, OnChanges, OnDestroy {\n\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public formGroup: UntypedFormGroup = new UntypedFormGroup({});\n\n  public filteredOptions = {};\n\n  /**\n   * Reference to the column renderer types\n   * @internal\n   */\n  entityTableColumnRenderer = EntityTableColumnRenderer;\n\n  /**\n   * Reference to the selection's state\n   * @internal\n   */\n  entityTableSelectionState = EntityTableSelectionState;\n\n  /**\n   * Observable of the selection,s state\n   * @internal\n   */\n  readonly selectionState$: BehaviorSubject<EntityTableSelectionState> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the store's selection\n   */\n  private selection$$: Subscription;\n\n  /**\n   * Subscription to the dataSource\n   */\n  private dataSource$$: Subscription;\n\n  /**\n   * The last record checked. Useful for selecting\n   * multiple records by holding the shift key and checking\n   * checkboxes.\n   */\n  private lastRecordCheckedKey: EntityKey;\n\n  /**\n   * Entity store\n   */\n  @Input() store: EntityStore<object>;\n\n  /**\n   * Table paginator\n   */\n  @Input() set paginator(value: MatPaginator) {\n    this._paginator = value;\n    this.dataSource.paginator = value;\n  }\n\n  get paginator(): MatPaginator {\n    return this._paginator;\n  }\n  private _paginator: MatPaginator;\n\n  /**\n   * Table template\n   */\n  @Input() template: EntityTableTemplate;\n\n  /**\n   * Scroll behavior on selection\n   */\n  @Input()\n  scrollBehavior: EntityTableScrollBehavior = EntityTableScrollBehavior.Auto;\n\n  /**\n   * Whether nulls should be first when sorting\n   */\n  @Input()\n  sortNullsFirst: boolean = false;\n\n  /**\n   * Show the table paginator or not. False by default.\n   */\n  @Input()\n  withPaginator: boolean = false;\n\n  /**\n   * Paginator options\n   */\n  @Input()\n  paginatorOptions: EntityTablePaginatorOptions;\n\n  /**\n   * Event emitted when an entity (row) is clicked\n   */\n  @Output() entityClick = new EventEmitter<object>();\n\n  /**\n   * Event emitted when an entity (row) is selected\n   */\n  @Output() entitySelectChange = new EventEmitter<{\n    added: object[];\n  }>();\n\n  /**\n   * Event emitted when the table sort is changed.\n   */\n  @Output() entitySortChange: EventEmitter<{column: EntityTableColumn, direction: string}> = new EventEmitter(undefined);\n\n  /**\n   * Table headers\n   * @internal\n   */\n  get headers(): string[] {\n    let columns = this.template.columns\n      .filter((column: EntityTableColumn) => column.visible !== false)\n      .map((column: EntityTableColumn) => column.name);\n\n    if (this.selectionCheckbox === true) {\n      columns = ['selectionCheckbox'].concat(columns);\n    }\n\n    return columns;\n  }\n\n  /**\n   * Data source consumable by the underlying material table\n   * @internal\n   */\n  dataSource = new MatTableDataSource<object>();\n\n  /**\n   * Whether selection is supported\n   * @internal\n   */\n  get selection(): boolean { return this.template.selection || false; }\n\n  /**\n   * Whether a selection checkbox should be displayed\n   * @internal\n   */\n  get selectionCheckbox(): boolean { return this.template.selectionCheckbox || false; }\n\n  /**\n   * Whether selection many entities should eb supported\n   * @internal\n   */\n  get selectMany(): boolean { return this.template.selectMany || false; }\n\n  /**\n   * Whether selection many entities should eb supported\n   * @internal\n   */\n  get fixedHeader(): boolean { return this.template.fixedHeader === undefined ? true : this.template.fixedHeader; }\n\n  get tableHeight(): string { return this.template.tableHeight ? this.template.tableHeight : 'auto'; }\n\n  constructor(private cdRef: ChangeDetectorRef,\n    private formBuilder: UntypedFormBuilder,\n    protected _focusMonitor: FocusMonitor,\n    protected _elementRef: ElementRef<HTMLElement>,\n    @Optional() @Self() public ngControl: NgControl,\n    @Optional() protected _parentForm: NgForm,\n    @Optional() protected _controlName: FormControlName,\n    protected _defaultErrorStateMatcher: ErrorStateMatcher,\n    private dateAdapter: DateAdapter<Date>\n  ) {\n    this.dateAdapter.setLocale('fr-CA');\n  }\n\n  /**\n   * Track the selection state to properly display the selection checkboxes\n   * @internal\n   */\n  ngOnInit() {\n    this.handleDatasource();\n    this.dataSource.paginator = this.paginator;\n  }\n\n  /**\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const store = changes.store;\n    if (store && store.currentValue !== store.previousValue) {\n      this.handleDatasource();\n    }\n  }\n\n  /**\n   * Process text or number value change (edition)\n   */\n  onValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.target.value;\n  }\n\n  /**\n   * Process boolean value change (edition)\n   */\n  onBooleanValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.checked;\n  }\n\n  /**\n   * Process select value change (edition)\n   */\n  onSelectValueChange(column: string, record: EntityRecord<any>, event) {\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = event.value;\n  }\n\n  /**\n   * Process autocomplete value change (edition)\n   */\n  onAutocompleteValueChange(column: EntityTableColumn, record: EntityRecord<any>, event) {\n    this.formGroup.controls[column.name].setValue(event.option.viewValue);\n    const key = this.getColumnKeyWithoutPropertiesTag(column.name);\n    record.entity.properties[key] = event.option.value;\n  }\n\n  /**\n   * Process date value change (edition)\n   */\n  onDateChange(column: string, record: EntityRecord<any>, event) {\n    const format = \"YYYY-MM-DD\";\n    const value = moment(event.value).format(format);\n    const key = this.getColumnKeyWithoutPropertiesTag(column);\n    record.entity.properties[key] = value;\n  }\n\n  /**\n   * Enable edition mode for one row\n   * More than one row can be edited at the same time\n   */\n  private enableEdit(record: EntityRecord<any>) {\n    const item = record.entity.properties || record.entity;\n    this.template.columns.forEach(column => {\n      column.title = column.validation?.mandatory && !column.title.includes('*') ? column.title + ' *' : column.title;\n\n      const key = this.getColumnKeyWithoutPropertiesTag(column.name);\n      if (column.type === 'boolean') {\n        if (!item[key] || item[key] === null) {\n          item[key] = false;\n        } else if (typeof item[key] === 'string') {\n          item[key] = JSON.parse(item[key].toLowerCase());\n        }\n        this.formGroup.setControl(column.name, this.formBuilder.control(\n          item[key]\n        ));\n      } else if (column.type === 'list') {\n        if (column.multiple) {\n          this.formGroup.setControl(column.name, this.formBuilder.control(\n            [item[key]]\n          ));\n        } else {\n          this.formGroup.setControl(column.name, this.formBuilder.control(\n            item[key]\n          ));\n\n          typeof item[key] === 'string' ?\n            this.formGroup.controls[column.name].setValue(parseInt(item[key])) :\n            this.formGroup.controls[column.name].setValue(item[key]);\n        }\n      } else if (column.type === 'autocomplete') {\n        this.formGroup.setControl(column.name, this.formBuilder.control(\n          item[key]\n        ));\n\n        this.filteredOptions[column.name] = new Observable<any[]>();\n        this.filteredOptions[column.name] =\n          this.formGroup.controls[column.name].valueChanges.pipe(\n            map(value => {\n              if (value?.length) {\n                return column.domainValues?.filter((option) => {\n                  const filterNormalized = value ? value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '') : '';\n                  const featureNameNormalized = option.value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n                  return featureNameNormalized.includes(filterNormalized);\n                });\n              }\n            })\n          );\n\n        let formControlValue = item[key];\n        column.domainValues.forEach(option => {\n          if (typeof formControlValue === 'string' && /^\\d+$/.test(formControlValue)) {\n            formControlValue = parseInt(formControlValue);\n          }\n          if (option.value === formControlValue || option.id === formControlValue) {\n            formControlValue = option.value;\n          }\n        });\n\n        this.formGroup.controls[column.name].setValue(formControlValue);\n        if (this.isEdition(record) && column.linkColumnForce) {\n          const entity = record.entity as any;\n          this.formGroup.controls[column.name].setValue(\n            entity?.properties[this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)]\n          );\n        }\n      } else if (column.type === 'date') {\n        if (column.visible !== false) {\n          if (item[key]) {\n            let date = moment(item[key]);\n            item[key] = date.utc().format('YYYY-MM-DD');\n            this.formGroup.setControl(column.name, this.formBuilder.control(\n              item[key]\n            ));\n          } else {\n            const newKey = this.getColumnKeyWithoutPropertiesTag(column.name);\n            record.entity.properties[newKey] = null;\n            this.formGroup.setControl(column.name, this.formBuilder.control(\n              null\n            ));\n          }\n        }\n      } else {\n        this.formGroup.setControl(column.name, this.formBuilder.control(\n          item[key]\n        ));\n      }\n\n      if (this.formGroup.controls[column.name] && this.getValidationAttributeValue(column, 'readonly')) {\n        this.formGroup.controls[column.name].disable();\n      }\n    });\n  }\n\n  private handleDatasource() {\n    this.unsubscribeStore();\n    this.selection$$ = this.store.stateView\n      .manyBy$((record: EntityRecord<object>) => record.state.selected === true)\n      .subscribe((records: EntityRecord<object>[]) => {\n        const firstSelected = records[0];\n        const firstSelectedStateviewPosition = this.store.stateView.all().indexOf(firstSelected);\n        const pageMax = this.paginator ? this.paginator.pageSize * (this.paginator.pageIndex + 1) : 0;\n        const pageMin = this.paginator ? pageMax - this.paginator.pageSize : 0;\n\n        if (\n          this.paginator &&\n          (firstSelectedStateviewPosition < pageMin ||\n          firstSelectedStateviewPosition >= pageMax)) {\n          const pageToReach = Math.floor(firstSelectedStateviewPosition / this.paginator.pageSize);\n          this.dataSource.paginator.pageIndex = pageToReach;\n        }\n        this.selectionState$.next(this.computeSelectionState(records));\n      });\n    this.dataSource$$ = this.store.stateView.all$().subscribe((all) => {\n      if (all[0]) {\n        this.enableEdit(all[0]);\n      }\n      this.dataSource.data = all;\n    });\n\n  }\n\n  /**\n   * Unbind the store watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unsubscribeStore();\n  }\n\n  private unsubscribeStore() {\n    if (this.selection$$) {\n      this.selection$$.unsubscribe();\n    }\n    if (this.dataSource$$) {\n      this.dataSource$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Trackby function\n   * @param record Record\n   * @param index Record index\n   * @internal\n   */\n  getTrackByFunction() {\n    return (index: number, record: EntityRecord<object, EntityState>) => {\n      return record.ref;\n    };\n  }\n\n  /**\n   * Trigger a refresh of thre table. This can be useful when\n   * the data source doesn't emit a new value but for some reason\n   * the records need an update.\n   * @internal\n   */\n  refresh() {\n    this.cdRef.detectChanges();\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.paginator = event;\n  }\n\n  /**\n   * On sort, sort the store\n   * @param event Sort event\n   * @internal\n   */\n  onSort(event: {active: string, direction: string}) {\n    const direction = event.direction;\n    const column = this.template.columns\n      .find((c: EntityTableColumn) => c.name === event.active);\n\n    if (direction === 'asc' || direction === 'desc') {\n      this.store.stateView.sort({\n        valueAccessor: (record: EntityRecord<object>) => this.getValue(record, column),\n        direction,\n        nullsFirst: this.sortNullsFirst\n      });\n      this.entitySortChange.emit({column, direction});\n      this.entitySortChange$.next(true);\n    } else {\n      this.store.stateView.sort(undefined);\n    }\n  }\n\n  /**\n   * When an entity is clicked, emit an event\n   * @param record Record\n   * @internal\n   */\n  onRowClick(record: EntityRecord<object>) {\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n    this.entityClick.emit(record.entity);\n  }\n\n  /**\n   * When an entity is selected, select it in the store and emit an event. Even if\n   * \"many\" is set to true, this method always select a single, exclusive row. Selecting\n   * multiple rows should be achieved by using the checkboxes.\n   * @param record Record\n   * @internal\n   */\n  onRowSelect(record: EntityRecord<object>) {\n    if (this.selection === false) { return; }\n\n    const entity = record.entity;\n    this.store.state.update(entity, {selected: true}, true);\n    this.entitySelectChange.emit({added: [entity]});\n  }\n\n  /**\n   * Select or unselect all rows at once. On select, emit an event.\n   * @param toggle Select or unselect\n   * @internal\n   */\n  onToggleRows(toggle: boolean) {\n    if (this.selection === false) { return; }\n\n    this.store.state.updateAll({selected: toggle});\n    if (toggle === true) {\n      const entities = this.store.stateView\n        .all()\n        .map((record: EntityRecord<object>) => record.entity);\n      this.entitySelectChange.emit({added: [entities]});\n    }\n  }\n\n  /**\n   * When an entity is toggled, select or unselect it in the store. On select,\n   * emit an event.\n   * @param toggle Select or unselect\n   * @param record Record\n   * @internal\n   */\n  onToggleRow(toggle: boolean, record: EntityRecord<object>) {\n    if (this.selection === false) { return; }\n\n    const entity = record.entity;\n    const exclusive = toggle === true && !this.selectMany;\n    this.store.state.update(entity, {selected: toggle}, exclusive);\n    if (toggle === true) {\n      this.entitySelectChange.emit({added: [entity]});\n    }\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n  }\n\n  /**\n   * When an entity is toggled, select or unselect it in the store. On select,\n   * emit an event.\n   * @param toggle Select or unselect\n   * @param record Record\n   * @internal\n   */\n  onShiftToggleRow(toggle: boolean, record: EntityRecord<object>, event: MouseEvent) {\n    if (this.selection === false) { return; }\n\n    if (this.selectMany === false || this.lastRecordCheckedKey === undefined) {\n      this.onToggleRow(toggle, record);\n      return;\n    }\n\n    // This is a workaround mat checkbox wrong behavior\n    // when the shift key is held.\n    // See https://github.com/angular/components/issues/6232\n    const range = window.document.createRange();\n    range.selectNode(event.target as HTMLElement);\n    window.getSelection().removeAllRanges();\n    window.getSelection().addRange(range);\n    event.stopImmediatePropagation();\n\n    const records = this.store.stateView.all();\n    const recordIndex = records.indexOf(record);\n    const lastRecordChecked = this.store.stateView.get(this.lastRecordCheckedKey);\n    const lastRecordIndex = records.indexOf(lastRecordChecked);\n    const indexes = [recordIndex, lastRecordIndex];\n    const selectRecords = records.slice(Math.min(...indexes), Math.max(...indexes) + 1);\n\n    const entities = selectRecords.map((_record: EntityRecord<object>) => _record.entity);\n    this.store.state.updateMany(entities, {selected: toggle});\n    if (toggle === true) {\n      this.entitySelectChange.emit({added: entities});\n    }\n    this.lastRecordCheckedKey = this.store.stateView.getKey(record);\n  }\n\n  /**\n   * Compute the selection state\n   * @returns Whether all, some or no rows are selected\n   * @internal\n   */\n  private computeSelectionState(selectedRecords: EntityRecord<object>[]): EntityTableSelectionState {\n    const states = EntityTableSelectionState;\n    const selectionCount = selectedRecords.length;\n    return selectionCount === 0 ?\n      states.None :\n      (selectionCount === this.store.stateView.count ? states.All : states.Some);\n  }\n\n  /**\n   * Whether a column is sortable\n   * @param column Column\n   * @returns True if a column is sortable\n   * @internal\n   */\n  columnIsSortable(column: EntityTableColumn): boolean {\n    let sortable = column.sort;\n    if (sortable === undefined) {\n      sortable = this.template.sort === undefined ? false : this.template.sort;\n    }\n    return sortable;\n  }\n\n  /**\n   * Whether a row is should be selected based on the underlying entity state\n   * @param record Record\n   * @returns True if a row should be selected\n   * @internal\n   */\n  rowIsSelected(record: EntityRecord<object>): boolean {\n    const state = record.state;\n    return state.selected ? state.selected : false;\n  }\n\n  isImg(value) {\n    if (this.isUrl(value)) {\n      return (\n        ['jpg', 'png', 'gif'].indexOf(value.split('.').pop().toLowerCase()) !== -1\n      );\n    } else {\n      return false;\n    }\n  }\n\n  isUrl(value) {\n    if (typeof value === 'string') {\n      return (\n        value.slice(0, 8) === 'https://' || value.slice(0, 7) === 'http://'\n      );\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Method to access an entity's values\n   * @param record Record\n   * @param column Column\n   * @returns Any value\n   * @internal\n   */\n  getValue(record: EntityRecord<object>, column: EntityTableColumn): any {\n    const entity = record.entity;\n    let value;\n    if (column.valueAccessor !== undefined) {\n      return column.valueAccessor(entity, record);\n    }\n    if (this.template.valueAccessor !== undefined) {\n      return this.template.valueAccessor(entity, column.name, record);\n    }\n    value = this.store.getProperty(entity, column.name);\n\n    if (column.type === 'boolean') {\n      if (value === undefined || value === null || value === '') {\n        value = false;\n      } else if (typeof value !== 'boolean' && value !== undefined) {\n        if (typeof value === 'number'){\n          value = Boolean(value);\n        } else {\n          value = JSON.parse(value.toLowerCase());\n        }\n      }\n      if (!this.isEdition(record)){\n        value = value ? '&#10003;' : ''; // check mark\n      }\n    } else if (column.type === 'list' && value && column.domainValues) {\n      const entity = record.entity as any;\n      if (column.multiple) {\n        let list_id;\n        typeof value === 'string' ? list_id = value.match(/[\\w.-]+/g).map(Number) : list_id = value;\n        let list_option = [];\n\n        column.domainValues.forEach(option => {\n          if (list_id.includes(option.id)) {\n            if (record.edition) {\n              list_option.push(option.id);\n            } else {\n              list_option.push(option.value);\n            }\n          }\n        });\n\n        this.isEdition(record) ? value = list_id : value = list_option;\n      } else {\n        if (!this.isEdition(record) && column.linkColumnForce) {\n          value = entity?.properties[this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)];\n        } else {\n          column.domainValues.forEach(option => {\n            if (typeof value === 'string' && /^\\d+$/.test(value)) {\n              value = parseInt(value);\n            }\n            if (option.value === value || option.id === value) {\n              this.isEdition(record) ? value = option.id : value = option.value;\n            }\n          });\n        }\n      }\n    } else if (column.type === 'autocomplete' && value && column.domainValues) {\n      const entity = record.entity as any;\n      if (!this.isEdition(record) && column.linkColumnForce) {\n        value = entity?.properties[this.getColumnKeyWithoutPropertiesTag(column.linkColumnForce)];\n      } else {\n        column.domainValues.forEach(option => {\n          if (typeof value === 'string' && /^\\d+$/.test(value)) {\n            value = parseInt(value);\n          }\n          if (option.value === value || option.id === value) {\n            value = option.value;\n          }\n        });\n      }\n    } else if (column.type === 'date') {\n      if (this.isEdition(record)) {\n        if (value) {\n          let date = moment(value);\n          value = date.format();\n          this.formGroup.controls[column.name].setValue(value);\n        }\n      } else if (!this.isEdition(record) && value === null) {\n        value = \"\";\n      }\n    }\n\n    if (value === undefined) {\n      value = '';\n    }\n\n    return value;\n  }\n\n  /**\n   * Method to access an entity's validation values\n   * @param column Column\n   * @param validationType string\n   * @returns Any value (false if no validation or not the one concerned)\n   * @internal\n   */\n  getValidationAttributeValue(column: EntityTableColumn, validationType: string): any {\n    if (column.validation !== undefined && column.validation[validationType] !== undefined) {\n      return column.validation[validationType];\n    } else {\n      return false;\n    }\n  }\n\n  public isEdition(record) {\n    return record.entity.edition ? true : false;\n  }\n\n  /**\n   * Return the type of renderer of a column\n   * @param column Column\n   * @returns Renderer type\n   * @internal\n   */\n  getColumnRenderer(column: EntityTableColumn): EntityTableColumnRenderer {\n    if (column.renderer !== undefined) {\n      return column.renderer;\n    }\n    return EntityTableColumnRenderer.Default;\n  }\n\n  /**\n   * Return the table ngClass\n   * @returns ngClass\n   * @internal\n   */\n  getTableClass(): {[key: string]: boolean} {\n    return {\n      'igo-entity-table-with-selection': this.selection\n    };\n  }\n\n  /**\n   * Return a header ngClass\n   * @returns ngClass\n   * @internal\n   */\n  getHeaderClass(): {[key: string]: boolean} {\n    const func = this.template.headerClassFunc;\n    if (func instanceof Function) {\n      return func();\n    }\n    return {};\n  }\n\n  /**\n   * Return a row ngClass\n   * @param record Record\n   * @returns ngClass\n   * @internal\n   */\n  getRowClass(record: EntityRecord<object>): {[key: string]: boolean} {\n    const entity = record.entity;\n    const func = this.template.rowClassFunc;\n    if (func instanceof Function) {\n      return func(entity, record);\n    }\n    return {};\n  }\n\n  /**\n   * Return a row ngClass\n   * @param record Record\n   * @param column Column\n   * @returns ngClass\n   * @internal\n   */\n  getCellClass(record: EntityRecord<object>, column: EntityTableColumn): {[key: string]: boolean} {\n    const entity = record.entity;\n    const cls = {};\n\n    const tableFunc = this.template.cellClassFunc;\n    if (tableFunc instanceof Function) {\n      Object.assign(cls, tableFunc(entity, column, record));\n    }\n\n    const columnFunc = column.cellClassFunc;\n    if (columnFunc instanceof Function) {\n      Object.assign(cls, columnFunc(entity, record));\n    }\n\n    return cls;\n  }\n\n  /**\n   * When a button is clicked\n   * @param func Function\n   * @param record Record\n   * @internal\n   */\n  onButtonClick(\n    clickFunc: (entity: object, record?: EntityRecord<object>) => void,\n    record: EntityRecord<object>\n  ) {\n    this.enableEdit(record);\n    if (typeof clickFunc === 'function') {\n      clickFunc(record.entity, record);\n    }\n  }\n\n  /**\n   * Retrieve column name without his \"properties\" tag (useful for edition workspace properties)\n   */\n  public getColumnKeyWithoutPropertiesTag(column: string) {\n    if (column.includes('properties.')) {\n      return column.split('.')[1];\n    }\n    return column;\n  }\n}\n","export enum ActionbarMode {\n  Dock = 'dock',\n  Overlay = 'overlay',\n  Context = 'context'\n}\n","<mat-list-item *ngIf=\"!action.checkbox\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\"\n  (click)=\"onClick()\">\n  <button *ngIf=\"withIcon\"\n    mat-list-avatar\n    mat-icon-button\n    [color]=\"color\"\n    [disabled]=\"disabled$ | async\">\n    <mat-icon *ngIf=\"withIcon\" svgIcon=\"{{icon$ | async}}\"></mat-icon>\n  </button>\n  <h4 *ngIf=\"withTitle\" matLine>{{title | translate}}</h4>\n</mat-list-item>\n\n<mat-list-item class=\"item-checkbox\" *ngIf=\"action.checkbox\"\n  matTooltipClass=\"actionbarItemTooltip\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"withTooltip ? ((tooltip$ | async) || title | translate) : ''\"\n  [ngClass]=\"ngClass$ | async\">\n  <mat-checkbox *ngIf=\"withTitle\"\n      (change)=\"action.handler()\"\n      [checked]=\"checkCondition$ | async\">\n      {{title | translate}}\n  </mat-checkbox>\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription, isObservable } from 'rxjs';\n\nimport { Action } from '../shared/action.interfaces';\n\n /**\n  * An action button\n  */\n@Component({\n  selector: 'igo-actionbar-item',\n  templateUrl: './actionbar-item.component.html',\n  styleUrls: ['./actionbar-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ActionbarItemComponent implements OnInit, OnDestroy {\n\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly checkCondition$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly tooltip$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly noDisplay$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly ngClass$: BehaviorSubject<{[key: string]: boolean}> = new BehaviorSubject({});\n\n  private ngClass$$: Subscription;\n\n  private disabled$$: Subscription;\n\n  private availability$$: Subscription;\n\n  private icon$$: Subscription;\n\n  private checkCondition$$: Subscription;\n\n  private tooltip$$: Subscription;\n\n  private noDisplay$$: Subscription;\n\n  private display$$: Subscription;\n\n  /**\n   * Action\n   */\n  @Input() action: Action;\n\n  /**\n   * Color\n   */\n  @Input() color = 'default';\n\n  /**\n   * Whether the action title is displayed\n   */\n  @Input() withTitle = true;\n\n  /**\n   * Whether the action icon is displayed\n   */\n  @Input() withIcon = true;\n\n  /**\n   * Whether a tooltip should be shown\n   */\n  @Input() withTooltip = true;\n\n  /**\n   * Whether the action is disabled\n   */\n  @Input()\n  set disabled(value: boolean) { this.disabled$.next(value); }\n  get disabled(): boolean { return this.disabled$.value; }\n\n  /**\n   * Whether the action is display or not\n   */\n  @Input()\n  set noDisplay(value: boolean) { this.noDisplay$.next(value); }\n  get noDisplay(): boolean { return this.noDisplay$.value; }\n\n  /**\n   * Event emitted when the action button is clicked\n   */\n  @Output() trigger: EventEmitter<Action> = new EventEmitter();\n\n  /**\n   * @internal\n   */\n  get title(): string { return this.action.title; }\n\n  constructor() {}\n\n  ngOnInit() {\n    const args = this.action.args || [];\n\n    if (this.action.ngClass !== undefined) {\n      this.ngClass$$ = this.action.ngClass(...args)\n        .subscribe((ngClass: {[key: string]: boolean}) => this.updateNgClass(ngClass));\n    }\n\n    if (isObservable(this.action.icon)) {\n      this.icon$$ = this.action.icon\n        .subscribe((icon: string) => this.updateIcon(icon));\n    } else {\n      this.updateIcon(this.action.icon);\n    }\n\n    if (isObservable(this.action.checkCondition)) {\n      this.checkCondition$$ = this.action.checkCondition\n        .subscribe((checkCondition: boolean) => this.updateCheckCondition(checkCondition));\n    } else {\n      this.updateCheckCondition(this.action.checkCondition);\n    }\n\n    if (isObservable(this.action.tooltip)) {\n      this.tooltip$$ = this.action.tooltip\n        .subscribe((tooltip: string) => this.updateTooltip(tooltip));\n    } else {\n      this.updateTooltip(this.action.tooltip);\n    }\n\n    if (this.action.availability !== undefined) {\n      this.availability$$ = this.action.availability(...args)\n        .subscribe((available: boolean) => this.disabled = !available);\n    }\n\n    this.disabled$$ = this.disabled$\n      .subscribe((disabled: boolean) => this.updateNgClass({'igo-actionbar-item-disabled': disabled}));\n\n    if (this.action.display !== undefined) {\n      this.display$$ = this.action.display(...args)\n        .subscribe((display: boolean) => this.noDisplay = !display);\n    }\n\n    this.noDisplay$$ = this.noDisplay$\n      .subscribe((noDisplay: boolean) => this.updateNgClass({'igo-actionbar-item-no-display': noDisplay}));\n  }\n\n  ngOnDestroy() {\n    if (this.ngClass$$ !== undefined) {\n      this.ngClass$$.unsubscribe();\n      this.ngClass$$ = undefined;\n    }\n\n    if (this.availability$$ !== undefined) {\n      this.availability$$.unsubscribe();\n      this.availability$$ = undefined;\n    }\n\n    if (this.display$$ !== undefined) {\n      this.display$$.unsubscribe();\n      this.display$$ = undefined;\n    }\n\n    if (this.checkCondition$$ !== undefined) {\n      this.checkCondition$$.unsubscribe();\n      this.checkCondition$$ = undefined;\n    }\n\n    if (this.icon$$ !== undefined) {\n      this.icon$$.unsubscribe();\n      this.icon$$ = undefined;\n    }\n\n    if (this.tooltip$$ !== undefined) {\n      this.tooltip$$.unsubscribe();\n      this.tooltip$$ = undefined;\n    }\n\n    this.disabled$$.unsubscribe();\n    this.noDisplay$$.unsubscribe();\n  }\n\n  /**\n   * When the action button is clicked, emit the 'trigger' event but don't\n   * invoke the action handler. This is handled by the parent component.\n   * @internal\n   */\n  onClick() {\n    if (this.disabled === true) {\n      return;\n    }\n    this.trigger.emit(this.action);\n  }\n\n  private updateNgClass(ngClass: {[key: string]: boolean}) {\n    this.ngClass$.next(Object.assign({}, this.ngClass$.value, ngClass));\n  }\n\n  private updateTooltip(tooltip: string) {\n    this.tooltip$.next(tooltip);\n  }\n\n  private updateCheckCondition(checkCondition: boolean) {\n    this.checkCondition$.next(checkCondition);\n  }\n\n  private updateIcon(icon: string) {\n    this.icon$.next(icon);\n  }\n}\n","<mat-list *ngIf=\"mode === actionbarMode.Dock\">\n\n    <div *ngIf=\"heightCondition && positionConditionTop && isDesktop\"\n      id=\"topChevron\">\n      <button\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.common.actionbar.scrollUp' | translate\"\n        (click)=\"scrollUp()\">\n        <mat-icon svgIcon=\"chevron-up\"></mat-icon>\n      </button>\n    </div>\n\n    <igo-actionbar-item\n      *ngIf=\"withToggleButton\"\n      color=\"accent\"\n      [withTitle]=\"false\"\n      [withIcon]=\"true\"\n      [color]=\"color\"\n      [disabled]=\"store.view.empty\"\n      [action]=\"toggleCollapseAction\"\n      (trigger)=\"onTriggerAction(toggleCollapseAction)\">\n    </igo-actionbar-item>\n\n    <ng-template #buttonContent *ngIf=\"!collapsed\" ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n      <igo-actionbar-item\n        color=\"accent\"\n        [withTitle]=\"withTitle\"\n        [withIcon]=\"withIcon\"\n        [withTooltip]=\"withTooltip\"\n        [color]=\"color\"\n        [disabled]=\"store.state.get(action).disabled\"\n        [action]=\"action\"\n        (trigger)=\"onTriggerAction(action)\">\n      </igo-actionbar-item>\n    </ng-template>\n\n    <div *ngIf=\"heightCondition && positionConditionLow && isDesktop\"\n      id=\"lowChevron\">\n      <button\n        mat-icon-button\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.common.actionbar.scrollDown' | translate\"\n        (click)=\"scrollDown()\">\n        <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n      </button>\n    </div>\n\n</mat-list>\n\n<div *ngIf=\"mode === actionbarMode.Overlay\">\n  <button class=\"buttonOverlay\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.common.actionbar.icon' | translate\"\n    [matMenuTriggerFor]=\"actionbarMenu\"\n    [disabled]=\"store.view.empty\"\n    [color]=\"iconColor\">\n    <mat-icon [svgIcon]=\"icon\"></mat-icon>\n  </button>\n\n  <mat-menu\n    #actionbarMenu=\"matMenu\"\n    class=\"igo-compact-menu igo-no-min-width-menu\"\n    overlapTrigger=\"true\"\n    [xPosition]=\"xPosition\"\n    [yPosition]=\"yPosition\"\n    [class]=\"overlayClass\">\n\n    <mat-list>\n      <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n        <igo-actionbar-item\n          color=\"accent\"\n          [withTitle]=\"withTitle\"\n          [withIcon]=\"withIcon\"\n          [color]=\"color\"\n          [action]=\"action\"\n          (trigger)=\"onTriggerAction(action)\">\n        </igo-actionbar-item>\n      </ng-template>\n    </mat-list>\n  </mat-menu>\n</div>\n<mat-card *ngIf=\"mode === actionbarMode.Context\" class=\"context-menu-card mat-elevation-z4\">\n  <mat-list>\n      <ng-template ngFor let-action [ngForOf]=\"store.view.all$() | async\">\n          <igo-actionbar-item\n            color=\"accent\"\n            [withTitle]=\"withTitle\"\n            [withIcon]=\"withIcon\"\n            [color]=\"color\"\n            [action]=\"action\"\n            (trigger)=\"onTriggerAction(action)\">\n          </igo-actionbar-item>\n        <br/>\n      </ng-template>\n  </mat-list>\n</mat-card>\n","import {\n  Component,\n  Input,\n  HostBinding,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy,\n  OnChanges,\n  OnDestroy,\n  SimpleChanges,\n  ElementRef\n} from '@angular/core';\n\nimport { MediaService, Media } from '@igo2/core';\nimport { EntityStoreWatcher } from '../../entity';\nimport { Action } from '../shared/action.interfaces';\nimport { ActionbarMode } from '../shared/action.enums';\nimport { ActionStore } from '../shared/store';\nimport { Overlay } from '@angular/cdk/overlay';\nimport { BehaviorSubject } from 'rxjs';\n\n/**\n * A list of action buttons.\n * This component can be displayed in one of two way: 'dock' or 'overlay'\n */\n@Component({\n  selector: 'igo-actionbar',\n  templateUrl: './actionbar.component.html',\n  styleUrls: ['./actionbar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ActionbarComponent implements OnDestroy, OnChanges {\n\n  /**\n   * Reference to the ActionbarMode enum for use in the template\n   * @internal\n   */\n  actionbarMode = ActionbarMode;\n\n  /**\n   * Whether the actionbar is collapsed (Dock mode)\n   * @internal\n   */\n  collapsed = false;\n\n  /**\n   * Toggle collapse action (Dock)\n   * @internal\n   */\n  toggleCollapseAction = {\n    id: 'actionbar_toggle',\n    icon: 'dots-vertical',\n    handler: () => {\n      this.collapsed = !this.collapsed;\n    }\n  };\n\n  /**\n   * Action store watcher\n   * @internal\n   */\n  private watcher: EntityStoreWatcher<Action>;\n\n  /**\n   * Height Condition for scroll button\n   */\n  heightCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n\n  /**\n   * Position Condition for top scroll button\n   */\n  positionConditionTop$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(true);\n\n  /**\n   * Position Condition for low scroll button\n   */\n  positionConditionLow$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(true);\n\n  /**\n   * Action store\n   */\n  @Input() store: ActionStore;\n\n  /**\n   * Actionbar mode\n   */\n  @Input() mode: ActionbarMode = ActionbarMode.Dock;\n\n  /**\n   * Whether a toggle button should be displayed (Dock mode)\n   */\n  @Input() withToggleButton = false;\n\n  /**\n   * Whether a the actionbar should display buttons horizontally\n   */\n  @Input() horizontal = false;\n\n  /**\n   * Color\n   */\n  @Input() color = 'default';\n\n  /**\n   * Color of the button if action mode === overlay\n   */\n  @Input() iconColor = 'default';\n\n  /**\n   * Whether action titles are displayed\n   */\n  @Input() withTitle = true;\n\n  /**\n   * Whether action tooltips are displayed\n   */\n  @Input() withTooltip = true;\n\n  /**\n   * Whether action titles are displayed (condition for scroll button)\n   */\n  @Input() scrollActive = true;\n\n  /**\n   * Whether action icons are displayed\n   */\n  @Input() withIcon = true;\n\n  /**\n   * Which icon want to be shown\n   */\n  @Input() icon = 'dots-horizontal';\n\n  /**\n   * Overlay X position\n   */\n  @Input() xPosition = 'before';\n\n  /**\n   * Overlay Y position\n   */\n  @Input() yPosition = 'above';\n\n  /**\n   * Class to add to the actionbar overlay\n   */\n  @Input()\n  set overlayClass(value: string) {\n    this._overlayClass = value;\n  }\n  get overlayClass(): string {\n    return [this._overlayClass, 'igo-actionbar-overlay'].join(' ');\n  }\n  private _overlayClass = '';\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.with-title')\n  get withTitleClass() {\n    return this.withTitle;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.with-icon')\n  get withIconClass() {\n    return this.withIcon;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.horizontal')\n  get horizontalClass() {\n    return this.horizontal;\n  }\n\n  get heightCondition(): boolean {\n    const el = this.elRef.nativeElement;\n    if (this.scrollActive === false) {\n      if (el.clientHeight < el.scrollHeight) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  get positionConditionTop(): boolean {\n    if (this.elRef.nativeElement.scrollTop === 0) {\n      return false;\n    }\n    return true;\n  }\n\n  get positionConditionLow(): boolean {\n    const el = this.elRef.nativeElement;\n    if (el.scrollTop >= (el.scrollHeight - el.clientHeight)) {\n      return false;\n    }\n    return true;\n  }\n\n  get isDesktop(): boolean {\n    return this.mediaService.getMedia() === Media.Desktop;\n  }\n\n  constructor(\n    public overlay: Overlay,\n    private elRef: ElementRef,\n    private cdRef: ChangeDetectorRef,\n    public mediaService: MediaService) {}\n\n  /**\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const store = changes.store;\n    if (store && store.currentValue !== store.previousValue) {\n      if (this.watcher !== undefined) {\n        this.watcher.destroy();\n      }\n      this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n    }\n  }\n\n  /**\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n  }\n\n  /**\n   * Invoke the action handler\n   * @internal\n   */\n  onTriggerAction(action: Action) {\n    const args = action.args || [];\n    action.handler(...args);\n  }\n\n  scrollDown() {\n    this.elRef.nativeElement.scrollBy(0, 52);\n  }\n\n  scrollUp() {\n    this.elRef.nativeElement.scrollBy(0, -52);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { ActionbarComponent } from './actionbar.component';\nimport { ActionbarItemComponent } from './actionbar-item.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatMenuModule,\n    MatListModule,\n    MatCardModule,\n    MatCheckboxModule\n  ],\n  exports: [ActionbarComponent],\n  declarations: [ActionbarComponent, ActionbarItemComponent]\n})\nexport class IgoActionbarModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoActionbarModule } from './actionbar/actionbar.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoActionbarModule\n  ],\n  exports: [\n    IgoActionbarModule\n  ],\n  declarations: [],\n  providers: []\n})\nexport class IgoActionModule {}\n","import { Directive, Input, ElementRef, OnInit } from '@angular/core';\nimport { MatIconRegistry } from '@angular/material/icon';\n\n\n/**\n * This directive allow to add an icon inside a matBadge.\n * A value must be set into the matBadge directive ex: matBadge=\"icon\".\n * The badge content will be overrided by this current directive.\n */\n@Directive({\n  selector: '[igoMatBadgeIcon]'\n})\nexport class IgoBadgeIconDirective implements OnInit {\n  @Input()\n  set igoMatBadgeIcon(value: string) {\n    this.matIconRegistry.getNamedSvgIcon(value).subscribe((svgObj) => {\n      this.svg = svgObj;\n      this.updateSvg();\n    });\n  }\n  private svg: SVGElement;\n\n  @Input()\n  set matBadgeHidden(value: boolean) {\n    this.hidden = value;\n    this.updateHidden();\n  }\n  private hidden = false;\n\n  @Input()\n  set matBadgeDisabled(value: boolean) {\n    this.disabled = value;\n    this.updateDisabled();\n  }\n  private disabled = false;\n\n  @Input()\n  set igoMatBadgeInverseColor(value: boolean) {\n    this.inverseColor = value;\n    this.updateColor();\n  }\n  private inverseColor = false;\n\n  @Input()\n  set igoMatBadgeInheritColor(value: boolean) {\n    this.inheritColor = value;\n    this.updateColor();\n  }\n  private inheritColor = false;\n\n  @Input()\n  set igoMatBadgeColor(value: string) {\n    this.color = value;\n    this.updateColor();\n  }\n  private color;\n\n  @Input()\n  set igoMatBadgeBackgroundColor(value: string) {\n    this.backgroundColor = value;\n    this.updateColor();\n  }\n  private backgroundColor;\n\n  get badge() {\n    return this.el.nativeElement.querySelector('.mat-badge-content');\n  }\n\n  private originalColor: string;\n\n  constructor(\n    private el: ElementRef,\n    private matIconRegistry: MatIconRegistry\n  ) {}\n\n  ngOnInit() {\n    this.badge.style.alignItems = 'center';\n    this.badge.style.justifyContent = 'center';\n\n    this.updateHidden();\n    this.updateColor();\n    this.updateSvg();\n  }\n\n  private updateSvg() {\n    if (!this.badge) {\n      return;\n    }\n    this.badge.innerHTML = '';\n    if (this.svg) {\n      this.badge.appendChild(this.svg);\n    }\n  }\n  private updateColor() {\n    if (!this.badge) {\n      return;\n    }\n\n    if (this.color || this.backgroundColor) {\n      this.badge.style.color = this.color ? this.color : '';\n      this.badge.style.background = this.backgroundColor ? this.backgroundColor : '';\n    } else if (this.inheritColor) {\n      if (this.inverseColor) {\n        this.badge.style.color = 'currentColor';\n        this.badge.style.background = 'none';\n      } else {\n        this.badge.style.color = '';\n        this.badge.style.background = 'currentColor';\n      }\n    } else if (!this.inheritColor) {\n      if (this.inverseColor) {\n        this.badge.style.color = window\n          .getComputedStyle(this.badge, null)\n          .getPropertyValue('background-color');\n        this.badge.style.background = 'none';\n      } else {\n        this.badge.style.color = '';\n        this.badge.style.background = '';\n      }\n    }\n    this.originalColor = this.badge.style.color;\n    this.updateDisabled();\n  }\n\n  private updateHidden() {\n    if (!this.badge) {\n      return;\n    }\n    this.badge.style.display = this.hidden ? 'none' : 'flex';\n  }\n\n  private updateDisabled() {\n    if (!this.badge || !this.inverseColor) {\n      return;\n    }\n    if (this.disabled) {\n      this.originalColor = this.badge.style.color;\n      this.badge.style.color = '#b9b9b9';\n    } else {\n      this.badge.style.color = this.originalColor;\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { IgoBadgeIconDirective } from './badge-icon.directive';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatIconModule } from '@angular/material/icon';\n\n@NgModule({\n  imports: [MatBadgeModule, MatIconModule],\n  declarations: [IgoBadgeIconDirective],\n  exports: [MatBadgeModule, IgoBadgeIconDirective]\n})\nexport class IgoMatBadgeIconModule {\n  static forRoot(): ModuleWithProviders<IgoMatBadgeIconModule> {\n    return {\n      ngModule: IgoMatBadgeIconModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Output\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoClickout]'\n})\nexport class ClickoutDirective {\n  @Output() clickout = new EventEmitter<MouseEvent>();\n\n  @HostListener('document:click', ['$event', '$event.target'])\n  handleMouseClick(event: MouseEvent, target: HTMLElement) {\n    if (!target) {\n      return;\n    }\n\n    if (!this.el.nativeElement.contains(target)) {\n      this.clickout.emit(event);\n    }\n  }\n\n  constructor(private el: ElementRef) {}\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { ClickoutDirective } from './clickout.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [ClickoutDirective],\n  exports: [ClickoutDirective]\n})\nexport class IgoClickoutModule {\n  static forRoot(): ModuleWithProviders<IgoClickoutModule> {\n    return {\n      ngModule: IgoClickoutModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  HostListener,\n  ElementRef,\n  Renderer2\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoCollapse]'\n})\nexport class CollapseDirective {\n  @Input()\n  get target() {\n    return this._target;\n  }\n  set target(value: Element) {\n    this._target = value;\n  }\n  private _target: Element;\n\n  @Input()\n  get collapsed(): boolean {\n    return this._collapsed;\n  }\n  set collapsed(collapsed: boolean) {\n    collapsed ? this.collapseTarget() : this.expandTarget();\n    this._collapsed = collapsed;\n    this.toggle.emit(collapsed);\n  }\n  private _collapsed = false;\n\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\n\n  @HostListener('click')\n  click() {\n    this.collapsed = !this.collapsed;\n  }\n\n  constructor(private renderer: Renderer2, private el: ElementRef) {}\n\n  private collapseTarget() {\n    this.renderer.addClass(this.target, 'igo-collapsed');\n    this.renderer.addClass(this.el.nativeElement, 'collapsed');\n  }\n\n  private expandTarget() {\n    this.renderer.removeClass(this.target, 'igo-collapsed');\n    this.renderer.removeClass(this.el.nativeElement, 'collapsed');\n  }\n}\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\n\n@Component({\n  selector: 'igo-collapsible',\n  templateUrl: './collapsible.component.html',\n  styleUrls: ['./collapsible.component.scss']\n})\nexport class CollapsibleComponent {\n  @Input()\n  get title() {\n    return this._title;\n  }\n  set title(value: string) {\n    this._title = value;\n  }\n  private _title = '';\n\n  @Input()\n  get collapsed() {\n    return this._collapsed;\n  }\n  set collapsed(value: boolean) {\n    this._collapsed = value;\n    this.toggle.emit(value);\n  }\n  private _collapsed = false;\n\n  @Output() toggle: EventEmitter<boolean> = new EventEmitter();\n}\n","<mat-list-item>\n  <mat-icon\n    svgIcon=\"chevron-up\" \n    class=\"igo-chevron\"\n    mat-list-avatar\n    igoCollapse\n    [target]=\"content\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"collapsed = $event\">\n  </mat-icon>\n  <h4 matLine>{{title}}</h4>\n</mat-list-item>\n\n<div #content>\n  <ng-content></ng-content>\n</div>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { CollapseDirective } from './collapse.directive';\nimport { CollapsibleComponent } from './collapsible.component';\n\n@NgModule({\n  imports: [MatIconModule, MatListModule],\n  declarations: [CollapsibleComponent, CollapseDirective],\n  exports: [CollapsibleComponent, CollapseDirective]\n})\nexport class IgoCollapsibleModule {\n  static forRoot(): ModuleWithProviders<IgoCollapsibleModule> {\n    return {\n      ngModule: IgoCollapsibleModule,\n      providers: []\n    };\n  }\n}\n","import { Component } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\n@Component({\n  selector: 'igo-confirm-dialog',\n  templateUrl: './confirm-dialog.component.html',\n  styleUrls: ['./confirm-dialog.component.scss']\n})\nexport class ConfirmDialogComponent {\n  public confirmMessage: string;\n\n  constructor(public dialogRef: MatDialogRef<ConfirmDialogComponent>) {}\n}\n","<h2 mat-dialog-title class=\"mat-typography\">{{'igo.common.confirmDialog.title' |translate}}</h2>\n<div mat-dialog-content class=\"mat-typography\">{{confirmMessage}}</div>\n<div mat-dialog-actions>\n  <button mat-button color=\"primary\" (click)=\"dialogRef.close(true)\">{{'igo.common.confirmDialog.confirmBtn' | translate}}</button>\n  <button mat-button (click)=\"dialogRef.close(false)\">{{'igo.common.confirmDialog.cancelBtn' |translate}}</button>\n</div>\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { Observable } from 'rxjs';\n\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\n\n@Injectable()\nexport class ConfirmDialogService {\n  constructor(private dialog: MatDialog) {}\n\n  public open(message: string): Observable<any> {\n    const dialogRef = this.dialog.open(ConfirmDialogComponent, {\n      disableClose: false\n    });\n    dialogRef.componentInstance.confirmMessage = message;\n\n    return dialogRef.afterClosed();\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { ConfirmDialogComponent } from './confirm-dialog.component';\nimport { ConfirmDialogService } from './confirm-dialog.service';\n\n@NgModule({\n  imports: [MatButtonModule, MatDialogModule, IgoLanguageModule],\n  declarations: [ConfirmDialogComponent],\n  exports: [ConfirmDialogComponent],\n  providers: [ConfirmDialogService]\n})\nexport class IgoConfirmDialogModule {\n  static forRoot(): ModuleWithProviders<IgoConfirmDialogModule> {\n    return {\n      ngModule: IgoConfirmDialogModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  HostListener,\n  Input,\n  Output,\n  ViewContainerRef\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { TemplatePortal } from '@angular/cdk/portal';\nimport { fromEvent, Subscription } from 'rxjs';\nimport { filter, take } from 'rxjs/operators';\nimport { Overlay, OverlayRef } from '@angular/cdk/overlay';\n\n@Directive({\n  selector: '[igoContextMenu]'\n})\nexport class ContextMenuDirective {\n  private overlayRef: OverlayRef | null;\n  private sub: Subscription;\n\n  @Input('igoContextMenu') menuContext: TemplateRef<any>;\n  @Output() menuPosition = new EventEmitter<{ x: number; y: number }>();\n\n  constructor(\n    public overlay: Overlay,\n    public viewContainerRef: ViewContainerRef,\n    private elementRef: ElementRef\n  ) {}\n\n  @HostListener('longpress', ['$event'])\n  @HostListener('contextmenu', ['$event'])\n  public onContextMenu(e: MouseEvent | TouchEvent): void {\n    let x;\n    let y;\n    if (e instanceof TouchEvent) {\n      x = e.touches[0].pageX;\n      y = e.touches[0].pageY;\n    } else if (e instanceof MouseEvent) {\n      x = e.x;\n      y = e.y;\n    }\n    if (!x || !y) {\n      return;\n    }\n\n    this.close();\n    e.preventDefault();\n    this.menuPosition.emit({ x, y });\n    this.overlayRef = null;\n    const positionStrategy = this.overlay\n      .position()\n      .flexibleConnectedTo({ x, y })\n      .withPositions([\n        {\n          originX: 'end',\n          originY: 'bottom',\n          overlayX: 'start',\n          overlayY: 'top'\n        }\n      ]);\n    this.overlayRef = this.overlay.create({\n      positionStrategy,\n      scrollStrategy: this.overlay.scrollStrategies.close()\n    });\n    this.overlayRef.attach(\n      new TemplatePortal(this.menuContext, this.viewContainerRef, {\n        $implicit: undefined\n      })\n    );\n\n    this.sub = fromEvent<MouseEvent>(document, 'click')\n      .pipe(\n        filter(event => {\n          const clickTarget = event.target as HTMLElement;\n          this.close();\n          return (\n            !!this.overlayRef &&\n            !this.overlayRef.overlayElement.contains(clickTarget)\n          );\n        }),\n        take(1)\n      )\n      .subscribe(() => this.close());\n\n    this.sub = fromEvent<MouseEvent>(document, 'contextmenu')\n      .pipe(\n        filter(event => {\n          const clickTarget = event.target as HTMLElement;\n          if (\n            clickTarget &&\n            !this.elementRef.nativeElement.contains(clickTarget) &&\n            !this.overlayRef.overlayElement.contains(clickTarget)\n          ) {\n            return true;\n          } else {\n            event.preventDefault();\n          }\n        }),\n        take(1)\n      )\n      .subscribe(() => this.close());\n  }\n\n  close() {\n    if (this.overlayRef) {\n      this.overlayRef.dispose();\n      this.overlayRef = null;\n    }\n    if (this.sub) {\n      this.sub.unsubscribe();\n    }\n  }\n}\n","import { Directive, HostListener, Output, EventEmitter, Input } from '@angular/core';\nimport { userAgent } from '@igo2/utils';\n\n\n/**\n * IgoLongPress trigger longpress event after a define duration.\n * This directive exist to patch the unavailable contextmenu event on iOS.\n * @param touchDuration touch duration in ms, default value is 400ms\n * @param iOSOnly define if longpress is triggered only for iOS, default value = true\n */\n@Directive({\n  selector: '[igoLongPress]'\n})\nexport class LongPressDirective {\n  private touchTimeout: any;\n  @Input() touchDuration: number = 400;\n  @Input() onlyIOS: boolean = true;\n  @Output() longpress = new EventEmitter();\n\n  constructor() { }\n\n\n  @HostListener('touchstart', ['$event'])\n  public touchstart(e: TouchEvent) {\n    this.touchTimeout = setTimeout(() => {\n      if (this.onlyIOS) {\n        if (userAgent.getOSName() === 'iOS') {\n          this.longpress.emit(e);\n        }\n      } else {\n        this.longpress.emit(e);\n      }\n    }, this.touchDuration);\n  }\n  @HostListener('touchmove')\n  @HostListener('touchcancel')\n  @HostListener('touchend')\n  public touchend() {\n    this.touchEnd();\n  }\n\n\n  private touchEnd() {\n    clearTimeout(this.touchTimeout);\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { ContextMenuDirective } from './context-menu.directive';\nimport { LongPressDirective } from './long-press.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [ContextMenuDirective, LongPressDirective],\n  exports: [ContextMenuDirective, LongPressDirective]\n})\nexport class IgoContextMenuModule {\n  static forRoot(): ModuleWithProviders<IgoContextMenuModule> {\n    return {\n      ngModule: IgoContextMenuModule,\n      providers: []\n    };\n  }\n}\n","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'igo-custom-html',\n  templateUrl: './custom-html.component.html',\n  styleUrls: ['./custom-html.component.scss']\n})\nexport class CustomHtmlComponent {\n  @Input()\n  get html(): string {\n    return this._html;\n  }\n  set html(value: string) {\n    this._html = value;\n  }\n  private _html = '';\n\n  constructor() {}\n}\n","<div class=\"custom-html\" [innerHTML]=\"html | sanitizeHtml\"></div>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { CustomHtmlComponent } from './custom-html.component';\nimport { SanitizeHtmlPipe } from './custom-html.pipe';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatInputModule,\n    MatButtonModule,\n    IgoLanguageModule\n  ],\n  exports: [SanitizeHtmlPipe, CustomHtmlComponent],\n  declarations: [SanitizeHtmlPipe, CustomHtmlComponent]\n})\nexport class IgoCustomHtmlModule {\n  static forRoot(): ModuleWithProviders<IgoCustomHtmlModule> {\n    return {\n      ngModule: IgoCustomHtmlModule\n    };\n  }\n}\n","import { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { catchError, map } from 'rxjs/operators';\nimport { throwError } from 'rxjs';\n\nimport { DOMOptions, DOMValue } from './dom.interfaces';\nimport { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DOMService {\n\n  constructor(private http: HttpClient) {}\n\n  async getDom(dom: DOMOptions): Promise<DOMValue[]> {\n    const url = dom.url;\n    let result: DOMValue[];\n\n    await this.http.get<any>(url).pipe(\n      map(response => {\n        result = response;\n        return response;\n      }),\n      catchError((err: HttpErrorResponse) => {\n        return throwError(err);\n      })\n    ).toPromise();\n\n    return result;\n  }\n\n}\n","import { ModuleWithProviders, NgModule } from '@angular/core';\n\nimport { DOMService } from './dom.service';\n\n@NgModule({\n  providers: [DOMService]\n})\nexport class IgoDOMModule {\n  static forRoot(): ModuleWithProviders<IgoDOMModule> {\n    return {\n      ngModule: IgoDOMModule,\n      providers: [\n        DOMService\n      ]\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { DragAndDropDirective } from './drag-drop.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [DragAndDropDirective],\n  exports: [DragAndDropDirective]\n})\nexport class IgoDrapDropModule {\n  static forRoot(): ModuleWithProviders<IgoDrapDropModule> {\n    return {\n      ngModule: IgoDrapDropModule,\n      providers: []\n    };\n  }\n}\n","import {\n  ComponentFactory,\n  ComponentRef,\n  ViewContainerRef\n} from '@angular/core';\n\nimport { Observable, Subscription } from 'rxjs';\n\n/**\n * This class is used in the DynamicComponentOutlet component. It holds\n * a reference to a component factory and can render that component\n * in a target element on demand. It's also possible to set inputs\n * and to subscribe to outputs.\n */\nexport class DynamicComponent<C> {\n\n  /**\n   * Component reference\n   */\n  private componentRef: ComponentRef<C>;\n\n  /**\n   * Subscriptions to the component's outputs. Those need\n   * to be unsubscribed when the component is destroyed.\n   */\n  private subscriptions: Subscription[] = [];\n\n  /**\n   * Component target element\n   */\n  private target: ViewContainerRef;\n\n  /**\n   * Component inputs\n   */\n  private inputs: {[key: string]: any} = {};\n\n  /**\n   * Subscriptions to the component's async inputs\n   */\n  private inputs$$: {[key: string]: Subscription} = {};\n\n  /**\n   * Subscribers to the component's outputs\n   */\n  private subscribers: {[key: string]: (event: any) => void} = {};\n\n  constructor(private componentFactory: ComponentFactory<C>) {}\n\n  /**\n   * Render the component to a target element.\n   * Set it's inputs and subscribe to it's outputs.\n   * @param target Target element\n   */\n  setTarget(target: ViewContainerRef) {\n    this.target = target;\n    this.componentRef = target.createComponent(this.componentFactory);\n    this.updateInputs(this.inputs);\n    this.updateSubscribers(this.subscribers);\n  }\n\n  /**\n   * Destroy this component. That means, removing from it's target\n   * element and unsubscribing to it's outputs.\n   */\n  destroy() {\n    if (this.target !== undefined) {\n      this.target.clear();\n    }\n    if (this.componentRef !== undefined) {\n      this.componentRef.destroy();\n      this.componentRef = undefined;\n    }\n    this.unobserveAllInputs();\n    this.unsubscribeAll();\n  }\n\n  /**\n   * Update the component inputs. This is an update so any\n   * key not defined won't be overwritten.\n   */\n  updateInputs(inputs: {[key: string]: any}) {\n    this.inputs = inputs;\n    if (this.componentRef === undefined) {\n      return;\n    }\n\n    const instance = this.componentRef.instance;\n    const allowedInputs = this.componentFactory.inputs;\n    allowedInputs.forEach((value: {propName: string; templateName: string; }) => {\n      const key = value.propName;\n\n      this.unobserveInput(key);\n\n      const inputValue = inputs[key];\n      if (inputs.hasOwnProperty(key)) {\n        if (inputValue instanceof Observable) {\n          this.observeInput(key, inputValue);\n        } else {\n          this.setInputValue(instance, key, inputValue);\n        }\n      }\n    });\n\n    if (typeof (instance as any).onUpdateInputs === 'function') {\n      (instance as any).onUpdateInputs();\n    }\n  }\n\n  /**\n   * Set an instance's input value\n   * @param instance Component instance\n   * @param key Input key\n   * @param value Input value\n   */\n  private setInputValue(instance: C, key: string, value: any) {\n    const currentValue = instance[key];\n    if (value === currentValue) {\n      return;\n    }\n\n    const prototype = Object.getPrototypeOf(instance);\n    const descriptor = Object.getOwnPropertyDescriptor(prototype, key);\n    if (descriptor !== undefined && descriptor.set !== undefined) {\n      descriptor.set.call(instance, value);\n    } else {\n      instance[key] = value;\n    }\n  }\n\n  /**\n   * Update the component subscribers. This is an update so any\n   * key not defined won't be overwritten.\n   */\n  updateSubscribers(subscribers: {[key: string]: (event: any) => void}) {\n    this.subscribers = subscribers;\n    if (this.componentRef === undefined) {\n      return;\n    }\n\n    const instance = this.componentRef.instance;\n    const allowedSubscribers = this.componentFactory.outputs;\n    allowedSubscribers.forEach((value: {propName: string; templateName: string; }) => {\n      const key = value.propName;\n      if (subscribers.hasOwnProperty(key)) {\n        const emitter = instance[key];\n        const subscriber = subscribers[key];\n        if (Array.isArray(subscriber)) {\n          subscriber.forEach((_subscriber) => {\n            this.subscriptions.push(emitter.subscribe(_subscriber));\n          });\n        } else {\n          this.subscriptions.push(emitter.subscribe(subscriber));\n        }\n      }\n    });\n  }\n\n  /**\n   * Subscribe to an observable input and update the component's input value\n   * accordingly\n   * @param key Input key\n   * @param observable Observable\n   */\n  private observeInput(key: string, observable: Observable<any>) {\n    this.inputs$$[key] = observable.subscribe((value: any) => {\n      const instance = this.componentRef.instance;\n      this.setInputValue(instance, key, value);\n\n      if (typeof (instance as any).onUpdateInputs === 'function') {\n        (instance as any).onUpdateInputs();\n      }\n    });\n  }\n\n  /**\n   * Unsubscribe to an observable input\n   * @param key Input key\n   */\n  private unobserveInput(key: string) {\n    if (this.inputs$$[key] !== undefined) {\n      this.inputs$$[key].unsubscribe();\n      this.inputs$$[key] = undefined;\n    }\n  }\n\n  /**\n   * Unsubscribe to all outputs.\n   */\n  private unobserveAllInputs() {\n    Object.values(this.inputs$$).forEach((s: Subscription | undefined) => {\n      if (s !== undefined) {\n        s.unsubscribe();\n      }\n    });\n    this.inputs$$ = {};\n  }\n\n  /**\n   * Unsubscribe to all outputs.\n   */\n  private unsubscribeAll() {\n    this.subscriptions.forEach((s: Subscription) => s.unsubscribe());\n    this.subscriptions = [];\n  }\n\n}\n","import {\n  ComponentFactoryResolver,\n  Injectable\n} from '@angular/core';\n\nimport { DynamicComponent } from './dynamic-component';\n\n/**\n * Service to creates DynamicComponent instances from base component classes\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class DynamicComponentService {\n\n  constructor(private resolver: ComponentFactoryResolver) {}\n\n  /**\n   * Creates a DynamicComponent instance from a base component class\n   * @param componentCls The component class\n   * @returns DynamicComponent instance\n   */\n  create(componentCls: any): DynamicComponent<any> {\n    const factory = this.resolver.resolveComponentFactory(componentCls as any);\n    return new DynamicComponent<typeof componentCls>(factory);\n  }\n}\n","import {\n  Input,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy,\n  Component,\n  OnChanges,\n  OnDestroy,\n  SimpleChanges,\n  ViewContainerRef,\n  ViewChild\n} from '@angular/core';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { DynamicComponent } from '../shared/dynamic-component';\nimport { DynamicComponentService } from '../shared/dynamic-component.service';\n\n@Component({\n  selector: 'igo-dynamic-outlet',\n  templateUrl: 'dynamic-outlet.component.html',\n  styleUrls: ['dynamic-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DynamicOutletComponent implements OnChanges, OnDestroy {\n  /**\n   * The dynamic component base class or the dynamic component itself\n   */\n  @Input() component: DynamicComponent<any> | any;\n\n  /**\n   * The dynamic component inputs\n   */\n  @Input() inputs: { [key: string]: any } = {};\n\n  /**\n   * The subscribers to the dynamic component outputs\n   */\n  @Input() subscribers: { [key: string]: (event: any) => void } = {};\n\n  /**\n   * The dynamic component\n   */\n  private dynamicComponent: DynamicComponent<any>;\n\n  /**\n   * The view element to render the component to\n   * @ignore\n   */\n  @ViewChild('target', { read: ViewContainerRef, static: true })\n  private target: ViewContainerRef;\n\n  constructor(\n    private dynamicComponentService: DynamicComponentService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * If the dynamic component changes, create it.\n   * If the inputs or subscribers change, update the current component's\n   * inputs or subscribers.\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const component = changes.component;\n    const inputs = changes.inputs;\n    const subscribers = changes.subscribers;\n    const eq = ObjectUtils.objectsAreEquivalent;\n\n    if (!component || !component.currentValue) {\n      return;\n    }\n\n    if (component.currentValue !== component.previousValue) {\n      this.createComponent(component.currentValue);\n    } else {\n      const inputsAreEquivalents =\n        inputs && eq(inputs.currentValue || {}, inputs.previousValue || {});\n      const subscribersAreEquivalents =\n        subscribers &&\n        eq(subscribers.currentValue || {}, subscribers.previousValue || {});\n\n      if (inputsAreEquivalents === false) {\n        this.updateInputs();\n      }\n\n      if (subscribersAreEquivalents === false) {\n        this.updateSubscribers();\n      }\n    }\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * Destroy the dynamic component and all it's subscribers\n   * @internal\n   */\n  ngOnDestroy() {\n    if (this.dynamicComponent) {\n      this.dynamicComponent.destroy();\n    }\n  }\n\n  /**\n   * Create a  DynamicComponent out of the component class and render it.\n   * @internal\n   */\n  private createComponent(component: DynamicComponent<any> | any) {\n    if (this.dynamicComponent !== undefined) {\n      this.dynamicComponent.destroy();\n    }\n    this.dynamicComponent =\n      component instanceof DynamicComponent\n        ? component\n        : this.dynamicComponentService.create(component);\n    this.renderComponent();\n  }\n\n  /**\n   * Create and render the dynamic component. Set it's inputs and subscribers\n   * @internal\n   */\n  private renderComponent() {\n    this.updateInputs();\n    this.updateSubscribers();\n    this.dynamicComponent.setTarget(this.target);\n  }\n\n  /**\n   * Update the dynamic component inputs. This is an update so any\n   * key not defined won't be overwritten.\n   * @internal\n   */\n  private updateInputs() {\n    this.dynamicComponent.updateInputs(this.inputs);\n  }\n\n  /**\n   * Update the dynamic component subscribers. This is an update so any\n   * key not defined won't be overwritten.\n   * @internal\n   */\n  private updateSubscribers() {\n    this.dynamicComponent.updateSubscribers(this.subscribers);\n  }\n}\n","<ng-template #target></ng-template>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { DynamicOutletComponent } from './dynamic-outlet.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    DynamicOutletComponent\n  ],\n  declarations: [\n    DynamicOutletComponent\n  ]\n})\nexport class IgoDynamicOutletModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoDynamicOutletModule } from './dynamic-outlet/dynamic-outlet.module';\nimport { DynamicComponentService } from './shared/dynamic-component.service';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoDynamicOutletModule\n  ],\n  exports: [\n    IgoDynamicOutletModule\n  ],\n  providers: [\n    DynamicComponentService\n  ]\n})\nexport class IgoDynamicComponentModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { FlexibleComponent } from './flexible.component';\n\n@NgModule({\n  imports: [],\n  declarations: [FlexibleComponent],\n  exports: [FlexibleComponent]\n})\nexport class IgoFlexibleModule {\n  static forRoot(): ModuleWithProviders<IgoFlexibleModule> {\n    return {\n      ngModule: IgoFlexibleModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  OnChanges,\n  SimpleChanges,\n  ChangeDetectionStrategy,\n  ViewChild,\n  ElementRef\n} from '@angular/core';\n\nimport { t } from 'typy';\n\nimport { Form, FormField, FormFieldGroup } from '../shared/form.interfaces';\nimport { getAllFormFields } from '../shared/form.utils';\n\n/**\n * A configurable form\n */\n@Component({\n  selector: 'igo-form',\n  templateUrl: './form.component.html',\n  styleUrls: ['./form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormComponent implements OnChanges {\n\n  /**\n   * Form\n   */\n  @Input() form: Form;\n\n  /**\n   * Input data\n   */\n  @Input() formData: { [key: string]: any};\n\n  /**\n   * Form autocomplete\n   */\n  @Input() autocomplete: string = 'off';\n\n  /**\n   * Event emitted when the form is submitted\n   */\n  @Output() submitForm = new EventEmitter<{[key: string]: any}>();\n\n  @ViewChild('buttons', { static: true }) buttons: ElementRef;\n\n  get hasButtons(): boolean {\n    return this.buttons.nativeElement.children.length !== 0;\n  }\n\n  constructor() {}\n\n  /**\n   * Is the entity or the template change, recreate the form or repopulate it.\n   * @internal\n   */\n  ngOnChanges(changes: SimpleChanges) {\n    const formData = changes.formData;\n    if (formData && formData.currentValue !== formData.previousValue) {\n      if (formData.currentValue === undefined) {\n        this.clear();\n      } else {\n        this.setData(formData.currentValue);\n      }\n    }\n  }\n\n  /**\n   * Transform the form data to a feature and emit an event\n   * @param event Form submit event\n   * @internal\n   */\n  onSubmit() {\n    this.submitForm.emit(this.getData());\n  }\n\n  getData(): { [key: string]: any} {\n    const data = {};\n    getAllFormFields(this.form).forEach((field: FormField) => {\n      this.updateDataWithFormField(data, field);\n    });\n    return data;\n  }\n\n  private setData(data: {[key: string]: any}) {\n    this.form.fields.forEach((field: FormField) => {\n      field.control.setValue(t(data, field.name).safeObject);\n    });\n\n    this.form.groups.forEach((group: FormFieldGroup) => {\n      group.fields.forEach((field: FormField) => {\n        field.control.setValue(t(data, field.name).safeObject);\n      });\n    });\n  }\n\n  private updateDataWithFormField(data: { [key: string]: any}, field: FormField) {\n    const control = field.control;\n    if (!control.disabled) {\n      data[field.name] = control.value;\n    }\n  }\n\n  /**\n   * Clear form\n   */\n  private clear() {\n    this.form.control.reset();\n  }\n\n}\n","import { AbstractControl } from '@angular/forms';\n\nimport { Form, FormField, FormFieldGroup } from './form.interfaces';\n\nexport function formControlIsRequired(control: AbstractControl): boolean {\n  if (control.validator) {\n    const validator = control.validator({} as AbstractControl);\n    if (validator && validator.required) {\n      return true;\n    }\n  }\n\n  if ((control as any).controls) {\n    const requiredControl = Object.keys((control as any).controls).find((key: string) => {\n      return formControlIsRequired((control as any).controls[key]);\n    });\n    return requiredControl !== undefined;\n  }\n\n  return false;\n}\n\nexport function getDefaultErrorMessages(): {[key: string]: string} {\n  return {\n    required: 'igo.common.form.errors.required'\n  };\n}\n\nexport function getControlErrorMessage(control: AbstractControl, messages: {[key: string]: string}): string {\n  const errors = control.errors || {};\n  const errorKeys = Object.keys(errors);\n  const errorMessages = errorKeys\n    .map((key: string) => messages[key])\n    .filter((message: string) => message !== undefined);\n  return errorMessages.length > 0 ? errorMessages[0] : '';\n}\n\nexport function getAllFormFields(form: Form): FormField[] {\n  return form.groups.reduce((acc: FormField[], group: FormFieldGroup) => {\n    return acc.concat(group.fields);\n  }, [].concat(form.fields));\n}\n\nexport function getFormFieldByName(form: Form, name: string): FormField {\n  const fields = getAllFormFields(form);\n  return fields.find((field: FormField) => {\n    return field.name === name;\n  });\n}\n","\n<form\n  [autocomplete]=\"autocomplete\"\n  [formGroup]=\"form.control\"\n  (ngSubmit)=\"onSubmit()\">\n  <div class=\"igo-form-body\" [ngClass]=\"{'igo-form-body-with-buttons': hasButtons}\">\n    <div class=\"igo-form-content\">\n      <ng-content></ng-content>\n    </div>\n    <div #buttons class=\"igo-form-buttons\">\n      <ng-content select=\"[formButtons]\"></ng-content>\n    </div>\n  </div>\n</form>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { FormComponent } from './form.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule\n  ],\n  exports: [\n    FormComponent,\n    FormsModule,\n    ReactiveFormsModule\n  ],\n  declarations: [\n    FormComponent\n  ]\n})\nexport class IgoFormFormModule {}\n","import { Injectable } from '@angular/core';\nimport { UntypedFormBuilder, Validators, ValidatorFn } from '@angular/forms';\n\nimport {\n  Form,\n  FormField,\n  FormFieldConfig,\n  FormFieldGroup,\n  FormFieldGroupConfig\n} from './form.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FormService {\n\n  constructor(private formBuilder: UntypedFormBuilder) {}\n\n  form(fields: FormField[], groups: FormFieldGroup[]): Form {\n    const control = this.formBuilder.group({});\n    fields.forEach((field: FormField) => {\n      control.addControl(field.name, field.control);\n    });\n    groups.forEach((group: FormFieldGroup) => {\n      control.addControl(group.name, group.control);\n    });\n\n    return {fields, groups, control};\n  }\n\n  group(config: FormFieldGroupConfig, fields: FormField[]): FormFieldGroup {\n    const options = config.options || {};\n    const control = this.formBuilder.group({});\n    fields.forEach((field: FormField) => {\n      control.addControl(field.name, field.control);\n    });\n\n    if (options.validator) {\n      const validators = this.getValidators(options.validator); // convert string to actual validator\n      control.setValidators(validators);\n    }\n\n    return Object.assign({}, config, {fields, control}) as FormFieldGroup;\n  }\n\n  field(config: FormFieldConfig): FormField {\n    const options = config.options || {};\n    const state = {\n      value: '',\n      disabled: options.disabled\n    };\n    const control = this.formBuilder.control(state);\n\n    if (options.validator) {\n      const validators = this.getValidators(options.validator); // convert string to actual validator\n      control.setValidators(validators);\n    }\n\n    return Object.assign({type: 'text'}, config, {control}) as FormField;\n  }\n\n  extendFieldConfig(config: FormFieldConfig, partial: Partial<FormFieldConfig>): FormFieldConfig {\n    const options = Object.assign({}, config.options || {}, partial.options || {});\n    const inputs = Object.assign({}, config.inputs || {}, partial.inputs || {});\n    const subscribers = Object.assign({}, config.subscribers || {}, partial.subscribers || {});\n    return Object.assign({}, config, {options, inputs, subscribers});\n  }\n\n  private getValidators(validatorOption: string | string[] | ValidatorFn): ValidatorFn | ValidatorFn[] {\n    if (Array.isArray(validatorOption)) {\n      return validatorOption.map((validatorStr) => {\n        return this.getValidator(validatorStr);\n      });\n    }\n\n    return this.getValidator(validatorOption);\n  }\n\n  private getValidator(validatorStr: string | ValidatorFn): ValidatorFn {\n    if (typeof validatorStr !== 'string') {\n      return validatorStr;\n    }\n\n    // regex pattern to extract arguments from string for e.g applying on \"minLength(8)\" would extract 8\n    const re = /^([a-zA-Z]{3,15})\\((.{0,20})\\)$/;\n    const match = validatorStr.match(re);\n\n    if (!match) {\n      return Validators[validatorStr];\n    }\n\n    const name = match[1];\n    const args = match[2];\n    return Validators[name](args);\n  }\n\n}\n","import { Injectable } from '@angular/core';\n\n/**\n * Service where all available form fields are registered.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class FormFieldService {\n\n  static fields: {[key: string]: any} = {};\n\n  static register(type: string, component: any) {\n    FormFieldService.fields[type] = component;\n  }\n\n  constructor() {}\n\n  /**\n   * Return field component by type\n   * @param type Field type\n   * @returns Field component\n   */\n  getFieldByType(type: string): any {\n    return FormFieldService.fields[type];\n  }\n\n}\n","\n\n<ng-container *ngIf=\"field !== undefined\">\n  <igo-dynamic-outlet\n    [component]=\"getFieldComponent()\"\n    [inputs]=\"getFieldInputs()\"\n    [subscribers]=\"getFieldSubscribers()\">\n  </igo-dynamic-outlet>\n</ng-container>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { FormField, FormFieldInputs, FormFieldOptions } from '../shared/form.interfaces';\nimport { FormFieldService } from '../shared/form-field.service';\nimport { getDefaultErrorMessages } from '../shared';\n\n/**\n * This component renders the proper form input based on\n * the field configuration it receives.\n */\n@Component({\n  selector: 'igo-form-field',\n  templateUrl: './form-field.component.html',\n  styleUrls: ['./form-field.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormFieldComponent {\n\n  /**\n   * Field configuration\n   */\n  @Input() field: FormField;\n\n  /**\n   * Field inputs cache\n   */\n  private fieldInputs: FormFieldInputs = undefined;\n\n  /**\n   * Field subscribers cache\n   */\n  private fieldSubscribers: {[key: string]: ({field: FormField, control: FormControl}) => void } = undefined;\n\n  get fieldOptions(): FormFieldOptions {\n    return this.field.options || {};\n  }\n\n  constructor(private formFieldService: FormFieldService) {}\n\n  getFieldComponent(): any {\n    return this.formFieldService.getFieldByType(this.field.type || 'text');\n  }\n\n  getFieldInputs(): FormFieldInputs {\n    if (this.fieldInputs !== undefined) {\n      return this.fieldInputs;\n    }\n\n    const errors = this.fieldOptions.errors || {};\n    this.fieldInputs = Object.assign(\n      {\n        placeholder: this.field.title,\n        disableSwitch: this.fieldOptions.disableSwitch || false\n      },\n      Object.assign({}, this.field.inputs || {}),\n      {\n        formControl: this.field.control,\n        errors: Object.assign({}, getDefaultErrorMessages(), errors)\n      }\n    );\n    return this.fieldInputs;\n  }\n\n  getFieldSubscribers(): {[key: string]: ({field: FormField, control: FormControl}) => void } {\n    if (this.fieldSubscribers !== undefined) {\n      return this.fieldSubscribers;\n    }\n\n    this.fieldSubscribers = Object.assign({}, this.field.subscribers || {});\n    return this.fieldSubscribers;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoDynamicOutletModule } from '../../dynamic-component/dynamic-outlet/dynamic-outlet.module';\n\nimport { FormFieldComponent } from './form-field.component';\nimport { FormFieldSelectComponent } from './form-field-select.component';\nimport { FormFieldTextComponent } from './form-field-text.component';\nimport { FormFieldTextareaComponent } from './form-field-textarea.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    IgoLanguageModule,\n    IgoDynamicOutletModule\n  ],\n  exports: [\n    FormFieldComponent,\n    FormFieldSelectComponent,\n    FormFieldTextComponent,\n    FormFieldTextareaComponent\n  ],\n  declarations: [\n    FormFieldComponent,\n    FormFieldSelectComponent,\n    FormFieldTextComponent,\n    FormFieldTextareaComponent\n  ]\n})\nexport class IgoFormFieldModule {}\n","<div\n  *ngIf=\"group && group.fields.length > 0\"\n  class=\"igo-form-group-fields\">\n  <div\n    *ngFor=\"let field of group.fields\"\n    class=\"igo-form-field-wrapper\"\n    [ngClass]=\"getFieldNgClass(field)\">\n    <igo-form-field [field]=\"field\"></igo-form-field>\n  </div>\n</div>\n\n<div class=\"igo-form-group-extra-content\">\n  <ng-content></ng-content>\n</div>\n\n<mat-error *ngIf=\"formControl.errors\">{{getErrorMessage() | translate}}</mat-error>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { UntypedFormGroup } from '@angular/forms';\n\nimport { getControlErrorMessage } from '../shared/form.utils';\nimport { FormField, FormFieldGroup } from '../shared/form.interfaces';\n\n/**\n * A configurable form, optionnally bound to an entity\n * (for example in case of un update). Submitting that form\n * emits an event with the form data but no other operation is performed.\n */\n@Component({\n  selector: 'igo-form-group',\n  templateUrl: './form-group.component.html',\n  styleUrls: ['./form-group.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class FormGroupComponent {\n\n  /**\n   * Form field group\n   */\n  @Input() group: FormFieldGroup;\n\n  /**\n   * Field placeholder\n   */\n  @Input() errors: {[key: string]: string};\n\n  /**\n   * Form group control\n   */\n  get formControl(): UntypedFormGroup { return this.group.control; }\n\n  constructor() {}\n\n  /**\n   * Return the number of columns a field should occupy.\n   * The maximum allowed is 2, even if the field config says more.\n   * @param field Field\n   * @returns Number of columns\n   * @internal\n   */\n  getFieldColSpan(field: FormField): number {\n    let colSpan = 2;\n    const options = field.options || {};\n    if (options.cols && options.cols > 0) {\n      colSpan = Math.min(options.cols, 2);\n    }\n\n    return colSpan;\n  }\n\n  /**\n   * Return the number of columns a field should occupy.\n   * The maximum allowed is 2, even if the field config says more.\n   * @param field Field\n   * @returns Number of columns\n   * @internal\n   */\n  getFieldNgClass(field: FormField): {[key: string]: boolean} {\n    const colspan = this.getFieldColSpan(field);\n    return {[`igo-form-field-colspan-${colspan}`]: true};\n  }\n\n  /**\n   * Get error message\n   */\n  getErrorMessage(): string {\n    const options = this.group.options || {};\n    return getControlErrorMessage(this.formControl, options.errors || {});\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatFormFieldModule } from '@angular/material/form-field';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoFormFieldModule } from '../form-field/form-field.module';\nimport { FormGroupComponent } from './form-group.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatFormFieldModule,\n    IgoLanguageModule,\n    IgoFormFieldModule\n  ],\n  exports: [\n    FormGroupComponent\n  ],\n  declarations: [\n    FormGroupComponent\n  ]\n})\nexport class IgoFormGroupModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFormFormModule } from './form/form.module';\nimport { IgoFormGroupModule } from './form-group/form-group.module';\nimport { IgoFormFieldModule } from './form-field/form-field.module';\nimport { FormService } from './shared/form.service';\nimport { FormFieldService } from './shared/form-field.service';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoFormGroupModule,\n    IgoFormFieldModule\n  ],\n  exports: [\n    IgoFormFormModule,\n    IgoFormGroupModule,\n    IgoFormFieldModule\n  ],\n  declarations: [],\n  providers: [\n    FormService,\n    FormFieldService\n  ]\n})\nexport class IgoFormModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { EntitySelectorComponent } from './entity-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    MatSelectModule\n  ],\n  exports: [EntitySelectorComponent],\n  declarations: [EntitySelectorComponent]\n})\nexport class IgoEntitySelectorModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { StopDropPropagationDirective } from './stop-drop-propagation.directive';\nimport { StopPropagationDirective } from './stop-propagation.directive';\n\n@NgModule({\n  imports: [],\n  declarations: [StopDropPropagationDirective, StopPropagationDirective],\n  exports: [StopDropPropagationDirective, StopPropagationDirective]\n})\nexport class IgoStopPropagationModule {\n  static forRoot(): ModuleWithProviders<IgoStopPropagationModule> {\n    return {\n      ngModule: IgoStopPropagationModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { EntityTablePaginatorComponent } from './entity-table-paginator.component';\nimport { MatPaginatorModule } from '@angular/material/paginator';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    MatPaginatorModule,\n  ],\n  exports: [\n    EntityTablePaginatorComponent\n  ],\n  declarations: [\n    EntityTablePaginatorComponent,\n  ]\n})\nexport class IgoEntityTablePaginatorModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { ImageErrorDirective } from './image-error.directive';\nimport { SecureImagePipe } from './secure-image.pipe';\n\n@NgModule({\n  imports: [],\n  declarations: [SecureImagePipe, ImageErrorDirective],\n  exports: [SecureImagePipe, ImageErrorDirective]\n})\nexport class IgoImageModule {\n  static forRoot(): ModuleWithProviders<IgoImageModule> {\n    return {\n      ngModule: IgoImageModule,\n      providers: []\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatSortModule } from '@angular/material/sort';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\n\nimport { IgoStopPropagationModule } from '../../stop-propagation/stop-propagation.module';\nimport { IgoCustomHtmlModule } from '../../custom-html/custom-html.module';\nimport { EntityTableRowDirective } from './entity-table-row.directive';\nimport { EntityTableComponent } from './entity-table.component';\nimport { MatPaginatorModule } from '@angular/material/paginator';\nimport { IgoEntityTablePaginatorModule } from '../entity-table-paginator/entity-table-paginator.module';\nimport { IgoImageModule } from '../../image/image.module';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatSelectModule } from '@angular/material/select';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatTableModule,\n    MatAutocompleteModule,\n    MatSortModule,\n    MatIconModule,\n    MatButtonModule,\n    MatCheckboxModule,\n    MatPaginatorModule,\n    MatSelectModule,\n    IgoStopPropagationModule,\n    IgoCustomHtmlModule,\n    IgoEntityTablePaginatorModule,\n    IgoImageModule,\n    IgoLanguageModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatInputModule,\n    MatDatepickerModule,\n    MatTooltipModule\n  ],\n  exports: [\n    EntityTableComponent\n  ],\n  declarations: [\n    EntityTableComponent,\n    EntityTableRowDirective\n  ]\n})\nexport class IgoEntityTableModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoEntitySelectorModule } from './entity-selector/entity-selector.module';\nimport { IgoEntityTableModule } from './entity-table/entity-table.module';\nimport { IgoEntityTablePaginatorModule } from './entity-table-paginator/entity-table-paginator.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoEntitySelectorModule,\n    IgoEntityTableModule,\n    IgoEntityTablePaginatorModule\n  ],\n  declarations: []\n})\nexport class IgoEntityModule {}\n","import { catchError } from 'rxjs/operators';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { Injectable } from '@angular/core';\nimport { InteractiveTourOptions } from './interactive-tour.interface';\nimport { ConfigService } from '@igo2/core';\n\n@Injectable()\nexport class InteractiveTourLoader {\n  private jsonURL: string;\n  private allToursOptions;\n\n  constructor(private http: HttpClient, private configService: ConfigService) {\n    this.jsonURL = this.getPathToConfigFile();\n  }\n\n   public loadConfigTour() {\n      this.getJSON()\n        .subscribe(\n          (data) => {\n            this.allToursOptions = data;\n          },\n          (err) => {\n            throw new Error(`Problem with Interactive tour configuration file: interactiveTour.json not find. Check if the file and is path is set correctly.`);\n          }\n        );\n   }\n\n  public getPathToConfigFile(): string {\n    return (\n      this.configService.getConfig('interactiveTour.pathToConfigFile') ||\n      './config/interactiveTour.json'\n    );\n  }\n\n  public getJSON(): Observable<any> {\n    return this.http.get(this.jsonURL).pipe(\n      catchError((e) => {\n        e.error.caught = true;\n        throw e;\n      })\n    );\n  }\n\n  public getTourOptionData(toolName): InteractiveTourOptions {\n    if (this.allToursOptions === undefined) {\n      return undefined;\n    }\n    let nameInConfigFile = toolName;\n    nameInConfigFile = nameInConfigFile.replace(/\\s/g, '');\n    return this.allToursOptions[nameInConfigFile];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { ShepherdService } from 'angular-shepherd';\n\nimport { ConfigService, MediaService, LanguageService } from '@igo2/core';\nimport { InteractiveTourLoader } from './interactive-tour.loader';\nimport {\n  InteractiveTourOptions,\n  InteractiveTourStep,\n  InteractiveTourAction\n} from './interactive-tour.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class InteractiveTourService {\n  private previousStep: InteractiveTourStep;\n  private nextIndex = 1;\n\n  constructor(\n    private configService: ConfigService,\n    private mediaService: MediaService,\n    private languageService: LanguageService,\n    private interactiveTourLoader: InteractiveTourLoader,\n    private shepherdService: ShepherdService\n  ) {\n    if (this.isAppHaveTour()) {\n      this.interactiveTourLoader.loadConfigTour();\n    }\n  }\n\n  public isAppHaveTour() {\n    const haveTour = this.configService.getConfig('interactiveTour.activateInteractiveTour');\n    if (haveTour === undefined) {\n      return true;\n    } else {\n      return haveTour;\n    }\n  }\n\n  public isToolHaveTourConfig(toolName: string): boolean {\n    const checkTourActiveOptions = this.interactiveTourLoader.getTourOptionData(\n      toolName\n    );\n    if (checkTourActiveOptions === undefined) {\n      return false;\n    } else {\n      return true;\n    }\n  }\n\n  public disabledTourButton(toolName: string): boolean {\n    const stepConfig: InteractiveTourOptions = this.interactiveTourLoader.getTourOptionData(\n      toolName\n    );\n\n    if (stepConfig?.conditions) {\n      for (const condition of stepConfig?.conditions) {\n        if (document.querySelector(condition) === null) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  public isMobile(): boolean {\n    return this.mediaService.isMobile();\n  }\n\n  public isTourDisplayInMobile(): boolean {\n    const showInMobile = this.configService.getConfig(\n      'interactiveTour.tourInMobile'\n    );\n    if (showInMobile === undefined) {\n      return true;\n    }\n    return this.configService.getConfig('interactiveTour.tourInMobile');\n  }\n\n  private getButtons(buttonKind?: 'first' | 'last' | 'noBackButton') {\n    if (buttonKind === 'noBackButton') {\n      return [\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.nextButton'\n          ),\n          type: 'next'\n        }\n      ];\n    }\n    if (buttonKind === 'first') {\n      return [\n        {\n          classes: 'shepherd-button-secondary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.exitButton'\n          ),\n          type: 'cancel'\n        },\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.nextButton'\n          ),\n          type: 'next'\n        }\n      ];\n    }\n\n    if (buttonKind === 'last') {\n      return [\n        {\n          classes: 'shepherd-button-secondary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.backButton'\n          ),\n          type: 'back'\n        },\n        {\n          classes: 'shepherd-button-primary',\n          text: this.languageService.translate.instant(\n            'igo.common.interactiveTour.exitButton'\n          ),\n          type: 'cancel'\n        }\n      ];\n    }\n\n    return [\n      {\n        classes: 'shepherd-button-secondary',\n        text: this.languageService.translate.instant(\n          'igo.common.interactiveTour.backButton'\n        ),\n        type: 'back'\n      },\n      {\n        classes: 'shepherd-button-primary',\n        text: this.languageService.translate.instant(\n          'igo.common.interactiveTour.nextButton'\n        ),\n        type: 'next'\n      }\n    ];\n  }\n\n  private getAction(actionName: string) {\n    const action = {\n      click: 'click'\n    };\n    return action[actionName.toLowerCase()];\n  }\n\n  private addProgress() {\n    const self = this as any;\n    let nbTry = 0;\n    const maxTry = 21;\n    const checkExist = setInterval(() => {\n      if (self.getCurrentStep()) {\n        if (self.getCurrentStep().options.attachTo.element && !document.querySelector(self.getCurrentStep().options.attachTo.element)) {\n          self.cancel();\n          clearInterval(checkExist);\n          return;\n        } else {\n          const currentStepElement = self.getCurrentStep().getElement();\n          if (currentStepElement) {\n            const shepherdList = currentStepElement.querySelectorAll('.shepherd-content, .shepherd-text');\n            shepherdList.forEach(element => {\n              element.classList.add('mat-typography');\n            });\n          }\n          const header = currentStepElement\n            ? currentStepElement.querySelector('.shepherd-header')\n            : undefined;\n\n          nbTry++;\n          if (header || nbTry > maxTry) {\n            clearInterval(checkExist);\n          }\n\n          if (header) {\n            const stepsArray = self.steps;\n            const progress = document.createElement('span');\n            progress.className = 'shepherd-progress';\n            progress.innerText = `${\n              stepsArray.indexOf(self.getCurrentStep()) + 1\n            }/${stepsArray.length}`;\n            header.insertBefore(\n              progress,\n              currentStepElement.querySelector('.shepherd-cancel-icon')\n            );\n          }\n        }\n      }\n    }, 100);\n  }\n\n  private checkNext(index, tour, service) {\n    if (tour.getCurrentStep()) {\n      if (tour.getCurrentStep().options.attachTo.element && document.querySelector(tour.getCurrentStep().options.attachTo.element)) {\n        tour.complete();\n        return;\n      }\n\n      if (index.index === tour.steps.length - 1) {\n        tour.complete();\n        return;\n      }\n\n      tour.steps.splice(index.index, 1);\n      const nextStep = tour.steps[index.index];\n      if (nextStep.options.attachTo.element && !document.querySelector(nextStep.options.attachTo.element)) {\n        service.checkNext(index, tour, service);\n      } else {\n        tour._setupModal();\n        tour.show(nextStep.id);\n      }\n    }\n  }\n\n  private executeAction(\n    step: InteractiveTourStep,\n    actionConfig: InteractiveTourAction\n  ) {\n    if (!actionConfig) {\n      return;\n    }\n\n    if (\n      actionConfig.condition &&\n      ((actionConfig.condition.charAt(0) === '!' &&\n        document.querySelector(actionConfig.condition.slice(1))) ||\n        (actionConfig.condition.charAt(0) !== '!' &&\n          !document.querySelector(actionConfig.condition)))\n    ) {\n      return;\n    }\n\n    const element: HTMLElement = document.querySelector(\n      actionConfig.element || step.element\n    ) as HTMLElement;\n    const action = this.getAction(actionConfig.action);\n    if (element && action) {\n      element[action]();\n    }\n  }\n\n  private executeActionPromise(\n    step: InteractiveTourStep,\n    actionConfig: InteractiveTourAction\n  ) {\n    return new Promise<void>((resolve) => {\n      this.executeAction(step, actionConfig);\n      if (!actionConfig || !actionConfig.waitFor) {\n        resolve();\n        return;\n      }\n      let nbTry = 0;\n      const maxTry = actionConfig.maxWait ? actionConfig.maxWait / 100 : 20;\n      const checkExist = setInterval(() => {\n        nbTry++;\n        if (nbTry > maxTry || document.querySelector(actionConfig.waitFor)) {\n          clearInterval(checkExist);\n          resolve();\n        }\n      }, 100);\n    });\n  }\n\n  private getShepherdSteps(stepConfig: InteractiveTourOptions) {\n    const shepherdSteps = [];\n\n    let i = 0;\n    for (const step of stepConfig.steps) {\n      shepherdSteps.push({\n        attachTo: {\n          element: step.element,\n          on: step.position || stepConfig.position\n        },\n        popperOptions: {\n          modifiers: [{ name: 'offset', options: { offset: [0, 15] } }]\n        },\n        beforeShowPromise: () => {\n          return Promise.all([\n            this.executeActionPromise(\n              this.previousStep,\n              this.previousStep ? this.previousStep.beforeChange : undefined\n            ),\n            this.executeActionPromise(step, step.beforeShow)\n          ]);\n        },\n        buttons: this.getButtons(\n          i === 0\n            ? 'first'\n            : i + 1 === stepConfig.steps.length\n            ? 'last'\n            : stepConfig.steps[i].noBackButton\n            ? 'noBackButton'\n            : undefined\n        ),\n        classes: step.class,\n        highlightClass: step.highlightClass,\n        scrollTo: step.scrollToElement || stepConfig.scrollToElement || true,\n        canClickTarget: step.disableInteraction\n          ? !step.disableInteraction\n          : undefined,\n        title: this.languageService.translate.instant(\n          step.title || stepConfig.title\n        ),\n        text: [this.languageService.translate.instant(step.text)],\n        when: {\n          show: () => {\n            this.executeAction(step, step.onShow);\n          },\n          hide: () => {\n            this.previousStep = step;\n            this.executeAction(step, step.onHide);\n          }\n        }\n      });\n      i++;\n    }\n\n    return shepherdSteps;\n  }\n\n  public startTour(toolName: string) {\n    const stepConfig: InteractiveTourOptions = this.interactiveTourLoader.getTourOptionData(\n      toolName\n    );\n\n    this.shepherdService.defaultStepOptions = {\n      classes: stepConfig.class,\n      highlightClass: stepConfig.highlightClass,\n      canClickTarget: stepConfig.disableInteraction\n        ? !stepConfig.disableInteraction\n        : true,\n      cancelIcon: {\n        enabled: true\n      }\n    };\n\n    const shepherdSteps = this.getShepherdSteps(stepConfig);\n\n    this.shepherdService.modal = true;\n    this.shepherdService.confirmCancel = false;\n    this.shepherdService.addSteps(shepherdSteps);\n\n    this.shepherdService.tourObject.on('show', this.addProgress);\n    this.shepherdService.tourObject.on('cancel', (index) =>{\n      this.checkNext(index, this.shepherdService.tourObject, this);\n    });\n\n    this.shepherdService.start();\n  }\n}\n","import { EntityRecord, EntityStore } from '../../entity';\nimport { Tool, ToolboxOptions } from './tool.interface';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n/**\n * Service where all available tools and their component are registered.\n */\nexport class Toolbox {\n  /**\n   * Observable of the active tool\n   */\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\n\n  /**\n   * Ordered list of tool names to display in a toolbar\n   */\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\n\n  /**\n   * Observable of the active tool\n   */\n  private activeTool$$: Subscription;\n\n  /**\n   * Active tool history. Useful for activating the previous tool.\n   */\n  private activeToolHistory: string[] = [];\n\n  /**\n   * Tool store\n   */\n  private store = new EntityStore<Tool>([], {\n    getKey: (tool: Tool) => tool.name\n  });\n\n  get tools$(): BehaviorSubject<Tool[]> {\n    return this.store.entities$;\n  }\n\n  constructor(private options: ToolboxOptions = {}) {\n    this.setToolbar(options.toolbar);\n    this.initStore();\n  }\n\n  /**\n   * Destroy the toolbox\n   */\n  destroy() {\n    this.activeTool$$.unsubscribe();\n    this.store.destroy();\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return this.store.get(name);\n  }\n\n  /**\n   * Return all tools\n   * @returns Array of tools\n   */\n  getTools(): Tool[] {\n    return this.store.all();\n  }\n\n  /**\n   * Set tool configurations\n   * @param tools Tools\n   */\n  setTools(tools: Tool[]) {\n    this.store.load(tools);\n  }\n\n  /**\n   * Get toolbar\n   * @returns Toolbar value\n   */\n  getToolbar(): string[] {\n    return this.toolbar$.getValue();\n  }\n\n  /**\n   * Set toolbar\n   * @param toolbar A list of tool names\n   */\n  setToolbar(toolbar: string[]) {\n    this.toolbar$.next(toolbar || []);\n  }\n\n  /**\n   * Activate a tool (and deactivate other tools)\n   * @param name Tool name\n   * @param options Tool options\n   */\n  activateTool(name: string, options: { [key: string]: any } = {}) {\n    const tool = this.getTool(name);\n    if (tool === undefined) {\n      return;\n    }\n\n    this.store.state.update(tool, { active: true, options }, true);\n  }\n\n  /**\n   * Activate the previous tool, if any\n   */\n  activatePreviousTool() {\n    if (this.activeToolHistory.length <= 1) {\n      this.deactivateTool();\n      return;\n    }\n    const [previous, current] = this.activeToolHistory.splice(-2, 2);\n    this.activateTool(previous);\n  }\n\n  /**\n   * Activate the tool below, if any\n   */\n  /* activateBelowTool() {\n    const arrayTools = this.getToolbar();\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\n    if (arrayTools[index + 1] !== undefined) {\n      this.deactivateTool();\n      const below = arrayTools[index + 1];\n      this.activateTool(below);\n    } else {\n      this.deactivateTool();\n      const below = arrayTools[0];\n      this.activateTool(below);\n    }\n  } */\n\n  /**\n   * Activate the tool above, if any\n   */\n  /* activateAboveTool() {\n    const arrayTools = this.getToolbar();\n    const index = arrayTools.findIndex(t => t === this.activeTool$.getValue().name);\n    if (arrayTools[index - 1] !== undefined) {\n      this.deactivateTool();\n      const above = arrayTools[index - 1];\n      this.activateTool(above);\n    } else {\n      this.deactivateTool();\n      const above = arrayTools[arrayTools.length - 1];\n      this.activateTool(above);\n    }\n  } */\n\n  /**\n   * Deactivate the active tool\n   */\n  deactivateTool() {\n    this.clearActiveToolHistory();\n    this.store.state.updateAll({ active: false });\n  }\n\n  /**\n   * Initialize the tool store and start observing the active tool\n   */\n  private initStore() {\n    this.store = new EntityStore<Tool>([], {\n      getKey: (entity: Tool) => entity.name\n    });\n\n    this.activeTool$$ = this.store.stateView\n      .firstBy$((record: EntityRecord<Tool>) => record.state.active === true)\n      .subscribe((record: EntityRecord<Tool>) => {\n        if (record === undefined) {\n          this.setActiveTool(undefined);\n          return;\n        }\n\n        const tool = record.entity;\n        const options = Object.assign(\n          {},\n          tool.options || {},\n          record.state.options || {}\n        );\n        this.setActiveTool(Object.assign({}, tool, { options }));\n      });\n  }\n\n  /**\n   * Set the active tool and update the tool history\n   * @param tool Tool\n   */\n  private setActiveTool(tool: Tool | undefined) {\n    this.activeTool$.next(tool);\n    if (tool === undefined) {\n      this.clearActiveToolHistory();\n    } else {\n      this.activeToolHistory = this.activeToolHistory\n        .filter((name: string) => name !== tool.name)\n        .concat([tool.name]);\n    }\n  }\n\n  /**\n   * Clear the tool history\n   */\n  private clearActiveToolHistory() {\n    this.activeToolHistory = [];\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { Tool } from './tool.interface';\nimport { Toolbox } from './toolbox';\n\n/**\n * Service where runtime tool configurations are registered\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ToolService {\n  static tools: { [key: string]: Tool } = {};\n\n  /**\n   * Toolbox that holds main tools\n   */\n  public toolbox: Toolbox = new Toolbox();\n\n  static register(tool: Tool) {\n    ToolService.tools[tool.name] = tool;\n  }\n\n  constructor() {\n    this.toolbox.setTools(this.getTools());\n  }\n\n  /**\n   * Return a tool\n   * @param name Tool name\n   * @returns tool Tool\n   */\n  getTool(name: string): Tool {\n    return ToolService.tools[name];\n  }\n\n  /**\n   * Return all tools\n   * @returns tTols\n   */\n  getTools(): Tool[] {\n    return Object.values(ToolService.tools);\n  }\n}\n","<button *ngIf=\"showTourButton\"\n  (click) = \"startInteractiveTour()\"\n  [ngClass]=\"getClass()\"\n  mat-raised-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [disabled]=disabledTourButton>\n  <span class=\"interactive-tour-button-title\">{{'igo.common.interactiveTour.buttonTitle' | translate}} {{(discoverTitleInLocale$ | async) | translate}}</span>\n  <mat-icon\n    svgIcon=\"presentation-play\"\n    [matTooltip]=\"disabledTourButton ?\n    ('igo.common.interactiveTour.disaledTooltipTourToolButton' | translate) :\n    ('igo.common.interactiveTour.tooltipTourToolButton' | translate)\">\n  </mat-icon>\n</button>\n","import { Component, ViewEncapsulation, Input } from '@angular/core';\nimport { InteractiveTourService } from './interactive-tour.service';\nimport { ToolService } from '../tool/shared/tool.service';\nimport { Observable, of } from 'rxjs';\n\n@Component({\n  selector: 'igo-interactive-tour',\n  templateUrl: './interactive-tour.component.html',\n  styleUrls: ['./interactive-tour.component.scss'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class InteractiveTourComponent {\n  /**\n   * Toolbox that holds main tools\n   */\n  @Input() tourToStart: string = '';\n  @Input() styleButton: string;\n  @Input() discoverTitleInLocale$: Observable<string> = of('IGO');\n\n  getClass() {\n    return {\n      'tour-button-tool-icon': this.styleButton === 'icon',\n      'tour-button-tool': this.styleButton === 'raised'\n    };\n  }\n\n  get toolbox() {\n    return this.toolService.toolbox;\n  }\n\n  getTourToStart() {\n    if (this.tourToStart) {\n      return this.tourToStart;\n    } else {\n      return this.activeToolName;\n    }\n  }\n\n  get activeToolName() {\n    if (this.toolbox) {\n      if (this.isActiveTool) {\n        return this.toolbox.activeTool$.getValue().name;\n      } else {\n        return 'global';\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  get isActiveTool(): boolean {\n    if (this.toolbox) {\n      return this.toolbox.activeTool$.getValue() !== undefined;\n    } else {\n      return undefined;\n    }\n  }\n\n  get isToolHaveTour(): boolean {\n    if (this.activeToolName === 'about' && !this.tourToStart) {\n      return false;\n    }\n    return this.interactiveTourService.isToolHaveTourConfig(\n      this.getTourToStart()\n    );\n  }\n\n  get showTourButton(): boolean {\n    // 2 conditions to show: have Tour on tool in Config file and if we are in mobile displayInMobile= true\n    let haveTour: boolean;\n    haveTour = this.isToolHaveTour;\n    if (haveTour === false) {\n      return false;\n    }\n\n    let inMobileAndShow: boolean;\n    if (this.interactiveTourService.isMobile()) {\n      inMobileAndShow = this.isTourDisplayInMobile;\n      if (inMobileAndShow === false) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  get isTourDisplayInMobile(): boolean {\n    return this.interactiveTourService.isTourDisplayInMobile();\n  }\n\n  get disabledTourButton(): boolean {\n    return this.interactiveTourService.disabledTourButton(this.activeToolName);\n  }\n\n  constructor(\n    private interactiveTourService: InteractiveTourService,\n    private toolService: ToolService\n  ) {}\n\n  startInteractiveTour() {\n    const tour = this.getTourToStart();\n    if (tour) {\n      this.interactiveTourService.startTour(tour);\n    } else {\n      return;\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { InteractiveTourService } from './interactive-tour.service';\nimport { InteractiveTourComponent } from './interactive-tour.component';\nimport { InteractiveTourLoader } from './interactive-tour.loader';\n\n@NgModule({\n  declarations: [InteractiveTourComponent],\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule\n  ],\n  providers: [InteractiveTourService, InteractiveTourLoader],\n  exports: [InteractiveTourComponent]\n})\nexport class IgoInteractiveTourModule {}\n","import { Pipe, PipeTransform } from '@angular/core';\n\n@Pipe({\n  name: 'keyvalue'\n})\nexport class KeyValuePipe implements PipeTransform {\n  transform(value: any, args?: any): any {\n    const keyValues = [];\n    Object.getOwnPropertyNames(value).forEach((key: string) =>\n      keyValues.push({ key, value: value[key] })\n    );\n\n    return keyValues;\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { KeyValuePipe } from './keyvalue.pipe';\n\n@NgModule({\n  imports: [],\n  declarations: [KeyValuePipe],\n  exports: [KeyValuePipe]\n})\nexport class IgoKeyValueModule {\n  static forRoot(): ModuleWithProviders<IgoKeyValueModule> {\n    return {\n      ngModule: IgoKeyValueModule,\n      providers: []\n    };\n  }\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  ElementRef,\n  Renderer2,\n  HostListener,\n  EventEmitter\n} from '@angular/core';\n\n@Directive({\n  selector: '[igoListItem]'\n})\nexport class ListItemDirective {\n\n  static focusedCls = 'igo-list-item-focused';\n  static selectedCls = 'igo-list-item-selected';\n  static disabledCls = 'igo-list-item-disabled';\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  @Input()\n  get focused() {\n    return this._focused;\n  }\n  set focused(value: boolean) {\n    if (value === this._focused) {\n      return;\n    }\n    if (this.disabled) {\n      return;\n    }\n\n    value ? this.beforeFocus.emit(this) : this.beforeUnfocus.emit(this);\n\n    this._focused = value;\n    if (this.selected !== true) {\n      this.toggleFocusedClass();\n    }\n\n    value ? this.focus.emit(this) : this.unfocus.emit(this);\n  }\n  private _focused = false;\n\n  @Input()\n  get selected() {\n    return this._selected;\n  }\n  set selected(value: boolean) {\n    if (value === this._selected) {\n      return;\n    }\n    if (this.disabled) {\n      return;\n    }\n\n    value ? this.beforeSelect.emit(this) : this.beforeUnselect.emit(this);\n\n    this._selected = value;\n    this._focused = value;\n    this.toggleSelectedClass();\n\n    value ? this.select.emit(this) : this.unselect.emit(this);\n  }\n  private _selected = false;\n\n  @Input()\n  get disabled() {\n    return this._disabled;\n  }\n  set disabled(value: boolean) {\n    if (value === this._disabled) {\n      return;\n    }\n\n    if (value === true) {\n      this.selected = false;\n    }\n\n    value ? this.beforeDisable.emit(this) : this.beforeEnable.emit(this);\n\n    this._disabled = value;\n    this.toggleDisabledClass();\n\n    value ? this.disable.emit(this) : this.enable.emit(this);\n  }\n  private _disabled = false;\n\n  @Output() beforeSelect = new EventEmitter<ListItemDirective>();\n  @Output() beforeFocus = new EventEmitter<ListItemDirective>();\n  @Output() beforeUnselect = new EventEmitter<ListItemDirective>();\n  @Output() beforeUnfocus = new EventEmitter<ListItemDirective>();\n  @Output() beforeDisable = new EventEmitter<ListItemDirective>();\n  @Output() beforeEnable = new EventEmitter<ListItemDirective>();\n  @Output() focus = new EventEmitter<ListItemDirective>();\n  @Output() unfocus = new EventEmitter<ListItemDirective>();\n  @Output() select = new EventEmitter<ListItemDirective>();\n  @Output() unselect = new EventEmitter<ListItemDirective>();\n  @Output() disable = new EventEmitter<ListItemDirective>();\n  @Output() enable = new EventEmitter<ListItemDirective>();\n\n  @HostListener('click')\n  onClick() {\n    this.selected = true;\n  }\n\n  constructor(public renderer: Renderer2, public el: ElementRef) {}\n\n  getOffsetTop(): number {\n    const padding = 5;\n\n    return this.el.nativeElement.offsetTop - padding;\n  }\n\n  private toggleFocusedClass() {\n    if (this.focused) {\n      this.addCls(ListItemDirective.focusedCls);\n    } else {\n      this.removeCls(ListItemDirective.focusedCls);\n    }\n  }\n\n  private toggleSelectedClass() {\n    if (this.selected) {\n      this.addCls(ListItemDirective.selectedCls);\n      this.removeCls(ListItemDirective.focusedCls);\n    } else {\n      this.removeCls(ListItemDirective.selectedCls);\n    }\n  }\n\n  private toggleDisabledClass() {\n    if (this.disabled) {\n      this.addCls(ListItemDirective.disabledCls);\n    } else {\n      this.removeCls(ListItemDirective.disabledCls);\n    }\n  }\n\n  private addCls(cls: string) {\n    this.renderer.addClass(this.el.nativeElement, cls);\n  }\n\n  private removeCls(cls: string) {\n    this.renderer.removeClass(this.el.nativeElement, cls);\n  }\n}\n","import {\n  Component,\n  AfterViewInit,\n  OnInit,\n  OnDestroy,\n  Input,\n  ContentChildren,\n  HostListener,\n  ElementRef\n} from '@angular/core';\nimport type { QueryList } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport { ListItemDirective } from './list-item.directive';\n\n@Component({\n  selector: 'igo-list',\n  templateUrl: './list.component.html',\n  styleUrls: ['./list.component.scss']\n})\nexport class ListComponent implements AfterViewInit, OnInit, OnDestroy {\n  @Input()\n  get navigation() {\n    return this._navigation;\n  }\n  set navigation(value: boolean) {\n    this._navigation = value;\n  }\n  private _navigation = true;\n\n  @Input()\n  get selection() {\n    return this._selection;\n  }\n  set selection(value: boolean) {\n    this._selection = value;\n  }\n  private _selection = true;\n\n  get selectedItem() {\n    return this._selectedItem;\n  }\n  set selectedItem(value: ListItemDirective) {\n    this.focusedItem = value;\n    this._selectedItem = value;\n  }\n  private _selectedItem: ListItemDirective;\n\n  get focusedItem() {\n    return this._focusedItem;\n  }\n  set focusedItem(value: ListItemDirective) {\n    this._focusedItem = value;\n  }\n  private _focusedItem: ListItemDirective;\n\n  private navigationEnabled: boolean;\n  private listItems$$: Subscription;\n  private subscriptions: Subscription[] = [];\n\n  @ContentChildren(ListItemDirective, { descendants: true })\n  listItems: QueryList<ListItemDirective>;\n\n  @HostListener('document:keydown', ['$event'])\n  @HostListener('document:enter', ['$event'])\n  handleKeyboardEvent(event: KeyboardEvent) {\n    // It would be nice to be able to unsubscribe to the event\n    // completely but until ES7 this won't be possible because\n    // document events are not observables\n    if (this.navigationEnabled) {\n      if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {\n        event.preventDefault();\n        this.navigate(event.key);\n      } else if (event.key === 'Enter') {\n        this.select(this.focusedItem);\n      }\n    }\n  }\n\n  constructor(private el: ElementRef) {}\n\n  ngOnInit() {\n    this.enableNavigation();\n  }\n\n  ngAfterViewInit() {\n    if (this.listItems.length) {\n      this.init();\n    }\n\n    this.listItems$$ = this.listItems.changes.subscribe(\n      (items: ListItemDirective[]) => this.init()\n    );\n  }\n\n  ngOnDestroy() {\n    this.listItems$$.unsubscribe();\n  }\n\n  focus(item?: ListItemDirective) {\n    if (!this.selection) {\n      return;\n    }\n\n    this.unfocus();\n\n    // We need to make this check because dynamic\n    // lists such as in the search results list may fail\n    if (item !== undefined) {\n      item.focused = true;\n    }\n  }\n\n  unfocus() {\n    if (this.focusedItem !== undefined) {\n      this.focusedItem.focused = false;\n    }\n\n    this.focusedItem = undefined;\n  }\n\n  focusNext() {\n    const items = this.listItems.toArray();\n    let item;\n    const igoList = this.el.nativeElement;\n    let disabled = true;\n    let index = this.getFocusedIndex();\n    if (index === undefined) {\n      index = -1;\n    }\n\n    while (disabled && index < items.length - 1) {\n      index += 1;\n      item = items[index];\n      disabled = item.disabled;\n    }\n\n    if (item !== undefined) {\n      this.focus(item);\n    }\n\n    if (!items[index + 1]) {\n      igoList.scrollTop = igoList.scrollHeight - igoList.clientHeight;\n      return;\n    }\n\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\n      igoList.scrollTop =\n        item.el.nativeElement.offsetTop +\n        item.el.nativeElement.children[0].offsetHeight -\n        igoList.clientHeight;\n    }\n  }\n\n  focusPrevious() {\n    const items = this.listItems.toArray();\n    let item: ListItemDirective;\n    const igoList = this.el.nativeElement;\n    let disabled = true;\n    let index = this.getFocusedIndex();\n\n    while (disabled && index > 0) {\n      index -= 1;\n      item = items[index];\n      disabled = item.disabled;\n    }\n\n    if (item !== undefined) {\n      this.focus(item);\n    }\n\n    if (!items[index - 1]) {\n      igoList.scrollTop = 0;\n      return;\n    }\n\n    if (item !== undefined && !this.isScrolledIntoView(item.el.nativeElement)) {\n      const padding = 3;\n      igoList.scrollTop = item.el.nativeElement.offsetTop - padding;\n    }\n  }\n\n  select(item?: ListItemDirective) {\n    if (!this.selection) {\n      return;\n    }\n\n    this.unselect();\n\n    if (item !== undefined) {\n      item.selected = true;\n    }\n  }\n\n  unselect() {\n    this.unfocus();\n\n    if (this.selectedItem !== undefined) {\n      this.selectedItem.selected = false;\n    }\n\n    this.selectedItem = undefined;\n  }\n\n  enableNavigation() {\n    if (this.navigation) {\n      this.navigationEnabled = true;\n    }\n  }\n\n  disableNavigation() {\n    this.navigationEnabled = false;\n  }\n\n  scrollToItem(item: ListItemDirective) {\n    this.el.nativeElement.scrollTop = item.getOffsetTop();\n  }\n\n  isScrolledIntoView(elem) {\n    const docViewTop =\n      this.el.nativeElement.scrollTop + this.el.nativeElement.offsetTop;\n    const docViewBottom = docViewTop + this.el.nativeElement.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.children[0].offsetHeight;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  private init() {\n    this.subscribe();\n\n    this.selectedItem = this.findSelectedItem();\n    this.focusedItem = this.findFocusedItem();\n\n    this.enableNavigation();\n  }\n\n  private subscribe() {\n    this.unsubscribe();\n\n    this.listItems.toArray().forEach(item => {\n      this.subscriptions.push(\n        item.beforeSelect.subscribe((item2: ListItemDirective) =>\n          this.handleItemBeforeSelect(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.select.subscribe((item2: ListItemDirective) =>\n          this.handleItemSelect(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.beforeFocus.subscribe((item2: ListItemDirective) =>\n          this.handleItemBeforeFocus(item2)\n        )\n      );\n\n      this.subscriptions.push(\n        item.focus.subscribe((item2: ListItemDirective) =>\n          this.handleItemFocus(item2)\n        )\n      );\n    }, this);\n  }\n\n  private unsubscribe() {\n    this.subscriptions.forEach((sub: Subscription) => sub.unsubscribe());\n    this.subscriptions = [];\n  }\n\n  private handleItemBeforeFocus(item: ListItemDirective) {\n    if (item !== this.focusedItem) {\n      this.unfocus();\n    }\n  }\n\n  private handleItemFocus(item: ListItemDirective) {\n    this.focusedItem = item;\n  }\n\n  private handleItemBeforeSelect(item: ListItemDirective) {\n    if (item !== this.focusedItem) {\n      this.unselect();\n    }\n  }\n\n  private handleItemSelect(item: ListItemDirective) {\n    this.selectedItem = item;\n  }\n\n  private findSelectedItem() {\n    return this.listItems.toArray().find(item => item.selected);\n  }\n\n  private findFocusedItem() {\n    return this.listItems.toArray().find(item => item.focused);\n  }\n\n  private getFocusedIndex() {\n    return this.listItems\n      .toArray()\n      .findIndex(item => item === this.focusedItem);\n  }\n\n  private navigate(key: string) {\n    switch (key) {\n      case 'ArrowUp':\n        this.focusPrevious();\n        break;\n      case 'ArrowDown':\n        this.focusNext();\n        break;\n      default:\n        break;\n    }\n  }\n}\n","<mat-list\n  igoClickout\n  [ngClass]=\"{'selectable': selection}\"\n  (clickout)=\"disableNavigation()\"\n  (click)=\"enableNavigation()\">\n  <ng-content></ng-content>\n</mat-list>\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\n\nimport { IgoClickoutModule } from '../clickout/clickout.module';\n\nimport { ListItemDirective } from './list-item.directive';\nimport { ListComponent } from './list.component';\n\n@NgModule({\n  imports: [CommonModule, MatIconModule, MatListModule, IgoClickoutModule],\n  declarations: [ListItemDirective, ListComponent],\n  exports: [ListItemDirective, ListComponent]\n})\nexport class IgoListModule {\n  static forRoot(): ModuleWithProviders<IgoListModule> {\n    return {\n      ngModule: IgoListModule,\n      providers: []\n    };\n  }\n}\n","<div *ngIf=\"withHeader\" class=\"igo-panel-header mat-typography\" title=\"\" [ngClass]=\"{'igo-cursor-pointer': cursorPointer === true}\">\n  <h3>\n    <ng-content select=\"[panelLeftButton]\"></ng-content>\n    <div class=\"igo-panel-title\">\n      {{ title }}\n      <ng-content select=\"[panelHeader]\"></ng-content>\n    </div>\n    <ng-content select=\"[panelRightButton]\"></ng-content>\n  </h3>\n</div>\n<div class=\"igo-panel-content\" title=\"\">\n  <ng-content></ng-content>\n</div>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  HostBinding\n} from '@angular/core';\n\n@Component({\n  selector: 'igo-panel',\n  templateUrl: './panel.component.html',\n  styleUrls: ['./panel.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class PanelComponent {\n  @Input() title: string;\n\n  @Input()\n  @HostBinding('class.igo-panel-with-header')\n  get withHeader(): boolean {\n    return this._withHeader;\n  }\n  set withHeader(value: boolean) {\n    this._withHeader = value;\n  }\n  private _withHeader = true;\n\n  @Input() cursorPointer: boolean = false;\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { PanelComponent } from './panel.component';\n\n@NgModule({\n  imports: [CommonModule],\n  exports: [PanelComponent],\n  declarations: [PanelComponent]\n})\nexport class IgoPanelModule {}\n","import { Component, Input } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'igo-spinner',\n  templateUrl: './spinner.component.html',\n  styleUrls: ['./spinner.component.scss']\n})\nexport class SpinnerComponent {\n\n  public shown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  @Input()\n  set shown(value: boolean) { this.shown$.next(value); }\n  get shown(): boolean { return this.shown$.value; }\n\n  constructor() {}\n\n  show() {\n    this.shown = true;\n  }\n\n  hide() {\n    this.shown = false;\n  }\n}\n","<div\n  [ngClass]=\"{'igo-spinner-container': true, 'igo-spinner-shown': (shown$ | async)}\">\n  <div class=\"igo-spinner-background\"></div>\n  <mat-progress-spinner diameter=\"40\" mode=\"indeterminate\"></mat-progress-spinner>\n</div>\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { ActivityService } from '@igo2/core';\nimport { SpinnerComponent } from './spinner.component';\n\n/**\n * A directive to bind a SpinnerComponent to the activity service.\n * The activity service tracks any HTTP request and this directive\n * will display the spinner it's attached to when the activity counter\n * is greater than 0.\n */\n@Directive({\n  selector: '[igoSpinnerActivity]'\n})\nexport class SpinnerActivityDirective implements OnInit, OnDestroy {\n  /**\n   * Subscription to the activity service counter\n   */\n  private counter$$: Subscription;\n\n  constructor(\n    @Self() private spinner: SpinnerComponent,\n    private activityService: ActivityService\n  ) {}\n\n  /**\n   * Subscribe to the activity service counter and display the spinner\n   * when it's is greater than 0.\n   * @internal\n   */\n  ngOnInit() {\n    this.counter$$ = this.activityService.counter$\n      .pipe(debounceTime(50))\n      .subscribe((count: number) => {\n        count > 0 ? this.spinner.show() : this.spinner.hide();\n      });\n  }\n\n  /**\n   * Unsubcribe to the activity service counter.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.counter$$.unsubscribe();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\n\nimport { SpinnerActivityDirective } from './spinner-activity.directive';\nimport { SpinnerComponent } from './spinner.component';\n\n@NgModule({\n  imports: [CommonModule, MatProgressSpinnerModule],\n  declarations: [SpinnerActivityDirective, SpinnerComponent],\n  exports: [SpinnerActivityDirective, SpinnerComponent]\n})\nexport class IgoSpinnerModule {}\n","import { DataSource } from '@angular/cdk/table';\nimport { MatSort } from '@angular/material/sort';\n\nimport { Observable, BehaviorSubject, merge } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { TableDatabase, TableModel } from './index';\n\nexport class TableDataSource extends DataSource<any> {\n  get filter(): string {\n    return this._filterChange.value;\n  }\n  set filter(filter: string) {\n    this._filterChange.next(filter);\n  }\n  private _filterChange = new BehaviorSubject('');\n\n  constructor(\n    private _database: TableDatabase,\n    private _model: TableModel,\n    private _sort: MatSort\n  ) {\n    super();\n  }\n\n  // Connect function called by the table to retrieve one stream containing\n  // the data to render.\n  connect(): Observable<any[]> {\n    if (!this._database) {\n      return merge([]);\n    }\n    const displayDataChanges = [\n      this._database.dataChange,\n      this._filterChange,\n      this._sort.sortChange\n    ];\n\n    return merge(...displayDataChanges).pipe(\n      map(() => {\n        return this.getFilteredData(this._database.data);\n      }),\n      map(data => {\n        return this.getSortedData(data);\n      })\n    );\n  }\n\n  disconnect() {}\n\n  getFilteredData(data): any[] {\n    if (!this.filter) {\n      return data;\n    }\n    return data.slice().filter((item: any) => {\n      const searchStr: string = this._model.columns\n        .filter(c => c.filterable)\n        .map(c => ObjectUtils.resolve(item, c.name))\n        .join(' ')\n        .toLowerCase();\n\n      return searchStr.indexOf(this.filter.toLowerCase()) !== -1;\n    });\n  }\n\n  getSortedData(data): any[] {\n    if (!this._sort.active || this._sort.direction === '') {\n      return data;\n    }\n\n    return data.sort((a, b) => {\n      const propertyA: number | string = ObjectUtils.resolve(\n        a,\n        this._sort.active\n      );\n      const propertyB: number | string = ObjectUtils.resolve(\n        b,\n        this._sort.active\n      );\n\n      return ObjectUtils.naturalCompare(\n        propertyB,\n        propertyA,\n        this._sort.direction\n      );\n    });\n  }\n}\n","export enum TableActionColor {\n  primary,\n  accent,\n  warn\n}\n","<div class='table-box'>\n  <div class='table-header' *ngIf=\"hasFilterInput\">\n    <mat-form-field floatPlaceholder='never'>\n      <input matInput #filter [placeholder]=\"'igo.common.table.filter' | translate\">\n    </mat-form-field>\n  </div>\n\n  <div class='table-container'>\n    <table mat-table #table [dataSource]='dataSource' matSort>\n\n      <!-- Checkbox Column -->\n      <ng-container matColumnDef=\"selectionCheckbox\">\n        <th mat-header-cell *matHeaderCellDef>\n          <mat-checkbox (change)=\"$event ? masterToggle() : null\"\n                        [checked]=\"selection.hasValue() && isAllSelected()\"\n                        [indeterminate]=\"selection.hasValue() && !isAllSelected()\">\n          </mat-checkbox>\n        </th>\n        <td mat-cell *matCellDef=\"let row\">\n          <mat-checkbox (click)=\"$event.stopPropagation()\"\n                        (change)=\"$event ? selection.toggle(row) : null\"\n                        [checked]=\"selection.isSelected(row)\">\n          </mat-checkbox>\n        </td>\n      </ng-container>\n\n      <ng-container [matColumnDef]='column.name' *ngFor='let column of model.columns'>\n        <ng-container *ngIf='column.sortable'>\n          <th mat-header-cell *matHeaderCellDef mat-sort-header> {{column.title}} </th>\n        </ng-container>\n\n        <ng-container *ngIf='!column.sortable'>\n          <th mat-header-cell *matHeaderCellDef> {{column.title}} </th>\n        </ng-container>\n\n        <ng-container *ngIf=\"!column.html; else cellHTML\">\n          <td mat-cell *matCellDef='let row' class=\"mat-cell-text\"\n            [ngClass]=\"model.cellClassFunc ? model.cellClassFunc(row, column) : {}\">\n            {{getValue(row, column.name)}}\n          </td>\n        </ng-container>\n\n        <ng-template #cellHTML>\n          <td mat-cell *matCellDef='let row' class=\"mat-cell-text\"\n            [ngClass]=\"model.cellClassFunc ? model.cellClassFunc(row, column) : {}\"\n            [innerHTML]=\"getValue(row, column.name)\">\n          </td>\n        </ng-template>\n      </ng-container>\n\n      <!-- Action Column -->\n      <ng-container matColumnDef='action'>\n        <th mat-header-cell *matHeaderCellDef></th>\n        <td mat-cell *matCellDef='let row'>\n          <button *ngFor='let action of model.actions'\n          mat-mini-fab\n          [color]='getActionColor(action.color)'\n          (click)='handleClickAction($event, action, row)'>\n            <mat-icon svgIcon=\"{{action.icon}}\"></mat-icon>\n          </button>\n        </td>\n      </ng-container>\n\n      <tr mat-header-row *matHeaderRowDef='displayedColumns;'></tr>\n      <tr mat-row\n        *matRowDef='let row; columns: displayedColumns;'\n        [ngClass]=\"model.rowClassFunc ? model.rowClassFunc(row) : {}\"\n        (click)=\"selection.toggle(row)\">\n      </tr>\n\n    </table>\n  </div>\n\n</div>\n","import {\n  Component,\n  ElementRef,\n  ViewChild,\n  Input,\n  Output,\n  OnChanges,\n  OnInit,\n  AfterViewInit,\n  EventEmitter\n} from '@angular/core';\nimport { MatSort } from '@angular/material/sort';\nimport { SelectionModel } from '@angular/cdk/collections';\n\nimport { debounceTime, distinctUntilChanged } from 'rxjs/operators';\nimport { fromEvent } from 'rxjs';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { TableModel } from './table-model.interface';\nimport { TableDatabase } from './table-database';\nimport { TableDataSource } from './table-datasource';\nimport { TableActionColor } from './table-action-color.enum';\n\n@Component({\n  selector: 'igo-table',\n  templateUrl: './table.component.html',\n  styleUrls: ['./table.component.scss']\n})\nexport class TableComponent implements OnChanges, OnInit, AfterViewInit {\n  @Input()\n  get database(): TableDatabase {\n    return this._database;\n  }\n  set database(value: TableDatabase) {\n    this._database = value;\n  }\n  private _database: TableDatabase;\n\n  @Input()\n  get model(): TableModel {\n    return this._model;\n  }\n  set model(value: TableModel) {\n    this._model = value;\n  }\n  private _model: TableModel;\n\n  @Input()\n  get hasFilterInput(): boolean {\n    return this._hasFIlterInput;\n  }\n  set hasFilterInput(value: boolean) {\n    this._hasFIlterInput = value;\n  }\n  private _hasFIlterInput = true;\n\n  public displayedColumns;\n  public dataSource: TableDataSource | null;\n  public selection = new SelectionModel<any>(true, []);\n\n  @Output()\n  select = new EventEmitter<{\n    added: any[];\n    removed: any[];\n    source: SelectionModel<any>;\n  }>();\n\n  @ViewChild('filter') filter: ElementRef;\n  @ViewChild(MatSort, { static: true }) sort: MatSort;\n\n  ngOnInit() {\n    this.dataSource = new TableDataSource(this.database, this.model, this.sort);\n\n    if (this.model) {\n      this.displayedColumns = this.model.columns\n        .filter(c => c.displayed !== false)\n        .map(c => c.name);\n\n      if (this.model.selectionCheckbox) {\n        this.displayedColumns.unshift('selectionCheckbox');\n      }\n      if (this.model.actions && this.model.actions.length) {\n        this.displayedColumns.push('action');\n      }\n    }\n\n    this.selection.changed.subscribe(e => this.select.emit(e));\n  }\n\n  ngAfterViewInit() {\n    if (this.filter) {\n      fromEvent(this.filter.nativeElement, 'keyup')\n        .pipe(\n          debounceTime(150),\n          distinctUntilChanged()\n        )\n        .subscribe(() => {\n          if (!this.dataSource) {\n            return;\n          }\n          this.dataSource.filter = this.filter.nativeElement.value;\n        });\n    }\n  }\n\n  ngOnChanges(change) {\n    if (change.database) {\n      this.dataSource = new TableDataSource(\n        this.database,\n        this.model,\n        this.sort\n      );\n      this.selection.clear();\n    }\n  }\n\n  getActionColor(colorId: number): string {\n    return TableActionColor[colorId];\n  }\n\n  getValue(row, key) {\n    return ObjectUtils.resolve(row, key);\n  }\n\n  /** Whether the number of selected elements matches the total number of rows. */\n  isAllSelected() {\n    const numSelected = this.selection.selected.length;\n    const numRows = this.database.data.length;\n    return numSelected === numRows;\n  }\n\n  /** Selects all rows if they are not all selected; otherwise clear selection. */\n  masterToggle() {\n    this.isAllSelected()\n      ? this.selection.clear()\n      : this.database.data.forEach(row => this.selection.select(row));\n  }\n\n  handleClickAction(event, action, row) {\n    event.stopPropagation();\n    action.click(row);\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { CdkTableModule } from '@angular/cdk/table';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSortModule } from '@angular/material/sort';\nimport { MatTableModule } from '@angular/material/table';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { TableComponent } from './table.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    CdkTableModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTableModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSortModule,\n    MatCheckboxModule,\n    IgoLanguageModule\n  ],\n  declarations: [TableComponent],\n  exports: [TableComponent]\n})\nexport class IgoTableModule {\n  static forRoot(): ModuleWithProviders<IgoTableModule> {\n    return {\n      ngModule: IgoTableModule,\n      providers: []\n    };\n  }\n}\n","import { EntityStore } from '../../entity';\nimport { Action } from './action.interfaces';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * actions.\n */\nexport class ActionStore extends EntityStore<Action> {\n\n}\n","export enum ToolboxColor {\n  White = 'white',\n  Grey = 'grey',\n  Primary = 'primary'\n}\n","import {\n  trigger,\n  state,\n  style,\n  transition,\n  animate,\n  AnimationTriggerMetadata\n} from '@angular/animations';\n\nexport function toolSlideInOut(\n  speed = '300ms',\n  type = 'ease-in-out'\n): AnimationTriggerMetadata {\n  return trigger('toolSlideInOut', [\n    state(\n      'enter',\n      style({\n        transform: 'translate3d(0, 0, 0)'\n      })\n    ),\n    transition('void => enter', animate(speed + ' ' + type))\n  ]);\n}\n","<igo-actionbar\n  *ngIf=\"(toolbar$ | async).length > 0\"\n  [store]=\"actionStore\"\n  [withIcon]=\"true\"\n  [withTitle]=\"toolbarWithTitle$ | async\"\n  [withTooltip]=\"(toolbarWithTitle$ | async) === false\"\n  [scrollActive]=\"toolbarWithTitle$ | async\"\n  [horizontal]=\"false\">\n</igo-actionbar>\n\n<div\n  *ngIf=\"activeTool$ | async as tool\"\n  class=\"igo-tool-container\"\n  [ngClass]=\"{'igo-tool-container-with-toolbar': !actionStore.empty, 'igo-tool-container-with-animation': animate}\"\n  [@toolSlideInOut]=\"animation$ | async\"\n  (@toolSlideInOut.start)=\"onAnimationStart()\"\n  (@toolSlideInOut.done)=\"onAnimationComplete()\">\n\n  <igo-dynamic-outlet\n    [component]=\"tool.component\"\n    [inputs]=\"getToolInputs(tool)\">\n  </igo-dynamic-outlet>\n\n</div>\n","import {\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  HostBinding,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { Subscription, BehaviorSubject, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Action, ActionStore } from '../../action';\nimport { Tool } from '../shared/tool.interface';\nimport { ToolboxColor } from '../shared/toolbox.enums';\nimport { Toolbox } from '../shared/toolbox';\nimport { toolSlideInOut } from './toolbox.animation';\n\n@Component({\n  selector: 'igo-toolbox',\n  templateUrl: 'toolbox.component.html',\n  styleUrls: ['toolbox.component.scss'],\n  animations: [toolSlideInOut()],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ToolboxComponent implements OnInit, OnDestroy {\n  /**\n   * Observable of the active tool\n   */\n  activeTool$: BehaviorSubject<Tool> = new BehaviorSubject(undefined);\n\n  /**\n   * Store of actions that toggle tools\n   */\n  actionStore: ActionStore = new ActionStore([]);\n\n  /**\n   * Observable of he anmation state\n   */\n  animation$: BehaviorSubject<string> = new BehaviorSubject('none');\n\n  /**\n   * Observable of the toolbar\n   */\n  toolbar$: BehaviorSubject<string[]> = new BehaviorSubject([]);\n\n  /**\n   * Whether the Toolbar should display actions' titles\n   */\n  toolbarWithTitle$: Observable<boolean> = this.activeTool$.pipe(\n    map((tool: Tool | undefined) => tool === undefined)\n  );\n\n  /**\n   * Subscription to the active tool\n   */\n  private activeTool$$: Subscription;\n\n  /**\n   * Subscription to the toolbar\n   */\n  private toolbar$$: Subscription;\n\n  /**\n   * Observable of the ongoing animation. This is useful when\n   * multiple animations are triggered at once i.e. when the user clicks\n   * too fast on different actions\n   */\n  private animating$ = new BehaviorSubject<boolean>(false);\n\n  /**\n   * Subscription to the ongoing animation\n   */\n  private animating$$: Subscription;\n\n  /**\n   * Toolbox\n   */\n  @Input() toolbox: Toolbox;\n\n  /**\n   * Whether the toolbox should animate the first tool entering\n   */\n  @Input() animate: boolean = false;\n\n  /**\n   * Color of Toolbox\n   */\n  @Input() color: ToolboxColor = ToolboxColor.White;\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.color-grey')\n  get classColorGrey() {\n    return this.color === ToolboxColor.Grey;\n  }\n\n  /**\n   * @ignore\n   */\n  @HostBinding('class.color-primary')\n  get classColorPrimary() {\n    return this.color === ToolboxColor.Primary;\n  }\n\n  /**\n   * Initialize the toolbar and subscribe to the active tool\n   * @internal\n   */\n  ngOnInit() {\n    this.toolbar$$ = this.toolbox.toolbar$.subscribe((toolbar: string[]) =>\n      this.onToolbarChange(toolbar)\n    );\n    this.activeTool$$ = this.toolbox.activeTool$.subscribe((tool: Tool) =>\n      this.onActiveToolChange(tool)\n    );\n  }\n\n  /**\n   * Unsubscribe to the active tool and destroy the action store\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toolbar$$.unsubscribe();\n    this.activeTool$$.unsubscribe();\n    this.actionStore.destroy();\n  }\n\n  /**\n   * Track the starting animation\n   * @internal\n   */\n  onAnimationStart() {\n    this.animating$.next(true);\n  }\n\n  /**\n   * Untrack the completed animation\n   * @internal\n   */\n  onAnimationComplete() {\n    this.animating$.next(false);\n  }\n\n  /**\n   * Return a tool's inputs\n   * @param tool Tool\n   * @returns Tool inputs\n   * @internal\n   */\n  getToolInputs(tool: Tool): { [key: string]: any } {\n    return tool.options || {};\n  }\n\n  /**\n   * Initialize an action store\n   * @param toolbar Toolbar\n   */\n  private onToolbarChange(toolbar: string[]) {\n    this.setToolbar(toolbar);\n  }\n\n  /**\n   * Activate a tool and trigger an animation or not\n   * @param tool Tool to activate\n   */\n  private onActiveToolChange(tool: Tool) {\n    if (!this.animate) {\n      this.setActiveTool(tool);\n      return;\n    }\n    this.onAnimate(() => this.setActiveTool(tool));\n  }\n\n  /**\n   * Set the active tool\n   * @param tool Tool to activate\n   */\n  private setActiveTool(tool: Tool | undefined) {\n    if (tool === undefined) {\n      this.actionStore.state.updateAll({ active: false });\n    } else {\n      const action = this.actionStore.get(tool.name);\n      if (action !== undefined) {\n        this.actionStore.state.update(action, { active: true }, true);\n      }\n    }\n\n    this.activeTool$.next(tool);\n    if (this.animate) {\n      this.animation$.next('enter');\n    }\n  }\n\n  /**\n   * Initialize the toolbar\n   */\n  private setToolbar(toolbar: string[]) {\n    const actions = toolbar.reduce((acc: Action[], toolName: string) => {\n      const tool = this.toolbox.getTool(toolName);\n      if (tool === undefined) {\n        return acc;\n      }\n\n      acc.push({\n        id: tool.name,\n        title: tool.title,\n        icon: tool.icon,\n        // iconImage: tool.iconImage,\n        tooltip: tool.tooltip,\n        args: [tool, this.toolbox],\n        handler: (_tool: Tool, _toolbox: Toolbox) => {\n          _toolbox.activateTool(_tool.name);\n        },\n        ngClass: (_tool: Tool, _toolbox: Toolbox) => {\n          return this.toolbox.activeTool$.pipe(\n            map((activeTool: Tool) => {\n              let toolActivated = false;\n              if (activeTool !== undefined && _tool.name === activeTool.name) {\n                toolActivated = true;\n              }\n\n              let childrenToolActivated = false;\n              if (\n                activeTool !== undefined &&\n                _tool.name === activeTool.parent\n              ) {\n                childrenToolActivated = true;\n              }\n\n              return {\n                'tool-activated': toolActivated,\n                'children-tool-activated': childrenToolActivated\n              };\n            })\n          );\n        }\n      });\n      return acc;\n    }, []);\n    this.actionStore.load(actions);\n    this.toolbar$.next(toolbar);\n  }\n\n  /**\n   * Observe the ongoing animation and ignore any incoming animation\n   * while one is still ongoing.\n   * @param callback Callback to execute when the animation completes\n   */\n  private onAnimate(callback: () => void) {\n    this.unAnimate();\n    this.animating$$ = this.animating$.subscribe((animation: boolean) => {\n      if (!animation) {\n        callback.call(this);\n        this.unAnimate();\n      }\n    });\n  }\n\n  /**\n   * Stop observing an animation when it's complete\n   */\n  private unAnimate() {\n    if (this.animating$$) {\n      this.animating$$.unsubscribe();\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoActionModule } from '../../action/action.module';\nimport {\n    IgoDynamicComponentModule\n} from '../../dynamic-component/dynamic-component.module';\n\nimport { ToolboxComponent } from './toolbox.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoActionModule,\n    IgoDynamicComponentModule\n  ],\n  exports: [\n    ToolboxComponent\n  ],\n  declarations: [\n    ToolboxComponent\n  ]\n})\nexport class IgoToolboxModule {}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { ToolService } from './shared/tool.service';\nimport { IgoToolboxModule } from './toolbox/toolbox.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoToolboxModule\n  ],\n  declarations: []\n})\nexport class IgoToolModule {\n  static forRoot(): ModuleWithProviders<IgoToolModule> {\n    return {\n      ngModule: IgoToolModule,\n      providers: [\n        ToolService\n      ]\n    };\n  }\n}\n","<igo-dynamic-outlet\n  *ngIf=\"widget\"\n  [component]=\"widget\"\n  [inputs]=\"inputs\"\n  [subscribers]=\"getEffectiveSubscribers()\">\n</igo-dynamic-outlet>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnDestroy\n} from '@angular/core';\n\nimport { DynamicComponent } from '../../dynamic-component';\n\nimport { WidgetComponent } from '../shared/widget.interfaces';\n\n/**\n * This component dynamically renders a widget. It also subscribes\n * to the widget's 'cancel' and 'complete' events and destroys it\n * when any of those event is emitted.\n */\n@Component({\n  selector: 'igo-widget-outlet',\n  templateUrl: './widget-outlet.component.html',\n  styleUrls: ['./widget-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WidgetOutletComponent implements OnDestroy {\n\n  /**\n   * Widget subscribers to 'cancel' and 'complete'\n   * @internal\n   */\n  private baseSubscribers = {\n    cancel: (event: any) => this.onCancel(event),\n    complete: (event: any) => this.onComplete(event)\n  };\n\n  /**\n   * Widget\n   */\n  @Input() widget: DynamicComponent<WidgetComponent>;\n\n  /**\n   * Widget inputs\n   */\n  @Input() inputs: {[key: string]: any};\n\n  /**\n   * Widget subscribers\n   */\n  @Input() subscribers: {[key: string]: (event: any) => void} = {};\n\n  /**\n   * Event emitted when the widget emits 'complete'\n   */\n  @Output() complete = new EventEmitter<any>();\n\n  /**\n   * Event emitted when the widget emits 'cancel'\n   */\n  @Output() cancel = new EventEmitter<any>();\n\n  constructor() {}\n\n  /**\n   * Destroy the current widget and all it's inner subscriptions\n   * @internal\n   */\n  ngOnDestroy() {\n    this.destroyWidget();\n  }\n\n  /**\n   * Get the effective subscribers. That means a combination of the base\n   * subscribers and any subscriber given as input.\n   * @returns Combined subscribers\n   * @internal\n   */\n  getEffectiveSubscribers(): {[key: string]: (event: any) => void} {\n    const subscribers = Object.assign({}, this.subscribers);\n\n    // Base subscribers\n    Object.keys(this.baseSubscribers).forEach((key: string) => {\n      const subscriber = subscribers[key];\n      const baseSubscriber = this.baseSubscribers[key];\n      if (subscriber !== undefined) {\n        subscribers[key] = (event: any) => {\n          subscriber(event);\n          baseSubscriber(event);\n        };\n      } else {\n        subscribers[key] = baseSubscriber;\n      }\n    });\n\n    return subscribers;\n  }\n\n  /**\n   * When the widget emits 'cancel', propagate that event and destroy\n   * the widget\n   */\n  private onCancel(event: any) {\n    this.cancel.emit(event);\n    this.destroyWidget();\n  }\n\n  /**\n   * When the widget emits 'complete', propagate that event and destroy\n   * the widget\n   */\n  private onComplete(event: any) {\n    this.complete.emit(event);\n    this.destroyWidget();\n  }\n\n  /**\n   * Destroy the current widget\n   */\n  private destroyWidget() {\n    if (this.widget !== undefined) {\n      this.widget.destroy();\n    }\n    this.widget = undefined;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport {\n  IgoDynamicComponentModule\n} from '../../dynamic-component/dynamic-component.module';\n\nimport { WidgetOutletComponent } from './widget-outlet.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoDynamicComponentModule\n  ],\n  exports: [\n    WidgetOutletComponent\n  ],\n  declarations: [\n    WidgetOutletComponent\n  ]\n})\nexport class IgoWidgetOutletModule {}\n","import { Injectable } from '@angular/core';\n\nimport { DynamicComponentService } from '../../dynamic-component/shared/dynamic-component.service';\n\nimport { Widget } from './widget';\nimport { WidgetComponent } from './widget.interfaces';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WidgetService {\n\n  constructor(private dynamicComponentService: DynamicComponentService) {}\n\n  create(widgetCls: any): Widget {\n    return this.dynamicComponentService.create(widgetCls as WidgetComponent);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoWidgetOutletModule } from './widget-outlet/widget-outlet.module';\nimport { WidgetService } from './shared/widget.service';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoWidgetOutletModule\n  ],\n  exports: [\n    IgoWidgetOutletModule\n  ],\n  declarations: [],\n  providers: [\n    WidgetService\n  ]\n})\nexport class IgoWidgetModule {}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { getEntityTitle } from '../../entity';\nimport { Workspace } from '../shared/workspace';\nimport { WorkspaceStore } from '../shared/store';\n\n/**\n * Drop list that activates the selected workspace emit an event.\n */\n@Component({\n  selector: 'igo-workspace-selector',\n  templateUrl: './workspace-selector.component.html',\n  styleUrls: ['./workspace-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WorkspaceSelectorComponent {\n\n  /**\n   * Store that holds the available workspaces.\n   */\n  @Input() store: WorkspaceStore;\n\n  /**\n   * Wheither the selector must be disabled or not.\n   */\n  @Input() disabled: boolean;\n\n  /**\n   * Event emitted when an workspace is selected or unselected\n   */\n  @Output() selectedChange = new EventEmitter<{\n    selected: boolean;\n    value: Workspace;\n  }>();\n\n  /**\n   * @internal\n   */\n  getWorkspaceTitle(workspace: Workspace): string {\n    return getEntityTitle(workspace);\n  }\n\n  /**\n   * When an workspace is manually selected, select it into the\n   * store and emit an event.\n   * @internal\n   * @param event The selection change event\n   */\n  onSelectedChange(event: {value: Workspace}) {\n    const workspace = event.value;\n    this.store.activateWorkspace(workspace);\n    this.selectedChange.emit({selected: true, value: workspace});\n  }\n\n}\n","<igo-entity-selector\n  [store]=\"store\"\n  [multi]=\"false\"\n  [titleAccessor]=\"getWorkspaceTitle\"\n  [disabled]=\"disabled\"\n  (selectedChange)=\"onSelectedChange($event)\">\n</igo-entity-selector>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoEntitySelectorModule } from '../../entity/entity-selector/entity-selector.module';\nimport { WorkspaceSelectorComponent } from './workspace-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoEntitySelectorModule\n  ],\n  exports: [\n    WorkspaceSelectorComponent\n  ],\n  declarations: [\n    WorkspaceSelectorComponent\n  ]\n})\nexport class IgoWorkspaceSelectorModule {}\n","<ng-container *ngIf=\"widget$ | async as widget\">\n  <igo-widget-outlet\n    [widget]=\"widget\"\n    [inputs]=\"widgetInputs$ | async\"\n    [subscribers]=\"widgetSubscribers$ | async\"\n    (cancel)=\"onWidgetCancel(widget)\"\n    (complete)=\"onWidgetComplete(widget)\">\n  </igo-widget-outlet>\n</ng-container>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Widget } from '../../widget';\nimport { Workspace } from '../shared/workspace';\n\n/**\n * This component dynamically render an Workspace's active widget.\n * It also deactivate that widget whenever the widget's component\n * emit the 'cancel' or 'complete' event.\n */\n@Component({\n  selector: 'igo-workspace-widget-outlet',\n  templateUrl: './workspace-widget-outlet.component.html',\n  styleUrls: ['./workspace-widget-outlet.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class WorkspaceWidgetOutletComponent {\n\n  /**\n   * Workspace\n   */\n  @Input() workspace: Workspace;\n\n  /**\n   * Event emitted when a widget is deactivate which happens\n   * when the widget's component emits the 'cancel' or 'complete' event.\n   */\n  @Output() deactivateWidget = new EventEmitter<Widget>();\n\n  /**\n   * Observable of the workspace's active widget\n   * @internal\n   */\n  get widget$(): BehaviorSubject<Widget> { return this.workspace.widget$; }\n\n  /**\n   * Observable of the workspace's widget inputs\n   * @internal\n   */\n  get widgetInputs$(): BehaviorSubject<{[key: string]: any}> {\n    return this.workspace.widgetInputs$;\n  }\n\n  /**\n   * Observable of the workspace's widget inputs\n   * @internal\n   */\n  get widgetSubscribers$(): BehaviorSubject<{[key: string]: (event: any) => void}> {\n    return this.workspace.widgetSubscribers$;\n  }\n\n  constructor() {}\n\n  /**\n   * When a widget's component emit the 'cancel' event,\n   * deactivate that widget and emit the 'deactivateWidget' event.\n   * @param widget Widget\n   * @internal\n   */\n  onWidgetCancel(widget: Widget) {\n    this.workspace.deactivateWidget();\n    this.deactivateWidget.emit(widget);\n  }\n\n  /**\n   * When a widget's component emit the 'cancel' event,\n   * deactivate that widget and emit the 'deactivateWidget' event.\n   * @param widget Widget\n   * @internal\n   */\n  onWidgetComplete(widget: Widget) {\n    this.workspace.deactivateWidget();\n    this.deactivateWidget.emit(widget);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoWidgetOutletModule } from '../../widget/widget-outlet/widget-outlet.module';\n\nimport { WorkspaceWidgetOutletComponent } from './workspace-widget-outlet.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoWidgetOutletModule\n  ],\n  exports: [\n    WorkspaceWidgetOutletComponent\n  ],\n  declarations: [\n    WorkspaceWidgetOutletComponent\n  ]\n})\nexport class IgoWorkspaceWidgetOutletModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\nimport { IgoWorkspaceWidgetOutletModule } from './workspace-widget-outlet/workspace-widget-outlet.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceWidgetOutletModule\n  ],\n  declarations: []\n})\nexport class IgoWorkspaceModule {}\n","import { BehaviorSubject } from 'rxjs';\n\nexport class TableDatabase {\n  /** Stream that emits whenever the data has been modified. */\n  dataChange: BehaviorSubject<any[]> = new BehaviorSubject<any[]>([]);\n  get data(): any[] {\n    return this.dataChange.value;\n  }\n\n  constructor(data?) {\n    if (data) {\n      this.dataChange.next(data);\n    }\n  }\n\n  set(data) {\n    this.dataChange.next(data);\n  }\n\n  add(item) {\n    const copiedData = this.data.slice();\n    copiedData.push(item);\n    this.set(copiedData);\n  }\n\n  remove(item) {\n    const copiedData = this.data.slice();\n    const index = copiedData.indexOf(item);\n    copiedData.splice(index, 1);\n    this.set(copiedData);\n  }\n}\n","import { Tool } from './tool.interface';\nimport { ToolService } from './tool.service';\n\nexport function ToolComponent(tool: Partial<Tool>): (cls: any) => any {\n  return (compType: any) => {\n    ToolService.register(Object.assign({}, tool, {\n      component: compType\n    } as Tool));\n  };\n}\n","import { EntityStore } from '../../entity';\nimport { Workspace } from './workspace';\nimport { BehaviorSubject } from 'rxjs';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * workspaces.\n */\nexport class WorkspaceStore extends EntityStore<Workspace> {\n\n  activeWorkspace$: BehaviorSubject<Workspace> = new BehaviorSubject(undefined);\n\n  /**\n   * Activate the an workspace workspace and deactivate the one currently active\n   * @param workspace Workspace\n   */\n  activateWorkspace(workspace: Workspace) {\n    const active = this.activeWorkspace$.value;\n    if (active !== undefined) {\n      active.deactivate();\n    }\n\n    this.deactivateWorkspace();\n    if (workspace !== undefined) {\n      this.state.update(workspace, {active: true, selected: true}, true);\n      this.activeWorkspace$.next(workspace);\n      workspace.activate();\n    }\n  }\n\n  /**\n   * Deactivate the current workspace\n   * @param workspace Workspace\n   */\n  deactivateWorkspace() {\n    const active = this.activeWorkspace$.value;\n    if (active !== undefined) {\n      active.deactivate();\n      this.activeWorkspace$.next(undefined);\n    }\n  }\n\n}\n","import { Subscription, BehaviorSubject, Subject } from 'rxjs';\n\nimport { ActionStore } from '../../action';\nimport { Widget } from '../../widget';\nimport { EntityStore } from '../../entity';\n\nimport { WorkspaceOptions } from './workspace.interfaces';\n\n/**\n * This class is responsible of managing the relations between\n * entities and the actions that consume them. It also defines an\n * entity table template that may be used by an entity table component.\n */\nexport class Workspace<E extends object = object> {\n\n  /**\n   * Observable of the selected widget\n   */\n  readonly widget$ = new BehaviorSubject<Widget>(undefined);\n\n  /**\n   * Observable of the selected widget's inputs\n   */\n  readonly widgetInputs$ = new BehaviorSubject<{[key: string]: any}>({});\n\n  /**\n   * Observable of the selected widget's subscribers\n   */\n  readonly widgetSubscribers$ = new BehaviorSubject<{[key: string]: (event: any) => void}>({});\n\n  /**\n   * Subscription to the selected entity\n   */\n  private entities$$: Subscription;\n\n  /**\n   * State change that trigger an update of the actions availability\n   */\n  private change: Subject<void> = new Subject();\n\n  /**\n   * Subscription to state changes\n   */\n  private change$: Subscription;\n\n  /**\n   * Workspace id\n   */\n  get id(): string { return this.options.id; }\n\n  /**\n   * Workspace title\n   */\n  get title(): string { return this.options.title; }\n\n  /**\n   * Workspace title\n   */\n  get meta(): {[key: string]: any} { return this.options.meta || {}; }\n\n  /**\n   * Entities store\n   */\n  get entityStore(): EntityStore<E> { return this.options.entityStore as EntityStore<E>; }\n\n  /**\n   * Actions store (some actions activate a widget)\n   */\n  get actionStore(): ActionStore { return this.options.actionStore; }\n\n  /**\n   * Selected widget\n   */\n  get widget(): Widget { return this.widget$.value; }\n\n  /**\n   * Whether a widget is selected\n   */\n  get hasWidget(): boolean { return this.widget !== undefined; }\n\n  constructor(protected options: WorkspaceOptions) {}\n\n  /**\n   * Whether this strategy is active\n   * @internal\n   */\n  get active(): boolean { return this.active$.value; }\n  readonly active$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Activate the workspace. By doing that, the workspace will observe\n   * the selected entity (from the store) and update the actions availability.\n   * For example, some actions require an entity to be selected.\n   */\n  activate() {\n    if (this.active === true) {\n      this.deactivate();\n    }\n    this.active$.next(true);\n\n    if (this.entityStore !== undefined) {\n      this.entities$$ = this.entityStore.stateView.all$()\n        .subscribe(() => this.onStateChange());\n    }\n\n    this.change.next();\n  }\n\n  /**\n   * Deactivate the workspace. Unsubcribe to the selected entity.\n   */\n  deactivate() {\n    this.active$.next(false);\n    this.deactivateWidget();\n\n    if (this.entities$$ !== undefined) {\n      this.entities$$.unsubscribe();\n    }\n    if (this.change$ !== undefined) {\n      this.change$.unsubscribe();\n    }\n  }\n\n  /**\n   * Activate a widget. In itself, activating a widget doesn't render it but,\n   * if an WorkspaceWidgetOutlet component is bound to this workspace, the widget will\n   * show up.\n   * @param widget Widget\n   * @param inputs Inputs the widget will receive\n   */\n  activateWidget(\n    widget: Widget,\n    inputs: {[key: string]: any} = {},\n    subscribers: {[key: string]: (event: any) => void} = {}\n  ) {\n    this.widget$.next(widget);\n    this.widgetInputs$.next(inputs);\n    this.widgetSubscribers$.next(subscribers);\n    this.change.next();\n  }\n\n  /**\n   * Deactivate a widget.\n   */\n  deactivateWidget() {\n    this.widget$.next(undefined);\n    this.change.next();\n  }\n\n  /**\n   * When the state changes, update the actions availability.\n   */\n  private onStateChange() {\n    this.change.next();\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppHomeComponent } from './home.component';\n\nconst routes: Routes = [\n  {\n    path: 'home',\n    component: AppHomeComponent\n  }\n];\n\nexport const AppHomeRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\nimport { InteractiveTourService } from '@igo2/common';\n\n@Component({\n  selector: 'app-home',\n  templateUrl: './home.component.html',\n  styleUrls: ['./home.component.scss']\n})\nexport class AppHomeComponent {\n  constructor(private interactiveTourService: InteractiveTourService) {}\n\n  startTour() {\n    this.interactiveTourService.startTour('global');\n  }\n}\n","<div style=\"text-align:center\">\n  <h1 id=\"igo-title\">\n    Welcome to IGO\n  </h1>\n  <img  class=\"igo-logo\" width=\"180\" src=\"assets/igo2/core/logo.png\">\n</div>\n\n<p>\n  <igo-interactive-tour\n    tourToStart = \"global\"\n    menuIsOpen = true\n    styleButton = \"raised\">\n  </igo-interactive-tour>\n</p>\n\n<p>\n  IGO2 library contains many components and services that may benefit any web application. <br>\n  IGO2 library is open source project using Angular, Angular Material and OpenLayers.\n</p>\n\n<h3>IGO2 library is divided into several elements: </h3>\n<ul>\n  <li><b>@igo2/utils</b> : Basic utilies without dependency (ex: base64, clipboard, uuid)</li>\n  <li><b>@igo2/core</b> : Element affecting the core of the application (ex: config, language, message, media, request)</li>\n  <li><b>@igo2/common</b> : Library containing reusable components (ex: clickout, drag-drop, list, panel, spinner, table)</li>\n  <li><b>@igo2/auth</b> : Library grouping the authentication and security module</li>\n  <li><b>@igo2/geo</b> : Library containing the geomatic components. Depends on Openlayers.</li>\n  <li><b>@igo2/context</b> : Library of components uniting @igo2/geo and @igo2/auth</li>\n  <li><b>@igo2/integration</b> : Library integrate basic components</li>\n</ul>\n\n<h2>Here are some links to help you start: </h2>\n<ul>\n  <li>\n    <h2><a target=\"_blank\" rel=\"noopener\" href=\"https://github.com/infra-geo-ouverte/igo2-lib/blob/master/README.md#user-installation\">Installation</a></h2>\n  </li>\n  <li>\n    <h2><a target=\"_blank\" rel=\"noopener\" href=\"https://angular.io/docs\">Angular Documentation</a></h2>\n  </li>\n</ul>\n\n*** Modules in <code>@igo2/core</code> must be imported only once\n","import { NgModule } from '@angular/core';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { AppHomeComponent } from './home.component';\nimport { AppHomeRoutingModule } from './home-routing.module';\nimport { IgoInteractiveTourModule } from '@igo2/common';\n\n@NgModule({\n  declarations: [AppHomeComponent],\n  imports: [\n    AppHomeRoutingModule,\n    IgoInteractiveTourModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule\n  ],\n  exports: [AppHomeComponent]\n})\nexport class AppHomeModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppActivityComponent } from './activity.component';\n\nconst routes: Routes = [\n  {\n    path: 'activity',\n    component: AppActivityComponent\n  }\n];\n\nexport const AppActivityRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { ActivityService } from '@igo2/core';\n\n@Component({\n  selector: 'app-activity',\n  templateUrl: './activity.component.html',\n  styleUrls: ['./activity.component.scss']\n})\nexport class AppActivityComponent {\n  private idsActivity: string[] = [];\n\n  constructor(private activityService: ActivityService) {}\n\n  register() {\n    this.idsActivity.push(this.activityService.register());\n  }\n\n  unregister() {\n    this.activityService.unregister(this.idsActivity.pop());\n  }\n\n  get counter() {\n    return this.activityService.counter$.value;\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>Activity</mat-card-title>\n  <mat-card-content>\n    <p>Register activities in service. Use to display a loading icon</p>\n\n    <li>Import <code>IgoActivityModule</code> only if you want register http calls</li>\n    <li>Import <code>IgoActivityModule</code> only once</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/activity\"> code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <mat-card-actions>\n    <button mat-raised-button (click)=\"register()\">Register</button>\n    <button mat-raised-button (click)=\"unregister()\">Unregister</button>\n  </mat-card-actions>\n  <p>Counter: {{counter}}</p>\n\n  <igo-spinner igoSpinnerActivity></igo-spinner>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoActivityModule } from '@igo2/core';\nimport { IgoSpinnerModule } from '@igo2/common';\n\nimport { AppActivityComponent } from './activity.component';\nimport { AppActivityRoutingModule } from './activity-routing.module';\n\n@NgModule({\n  declarations: [AppActivityComponent],\n  imports: [\n    AppActivityRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoActivityModule.forRoot(), // Only if you want register http calls\n    IgoSpinnerModule\n  ],\n  exports: [AppActivityComponent]\n})\nexport class AppActivityModule {}\n","interface Environment {\n  production: boolean;\n  igo: any;\n}\n\nexport const environment: Environment = {\n  production: true,\n  igo: {\n    projections: [\n      {\n        code: 'EPSG:32198',\n        alias: 'Quebec Lambert',\n        def:\n          '+proj=lcc +lat_1=60 +lat_2=46 +lat_0=44 +lon_0=-68.5 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs',\n        extent: [-886251.0296, 180252.9126, 897177.3418, 2106143.8139]\n      }\n    ],\n    auth: {\n      intern: {\n        enabled: true\n      },\n      allowAnonymous: true\n    },\n    interactiveTour: {\n      tourInMobile: true\n    },\n    importExport: {\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ogre'\n    },\n    language: {\n      prefix: './locale/'\n    },\n    catalog: {\n      sources: [\n        {\n          id: 'Gououvert',\n          title: 'Gouvouvert',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi'\n        },\n        {\n          id: 'DefiningInfoFormat',\n          title: 'Defining info_format',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          queryFormat: {\n            html: '*',\n            'application/json': [\n              'stations_meteoroutieres',\n              'histo_stations_meteoroutieres'\n            ]\n          },\n          queryHtmlTarget: 'iframe',\n          count: 30\n        },\n        {\n          id: 'catalogwithregex',\n          title: 'Filtered catalog by regex',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          regFilters: ['zpegt']\n        },\n        {\n          id: 'catalogwithtooltipcontrol',\n          title: 'Controling tooltip format',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          tooltipType: 'abstract' // or title\n        }\n      ]\n    },\n    searchSources: {\n      storedqueriesreverse: { enabled: false},\n      nominatim: {\n        enabled: false\n      },\n      icherche: {\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\n        order: 2,\n        enabled: true,\n        params: {\n          limit: '8'\n        }\n      },\n      coordinatesreverse: {\n        showInPointerSummary: true\n      },\n      icherchereverse: {\n        showInPointerSummary: true,\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\n        order: 3,\n        enabled: true\n      },\n      ilayer: {\n        searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\n        order: 4,\n        enabled: true,\n        params: {\n          limit: '5'\n        }\n      }\n    }\n  }\n};\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppConfigComponent } from './config.component';\n\nconst routes: Routes = [\n  {\n    path: 'config',\n    component: AppConfigComponent\n  }\n];\n\nexport const AppConfigRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\nimport { ConfigService, LanguageOptions } from '@igo2/core';\n\n@Component({\n  selector: 'app-config',\n  templateUrl: './config.component.html',\n  styleUrls: ['./config.component.scss']\n})\nexport class AppConfigComponent {\n  public configLanguage: LanguageOptions;\n\n  constructor(private configService: ConfigService) {\n    this.configLanguage = this.configService.getConfig('language');\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>config</mat-card-title>\n  <mat-card-content>\n    <p>Load config in your angular application</p>\n\n    <li>Import <code>IgoConfigModule</code> only once</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/config\"> code of this example</a> <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\n    <hr>\n  </mat-card-content>\n\n  <p>Config language: {{configLanguage | json }}<p>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoConfigModule, provideConfigOptions } from '@igo2/core';\n\nimport { environment } from '../../../environments/environment';\nimport { AppConfigComponent } from './config.component';\nimport { AppConfigRoutingModule } from './config-routing.module';\n\n@NgModule({\n  declarations: [AppConfigComponent],\n  imports: [\n    AppConfigRoutingModule,\n    CommonModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoConfigModule.forRoot()\n  ],\n  exports: [AppConfigComponent],\n  providers: [\n    provideConfigOptions({\n      default: environment.igo\n    })\n  ]\n})\nexport class AppConfigModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppLanguageComponent } from './language.component';\n\nconst routes: Routes = [\n  {\n    path: 'language',\n    component: AppLanguageComponent\n  }\n];\n\nexport const AppLanguageRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-language',\n  templateUrl: './language.component.html',\n  styleUrls: ['./language.component.scss']\n})\nexport class AppLanguageComponent {\n  public app = {\n    title: 'IGO'\n  };\n  constructor(private languageService: LanguageService) {}\n\n  changeLanguage(language: string) {\n    this.languageService.setLanguage(language);\n    console.log(this.languageService);\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>language</mat-card-title>\n  <mat-card-content>\n    <p>Translate your angular application</p>\n\n    <li>Import <code>IgoLanguageModule</code> only once</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/language\">code of this example</a><br>\n    See language section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a><br>\n    See <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/locale\">locale files</a>\n    <hr>\n  </mat-card-content>\n\n  <mat-card-actions>\n    <button mat-raised-button (click)=\"changeLanguage('en')\">English</button>\n    <button mat-raised-button (click)=\"changeLanguage('fr')\">Franais</button>\n  </mat-card-actions>\n\n  <p>{{'welcome' | translate: app}}<p>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { AppLanguageComponent } from './language.component';\nimport { AppLanguageRoutingModule } from './language-routing.module';\n\n@NgModule({\n  declarations: [AppLanguageComponent],\n  imports: [\n    AppLanguageRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoLanguageModule.forRoot()\n  ],\n  exports: [AppLanguageComponent]\n})\nexport class AppLanguageModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppMediaComponent } from './media.component';\n\nconst routes: Routes = [\n  {\n    path: 'media',\n    component: AppMediaComponent\n  }\n];\n\nexport const AppMediaRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { MediaService } from '@igo2/core';\n\n@Component({\n  selector: 'app-media',\n  templateUrl: './media.component.html',\n  styleUrls: ['./media.component.scss']\n})\nexport class AppMediaComponent {\n  constructor(private mediaService: MediaService) {}\n\n  get media() {\n    return this.mediaService.getMedia();\n  }\n\n  get orientation() {\n    return this.mediaService.getOrientation();\n  }\n\n  get isTouchScreen() {\n    return this.mediaService.isTouchScreen();\n  }\n\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>Media</mat-card-title>\n  <mat-card-content>\n    <p>Detect type of media (mobile, tablet, desktop)</p>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/media\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <p>Current media: {{media}}</p>\n  <p>Current orientation: {{orientation}}</p>\n  <p>Device mode:  {{isTouchScreen ? 'Touch device' : 'Not a touch device '}}</p>\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { AppMediaComponent } from './media.component';\nimport { AppMediaRoutingModule } from './media-routing.module';\n\n@NgModule({\n  declarations: [AppMediaComponent],\n  imports: [AppMediaRoutingModule, MatCardModule],\n  exports: [AppMediaComponent]\n})\nexport class AppMediaModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppMessageComponent } from './message.component';\n\nconst routes: Routes = [\n  {\n    path: 'message',\n    component: AppMessageComponent\n  }\n];\n\nexport const AppMessageRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { MessageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-message',\n  templateUrl: './message.component.html',\n  styleUrls: ['./message.component.scss']\n})\nexport class AppMessageComponent {\n  constructor(private messageService: MessageService) {}\n\n  success() {\n    this.messageService.success('Congratulations', 'Success');\n  }\n\n  info() {\n    this.messageService.info('Welcome to IGO', 'Info');\n  }\n\n  alert() {\n    this.messageService.alert('Warning', 'Alert');\n  }\n  error() {\n    this.messageService.error('There is a bug', 'Error');\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>Message</mat-card-title>\n  <mat-card-content>\n    <p>Show message to user.</p>\n\n    <li>Import <code>IgoMessageModule</code> only once</li>\n    <li>Dependencies: BrowserAnimationsModule </li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/message\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <mat-card-actions>\n    <button mat-raised-button (click)=\"success()\">Success message</button>\n    <button mat-raised-button color='primary' (click)=\"info()\">Info message</button>\n    <button mat-raised-button color='accent' (click)=\"alert()\">Alert message</button>\n    <button mat-raised-button color='warn' (click)=\"error()\">Error message</button>\n  </mat-card-actions>\n</mat-card>\n\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMessageModule } from '@igo2/core';\n\nimport { AppMessageComponent } from './message.component';\nimport { AppMessageRoutingModule } from './message-routing.module';\n\n@NgModule({\n  declarations: [AppMessageComponent],\n  imports: [\n    AppMessageRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMessageModule.forRoot()\n  ],\n  exports: [AppMessageComponent]\n})\nexport class AppMessageModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppRequestComponent } from './request.component';\n\nconst routes: Routes = [\n  {\n    path: 'request',\n    component: AppRequestComponent\n  }\n];\n\nexport const AppRequestRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-request',\n  templateUrl: './request.component.html',\n  styleUrls: ['./request.component.scss']\n})\nexport class AppRequestComponent {\n  constructor(\n    private http: HttpClient,\n    public languageService: LanguageService\n  ) {}\n\n  callHttp() {\n    const url = 'https://geoegl.msp.gouv.qc.ca/apis/icherche/info';\n    this.http.get(url).subscribe(rep => {\n      console.log(rep);\n    });\n  }\n\n  callHttpError() {\n    const url = '404';\n    this.http.get(url).subscribe(rep => {\n      console.log(rep);\n    });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Core</mat-card-subtitle>\n  <mat-card-title>Request</mat-card-title>\n  <mat-card-content>\n    <p>Register http calls in console</p>\n\n    <li>Import <code>IgoLoggingModule</code> only if you want register http calls in console</li>\n    <li>Import <code>IgoErrorModule</code> only if you want register errors from http call in console</li>\n    <li>Import modules only once</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/core/request\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <mat-card-actions>\n    <button mat-raised-button (click)=\"callHttp()\">Log</button>\n    <button mat-raised-button (click)=\"callHttpError()\">Error</button>\n  </mat-card-actions>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { HttpClientModule } from '@angular/common/http';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoErrorModule, IgoLanguageModule } from '@igo2/core';\n\nimport { AppRequestComponent } from './request.component';\nimport { AppRequestRoutingModule } from './request-routing.module';\n\n@NgModule({\n  declarations: [AppRequestComponent],\n  imports: [\n    AppRequestRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    HttpClientModule,\n    IgoLanguageModule.forRoot(),\n    IgoErrorModule.forRoot() // Only if you want register errors from http call in console\n    // IgoLoggingModule.forRoot() // Only if you want register http calls in console\n  ],\n  exports: [AppRequestComponent]\n})\nexport class AppRequestModule {}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Action</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/action\">code of this example</a>\n  </mat-card-content>\n\n  <igo-actionbar\n    [store]=\"store\"\n    [withIcon]=\"true\"\n    [withTitle]=\"actionbarMode === 'overlay'\"\n    [horizontal]=\"true\"\n    [mode]=\"actionbarMode\">\n  </igo-actionbar>\n\n</mat-card>\n<p></p>\n\n<mat-card [igoContextMenu]= actionbarMenu>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Action context-menu</mat-card-title>\n  <div></div>\n</mat-card>\n\n\n\n<ng-template #actionbarMenu>\n  <igo-actionbar\n    [store]=\"store\"\n    [withIcon]=\"true\"\n    [horizontal]=\"true\"\n    [mode]=\"'context'\">\n  </igo-actionbar>\n</ng-template>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppActionComponent } from './action.component';\n\nconst routes: Routes = [\n  {\n    path: 'action',\n    component: AppActionComponent\n  }\n];\n\nexport const AppActionRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport {\n  Media,\n  MediaOrientation,\n  MediaService,\n  LanguageService\n} from '@igo2/core';\nimport { ActionStore, ActionbarMode } from '@igo2/common';\nimport { Overlay } from '@angular/cdk/overlay';\n\n@Component({\n  selector: 'app-action',\n  templateUrl: './action.component.html',\n  styleUrls: ['./action.component.scss']\n})\nexport class AppActionComponent implements OnInit, OnDestroy {\n  public store = new ActionStore([]);\n\n  private added$ = new BehaviorSubject(false);\n\n  get actionbarMode(): ActionbarMode {\n    const media = this.mediaService.media$.value;\n    const orientation = this.mediaService.orientation$.value;\n    if (media === Media.Desktop && orientation === MediaOrientation.Landscape) {\n      return ActionbarMode.Dock;\n    }\n    return ActionbarMode.Overlay;\n  }\n\n  constructor(\n    public overlay: Overlay,\n    private mediaService: MediaService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    this.store.load([\n      {\n        id: 'add',\n        title: 'Add',\n        icon: 'plus',\n        tooltip: 'Add Tooltip',\n        handler: () => {\n          alert('Add!');\n          this.added$.next(true);\n        }\n      },\n      {\n        id: 'edit',\n        title: 'Edit',\n        icon: 'pencil',\n        tooltip: 'Edit Tooltip',\n        args: ['1'],\n        handler: (item: string) => {\n          alert(`Edit item ${item}!`);\n        },\n        availability: () => this.added$\n      },\n      {\n        id: 'delete',\n        title: 'Delete',\n        tooltip: 'Delete Tooltip',\n        icon: 'delete',\n        handler: () => {\n          alert('Delete!');\n          this.added$.next(false);\n        },\n        availability: () => this.added$\n      }\n    ]);\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoActionModule, IgoContextMenuModule } from '@igo2/common';\n\nimport { AppActionComponent } from './action.component';\nimport { AppActionRoutingModule } from './action-routing.module';\n\n@NgModule({\n  declarations: [AppActionComponent],\n  imports: [\n    AppActionRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoActionModule,\n    IgoContextMenuModule\n  ],\n  exports: [AppActionComponent]\n})\nexport class AppActionModule {}\n","import { Component, Input, ChangeDetectionStrategy, ChangeDetectorRef } from '@angular/core';\n\nimport { OnUpdateInputs } from '@igo2/common';\n\n@Component({\n  selector: 'app-salutation-component',\n  template: '<p>Hello, my name is {{name}}.</p>',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSalutationComponent implements OnUpdateInputs {\n\n  @Input() name: string;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n}\n\n@Component({\n  selector: 'app-explanation-component',\n  template: '<p>I am a dynamic component, rendered into an IgoDynamicOutlet.</p>',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppExplanationComponent implements OnUpdateInputs {\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n}\n\n@Component({\n  selector: 'app-dynamic-component',\n  templateUrl: './dynamic-component.component.html',\n  styleUrls: ['./dynamic-component.component.scss']\n})\nexport class AppDynamicComponentComponent {\n\n  component: any = AppSalutationComponent;\n\n  inputs = {name: 'Bob'};\n\n  toggleComponent() {\n    this.component = this.component === AppSalutationComponent ?\n      AppExplanationComponent :\n      AppSalutationComponent;\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppDynamicComponentComponent } from './dynamic-component.component';\n\nconst routes: Routes = [\n  {\n    path: 'dynamic-component',\n    component: AppDynamicComponentComponent\n  }\n];\n\nexport const AppDynamicComponentRoutingModule = RouterModule.forChild(\n  routes\n);\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Dynamic Component</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/dynamic-component\">code of this example</a>\n  </mat-card-content>\n\n  <igo-dynamic-outlet\n    [component]=\"component\"\n    [inputs]=\"inputs\">\n  </igo-dynamic-outlet>\n\n  <button mat-flat-button color=\"primary\" (click)=\"toggleComponent()\">Toggle Component</button>\n</mat-card>\n\n\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoDynamicComponentModule } from '@igo2/common';\n\nimport {\n  AppSalutationComponent,\n  AppExplanationComponent,\n  AppDynamicComponentComponent\n} from './dynamic-component.component';\nimport { AppDynamicComponentRoutingModule } from './dynamic-component-routing.module';\n\n@NgModule({\n    declarations: [\n        AppSalutationComponent,\n        AppDynamicComponentComponent,\n        AppExplanationComponent\n    ],\n    imports: [\n        AppDynamicComponentRoutingModule,\n        MatButtonModule,\n        MatCardModule,\n        IgoDynamicComponentModule\n    ],\n    exports: [AppDynamicComponentComponent]\n})\nexport class AppDynamicComponentModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppEntityTableComponent } from './entity-table.component';\n\nconst routes: Routes = [\n  {\n    path: 'entity-table',\n    component: AppEntityTableComponent\n  }\n];\n\nexport const AppEntityTableRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  EntityStore,\n  EntityTableButton,\n  getEntityProperty,\n  EntityTableColumnRenderer,\n  EntityTablePaginatorOptions\n} from '@igo2/common';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n  selector: 'app-entity-table',\n  templateUrl: './entity-table.component.html',\n  styleUrls: ['./entity-table.component.scss']\n})\nexport class AppEntityTableComponent implements OnInit, OnDestroy {\n  public store = new EntityStore([]);\n  public paginator: MatPaginator;\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public paginatorOptions: EntityTablePaginatorOptions = {pageSize: 10};\n\n  public template = {\n    selection: true,\n    selectionCheckbox: true,\n    selectMany: true,\n    sort: true,\n    valueAccessor: (entity: object, name: string) => {\n      return getEntityProperty(entity, name);\n    },\n    columns: [\n      {\n        name: 'selected',\n        title: 'Selected',\n        valueAccessor: (entity: object) => {\n          return this.store.state.get(entity).selected\n            ? 'radiobox-marked'\n            : 'radiobox-blank';\n        },\n        renderer: EntityTableColumnRenderer.Icon\n      },\n      {\n        name: 'id',\n        title: 'ID'\n      },\n      {\n        name: 'name',\n        title: 'Name'\n      },\n      {\n        name: 'description',\n        title: 'Description',\n        renderer: EntityTableColumnRenderer.HTML\n      },\n      {\n        name: 'url',\n        title: 'Hyperlink'\n      },\n      {\n        name: 'image',\n        title: 'Image'\n      },\n      {\n        name: 'action',\n        title: '',\n        valueAccessor: (entity: object) => {\n          return [{\n            icon: 'home',\n            color: 'warn',\n            click: (row) => { console.log(row); }\n          }] as EntityTableButton[];\n        },\n        renderer: EntityTableColumnRenderer.ButtonGroup\n      }\n    ]\n  };\n\n  constructor(private languageService: LanguageService) {}\n\n  ngOnInit() {\n    const ids = [2, 1, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13];\n\n    const entities = ids.map(id => {\n      if (id === 3) {\n        return { id , name: `Name ${id}`, description: `<b>Description ${id}</b>`, url: 'https://igouverte.org', image: 'https://www.igouverte.org/assets/img/NONEXISTINGIMAGE.png'};\n      }\n      return { id , name: `Name ${id}`, description: `<b>Description ${id}</b>`, url: 'https://igouverte.org', image: 'https://www.igouverte.org/assets/img/Igo_logoavec.png'};\n    });\n    this.store.load(entities);\n  }\n\n  entitySortChange() {\n    this.entitySortChange$.next(true);\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.paginator = event;\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Entity Table</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/entity-table\">code of this example</a>\n  </mat-card-content>\n  <igo-entity-table\n    [store]=\"store\"\n    [withPaginator]=\"true\"\n    [paginatorOptions]=\"paginatorOptions\"\n    [template]=\"template\"\n    (entitySortChange)=\"entitySortChange()\">\n  </igo-entity-table>\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoEntityTableModule, IgoEntityTablePaginatorModule } from '@igo2/common';\n\nimport { AppEntityTableComponent } from './entity-table.component';\nimport { AppEntityTableRoutingModule } from './entity-table-routing.module';\n\n@NgModule({\n  declarations: [AppEntityTableComponent],\n  imports: [\n    AppEntityTableRoutingModule,\n    MatCardModule,\n    IgoEntityTableModule,\n    IgoEntityTablePaginatorModule\n  ],\n  exports: [AppEntityTableComponent]\n})\nexport class AppEntityTableModule {}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Entity Selector</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/entity-selector\">code of this example</a>\n  </mat-card-content>\n\n  <igo-entity-selector\n    [store]=\"store\"\n    [titleAccessor]=\"getTitle\"\n    [emptyText]=\"''\"\n    [placeholder]=\"'Select an entity'\"\n    (selectedChange)=\"onSelectedChange($event)\">\n  </igo-entity-selector>\n\n  <div *ngIf=\"selected$ | async as selected\">\n    <p>ID: {{selected.id}}</p>\n    <p>Name: {{selected.name}}</p>\n    <p>Description: <span [innerHtml]=\"selected.description\"></span></p>\n  </div>\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppEntitySelectorComponent } from './entity-selector.component';\n\nconst routes: Routes = [\n  {\n    path: 'entity-selector',\n    component: AppEntitySelectorComponent\n  }\n];\n\nexport const AppEntitySelectorRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport { EntityStore } from '@igo2/common';\n\ninterface DemoEntity {\n  id: string;\n  name: string;\n  description: string;\n}\n\n@Component({\n  selector: 'app-entity-selector',\n  templateUrl: './entity-selector.component.html',\n  styleUrls: ['./entity-selector.component.scss']\n})\nexport class AppEntitySelectorComponent implements OnInit, OnDestroy {\n\n  public store = new EntityStore([]);\n\n  public selected$ = new BehaviorSubject<DemoEntity>(undefined);\n\n  constructor(private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.store.load([\n      {id: '2', name: 'Name 2', description: '<b>Description 2</b>'},\n      {id: '1', name: 'Name 1', description: '<b>Description 1</b>'},\n      {id: '3', name: 'Name 3', description: '<b>Description 3</b>'}\n    ]);\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  getTitle(entity: DemoEntity): string {\n    return entity.name;\n  }\n\n  onSelectedChange(event: {selected: boolean; entity: DemoEntity}) {\n    this.selected$.next(event.entity);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoEntitySelectorModule } from '@igo2/common';\n\nimport { AppEntitySelectorComponent } from './entity-selector.component';\nimport { AppEntitySelectorRoutingModule } from './entity-selector-routing.module';\n\n@NgModule({\n  declarations: [AppEntitySelectorComponent],\n  imports: [\n    CommonModule,\n    AppEntitySelectorRoutingModule,\n    MatCardModule,\n    IgoEntitySelectorModule\n  ],\n  exports: [AppEntitySelectorComponent]\n})\nexport class AppEntitySelectorModule {}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Form</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/form\">code of this example</a>\n  </mat-card-content>\n\n  <igo-form\n    *ngIf=\"form$ | async as form\"\n    [form]=\"form\"\n    [formData]=\"data$ | async\"\n    (submitForm)=\"onSubmit($event)\">\n\n    <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n    <div formButtons>\n      <button\n        mat-stroked-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"fillForm()\">\n        Fill Form\n      </button>\n      <button\n        mat-stroked-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"clearForm()\">\n        Clear Form\n      </button>\n      <button\n        mat-flat-button\n        type=\"submit\"\n        color=\"primary\"\n        [disabled]=\"submitDisabled\">\n        Submit\n      </button>\n    </div>\n  </igo-form>\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppFormComponent } from './form.component';\n\nconst routes: Routes = [\n  {\n    path: 'form',\n    component: AppFormComponent\n  }\n];\n\nexport const AppFormRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport { Form, FormService } from '@igo2/common';\n\n@Component({\n  selector: 'app-form',\n  templateUrl: './form.component.html',\n  styleUrls: ['./form.component.scss']\n})\nexport class AppFormComponent implements OnInit, OnDestroy {\n\n  form$ = new BehaviorSubject<Form>(undefined);\n\n  data$ = new BehaviorSubject<{[key: string]: any}>(undefined);\n\n  submitDisabled = true;\n\n  private valueChanges$$: Subscription;\n\n  constructor(\n    private formService: FormService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    const fieldConfigs = [\n      {\n        name: 'id',\n        title: 'ID',\n        options: {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        options: {\n          cols: 1,\n          validator: Validators.required\n        }\n      },\n      {\n        name: 'status',\n        title: 'Status',\n        type: 'select',\n        options: {\n          cols: 2\n        },\n        inputs: {\n          choices: [\n            {value: 1, title: 'Single'},\n            {value: 2, title: 'Married'}\n          ]\n        }\n      }\n    ];\n\n    const fields = fieldConfigs.map((config) => this.formService.field(config));\n    const form = this.formService.form([], [this.formService.group({name: 'info'}, fields)]);\n\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\n      this.submitDisabled = !form.control.valid;\n    });\n\n    this.form$.next(form);\n  }\n\n  ngOnDestroy() {\n    this.valueChanges$$.unsubscribe();\n  }\n\n  fillForm() {\n    this.data$.next({\n      id: 1,\n      name: 'Bob',\n      status: 2\n    });\n  }\n\n  clearForm() {\n    this.form$.value.control.reset();\n  }\n\n  onSubmit(data: {[key: string]: any}) {\n    alert(JSON.stringify(data));\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoFormModule } from '@igo2/common';\n\nimport { AppFormComponent } from './form.component';\nimport { AppFormRoutingModule } from './form-routing.module';\n\n@NgModule({\n  declarations: [AppFormComponent],\n  imports: [\n    CommonModule,\n    AppFormRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoFormModule\n  ],\n  exports: [AppFormComponent]\n})\nexport class AppFormModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppTableComponent } from './table.component';\n\nconst routes: Routes = [\n  {\n    path: 'table',\n    component: AppTableComponent\n  }\n];\n\nexport const AppTableRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { TableDatabase, TableActionColor } from '@igo2/common';\n\n@Component({\n  selector: 'app-table',\n  templateUrl: './table.component.html',\n  styleUrls: ['./table.component.scss']\n})\nexport class AppTableComponent implements OnInit {\n  public database: TableDatabase;\n\n  public model = {\n    columns: [\n      {\n        name: 'id',\n        title: 'ID',\n        sortable: false,\n        filterable: true\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        sortable: true,\n        filterable: true\n      },\n      {\n        name: 'description',\n        title: 'Description',\n        sortable: true,\n        filterable: true\n      }\n    ],\n    actions: [\n      {\n        icon: 'file-document',\n        color: TableActionColor.primary,\n        click: row => this.showName(row.name)\n      }\n    ],\n    selectionCheckbox: true\n  };\n\n  constructor(private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.database = new TableDatabase([\n      { id: '2', name: 'Name 2', description: 'Hello 2' },\n      { id: '1', name: 'Name 1', description: 'Bonjour 1' },\n      { id: '3', name: 'Name 3', description: 'Hola 3' }\n    ]);\n  }\n\n  showName(name) {\n    alert(name);\n  }\n\n  handleSelect(rows) {\n    console.log(rows);\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Table</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/table\">code of this example</a>\n  </mat-card-content>\n\n  <igo-table\n    [database]=\"database\"\n    [model]=\"model\"\n    [hasFilterInput]=\"true\"\n    (select)=\"handleSelect($event)\">\n  </igo-table>\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoTableModule } from '@igo2/common';\n\nimport { AppTableComponent } from './table.component';\nimport { AppTableRoutingModule } from './table-routing.module';\n\n@NgModule({\n  declarations: [AppTableComponent],\n  imports: [\n    AppTableRoutingModule,\n    MatCardModule,\n    IgoTableModule\n  ],\n  exports: [AppTableComponent]\n})\nexport class AppTableModule {}\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Tool</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/tool\">code of this example</a>\n  </mat-card-content>\n\n  <igo-panel [title]=\"panelTitle\">\n    <button\n      mat-icon-button\n      panelLeftButton\n      (click)=\"toolbox.activatePreviousTool()\"\n      *ngIf=\"activeTool$ | async\">\n      <mat-icon svgIcon=\"arrow-back\"></mat-icon>\n    </button>\n\n    <button\n      mat-icon-button\n      panelRightButton\n      (click)=\"toolbox.deactivateTool()\"\n      *ngIf=\"activeTool$ | async\">\n      <mat-icon svgIcon=\"menu\"></mat-icon>\n    </button>\n\n    <igo-toolbox [toolbox]=\"toolbox\" [animate]=\"true\"></igo-toolbox>\n  </igo-panel>\n\n  <button\n    mat-flat-button\n    type=\"button\"\n    color=\"primary\"\n    (click)=\"activateSalutationTool()\">\n    Activate Salutation Tool\n  </button>\n\n</mat-card>\n","import {\n  Component,\n  OnInit,\n  OnDestroy,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  OnUpdateInputs,\n  Tool,\n  Toolbox,\n  ToolComponent,\n  ToolService\n} from '@igo2/common';\n\n@ToolComponent({\n  name: 'demo-salutation',\n  title: 'Salutation',\n  icon: 'account',\n  options: {name: 'Jack'}\n})\n@Component({\n  selector: 'app-salutation-tool',\n  template: `\n    <p>Hello, my name is {{name}}.</p>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSalutationToolComponent implements OnUpdateInputs {\n\n  @Input() name: string;\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n}\n\n@ToolComponent({\n  name: 'demo-about',\n  title: 'About',\n  icon: 'information'\n})\n@Component({\n  selector: 'app-about-tool',\n  template: `\n    <p>I'm a tool inside a toolbox.</p>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppAboutToolComponent {}\n\n@Component({\n  selector: 'app-tool',\n  templateUrl: './tool.component.html',\n  styleUrls: ['./tool.component.scss']\n})\nexport class AppToolComponent implements OnInit, OnDestroy {\n\n  toolbox = new Toolbox();\n\n  get activeTool$(): BehaviorSubject<Tool> {\n    return this.toolbox.activeTool$;\n  }\n\n  get panelTitle(): string {\n    return this.activeTool$.value ? this.activeTool$.value.title : 'Toolbox';\n  }\n\n  constructor(\n    private toolService: ToolService,\n    private languageService: LanguageService\n  ) {}\n\n  ngOnInit() {\n    this.toolbox.setToolbar(['demo-salutation', 'demo-about']);\n    this.toolbox.setTools(this.toolService.getTools());\n  }\n\n  ngOnDestroy() {\n    this.toolbox.destroy();\n  }\n\n  activateSalutationTool() {\n    this.toolbox.activateTool('demo-salutation', {name: 'Bob'});\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppToolComponent } from './tool.component';\n\nconst routes: Routes = [\n  {\n    path: 'tool',\n    component: AppToolComponent\n  }\n];\n\nexport const AppToolRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoPanelModule, IgoToolModule } from '@igo2/common';\n\nimport {\n  AppToolComponent,\n  AppSalutationToolComponent,\n  AppAboutToolComponent\n} from './tool.component';\nimport { AppToolRoutingModule } from './tool-routing.module';\n\n@NgModule({\n    declarations: [\n        AppToolComponent,\n        AppSalutationToolComponent,\n        AppAboutToolComponent\n    ],\n    imports: [\n        CommonModule,\n        AppToolRoutingModule,\n        MatButtonModule,\n        MatIconModule,\n        MatCardModule,\n        IgoLanguageModule,\n        IgoPanelModule,\n        IgoToolModule.forRoot()\n    ],\n    exports: [AppToolComponent]\n})\nexport class AppToolModule {}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { DynamicComponent, OnUpdateInputs, WidgetComponent, WidgetService } from '@igo2/common';\n\n@Component({\n  selector: 'app-salutation-widget',\n  template: `\n    <p>Hello, my name is {{name}}.</p>\n    <button mat-flat-button (click)=\"complete.emit(name)\">Nice to meet you</button>\n    <button mat-flat-button (click)=\"cancel.emit(name)\">Dismiss</button>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSalutationWidgetComponent implements OnUpdateInputs, WidgetComponent {\n\n  @Input() name: string;\n\n  @Output() complete = new EventEmitter<string>();\n\n  @Output() cancel = new EventEmitter<string>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n}\n\n@Component({\n  selector: 'app-widget',\n  templateUrl: './widget.component.html',\n  styleUrls: ['./widget.component.scss']\n})\nexport class AppWidgetComponent {\n\n  widget: DynamicComponent<WidgetComponent> = this.widgetService.create(AppSalutationWidgetComponent);\n\n  inputs = {name: 'Bob'};\n\n  constructor(private widgetService: WidgetService) {}\n\n  onWidgetComplete(name: string) {\n    alert(`${name} emitted event 'complete' then got automatically destroyed.`);\n  }\n\n  onWidgetCancel() {\n    alert(`Widget emitted event 'cancel' then got automatically destroyed.`);\n  }\n\n}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppWidgetComponent } from './widget.component';\n\nconst routes: Routes = [\n  {\n    path: 'widget',\n    component: AppWidgetComponent\n  }\n];\n\nexport const AppWidgetRoutingModule = RouterModule.forChild(\n  routes\n);\n","<mat-card>\n  <mat-card-subtitle>Common</mat-card-subtitle>\n  <mat-card-title>Widget</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/widget\">code of this example</a>\n  </mat-card-content>\n\n  <igo-widget-outlet\n    [widget]=\"widget\"\n    [inputs]=\"inputs\"\n    (complete)=\"onWidgetComplete($event)\"\n    (cancel)=\"onWidgetCancel()\">\n  </igo-widget-outlet>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoWidgetModule } from '@igo2/common';\n\nimport {\n  AppSalutationWidgetComponent,\n  AppWidgetComponent\n} from './widget.component';\nimport { AppWidgetRoutingModule } from './widget-routing.module';\n\n@NgModule({\n    declarations: [\n        AppSalutationWidgetComponent,\n        AppWidgetComponent\n    ],\n    imports: [\n        AppWidgetRoutingModule,\n        MatButtonModule,\n        MatCardModule,\n        IgoWidgetModule\n    ],\n    exports: [AppWidgetComponent]\n})\nexport class AppWidgetModule {}\n","import { Injectable, Injector } from '@angular/core';\nimport jwtDecode from 'jwt-decode';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthOptions } from './auth.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TokenService {\n  private options: AuthOptions;\n\n  constructor(private injector: Injector) {}\n\n  set(token: string) {\n    localStorage.setItem(this.tokenKey, token);\n  }\n\n  remove() {\n    localStorage.removeItem(this.tokenKey);\n  }\n\n  get(): string {\n    return localStorage.getItem(this.tokenKey);\n  }\n\n  decode() {\n    const token = this.get();\n    if (!token) {\n      return;\n    }\n    return jwtDecode(token);\n  }\n\n  isExpired() {\n    const jwt = this.decode();\n    const currentTime = new Date().getTime() / 1000;\n    if (jwt && currentTime < jwt.exp) {\n      return false;\n    }\n    return true;\n  }\n\n  private get tokenKey() {\n    const config = this.injector.get<ConfigService>(ConfigService);\n    this.options = config.getConfig('auth') || {};\n    return this.options.tokenKey;\n  }\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Router } from '@angular/router';\n\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport { tap, catchError } from 'rxjs/operators';\nimport { globalCacheBusterNotifier } from 'ts-cacheable';\n\nimport { ConfigService, LanguageService, MessageService } from '@igo2/core';\nimport { Base64 } from '@igo2/utils';\n\nimport { User, IInfosUser } from './auth.interface';\nimport { TokenService } from './token.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  public authenticate$ = new BehaviorSubject<boolean>(undefined);\n  public logged$ = new BehaviorSubject<boolean>(undefined);\n  public redirectUrl: string;\n  public languageForce = false;\n  private anonymous = false;\n\n  get hasAuthService() {\n    return this.config.getConfig('auth.url') !== undefined;\n  }\n\n  constructor(\n    private http: HttpClient,\n    private tokenService: TokenService,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    @Optional() private router: Router\n  ) {\n    this.authenticate$.next(this.authenticated);\n    this.authenticate$.subscribe((authenticated) => {\n      this.logged$.next(authenticated);\n      globalCacheBusterNotifier.next();\n    });\n  }\n\n  login(username: string, password: string): Observable<void> {\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\n\n    const body = {\n      username,\n      password: this.encodePassword(password)\n    };\n\n    return this.loginCall(body, myHeader);\n  }\n\n  loginWithToken(token: string, type: string, infosUser?: IInfosUser): Observable<void> {\n    const myHeader = new HttpHeaders({ 'Content-Type': 'application/json' });\n\n    const body = {\n      token,\n      typeConnection: type,\n      infosUser\n    };\n\n    return this.loginCall(body, myHeader);\n  }\n\n  loginAnonymous(): Observable<boolean> {\n    this.anonymous = true;\n    this.logged$.next(true);\n    return of(true);\n  }\n\n  refresh(): Observable<void> {\n    const url = this.config.getConfig('auth.url');\n    return this.http.post(`${url}/refresh`, {}).pipe(\n      tap((data: any) => {\n        this.tokenService.set(data.token);\n      }),\n      catchError((err) => {\n        err.error.caught = true;\n        throw err;\n      })\n    );\n  }\n\n  logout(): Observable<boolean> {\n    this.anonymous = false;\n    this.tokenService.remove();\n    this.authenticate$.next(false);\n    return of(true);\n  }\n\n  isAuthenticated(): boolean {\n    return !this.tokenService.isExpired();\n  }\n\n  getToken(): string {\n    return this.tokenService.get();\n  }\n\n  decodeToken() {\n    if (this.isAuthenticated()) {\n      return this.tokenService.decode();\n    }\n    return false;\n  }\n\n  goToRedirectUrl() {\n    if (!this.router) {\n      return;\n    }\n    const redirectUrl = this.redirectUrl || this.router.url;\n\n    const options = this.config.getConfig('auth') || {};\n    if (redirectUrl === options.loginRoute) {\n      const homeRoute = options.homeRoute || '/';\n      this.router.navigateByUrl(homeRoute);\n    } else if (redirectUrl) {\n      this.router.navigateByUrl(redirectUrl);\n    }\n  }\n\n  getUserInfo(): Observable<User> {\n    const url = this.config.getConfig('auth.url') + '/info';\n    return this.http.get<User>(url);\n  }\n\n  getProfils(): Observable<{ profils: string[] }> {\n    const url = this.config.getConfig('auth.url');\n    return this.http.get<{ profils: string[] }>(`${url}/profils`);\n  }\n\n  updateUser(user: User): Observable<User> {\n    const url = this.config.getConfig('auth.url');\n    return this.http.patch<User>(url, user);\n  }\n\n  private encodePassword(password: string) {\n    return Base64.encode(password);\n  }\n\n  // authenticated or anonymous\n  get logged(): boolean {\n    return this.authenticated || this.isAnonymous;\n  }\n\n  get isAnonymous(): boolean {\n    return this.anonymous;\n  }\n\n  get authenticated(): boolean {\n    return this.isAuthenticated();\n  }\n\n  get isAdmin(): boolean {\n    const token = this.decodeToken();\n    if (token && token.user && token.user.isAdmin) {\n      return true;\n    }\n    return false;\n  }\n\n  private loginCall(body, headers) {\n    const url = this.config.getConfig('auth.url');\n    return this.http.post(`${url}/login`, body, { headers }).pipe(\n      tap((data: any) => {\n        this.tokenService.set(data.token);\n        const tokenDecoded = this.decodeToken();\n        if (tokenDecoded && tokenDecoded.user) {\n          if (tokenDecoded.user.locale && !this.languageForce) {\n            this.languageService.setLanguage(tokenDecoded.user.locale);\n          }\n          if (tokenDecoded.user.isExpired) {\n            this.languageService.translate\n              .get('igo.auth.error.Password expired')\n              .subscribe((expiredAlert) =>\n                this.messageService.alert(expiredAlert)\n              );\n          }\n        }\n        this.authenticate$.next(true);\n      }),\n      catchError((err) => {\n        err.error.caught = true;\n        throw err;\n      })\n    );\n  }\n}\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter\n} from '@angular/core';\n\nimport { ConfigService, LanguageService } from '@igo2/core';\nimport { AuthGoogleOptions } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\n\n@Component({\n  selector: 'igo-auth-google',\n  templateUrl: './auth-google.component.html',\n  styleUrls: ['./auth-google.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthGoogleComponent {\n  private options: AuthGoogleOptions;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private appRef: ApplicationRef\n  ) {\n    this.options = this.config.getConfig('auth.google') || {};\n\n    if (this.options.apiKey && this.options.clientId) {\n      this.loadSDKGoogle();\n      this.loadPlatform();\n    } else {\n      console.warn('Google authentification needs \"apiKey\" and \"clientId\" options');\n    }\n  }\n\n  public handleSignInClick() {\n    (window as any).gapi.auth2.getAuthInstance().signIn();\n  }\n\n  public handleSignOutClick() {\n    (window as any).gapi.auth2.getAuthInstance().signOut();\n  }\n\n  private handleClientLoad() {\n    (window as any).gapi.load('client:auth2', () => this.initClient());\n  }\n\n  private initClient() {\n    (window as any).gapi.client\n      .init({\n        apiKey: this.options.apiKey,\n        clientId: this.options.clientId,\n        discoveryDocs: [\n          'https://people.googleapis.com/$discovery/rest?version=v1'\n        ],\n        scope: 'profile'\n      })\n      .then(() => {\n        this.handleSignOutClick();\n        this.updateTextButton();\n        (window as any).gapi.auth2.getAuthInstance().isSignedIn.listen(rep => {\n          this.updateSigninStatus(rep);\n        });\n      });\n  }\n\n  private updateSigninStatus(isSignedIn) {\n    this.updateTextButton();\n    if (isSignedIn) {\n      this.loginGoogle((window as any).gapi.client.getToken().access_token);\n    }\n  }\n\n  private updateTextButton() {\n    const btn = document.querySelector('span[id^=\"not_signed_\"]');\n    if (btn && this.languageService.getLanguage() !== 'en') {\n      if (btn.innerHTML === 'Sign in with Google') {\n        btn.innerHTML = this.languageService.translate.instant('igo.auth.google.login');\n      } else if (btn.innerHTML === 'Signed in with Google') {\n        btn.innerHTML = this.languageService.translate.instant('igo.auth.google.logged');\n      }\n    }\n  }\n\n  private loginGoogle(token) {\n    this.authService.loginWithToken(token, 'google').subscribe(() => {\n      this.appRef.tick();\n      this.login.emit(true);\n    });\n  }\n\n  private loadSDKGoogle() {\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'google-jssdk';\n    js.src = 'https://apis.google.com/js/api.js';\n    js.onload = () => {\n      this.handleClientLoad();\n    };\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n\n  private loadPlatform() {\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'google-platform';\n    js.src = 'https://apis.google.com/js/platform.js';\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n}\n","<div class=\"g-signin2 google-login-button\" data-height=\"40\" data-width=\"265\" data-longtitle=\"true\">\n","<form [formGroup]=\"form\" role=\"form\" (ngSubmit)=\"loginUser(form.value)\">\n  <div>\n    <mat-form-field class=\"full-width\">\n      <input matInput required placeholder=\"{{'igo.auth.user' | translate}}\" formControlName=\"username\">\n    </mat-form-field>\n  </div>\n\n  <div>\n    <mat-form-field class=\"full-width\">\n      <input matInput required type=\"password\" placeholder=\"{{'igo.auth.password' | translate}}\" formControlName=\"password\">\n    </mat-form-field>\n  </div>\n\n  <button mat-raised-button type=\"submit\">{{'igo.auth.login' | translate}}</button>\n  <button *ngIf=\"allowAnonymous\" mat-raised-button class=\"anonymous\" type=\"button\" [disabled]=\"loading\" (click)=\"loginAnonymous()\">\n    {{'igo.auth.accessAnonymous' | translate }}\n  </button>\n  <div *ngIf=\"error\">\n    <br/>\n    <font size=\"3\" color=\"red\">{{error}}</font>\n  </div>\n</form>\n\n<!--\nThis part was removed from the below line to fix Angular issue 30616 : [disabled]=\"!form.valid || loading\n  <button mat-raised-button type=\"submit\" [disabled]=\"!form.valid || loading\">{{'igo.auth.login' | translate}}</button>*/\n-->\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  Input,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Validators, UntypedFormGroup, UntypedFormBuilder } from '@angular/forms';\n\nimport { AuthService } from '../shared/auth.service';\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'igo-auth-intern',\n  templateUrl: './auth-intern.component.html',\n  styleUrls: ['./auth-intern.component.scss'],\n  changeDetection: ChangeDetectionStrategy.Default\n})\nexport class AuthInternComponent {\n  @Input()\n  get allowAnonymous(): boolean {\n    return this._allowAnonymous;\n  }\n  set allowAnonymous(value: boolean) {\n    this._allowAnonymous = value;\n  }\n  private _allowAnonymous = true;\n\n  public error = '';\n  public form: UntypedFormGroup;\n  public loading = false;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    public auth: AuthService,\n    private languageService: LanguageService,\n    fb: UntypedFormBuilder\n  ) {\n    this.form = fb.group({\n      username: ['', Validators.required],\n      password: ['', Validators.required]\n    });\n  }\n\n  loginUser(values: any) {\n    this.loading = true;\n    this.auth.login(values.username, values.password).subscribe(\n      () => {\n        this.login.emit(true);\n        this.loading = false;\n      },\n      (error: any) => {\n        try {\n          this.languageService.translate\n            .get('igo.auth.error.' + error.error.message)\n            .subscribe(errorMsg => (this.error = errorMsg));\n        } catch (e) {\n          this.error = error.error.message;\n        }\n        this.loading = false;\n      }\n    );\n    return false;\n  }\n\n  loginAnonymous() {\n    this.auth.loginAnonymous().subscribe(() => {\n      this.login.emit(true);\n    });\n  }\n}\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter\n} from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthFacebookOptions } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\n\n@Component({\n  selector: 'igo-auth-facebook',\n  templateUrl: './auth-facebook.component.html',\n  styleUrls: ['./auth-facebook.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthFacebookComponent {\n  private options: AuthFacebookOptions;\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef\n  ) {\n    this.options = this.config.getConfig('auth.facebook') || {};\n\n    if (this.options.appId) {\n      this.loadSDKFacebook();\n    } else {\n      console.warn('Facebook authentification needs \"appId\" option');\n    }\n  }\n\n  private subscribeEvents() {\n    (window as any).FB.Event.subscribe('auth.statusChange', rep => {\n      this.statusChangeCallback(rep);\n    });\n  }\n\n  private statusChangeCallback(response) {\n    if (response.status === 'connected') {\n      const accessToken = response.authResponse.accessToken;\n      this.loginFacebook(accessToken);\n    }\n  }\n\n  private loginFacebook(token) {\n    this.authService.loginWithToken(token, 'facebook').subscribe(() => {\n      this.appRef.tick();\n      this.login.emit(true);\n    });\n  }\n\n  private loadSDKFacebook() {\n    if (document.getElementById('facebook-jssdk')) {\n      return;\n    }\n\n    const urlSDK =\n      'https://connect.facebook.net/fr_CA/sdk.js#xfbml=1&version=v2.9';\n\n    const fjs = document.getElementsByTagName('script')[0];\n    const js = document.createElement('script');\n    js.id = 'facebook-jssdk';\n    js.src = `${urlSDK}&appId=${this.options.appId}`;\n    js.onload = () => {\n      this.subscribeEvents();\n    };\n    fjs.parentNode.insertBefore(js, fjs);\n  }\n}\n","<div scope=\"public_profile,email\"\n     class=\"fb-login-button\" data-max-rows=\"1\" data-size=\"large\"\n     data-button-type=\"login_with\" data-show-faces=\"false\"\n     data-auto-logout-link=\"false\" data-use-continue-as=\"false\">\n</div>\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter,\n  Inject\n} from '@angular/core';\nimport { MsalBroadcastService, MsalService, MSAL_GUARD_CONFIG} from '@azure/msal-angular';\nimport {\n  InteractionStatus,\n  AuthenticationResult,\n  PublicClientApplication,\n  PopupRequest,\n  SilentRequest,\n  InteractionRequiredAuthError\n} from '@azure/msal-browser';\nimport { ConfigService } from '@igo2/core';\nimport { AuthMicrosoftOptions, MSPMsalGuardConfiguration } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\nimport { filter, takeUntil } from 'rxjs/operators';\nimport { Subject } from 'rxjs';\n\n@Component({\n  selector: 'igo-auth-microsoft',\n  templateUrl: './auth-microsoft.component.html',\n  styleUrls: ['./auth-microsoft.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthMicrosoftComponent {\n  private options: AuthMicrosoftOptions;\n  private readonly _destroying$ = new Subject<void>();\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n  private broadcastService: MsalBroadcastService;\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef,\n    private msalService: MsalService,\n    @Inject(MSAL_GUARD_CONFIG) private msalGuardConfig: MSPMsalGuardConfiguration[],\n  ) {\n    this.options = this.config.getConfig('auth.microsoft') || {};\n\n    this.msalService.instance = new PublicClientApplication({\n      auth: this.options,\n      cache: {\n        cacheLocation: 'sessionStorage'\n      }\n    });\n\n    this.broadcastService = new MsalBroadcastService(this.msalService.instance, this.msalService);\n\n    if (this.options.clientId) {\n      this.broadcastService.inProgress$\n      .pipe(\n        filter((status: InteractionStatus) => status === InteractionStatus.None),\n        takeUntil(this._destroying$)\n      )\n      .subscribe(() => {\n        this.checkAccount();\n      });\n\n    } else {\n      console.warn('Microsoft authentification needs \"clientId\" option');\n    }\n  }\n\n  public loginMicrosoft() {\n    this.msalService.loginPopup({...this.getConf().authRequest} as PopupRequest)\n    .subscribe((response: AuthenticationResult) => {\n      this.msalService.instance.setActiveAccount(response.account);\n      this.checkAccount();\n    });\n  }\n\n  private checkAccount() {\n    this.msalService.instance\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\n      .then((response: AuthenticationResult) => {\n        const tokenAccess = response.accessToken;\n        const tokenId = response.idToken;\n        this.authService.loginWithToken(tokenAccess, 'microsoft', { tokenId } ).subscribe(() => {\n          this.appRef.tick();\n          this.login.emit(true);\n        });\n      })\n      .catch(async (error) => {\n        if (error instanceof InteractionRequiredAuthError) {\n          // fallback to interaction when silent call fails\n          return this.msalService.acquireTokenPopup(this.getConf().authRequest as SilentRequest);\n        }\n        console.log(error);\n      }).catch(error => {\n        console.log('Silent token fails');\n      });\n  }\n\n  private getConf(): MSPMsalGuardConfiguration {\n    return this.msalGuardConfig.filter(conf => conf.type === 'add')[0];\n  }\n}\n","<button class=\"microsoft-login-button\" mat-raised-button (click)=\"loginMicrosoft()\">\n  <mat-icon svgIcon=\"microsoft\"></mat-icon>\n  {{'igo.auth.microsoft.login' | translate}}\n</button>\n","/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { Inject, Injectable } from '@angular/core';\nimport { Location } from '@angular/common';\nimport {\n    IPublicClientApplication,\n    EndSessionRequest,\n    EndSessionPopupRequest,\n    AuthenticationResult,\n    RedirectRequest,\n    SilentRequest,\n    PopupRequest,\n    SsoSilentRequest,\n    Logger,\n    WrapperSKU\n} from '@azure/msal-browser';\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\nimport { Observable, from } from 'rxjs';\nimport { IMsalService } from '@azure/msal-angular';\n\n@Injectable()\nexport class MsalServiceb2c implements IMsalService {\n    private redirectHash: string;\n    private logger: Logger;\n    private name = '@azure/msal-angular';\n    private version = '2.0.0-beta.2';\n    constructor(\n        @Inject(MSAL_INSTANCE) public instance: IPublicClientApplication,\n        private location: Location\n    ) {\n        const hash = this.location.path(true).split('#').pop();\n        if (hash) {\n            this.redirectHash = `#${hash}`;\n        }\n        this.instance.initializeWrapperLibrary(WrapperSKU.Angular, this.version);\n    }\n\n    initialize(): Observable<void> {\n        return from(this.instance.initialize());\n    }\n\n    acquireTokenPopup(request: PopupRequest): Observable<AuthenticationResult> {\n        return from(this.instance.acquireTokenPopup(request));\n    }\n    acquireTokenRedirect(request: RedirectRequest): Observable<void> {\n        return from(this.instance.acquireTokenRedirect(request));\n    }\n    acquireTokenSilent(silentRequest: SilentRequest): Observable<AuthenticationResult> {\n        return from(this.instance.acquireTokenSilent(silentRequest));\n    }\n    handleRedirectObservable(hash?: string): Observable<AuthenticationResult> {\n        return from(this.instance.handleRedirectPromise(hash || this.redirectHash));\n    }\n    loginPopup(request?: PopupRequest): Observable<AuthenticationResult> {\n        return from(this.instance.loginPopup(request));\n    }\n    loginRedirect(request?: RedirectRequest): Observable<void> {\n        return from(this.instance.loginRedirect(request));\n    }\n    logout(logoutRequest?: EndSessionRequest): Observable<void> {\n        return from(this.instance.logout(logoutRequest));\n    }\n    logoutRedirect(logoutRequest?: EndSessionRequest): Observable<void> {\n        return from(this.instance.logoutRedirect(logoutRequest));\n    }\n    logoutPopup(logoutRequest?: EndSessionPopupRequest): Observable<void> {\n        return from(this.instance.logoutPopup(logoutRequest));\n    }\n    ssoSilent(request: SsoSilentRequest): Observable<AuthenticationResult> {\n        return from(this.instance.ssoSilent(request));\n    }\n    /**\n     * Gets logger for msal-angular.\n     * If no logger set, returns logger instance created with same options as msal-browser\n     */\n    getLogger(): Logger {\n        if (!this.logger) {\n            this.logger = this.instance.getLogger().clone(this.name, this.version);\n        }\n        return this.logger;\n    }\n    // Create a logger instance for msal-angular with the same options as msal-browser\n    setLogger(logger: Logger): void {\n        this.logger = logger.clone(this.name, this.version);\n        this.instance.setLogger(logger);\n    }\n\n}\n","/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { Inject, Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable, Subject } from 'rxjs';\nimport { MSAL_INSTANCE } from '@azure/msal-angular';\nimport { EventMessage, EventMessageUtils, IPublicClientApplication, InteractionStatus } from '@azure/msal-browser';\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service.';\n\n@Injectable()\nexport class MsalBroadcastServiceb2c {\n    private _msalSubject: Subject<EventMessage>;\n    public msalSubject$: Observable<EventMessage>;\n    private _inProgress: BehaviorSubject<InteractionStatus>;\n    public inProgress$: Observable<InteractionStatus>;\n\n    constructor(\n        @Inject(MSAL_INSTANCE) private msalInstance: IPublicClientApplication,\n        private authService: MsalServiceb2c\n    ) {\n        this._msalSubject = new Subject<EventMessage>();\n        this.msalSubject$ = this._msalSubject.asObservable();\n\n        // InProgress as BehaviorSubject so most recent inProgress state will be available upon subscription\n        this._inProgress = new BehaviorSubject<InteractionStatus>(InteractionStatus.Startup);\n        this.inProgress$ = this._inProgress.asObservable();\n\n        this.msalInstance.addEventCallback((message: EventMessage) => {\n            this._msalSubject.next(message);\n            const status = EventMessageUtils.getInteractionStatusFromEvent(message);\n            if (status !== null) {\n                this.authService.getLogger().verbose(`BroadcastService - ${message.eventType} results in setting inProgress to ${status}`);\n                this._inProgress.next(status);\n            }\n        });\n    }\n}\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  ApplicationRef,\n  Output,\n  EventEmitter,\n  Inject\n} from '@angular/core';\n\nimport { MSAL_GUARD_CONFIG } from '@azure/msal-angular';\nimport {\n  InteractionStatus,\n  AuthenticationResult,\n  PublicClientApplication,\n  PopupRequest,\n  SilentRequest,\n  InteractionRequiredAuthError\n} from '@azure/msal-browser';\nimport { ConfigService } from '@igo2/core';\nimport { AuthMicrosoftb2cOptions, MSPMsalGuardConfiguration } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\nimport { filter, takeUntil } from 'rxjs/operators';\nimport { Subject } from 'rxjs';\nimport { MsalBroadcastServiceb2c } from '../shared/auth-msalBroadcastServiceb2c.service';\nimport { MsalServiceb2c } from '../shared/auth-msalServiceb2c.service.';\n\n@Component({\n  selector: 'igo-auth-microsoftb2c',\n  templateUrl: './auth-microsoftb2c.component.html',\n  styleUrls: ['./auth-microsoftb2c.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AuthMicrosoftb2cComponent {\n  private options: AuthMicrosoftb2cOptions;\n  private readonly _destroying$ = new Subject<void>();\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n  private broadcastService: MsalBroadcastServiceb2c;\n\n  constructor(\n    private authService: AuthService,\n    private config: ConfigService,\n    private appRef: ApplicationRef,\n    private msalService: MsalServiceb2c,\n    @Inject(MSAL_GUARD_CONFIG) private msalGuardConfig: MSPMsalGuardConfiguration[],\n  ) {\n\n    this.options = this.config.getConfig('auth.microsoftb2c') || {};\n\n    this.msalService.instance = new PublicClientApplication({\n      auth: this.options.browserAuthOptions,\n      cache: {\n        cacheLocation: 'sessionStorage'\n      }\n    });\n\n    this.broadcastService = new MsalBroadcastServiceb2c(this.msalService.instance, this.msalService);\n\n    if (this.options.browserAuthOptions.clientId) {\n      this.broadcastService.inProgress$\n      .pipe(\n        filter((status: InteractionStatus) => status === InteractionStatus.None),\n        takeUntil(this._destroying$)\n      )\n      .subscribe(() => {\n        this.checkAccount();\n      });\n\n    } else {\n      console.warn('Microsoft authentification needs \"clientId\" option');\n    }\n  }\n\n  public loginMicrosoftb2c() {\n    this.msalService.loginPopup({...this.getConf().authRequest} as PopupRequest)\n    .subscribe((response: AuthenticationResult) => {\n      this.msalService.instance.setActiveAccount(response.account);\n      this.checkAccount();\n    });\n  }\n\n  private checkAccount() {\n    this.msalService.instance\n      .acquireTokenSilent(this.getConf().authRequest as SilentRequest)\n      .then((response: AuthenticationResult) => {\n        const token = response.idToken;\n        this.authService.loginWithToken(token, 'microsoftb2c').subscribe(() => {\n          this.appRef.tick();\n          this.login.emit(true);\n        });\n      })\n      .catch(async (error) => {\n        if (error instanceof InteractionRequiredAuthError) {\n          // fallback to interaction when silent call fails\n          return this.msalService.acquireTokenPopup(this.getConf().authRequest as SilentRequest);\n        }\n        }).catch(error => {\n          console.log('Silent token fails');\n        });\n  }\n\n  private getConf(): MSPMsalGuardConfiguration {\n    return this.msalGuardConfig.filter(conf => conf.type === 'b2c')[0];\n  }\n}\n","<button class=\"microsoft-login-button\" mat-raised-button (click)=\"loginMicrosoftb2c()\">\n  <mat-icon svgIcon=\"microsoft\"></mat-icon>\n  {{'igo.auth.microsoftb2c.login' | translate}}\n</button>\n","<div *ngIf=\"visible\">\n  <div *ngIf=\"!auth.logged && backgroundDisable\" class=\"backgroundDisable\"></div>\n\n  <div *ngIf=\"!auth.logged && showLoginDiv\" class=\"login center-block\">\n    <h1>{{'igo.auth.connection' | translate}}</h1>\n\n    <igo-auth-google\n      *ngIf=\"options.google && options.google.enabled !== false\"\n      (login)=\"onLogin()\">\n    </igo-auth-google>\n    <igo-auth-microsoft\n      *ngIf=\"options.microsoft && options.microsoft.enabled !== false\"\n      (login)=\"onLogin()\">\n    </igo-auth-microsoft>\n    <igo-auth-microsoftb2c\n      *ngIf=\"options.microsoftb2c && options.microsoftb2c.enabled !== false\"\n      (login)=\"onLogin()\">\n    </igo-auth-microsoftb2c>\n    <igo-auth-facebook\n      *ngIf=\"options.facebook && options.facebook.enabled !== false\"\n      (login)=\"onLogin()\">\n    </igo-auth-facebook>\n    <igo-auth-intern\n      *ngIf=\"!options.intern || options.intern.enabled !== false\"\n      [allowAnonymous]=\"options.allowAnonymous\"\n      (login)=\"onLogin()\">\n    </igo-auth-intern>\n  </div>\n\n  <div *ngIf=\"auth.logged && showAlreadyConnectedDiv\" class=\"login center-block\">\n    <p>{{'igo.auth.welcome' |translate: user}}</p>\n    <button mat-raised-button type=\"button\" (click)=\"logout()\">{{'igo.auth.signOut' |translate}}</button>\n  </div>\n\n  <div *ngIf=\"showLogoutDiv\" class=\"login center-block\">\n    <p>{{'igo.auth.deconnection' |translate}}</p>\n    <button *ngIf=\"options.homeRoute\" mat-raised-button type=\"button\" (click)=\"home()\">{{'igo.auth.home' |translate}}</button>\n  </div>\n\n</div>\n","import {\n  Component,\n  ChangeDetectionStrategy,\n  OnInit,\n  Input,\n  Optional,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Router, NavigationStart } from '@angular/router';\nimport { filter } from 'rxjs/operators';\n\nimport { ConfigService } from '@igo2/core';\nimport { AuthOptions } from '../shared/auth.interface';\nimport { AuthService } from '../shared/auth.service';\n\n@Component({\n  selector: 'igo-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.Default\n})\nexport class AuthFormComponent implements OnInit {\n  @Input()\n  get backgroundDisable(): boolean {\n    if (this.isLogoutRoute || this.isLogoutRoute) {\n      return false;\n    }\n    return this._backgroundDisable;\n  }\n  set backgroundDisable(value: boolean) {\n    this._backgroundDisable = value.toString() === 'true';\n  }\n  private _backgroundDisable = true;\n\n  @Input()\n  get hasAlreadyConnectedDiv(): boolean {\n    return this._hasAlreadyConnectedDiv;\n  }\n  set hasAlreadyConnectedDiv(value: boolean) {\n    this._hasAlreadyConnectedDiv = value.toString() === 'true';\n  }\n  private _hasAlreadyConnectedDiv = true;\n\n  @Input()\n  get hasLogoutDiv(): boolean {\n    return this._hasLogoutDiv;\n  }\n  set hasLogoutDiv(value: boolean) {\n    this._hasLogoutDiv = value.toString() === 'true';\n  }\n  private _hasLogoutDiv = true;\n\n  @Input()\n  get showAlreadyConnectedDiv(): boolean {\n    if (this.isLogoutRoute) {\n      return this.hasAlreadyConnectedDiv;\n    }\n    return this._showAlreadyConnectedDiv;\n  }\n  set showAlreadyConnectedDiv(value: boolean) {\n    this._showAlreadyConnectedDiv = value.toString() === 'true';\n  }\n  private _showAlreadyConnectedDiv = false;\n\n  @Input()\n  get showLogoutDiv(): boolean {\n    if (this.isLogoutRoute) {\n      return this.hasLogoutDiv;\n    }\n    return this._showLogoutDiv;\n  }\n  set showLogoutDiv(value: boolean) {\n    this._showLogoutDiv = value.toString() === 'true';\n  }\n  private _showLogoutDiv = false;\n\n  get showLoginDiv(): boolean {\n    if (!this.isLogoutRoute) {\n      return true;\n    }\n  }\n\n  @Output() login: EventEmitter<boolean> = new EventEmitter<boolean>();\n\n  public options: AuthOptions;\n  public user;\n\n  public visible = true;\n\n  private isLoginRoute: boolean;\n  private isLogoutRoute: boolean;\n\n  constructor(\n    public auth: AuthService,\n    private config: ConfigService,\n    @Optional() private router: Router\n  ) {\n    this.options = this.config.getConfig('auth') || {};\n    this.visible = Object.getOwnPropertyNames(this.options).length !== 0;\n  }\n\n  public ngOnInit() {\n    this.analyzeRoute();\n    this.getName();\n  }\n\n  public onLogin() {\n    this.auth.goToRedirectUrl();\n    this.getName();\n    this.login.emit(true);\n  }\n\n  public logout() {\n    this.auth.logout().subscribe(() => {\n      this.user = undefined;\n      if (this.router) {\n        if (this.options.logoutRoute) {\n          this.router.navigate([this.options.logoutRoute]);\n        } else if (this.options.homeRoute) {\n          this.router.navigate([this.options.homeRoute]);\n        }\n      }\n    });\n  }\n\n  public home() {\n    if (this.router && this.options.homeRoute) {\n      this.router.navigate([this.options.homeRoute]);\n    }\n  }\n\n  private getName() {\n    const tokenDecoded = this.auth.decodeToken();\n    if (tokenDecoded) {\n      this.user = {\n        name: tokenDecoded.user.firstName || tokenDecoded.user.sourceId\n      };\n    }\n  }\n\n  private analyzeRoute() {\n    if (!this.router) {\n      return;\n    }\n\n    this.router.events\n      .pipe(filter((event) => event instanceof NavigationStart))\n      .subscribe((changeEvent: any) => {\n        if (changeEvent.url) {\n          const currentRoute = changeEvent.url;\n          const logoutRoute = this.options.logoutRoute;\n          const loginRoute = this.options.loginRoute;\n\n          this.isLogoutRoute = currentRoute === logoutRoute;\n          this.isLoginRoute = currentRoute === loginRoute;\n\n          if (this.isLogoutRoute) {\n            this.auth.logout();\n          }\n        }\n      });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport {\n  HttpEvent,\n  HttpInterceptor,\n  HttpHandler,\n  HttpRequest\n} from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { Md5 } from 'ts-md5';\n\nimport { ConfigService } from '@igo2/core';\nimport { TokenService } from './token.service';\nimport { AuthByKeyOptions, WithCredentialsOptions } from './auth.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthInterceptor implements HttpInterceptor {\n  private refreshInProgress = false;\n\n  private get trustHosts() {\n    const trustHosts = this.config.getConfig('auth.trustHosts') || [];\n    trustHosts.push(window.location.hostname);\n    return trustHosts;\n  }\n\n  private get hostsWithCredentials(): WithCredentialsOptions[] {\n    return this.config.getConfig('auth.hostsWithCredentials') || [];\n  }\n\n  private get hostsWithAuthByKey(): AuthByKeyOptions[] {\n    return this.config.getConfig('auth.hostsByKey') || [];\n  }\n\n  constructor(\n    private config: ConfigService,\n    private tokenService: TokenService,\n    private http: HttpClient\n  ) {}\n\n  intercept(\n    originalReq: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    const withCredentials = this.handleHostsWithCredentials(originalReq.url);\n    let req = originalReq.clone();\n    const hostWithKey = this.handleHostsAuthByKey(originalReq.url);\n    if (hostWithKey) {\n      req = req.clone({\n        params: req.params.set(hostWithKey.key, hostWithKey.value)\n      });\n    }\n    if (withCredentials) {\n      req = originalReq.clone({\n        withCredentials\n      });\n      return next.handle(req);\n    }\n    this.refreshToken();\n    const token = this.tokenService.get();\n    const element = document.createElement('a');\n    element.href = req.url;\n    if (element.host === '') {\n      element.href = element.href; // FIX IE11, DO NOT REMOVE\n    }\n\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\n      return next.handle(req);\n    }\n\n    const authHeader = `Bearer ${token}`;\n    let authReq = req.clone({\n      headers: req.headers.set('Authorization', authHeader)\n    });\n\n    const tokenDecoded: any = this.tokenService.decode();\n    if (\n      authReq.params.get('_i') === 'true' &&\n      tokenDecoded &&\n      tokenDecoded.user &&\n      tokenDecoded.user.sourceId\n    ) {\n      const hashUser = Md5.hashStr(tokenDecoded.user.sourceId) as string;\n      authReq = authReq.clone({\n        params: authReq.params.set('_i', hashUser)\n      });\n    } else if (authReq.params.get('_i') === 'true') {\n      authReq = authReq.clone({\n        params: authReq.params.delete('_i')\n      });\n    }\n\n    return next.handle(authReq);\n  }\n\n  interceptXhr(xhr, url: string): boolean {\n    const withCredentials = this.handleHostsWithCredentials(url);\n    if (withCredentials) {\n       xhr.withCredentials = withCredentials;\n       return true;\n    }\n\n    this.refreshToken();\n    const element = document.createElement('a');\n    element.href = url;\n\n    const token = this.tokenService.get();\n    if (!token || this.trustHosts.indexOf(element.hostname) === -1) {\n      return false;\n    }\n    xhr.setRequestHeader('Authorization', 'Bearer ' + token);\n    return true;\n  }\n\n  alterUrlWithKeyAuth(url: string): string {\n    const hostWithKey = this.handleHostsAuthByKey(url);\n    let interceptedUrl = url;\n    if (hostWithKey) {\n      const urlDecomposed = interceptedUrl.split(/[?&]/);\n      let urlWithKeyAdded = urlDecomposed.shift();\n      const paramsToKeep = urlDecomposed.filter(p => p.length !== 0);\n      paramsToKeep.push(`${hostWithKey.key}=${hostWithKey.value}`);\n      if (paramsToKeep.length) {\n        urlWithKeyAdded += '?' + paramsToKeep.join('&');\n      }\n      return urlWithKeyAdded;\n    }\n    return;\n  }\n\n  private handleHostsWithCredentials(reqUrl: string) {\n    let withCredentials = false;\n    for (const hostWithCredentials of this.hostsWithCredentials) {\n      const domainRegex = new RegExp(hostWithCredentials.domainRegFilters);\n      if (domainRegex.test(reqUrl)) {\n        withCredentials = hostWithCredentials.withCredentials !== undefined ? hostWithCredentials.withCredentials : undefined;\n        break;\n      }\n    }\n    return withCredentials;\n  }\n\n  private handleHostsAuthByKey(reqUrl: string): {key: string, value: string} {\n    let hostWithKey;\n    for (const hostWithAuthByKey of this.hostsWithAuthByKey) {\n      const domainRegex = new RegExp(hostWithAuthByKey.domainRegFilters);\n      if (domainRegex.test(reqUrl)) {\n        var replace = `${hostWithAuthByKey.keyProperty}=${hostWithAuthByKey.keyValue}`;\n        var keyAdded = new RegExp(replace,\"gm\");\n        if (!keyAdded.test(reqUrl)) {\n          hostWithKey = {key : hostWithAuthByKey.keyProperty, value: hostWithAuthByKey.keyValue};\n          break;\n        }\n      }\n    }\n    return hostWithKey;\n  }\n\n  refreshToken() {\n    const jwt = this.tokenService.decode();\n    const currentTime = new Date().getTime() / 1000;\n\n    if (\n      !this.refreshInProgress &&\n      jwt &&\n      currentTime < jwt.exp &&\n      currentTime > jwt.exp - 1800\n    ) {\n      this.refreshInProgress = true;\n\n      const url = this.config.getConfig('auth.url');\n      return this.http.post(`${url}/refresh`, {}).subscribe(\n        (data: any) => {\n          this.tokenService.set(data.token);\n          this.refreshInProgress = false;\n        },\n        err => {\n          err.error.caught = true;\n          return err;\n        }\n      );\n    }\n  }\n}\n","import {\n  MSAL_GUARD_CONFIG,\n  MSAL_INSTANCE,\n  MsalService,\n} from '@azure/msal-angular';\n\nimport {\n  PublicClientApplication,\n  InteractionType\n} from '@azure/msal-browser';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { BrowserAuthOptions } from '@azure/msal-browser';\n\nimport { AuthMicrosoftOptions, MSPMsalGuardConfiguration } from './auth.interface';\n\nimport { MsalServiceb2c } from './auth-msalServiceb2c.service.';\n\nexport function MSALConfigFactory(config: ConfigService): PublicClientApplication {\n\n  const msConf: BrowserAuthOptions = config.getConfig('auth.microsoft') || {};\n\n  msConf.redirectUri = msConf.redirectUri || window.location.href;\n  msConf.authority = msConf.authority || 'https://login.microsoftonline.com/organizations';\n\n  const myMsalObj = new PublicClientApplication({\n    auth: msConf,\n    cache: {\n      cacheLocation: 'sessionStorage'\n    }\n  });\n\n  return myMsalObj;\n}\n\nexport function MSALConfigFactoryb2c(config: ConfigService): PublicClientApplication {\n\n  const msConf: BrowserAuthOptions = config.getConfig('auth.microsoftb2c.browserAuthOptions') || {};\n  msConf.redirectUri = msConf.redirectUri || window.location.href;\n  msConf.authority = msConf.authority || 'https://login.microsoftonline.com/organizations';\n\n  const myMsalObj = new PublicClientApplication({\n    auth: msConf,\n    cache: {\n      cacheLocation: 'sessionStorage'\n    }\n  });\n\n  return myMsalObj;\n}\n\nexport function MSALAngularConfigFactory(config: ConfigService): MSPMsalGuardConfiguration {\n\n  const msConf: AuthMicrosoftOptions = config.getConfig('auth.microsoft') || {};\n\n  return {\n    interactionType: InteractionType.Popup,\n    authRequest: {\n      scopes: ['user.read'],\n      loginHint: 'todo',\n    },\n    type: 'add'\n  };\n}\n\nexport function MSALAngularConfigFactoryb2c(config: ConfigService): MSPMsalGuardConfiguration {\n\n  const msConf: BrowserAuthOptions = config.getConfig('auth.microsoftb2c.browserAuthOptions') || {};\n\n  return {\n    interactionType: InteractionType.Popup,\n    authRequest: {\n      scopes: [msConf.clientId]\n    },\n    type: 'b2c'\n  };\n}\n\nexport function provideAuthMicrosoft(type?: string) {\n  if (type === 'b2c') {\n    return [\n      {\n        provide: MSAL_INSTANCE,\n        useFactory: MSALConfigFactoryb2c,\n        deps: [ConfigService]\n      },\n      {\n        provide: MSAL_GUARD_CONFIG,\n        useFactory: MSALAngularConfigFactoryb2c,\n        deps: [ConfigService],\n        multi: true\n      },\n      MsalServiceb2c\n    ];\n  } else {\n    return [\n      {\n        provide: MSAL_INSTANCE,\n        useFactory: MSALConfigFactory,\n        deps: [ConfigService]\n      },\n      {\n        provide: MSAL_GUARD_CONFIG,\n        useFactory: MSALAngularConfigFactory,\n        deps: [ConfigService],\n        multi: true\n      },\n      MsalService\n    ];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { StorageService, StorageScope, ConfigService } from '@igo2/core';\nimport { AuthService } from './auth.service';\nimport { TokenService } from './token.service';\nimport { AuthStorageOptions } from './storage.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthStorageService extends StorageService {\n  protected options: AuthStorageOptions;\n\n  constructor(\n    config: ConfigService,\n    private http: HttpClient,\n    private authService: AuthService,\n    private tokenService: TokenService\n  ) {\n    super(config);\n\n    this.authService.authenticate$.subscribe(isAuthenticated => {\n      if (isAuthenticated && this.options.url) {\n        this.http\n          .get(this.options.url)\n          .subscribe((userIgo: { preference: object }) => {\n            if (userIgo && userIgo.preference) {\n              for (const key of Object.keys(userIgo.preference)) {\n                const value = userIgo.preference[key];\n                super.set(key, value);\n              }\n            }\n          });\n      }\n    });\n  }\n\n  set(\n    key: string,\n    value: string | object | boolean | number,\n    scope: StorageScope = StorageScope.LOCAL\n  ) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      const preference = {};\n      preference[key] = value;\n      this.http.patch(this.options.url, { preference }).subscribe();\n    }\n    super.set(key, value, scope);\n  }\n\n  remove(key: string, scope: StorageScope = StorageScope.LOCAL) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      const preference = {};\n      preference[key] = undefined;\n      this.http.patch(this.options.url, { preference }).subscribe();\n    }\n    super.remove(key, scope);\n  }\n\n  clear(scope: StorageScope = StorageScope.LOCAL) {\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      this.http.patch(this.options.url, { preference: {}}, {\n        params: {\n          mergePreference: 'false'\n        }\n      }).subscribe();\n    }\n\n    let token: string;\n    if (scope === StorageScope.LOCAL) {\n      token = this.tokenService.get();\n    }\n\n    super.clear(scope);\n\n    if (token) {\n      this.tokenService.set(token);\n    }\n\n    if (\n      scope === StorageScope.LOCAL &&\n      this.authService.authenticated &&\n      this.options.url\n    ) {\n      this.http\n        .get(this.options.url)\n        .subscribe((userIgo: { preference: object }) => {\n          if (userIgo && userIgo.preference) {\n            for (const key of Object.keys(userIgo.preference)) {\n              const value = userIgo.preference[key];\n              super.set(key, value);\n            }\n          }\n        });\n    }\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MsalModule } from '@azure/msal-angular';\n\nimport { StorageService, IgoLanguageModule } from '@igo2/core';\n\nimport { AuthStorageService } from './shared/storage.service';\nimport { ProtectedDirective } from './shared/protected.directive';\nimport { AuthInterceptor } from './shared/auth.interceptor';\nimport { provideAuthMicrosoft } from './shared/auth-microsoft.provider';\n\nimport { AuthInternComponent } from './auth-form/auth-intern.component';\nimport { AuthFormComponent } from './auth-form/auth-form.component';\nimport { AuthGoogleComponent } from './auth-form/auth-google.component';\nimport { AuthFacebookComponent } from './auth-form/auth-facebook.component';\nimport { AuthMicrosoftComponent } from './auth-form/auth-microsoft.component';\nimport { AuthMicrosoftb2cComponent } from './auth-form/auth-microsoftb2c.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatIconModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    MsalModule\n  ],\n  declarations: [\n    AuthFormComponent,\n    AuthGoogleComponent,\n    AuthInternComponent,\n    AuthFacebookComponent,\n    AuthMicrosoftComponent,\n    AuthMicrosoftb2cComponent,\n    ProtectedDirective\n  ],\n  exports: [AuthFormComponent, ProtectedDirective]\n})\nexport class IgoAuthModule {\n  static forRoot(): ModuleWithProviders<IgoAuthModule> {\n    return {\n      ngModule: IgoAuthModule,\n      providers: [\n        {\n          provide: HTTP_INTERCEPTORS,\n          useClass: AuthInterceptor,\n          multi: true\n        },\n        {\n          provide: StorageService,\n          useClass: AuthStorageService\n        },\n        ...provideAuthMicrosoft('add'),\n        ...provideAuthMicrosoft('b2c')\n      ]\n    };\n  }\n}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppAuthFormComponent } from './auth-form.component';\n\nconst routes: Routes = [\n  {\n    path: 'auth-form',\n    component: AppAuthFormComponent\n  }\n];\n\nexport const AppAuthFormRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\n\n@Component({\n  selector: 'app-auth-form',\n  templateUrl: './auth-form.component.html',\n  styleUrls: ['./auth-form.component.scss']\n})\nexport class AppAuthFormComponent {\n  private idsActivity: string[] = [];\n\n  constructor(private languageService: LanguageService) {}\n}\n","<mat-card>\n  <mat-card-subtitle>Auth</mat-card-subtitle>\n  <mat-card-title>Authentification</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: ConfigService, LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/auth/auth-form\">code of this example</a><br>\n    See auth section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\n  </mat-card-content>\n</mat-card>\n\n<igo-auth-form></igo-auth-form>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoAuthModule } from '@igo2/auth';\n\nimport { AppAuthFormComponent } from './auth-form.component';\nimport { AppAuthFormRoutingModule } from './auth-form-routing.module';\n\n@NgModule({\n  declarations: [AppAuthFormComponent],\n  imports: [AppAuthFormRoutingModule, MatCardModule, IgoAuthModule.forRoot()],\n  exports: [AppAuthFormComponent]\n})\nexport class AppAuthFormModule {}\n","import { Injectable } from '@angular/core';\n\nimport { MetadataOptions } from './metadata.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class MetadataService {\n  constructor() {}\n\n  open(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      window.open(metadata.url, '_blank');\n    }\n  }\n}\n","<button\n  *ngIf=\"(options && options.metadata && options.metadata.url) || (options && options.metadata && options.metadata.abstract)\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.metadata.show' | translate\"\n  [color]=\"color\"\n  (click)=\"openMetadata(options.metadata)\">\n  <mat-icon svgIcon=\"information-outline\"></mat-icon>\n</button>\n","<h2 mat-dialog-title>{{ data.layerTitle }}</h2>\n<button class=\"close-button\" mat-button mat-dialog-close>X</button>\n<mat-dialog-content *ngIf=\"data.type !== 'arcgisrest'\" class=\"mat-typography\">\n  <h3>{{ data.abstract }}</h3>\n</mat-dialog-content>\n<mat-dialog-content *ngIf=\"data.type === 'arcgisrest'\" class=\"mat-typography\">\n  <h3 [innerHTML]=\"data.abstract\"></h3>\n</mat-dialog-content>\n","import { Component, Input, ChangeDetectionStrategy, Inject, ViewEncapsulation } from '@angular/core';\nimport { MatDialog, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport {\n  MetadataOptions,\n  MetadataLayerOptions\n} from '../shared/metadata.interface';\nimport { MetadataService } from '../shared/metadata.service';\n\n@Component({\n  selector: 'igo-metadata-button',\n  templateUrl: './metadata-button.component.html',\n  styleUrls: ['./metadata-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MetadataButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(\n    private metadataService: MetadataService,\n    private dialog: MatDialog) {}\n\n  openMetadata(metadata: MetadataOptions) {\n    if (metadata.extern) {\n      if (!metadata.url && metadata.abstract) {\n        this.dialog.open(MetadataAbstractComponent, {\n          data: {\n            layerTitle: this.layer.title,\n            abstract: metadata.abstract,\n            type: metadata.type\n          }\n        });\n      } else if (metadata.url) {\n        this.metadataService.open(metadata);\n      }\n    } else if (!metadata.extern && metadata.abstract) {\n      this.dialog.open(MetadataAbstractComponent, {\n        data: {\n          layerTitle: this.layer.title,\n          abstract: metadata.abstract,\n          type: metadata.type\n        }\n      });\n    }\n  }\n\n  get options(): MetadataLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n}\n\n@Component({\n  selector: 'igo-metadata-abstract',\n  templateUrl: './metadata-abstract.component.html',\n  styleUrls: ['./metadata-abstract.component.scss'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class MetadataAbstractComponent {\n  constructor(@Inject(MAT_DIALOG_DATA) public data: MetadataOptions) {}\n}\n","import { MatDialogModule } from '@angular/material/dialog';\nimport { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { MetadataButtonComponent, MetadataAbstractComponent } from './metadata-button/metadata-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule,\n    MatDialogModule\n  ],\n  exports: [\n    MetadataButtonComponent,\n    MetadataAbstractComponent],\n  declarations: [\n    MetadataButtonComponent,\n    MetadataAbstractComponent]\n})\nexport class IgoMetadataModule {\n  static forRoot(): ModuleWithProviders<IgoMetadataModule> {\n    return {\n      ngModule: IgoMetadataModule,\n      providers: []\n    };\n  }\n}\n","export const FEATURE = 'Feature';\n\nexport enum FeatureMotion {\n  None,\n  Move,\n  Zoom,\n  Default\n}\n","import olSourceImage from 'ol/source/Image';\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { ImageLayer } from '../shared/layers/image-layer';\n\n\nexport class ImageWatcher extends Watcher {\n  protected id: string;\n  protected loaded = 0;\n  protected loading = 0;\n\n  private source: olSourceImage;\n\n  private messageService: MessageService;\n  private languageService: LanguageService;\n\n  constructor(layer: ImageLayer, messageService: MessageService, languageService: LanguageService) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n    this.messageService = messageService;\n    this.languageService = languageService;\n  }\n\n  protected watch() {\n    this.source.on(`imageloadstart`, e => this.handleLoadStart(e));\n    this.source.on(`imageloadend`, e => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, e => this.handleLoadEnd(e));\n    this.source.on(`imageloaderror`, e => this.handleLoadError(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`imageloadstart`, e => this.handleLoadStart(e));\n    this.source.un(`imageloadend`, e => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, e => this.handleLoadEnd(e));\n    this.source.un(`imageloaderror`, e => this.handleLoadError(e));\n  }\n\n  private handleLoadStart(event: any) {\n    if (!event.image.__watchers__) {\n      event.image.__watchers__ = [];\n    }\n    event.image.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.image.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.image.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.image.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n\n  private handleLoadError(event) {\n\n    if (!event.image.__watchers__) {\n      return;\n    }\n    const title = this.languageService.translate.instant(\n      'igo.geo.dataSource.unavailableTitle'\n    );\n    const message = this.languageService.translate.instant(\n      'igo.geo.dataSource.unavailable', {value: event.target.params_.LAYERS}\n    );\n\n    this.messageService.error(message, title);\n    this.loaded = -1;\n    this.loading = 0;\n    this.status = SubjectStatus.Error;\n\n  }\n}\n","import { AnyLayerOptions } from \"../shared/layers/any-layer.interface\";\nimport { VectorTileLayerOptions } from \"../shared/layers/vectortile-layer.interface\";\n\n\nexport function computeMVTOptionsOnHover(layerOptions: AnyLayerOptions) {\n  const vectorTileLayerOptions = layerOptions as VectorTileLayerOptions;\n  if (\n    vectorTileLayerOptions.sourceOptions?.type === 'mvt' &&\n    (vectorTileLayerOptions.styleByAttribute?.hoverStyle || vectorTileLayerOptions.hoverStyle)) {\n    const fc = vectorTileLayerOptions.sourceOptions.featureClass;\n    vectorTileLayerOptions.sourceOptions.featureClass = fc ? fc : 'feature';\n  }\n  return layerOptions;\n}\n","import olSourceTile from 'ol/source/Tile';\nimport { uuid, Watcher, SubjectStatus } from '@igo2/utils';\n\nimport { TileLayer } from '../shared/layers/tile-layer';\nimport { VectorTileLayer } from '../shared/layers/vectortile-layer';\n\nexport class TileWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private source: olSourceTile;\n\n  constructor(layer: TileLayer | VectorTileLayer) {\n    super();\n    this.source = layer.options.source.ol;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    this.source.on(`tileloadstart`, e => this.handleLoadStart(e));\n    this.source.on(`tileloadend`, e => this.handleLoadEnd(e));\n    this.source.on(`tileloaderror`, e => this.handleLoadEnd(e));\n  }\n\n  protected unwatch() {\n    this.source.un(`tileloadstart`, e => this.handleLoadStart(e));\n    this.source.un(`tileloadend`, e => this.handleLoadEnd(e));\n    this.source.un(`tileloaderror`, e => this.handleLoadEnd(e));\n  }\n\n  private handleLoadStart(event: any) {\n    // This is to avoid increasing\n    // the number of loaded tiles if a tile was loading\n    // before subscribing to this watcher\n    if (!event.tile.__watchers__) {\n      event.tile.__watchers__ = [];\n    }\n    event.tile.__watchers__.push(this.id);\n\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event) {\n    if (!event.tile.__watchers__) {\n      return;\n    }\n\n    const watcherIndex = event.tile.__watchers__.indexOf(this.id);\n    if (watcherIndex < 0) {\n      return;\n    }\n\n    event.tile.__watchers__.splice(watcherIndex, 1);\n\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import { ArcGISRestDataSourceOptions } from './../datasource/shared/datasources/arcgisrest-datasource.interface';\nimport { Md5 } from 'ts-md5';\n\nimport { uuid } from '@igo2/utils';\n\nimport { AnyDataSourceOptions } from '../datasource/shared/datasources/any-datasource.interface';\nimport { DataSourceOptions } from '../datasource/shared/datasources/datasource.interface';\nimport { WMSDataSourceOptions } from '../datasource/shared/datasources/wms-datasource.interface';\nimport { WMTSDataSourceOptions } from '../datasource/shared/datasources/wmts-datasource.interface';\nimport { WFSDataSourceOptions } from '../datasource';\n\n/**\n * Generate a id from it's datasource options.\n * @param options Data source options\n * @returns A id\n */\nexport function generateIdFromSourceOptions(options: DataSourceOptions): string {\n  const generators = {\n    wms: generateWMSIdFromSourceOptions,\n    wmts: generateWMTSIdFromSourceOptions,\n    xyz: generateXYZIdFromSourceOptions,\n    feature: generateFeatureIdFromSourceOptions,\n    wfs: generateWfsIdFromSourceOptions,\n    arcgisrest: generateArcgisRestIdFromSourceOptions,\n    imagearcgisrest: generateArcgisRestIdFromSourceOptions,\n    tilearcgisrest: generateArcgisRestIdFromSourceOptions,\n    osm: (_options: AnyDataSourceOptions) => 'OSM',\n    tiledebug: (_options: AnyDataSourceOptions) => 'tiledebug'\n  };\n  const generator = generators[options.type] || generateId;\n  return generator(options);\n}\n\n/**\n * Generate a id from WMS data source options\n * @param options WMS data source options\n * @returns A md5 hash of the the url and layers\n */\nexport function generateWMSIdFromSourceOptions(options: WMSDataSourceOptions) {\n  const layers = options.params.LAYERS;\n  const url = standardizeUrl(options.url);\n  const chain = 'wms' + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from WMTS data source options\n * @param options WMTS data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWMTSIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  const layer = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = 'wmts' + url + layer;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from XYZ data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateXYZIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  const url = standardizeUrl(options.url);\n  const chain = 'xyz' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateFeatureIdFromSourceOptions(options: WMTSDataSourceOptions) {\n  if (!options.url) { return generateId(options); }\n  const url = standardizeUrl(options.url);\n  const chain = 'feature' + url;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a id from feature data source options\n * @param options XYZ data source options\n * @returns A md5 hash of the the url and layer\n */\nexport function generateWfsIdFromSourceOptions(options: WFSDataSourceOptions) {\n  if (!options.url || !options.params) { return generateId(options); }\n  const url = standardizeUrl(options.url);\n  const chain = 'wfs' + url + options.params.featureTypes;\n  return Md5.hashStr(chain) as string;\n}\n/**\n * Generate a id from ArcGIS Rest data source options\n * @param options ArcGIS Rest data source options\n * @returns A md5 hash of the url and layers\n */\nexport function generateArcgisRestIdFromSourceOptions(options: ArcGISRestDataSourceOptions) {\n  const layers = options.layer;\n  const url = standardizeUrl(options.url);\n  const chain = (options.type || 'arcgis') + url + layers;\n  return Md5.hashStr(chain) as string;\n}\n\n/**\n * Generate a unique id\n * @returns A uuid\n */\nexport function generateId(_options: AnyDataSourceOptions) {\n  return uuid();\n}\n\nexport function standardizeUrl(url: string): string {\n  const absUrl = url.charAt(0) === '/' ? window.location.origin + url : url;\n  const urlDecomposed = absUrl.split(/[?&]/);\n  let urlStandardized = urlDecomposed.shift();\n  const paramsToKeep = urlDecomposed.filter(p => p.length !== 0 && p.charAt(0) !== '_');\n  if (paramsToKeep.length) {\n    urlStandardized += '?' + paramsToKeep.join('&');\n  }\n  return urlStandardized;\n}\n","import olSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\nimport olClusterSource from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  DataSourceOptions,\n  Legend\n} from './datasource.interface';\n\nimport { DataService } from './data.service';\nimport { generateIdFromSourceOptions } from '../../../utils/id-generator';\nimport { LegendMapViewOptions, LegendOptions } from '../../../layer/shared/layers/layer.interface';\n\nexport abstract class DataSource {\n\n  public id: string;\n  public ol: olSource | olVectorSource<OlGeometry> | olClusterSource ;\n  private legend: Legend[];\n\n  constructor(\n    public options: DataSourceOptions = {},\n    protected dataService?: DataService\n  ) {\n    this.options = options;\n    this.id = this.options.id ||this.generateId();\n    this.ol = this.createOlSource();\n  }\n\n  protected abstract createOlSource(): olSource;\n\n  protected generateId(): string {\n    return generateIdFromSourceOptions(this.options);\n  }\n\n  public getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    return this.legend ? this.legend : [];\n  }\n\n  public setLegend(options: LegendOptions): Legend[] {\n    if (options.url) {\n      this.legend = [{ url: options.url} ];\n    } else if (options.html) {\n      this.legend = [{ html: options.html} ];\n    } else {\n      this.legend = [];\n    }\n\n    return this.legend;\n  }\n\n  protected abstract onUnwatch();\n}\n","import olSourceVector from 'ol/source/Vector';\nimport * as olformat from 'ol/format';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { FeatureDataSourceOptions } from './feature-datasource.interface';\n\nexport class FeatureDataSource extends DataSource {\n  public options: FeatureDataSourceOptions;\n  public ol: olSourceVector<OlGeometry>;\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const sourceOptions = {\n      format: this.getSourceFormatFromOptions(this.options)\n    };\n\n    return new olSourceVector(Object.assign(sourceOptions, this.options));\n  }\n\n  protected getSourceFormatFromOptions(options: FeatureDataSourceOptions) {\n    if (options.format) {\n      return options.format;\n    }\n    let olFormatCls;\n    const formatType = options.formatType;\n    if (!formatType) {\n      olFormatCls = olformat.GeoJSON;\n    } else {\n      olFormatCls = olformat[formatType];\n      if (olFormatCls === undefined) {\n        throw new Error('Invalid vector source format ${formatType}.');\n      }\n    }\n\n    const formatOptions = options.formatOptions;\n    let format;\n    if (formatOptions) {\n      format = new olFormatCls(formatOptions);\n    } else {\n      format = new olFormatCls();\n    }\n\n    return format;\n  }\n\n  public onUnwatch() {}\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n}\n","import olSourceCluster from 'ol/source/Cluster';\n\nimport { uuid } from '@igo2/utils';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { ClusterDataSourceOptions } from './cluster-datasource.interface';\n\nexport class ClusterDataSource extends FeatureDataSource {\n  public options: ClusterDataSourceOptions;\n  public ol: olSourceCluster;\n\n  protected createOlSource(): olSourceCluster {\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    this.options.source = super.createOlSource();\n    return new olSourceCluster(this.options);\n  }\n\n  protected generateId() {\n    return uuid();\n  }\n\n  public onUnwatch() {}\n}\n","import { uuid, Watcher, SubjectStatus } from '@igo2/utils';\n\nimport { VectorLayer } from '../shared/layers/vector-layer';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\n\nexport class VectorWatcher extends Watcher {\n  private id: string;\n  private loaded = 0;\n  private loading = 0;\n\n  private layer: VectorLayer;\n\n  constructor(layer: VectorLayer) {\n    super();\n    this.layer = layer;\n    this.id = uuid();\n  }\n\n  protected watch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n     }\n\n    if (olSource.getUrl()) {\n      olSource.on(`featuresloadstart`, e => this.handleLoadStart(e));\n      olSource.on(`featuresloadend`, e => this.handleLoadEnd(e));\n      olSource.on(`featuresloaderror`, e => this.handleLoadEnd(e));\n    }\n\n  }\n\n  protected unwatch() {\n    let olSource = this.layer.options.source.ol;\n    if (this.layer.dataSource instanceof ClusterDataSource) {\n      olSource = (this.layer.options.source.options as any).source;\n     }\n    if (olSource.getUrl()) {\n      olSource.un(`featuresloadstart`, e => this.handleLoadStart(e));\n      olSource.un(`featuresloadend`, e => this.handleLoadEnd(e));\n      olSource.un(`featuresloaderror`, e => this.handleLoadEnd(e));\n    }\n  }\n\n  private handleLoadStart(event: any) {\n    this.loading += 1;\n    this.status = SubjectStatus.Working;\n  }\n\n  private handleLoadEnd(event: any) {\n    this.loaded += 1;\n\n    const loading = this.loading;\n    if (this.loaded >= loading) {\n      if (loading === this.loading) {\n        this.status = SubjectStatus.Done;\n        this.loaded = this.loading = 0;\n      }\n    }\n  }\n}\n","import * as olproj from 'ol/proj';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { MAC } from 'ol/has';\n\nimport { NumberUtils } from '@igo2/utils';\n\nimport { MapViewState } from './map.interface';\nimport { Projection } from './projection.interfaces';\n\n/**\n * This method extracts a coordinate tuple from a string.\n * @param str Any string\n * @param mapProjection string Map Projection\n * @param opts.forceNA boolean Force North America Zone\n * @returns object:\n *             lonLat: Coordinate,\n *             message: Message of error,\n *             radius: radius of the confience of coordinate,\n *             conf: confidence of the coordinate}\n */\nexport function stringToLonLat(\n  str: string,\n  mapProjection: string,\n  opts: { forceNA?: boolean } = {}\n): {\n  lonLat: [number, number] | undefined;\n  message: string;\n  radius: number | undefined;\n  conf: number | undefined;\n} {\n  let lonLat: [number, number];\n  let coordStr: string;\n  let negativeLon: string;\n  let degreesLon: string;\n  let minutesLon: string;\n  let secondsLon: string;\n  let directionLon: string;\n  let decimalLon: string;\n  let negativeLat: string;\n  let degreesLat: string;\n  let minutesLat: string;\n  let secondsLat: string;\n  let directionLat: string;\n  let decimalLat: string;\n  let zone: string;\n  let radius: string;\n  let conf: string;\n  let lon: any;\n  let lat: any;\n\n  const projectionPattern = '(\\\\s*;\\\\s*[\\\\d]{4,6})';\n  const toProjection = '4326';\n  let projectionStr: string;\n  const projectionRegex = new RegExp(projectionPattern, 'g');\n\n  const lonlatCoord = '([-+])?([\\\\d]{1,3})([,.](\\\\d+))?';\n  const lonLatPattern = `${lonlatCoord}[\\\\s,]+${lonlatCoord}`;\n  const lonLatRegex = new RegExp(`^${lonLatPattern}$`, 'g');\n\n  const dmsCoord =\n    '([0-9]{1,2})[:|]?\\\\s*([0-9]{1,2})?[:|\\'||]?\\\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\\\s*[\"||]?\\\\s*';\n  const dmsCoordPattern = `${dmsCoord}([N|S|E|W|O]),?\\\\s*${dmsCoord}([N|S|E|W|O])`;\n  const dmsRegex = new RegExp(`^${dmsCoordPattern}$`, 'gi');\n\n  const patternUtm =\n    '(UTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const utmRegex = new RegExp(`^${patternUtm}`, 'gi');\n\n  const patternMtm =\n    '(MTM)-?(\\\\d{1,2})[\\\\s,]*(\\\\d+[.,]?\\\\d+)[\\\\s,]+(\\\\d+[.,]?\\\\d+)';\n  const mtmRegex = new RegExp(`^${patternMtm}`, 'gi');\n\n  const ddCoord = '([-+])?(\\\\d{1,3})[,.](\\\\d+)';\n  const patternDd = `${ddCoord}\\\\s*[,]?\\\\s*${ddCoord}`;\n  const ddRegex = new RegExp(`^${patternDd}`, 'g');\n\n  const dmdCoord =\n    '([-+])?(\\\\d{1,3})[\\\\s,.]{1}(\\\\d{1,2})[\\\\s,.]{1}(\\\\d{1,2})[.,]?(\\\\d{1,5})?';\n  const patternDmd = `${dmdCoord}\\\\s*[,.]?\\\\s*${dmdCoord}`;\n  const dmdRegex = new RegExp(`^${patternDmd}`, 'g');\n\n /* eslint-disable max-len */\n  const patternBELL =\n    'LAT\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,2})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*LONG\\\\s*[\\\\s:]*\\\\s*([-+])?(\\\\d{1,3})[\\\\s.,]?(\\\\d+)?[\\\\s.,]?\\\\s*(\\\\d{1,2}([.,]\\\\d+)?)?\\\\s*(N|S|E|W)?\\\\s*UNC\\\\s*[\\\\s:]?\\\\s*(\\\\d+)\\\\s*CONF\\\\s*[\\\\s:]?\\\\s*(\\\\d{1,3})';\n  const bellRegex = new RegExp(`^${patternBELL}?`, 'gi');\n\n  const mmCoord = '([-+]?\\\\d+)[,.]?(\\\\d+)?';\n  const mmPattern = `${mmCoord}[\\\\s,]+${mmCoord}`;\n  const mmRegex = new RegExp(`^${mmPattern}$`, 'g');\n\n  let isXYCoords = false;\n\n  str = str.toLocaleUpperCase().trim();\n\n  // Extract projection\n  if (projectionRegex.test(str)) {\n    [coordStr, projectionStr] = str.split(';').map(s => s.trim());\n  } else {\n    coordStr = str;\n  }\n  if (lonLatRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      lon,\n      ,\n      decimalLon,\n      negativeLat,\n      lat,\n      ,\n      decimalLat\n    ] = coordStr.match(lonLatPattern);\n\n    lon = parseFloat((negativeLon ? negativeLon : '') + lon + '.' + decimalLon);\n    lat = parseFloat((negativeLat ? negativeLat : '') + lat + '.' + decimalLat);\n  } else if (dmsRegex.test(coordStr)) {\n    [\n      ,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      directionLon,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      directionLat\n    ] = coordStr.match(dmsCoordPattern);\n\n    if (directionLon === 'S' || directionLon === 'N') {\n      degreesLon = [degreesLat, (degreesLat = degreesLon)][0];\n      minutesLon = [minutesLat, (minutesLat = minutesLon)][0];\n      secondsLon = [secondsLat, (secondsLat = secondsLon)][0];\n      directionLon = [directionLat, (directionLat = directionLon)][0];\n    }\n\n    lon = convertDMSToDD(\n      parseFloat(degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat(degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (utmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternUtm);\n    const epsgUtm = Number(zone) < 10 ? `EPSG:3260${zone}` : `EPSG:326${zone}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgUtm,\n      'EPSG:4326'\n    );\n  } else if (mtmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, , zone, lon, lat] = coordStr.match(patternMtm);\n    const epsgMtm =\n      Number(zone) < 10 ? `EPSG:3218${zone}` : `EPSG:321${80 + Number(zone)}`;\n    [lon, lat] = olproj.transform(\n      [parseFloat(lon), parseFloat(lat)],\n      epsgMtm,\n      'EPSG:4326'\n    );\n  } else if (dmdRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      decimalLat\n    ] = coordStr.match(patternDmd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (ddRegex.test(coordStr)) {\n    [\n      ,\n      negativeLon,\n      degreesLon,\n      decimalLon,\n      negativeLat,\n      degreesLat,\n      decimalLat\n    ] = coordStr.match(patternDd);\n\n    lon = convertDMSToDD(\n      parseFloat((negativeLon ? negativeLon : '') + degreesLon),\n      parseFloat(minutesLon),\n      parseFloat(secondsLon),\n      directionLon\n    );\n    lat = convertDMSToDD(\n      parseFloat((negativeLat ? negativeLat : '') + degreesLat),\n      parseFloat(minutesLat),\n      parseFloat(secondsLat),\n      directionLat\n    );\n  } else if (bellRegex.test(coordStr)) {\n    [\n      ,\n      negativeLat,\n      degreesLat,\n      minutesLat,\n      secondsLat,\n      ,\n      directionLat,\n      negativeLon,\n      degreesLon,\n      minutesLon,\n      secondsLon,\n      ,\n      directionLon,\n      radius,\n      conf\n    ] = coordStr.match(patternBELL);\n\n    // Set default value for North America\n    if (!directionLon) {\n      directionLon = 'W';\n    }\n\n    // Check if real minutes or decimals\n    if (minutesLon && minutesLon.length > 2) {\n      lon = parseFloat(\n        (negativeLon ? negativeLon : '') + degreesLon + '.' + minutesLon\n      );\n    } else {\n      lon = convertDMSToDD(\n        parseFloat(degreesLon),\n        parseFloat(minutesLon),\n        parseFloat(secondsLon),\n        directionLon\n      );\n    }\n\n    if (minutesLat && minutesLat.length > 2) {\n      lat = parseFloat(\n        (negativeLat ? negativeLat : '') + degreesLat + '.' + minutesLat\n      );\n    } else {\n      lat = convertDMSToDD(\n        parseFloat(degreesLat),\n        parseFloat(minutesLat),\n        parseFloat(secondsLat),\n        directionLat\n      );\n    }\n  } else if (mmRegex.test(coordStr)) {\n    isXYCoords = true;\n    [, lon, decimalLon, lat, decimalLat] = coordStr.match(mmPattern);\n\n    if (decimalLon) {\n      lon = parseFloat(lon + '.' + decimalLon);\n    }\n\n    if (decimalLat) {\n      lat = parseFloat(lat + '.' + decimalLat);\n    }\n  } else {\n    return {\n      lonLat: undefined,\n      message: '',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n\n  if (opts.forceNA && !isXYCoords) {\n    // Set a negative coordinate for North America zone\n    if (lon > 0 && lat > 0) {\n      if (lon > lat) {\n        lon = -lon;\n      } else {\n        lat = -lat;\n      }\n    }\n\n    // Reverse coordinate to respect lonLat convention\n    if (lon > lat) {\n      lon = [lat, (lat = lon)][0];\n    }\n  }\n\n  lonLat = [Number(lon), Number(lat)] as [number, number];\n\n  // Reproject the coordinate if projection parameter have been set and coord is not 4326\n  if (\n    (projectionStr !== undefined && projectionStr !== toProjection) ||\n    (lonLat[0] > 180 || lonLat[0] < -180) ||\n    (lonLat[1] > 90 || lonLat[1] < -90)\n  ) {\n    const source = projectionStr ? 'EPSG:' + projectionStr : mapProjection;\n    const dest = 'EPSG:' + toProjection;\n\n    try {\n      lonLat = olproj.transform(lonLat, source, dest) as [number, number];\n    } catch (e) {\n      return {\n        lonLat: undefined,\n        message: 'Projection ' + source + ' not supported',\n        radius: undefined,\n        conf: undefined\n      };\n    }\n  }\n  if (Math.abs(lonLat[0]) <= 180 && Math.abs(lonLat[1]) <= 90) {\n    return {\n      lonLat,\n      message: '',\n      radius: radius ? parseInt(radius, 10) : undefined,\n      conf: conf ? parseInt(conf, 10) : undefined\n    };\n  } else {\n    return {\n      lonLat: undefined,\n      message: 'Coordinate out of Longitude/Latitude bounds',\n      radius: undefined,\n      conf: undefined\n    };\n  }\n}\n\n/**\n * Convert degrees minutes seconds to dd\n * @param degrees Degrees\n * @param minutes Minutes\n * @param seconds Seconds\n * @param direction Direction\n */\nfunction convertDMSToDD(\n  degrees: number,\n  minutes: number,\n  seconds: number,\n  direction: string\n) {\n  minutes = minutes || 0;\n  seconds = seconds || 0;\n\n  const neg = degrees < 0;\n  let dd = Math.abs(degrees) + minutes / 60 + seconds / 3600;\n\n  if (neg || direction === 'S' || direction === 'W') {\n    dd = -dd;\n  } // Don't do anything for N or E\n  return dd;\n}\n\n/**\n * Convert dd to degrees minutes seconds\n * @param lonLatDD longitude and latitude in dd\n * @param decimal number of decimals for seconds\n * @returns longitude and latitude in dms\n */\nexport function convertDDToDMS(\n  lonLatDD: [number, number], decimal: number = 3\n): string[] {\n  const lonLatDMS = [];\n\n  lonLatDD.forEach(dd => {\n    const degrees = dd < 0 ? Math.ceil(dd) : Math.floor(dd);\n    const int = dd < 0 ? (degrees - dd) * 60 : (dd - degrees) * 60;\n    const minutes = Math.floor(int);\n    const seconds = ((int - minutes) * 60).toFixed(decimal);\n\n    lonLatDMS.push(`${degrees} ${minutes}' ${seconds}\"`);\n  });\n  return lonLatDMS;\n}\n\n/**\n * Return true of two view states are equal.\n * @param state1 View state\n * @param state2 View state\n * @returns True if the view states are equal\n */\nexport function viewStatesAreEqual(\n  state1: MapViewState,\n  state2: MapViewState\n): boolean {\n  if (state1 === undefined || state2 === undefined) {\n    return false;\n  }\n\n  const tolerance = 1 / 10000;\n  return (\n    state1.zoom === state2.zoom &&\n    Math.trunc(state1.center[0] / tolerance) ===\n      Math.trunc(state2.center[0] / tolerance) &&\n    Math.trunc(state1.center[1] / tolerance) ===\n      Math.trunc(state2.center[1] / tolerance)\n  );\n}\n\n/**\n * Format the scale to a human readable text\n * @param Scale of the map\n * @returns Human readable scale text\n */\nexport function formatScale(scale) {\n  scale = Math.round(scale);\n  if (scale < 10000) {\n    return scale + '';\n  }\n\n  scale = Math.round(scale / 1000);\n  if (scale < 1000) {\n    return scale + 'K';\n  }\n\n  scale = Math.round(scale / 1000);\n  return scale + 'M';\n}\n\n/**\n * Return the resolution from a scale denom\n * @param scale Scale denom\n * @param dpi DPI\n * @returns Resolution\n */\nexport function getResolutionFromScale(\n  scale: number,\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return scale / (inchesPerMeter * dpi);\n}\n\n/**\n * Return the resolution from a scale denom\n * @param Scale denom\n * @returns Resolution\n */\nexport function getScaleFromResolution(\n  resolution: number,\n  unit: string = 'm',\n  dpi: number = 96\n): number {\n  const inchesPerMeter = 39.3701;\n  return resolution * olproj.METERS_PER_UNIT[unit] * inchesPerMeter * dpi;\n}\n\n/**\n * Returns true if the CTRL key is pushed during an Ol MapBrowserPointerEvent\n * @param event OL MapBrowserPointerEvent\n * @returns Whether the CTRL key is pushed\n */\nexport function ctrlKeyDown(event: MapBrowserPointerEvent<any>): boolean {\n  const originalEvent = event.originalEvent;\n  return (\n    !originalEvent.altKey &&\n    (MAC ? originalEvent.metaKey : originalEvent.ctrlKey) &&\n    !originalEvent.shiftKey\n  );\n}\n\nexport function roundCoordTo(coord: [number, number], decimal: number = 3): [number, number] {\n  return [\n    NumberUtils.roundToNDecimal(coord[0], decimal),\n    NumberUtils.roundToNDecimal(coord[1], decimal)] as [number, number];\n}\n\nexport function roundCoordToString(coord: [number, number], decimal: number = 3): [string, string]{\n    return roundCoordTo(coord, decimal).map(r => r.toString()) as [string, string];\n}\n\n/**\n * Returns an array of converted coordinates.\n * Conversion is done for every configured projections\n * and for the current UTM zone and MTM zone.\n * @param lonLat [number, number] array of the coordinate to transform.\n * @param projections  Projection[] Array of destination projection.\n * @param reverseCoords To reverse coords from latLon to lonLat (search option)\n * @returns Returns an array of converted coordinates.\n */\nexport function lonLatConversion(\n  lonLat: [number, number],\n  projections: Projection[]\n): {\n  code: string;\n  alias: string;\n  coord: [number, number];\n  igo2CoordFormat: string;\n}[] {\n  const rawCoord3857 = olproj.transform(lonLat, 'EPSG:4326', 'EPSG:3857') as [number, number];\n  const convertedLonLat = [\n    {\n      code: 'EPSG:3857',\n      alias: 'Web Mercator',\n      coord: rawCoord3857,\n      igo2CoordFormat: `${roundCoordTo(rawCoord3857).join(', ')} ; 3857`\n    }\n  ];\n\n  // detect the current utm zone.\n  const utmZone = utmZoneFromLonLat(lonLat);\n  const epsgUtm = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n  const utmName = `UTM-${utmZone}`;\n  const rawCoordUtm = olproj.transform(lonLat, 'EPSG:4326', epsgUtm) as [number, number];\n  convertedLonLat.push({\n    code: epsgUtm,\n    alias: 'UTM',\n    coord: rawCoordUtm,\n    igo2CoordFormat: `${utmName} ${roundCoordTo(rawCoordUtm).join(', ')}`\n  });\n\n  // detect the current mtm zone.\n  const mtmZone = mtmZoneFromLonLat(lonLat);\n  if (mtmZone) {\n    const epsgMtm =\n      mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n    const mtmName = `MTM-${mtmZone}`;\n    const rawCoordMtm = olproj.transform(lonLat, 'EPSG:4326', epsgMtm) as [number, number];\n    convertedLonLat.push({\n      code: epsgMtm,\n      alias: 'MTM',\n      coord: rawCoordMtm,\n      igo2CoordFormat: `${mtmName} ${roundCoordTo(rawCoordMtm).join(', ')}`\n    });\n  }\n\n  projections.forEach(projection => {\n    const rawCoord = olproj.transform(lonLat, 'EPSG:4326', projection.code) as [number, number];\n    const numericEpsgCode = projection.code.split(':')[1];\n    convertedLonLat.push({\n      code: projection.code,\n      alias: projection.alias || projection.code,\n      coord: rawCoord,\n      igo2CoordFormat: `${roundCoordTo(rawCoord).join(', ')} ; ${numericEpsgCode}`\n    });\n  });\n\n  return convertedLonLat;\n}\n\n/**\n * Detect the current utm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the UTM zone.\n * @returns number The UTM zone.\n */\nexport function utmZoneFromLonLat(lonLat: [number, number]) {\n  return Math.ceil((lonLat[0] + 180) / 6);\n}\n\n/**\n * Detect the current mtm zone of the lon/lat coordinate.\n * @param lonLat [number, number] array of the coordinate to detect the MTM zone.\n * @returns number The MTM zone. Undefined if outside of the mtm application zone.\n */\nexport function mtmZoneFromLonLat(lonLat: [number, number]) {\n  const long = lonLat[0];\n  let mtmZone;\n  if (long < -51 && long > -54) {\n    mtmZone = 1;\n  }\n  if (long < -54 && long > -57) {\n    mtmZone = 2;\n  }\n  if (long < -57 && long > -60) {\n    mtmZone = 3;\n  }\n  if (long < -60 && long > -63) {\n    mtmZone = 4;\n  }\n  if (long < -63 && long > -66) {\n    mtmZone = 5;\n  }\n  if (long < -66 && long > -69) {\n    mtmZone = 6;\n  }\n  if (long < -69 && long > -72) {\n    mtmZone = 7;\n  }\n  if (long < -72 && long > -75) {\n    mtmZone = 8;\n  }\n  if (long < -75 && long > -78) {\n    mtmZone = 9;\n  }\n  if (long < -78 && long > -81) {\n    mtmZone = 10;\n  }\n  return mtmZone;\n}\n","import {\n  BehaviorSubject,\n  Observable,\n  Subject,\n  Subscription,\n  combineLatest\n} from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\n\nimport { AuthInterceptor } from '@igo2/auth';\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { DataSource, Legend } from '../../../datasource';\nimport { IgoMap } from '../../../map/shared/map';\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\n\nimport { LayerOptions } from './layer.interface';\nimport { Message, MessageService } from '@igo2/core';\n\nexport abstract class Layer {\n  public collapsed: boolean;\n  public dataSource: DataSource;\n  public legend: Legend[];\n  public legendCollapsed: boolean = true;\n  public firstLoadComponent: boolean = true;\n  public map: IgoMap;\n  public ol: olLayer<olSource>;\n  public olLoadingProblem: boolean = false;\n  public status$: Subject<SubjectStatus>;\n  public hasBeenVisible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n  private hasBeenVisible$$: Subscription;\n  private resolution$$: Subscription;\n\n  /**\n   * Define if a layer is generated by code OR defined by layer/context user layer.\n   * Useful for filtering layers list in mapOffline.directive or in the sharemap...\n   * return false by default.\n   */\n  get isIgoInternalLayer(): boolean {\n    return this.options.isIgoInternalLayer || false;\n  }\n\n  get id(): string {\n    return this.options.id || this.dataSource.id;\n  }\n\n  get alias(): string {\n    return this.options.alias;\n  }\n\n  get title(): string {\n    return this.options.title;\n  }\n\n  set title(title: string) {\n    this.options.title = title;\n  }\n\n  get zIndex(): number {\n    return this.ol.getZIndex();\n  }\n\n  set zIndex(zIndex: number) {\n    this.ol.setZIndex(zIndex);\n  }\n\n  get baseLayer(): boolean {\n    return this.options.baseLayer;\n  }\n\n  set baseLayer(baseLayer: boolean) {\n    this.options.baseLayer = baseLayer;\n  }\n\n  get opacity(): number {\n    return this.ol.get('opacity');\n  }\n\n  set opacity(opacity: number) {\n    this.ol.setOpacity(opacity);\n  }\n\n  set isInResolutionsRange(value: boolean) {\n    this.isInResolutionsRange$.next(value);\n  }\n  get isInResolutionsRange(): boolean {\n    return this.isInResolutionsRange$.value;\n  }\n  readonly isInResolutionsRange$: BehaviorSubject<\n    boolean\n  > = new BehaviorSubject(false);\n\n  set maxResolution(value: number) {\n    this.ol.setMaxResolution(value || Infinity);\n    this.updateInResolutionsRange();\n  }\n  get maxResolution(): number {\n    return this.ol.getMaxResolution();\n  }\n\n  set minResolution(value: number) {\n    this.ol.setMinResolution(value || 0);\n    this.updateInResolutionsRange();\n  }\n  get minResolution(): number {\n    return this.ol.getMinResolution();\n  }\n\n  set visible(value: boolean) {\n    this.ol.setVisible(value);\n    this.visible$.next(value);\n    if (!this.hasBeenVisible$.value && value){\n      this.hasBeenVisible$.next(value);\n    }\n    if (this.options?.messages && value) {\n      this.options?.messages\n        .filter(m => m.options?.showOnEachLayerVisibility)\n        .map(message =>\n          this.showMessage(message)\n        );\n    }\n  }\n  get visible(): boolean {\n    return this.visible$.value;\n  }\n  readonly visible$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  get displayed(): boolean {\n    return this.visible && this.isInResolutionsRange;\n  }\n  readonly displayed$: Observable<boolean> = combineLatest([\n    this.isInResolutionsRange$,\n    this.visible$\n  ]).pipe(map((bunch: [boolean, boolean]) => bunch[0] && bunch[1]));\n\n  get showInLayerList(): boolean {\n    return this.options.showInLayerList !== false;\n  }\n\n\n  constructor(\n    public options: LayerOptions,\n    protected messageService?: MessageService,\n    protected authInterceptor?: AuthInterceptor\n  ) {\n    this.dataSource = options.source;\n\n    this.ol = this.createOlLayer();\n    if (options.zIndex !== undefined) {\n      this.zIndex = options.zIndex;\n    }\n\n    if (options.baseLayer && options.visible === undefined) {\n      options.visible = false;\n    }\n\n    this.maxResolution = options.maxResolution || getResolutionFromScale(Number(options.maxScaleDenom));\n    this.minResolution = options.minResolution || getResolutionFromScale(Number(options.minScaleDenom));\n\n    this.visible = options.visible === undefined ? true : options.visible;\n    this.opacity = options.opacity === undefined ? 1 : options.opacity;\n\n    if (\n      options.legendOptions &&\n      (options.legendOptions.url || options.legendOptions.html)\n    ) {\n      this.legend = this.dataSource.setLegend(options.legendOptions);\n    }\n\n    this.legendCollapsed = options.legendOptions\n      ? options.legendOptions.collapsed\n        ? options.legendOptions.collapsed\n        : true\n      : true;\n\n    this.ol.set('_layer', this, true);\n  }\n\n  protected abstract createOlLayer(): olLayer<olSource>;\n\n  setMap(igoMap: IgoMap | undefined) {\n    this.map = igoMap;\n\n    this.unobserveResolution();\n    if (igoMap !== undefined) {\n      this.observeResolution();\n      this.hasBeenVisible$$ = this.hasBeenVisible$.subscribe(() => {\n        if (this.options.messages && this.visible) {\n          this.options.messages.map(message => {\n            this.showMessage(message);\n          });\n        }\n      });\n    }\n  }\n\n  private showMessage(message: Message) {\n    if (!this.messageService) {\n      return;\n    }\n    message.title = message.title;\n    message.text = message.text;\n    this.messageService.message(message as Message);\n  }\n\n  private observeResolution() {\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(() =>\n      this.updateInResolutionsRange()\n    );\n  }\n\n  private unobserveResolution() {\n    if (this.resolution$$ !== undefined) {\n      this.resolution$$.unsubscribe();\n      this.resolution$$ = undefined;\n    }\n  }\n\n  private updateInResolutionsRange() {\n    if (this.map !== undefined) {\n      const resolution = this.map.viewController.getResolution();\n      const minResolution = this.minResolution;\n      const maxResolution = this.maxResolution === undefined ? Infinity : this.maxResolution;\n      this.isInResolutionsRange = resolution >= minResolution && resolution <= maxResolution;\n    } else {\n      this.isInResolutionsRange = false;\n    }\n  }\n}\n","export enum OgcFilterOperatorType {\n    BasicNumericOperator = 'basicnumericoperator',\n    Basic = 'basic',\n    BasicAndSpatial = 'basicandspatial',\n    Spatial = 'spatial',\n    All = 'all',\n    Time = 'time'\n}\n\nexport enum OgcFilterOperator {\n    BBOX = 'BBox',\n    PropertyIsBetween = 'PropertyIsBetween',\n    Contains = 'Contains',\n    During = 'During',\n    PropertyIsEqualTo = 'PropertyIsEqualTo',\n    PropertyIsGreaterThan = 'PropertyIsGreaterThan',\n    PropertyIsGreaterThanOrEqualTo = 'PropertyIsGreaterThanOrEqualTo',\n    Intersects = 'Intersects',\n    PropertyIsNull = 'PropertyIsNull',\n    PropertyIsLessThan = 'PropertyIsLessThan',\n    PropertyIsLessThanOrEqualTo = 'PropertyIsLessThanOrEqualTo',\n    PropertyIsLike = 'PropertyIsLike',\n    PropertyIsNotEqualTo = 'PropertyIsNotEqualTo',\n    Within = 'Within',\n    And = 'And',\n    Or = 'Or',\n    Not = 'Not'\n}\n","import * as olfilter from 'ol/format/filter';\nimport olFormatWKT from 'ol/format/WKT';\nimport olFormatWFS, { WriteGetFeatureOptions } from 'ol/format/WFS';\nimport olGeometry from 'ol/geom/Geometry';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { uuid, ObjectUtils } from '@igo2/utils';\n\nimport {\n  OgcFilter,\n  IgoOgcFilterObject,\n  AnyBaseOgcFilterOptions,\n  OgcInterfaceFilterOptions,\n  OgcFilterableDataSourceOptions,\n  OgcFiltersOptions,\n  IgoOgcSelector,\n  SelectorGroup,\n  OgcSelectorBundle\n} from './ogc-filter.interface';\nimport { OgcFilterOperatorType, OgcFilterOperator } from './ogc-filter.enum';\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport { default as moment } from 'moment';\nexport class OgcFilterWriter {\n  private filterSequence: OgcInterfaceFilterOptions[] = [];\n  public operators = {\n    [OgcFilterOperator.PropertyIsEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsNotEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.PropertyIsLike as string]: {\n      spatial: false,\n      fieldRestrict: ['string']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThan as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsLessThanOrEqualTo as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.PropertyIsBetween as string]: {\n      spatial: false,\n      fieldRestrict: ['number']\n    },\n    [OgcFilterOperator.During as string]: { spatial: false, fieldRestrict: [] },\n    [OgcFilterOperator.PropertyIsNull as string]: {\n      spatial: false,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Intersects as string]: {\n      spatial: true,\n      fieldRestrict: []\n    },\n    [OgcFilterOperator.Within as string]: { spatial: true, fieldRestrict: [] },\n    [OgcFilterOperator.Contains as string]: { spatial: true, fieldRestrict: [] }\n  };\n\n  defineOgcFiltersDefaultOptions(\n    ogcFiltersOptions: OgcFiltersOptions,\n    fieldNameGeometry: string,\n    srcType?: string\n  ): OgcFiltersOptions {\n    let ogcFiltersDefaultValue = true; // default values for wfs.\n    if (srcType && srcType === 'wms') {\n      ogcFiltersDefaultValue = false;\n    }\n\n    ogcFiltersOptions = ogcFiltersOptions || {};\n    ogcFiltersOptions.enabled =\n      ogcFiltersOptions.enabled === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.enabled;\n    ogcFiltersOptions.editable =\n      ogcFiltersOptions.editable === undefined\n        ? ogcFiltersDefaultValue\n        : ogcFiltersOptions.editable;\n    ogcFiltersOptions.geometryName = fieldNameGeometry;\n\n    ogcFiltersOptions.advancedOgcFilters = true;\n    if (ogcFiltersOptions.enabled && (ogcFiltersOptions.pushButtons || ogcFiltersOptions.checkboxes\n      || ogcFiltersOptions.radioButtons || ogcFiltersOptions.select || ogcFiltersOptions.autocomplete)) {\n      ogcFiltersOptions.advancedOgcFilters = false;\n    }\n    return ogcFiltersOptions;\n  }\n\n  public buildFilter(\n    filters?: IgoOgcFilterObject,\n    extent?: [number, number, number, number],\n    proj?: olProjection,\n    fieldNameGeometry?: string,\n    options?: OgcFilterableDataSourceOptions\n  ): string {\n    let ourBboxFilter;\n    let enableBbox: boolean;\n    if (/intersects|contains|within/gi.test(JSON.stringify(filters))) {\n      enableBbox = false;\n    } else {\n      enableBbox = true;\n    }\n    if (filters) {\n      fieldNameGeometry =\n        (filters as any).geometryName !== undefined\n          ? (filters as any).geometryName\n          : fieldNameGeometry;\n    }\n    if (extent && filters) {\n      ourBboxFilter = olfilter.bbox(fieldNameGeometry, extent, proj.getCode());\n    }\n    let filterAssembly: OgcFilter;\n    if (filters) {\n      filters = this.checkIgoFiltersProperties(\n        filters,\n        fieldNameGeometry,\n        proj\n      );\n      if (extent && enableBbox) {\n        filterAssembly = olfilter.and(\n          ourBboxFilter,\n          this.bundleFilter(filters, options)\n        );\n      } else {\n        filterAssembly = this.bundleFilter(filters, options);\n      }\n    } else {\n      return 'bbox=' + extent.join(',') + ',' + proj.getCode();\n    }\n\n    const wfsOptions: WriteGetFeatureOptions = {\n      srsName: '',\n      featureNS: '',\n      featurePrefix: '',\n      featureTypes: ['featureTypes'],\n      filter: filterAssembly,\n      outputFormat: '',\n      geometryName: fieldNameGeometry\n    };\n\n    const query = new olFormatWFS().writeGetFeature(wfsOptions);\n    const str = new XMLSerializer().serializeToString(query);\n    const regexp1 = /typenames *=|typename *=\\\"featureTypes\\\" *>/gi;\n    const regexp2 = /<\\/Query><\\/GetFeature>/gi;\n\n    return 'filter=' + str.split(regexp1)[1].split(regexp2)[0];\n  }\n\n  private bundleFilter(\n    filterObject: any,\n    options?: OgcFilterableDataSourceOptions\n  ) {\n    if (filterObject instanceof Array) {\n      const logicalArray = [];\n      filterObject.forEach((element) => {\n        logicalArray.push(this.bundleFilter(element, options));\n      });\n      return logicalArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return this.createFilter(\n          {\n            operator: filterObject.logical,\n            logicalArray: this.bundleFilter(filterObject.filters, options)\n          },\n          options\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.createFilter(\n          filterObject as AnyBaseOgcFilterOptions,\n          options\n        );\n      }\n    }\n  }\n\n  private createFilter(\n    filterOptions,\n    options?: OgcFilterableDataSourceOptions\n  ): OgcFilter {\n    const operator = filterOptions.operator;\n    const logicalArray = filterOptions.logicalArray;\n\n    const wfsPropertyName = filterOptions.propertyName;\n    const wfsPattern = filterOptions.pattern;\n    const wfsMatchCase = filterOptions.matchCase\n      ? filterOptions.matchCase\n      : true;\n    const wfsWildCard = filterOptions.wildCard ? filterOptions.wildCard : '*';\n    const wfsSingleChar = filterOptions.singleChar\n      ? filterOptions.singleChar\n      : '.';\n    const wfsEscapeChar = filterOptions.escapeChar\n      ? filterOptions.escapeChar\n      : '!';\n\n    const wfsLowerBoundary = filterOptions.lowerBoundary;\n    const wfsUpperBoundary = filterOptions.upperBoundary;\n\n    const wfsGeometryName = filterOptions.geometryName;\n    const wfsExtent = filterOptions.extent;\n    const wfsWktGeometry = filterOptions.wkt_geometry;\n    const wfsSrsName = filterOptions.srsName\n      ? filterOptions.srsName\n      : 'EPSG:3857';\n\n    const wfsBegin = this.parseFilterOptionDate(\n      filterOptions.begin,\n      options ? options.minDate : undefined\n    );\n    const wfsEnd = this.parseFilterOptionDate(\n      filterOptions.end,\n      options ? options.maxDate : undefined\n    );\n\n    const wfsExpression = filterOptions.expression;\n\n    let geometry: olGeometry;\n    if (wfsWktGeometry) {\n      const wkt = new olFormatWKT();\n      geometry = wkt.readGeometry(wfsWktGeometry, {\n        dataProjection: wfsSrsName,\n        featureProjection: wfsSrsName || 'EPSG:3857'\n      });\n    }\n\n    switch (operator.toLowerCase()) {\n      case OgcFilterOperator.BBOX.toLowerCase():\n        return olfilter.bbox(wfsGeometryName, wfsExtent, wfsSrsName);\n      case OgcFilterOperator.PropertyIsBetween.toLowerCase():\n        return olfilter.between(\n          wfsPropertyName,\n          wfsLowerBoundary || 1e40*-1,\n          wfsUpperBoundary || 1e40\n        );\n      case OgcFilterOperator.Contains.toLowerCase():\n        return olfilter.contains(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.During.toLowerCase():\n        return olfilter.during(wfsPropertyName, wfsBegin, wfsEnd);\n      case OgcFilterOperator.PropertyIsEqualTo.toLowerCase():\n        return olfilter.equalTo(wfsPropertyName, wfsExpression, wfsMatchCase);\n      case OgcFilterOperator.PropertyIsGreaterThan.toLowerCase():\n        return olfilter.greaterThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo.toLowerCase():\n        return olfilter.greaterThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.Intersects.toLowerCase():\n        return olfilter.intersects(wfsGeometryName, geometry, wfsSrsName);\n      case OgcFilterOperator.PropertyIsNull.toLowerCase():\n        return olfilter.isNull(wfsPropertyName);\n      case OgcFilterOperator.PropertyIsLessThan.toLowerCase():\n        return olfilter.lessThan(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo.toLowerCase():\n        return olfilter.lessThanOrEqualTo(wfsPropertyName, wfsExpression);\n      case OgcFilterOperator.PropertyIsLike.toLowerCase():\n        return olfilter.like(\n          wfsPropertyName,\n          wfsPattern ? wfsPattern.replace(/[()_]/gi, wfsSingleChar): wfsWildCard,\n          wfsWildCard,\n          wfsSingleChar,\n          wfsEscapeChar,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.PropertyIsNotEqualTo.toLowerCase():\n        return olfilter.notEqualTo(\n          wfsPropertyName,\n          wfsExpression,\n          wfsMatchCase\n        );\n      case OgcFilterOperator.Within.toLowerCase():\n        return olfilter.within(wfsGeometryName, geometry, wfsSrsName);\n      // LOGICAL\n      case OgcFilterOperator.And.toLowerCase():\n        return olfilter.and.apply(null, logicalArray);\n      case OgcFilterOperator.Or.toLowerCase():\n        return olfilter.or.apply(null, logicalArray);\n      case OgcFilterOperator.Not.toLowerCase():\n        return olfilter.not.apply(null, logicalArray);\n\n      default:\n        return undefined;\n    }\n  }\n\n  public defineInterfaceFilterSequence(\n    filterObject: any,\n    geometryName,\n    logical = '',\n    level = -1\n  ): OgcInterfaceFilterOptions[] {\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            element,\n            geometryName,\n            logical,\n            level\n          )\n        );\n      });\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        level = level + 1;\n        this.filterSequence.concat(\n          this.defineInterfaceFilterSequence(\n            filterObject.filters,\n            geometryName,\n            filterObject.logical,\n            level\n          )\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        this.filterSequence.push(\n          this.addInterfaceFilter(filterObject, geometryName, level, logical)\n        );\n      }\n    }\n    return this.filterSequence;\n  }\n\n  public computeAllowedOperators(\n    fields?: SourceFieldsOptionsParams[],\n    propertyName?: string,\n    defaultOperatorsType?: OgcFilterOperatorType\n  ) {\n    let effectiveOperators: {} = {};\n    let allowedOperators;\n    let fieldsHasSpatialOperator: boolean;\n    let includeContains: boolean;\n\n    if (fields && propertyName) {\n      const srcField = fields.find((field) => field.name === propertyName);\n      allowedOperators =\n        srcField && srcField.allowedOperatorsType\n          ? srcField.allowedOperatorsType\n          : defaultOperatorsType;\n    }\n\n    if (fields) {\n      fields.map((field) => {\n        if (!field.allowedOperatorsType) {\n          return;\n        }\n        const allowedOperatorsType = field.allowedOperatorsType.toLowerCase();\n        if (\n          allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.Spatial.toLowerCase() ||\n          allowedOperatorsType ===\n            OgcFilterOperatorType.BasicAndSpatial.toLowerCase()\n        ) {\n          fieldsHasSpatialOperator = true;\n          if (\n            allowedOperatorsType === OgcFilterOperatorType.All.toLowerCase()\n          ) {\n            includeContains = true;\n          }\n        }\n      });\n    }\n\n    allowedOperators = allowedOperators\n      ? allowedOperators\n      : OgcFilterOperatorType.BasicAndSpatial;\n\n    switch (allowedOperators.toLowerCase()) {\n      case OgcFilterOperatorType.All:\n        effectiveOperators = this.operators;\n        break;\n      case OgcFilterOperatorType.Spatial:\n        effectiveOperators = {\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicAndSpatial:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.Basic:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          }\n        };\n        break;\n      case OgcFilterOperatorType.Time:\n        effectiveOperators = {\n          [OgcFilterOperator.During]: { spatial: false, fieldRestrict: [] }\n        };\n        break;\n      case OgcFilterOperatorType.BasicNumericOperator:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsGreaterThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsGreaterThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThan]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          },\n          [OgcFilterOperator.PropertyIsLessThanOrEqualTo]: {\n            spatial: false,\n            fieldRestrict: ['number']\n          }\n        };\n        break;\n      default:\n        effectiveOperators = {\n          [OgcFilterOperator.PropertyIsEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.PropertyIsNotEqualTo]: {\n            spatial: false,\n            fieldRestrict: []\n          },\n          [OgcFilterOperator.Intersects]: { spatial: true, fieldRestrict: [] },\n          [OgcFilterOperator.Within]: { spatial: true, fieldRestrict: [] }\n        };\n    }\n\n    if (fieldsHasSpatialOperator) {\n      (effectiveOperators as any).Intersects = {\n        spatial: true,\n        fieldRestrict: []\n      };\n      (effectiveOperators as any).Within = { spatial: true, fieldRestrict: [] };\n      if (includeContains) {\n        (effectiveOperators as any).Contains = {\n          spatial: true,\n          fieldRestrict: []\n        };\n      }\n    }\n\n    return effectiveOperators;\n  }\n\n  public addInterfaceFilter(\n    igoOgcFilterObject?,\n    geometryName?,\n    level = 0,\n    parentLogical = 'Or'\n  ): OgcInterfaceFilterOptions {\n    if (!igoOgcFilterObject) {\n      igoOgcFilterObject = { operator: 'PropertyIsEqualTo' };\n    }\n    const f = {\n      propertyName: '',\n      operator: '',\n      active: '',\n      filterid: uuid(),\n      step: '',\n      begin: '',\n      end: '',\n      sliderOptions: {},\n      lowerBoundary: '',\n      upperBoundary: '',\n      expression: '',\n      pattern: '',\n      wildCard: '*',\n      singleChar: '.',\n      escapeChar: '!',\n      matchCase: true,\n      igoSpatialSelector: '',\n      igoSNRC: '',\n      geometryName: '',\n      geometry: '',\n      wkt_geometry: '',\n      extent: '',\n      srsName: '',\n      parentLogical: '',\n      level: 0\n    };\n\n    return Object.assign(\n      f,\n      {\n        parentLogical,\n        level,\n        geometryName\n      },\n      igoOgcFilterObject\n    );\n  }\n\n  public checkIgoFiltersProperties(\n    filterObject: any,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterArray = [];\n    if (filterObject instanceof Array) {\n      filterObject.forEach((element) => {\n        filterArray.push(\n          this.checkIgoFiltersProperties(\n            element,\n            fieldNameGeometry,\n            proj,\n            active\n          )\n        );\n      });\n      return filterArray;\n    } else {\n      if (filterObject.hasOwnProperty('logical')) {\n        return Object.assign(\n          {},\n          {\n            logical: filterObject.logical,\n            filters: this.checkIgoFiltersProperties(\n              filterObject.filters,\n              fieldNameGeometry,\n              proj,\n              active\n            )\n          }\n        );\n      } else if (filterObject.hasOwnProperty('operator')) {\n        return this.addFilterProperties(\n          filterObject as OgcInterfaceFilterOptions,\n          fieldNameGeometry,\n          proj,\n          active\n        );\n      }\n    }\n  }\n\n  private addFilterProperties(\n    igoOgcFilterObject: OgcInterfaceFilterOptions,\n    fieldNameGeometry,\n    proj: olProjection,\n    active = false\n  ) {\n    const filterid = igoOgcFilterObject.hasOwnProperty('filterid')\n      ? igoOgcFilterObject.filterid\n      : uuid();\n    const status = igoOgcFilterObject.hasOwnProperty('active')\n      ? igoOgcFilterObject.active\n      : active;\n\n    const srsName = igoOgcFilterObject.hasOwnProperty('srsName')\n      ? igoOgcFilterObject.srsName\n      : proj\n      ? proj.getCode()\n      : 'EPSG:3857';\n\n    return Object.assign(\n      {},\n      {\n        filterid,\n        active: status,\n        igoSpatialSelector: 'fixedExtent',\n        srsName\n      },\n      igoOgcFilterObject,\n      { geometryName: fieldNameGeometry }\n    );\n  }\n\n  public rebuiltIgoOgcFilterObjectFromSequence(\n    sequence: OgcInterfaceFilterOptions[]\n  ): IgoOgcFilterObject {\n    if (sequence instanceof Array) {\n      if (sequence.length >= 1) {\n        let lastParentLogical = sequence[0].parentLogical;\n        let nextElement: any;\n        let logicalArray = [];\n        let lastProcessedFilter;\n        sequence.forEach((uiFilter) => {\n          const element = Object.assign({}, uiFilter);\n          const index = sequence.indexOf(uiFilter);\n          if (index >= 0 && index < sequence.length - 1) {\n            nextElement = sequence[index + 1];\n          } else {\n            nextElement = element;\n          }\n          delete element.active;\n          delete element.filterid;\n          delete element.parentLogical;\n          logicalArray.push(element);\n\n          if (sequence.length === 1) {\n            lastProcessedFilter = element;\n          } else if (lastParentLogical !== nextElement.parentLogical) {\n            if (logicalArray.length === 1) {\n              console.log(\n                'You must set at ' +\n                  'least two operator in a logical (' +\n                  lastParentLogical +\n                  ')'\n              );\n            } else {\n              lastProcessedFilter = Object.assign(\n                {},\n                { logical: lastParentLogical, filters: logicalArray }\n              );\n              logicalArray = [lastProcessedFilter];\n              lastParentLogical = nextElement.parentLogical;\n            }\n          }\n        });\n        return lastProcessedFilter;\n      } else {\n        return undefined;\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  private computeIgoSelector(selectors: IgoOgcSelector): IgoOgcSelector {\n    if (\n      selectors.groups.every((group) => group.computedSelectors !== undefined)\n    ) {\n      return selectors;\n    }\n    let selector: IgoOgcSelector;\n    if (selectors.groups && selectors.bundles) {\n      if (!selectors.bundles.every((bundle) => bundle.id !== undefined)) {\n        throw new Error(\n          'You must set an id for each of your bundles'\n        );\n      }\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups.forEach((group) => {\n        group.title = group.title ? group.title : group.name;\n        group.enabled = group.enabled ? group.enabled : false;\n        group.computedSelectors = ObjectUtils.copyDeep(\n          selector.bundles.filter((b) => group.ids.includes(b.id))\n        );\n      });\n    } else if (!selectors.groups && selectors.bundles) {\n      selector = ObjectUtils.copyDeep(selectors);\n      selector.groups = [\n        {\n          title: 'group1',\n          name: 'group1',\n          computedSelectors: ObjectUtils.copyDeep(selector.bundles)\n        } as SelectorGroup\n      ];\n    } else {\n      selector = {\n        bundles: selectors as any,\n        groups: [\n          {\n            title: 'group1',\n            name: 'group1',\n            computedSelectors: ObjectUtils.copyDeep(\n              selectors\n            ) as OgcSelectorBundle[]\n          } as SelectorGroup\n        ],\n        selectorType: selector.selectorType\n      };\n    }\n    if (!selector.groups.find((selectorGroup) => selectorGroup.enabled)) {\n      selector.groups[0].enabled = true;\n    }\n    return selector;\n  }\n\n  public handleOgcFiltersAppliedValue(\n    options: OgcFilterableDataSourceOptions,\n    fieldNameGeometry: string,\n    extent?: [number, number, number, number],\n    proj?: olProjection\n  ): string {\n    const ogcFilters = options.ogcFilters;\n    if (!ogcFilters) {\n      return;\n    }\n    const conditions = [];\n    let filterQueryStringSelector = '';\n    let filterQueryStringAdvancedFilters = '';\n    if (ogcFilters.enabled && (ogcFilters.pushButtons || ogcFilters.checkboxes || ogcFilters.radioButtons || ogcFilters.select\n      || ogcFilters.autocomplete)) {\n      let selectors;\n      if (ogcFilters.pushButtons) {\n        selectors = ogcFilters.pushButtons;\n        const pushConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of pushConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.checkboxes) {\n        selectors = ogcFilters.checkboxes;\n        const checkboxConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of checkboxConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.radioButtons) {\n        selectors = ogcFilters.radioButtons;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const radioConditions = this.formatGroupAndFilter(ogcFilters, selectorsCorr);\n        for (const condition of radioConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.select) {\n        selectors = ogcFilters.select;\n        const selectorsCorr = this.verifyMultipleEnableds(selectors);\n        const selectConditions = this.formatGroupAndFilter(ogcFilters, selectorsCorr);\n        for (const condition of selectConditions) {\n          conditions.push(condition);\n        }\n      }\n      if (ogcFilters.autocomplete) {\n        selectors = ogcFilters.autocomplete;\n        const selectConditions = this.formatGroupAndFilter(ogcFilters, selectors);\n        for (const condition of selectConditions) {\n          conditions.push(condition);\n        }\n      }\n\n      if (conditions.length >= 1) {\n        filterQueryStringSelector = this.buildFilter(\n          conditions.length === 1\n            ? conditions[0]\n            : { logical: 'And', filters: conditions },\n          extent,\n          proj,\n          ogcFilters.geometryName\n        );\n      }\n    }\n    if (ogcFilters.enabled && ogcFilters.filters) {\n      ogcFilters.geometryName = ogcFilters.geometryName || fieldNameGeometry;\n      const igoFilters = ogcFilters.filters;\n      filterQueryStringAdvancedFilters = this.buildFilter(\n        igoFilters,\n        extent,\n        proj,\n        ogcFilters.geometryName,\n        options\n      );\n    }\n\n    let filterQueryString = ogcFilters.advancedOgcFilters\n      ? filterQueryStringAdvancedFilters\n      : filterQueryStringSelector;\n    if (options.type === 'wms') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.LAYERS\n      );\n    }\n    if (options.type === 'wfs') {\n      filterQueryString = this.formatProcessedOgcFilter(\n        filterQueryString,\n        (options as any).params.featureTypes\n      );\n    }\n\n    return filterQueryString;\n  }\n\n  public verifyMultipleEnableds(selectors) {\n    selectors.bundles.forEach(bundle => {\n      if (!bundle.multiple && bundle.selectors) {\n        const enableds = bundle.selectors.reduce((list, filter, index) => (filter.enabled) === true ? list.concat(index) : list, []);\n        if (enableds.length > 1) {\n          enableds.splice(0, 1);\n          enableds.forEach(index => {\n            bundle.selectors[index].enabled = false;\n          });\n        }\n      }\n    });\n    return selectors;\n  }\n\n  public formatGroupAndFilter(ogcFilters: OgcFiltersOptions, selectors) {\n    selectors = this.computeIgoSelector(\n      selectors\n    );\n    const selectorBundle = selectors.groups.find(\n      (g) => g.enabled\n    ).computedSelectors;\n    const conditions = [];\n    selectorBundle.map((bundle) => {\n      const bundleCondition = [];\n      const selectorsType = bundle.selectors as any;\n      if (!selectorsType) {\n        return;\n      }\n      selectorsType\n        .filter((ogcselector) => ogcselector.enabled === true)\n        .forEach((enabledSelector) => bundleCondition.push(enabledSelector.filters));\n      if (bundleCondition.length === 1) {\n        conditions.push(bundleCondition[0]);\n      } else if (bundleCondition.length > 1) {\n        conditions.push({\n          logical: bundle.logical,\n          filters: bundleCondition\n        });\n      }\n    });\n\n    if (selectors.selectorType === 'pushButton') {\n      ogcFilters.pushButtons = selectors;\n    } else if (selectors.selectorType === 'checkbox') {\n      ogcFilters.checkboxes = selectors;\n    } else if (selectors.selectorType === 'radioButton') {\n      ogcFilters.radioButtons = selectors;\n    } else if (selectors.selectorType === 'select') {\n      ogcFilters.select = selectors;\n    } else if (selectors.selectorType === 'autocomplete') {\n      ogcFilters.autocomplete = selectors;\n    }\n    return conditions;\n  }\n\n  public formatProcessedOgcFilter(\n    processedFilter: string,\n    layersOrTypenames: string\n  ): string {\n\n    if (!processedFilter) {return undefined;};\n    let appliedFilter = '';\n    if (processedFilter.length === 0 && layersOrTypenames.indexOf(',') === -1) {\n      appliedFilter = processedFilter;\n    } else {\n      layersOrTypenames.split(',').forEach((layerOrTypenames) => {\n        appliedFilter = `${appliedFilter}(${processedFilter.replace(\n          'filter=',\n          ''\n        )})`;\n      });\n    }\n    appliedFilter = appliedFilter.replace(/\\(\\)/g, '');\n    const filterValue =\n      appliedFilter.length > 0\n        ? appliedFilter.replace('filter=', '')\n        : undefined;\n    return filterValue;\n  }\n\n  public parseFilterOptionDate(value: string, defaultValue?: string): string {\n    if (!value) {\n      return defaultValue;\n    } else if (value === 'today') {\n      return undefined;\n    } else if (moment(value).isValid()) {\n      return value;\n    } else {\n      return undefined;\n    }\n  }\n}\n","import { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\n\nimport * as OlFormat from 'ol/format';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport olFormatGML32 from 'ol/format/GML32';\nimport olFormatOSMXML from 'ol/format/OSMXML';\nimport olProjection from 'ol/proj/Projection';\n\nexport const defaultEpsg = 'EPSG:3857';\nexport const defaultMaxFeatures = 5000;\nexport const defaultWfsVersion = '2.0.0';\nexport const defaultFieldNameGeometry = 'geometry';\nexport const gmlRegex = new RegExp(/(.*)?gml(.*)?/gi);\nexport const jsonRegex = new RegExp(/(.*)?json(.*)?/gi);\n\n\n/**\n * This method build the WFS URL based on the layer property.\n * @param options  WFSDataSourceOptions The common wfs datasource options interface\n * @param extent  An extent like array [number, number, number, number]\n * @param proj  olProjection\n * @param ogcFilters  OgcFiltersOptions\n * @returns A string representing the datasource options, based on filter and views\n */\nexport function buildUrl(\n  options: WFSDataSourceOptions,\n  extent,\n  proj: olProjection,\n  ogcFilters: OgcFiltersOptions,\n  randomParam?: boolean): string {\n  const paramsWFS = options.paramsWFS;\n  const queryStringValues = formatWFSQueryString(options, undefined, options.paramsWFS.srsName);\n  let igoFilters;\n  if (ogcFilters && ogcFilters.enabled) {\n    igoFilters = ogcFilters.filters;\n  }\n  const ogcFilterWriter = new OgcFilterWriter();\n  const filterOrBox = ogcFilterWriter.buildFilter(igoFilters, extent, proj, ogcFilters.geometryName, options);\n  let filterOrPush = ogcFilterWriter.handleOgcFiltersAppliedValue(options, ogcFilters.geometryName, extent, proj);\n\n  let prefix = 'filter';\n  if (!filterOrPush) {\n    prefix = 'bbox';\n    filterOrPush = extent.join(',') + ',' + proj.getCode();\n  }\n\n  paramsWFS.xmlFilter = ogcFilters.advancedOgcFilters ? filterOrBox : `${prefix}=${filterOrPush}`;\n  let baseUrl = queryStringValues.find(f => f.name === 'getfeature').value;\n  const patternFilter = /(filter|bbox)=.*/gi;\n  baseUrl = patternFilter.test(paramsWFS.xmlFilter) ? `${baseUrl}&${paramsWFS.xmlFilter}` : baseUrl;\n  options.download = Object.assign({}, options.download, { dynamicUrl: baseUrl });\n  if (randomParam) {\n    baseUrl += `$&_t${new Date().getTime()}`;\n  }\n  return baseUrl.replace(/&&/g, '&');\n}\n\n\n/**\n * This method build/standardize WFS call query params based on the layer property.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @param count  Number: Used to control the number of feature. Used to bypass whe wfs datasource options interface (maxFeatures)\n * @param epsg  String: Used to control the EPSG code (es: 'EPSG3857'). Used to bypass whe wfs datasource options interface (srsName)\n * @param properties  String: Used to control the queried fields  (WFS service).\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function formatWFSQueryString(\n  dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n  count?: number,\n  epsg?: string,\n  properties?: string,\n  startIndex: number = 0,\n  forceDefaultOutputFormat: boolean = false\n): { name: string; value: string }[] {\n  const versionWfs200 = '2.0.0'; // not the same usage as defaultWfsVersion.\n  const url = dataSourceOptions.urlWfs;\n  const paramsWFS = dataSourceOptions.paramsWFS;\n  const effectiveCount = count || defaultMaxFeatures;\n  const effectiveStartIndex = paramsWFS.version === versionWfs200 ? `startIndex=${startIndex}` : '';\n  const epsgCode = epsg || defaultEpsg;\n  let outputFormat = paramsWFS.outputFormat\n    ? `outputFormat=${paramsWFS.outputFormat}`\n    : '';\n  let version = paramsWFS.version\n    ? `version=${paramsWFS.version}`\n    : `version=${defaultWfsVersion}`;\n  const paramTypename =\n    paramsWFS.version === versionWfs200 ? 'typenames' : 'typename';\n  const featureTypes = `${paramTypename}=${paramsWFS.featureTypes}`;\n  const paramMaxFeatures =\n    paramsWFS.version === versionWfs200 ? 'count' : 'maxFeatures';\n  let cnt = count\n    ? `${paramMaxFeatures}=${effectiveCount}`\n    : paramsWFS.maxFeatures\n    ? `${paramMaxFeatures}=${paramsWFS.maxFeatures}`\n    : `${paramMaxFeatures}=${effectiveCount}`;\n  if (forceDefaultOutputFormat) {\n      outputFormat = '';\n      version = 'version=1.1.0';\n      cnt = cnt.replace('count', 'maxFeatures');\n    }\n\n  const srs = epsg\n    ? `srsname=${epsgCode}`\n    : paramsWFS.srsName\n    ? 'srsname=' + paramsWFS.srsName\n    : `srsname=${epsgCode}`;\n\n  let propertyName = '';\n  let valueReference = '';\n  if (properties) {\n    propertyName = `propertyName=${properties}`;\n    valueReference = `valueReference=${properties}`;\n  }\n  const sourceFields = dataSourceOptions.sourceFields;\n  if (!propertyName && sourceFields && sourceFields.length > 0) {\n    const fieldsNames = [];\n    dataSourceOptions.sourceFields.forEach(sourcefield => {\n      fieldsNames.push(sourcefield.name);\n    });\n    propertyName = `propertyName=${fieldsNames.join(',')},${\n      paramsWFS.fieldNameGeometry\n    }`;\n  }\n\n  const separator = url.indexOf('?') === -1 ? '?' : '&';\n  const getCapabilities = `${url}${separator}service=WFS&request=GetCapabilities&${version}`;\n  let getFeature = `${url}${separator}service=WFS&request=GetFeature&${version}&${featureTypes}&`;\n  getFeature += `${outputFormat}&${srs}&${cnt}&${propertyName}&${effectiveStartIndex}`;\n\n  let getpropertyvalue = `${url}?service=WFS&request=GetPropertyValue&version=${versionWfs200}&${featureTypes}&`;\n  getpropertyvalue += `&${cnt}&${valueReference}`;\n\n  return [\n    { name: 'outputformat', value: outputFormat },\n    { name: 'version', value: version },\n    { name: 'typename', value: featureTypes },\n    { name: 'count', value: cnt },\n    { name: 'srsname', value: srs },\n    { name: 'propertyname', value: propertyName },\n    { name: 'valuereference', value: valueReference },\n    { name: 'getcapabilities', value: getCapabilities.replace(/&&/g, '&') },\n    { name: 'getfeature', value: getFeature.replace(/&&/g, '&') },\n    { name: 'getpropertyvalue', value: getpropertyvalue.replace(/&&/g, '&') }\n  ];\n}\n\n/**\n * Validate/Modify layer's wfs options based on :\n * 1- an Openlayers's issue with GML provided from WFS. Refer to\n * https://github.com/openlayers/openlayers/pull/6400\n * 2- Set default values for optionals parameters.\n * @param wfsDataSourceOptions  WFSDataSourceOptions The common wfs datasource options interface\n * @returns An array array of {name: '', value: ''} of predefined query params.\n */\nexport function checkWfsParams(wfsDataSourceOptions, srcType?: string) {\n  if (srcType && srcType === 'wfs') {\n    // reassignation of params to paramsWFS and url to urlWFS to have a common interface with wms-wfs datasources\n    wfsDataSourceOptions.paramsWFS = wfsDataSourceOptions.params;\n  }\n\n  const paramsWFS = wfsDataSourceOptions.paramsWFS;\n  wfsDataSourceOptions.urlWfs =\n    wfsDataSourceOptions.urlWfs || wfsDataSourceOptions.url;\n\n  paramsWFS.version = paramsWFS.version || defaultWfsVersion;\n  paramsWFS.fieldNameGeometry =\n    paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n  paramsWFS.maxFeatures = paramsWFS.maxFeatures || defaultMaxFeatures;\n\n  let outputFormat;\n  if (paramsWFS.outputFormat) {\n    outputFormat = paramsWFS.outputFormat;\n  }\n\n  if (gmlRegex.test(outputFormat) || !outputFormat) {\n    paramsWFS.version = '1.1.0';\n  }\n  return Object.assign({}, wfsDataSourceOptions);\n}\n\nexport function getFormatFromOptions(\n  options: WFSDataSourceOptions | WMSDataSourceOptions\n) {\n  const wfsOptions = options as WFSDataSourceOptions;\n\n  let olFormatCls;\n  const outputFormat = wfsOptions.paramsWFS.outputFormat\n    ? wfsOptions.paramsWFS.outputFormat\n    : undefined;\n\n  if (!outputFormat) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  if (OlFormat[outputFormat]) {\n    olFormatCls = OlFormat[outputFormat];\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gml2')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ...{ gmlFormat: olFormatGML2 }});\n  } else if (outputFormat.toLowerCase().match('gml32')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ...{ gmlFormat: olFormatGML32 }});\n  } else if (outputFormat.toLowerCase().match('gml3')) {\n    olFormatCls = OlFormat.WFS;\n    return new olFormatCls({ ...wfsOptions.formatOptions, ...{ gmlFormat: olFormatGML3 }});\n  } else if (outputFormat.toLowerCase().match('topojson')) {\n    olFormatCls = OlFormat.TopoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('geojson')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('esrijson')) {\n    olFormatCls = OlFormat.EsriJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('json')) {\n    olFormatCls = OlFormat.GeoJSON;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('gpx')) {\n    olFormatCls = OlFormat.GPX;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('WKT')) {\n    olFormatCls = OlFormat.WKT;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('osmxml')) {\n    olFormatCls = olFormatOSMXML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  } else if (outputFormat.toLowerCase().match('kml')) {\n    olFormatCls = OlFormat.KML;\n    return new olFormatCls(wfsOptions.formatOptions);\n  }\n\n  return new olFormatCls();\n}\n","import olLayerVector from 'ol/layer/Vector';\nimport olSourceVector from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { unByKey } from 'ol/Observable';\nimport { easeOut } from 'ol/easing';\nimport { asArray as ColorAsArray } from 'ol/color';\nimport { getVectorContext } from 'ol/render';\nimport olFeature from 'ol/Feature';\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\n\nimport { FeatureDataSource } from '../../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSource } from '../../../datasource/shared/datasources/wfs-datasource';\nimport { ArcGISRestDataSource } from '../../../datasource/shared/datasources/arcgisrest-datasource';\nimport { WebSocketDataSource } from '../../../datasource/shared/datasources/websocket-datasource';\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\n\nimport { VectorWatcher } from '../../utils';\nimport { IgoMap, MapExtent } from '../../../map';\nimport { Layer } from './layer';\nimport { VectorLayerOptions } from './vector-layer.interface';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { MessageService } from '@igo2/core';\nimport { WFSDataSourceOptions } from '../../../datasource/shared/datasources/wfs-datasource.interface';\nimport { buildUrl, defaultMaxFeatures } from '../../../datasource/shared/datasources/wms-wfs.utils';\nimport { OgcFilterableDataSourceOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { GeoNetworkService, SimpleGetOptions } from '../../../offline/shared/geo-network.service';\nimport { catchError, concatMap, first } from 'rxjs/operators';\nimport { GeoDBService } from '../../../offline/geoDB/geoDB.service';\nimport { of } from 'rxjs';\nexport class VectorLayer extends Layer {\n  public dataSource:\n    | FeatureDataSource\n    | WFSDataSource\n    | ArcGISRestDataSource\n    | WebSocketDataSource\n    | ClusterDataSource;\n  public options: VectorLayerOptions;\n  public ol: olLayerVector<olSourceVector<OlGeometry>>;\n  private watcher: VectorWatcher;\n  private trackFeatureListenerId;\n\n  get browsable(): boolean {\n    return this.options.browsable !== false;\n  }\n\n  get exportable(): boolean {\n    return this.options.exportable !== false;\n  }\n\n  constructor(\n    options: VectorLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor,\n    private geoNetworkService?: GeoNetworkService,\n    private geoDBService?: GeoDBService\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new VectorWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVector<olSourceVector<OlGeometry>> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVector<OlGeometry>\n    });\n\n    if (this.options.animation) {\n      this.dataSource.ol.on(\n        'addfeature',\n        function(e) {\n          this.flash(e.feature);\n        }.bind(this)\n      );\n    }\n\n    if (this.options.trackFeature) {\n      this.enableTrackFeature(this.options.trackFeature);\n    }\n\n    const vector = new olLayerVector(olOptions);\n    const vectorSource = vector.getSource() as olSourceVector<OlGeometry>;\n    const url = vectorSource.getUrl();\n    if (url) {\n      let loader;\n      const wfsOptions = olOptions.sourceOptions as WFSDataSourceOptions;\n      if (wfsOptions?.type === 'wfs' && (wfsOptions.params || wfsOptions.paramsWFS)) {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customWFSLoader(\n            vectorSource,\n            wfsOptions,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      } else {\n        loader = (extent, resolution, proj, success, failure) => {\n          this.customLoader(\n            vectorSource,\n            url,\n            this.authInterceptor,\n            extent,\n            resolution,\n            proj,\n            success,\n            failure\n          );\n        };\n      }\n      if (loader) {\n        vectorSource.setLoader(loader);\n      }\n    }\n    return vector;\n  }\n\n  protected flash(feature) {\n    const start = new Date().getTime();\n    const listenerKey = this.ol.on('postrender', animate.bind(this));\n\n    function animate(event) {\n      const vectorContext = getVectorContext(event);\n      const frameState = event.frameState;\n      const flashGeom = feature.getGeometry().clone();\n      const elapsed = frameState.time - start;\n      const elapsedRatio = elapsed / this.options.animation.duration;\n      const opacity = easeOut(1 - elapsedRatio);\n      const newColor = ColorAsArray(this.options.animation.color || 'red');\n      newColor[3] = opacity;\n      let style = this.ol\n        .getStyleFunction()\n        .call(this, feature)\n        .find((style2) => {\n          return style2.getImage();\n        });\n      if (!style) {\n        style = this.ol.getStyleFunction().call(this, feature)[0];\n      }\n      const styleClone = style.clone();\n\n      switch (feature.getGeometry().getType()) {\n        case 'Point':\n          if(styleClone.getImage() !== null &&\n            typeof styleClone.getImage().getRadius === 'function'){\n            const radius =\n            easeOut(elapsedRatio) * (styleClone.getImage().getRadius() * 3);\n            styleClone.getImage().setRadius(radius);\n            styleClone.getImage().setOpacity(opacity);\n          }\n\n          break;\n        case 'LineString':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getStroke().setColor(newColor);\n            styleClone\n              .getImage()\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) *\n                  (styleClone.getImage().getStroke().getWidth() * 3)\n              );\n          }\n          if (styleClone.getStroke()) {\n            styleClone.getStroke().setColor(newColor);\n            styleClone\n              .getStroke()\n              .setWidth(\n                easeOut(elapsedRatio) * (styleClone.getStroke().getWidth() * 3)\n              );\n          }\n          break;\n        case 'Polygon':\n          // TODO\n          if (styleClone.getImage()) {\n            styleClone.getImage().getFill().setColor(newColor);\n          }\n          if (styleClone.getFill()) {\n            styleClone.getFill().setColor(newColor);\n          }\n          break;\n      }\n\n      styleClone.setText('');\n      vectorContext.setStyle(styleClone);\n      vectorContext.drawGeometry(flashGeom);\n\n      if (elapsed > this.options.animation.duration) {\n        unByKey(listenerKey);\n        // remove last geometry\n        // there is a little flash before feature disappear, better solution ?\n        this.map.ol.render();\n        return;\n      }\n      // tell OpenLayers to continue postcompose animation\n      this.map.ol.render();\n    }\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  public setExtent(extent: MapExtent): void {\n    this.options.extent = extent;\n  }\n\n  public onUnwatch() {\n    this.dataSource.onUnwatch();\n    this.stopAnimation();\n  }\n\n  public stopAnimation() {\n    this.dataSource.ol.un(\n      'addfeature',\n      function(e) {\n        if (this.visible) {\n          this.flash(e.feature);\n        }\n      }.bind(this)\n    );\n  }\n\n  public enableTrackFeature(id: string | number) {\n    this.trackFeatureListenerId = this.dataSource.ol.on(\n      'addfeature',\n      this.trackFeature.bind(this, id)\n    );\n  }\n  public centerMapOnFeature(id: string | number) {\n    const feat = this.dataSource.ol.getFeatureById(id);\n    if (feat) {\n      this.map.ol.getView().setCenter((feat.getGeometry() as any).getCoordinates());\n    }\n  }\n\n  public trackFeature(id, feat) {\n    if (feat.feature.getId() === id && this.visible) {\n      this.centerMapOnFeature(id);\n    }\n  }\n\n  public disableTrackFeature(id?: string | number) {\n    unByKey(this.trackFeatureListenerId);\n  }\n\n  /**\n   * Custom loader for a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param options olOptions from source\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param proj the projection to retrieve the data\n   * @param success success callback\n   * @param failure failure callback\n   * @param randomParam random parameter to ensure cache is not causing problems in retrieving new data\n   */\n  public customWFSLoader(\n    vectorSource,\n    options,\n    interceptor,\n    extent,\n    resolution,\n    proj,\n    success,\n    failure,\n    randomParam?: boolean\n  ) {\n    {\n      const paramsWFS = options.paramsWFS;\n      const wfsProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : proj;\n      const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\n      paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\n      const url = buildUrl(\n        options,\n        currentExtent,\n        wfsProj,\n        (options as OgcFilterableDataSourceOptions).ogcFilters,\n        randomParam);\n      let startIndex = 0;\n      if (paramsWFS.version === '2.0.0' && paramsWFS.maxFeatures > defaultMaxFeatures) {\n        const nbOfFeature = 1000;\n        while (startIndex < paramsWFS.maxFeatures) {\n          let alteredUrl = url.replace('count=' + paramsWFS.maxFeatures, 'count=' + nbOfFeature);\n          alteredUrl = alteredUrl.replace('startIndex=0', '0');\n          alteredUrl += '&startIndex=' + startIndex;\n          alteredUrl.replace(/&&/g, '&');\n          this.getFeatures(vectorSource, interceptor, currentExtent, wfsProj, proj, alteredUrl, nbOfFeature, success, failure);\n          startIndex += nbOfFeature;\n        }\n      } else {\n        this.getFeatures(vectorSource, interceptor, currentExtent, wfsProj, proj, url, paramsWFS.maxFeatures, success, failure);\n      }\n    }\n  }\n\n\n  /**\n   * Custom loader to get feature from a WFS datasource\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param dataProjection the projection of the retrieved data\n   * @param featureProjection the projection of the created features\n   * @param url the url string to retrieve the data\n   * @param threshold the threshold to manage \"more features\" (TODO)\n   * @param success success callback\n   * @param failure failure callback\n   */\n  private getFeatures(\n    vectorSource: olSourceVector<OlGeometry>,\n    interceptor,\n    extent,\n    dataProjection,\n    featureProjection,\n    url: string,\n    threshold: number,\n    success, failure) {\n\n    const idAssociatedCall = (this.dataSource as WFSDataSource).mostRecentIdCallOGCFilter;\n    const xhr = new XMLHttpRequest();\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', modifiedUrl);\n    if (interceptor) {\n      interceptor.interceptXhr(xhr, modifiedUrl);\n    }\n    const onError = () => {\n      vectorSource.removeLoadedExtent(extent);\n      failure();\n    };\n    xhr.onerror = onError;\n    xhr.onload = () => {\n      if (xhr.status === 200 && xhr.responseText.length > 0) {\n        const features =\n          vectorSource\n            .getFormat()\n            .readFeatures(xhr.responseText, { dataProjection, featureProjection }) as olFeature<OlGeometry>[];\n        // TODO Manage \"More feature\"\n        /*if (features.length === 0 || features.length < threshold ) {\n          console.log('No more data to download at this resolution');\n        }*/\n        // Avoids retrieving an older call that took longer to be process\n        if (idAssociatedCall === (this.dataSource as WFSDataSource).mostRecentIdCallOGCFilter)\n        {\n            vectorSource.addFeatures(features);\n            success(features);\n        }\n        else {\n            success([]);\n        }\n      } else {\n        onError();\n      }\n    };\n    xhr.send();\n  }\n\n  /**\n   * Custom loader for vector layer.\n   * @internal\n   * @param vectorSource the vector source to be created\n   * @param url the url string or function to retrieve the data\n   * @param interceptor the interceptor of the data\n   * @param extent the extent of the requested data\n   * @param resolution the current resolution\n   * @param projection the projection to retrieve the data\n   */\n  private customLoader(\n    vectorSource,\n    url,\n    interceptor,\n    extent,\n    resolution,\n    projection,\n    success,\n    failure\n  ) {\n    const xhr = new XMLHttpRequest();\n    let modifiedUrl = url;\n    if (typeof url !== 'function') {\n      const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n      if (alteredUrlWithKeyAuth) {\n        modifiedUrl = alteredUrlWithKeyAuth;\n      }\n    } else {\n      modifiedUrl = url(extent, resolution, projection);\n    }\n\n    if (this.geoNetworkService && typeof url !== 'function') {\n      const format = vectorSource.getFormat();\n      const type = format.getType();\n\n      let responseType = type;\n      const onError = () => {\n        vectorSource.removeLoadedExtent(extent);\n        failure();\n      };\n\n      const options: SimpleGetOptions = { responseType };\n      this.geoNetworkService.geoDBService.get(url).pipe(concatMap(r =>\n        r ? of(r) : this.geoNetworkService.get(modifiedUrl, options)\n          .pipe(\n            first(),\n            catchError((res) => {\n              onError();\n              throw res;\n            })\n          )\n      ))\n      .subscribe((content) => {\n          if (content) {\n            const format = vectorSource.getFormat();\n            const type = format.getType();\n            let source;\n            if (type === 'json' || type === 'text') {\n              source = content;\n            } else if (type === 'xml') {\n              source = content;\n              if (!source) {\n                source = new DOMParser().parseFromString(\n                  content,\n                  'application/xml'\n                );\n              }\n            } else if (type === 'arraybuffer') {\n              source = content;\n            }\n            if (source) {\n              const features = format.readFeatures(source, { extent, featureProjection: projection });\n              vectorSource.addFeatures(features, format.readProjection(source));\n              success(features);\n            } else {\n              onError();\n            }\n          }\n        });\n\n    } else {\n    xhr.open( 'GET', modifiedUrl);\n    const format = vectorSource.getFormat();\n    if (format.getType() === 'arraybuffer') {\n      xhr.responseType = 'arraybuffer';\n    }\n    if (interceptor) {\n      interceptor.interceptXhr(xhr, modifiedUrl);\n    }\n\n    const onError = () => {\n      vectorSource.removeLoadedExtent(extent);\n      failure();\n    };\n    xhr.onerror = onError;\n    xhr.onload = () => {\n      // status will be 0 for file:// urls\n      if (!xhr.status || (xhr.status >= 200 && xhr.status < 300)) {\n        const type = format.getType();\n        let source;\n        if (type === 'json' || type === 'text') {\n          source = xhr.responseText;\n        } else if (type === 'xml') {\n          source = xhr.responseXML;\n          if (!source) {\n            source = new DOMParser().parseFromString(\n              xhr.responseText,\n              'application/xml'\n            );\n          }\n        } else if (type === 'arraybuffer') {\n          source = xhr.response;\n        }\n        if (source) {\n          const features = format.readFeatures(source, { extent, featureProjection: projection });\n          vectorSource.addFeatures(features, format.readProjection(source));\n          success(features);\n        } else {\n          onError();\n        }\n      } else {\n        onError();\n      }\n    };\n    xhr.send();\n  }\n  }\n}\n","export abstract class DataService {\n    abstract getData(): string;\n}\n","import olSourceOSM from 'ol/source/OSM';\n\nimport { DataSource } from './datasource';\nimport { OSMDataSourceOptions } from './osm-datasource.interface';\n\nexport class OSMDataSource extends DataSource {\n  public options: OSMDataSourceOptions;\n  public ol: olSourceOSM;\n\n  protected createOlSource(): olSourceOSM {\n    if (!this.options.url) {\n      this.options.url = 'https://tile.openstreetmap.org/{z}/{x}/{y}.png';\n    }\n    return new olSourceOSM(this.options);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceXYZ from 'ol/source/XYZ';\n\nimport { DataSource } from './datasource';\nimport { XYZDataSourceOptions } from './xyz-datasource.interface';\n\nexport class XYZDataSource extends DataSource {\n  public options: XYZDataSourceOptions;\n  public ol: olSourceXYZ;\n\n  protected createOlSource(): olSourceXYZ {\n    return new olSourceXYZ(this.options);\n  }\n\n  public onUnwatch() {}\n\n}\n","import olSourceVector from 'ol/source/Vector';\nimport * as OlLoadingStrategy from 'ol/loadingstrategy';\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WFSService } from './wfs.service';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport { OgcFilterableDataSourceOptions, OgcFiltersOptions } from '../../../filter/shared/ogc-filter.interface';\nimport {\n  defaultFieldNameGeometry,\n  checkWfsParams,\n  getFormatFromOptions,\n  buildUrl\n} from './wms-wfs.utils';\nimport { AuthInterceptor } from '@igo2/auth';\n\nexport class WFSDataSource extends DataSource {\n  public ol: olSourceVector<OlGeometry>;\n  public mostRecentIdCallOGCFilter: number = 0;\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  constructor(\n    public options: WFSDataSourceOptions,\n    protected wfsService: WFSService,\n    private authInterceptor?: AuthInterceptor\n  ) {\n    super(checkWfsParams(options, 'wfs'));\n\n    const ogcFilters = (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n    const fieldNameGeometry = this.options.paramsWFS.fieldNameGeometry || defaultFieldNameGeometry;\n    const ogcFilterWriter = new OgcFilterWriter();\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters =\n      ogcFilterWriter.defineOgcFiltersDefaultOptions(ogcFilters, fieldNameGeometry);\n    if (\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.enabled &&\n      (this.options as OgcFilterableDataSourceOptions).ogcFilters.editable &&\n      (options.sourceFields || []).filter(sf => !sf.values).length > 0\n    ) {\n      this.wfsService.getSourceFieldsFromWFS(this.options);\n    }\n\n    if (ogcFilters?.pushButtons){\n      ogcFilters.pushButtons.selectorType = 'pushButton';\n    }\n    if (ogcFilters?.checkboxes){\n      ogcFilters.checkboxes.selectorType = 'checkbox';\n    }\n    if (ogcFilters?.radioButtons){\n      ogcFilters.radioButtons.selectorType = 'radioButton';\n    }\n    if (ogcFilters?.select){\n      ogcFilters.select.selectorType = 'select';\n    }\n    if (ogcFilters?.autocomplete){\n      ogcFilters.autocomplete.selectorType = 'autocomplete';\n    }\n\n    this.setOgcFilters((this.options as OgcFilterableDataSourceOptions).ogcFilters, true);\n  }\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const vectorSource = new olSourceVector({\n      format: getFormatFromOptions(this.options),\n      url: (extent, resolution, proj: olProjection) => {\n        const paramsWFS = this.options.paramsWFS;\n        const wfsProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : proj;\n        const ogcFilters = (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n        const currentExtent = olproj.transformExtent(extent, proj, wfsProj);\n        paramsWFS.srsName = paramsWFS.srsName || proj.getCode();\n        return buildUrl(this.options, currentExtent, wfsProj, ogcFilters);\n      },\n      strategy: OlLoadingStrategy.bbox\n    });\n    return vectorSource;\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    this.mostRecentIdCallOGCFilter += 1;\n    if (triggerEvent) {\n      this.ol.notify('ogcFilters', this.ogcFilters);\n    }\n  }\n\n  public onUnwatch() { }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { combineLatest, Observable, of } from 'rxjs';\nimport olFeature from 'ol/Feature';\nimport { WFSDataSourceOptions } from './wfs-datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { DataService } from './data.service';\nimport { formatWFSQueryString,\n          gmlRegex,\n          defaultEpsg,\n          defaultMaxFeatures,\n          getFormatFromOptions} from './wms-wfs.utils';\nimport { concatMap } from 'rxjs/operators';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n@Injectable({\n  providedIn: 'root'\n})\nexport class WFSService extends DataService {\n  constructor(private http: HttpClient) {\n    super();\n  }\n\n  getData() {\n    console.log('This is defining a data service.');\n    return 'This is defining a data service.';\n  }\n\n  public getSourceFieldsFromWFS(dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions) {\n    if (!dataSourceOptions.sourceFields || dataSourceOptions.sourceFields.length === 0 ) {\n      dataSourceOptions.sourceFields = [];\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(getfeatureSourceField => {\n        dataSourceOptions.sourceFields = getfeatureSourceField;\n      });\n\n    } else {\n      this.defineFieldAndValuefromWFS(dataSourceOptions).subscribe(getfeatureSourceField => {\n        dataSourceOptions.sourceFields.forEach(sourcefield => {\n          if (sourcefield.alias === undefined) {\n            sourcefield.alias = sourcefield.name; // to allow only a list of sourcefield with names\n          }\n          if (sourcefield.values === undefined || sourcefield.values.length === 0) {\n            sourcefield.values = getfeatureSourceField.find(sf => sf.name === sourcefield.name).values;\n          }\n        });\n      });\n    }\n  }\n\n  private wfsGetFeature(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions,\n    nb: number = defaultMaxFeatures,\n    epsgCode: string = defaultEpsg,\n    propertyName?: string,\n    startIndex: number = 0,\n    forceDefaultOutputFormat: boolean = false\n  ): Observable<any> {\n    const queryStringValues = formatWFSQueryString(dataSourceOptions, nb, epsgCode, propertyName, startIndex, forceDefaultOutputFormat );\n    const baseUrl = queryStringValues.find(f => f.name === 'getfeature').value;\n    const outputFormat = dataSourceOptions.paramsWFS.outputFormat;\n    if (forceDefaultOutputFormat || gmlRegex.test(outputFormat) || !outputFormat) {\n      return this.http.get(baseUrl, { responseType: 'text' });\n    } else {\n      return this.http.get(baseUrl);\n    }\n  }\n\n  defineFieldAndValuefromWFS(\n    dataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions\n  ): Observable<any> {\n    return new Observable(d => {\n      const sourceFields = [];\n      let fieldList;\n      let fieldListWoGeom;\n      let fieldListWoGeomStr;\n      let olFormats;\n      let effectiveOlFormats;\n\n      olFormats = getFormatFromOptions(dataSourceOptions);\n      const gmlDataSourceOptions: WFSDataSourceOptions | WMSDataSourceOptions = JSON.parse(\n        JSON.stringify(dataSourceOptions)\n      );\n      delete gmlDataSourceOptions.paramsWFS.outputFormat;\n      delete (gmlDataSourceOptions as WFSDataSourceOptions).formatOptions;\n\n      effectiveOlFormats = getFormatFromOptions(gmlDataSourceOptions);\n      let sourceFieldsToRetrieveValues = dataSourceOptions.sourceFields?.filter(f => !f.values).map(f => f.name);\n\n      // Validate if the service manage no outputformat (wfs 1.0.0 and GML is the default return)\n      this.wfsGetFeature(dataSourceOptions, 1, undefined, undefined, 0, true).pipe(\n        concatMap(res => String(res).toLowerCase().includes('exception') ? of(false) : of(true)),\n        concatMap(allowGml => {\n          // If the service return GML (return no exception)\n          return this.wfsGetFeature(dataSourceOptions, 1).pipe(\n            concatMap(firstFeature => {\n              const features = olFormats.readFeatures(firstFeature);\n              fieldList = features[0].getKeys();\n              if (dataSourceOptions.sourceFields || dataSourceOptions.sourceFields.length === 0) {\n                sourceFieldsToRetrieveValues = fieldList;\n              }\n              fieldListWoGeom = fieldList.filter(\n                field =>\n                  sourceFieldsToRetrieveValues.includes(field) &&\n                  field !== features[0].getGeometryName() &&\n                  !field.match(/boundedby/gi)\n              );\n              fieldListWoGeomStr = fieldListWoGeom.join(',');\n              const processingArray = [];\n              let startIndex = 0;\n              // If the service do not allow gml return, dice the call in multiple\n              // calls by increment of chunkSize with the original outputFormat\n              if (\n                !allowGml && dataSourceOptions.paramsWFS.version === '2.0.0' &&\n                dataSourceOptions.paramsWFS.maxFeatures > defaultMaxFeatures) {\n                const chunkSize = 1000;\n                while (startIndex < dataSourceOptions.paramsWFS.maxFeatures) {\n                  processingArray.push(this.wfsGetFeature(\n                    dataSourceOptions,\n                    chunkSize,\n                    dataSourceOptions.paramsWFS.srsName,\n                    fieldListWoGeomStr,\n                    startIndex\n                  ));\n                  startIndex += chunkSize;\n                }\n                effectiveOlFormats = olFormats;\n              } else {\n                processingArray.push(this.wfsGetFeature(\n                  dataSourceOptions,\n                  dataSourceOptions.paramsWFS.maxFeatures || defaultMaxFeatures,\n                  dataSourceOptions.paramsWFS.srsName,\n                  fieldListWoGeomStr,\n                  0, true\n                ));\n              }\n              return combineLatest(processingArray);\n            })\n          );\n        })).subscribe((results) => {\n          let mfeatures: olFeature<OlGeometry>[] = [];\n          results.map((result) => {\n            const loopFeatures = effectiveOlFormats.readFeatures(result);\n            mfeatures = mfeatures.concat(loopFeatures);\n          });\n          this.built_properties_value(mfeatures).forEach(element => {\n            sourceFields.push(element);\n          });\n          d.next(sourceFields);\n          d.complete();\n        });\n    });\n  }\n\n  private built_properties_value(features: olFeature<OlGeometry>[]): string[] {\n    if (features.length === 0) {\n      return [];\n    }\n    const kv = Object.assign({}, features[0].getProperties());\n    delete kv[features[0].getGeometryName()];\n    delete kv.boundedBy;\n    const sourceFields = [];\n    for (const property in kv) {\n      if (kv.hasOwnProperty(property)) {\n        const fieldType =\n          typeof features[0].get(property) === 'object'\n            ? undefined\n            : typeof features[0].get(property);\n        sourceFields.push({\n          name: property,\n          alias: property,\n          type: fieldType,\n          values: [kv[property]]\n        });\n      }\n    }\n    features.every((element) => {\n      const featureProperties = element.getProperties();\n      for (const key in featureProperties) {\n        if (featureProperties.hasOwnProperty(key) && key in kv) {\n          sourceFields.filter(f => f.name === key).forEach(v => {\n            if (v.values.indexOf(featureProperties[key]) === -1) {\n              v.values.push(featureProperties[key]);\n            }\n          });\n        }\n      }\n      return true;\n    });\n    return sourceFields;\n  }\n}\n","export enum QueryFormat {\n  GML2 = 'gml2',\n  GML3 = 'gml3',\n  JSON = 'json',\n  GEOJSON = 'geojson',\n  GEOJSON2 = 'geojson2',\n  ESRIJSON = 'esrijson',\n  TEXT = 'text',\n  HTML = 'html',\n  HTMLGML2 = 'htmlgml2'\n}\n\nexport enum QueryFormatMimeType {\n  GML2 = 'application/vnd.ogc.gml',\n  GML3 = 'application/vnd.ogc.gml/3.1.1',\n  JSON = 'application/json',\n  GEOJSON = 'application/geojson',\n  GEOJSON2 = 'geojson',\n  ESRIJSON = 'application/json',\n  TEXT = 'text/plain',\n  HTML = 'text/html',\n  HTMLGML2 = 'text/html'\n}\n\nexport enum QueryHtmlTarget {\n  IFRAME = 'iframe',\n  BLANK = '_blank'\n}\n","import olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { WMSDataSourceOptions } from './wms-datasource.interface';\nimport { WFSService } from './wfs.service';\n\nimport { OgcFilterWriter } from '../../../filter/shared/ogc-filter';\nimport { OgcFilterableDataSourceOptions, OgcFiltersOptions, OgcFilterDuringOptions } from '../../../filter/shared/ogc-filter.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nimport {\n  formatWFSQueryString,\n  checkWfsParams,\n  defaultFieldNameGeometry\n} from './wms-wfs.utils';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { LegendMapViewOptions } from '../../../layer/shared/layers/layer.interface';\nimport { BehaviorSubject } from 'rxjs';\nimport { TimeFilterableDataSourceOptions, TimeFilterOptions } from '../../../filter/shared/time-filter.interface';\n\nexport class WMSDataSource extends DataSource {\n  public ol: olSourceImageWMS;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  set ogcFilters(value: OgcFiltersOptions) {\n    (this.options as OgcFilterableDataSourceOptions).ogcFilters = value;\n  }\n  get ogcFilters(): OgcFiltersOptions {\n    return (this.options as OgcFilterableDataSourceOptions).ogcFilters;\n  }\n\n  set timeFilter(value: TimeFilterOptions ) {\n    (this.options as TimeFilterableDataSourceOptions).timeFilter = value;\n  }\n  get timeFilter(): TimeFilterOptions {\n    return (this.options as TimeFilterableDataSourceOptions).timeFilter;\n  }\n  readonly timeFilter$: BehaviorSubject<TimeFilterOptions> = new BehaviorSubject(undefined);\n\n  constructor(\n    public options: WMSDataSourceOptions,\n    protected wfsService: WFSService\n  ) {\n    super(options);\n    const sourceParams: any = options.params;\n\n    const dpi = sourceParams.DPI || 96;\n    sourceParams.DPI = dpi;\n    sourceParams.MAP_RESOLUTION = dpi;\n    sourceParams.FORMAT_OPTIONS = 'dpi:' + dpi;\n\n    if (options.refreshIntervalSec && options.refreshIntervalSec > 0) {\n      setInterval(() => {\n        this.refresh();\n      }, options.refreshIntervalSec * 1000); // Convert seconds to MS\n    }\n\n    let fieldNameGeometry = defaultFieldNameGeometry;\n\n    // ####   START if paramsWFS\n    if (options.paramsWFS) {\n      const wfsCheckup = checkWfsParams(options, 'wms');\n      ObjectUtils.mergeDeep(options.paramsWFS, wfsCheckup.paramsWFS);\n\n      fieldNameGeometry =\n        options.paramsWFS.fieldNameGeometry || fieldNameGeometry;\n\n      options.download = Object.assign({}, options.download, {\n        dynamicUrl: this.buildDynamicDownloadUrlFromParamsWFS(options)\n      });\n    } //  ####   END  if paramsWFS\n\n    if (!options.sourceFields || options.sourceFields.length === 0) {\n      options.sourceFields = [];\n    } else {\n      options.sourceFields.forEach(sourceField => {\n        sourceField.alias = sourceField.alias\n          ? sourceField.alias\n          : sourceField.name;\n        // to allow only a list of sourcefield with names\n      });\n    }\n    const initOgcFilters = (options as OgcFilterableDataSourceOptions)\n      .ogcFilters;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (!initOgcFilters) {\n      (options as OgcFilterableDataSourceOptions).ogcFilters = ogcFilterWriter.defineOgcFiltersDefaultOptions(\n        initOgcFilters,\n        fieldNameGeometry,\n        'wms'\n      );\n    } else {\n      initOgcFilters.advancedOgcFilters = (initOgcFilters.pushButtons || initOgcFilters.checkboxes\n        || initOgcFilters.radioButtons || initOgcFilters.select || initOgcFilters.autocomplete)\n        ? false\n        : true;\n      if (initOgcFilters.advancedOgcFilters && initOgcFilters.filters) {\n          const filterDuring = initOgcFilters.filters as OgcFilterDuringOptions;\n          if(filterDuring.calendarModeYear) {\n            initOgcFilters.advancedOgcFilters = false;\n          }\n      }\n      if (initOgcFilters.pushButtons){\n        initOgcFilters.pushButtons.selectorType = 'pushButton';\n      }\n      if (initOgcFilters.checkboxes){\n        initOgcFilters.checkboxes.selectorType = 'checkbox';\n      }\n      if (initOgcFilters.radioButtons){\n        initOgcFilters.radioButtons.selectorType = 'radioButton';\n      }\n      if (initOgcFilters.select){\n        initOgcFilters.select.selectorType = 'select';\n      }\n      if (initOgcFilters.autocomplete){\n        initOgcFilters.autocomplete.selectorType = 'autocomplete';\n      }\n    }\n\n    if (\n      sourceParams.LAYERS.split(',').length > 1 &&\n      initOgcFilters &&\n      initOgcFilters.enabled\n    ) {\n      console.log('*******************************');\n      console.log(\n        'BE CAREFULL, YOUR WMS LAYERS (' +\n          sourceParams.LAYERS +\n          ') MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! '\n      );\n      console.log('*******************************');\n    }\n\n    if (\n      options.paramsWFS &&\n      initOgcFilters &&\n      initOgcFilters.enabled &&\n      initOgcFilters.editable &&\n      (options.sourceFields || []).filter(sf => !sf.values).length > 0) {\n      this.wfsService.getSourceFieldsFromWFS(options);\n    }\n\n    const filterQueryString = ogcFilterWriter.handleOgcFiltersAppliedValue(\n      options,\n      fieldNameGeometry\n    );\n    sourceParams.FILTER = filterQueryString;\n    this.ol.updateParams({'FILTER': sourceParams.FILTER});\n    this.setOgcFilters(initOgcFilters, true);\n\n    const timeFilterableDataSourceOptions = (options as TimeFilterableDataSourceOptions);\n    if (\n      timeFilterableDataSourceOptions?.timeFilterable &&\n      timeFilterableDataSourceOptions?.timeFilter) {\n      this.setTimeFilter(timeFilterableDataSourceOptions.timeFilter, true);\n    }\n  }\n\n  refresh() {\n    this.ol.updateParams({ igoRefresh: Math.random() });\n  }\n\n  private buildDynamicDownloadUrlFromParamsWFS(asWFSDataSourceOptions) {\n    const queryStringValues = formatWFSQueryString(asWFSDataSourceOptions);\n    const downloadUrl = queryStringValues.find(f => f.name === 'getfeature')\n      .value;\n    return downloadUrl;\n  }\n\n  protected createOlSource(): olSourceImageWMS {\n    return new olSourceImageWMS(Object.assign({ratio: 1}, this.options));\n  }\n\n  setOgcFilters(ogcFilters: OgcFiltersOptions, triggerEvent: boolean = false) {\n    this.ogcFilters = ogcFilters;\n    if (triggerEvent) {\n      this.ol.notify('ogcFilters', this.ogcFilters);\n    }\n  }\n\n  setTimeFilter(timeFilter: TimeFilterOptions, triggerEvent: boolean = false) {\n    this.timeFilter = timeFilter;\n    if (triggerEvent) {\n      this.timeFilter$.next(this.timeFilter);\n      this.ol.notify('timeFilter', this.ogcFilters);\n    }\n  }\n\n  getLegend(style?: string, view?: LegendMapViewOptions): Legend[] {\n    let legend = super.getLegend();\n    if (legend.length > 0 && (style === undefined && !view?.scale)) {\n      return legend;\n    }\n\n    let contentDependent = false;\n    let projParam;\n\n    if (view?.size && view?.extent && view?.projection && this.options.contentDependentLegend) {\n      projParam = this.params.VERSION === '1.3.0' || this.params.VERSION === undefined ? 'CRS' : 'SRS';\n      contentDependent = true;\n    }\n\n    const sourceParams = this.params;\n\n    let layers = [];\n    if (sourceParams.LAYERS !== undefined) {\n      layers = sourceParams.LAYERS.split(',');\n    }\n\n    const baseUrl = this.options.url.replace(/\\?$/, '');\n    const params = [\n      'REQUEST=GetLegendGraphic',\n      'SERVICE=WMS',\n      'FORMAT=image/png',\n      'SLD_VERSION=1.1.0',\n      `VERSION=${sourceParams.VERSION || '1.3.0'}`\n    ];\n    if (style !== undefined) {\n      params.push(`STYLE=${style}`);\n    }\n    if (view?.scale !== undefined) {\n      params.push(`SCALE=${view.scale}`);\n    }\n    if (contentDependent) {\n      params.push(`WIDTH=${view.size[0]}`);\n      params.push(`HEIGHT=${view.size[1]}`);\n      params.push(`BBOX=${view.extent.join(',')}`);\n      params.push(`${projParam}=${view.projection}`);\n    }\n\n    legend = layers.map((layer: string) => {\n      const separator = baseUrl.match(/\\?/) ? '&' : '?';\n      return {\n        url: `${baseUrl}${separator}${params.join('&')}&LAYER=${layer}`,\n        title: layers.length > 1 ? layer : undefined,\n        currentStyle: style === undefined ? undefined : style as string\n      };\n    });\n\n    return legend;\n  }\n\n  public onUnwatch() {}\n}\n","import olTileGridWMTS from 'ol/tilegrid/WMTS';\nimport * as olproj from 'ol/proj';\nimport {\n  getTopLeft as extentGetTopLeft,\n  getWidth as extentGetWidth\n} from 'ol/extent.js';\n\nexport function createDefaultTileGrid(epsg?: string): olTileGridWMTS {\n  const projection = epsg ? olproj.get(epsg) : olproj.get('EPSG:3857');\n  const projectionExtent = projection.getExtent();\n  const size = extentGetWidth(projectionExtent) / 256;\n  const resolutions = new Array(20);\n  const matrixIds = new Array(20);\n  for (let z = 0; z < 20; ++z) {\n    resolutions[z] = size / Math.pow(2, z);\n    matrixIds[z] = z;\n  }\n\n  return new olTileGridWMTS({\n    origin: extentGetTopLeft(projectionExtent),\n    resolutions,\n    matrixIds\n  });\n}\n","import { Options } from 'ol/source/WMTS';\nimport olSourceWMTS from 'ol/source/WMTS';\n\nimport { createDefaultTileGrid } from '../../utils/tilegrid';\nimport { DataSource } from './datasource';\nimport { WMTSDataSourceOptions } from './wmts-datasource.interface';\n\nexport class WMTSDataSource extends DataSource {\n  public options: WMTSDataSourceOptions;\n  public ol: olSourceWMTS;\n\n  constructor(options: WMTSDataSourceOptions) {\n    super(options);\n  }\n\n  protected createOlSource(): olSourceWMTS {\n    const sourceOptions = Object.assign(\n      {\n        tileGrid: createDefaultTileGrid(this.options.projection as string)\n      },\n      this.options\n    ) as Options;\n\n    return new olSourceWMTS(sourceOptions);\n  }\n\n  public onUnwatch() {}\n\n}\n","import olSourceCarto from 'ol/source/CartoDB';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { CartoDataSourceOptions } from './carto-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\n\nexport class CartoDataSource extends DataSource {\n  public ol: olSourceCarto;\n  public options: CartoDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceCarto {\n    const crossOrigin = this.options.crossOrigin\n      ? this.options.crossOrigin\n      : 'anonymous';\n    const sourceOptions = Object.assign(\n      {\n        crossOrigin\n      },\n      this.options\n    );\n    return new olSourceCarto(sourceOptions);\n  }\n\n  getLegend(): Legend[] {\n    const legend = super.getLegend();\n    if (legend.length > 0) {\n      return legend;\n    }\n\n    let htmlString = '<table>';\n    if (this.options.config.layers[0].legend !== null) {\n      this.options.config.layers[0].legend.items.forEach(f => {\n        if (f.visible === true) {\n          htmlString +=\n            '<tr><td>' +\n            '<p><font size=\"5\" color=\"' +\n            f.value +\n            '\"> &#9679</font></p></td>' +\n            '<td>' +\n            f.name +\n            '</td></tr>';\n        }\n      });\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    } else {\n      // Try to build the legend from the cartocss options\n      const layerOptions = this.options.config.layers[0].options;\n      // All available cartocss style options\n      const types = [\n        'polygon-fill:',\n        'marker-fill:',\n        'shield-fill:',\n        'building-fill:',\n        'line-color:'\n      ];\n      for (const oneType of types) {\n        if (layerOptions.cartocss.includes(oneType)) {\n          const type = layerOptions.cartocss.split(oneType).pop();\n          const color = type.substr(0, type.indexOf(';'));\n          if (color.includes('ramp')) {\n            const colors = color.split(', (')[1].split(',');\n            const data = color.split(', (')[2].split(',');\n            for (let j = 0; j < colors.length; j++) {\n              colors[j] = colors[j].replace(/(\"|\\))/g, '');\n              data[j] = data[j].replace(/(\"|\\))/g, '');\n              if (data[j].replace(/\\s+/g, '') === '=') {\n                data[j] = 'Autres';\n              }\n              htmlString +=\n                '<tr><td>' +\n                '<p><font size=\"5\" color=\"' +\n                colors[j] +\n                '\"> &#9679</font></p></td>' +\n                '<td>' +\n                data[j] +\n                '</td></tr>';\n            }\n            break;\n          } else {\n            const title = layerOptions.layer_name\n              ? layerOptions.layer_name\n              : '';\n            htmlString +=\n              '<tr><td>' +\n              '<p><font size=\"5\" color=\"' +\n              color +\n              '\"> &#9679</font></p>' +\n              '</td><td>' +\n              title +\n              '</td></tr>';\n            break;\n          }\n        }\n      }\n      htmlString += '</table>';\n      return [{ html: htmlString }];\n    }\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceVector from 'ol/source/Vector';\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\nimport * as olloadingstrategy from 'ol/loadingstrategy';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { ArcGISRestDataSourceOptions } from './arcgisrest-datasource.interface';\n\nexport class ArcGISRestDataSource extends DataSource {\n  public ol: olSourceVector<OlGeometry>;\n  public options: ArcGISRestDataSourceOptions;\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    const esrijsonFormat = new olFormatEsriJSON();\n    return new olSourceVector({\n      attributions: this.options.params.attributions,\n      overlaps: false,\n      format: esrijsonFormat,\n      url: function(extent, resolution, proj) {\n        const baseUrl = this.options.url + '/' + this.options.layer + '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        if (this.options.params.time) {\n          const time = `time=${this.options.params.time}`;\n          params.push(time);\n        }\n        if (this.options.params.customParams) {\n          this.options.params.customParams.forEach(element => {\n            params.push(element);\n          });\n        }\n        return `${baseUrl}?${params.join('&')}`;\n      }.bind(this),\n      strategy: olloadingstrategy.bbox\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || legend.length > 0) {\n      return legend;\n    }\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n    let src: string;\n    let label: string;\n    let svg: string;\n\n    if (legendInfo.legend) {\n      for (const legendElement of legendInfo.legend) {\n        src = this.htmlImgSrc(legendElement.contentType, legendElement.imageData);\n        label = legendElement.label ? legendElement.label.replace('<Null>', 'Null') : '';\n        htmlString +=\n          `<tr><td align='left'><img src=\"` +\n          src +\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      }\n    } else if (legendInfo.type === \"uniqueValue\") {\n      for (const legendElement of legendInfo.uniqueValueInfos) {\n        label = legendElement.label.replace('<Null>', 'Null');\n        if (legendElement.symbol.type === 'esriPMS') {\n          src = this.htmlImgSrc(legendElement.symbol.contentType, legendElement.symbol.imageData);\n          htmlString +=\n            `<tr><td align='left'><img src=\"` +\n            src +\n            `\" alt ='' /></td><td class=\"mat-typography\">` +\n            label +\n            '</td></tr>';\n        } else if (legendElement.symbol.type !== 'esriPMS') {\n          svg = this.createSVG(legendElement.symbol);\n          htmlString += `<tr><td align='left'>` + svg + `</td><td class=\"mat-typography\">` + label + '</td></tr>';\n        }\n      }\n    } else if (legendInfo.type === \"simple\") {\n      label = legendInfo.label ? legendInfo.label.replace('<Null>', 'Null') : '';\n      if (legendInfo.symbol.type === 'esriPMS') {\n        src = this.htmlImgSrc(legendInfo.symbol.contentType, legendInfo.symbol.imageData);\n        htmlString +=\n          `<tr><td align='left'><img src=\"` +\n          src +\n          `\" alt ='' /></td><td class=\"mat-typography\">` +\n          label +\n          '</td></tr>';\n      } else if (legendInfo.symbol.type !== 'esriPMS') {\n        svg = this.createSVG(legendInfo.symbol);\n        htmlString += `<tr><td align='left'>` + svg + `</td><td class=\"mat-typography\">` + label + '</td></tr>';\n      }\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  htmlImgSrc(contentType: string, imageData: string): string {\n    return `data:${contentType};base64,${imageData}`;\n  }\n\n  createSVG(symbol): string {\n    let svg: string = '';\n\n    const color: Array<number> = symbol.color ? symbol.color : [0, 0, 0, 0];\n\n    if (symbol.type === 'esriSLS') {\n      const width: number = symbol.width ? symbol.width : 0;\n\n      const stroke: string = `stroke:rgba(` + color[0] + ',' + color[1] + ',' + color[2] + ',' + color[3] + ')';\n      const strokeWidth: string = `stroke-width:` + width;\n\n      if (symbol.style === 'esriSLSSolid') {\n        svg = `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` + stroke + ';' + strokeWidth + `\"/></svg>`;\n      } else if (symbol.style === 'esriSLSDash') {\n        const strokeDashArray: string = `stroke-dasharray=\"5,5\"`;\n        svg = `<svg height=\"30\" width=\"30\"><line x1=\"0\" y1=\"15\" x2=\"30\" y2=\"15\" style=\"` + stroke + ';' + strokeWidth + `\" `+ strokeDashArray + `/></svg>`;\n      }\n    } else if (symbol.style === 'esriSMSCircle' || symbol.style === 'esriSFSSolid') {\n      const outlineColor = symbol.outline.color;\n      const outlineWidth = symbol.outline.width;\n      const size = symbol.size;\n\n      const stroke = `stroke:rgba(` + outlineColor[0] + ',' + outlineColor[1] + ',' + outlineColor[2] + ',' + outlineColor[3] + ')';\n      const strokeWidth = `stroke-width:` + outlineWidth;\n      const fill = `fill:rgba(` + color[0] + ',' + color[1] + ',' + color[2] + ',' + color[3] + ')';\n\n      if (symbol.style === 'esriSMSCircle') {\n        svg = `<svg height=\"30\" width=\"30\"><circle cx=\"15\" cy=\"15\" r=\"` + size/2 + `\" style=\"` + stroke + ';' + strokeWidth + ';' + fill + `\"/></svg>`;\n      } else {\n        svg = `<svg height=\"30\" width=\"30\"><rect x=\"5\" y=\"5\" width=\"20\" height=\"20\" style =\"` + stroke + ';' + strokeWidth + ';' + fill + `\"/></svg>`;\n      }\n    }\n    return svg;\n  }\n\n  public onUnwatch() {}\n}\n","import ImageArcGISRest from 'ol/source/ImageArcGISRest';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { ArcGISRestImageDataSourceOptions } from './imagearcgisrest-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\nexport class ImageArcGISRestDataSource extends DataSource {\n  public ol: ImageArcGISRest;\n  public options: ArcGISRestImageDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): ImageArcGISRest {\n    const params = this.options.layer === undefined ? this.options.params : Object.assign(\n      {LAYERS: `show:${this.options.layer}`},\n      this.options.params\n    );\n\n    if (typeof params.renderingRule === 'object') {\n      params.renderingRule = JSON.stringify(params.renderingRule);\n    }\n\n    return new ImageArcGISRest({\n      ratio: 1,\n      params,\n      url: this.options.url\n    });\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || this.options.layer === undefined || legend.length > 0) {\n      return legend;\n    }\n\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const legendElement of legendInfo.legend) {\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\n      const label = legendElement.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceTileArcGISRest from 'ol/source/TileArcGISRest';\nimport { Options } from 'ol/source/TileArcGISRest';\n\nimport { DataSource } from './datasource';\nimport { Legend } from './datasource.interface';\nimport { TileArcGISRestDataSourceOptions } from './tilearcgisrest-datasource.interface';\nimport { QueryHtmlTarget } from '../../../query/shared/query.enums';\n\nexport class TileArcGISRestDataSource extends DataSource {\n  public ol: olSourceTileArcGISRest;\n  public options: TileArcGISRestDataSourceOptions;\n\n  get params(): any {\n    return this.options.params as any;\n  }\n\n  get queryTitle(): string {\n    return (this.options as any).queryTitle\n      ? (this.options as any).queryTitle\n      : 'title';\n  }\n\n  get mapLabel(): string {\n    return (this.options as any).mapLabel;\n  }\n\n  get queryHtmlTarget(): string {\n    return (this.options as any).queryHtmlTarget\n      ? (this.options as any).queryHtmlTarget\n      : QueryHtmlTarget.BLANK;\n  }\n\n  protected createOlSource(): olSourceTileArcGISRest {\n    return new olSourceTileArcGISRest(this.options as Options);\n  }\n\n  getLegend(): Legend[] {\n    const legendInfo = this.options.legendInfo;\n    const legend = super.getLegend();\n    if (legendInfo === undefined || this.options.layer === undefined || legend.length > 0) {\n      return legend;\n    }\n\n    if (!legendInfo) {\n      return;\n    }\n    let htmlString = '<table>';\n\n    for (const legendElement of legendInfo.legend) {\n      const src = `${this.options.url}/${legendInfo.layerId}/images/${legendElement.url}`;\n      const label = legendElement.label.replace('<Null>', 'Null');\n      htmlString +=\n        `<tr><td align='left'><img src=\"` +\n        src +\n        `\" alt ='' /></td><td class=\"mat-typography\">` +\n        label +\n        '</td></tr>';\n    }\n    htmlString += '</table>';\n    return [{ html: htmlString }];\n  }\n\n  public onUnwatch() {}\n}\n","import TileDebug from 'ol/source/TileDebug';\nimport TileGrid from 'ol/tilegrid/TileGrid';\n\nimport { DataSource } from './datasource';\nimport { TileDebugDataSourceOptions } from './tiledebug-datasource.interface';\n\nexport class TileDebugDataSource extends DataSource {\n  public options: TileDebugDataSourceOptions;\n  public ol: TileDebug;\n\n  protected createOlSource(): TileDebug {\n    const baseOptions = JSON.parse(JSON.stringify(this.options)); // to avoid to alter the original options\n    if (this.options.tileGrid) {\n      delete baseOptions.tileGrid;\n      baseOptions.tileGrid = new TileGrid(this.options.tileGrid);\n    }\n    return new TileDebug(baseOptions);\n  }\n\n  public onUnwatch() {}\n}\n","import olSourceVector from 'ol/source/Vector';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { FeatureDataSource } from './feature-datasource';\nimport { WebSocketDataSourceOptions } from './websocket-datasource.interface';\n\nexport class WebSocketDataSource extends FeatureDataSource {\n  public ws: WebSocket;\n  public options: WebSocketDataSourceOptions;\n\n  protected createOlSource(): olSourceVector<OlGeometry> {\n    this.createWebSocket();\n    this.options.format = this.getSourceFormatFromOptions(this.options);\n    return super.createOlSource();\n  }\n\n  private createWebSocket() {\n    this.ws = new WebSocket(this.options.url);\n    this.ws.onmessage = this.onMessage.bind(this);\n\n    if (this.options.onclose) {\n      this.ws.onclose = this.onClose.bind(this);\n    }\n\n    if (this.options.onerror) {\n      this.ws.onerror = this.onError.bind(this);\n    }\n\n    if (this.options.onopen) {\n      this.ws.onopen = this.onOpen.bind(this);\n    }\n  }\n\n  onMessage(event) {\n    const featureAdded = this.options.format.readFeature(event.data) as olFeature<OlGeometry>;\n\n    switch (this.options.onmessage) {\n      case 'update':\n        // ol don't add if same ID\n        const featureToRemove = this.ol.getFeatureById(featureAdded.getId());\n        if (featureToRemove) {\n          this.ol.removeFeature(featureToRemove);\n        }\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'delete':\n        this.ol.clear(true);\n        this.ol.addFeature(featureAdded);\n        break;\n      case 'add':\n      default:\n        this.ol.addFeature(featureAdded);\n    }\n  }\n\n  onClose(event) {\n    // thrown message to user\n  }\n\n  onError(event) {\n    // thrown message to user\n  }\n\n  onOpen(event) {\n    // thrown message to user ?\n  }\n\n  public onUnwatch() {\n    this.ws.close();\n  }\n}\n","import { Md5 } from 'ts-md5';\nimport feature from 'ol/Feature';\nimport olSourceVectorTile from 'ol/source/VectorTile';\nimport olFormatMVT from 'ol/format/MVT';\n\nimport { uuid } from '@igo2/utils';\n\nimport { DataSource } from './datasource';\nimport { MVTDataSourceOptions } from './mvt-datasource.interface';\n\nexport class MVTDataSource extends DataSource {\n  public options: MVTDataSourceOptions;\n  public ol: olSourceVectorTile;\n\n  protected createOlSource(): olSourceVectorTile {\n    let mvtFormat;\n    if (this.options.featureClass === 'feature') {\n      mvtFormat = new olFormatMVT({featureClass: feature});\n    } else {\n      mvtFormat = new olFormatMVT();\n    }\n    this.options.format = mvtFormat;\n    return new olSourceVectorTile(this.options);\n  }\n\n  protected generateId() {\n    if (!this.options.url) {\n        return uuid();\n    }\n    const chain = 'mvt' + this.options.url;\n    return Md5.hashStr(chain) as string;\n  }\n\n  public onUnwatch() {}\n}\n","import * as olstyle from 'ol/style';\nimport * as olproj from 'ol/proj';\n\nexport class EsriStyleGenerator {\n  public _converters: any;\n  public _renderers: any;\n\n  constructor() {\n    this._converters = {};\n    this._converters.esriPMS = EsriStyleGenerator._convertEsriPMS;\n    this._converters.esriSFS = EsriStyleGenerator._convertEsriSFS;\n    this._converters.esriSLS = EsriStyleGenerator._convertEsriSLS;\n    this._converters.esriSMS = EsriStyleGenerator._convertEsriSMS;\n    this._converters.esriTS = EsriStyleGenerator._convertEsriTS;\n    this._renderers = {};\n    this._renderers.uniqueValue = this._renderUniqueValue;\n    this._renderers.simple = this._renderSimple;\n    this._renderers.classBreaks = this._renderClassBreaks;\n  }\n  static _convertPointToPixel(point) {\n    return point / 0.75;\n  }\n  static _transformColor(color): [number, number, number, number] {\n    // alpha channel is different, runs from 0-255 but in ol3 from 0-1\n    return [color[0], color[1], color[2], color[3] / 255];\n  }\n\n  static _getResolutionForScale(scale, units) {\n    const dpi = 96;\n    const mpu = olproj.METERS_PER_UNIT[units];\n    const inchesPerMeter = 39.3701;\n    return parseFloat(scale) / (mpu * inchesPerMeter * dpi);\n  }\n\n  /* convert an Esri Text Symbol */\n  static _convertEsriTS(symbol) {\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    const text = symbol.text !== undefined ? symbol.text : undefined;\n    return new olstyle.Style({\n      text: new olstyle.Text({\n        fill: new olstyle.Fill({\n          color: EsriStyleGenerator._transformColor(symbol.color)\n        }),\n        font:\n          symbol.font.style +\n          ' ' +\n          symbol.font.weight +\n          ' ' +\n          symbol.font.size +\n          ' px ' +\n          symbol.font.family,\n        textBaseline: symbol.verticalAlignment,\n        textAlign: symbol.horizontalAlignment,\n        offsetX: EsriStyleGenerator._convertPointToPixel(symbol.xoffset),\n        offsetY: EsriStyleGenerator._convertPointToPixel(symbol.yoffset),\n        rotation,\n        text\n      })\n    });\n  }\n  /* convert an Esri Picture Marker Symbol */\n  static _convertEsriPMS(symbol) {\n    const src = 'data:' + symbol.contentType + ';base64, ' + symbol.imageData;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n\n    return new olstyle.Style({\n      image: new olstyle.Icon({\n        src,\n        rotation\n      })\n    });\n  }\n  /* convert an Esri Simple Fill Symbol */\n  static _convertEsriSFS(symbol) {\n    // there is no support in openlayers currently for fill patterns, so style is not interpreted\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    return new olstyle.Style({\n      fill,\n      stroke\n    });\n  }\n  static _convertOutline(outline) {\n    let lineDash;\n    const color = EsriStyleGenerator._transformColor(outline.color);\n    if (outline.style === 'esriSLSDash') {\n      lineDash = [5];\n    } else if (outline.style === 'esriSLSDashDot') {\n      lineDash = [5, 5, 1, 2];\n    } else if (outline.style === 'esriSLSDashDotDot') {\n      lineDash = [5, 5, 1, 2, 1, 2];\n    } else if (outline.style === 'esriSLSDot') {\n      lineDash = [1, 2];\n    } else if (outline.style === 'esriSLSNull') {\n      // line not visible, make color fully transparent\n      color[3] = 0;\n    }\n    return new olstyle.Stroke({\n      color,\n      lineDash,\n      width: EsriStyleGenerator._convertPointToPixel(outline.width)\n    });\n  }\n  /* convert an Esri Simple Line Symbol */\n  static _convertEsriSLS(symbol) {\n    return new olstyle.Style({\n      stroke: EsriStyleGenerator._convertOutline(symbol)\n    });\n  }\n  static _transformAngle(angle) {\n    if (angle === 0 || angle === undefined) {\n      return undefined;\n    }\n    const normalRad = (angle * Math.PI) / 180;\n    const ol3Rad = -normalRad + Math.PI / 2;\n    if (ol3Rad < 0) {\n      return 2 * Math.PI + ol3Rad;\n    } else {\n      return ol3Rad;\n    }\n  }\n  /* convert an Esri Simple Marker Symbol */\n  static _convertEsriSMS(symbol) {\n    const fill = new olstyle.Fill({\n      color: EsriStyleGenerator._transformColor(symbol.color)\n    });\n    const stroke = symbol.outline\n      ? EsriStyleGenerator._convertOutline(symbol.outline)\n      : undefined;\n    const radius = EsriStyleGenerator._convertPointToPixel(symbol.size) / 2;\n    const rotation = EsriStyleGenerator._transformAngle(symbol.angle);\n    if (symbol.style === 'esriSMSCircle') {\n      return new olstyle.Style({\n        image: new olstyle.Circle({\n          radius,\n          fill,\n          stroke\n        })\n      });\n    } else if (symbol.style === 'esriSMSCross') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: 0,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSDiamond') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSSquare') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSX') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 4,\n          radius,\n          radius2: 0,\n          angle: Math.PI / 4,\n          rotation\n        })\n      });\n    } else if (symbol.style === 'esriSMSTriangle') {\n      return new olstyle.Style({\n        image: new olstyle.RegularShape({\n          fill,\n          stroke,\n          points: 3,\n          radius,\n          angle: 0,\n          rotation\n        })\n      });\n    }\n  }\n\n  _convertLabelingInfo(labelingInfo, mapUnits) {\n    const styles = [];\n    for (let i = 0, ii = labelingInfo.length; i < ii; ++i) {\n      const labelExpression = labelingInfo[i].labelExpression;\n      // only limited support for label expressions\n      const field = labelExpression.substr(\n        labelExpression.indexOf('[') + 1,\n        labelExpression.indexOf(']') - 1\n      );\n      const symbol = labelingInfo[i].symbol;\n      const maxScale = labelingInfo[i].maxScale;\n      const minScale = labelingInfo[i].minScale;\n      let minResolution = null;\n      if (maxScale !== 0) {\n        minResolution = EsriStyleGenerator._getResolutionForScale(\n          maxScale,\n          mapUnits\n        );\n      }\n      let maxResolution = null;\n      if (minScale !== 0) {\n        maxResolution = EsriStyleGenerator._getResolutionForScale(\n          minScale,\n          mapUnits\n        );\n      }\n      const style = this._converters[symbol.type].call(this, symbol);\n      styles.push(\n        (() => {\n          return function(feature, resolution) {\n            let visible = true;\n            if (this.minResolution !== null && this.maxResolution !== null) {\n              visible =\n                resolution < this.maxResolution &&\n                resolution >= this.minResolution;\n            } else if (this.minResolution !== null) {\n              visible = resolution >= this.minResolution;\n            } else if (this.maxResolution !== null) {\n              visible = resolution < this.maxResolution;\n            }\n            if (visible) {\n              const value = feature.get(this.field);\n              this.style.getText().setText(value);\n              return [this.style];\n            }\n          };\n        })().bind({\n          minResolution,\n          maxResolution,\n          field,\n          style\n        })\n      );\n    }\n    return styles;\n  }\n\n  _renderSimple(renderer) {\n    const style = this._converters[renderer.symbol.type].call(\n      this,\n      renderer.symbol\n    );\n    return (() => {\n      return () => {\n        return [style];\n      };\n    })();\n  }\n  _renderClassBreaks(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    const defaultStyle = this._converters[defaultSymbol.type].call(\n      this,\n      defaultSymbol\n    );\n    const field = renderer.field;\n    const classes = [];\n    for (let i = 0, ii = renderer.classBreakInfos.length; i < ii; ++i) {\n      const classBreakInfo = renderer.classBreakInfos[i];\n      let min;\n      if (\n        classBreakInfo.classMinValue === null ||\n        classBreakInfo.classMinValue === undefined\n      ) {\n        if (i === 0) {\n          min = renderer.minValue;\n        } else {\n          min = renderer.classBreakInfos[i - 1].classMaxValue;\n        }\n      } else {\n        min = classBreakInfo.classMinValue;\n      }\n      const max = classBreakInfo.classMaxValue;\n      const symbol = classBreakInfo.symbol;\n      const style = this._converters[symbol.type].call(this, symbol);\n      classes.push({ min, max, style });\n    }\n    return (() => {\n      return (feature) => {\n        const value = feature.get(field);\n        for (let i = 0, ii = classes.length; i < ii; ++i) {\n          let condition;\n          if (i === 0) {\n            condition = value >= classes[i].min && value <= classes[i].max;\n          } else {\n            condition = value > classes[i].min && value <= classes[i].max;\n          }\n          if (condition) {\n            return [classes[i].style];\n          }\n        }\n        return [defaultStyle];\n      };\n    })();\n  }\n  _renderUniqueValue(renderer) {\n    const defaultSymbol = renderer.defaultSymbol;\n    let defaultStyle = [];\n    if (defaultSymbol) {\n      defaultStyle = [\n        this._converters[defaultSymbol.type].call(this, defaultSymbol)\n      ];\n    }\n    const field = renderer.field1;\n    const infos = renderer.uniqueValueInfos;\n    const me = this;\n    return (() => {\n      const hash = {};\n      for (let i = 0, ii = infos.length; i < ii; ++i) {\n        const info = infos[i];\n        const symbol = info.symbol;\n        hash[info.value] = [me._converters[symbol.type].call(me, symbol)];\n      }\n\n      return (feature) => {\n        const style = hash[feature.get(field)];\n        return style ? style : defaultStyle;\n      };\n    })();\n  }\n  generateStyle(layerInfo, mapUnits) {\n    const drawingInfo = layerInfo.drawingInfo;\n    let styleFunctions = [];\n    const drawingInfoStyle = this._renderers[drawingInfo.renderer.type].call(\n      this,\n      drawingInfo.renderer\n    );\n    if (drawingInfoStyle !== undefined) {\n      styleFunctions.push(drawingInfoStyle);\n    }\n    if (layerInfo.labelingInfo) {\n      const labelingInfoStyleFunctions = this._convertLabelingInfo(\n        layerInfo.labelingInfo,\n        mapUnits\n      );\n      styleFunctions = styleFunctions.concat(labelingInfoStyleFunctions);\n    }\n    if (styleFunctions.length === 1) {\n      return styleFunctions[0];\n    } else {\n      return (() => {\n        return (feature, resolution) => {\n          let styles = [];\n          for (let i = 0, ii = styleFunctions.length; i < ii; ++i) {\n            const result = styleFunctions[i].call(null, feature, resolution);\n            if (result) {\n              styles = styles.concat(result);\n            }\n          }\n          return styles;\n        };\n      })();\n    }\n  }\n}\n","export enum TimeFilterType {\n    DATE = 'date',\n    TIME = 'time',\n    DATETIME = 'datetime',\n    YEAR = 'year',\n}\n\nexport enum TimeFilterStyle {\n    CALENDAR = 'calendar',\n    SLIDER = 'slider',\n}\n","import { Injectable } from '@angular/core';\n\nimport { IgoMap } from './map';\n\n/**\n * MapService\n *\n * This service tracks the IgoMap instance, if any.\n * Currently, only one map instance is supported\n * but support for multiple maps may be added in the future.\n * This will impact other services such as the OverlayService\n * because these maps won't be sharing overlayed features.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class MapService {\n  private map: IgoMap;\n\n  constructor() {}\n\n  getMap(): IgoMap {\n    return this.map;\n  }\n\n  setMap(map: IgoMap) {\n    this.map = map;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport {\n  HttpClient,\n  HttpParams\n} from '@angular/common/http';\nimport { Observable, forkJoin, of } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport { Cacheable } from 'ts-cacheable';\n\nimport { WMSCapabilities, WMTSCapabilities, EsriJSON } from 'ol/format';\nimport { optionsFromCapabilities } from 'ol/source/WMTS.js';\nimport olAttribution from 'ol/control/Attribution';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { MapService } from '../../map/shared/map.service';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\nimport { EsriStyleGenerator } from '../utils/esri-style-generator';\nimport {\n  QueryFormat,\n  QueryFormatMimeType\n} from '../../query/shared/query.enums';\n\nimport {\n  WMTSDataSourceOptions,\n  WMSDataSourceOptions,\n  CartoDataSourceOptions,\n  ArcGISRestDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions\n} from './datasources';\nimport {\n  LegendOptions,\n  ItemStyleOptions\n} from '../../layer/shared/layers/layer.interface';\nimport {\n  TimeFilterType,\n  TimeFilterStyle\n} from '../../filter/shared/time-filter.enum';\nimport * as olproj from 'ol/proj';\n\nexport enum TypeCapabilities {\n  wms = 'wms',\n  wmts = 'wmts',\n  arcgisrest = 'esriJSON',\n  imagearcgisrest = 'esriJSON',\n  tilearcgisrest = 'esriJSON'\n}\n\nexport type TypeCapabilitiesStrings = keyof typeof TypeCapabilities;\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CapabilitiesService {\n  private parsers = {\n    wms: new WMSCapabilities(),\n    wmts: new WMTSCapabilities(),\n    esriJSON: new EsriJSON()\n  };\n\n  constructor(private http: HttpClient, private mapService: MapService) {}\n\n  getWMSOptions(\n    baseOptions: WMSDataSourceOptions\n  ): Observable<WMSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = (baseOptions.params as any).VERSION;\n\n    return this.getCapabilities('wms', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n  }\n\n  getWMTSOptions(\n    baseOptions: WMTSDataSourceOptions\n  ): Observable<WMTSDataSourceOptions> {\n    const url = baseOptions.url;\n    const version = baseOptions.version;\n\n    const options = this.getCapabilities('wmts', url, version).pipe(\n      map((capabilities: any) => {\n        return capabilities\n          ? this.parseWMTSOptions(baseOptions, capabilities)\n          : undefined;\n      })\n    );\n    return options;\n  }\n\n  getCartoOptions(\n    baseOptions: CartoDataSourceOptions\n  ): Observable<CartoDataSourceOptions> {\n    const baseUrl =\n      'https://' +\n      baseOptions.account +\n      '.carto.com/api/v2/viz/' +\n      baseOptions.mapId +\n      '/viz.json';\n\n    return this.http\n      .jsonp(baseUrl, 'callback')\n      .pipe(\n        map((cartoOptions: any) =>\n          this.parseCartoOptions(baseOptions, cartoOptions)\n        )\n      );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const serviceCapabilities = this.getCapabilities('arcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    return forkJoin([arcgisOptions, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseArcgisOptions(baseOptions, res[0], res[1]);\n      })\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getImageArcgisOptions(\n    baseOptions: ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const legendUrl = baseOptions.url + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities('imagearcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    const legend = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Image Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legend, serviceCapabilities]).pipe(\n      map((res: any) => {\n        return this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2]);\n      })\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getTileArcgisOptions(\n    baseOptions: TileArcGISRestDataSourceOptions\n  ): Observable<ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions> {\n    const baseUrl = baseOptions.url + '/' + baseOptions.layer + '?f=json';\n    const legendUrl = baseOptions.url + '/legend?f=json';\n    const serviceCapabilities = this.getCapabilities('tilearcgisrest', baseOptions.url);\n    const arcgisOptions = this.http.get(baseUrl);\n    const legendInfo = this.http.get(legendUrl).pipe(\n      map((res: any) => res),\n      catchError((err) => {\n        console.log('No legend associated with this Tile Service');\n        return of(err);\n      })\n    );\n    return forkJoin([arcgisOptions, legendInfo, serviceCapabilities]).pipe(\n      map((res: any) =>\n        this.parseTileOrImageArcgisOptions(baseOptions, res[0], res[1], res[2])\n      )\n    );\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  getCapabilities(\n    service: TypeCapabilitiesStrings,\n    baseUrl: string,\n    version?: string\n  ): Observable<any> {\n    const params = new HttpParams({\n      fromObject: {\n        request: 'GetCapabilities',\n        service: service.toUpperCase(),\n        version: version || '1.3.0',\n        _i: 'true'\n      }\n    });\n\n    let request;\n    if (TypeCapabilities[service] === 'esriJSON') {\n      request = this.http.get(baseUrl + '?f=json');\n    } else {\n      request = this.http.get(baseUrl, {\n        params,\n        responseType: 'text'\n      });\n    }\n\n    return request.pipe(\n      map((res) => {\n        if (TypeCapabilities[service] === 'esriJSON') {\n          return res as object;\n        }\n        if (\n          String(res).toLowerCase().includes('serviceexception') &&\n          String(res).toLowerCase().includes('access denied')\n        ) {\n          throw {\n            error: {\n              message: 'Service error getCapabilities: Access is denied'\n            }\n          };\n        } else {\n          return this.parsers[service].read(res);\n        }\n      }),\n      catchError((e) => {\n        if (typeof e.error !== 'undefined') {\n          e.error.caught = true;\n        }\n        throw e;\n      })\n    );\n  }\n\n  private parseWMSOptions(\n    baseOptions: WMSDataSourceOptions,\n    capabilities: any\n  ): WMSDataSourceOptions {\n    const layers = (baseOptions.params as any).LAYERS;\n    const layer = this.findDataSourceInCapabilities(\n      capabilities.Capability.Layer,\n      layers\n    );\n\n    if (!layer) {\n      throw {\n        error: {\n          message: 'Layer not found'\n        }\n      };\n    }\n    const metadata = layer.DataURL ? layer.DataURL[0] : undefined;\n    const abstract = layer.Abstract ? layer.Abstract : undefined;\n    const keywordList = layer.KeywordList ? layer.KeywordList : undefined;\n    let queryable = layer.queryable;\n    const timeFilter = this.getTimeFilter(layer);\n    const timeFilterable = timeFilter && Object.keys(timeFilter).length > 0;\n    const legendOptions = layer.Style ? this.getStyle(layer.Style) : undefined;\n    let isExtentInGeographic = true;\n    if (layer.EX_GeographicBoundingBox) {\n      layer.EX_GeographicBoundingBox.forEach((coord, index) => {\n        if (index < 2 && (coord > 180 || coord < -180)) {\n          isExtentInGeographic = false;\n        }\n        if (index >= 2 && (coord > 90 || coord < -90)) {\n          isExtentInGeographic = false;\n        }\n      });\n    } else {\n      isExtentInGeographic = false;\n    }\n\n    const extent = isExtentInGeographic ?\n        olproj.transformExtent(layer.EX_GeographicBoundingBox, 'EPSG:4326', this.mapService.getMap().projection) :\n        undefined;\n\n    let queryFormat: QueryFormat;\n    const queryFormatMimeTypePriority = [\n      QueryFormatMimeType.GEOJSON,\n      QueryFormatMimeType.GEOJSON2,\n      QueryFormatMimeType.GML3,\n      QueryFormatMimeType.GML2,\n      QueryFormatMimeType.JSON,\n      QueryFormatMimeType.HTML\n    ];\n\n    for (const mimeType of queryFormatMimeTypePriority) {\n      if (\n        capabilities.Capability.Request.GetFeatureInfo.Format.indexOf(\n          mimeType\n        ) !== -1\n      ) {\n        const keyEnum = Object.keys(QueryFormatMimeType).find(\n          (key) => QueryFormatMimeType[key] === mimeType\n        );\n        queryFormat = QueryFormat[keyEnum];\n        break;\n      }\n    }\n    if (!queryFormat) {\n      queryable = false;\n    }\n\n    const options: WMSDataSourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title,\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        extent,\n        metadata: {\n          url: metadata ? metadata.OnlineResource : undefined,\n          extern: metadata ? true : undefined,\n          abstract,\n          keywordList\n        },\n        legendOptions\n      },\n      queryable,\n      queryFormat,\n      timeFilter: timeFilterable ? timeFilter : undefined,\n      timeFilterable: timeFilterable ? true : undefined,\n      minDate: timeFilterable ? timeFilter.min : undefined,\n      maxDate: timeFilterable ? timeFilter.max : undefined,\n      stepDate: timeFilterable ? timeFilter.step : undefined\n    });\n\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseWMTSOptions(\n    baseOptions: WMTSDataSourceOptions,\n    capabilities: any\n  ): WMTSDataSourceOptions {\n    // Put Title source in _layerOptionsFromSource. (For source & catalog in _layerOptionsFromSource, if not already on config)\n    const layer = capabilities.Contents.Layer.find(\n      (el) => el.Identifier === baseOptions.layer\n    );\n\n    const options = optionsFromCapabilities(capabilities, baseOptions);\n\n    const ouputOptions = Object.assign(options, baseOptions);\n    const sourceOptions = ObjectUtils.removeUndefined({\n      _layerOptionsFromSource: {\n        title: layer.Title\n      }\n    });\n\n    return ObjectUtils.mergeDeep(sourceOptions, ouputOptions);\n  }\n\n  private parseCartoOptions(\n    baseOptions: CartoDataSourceOptions,\n    cartoOptions: any\n  ): CartoDataSourceOptions {\n    const layers = [];\n    const params = cartoOptions.layers[1].options.layer_definition;\n    params.layers.forEach((element) => {\n      layers.push({\n        type: element.type.toLowerCase(),\n        options: element.options,\n        legend: element.legend\n      });\n    });\n    const options = ObjectUtils.removeUndefined({\n      config: {\n        version: params.version,\n        layers\n      }\n    });\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseArcgisOptions(\n    baseOptions: ArcGISRestDataSourceOptions,\n    arcgisOptions: any,\n    serviceCapabilities: any,\n  ): ArcGISRestDataSourceOptions {\n    const title = arcgisOptions.name;\n    let legendInfo: any;\n\n    if (arcgisOptions.drawingInfo?.renderer) {\n      legendInfo = arcgisOptions.drawingInfo.renderer;\n    } else {\n      legendInfo = undefined;\n    }\n\n    let style;\n    if (arcgisOptions.drawingInfo) {\n      const styleGenerator = new EsriStyleGenerator();\n      const units = arcgisOptions.units === 'esriMeters' ? 'm' : 'degrees';\n      style = styleGenerator.generateStyle(arcgisOptions, units);\n    }\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        style,\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract: arcgisOptions.description || serviceCapabilities.serviceDescription\n        },\n      },\n      legendInfo,\n      timeFilter,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    options.attributions = attributions;\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private parseTileOrImageArcgisOptions(\n    baseOptions: TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions,\n    arcgisOptions: any,\n    legend: any,\n    serviceCapabilities: any\n  ): TileArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions {\n    const title = arcgisOptions.name;\n    const legendInfo = legend.layers ? legend.layers.find(x => x.layerName === title) : undefined;\n    const attributions = new olAttribution({\n      target: arcgisOptions.copyrightText\n    });\n    let timeExtent;\n    let timeFilter;\n    if (arcgisOptions.timeInfo) {\n      const time = arcgisOptions.timeInfo.timeExtent;\n      timeExtent = time[0] + ',' + time[1];\n      const min = new Date();\n      min.setTime(time[0]);\n      const max = new Date();\n      max.setTime(time[1]);\n      timeFilter = {\n        min: min.toUTCString(),\n        max: max.toUTCString(),\n        range: true,\n        type: TimeFilterType.DATETIME,\n        style: TimeFilterStyle.CALENDAR\n      };\n    }\n    const params = Object.assign(\n      {},\n      {\n        LAYERS: baseOptions.layer ? 'show:' + baseOptions.layer : undefined,\n        time: timeExtent\n      }\n    );\n    const options = ObjectUtils.removeUndefined({\n      params,\n      _layerOptionsFromSource: {\n        title,\n        minResolution: getResolutionFromScale(arcgisOptions.maxScale),\n        maxResolution: getResolutionFromScale(arcgisOptions.minScale),\n        metadata: {\n          extern: false,\n          abstract: arcgisOptions.description || serviceCapabilities.serviceDescription\n        },\n      },\n      legendInfo,\n      timeFilter,\n      sourceFields: arcgisOptions.fields,\n      queryTitle: arcgisOptions.displayField\n    });\n    options.attributions = attributions;\n    return ObjectUtils.mergeDeep(options, baseOptions);\n  }\n\n  private findDataSourceInCapabilities(layerArray, name): any {\n    if (Array.isArray(layerArray)) {\n      let layer;\n      layerArray.find((value) => {\n        layer = this.findDataSourceInCapabilities(value, name);\n        return layer !== undefined;\n      }, this);\n\n      return layer;\n    } else if (layerArray.Layer) {\n      return this.findDataSourceInCapabilities(layerArray.Layer, name);\n    } else {\n      if (layerArray.Name && layerArray.Name === name) {\n        return layerArray;\n      }\n      return undefined;\n    }\n  }\n\n  getTimeFilter(layer) {\n    let dimension;\n\n    if (layer.Dimension) {\n      const timeFilter: any = {};\n      dimension = layer.Dimension[0];\n\n      if (dimension.values) {\n        const minMaxDim = dimension.values.split('/');\n        timeFilter.min = minMaxDim[0] !== undefined ? minMaxDim[0] : undefined;\n        timeFilter.max = minMaxDim[1] !== undefined ? minMaxDim[1] : undefined;\n        timeFilter.step = minMaxDim[2] !== undefined ? minMaxDim[2] : undefined;\n      }\n\n      if (dimension.default) {\n        timeFilter.value = dimension.default;\n      }\n      return timeFilter;\n    }\n  }\n\n  getStyle(Style): LegendOptions {\n    const styleOptions: ItemStyleOptions[] = Style.map((style) => {\n      return {\n        name: style.Name,\n        title: style.Title\n      };\n    })\n      // Handle repeat the style \"default\" in output  (MapServer or OpenLayer)\n      .filter(\n        (item, index, self) =>\n          self.findIndex((i: ItemStyleOptions) => i.name === item.name) ===\n          index\n      );\n\n    const legendOptions: LegendOptions = {\n      stylesAvailable: styleOptions\n    } as LegendOptions;\n\n    return legendOptions;\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport {\n  ArcGISRestDataSourceOptions,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSourceOptions,\n  WMSDataSourceOptions\n} from '../datasources';\n\nexport abstract class OptionsService {\n  abstract getWMSOptions(\n    _baseOptions: WMSDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<WMSDataSourceOptions>;\n  abstract getArcgisRestOptions(\n    _baseOptions: ArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestDataSourceOptions | ArcGISRestImageDataSourceOptions | TileArcGISRestDataSourceOptions>;\n}\n","import { Injectable } from '@angular/core';\n\nimport proj4 from 'proj4';\nimport * as olproj from 'ol/proj';\nimport * as olproj4 from 'ol/proj/proj4';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { Projection } from './projection.interfaces';\n\n/**\n * When injected, this service automatically registers and\n * projection defined in the application config. A custom projection\n * needs to be registered to be usable by OL.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ProjectionService {\n\n  constructor(private config: ConfigService) {\n    const projections = this.config.getConfig('projections') || [];\n    projections.forEach((projection: Projection) => {\n      projection.alias = projection.alias ? projection.alias : projection.code;\n      this.registerProjection(projection);\n    });\n\n    // register all utm zones\n    for (let utmZone = 1; utmZone < 61; utmZone++) {\n      const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n      const def = `+proj=utm +zone=${utmZone} +datum=WGS84 +units=m +no_defs`;\n      const proj: Projection = { code, def, extent : undefined};\n      this.registerProjection(proj);\n    }\n\n    // register all mtm zones\n    for (let mtmZone = 1; mtmZone < 11; mtmZone++) {\n      const code = mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n      let lon0;\n      if (Number(mtmZone) <= 2) {\n        lon0 = -50 - Number(mtmZone) * 3;\n      } else if (Number(mtmZone) >= 12) {\n        lon0 = -81 - (Number(mtmZone) - 12) * 3;\n      } else {\n        lon0 = -49.5 - Number(mtmZone) * 3;\n      }\n      const def = `+proj=tmerc +lat_0=0 +lon_0=${lon0} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\"`;\n      const proj: Projection = { code, def, extent : undefined};\n      this.registerProjection(proj);\n    }\n  }\n\n  /**\n   * Define a proj4 projection and register it in OL\n   * @param projection Projection\n   */\n  registerProjection(projection: Projection) {\n    proj4.defs(projection.code, projection.def);\n    olproj4.register(proj4);\n    if (projection.extent) {\n      olproj.get(projection.code).setExtent(projection.extent);\n    }\n  }\n\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { forkJoin, of, Observable, BehaviorSubject } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { CapabilitiesService } from './capabilities.service';\nimport { OptionsService } from './options/options.service';\nimport { WFSService } from './datasources/wfs.service';\nimport {\n  DataSource,\n  OSMDataSource,\n  OSMDataSourceOptions,\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  XYZDataSource,\n  XYZDataSourceOptions,\n  TileDebugDataSource,\n  TileDebugDataSourceOptions,\n  WFSDataSource,\n  WFSDataSourceOptions,\n  WMTSDataSource,\n  WMTSDataSourceOptions,\n  WMSDataSource,\n  WMSDataSourceOptions,\n  CartoDataSource,\n  CartoDataSourceOptions,\n  ArcGISRestDataSource,\n  ArcGISRestDataSourceOptions,\n  ImageArcGISRestDataSource,\n  ArcGISRestImageDataSourceOptions,\n  TileArcGISRestDataSource,\n  TileArcGISRestDataSourceOptions,\n  WebSocketDataSource,\n  AnyDataSourceOptions,\n  MVTDataSource,\n  MVTDataSourceOptions,\n  ClusterDataSource,\n  ClusterDataSourceOptions\n} from './datasources';\nimport { ObjectUtils } from '@igo2/utils';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { ProjectionService } from '../../map/shared/projection.service';\nimport { AuthInterceptor } from '@igo2/auth';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DataSourceService {\n  public datasources$ = new BehaviorSubject<DataSource[]>([]);\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    @Optional() private optionsService: OptionsService,\n    private wfsDataSourceService: WFSService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private projectionService: ProjectionService,\n    private authInterceptor?: AuthInterceptor\n  ) {}\n\n  createAsyncDataSource(context: AnyDataSourceOptions, detailedContextUri?: string): Observable<DataSource> {\n    if (!context.type) {\n      console.error(context);\n      throw new Error('Datasource needs a type');\n    }\n    let dataSource;\n    switch (context.type.toLowerCase()) {\n      case 'osm':\n        dataSource = this.createOSMDataSource(context as OSMDataSourceOptions);\n        break;\n      case 'vector':\n        dataSource = this.createFeatureDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'wfs':\n        dataSource = this.createWFSDataSource(context as WFSDataSourceOptions);\n        break;\n      case 'wms':\n        const wmsContext = context as WMSDataSourceOptions;\n        ObjectUtils.removeDuplicateCaseInsensitive(wmsContext.params);\n        dataSource = this.createWMSDataSource(wmsContext, detailedContextUri);\n        break;\n      case 'wmts':\n        dataSource = this.createWMTSDataSource(\n          context as WMTSDataSourceOptions\n        );\n        break;\n      case 'xyz':\n        dataSource = this.createXYZDataSource(context as XYZDataSourceOptions);\n        break;\n      case 'tiledebug':\n        dataSource = this.createTileDebugDataSource(context as TileDebugDataSource);\n        break;\n      case 'carto':\n        dataSource = this.createCartoDataSource(\n          context as CartoDataSourceOptions\n        );\n        break;\n      case 'arcgisrest':\n        dataSource = this.createArcGISRestDataSource(\n          context as ArcGISRestDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'imagearcgisrest':\n        dataSource = this.createArcGISRestImageDataSource(\n          context as ArcGISRestImageDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'websocket':\n        dataSource = this.createWebSocketDataSource(\n          context as FeatureDataSourceOptions\n        );\n        break;\n      case 'mvt':\n        dataSource = this.createMVTDataSource(context as MVTDataSourceOptions);\n        break;\n      case 'tilearcgisrest':\n        dataSource = this.createTileArcGISRestDataSource(\n          context as TileArcGISRestDataSourceOptions, detailedContextUri\n        );\n        break;\n      case 'cluster':\n        dataSource = this.createClusterDataSource(\n          context as ClusterDataSourceOptions\n        );\n        break;\n      default:\n        console.error(context);\n        throw new Error('Invalid datasource type');\n    }\n\n    this.datasources$.next(this.datasources$.value.concat([dataSource]));\n\n    return dataSource;\n  }\n\n  private createOSMDataSource(\n    context: OSMDataSourceOptions\n  ): Observable<OSMDataSource> {\n    return new Observable(d => d.next(new OSMDataSource(context)));\n  }\n\n  private createFeatureDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<FeatureDataSource> {\n    return new Observable(d => d.next(new FeatureDataSource(context)));\n  }\n\n  private createWebSocketDataSource(\n    context: FeatureDataSourceOptions\n  ): Observable<WebSocketDataSource> {\n    return new Observable(d => d.next(new WebSocketDataSource(context)));\n  }\n\n  private createWFSDataSource(\n    context: WFSDataSourceOptions\n  ): Observable<WFSDataSource> {\n    return new Observable(d =>\n      d.next(new WFSDataSource(context, this.wfsDataSourceService, this.authInterceptor))\n    );\n  }\n\n  private createWMSDataSource(context: WMSDataSourceOptions, detailedContextUri?: string): Observable<any> {\n    const observables = [];\n    if (context.optionsFromCapabilities) {\n      observables.push(\n        this.capabilitiesService.getWMSOptions(context).pipe(\n          catchError(e => {\n            const title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            const message = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailable',\n              { value: context.params.LAYERS }\n            );\n\n            this.messageService.error(message, title);\n            throw e;\n          })\n        )\n      );\n    }\n\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getWMSOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n\n    observables.push(of(context));\n\n    return forkJoin(observables).pipe(\n      map((options: WMSDataSourceOptions[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new WMSDataSource(optionsMerged, this.wfsDataSourceService);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createWMTSDataSource(\n    context: WMTSDataSourceOptions\n  ): Observable<WMTSDataSource> {\n    if (context.optionsFromCapabilities) {\n      return this.capabilitiesService.getWMTSOptions(context).pipe(\n        map((options: WMTSDataSourceOptions) => {\n          return options ? new WMTSDataSource(options) : undefined;\n        }),\n        catchError(() => {\n          const title = this.languageService.translate.instant(\n            'igo.geo.dataSource.unavailableTitle'\n          );\n          const message = this.languageService.translate.instant(\n            'igo.geo.dataSource.unavailable',\n            { value: context.layer }\n          );\n\n          this.messageService.error(message, title);\n          return of(undefined);\n        })\n      );\n    }\n\n    return new Observable(d => d.next(new WMTSDataSource(context)));\n  }\n\n  private createXYZDataSource(\n    context: XYZDataSourceOptions\n  ): Observable<XYZDataSource> {\n    return new Observable(d => d.next(new XYZDataSource(context)));\n  }\n\n  private createTileDebugDataSource(\n    context: TileDebugDataSourceOptions\n  ): Observable<TileDebugDataSource> {\n    return new Observable(d => d.next(new TileDebugDataSource(context)));\n  }\n\n  private createCartoDataSource(\n    context: CartoDataSourceOptions\n  ): Observable<CartoDataSource> {\n    if (context.mapId) {\n      return this.capabilitiesService\n        .getCartoOptions(context)\n        .pipe(\n          map((options: CartoDataSourceOptions) => new CartoDataSource(options))\n        );\n    }\n    return new Observable(d => d.next(new CartoDataSource(context)));\n  }\n\n  private createArcGISRestDataSource(\n    context: ArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestDataSource> {\n    const observables = [];\n    observables.push(this.capabilitiesService.getArcgisOptions(context).pipe(\n      catchError(e => {\n        const title = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        );\n        const message = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailable',\n          { value: context.layer }\n        );\n\n        this.messageService.error(message, title);\n        throw e;\n      })\n    ));\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createArcGISRestImageDataSource(\n    context: ArcGISRestImageDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<ArcGISRestImageDataSourceOptions> {\n    const observables = [];\n\n    observables.push(this.capabilitiesService.getImageArcgisOptions(context).pipe(\n      catchError(e => {\n        const title = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        );\n        const message = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailable',\n          { value: context.params.LAYERS }\n        );\n\n        this.messageService.error(message, title);\n        throw e;\n      })\n    ));\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: ImageArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new ImageArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createTileArcGISRestDataSource(\n    context: TileArcGISRestDataSourceOptions,\n    detailedContextUri?: string\n  ): Observable<TileArcGISRestDataSource> {\n    const observables = [];\n    observables.push(this.capabilitiesService.getImageArcgisOptions(context).pipe(\n      catchError(e => {\n        const title = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        );\n        const message = this.languageService.translate.instant(\n          'igo.geo.dataSource.unavailable',\n          { value: context.params.LAYERS }\n        );\n\n        this.messageService.error(message, title);\n        throw e;\n      })\n    ));\n    if (this.optionsService && context.optionsFromApi === true) {\n      observables.push(\n        this.optionsService.getArcgisRestOptions(context, detailedContextUri).pipe(\n          catchError(e => {\n            e.error.toDisplay = true;\n            e.error.title = this.languageService.translate.instant(\n              'igo.geo.dataSource.unavailableTitle'\n            );\n            e.error.message = this.languageService.translate.instant(\n              'igo.geo.dataSource.optionsApiUnavailable'\n            );\n            return of({});\n          })\n        )\n      );\n    }\n    observables.push(of(context));\n    return forkJoin(observables).pipe(\n      map((options: TileArcGISRestDataSource[]) => {\n        const optionsMerged = options.reduce((a, b) =>\n          ObjectUtils.mergeDeep(a, b)\n        );\n        return new TileArcGISRestDataSource(optionsMerged);\n      }),\n      catchError(() => {\n        return of(undefined);\n      })\n    );\n  }\n\n  private createMVTDataSource(\n    context: MVTDataSourceOptions\n  ): Observable<MVTDataSource> {\n    return new Observable(d => d.next(new MVTDataSource(context)));\n  }\n\n  private createClusterDataSource(\n    context: ClusterDataSourceOptions\n  ): Observable<ClusterDataSource> {\n    return new Observable(d => d.next(new ClusterDataSource(context)));\n  }\n}\n","import * as olextent from 'ol/extent';\nimport * as olproj from 'ol/proj';\nimport * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport type { GeometryLayout } from 'ol/geom/Geometry';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlFormatGeoJSON from 'ol/format/GeoJSON';\nimport OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { uuid } from '@igo2/utils';\n\nimport {\n  EntityKey,\n  getEntityId,\n  getEntityTitle,\n  getEntityRevision,\n  getEntityIcon,\n  getEntityProperty\n} from '@igo2/common';\n\nimport { IgoMap } from '../../map';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource';\nimport { FEATURE, FeatureMotion } from './feature.enums';\nimport { Feature, FeatureGeometry } from './feature.interfaces';\nimport { FeatureStore } from './store';\n\n/**\n * Create an Openlayers feature object out of a feature definition.\n * The output object has a reference to the feature id.\n * @param feature Feature definition\n * @param projectionOut Feature object projection\n * @returns OpenLayers feature object\n */\nexport function featureToOl(\n  feature: Feature,\n  projectionOut: string,\n  getId?: (Feature) => EntityKey\n): OlFeature<OlGeometry> {\n  getId = getId ? getId : getEntityId;\n\n  const olFormat = new OlFormatGeoJSON();\n  const olFeature = olFormat.readFeature(feature, {\n    dataProjection: feature.projection,\n    featureProjection: projectionOut\n  });\n\n  olFeature.setId(getId(feature));\n\n  const title = getEntityTitle(feature);\n  if (title !== undefined) {\n    olFeature.set('_title', title, true);\n  }\n\n  if (feature.extent !== undefined) {\n    olFeature.set('_extent', feature.extent, true);\n  }\n\n  if (feature.projection !== undefined) {\n    olFeature.set('_projection', feature.projection, true);\n  }\n\n  const mapTitle = getEntityProperty(feature, 'meta.mapTitle');\n  if (mapTitle !== undefined) {\n    olFeature.set('_mapTitle', mapTitle, true);\n  }\n\n  olFeature.set('_entityRevision', getEntityRevision(feature), true);\n\n  const icon = getEntityIcon(feature);\n  if (icon !== undefined) {\n    olFeature.set('_icon', icon, true);\n  }\n\n  if (feature.meta && feature.meta.style) {\n    olFeature.set('_style', feature.meta.style, true);\n  }\n\n  if (feature.sourceId) {\n    olFeature.set('_sourceId', feature.sourceId, true);\n  }\n\n  return olFeature;\n}\n\nexport function renderFeatureFromOl(\n  olRenderFeature: OlRenderFeature,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let geom;\n  let title;\n  let exclude;\n  let excludeOffline;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    if (olLayer.get('sourceOptions')) {\n      exclude = olLayer.get('sourceOptions').excludeAttribute;\n      excludeOffline = olLayer.get('sourceOptions').excludeAttributeOffline;\n    }\n  } else {\n    title = olRenderFeature.get('_title');\n  }\n\n  const olFormat = new OlFormatGeoJSON();\n  const properties = olRenderFeature.getProperties();\n  const geometryType = olRenderFeature.getType();\n\n  if (geometryType === 'Polygon') {\n    const ends = olRenderFeature.getEnds() as number[];\n    geom = new OlPolygon(\n      olRenderFeature.getFlatCoordinates(),\n      'XY' as GeometryLayout,\n      ends\n    );\n  } else if (geometryType === 'Point') {\n    geom = new OlPoint(olRenderFeature.getFlatCoordinates(), 'XY' as GeometryLayout);\n  } else if (geometryType === 'LineString') {\n    geom = new OlLineString(\n      olRenderFeature.getFlatCoordinates(),\n      'XY' as GeometryLayout,\n    );\n  }\n\n  const geometry = olFormat.writeGeometryObject(geom, {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  const id = olRenderFeature.getId() ? olRenderFeature.getId() : uuid();\n  const mapTitle = olRenderFeature.get('_mapTitle');\n  const extent = olproj.transformExtent(olRenderFeature.getExtent(), projectionIn, projectionOut) as [number, number, number, number];\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent,\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olRenderFeature\n  };\n}\n/**\n * Create a feature object out of an OL feature\n * The output object has a reference to the feature id.\n * @param olFeature OL Feature\n * @param projectionIn OL feature projection\n * @param olLayer OL Layer\n * @param projectionOut Feature projection\n * @returns Feature\n */\nexport function featureFromOl(\n  olFeature: OlFeature<OlGeometry>,\n  projectionIn: string,\n  olLayer?: OlLayer<OlSource>,\n  projectionOut = 'EPSG:4326'\n): Feature {\n  let title;\n  let exclude;\n  let excludeOffline;\n  let idColumn; // for arcgisrest and tilearcgisrest source\n  const olFormat = new OlFormatGeoJSON();\n\n  const keys = olFeature.getKeys().filter((key: string) => {\n    return !key.startsWith('_') && key !== 'geometry';\n  });\n  const properties = keys.reduce((acc: object, key: string) => {\n    acc[key] = olFeature.get(key);\n    return acc;\n  }, {});\n\n  const geometry = olFormat.writeGeometryObject(olFeature.getGeometry(), {\n    dataProjection: projectionOut,\n    featureProjection: projectionIn\n  }) as FeatureGeometry;\n\n  if (olLayer) {\n    title = olLayer.get('title');\n    const sourceOptions = olLayer.get('sourceOptions');\n    if (sourceOptions) {\n      exclude = sourceOptions.excludeAttribute;\n      excludeOffline = sourceOptions.excludeAttributeOffline;\n      idColumn =\n        sourceOptions.idColumn ||\n        ((sourceOptions.type === 'arcgisrest' || sourceOptions.type === 'tilearcgisrest') ? 'OBJECTID' : undefined );\n    }\n  } else {\n    title = olFeature.get('_title');\n  }\n  const mapTitle = olFeature.get('_mapTitle');\n  const id = olFeature.getId() ? olFeature.getId() : olFeature.get(idColumn) ? olFeature.get(idColumn) : uuid();\n  const newFeature = olFeature.get('_newFeature');\n\n  return {\n    type: FEATURE,\n    projection: projectionOut,\n    extent: olFeature.get('_extent'),\n    meta: {\n      id,\n      title: title ? title : mapTitle ? mapTitle : id,\n      mapTitle,\n      revision: olFeature.getRevision(),\n      style: olFeature.get('_style'),\n      excludeAttribute: exclude,\n      excludeAttributeOffline: excludeOffline\n    },\n    properties,\n    geometry,\n    ol: olFeature\n  };\n}\n\n/**\n * Compute an OL feature extent in it's map projection\n * @param map Map\n * @param olFeature OL feature\n * @returns Extent in the map projection\n */\nexport function computeOlFeatureExtent(\n  map: IgoMap,\n  olFeature: OlFeature<OlGeometry>\n): [number, number, number, number] {\n  let olExtent = olextent.createEmpty();\n\n  const olFeatureExtent = olFeature.get('_extent');\n  const olFeatureProjection = olFeature.get('_projection');\n  if (olFeatureExtent !== undefined && olFeatureProjection !== undefined) {\n    olExtent = olproj.transformExtent(\n      olFeatureExtent,\n      olFeatureProjection,\n      map.projection\n    );\n  } else {\n    const olGeometry = olFeature.getGeometry();\n    if (olGeometry !== null) {\n      olExtent = olGeometry.getExtent();\n    }\n  }\n\n  return olExtent as [number, number, number, number];\n}\n\n/**\n * Compute a multiple OL features extent in their map projection\n * @param map Map\n * @param olFeatures OL features\n * @returns Extent in the map projection\n */\nexport function computeOlFeaturesExtent(\n  map: IgoMap,\n  olFeatures: OlFeature<OlGeometry>[]\n): [number, number, number, number] {\n  const extent = olextent.createEmpty();\n\n  olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const featureExtent = computeOlFeatureExtent(map, olFeature);\n    olextent.extend(extent, featureExtent);\n  });\n\n  return extent as [number, number, number, number];\n}\n\n/**\n * Scale an extent.\n * @param extent Extent\n * @param Scaling factors for top, right, bottom and left directions, in that order\n * @returns Scaled extent\n */\nexport function scaleExtent(\n  extent: [number, number, number, number],\n  scale: [number, number, number, number]\n): [number, number, number, number] {\n  const [width, height] = olextent.getSize(extent);\n  return [\n    scale[3] ? extent[0] - width * scale[3] : extent[0],\n    scale[2] ? extent[1] - height * scale[2] : extent[1],\n    scale[1] ? extent[2] + width * scale[1] : extent[2],\n    scale[0] ? extent[3] + height * scale[0] : extent[3]\n  ];\n}\n\n/**\n * Return true if features are out of view.\n * If features are too close to the edge, they are considered out of view.\n * We define the edge as 5% of the extent size.\n * @param map Map\n * @param featuresExtent The features's extent\n * @returns Return true if features are out of view\n */\nexport function featuresAreOutOfView(\n  map: IgoMap,\n  featuresExtent: [number, number, number, number]\n) {\n  const mapExtent = map.viewController.getExtent();\n  const edgeRatio = 0.05;\n  const scale = [-1, -1, -1, -1].map(x => x * edgeRatio);\n  const viewExtent = scaleExtent(mapExtent, scale as [\n    number,\n    number,\n    number,\n    number\n  ]);\n\n  return !olextent.containsExtent(viewExtent, featuresExtent);\n}\n\n/**\n * Return true if features are too deep into the view. This results\n * in features being too small.\n * Features are considered too small if their extent occupies less than\n * 1% of the map extent.\n * @param map Map\n * @param featuresExtent The features's extent\n * @param areaRatio The features extent to view extent acceptable ratio\n * @returns Return true if features are too deep in the view\n */\nexport function featuresAreTooDeepInView(\n  map: IgoMap,\n  featuresExtent: [number, number, number, number],\n  areaRatio?: number\n) {\n  // An area ratio of 0.004 means that the feature extent's width and height\n  // should be about 1/16 of the map extent's width and height\n  areaRatio = areaRatio ? areaRatio : 0.004;\n  const mapExtent = map.viewController.getExtent();\n  const mapExtentArea = olextent.getArea(mapExtent);\n  const featuresExtentArea = olextent.getArea(featuresExtent);\n\n  if (featuresExtentArea === 0 && map.viewController.getZoom() > 13) {\n    // In case it's a point\n    return false;\n  }\n\n  return featuresExtentArea / mapExtentArea < areaRatio;\n}\n\n/**\n * Fit view to include the features extent.\n * By default, this method will let the features occupy about 50% of the viewport.\n * @param map Map\n * @param olFeatures OL features\n * @param motion To motion to the new map view\n * @param scale If this is defined, the original view will be scaled\n *  by that factor before any logic is applied.\n */\nexport function moveToOlFeatures(\n  map: IgoMap,\n  olFeatures: OlFeature<OlGeometry>[],\n  motion: FeatureMotion = FeatureMotion.Default,\n  scale?: [number, number, number, number],\n  areaRatio?: number\n) {\n  const featuresExtent = computeOlFeaturesExtent(map, olFeatures);\n  let viewExtent = featuresExtent;\n  if (scale !== undefined) {\n    viewExtent = scaleExtent(viewExtent, scale);\n  }\n\n  if (motion === FeatureMotion.Zoom) {\n    map.viewController.zoomToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Move) {\n    map.viewController.moveToExtent(viewExtent);\n  } else if (motion === FeatureMotion.Default) {\n    if (\n      featuresAreOutOfView(map, featuresExtent) ||\n      featuresAreTooDeepInView(map, featuresExtent, areaRatio)\n    ) {\n      map.viewController.zoomToExtent(viewExtent);\n    }\n  }\n}\n\n/**\n * Hide an OL feature\n * @param olFeature OL feature\n */\nexport function hideOlFeature(olFeature: OlFeature<OlGeometry>) {\n  olFeature.setStyle(new olstyle.Style({}));\n}\n\n/**\n * Try to bind a layer to a store if none is bound already.\n * The layer will also be added to the store's map.\n * If no layer is given to that function, a basic one will be created.\n * @param store The store to bind the layer\n * @param layer An optional VectorLayer\n */\nexport function tryBindStoreLayer(store: FeatureStore, layer?: VectorLayer) {\n  if (store.layer !== undefined) {\n    if (store.layer.map === undefined) {\n      store.map.addLayer(store.layer);\n    }\n    return;\n  }\n\n  layer = layer\n    ? layer\n    : new VectorLayer({\n        source: new FeatureDataSource()\n      });\n  store.bindLayer(layer);\n  if (store.layer.map === undefined) {\n    store.map.addLayer(store.layer);\n  }\n}\n\n/**\n * Compute a diff between a source array of Ol features and a target array\n * @param source Source array of OL features\n * @param starget Target array of OL features\n * @returns Features to add and remove\n */\nexport function computeOlFeaturesDiff(\n  source: OlFeature<OlGeometry>[],\n  target: OlFeature<OlGeometry>[]\n): {\n  add: OlFeature<OlGeometry>[];\n  remove: OlFeature<OlGeometry>[];\n} {\n  const olFeaturesMap = new Map();\n  target.forEach((olFeature: OlFeature<OlGeometry>) => {\n    olFeaturesMap.set(olFeature.getId(), olFeature);\n  });\n\n  const olFeaturesToRemove = [];\n  source.forEach((olFeature: OlFeature<OlGeometry>) => {\n    const newOlFeature = olFeaturesMap.get(olFeature.getId());\n    if (newOlFeature === undefined) {\n      olFeaturesToRemove.push(olFeature);\n    } else if (\n      newOlFeature.get('_entityRevision') !== olFeature.get('_entityRevision')\n    ) {\n      olFeaturesToRemove.push(olFeature);\n    } else {\n      olFeaturesMap.delete(newOlFeature.getId());\n    }\n  });\n\n  const olFeaturesToAddIds = Array.from(olFeaturesMap.keys());\n  const olFeaturesToAdd = target.filter((olFeature: OlFeature<OlGeometry>) => {\n    return olFeaturesToAddIds.indexOf(olFeature.getId()) >= 0;\n  });\n\n  return {\n    add: olFeaturesToAdd,\n    remove: olFeaturesToRemove\n  };\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olextent from 'ol/extent';\n\nimport {\n  getEntityId,\n  EntityKey,\n  EntityStore\n} from '@igo2/common';\n\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer';\nimport { IgoMap, MapExtent } from '../../map';\n\nimport { FeatureMotion } from './feature.enums';\nimport { Feature, FeatureStoreOptions } from './feature.interfaces';\nimport { computeOlFeaturesDiff, featureFromOl, featureToOl, moveToOlFeatures, computeOlFeaturesExtent } from './feature.utils';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * features and the map layer to display them on. Synchronization\n * between the store and the layer is handled by strategies.\n */\nexport class FeatureStore<T extends Feature = Feature> extends EntityStore<T> {\n\n  /**\n   * Vector layer to display the features on\n   */\n  layer: VectorLayer;\n\n  /**\n   * The map the layer is bound to\n   */\n  readonly map: IgoMap;\n\n  /**\n   * The layer's data source\n   */\n  get source(): FeatureDataSource {\n    return this.layer ? this.layer.dataSource as FeatureDataSource : undefined;\n  }\n\n  constructor(entities: T[], options: FeatureStoreOptions) {\n    super(entities, options);\n    this.map = options.map;\n  }\n\n  /**\n   * Bind this store to a vector layer\n   * @param layer Vector layer\n   * @returns Feature store\n   */\n  bindLayer(layer: VectorLayer): FeatureStore {\n    this.layer = layer;\n    return this;\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible. Strategies\n   * make extensive use of that method.\n   * @param features Features\n   * @param motion Optional: The type of motion to perform\n   */\n  setLayerFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number,\n    getId?: (Feature) => EntityKey\n  ) {\n    getId = getId ? getId : getEntityId;\n    this.checkLayer();\n\n    const olFeatures = features\n      .map((feature: Feature) => featureToOl(feature, this.map.projection, getId));\n    this.setLayerOlFeatures(olFeatures, motion, viewScale, areaRatio);\n  }\n\n  /**\n   * Set the store's features from an array of OL features.\n   * @param olFeatures Ol features\n   */\n  setStoreOlFeatures(olFeatures: OlFeature<OlGeometry>[]) {\n    this.checkLayer();\n\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n      return featureFromOl(olFeature, this.layer.map.projection);\n    });\n    this.load(features as T[]);\n  }\n\n  /**\n   * Remove all features from the layer\n   */\n  clearLayer() {\n    this.checkLayer();\n    this.source.ol.clear();\n  }\n\n  /**\n   * Check wether a layer is bound or not and throw an error if not.\n   */\n  private checkLayer() {\n    if (this.layer === undefined) {\n      throw new Error('This FeatureStore is not bound to a layer.');\n    }\n  }\n\n  /**\n   * Set the layer's features and perform a motion to make them visible.\n   * @param features Openlayers feature objects\n   * @param motion Optional: The type of motion to perform\n   */\n  public setLayerOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    viewScale?: [number, number, number, number],\n    areaRatio?: number\n  ) {\n    const olSource = this.layer.ol.getSource();\n    const diff = computeOlFeaturesDiff(olSource.getFeatures(), olFeatures);\n    if (diff.remove.length > 0) {\n      this.removeOlFeaturesFromLayer(diff.remove);\n    }\n\n    if (diff.add.length > 0) {\n      this.addOlFeaturesToLayer(diff.add);\n    }\n\n    if (diff.add.length > 0) {\n      // If features are added, do a motion toward the newly added features\n      moveToOlFeatures(this.map, diff.add, motion, viewScale, areaRatio);\n    } else if (diff.remove.length > 0) {\n      // Else, do a motion toward all the features\n      moveToOlFeatures(this.map, olFeatures, motion, viewScale, areaRatio);\n    }\n  }\n\n  setLayerExtent(): void {\n    let features = this.entities$.getValue();\n    let extent = olextent.createEmpty() as MapExtent;\n    let olFeatures = [];\n\n    features.forEach((feature) => {\n      olFeatures.push(featureToOl(feature, this.map.projection));\n    });\n    const featuresExtent = computeOlFeaturesExtent(this.map, olFeatures);\n    olextent.extend(extent, featuresExtent);\n    this.layer.setExtent(extent);\n  }\n  /**\n   * Add features to the the layer\n   * @param features Openlayers feature objects\n   */\n  private addOlFeaturesToLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      olFeature.set('_featureStore', this, true);\n    });\n    this.source.ol.addFeatures(olFeatures);\n  }\n\n  /**\n   * Remove features from the the layer\n   * @param features Openlayers feature objects\n   */\n  private removeOlFeaturesFromLayer(olFeatures: OlFeature<OlGeometry>[]) {\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      this.source.ol.removeFeature(olFeature);\n    });\n  }\n\n}\n","import * as olextent from 'ol/extent';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreInMapExtentStrategyOptions } from '../feature.interfaces';\nimport { Subscription } from 'rxjs';\nimport { skipWhile } from 'rxjs/operators';\n\n/**\n * This strategy maintain the store features updated while the map is moved.\n * The features's state inside the map are tagged inMapExtent = true;\n */\nexport class FeatureStoreInMapExtentStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private states$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapExtentStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$\n      .pipe(skipWhile((empty) => !empty))\n      .subscribe(() => this.updateEntitiesInExtent(store));\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInExtent(store);\n    this.states$$.push(store.layer.map.viewController.state$.subscribe(() => {\n      this.updateEntitiesInExtent(store);\n    }));\n  }\n\n  private updateEntitiesInExtent(store) {\n    if (store?.layer?.map?.viewController) {\n      store.state.updateAll({ inMapExtent: false });\n      const mapExtent = store.layer.map.viewController.getExtent();\n      let entitiesInMapExtent = [];\n      let entitiesWithNoGeom = [];\n      for (const entity of store.entities$.value) {\n        if (entity.ol) {\n          if (olextent.intersects(entity.ol.getGeometry().getExtent(), mapExtent)) {\n            entitiesInMapExtent.push(entity);\n          }\n        } else {\n          entitiesWithNoGeom.push(entity);\n        }\n      }\n      if (entitiesInMapExtent.length > 0) {\n        store.state.updateMany(entitiesInMapExtent, { inMapExtent: true }, false);\n      }\n      if (entitiesWithNoGeom.length > 0) {\n        store.state.updateMany(entitiesWithNoGeom, { inMapExtent: true }, false);\n      }\n    }\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.states$$.map(state => state.unsubscribe());\n    if (this.empty$$) { this.empty$$.unsubscribe(); }\n  }\n}\n","import { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreInMapResolutionStrategyOptions } from '../feature.interfaces';\nimport { Subscription } from 'rxjs';\n\n\n/**\n * This strategy maintain the store features updated while the map is scrolled.\n * The features's state inside the map's resolution are tagged inMapResolution = true;\n */\nexport class FeatureStoreInMapResolutionStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n  private resolution$$: Subscription[] = [];\n  private empty$$: Subscription;\n\n  constructor(protected options: FeatureStoreInMapResolutionStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n    this.empty$$ = store.empty$\n      .subscribe(() => this.updateEntitiesInResolution(store, store.layer.map.viewController.getResolution()));\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.updateEntitiesInResolution(store, store.layer.map.viewController.getResolution());\n    this.resolution$$.push(store.layer.map.viewController.resolution$.subscribe((res) => {\n      this.updateEntitiesInResolution(store, res);\n    }));\n  }\n\n  private updateEntitiesInResolution(store, mapResolution: number) {\n    if (mapResolution > store.layer.minResolution && mapResolution < store.layer.maxResolution) {\n      store.state.updateAll({ inMapResolution: true });\n    } else {\n      store.state.updateAll({ inMapResolution: false });\n    }\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    this.stores$$.clear();\n    this.resolution$$.map(state => state.unsubscribe());\n    if (this.empty$$) { this.empty$$.unsubscribe(); }\n  }\n}\n","import { Subscription } from 'rxjs';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureMotion } from '../feature.enums';\nimport { Feature, FeatureStoreLoadingStrategyOptions } from '../feature.interfaces';\nimport { FeatureStore } from '../store';\n\n/**\n * This strategy loads a store's features into it's layer counterpart.\n * The store -> layer binding is a one-way binding. That means any entity\n * added to the store will be added to the layer but the opposite is false.\n *\n * Important: This strategy observes filtered entities, not raw entities. This\n * is not configurable yet.\n */\nexport class FeatureStoreLoadingStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's features\n   */\n  private stores$$ = new Map<FeatureStore, Subscription>();\n\n  private motion: FeatureMotion;\n\n  constructor(protected options: FeatureStoreLoadingStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for entities changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for entities changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Define the motion to apply on load\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for entities changes in a store.\n   * Important: Never observe a store's sorted entities. It makes no sense\n   * to display sorted entities (instead of unsorted) on a layer and it\n   * would potentially result in a lot of useless computation.\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    const subscription = store.view.all$()\n      .subscribe((features: Feature[]) => this.onFeaturesChange(features, store));\n    this.stores$$.set(store, subscription);\n  }\n\n  /**\n   * Stop watching for entities changes in a store.\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const subscription = this.stores$$.get(store);\n    if (subscription !== undefined) {\n      subscription.unsubscribe();\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for entities changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, Subscription]) => {\n      entries[1].unsubscribe();\n    });\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features into a layer or clear the layer if the array of features is empty.\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onFeaturesChange(features: Feature[], store: FeatureStore) {\n    if (features.length === 0) {\n      store.clearLayer();\n    } else {\n      store.setLayerFeatures(\n        features,\n        this.selectMotion(store),\n        this.options.viewScale,\n        this.options.areaRatio,\n        this.options.getFeatureId\n      );\n    }\n  }\n\n  /**\n   * Selects the best motion\n   * @param store A FeatureStore to apply the motion\n   * @returns The motion selected\n   */\n  private selectMotion(store: FeatureStore) {\n    if (this.motion !== undefined) { return this.motion; }\n\n    if (store.pristine === true) {\n      // If features have just been loaded into the store, move/zoom on them\n      return FeatureMotion.Default;\n    } else if (store.count > store.view.count) {\n      // If features have been filtered, move/zoom on the remaining ones\n      return FeatureMotion.Default;\n    } else {\n      // On insert, update or delete, do nothing\n      return FeatureMotion.None;\n    }\n  }\n}\n","import OlEvent from 'ol/events/Event';\n\nimport { EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureStore } from '../store';\nimport { FeatureStoreLoadingLayerStrategyOptions } from '../feature.interfaces';\nimport { ClusterDataSource } from '../../../datasource/shared/datasources/cluster-datasource';\n\n/**\n * This strategy loads a layer's features into it's store counterpart.\n * The layer -> store binding is a one-way binding. That means any OL feature\n * added to the layer will be added to the store but the opposite is false.\n *\n * Important: In it's current state, this strategy is to meant to be combined\n * with a standard Loading strategy and it would probably cause recursion issues.\n */\nexport class FeatureStoreLoadingLayerStrategy extends EntityStoreStrategy {\n\n  /**\n   * Subscription to the store's OL source changes\n   */\n  private stores$$ = new Map<FeatureStore, string>();\n\n  constructor(protected options: FeatureStoreLoadingLayerStrategyOptions) {\n    super(options);\n  }\n\n  /**\n   * Bind this strategy to a store and start watching for Ol source changes\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      this.watchStore(store);\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and stop watching for Ol source changes\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      this.unwatchStore(store);\n    }\n  }\n\n  /**\n   * Start watching all stores already bound to that strategy at once.\n   * @internal\n   */\n  protected doActivate() {\n    this.stores.forEach((store: FeatureStore) => this.watchStore(store));\n  }\n\n  /**\n   * Stop watching all stores bound to that strategy\n   * @internal\n   */\n  protected doDeactivate() {\n    this.unwatchAll();\n  }\n\n  /**\n   * Watch for a store's  OL source changes\n   * @param store Feature store\n   */\n  private watchStore(store: FeatureStore) {\n    if (this.stores$$.has(store)) {\n      return;\n    }\n\n    this.onSourceChanges(store);\n    const olSource = store.layer.ol.getSource();\n    olSource.on('change', (event: OlEvent) => {\n      this.onSourceChanges(store);\n    });\n  }\n\n  /**\n   * Stop watching for a store's OL source changes\n   * @param store Feature store\n   */\n  private unwatchStore(store: FeatureStore) {\n    const key = this.stores$$.get(store);\n    if (key !== undefined) {\n      this.stores$$.delete(store);\n    }\n  }\n\n  /**\n   * Stop watching for OL source changes in all stores.\n   */\n  private unwatchAll() {\n    Array.from(this.stores$$.entries()).forEach((entries: [FeatureStore, string]) => {\n    });\n    this.stores$$.clear();\n  }\n\n  /**\n   * Load features from an OL source into a  store or clear the store if the source is empty\n   * @param features Store filtered features\n   * @param store Feature store\n   */\n  private onSourceChanges(store: FeatureStore) {\n    let olFeatures = store.layer.ol.getSource().getFeatures();\n\n    if (store.layer.dataSource instanceof ClusterDataSource) {\n      olFeatures = (olFeatures as any).flatMap((cluster: any) =>\n        cluster.get('features')\n      );\n    }\n    if (olFeatures.length === 0) {\n      store.clear();\n    } else {\n      store.setStoreOlFeatures(olFeatures);\n    }\n  }\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlDragBoxInteraction, { DragBoxEvent } from 'ol/interaction/DragBox';\nimport { DragBoxEvent as OlDragBoxEvent } from 'ol/interaction/DragBox';\nimport { EventsKey } from 'ol/events';\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { unByKey } from 'ol/Observable';\n\nimport { Subscription, combineLatest } from 'rxjs';\nimport { map, debounceTime, skip } from 'rxjs/operators';\n\nimport { EntityKey, EntityRecord, EntityStoreStrategy } from '@igo2/common';\n\nimport { FeatureDataSource } from '../../../datasource';\nimport { VectorLayer } from '../../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../../map/shared/map';\nimport { ctrlKeyDown } from '../../../map/shared/map.utils';\n\nimport {\n  Feature,\n  FeatureStoreSelectionStrategyOptions\n} from '../feature.interfaces';\nimport { FeatureStore } from '../store';\nimport { FeatureMotion } from '../feature.enums';\n\nexport class OlDragSelectInteraction extends OlDragBoxInteraction {\n  constructor(options) {\n    super(options);\n  }\n}\n\n/**\n * This strategy synchronizes a store and a layer selected entities.\n * The store <-> layer binding is a two-way binding.\n *\n * In many cases, a single strategy bound to multiple stores\n * will yield better results that multiple strategies with each their\n * own store. In the latter scenario, a click on overlapping features\n * would trigger the strategy of each layer and they would cancel\n * each other as well as move the map view around needlessly.\n */\nexport class FeatureStoreSelectionStrategy extends EntityStoreStrategy {\n  /**\n   * Listener to the map click event that allows selecting a feature\n   * by clicking on the map\n   */\n  private mapClickListener;\n\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Subscription to all stores selected entities\n   */\n  private stores$$: Subscription;\n\n  private motion: FeatureMotion;\n\n  /**\n   * The map the layers belong to\n   */\n  get map(): IgoMap {\n    return this.options.map;\n  }\n\n  /**\n   * A feature store that'll contain the selected features. It has it's own\n   * layer, shared by all the stores this staretgy is bound to.\n   */\n  get overlayStore(): FeatureStore {\n    return this._overlayStore;\n  }\n  private _overlayStore: FeatureStore;\n\n  constructor(protected options: FeatureStoreSelectionStrategyOptions) {\n    super(options);\n    this.setMotion(options.motion);\n    this._overlayStore = this.createOverlayStore();\n  }\n\n  /**\n   * Bind this strategy to a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  bindStore(store: FeatureStore) {\n    super.bindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Unbind this strategy from a store and force this strategy's\n   * reactivation to properly setup watchers.\n   * @param store Feature store\n   */\n  unbindStore(store: FeatureStore) {\n    super.unbindStore(store);\n    if (this.active === true) {\n      // Force reactivation\n      this.activate();\n    }\n  }\n\n  /**\n   * Define the motion to apply on select\n   * @param motion Feature motion\n   */\n  setMotion(motion: FeatureMotion) {\n    this.motion = motion;\n  }\n\n  /**\n   * Unselect all entities, from all stores\n   */\n  unselectAll() {\n    this.stores.forEach((store: FeatureStore) => {\n      store.state.updateAll({ selected: false });\n    });\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.overlayStore.source.ol.clear();\n    this.overlayStore.clear();\n  }\n\n  /**\n   * Deactivate the selection without removing the selection\n   * overlay.\n   */\n  deactivateSelection() {\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n    this.unwatchAll();\n  }\n\n  /**\n   * Add the overlay layer, setup the map click lsitener and\n   * start watching for stores selection\n   * @internal\n   */\n  protected doActivate() {\n    this.addOverlayLayer();\n    this.listenToMapClick();\n    if (this.options.dragBox === true) {\n      this.addDragBoxInteraction();\n    }\n    this.watchAll();\n  }\n\n  /**\n   * Remove the overlay layer, remove the map click lsitener and\n   * stop watching for stores selection\n   * @internal\n   */\n  protected doDeactivate() {\n    this.deactivateSelection();\n    this.removeOverlayLayer();\n  }\n\n  /**\n   * Create a single observable of all the stores. With a single observable,\n   * features can be added all at once to the overlay layer and a single\n   * motion can be performed. Multiple observable would have\n   * a cancelling effect on each other.\n   */\n  private watchAll() {\n    this.unwatchAll();\n\n    const stores$ = this.stores.map((store: FeatureStore) => {\n      return store.stateView\n        .manyBy$((record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        })\n        .pipe(\n          map((records: EntityRecord<Feature>[]) =>\n            records.map((record) => record.entity)\n          )\n        );\n    });\n    this.stores$$ = combineLatest(stores$)\n      .pipe(\n        debounceTime(5),\n        skip(1), // Skip intial selection\n        map((features: Array<Feature[]>) =>\n          features.reduce((a, b) => a.concat(b))\n        )\n      )\n      .subscribe((features: Feature[]) => this.onSelectFromStore(features));\n  }\n\n  /**\n   * Stop watching for selection in all stores.\n   */\n  private unwatchAll() {\n    if (this.stores$$ !== undefined) {\n      this.stores$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a 'singleclick' listener to the map that'll allow selecting\n   * features by clicking on the map. The selection will be performed\n   * only on the layers bound to this strategy.\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => {\n        this.onMapClick(event);\n      }\n    );\n  }\n\n  /**\n   * Remove the map click listener\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n  }\n\n  /**\n   * On map click, select feature at pixel\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onMapClick(event: MapBrowserPointerEvent<any>) {\n    const exclusive = !ctrlKeyDown(event);\n    const reverse = !exclusive;\n    const olFeatures = event.map.getFeaturesAtPixel(event.pixel, {\n      hitTolerance: this.options.hitTolerance || 0,\n      layerFilter: olLayer => {\n        const storeOlLayer = this.stores.find((store: FeatureStore) => {\n          return store.layer?.ol === olLayer;\n        });\n        return storeOlLayer !== undefined;\n      }\n    }) as OlFeature<OlGeometry>[];\n    this.onSelectFromMap(olFeatures, exclusive, reverse);\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteraction;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteraction = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteraction === undefined) {\n      olDragSelectInteraction = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteraction);\n      this.olDragSelectInteraction = olDragSelectInteraction;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteraction.on(\n      'boxend',\n      (event: DragBoxEvent) => this.onDragBoxEnd(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n\n  /**\n   * On dragbox end, select features in drag box\n   * @param event OL MapBrowserPointerEvent\n   */\n  private onDragBoxEnd(event: OlDragBoxEvent) {\n    const exclusive = !ctrlKeyDown(event.mapBrowserEvent);\n    const target = event.target as any;\n    const extent = target.getGeometry().getExtent();\n    const olFeatures = this.stores.reduce(\n      (acc: OlFeature<OlGeometry>[], store: FeatureStore) => {\n        const olSource = store.layer.ol.getSource();\n        acc.push(...olSource.getFeaturesInExtent(extent));\n        return acc;\n      },\n      []\n    );\n    this.onSelectFromMap(olFeatures, exclusive, false);\n  }\n\n  /**\n   * When features are selected from the store, add\n   * them to this startegy's overlay layer (select on map)\n   * @param features Store features\n   */\n  private onSelectFromStore(features: Feature[]) {\n    const motion = this.motion;\n    const olOverlayFeatures = this.overlayStore.layer.ol\n      .getSource()\n      .getFeatures();\n    const overlayFeaturesKeys = olOverlayFeatures.map((olFeature: OlFeature<OlGeometry>) =>\n      olFeature.getId()\n    );\n    const featuresKeys = features.map(this.overlayStore.getKey);\n\n    let doMotion;\n    if (features.length === 0) {\n      doMotion = false;\n    } else {\n      doMotion =\n        overlayFeaturesKeys.length !== featuresKeys.length ||\n        !overlayFeaturesKeys.every(\n          (key: EntityKey) => featuresKeys.indexOf(key) >= 0\n        );\n    }\n\n    this.overlayStore.setLayerFeatures(\n      features,\n      doMotion ? motion : FeatureMotion.None,\n      this.options.viewScale,\n      this.options.areaRatio,\n      this.options.getFeatureId\n    );\n  }\n\n  /**\n   * When features are selected from the map, also select them\n   * in their store.\n   * @param olFeatures OL feature objects\n   */\n  private onSelectFromMap(\n    olFeatures: OlFeature<OlGeometry>[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    const groupedFeatures = this.groupFeaturesByStore(olFeatures);\n\n    this.stores.forEach((store: FeatureStore) => {\n      const features = groupedFeatures.get(store);\n      if (features === undefined && exclusive === true) {\n        this.unselectAllFeaturesFromStore(store);\n      } else if (features === undefined && exclusive === false) {\n        // Do nothing\n      } else {\n        this.selectFeaturesFromStore(store, features, exclusive, reverse);\n      }\n    });\n  }\n\n  /**\n   * Select features in store\n   * @param store: Feature store\n   * @param features Features\n   */\n  private selectFeaturesFromStore(\n    store: FeatureStore,\n    features: Feature[],\n    exclusive: boolean,\n    reverse: boolean\n  ) {\n    if (reverse === true) {\n      store.state.reverseMany(features, ['selected']);\n    } else {\n      store.state.updateMany(features, { selected: true }, exclusive);\n    }\n  }\n\n  /**\n   * Unselect all features from store\n   * @param store: Feature store\n   */\n  private unselectAllFeaturesFromStore(store: FeatureStore) {\n    store.state.updateAll({ selected: false });\n  }\n\n  /**\n   * This method returns a store -> features mapping from a list\n   * of OL selected features. OL features keep a reference to the store\n   * they are from.\n   * @param olFeatures: OL feature objects\n   * @returns Store -> features mapping\n   */\n  private groupFeaturesByStore(\n    olFeatures: OlFeature<OlGeometry>[]\n  ): Map<FeatureStore, Feature[]> {\n    const groupedFeatures = new Map<FeatureStore, Feature[]>();\n    if (olFeatures === null || olFeatures === undefined) {\n      return groupedFeatures;\n    }\n\n    olFeatures.forEach((olFeature: OlFeature<OlGeometry>) => {\n      const store = olFeature.get('_featureStore');\n      if (store === undefined) {\n        return;\n      }\n\n      let features = groupedFeatures.get(store);\n      if (features === undefined) {\n        features = [];\n        groupedFeatures.set(store, features);\n      }\n\n      const feature = store.get(olFeature.getId());\n      if (feature !== undefined) {\n        features.push(feature);\n      }\n    });\n\n    return groupedFeatures;\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay store\n   */\n  private createOverlayStore(): FeatureStore {\n    const overlayLayer = this.options.layer\n      ? this.options.layer\n      : this.createOverlayLayer();\n    return new FeatureStore([], { map: this.map }).bindLayer(overlayLayer);\n  }\n\n  /**\n   * Create an overlay store that'll contain the selected features.\n   * @returns Overlay layer\n   */\n  private createOverlayLayer(): VectorLayer {\n    return new VectorLayer({\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      style: undefined,\n      showInLayerList: false,\n      exportable: false,\n      browsable: false\n    });\n  }\n\n  /**\n   * Add the overlay store's layer to the map to display the selected\n   * features.\n   */\n  private addOverlayLayer() {\n    if (this.overlayStore.layer.map === undefined) {\n      this.map.addLayer(this.overlayStore.layer);\n    }\n  }\n\n  /**\n   * Remove the overlay layer from the map\n   */\n  private removeOverlayLayer() {\n    this.overlayStore.source.ol.clear();\n    this.map.removeLayer(this.overlayStore.layer);\n  }\n}\n","import { FeatureStore } from './store';\nimport { FeatureStoreSelectionStrategy } from './strategies/selection';\nimport { FeatureStoreLoadingStrategy } from './strategies/loading';\n\n/**\n * Try to add a loading strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the loading strategy\n * @param strategy An optional loading strategy\n */\nexport function tryAddLoadingStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreLoadingStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreLoadingStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreLoadingStrategy);\n    return;\n  }\n\n  strategy = strategy ? strategy : new FeatureStoreLoadingStrategy({});\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n\n/**\n * Try to add a selection strategy to a store and activate it.\n * If no strategy is given to that function, a basic one will be created.\n * @param store The store to bind the selection strategy\n * @param [strategy] An optional selection strategy\n */\nexport function tryAddSelectionStrategy(\n  store: FeatureStore,\n  strategy?: FeatureStoreSelectionStrategy\n) {\n  if (store.getStrategyOfType(FeatureStoreSelectionStrategy) !== undefined) {\n    store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n    return;\n  }\n  strategy = strategy\n    ? strategy\n    : new FeatureStoreSelectionStrategy({\n        map: store.map\n      });\n  store.addStrategy(strategy);\n  strategy.activate();\n}\n","import * as olstyle from 'ol/style';\nimport { asArray as ColorAsArray } from 'ol/color';\n\n/**\n * Create a marker style for points\n * @returns Style\n */\nexport function createOverlayMarkerStyle({\n  text,\n  opacity = 1,\n  markerColor = [0, 161, 222],\n  markerOutlineColor = [255, 255, 255]\n}: {\n  text?: string;\n  opacity?: number;\n  markerColor?: string | number[];\n  markerOutlineColor?: string | number[];\n} = {}): olstyle.Style {\n  let iconColor;\n  let svgIconColor;\n  let svgOutlineColor;\n  let svg;\n\n  const isIE = /msie\\s|trident\\/|edge\\//i.test(window.navigator.userAgent); // To fix IE11 svg bug (temporarly)\n\n  const newColor = ColorAsArray(markerColor).slice(0);\n  const newOutlineColor = ColorAsArray(markerOutlineColor).slice(0);\n\n  if (newColor.length === 4 && (typeof markerColor !== 'string' || /^#[0-9A-F]{8}$/i.test(markerColor as string))) {\n    opacity = newColor[3];\n  }\n\n  svgIconColor = `\"rgba(${newColor[0]},${newColor[1]},${newColor[2]},${opacity})\"`;\n  iconColor = markerColor;\n\n  svgOutlineColor = `\"rgb(${newOutlineColor[0]},${newOutlineColor[1]},${newOutlineColor[2]})\"`;\n\n  svg =\n    'data:image/svg+xml;utf8,<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" height=\"36\" width=\"36\" viewBox=\"0 0 36 36\">' +\n    '<path fill=' +\n    svgIconColor +\n    ' stroke=' +\n    svgOutlineColor +\n    ` stroke-width=\"2\" d=\"M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z\"></path>` +\n    '</svg>';\n\n  let src;\n  if (isIE) {\n    switch (markerColor) {\n      case 'blue' || [0, 161, 222] || '#00a1de':\n        iconColor = 'blue';\n        break;\n      case 'red' || '#f64139':\n        iconColor = 'red';\n        break;\n      case 'yellow' || '#ffd700':\n        iconColor = 'yellow';\n        break;\n      case 'green' || '#008000':\n        iconColor = 'green';\n        break;\n      default:\n        iconColor = 'blue';\n        break;\n    }\n    src = './assets/igo2/geo/icons/place_' + iconColor + '_36px.svg';\n  } else {\n    src = svg;\n  }\n\n  return new olstyle.Style({\n    image: new olstyle.Icon({\n      src: svg,\n      opacity,\n      imgSize: [36, 36], // for ie\n      anchor: [0.5, 0.92]\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import { Injectable } from '@angular/core';\n\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport { StyleByAttribute } from './vector-style.interface';\n\nimport { ClusterParam } from './clusterParam';\nimport { createOverlayMarkerStyle } from '../../overlay/shared/overlay-marker-style.utils';\nimport RenderFeature from 'ol/render/Feature';\nimport { getResolutionFromScale } from '../../map/shared/map.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleService {\n  public style: olstyle.Style;\n\n  /**\n   * Create a style based on a object as\n   * style: {\n   *       \"stroke\": {\n   *         \"color\": \"blue\",\n   *         \"lineDash\": [10, 5]\n   *       },\n   *       \"text\": {\n   *         \"minScaleDenom\": 50000,\n   *         \"maxScaleDenom\": 200000,\n   *         \"minResolution\": 100,\n   *         \"maxResolution\": 400,\n   *         \"attribute\": \"THE COLUMN NAME TO RETRIEVE THE LABEL VALUE\",\n   *         \"text\": \"MY HARCODED TEXT\",\n   *         \"stroke\": {\n   *           \"color\": \"blue\",\n   *           \"width\": 0.75\n   *         },\n   *         \"fill\": {\n   *           \"color\": \"black\"\n   *         },\n   *         \"font\": \"20px sans-serif\",\n   *         \"overflow\": true,\n   *         \"offsetX\": 10,\n   *         \"offsetY\": 20,\n   *         \"padding\": [2.5, 2.5, 2.5, 2.5]\n   *       },\n   *       \"width\": 5\n   *     }\n   *\n   * @param options\n   * @param feature feature to apply style on\n   * @param resolution current map resolution, to control label resolution range\n   * @returns\n   */\n  createStyle(options: { [key: string]: any }, feature?: RenderFeature | OlFeature<OlGeometry>, resolution?: number) {\n\n    if (!options) {\n      return createOverlayMarkerStyle();\n    }\n    if (typeof options === 'function' || options instanceof olstyle.Style) {\n      return options;\n    }\n    const parsedStyle = this.parseStyle('style', options);\n    if (parsedStyle.getText()) {\n      let labelMinResolution = 0;\n      let labelMaxResolution = Infinity;\n      if (options.text) {\n        const labelMinResolutionFromScale =\n          options.text?.minScaleDenom ? getResolutionFromScale(Number(options.text.minScaleDenom)) : undefined;\n        const labelMaxResolutionFromScale =\n          options.text?.maxScaleDenom ? getResolutionFromScale(Number(options.text.maxScaleDenom)) : undefined;\n        const minResolution = options.text?.minResolution ? options.text.minResolution : 0;\n        const maxResolution = options.text?.maxResolution ? options.text.maxResolution : Infinity;\n\n        labelMinResolution = labelMinResolutionFromScale || minResolution;\n        labelMaxResolution = labelMaxResolutionFromScale || maxResolution;\n      }\n      if (feature && resolution >= labelMinResolution && resolution <= labelMaxResolution) {\n        if (feature && options.text.attribute) {\n          parsedStyle.getText().setText(this.getLabel(feature, options.text.attribute));\n        }\n      } else {\n        parsedStyle.setText();\n      }\n    }\n    return parsedStyle;\n  }\n\n  private parseStyle(key: string, value: any) {\n    const styleOptions = {};\n    const olCls = this.getOlCls(key);\n\n    if (olCls && value instanceof Object) {\n      Object.keys(value).forEach(_key => {\n        const olKey = this.getOlKey(_key);\n        styleOptions[olKey] = this.parseStyle(_key, value[_key]);\n      });\n      return new olCls(styleOptions);\n    } else {\n      return value;\n    }\n  }\n\n  private getOlKey(key: any) {\n    let olKey;\n    switch (key.toLowerCase()) {\n      case 'circle':\n      case 'regularshape':\n      case 'icon':\n        olKey = 'image';\n        break;\n      default:\n        break;\n    }\n\n    return olKey || key;\n  }\n\n  private getOlCls(key: any) {\n    let olCls = olstyle[key.charAt(0).toUpperCase() + key.slice(1)];\n    if (key === 'regularshape') {\n      olCls = olstyle.RegularShape;\n    }\n    if (key === 'backgroundFill') {\n      olCls = olstyle.Fill;\n    }\n    if (key === 'backgroundStroke') {\n      olCls = olstyle.Stroke;\n    }\n\n    return olCls;\n  }\n\n  createStyleByAttribute(feature: RenderFeature | OlFeature<OlGeometry>, styleByAttribute: StyleByAttribute, resolution: number) {\n\n    let style;\n    const type = styleByAttribute.type ? styleByAttribute.type : this.guessTypeFeature(feature);\n    const attribute = styleByAttribute.attribute;\n    const data = styleByAttribute.data;\n    const stroke = styleByAttribute.stroke;\n    const width = styleByAttribute.width;\n    const fill = styleByAttribute.fill;\n    const anchor = styleByAttribute.anchor;\n    const radius = styleByAttribute.radius;\n    const icon = styleByAttribute.icon;\n    const scale = styleByAttribute.scale;\n    const size = data ? data.length : 0;\n    const label = styleByAttribute.label ? styleByAttribute.label.attribute : undefined;\n    const labelMinResolutionFromScale =\n      styleByAttribute.label?.minScaleDenom ? getResolutionFromScale(Number(styleByAttribute.label.minScaleDenom)) : undefined;\n    const labelMaxResolutionFromScale =\n      styleByAttribute.label?.maxScaleDenom ? getResolutionFromScale(Number(styleByAttribute.label.maxScaleDenom)) : undefined;\n    const minResolution = styleByAttribute.label?.minResolution ? styleByAttribute.label.minResolution : 0;\n    const maxResolution = styleByAttribute.label?.maxResolution ? styleByAttribute.label.maxResolution : Infinity;\n\n    const labelMinResolution = labelMinResolutionFromScale || minResolution;\n    const labelMaxResolution = labelMaxResolutionFromScale || maxResolution;\n\n    let labelStyle = styleByAttribute.label?.style ? this.parseStyle('text', styleByAttribute.label.style) : undefined;\n    if (!labelStyle && label) {\n        labelStyle = new olstyle.Text();\n    }\n    const baseStyle = styleByAttribute.baseStyle;\n\n    if (labelStyle) {\n      if (resolution >= labelMinResolution && resolution <= labelMaxResolution) {\n        labelStyle.setText(this.getLabel(feature, label));\n      } else {\n        labelStyle.setText('');\n      }\n    }\n\n    if (type === 'circle') {\n      for (let i = 0; i < size; i++) {\n        const val =\n          typeof feature.get(attribute) !== 'undefined' && feature.get(attribute) !== null\n            ? feature.get(attribute)\n            : '';\n        if (val === data[i] || val.toString().match(new RegExp(data[i], 'gmi'))) {\n          if (icon) {\n            style = [\n              new olstyle.Style({\n                image: new olstyle.Icon({\n                  color: fill ? fill[i] : undefined,\n                  src: icon[i],\n                  scale: scale ? scale[i] : 1,\n                  anchor: anchor ? anchor[i] : [0.5, 0.5]\n                }),\n                text: labelStyle instanceof olstyle.Text ? labelStyle : undefined\n              })\n            ];\n            return style;\n          }\n          style = [\n            new olstyle.Style({\n              image: new olstyle.Circle({\n                radius: radius ? radius[i] : 4,\n                stroke: new olstyle.Stroke({\n                  color: stroke ? stroke[i] : 'black',\n                  width: width ? width[i] : 1\n                }),\n                fill: new olstyle.Fill({\n                  color: fill ? fill[i] : 'black'\n                })\n              }),\n              text: labelStyle instanceof olstyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (!(feature as OlFeature<OlGeometry>).getStyle()) {\n        if (baseStyle) {\n          style = this.createStyle(baseStyle, feature, resolution);\n          if (labelStyle) {\n            style.setText(labelStyle);\n          }\n          return style;\n        }\n        style = [\n          new olstyle.Style({\n            image: new olstyle.Circle({\n              radius: 4,\n              stroke: new olstyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olstyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          })\n        ];\n        return style;\n      }\n    } else if (type === 'regular') {\n      for (let i = 0; i < size; i++) {\n        const val =\n        typeof feature.get(attribute) !== 'undefined' && feature.get(attribute) !== null\n            ? feature.get(attribute)\n            : '';\n        if (val === data[i] || val.toString().match(new RegExp(data[i], 'gmi'))) {\n          style = [\n            new olstyle.Style({\n              stroke: new olstyle.Stroke({\n                color: stroke ? stroke[i] : 'black',\n                width: width ? width[i] : 1\n              }),\n              fill: new olstyle.Fill({\n                color: fill ? fill[i] : 'rgba(255,255,255,0.4)'\n              }),\n              text: labelStyle instanceof olstyle.Text ? labelStyle : undefined\n            })\n          ];\n          return style;\n        }\n      }\n      if (feature instanceof OlFeature) {\n        if (!feature.getStyle()) {\n          if (baseStyle) {\n            style = this.createStyle(baseStyle, feature, resolution);\n            if (labelStyle) {\n              style.setText(labelStyle);\n            }\n            return style;\n          }\n          style = [\n            new olstyle.Style({\n              stroke: new olstyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olstyle.Fill({\n                color: '#bbbbf2'\n              })\n            })\n          ];\n          return style;\n        }\n      }\n    }\n  }\n\n  createClusterStyle(feature: RenderFeature | OlFeature<OlGeometry>, resolution: number, clusterParam: ClusterParam = {}, layerStyle) {\n    let style;\n    const size = feature.get('features').length;\n    if (size !== 1) {\n      if (clusterParam.clusterRanges) {\n        for (const r of clusterParam.clusterRanges) {\n          if (\n            (!r.minRadius || r.minRadius <= size) &&\n            (!r.maxRadius || r.maxRadius >= size)\n          ) {\n            style = this.createStyle(r.style) as olstyle.Circle;\n\n            if (r.showRange) {\n              const text = new olstyle.Text({\n                text: size.toString(),\n                fill: new olstyle.Fill({\n                  color: '#fff'\n                })\n              });\n              style.setText(text);\n            }\n\n            if (r.dynamicRadius) {\n              let clusterRadius: number;\n              const radiusMin = style.getRadius();\n              clusterRadius = 5 * Math.log(size);\n              if (clusterRadius < radiusMin) {\n                clusterRadius = radiusMin;\n              }\n              style.image_.setRadius(clusterRadius);\n            }\n            break;\n          }\n        }\n      }\n\n      if (!style) {\n        let clusterRadius: number;\n        if (clusterParam.radiusCalc) {\n          clusterRadius = clusterParam.radiusCalc(size);\n        } else {\n          const radiusMin = 6;\n          clusterRadius = 5 * Math.log(size);\n          if (clusterRadius < radiusMin) {\n            clusterRadius = radiusMin;\n          }\n        }\n\n        style = [\n          new olstyle.Style({\n            image: new olstyle.Circle({\n              radius: clusterRadius,\n              stroke: new olstyle.Stroke({\n                color: 'black'\n              }),\n              fill: new olstyle.Fill({\n                color: 'rgba(24, 134, 45, 0.5)'\n              })\n            }),\n            text: new olstyle.Text({\n              text: size.toString(),\n              fill: new olstyle.Fill({\n                color: '#fff'\n              })\n            })\n          })\n        ];\n      }\n    } else {\n      style = this.createStyle(layerStyle, feature, resolution);\n    }\n    return style;\n  }\n\n  getLabel(feature, labelMatch): string {\n    let label = labelMatch;\n    if (!label) {\n      return;\n    }\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach(v => {\n      label = label.replace(v[0], feature.get(v[1]));\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.get(labelMatch) || labelMatch;\n    }\n\n    return label;\n  }\n\n  private guessTypeFeature(feature) {\n    switch (feature.getGeometry().getType()) {\n      case 'Point':\n      case 'MultiPoint':\n      case 'Circle':\n        return 'circle';\n      default:\n        return 'regular';\n    }\n  }\n}\n","import * as olstyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\n\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { createOverlayMarkerStyle } from './overlay-marker-style.utils';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n/**\n * Create an overlay layer and it's source\n * @returns Overlay layer\n */\nexport function createOverlayLayer(): VectorLayer {\n  const overlayDataSource = new FeatureDataSource();\n  return new VectorLayer({\n    title: 'Overlay',\n    zIndex: 300,\n    source: overlayDataSource,\n    style: createOverlayLayerStyle()\n  });\n}\n\n/**\n * Create an overlay style with markers for points and a basic stroke/fill\n * combination for lines and polygons\n * @returns Style function\n */\nfunction createOverlayLayerStyle(): (olFeature: OlFeature<OlGeometry>, resolution: number) => olstyle.Style {\n  const defaultStyle = createOverlayDefaultStyle();\n  const markerStyle = createOverlayMarkerStyle();\n\n  let style;\n\n  return (olFeature: OlFeature<OlGeometry>, resolution) => {\n    if (olFeature.getId() === 'bufferFeature') {\n      style = createBufferStyle(\n        olFeature.get('bufferStroke'),\n        2,\n        olFeature.get('bufferFill'),\n        olFeature.get('bufferText')\n      );\n      return style;\n    } else {\n      const customStyle = olFeature.get('_style');\n      if (customStyle) {\n        const styleService = new StyleService();\n        return styleService.createStyle(customStyle, olFeature, resolution);\n      }\n      const geometryType = olFeature.getGeometry().getType();\n      style = geometryType === 'Point' ? markerStyle : defaultStyle;\n      style.getText().setText(olFeature.get('_mapTitle'));\n      return style;\n    }\n  };\n}\n\n/**\n * Create a basic style for lines and polygons\n * @returns Style\n */\nexport function createOverlayDefaultStyle({\n  text,\n  strokeWidth = 2,\n  fillColor = [0, 161, 222, 0.3],\n  strokeColor = [0, 161, 222, 0.9],\n}: {\n  text?: string;\n  strokeWidth?: number;\n  fillColor?: string | number[];\n  strokeColor?: string | number[];\n} = {}): olstyle.Style {\n  const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n  const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeWithOpacity\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillWithOpacity\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      text,\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n\nfunction createBufferStyle(\n  strokeRGBA: [number, number, number, number] = [0, 161, 222, 1],\n  strokeWidth: number = 2,\n  fillRGBA: [number, number, number, number] = [0, 161, 222, 0.15],\n  bufferRadius?\n): olstyle.Style {\n  const stroke = new olstyle.Stroke({\n    width: strokeWidth,\n    color: strokeRGBA\n  });\n\n  const fill = new olstyle.Fill({\n    color: fillRGBA\n  });\n\n  return new olstyle.Style({\n    stroke,\n    fill,\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke,\n      fill\n    }),\n    text: new olstyle.Text({\n      font: '12px Calibri,sans-serif',\n      text: bufferRadius,\n      fill: new olstyle.Fill({ color: '#000' }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true\n    })\n  });\n}\n","import OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  Feature,\n  FeatureMotion,\n  featureToOl,\n  moveToOlFeatures\n} from '../../feature/shared';\nimport { FeatureDataSource } from '../../datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\n\nimport { createOverlayLayer } from './overlay.utils';\n\n/**\n * This class is simply a shortcut for adding features to a map.\n * It does nothing more than a standard layer but it's shipped with\n * a defautl style based on the geometry type of the features it contains.\n * @todo Enhance that by using a FeatureStore and strategies.\n */\nexport class Overlay {\n  /**\n   * The map to add the layer to\n   */\n  private map: IgoMap;\n\n  /**\n   * Overlay layer\n   */\n  private layer: VectorLayer;\n\n  /**\n   * Overlay layer's data source\n   */\n  get dataSource(): FeatureDataSource {\n    return this.layer.dataSource as FeatureDataSource;\n  }\n\n  constructor(map?: IgoMap) {\n    this.layer = createOverlayLayer();\n    this.setMap(map);\n  }\n\n  /**\n   * Bind this to a map and add the overlay layer to that map\n   * @param map Map\n   */\n  setMap(map: IgoMap) {\n    if (map === undefined) {\n      if (this.map !== undefined) {\n        this.map.ol.removeLayer(this.layer.ol);\n      }\n    } else {\n      map.ol.addLayer(this.layer.ol);\n    }\n    this.map = map;\n  }\n\n  /**\n   * Set the overlay features and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   * @param sourceId Optional: Remove features of certain sourceId (ex: 'Map' for query features)\n   */\n  setFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default,\n    sourceId?: string\n  ) {\n    if (sourceId) {\n      for (const olFeature of this.dataSource.ol.getFeatures()) {\n        if (olFeature.get('_sourceId') === sourceId) {\n          this.removeOlFeature(olFeature);\n        }\n      }\n    } else {\n      this.clear();\n    }\n    this.addFeatures(features, motion);\n  }\n\n  /**\n   * Add a feature to the  overlay and, optionally, move to it\n   * @param feature Feature\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addFeature(feature: Feature, motion: FeatureMotion = FeatureMotion.Default) {\n    this.addFeatures([feature], motion);\n  }\n\n  /**\n   * Add features to the  overlay and, optionally, move to them\n   * @param features Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addFeatures(\n    features: Feature[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    const olFeatures = [];\n    features.forEach((feature: Feature) => {\n      const olFeature = featureToOl(feature, this.map.projection);\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry === null) {\n        return;\n      }\n      olFeatures.push(olFeature);\n    });\n\n    this.addOlFeatures(olFeatures, motion);\n  }\n\n  /**\n   * Add a OpenLayers feature to the  overlay and, optionally, move to it\n   * @param olFeature OpenLayers Feature\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeature(\n    olFeature: OlFeature<OlGeometry>,\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.addOlFeatures([olFeature], motion);\n  }\n\n  /**\n   * Add OpenLayers features to the overlay and, optionally, move to them\n   * @param olFeatures OpenLayers Features\n   * @param motion Optional: Apply this motion to the map view\n   */\n  addOlFeatures(\n    olFeatures: OlFeature<OlGeometry>[],\n    motion: FeatureMotion = FeatureMotion.Default\n  ) {\n    this.dataSource.ol.addFeatures(olFeatures);\n    moveToOlFeatures(this.map, olFeatures, motion);\n  }\n\n  /**\n   * Remove a feature from the overlay\n   * @param feature Feature\n   */\n  removeFeature(feature: Feature) {\n    this.removeFeatures([feature]);\n  }\n\n  /**\n   * Remove features from the overlay\n   * @param features Features\n   */\n  removeFeatures(features: Feature[]) {\n    features.forEach((feature: Feature) => {\n      if (feature.meta) {\n        if (this.dataSource.ol.getFeatureById(feature.meta.id)) {\n          this.removeOlFeature(this.dataSource.ol.getFeatureById(feature.meta.id));\n        }\n      }\n    });\n  }\n\n  /**\n   * Remove an OpenLayers feature from the overlay\n   * @param olFeature OpenLayers Feature\n   */\n  removeOlFeature(olFeature: OlFeature<OlGeometry>) {\n    this.dataSource.ol.removeFeature(olFeature);\n  }\n\n  /**\n   * Clear the overlay\n   */\n  clear() {\n    this.dataSource.ol.clear();\n  }\n}\n","import olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\nimport { Message } from '@igo2/core';\n\nimport { DataSource } from '../../../datasource/shared/datasources/datasource';\nimport { AnyDataSourceOptions } from '../../../datasource/shared/datasources/any-datasource.interface';\nimport { MapExtent, MapViewOptions } from '../../../map/shared/map.interface';\n\nexport interface LayerOptions {\n  isIgoInternalLayer?: boolean; // useful when mapOffline directive set the resolution of the layers.\n  source?: DataSource;\n  sourceOptions?: AnyDataSourceOptions;\n  title?: string;\n  id?: string;\n  alias?: string;\n  security?: LayerSecurityOptions;\n  baseLayer?: boolean;\n  opacity?: number;\n  visible?: boolean;\n  extent?: MapExtent;\n  zIndex?: number;\n  messages?: Message[];\n  minResolution?: number;\n  maxResolution?: number;\n  minScaleDenom?: number;\n  maxScaleDenom?: number;\n  showInLayerList?: boolean;\n  removable?: boolean;\n  workspace?: GeoWorkspaceOptions;\n  legendOptions?: LegendOptions;\n  ol?: olLayer<olSource>;\n  tooltip?: TooltipContent;\n  _internal?: { [key: string]: string };\n  active?: boolean;\n  check?: boolean;\n  linkedLayers?: LayersLink;\n  showButtonZoomToExtent?: boolean;\n}\n\nexport interface LayerSecurityOptions {\n  profils?: string[]\n}\n\nexport interface GeoWorkspaceOptions {\n  srcId?: string;\n  workspaceId?: string;\n  minResolution?: number;\n  maxResolution?: number;\n  enabled?: boolean;\n  queryOptions?: GeoWorkspaceQueryOptions;\n  pageSize?: number;\n  pageSizeOptions?: number[];\n}\n\nexport interface GeoWorkspaceQueryOptions {\n  mapQueryOnOpenTab?: boolean;\n  tabQuery?: boolean;\n}\n\nexport interface LayersLink {\n  linkId: string;\n  links?: LayersLinkProperties[];\n}\nexport interface LayersLinkProperties {\n  linkedIds: string[];\n  syncedDelete: boolean;\n  properties: LinkedProperties[];\n}\n\nexport enum LinkedProperties {\n  OPACITY = 'opacity',\n  VISIBLE = 'visible',\n  OGCFILTERS = 'ogcFilters',\n  MINRESOLUTION = 'minResolution',\n  MAXRESOLUTION = 'maxResolution',\n  ZINDEX = 'zIndex',\n  TIMEFILTER = 'timeFilter'\n}\n\nexport interface GroupLayers {\n  title: string;\n  layers?: LayerOptions;\n  collapsed?: boolean;\n}\n\nexport interface TooltipContent {\n  type?: TooltipType;\n  text?: string;\n}\nexport enum TooltipType {\n  TITLE = 'title',\n  ABSTRACT = 'abstract',\n  CUSTOM = 'custom'\n}\n\nexport interface LegendOptions {\n  collapsed?: boolean;\n  display?: boolean;\n  url?: string;\n  html?: string;\n  stylesAvailable?: ItemStyleOptions[];\n}\n\nexport interface LegendMapViewOptions extends MapViewOptions{\n  scale?: number;\n  size?: [number, number];\n}\n\nexport interface ItemStyleOptions {\n  name: string;\n  title?: string;\n}\n\nexport interface OutputLayerLegend {\n  title: string;\n  url: string;\n  display: boolean;\n}\n","import olLayerImage from 'ol/layer/Image';\nimport olSourceImage from 'ol/source/Image';\n\nimport { AuthInterceptor } from '@igo2/auth';\n\nimport { ImageWatcher } from '../../utils';\nimport { IgoMap } from '../../../map';\n\nimport { WMSDataSource } from '../../../datasource/shared/datasources/wms-datasource';\n\nimport { Layer } from './layer';\nimport { ImageLayerOptions } from './image-layer.interface';\nimport { ImageArcGISRestDataSource } from '../../../datasource/shared/datasources/imagearcgisrest-datasource';\nimport { LanguageService, MessageService } from '@igo2/core';\n\nexport class ImageLayer extends Layer {\n  public dataSource: WMSDataSource | ImageArcGISRestDataSource;\n  public options: ImageLayerOptions;\n  public ol: olLayerImage<olSourceImage>;\n\n  private watcher: ImageWatcher;\n\n  constructor(\n    options: ImageLayerOptions,\n    public messageService: MessageService,\n    private languageService: LanguageService,\n    public authInterceptor?: AuthInterceptor\n  ) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new ImageWatcher(this, this.messageService, this.languageService);\n    this.status$ = this.watcher.status$;\n    this.status$.subscribe(valStatus => {\n      if (valStatus === 0) {\n        this.olLoadingProblem = true;\n      }\n    });\n  }\n\n  protected createOlLayer(): olLayerImage<olSourceImage> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceImage\n    });\n\n    const image = new olLayerImage(olOptions);\n    if (this.authInterceptor) {\n      (image.getSource() as any).setImageLoadFunction((tile, src) => {\n        this.customLoader(tile, src, this.authInterceptor, this.messageService, this.languageService);\n      });\n    }\n\n    return image;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n\n  private customLoader(tile, src: string, interceptor: AuthInterceptor, messageService: MessageService, languageService: LanguageService) {\n    const xhr = new XMLHttpRequest();\n\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(src);\n    let url = src;\n    if (alteredUrlWithKeyAuth) {\n      url = alteredUrlWithKeyAuth;\n    }\n    xhr.open('GET', url);\n    const intercepted = interceptor.interceptXhr(xhr, url);\n    if (!intercepted) {\n      xhr.abort();\n      tile.getImage().src = url;\n      return;\n    }\n\n    xhr.responseType = 'arraybuffer';\n\n    xhr.onload = function() {\n      const arrayBufferView = new Uint8Array((this as any).response);\n      const responseString = new TextDecoder().decode(arrayBufferView);\n      if (responseString.includes('ServiceExceptionReport')) {\n        messageService.error(languageService.translate.instant(\n          'igo.geo.dataSource.optionsApiUnavailable'\n        ),\n        languageService.translate.instant(\n          'igo.geo.dataSource.unavailableTitle'\n        ));\n      }\n      const blob = new Blob([arrayBufferView], { type: 'image/png' });\n      const urlCreator = window.URL;\n      const imageUrl = urlCreator.createObjectURL(blob);\n      tile.getImage().src = imageUrl;\n    };\n    xhr.send();\n  }\n}\n","import olLayerTile from 'ol/layer/Tile';\nimport olSourceTile from 'ol/source/Tile';\nimport Tile from 'ol/Tile';\n\nimport { TileWatcher } from '../../utils';\nimport { IgoMap } from '../../../map';\n\nimport { OSMDataSource } from '../../../datasource/shared/datasources/osm-datasource';\nimport { WMTSDataSource } from '../../../datasource/shared/datasources/wmts-datasource';\nimport { XYZDataSource } from '../../../datasource/shared/datasources/xyz-datasource';\nimport { CartoDataSource } from '../../../datasource/shared/datasources/carto-datasource';\nimport { TileArcGISRestDataSource } from '../../../datasource/shared/datasources/tilearcgisrest-datasource';\nimport { TileDebugDataSource } from '../../../datasource/shared/datasources/tiledebug-datasource';\n\nimport { Layer } from './layer';\nimport { TileLayerOptions } from './tile-layer.interface';\n\nimport { MessageService } from '@igo2/core';\nimport { AuthInterceptor } from '@igo2/auth';\nexport class TileLayer extends Layer {\n  public dataSource:\n    | OSMDataSource\n    | WMTSDataSource\n    | XYZDataSource\n    | TileDebugDataSource\n    | CartoDataSource\n    | TileArcGISRestDataSource;\n  public options: TileLayerOptions;\n  public ol: olLayerTile<olSourceTile>;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: TileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor) {\n    super(options, messageService);\n\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerTile<olSourceTile> {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol\n    });\n    const tileLayer = new olLayerTile(olOptions);\n    const tileSource = tileLayer.getSource();\n    tileSource.setTileLoadFunction((tile: Tile, url: string) => {\n      this.customLoader(tile, url, this.authInterceptor);\n    });\n\n    return tileLayer;\n  }\n\n  /**\n   * Custom loader for tile layer.\n   * @internal\n   * @param tile the current tile\n   * @param url the url string or function to retrieve the data\n   */\n  customLoader(tile, url: string, interceptor: AuthInterceptor ) {\n\n    const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n    let modifiedUrl = url;\n    if (alteredUrlWithKeyAuth) {\n      modifiedUrl = alteredUrlWithKeyAuth;\n    }\n    tile.getImage().src = modifiedUrl;\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","import olLayerVectorTile from 'ol/layer/VectorTile';\nimport olSourceVectorTile from 'ol/source/VectorTile';\n\nimport { MVTDataSource } from '../../../datasource/shared/datasources/mvt-datasource';\n\nimport { Layer } from './layer';\nimport { VectorTileLayerOptions } from './vectortile-layer.interface';\nimport { TileWatcher } from '../../utils';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { IgoMap } from '../../../map';\nimport { MessageService } from '@igo2/core';\nimport VectorTile from 'ol/VectorTile';\n\nexport class VectorTileLayer extends Layer {\n  public dataSource: MVTDataSource;\n  public options: VectorTileLayerOptions;\n  public ol: olLayerVectorTile;\n\n  private watcher: TileWatcher;\n\n  constructor(\n    options: VectorTileLayerOptions,\n    public messageService?: MessageService,\n    public authInterceptor?: AuthInterceptor) {\n    super(options, messageService, authInterceptor);\n    this.watcher = new TileWatcher(this);\n    this.status$ = this.watcher.status$;\n  }\n\n  protected createOlLayer(): olLayerVectorTile {\n    const olOptions = Object.assign({}, this.options, {\n      source: this.options.source.ol as olSourceVectorTile\n    });\n\n    const vectorTile = new olLayerVectorTile(olOptions);\n    const vectorTileSource = vectorTile.getSource() as olSourceVectorTile;\n\n    vectorTileSource.setTileLoadFunction((tile: VectorTile, url: string) => {\n      const loader = this.customLoader(url, tile.getFormat(), this.authInterceptor, tile.onLoad.bind(tile));\n      if (loader) {\n        tile.setLoader(loader);\n      }\n    }\n    );\n\n    return vectorTile;\n  }\n\n  /**\n   * Custom loader for vector tile layer. Modified from the loadFeaturesXhr function in ol\\featureloader.js\n   * @internal\n   * @param url the url string or function to retrieve the data\n   * @param format the format of the tile\n   * @param interceptor the interceptor of the data\n   * @param success On success event action to trigger\n   * @param failure On failure event action to trigger TODO\n   */\n  customLoader(url, format, interceptor, success, failure?) {\n    return ((extent, resolution, projection) => {\n      const xhr = new XMLHttpRequest();\n      let modifiedUrl = url;\n      if (typeof url !== 'function') {\n        const alteredUrlWithKeyAuth = interceptor.alterUrlWithKeyAuth(url);\n        if (alteredUrlWithKeyAuth) {\n          modifiedUrl = alteredUrlWithKeyAuth;\n        }\n      } else {\n        modifiedUrl = url(extent, resolution, projection);\n      }\n      xhr.open( 'GET', modifiedUrl);\n      if (interceptor) {\n        interceptor.interceptXhr(xhr, modifiedUrl);\n      }\n\n      if (format.getType() === 'arraybuffer') {\n        xhr.responseType = 'arraybuffer';\n      }\n      xhr.onload = (event) => {\n        if (!xhr.status || xhr.status >= 200 && xhr.status < 300) {\n          const type = format.getType();\n          let source;\n          if (type === 'json' || type === 'text') {\n            source = xhr.responseText;\n          }\n          else if (type === 'xml') {\n            source = xhr.responseXML;\n            if (!source) {\n              source = new DOMParser().parseFromString(xhr.responseText, 'application/xml');\n            }\n          }\n          else if (type === 'arraybuffer') {\n            source = xhr.response;\n          }\n          if (source) {\n            success.call(this, format.readFeatures(source, {\n              extent,\n              featureProjection: projection\n            }), format.readProjection(source));\n          }\n          else {\n            // TODO\n            failure.call(this);\n          }\n        } else {\n          // TODO\n          failure.call(this);\n        }\n      };\n      xhr.onerror = () => {\n        // TODO\n        failure.call(this);\n      };\n      xhr.send();\n    });\n  }\n\n  public setMap(map: IgoMap | undefined) {\n    if (map === undefined) {\n      this.watcher.unsubscribe();\n    } else {\n      this.watcher.subscribe(() => {});\n    }\n    super.setMap(map);\n  }\n}\n","import { BehaviorSubject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { Watcher, SubjectStatus } from '@igo2/utils';\nimport { Layer, LinkedProperties } from '../../layer/shared/layers';\nimport { ObjectEvent } from 'ol/Object';\n\nexport class LayerWatcher extends Watcher {\n  public propertyChange$: BehaviorSubject<{event:ObjectEvent, layer: Layer}> = new BehaviorSubject(undefined);\n  private loaded = 0;\n  private loading = 0;\n  private layers: Layer[] = [];\n  private subscriptions: Subscription[] = [];\n\n  constructor() {\n    super();\n  }\n\n  watch() {}\n\n  unwatch() {\n    this.layers.forEach(layer => this.unwatchLayer(layer), this);\n  }\n\n  setPropertyChange(change: ObjectEvent, layer: Layer) {\n\n    if (![\n      LinkedProperties.TIMEFILTER,\n      LinkedProperties.OGCFILTERS,\n      LinkedProperties.VISIBLE,\n      LinkedProperties.OPACITY,\n      LinkedProperties.MINRESOLUTION,\n      LinkedProperties.MAXRESOLUTION]\n      .includes(change.key as any)) {\n      return;\n  }\n  this.propertyChange$.next({event: change, layer});\n  }\n\n  watchLayer(layer: Layer) {\n    if (layer.status$ === undefined) {\n      return;\n    }\n    layer.ol.on('propertychange', evt => this.setPropertyChange(evt, layer));\n    layer.dataSource.ol.on('propertychange', evt => this.setPropertyChange(evt, layer));\n\n\n    this.layers.push(layer);\n\n    const layer$$ = layer.status$\n      .pipe(distinctUntilChanged())\n      .subscribe(status => {\n        if (status === SubjectStatus.Error) {\n          this.loading = 0;\n          this.loaded = -1;\n        }\n        if (status === SubjectStatus.Working) {\n          this.loading += 1;\n        } else if (status === SubjectStatus.Done) {\n          this.loaded += 1;\n        }\n\n        if (this.loaded >= this.loading) {\n          this.loading = this.loaded = 0;\n          this.status = SubjectStatus.Done;\n        } else if (this.loading > 0) {\n          this.status = SubjectStatus.Working;\n        }\n      });\n\n    this.subscriptions.push(layer$$);\n  }\n\n  unwatchLayer(layer: Layer) {\n    layer.ol.un('propertychange', evt => this.setPropertyChange(evt,layer));\n    layer.dataSource.ol.un('propertychange', evt => this.setPropertyChange(evt, layer));\n    layer.status$.next(SubjectStatus.Done);\n    const index = this.layers.indexOf(layer);\n    if (index >= 0) {\n      const status = (layer as any).watcher.status;\n      if (\n        [SubjectStatus.Working, SubjectStatus.Waiting].indexOf(status) !== -1\n      ) {\n        this.loaded += 1;\n      }\n      this.subscriptions[index].unsubscribe();\n      this.subscriptions.splice(index, 1);\n      this.layers.splice(index, 1);\n      (layer as any).watcher.unwatch();\n    }\n  }\n}\n","export enum MapViewAction {\n  Move,\n  Zoom\n}\n","import { EventsKey } from 'ol/events';\nimport OlMap from 'ol/Map';\nimport { unByKey } from 'ol/Observable';\n\n/**\n * Base map controller\n */\nexport class MapController {\n\n  /**\n   * OL Map\n   */\n  protected olMap: OlMap;\n\n  /**\n   * Array of observer keys\n   */\n  protected observerKeys: EventsKey[] = [];\n\n  /**\n   * Return the OL map this controller is bound to\n   * @returns OL Map\n   */\n  getOlMap(): OlMap {\n    return this.olMap;\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap !== undefined && this.getOlMap() !== undefined) {\n      throw new Error('This controller is already bound to a map.');\n    }\n\n    if (olMap === undefined) {\n      this.teardownObservers();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    this.observerKeys.forEach((key: EventsKey) => unByKey(key));\n    this.observerKeys = [];\n  }\n\n}\n","import OlMap from 'ol/Map';\nimport OlMapEvent from 'ol/MapEvent';\n\nimport { BehaviorSubject, Subject, Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport * as oleasing from 'ol/easing';\nimport * as olproj from 'ol/proj';\nimport OlProjection from 'ol/proj/Projection';\nimport OlView from 'ol/View';\n\nimport { MapViewAction } from '../map.enums';\nimport { MapExtent, MapViewState } from '../map.interface';\nimport { getScaleFromResolution, viewStatesAreEqual } from '../map.utils';\nimport { MapController } from './controller';\nimport { EventsKey } from 'ol/events';\nimport { ObjectEvent } from 'ol/Object';\n\nexport interface MapViewControllerOptions {\n  stateHistory: boolean;\n}\n\n/**\n * Controller to handle map view interactions\n */\nexport class MapViewController extends MapController {\n  /**\n   * Observable of the current rotation in radians\n   */\n   readonly rotation$ = new BehaviorSubject<number>(0);\n\n  /**\n   * Observable of the current resolution\n   */\n  resolution$ = new BehaviorSubject<number>(undefined);\n\n  /**\n   * Observable of the current state\n   */\n  state$ = new BehaviorSubject<MapViewState>(undefined);\n\n  /**\n   * View Padding\n   * Values in the array are top, right, bottom and left padding.\n   */\n  padding = [0, 0, 0, 0];\n\n  /**\n   * Max zoom after set extent\n   */\n  maxZoomOnExtent = 19;\n\n  /**\n   * Max extent possible when zooming\n   */\n  maxLayerZoomExtent: MapExtent;\n\n  /**\n   * Extent stream\n   */\n  private extent$ = new Subject<{ extent: MapExtent; action: MapViewAction }>();\n\n  /**\n   * Subscription to the movement stream\n   */\n  private extent$$: Subscription;\n\n  /**\n   * History of states\n   */\n  private states: MapViewState[] = [];\n\n  /**\n   * Current state index\n   */\n  private stateIndex: number = 0;\n\n  /**\n   * Whether the view controller should keep the view's state history\n   */\n  get stateHistory(): boolean {\n    return this.options ? this.options.stateHistory === true : false;\n  }\n\n  /**\n   * OL View\n   */\n  get olView(): OlView {\n    return this.olMap.getView();\n  }\n\n  constructor(private options?: MapViewControllerOptions) {\n    super();\n  }\n\n  setPadding(padding: { top?: number, bottom?: number, left?: number, right?: number }) {\n    // Values in the array are top, right, bottom and left padding.\n    if (padding.top || padding.top === 0) {\n      this.padding[0] = padding.top;\n    }\n    if (padding.right || padding.right === 0) {\n      this.padding[1] = padding.right;\n    }\n    if (padding.bottom || padding.bottom === 0) {\n      this.padding[2] = padding.bottom;\n    }\n    if (padding.left || padding.left === 0) {\n      this.padding[3] = padding.left;\n    }\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    super.setOlMap(olMap);\n    this.setupObservers();\n  }\n\n  /**\n   * Observe move moveend and subscribe to the extent stream\n   */\n  setupObservers() {\n    if (this.stateHistory === true) {\n      this.observerKeys.push(\n        this.olMap.on('moveend', (event: OlMapEvent) => this.onMoveEnd(event)) as EventsKey\n      );\n    }\n\n    this.extent$$ = this.extent$\n      .pipe(debounceTime(25))\n      .subscribe((value: { extent: MapExtent; action: MapViewAction }) => {\n        this.setExtent(value.extent, value.action);\n      });\n  }\n\n  monitorRotation() {\n    this.observerKeys.push(\n      this.olMap.getView().on('change:rotation', (evt: ObjectEvent) => {\n        this.rotation$.next(evt.target.getRotation());\n      }) as EventsKey\n      );\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    super.teardownObservers();\n    if (this.extent$$ !== undefined) {\n      this.extent$$.unsubscribe();\n      this.extent$$ = undefined;\n    }\n  }\n\n  /**\n   * Get the view's OL projection\n   * @returns OL projection\n   */\n  getOlProjection(): OlProjection {\n    return this.olView.getProjection();\n  }\n\n  /**\n   * Get the current map view center\n   * @param projection Output projection\n   * @returns Center\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    let center = this.olView.getCenter() as [number, number];\n    if (projection && center) {\n      center = olproj.transform(center, this.getOlProjection(), projection) as [number, number];\n    }\n    return center;\n  }\n\n  /**\n   * Get the current view extent\n   * @param projection Output projection\n   * @returns Extent\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    let extent = this.olView.calculateExtent(this.olMap.getSize());\n    if (projection && extent) {\n      extent = olproj.transformExtent(\n        extent,\n        this.getOlProjection(),\n        projection\n      );\n    }\n    return extent as [number, number, number, number];\n  }\n\n  /**\n   * Get the current scale\n   * @param dpi Dot per inches\n   * @returns View scale\n   */\n  getScale(dpi = 96) {\n    return getScaleFromResolution(\n      this.getResolution(),\n      this.getOlProjection().getUnits(),\n      dpi\n    );\n  }\n\n  /**\n   * Get the current resolution\n   * @returns Projection denominator\n   */\n  getResolution(): number {\n    return this.olView.getResolution();\n  }\n\n  /**\n   * Get the current zoom level\n   * @returns Zoom level\n   */\n  getZoom(): number {\n    return Math.round(this.olView.getZoom());\n  }\n\n  /**\n   * Zoom in\n   */\n  zoomIn() {\n    this.zoomTo(this.olView.getZoom() + 1);\n  }\n\n  /**\n   * Zoom out\n   */\n  zoomOut() {\n    this.zoomTo(this.olView.getZoom() - 1);\n  }\n\n  /**\n   * Zoom to specific zoom level\n   * @param zoom Zoom level\n   */\n  zoomTo(zoom: number) {\n    this.olView.cancelAnimations();\n    this.olView.animate({\n      zoom,\n      duration: 250,\n      easing: oleasing.easeOut\n    });\n  }\n\n  /**\n   * Move to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to move to\n   */\n  moveToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Move });\n  }\n\n  /**\n   * Zoom to extent after a short delay (100ms) unless\n   * a new movement gets registered in the meantime.\n   * @param extent Extent to zoom to\n   */\n  zoomToExtent(extent: [number, number, number, number]) {\n    this.extent$.next({ extent, action: MapViewAction.Zoom });\n  }\n\n  /**\n   * Return the current view rotation\n   * @returns Rotation angle in radians\n   */\n  getRotation(): number {\n    return this.olView.getRotation();\n  }\n\n  /**\n   * Reset the view rotation to 0\n   */\n  resetRotation() {\n    this.olView.animate({ rotation: 0 });\n  }\n\n  /**\n   * Whether the view has a previous state\n   * @returns True if the view has a previous state\n   */\n  hasPreviousState(): boolean {\n    return this.states.length > 1 && this.stateIndex > 0;\n  }\n\n  /**\n   * Whether the view has a next state\n   * @returns True if the view has a next state\n   */\n  hasNextState(): boolean {\n    return this.states.length > 1 && this.stateIndex < this.states.length - 1;\n  }\n\n  /**\n   * Restore the previous view state\n   */\n  previousState() {\n    if (this.hasPreviousState()) {\n      this.setStateIndex(this.stateIndex - 1);\n    }\n  }\n\n  /**\n   * Restore the next view state\n   */\n  nextState() {\n    if (this.hasNextState()) {\n      this.setStateIndex(this.stateIndex + 1);\n    }\n  }\n\n  /**\n   * Clear the state history\n   */\n  clearStateHistory() {\n    this.states = [];\n    this.stateIndex = 0;\n  }\n\n  /**\n   * Update the the view to it's intial state\n   */\n  setInitialState() {\n    if (this.states.length > 0) {\n      this.setStateIndex(0);\n    }\n  }\n\n  /**\n   * Move to the extent retrieved from the stream\n   * @param extent Extent\n   * @param action Either zoom or move\n   * @param animation With or without animation to the target extent.\n   */\n  private setExtent(\n    extent: MapExtent,\n    action: MapViewAction,\n    animation: boolean = true\n  ) {\n    const olView = this.olView;\n    olView.cancelAnimations();\n    const duration = animation ? 500 : 0;\n    const zoom = olView.getZoom();\n\n    const fromCenter = olView.getCenter();\n    const toCenter = [\n      extent[0] + (extent[2] - extent[0]) / 2,\n      extent[1] + (extent[3] - extent[1]) / 2\n    ];\n    const distCenter = Math.sqrt(\n      Math.pow(fromCenter[0] - toCenter[0], 2) +\n        Math.pow(fromCenter[1] - toCenter[1], 2)\n    );\n    const fromExtent = olView.calculateExtent();\n    const fromSize = Math.sqrt(\n      Math.pow(fromExtent[2] - fromExtent[0], 2) +\n        Math.pow(fromExtent[3] - fromExtent[1], 2)\n    );\n    const toSize = Math.sqrt(\n      Math.pow(extent[2] - extent[0], 2) + Math.pow(extent[3] - extent[1], 2)\n    );\n    const moySize = (toSize + fromSize) / 2;\n    const xSize = distCenter / moySize;\n\n    const maxZoom =\n      action === MapViewAction.Move || zoom > this.maxZoomOnExtent\n        ? zoom\n        : this.maxZoomOnExtent;\n\n    olView.fit(extent, {\n      size: this.olMap.getSize(),\n      maxZoom,\n      padding: this.padding,\n      duration: xSize > 4 ? 0 : duration,\n      callback: (isFinished: boolean) => {\n        if (!isFinished) {\n          olView.fit(extent, {\n            size: this.olMap.getSize(),\n            maxZoom,\n            padding: this.padding,\n            duration: xSize > 4 ? 0 : duration\n          });\n        }\n      }\n    });\n  }\n\n  /**\n   * Set the view state index\n   * @param index State index\n   */\n  private setStateIndex(index: number) {\n    this.stateIndex = index;\n    this.setState(this.states[index]);\n  }\n\n  /**\n   * Set the view state\n   * @param state View state\n   */\n  private setState(state: MapViewState) {\n    this.olView.animate({\n      resolution: state.resolution,\n      center: state.center,\n      duration: 0\n    });\n  }\n\n  /**\n   * On move end, get the view state and record it.\n   * @param event Map event\n   */\n  private onMoveEnd(event: OlMapEvent) {\n    const resolution = this.getResolution();\n    if (this.resolution$.value !== resolution) {\n      this.resolution$.next(resolution);\n    }\n\n    const state = {\n      resolution,\n      center: this.getCenter(),\n      zoom: this.getZoom()\n    };\n\n    if (this.stateHistory === true) {\n      const stateIndex = this.stateIndex;\n      const stateAtIndex =\n        this.states.length === 0 ? undefined : this.states[stateIndex];\n      if (!viewStatesAreEqual(state, stateAtIndex)) {\n        this.states = this.states.slice(0, stateIndex + 1).concat([state]);\n        this.stateIndex = this.states.length - 1;\n      }\n    }\n\n    this.state$.next(state);\n  }\n}\n","import OlMap from 'ol/Map';\nimport olGeolocation from 'ol/Geolocation';\nimport { BehaviorSubject, interval, Subscription } from 'rxjs';\n\nimport * as olproj from 'ol/proj';\nimport olFeature from 'ol/Feature';\nimport { MapController } from './controller';\nimport { Point, Polygon } from 'ol/geom';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport { IgoMap } from '../map';\nimport * as olstyle from 'ol/style';\nimport { Overlay } from '../../../overlay/shared/overlay';\nimport { FeatureMotion } from '../../../feature/shared/feature.enums';\nimport { StorageService, ConfigService } from '@igo2/core';\nimport { MapViewOptions } from '../map.interface';\nimport { switchMap } from 'rxjs/operators';\nexport interface MapGeolocationControllerOptions {\n  //  todo keepPositionHistory?: boolean;\n  projection: olproj.ProjectionLike\n  accuracyThreshold?: number;\n  followPosition?: boolean;\n  buffer?: GeolocationBuffer;\n}\nexport interface MapGeolocationState {\n  position: number[];\n  projection: string;\n  accuracy: number;\n  altitude: number;\n  altitudeAccuracy: number;\n  heading: number;\n  speed: number;\n  enableHighAccuracy: boolean;\n  timestamp: Date;\n}\nexport interface GeolocationBuffer {\n  bufferRadius?: number;\n  bufferStroke?: [number, number, number, number];\n  bufferFill?: [number, number, number, number];\n  showBufferRadius?: boolean;\n}\n\n\nenum GeolocationOverlayType {\n  Position = 'position',\n  Accuracy = 'accuracy',\n  Buffer= 'buffer'\n}\n\n/**\n * Controller to handle map view interactions\n */\nexport class MapGeolocationController extends MapController {\n\n  private subscriptions$$: Subscription[] = [];\n  private geolocationOverlay: Overlay;\n  private positionFeatureStyle: olstyle.Style | olstyle.Style[] = new olstyle.Style({\n    image: new olstyle.Circle({\n      radius: 6,\n      fill: new olstyle.Fill({\n        color: '#3399CC',\n      }),\n      stroke: new olstyle.Stroke({\n        color: '#fff',\n        width: 2,\n      }),\n    }),\n  });\n  private accuracyFeatureStyle: olstyle.Style | olstyle.Style[] = new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: 'rgba(120, 120, 120, 0.4)',\n      width: 1,\n    }),\n    fill: new olstyle.Fill({\n      color: 'rgba(120, 120, 120, 0.4)',\n    }),\n  });\n\n  private geolocation: olGeolocation;\n\n  /**\n   * Observable of the current emission interval of the position. In seconds\n   */\n   public readonly emissionIntervalSeconds$: BehaviorSubject<number> = new BehaviorSubject(5);\n\n  /**\n   * Observable of the current position\n   */\n  public readonly position$ = new BehaviorSubject<MapGeolocationState>(undefined);\n  /**\n   * Observable of the tracking state\n   */\n  public readonly tracking$ = new BehaviorSubject<boolean>(undefined);\n  /**\n   * Observable of the follow position state\n   */\n  public readonly followPosition$ = new BehaviorSubject<boolean>(undefined);\n\n\n  /**\n   * History of positions\n   */\n  // private positions: MapGeolocationState[] = [];\n\n  /**\n   * Whether the geolocate controller should keep the position history\n   */\n  /*\n  // todo: refine this method\n  set keepPositionHistory(value) {\n    this._keepPositionHistory = value;\n  }\n  get keepPositionHistory(): boolean {\n    return this._keepPositionHistory;\n  }\n  private _keepPositionHistory: boolean = this.options && this.options.keepPositionHistory ? this.options.keepPositionHistory : true;\n*/\n  /**\n   * Whether the geolocate should show a buffer around the current position\n   */\n   set buffer(value: GeolocationBuffer) {\n    this._buffer = value;\n    this.handleFeatureCreation(this.position$.value);\n  }\n   get buffer(): GeolocationBuffer {\n    return this._buffer;\n  }\n  private _buffer: GeolocationBuffer = this.options && this.options.buffer ? this.options.buffer : undefined;\n\n  /**\n   * Whether the geolocate controller accuracy threshold to store/show the position.\n   */\n  set accuracyThreshold(value: number) {\n    this._accuracyThreshold = value;\n    this.handleFeatureCreation(this.position$.value);\n  }\n\n  get accuracyThreshold(): number {\n    return this._accuracyThreshold;\n  }\n  private _accuracyThreshold = this.options && this.options.accuracyThreshold ? this.options.accuracyThreshold : 5000;\n\n\n  /**\n   * Whether the activate the geolocation.\n   */\n  get tracking() {\n    return this.geolocation.getTracking();\n  }\n\n  set tracking(value: boolean) {\n    this.geolocation.setTracking(value || false);\n    this.tracking$.next(value);\n    if (this.storageService && value !== undefined) {\n      this.storageService.set('geolocation.tracking', value);\n    }\n    if (!value) {\n      this.position$.next(undefined);\n    }\n  }\n\n    /**\n   * Whether the activate the view tracking of the current position\n   */\n  set followPosition(value: boolean) {\n    this._followPosition = value;\n    this.followPosition$.next(value);\n    if (this.configService?.getConfig('geolocate.followPosition') === false) {\n      this._followPosition = false;\n      this.followPosition$.next(false);\n    }\n    this.handleFeatureCreation(this.position$.value);\n    if (this.storageService && value !== undefined) {\n      this.storageService.set('geolocation.followPosition', value);\n    }\n  }\n\n  get followPosition() {\n    return this._followPosition;\n  }\n\n\n  private _followPosition = this.options && this.options.followPosition ? this.options.followPosition : false;\n\n\n  constructor(\n    private map: IgoMap,\n    private options?: MapGeolocationControllerOptions,\n    private storageService?: StorageService,\n    private configService?: ConfigService) {\n    super();\n    this.geolocationOverlay = new Overlay(this.map);\n  }\n\n  /**\n   * Add or remove this controller to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    super.setOlMap(olMap);\n    this.setupObservers();\n  }\n\n  private deleteGeolocationFeatures() {\n    this.deleteFeatureByType(GeolocationOverlayType.Position);\n    this.deleteFeatureByType(GeolocationOverlayType.Accuracy);\n    this.deleteFeatureByType(GeolocationOverlayType.Buffer);\n  }\n\n  setupObservers() {\n    this.tracking$.subscribe(tracking => {\n      if (tracking) {\n        this.onPositionChange(true, true);\n      } else {\n        this.deleteGeolocationFeatures();\n      }\n    });\n\n    this.geolocation = new olGeolocation({\n      // enableHighAccuracy must be set to true to have the heading value.\n      trackingOptions: {\n        enableHighAccuracy: true,\n        maximumAge: 10000,\n        timeout: 600000\n      },\n      projection: this.options.projection,\n    });\n    let tracking = false;\n    this.subscriptions$$.push(this.emissionIntervalSeconds$\n      .pipe(switchMap(value => interval(value * 1000)))\n      .subscribe(() => {\n        if (tracking === this.tracking) {\n          this.onPositionChange(true);\n        } else {\n          tracking = this.tracking;\n          this.onPositionChange(true, true);\n        }\n      }));\n  }\n\n  public updateGeolocationOptions(options: MapViewOptions) {\n    if (!options) { return;}\n    // todo maybe a dedicated interface for geolocation should be defined instead of putting these inside the mapviewoptions?\n    let tracking = options.geolocate;\n    let followPosition = options.alwaysTracking;\n    if (this.storageService) {\n      const storedTracking = this.storageService.get('geolocation.tracking') as boolean;\n      if (storedTracking !== null && storedTracking !== undefined) {\n        tracking = storedTracking;\n      }\n\n      const storedFollowPosition = this.storageService.get('geolocation.followPosition') as boolean;\n      if (storedFollowPosition !== null && storedFollowPosition !== undefined) {\n        followPosition = storedFollowPosition;\n      }\n    }\n    this.tracking = tracking;\n    this.followPosition = followPosition;\n    this.buffer = options.buffer;\n  }\n\n  /**\n   * Teardown any observers\n   */\n  teardownObservers() {\n    if (this.subscriptions$$.length) {\n      this.subscriptions$$.map(s => s.unsubscribe());\n    }\n    super.teardownObservers();\n  }\n\n  /**\n   * Clear the position  history\n   */\n  /*\n  // todo\n  clearPositionsHistory() {\n    this.positions = [];\n  }*/\n\n  /**\n   * On position change, get the position, show it on the map and record it.\n   * @param emitEvent Map event\n   */\n  private onPositionChange(emitEvent: boolean = false, zoomTo: boolean = false) {\n    if (!this.tracking) {\n      return;\n    }\n    const geolocateProperties = this.geolocation.getProperties();\n\n    if (geolocateProperties.accuracy > this.accuracyThreshold) {\n      console.warn('Poor geolocation accuracy. No position are stored/shown');\n      this.position$.next(undefined);\n      return;\n    }\n\n    const position: MapGeolocationState = {\n      position: geolocateProperties.position,\n      projection: this.geolocation.getProjection().getCode(),\n      accuracy: geolocateProperties.accuracy,\n      altitude: geolocateProperties.altitude,\n      altitudeAccuracy: geolocateProperties.altitudeAccuracy,\n      heading: geolocateProperties.heading,\n      speed: geolocateProperties.speed,\n      enableHighAccuracy: geolocateProperties.trackingOptions?.enableHighAccuracy ? true : false,\n      timestamp: new Date()\n    };\n    this.handleFeatureCreation(position, zoomTo);\n    if (emitEvent) {\n      this.position$.next(position);\n      /*if (this.keepPositionHistory === true) {\n        // handle position diff to store only true diff;\n        this.positions.push(position);\n      }*/\n    }\n  }\n\n  private deleteFeatureByType(type: GeolocationOverlayType) {\n    const featureById = this.geolocationOverlay.dataSource.ol.getFeatureById(type);\n    if (featureById) {\n      this.geolocationOverlay.dataSource.ol.removeFeature(featureById);\n    }\n\n  }\n\n  private handleFeatureCreation(position: MapGeolocationState, zoomTo: boolean = false) {\n    if (!position || !position.position) {\n      return;\n    }\n    this.deleteGeolocationFeatures();\n    const positionGeometry = new Point(position.position);\n    const accuracyGeometry = fromCircle(new OlCircle(position.position, position.accuracy || 0));\n\n    const positionFeature = new olFeature<Point>({ geometry: positionGeometry });\n    const accuracyFeature = new olFeature<Polygon>({ geometry: accuracyGeometry });\n\n    if (positionGeometry) {\n      let motion = this.followPosition ? FeatureMotion.Move : FeatureMotion.None;\n      if (zoomTo) {\n        motion = FeatureMotion.Zoom;\n      }\n      positionFeature.setId(GeolocationOverlayType.Position);\n      positionFeature.setStyle(this.positionFeatureStyle);\n      this.geolocationOverlay.addOlFeature(positionFeature, motion);\n      if (accuracyGeometry) {\n        accuracyFeature.setId(GeolocationOverlayType.Accuracy);\n        accuracyFeature.setStyle(this.accuracyFeatureStyle);\n        this.geolocationOverlay.addOlFeature(accuracyFeature, motion);\n      }\n      if (this.buffer) {\n        const bufferFeature = new olFeature(new OlCircle(position.position, this.buffer.bufferRadius));\n        const bufferStyle = new olstyle.Style({\n          stroke: new olstyle.Stroke({ width: 2, color: this.buffer.bufferStroke }),\n          fill: new olstyle.Fill({ color: this.buffer.bufferFill }),\n          text: new olstyle.Text({\n            textAlign: 'left',\n            offsetX: 10,\n            offsetY: -10,\n            font: '12px Calibri,sans-serif',\n            text: this.buffer.showBufferRadius ? `${this.buffer.bufferRadius}m` : '',\n            fill: new olstyle.Fill({ color: '#000' }),\n            stroke: new olstyle.Stroke({ color: '#fff', width: 3 })\n          })\n        });\n        bufferFeature.setId(GeolocationOverlayType.Buffer);\n        bufferFeature.setStyle(bufferStyle);\n        this.geolocationOverlay.addOlFeature(bufferFeature, motion);\n      }\n\n    }\n\n  }\n}\n","import { ObjectEvent } from \"ol/Object\";\nimport { getUid } from \"ol/util\";\nimport { WMSDataSource } from \"../../datasource/shared/datasources/wms-datasource\";\nimport { OgcFilterableDataSource, OgcFilterableDataSourceOptions } from \"../../filter/shared/ogc-filter.interface\";\nimport { TimeFilterableDataSource, TimeFilterableDataSourceOptions } from \"../../filter/shared/time-filter.interface\";\nimport { Layer, LinkedProperties } from \"../../layer/shared/layers\";\nimport { IgoMap } from \"./map\";\nimport olSourceImageWMS from 'ol/source/ImageWMS';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\n\nexport function getLinkedLayersOptions(layer: Layer) {\n    return layer.options.linkedLayers;\n}\n\nexport function getIgoLayerByLinkId(map: IgoMap, id: string) {\n    return map.layers.find(l => l.options.linkedLayers?.linkId === id);\n}\n\nexport function layerHasLinkWithProperty(layer: Layer, property: LinkedProperties): boolean {\n    let hasLinkWithProperty = false;\n    const layerLLOptions = getLinkedLayersOptions(layer);\n    if (layerLLOptions?.links) {\n        const link = layerLLOptions.links.find(l => l.properties.includes(property));\n        hasLinkWithProperty = link ? true : false;\n    }\n    return hasLinkWithProperty;\n}\n\nexport function layerHasLinkDeletion(layer: Layer): boolean {\n  let hasLinkWithSyncedDelete = false;\n  const layerLLOptions = getLinkedLayersOptions(layer);\n  if (layerLLOptions?.links) {\n      const link = layerLLOptions.links.find(l => l.syncedDelete);\n      hasLinkWithSyncedDelete = link ? true : false;\n  }\n  return hasLinkWithSyncedDelete;\n}\n\nexport function getRootParentByProperty(map: IgoMap, layer: Layer, property: LinkedProperties): Layer {\n    let layerToUse = layer;\n    let parentLayer = layerToUse;\n    let hasParentLayer = true;\n    while (hasParentLayer) {\n        layerToUse = parentLayer;\n        parentLayer = getDirectParentLayerByProperty(map, layerToUse, property);\n        hasParentLayer = parentLayer ? true : false;\n    }\n    if (!hasParentLayer) {\n        if (!layerHasLinkWithProperty(layerToUse,property)) {\n            layerToUse = undefined;\n        }\n    }\n    return hasParentLayer ? parentLayer : layerToUse;\n}\n\nexport function getDirectParentLayerByProperty(map: IgoMap, layer: Layer, property: LinkedProperties): Layer {\n    if (layer?.options.linkedLayers?.linkId) {\n        const currentLinkId = layer.options.linkedLayers.linkId;\n        let parents = map.layers.filter(pl => {\n            const linkedLayers = pl.options.linkedLayers;\n            if (linkedLayers && linkedLayers.links) {\n                const a = linkedLayers.links.find(l => l.linkedIds.includes(currentLinkId) && l.properties.includes(property));\n                return a;\n            }\n        });\n        if (parents.length > 1) {\n            console.warn(`Your layer ${layer.title || layer.id} must only have 1 parent (${parents.map(p => p.title || p.id)})\n            , The first parent (${parents[0].title || parents[0].id}) will be use to sync properties`);\n        }\n        return parents[0];\n    }\n}\n\nexport function getDirectChildLayersByProperty(map: IgoMap, layer: Layer, property: LinkedProperties): Layer[] {\n    let linkedIds = [];\n    if (layer?.options.linkedLayers?.links) {\n        layer.options.linkedLayers.links\n        .filter(l => l.properties.includes(property))\n        .map(link => {\n            linkedIds = linkedIds.concat(link.linkedIds);});\n    }\n    return linkedIds.map(lid => getIgoLayerByLinkId(map, lid));\n}\n\nexport function getAllChildLayersByProperty(map: IgoMap, layer: Layer, knownChildLayers: Layer[], property: LinkedProperties): Layer[] {\n    let childLayers = getDirectChildLayersByProperty(map, layer,property);\n    childLayers.map(cl => {\n        knownChildLayers.push(cl);\n        const directChildLayers = getDirectChildLayersByProperty(map, cl, property);\n        if (directChildLayers) {\n            getAllChildLayersByProperty(map, cl, knownChildLayers, property);\n        }\n\n    });\n    return knownChildLayers;\n}\n\nexport function getRootParentByDeletion(map: IgoMap, layer: Layer): Layer {\n  let layerToUse = layer;\n  let parentLayer = layerToUse;\n  let hasParentLayer = true;\n  while (hasParentLayer) {\n      layerToUse = parentLayer;\n      parentLayer = getDirectParentLayerByDeletion(map, layerToUse);\n      hasParentLayer = parentLayer ? true : false;\n  }\n  if (!hasParentLayer) {\n    if (!layerHasLinkDeletion(layerToUse)) {\n      layerToUse = undefined;\n    }\n  }\n  return hasParentLayer ? parentLayer : layerToUse;\n}\n\nexport function getDirectParentLayerByDeletion(map: IgoMap, layer: Layer): Layer {\n  if (layer.options.linkedLayers?.linkId) {\n      const currentLinkId = layer.options.linkedLayers.linkId;\n      let parents = map.layers.filter(pl => {\n          const linkedLayers = pl.options.linkedLayers;\n          if (linkedLayers && linkedLayers.links) {\n              const a = linkedLayers.links.find(l => (l.linkedIds.includes(currentLinkId) && l.syncedDelete));\n              return a;\n          }\n      });\n      if (parents.length > 1) {\n          console.warn(`Your layer ${layer.title || layer.id} must only have 1 parent (${parents.map(p => p.title || p.id)})\n          , The first parent (${parents[0].title || parents[0].id}) will be use to sync properties`);\n      }\n      return parents[0];\n  }\n}\n\nexport function getDirectChildLayersByDeletion(map: IgoMap, layer: Layer): Layer[] {\n  let linkedIds = [];\n  if (layer?.options.linkedLayers?.links) {\n      layer.options.linkedLayers.links\n      .filter(l => l.syncedDelete)\n      .map(link => {\n          linkedIds = linkedIds.concat(link.linkedIds);});\n  }\n  return linkedIds.map(lid => getIgoLayerByLinkId(map, lid));\n}\n\nexport function getAllChildLayersByDeletion(map: IgoMap, layer: Layer, knownChildLayers: Layer[]): Layer[] {\n  let childLayers = getDirectChildLayersByDeletion(map, layer);\n  childLayers.map(cl => {\n      knownChildLayers.push(cl);\n      const directChildLayers = getDirectChildLayersByDeletion(map, cl);\n      if (directChildLayers) {\n        getAllChildLayersByDeletion(map, cl, knownChildLayers);\n      }\n\n  });\n  return knownChildLayers;\n}\n\nexport function initLayerSyncFromRootParentLayers(map: IgoMap, layers: Layer[]) {\n    const rootLayersByProperty = {};\n    const keys = Object.keys(LinkedProperties);\n    keys.map(k => {\n      rootLayersByProperty[LinkedProperties[k]] = [];\n    });\n    layers\n      .filter(l => getLinkedLayersOptions(l))\n      .map(l => {\n        keys.map(key => {\n          const k = LinkedProperties[key];\n          const plbp = getRootParentByProperty(map, l, k as LinkedProperties);\n          const layers = rootLayersByProperty[k];\n          const layersId = layers.map(l => l.id);\n          if (plbp && !layersId.includes(plbp.id)) {\n            rootLayersByProperty[k].push(plbp);\n          }\n        });\n      });\n    Object.keys(rootLayersByProperty).map(k => {\n      const layers = rootLayersByProperty[k];\n      layers.map((l: Layer) => l.ol.notify(k, undefined));\n    });\n  }\n\n  export function handleLayerPropertyChange(map: IgoMap, propertyChange: ObjectEvent, initiatorIgoLayer: Layer) {\n    if (!propertyChange) {\n      return;\n    }\n    const ogcFilterWriter = new OgcFilterWriter();\n    let isLayerProperty = true;\n    let isDatasourceProperty = true;\n    const key = propertyChange.key;\n    let newValue;\n    if (key === 'ogcFilters') {\n      isLayerProperty = false;\n      isDatasourceProperty = true;\n      newValue = (initiatorIgoLayer.dataSource.options as OgcFilterableDataSourceOptions).ogcFilters;\n    } else if (key === 'timeFilter') {\n      isLayerProperty = false;\n      isDatasourceProperty = true;\n      newValue = (initiatorIgoLayer.dataSource.options as TimeFilterableDataSourceOptions).timeFilter;\n    } else {\n      isLayerProperty = true;\n      isDatasourceProperty = false;\n      newValue = initiatorIgoLayer.ol.get(key);\n    }\n\n    const initiatorLinkedLayersOptions = getLinkedLayersOptions(initiatorIgoLayer);\n    if (initiatorLinkedLayersOptions) {\n      let rootParentByProperty = getRootParentByProperty(map,initiatorIgoLayer, key as LinkedProperties);\n      if (!rootParentByProperty) {\n        rootParentByProperty = initiatorIgoLayer;\n      }\n\n      const clbp = [rootParentByProperty];\n      getAllChildLayersByProperty(map, rootParentByProperty, clbp, key as LinkedProperties);\n\n      let resolutionPropertyHasChanged = false;\n      const initiatorIgoLayerSourceType = initiatorIgoLayer.options.source.options.type;\n      const initiatorIgoLayerOgcFilterableDataSourceOptions = initiatorIgoLayer.dataSource.options as OgcFilterableDataSourceOptions;\n      clbp.map(l => {\n        if (initiatorIgoLayer && l && getUid(initiatorIgoLayer.ol) !== getUid(l?.ol)) {\n          const lLayerType = l.options.source.options.type;\n          if (isLayerProperty) {\n          l.ol.set(key, newValue, true);\n          if (key === 'visible') {\n            l.visible$.next(newValue);\n          }\n          if (key === 'minResolution' || key === 'maxResolution') {\n            resolutionPropertyHasChanged = true;\n          }\n          } else if (isDatasourceProperty) {\n            if (key === 'ogcFilters') {\n              (l.dataSource as OgcFilterableDataSource).setOgcFilters(newValue, false);\n              if (lLayerType === 'wfs') {\n                l.ol.getSource().refresh();\n              }\n              if (lLayerType === 'wms') {\n                let appliedOgcFilter;\n                if (initiatorIgoLayerSourceType === 'wfs') {\n                  appliedOgcFilter = ogcFilterWriter.handleOgcFiltersAppliedValue(\n                    initiatorIgoLayerOgcFilterableDataSourceOptions,\n                    (initiatorIgoLayer.dataSource.options as any).fieldNameGeometry,\n                    undefined,\n                    map.viewController.getOlProjection()\n                  );\n                } else if (initiatorIgoLayerSourceType === 'wms') {\n                  appliedOgcFilter = (initiatorIgoLayer.dataSource as WMSDataSource).ol.getParams().FILTER;\n                }\n                (l.dataSource as WMSDataSource).ol.updateParams({ FILTER: appliedOgcFilter });\n              }\n            } else if (l.dataSource instanceof WMSDataSource && key === 'timeFilter') {\n              (l.dataSource as TimeFilterableDataSource).setTimeFilter(newValue, false);\n              const appliedTimeFilter = (initiatorIgoLayer.ol.getSource() as olSourceImageWMS).getParams().TIME;\n              l.dataSource.ol.updateParams({ TIME: appliedTimeFilter });\n            }\n          }\n        }\n      });\n      if (resolutionPropertyHasChanged) {\n        map.viewController.resolution$.next(map.viewController.resolution$.value);\n      }\n\n\n    }\n  }\n","import olMap from 'ol/Map';\nimport olView from 'ol/View';\nimport olControlAttribution from 'ol/control/Attribution';\nimport olControlScaleLine from 'ol/control/ScaleLine';\nimport * as olproj from 'ol/proj';\nimport * as olproj4 from 'ol/proj/proj4';\nimport OlProjection from 'ol/proj/Projection';\nimport * as olinteraction from 'ol/interaction';\nimport {getUid} from 'ol/util';\nimport olLayer from 'ol/layer/Layer';\nimport olSource from 'ol/source/Source';\n\nimport proj4 from 'proj4';\nimport { BehaviorSubject, skipWhile, Subject } from 'rxjs';\n\nimport { SubjectStatus } from '@igo2/utils';\n\nimport { Layer } from '../../layer/shared/layers';\nimport { Overlay } from '../../overlay/shared/overlay';\n\nimport { LayerWatcher } from '../utils/layer-watcher';\nimport {\n  MapViewOptions,\n  MapOptions,\n  MapAttributionOptions,\n  MapScaleLineOptions,\n  MapExtent,\n  MapControlsOptions\n} from './map.interface';\nimport { MapViewController } from './controllers/view';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { MapGeolocationController } from './controllers/geolocation';\nimport { StorageService, ConfigService } from '@igo2/core';\nimport { ObjectEvent } from 'ol/Object';\nimport {\n  getAllChildLayersByDeletion,\n  getRootParentByDeletion,\n  handleLayerPropertyChange,\n  initLayerSyncFromRootParentLayers\n} from './linkedLayers.utils';\n\n// TODO: This class is messy. Clearly define it's scope and the map browser's.\n// Move some stuff into controllers.\nexport class IgoMap {\n  public ol: olMap;\n  public offlineButtonToggle$ = new BehaviorSubject<boolean>(false);\n  public layers$ = new BehaviorSubject<Layer[]>([]);\n  public status$: Subject<SubjectStatus>;\n  public propertyChange$: Subject<{event:ObjectEvent, layer: Layer}>;\n  public overlay: Overlay;\n  public queryResultsOverlay: Overlay;\n  public searchResultsOverlay: Overlay;\n  public viewController: MapViewController;\n  public geolocationController: MapGeolocationController;\n  public swipeEnabled$ = new BehaviorSubject<boolean>(false);\n  public mapCenter$ = new BehaviorSubject<boolean>(false);\n  public selectedFeatures$ = new BehaviorSubject<Layer[]>(null);\n\n  public bufferDataSource: FeatureDataSource;\n\n  private layerWatcher: LayerWatcher;\n  private options: MapOptions;\n  private mapViewOptions: MapViewOptions;\n  private defaultOptions: Partial<MapOptions> = {\n    controls: { attribution: false }\n  };\n\n  get layers(): Layer[] {\n    return this.layers$.value;\n  }\n\n  get projection(): string {\n    return this.viewController.getOlProjection().getCode();\n  }\n\n  constructor(\n    options?: MapOptions,\n    private storageService?: StorageService,\n    private configService?: ConfigService) {\n    this.options = Object.assign({}, this.defaultOptions, options);\n    this.layerWatcher = new LayerWatcher();\n    this.status$ = this.layerWatcher.status$;\n    this.propertyChange$ = this.layerWatcher.propertyChange$;\n    olproj4.register(proj4);\n    this.init();\n  }\n\n  init() {\n    const controls = [];\n    if (this.options.controls) {\n      if (this.options.controls.attribution) {\n        const attributionOpt = (this.options.controls.attribution === true\n          ? {}\n          : this.options.controls.attribution) as MapAttributionOptions;\n        controls.push(new olControlAttribution(attributionOpt));\n      }\n      if (this.options.controls.scaleLine) {\n        const scaleLineOpt = (this.options.controls.scaleLine === true\n          ? {}\n          : this.options.controls.scaleLine) as MapScaleLineOptions;\n        controls.push(new olControlScaleLine(scaleLineOpt));\n      }\n    }\n    let interactions = {};\n    if (this.options.interactions === false) {\n      interactions = {\n        altShiftDragRotate: false,\n        doubleClickZoom: false,\n        keyboard: false,\n        mouseWheelZoom: false,\n        shiftDragZoom: false,\n        dragPan: false,\n        pinchRotate: false,\n        pinchZoom: false\n      };\n    }\n\n    this.ol = new olMap({\n      interactions: olinteraction.defaults(interactions),\n      controls\n    });\n\n    this.setView(this.options.view || {});\n    this.viewController = new MapViewController({\n      stateHistory: true\n    });\n    this.viewController.setOlMap(this.ol);\n    this.overlay = new Overlay(this);\n    this.queryResultsOverlay = new Overlay(this);\n    this.searchResultsOverlay = new Overlay(this);\n    this.ol.once('rendercomplete', () => {\n      this.geolocationController = new MapGeolocationController(\n        this,\n        {\n          projection: this.viewController.getOlProjection()\n        },\n        this.storageService,\n        this.configService);\n      this.geolocationController.setOlMap(this.ol);\n      if (this.geolocationController) {\n        this.geolocationController.updateGeolocationOptions(this.mapViewOptions);\n      }\n      this.layers$.subscribe((layers) => {\n        for (const layer of layers) {\n          if (layer.options.linkedLayers) {\n            layer.ol.once('postrender', () => {\n              initLayerSyncFromRootParentLayers(this, this.layers);\n            });\n          }\n        }\n      });\n      this.viewController.monitorRotation();\n  });\n  this.propertyChange$.pipe(skipWhile((pc) => !pc)).subscribe(p => handleLayerPropertyChange(this, p.event, p.layer));\n  }\n\n\n  setTarget(id: string) {\n    this.ol.setTarget(id);\n    if (id !== undefined) {\n      this.layerWatcher.subscribe(() => { }, null);\n    } else {\n      this.layerWatcher.unsubscribe();\n    }\n  }\n\n  updateView(options: MapViewOptions) {\n    const currentView = this.ol.getView();\n    const viewOptions = Object.assign(\n      {\n        zoom: currentView.getZoom()\n      },\n      currentView.getProperties()\n    );\n\n    this.setView(Object.assign(viewOptions, options));\n    if (options.maxZoomOnExtent) {\n      this.viewController.maxZoomOnExtent = options.maxZoomOnExtent;\n    }\n    this.mapViewOptions = options;\n  }\n\n  /**\n   * Set the map view\n   * @param options Map view options\n   */\n  setView(options: MapViewOptions) {\n    if (this.viewController !== undefined) {\n      this.viewController.clearStateHistory();\n    }\n\n    options = Object.assign({ constrainResolution: true }, options);\n    const view = new olView(options);\n    this.ol.setView(view);\n\n    if (options) {\n      if (options.maxLayerZoomExtent) {\n        this.viewController.maxLayerZoomExtent = options.maxLayerZoomExtent;\n      }\n\n      if (options.center) {\n        const projection = view.getProjection().getCode();\n        const center = olproj.fromLonLat(options.center, projection);\n        view.setCenter(center);\n      }\n    }\n  }\n\n  updateControls(value: MapControlsOptions) {\n    if (value === undefined) {\n      return;\n    }\n\n    const controls = [];\n    if (value.attribution) {\n      const attributionOpt = (value.attribution === true\n        ? {}\n        : value.attribution) as MapAttributionOptions;\n      controls.push(new olControlAttribution(attributionOpt));\n    }\n    if (value.scaleLine) {\n      const scaleLineOpt = (value.scaleLine === true\n        ? {}\n        : value.scaleLine) as MapScaleLineOptions;\n      controls.push(new olControlScaleLine(scaleLineOpt));\n    }\n\n    const currentControls = Object.assign([], this.ol.getControls().getArray());\n    currentControls.forEach(control => {\n      this.ol.removeControl(control);\n    });\n    controls.forEach(control => {\n      this.ol.addControl(control);\n    });\n  }\n\n  /**\n   * Deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getCenter(projection?: string | OlProjection): [number, number] {\n    return this.viewController.getCenter(projection);\n  }\n\n  /**\n   * Deprecated\n   * TODO: Move to ViewController and update every place it's used\n   */\n  getExtent(projection?: string | OlProjection): MapExtent {\n    return this.viewController.getExtent(projection);\n  }\n\n  // TODO: Move to ViewController and update every place it's used\n  getZoom(): number {\n    return this.viewController.getZoom();\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (!baseLayer) {\n      return;\n    }\n\n    for (const bl of this.getBaseLayers()) {\n      bl.visible = false;\n    }\n\n    baseLayer.visible = true;\n\n    this.viewController.olView.setMinZoom(\n      baseLayer.dataSource.options.minZoom || (this.options.view || {}).minZoom\n    );\n    this.viewController.olView.setMaxZoom(\n      baseLayer.dataSource.options.maxZoom || (this.options.view || {}).maxZoom\n    );\n  }\n\n  getBaseLayers(): Layer[] {\n    return this.layers.filter((layer: Layer) => layer.baseLayer === true);\n  }\n\n  getLayerById(id: string): Layer {\n    return this.layers.find((layer: Layer) => layer.id && layer.id === id);\n  }\n\n  getLayerByAlias(alias: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => layer.alias && layer.alias === alias\n    );\n  }\n\n  getLayerByOlUId(olUId: string): Layer {\n    return this.layers.find(\n      (layer: Layer) => getUid(layer.ol) && getUid(layer.ol) === olUId\n    );\n  }\n\n  getLayerByOlLayer(olLayer: olLayer<olSource>): Layer {\n    const olUId = getUid(olLayer);\n    return this.getLayerByOlUId(olUId);\n  }\n\n  /**\n   * Add a single layer\n   * @param layer Layer to add\n   * @param push DEPRECATED\n   */\n  addLayer(layer: Layer, push = true) {\n    this.addLayers([layer]);\n  }\n\n  /**\n   * Add many layers\n   * @param layers Layers to add\n   * @param push DEPRECATED\n   */\n  addLayers(layers: Layer[], push = true) {\n    let offsetZIndex = 0;\n    let offsetBaseLayerZIndex = 0;\n    const addedLayers = layers\n      .map((layer: Layer) => {\n        if (!layer) { return; }\n        const offset = layer.zIndex\n          ? 0\n          : layer.baseLayer\n            ? offsetBaseLayerZIndex++\n            : offsetZIndex++;\n        return this.doAddLayer(layer, offset);\n      })\n      .filter((layer: Layer | undefined) => layer !== undefined);\n    this.setLayers([].concat(this.layers, addedLayers));\n  }\n\n  /**\n   * Remove a single layer\n   * @param layer Layer to remove\n   */\n  removeLayer(layer: Layer) {\n    this.removeLayers([layer]);\n  }\n\n  /**\n   * Remove many layers\n   * @param layers Layers to remove\n   */\n  removeLayers(layers: Layer[]) {\n    const newLayers = this.layers$.value.slice(0);\n    const layersToRemove = [];\n    layers.forEach((layer: Layer) => {\n      const index = newLayers.indexOf(layer);\n      if (index >= 0) {\n        layersToRemove.push(layer);\n        newLayers.splice(index, 1);\n        this.handleLinkedLayersDeletion(layer, layersToRemove);\n        layersToRemove.map(linkedLayer => {\n          const linkedIndex = newLayers.indexOf(linkedLayer);\n          if (linkedIndex >= 0) {\n            newLayers.splice(linkedIndex, 1);\n          }\n        });\n      }\n    });\n\n    layersToRemove.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.setLayers(newLayers);\n  }\n\n  /**\n   * Build a list of linked layers to delete\n   * @param srcLayer Layer that has triggered the deletion\n   * @param layersToRemove list to append the layer to delete into\n   */\n  handleLinkedLayersDeletion(srcLayer: Layer, layersToRemove: Layer[]) {\n    let rootParentByDeletion = getRootParentByDeletion(this, srcLayer);\n    if (!rootParentByDeletion) {\n      rootParentByDeletion = srcLayer;\n    }\n    const clbd = getAllChildLayersByDeletion(this, rootParentByDeletion, [rootParentByDeletion]);\n    for (const layer of clbd) {\n      layersToRemove.push(layer);\n    }\n  }\n\n  /**\n   * Remove all layers\n   */\n  removeAllLayers() {\n    this.layers.forEach((layer: Layer) => this.doRemoveLayer(layer));\n    this.layers$.next([]);\n  }\n\n  raiseLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index > 1) {\n      this.moveLayer(layer, index, index - 1);\n    }\n  }\n\n  raiseLayers(layers: Layer[]) {\n    for (const layer of layers) {\n      this.raiseLayer(layer);\n    }\n  }\n\n  lowerLayer(layer: Layer) {\n    const index = this.getLayerIndex(layer);\n    if (index < this.layers.length - 1) {\n      this.moveLayer(layer, index, index + 1);\n    }\n  }\n\n  lowerLayers(layers: Layer[]) {\n    const reverseLayers = layers.reverse();\n    for (const layer of reverseLayers) {\n      this.lowerLayer(layer);\n    }\n  }\n\n  moveLayer(layer: Layer, from: number, to: number) {\n    const layerTo = this.layers[to];\n    const zIndexTo = layerTo.zIndex;\n    const zIndexFrom = layer.zIndex;\n\n    if (layerTo.baseLayer || layer.baseLayer) {\n      return;\n    }\n\n    layer.zIndex = zIndexTo;\n    layerTo.zIndex = zIndexFrom;\n\n    this.layers[to] = layer;\n    this.layers[from] = layerTo;\n    this.layers$.next(this.layers.slice(0));\n  }\n\n  /**\n   * Add a layer to the OL map and start watching. If the layer is already\n   * added to this map, make it visible but don't add it one again.\n   * @param layer Layer\n   * @returns The layer added, if any\n   */\n  private doAddLayer(layer: Layer, offsetZIndex: number) {\n    if (layer.baseLayer && layer.visible) {\n      this.changeBaseLayer(layer);\n    }\n\n    const existingLayer = this.getLayerById(layer.id);\n    if (existingLayer !== undefined) {\n      existingLayer.visible = true;\n      return;\n    }\n\n    if (!layer.baseLayer && layer.zIndex) {\n      layer.zIndex += 10;\n    }\n\n    if (layer.zIndex === undefined || layer.zIndex === 0) {\n      const maxZIndex = Math.max(\n        layer.baseLayer ? 0 : 10,\n        ...this.layers\n          .filter(\n            (l) => l.baseLayer === layer.baseLayer && l.zIndex < 200 // zIndex > 200 = system layer\n          )\n          .map((l) => l.zIndex)\n      );\n      layer.zIndex = maxZIndex + 1 + offsetZIndex;\n    }\n\n    if (layer.baseLayer && layer.zIndex > 9) {\n      layer.zIndex = 10; // baselayer must have zIndex < 10\n    }\n\n    layer.setMap(this);\n    this.layerWatcher.watchLayer(layer);\n    this.ol.addLayer(layer.ol);\n\n    return layer;\n  }\n\n  /**\n   * Remove a layer from the OL map and stop watching\n   * @param layer Layer\n   */\n  private doRemoveLayer(layer: Layer) {\n    this.layerWatcher.unwatchLayer(layer);\n    this.ol.removeLayer(layer.ol);\n    layer.setMap(undefined);\n  }\n\n  /**\n   * Update the layers observable\n   * @param layers Layers\n   */\n  private setLayers(layers: Layer[]) {\n    this.layers$.next(this.sortLayersByZIndex(layers).slice(0));\n  }\n\n  /**\n   * Sort layers by descending zIndex\n   * @param layers Array of layers\n   * @returns The original array, sorted by zIndex\n   */\n  private sortLayersByZIndex(layers: Layer[]) {\n    // Sort by descending zIndex\n    return layers.sort(\n      (layer1: Layer, layer2: Layer) => layer2.zIndex - layer1.zIndex\n    );\n  }\n\n  /**\n   * Get layer index in the map's inenr array of layers\n   * @param layer Layer\n   * @returns The layer index\n   */\n  private getLayerIndex(layer: Layer) {\n    return this.layers.findIndex((_layer: Layer) => _layer === layer);\n  }\n\n  onOfflineToggle(offline: boolean) {\n    this.offlineButtonToggle$.next(offline);\n  }\n}\n","import {\n  Component,\n  Input,\n  OnInit,\n  AfterViewInit,\n  OnDestroy\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { SubjectStatus } from '@igo2/utils';\nimport { ActivityService } from '@igo2/core';\n\nimport { IgoMap } from '../shared/map';\nimport { MapControlsOptions, MapViewOptions } from '../shared/map.interface';\n\n@Component({\n  selector: 'igo-map-browser',\n  templateUrl: './map-browser.component.html',\n  styleUrls: ['./map-browser.component.scss']\n})\nexport class MapBrowserComponent implements OnInit, AfterViewInit, OnDestroy {\n  private activityId: string;\n  private status$$: Subscription;\n\n  @Input() map: IgoMap;\n\n  @Input()\n  get view(): MapViewOptions {\n    return this._view;\n  }\n  set view(value: MapViewOptions) {\n    this._view = value;\n    if (this.map !== undefined) {\n      this.map.updateView(value);\n    }\n  }\n  private _view: MapViewOptions;\n\n  get controls(): MapControlsOptions {\n    return this._controls;\n  }\n\n  set controls(value: MapControlsOptions) {\n    this._controls = value;\n    if (this.map !== undefined) {\n      this.map.updateControls(value);\n    }\n  }\n  private _controls: MapControlsOptions;\n\n  public id = `igo-map-target-${new Date().getTime()}`;\n\n  constructor(private activityService: ActivityService) {}\n\n  ngOnInit() {\n    this.status$$ = this.map.status$.subscribe(status =>\n      this.handleStatusChange(status)\n    );\n  }\n\n  ngAfterViewInit() {\n    this.map.setTarget(this.id);\n  }\n\n  ngOnDestroy() {\n    this.map.setTarget(undefined);\n    this.activityService.unregister(this.activityId);\n    this.status$$.unsubscribe();\n  }\n\n  private handleStatusChange(status: SubjectStatus) {\n    if (status === SubjectStatus.Working && this.activityId === undefined) {\n      this.activityId = this.activityService.register();\n    } else if (status === SubjectStatus.Done && this.activityId !== undefined) {\n      this.activityService.unregister(this.activityId);\n      this.activityId = undefined;\n    }\n  }\n}\n","<div [id]=\"id\" class=\"igo-map-browser-target\"></div>\n<ng-content></ng-content>\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  Self,\n  OnInit\n} from '@angular/core';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\n\nimport { transform } from 'ol/proj';\nimport { MediaService } from '@igo2/core';\nimport { unByKey } from 'ol/Observable';\n/**\n * This directive return the pointer coordinate (on click or pointermove)\n * in [longitude, latitude], delayed by in input (pointerMoveDelay)\n * to avoid too many emitted values.\n */\n@Directive({\n  selector: '[igoPointerPosition]'\n})\nexport class PointerPositionDirective implements OnInit, OnDestroy {\n\n  private lastTimeoutRequest;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * Delay before emitting an event\n   */\n  @Input() pointerPositionDelay: number = 1000;\n\n  /**\n   * Event emitted when the pointer move, delayed by pointerMoveDelay\n   */\n  @Output() pointerPositionCoord = new EventEmitter<[number, number]>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService\n  ) { }\n\n  /**\n   * Start listening to pointermove\n   * @internal\n   */\n  ngOnInit(): void {\n    this.listenToMapPointerMove();\n    this.listenToMapClick();\n  }\n\n  /**\n   * Stop listening to pointermove\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unlistenToMapClick();\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, this.pointerPositionDelay)\n    );\n  }\n\n  /**\n   * On map click\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onPointerEvent(event, 0)\n    );\n  }\n\n  /**\n   * Stop listening for map pointermove\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * emit delayed coordinate (longitude, latitude array) based on pointerMoveDelay or on click\n   * @param event OL map browser pointer event\n   */\n  private onPointerEvent(event: MapBrowserPointerEvent<any>, delay: number) {\n    if (event.dragging || this.mediaService.isTouchScreen()) {return; }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n\n    const lonlat = transform(event.coordinate, this.mapProjection, 'EPSG:4326') as [number, number];\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.pointerPositionCoord.emit(lonlat);\n    }, delay);\n  }\n}\n","import {\n  Directive,\n  Input,\n  OnDestroy,\n  Self,\n  OnInit,\n  HostListener\n} from '@angular/core'\n  ;\nimport olLayerVectorTile from 'ol/layer/VectorTile';\nimport olLayerVector from 'ol/layer/Vector';\n\nimport { Subscription } from 'rxjs';\nimport olVectorTileSource from 'ol/source/VectorTile';\n\nimport type { default as OlMapBrowserEvent } from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlFeature from 'ol/Feature';\nimport * as OlStyle from 'ol/style';\nimport * as OlGeom from 'ol/geom';\n\nimport { EntityStore } from '@igo2/common';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { VectorLayer, Layer, VectorTileLayer } from '../../layer/shared/layers';\nimport { take } from 'rxjs/operators';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureMotion } from '../../feature/shared/feature.enums';\nimport { MediaService } from '@igo2/core';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { unByKey } from 'ol/Observable';\nimport RenderFeature from 'ol/render/Feature';\nimport { StyleByAttribute } from '../../layer/shared/vector-style.interface';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoHoverFeature]'\n})\nexport class HoverFeatureDirective implements OnInit, OnDestroy {\n\n  public store: FeatureStore<Feature>;\n  private pointerHoverFeatureStore: EntityStore<OlFeature<OlGeometry>> = new EntityStore<OlFeature<OlGeometry>>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n\n  private selectionLayer: olLayerVectorTile;\n  private selectionMVT = {};\n  private mvtStyleOptions: StyleByAttribute;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private singleClickMapListener;\n\n  private hoverFeatureId: string = 'hoverFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoHoverFeatureDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoHoverFeatureEnabled: boolean = false;\n\n  @HostListener('mouseout')\n  mouseout() {\n    clearTimeout(this.lastTimeoutRequest);\n    this.clearLayer();\n  }\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private mediaService: MediaService,\n    private styleService: StyleService,\n  ) { }\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.listenToMapPointerMove();\n    this.subscribeToPointerStore();\n    this.listenToMapClick();\n\n    this.map.status$.pipe(take(1)).subscribe(() => {\n      this.store = new FeatureStore<Feature>([], { map: this.map });\n      this.initStore();\n    });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers: Layer[]) => {\n      if (this.store && !layers.find(l => l.id === 'hoverFeatureId')) {\n        this.initStore();\n      }\n    });\n\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'hoverFeatureId',\n      title: 'hoverFeature',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: hoverFeatureMarker\n    });\n    tryBindStoreLayer(store, layer);\n\n    this.selectionLayer = new olLayerVectorTile({\n      map: this.map.ol,\n      zIndex: 901,\n      renderMode: \"vector\",\n      declutter: true,\n      source: new olVectorTileSource({projection: this.map.projection}),\n      style: (feature, resolution) => {\n        if (this.mvtStyleOptions && feature.getId() in this.selectionMVT) {\n          return this.createHoverStyle(feature, this.mvtStyleOptions, resolution);\n        }\n      }\n    });\n  }\n\n  createHoverStyle(feature: RenderFeature | OlFeature<OlGeometry>, hoverStyle: StyleByAttribute, resolution: number) {\n    const localHoverStyle = { ...hoverStyle };\n    let label = hoverStyle.label ? hoverStyle.label.attribute : undefined;\n    let hasLabelStyle = hoverStyle.label?.style ? true : false;\n\n    if (!feature.get('_isLabel')) {\n      localHoverStyle.label = undefined;\n      hasLabelStyle = false;\n      label = undefined;\n    } else {\n      // clear the style for label....\n      const size = localHoverStyle.data ? localHoverStyle.data.length : 0;\n      const radius = [];\n      const stroke = [];\n      const width = [];\n      const fill = [];\n      for (let i = 0; i < size; i++) {\n        radius.push(0);\n        stroke.push('rgba(255, 255, 255, 0)');\n        width.push(0);\n        fill.push('rgba(255, 255, 255, 0)');\n      }\n      localHoverStyle.radius = radius;\n      localHoverStyle.stroke = stroke;\n      localHoverStyle.width = width;\n      localHoverStyle.fill = fill;\n    }\n    if (!hasLabelStyle && label) {\n      localHoverStyle.label.style =\n      {\n        textAlign: 'left',\n        textBaseline: 'top',\n        font: '12px Calibri,sans-serif',\n        fill: { color: '#000' },\n        backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\n        backgroundStroke: { color: 'rgba(200, 200, 200, 0.75)', width: 2 },\n        stroke: { color: '#fff', width: 3 },\n        overflow: true,\n        offsetX: 10,\n        offsetY: 20,\n        padding: [2.5, 2.5, 2.5, 2.5]\n      };\n    }\n    return this.styleService.createStyleByAttribute(feature, localHoverStyle, resolution);\n  }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unlistenToMapSingleClick();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerHoverFeatureStore.entities$.subscribe(resultsUnderPointerPosition => {\n      this.addFeatureOverlay(resultsUnderPointerPosition);\n    });\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: OlMapBrowserEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * On map singleclick\n   */\n  private listenToMapClick() {\n    this.singleClickMapListener = this.map.ol.on(\n      'singleclick',\n      (event: OlMapBrowserEvent<any>) => this.onMapSingleClickEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Stop listening for map singleclick\n   * @internal\n   */\n  private unlistenToMapSingleClick() {\n    unByKey(this.singleClickMapListener);\n    this.singleClickMapListener = undefined;\n  }\n\n  /**\n   * Trigger clear layer on singleclick.\n   * @param event OL map browser singleclick event\n   */\n  private onMapSingleClickEvent(event: OlMapBrowserEvent<any>) {\n    this.clearLayer();\n  }\n\n  /**\n   * Trigger hover when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: OlMapBrowserEvent<any>) {\n    if (\n      event.dragging || !this.igoHoverFeatureEnabled ||\n      this.mediaService.isTouchScreen()) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    let maximumZindex = -Infinity;\n    let topMostOlLayer;\n    const pixel = this.map.ol.getPixelFromCoordinate(event.coordinate);\n    this.lastTimeoutRequest = setTimeout(() => {\n\n      // retrieve the topmost layer with feature to only apply the hover on this layer.\n      this.map.ol.forEachFeatureAtPixel(pixel, (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\n        if (!layerOL) {\n          return;\n        }\n        const igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid);\n        if (!this.canProcessHover(igoLayer as any)) {\n          return;\n        }\n        if (igoLayer.zIndex <= maximumZindex) {\n          return;\n        }\n        maximumZindex = igoLayer.zIndex;\n        topMostOlLayer = layerOL;\n\n      }, {\n        hitTolerance: 10, layerFilter: olLayer => olLayer instanceof olLayerVector || olLayer instanceof olLayerVectorTile\n      });\n      if (!topMostOlLayer) {\n        // To clear label\n        this.clearLayer();\n        this.pointerHoverFeatureStore.clear();\n        return;\n      }\n\n      this.map.ol.forEachFeatureAtPixel(pixel, (mapFeature: RenderFeature | OlFeature<OlGeometry>, layerOL: any) => {\n        // To avoid flashing feature\n        if (\n          mapFeature.get('hoverSummary') === undefined &&\n          mapFeature.getProperties() !== this.pointerHoverFeatureStore.all()[0]?.getProperties()\n        ) {\n          this.clearLayer();\n          let igoLayer;\n          if (layerOL instanceof olLayerVector) {\n            igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid) as VectorLayer;\n            if (!this.canProcessHover(igoLayer)) {\n              return;\n            }\n            let localOlFeature = this.handleRenderFeature(mapFeature);\n            this.setLayerStyleFromOptions(igoLayer, localOlFeature);\n            const featuresToLoad = [localOlFeature];\n            localOlFeature.set(\"_isLabel\", false);\n            const myLabelOlFeature = new OlFeature();\n            myLabelOlFeature.setProperties(localOlFeature.getProperties());\n            const labelGeom =\n              localOlFeature.getGeometry().getType() === 'Point' ? localOlFeature.getGeometry() : new OlGeom.Point(event.coordinate);\n            myLabelOlFeature.setGeometry(labelGeom);\n            myLabelOlFeature.setId(localOlFeature.getId());\n            myLabelOlFeature.set(\"_isLabel\", true);\n            this.setLayerStyleFromOptions(igoLayer, myLabelOlFeature);\n            featuresToLoad.push(myLabelOlFeature);\n            this.pointerHoverFeatureStore.load(featuresToLoad);\n            return true;\n          }\n          if (layerOL instanceof olLayerVectorTile) {\n            igoLayer = this.map.getLayerByOlUId((layerOL as any).ol_uid) as VectorTileLayer;\n            if (!this.canProcessHover(igoLayer)) {\n              return;\n            }\n            if (igoLayer?.options?.styleByAttribute?.hoverStyle) {\n              this.mvtStyleOptions = igoLayer.options.styleByAttribute.hoverStyle;\n            } else if (igoLayer?.options?.hoverStyle) {\n              this.mvtStyleOptions = igoLayer.options.hoverStyle;\n            }\n            this.selectionLayer.setSource(layerOL.getSource());\n            layerOL.getFeatures(event.pixel).then((mvtFeatures: (RenderFeature | OlFeature<OlGeometry>)[]) => {\n              if (!mvtFeatures.length) {\n                this.selectionMVT = {};\n                this.selectionLayer.changed();\n                this.clearLayer();\n                return;\n              }\n              const feature = mvtFeatures[0];\n              if (!feature) {\n                this.clearLayer();\n                return;\n              }\n              let localOlFeature = this.handleRenderFeature(feature);\n              localOlFeature.set(\"_isLabel\", false);\n              const myLabelOlFeature = new OlFeature();\n              myLabelOlFeature.setProperties(localOlFeature.getProperties());\n              const labelGeom =\n              localOlFeature.getGeometry().getType() === 'Point' ? localOlFeature.getGeometry() : new OlGeom.Point(event.coordinate);\n              myLabelOlFeature.setGeometry(labelGeom);\n              myLabelOlFeature.setId(localOlFeature.getId());\n              myLabelOlFeature.set(\"_isLabel\", true);\n              this.setLayerStyleFromOptions(igoLayer, myLabelOlFeature);\n              this.pointerHoverFeatureStore.load([myLabelOlFeature]);\n              this.selectionMVT[feature.getId()] = localOlFeature;\n              this.selectionLayer.changed();\n            });\n          }\n        }\n      }, {\n        hitTolerance: 10, layerFilter: olLayer => olLayer === topMostOlLayer\n      });\n    }, this.igoHoverFeatureDelay);\n  }\n\n  canProcessHover(igoLayer: VectorLayer | VectorTileLayer): boolean {\n    if (!igoLayer) {\n      return false;\n    }\n    if (!igoLayer.visible) {\n      return false;\n    }\n    if (!igoLayer.options) {\n      return false;\n    }\n\n    if (!igoLayer.options.styleByAttribute && !igoLayer.options.hoverStyle) {\n      return false;\n    }\n\n    if (\n      (igoLayer.options.styleByAttribute && !igoLayer.options.styleByAttribute.hoverStyle) &&\n      !igoLayer.options.hoverStyle) {\n      return false;\n    }\n    return true;\n  }\n\n  handleRenderFeature(feature: RenderFeature | OlFeature<OlGeometry>): OlFeature<OlGeometry> {\n    let localFeature: OlFeature<OlGeometry>;\n    if (feature instanceof RenderFeature) {\n      localFeature = new OlFeature({\n        geometry: this.getGeometry(feature)\n      });\n      localFeature.setId(feature.getId());\n    } else if (feature instanceof OlFeature) {\n      localFeature = feature;\n    }\n    localFeature.setProperties(feature.getProperties());\n    return localFeature;\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addFeatureOverlay(hoverEntity: OlFeature<OlGeometry>[]) {\n\n    if (hoverEntity.length > 0) {\n\n      const result = hoverEntity[0];\n      this.clearLayer();\n      const feature = new OlFeature({\n        geometry: result.getGeometry(),\n        meta: { id: this.hoverFeatureId },\n        hoverSummary: this.getHoverSummary(result.getProperties())\n      });\n\n      this.store.setLayerOlFeatures([feature], FeatureMotion.None);\n    }\n  }\n\n  private setLayerStyleFromOptions(igoLayer: VectorLayer | VectorTileLayer, feature: OlFeature<OlGeometry>) {\n    const resolution = this.store.layer.map.viewController.getResolution();\n    if (igoLayer?.options?.styleByAttribute?.hoverStyle) {\n      this.store.layer.ol.setStyle(this.createHoverStyle(feature, igoLayer.options.styleByAttribute.hoverStyle, resolution));\n      return;\n    }\n    if (igoLayer?.options?.hoverStyle) {\n      this.store.layer.ol.setStyle(this.createHoverStyle(feature, igoLayer.options.hoverStyle, resolution));\n    }\n  }\n\n  private getHoverSummary(properties): string {\n    let summary = '';\n    for (const [key, value] of Object.entries(properties)) {\n      if (!key.startsWith('_') && key !== 'geometry') {\n        summary += `${key}: ${value}` + '\\n';\n      }\n    }\n    return summary.length >= 2 ? summary.slice(0, -2) : summary;\n  }\n\n  private getGeometry(feature): OlGeom.Geometry {\n    let geom;\n    if (!feature.getOrientedFlatCoordinates) {\n      geom = feature.getGeometry();\n    } else {\n\n      const coords = feature.getOrientedFlatCoordinates();\n      const flatCoords = [];\n\n      coords.forEach((c, idx) => {\n        if (idx % 2 === 0) {\n          flatCoords.push([parseFloat(coords[idx]), parseFloat(coords[idx + 1])]);\n        }\n      });\n\n      // TODO: test MultiX\n      switch (feature.getType()) {\n        case 'Point':\n          geom = new OlGeom.Point(flatCoords);\n          break;\n        case 'Polygon':\n          geom = new OlGeom.Polygon([flatCoords]);\n          break;\n        case 'LineString':\n          geom = new OlGeom.LineString([flatCoords]);\n          break;\n      }\n    }\n\n    return geom;\n  }\n\n\n  /**\n   * Clear the pointer store features\n   */\n  private clearLayer() {\n    this.selectionMVT = {};\n    if (this.selectionLayer) {\n      this.selectionLayer.changed();\n    }\n    if (this.store) {\n      this.store.clearLayer();\n    }\n  }\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function hoverFeatureMarker(feature: OlFeature<OlGeom.Geometry>, resolution: number): OlStyle.Style[] {\n\n  const olStyleText = new OlStyle.Style({\n    text: new OlStyle.Text({\n      text: feature.get('hoverSummary'),\n      textAlign: 'left',\n      textBaseline: 'top',\n      font: '12px Calibri,sans-serif',\n      fill: new OlStyle.Fill({ color: '#000' }),\n      backgroundFill: new OlStyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n      backgroundStroke: new OlStyle.Stroke({ color: 'rgba(200, 200, 200, 0.75)', width: 2 }),\n      stroke: new OlStyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true,\n      offsetX: 10,\n      offsetY: 20,\n      padding: [2.5, 2.5, 2.5, 2.5]\n    })\n  });\n\n  const olStyle = [olStyleText];\n  switch (feature.getGeometry().getType()) {\n    case 'Point':\n      olStyle.push(new OlStyle.Style({\n        image: new OlStyle.Circle({\n          radius: 10,\n          stroke: new OlStyle.Stroke({\n            color: 'blue',\n            width: 3\n          })\n        })\n      }));\n      break;\n    default:\n      olStyle.push(new OlStyle.Style({\n        stroke: new OlStyle.Stroke({\n          color: 'white',\n          width: 5\n        })\n      }));\n      olStyle.push(new OlStyle.Style({\n        stroke: new OlStyle.Stroke({\n          color: 'blue',\n          width: 3\n        })\n      }));\n  }\n\n  return olStyle;\n\n}\n","import { Component, Input } from '@angular/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-zoom-button',\n  templateUrl: './zoom-button.component.html',\n  styleUrls: ['./zoom-button.component.scss']\n})\nexport class ZoomButtonComponent {\n\n  @Input() map: IgoMap;\n\n  @Input() color: string;\n\n  get zoom(): number { return this.map.viewController.getZoom(); }\n\n  get minZoom(): number { return this.map.viewController.olView.getMinZoom() || 1; }\n\n  get maxZoom(): number { return this.map.viewController.olView.getMaxZoom(); }\n\n  constructor() {}\n}\n","<div class=\"igo-zoom-button-container\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomIn' | translate: {zoom: zoom + 1}\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom >= maxZoom\"\n    (click)=\"map.viewController.zoomIn()\">\n    <mat-icon svgIcon=\"plus\"></mat-icon>\n  </button>\n\n  <button\n    mat-icon-button\n    [matTooltip]=\"'igo.geo.mapButtons.zoomOut' | translate: {zoom: zoom - 1}\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    [disabled]=\"zoom <= minZoom\"\n    (click)=\"map.viewController.zoomOut()\">\n    <mat-icon svgIcon=\"minus\"></mat-icon>\n  </button>\n</div>\n","<div class=\"igo-geolocate-button-container\" *ngIf=\"map.geolocationController\">\n  <button\n    mat-icon-button\n    [matTooltip]=\"map.geolocationController.tracking ? ('igo.geo.mapButtons.geolocateInactive' | translate) :('igo.geo.mapButtons.geolocate' | translate)\"\n    matTooltipPosition=\"left\"\n    [color]=\"color\"\n    (click)=\"onGeolocationClick()\">\n    <mat-icon svgIcon=\"{{icon$ | async}}\"></mat-icon>\n  </button>\n</div>\n","import { AfterContentInit, Component, Input, OnDestroy } from '@angular/core';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-geolocate-button',\n  templateUrl: './geolocate-button.component.html',\n  styleUrls: ['./geolocate-button.component.scss']\n})\nexport class GeolocateButtonComponent implements AfterContentInit, OnDestroy {\n\n  private tracking$$: Subscription;\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject('crosshairs-gps');\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get color(): string {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color: string;\n\n  constructor(private configService: ConfigService) {}\n  ngAfterContentInit(): void {\n    this.map.ol.once('rendercomplete', () => {\n      this.tracking$$ =this.map.geolocationController.tracking$.subscribe(tracking => {\n        if (tracking) {\n          this.icon$.next('crosshairs-gps');\n        } else {\n          this.configService.getConfig('geolocate.basic') ? this.icon$.next('crosshairs-gps') : this.icon$.next('crosshairs');\n        }\n      });\n    });\n  }\n\n  ngOnDestroy(): void {\n    if (this.tracking$$) {\n      this.tracking$$.unsubscribe();\n    }\n  }\n\n  onGeolocationClick() {\n    const tracking = this.map.geolocationController.tracking;\n    this.map.geolocationController.tracking = tracking ? false : true;\n  }\n}\n","import { ConfigService } from '@igo2/core';\r\nimport { Component, Input } from '@angular/core';\r\nimport { IgoMap } from '../shared/map';\r\nimport { MapExtent } from '../shared/map.interface';\r\nimport * as olproj from 'ol/proj';\r\n/*\r\nButton to center the map to the home extent\r\n*/\r\n@Component({\r\n  selector: 'igo-home-extent-button',\r\n  templateUrl:'./home-extent-button.component.html',\r\n  styleUrls: ['./home-extent-button.component.scss'],\r\n})\r\nexport class HomeExtentButtonComponent {\r\n  @Input() map: IgoMap;\r\n  @Input() color: string;\r\n  @Input() extentOverride?: MapExtent;\r\n  @Input() centerOverride?: [number, number];\r\n  @Input() zoomOverride?: number;\r\n\r\n  private homeExtentButtonExtent;\r\n  private homeExtentButtonCenter;\r\n  private homeExtentButtonZoom;\r\n\r\n constructor(public configService: ConfigService) {\r\n      this.computeHomeExtent();\r\n  }\r\n\r\n  computeHomeExtent() {\r\n    this.homeExtentButtonExtent = this.extentOverride || this.configService.getConfig('homeExtentButton.homeExtButtonExtent');\r\n    this.homeExtentButtonCenter = this.centerOverride || this.configService.getConfig('homeExtentButton.homeExtButtonCenter');\r\n    this.homeExtentButtonZoom = this.zoomOverride || this.configService.getConfig('homeExtentButton.homeExtButtonZoom');\r\n\r\n    // priority over extent if these 2 properties are defined;\r\n    if (this.centerOverride && this.zoomOverride) {\r\n      this.homeExtentButtonExtent = undefined;\r\n    }\r\n  }\r\n\r\n  onToggleClick() {\r\n    this.computeHomeExtent();\r\n    if (this.homeExtentButtonExtent) {\r\n      this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);\r\n    } else if (this.homeExtentButtonCenter && this.homeExtentButtonZoom) {\r\n      const center = olproj.fromLonLat(this.homeExtentButtonCenter, this.map.viewController.olView.getProjection().getCode());\r\n      this.map.viewController.olView.setCenter(center);\r\n      this.map.viewController.zoomTo(this.homeExtentButtonZoom);\r\n    }\r\n  }\r\n}\r\n","<div class=\"igo-home-extent-button-container\"><button\r\n    mat-icon-button\r\n    [matTooltip]=\"'igo.geo.mapButtons.home-extent' | translate\"\r\n            matTooltipPosition=\"left\"\r\n    [color]=\"color\"\r\n    (click)=\"onToggleClick()\"><mat-icon svgIcon = \"home-map-marker\"></mat-icon></button></div>\r\n","<div *ngIf=\"visible\" class=\"igo-wake-lock-button-container\">\n  <div>\n    <button \n      [color]=\"color\"\n      mat-icon-button\n      [matTooltip]=\"enabled ? ('igo.geo.mapButtons.preventSreenLock' | translate): ('igo.geo.mapButtons.letScreenLock' | translate)\"\n      matTooltipPosition=\"left\"\n      (click)=\"toggleWakeLock()\">\n      <mat-icon svgIcon=\"{{icon$ | async}}\"></mat-icon>\n    </button>\n  </div>\n</div>","import { Component, Input } from '@angular/core';\nimport { ConfigService, StorageService } from '@igo2/core';\nimport { BehaviorSubject } from 'rxjs';\nimport NoSleep from 'nosleep.js';\nimport { IgoMap } from '../shared/map';\nimport { userAgent } from '@igo2/utils';\n\n@Component({\n  selector: 'igo-wake-lock-button',\n  templateUrl: './wake-lock-button.component.html',\n  styleUrls: ['./wake-lock-button.component.scss']\n})\n\n/**\n * Prevent display sleep and enable wake lock in all Android and iOS web browsers.\n * On iOS, the Wake Lock API is not supported\n * https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API\n * On not supported browser, a fake video is used to keep the screen open.\n *\n * TODO: When the API will be supported by every browser, We should remove the NoSleep.js dependency\n * and replace it by a WakeLock API implementation.\n */\nexport class WakeLockButtonComponent {\n\n  @Input() color: string = 'primary';\n  @Input() map: IgoMap;\n  @Input()\n  get enabled(): boolean {\n    return this.storageService.get('wakeLockEnabled') as boolean;\n  }\n  set enabled(value: boolean) {\n    this.storageService.set('wakeLockEnabled', value);\n  }\n\n  private noSleep: NoSleep;\n  readonly icon$: BehaviorSubject<string> = new BehaviorSubject('sleep');\n  public visible = false;\n\n  constructor(\n    private config: ConfigService,\n    private storageService: StorageService\n  ) {\n    this.visible = this.config.getConfig('wakeLockApiButton') ? true : false;\n    this.noSleep = new NoSleep();\n    const nonWakeLockApiBrowser = userAgent.satisfies({\n      ie: '>0',\n      edge: '<84',\n      chrome: '<84',\n      firefox: '>0',\n      opera: '<70',\n      safari: '>0'\n    });\n    if (nonWakeLockApiBrowser) {\n      this.disableWakeLock();\n      this.enabled = false;\n      window.onblur = () => {\n        this.disableWakeLock();\n        this.enabled = false;\n    };\n    }\n    this.enabled ? this.enableWakeLock() : this.disableWakeLock();\n  }\n\n  /**\n   * Prevent display sleep and enable wake lock in all Android and iOS web browsers.\n   * On iOS, the Wake Lock API is not supported\n   * https://developer.mozilla.org/en-US/docs/Web/API/Screen_Wake_Lock_API\n   * On not supported browser, a fake video is used to keep the screen open.\n   */\n  private enableWakeLock() {\n    this.noSleep.enable();\n    this.enabled = true;\n    this.icon$.next('sleep-off');\n  }\n  /**\n   * Let display sleep\n   */\n  private disableWakeLock() {\n    this.noSleep.disable();\n    this.enabled = false;\n    this.icon$.next('sleep');\n  }\n\n  toggleWakeLock() {\n    if (this.enabled) {\n      this.disableWakeLock();\n    } else {\n      this.enableWakeLock();\n    }\n  }\n}\n","<div *ngIf=\"baseLayers.length > 0\"\n     class=\"igo-baselayers-switcher-container\"\n     [ngClass]=\"{'container-expand': expand}\"\n     [@baseLayerSwitcherState]=\"expand ? 'expand' : useStaticIcon ? 'collapseIcon' : 'collapseMap'\"\n     (@baseLayerSwitcherState.start)=\"showButton=false\"\n     (@baseLayerSwitcherState.done)=\"showButton=true\"\n     (click)=\"collapseOrExpand()\">\n\n     <div *ngIf=\"useStaticIcon && !expand && showButton\" class=\"igo-baselayers-switcher-button-container\">\n       <button\n         mat-icon-button\n         [matTooltip]=\"'igo.geo.mapButtons.baselayerSwitcher' | translate\"\n         matTooltipPosition=\"right\"\n         color=\"primary\">\n         <mat-icon svgIcon=\"image-multiple\"></mat-icon>\n       </button>\n     </div>\n\n     <igo-mini-basemap class=\"mat-typography\" *ngFor=\"let baseLayer of baseLayers; let i = index\"\n       [map]=\"map\"\n       [baseLayer]=\"baseLayer\"\n       [title]=\"(baseLayers.length > 2 && !expand) ? ('igo.geo.baselayersSwitcher.title' | translate) : baseLayer.title\"\n       [display]=\"expand || (i === 0 && !useStaticIcon)\"\n       [disabled]=\"!expand && baseLayers.length > 1\">\n     </igo-mini-basemap>\n\n    <div class=\"more-baselayers\">\n      <mat-icon class=\"material-icons mat-icon mat-list-avatar\" color=\"primary\" svgIcon=\"menu-down\"></mat-icon>\n    </div>\n\n</div>\n","import { Component, Input, AfterViewInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport { MediaService, Media } from '@igo2/core';\nimport { Layer } from '../../layer';\nimport { IgoMap } from '../shared';\nimport { baseLayersSwitcherSlideInOut } from './baselayers-switcher.animation';\n\n@Component({\n  selector: 'igo-baselayers-switcher',\n  templateUrl: './baselayers-switcher.component.html',\n  styleUrls: ['./baselayers-switcher.component.scss'],\n  animations: [baseLayersSwitcherSlideInOut()]\n})\nexport class BaseLayersSwitcherComponent implements AfterViewInit, OnDestroy {\n  @Input() map: IgoMap;\n  @Input() useStaticIcon: boolean;\n\n  public _baseLayers: Layer[] = [];\n  public expand = false;\n  public showButton = true;\n\n  private layers$$: Subscription;\n\n  constructor(private mediaService: MediaService) {\n    const media = this.mediaService.media$.value;\n    if (media === Media.Mobile && this.useStaticIcon === undefined) {\n      this.useStaticIcon = true;\n    }\n  }\n\n  ngAfterViewInit() {\n    this.layers$$ = this.map.layers$.subscribe(arrayLayers => {\n      this._baseLayers = arrayLayers.filter(l => l.baseLayer);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n  }\n\n  collapseOrExpand() {\n    if (this.baseLayers.length > 1 || this.useStaticIcon) {\n      this.expand = !this.expand;\n    } else {\n      this.expand = false;\n    }\n  }\n\n  get baseLayers(): Layer[] {\n    const mapResolution = this.map.viewController.getResolution();\n    const mapZoom = this.map.viewController.getZoom();\n\n    const bl = this._baseLayers.filter(l => {\n      return (\n        (!l.options.maxResolution ||\n          mapResolution <= l.options.maxResolution) &&\n        (!l.options.minResolution || mapResolution >= l.options.minResolution) &&\n        (!l.options.source.options.maxZoom || mapZoom <= l.options.source.options.maxZoom) &&\n        (!l.options.source.options.minZoom || mapZoom >= l.options.source.options.minZoom)\n      );\n    });\n\n    const blHidden = bl.filter(l => !l.visible);\n    return blHidden.length + 1 === bl.length ? blHidden : bl;\n  }\n}\n","import {\n  trigger,\n  state,\n  style,\n  transition,\n  animate,\n  AnimationTriggerMetadata\n} from '@angular/animations';\n\nexport function baseLayersSwitcherSlideInOut(): AnimationTriggerMetadata {\n  return trigger('baseLayerSwitcherState', [\n    state(\n      'collapseIcon',\n      style({\n        height: '40px',\n        width: '40px',\n        overflow: 'hidden'\n      })\n    ),\n    state(\n      'collapseMap',\n      style({\n        height: '85px',\n        overflow: 'hidden'\n      })\n    ),\n    state(\n      'expand',\n      style({\n        overflow: 'hidden'\n      })\n    ),\n    transition('collapse => expand', animate('200ms')),\n    transition('expand => collapse', animate('200ms'))\n  ]);\n}\n","import { Injectable } from '@angular/core';\nimport { DBMode, NgxIndexedDBService } from 'ngx-indexed-db';\nimport { Observable, of, Subject } from 'rxjs';\nimport { concatMap, first, map, take } from 'rxjs/operators';\nimport { CompressionService } from '@igo2/core';\nimport { GeoDBData } from './geoDB.interface';\nimport { InsertSourceInsertDBEnum } from './geoDB.enums';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class GeoDBService {\n  readonly dbName: string = 'geoData';\n  public collisionsMap: Map<number, string[]> = new Map();\n  public _newData: number = 0;\n\n  constructor(\n    private ngxIndexedDBService: NgxIndexedDBService,\n    private compression: CompressionService\n  ) { }\n\n  /**\n   * Only blob can be will be compressed\n   * @param url\n   * @param regionID\n   * @param object object to handle\n   * @param insertSource type of event user or system\n   * @param insertEvent Name of the event where the insert has been triggered\n   * @returns\n   */\n  update(url: string, regionID: any, object: any, insertSource: InsertSourceInsertDBEnum, insertEvent: string): Observable<any> {\n    if (!object) {\n      return;\n    }\n    let compress = false;\n\n    const subject: Subject<GeoDBData> = new Subject();\n    let object$: Observable<any> = of(object);\n    if (object instanceof Blob) {\n      object$ = this.compression.compressBlob(object);\n      compress = true;\n    }\n    let geoDBData: GeoDBData;\n    object$.pipe(\n      first(),\n      concatMap(object => {\n        geoDBData = {\n          url,\n          regionID,\n          object: object,\n          compressed: compress,\n          insertSource,\n          insertEvent\n        };\n        return this.ngxIndexedDBService.getByID(this.dbName, url);\n      }),\n      concatMap((dbObject: GeoDBData) => {\n        if (!dbObject) {\n          this._newData++;\n          return this.ngxIndexedDBService.add(this.dbName, geoDBData);\n        } else {\n          const currentRegionID = dbObject.regionID;\n          if (currentRegionID !== regionID) {\n            const collisions = this.collisionsMap.get(currentRegionID);\n            if (collisions !== undefined) {\n              collisions.push(dbObject.url);\n              this.collisionsMap.set(currentRegionID, collisions);\n            } else {\n              this.collisionsMap.set(currentRegionID, [dbObject.url]);\n            }\n          }\n          return this.customUpdate(geoDBData);\n        }\n      })\n    ).subscribe((response) => {\n      subject.next(response);\n      subject.complete();\n    });\n    return subject;\n  }\n\n  private customUpdate(geoDBData: GeoDBData): Observable<GeoDBData> {\n    const subject: Subject<GeoDBData> = new Subject();\n    const deleteRequest = this.ngxIndexedDBService.deleteByKey(this.dbName, geoDBData.url);\n    deleteRequest.pipe(\n      concatMap(isDeleted => isDeleted ? this.ngxIndexedDBService.add(this.dbName, geoDBData) : of(undefined))\n    )\n    .subscribe(object => {\n      if (object) {\n        subject.next(object);\n      }\n      subject.complete();\n    });\n    return subject;\n  }\n\n  get(url: string): Observable<any> {\n    return this.ngxIndexedDBService.getByID(this.dbName, url).pipe(\n      map((data: GeoDBData) => {\n        if (data) {\n          const object = data.object;\n          if (!data.compressed) {\n            return object;\n          }\n          return this.compression.decompressBlob(object);\n        }\n      })\n    );\n  }\n\n  getByID(url: string): Observable<any> {\n    return this.ngxIndexedDBService.getByID(this.dbName, url);\n  }\n\n  deleteByKey(url: string): Observable<any> {\n    return this.ngxIndexedDBService.deleteByKey(this.dbName, url);\n  }\n\n  getRegionCountByID(id: number): Observable<number> {\n    const subject: Subject<number> = new Subject();\n    const dbRequest = this.getRegionByID(id)\n      .subscribe((datas) => {\n        subject.next(datas.length);\n        subject.complete();\n      });\n    return subject;\n  }\n\n  getRegionByID(id: number): Observable<any[]> {\n    if (!id) {\n      return;\n    }\n\n    const IDBKey: IDBKeyRange = IDBKeyRange.only(id);\n    const dbRequest = this.ngxIndexedDBService.getAllByIndex(this.dbName, 'regionID', IDBKey);\n    return dbRequest;\n  }\n\n  deleteByRegionID(id: number): Observable<any> {\n    if (!id) {\n      return;\n    }\n\n    const IDBKey: IDBKeyRange = IDBKeyRange.only(id);\n    const dbRequest = this.ngxIndexedDBService.getAllByIndex(this.dbName, 'regionID', IDBKey);\n    dbRequest.subscribe((datas: GeoDBData[]) => {\n      datas.forEach((data) => {\n        this.ngxIndexedDBService.deleteByKey(this.dbName, data.url);\n      });\n    });\n    return dbRequest;\n  }\n\n  openCursor(\n    keyRange: IDBKeyRange = IDBKeyRange.lowerBound(0),\n    mode: DBMode = DBMode.readonly\n  ) {\n    const request = this.ngxIndexedDBService.openCursorByIndex(this.dbName, 'regionID', keyRange, mode);\n    return request;\n  }\n\n  resetCounters() {\n    this.resetCollisionsMap();\n    this._newData = 0;\n  }\n\n  resetCollisionsMap() {\n    this.collisionsMap = new Map();\n  }\n\n  revertCollisions() {\n    for (const [regionID, collisions] of this.collisionsMap) {\n      for (const url of collisions) {\n        this.ngxIndexedDBService.getByKey(this.dbName, url)\n          .pipe(take(1))\n          .subscribe((dbObject: GeoDBData) => {\n            const updatedObject = dbObject;\n            updatedObject.regionID = regionID;\n            this.customUpdate(dbObject);\n          });\n      }\n    }\n  }\n\n  get newData(): number {\n    return this._newData;\n  }\n}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { ConnectionState, NetworkService } from '@igo2/core';\nimport { Observable } from 'rxjs';\nimport { GeoDBService } from '../geoDB/geoDB.service';\n\nexport enum ResponseType {\n  Arraybuffer= 'arraybuffer',\n  Blob= 'blob',\n  Text= 'text',\n  Json= 'json',\n}\nexport interface SimpleGetOptions {\n  responseType: ResponseType;\n  withCredentials?: boolean;\n}\n@Injectable({\n  providedIn: 'root'\n})\nexport class GeoNetworkService {\n  private networkOnline: boolean = true;\n  constructor(\n    private http: HttpClient,\n    public geoDBService: GeoDBService,\n    private networkService: NetworkService,\n  ) {\n    this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.networkOnline = state.connection;\n    });\n  }\n\n  get(url: string, simpleGetOptions: SimpleGetOptions): Observable<any> {\n    if (window.navigator.onLine && this.networkOnline) {\n      return this.getOnline(url, simpleGetOptions);\n    }\n    return this.getOffline(url);\n  }\n\n  private getOnline(url: string, simpleGetOptions: SimpleGetOptions): Observable<any> {\n    let request;\n    switch (simpleGetOptions.responseType) {\n      // TODO Ajuster pour autre formats\n      case 'arraybuffer':\n        request = this.http.get(url, { responseType: 'arraybuffer', withCredentials: simpleGetOptions.withCredentials });\n        break;\n      case 'blob':\n        request = this.http.get(url, { responseType: 'blob', withCredentials: simpleGetOptions.withCredentials });\n        break;\n      case 'text':\n        request = this.http.get(url, { responseType: 'text', withCredentials: simpleGetOptions.withCredentials });\n          break;\n      case 'json':\n        request = this.http.get(url, { responseType: 'json', withCredentials: simpleGetOptions.withCredentials });\n        break;\n      default:\n        request = this.http.get(url, { responseType: 'blob', withCredentials: simpleGetOptions.withCredentials });\n        break;\n    }\n    return request;\n  }\n\n  private getOffline(url: string): Observable<any> {\n    return this.geoDBService.get(url);\n  }\n\n  public isOnline() {\n    return this.networkOnline && window.navigator.onLine;\n  }\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, of } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\nimport {stylefunction} from \"ol-mapbox-style\";\nimport { AuthInterceptor } from '@igo2/auth';\nimport { ObjectUtils } from '@igo2/utils';\nimport olLayerVectorTile from 'ol/layer/VectorTile';\n\nimport { Style } from 'ol/style';\n\nimport {\n  OSMDataSource,\n  FeatureDataSource,\n  XYZDataSource,\n  TileDebugDataSource,\n  WFSDataSource,\n  WMTSDataSource,\n  WMSDataSource,\n  CartoDataSource,\n  ImageArcGISRestDataSource,\n  ArcGISRestDataSource,\n  TileArcGISRestDataSource,\n  WebSocketDataSource,\n  MVTDataSource,\n  ClusterDataSource\n} from '../../datasource';\n\nimport { DataSourceService } from '../../datasource/shared/datasource.service';\n\nimport {\n  Layer,\n  ImageLayer,\n  ImageLayerOptions,\n  TileLayer,\n  TileLayerOptions,\n  VectorLayer,\n  VectorLayerOptions,\n  AnyLayerOptions,\n  VectorTileLayer,\n  VectorTileLayerOptions\n} from './layers';\n\nimport { computeMVTOptionsOnHover } from '../utils/layer.utils';\nimport { StyleService } from './style.service';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { GeoNetworkService } from '../../offline/shared/geo-network.service';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerService {\n  constructor(\n    private http: HttpClient,\n    private styleService: StyleService,\n    private dataSourceService: DataSourceService,\n    private geoNetwork: GeoNetworkService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    @Optional() private authInterceptor: AuthInterceptor\n  ) {}\n\n  createLayer(layerOptions: AnyLayerOptions): Layer {\n    if (!layerOptions.source) {\n      return;\n    }\n\n    if (\n      layerOptions.source.options &&\n      layerOptions.source.options._layerOptionsFromSource\n    ) {\n      layerOptions = ObjectUtils.mergeDeep(\n        layerOptions.source.options._layerOptionsFromSource,\n        layerOptions || {}\n      );\n    }\n\n    let layer;\n    switch (layerOptions.source.constructor) {\n      case OSMDataSource:\n      case WMTSDataSource:\n      case XYZDataSource:\n      case TileDebugDataSource:\n      case CartoDataSource:\n      case TileArcGISRestDataSource:\n        layer = this.createTileLayer(layerOptions as TileLayerOptions);\n        break;\n      case FeatureDataSource:\n      case WFSDataSource:\n      case ArcGISRestDataSource:\n      case WebSocketDataSource:\n      case ClusterDataSource:\n        layer = this.createVectorLayer(layerOptions as VectorLayerOptions);\n        break;\n      case ImageArcGISRestDataSource:\n      case WMSDataSource:\n        layer = this.createImageLayer(layerOptions as ImageLayerOptions);\n        break;\n      case MVTDataSource:\n        const _layerOptions = computeMVTOptionsOnHover(layerOptions);\n        layer = this.createVectorTileLayer(\n          _layerOptions as VectorTileLayerOptions\n        );\n        break;\n      default:\n        break;\n    }\n\n    return layer;\n  }\n\n  createAsyncLayer(_layerOptions: AnyLayerOptions, detailedContextUri?: string): Observable<Layer> {\n    const layerOptions = computeMVTOptionsOnHover(_layerOptions);\n    if (layerOptions.source) {\n      return new Observable(d => d.next(this.createLayer(layerOptions)));\n    }\n\n    return this.dataSourceService\n      .createAsyncDataSource(layerOptions.sourceOptions, detailedContextUri)\n      .pipe(\n        map(source => {\n          if (source === undefined) {\n            return undefined;\n          }\n          return this.createLayer(Object.assign(layerOptions, { source }));\n        })\n      );\n  }\n\n  private createImageLayer(layerOptions: ImageLayerOptions): ImageLayer {\n    return new ImageLayer(layerOptions, this.messageService, this.languageService, this.authInterceptor);\n  }\n\n  private createTileLayer(layerOptions: TileLayerOptions): TileLayer {\n    return new TileLayer(layerOptions, this.messageService, this.authInterceptor);\n  }\n\n  private createVectorLayer(layerOptions: VectorLayerOptions): VectorLayer {\n    let style: Style[] | Style | OlStyleLike;\n    let igoLayer: VectorLayer;\n    if (layerOptions.style !== undefined) {\n      style = (feature, resolution) => this.styleService.createStyle(layerOptions.style, feature, resolution);\n    }\n\n    if (layerOptions.source instanceof ArcGISRestDataSource) {\n      const source = layerOptions.source as ArcGISRestDataSource;\n      style = source.options.params.style;\n    } else if (layerOptions.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.styleByAttribute,\n          resolution\n        );\n      };\n      igoLayer = new VectorLayer(layerOptions, this.messageService, this.authInterceptor, this.geoNetwork);\n    }\n\n    if (layerOptions.source instanceof ClusterDataSource) {\n      const serviceStyle = this.styleService;\n      const baseStyle = layerOptions.clusterBaseStyle;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createClusterStyle(\n          feature,\n          resolution,\n          layerOptions.clusterParam,\n          baseStyle\n        );\n      };\n      igoLayer = new VectorLayer(layerOptions, this.messageService, this.authInterceptor, this.geoNetwork);\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!igoLayer) {\n      igoLayer = new VectorLayer(layerOptionsOl, this.messageService, this.authInterceptor, this.geoNetwork);\n    }\n\n    this.applyMapboxStyle(igoLayer, layerOptionsOl as any);\n\n    return igoLayer;\n  }\n\n  private createVectorTileLayer(\n    layerOptions: VectorTileLayerOptions\n  ): VectorTileLayer {\n    let style: Style[] | Style | OlStyleLike;\n    let igoLayer: VectorTileLayer;\n\n    if (layerOptions.style !== undefined) {\n      style = (feature, resolution) => this.styleService.createStyle(layerOptions.style, feature, resolution);\n    }\n\n    if (layerOptions.styleByAttribute) {\n      const serviceStyle = this.styleService;\n      layerOptions.style = (feature, resolution) => {\n        return serviceStyle.createStyleByAttribute(\n          feature,\n          layerOptions.styleByAttribute,\n          resolution\n        );\n      };\n      igoLayer = new VectorTileLayer(layerOptions, this.messageService, this.authInterceptor);\n    }\n\n    const layerOptionsOl = Object.assign({}, layerOptions, {\n      style\n    });\n\n    if (!igoLayer) {\n      igoLayer = new VectorTileLayer(layerOptionsOl, this.messageService, this.authInterceptor);\n    }\n\n    this.applyMapboxStyle(igoLayer, layerOptionsOl);\n    return igoLayer;\n  }\n\n  private applyMapboxStyle(layer: Layer, layerOptions: VectorTileLayerOptions) {\n    if (layerOptions.mapboxStyle) {\n      this.getStuff(layerOptions.mapboxStyle.url).subscribe(res => {\n        if (res.sprite){\n          const url = this.getAbsoluteUrl(layerOptions.mapboxStyle.url, res.sprite);\n          this.getStuff(url+'.json').subscribe(res2 => {\n            stylefunction(layer.ol as olLayerVectorTile, res, layerOptions.mapboxStyle.source, undefined, res2,\n              url+'.png');\n          });\n        } else {\n          stylefunction(layer.ol as olLayerVectorTile, res, layerOptions.mapboxStyle.source);\n        }\n      });\n    }\n  }\n\n  private getStuff(url: string) {\n    return this.http.get(url).pipe(\n      map((res: any) => res),\n      catchError(err => {\n        console.log('No style was found');\n        return of(err);\n      })\n    );\n  }\n\n  private getAbsoluteUrl(source, url) {\n    const r = new RegExp('^http|\\/\\/', 'i');\n    if(r.test(url)){\n      return url;\n    } else {\n      if ( source.substr(source.length -1) === \"/\"){\n        return source + url;\n      } else{\n        return source + \"/\" + url;\n      }\n    }\n  }\n\n}\n","<div class=\"igo-mini-basemap-container\">\n\n  <div *ngIf=\"display\" (click)=\"changeBaseLayer(baseLayer)\">\n    <igo-map-browser [map]=\"basemap\"></igo-map-browser>\n    <div *ngIf='title' class='igo-mini-basemap-title'> {{title}} </div>\n  </div>\n\n</div>\n","import {\n  Component,\n  Input,\n  AfterViewInit,\n  OnDestroy,\n  ApplicationRef,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { Layer, LayerOptions } from '../../layer/shared';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { IgoMap } from '../shared';\n\nimport OlMap from 'ol/Map';\nimport OlView from 'ol/View';\n\n@Component({\n  selector: 'igo-mini-basemap',\n  templateUrl: './mini-basemap.component.html',\n  styleUrls: ['./mini-basemap.component.scss']\n})\nexport class MiniBaseMapComponent implements AfterViewInit, OnDestroy {\n\n  @Input() map: IgoMap;\n  @Input() disabled: boolean;\n  @Input() title: string;\n\n  @Input()\n  get display(): boolean {\n    return this._display;\n  }\n  set display(value: boolean) {\n    this._display = value;\n    this.cdRef.detectChanges();\n    this.basemap.ol.getView().changed();\n  }\n  private _display: boolean;\n\n  @Input()\n  get baseLayer(): Layer {\n    return this._baseLayer;\n  }\n  set baseLayer(value: Layer) {\n    this._baseLayer = value;\n    this.handleBaseLayerChanged(value);\n  }\n  private _baseLayer: Layer;\n\n  public basemap = new IgoMap({\n    controls: {},\n    interactions: false\n  });\n\n  constructor(\n    private layerService: LayerService,\n    private appRef: ApplicationRef,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  ngAfterViewInit() {\n    this.handleMainMapViewChange(this.map.ol.getView());\n    this.map.viewController.olView.on('change', change => {\n      this.handleMainMapViewChange((change.target as OlView));\n    });\n    this.map.ol.on('pointerdrag', change => {\n      this.handleMainMapViewChange((change.target as OlMap).getView());\n    });\n  }\n\n  ngOnDestroy() {\n    this.map.viewController.olView.un('change', change => {\n      this.handleMainMapViewChange((change.target as OlView));\n    });\n    this.map.ol.un('pointerdrag', change => {\n      this.handleMainMapViewChange((change.target as OlMap).getView());\n    });\n  }\n\n  changeBaseLayer(baseLayer: Layer) {\n    if (this.disabled) {\n      return;\n    }\n    this.map.changeBaseLayer(baseLayer);\n    this.appRef.tick();\n  }\n\n  private handleMainMapViewChange(mainMapView) {\n    const mainMapViewProperties = mainMapView.getProperties();\n    this.basemap.viewController.olView.setResolution(mainMapViewProperties.resolution);\n    this.basemap.viewController.olView.setRotation(mainMapViewProperties.rotation);\n    this.basemap.viewController.olView.setCenter(this.map.viewController.getCenter());\n  }\n\n  private handleBaseLayerChanged(baselayer: Layer) {\n    this.basemap.removeAllLayers();\n\n    const options: any = Object.assign(\n      Object.create(baselayer.options),\n      baselayer.options,\n      {\n        visible: true,\n        baseLayer: false\n      }\n    );\n\n    const layer = this.layerService.createLayer(options);\n    this.basemap.addLayer(layer);\n    this.handleLinkedBaseLayer(layer);\n  }\n\n  private handleLinkedBaseLayer(baselayer: Layer) {\n    const linkedLayers = baselayer.options.linkedLayers;\n    if (!linkedLayers) {\n      return;\n    }\n    const currentLinkedId = linkedLayers.linkId;\n    const currentLinks = linkedLayers.links;\n    const isParentLayer = currentLinks ? true : false;\n    if (isParentLayer && currentLinkedId === baselayer.options.linkedLayers.linkId) {\n      // search for child layers\n      currentLinks.map(link => {\n        link.linkedIds.map(linkedId => {\n          const layerToApply = this.map.layers.find(l => l.options.linkedLayers?.linkId === linkedId);\n          if (layerToApply) {\n            const linkedLayerOptions: any = Object.assign(\n              Object.create(layerToApply.options),\n              layerToApply.options,\n              {\n                zIndex: 9000,\n                visible: true,\n                baseLayer: false,\n              } as LayerOptions\n            );\n            this.basemap.addLayer(this.layerService.createLayer(linkedLayerOptions));\n          }\n        });\n      });\n    }\n  }\n}\n","<div *ngIf=\"((rotated$ | async) && !showIfNoRotation) || showIfNoRotation\" class=\"igo-rotation-button-container\"\n  [matTooltip]=\"(rotated$ | async) ? ('igo.geo.mapButtons.resetRotation' | translate: {azimuth: azimuthRounded, rotation: rotationRounded}): ('igo.geo.mapButtons.tipRotation' | translate)\"\n  matTooltipPosition=\"left\">\n  <button mat-icon-button matTooltipPosition=\"left\" [color]=\"color\" [disabled]=\"(rotated$ | async) === false\"\n    (click)=\"map.viewController.resetRotation()\">\n    <mat-icon [ngStyle]=\"currentStyle$ | async\" svgIcon=\"navigation\">\n    </mat-icon>\n  </button>\n</div>\n","import { AfterContentInit, Component, Input } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { bearingToAzimuth } from '@turf/helpers';\n\nimport { IgoMap } from '../shared/map';\n\n@Component({\n  selector: 'igo-rotation-button',\n  templateUrl: './rotation-button.component.html',\n  styleUrls: ['./rotation-button.component.scss']\n})\nexport class RotationButtonComponent implements AfterContentInit {\n  readonly rotated$ = new BehaviorSubject<boolean>(false);\n  public azimuthRounded: number = 0;\n  public rotationRounded: number = 0;\n  readonly currentStyle$ = new BehaviorSubject<{}>({\n    transform: 'rotate(0rad)'\n  });\n\n  @Input() map: IgoMap;\n  @Input() showIfNoRotation: boolean;\n  @Input() color: string;\n\n  constructor() { }\n\n  ngAfterContentInit() {\n    this.map.viewController.rotation$.subscribe(r => {\n      const radians = r || 0;\n      const deg = radians * 180 / Math.PI;\n      this.rotationRounded = Math.round(deg);\n      this.azimuthRounded = Math.round(bearingToAzimuth(deg * -1));\n      this.currentStyle$.next({\n        transform: 'rotate(' + radians + 'rad)'\n      });\n      this.rotated$.next(radians !== 0);\n    }\n    );\n  }\n}\n","<div *ngIf=\"infoContent && infoContent.length\" class=\"infoSection\">\n    <pre>{{infoContent}}</pre>\n</div>","import { Component, Input } from '@angular/core';\n\n@Component({\n  selector: 'igo-info-section',\n  templateUrl: './info-section.component.html',\n  styleUrls: ['./info-section.component.scss']\n})\nexport class InfoSectionComponent {\n\n  @Input() infoContent: string = '';\n\n  constructor() {}\n\n}\n","export enum CatalogItemType {\n  Layer = 'layer',\n  Group = 'group'\n}\n\nexport enum TypeCatalog {\n  wms, wmts, baselayers, arcgisrest, tilearcgisrest, imagearcgisrest, composite\n}\n\nexport type TypeCatalogStrings = keyof typeof TypeCatalog;\n","import { Observable } from 'rxjs';\n\nimport { TooltipType } from '../../layer';\nimport { TimeFilterOptions } from '../../filter';\nimport { QueryFormat, QueryHtmlTarget } from '../../query';\n\nimport { ICatalog, ICompositeCatalog , CatalogItem, CatalogItemGroup } from './catalog.interface';\nimport { CatalogService } from './catalog.service';\nimport { TypeCatalog, TypeCatalogStrings } from './catalog.enum';\n\nexport abstract class Catalog implements ICatalog {\n\n    // ICatalog -----------------------------\n    id: string;\n    title: string;\n    url: string;\n    removable?: boolean;\n    externalProvider?: boolean;\n    abstract?: string;\n    forcedProperties?: any[];\n    items?: CatalogItem[];\n    type?: TypeCatalogStrings;\n    version?: string;\n    matrixSet?: string;\n    requestEncoding?: string;\n    regFilters?: string[];\n    groupImpose?: CatalogItemGroup;\n    groupSeparator?: string;\n    timeFilter?: TimeFilterOptions;\n    queryFormat?: QueryFormat;\n    queryHtmlTarget?: QueryHtmlTarget;\n    queryParams?: { [key: string]: string; };\n    sourceOptions?: { [key: string]: any; };\n    count?: number;\n    tooltipType?: TooltipType.ABSTRACT | TooltipType.TITLE;\n    sortDirection?: 'asc' | 'desc';\n    setCrossOriginAnonymous?: boolean;\n    showLegend?: boolean;\n    profils?: string[];\n    // ICatalog -----------------------------\n\n    protected catalogService: CatalogService;\n\n    constructor(options: Catalog, service: CatalogService) {\n        Object.assign(this, options);\n        this.catalogService = service;\n    }\n\n    public abstract collectCatalogItems(): Observable<CatalogItem[]>;\n}\n\nclass WMSCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.wms];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogWMSLayerItems(this);\n    }\n}\n\nclass WMTSCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.wmts];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogWMTSLayerItems(this);\n    }\n}\n\nclass BaselayersCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.baselayers];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems(): Observable<CatalogItemGroup[]> {\n        return this.catalogService.loadCatalogBaseLayerItems(this);\n    }\n}\n\nclass ArcGISRestCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.arcgisrest];\n        this.type = TypeCatalog[sType];\n    }\n\n    public collectCatalogItems() {\n        return this.catalogService.loadCatalogArcGISRestItems(this);\n    }\n}\n\nclass TileOrImageArcGISRestCatalog extends Catalog {\n    constructor(options: Catalog, service: CatalogService, typeCatalog: TypeCatalog) {\n        super(options, service);\n        this.type = TypeCatalog[TypeCatalog[typeCatalog]];\n    }\n\n    public collectCatalogItems() {\n        return this.catalogService.loadCatalogArcGISRestItems(this);\n    }\n}\n\nexport class CompositeCatalog extends Catalog implements ICompositeCatalog {\n    composite: ICatalog[];\n\n    constructor(options: Catalog, service: CatalogService) {\n        super(options, service);\n        const sType: string = TypeCatalog[TypeCatalog.composite];\n        this.type = TypeCatalog[sType];\n        this.url = null;\n    }\n\n    public collectCatalogItems(): Observable<CatalogItem[]> {\n        return this.catalogService.loadCatalogCompositeLayerItems(this);\n    }\n}\n\nexport class CatalogFactory {\n\n    public static createInstanceCatalog(options: Catalog, service: CatalogService): Catalog {\n\n        let catalog: Catalog;\n        if (options.hasOwnProperty('composite')) {\n            catalog = new CompositeCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.baselayers]) {\n            catalog = new BaselayersCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.arcgisrest]) {\n            catalog = new ArcGISRestCatalog(options, service);\n        } else if (options.type === TypeCatalog[TypeCatalog.tilearcgisrest]) {\n            catalog = new TileOrImageArcGISRestCatalog(options, service, TypeCatalog.tilearcgisrest);\n        } else if (options.type === TypeCatalog[TypeCatalog.imagearcgisrest]) {\n            catalog = new TileOrImageArcGISRestCatalog(options, service, TypeCatalog.imagearcgisrest);\n        } else if (options.type === TypeCatalog[TypeCatalog.wmts]) {\n            catalog = new WMTSCatalog(options, service);\n        } else {\n            catalog = new WMSCatalog(options, service);\n        }\n\n        return catalog;\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, of } from 'rxjs';\nimport { map, mergeMap } from 'rxjs/operators';\n\nimport { default as striptags } from 'striptags';\n\nimport * as olformat from 'ol/format';\nimport * as olextent from 'ol/extent';\nimport olFormatGML2 from 'ol/format/GML2';\nimport olFormatGML3 from 'ol/format/GML3';\nimport olFormatEsriJSON from 'ol/format/EsriJSON';\nimport olFeature from 'ol/Feature';\nimport * as olgeom from 'ol/geom';\n\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { uuid } from '@igo2/utils';\nimport { Feature, FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport {\n  WMSDataSource,\n  CartoDataSource,\n  TileArcGISRestDataSource,\n  WMSDataSourceOptions,\n  ImageArcGISRestDataSource\n} from '../../datasource';\n\nimport {\n  QueryFormat,\n  QueryFormatMimeType,\n  QueryHtmlTarget\n} from './query.enums';\nimport {\n  QueryOptions,\n  QueryableDataSource,\n  QueryableDataSourceOptions,\n  QueryUrlData\n} from './query.interfaces';\nimport { MapExtent } from '../../map/shared/map.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class QueryService {\n  public queryEnabled = true;\n  public defaultFeatureCount = 20; // default feature count\n  public featureCount = 20; // feature count\n\n  private previousMessageIds = [];\n\n  constructor(\n    private http: HttpClient,\n    private messageService: MessageService,\n    private languageService: LanguageService) {}\n\n  query(layers: Layer[], options: QueryOptions): Observable<Feature[]>[] {\n    if (this.previousMessageIds.length) {\n      this.previousMessageIds.forEach(id => {\n        this.messageService.remove(id);\n      });\n    }\n\n    const newLayers = layers.filter((layer: Layer) => layer.visible && layer.isInResolutionsRange)\n    .map((layer: Layer) => this.queryLayer(layer, options));\n    // the directive accept array in this format [observable, observable...]\n    // if we use multiple 'url' in queryUrl so the result => this form [observable, observable, [observable, observable]]\n    // so we need to flat the array\n    let flatArray = [].concat.apply([], newLayers);\n    return flatArray;\n  }\n\n  queryLayer(layer: Layer, options: QueryOptions): Observable<Feature[]> | Observable<Feature[]>[] {\n    const url = this.getQueryUrl(layer.dataSource, options, false, layer.map.viewController.getExtent());\n    if (!url) {\n      return of([]);\n    }\n\n    const resolution: number = layer.map.viewController.getResolution();\n    const scale: number = layer.map.viewController.getScale();\n\n    if ((layer.dataSource as QueryableDataSource).options.queryFormat === QueryFormat.HTMLGML2) {\n      if (typeof url === 'string') {\n        const urlGml = this.getQueryUrl(layer.dataSource, options, true) as string;\n        return this.http.get(urlGml, { responseType: 'text' }).pipe(\n          mergeMap(gmlRes => {\n            const mergedGML = this.mergeGML(gmlRes, url, layer);\n            const imposedGeom = mergedGML[0];\n            const imposedProperties = mergedGML[1];\n            return this.http\n              .get(url, { responseType: 'text' })\n              .pipe(\n                map(res =>\n                  this.extractData(res, layer, options, url, imposedGeom, imposedProperties)\n                )\n              );\n          })\n        );\n      }\n      const urlGmls = this.getQueryUrl(layer.dataSource, options, true);\n      let observables: any = [];\n      for (let i = 0; i < urlGmls.length; i++) {\n        const element = urlGmls[i] as QueryUrlData;\n        if (this.checkScaleAndResolution(resolution, scale, element)) {\n          observables.push(this.requestDataForHTMLGML2(element.url, url[i].url, layer, options));\n        }\n      }\n      return observables;\n    } else {\n      if (typeof url === 'string') {\n        const request = this.http.get(url, { responseType: 'text' });\n        return request.pipe(map(res => this.extractData(res, layer, options, url)));\n      }\n      let observables: any = [];\n      for (let i = 0; i < url.length; i++) {\n        const element: QueryUrlData = url[i];\n        if (this.checkScaleAndResolution(resolution, scale, element)) {\n          const request = this.http.get(element.url, { responseType: 'text' });\n          observables.push(request.pipe(map(res => this.extractData(res, layer, options, element.url))));\n        }\n      }\n      return observables;\n    }\n  }\n\n  private requestDataForHTMLGML2(urlGml: string, url: string ,layer: Layer, options: QueryOptions): Observable<Feature[]> {\n    return this.http.get(urlGml, { responseType: 'text' }).pipe(\n      mergeMap(gmlRes => {\n        const mergedGML = this.mergeGML(gmlRes, url, layer);\n        const imposedGeom = mergedGML[0];\n        const imposedProperties = mergedGML[1];\n        return this.http\n          .get(url, { responseType: 'text' })\n          .pipe(\n            map(res =>\n              this.extractData(res, layer, options, url, imposedGeom, imposedProperties)\n            )\n          );\n      })\n    );\n  }\n\n  private checkScaleAndResolution(resolution: number, scale: number, element: QueryUrlData): boolean {\n    let checkScale: boolean;\n    let checkResolution: boolean;\n\n    if (!element.minResolution && !element.maxResolution && !element.minScale && !element.maxScale) {\n      return true;\n    } else {\n      /******************* checking Resolution *******************/\n      if (element.minResolution && element.maxResolution) {\n        // if \"minResolution\" and \"maxResolution\" exists check if resoltion is between\n        if ((resolution >= element.minResolution) && (resolution <= element.maxResolution)) {\n          checkResolution = true;\n        }\n      } else {\n        // check if \"minResolution\" or \"maxResolution\" exists\n        if (element.minResolution && resolution >= element.minResolution) { checkResolution = true; }\n        if (element.maxResolution && resolution <= element.maxResolution) { checkResolution = true; }\n      }\n\n      /******************* checking Scale *******************/\n      if (element.minScale && element.maxScale) {\n        // if \"minScale\" and \"maxScale\" exists check if scale is between\n        if ((scale > element.minScale) && (scale < element.maxScale)) {\n          checkScale = true;\n        }\n      } else {\n        // check if \"minScale\" or \"maxScale\" exists\n        if (element.maxScale && scale <= element.maxScale) { checkScale = true; }\n        if (element.minScale && scale >= element.minScale) { checkScale = true; }\n      }\n\n      /******************* result of checking *******************/\n      if (checkScale === true && checkResolution === true) {\n        return true;\n      } else if ((checkResolution === true && !checkScale) || (checkScale === true && !checkResolution)) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }\n\n  private mergeGML(gmlRes, url, layer: Layer): [FeatureGeometry, { [key: string]: any }] {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(gmlRes);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      features = wmsParser.readFeatures(gmlRes);\n    }\n    const olmline = new olgeom.MultiLineString([]);\n    let pts;\n    const ptsArray = [];\n    let olmpoly = new olgeom.MultiPolygon([]);\n    let firstFeatureType;\n    const nbFeatures = features.length;\n\n    // Check if geometry intersect bbox\n    // for geoserver getfeatureinfo response in data projection, not call projection\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const bbox = bboxRaw.split(',');\n    const bboxExtent = olextent.createEmpty();\n    olextent.extend(bboxExtent, bbox);\n    const outBboxExtent = false;\n    let titleContent;\n    let queryTileField;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        queryTileField = dataSourceOptions.queryTitle;\n      }\n    }\n    features.map(feature => {\n\n      if (queryTileField) {\n        let queryTitleContent = feature.getProperties()[queryTileField];\n        if (queryTitleContent) {\n          titleContent = !titleContent ? queryTitleContent : `${titleContent},${queryTitleContent}`;\n        }\n      }\n      /*  if (!feature.getGeometry().simplify(100).intersectsExtent(bboxExtent)) {\n        outBboxExtent = true;\n        // TODO: Check to project the geometry?\n      }*/\n      const featureGeometryCoordinates = (feature.getGeometry() as any).getCoordinates();\n      const featureGeometryType = feature.getGeometry().getType();\n\n      if (!firstFeatureType && !outBboxExtent) {\n        firstFeatureType = featureGeometryType;\n      }\n      if (!outBboxExtent) {\n        switch (featureGeometryType) {\n          case 'Point':\n            if (nbFeatures === 1) {\n              pts = new olgeom.Point(featureGeometryCoordinates, 'XY');\n            } else {\n              ptsArray.push(featureGeometryCoordinates);\n            }\n            break;\n          case 'LineString':\n            olmline.appendLineString(\n              new olgeom.LineString(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'Polygon':\n            olmpoly.appendPolygon(\n              new olgeom.Polygon(featureGeometryCoordinates, 'XY')\n            );\n            break;\n          case 'MultiPolygon':\n            olmpoly = new olgeom.MultiPolygon(featureGeometryCoordinates, 'XY');\n            break;\n          default:\n            return;\n        }\n      }\n    });\n\n    let olmpts;\n    if (ptsArray.length === 0 && pts) {\n      olmpts = {\n        type: pts.getType(),\n        coordinates: pts.getCoordinates()\n      };\n    } else {\n      olmpts = {\n        type: 'Polygon',\n        coordinates: [this.convexHull(ptsArray)]\n      };\n    }\n\n    let returnGeometry;\n    switch (firstFeatureType) {\n      case 'LineString':\n        returnGeometry = {\n          type: olmline.getType(),\n          coordinates: olmline.getCoordinates()\n        };\n        break;\n      case 'Point':\n        returnGeometry = olmpts;\n        break;\n      case 'Polygon':\n        returnGeometry = {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n        break;\n      case 'MultiPolygon':\n        returnGeometry = {\n          type: olmpoly.getType(),\n          coordinates: olmpoly.getCoordinates()\n        };\n        break;\n    }\n    const imposedProperties = {};\n\n    if (queryTileField) {\n      imposedProperties[queryTileField] = titleContent;\n    }\n\n    return [ returnGeometry, imposedProperties];\n\n\n  }\n\n  cross(a, b, o) {\n    return (a[0] - o[0]) * (b[1] - o[1]) - (a[1] - o[1]) * (b[0] - o[0]);\n  }\n\n  /**\n   * @param points An array of [X, Y] coordinates\n   * This method is use instead of turf.js convexHull because Turf needs at least 3 point to make a hull.\n   * https://en.wikibooks.org/wiki/Algorithm_Implementation/Geometry/Convex_hull/Monotone_chain#JavaScript\n   */\n  convexHull(points) {\n    points.sort((a, b) => {\n      return a[0] === b[0] ? a[1] - b[1] : a[0] - b[0];\n    });\n\n    const lower = [];\n    for (const point of points) {\n      while (\n        lower.length >= 2 &&\n        this.cross(lower[lower.length - 2], lower[lower.length - 1], point) <= 0\n      ) {\n        lower.pop();\n      }\n      lower.push(point);\n    }\n\n    const upper = [];\n    for (let i = points.length - 1; i >= 0; i--) {\n      while (\n        upper.length >= 2 &&\n        this.cross(\n          upper[upper.length - 2],\n          upper[upper.length - 1],\n          points[i]\n        ) <= 0\n      ) {\n        upper.pop();\n      }\n      upper.push(points[i]);\n    }\n\n    upper.pop();\n    lower.pop();\n    return lower.concat(upper);\n  }\n\n  private extractData(\n    res,\n    layer: Layer,\n    options: QueryOptions,\n    url: string,\n    imposedGeometry?,\n    imposedProperties?: { [key: string]: any }\n  ): Feature[] {\n    const queryDataSource = layer.dataSource as QueryableDataSource;\n\n    const allowedFieldsAndAlias = this.getAllowedFieldsAndAlias(layer);\n    let features = [];\n    switch (queryDataSource.options.queryFormat) {\n      case QueryFormat.GML3:\n        features = this.extractGML3Data(\n          res,\n          layer.zIndex,\n          allowedFieldsAndAlias\n        );\n        break;\n      case QueryFormat.JSON:\n      case QueryFormat.GEOJSON:\n      case QueryFormat.GEOJSON2:\n        features = this.extractGeoJSONData(res, layer.zIndex, allowedFieldsAndAlias);\n        break;\n      case QueryFormat.ESRIJSON:\n        features = this.extractEsriJSONData(res, layer.zIndex, allowedFieldsAndAlias);\n        break;\n      case QueryFormat.TEXT:\n        features = this.extractTextData(res);\n        break;\n      case QueryFormat.HTML:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url\n        );\n        break;\n      case QueryFormat.HTMLGML2:\n        features = this.extractHtmlData(\n          res,\n          queryDataSource.queryHtmlTarget,\n          url,\n          imposedGeometry,\n          imposedProperties\n        );\n        break;\n      case QueryFormat.GML2:\n      default:\n        features = this.extractGML2Data(res, layer, allowedFieldsAndAlias);\n        break;\n    }\n    if (features.length > 0 && (features[0].geometry === null || !features[0].geometry)) {\n      const geomToAdd = this.createGeometryFromUrlClick(url);\n\n      for (const feature of features) {\n        feature.geometry = geomToAdd;\n      }\n    }\n\n    const wmsDatasource = layer.dataSource as WMSDataSource;\n    const featureCount = wmsDatasource.params?.FEATURE_COUNT ?\n      new RegExp('FEATURE_COUNT=' + this.featureCount) :\n      new RegExp('FEATURE_COUNT=' + this.defaultFeatureCount);\n\n    if (\n      featureCount.test(url) &&\n      ((wmsDatasource.params?.FEATURE_COUNT && this.featureCount > 1 && features.length === this.featureCount) ||\n      (!wmsDatasource.params?.FEATURE_COUNT && features.length === this.defaultFeatureCount))) {\n      this.languageService.translate.get('igo.geo.query.featureCountMax', {value: layer.title}).subscribe(message => {\n        const messageObj = this.messageService.info(message);\n        this.previousMessageIds.push(messageObj.toastId);\n      });\n    }\n\n    return features.map((feature: Feature, index: number) => {\n      const mapLabel = feature.properties[queryDataSource.mapLabel];\n\n      let exclude;\n      if (layer.options.sourceOptions?.type === 'wms') {\n        const sourceOptions = layer.options\n          .sourceOptions as WMSDataSourceOptions;\n        exclude = sourceOptions ? sourceOptions.excludeAttribute : undefined;\n      }\n\n      let title = this.getQueryTitle(feature, layer);\n      if (!title && features.length > 1) {\n        title = `${layer.title} (${index + 1})`;\n      } else if (!title) {\n        title = layer.title;\n      }\n\n      const meta = Object.assign({}, feature.meta || {}, {\n        id: uuid(),\n        title,\n        mapTitle: mapLabel,\n        sourceTitle: layer.title,\n        order: 1000 - layer.zIndex,\n        excludeAttribute: exclude\n      });\n\n      return Object.assign(feature, {\n        meta,\n        projection:\n          queryDataSource.options.type === 'carto'\n            ? 'EPSG:4326'\n            : options.projection\n      });\n    });\n  }\n\n  private createGeometryFromUrlClick(url) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const bboxRaw = searchParams.bbox;\n    const width = parseInt(searchParams.width, 10);\n    const height = parseInt(searchParams.height, 10);\n    const xPosition = parseInt(searchParams.i || searchParams.x, 10);\n    const yPosition = parseInt(searchParams.j || searchParams.y, 10);\n\n    const bbox = bboxRaw.split(',');\n    let threshold =\n      (Math.abs(parseFloat(bbox[0])) - Math.abs(parseFloat(bbox[2]))) * 0.05;\n\n    // for context in degree (EPSG:4326,4269...)\n    if (Math.abs(parseFloat(bbox[0])) < 180) {\n      threshold = 0.045;\n    }\n    const clickx =\n      parseFloat(bbox[0]) +\n      (Math.abs(parseFloat(bbox[0]) - parseFloat(bbox[2])) * xPosition) /\n        width -\n      threshold;\n    const clicky =\n      parseFloat(bbox[1]) +\n      (Math.abs(parseFloat(bbox[1]) - parseFloat(bbox[3])) * yPosition) /\n        height -\n      threshold;\n    const clickx1 = clickx + threshold * 2;\n    const clicky1 = clicky + threshold * 2;\n\n    const wktPoly =\n      'POLYGON((' +\n      clickx +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky1 +\n      ', ' +\n      clickx1 +\n      ' ' +\n      clicky +\n      ', ' +\n      clickx +\n      ' ' +\n      clicky +\n      '))';\n\n    const format = new olformat.WKT();\n    const tenPercentWidthGeom = format.readFeature(wktPoly);\n    const f = tenPercentWidthGeom.getGeometry() as any;\n\n    const newGeom = {\n      type: f.getType(),\n      coordinates: f.getCoordinates()\n    };\n\n    return newGeom;\n  }\n\n  private extractGML2Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML2();\n    let features = parser.readFeatures(res);\n    // Handle non standard GML output (MapServer)\n    if (features.length === 0) {\n      const wmsParser = new olformat.WMSGetFeatureInfo();\n      try {\n        features = wmsParser.readFeatures(res);\n      } catch (e) {\n        console.warn(\n          'query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.'\n        );\n      }\n    }\n\n    return features.map(feature =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGML3Data(res, zIndex, allowedFieldsAndAlias?) {\n    const parser = new olFormatGML3();\n    let features = [];\n    try {\n      features = parser.readFeatures(res);\n    } catch (e) {\n      console.warn('query.service: GML3 is not well supported');\n    }\n    return features.map(feature =>\n      this.featureToResult(feature, zIndex, allowedFieldsAndAlias)\n    );\n  }\n\n  private extractGeoJSONData(res, zIndex, allowedFieldsAndAlias?) {\n    let features = [];\n    try {\n      features = JSON.parse(res.replace(/(\\r|\\n)/g, ' ')).features;\n    } catch (e) {\n      console.warn('query.service: Unable to parse geojson', '\\n', res);\n    }\n    features.map(feature => feature.meta = {\n      id: uuid(),\n      order: 1000 - zIndex,\n      alias: allowedFieldsAndAlias\n    });\n    return features;\n  }\n\n  private extractEsriJSONData(res, zIndex, allowedFieldsAndAlias) {\n    if (res) {\n      try {\n        if (JSON.parse(res).error) {\n          return [];\n        }\n      } catch (e) {}\n    }\n    const parser = new olFormatEsriJSON();\n    const features = parser.readFeatures(res);\n\n    return features.map(feature => this.featureToResult(feature, zIndex, allowedFieldsAndAlias));\n  }\n\n  private extractTextData(res) {\n    // TODO\n    return [];\n  }\n\n  private extractHtmlData(\n    res,\n    htmlTarget: QueryHtmlTarget,\n    url,\n    imposedGeometry?,\n    imposedProperties?: { [key: string]: any }\n  ) {\n    const searchParams: any = this.getQueryParams(url.toLowerCase());\n    const projection = searchParams.crs || searchParams.srs || 'EPSG:3857';\n    const geomToAdd = this.createGeometryFromUrlClick(url);\n\n    if (\n      htmlTarget !== QueryHtmlTarget.BLANK &&\n      htmlTarget !== QueryHtmlTarget.IFRAME\n    ) {\n      htmlTarget = QueryHtmlTarget.IFRAME;\n    }\n\n    const bodyTagStart = res.toLowerCase().indexOf('<body>');\n    const bodyTagEnd = res.toLowerCase().lastIndexOf('</body>') + 7;\n    // replace \\r \\n  and ' ' with '' to validate if the body is really empty. Clear all the html tags from body\n    const body = striptags(res.slice(bodyTagStart, bodyTagEnd).replace(/(\\r|\\n|\\s)/g, ''));\n    if (body === '' || res === '') {\n      return [];\n    }\n\n    return [\n      {\n        type: FEATURE,\n        projection,\n        properties: Object.assign({ target: htmlTarget, body: res, url }, imposedProperties),\n        geometry: imposedGeometry || geomToAdd\n      }\n    ];\n  }\n\n  private getQueryParams(url) {\n    const queryString = url.split('?');\n    if (!queryString[1]) {\n      return;\n    }\n    const pairs = queryString[1].split('&');\n\n    const result = {};\n    pairs.forEach(pair => {\n      pair = pair.split('=');\n      result[pair[0]] = decodeURIComponent(pair[1] || '');\n    });\n    return result;\n  }\n\n  public featureToResult(\n    featureOL: olFeature<olgeom.Geometry>,\n    zIndex: number,\n    allowedFieldsAndAlias?\n  ): Feature {\n    const featureGeometry = featureOL.getGeometry() as any;\n    const properties: any = Object.assign({}, featureOL.getProperties());\n    delete properties.geometry;\n    delete properties.GEOMETRIE;\n    delete properties.boundedBy;\n    delete properties.shape;\n    delete properties.SHAPE;\n    delete properties.SHAPE_S;\n    delete properties.SHAPE_L;\n    delete properties.SHAPE_P;\n    delete properties.the_geom;\n    delete properties.geom;\n    delete properties.geom32198;\n\n    let geometry;\n    if (featureGeometry) {\n      geometry = {\n        type: featureGeometry.getType(),\n        coordinates: featureGeometry.getCoordinates()\n      };\n    }\n\n    return {\n      type: FEATURE,\n      projection: undefined,\n      properties,\n      geometry,\n      meta: {\n        id: uuid(),\n        order: 1000 - zIndex,\n        alias: allowedFieldsAndAlias\n      }\n    };\n  }\n\n  private getQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    forceGML2 = false,\n    mapExtent?: MapExtent\n  ): string | QueryUrlData[]{\n    let url;\n\n    if (datasource.options.queryUrls) {\n      return this.getCustomQueryUrl(datasource, options, mapExtent);\n    }\n\n    switch (datasource.constructor) {\n      case WMSDataSource:\n        const wmsDatasource = datasource as WMSDataSource;\n\n        const WMSGetFeatureInfoOptions = {\n          INFO_FORMAT:\n            wmsDatasource.params.INFO_FORMAT ||\n            this.getMimeInfoFormat(datasource.options.queryFormat),\n          QUERY_LAYERS: wmsDatasource.params.LAYERS,\n          FEATURE_COUNT: wmsDatasource.params.FEATURE_COUNT || this.defaultFeatureCount\n        };\n\n        if (wmsDatasource.params.FEATURE_COUNT) {\n          this.featureCount = wmsDatasource.params.FEATURE_COUNT;\n        }\n\n        if (forceGML2) {\n          WMSGetFeatureInfoOptions.INFO_FORMAT = this.getMimeInfoFormat(\n            QueryFormat.GML2\n          );\n        }\n\n        url = wmsDatasource.ol.getFeatureInfoUrl(\n          options.coordinates,\n          options.resolution,\n          options.projection,\n          WMSGetFeatureInfoOptions\n        );\n        // const wmsVersion =\n        //   wmsDatasource.params.VERSION ||\n        //   wmsDatasource.params.version ||\n        //   '1.3.0';\n        // if (wmsVersion !== '1.3.0') {\n        //   url = url.replace('&I=', '&X=');\n        //   url = url.replace('&J=', '&Y=');\n        // }\n        break;\n      case CartoDataSource:\n        const cartoDatasource = datasource as CartoDataSource;\n        const baseUrl =\n          'https://' +\n          cartoDatasource.options.account +\n          '.carto.com/api/v2/sql?';\n        const format = 'format=GeoJSON';\n        const sql =\n          '&q=' + cartoDatasource.options.config.layers[0].options.sql;\n        const clause =\n          ' WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(';\n        const meters = cartoDatasource.options.queryPrecision\n          ? cartoDatasource.options.queryPrecision\n          : '1000';\n        const coordinates =\n          options.coordinates[0] +\n          ',' +\n          options.coordinates[1] +\n          '),3857),' +\n          meters +\n          '))';\n\n        url = `${baseUrl}${format}${sql}${clause}${coordinates}`;\n        break;\n      case ImageArcGISRestDataSource:\n      case TileArcGISRestDataSource:\n        const tileArcGISRestDatasource = datasource as TileArcGISRestDataSource;\n        const deltaX = Math.abs(mapExtent[0] - mapExtent[2]);\n        const deltaY = Math.abs(mapExtent[1] - mapExtent[3]);\n        const maxDelta = deltaX > deltaY ? deltaX : deltaY;\n        const clickBuffer = maxDelta * 0.005;\n        const threshold = tileArcGISRestDatasource.options.queryPrecision ? tileArcGISRestDatasource.options.queryPrecision : clickBuffer;\n        const extent = olextent.buffer(\n          olextent.boundingExtent([options.coordinates]),\n          threshold\n        );\n        const serviceUrl =\n          tileArcGISRestDatasource.options.url +\n          '/' +\n          tileArcGISRestDatasource.options.layer +\n          '/query/';\n        const geometry = encodeURIComponent(\n          '{\"xmin\":' +\n            extent[0] +\n            ',\"ymin\":' +\n            extent[1] +\n            ',\"xmax\":' +\n            extent[2] +\n            ',\"ymax\":' +\n            extent[3] +\n            ',\"spatialReference\":{\"wkid\":102100}}'\n        );\n        const params = [\n          'f=json',\n          `geometry=${geometry}`,\n          'geometryType=esriGeometryEnvelope',\n          'inSR=102100',\n          'spatialRel=esriSpatialRelIntersects',\n          'outFields=*',\n          'returnGeometry=true',\n          'outSR=102100'\n        ];\n        url = `${serviceUrl}?${params.join('&')}`;\n        break;\n      default:\n        break;\n    }\n\n    return url;\n  }\n\n  private getMimeInfoFormat(queryFormat: string) {\n    let mime = 'application/vnd.ogc.gml';\n    const keyEnum = Object.keys(QueryFormat).find(\n      key => QueryFormat[key] === queryFormat\n    );\n    if (keyEnum) {\n      mime = QueryFormatMimeType[keyEnum];\n    }\n\n    return mime;\n  }\n\n  getAllowedFieldsAndAlias(layer: any) {\n    let allowedFieldsAndAlias;\n    if (\n      layer.options?.source?.options?.sourceFields &&\n      layer.options.source.options.sourceFields.length >= 1\n    ) {\n      allowedFieldsAndAlias = {};\n      layer.options.source.options.sourceFields.forEach(sourceField => {\n        const alias = sourceField.alias ? sourceField.alias : sourceField.name;\n        allowedFieldsAndAlias[sourceField.name] = alias;\n      });\n    }\n    return allowedFieldsAndAlias;\n  }\n\n  getQueryTitle(feature: Feature, layer: Layer): string {\n    let title;\n    if (layer.options?.source?.options) {\n      const dataSourceOptions = layer.options.source\n        .options as QueryableDataSourceOptions;\n      if (dataSourceOptions.queryTitle) {\n        title = this.getLabelMatch(feature, dataSourceOptions.queryTitle);\n      }\n    }\n\n    return title;\n  }\n\n  getLabelMatch(feature: Feature, labelMatch): string {\n    let label = labelMatch;\n    const labelToGet = Array.from(labelMatch.matchAll(/\\$\\{([^\\{\\}]+)\\}/g));\n\n    labelToGet.forEach(v => {\n      label = label.replace(v[0], feature.properties[v[1]]);\n    });\n\n    // Nothing done? check feature's attribute\n    if (labelToGet.length === 0 && label === labelMatch) {\n      label = feature.properties[labelMatch] || labelMatch;\n    }\n\n    return label;\n  }\n\n  /**\n   * @param datasource QueryableDataSource\n   * @param options QueryOptions\n   * @mapExtent extent of the map when click event\n   *\n   */\n\n  getCustomQueryUrl(\n    datasource: QueryableDataSource,\n    options: QueryOptions,\n    mapExtent?: MapExtent): QueryUrlData[] {\n\n      const extent = olextent.getForViewAndSize(\n        options.coordinates,\n        options.resolution,\n        0,\n        [101, 101]\n      );\n\n      return datasource.options.queryUrls.map(item => {\n        let data: QueryUrlData = {\n          url: item.url.replace(/\\{bbox\\}/g, extent.join(','))\n          .replace(/\\{x\\}/g, options.coordinates[0].toString())\n          .replace(/\\{y\\}/g, options.coordinates[1].toString())\n          .replace(/\\{resolution\\}/g, options.resolution.toString())\n          .replace(/\\{srid\\}/g, options.projection.replace('EPSG:',''))\n        };\n\n        // if the queryFormat changed to \"QueryFormat.HTMLGML2\": mapExtent will be undefined\n        // we need to check \"mapExtent\" befor replace variables in the url\n        if(mapExtent) {\n          data.url.replace(/\\{xmin\\}/g, mapExtent[0].toString())\n          .replace(/\\{ymin\\}/g, mapExtent[1].toString())\n          .replace(/\\{xmax\\}/g, mapExtent[2].toString())\n          .replace(/\\{ymax\\}/g, mapExtent[3].toString());\n        }\n\n        if(item.maxResolution) {\n          data.maxResolution = item.maxResolution;\n        }\n\n        if(item.minResolution) {\n          data.minResolution = item.minResolution;\n        }\n\n        if(item.minScale) {\n          data.minScale = item.minScale;\n        }\n\n        if(item.maxScale) {\n          data.maxScale = item.maxScale;\n        }\n\n        return data;\n      });\n    }\n}\n","import OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\n\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { QueryableDataSource } from './query.interfaces';\n\n/**\n * Whether a layer is queryable\n * @param layer Layer\n * @returns True if the layer s squeryable\n */\nexport function layerIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryable === true;\n}\n\n/**\n * Whether an OL layer is queryable\n * @param layer Layer\n * @returns True if the ol layer is queryable\n */\nexport function olLayerIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined ? false : layerIsQueryable(layer);\n}\n\n/**\n * Whether a layer's feature is queryable\n * @param layer Layer\n * @returns True if the layer's feature is queryable\n */\nexport function layerFeatureIsQueryable(layer: AnyLayer): boolean {\n  const dataSource = layer.dataSource as QueryableDataSource;\n  return dataSource.options.queryLayerFeatures !== undefined ? (dataSource.options.queryLayerFeatures === true) : true;\n}\n\n/**\n * Whether an OL Vector layer is queryable\n * @param layer Layer\n * @returns True if the ol vector layer is queryable\n */\nexport function olLayerFeatureIsQueryable(olLayer: OlLayer<OlSource>): boolean {\n  const layer = olLayer.get('_layer');\n  return layer === undefined ? false : (layerIsQueryable(layer) && layerFeatureIsQueryable(layer));\n}\n","import {\n  Directive,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  AfterViewInit,\n  Self\n} from '@angular/core';\n\nimport { Subscription, Observable, of, zip } from 'rxjs';\nimport { unByKey } from 'ol/Observable';\n\nimport OlFeature from 'ol/Feature';\nimport OlRenderFeature from 'ol/render/Feature';\nimport OlLayer from 'ol/layer/Layer';\nimport OlSource from 'ol/source/Source';\nimport olVectorSource from 'ol/source/Vector';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\nimport { EventsKey } from 'ol/events';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { renderFeatureFromOl } from '../../feature/shared/feature.utils';\nimport { featureFromOl } from '../../feature/shared/feature.utils';\nimport { QueryService } from './query.service';\nimport { layerIsQueryable, olLayerFeatureIsQueryable } from './query.utils';\nimport { ctrlKeyDown } from '../../map/shared/map.utils';\nimport { OlDragSelectInteraction } from '../../feature/shared/strategies/selection';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { QueryableDataSourceOptions } from './query.interfaces';\n\n/**\n * This directive makes a map queryable with a click of with a drag box.\n * By default, all layers are queryable but this can ben controlled at\n * the layer level.\n */\n@Directive({\n  selector: '[igoQuery]'\n})\nexport class QueryDirective implements AfterViewInit, OnDestroy {\n  /**\n   * Subscriptions to ongoing queries\n   */\n  private queries$$: Subscription[] = [];\n\n  /**\n   * Listener to the map click event\n   */\n  private mapClickListener;\n\n  /**\n   * OL drag box interaction\n   */\n  private olDragSelectInteraction: OlDragSelectInteraction;\n\n  /**\n   * Ol drag box \"end\" event key\n   */\n  private olDragSelectInteractionEndKey: EventsKey | EventsKey[];\n\n  /**\n   * Whter to query features or not\n   */\n  @Input() queryFeatures: boolean = false;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesHitTolerance: number = 0;\n\n  /**\n   * Feature query hit tolerance\n   */\n  @Input() queryFeaturesCondition: (olLayer: OlLayer<OlSource>) => boolean;\n\n  /**\n   * Whether all query should complete before emitting an event\n   */\n  @Input() waitForAllQueries: boolean = true;\n\n  /**\n   * Event emitted when a query (or all queries) complete\n   */\n  @Output() query = new EventEmitter<{\n    features: Feature[] | Feature[][];\n    event: MapBrowserPointerEvent<any>;\n  }>();\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return (this.component.map as any) as IgoMap;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private queryService: QueryService\n  ) {}\n\n  /**\n   * Start listening to click and drag box events\n   * @internal\n   */\n  ngAfterViewInit() {\n    this.listenToMapClick();\n    this.addDragBoxInteraction();\n  }\n\n  /**\n   * Stop listening to click and drag box events and cancel ongoind requests\n   * @internal\n   */\n  ngOnDestroy() {\n    this.cancelOngoingQueries();\n    this.unlistenToMapClick();\n    this.removeDragBoxInteraction();\n  }\n\n  /**\n   * On map click, issue queries\n   */\n  private listenToMapClick() {\n    this.mapClickListener = this.map.ol.on(\n      'singleclick',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Stop listening for map clicks\n   */\n  private unlistenToMapClick() {\n    unByKey(this.mapClickListener);\n    this.mapClickListener = undefined;\n  }\n\n  /**\n   * Issue queries from a map event and emit events with the results\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    this.cancelOngoingQueries();\n    if (!this.queryService.queryEnabled) {\n      return;\n    }\n\n    const queries$ = [];\n    if (this.queryFeatures) {\n      queries$.push(this.doQueryFeatures(event));\n    }\n\n    const resolution = this.map.ol.getView().getResolution();\n    const queryLayers = this.map.layers.filter(layerIsQueryable);\n    queries$.push(\n      ...this.queryService.query(queryLayers, {\n        coordinates: event.coordinate as [number, number],\n        projection: this.map.projection,\n        resolution\n      })\n    );\n\n    if (queries$.length === 0) {\n      return;\n    }\n\n    if (this.waitForAllQueries) {\n      this.queries$$.push(\n        zip(...queries$).subscribe((results: Feature[][]) => {\n          const features = [].concat(...results);\n          this.query.emit({ features, event });\n        })\n      );\n    } else {\n      this.queries$$ = queries$.map((query$: Observable<Feature[]>) => {\n        return query$.subscribe((features: Feature[]) => {\n          this.query.emit({ features, event });\n        });\n      });\n    }\n  }\n\n  /**\n   * Query features already present on the map\n   * @param event OL map browser pointer event\n   */\n  private doQueryFeatures(\n    event: MapBrowserPointerEvent<any>\n  ): Observable<Feature[]> {\n    const clickedFeatures = [];\n\n    if (event.type === 'singleclick') {\n      this.map.ol.forEachFeatureAtPixel(\n        event.pixel,\n        (featureOL: OlFeature<OlGeometry>, layerOL: any) => {\n          const layer = this.map.getLayerById(layerOL.values_._layer.id);\n          if ((layer.dataSource.options as QueryableDataSourceOptions).queryFormatAsWms) {\n            return;\n          }\n          if (featureOL) {\n            if (featureOL.get('features')) {\n              for (const feature of featureOL.get('features')) {\n                const newFeature = featureFromOl(feature, this.map.projection);\n                newFeature.meta = {\n                  title: feature.values_.nom,\n                  id: layerOL.values_._layer.id + '.' + feature.id_,\n                  icon: feature.values_._icon,\n                  sourceTitle: layerOL.values_.title,\n                  alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                  // title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n                };\n                clickedFeatures.push(newFeature);\n              }\n            } else if (featureOL instanceof OlRenderFeature) {\n              const newFeature = renderFeatureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            } else {\n              const newFeature = featureFromOl(\n                featureOL,\n                this.map.projection,\n                layerOL\n              );\n              newFeature.meta = {\n                id: layerOL.values_._layer.id + '.' + newFeature.meta.id,\n                sourceTitle: layerOL.values_.title,\n                alias: this.queryService.getAllowedFieldsAndAlias(layer),\n                title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n              };\n              clickedFeatures.push(newFeature);\n            }\n          }\n        },\n        {\n          hitTolerance: this.queryFeaturesHitTolerance || 0,\n          layerFilter: this.queryFeaturesCondition\n            ? this.queryFeaturesCondition\n            : olLayerFeatureIsQueryable\n        }\n      );\n    } else if (event.type === 'boxend') {\n      const target = event.target as any;\n      const dragExtent = target.getGeometry().getExtent();\n      this.map.layers\n        .filter(layerIsQueryable)\n        .filter(layer => layer instanceof VectorLayer && layer.visible)\n        .map(layer => {\n          const featuresOL = layer.dataSource.ol as olVectorSource<OlGeometry>;\n          featuresOL.forEachFeatureIntersectingExtent(dragExtent, (olFeature: any) => {\n            const newFeature: Feature = featureFromOl(olFeature, this.map.projection, layer.ol);\n            newFeature.meta = {\n              id: layer.id + '.' + olFeature.getId(),\n              icon: olFeature.values_._icon,\n              sourceTitle: layer.title,\n              alias: this.queryService.getAllowedFieldsAndAlias(layer),\n              title: this.queryService.getQueryTitle(newFeature, layer) || newFeature.meta.title\n            };\n            clickedFeatures.push(newFeature);\n          });\n        });\n    }\n\n\n    return of(clickedFeatures);\n  }\n\n  /**\n   * Cancel ongoing requests, if any\n   */\n  private cancelOngoingQueries() {\n    this.queries$$.forEach((sub: Subscription) => sub.unsubscribe());\n    this.queries$$ = [];\n  }\n\n  /**\n   * Add a drag box interaction and, on drag box end, select features\n   */\n  private addDragBoxInteraction() {\n    let olDragSelectInteractionOnQuery;\n    const olInteractions = this.map.ol.getInteractions().getArray();\n\n    // There can only be one dragbox interaction, so find the current one, if any\n    // Don't keep a reference to the current dragbox because we don't want\n    // to remove it when this startegy is deactivated\n    for (const olInteraction of olInteractions) {\n      if (olInteraction instanceof OlDragSelectInteraction) {\n        olDragSelectInteractionOnQuery = olInteraction;\n        break;\n      }\n    }\n    // If no drag box interaction is found, create a new one and add it to the map\n    if (olDragSelectInteractionOnQuery === undefined) {\n      olDragSelectInteractionOnQuery = new OlDragSelectInteraction({\n        condition: ctrlKeyDown\n      });\n      this.map.ol.addInteraction(olDragSelectInteractionOnQuery);\n      this.olDragSelectInteraction = olDragSelectInteractionOnQuery;\n    }\n\n    this.olDragSelectInteractionEndKey = olDragSelectInteractionOnQuery.on(\n      'boxend',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Remove drag box interaction\n   */\n  private removeDragBoxInteraction() {\n    if (this.olDragSelectInteractionEndKey !== undefined) {\n      unByKey(this.olDragSelectInteractionEndKey);\n    }\n    if (this.olDragSelectInteraction !== undefined) {\n      this.map.ol.removeInteraction(this.olDragSelectInteraction);\n    }\n    this.olDragSelectInteraction = undefined;\n  }\n}\n","import { Observable } from 'rxjs';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { StorageService } from '@igo2/core';\nimport { SearchResult } from '../search.interfaces';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions,\n  SearchSourceSettings\n} from './source.interfaces';\n\n/**\n * Base search source class\n */\nexport class SearchSource {\n  /**\n   * Search source ID\n   * @internal\n   */\n  static id = '';\n\n  /**\n   * Search source type\n   * @internal\n   */\n  static type = '';\n\n  /**\n   * Search source options\n   * @internal\n   */\n  protected options: SearchSourceOptions;\n\n  /**\n   * Get search source's id\n   * @returns Search source's id\n   */\n  getId(): string {\n    throw new Error('You have to implement the method \"getId\".');\n  }\n  /**\n   * Get search source's type\n   * @returns Search source's type\n   */\n  getType(): string {\n    throw new Error('You have to implement the method \"getType\".');\n  }\n\n  /**\n   * Get search source's default options\n   * @returns Search source default options\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    throw new Error('You have to implement the method \"getDefaultOptions\".');\n  }\n\n  /**\n   * Search source's title\n   */\n  get title(): string {\n    return this.options.title;\n  }\n\n  /**\n   * Whether the search source is available\n   */\n  get available(): boolean {\n    return this.options.available !== false;\n  }\n\n  /**\n   * Whether the search source is enabled\n   */\n  set enabled(value: boolean) {\n    this.options.enabled = value;\n  }\n  get enabled(): boolean {\n    return this.available && this.options.enabled !== false;\n  }\n\n  get showInPointerSummary(): boolean {\n    const showInPointerSummary = this.options.showInPointerSummary;\n    return showInPointerSummary ? showInPointerSummary : false;\n  }\n\n  get showInSettings(): boolean {\n    const showInSettings = this.options.showInSettings;\n    return showInSettings === undefined ? true : showInSettings;\n  }\n\n  /**\n   * Search url\n   */\n  get searchUrl(): string {\n    return this.options.searchUrl;\n  }\n\n  /**\n   * Search query params\n   */\n  get params(): { [key: string]: string } {\n    return this.options.params === undefined ? {} : this.options.params;\n  }\n\n  /**\n   * Search settings\n   */\n  get settings(): SearchSourceSettings[] {\n    return this.options.settings === undefined ? [] : this.options.settings;\n  }\n\n  /**\n   * Set params from selected settings\n   */\n  setParamFromSetting(setting: SearchSourceSettings, saveInStorage = true) {\n    switch (setting.type) {\n      case 'radiobutton':\n        setting.values.forEach(conf => {\n          if (conf.enabled) {\n            this.options.params = Object.assign(this.options.params || {}, {\n              [setting.name]: conf.value\n            });\n          }\n        });\n        break;\n      case 'checkbox':\n        let confValue = '';\n        setting.values\n          .filter(s => s.available !== false)\n          .forEach(conf => {\n            if (conf.enabled) {\n              confValue += conf.value + ',';\n            }\n          });\n        confValue = confValue.slice(0, -1);\n        this.options.params = Object.assign(this.options.params || {}, {\n          [setting.name]: confValue\n        });\n        break;\n    }\n\n    if (saveInStorage && this.storageService) {\n      this.storageService.set(\n        this.getId() + '.options',\n        {params: this.options.params}\n      );\n    }\n  }\n\n  /**\n   * Search results display order\n   */\n  get displayOrder(): number {\n    return this.options.order === undefined ? 99 : this.options.order;\n  }\n\n  constructor(options: SearchSourceOptions, private storageService?: StorageService) {\n    this.options = options;\n    if (this.storageService) {\n      const storageOptions = this.storageService.get(\n        this.getId() + '.options'\n      ) as object;\n      if (storageOptions) {\n        this.options = ObjectUtils.mergeDeep(this.options, storageOptions);\n      }\n    }\n\n    this.options = ObjectUtils.mergeDeep(this.getDefaultOptions(), this.options);\n\n\n    // Set Default Params from Settings\n    this.settings.forEach(setting => {\n      this.setParamFromSetting(setting, false);\n    });\n  }\n\n  /**\n   * Get hashtags valid\n   * @param hashtag hashtag from query\n   */\n  getHashtagsValid(term: string, settingsName: string): string[] {\n    const hashtags = term.match(/(#[A-Za-z+]+)/g);\n    if (!hashtags) {\n      return undefined;\n    }\n\n    const searchSourceSetting = this.getSettingsValues(settingsName);\n    const hashtagsValid = [];\n    hashtags.forEach(hashtag => {\n      searchSourceSetting.values.forEach(conf => {\n        const hashtagKey = hashtag.substring(1);\n        if (typeof conf.value === 'string') {\n          const types = conf.value\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n            .split(',');\n          const index = types.indexOf(\n            hashtagKey\n              .toLowerCase()\n              .normalize('NFD')\n              .replace(/[\\u0300-\\u036f]/g, '')\n          );\n          if (index !== -1) {\n            hashtagsValid.push(types[index]);\n          }\n        }\n        if (conf.hashtags && conf.hashtags.indexOf(hashtagKey.toLowerCase()) !== -1) {\n          hashtagsValid.push(conf.value);\n        }\n      });\n    });\n\n    return hashtagsValid.filter((a, b) => hashtagsValid.indexOf(a) === b);\n  }\n\n  getSettingsValues(search: string): SearchSourceSettings {\n    return this.getDefaultOptions().settings.find(\n      (value: SearchSourceSettings) => {\n        return value.name === search;\n      }\n    );\n  }\n}\n\n/**\n * Search sources that allow searching by text implement this class\n */\nexport interface TextSearch {\n  /**\n   * Search by text\n   * @param term Text\n   * @param options Optional: TextSearchOptions\n   * @returns Observable or search results\n   */\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult[]>;\n}\n\n/**\n * Search sources that allow searching by coordinates implement this class\n */\nexport interface ReverseSearch {\n  /**\n   * Search by text\n   * @param lonLat Coordinates\n   * @param options Optional: ReverseSearchOptions\n   * @returns Observable or search results\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions,\n    reverseSearchCoordsFormat?: boolean\n  ): Observable<SearchResult[]>;\n}\n","import { Injectable, Inject } from '@angular/core';\n\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { SearchSourceOptions } from '../../search/shared/sources/source.interfaces';\n/**\n * Map search source. For now it has no search capability. All it does\n * is act as a placeholder for the map query results' \"search source\".\n */\n@Injectable()\nexport class QuerySearchSource extends SearchSource {\n  static id = 'map';\n  static type = FEATURE;\n\n  constructor(@Inject('options') options: SearchSourceOptions) {\n    super(options);\n  }\n\n  getId(): string {\n    return QuerySearchSource.id;\n  }\n\n  getType(): string {\n    return QuerySearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Carte'\n    };\n  }\n}\n","export class GoogleLinks {\n  static getGoogleMapsCoordLink(lon, lat) {\n    return 'https://www.google.com/maps?q=' + lat + ',' + lon;\n  }\n\n  static getGoogleStreetViewLink(lon, lat) {\n    return 'https://www.google.com/maps?q=&layer=c&cbll=' + lat + ',' + lon;\n  }\n\n  static getGoogleMapsNameLink(name) {\n    const encodedName = encodeURI(name);\n    return 'https://www.google.com/maps?q=' + encodedName;\n  }\n}\n","import type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\nimport olFeature from 'ol/Feature';\nimport { asArray as ColorAsArray } from 'ol/color';\n\nimport { createOverlayMarkerStyle } from '../overlay/shared/overlay-marker-style.utils';\nimport { createOverlayDefaultStyle } from '../overlay/shared/overlay.utils';\nimport { FeatureCommonVectorStyleOptions } from './commonVectorStyle.interface';\nimport { Feature } from '../feature';\n\n\n/**\n * Generate a style for selected features\n * @param feature The feature to generate the style\n * @returns A olStyle\n */\nexport function getCommonVectorSelectedStyle(\n  {\n    feature,\n    markerColor = [0, 161, 222],\n    markerOpacity = 1,\n    markerOutlineColor = [0, 255, 255],\n    fillColor,\n    fillOpacity = 0.15,\n    strokeColor = [0, 255, 255],\n    strokeOpacity = 0.5,\n    strokeWidth = 4\n  }: FeatureCommonVectorStyleOptions): olstyle.Style {\n\n  return getCommonVectorStyle({\n    feature,\n    markerColor,\n    markerOpacity,\n    markerOutlineColor,\n    fillColor,\n    fillOpacity,\n    strokeColor,\n    strokeOpacity,\n    strokeWidth\n  });\n}\n\n/**\n * Generate a basic style for features\n * @param feature The feature to generate the style\n * @returns A olStyle\n */\nexport function getCommonVectorStyle(\n  {\n    feature,\n    markerColor = [0, 161, 222],\n    markerOpacity = 0.5,\n    markerOutlineColor,\n    fillColor = [0, 161, 222],\n    fillOpacity = 0.15,\n    strokeColor = [0, 161, 222],\n    strokeOpacity = 0.5,\n    strokeWidth = 2\n  }: FeatureCommonVectorStyleOptions): olstyle.Style {\n\n  const isOlFeature = feature instanceof olFeature;\n  let geometry;\n  let text;\n  if (isOlFeature) {\n    feature = feature as olFeature<OlGeometry>;\n    geometry = feature.getGeometry();\n  } else {\n    feature = feature as Feature;\n    geometry = feature.geometry;\n    text = feature.meta.mapTitle;\n  }\n  const geometryType = isOlFeature ? geometry.getType() : geometry.type;\n\n  if (!geometry || geometryType === 'Point') {\n    const markerColorAsArray = ColorAsArray(markerColor).slice(0);\n    const markerColorRGB = markerColorAsArray.slice(0, 3);\n\n    if (markerColorAsArray.length === 4 &&\n        (typeof markerColor !== 'string' || /^#[0-9A-F]{8}$/i.test(markerColor as string))) {\n      markerOpacity = markerColorAsArray[3];\n    }\n\n    return createOverlayMarkerStyle({\n      text,\n      opacity: markerOpacity,\n      markerOutlineColor,\n      markerColor: markerColorRGB\n    });\n  } else {\n    const fillWithOpacity = ColorAsArray(fillColor).slice(0);\n    const strokeWithOpacity = ColorAsArray(strokeColor).slice(0);\n\n    if (!(fillWithOpacity.length === 4 &&\n        (typeof fillColor !== 'string' || /^#[0-9A-F]{8}$/i.test(fillColor as string)))) {\n      fillWithOpacity[3] = fillOpacity;\n    }\n\n    if (!(strokeWithOpacity.length === 4 &&\n        (typeof strokeColor !== 'string' || /^#[0-9A-F]{8}$/i.test(strokeColor as string)))) {\n      strokeWithOpacity[3] = strokeOpacity;\n    }\n\n    return createOverlayDefaultStyle({\n      text,\n      strokeWidth,\n      strokeColor: strokeWithOpacity,\n      fillColor: fillWithOpacity\n    });\n  }\n}\n","export class OsmLinks {\n  static getOpenStreetMapLink(lon, lat, zoom: number = 17) {\n    // return 'https://www.google.com/maps?q=' + lat + ',' + lon;\n    return `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}#map=${zoom}/${lat}/${lon}`;\n  }\n\n  static getOpenStreetCamLink(lon, lat, zoom: number = 17) {\n    return `https://openstreetcam.org/map/@${lat},${lon},${zoom}z`;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\nimport { EMPTY, Observable, of, zip } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { uuid, ObjectUtils } from '@igo2/utils';\nimport { LanguageService, MessageService, ConfigService } from '@igo2/core';\nimport {\n  CapabilitiesService,\n  WMSDataSourceOptions,\n  WMSDataSourceOptionsParams,\n  WMTSDataSourceOptions,\n  ArcGISRestDataSourceOptions\n} from '../../datasource';\nimport { LayerOptions, ImageLayerOptions } from '../../layer';\nimport { getResolutionFromScale } from '../../map';\n\nimport {\n  CatalogItem,\n  CatalogItemLayer,\n  CatalogItemGroup,\n  ForcedProperty\n} from './catalog.interface';\nimport { Catalog, CatalogFactory, CompositeCatalog } from './catalog.abstract';\nimport { CatalogItemType, TypeCatalog } from './catalog.enum';\nimport { QueryFormat } from '../../query';\nimport { generateIdFromSourceOptions } from '../../utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CatalogService {\n  constructor(\n    private http: HttpClient,\n    private config: ConfigService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private capabilitiesService: CapabilitiesService\n  ) {}\n\n  loadCatalogs(): Observable<Catalog[]> {\n    const contextConfig = this.config.getConfig('context') || {};\n    const catalogConfig = this.config.getConfig('catalog') || {};\n    const apiUrl = catalogConfig.url || contextConfig.url;\n    const catalogsFromConfig = catalogConfig.sources || [];\n\n    const observables$ = [];\n\n    if (apiUrl) {\n      // Base layers catalog\n      if (catalogConfig.baseLayers) {\n        const translate = this.languageService.translate;\n        const title = translate.instant('igo.geo.catalog.baseLayers');\n        const baseLayersCatalog = [\n          {\n            id: 'catalog.baselayers',\n            title,\n            url: `${apiUrl}/baselayers`,\n            type: 'baselayers'\n          }\n        ];\n        observables$.push(of(baseLayersCatalog));\n      }\n\n      // Catalogs from API\n      const catalogsFromApi$ = this.http\n        .get<Catalog[]>(`${apiUrl}/catalogs`)\n        .pipe(\n          map((catalogs) =>\n            catalogs.map((c: any) => Object.assign(c, c.options))\n          ),\n          catchError((_response: HttpErrorResponse) => EMPTY)\n        );\n      observables$.push(catalogsFromApi$);\n    }\n\n    // Catalogs from config\n    if (catalogsFromConfig.length > 0) {\n      observables$.push(\n        of(catalogsFromConfig).pipe(\n          map((catalogs: Catalog[]) =>\n            catalogs.map((c) => {\n              if (!c.id) {\n                c.id = uuid();\n              }\n              return c;\n            })\n          )\n        )\n      );\n    }\n\n    return zip(...observables$).pipe(\n      map((catalogs: Catalog[][]) => [].concat.apply([], catalogs))\n    ) as Observable<Catalog[]>;\n  }\n\n  loadCatalogItems(catalog: Catalog): Observable<CatalogItem[]> {\n    let newCatalog: Catalog;\n    newCatalog = CatalogFactory.createInstanceCatalog(catalog, this);\n    return newCatalog.collectCatalogItems();\n  }\n\n  loadCatalogBaseLayerItems(catalog: Catalog): Observable<CatalogItemGroup[]> {\n    return this.getCatalogBaseLayersOptions(catalog).pipe(\n      map((layersOptions: LayerOptions[]) => {\n        const items = layersOptions.map((layerOptions: LayerOptions) => {\n          return {\n            id: generateIdFromSourceOptions(layerOptions.sourceOptions),\n            title: layerOptions.title,\n            type: CatalogItemType.Layer,\n            externalProvider: catalog.externalProvider,\n            options: layerOptions\n          } as CatalogItemLayer;\n        });\n        return [\n          {\n            id: 'catalog.group.baselayers',\n            type: CatalogItemType.Group,\n            externalProvider: catalog.externalProvider,\n            title: catalog.title,\n            items\n          }\n        ];\n      })\n    );\n  }\n\n  private getCatalogBaseLayersOptions(\n    catalog: Catalog\n  ): Observable<LayerOptions[]> {\n    return this.http.get<LayerOptions[]>(catalog.url);\n  }\n\n  loadCatalogWMSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        const items = [];\n        if (!capabilities) {\n          return items;\n        }\n        if (capabilities.Service && capabilities.Service.Abstract && capabilities.Service.Abstract.length) {\n          catalog.abstract = capabilities.Service.Abstract;\n        }\n        const finalLayers = [];\n        this.flattenWmsCapabilities(capabilities.Capability.Layer, 0, finalLayers, catalog.groupSeparator);\n        const capabilitiesCapabilityLayer = Object.assign({}, capabilities.Capability.Layer);\n        capabilitiesCapabilityLayer.Layer = finalLayers.filter(f => f.Layer.length !== 0);\n        this.includeRecursiveItems(\n          catalog,\n          capabilitiesCapabilityLayer,\n          items\n        );\n        return items;\n      })\n    );\n  }\n\n  flattenWmsCapabilities(parent, level = 0, finalLayers, separator = ' / ') {\n    if (!finalLayers.includes(parent.Title)) {\n        const modifiedParent = Object.assign({}, parent);\n        modifiedParent.Layer = [];\n        finalLayers.push(modifiedParent);\n    }\n    for (const layer of parent.Layer) {\n        const modifiedLayer = Object.assign({}, layer);\n        if (level > 0) {\n          modifiedLayer.Title = parent.Title + separator + layer.Title;\n        }\n        if (layer.Layer) {\n            this.flattenWmsCapabilities(modifiedLayer, level + 1, finalLayers, separator);\n        } else {\n            finalLayers.find(ff => ff.Title === parent.Title).Layer.push(layer);\n         }\n    }\n}\n\n  loadCatalogWMTSLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => this.getWMTSItems(catalog, capabilities))\n    );\n  }\n\n  loadCatalogArcGISRestItems(catalog: Catalog): Observable<CatalogItem[]> {\n    return this.getCatalogCapabilities(catalog).pipe(\n      map((capabilities: any) => {\n        return this.getArcGISRESTItems(catalog, capabilities);\n      })\n    );\n  }\n\n  loadCatalogCompositeLayerItems(catalog: Catalog): Observable<CatalogItem[]> {\n    const compositeCatalog = (catalog as CompositeCatalog).composite;\n\n    const catalogsFromInstance = [] as Catalog[];\n    compositeCatalog.map((component: Catalog) => {\n      component.sortDirection = catalog.sortDirection; // propagate sortDirection with parent value\n      catalogsFromInstance.push(\n        CatalogFactory.createInstanceCatalog(component, this)\n    );\n  }\n    );\n\n    // get CatalogItems for each original Catalog-----------------------------------------------------\n    const request1$ = [];\n    catalogsFromInstance.map((component: Catalog) =>\n      request1$.push(component.collectCatalogItems())\n    );\n\n    // integrate imposed group -----------------------------------------------------\n    let request2$ = [];\n\n    function flatDeepLayer(arr) {\n      return arr.reduce(\n        (acc, val) =>\n          acc.concat(\n            val.type === CatalogItemType.Group ? flatDeepLayer(val.items) : val\n          ),\n        []\n      );\n    }\n\n    if (\n      Object.keys(compositeCatalog).find((k) => compositeCatalog[k].groupImpose)\n    ) {\n      const pushImposeGroup = (item, index) => {\n        const c = catalogsFromInstance[index];\n        const outGroupImpose = Object.assign({}, c.groupImpose);\n        outGroupImpose.address = c.id;\n        outGroupImpose.type = CatalogItemType.Group;\n        outGroupImpose.externalProvider = c.externalProvider;\n        if (outGroupImpose.sortDirection === undefined) {\n          outGroupImpose.sortDirection = c.sortDirection;\n        }\n        outGroupImpose.items = [];\n\n        const flatLayer = flatDeepLayer(item);\n        flatLayer.map(\n          (v) => (v.address = `${outGroupImpose.address}.${outGroupImpose.id}`)\n        );\n        outGroupImpose.items = flatLayer;\n\n        return outGroupImpose;\n      };\n\n      request2$ = request1$.map((obs, idx) =>\n        obs.pipe(\n          map((items) =>\n            compositeCatalog[idx].groupImpose\n              ? pushImposeGroup(items, idx)\n              : items\n          )\n        )\n      );\n    } else {\n      request2$ = request1$;\n    }\n\n    // concat Group -----------------------------------------------------\n    const request3$ = zip(...request2$).pipe(\n      map(\n        (output: CatalogItem[]) => [].concat(...output) // [].concat.apply([], result1\n      )\n    );\n\n    // merge Group (first level only) -----------------------------------------------------\n    const groupByGroupId = (data, keyFn) =>\n      data.reduce((acc, group) => {\n        const groupId = keyFn(group);\n        const ind = acc.find((x) => x.id === groupId);\n\n        if (!ind) {\n          acc[acc.length] = group;\n        } else {\n          const ix = acc.indexOf(ind);\n          if (acc[ix].address.split('|').indexOf(group.address) === -1) {\n            acc[ix].address = `${acc[ix].address}|${group.address}`;\n          }\n          acc[ix].items.push(...group.items);\n        }\n        return acc;\n      }, []);\n\n    // merge Layer for each Level (catalog, group(recursive))\n    const recursiveGroupByLayerAddress = (items, keyFn) =>\n      items.reduce((acc, item, idx, arr) => {\n        const layerTitle = keyFn(item);\n        const outItem = Object.assign({}, item);\n\n        if (item.type === CatalogItemType.Layer) {\n          // same title, same address => result: only one item is kept\n\n          // same title, address diff\n          const indicesMatchTitle = [];\n          const indicesMatchNewMetadataUrl = []; // metadata\n          const diffAddress = arr.filter((x, i) => {\n            let bInd = false;\n            if (x.title === layerTitle && x.type === CatalogItemType.Layer) {\n              if (i !== idx && x.address !== item.address) {\n                bInd = true;\n              }\n              indicesMatchTitle.push(i);\n            }\n            return bInd;\n          }); // $& i !== idx\n\n          if (diffAddress.length > 0) {\n            let nPosition = indicesMatchTitle.findIndex((x) => x === idx) + 1;\n            outItem.title = `${item.title} (${nPosition})`; // source: ${item.address.split('.')[0]}\n            nPosition = indicesMatchNewMetadataUrl.findIndex((x) => x === idx) + 1;\n            outItem.newMetadataUrl = `${item.newMetadataUrl} (${nPosition})`; // source: ${item.address.split('.')[0]}\n          }\n\n          const exist = acc.find(\n            (x) => x.title === outItem.title && x.type === CatalogItemType.Layer\n          );\n          if (!exist) {\n            acc[acc.length] = outItem;\n          }\n        } else if (item.type === CatalogItemType.Group) {\n          outItem.items = recursiveGroupByLayerAddress(\n            item.items,\n            (layer) => layer.title\n          );\n          acc[acc.length] = outItem;\n        }\n\n        return acc;\n      }, []);\n\n    const request4$ = request3$.pipe(\n      map((output) => groupByGroupId(output, (group) => group.id)),\n      map((output) => [].concat(...output)),\n      map((data) => recursiveGroupByLayerAddress(data, (layer) => layer.title))\n    );\n\n    return request4$;\n  }\n\n  private getCatalogCapabilities(catalog: Catalog): Observable<any> {\n    const sType: string = TypeCatalog[catalog.type as string];\n    return this.capabilitiesService\n      .getCapabilities(sType as any, catalog.url, catalog.version)\n      .pipe(\n        catchError((e) => {\n          const title = this.languageService.translate.instant(\n            'igo.geo.catalog.unavailableTitle'\n          );\n          const message =\n          catalog.title ? this.languageService.translate.instant(\n            'igo.geo.catalog.unavailable',\n            { value: catalog.title }\n          ) : this.languageService.translate.instant(\n            'igo.geo.catalog.someUnavailable'\n          );\n\n          this.messageService.error(message, title);\n          console.error(e);\n          return of(undefined);\n        })\n      );\n  }\n\n  private computeForcedProperties(\n    layerNameFromCatalog: string,\n    forcedProperties: ForcedProperty[]): ForcedProperty {\n\n    if (!forcedProperties || forcedProperties.length === 0) {\n      return;\n    }\n    const returnProperty: ForcedProperty = {\n      layerName: layerNameFromCatalog,\n      title: undefined,\n      metadataUrl: undefined,\n      metadataAbstract: undefined,\n      metadataAbstractAll: undefined,\n      metadataUrlAll: undefined\n    };\n    //process wildcard before\n    // if there is a * wildcard\n    const forcedPropertiesForAllLayers = forcedProperties.find(f => f.layerName === '*');\n    if (forcedPropertiesForAllLayers) {\n      // metadataAbstractAll\n      if (forcedPropertiesForAllLayers.metadataAbstractAll) {\n        returnProperty.metadataAbstractAll = forcedPropertiesForAllLayers.metadataAbstractAll;\n      }\n      // metadataUrlAll\n      if (forcedPropertiesForAllLayers.metadataUrlAll) {\n        returnProperty.metadataUrlAll = forcedPropertiesForAllLayers.metadataUrlAll;\n      }\n    }\n    forcedProperties.map(forcedProperty => {\n      // if match found\n      if (layerNameFromCatalog === forcedProperty.layerName) {\n        // title\n        if (forcedProperty.title) {\n          returnProperty.title = forcedProperty.title;\n        }\n        // metadataUrl\n        if (forcedProperty.metadataUrl) {\n          returnProperty.metadataUrl = forcedProperty.metadataUrl;\n        }\n        // metadataAbstract\n        if (forcedProperty.metadataAbstract) {\n          returnProperty.metadataAbstract = forcedProperty.metadataAbstract;\n        }\n      }\n    });\n    return returnProperty;\n  }\n\n  /// WMS\n\n  private prepareCatalogItemLayer(layer, idParent, layersQueryFormat, catalog) {\n    const configuredQueryFormat = this.retrieveLayerInfoFormat(\n      layer.Name,\n      layersQueryFormat\n    );\n\n    const legendOptions =\n      catalog.showLegend && layer.Style\n        ? this.capabilitiesService.getStyle(layer.Style)\n        : undefined;\n\n    const params = Object.assign({}, catalog.queryParams, {\n      LAYERS: layer.Name,\n      VERSION: catalog.version\n    } as WMSDataSourceOptionsParams);\n\n    const baseSourceOptions = {\n      type: 'wms',\n      url: catalog.url,\n      crossOrigin: catalog.setCrossOriginAnonymous ? 'anonymous' : undefined,\n      queryFormat: configuredQueryFormat,\n      queryHtmlTarget:\n        configuredQueryFormat === QueryFormat.HTML ||\n        configuredQueryFormat === QueryFormat.HTMLGML2\n          ? 'iframe'\n          : undefined,\n      optionsFromCapabilities: true\n    };\n\n    const sourceOptions = Object.assign(\n      {},\n      baseSourceOptions,\n      catalog.sourceOptions,\n      { params }\n    ) as WMSDataSourceOptions;\n\n    const propertiesToForce = this.computeForcedProperties(layer.Name, catalog.forcedProperties);\n    let baseAbstract;\n    let extern = true;\n    if (layer.Abstract) {\n      baseAbstract = layer.Abstract;\n    } else if (!layer.Abstract && catalog.abstract) {\n      baseAbstract = catalog.abstract;\n    }\n    const layerOnlineResource = layer?.DataURL && layer?.DataURL.length >0 ? layer?.DataURL[0].OnlineResource : undefined;\n\n    let metadataUrl = propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll || layerOnlineResource;\n    let metadataAbstract = propertiesToForce?.metadataAbstract || propertiesToForce?.metadataAbstractAll || baseAbstract;\n\n    if (\n      !propertiesToForce?.metadataUrl &&\n      !propertiesToForce?.metadataUrlAll &&\n      (propertiesToForce?.metadataAbstract ||\n        propertiesToForce?.metadataAbstractAll)\n    ) {\n      extern = false;\n    }\n    if (propertiesToForce?.metadataAbstract && propertiesToForce?.metadataUrlAll) {\n      extern = false;\n    }\n\n    const layerPrepare = {\n      id: generateIdFromSourceOptions(sourceOptions),\n      type: CatalogItemType.Layer,\n      title: propertiesToForce?.title ? propertiesToForce.title : layer.Title,\n      address: idParent,\n      externalProvider: catalog.externalProvider || false,\n      options: {\n        maxResolution: getResolutionFromScale(layer.MaxScaleDenominator),\n        minResolution: getResolutionFromScale(layer.MinScaleDenominator),\n        metadata: {\n          url: metadataUrl,\n          extern,\n          abstract: metadataAbstract,\n          type: baseSourceOptions.type\n        },\n        legendOptions,\n        tooltip: { type: catalog.tooltipType },\n        sourceOptions\n      }\n    } as CatalogItem;\n\n    return ObjectUtils.removeUndefined(layerPrepare);\n  }\n\n  private prepareCatalogItemGroup(\n    itemListIn,\n    regexes,\n    idGroup,\n    layersQueryFormat,\n    catalog\n  ) {\n    const groupPrepare = {\n      id: idGroup,\n      type: CatalogItemType.Group,\n      title: itemListIn.Title,\n      address: catalog.id,\n      externalProvider: catalog.externalProvider || false,\n      sortDirection: catalog.sortDirection, // propagate sortDirection\n      items: itemListIn.Layer.reduce((items: CatalogItem[], layer: any) => {\n        if (layer.Layer !== undefined) {\n          // recursive, check next level\n          const idGroupItemNextLevel =\n            idGroup + `.group.${layer.Name || layer.Layer[0].Name}`;\n          const groupItem: CatalogItemGroup = this.prepareCatalogItemGroup(\n            layer,\n            regexes,\n            idGroupItemNextLevel,\n            layersQueryFormat,\n            catalog\n          );\n\n          items.push(groupItem);\n        } else {\n          if (this.testLayerRegexes(layer.Name, regexes) === false) {\n            return items;\n          }\n\n          const layerItem: CatalogItemLayer<ImageLayerOptions> = this.prepareCatalogItemLayer(\n            layer,\n            idGroup,\n            layersQueryFormat,\n            catalog\n          );\n\n          items.push(layerItem);\n        }\n        return items;\n      }, [])\n    };\n    return groupPrepare;\n  }\n\n  private includeRecursiveItems(\n    catalog: Catalog,\n    itemListIn: any,\n    itemsPrepare: CatalogItem[],\n    loopLevel: number = 0\n  ) {\n    // Dig all levels until last level (layer object are not defined on last level)\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n    if (!itemListIn.Layer) {\n      return;\n    }\n\n    for (const item of itemListIn.Layer) {\n      if (item.Layer !== undefined) {\n        // recursive, check next level\n        this.includeRecursiveItems(catalog, item, itemsPrepare, loopLevel + 1);\n        continue;\n      }\n\n      const layersQueryFormat = this.findCatalogInfoFormat(catalog);\n\n      // group(with layers) and layer(without group) level 1\n      if (loopLevel !== 0) {\n        // TODO: Slice that into multiple methods\n        // Define object of group layer\n        const idGroupItem = `catalog.group.${itemListIn.Name || item.Name}`;\n        const groupItem = this.prepareCatalogItemGroup(\n          itemListIn,\n          regexes,\n          idGroupItem,\n          layersQueryFormat,\n          catalog\n        );\n\n        if (groupItem.items.length !== 0) {\n          itemsPrepare.push(groupItem);\n        }\n\n        // Break the group (don't add a group of layer for each of their layer!)\n        break;\n      } else {\n        // layer without group\n        if (this.testLayerRegexes(item.Name, regexes) !== false) {\n          const layerItem = this.prepareCatalogItemLayer(\n            item,\n            catalog.id,\n            layersQueryFormat,\n            catalog\n          );\n          itemsPrepare.push(layerItem);\n        }\n      }\n    }\n  }\n\n  /// WMTS\n\n  private getWMTSItems(\n    catalog,\n    capabilities: { [key: string]: any }\n  ): CatalogItemLayer[] {\n    if (!capabilities) {\n      return [];\n    }\n    const layers = capabilities.Contents.Layer;\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    if (\n      capabilities.ServiceIdentification &&\n      capabilities.ServiceIdentification.Abstract &&\n      capabilities.ServiceIdentification.Abstract.length) {\n      catalog.abstract = capabilities.ServiceIdentification.Abstract;\n    }\n\n    return layers\n      .map((layer: any) => {\n\n        const propertiesToForce = this.computeForcedProperties(layer.Title, catalog.forcedProperties);\n        let extern = true;\n\n        let metadataUrl = propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll;\n        let metadataAbstract = propertiesToForce?.metadataAbstract || propertiesToForce?.metadataAbstractAll || catalog.abstract;\n\n        if (\n          !propertiesToForce?.metadataUrl &&\n          !propertiesToForce?.metadataUrlAll &&\n          (propertiesToForce?.metadataAbstract ||\n            propertiesToForce?.metadataAbstractAll)\n        ) {\n          extern = false;\n        }\n        if (propertiesToForce?.metadataAbstract && propertiesToForce?.metadataUrlAll) {\n          extern = false;\n        }\n\n\n      if (this.testLayerRegexes(layer.Identifier, regexes) === false) {\n        return undefined;\n      }\n      const params = Object.assign({}, catalog.queryParams, {\n        version: '1.0.0'\n      });\n      const baseSourceOptions = {\n        type: 'wmts',\n        url: catalog.url,\n        crossOrigin: catalog.setCrossOriginAnonymous\n          ? 'anonymous'\n          : undefined,\n        layer: layer.Identifier,\n        matrixSet: catalog.matrixSet,\n        optionsFromCapabilities: true,\n        requestEncoding: catalog.requestEncoding || 'KVP',\n        style: 'default'\n      } as WMTSDataSourceOptions;\n      const sourceOptions = Object.assign(\n        {},\n        baseSourceOptions,\n        catalog.sourceOptions,\n        { params }\n      ) as WMTSDataSourceOptions;\n\n      return ObjectUtils.removeUndefined({\n        id: generateIdFromSourceOptions(sourceOptions),\n        type: CatalogItemType.Layer,\n        title: propertiesToForce?.title ? propertiesToForce.title : layer.Title,\n        address: catalog.id,\n        externalProvider: catalog.externalProvider,\n        options: {\n          sourceOptions,\n          metadata: {\n            url: metadataUrl,\n            extern,\n            abstract: metadataAbstract,\n            type: baseSourceOptions.type\n          }\n        }\n      } as CatalogItem);\n    })\n    .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n}\n\n/// ERSI\n\n  private getArcGISRESTItems(\n    catalog,\n    capabilities\n  ): CatalogItemLayer[] {\n    if (!capabilities) {\n      return [];\n    }\n    const layers =\n    !capabilities.layers ? [] : capabilities.layers.filter(layer => !layer.type || layer.type === 'Feature Layer');\n    if (!capabilities.layers) {\n      this.messageService.error(\n        this.languageService.translate.instant('igo.geo.catalog.someUnavailable'),\n        this.languageService.translate.instant('igo.geo.catalog.unavailableTitle')\n      );\n    }\n\n    const regexes = (catalog.regFilters || []).map(\n      (pattern: string) => new RegExp(pattern)\n    );\n\n    let abstract;\n    if (capabilities.serviceDescription && capabilities.serviceDescription.length) {\n      const regex = /(<([^>]+)>)/ig;\n      abstract = capabilities.serviceDescription.replace(regex, '');\n    }\n\n    return layers\n      .map((layer: any) => {\n\n        const propertiesToForce = this.computeForcedProperties(layer.name, catalog.forcedProperties);\n        let baseAbstract;\n        let extern = true;\n        if (layer.Abstract) {\n          baseAbstract = layer.Abstract;\n        } else if (!layer.Abstract && catalog.abstract) {\n          baseAbstract = catalog.abstract;\n        }\n\n        let metadataUrl = propertiesToForce?.metadataUrl || propertiesToForce?.metadataUrlAll;\n        let metadataAbstract = propertiesToForce?.metadataAbstract || propertiesToForce?.metadataAbstractAll || baseAbstract;\n\n        if (\n          !propertiesToForce?.metadataUrl &&\n          !propertiesToForce?.metadataUrlAll &&\n          (propertiesToForce?.metadataAbstract ||\n            propertiesToForce?.metadataAbstractAll)\n        ) {\n          extern = false;\n        }\n        if (propertiesToForce?.metadataAbstract && propertiesToForce?.metadataUrlAll) {\n          extern = false;\n        }\n\n        if (this.testLayerRegexes(layer.id, regexes) === false) {\n          return undefined;\n        }\n        const baseSourceOptions = {\n          type: TypeCatalog[catalog.type],\n          url: catalog.url,\n          crossOrigin: catalog.setCrossOriginAnonymous\n            ? 'anonymous'\n            : undefined,\n          layer: layer.id as string,\n          queryable: true,\n          queryFormat: 'esrijson',\n          matrixSet: catalog.matrixSet,\n          optionsFromCapabilities: true,\n          style: 'default'\n        } as ArcGISRestDataSourceOptions;\n        const sourceOptions = Object.assign(\n          {},\n          baseSourceOptions,\n          catalog.sourceOptions\n        ) as ArcGISRestDataSourceOptions;\n        return ObjectUtils.removeUndefined({\n          id: generateIdFromSourceOptions(sourceOptions),\n          type: CatalogItemType.Layer,\n          title: propertiesToForce?.title ? propertiesToForce.title : layer.name,\n          externalProvider: catalog.externalProvider,\n          address: catalog.id,\n          options: {\n            sourceOptions,\n            minResolution: getResolutionFromScale(layer.maxScale),\n            maxResolution: getResolutionFromScale(layer.minScale),\n            metadata: {\n              url: metadataUrl,\n              extern,\n              abstract: metadataAbstract,\n              type: baseSourceOptions.type\n            },\n          }\n        } as CatalogItem);\n      })\n      .filter((item: CatalogItemLayer | undefined) => item !== undefined);\n  }\n\n  private testLayerRegexes(layerName: string, regexes: RegExp[]): boolean {\n    if (regexes.length === 0) {\n      return true;\n    }\n    return regexes.find((regex: RegExp) => regex.test(layerName)) !== undefined;\n  }\n\n  private retrieveLayerInfoFormat(\n    layerNameFromCatalog: string,\n    layersQueryFormat: { layer: string; queryFormat: QueryFormat }[]\n  ): QueryFormat {\n    const currentLayerInfoFormat = layersQueryFormat.find(\n      (f) => f.layer === layerNameFromCatalog\n    );\n    const baseInfoFormat = layersQueryFormat.find((f) => f.layer === '*');\n    let queryFormat: QueryFormat;\n    if (currentLayerInfoFormat) {\n      queryFormat = currentLayerInfoFormat.queryFormat;\n    } else if (baseInfoFormat) {\n      queryFormat = baseInfoFormat.queryFormat;\n    }\n    return queryFormat;\n  }\n\n  private findCatalogInfoFormat(\n    catalog: Catalog\n  ): { layer: string; queryFormat: QueryFormat }[] {\n    const layersQueryFormat: { layer: string; queryFormat: QueryFormat }[] = [];\n    if (!catalog.queryFormat) {\n      return layersQueryFormat;\n    }\n    Object.keys(catalog.queryFormat).forEach((configuredInfoFormat) => {\n      if (catalog.queryFormat[configuredInfoFormat] instanceof Array) {\n        catalog.queryFormat[configuredInfoFormat].forEach((layerName) => {\n          if (\n            !layersQueryFormat.find((specific) => specific.layer === layerName)\n          ) {\n            layersQueryFormat.push({\n              layer: layerName,\n              queryFormat: configuredInfoFormat as QueryFormat\n            });\n          }\n        });\n      } else {\n        if (\n          !layersQueryFormat.find(\n            (specific) =>\n              specific.layer === catalog.queryFormat[configuredInfoFormat]\n          )\n        ) {\n          layersQueryFormat.push({\n            layer: catalog.queryFormat[configuredInfoFormat],\n            queryFormat: configuredInfoFormat as QueryFormat\n          });\n        }\n      }\n    });\n    return layersQueryFormat;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <igo-catalog-browser-group\n        [catalog]=\"catalog\"\n        [group]=\"item\"\n        [map]=\"map\"\n        [state]=\"store.state\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [collapsed]=\"(store.count === 1) ? false : true\"\n        [toggleCollapsed]=\"toggleCollapsedGroup\"\n        (addedChange)=\"onGroupAddedChange($event)\"\n        (layerAddedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-group>\n    </ng-container>\n\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"item\"\n        [map]=\"map\"\n        [resolution]=\"resolution$ | async\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"store.state.get(item).added\"\n        (addedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { zip, BehaviorSubject } from 'rxjs';\n\nimport { EntityStore, EntityStoreWatcher } from '@igo2/common';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { IgoMap } from '../../map';\n\nimport {\n  Catalog,\n  CatalogItem,\n  CatalogItemLayer,\n  CatalogItemGroup,\n  CatalogItemState,\n  CatalogItemType\n} from '../shared';\n\n/**\n * Component to browse a catalog's groups and layers and display them on a map.\n */\n@Component({\n  selector: 'igo-catalog-browser',\n  templateUrl: './catalog-browser.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserComponent implements OnInit, OnDestroy {\n  /**\n   * Catalog items store watcher\n   */\n  private watcher: EntityStoreWatcher<CatalogItem>;\n\n // private resolution$$: Subscription;\n\n  get resolution$(): BehaviorSubject<number> { return this.map.viewController.resolution$; }\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Store holding the catalog's items\n   */\n  @Input() store: EntityStore<CatalogItem, CatalogItemState>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Whether a group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsedGroup: boolean = true;\n\n  constructor(\n    private layerService: LayerService,\n    private cdRef: ChangeDetectorRef\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    const currentItems = this.map.layers.map((layer: Layer) => {\n      return {\n        id: layer.options.source.id,\n        title: layer.title,\n        type: CatalogItemType.Layer\n      };\n    });\n    this.store.state.updateMany(currentItems, { added: true }, true);\n    if (this.catalog && this.catalog.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.catalog.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n      });\n    }\n\n    const catalogShowLegend = this.catalog ? this.catalog.showLegend : false;\n    this.catalogAllowLegend = catalogShowLegend ? catalogShowLegend : this.catalogAllowLegend;\n\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n  }\n\n  ngOnDestroy() {\n    this.watcher.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * When a layer is added or removed, add or remove it from the map\n   * @internal\n   * @param event Layer added event\n   */\n  onLayerAddedChange(event: { added: boolean; layer: CatalogItemLayer }) {\n    const layer = event.layer;\n    this.store.state.update(layer, { added: event.added }, false);\n    event.added ? this.addLayerToMap(layer) : this.removeLayerFromMap(layer);\n  }\n\n  /**\n   * When a froup is added or removed, add or remove it from the map\n   * @internal\n   * @param event Group added event\n   */\n  onGroupAddedChange(event: { added: boolean; group: CatalogItemGroup }) {\n    const group = event.group;\n    this.store.state.update(group, { added: event.added }, false);\n    event.added ? this.addGroupToMap(group) : this.removeGroupFromMap(group);\n  }\n\n  /**\n   * Add layer to map\n   * @param layer Catalog layer\n   */\n  private addLayerToMap(layer: CatalogItemLayer) {\n    this.addLayersToMap([layer]);\n  }\n\n  /**\n   * Remove layer from map\n   * @param layer Catalog layer\n   */\n  private removeLayerFromMap(layer: CatalogItemLayer) {\n    this.removeLayersFromMap([layer]);\n  }\n\n  /**\n   * Add multiple layers to map\n   * @param layers Catalog layers\n   */\n  private addLayersToMap(layers: CatalogItemLayer[]) {\n    const layers$ = layers.map((layer: CatalogItemLayer) => {\n      if (!layer.options.sourceOptions.optionsFromApi) {\n        layer.options.sourceOptions.optionsFromApi = true;\n      }\n      if (this.catalog.profils?.length) {\n        layer.options.security = { profils: this.catalog.profils };\n      }\n      return this.layerService.createAsyncLayer(layer.options);\n    });\n\n    zip(...layers$).subscribe((oLayers: Layer[]) => {\n      this.store.state.updateMany(layers, { added: true });\n      this.map.addLayers(oLayers);\n    });\n  }\n\n  /**\n   * Remove multiple layers from map\n   * @param layers Catalog layers\n   */\n  private removeLayersFromMap(layers: CatalogItemLayer[]) {\n    layers.forEach((layer: CatalogItemLayer) => {\n      this.store.state.update(layer, { added: false });\n      if (layer.options.baseLayer === true) {\n        const oLayer = this.map.getLayerById(layer.options.id);\n        if (oLayer !== undefined) {\n          this.map.removeLayer(oLayer);\n        }\n      } else {\n        const oLayer = this.map.getLayerById(layer.id);\n        if (oLayer !== undefined) {\n          this.map.removeLayer(oLayer);\n        }\n      }\n    });\n  }\n\n  /**\n   * Sort the layers by title. asc or desc.\n   * @internal\n   */\n  private sortCatalogItemsByTitle(items: CatalogItem[], direction) {\n    const returnItem = items.sort((a, b) => {\n      const titleA = a.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      const titleB = b.title.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n\n      if (titleA < titleB) {\n        return -1;\n      }\n      if (titleA > titleB) {\n        return 1;\n      }\n      return 0;\n    });\n    switch (direction) {\n      case 'asc':\n        return returnItem;\n      case 'desc':\n        return returnItem.reverse();\n      default:\n        return items;\n    }\n  }\n\n  /**\n   * Add all the layers of a group to map\n   * @param group Catalog group\n   */\n  private addGroupToMap(group: CatalogItemGroup) {\n    let layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === false;\n    });\n    if (group.sortDirection !== undefined) {\n      layers = this.sortCatalogItemsByTitle(layers, group.sortDirection);\n    }\n    this.addLayersToMap(layers.reverse() as CatalogItemLayer[]);\n  }\n\n  /**\n   * Remove all the layers of a group from map\n   * @param group Catalog group\n   */\n  private removeGroupFromMap(group: CatalogItemGroup) {\n    const layers = group.items.filter((item: CatalogItem) => {\n      const added = this.store.state.get(item).added || false;\n      return this.isLayer(item) && added === true;\n    });\n    this.removeLayersFromMap(layers as CatalogItemLayer[]);\n  }\n}\n","<ng-container *ngIf=\"legendItems$ | async as items\">\n  <ng-container *ngIf=\"items.length; else noItems\">\n    <ng-container *ngFor=\"let item of items.slice().reverse()\" #renderedLegends>\n      <div *ngIf=\"getLegend; else noItems\">\n        <mat-list-item *ngIf=\"item.title\">\n          <mat-icon\n            id=\"legend-toggle\"\n            class=\"igo-chevron\"\n            mat-list-avatar\n            igoCollapse\n            [target]=\"legend\"\n            [collapsed]=\"(item.collapsed)\"\n            (toggle)=\"toggleLegendItem($event, item)\"\n            svgIcon=\"chevron-up\">\n          </mat-icon>\n          <h4 matLine>{{computeItemTitle(item) | async}} </h4>\n        </mat-list-item>\n        <div #legend class=\"igo-layer-legend\" [ngClass]=\"{'with-title': item.title}\">\n          <div *ngIf=\"currentStyle !== undefined\">\n              <mat-form-field>\n                <mat-select tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n                  [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" [(ngModel)]=\"currentStyle\"\n                  (selectionChange)=\"onChangeStyle()\">\n                  <mat-option *ngFor=\"let style of styles\" [value]=\"style.name\">{{style.title}}</mat-option>\n                </mat-select>\n            </mat-form-field>\n          </div>\n          <div *ngIf=\"!(item.collapsed)\">\n            <div *ngIf=\"item.url\">\n              <img igoImageError *ngIf=\"item.imgGraphValue\" hideError=\"true\" #renderedLegend id=\"{{item.title}}\" (load)=\"onLoadImage(item.title)\"\n                [src]=\"item.imgGraphValue\"\n                alt=\"{{'igo.geo.layer.legend.loadingLegendText' | translate}}\">\n              <small *ngIf=\"imagesHeight[item.title]<16\">\n                  {{'igo.geo.layer.legend.noLegendScale' | translate}}\n              </small>\n            </div>\n            <div\n              [ngStyle]=\"item.style\"\n              [innerHTML]=\"item.html | sanitizeHtml\"\n              *ngIf=\"item.html\">\n            </div>\n          </div>\n        </div>\n      </div>\n    </ng-container>\n  </ng-container>\n\n  <ng-template #noItems>\n    <small>\n      {{'igo.geo.layer.legend.noLegendText' | translate}}\n    </small>\n  </ng-template>\n\n</ng-container>\n","import { HttpClient } from '@angular/common/http';\nimport { Component, Input, OnInit, OnDestroy, ChangeDetectionStrategy, ViewChildren, ElementRef, ChangeDetectorRef } from '@angular/core';\nimport type { QueryList } from '@angular/core';\n\nimport { Subscription, BehaviorSubject, of, Observable } from 'rxjs';\n\nimport { Legend } from '../../datasource/shared/datasources/datasource.interface';\nimport { Layer, ItemStyleOptions } from '../shared/layers';\nimport { LegendMapViewOptions } from '../shared/layers/layer.interface';\nimport { CapabilitiesService } from '../../datasource/shared/capabilities.service';\nimport { catchError, map } from 'rxjs/operators';\nimport { LanguageService, ConfigService } from '@igo2/core';\nimport { WMSDataSource, WMSDataSourceOptions } from '../../datasource';\nimport { SecureImagePipe } from '@igo2/common';\n\n@Component({\n  selector: 'igo-layer-legend',\n  templateUrl: './layer-legend.component.html',\n  styleUrls: ['./layer-legend.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendComponent implements OnInit, OnDestroy {\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  /**\n   * Observable of the legend items\n   */\n  legendItems$: BehaviorSubject<Legend[]> = new BehaviorSubject([]);\n\n  /**\n   * Subscription to the map's resolution\n   */\n  private state$$: Subscription;\n\n  /**\n   * The available styles\n   */\n  public styles;\n\n  /**\n   * The style used to make the legend\n   */\n  public currentStyle;\n\n  /**\n   * The scale used to make the legend\n   */\n  private scale: number = undefined;\n\n  /**\n   * The extent used to make the legend\n   */\n  private view: LegendMapViewOptions = undefined;\n  /**\n   * Get list of images display\n   */\n  @ViewChildren('renderedLegend') renderedLegends: QueryList<ElementRef>;\n\n  /**\n   * List of size of images displayed\n   */\n  public imagesHeight: { [srcKey: string]: number } = {};\n\n  /**\n   * Layer\n   */\n  @Input() layer: Layer;\n\n  /**\n   * if getLegendGraphic is authorized\n   */\n  public getLegend = true;\n\n  /**\n   * activeLegend\n   */\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private languageService: LanguageService,\n    private configService: ConfigService,\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * On init, subscribe to the map's resolution and update the legend accordingly\n   */\n  ngOnInit() {\n    let lastlLegend = this.layer.legend;\n    this.styles = this.listStyles();\n    const sourceOptions = this.layer.options.source.options as any;\n    if (sourceOptions && sourceOptions.params && sourceOptions.params.STYLES) {\n      // if a styles is provided into the layers wms params\n      this.currentStyle = this.styles.find(style => style.name === sourceOptions.params.STYLES).name;\n    } else if (!lastlLegend) {\n      // if no legend is manually provided\n      if (this.styles && this.styles.length > 1) {\n        this.currentStyle = this.styles[0].name;\n      }\n    } else if (this.styles && this.styles.length > 1) {\n      this.currentStyle = lastlLegend[0].currentStyle;\n    }\n    if (typeof this.layer.options.legendOptions !== 'undefined' && this.layer.options.legendOptions.display === false) {\n      lastlLegend = [];\n    } else {\n      lastlLegend = this.layer.dataSource.getLegend(this.currentStyle, this.view);\n    }\n\n    if (this.updateLegendOnResolutionChange || (sourceOptions as WMSDataSourceOptions).contentDependentLegend) {\n      const state$ = this.layer.map.viewController.state$;\n      this.state$$ = state$.subscribe(() => this.onViewControllerStateChange());\n    } else if (lastlLegend && lastlLegend.length !== 0) {\n      this.legendItems$.next(lastlLegend);\n      for (const legend of lastlLegend) {\n        this.getLegendGraphic(legend);\n      }\n    }\n  }\n\n  /**\n   * On destroy, unsubscribe to the map's view state\n   */\n  ngOnDestroy() {\n    if (this.state$$ !== undefined) {\n      this.state$$.unsubscribe();\n    }\n  }\n\n  getLegendGraphic(item: Legend) {\n    if (item.url) {\n      const secureIMG = new SecureImagePipe(this.http, this.configService);\n      secureIMG.transform(item.url).pipe(\n        catchError((err) => {\n          if (err.error) {\n            err.error.caught = true;\n            this.getLegend = false;\n            this.cdRef.detectChanges();\n            return err;\n          }\n        })\n        ).subscribe(obsLegGraph => {\n          const idx = this.legendItems$.value.findIndex(leg => leg.title === item.title);\n          const legendGraph = obsLegGraph as string;\n          this.legendItems$.value[idx].imgGraphValue = legendGraph;\n          this.cdRef.detectChanges();\n        }\n      );\n    }\n  }\n\n  toggleLegendItem(collapsed: boolean, item: Legend) {\n    item.collapsed = collapsed;\n  }\n\n  private transfertToggleLegendItem(newLegends: Legend[]): Legend[] {\n    const outLegends: Legend[] = newLegends;\n    const lastLegends = this.layer.legend;\n    for (let i = 0; i < lastLegends.length; i++) {\n      outLegends[i].collapsed = lastLegends[i].collapsed;\n   }\n    return outLegends;\n  }\n\n  computeItemTitle(layerLegend): Observable<string> {\n    const layerOptions = this.layer.dataSource.options as any;\n    if (layerOptions.type !== 'wms') {\n      return of(layerLegend.title);\n    }\n\n    const layers = layerOptions.params.LAYERS.split(',');\n    const localLayerOptions = JSON.parse(JSON.stringify(layerOptions)); // to avoid to alter the original options.\n    localLayerOptions.params.LAYERS = layers.find(layer => layer === layerLegend.title);\n    return this.capabilitiesService\n      .getWMSOptions(localLayerOptions)\n      .pipe(map(wmsDataSourceOptions => {\n        return wmsDataSourceOptions._layerOptionsFromSource.title;\n      }));\n  }\n\n  /**\n   * On resolution change, compute the effective scale level and update the\n   * legend accordingly.\n   * @param resolution Map resolution\n   */\n  private onViewControllerStateChange() {\n    this.view = {\n      resolution: this.layer.map.viewController.getResolution(),\n      extent: this.layer.map.viewController.getExtent(),\n      projection: this.layer.map.viewController.getOlProjection().getCode(),\n      scale: this.layer.map.viewController.getScale(),\n      size: this.layer.map.ol.getSize()\n    } as LegendMapViewOptions;\n    this.updateLegend();\n  }\n\n  /**\n   * Update the legend with scale level and style define\n   */\n  private updateLegend() {\n    let legendItems = this.layer.dataSource.getLegend(this.currentStyle, this.view);\n    if (this.layer.legend && this.layer.legend.length > 1) { legendItems = this.transfertToggleLegendItem(legendItems); }\n    this.layer.legend = legendItems;\n\n    if (legendItems.length === 0 && this.legendItems$.value.length === 0) {\n      return;\n    }\n    this.legendItems$.next(legendItems);\n    for (const legend of this.legendItems$.value) {\n      this.getLegendGraphic(legend);\n    }\n  }\n\n  private listStyles() {\n    const layerOptions = this.layer.options;\n    if (layerOptions && layerOptions.legendOptions) {\n      const translate = this.languageService.translate;\n      const title = translate.instant('igo.geo.layer.legend.default');\n      let stylesAvailable = [{ name: '', title } as ItemStyleOptions];\n      if (layerOptions.legendOptions.stylesAvailable) {\n        stylesAvailable = stylesAvailable.concat(layerOptions.legendOptions.stylesAvailable.filter(sA => (\n          sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !== 'default' &&\n          sA.name.normalize('NFD').replace(/[\\u0300-\\u036f]/gi, '') !== 'defaut')));\n      }\n      stylesAvailable.filter(sa => !sa.title).map((sa) => sa.title = sa.name);\n      stylesAvailable.map(s => s.title = s.title.charAt(0).toUpperCase() + s.title.slice(1).replace(/_/g, ' '));\n      return stylesAvailable;\n    }\n    return ;\n  }\n\n  onChangeStyle() {\n    this.updateLegend();\n    let STYLES = '';\n    if (this.layer.dataSource instanceof WMSDataSource) {\n      this.layer.dataSource.ol.getParams().LAYERS.split(',').map(layer =>\n        STYLES += this.currentStyle + ','\n      );\n      STYLES = STYLES.slice(0, -1);\n      this.layer.dataSource.ol.updateParams({ STYLES });\n    }\n  }\n\n  onLoadImage(id: string) {\n    let elemRef: HTMLImageElement;\n    if (this.renderedLegends.length === 1) {\n      elemRef = this.renderedLegends.first.nativeElement as HTMLImageElement;\n    } else {\n      elemRef = this.renderedLegends.find(renderedLegend => renderedLegend.nativeElement.id === id).nativeElement as HTMLImageElement;\n    }\n    this.imagesHeight[id] = elemRef.height;\n  }\n}\n","<mat-list-item>\n  <mat-icon *ngIf=\"haveGroup()\" mat-list-avatar svgIcon=\"blank\"></mat-icon>\n  <h4 mat-line matTooltipShowDelay=\"500\" [ngClass]=\"(catalogAllowLegend)?'igo-cataloglayer-title':''\" (click)=\"askForLegend($event)\" [matTooltip]=\"computeTitleTooltip()\">{{title}}</h4>\n\n    <button *ngIf=\"layer.externalProvider\"\n      disabled=\"true\"\n      mat-icon-button>\n    <mat-icon\n      class=\"igo-cataloglayer-external-icon\"\n      *ngIf=\"layer.externalProvider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.layer' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n      svgIcon=\"earth-arrow-right\">\n    </mat-icon>\n  </button>\n  <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n\n  <button\n    (mouseenter)=\"onMouseEvent($event)\" (mouseleave)=\"onMouseEvent($event)\"\n    mat-icon-button\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"computeTooltip() | translate\"\n    [color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n    (click)=\"onToggleClick($event)\">\n    <mat-icon\n       matBadge=\"icon\"\n       [igoMatBadgeIcon]=\"getBadgeIcon()\"\n       igoMatBadgeColor=\"rgba(0,0,0,0.87)\"\n       igoMatBadgeBackgroundColor=\"none\"\n       igoMatBadgeInverseColor=\"true\"\n       [matBadgeHidden]=\"((inRange$ | async) && (isVisible$ | async) === true) || ((inRange$ | async) && !added) || ((inRange$ | async) && (isPreview$ | async))\"\n       [matBadgeDisabled]=\"(inRange$ | async) === false\"\n       matBadgeSize=\"small\"\n       matBadgePosition=\"after\"\n       [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\">\n    </mat-icon>\n  </button>\n\n</mat-list-item>\n\n<div #legend class=\"igo-cataloglayer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"(layerLegendShown$ | async) && (igoLayer$ | async) && catalogAllowLegend\"\n    [layer]=\"igoLayer$ | async\">\n  </igo-layer-legend>\n</div>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\n\nimport { CatalogItemLayer } from '../shared';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { first } from 'rxjs/operators';\nimport { Layer, TooltipType } from '../../layer/shared/layers';\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { IgoMap } from '../../map';\n\n/**\n * Catalog browser layer item\n */\n@Component({\n  selector: 'igo-catalog-browser-layer',\n  templateUrl: './catalog-browser-layer.component.html',\n  styleUrls: ['./catalog-browser-layer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserLayerComponent implements OnInit, OnDestroy {\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public isVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private isPreview$$: Subscription;\n  private resolution$$: Subscription;\n  private layers$$: Subscription;\n  private lastTimeoutRequest;\n\n  public layerLegendShown$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public igoLayer$ = new BehaviorSubject<Layer>(undefined);\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Catalog layer\n   */\n  @Input() layer: CatalogItemLayer;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added = false;\n\n  /**\n   * Event emitted when the add/remove button is clicked\n   */\n  @Output() addedChange = new EventEmitter<{\n    added: boolean;\n    layer: CatalogItemLayer;\n  }>();\n\n  @Output() addedLayerIsPreview = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.layer);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.layer) || 'layers';\n  }\n\n  constructor(private layerService: LayerService ) {}\n\n  ngOnInit(): void {\n    this.isPreview$$ = this.isPreview$.subscribe(value => this.addedLayerIsPreview.emit(value));\n\n    this.layers$$ = this.map.layers$.subscribe(() => {\n      this.isVisible();\n    });\n\n    this.resolution$$ = this.map.viewController.resolution$.subscribe((resolution) => {\n      this.isInResolutionsRange(resolution);\n      this.isVisible();\n    });\n  }\n\n  ngOnDestroy() {\n    this.isPreview$$.unsubscribe();\n    this.resolution$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  computeTitleTooltip(): string {\n      const layerOptions = this.layer.options;\n      if (!layerOptions.tooltip) {\n        return getEntityTitle(this.layer);\n      }\n      const layerTooltip = layerOptions.tooltip;\n      const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n      switch (layerOptions.tooltip.type) {\n        case TooltipType.TITLE:\n          return this.layer.title;\n        case TooltipType.ABSTRACT:\n          if (layerMetadata && layerMetadata.abstract) {\n            return layerMetadata.abstract;\n          } else {\n            return this.layer.title;\n          }\n        case TooltipType.CUSTOM:\n          if (layerTooltip && layerTooltip.text) {\n            return layerTooltip.text;\n          } else {\n            return this.layer.title;\n          }\n        default:\n          return this.layer.title;\n      }\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  askForLegend(event) {\n    this.layerLegendShown$.next(!this.layerLegendShown$.value);\n    this.layerService.createAsyncLayer(this.layer.options).pipe(first())\n    .subscribe(layer => this.igoLayer$.next(layer));\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n    if (event.type === 'mouseenter' && this.mouseInsideAdd ) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove();\n          } else {\n            this.add();\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add();\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove();\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add() {\n    if (!this.added) {\n      this.added = true;\n      this.addedChange.emit({ added: true, layer: this.layer });\n    }\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private remove() {\n    if (this.added) {\n      this.added = false;\n      this.addedChange.emit({ added: false, layer: this.layer });\n    }\n  }\n\n  haveGroup(): boolean {\n    return !(!this.layer.address || this.layer.address.split('.').length === 1);\n  }\n\n  isInResolutionsRange(resolution: number) {\n    const minResolution = (!this.layer.options.minResolution || Number.isNaN(this.layer.options.minResolution))\n      ? 0 : this.layer.options.minResolution;\n    const maxResolution = (!this.layer.options.maxResolution || Number.isNaN(this.layer.options.maxResolution))\n    ? Infinity : this.layer.options.maxResolution;\n    this.inRange$.next(\n      resolution >= minResolution && resolution <= maxResolution\n    );\n  }\n\n  isVisible() {\n    if (this.layer?.id) {\n      const oLayer = this.map.getLayerById(this.layer?.id);\n      oLayer ? this.isVisible$.next(oLayer.visible) : this.isVisible$.next(false);\n    }\n  }\n\n  getBadgeIcon() {\n    if (this.inRange$.getValue()) {\n      return this.isVisible$.getValue() ? '' : 'eye-off';\n    } else {\n      return 'eye-off';\n    }\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      if (this.isPreview$.value) {\n        return 'igo.geo.catalog.layer.addToMap';\n      } else if (this.inRange$.value) {\n        return this.isVisible$.value\n        ? 'igo.geo.catalog.layer.removeFromMap'\n        : 'igo.geo.catalog.layer.removeFromMapNotVisible';\n      } else {\n        return 'igo.geo.catalog.layer.removeFromMapOutRange';\n      }\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n}\n","<mat-list-item>\n  <mat-icon\n    mat-list-avatar\n    svgIcon=\"chevron-up\"\n    igoCollapse\n    class=\"igo-chevron\"\n    [target]=\"items\"\n    [collapsed]=\"collapsed\"\n    (toggle)=\"onToggleCollapsed($event)\">\n  </mat-icon>\n\n  <h4 class=\"igo-catalog-group-title\" id=\"catalog-group-title\" mat-line matTooltipShowDelay=\"500\" [matTooltip]=\"title\" (click)=\"onTitleClick()\">{{title}}</h4>\n\n  <button *ngIf=\"group.externalProvider\"\n    disabled=\"true\"\n    mat-icon-button>\n    <mat-icon\n      class=\"igo-cataloggroup-external-icon\"\n      *ngIf=\"group.externalProvider\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.externalProvider.group' | translate\"\n      color=\"primary\"\n      (click)=\"$event.stopPropagation()\"\n      svgIcon=\"earth-arrow-right\">\n    </mat-icon>\n  </button>\n\n  <ng-container *ngIf=\"(added$ | async) && (preview$ | async) === false; else notadded\">\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.group.removeFromMap' | translate\"\n      color=\"warn\"\n      [disabled]=\"disabled$ | async\"\n      (click)=\"onToggleClick()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n  </ng-container>\n\n  <ng-template #notadded>\n    <button\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.catalog.group.addToMap' | translate\"\n      [disabled]=\"disabled$ | async\"\n      (click)=\"onToggleClick()\">\n      <mat-icon svgIcon=\"plus\"></mat-icon>\n    </button>\n  </ng-template>\n</mat-list-item>\n\n<div #items>\n  <ng-template ngFor let-item [ngForOf]=\"store.view.all$() | async\">\n    <ng-container *ngIf=\"isGroup(item)\">\n      <!-- todo: add display ans manage CatalogItemGroup -->\n    </ng-container>\n    <ng-container *ngIf=\"isLayer(item)\">\n      <igo-catalog-browser-layer\n        igoListItem\n        [layer]=\"item\"\n        [resolution]=\"resolution\"\n        [map]=\"map\"\n        [catalogAllowLegend]=\"catalogAllowLegend\"\n        [added]=\"state.get(item).added\"\n        (addedLayerIsPreview)=\"onLayerPreview($event)\"\n        (addedChange)=\"onLayerAddedChange($event)\">\n      </igo-catalog-browser-layer>\n    </ng-container>\n  </ng-template>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport { EntityStore } from '@igo2/common';\nimport type { EntityStateManager } from '@igo2/common';\n\nimport {\n  Catalog,\n  CatalogItem,\n  CatalogItemGroup,\n  CatalogItemLayer,\n  CatalogItemState,\n  CatalogItemType\n} from '../shared';\nimport { IgoMap } from '../../map';\n\n/**\n * Catalog browser group item\n */\n@Component({\n  selector: 'igo-catalog-browser-group',\n  templateUrl: './catalog-browser-group.component.html',\n  styleUrls: ['./catalog-browser-group.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogBrowserGroupComponent implements OnInit, OnDestroy {\n\n  /**\n   * Group's items store\n   * @internal\n   */\n  store = new EntityStore<CatalogItem, CatalogItemState>([]);\n\n  /**\n   * Whether all the layers of the group are added\n   * @internal\n   */\n  added$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  preview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Whether the toggle button is disabled\n   * @internal\n   */\n  disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Catalog group\n   */\n  @Input() group: CatalogItemGroup;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Whether the group is collapsed\n   */\n  @Input() collapsed: boolean = true;\n\n  @Input() resolution: number;\n\n  @Input() catalogAllowLegend = false;\n\n  /**\n   * Whether the group can be toggled when it's collapsed\n   */\n  @Input() toggleCollapsed: boolean = true;\n\n  /**\n   * Parent catalog's items store state. Groups share a unique\n   * EntityState that tracks the group and it's layers state (whether they are added or not).\n   * Sharing a unique state would also allow us to expand this component to allow\n   * the selection of a layer while unselecting any layer already selected in another group.\n   * This could be useful to display some layer info before adding it, for example.\n   */\n  @Input() state: EntityStateManager<CatalogItem, CatalogItemState>;\n\n  /**\n   * Event emitted when the add/remove button of the group is clicked\n   */\n  @Output() addedChange = new EventEmitter<{\n    added: boolean;\n    group: CatalogItemGroup;\n  }>();\n\n  /**\n   * Event emitted when the add/remove button of a layer is clicked\n   */\n  @Output() layerAddedChange = new EventEmitter<{\n    added: boolean;\n    layer: CatalogItemLayer;\n  }>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return this.group.title;\n  }\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.load(this.group.items);\n    this.evaluateAdded();\n    this.evaluateDisabled(this.collapsed);\n    if (this.group.sortDirection !== undefined) {\n      this.store.view.sort({\n        direction: this.group.sortDirection,\n        valueAccessor: (item: CatalogItem) => item.title\n        });\n    }\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  /**\n   * @internal\n   */\n  isGroup(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Group;\n  }\n\n  /**\n   * @internal\n   */\n  isLayer(item: CatalogItem): boolean {\n    return item.type === CatalogItemType.Layer;\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick() {\n    this.added$.value ? this.remove() : this.add();\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleCollapsed(collapsed: boolean) {\n    this.evaluateDisabled(collapsed);\n  }\n\n  /**\n   * When a layer is added or removed, evaluate if all the layers of the group\n   * are now added or removed. If so, consider that the group itself is added\n   * or removed.\n   * @internal\n   * @param event Layer added change event\n   */\n  onLayerAddedChange(event: { added: boolean; layer: CatalogItemLayer }) {\n    this.layerAddedChange.emit(event);\n    this.tryToggleGroup(event);\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private add() {\n    this.added$.next(true);\n    this.addedChange.emit({\n      added: true,\n      group: this.group\n    });\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private remove() {\n    this.added$.next(false);\n    this.addedChange.emit({\n      added: false,\n      group: this.group\n    });\n  }\n\n  onLayerPreview(event) {\n    this.preview$.next(event);\n  }\n\n  /**\n   * If all the layers of the group added or removed, add or remove the group itself.\n   * @param event The last layer added change event to occur\n   */\n  private tryToggleGroup(event: { added: boolean; layer: CatalogItemLayer }) {\n    const added = event.added;\n    const layer = event.layer;\n\n    const layersAdded = this.store.view\n      .all()\n      .filter((item: CatalogItem) => item.id !== layer.id)\n      .map((item: CatalogItem) => this.state.get(item).added || false);\n\n    if (layersAdded.every(value => value === added)) {\n      added ? this.add() : this.remove();\n    } else if (this.added$.value === true) {\n      this.added$.next(false);\n    }\n  }\n\n  private evaluateAdded() {\n    const added = this.store.all().every((item: CatalogItem) => {\n      return (this.state.get(item).added || false) === true;\n    });\n    this.added$.next(added);\n  }\n\n  private evaluateDisabled(collapsed: boolean) {\n    let disabled = false;\n    if (this.toggleCollapsed === false) {\n      disabled = collapsed;\n    }\n    this.disabled$.next(disabled);\n  }\n\n  onTitleClick() {\n    this.collapsed = !this.collapsed;\n  }\n}\n","import { Injectable } from '@angular/core';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class LayerListToolService {\n  public keyword: string;\n  public sortAlpha = false;\n  public onlyVisible = false;\n  public onlyInRange = false;\n  public keywordInitialized = false;\n  public sortedAlphaInitialized = false;\n  public onlyVisibleInitialized = false;\n  public onlyInRangeInitialized = false;\n\n  constructor() {}\n\n}\n","<mat-list-item class= \"igo-layer-list-item\">\n  <mat-checkbox *ngIf=\"selectionMode\"\n    class=\"layerCheck\"\n    mat-list-icon\n    (change)=\"check()\"\n    [checked]=\"layerCheck\">\n  </mat-checkbox>\n  <h4 (click)=\"toggleLegendOnClick()\" matLine class=\"igo-layer-title\" [matTooltip]=\"tooltipText\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n\n  <button *ngIf=\"!selectionMode\"\n    mat-icon-button\n    [color]=\"layer.visible ? 'primary' : 'default'\"\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"eyeTooltip | translate\"\n    (click)=\"toggleVisibility()\">\n    <mat-icon\n      matBadge=\"?\"\n      matBadgeColor=\"accent\"\n      matBadgeSize=\"small\"\n      matBadgePosition=\"after\"\n      [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n      [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n      [svgIcon]=\"(layer.visible$ | async) ? 'eye' : 'eye-off'\">\n    </mat-icon>\n  </button>\n\n  <button *ngIf=\"selectionMode\" class=\"selection-eye\"\n  mat-icon-button\n  [color]=\"layer.visible ? 'primary' : 'default'\"\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"layer.visible ?\n                ('igo.geo.layer.hideLayer' | translate) :\n                ('igo.geo.layer.showLayer' | translate)\"\n  (click)=\"toggleVisibility()\">\n  <mat-icon\n    matBadge=\"?\"\n    matBadgeColor=\"accent\"\n    matBadgeSize=\"small\"\n    matBadgePosition=\"after\"\n    [matBadgeHidden]=\"queryBadgeHidden$ | async\"\n    [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n    [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n  </mat-icon>\n</button>\n\n  <button *ngIf=\"!selectionMode\"\n    class=\"actions-button\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]= \"'igo.geo.layer.moreOptions' | translate\"\n    mat-icon-button\n    color=\"primary\"\n    (click)=\"toggleLayerTool()\">\n    <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\n  </button>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    *ngIf=\"showLegend$ | async\"\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n  </igo-layer-legend>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  Renderer2,\n  ElementRef,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { layerIsQueryable } from '../../query/shared/query.utils';\nimport { Layer, TooltipType } from '../shared/layers';\nimport { NetworkService, ConnectionState } from '@igo2/core';\n\n@Component({\n  selector: 'igo-layer-item',\n  templateUrl: './layer-item.component.html',\n  styleUrls: ['./layer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerItemComponent implements OnInit, OnDestroy {\n  public focusedCls = 'igo-layer-item-focused';\n\n  @Input()\n  get activeLayer() {\n    return this._activeLayer;\n  }\n  set activeLayer(value) {\n    if (value && this.layer && value.id === this.layer.id && !this.selectionMode) {\n      this.layerTool$.next(true);\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n  }\n  private _activeLayer;\n\n  layerTool$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  queryBadgeHidden$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  @Input()\n  get selectAll() {\n    return this._selectAll;\n  }\n  set selectAll(value: boolean) {\n    this._selectAll = value;\n    if (value === true) {\n      this.layerCheck = true;\n    }\n  }\n  private _selectAll = false;\n\n  @Input() layerCheck;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n  private layers$$: Subscription;\n\n  layers$: BehaviorSubject<Layer> = new BehaviorSubject<Layer>(undefined);\n\n  @Input()\n  get layer() {\n    return this._layer;\n  }\n  set layer(value) {\n    this._layer = value;\n    this.layers$.next(value);\n  }\n  private _layer;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendIfVisible: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() orderable: boolean = true;\n\n  @Input() lowerDisabled: boolean = false;\n\n  @Input() raiseDisabled: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Input() selectionMode;\n\n  @Input() changeDetection;\n\n  get opacity() {\n    return this.layer.opacity * 100;\n  }\n  set opacity(opacity: number) {\n    this.layer.opacity = opacity / 100;\n  }\n\n  get eyeTooltip() {\n    if (this.inResolutionRange$.getValue() === false) {\n      return 'igo.geo.layer.notInResolution';\n    } else {\n      return this.layer.visible ? 'igo.geo.layer.hideLayer' : 'igo.geo.layer.showLayer';\n    }\n  }\n\n  @Output() action: EventEmitter<Layer> = new EventEmitter<Layer>(undefined);\n  @Output() checkbox = new EventEmitter<{\n    layer: Layer;\n    check: boolean;\n  }>();\n\n  constructor(\n    private networkService: NetworkService,\n    private renderer: Renderer2,\n    private elRef: ElementRef,\n    private cdRef: ChangeDetectorRef) {}\n\n  ngOnInit() {\n    if (\n      this.layer.visible &&\n      this.expandLegendIfVisible &&\n      this.layer.firstLoadComponent === true\n    ) {\n      this.layer.firstLoadComponent = false;\n      this.layer.legendCollapsed = false;\n    }\n    this.toggleLegend(this.layer.legendCollapsed);\n    this.updateQueryBadge();\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.state = state;\n      this.onResolutionChange();\n    });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layer && this.layer.options.active) {\n        this.layerTool$.next(true);\n        this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n      }\n    });\n\n    if (this.changeDetection) {\n      this.changeDetection.subscribe(() => this.cdRef.detectChanges());\n    }\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    this.toggleLegend(this.showLegend$.value);\n  }\n\n  toggleVisibility() {\n    this.layer.visible = !this.layer.visible;\n    if (this.toggleLegendOnVisibilityChange) {\n      this.toggleLegend(!this.layer.visible);\n    }\n    this.updateQueryBadge();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    if (\n      inResolutionRange === false &&\n      this.updateLegendOnResolutionChange === true\n    ) {\n      this.toggleLegend(true);\n    }\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n\n  private updateQueryBadge() {\n    const hidden =\n      this.queryBadge === false ||\n      this.layer.visible === false ||\n      !layerIsQueryable(this.layer);\n    this.queryBadgeHidden$.next(hidden);\n  }\n\n  toggleLayerTool() {\n    this.layerTool$.next(!this.layerTool$.getValue());\n    if (this.layerTool$.getValue() === true) {\n      this.renderer.addClass(this.elRef.nativeElement, this.focusedCls);\n    } else {\n      this.renderer.removeClass(this.elRef.nativeElement, this.focusedCls);\n    }\n    this.action.emit(this.layer);\n  }\n\n  public check() {\n    this.layerCheck = !this.layerCheck;\n    this.checkbox.emit({layer: this.layer, check: this.layerCheck});\n  }\n}\n","export enum LayerListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\nexport enum LayerListSelectVisibleEnum {\n  ALL_VISIBLE = 'ALL_VISIBLE',\n  ALL_HIDDEN = 'ALL_HIDDEN',\n  MIXED = 'MIXED',\n  NULL = 'NULL'\n}\n\nexport enum LayerListDisplacement {\n  Raise = 'raise',\n  Lower = 'lower',\n}\n","<mat-list>\n  <igo-layer-list-tool *ngIf=\"showToolbar$ | async\"\n    floatLabel=\"auto\"\n    [layersAreAllVisible]=\"layersAreAllVisible\"\n    [term]=\"layerFilterAndSortOptions.keyword\"\n    [onlyVisible]=\"layerFilterAndSortOptions.onlyVisible\"\n    [sortAlpha]=\"layerFilterAndSortOptions.sortAlpha\"\n    (appliedFilterAndSort)=\"onAppliedFilterAndSortChange($event)\"\n    (selection)=\"toggleSelectionMode($event)\">\n  </igo-layer-list-tool>\n</mat-list>\n\n<mat-list-item *ngIf=\"selection\" class=\"select-all\">\n  <mat-checkbox\n    class=\"select-all-checkbox mat-subheading-2\"\n    [color]=\"!selectAllCheck && layersChecked.length > 0 ? 'accent' : 'primary'\"\n    (change)=\"selectAll()\"\n    [checked]=\"selectAllCheck\"\n    [indeterminate]=\"!selectAllCheck && layersChecked.length > 0\"> {{selectAllCheck ? ('igo.geo.layer.deselectAll' | translate) : ('igo.geo.layer.selectAll' | translate)}}\n  </mat-checkbox>\n</mat-list-item>\n<mat-divider></mat-divider>\n\n<igo-list #igoList [ngClass]=\"{'igo-list-tools-multi': selection, 'igo-list-tools-single': (layerTool && !selection), 'igo-list-no-tools': (!layerTool && !selection)}\" [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n    <igo-layer-item *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n      igoListItem\n      [layer]=\"layer\"\n      [activeLayer]=\"activeLayer\"\n      [orderable]=\"orderable && !layer.baseLayer\"\n      [lowerDisabled]=\"getLowerLayer().id === layer.id\"\n      [raiseDisabled]=\"getUpperLayer().id === layer.id\"\n      [queryBadge]=\"queryBadge\"\n      [expandLegendIfVisible]=\"expandLegendOfVisibleLayers\"\n      [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\"\n      [toggleLegendOnVisibilityChange]=\"toggleLegendOnVisibilityChange\"\n      [selectionMode]=\"selection\"\n      [selectAll]=\"selectAllCheck\"\n      [layerCheck]=\"layer.options.check\"\n      [changeDetection]=\"layerItemChangeDetection$\"\n      (action)=\"toggleLayerTool($event)\"\n      (checkbox)=\"layersCheck($event)\">\n    </igo-layer-item>\n  </ng-template>\n</igo-list>\n\n<igo-panel *ngIf=\"!selection && layerTool && activeLayer\" class=\"igo-layer-actions-container\" [title]=\"activeLayer.title\">\n  <div class=\"igo-layer-button-group\">\n    <button\n      *ngIf=\"isLayerRemovable(activeLayer)\"\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.removeLayer' | translate\"\n      (click)=\"removeLayers()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterLowerLayer' | translate) : ('igo.geo.layer.lowerLayer' | translate)\"\n      [disabled]=\"lowerDisabled\"\n      (click)=\"moveActiveLayer(activeLayer,layerListDisplacement.Lower, true)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"lowerDisabled\"\n                svgIcon=\"arrow-down\"></mat-icon>\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterRaiseLayer' | translate) : ('igo.geo.layer.raiseLayer' | translate)\"\n      [disabled]=\"raiseDisabled\"\n      (click)=\"moveActiveLayer(activeLayer,layerListDisplacement.Raise, true)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"raiseDisabled\"\n                svgIcon=\"arrow-up\"></mat-icon>\n    </button>\n\n    <!-- <label>{{ 'igo.geo.layer.opacity' | translate }} </label> -->\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\">\n      <mat-icon [matBadge]=\"badgeOpacity\" matBadgeColor=\"primary\" matBadgeSize=\"medium\" svgIcon=\"opacity\"></mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\" class=\"mat-menu-opacity-slider\">\n      <div id=\"opacity-menu\">\n        <mat-slider\n          id=\"opacity-slider\"\n          color=\"primary\"\n          thumbLabel\n          tickInterval=\"5\"\n          step=\"5\"\n          [min]=\"0\"\n          [max]=\"100\"\n          [value]=\"opacity\"\n          (input)=\"changeOpacity($event)\"\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n          (click) = \"$event.stopPropagation()\"\n          matTooltipShowDelay=\"500\"\n          tooltip-position=\"below\">\n        </mat-slider>\n      </div>\n    </mat-menu>\n\n    <button\n      *ngIf=\"activeLayerExtentIsValid(activeLayer)\"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayer' | translate\"\n      (click)=\"zoomLayerExtents(activeLayer)\">\n      <mat-icon matBadgeColor=\"primary\" matBadgeSize=\"medium\" svgIcon=\"magnify-scan\"></mat-icon>\n    </button>\n\n    <ng-container igoLayerItemToolbar\n      [ngTemplateOutlet]=\"templateLayerToolbar\"\n      [ngTemplateOutletContext]=\"{layer: activeLayer}\">\n    </ng-container>\n\n    <ng-content select=\"[igoLayerItemToolbar]\"></ng-content>\n  </div>\n</igo-panel>\n\n<igo-panel *ngIf=\"selection && layers.length > 0\" class=\"igo-layer-actions-container\" [title]=\"'igo.geo.layer.tools' | translate\">\n  <div class=\"actions-buttons-multi\">\n    <button\n      class=\"delete-button\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"isAllLayersRemovable(layersChecked) ? ('igo.geo.layer.removeSelectedLayers' | translate) : 'igo.geo.layer.removeSelectedLayersRestriction' | translate\"\n      (click)=\"removeLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"'!'\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"isAllLayersRemovable(layersChecked)\"\n                svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <button\n      class=\"eye-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matTooltip]=\"statusSelectedLayersCheck === 'ALL_HIDDEN' ? ('igo.geo.layer.showSelectedLayers' | translate) : ('igo.geo.layer.hideSelectedLayers' | translate)\"\n      (click)=\"toggleVisibility(layersChecked)\">\n      <mat-icon\t[svgIcon]=\"(statusSelectedLayersCheck === 'ALL_HIDDEN') ? 'eye-off' : 'eye'\"></mat-icon>\n    </button>\n\n    <button\n      class=\"down-button\"\n      mat-icon-button\n      color=\"primary\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterLowerLayer' | translate) : ('igo.geo.layer.lowerLayer' | translate)\"\n      [disabled]=\"lowerDisabledSelection\"\n      (click)=\"lowerLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"lowerDisabledSelection\"\n                svgIcon=\"arrow-down\"></mat-icon>\n    </button>\n\n    <button\n      class=\"up-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"(sortAlpha || onlyVisible || keyword) ? ('igo.geo.layer.filterRaiseLayer' | translate) : ('igo.geo.layer.raiseLayer' | translate)\"\n      [disabled]=\"raiseDisabledSelection\"\n      (click)=\"raiseLayers(layersChecked)\">\n      <mat-icon [matBadge]=\"(sortAlpha || onlyVisible || keyword) ? '!' : ''\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" [matBadgeHidden]=\"raiseDisabledSelection\"\n                svgIcon=\"arrow-up\"></mat-icon>\n    </button>\n\n    <button\n      class=\"opacity-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [disabled]=\"layersChecked.length === 0\"\n      [matMenuTriggerFor]=\"opacityMenu\"\n      [matTooltip]=\"'igo.geo.layer.opacity' | translate\">\n      <mat-icon svgIcon=\"opacity\"></mat-icon>\n    </button>\n\n    <mat-menu #opacityMenu=\"matMenu\"  class=\"mat-menu-opacity-slider\">\n      <div id=\"opacity-menu\">\n        <mat-slider *ngIf=\"layersChecked.length\"\n          id=\"opacity-slider\"\n          color=\"primary\"\n          thumbLabel\n          tickInterval=\"5\"\n          step=\"5\"\n          [min]=\"0\"\n          [max]=\"100\"\n          [(ngModel)]=\"checkOpacity\"\n          [matTooltip]=\"'igo.geo.layer.opacity' | translate\"\n          matTooltipShowDelay=\"500\"\n          tooltip-position=\"below\"\n          (click) = \"$event.stopPropagation()\">\n        </mat-slider>\n      </div>\n    </mat-menu>\n\n    <button\n    *ngIf=\"layersChecked.length !== 0 && activeLayersExtentAreValid(layersChecked)\"\n      class=\"zoomLayer-button\"\n      color=\"primary\"\n      mat-icon-button\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.layer.zoomLayers' | translate\"\n      (click)=\"zoomLayersExtents(layersChecked)\">\n      <mat-icon svgIcon=\"magnify-scan\"></mat-icon>\n    </button>\n  </div>\n</igo-panel>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ContentChild,\n  OnInit,\n  OnDestroy,\n  Output,\n  EventEmitter,\n  ElementRef\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport scrollIntoView from 'scroll-into-view-if-needed';\n\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { LayerListControlsEnum, LayerListDisplacement } from './layer-list.enum';\nimport { LayerListSelectVisibleEnum } from './layer-list.enum';\nimport {\n  BehaviorSubject,\n  ReplaySubject,\n  Subscription,\n  EMPTY,\n  timer\n} from 'rxjs';\nimport { debounce } from 'rxjs/operators';\nimport {\n  MetadataOptions,\n  MetadataLayerOptions\n} from '../../metadata/shared/metadata.interface';\nimport { LayerListControlsOptions } from '../layer-list-tool/layer-list-tool.interface';\nimport { IgoMap } from '../../map/shared/map';\nimport { Layer } from '../shared/layers/layer';\nimport { LinkedProperties } from '../shared/layers/layer.interface';\nimport { MatSliderChange } from '@angular/material/slider';\nimport * as olextent from 'ol/extent';\nimport { getAllChildLayersByProperty, getRootParentByProperty } from '../../map/shared/linkedLayers.utils';\n\n// TODO: This class could use a clean up. Also, some methods could be moved ealsewhere\n@Component({\n  selector: 'igo-layer-list',\n  templateUrl: './layer-list.component.html',\n  styleUrls: ['./layer-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerListComponent implements OnInit, OnDestroy {\n  orderable = true;\n  thresholdToFilterAndSort = 5;\n\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n\n  change$ = new ReplaySubject<void>(1);\n\n  showToolbar$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public layerTool: boolean;\n\n  public hideSelectedLayers: boolean = true;\n  activeLayer$: BehaviorSubject<Layer> = new BehaviorSubject(undefined);\n\n  layersChecked: Layer[] = [];\n  public selection: boolean;\n\n  private change$$: Subscription;\n  private layers$$: Subscription;\n  public layerItemChangeDetection$ = new BehaviorSubject(undefined);\n\n  @ContentChild('igoLayerItemToolbar', /* TODO: add static flag */ {})\n  templateLayerToolbar: TemplateRef<any>;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() ogcButton: boolean = true;\n\n  @Input() timeButton: boolean = true;\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = this.removeProblemLayerInList(value);\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n\n  set activeLayer(value: Layer) {\n    this._activeLayer = value;\n    this.activeLayer$.next(value);\n  }\n  get activeLayer(): Layer {\n    return this._activeLayer;\n  }\n  private _activeLayer: Layer;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input() layerFilterAndSortOptions: LayerListControlsOptions = {};\n\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() toggleLegendOnVisibilityChange: boolean = false;\n\n  @Input() expandLegendOfVisibleLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() queryBadge: boolean = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n\n  get keyword(): string {\n    return this._keyword;\n  }\n  set keyword(value: string) {\n    this._keyword = value;\n    this.next();\n  }\n  private _keyword = undefined;\n\n  get onlyVisible(): boolean {\n    return this._onlyVisible;\n  }\n  set onlyVisible(value: boolean) {\n    this._onlyVisible = value;\n    this.next();\n  }\n  private _onlyVisible = false;\n\n  get sortAlpha(): boolean {\n    return this._sortedAlpha;\n  }\n  set sortAlpha(value: boolean) {\n    this._sortedAlpha = value;\n    this.next();\n  }\n  private _sortedAlpha = false;\n\n  get opacity() {\n    return Math.round(this.activeLayer$.getValue().opacity * 100);\n  }\n  set opacity(opacity: number) {\n    this.activeLayer$.getValue().opacity = opacity / 100;\n  }\n\n  get badgeOpacity() {\n    if (this.opacity === 100) {\n      return;\n    }\n    return this.opacity;\n  }\n\n  get raiseDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getUpperLayer().id === this.activeLayer.id ||\n      this.isUpperBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabled(): boolean {\n    if (\n      !this.orderable ||\n      this.activeLayer.baseLayer ||\n      this.getLowerLayer().id === this.activeLayer.id ||\n      this.isLowerBaselayer(this.activeLayer)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get raiseDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.raisableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get lowerDisabledSelection(): boolean {\n    if (\n      this.layersChecked.length === 0 ||\n      !this.orderable ||\n      !this.lowerableLayers(this.layersChecked) ||\n      this.selectAllCheck === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  get checkOpacity() {\n    return this.layersCheckedOpacity() * 100;\n  }\n  set checkOpacity(opacity: number) {\n    for (const layer of this.layersChecked) {\n      layer.opacity = opacity / 100;\n    }\n  }\n\n  get layerListDisplacement(): typeof LayerListDisplacement {\n    return LayerListDisplacement;\n  }\n\n  public toggleOpacity = false;\n\n  public selectAllCheck: boolean;\n  public selectAllCheck$ = new BehaviorSubject<boolean>(undefined);\n  private selectAllCheck$$: Subscription;\n\n  constructor(private elRef: ElementRef) { }\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.layers.length === 0 ? EMPTY : timer(50);\n        })\n      )\n      .subscribe(() => {\n        this.showToolbar$.next(this.computeShowToolbar());\n        this.layers$.next(this.computeLayers(this.layers.slice(0)));\n        this.appliedFilterAndSort.emit({\n          keyword: this.keyword,\n          sortAlpha: this.sortAlpha,\n          onlyVisible: this.onlyVisible\n        });\n      });\n\n    this.selectAllCheck$$ = this.selectAllCheck$.subscribe((value) => {\n      this.selectAllCheck = value;\n    });\n\n    this.layers$$ = this.layers$.subscribe(() => {\n      if (this.layers) {\n        let checks = 0;\n        for (const layer of this.layers) {\n          layer.status$.subscribe(valStatus => {\n            if (valStatus === 0) {\n              this.map.removeLayer(layer);\n            }\n          });\n          if (layer.options.active) {\n            this.activeLayer = layer;\n            this.layerTool = true;\n          }\n          if (layer.options.check) {\n            checks += 1;\n          }\n        }\n        if (this.excludeBaseLayers) {\n          this.selectAllCheck =\n            checks ===\n              this.layers.filter(\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\n              ).length\n              ? true\n              : false;\n        } else {\n          this.selectAllCheck =\n            checks === this.layers.filter((lay) => lay.showInLayerList).length\n              ? true\n              : false;\n        }\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n    this.selectAllCheck$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  activeLayerExtentIsValid(layer: Layer): boolean {\n    let valid = false;\n    if (layer.options.showButtonZoomToExtent === false) {\n      return false;\n    }\n    const layerExtent = layer.options.extent;\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    if (layerExtent) {\n      if (maxLayerZoomExtent) {\n        valid = olextent.containsExtent(maxLayerZoomExtent, layerExtent);\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  activeLayersExtentAreValid(layers: Layer[]): boolean {\n    let valid = false;\n    const layersExtent = olextent.createEmpty();\n    const maxLayerZoomExtent = this.map.viewController.maxLayerZoomExtent;\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent && !layerExtent.includes(Infinity)) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n\n    if (!olextent.isEmpty(layersExtent)) {\n      if (maxLayerZoomExtent) {\n        valid = (olextent.containsExtent(maxLayerZoomExtent, layersExtent));\n      } else {\n        valid = true;\n      }\n    }\n    return valid;\n  }\n\n  zoomLayerExtents(layer: Layer) {\n    this.map.viewController.zoomToExtent(layer.options.extent);\n  }\n\n  zoomLayersExtents(layers: Layer[]) {\n    const layersExtent = olextent.createEmpty() as [number, number, number, number];\n\n    for (const layer of layers) {\n      const layerExtent = layer.options.extent;\n\n      if (layerExtent) {\n        olextent.extend(layersExtent, layerExtent);\n      }\n    }\n    this.map.viewController.zoomToExtent(layersExtent);\n  }\n\n  changeOpacity(event: MatSliderChange){\n    this.opacity = event.value;\n  }\n\n  clearKeyword() {\n    this.keyword = undefined;\n  }\n\n  getLowerLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex < current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isLowerBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index + 1] &&\n      this.layers[index + 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  getUpperLayer() {\n    return this.layers\n      .filter((l) => !l.baseLayer)\n      .reduce(\n        (prev, current) => {\n          return prev.zIndex > current.zIndex ? prev : current;\n        },\n        { zIndex: undefined, id: undefined }\n      );\n  }\n\n  isUpperBaselayer(layer) {\n    const index = this.layers.findIndex((lay) => layer.id === lay.id);\n    if (\n      this.layers &&\n      this.layers[index - 1] &&\n      this.layers[index - 1].baseLayer === true\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  moveActiveLayer(activeLayer: Layer, actiontype: LayerListDisplacement, fromUi: boolean = false) {\n    const sortedLayersToMove = [];\n    getRootParentByProperty(this.map,activeLayer,LinkedProperties.ZINDEX);\n    let rootParentByProperty = getRootParentByProperty(this.map,activeLayer,LinkedProperties.ZINDEX);\n    if (!rootParentByProperty) {\n      rootParentByProperty = activeLayer;\n    }\n    const layersToMove = [rootParentByProperty];\n    getAllChildLayersByProperty(this.map, rootParentByProperty, layersToMove, LinkedProperties.ZINDEX);\n\n    this.layers.map(layer => {\n      if (layersToMove.indexOf(layer) !== -1) {\n        sortedLayersToMove.push(layer);\n      }\n    });\n\n    if (actiontype === LayerListDisplacement.Raise) {\n      this.raiseLayers(sortedLayersToMove, fromUi);\n    } else if (actiontype === LayerListDisplacement.Lower) {\n      this.lowerLayers(sortedLayersToMove, fromUi);\n    }\n  }\n\n  /*\n   * For selection mode disabled attribute\n   */\n  raisableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const previousLayer = this.layers[mapIndex - 1];\n      if (\n        previousLayer &&\n        previousLayer.baseLayer !== true &&\n        !layers.find((lay) => previousLayer.id === lay.id) &&\n        currentLayer.baseLayer !== true\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  raisableLayer(index: number) {\n    if (index < 1) {\n      return false;\n    }\n\n    if (this.layers[index - 1].options.check) {\n      return this.raisableLayer(index - 1);\n    }\n    return true;\n  }\n\n  raiseLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToRaise = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.raisableLayer(index)) {\n        layersToRaise.push(layer);\n      }\n    }\n    this.map.raiseLayers(layersToRaise);\n    if (fromUi) {\n      setTimeout(() => {\n        const checkItems = this.elRef.nativeElement.getElementsByClassName('mat-checkbox-checked');\n        const itemFocused = this.elRef.nativeElement.getElementsByClassName('igo-layer-item-focused');\n        let targetToScroll;\n        if (checkItems.length) {\n          targetToScroll = checkItems[0];\n        }\n        if (itemFocused.length) {\n          targetToScroll = itemFocused[0];\n        }\n        if (targetToScroll) {\n          scrollIntoView(targetToScroll, {\n            scrollMode: 'if-needed',\n            behavior: 'smooth',\n            block: 'end',\n            inline: 'nearest'\n          });\n        }\n      }, 100);\n    }\n  }\n  /*\n   * For selection mode disabled attribute\n   */\n  lowerableLayers(layers: Layer[]) {\n    let response = false;\n    let base = 0;\n    for (const layer of layers) {\n      const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n      const currentLayer = this.layers[mapIndex];\n      if (currentLayer.baseLayer) {\n        base += 1;\n      }\n\n      const nextLayer = this.layers[mapIndex + 1];\n      if (\n        nextLayer &&\n        nextLayer.baseLayer !== true &&\n        !layers.find((lay) => nextLayer.id === lay.id)\n      ) {\n        response = true;\n      }\n    }\n\n    if (\n      (this.layersChecked.length === 1 && this.layersChecked[0].baseLayer) ||\n      base === this.layersChecked.length\n    ) {\n      response = false;\n    }\n    return response;\n  }\n\n  /*\n   * When multiple layers is selected but some may be allow to move\n   */\n  lowerableLayer(index: number) {\n    if (\n      index >\n      this.layers.filter((lay) => lay.baseLayer !== true).length - 2\n    ) {\n      return false;\n    }\n\n    if (this.layers[index + 1].options.check) {\n      return this.lowerableLayer(index + 1);\n    }\n    return true;\n  }\n\n  lowerLayers(layers: Layer[], fromUi: boolean = true) {\n    const layersToLower = [];\n    for (const layer of layers) {\n      const index = this.layers.findIndex((lay) => lay.id === layer.id);\n      if (this.lowerableLayer(index)) {\n        layersToLower.push(layer);\n      }\n    }\n    this.map.lowerLayers(layersToLower);\n    if (fromUi) {\n      setTimeout(() => {\n        const checkItems = this.elRef.nativeElement.getElementsByClassName('mat-checkbox-checked');\n        const itemFocused = this.elRef.nativeElement.getElementsByClassName('igo-layer-item-focused');\n        let targetToScroll;\n        if (checkItems.length) {\n          targetToScroll = checkItems[checkItems.length-1];\n        }\n        if (itemFocused.length) {\n          targetToScroll = itemFocused[0];\n        }\n        if (targetToScroll) {\n          scrollIntoView(targetToScroll, {\n            scrollMode: 'if-needed',\n            behavior: 'smooth',\n            block: 'end',\n            inline: 'nearest'\n          });\n        }\n      }, 100);\n    }\n  }\n  private next() {\n    this.change$.next();\n  }\n\n  private computeLayers(layers: Layer[]): Layer[] {\n    let layersOut = this.filterLayers(layers);\n    if (this.sortAlpha) {\n      layersOut = this.sortLayersByTitle(layersOut);\n    } else {\n      layersOut = this.sortLayersByZindex(layersOut);\n    }\n    return layersOut;\n  }\n\n  onKeywordChange(term) {\n    this.keyword = term;\n  }\n\n  onAppliedFilterAndSortChange(appliedFilter: LayerListControlsOptions) {\n    this.keyword = appliedFilter.keyword;\n    this.onlyVisible = appliedFilter.onlyVisible;\n    this.sortAlpha = appliedFilter.sortAlpha;\n  }\n\n  private filterLayers(layers: Layer[]): Layer[] {\n    if (\n      this.layerFilterAndSortOptions.showToolbar === LayerListControlsEnum.never\n    ) {\n      return layers;\n    }\n    if (!this.keyword && !this.onlyVisible) {\n      return layers;\n    }\n\n    const keepLayerIds = layers.map((layer: Layer) => layer.id);\n\n    layers.forEach((layer: Layer) => {\n      const layerOptions = (layer.options as MetadataLayerOptions) || {};\n      const dataSourceOptions = layer.dataSource.options || {};\n      const metadata = layerOptions.metadata || ({} as MetadataOptions);\n      const keywords = metadata.keywordList || [];\n      const layerKeywords = keywords.map((kw: string) => {\n        return kw.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n      });\n\n      if (this.keyword && layer.title) {\n        const localKeyword = this.keyword\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const layerTitle = layer.title\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const dataSourceType = dataSourceOptions.type || '';\n        const keywordRegex = new RegExp(localKeyword, 'gi');\n        const keywordInList =\n          layerKeywords.find((kw: string) => keywordRegex.test(kw)) !==\n          undefined;\n        if (\n          !keywordRegex.test(layerTitle) &&\n          !(this.keyword.toLowerCase() === dataSourceType.toLowerCase()) &&\n          !keywordInList\n        ) {\n          const index = keepLayerIds.indexOf(layer.id);\n          if (index > -1) {\n            keepLayerIds.splice(index, 1);\n          }\n        }\n      }\n\n      if (this.onlyVisible && layer.visible === false) {\n        const index = keepLayerIds.indexOf(layer.id);\n        if (index > -1) {\n          keepLayerIds.splice(index, 1);\n        }\n      }\n    });\n\n    return layers.filter(\n      (layer: Layer) => keepLayerIds.indexOf(layer.id) !== -1\n    );\n  }\n\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  private sortLayersByTitle(layers: Layer[]) {\n    return layers.sort((a, b) => {\n      if (this.normalize(a.title) < this.normalize(b.title)) {\n        return -1;\n      }\n      if (this.normalize(a.title) > this.normalize(b.title)) {\n        return 1;\n      }\n      return 0;\n    });\n  }\n\n  private normalize(str: string) {\n    return str\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .toLowerCase();\n  }\n\n  private computeShowToolbar(): boolean {\n    switch (this.layerFilterAndSortOptions.showToolbar) {\n      case LayerListControlsEnum.always:\n        return true;\n      case LayerListControlsEnum.never:\n        return false;\n      default:\n        if (\n          this.layers.length >= this.thresholdToFilterAndSort ||\n          this.keyword ||\n          this.onlyVisible\n        ) {\n          return true;\n        }\n        return false;\n    }\n  }\n\n  toggleLayerTool(layer) {\n    this.toggleOpacity = false;\n    if (this.layerTool && layer === this.activeLayer) {\n      this.layerTool = false;\n    } else {\n      this.layerTool = true;\n    }\n\n    for (const lay of this.layers) {\n      lay.options.active = false;\n    }\n    layer.options.active = true;\n    this.activeLayer = layer;\n  }\n\n  removeLayers(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      this.layersChecked = [];\n      for (const layer of layers) {\n        if (layer.options.removable !== false) {\n          layer.map.removeLayer(layer);\n        } else {\n          this.layersChecked.push(layer);\n        }\n      }\n    } else if (!layers && this.activeLayer.options.removable !== false) {\n      this.activeLayer.map.removeLayer(this.activeLayer);\n      this.layerTool = false;\n    }\n  }\n\n  toggleVisibility(layers?: Layer[]) {\n    if (layers && layers.length > 0) {\n      for (const layer of layers) {\n        layer.visible = this.hideSelectedLayers;\n      }\n    }\n    this.layerItemChangeDetection$.next(true);\n  }\n\n  isLayerRemovable(layer: Layer): boolean {\n    return layer.options.removable !== false;\n  }\n\n  isAllLayersRemovable(layers: Layer[]): boolean {\n    return layers.every(l => this.isLayerRemovable(l));\n  }\n\n  get statusSelectedLayersCheck(): LayerListSelectVisibleEnum {\n    let statusSelectedLayers: LayerListSelectVisibleEnum =\n      LayerListSelectVisibleEnum.NULL;\n    let findTrue: boolean = false;\n    let findFalse: boolean = false;\n\n    if (this.layersChecked.length === 0) {\n      statusSelectedLayers = LayerListSelectVisibleEnum.NULL;\n    } else {\n      statusSelectedLayers = LayerListSelectVisibleEnum.MIXED;\n      this.hideSelectedLayers = false;\n\n      for (const layer2 of this.layersChecked) {\n        if (layer2.visible === true) {\n          findTrue = true;\n        }\n        if (layer2.visible === false) {\n          findFalse = true;\n        }\n      }\n\n      if (findTrue === true && findFalse === false) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_VISIBLE;\n      }\n      if (findTrue === false && findFalse === true) {\n        statusSelectedLayers = LayerListSelectVisibleEnum.ALL_HIDDEN;\n        this.hideSelectedLayers = true;\n      }\n    }\n\n    return statusSelectedLayers;\n  }\n\n  layersCheck(event: { layer: Layer; check: boolean }) {\n    event.layer.options.check = event.check;\n    if (event.check === true) {\n      const eventMapIndex = this.layers.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      for (const layer of this.layersChecked) {\n        const mapIndex = this.layers.findIndex((lay) => layer.id === lay.id);\n        if (eventMapIndex < mapIndex) {\n          this.layersChecked.splice(\n            this.layersChecked.findIndex((lay) => layer.id === lay.id),\n            0,\n            event.layer\n          );\n\n          if (this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter(\n                (lay) => lay.baseLayer !== true && lay.showInLayerList\n              ).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          } else if (!this.excludeBaseLayers) {\n            if (\n              this.layersChecked.length ===\n              this.layers.filter((lay) => lay.showInLayerList).length\n            ) {\n              this.selectAllCheck = true;\n            } else {\n              this.selectAllCheck = false;\n            }\n          }\n          return;\n        }\n      }\n      this.layersChecked.push(event.layer);\n    } else {\n      const index = this.layersChecked.findIndex(\n        (layer) => event.layer.id === layer.id\n      );\n      this.layersChecked.splice(index, 1);\n    }\n\n    if (this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter(\n          (lay) => lay.baseLayer !== true && lay.showInLayerList\n        ).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    } else if (!this.excludeBaseLayers) {\n      if (\n        this.layersChecked.length ===\n        this.layers.filter((lay) => lay.showInLayerList).length\n      ) {\n        this.selectAllCheck = true;\n      } else {\n        this.selectAllCheck = false;\n      }\n    }\n  }\n\n  toggleSelectionMode(value: boolean) {\n    this.selection = value;\n    this.activeLayer = undefined;\n    if (value === true) {\n      this.layerTool = false;\n      for (const layer of this.layers) {\n        if (layer.options.check) {\n          this.layersChecked.push(layer);\n        }\n      }\n    }\n  }\n\n  layersCheckedOpacity(): any {\n    if (this.layersChecked.length > 1) {\n      return 1;\n    } else {\n      const opacity = [];\n      for (const layer of this.layersChecked) {\n        opacity.push(layer.opacity);\n      }\n      return opacity;\n    }\n  }\n\n  selectAll() {\n    if (!this.selectAllCheck) {\n      for (const layer of this.layers) {\n        if (\n          this.excludeBaseLayers &&\n          layer.baseLayer !== true &&\n          layer.showInLayerList\n        ) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        } else if (!this.excludeBaseLayers && layer.showInLayerList) {\n          layer.options.check = true;\n          this.layersChecked.push(layer);\n        }\n      }\n      this.selectAllCheck$.next(true);\n    } else {\n      for (const layer of this.layers) {\n        layer.options.check = false;\n      }\n      this.layersChecked = [];\n      this.selectAllCheck$.next(false);\n    }\n  }\n\n  isScrolledIntoView(elemSource, elem) {\n    const docViewTop = elemSource.scrollTop;\n    const docViewBottom = docViewTop + elemSource.clientHeight;\n\n    const elemTop = elem.offsetTop;\n    const elemBottom = elemTop + elem.clientHeight;\n    return elemBottom <= docViewBottom && elemTop >= docViewTop;\n  }\n\n  removeProblemLayerInList(layersList: Layer[]): Layer[] {\n    for (const layer of layersList) {\n      if (layer.olLoadingProblem === true) {\n        this.map.removeLayer(layer);\n      }\n    }\n    return layersList;\n  }\n}\n","  <mat-list-item>\n      <mat-form-field class=\"inputFilter\" [floatLabel]=\"floatLabel\">\n        <input\n          matInput\n          [placeholder]=\"'igo.geo.layer.filterPlaceholder' | translate\"\n          [matTooltip]=\"'igo.geo.layer.subsetLayersListKeyword' | translate\"\n          matTooltipShowDelay=\"500\"\n          type=\"text\" [(ngModel)]=\"term\">\n        <button\n          mat-button\n          *ngIf=\"term\"\n          matSuffix\n          mat-icon-button\n          aria-label=\"Clear\"\n          color=\"warn\"\n          (click)=\"clearTerm()\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n        </button>\n      </mat-form-field>\n\n      <div [matTooltip]=\"sortAlpha ?\n      ('igo.geo.layer.sortMapOrder' | translate) :\n      ('igo.geo.layer.sortAlphabetically' | translate)\" matTooltipShowDelay=\"500\">\n        <button class=\"sort-alpha\" [color]=\"sortAlpha ? 'warn' : 'primary'\" mat-icon-button (click)=\"toggleSortAlpha()\">\n          <mat-icon [svgIcon]=\"sortAlpha ? 'sort-ascending' : 'sort-alphabetical-ascending'\"></mat-icon>\n        </button>\n      </div>\n\n       <div [matTooltip]=\"onlyVisible ?\n        ('igo.geo.layer.resetLayersList' | translate) :\n        ('igo.geo.layer.subsetLayersListOnlyVisible' | translate)\" matTooltipShowDelay=\"500\">\n         <button class=\"only-visible\" mat-icon-button [disabled]=\"layersAreAllVisible && !onlyVisible\"\n           [color]=\"onlyVisible ? 'warn' : 'primary'\" (click)=\"toggleOnlyVisible()\">\n           <mat-icon\n             matBadge=\"icon\"\n             igoMatBadgeIcon=\"eye\"\n             igoMatBadgeInverseColor=\"true\"\n             igoMatBadgeInheritColor=\"true\"\n             [svgIcon]=\"onlyVisible ? 'filter-remove' : 'filter'\">\n           </mat-icon>\n         </button>\n       </div>\n\n       <div [matTooltip]=\"selectionMode ?\n        ('igo.geo.layer.deactivateSelectionMode' | translate) :\n        ('igo.geo.layer.activateSelectionMode' | translate)\" matTooltipShowDelay=\"500\">\n         <button class=\"selection-mode\" mat-icon-button\n           color=\"primary\" (click)=\"toggleSelectionMode()\">\n           <mat-icon [svgIcon]=\"selectionMode ? 'checkbox-multiple-marked-outline' : 'checkbox-multiple-blank-outline'\"></mat-icon>\n         </button>\n       </div>\n\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit,\n  EventEmitter,\n  Output,\n  OnDestroy\n} from '@angular/core';\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { LayerListControlsOptions } from './layer-list-tool.interface';\n\n@Component({\n  selector: 'igo-layer-list-tool',\n  templateUrl: './layer-list-tool.component.html',\n  styleUrls: ['./layer-list-tool.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerListToolComponent implements OnInit, OnDestroy {\n  public onlyVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public sortAlpha$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public term$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n  onlyVisible$$: Subscription;\n  sortAlpha$$: Subscription;\n  term$$: Subscription;\n\n  @Input() layersAreAllVisible: boolean = true;\n\n  @Input() floatLabel: FloatLabelType = 'auto';\n\n  @Input()\n  set onlyVisible(value: boolean) {\n    this.onlyVisible$.next(value);\n  }\n  get onlyVisible(): boolean {\n    return this.onlyVisible$.value;\n  }\n\n  @Input()\n  set sortAlpha(value: boolean) {\n    this.sortAlpha$.next(value);\n  }\n  get sortAlpha(): boolean {\n    return this.sortAlpha$.value;\n  }\n\n  @Input()\n  set term(value: string) {\n    this.term$.next(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n\n  public selectionMode = false;\n\n  @Output() appliedFilterAndSort = new EventEmitter<LayerListControlsOptions>();\n  @Output() selection = new EventEmitter<boolean>();\n\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe(keyword => {\n      this.appliedFilterAndSort.emit({\n        keyword,\n        onlyVisible: this.onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n\n    this.onlyVisible$$ = this.onlyVisible$.subscribe(onlyVisible => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible,\n        sortAlpha: this.sortAlpha\n      });\n    });\n    this.sortAlpha$$ = this.sortAlpha$.subscribe(sortAlpha => {\n      this.appliedFilterAndSort.emit({\n        keyword: this.term,\n        onlyVisible: this.onlyVisible,\n        sortAlpha\n      });\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.onlyVisible$$.unsubscribe();\n    this.sortAlpha$$.unsubscribe();\n    this.term$$.unsubscribe();\n  }\n\n  clearTerm() {\n    this.term = undefined;\n  }\n  toggleSortAlpha() {\n    this.sortAlpha = !this.sortAlpha;\n  }\n\n  toggleOnlyVisible() {\n    this.onlyVisible = !this.onlyVisible;\n  }\n\n  toggleSelectionMode() {\n    this.selectionMode = !this.selectionMode;\n    this.selection.emit(this.selectionMode);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy, Optional } from '@angular/core';\nimport { Subscription, combineLatest } from 'rxjs';\n\nimport { RouteService } from '@igo2/core';\nimport { MapService } from '../../map/shared/map.service';\nimport { LayerListComponent } from './layer-list.component';\nimport { Layer } from '../shared/layers/layer';\nimport { map, debounceTime } from 'rxjs/operators';\n\n@Directive({\n  selector: '[igoLayerListBinding]'\n})\nexport class LayerListBindingDirective implements OnInit, OnDestroy {\n  private component: LayerListComponent;\n  private layersOrResolutionChange$$: Subscription;\n  layersVisibility$$: Subscription;\n\n  constructor(\n    @Self() component: LayerListComponent,\n    private mapService: MapService,\n    @Optional() private route: RouteService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input layers\n    // this.component.layers = [];\n    this.layersOrResolutionChange$$ = combineLatest([\n      this.mapService.getMap().layers$,\n      this.mapService.getMap().viewController.resolution$]\n    ).pipe(\n      debounceTime(10)\n    ).subscribe((bunch: [Layer[], number]) => {\n      const shownLayers = bunch[0].filter((layer: Layer) => {\n        return layer.showInLayerList === true;\n      });\n      this.component.layers = shownLayers;\n      this.setLayersVisibilityStatus(shownLayers, this.component.excludeBaseLayers);\n    });\n  }\n\n  private setLayersVisibilityStatus(layers: Layer[], excludeBaseLayers: boolean) {\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n    this.layersVisibility$$ = combineLatest(layers\n      .filter(layer => layer.baseLayer !== excludeBaseLayers )\n      .map((layer: Layer) => layer.visible$))\n      .pipe(map((visibles: boolean[]) => visibles.every(Boolean)))\n      .subscribe((allLayersAreVisible: boolean) =>\n        this.component.layersAreAllVisible = allLayersAreVisible);\n  }\n\n  ngOnDestroy() {\n    this.layersOrResolutionChange$$.unsubscribe();\n    if (this.layersVisibility$$ !== undefined) {\n      this.layersVisibility$$.unsubscribe();\n      this.layersVisibility$$ = undefined;\n    }\n  }\n\n}\n","\n<div class=\"layer-legend-list-container\">\n  <mat-slide-toggle \n  tooltip-position=\"above\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.layer.legend.showAll' | translate\"\n  [checked]=\"showAllLegendsValue\" class=\"mat-typography\" \n  *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\" [labelPosition]=\"'before'\" (change)=\"toggleShowAllLegends($event.checked)\">\n    {{'igo.geo.layer.legend.showAll' | translate}}\n  </mat-slide-toggle>\n  <mat-divider *ngIf=\"(layersInUi$ | async).length && allowShowAllLegends\"></mat-divider>\n  <igo-list [navigation]=\"false\" [selection]=\"false\">\n    <ng-template ngFor let-layer let-i=\"index\" [ngForOf]=\"layers$ | async\">\n      <igo-layer-legend-item *ngIf=\"!(excludeBaseLayers && layer.baseLayer)\"\n          igoListItem [layer]=\"layer\"\n          [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n      </igo-layer-legend-item>\n    </ng-template>\n  </igo-list>\n  <p class=\"layers-empty mat-typography\" \n    *ngIf=\"!showAllLegendsValue && (layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async)===false && allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleWithShowAllButton' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\" \n    *ngIf=\"!showAllLegendsValue && (layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async) && allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\"\n    *ngIf=\"(layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async)===false && !allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisible' | translate}} \n  </p>\n  <p class=\"layers-empty mat-typography\"\n    *ngIf=\"(layersInUi$ | async).length && (hasVisibleOrInRangeLayers$ | async)===false && (hasVisibleAndNotInRangeLayers$ | async) && !allowShowAllLegends\">\n    {{'igo.geo.layer.legend.noLayersVisibleButZoom' | translate}} \n  </p>\n\n</div>","import { Component, Input, ChangeDetectionStrategy, OnInit, OnDestroy, EventEmitter, Output } from '@angular/core';\nimport { Layer } from '../shared';\nimport { BehaviorSubject, ReplaySubject, Subscription, EMPTY, timer } from 'rxjs';\nimport { debounce } from 'rxjs/operators';\n\n@Component({\n  selector: 'igo-layer-legend-list',\n  templateUrl: './layer-legend-list.component.html',\n  styleUrls: ['./layer-legend-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendListComponent implements OnInit, OnDestroy {\n  orderable = true;\n\n  hasVisibleOrInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  hasVisibleAndNotInRangeLayers$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  layersInUi$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  layers$: BehaviorSubject<Layer[]> = new BehaviorSubject([]);\n  showAllLegend: boolean = false;\n  public change$ = new ReplaySubject<void>(1);\n  private change$$: Subscription;\n  @Input()\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.next();\n  }\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  private _layers: Layer[];\n  @Input() excludeBaseLayers: boolean = false;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  @Input() allowShowAllLegends: boolean = false;\n\n  @Input() showAllLegendsValue: boolean = false;\n\n  @Output() allLegendsShown = new EventEmitter<boolean>(false);\n\n  constructor() { }\n  ngOnInit(): void {\n    this.change$$ = this.change$\n      .pipe(debounce(() => {\n        return this.layers.length === 0 ? EMPTY : timer(50);\n      }))\n      .subscribe(() => {\n        const layers = this.computeShownLayers(this.layers.slice(0));\n        this.layers$.next(layers);\n        this.hasVisibleOrInRangeLayers$.next(\n          this.layers.slice(0)\n            .filter(layer => layer.baseLayer !== true)\n            .filter(layer => layer.visible$.value && layer.isInResolutionsRange$.value).length > 0\n        );\n        this.hasVisibleAndNotInRangeLayers$.next(\n          this.layers.slice(0)\n            .filter(layer => layer.baseLayer !== true)\n            .filter(layer => layer.visible$.value && !layer.isInResolutionsRange$.value).length > 0\n        );\n\n        this.layersInUi$.next(\n          this.layers.slice(0).filter(layer => layer.showInLayerList !== false && (!this.excludeBaseLayers || !layer.baseLayer))\n        );\n      });\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n  }\n  private next() {\n    this.change$.next();\n  }\n  private computeShownLayers(layers: Layer[]) {\n    let shownLayers = layers.filter((layer: Layer) => layer.visible && layer.isInResolutionsRange);\n    if (this.showAllLegendsValue) {\n      shownLayers = layers;\n    }\n    return this.sortLayersByZindex(shownLayers);\n  }\n  private sortLayersByZindex(layers: Layer[]) {\n    return layers.sort((layer1, layer2) => layer2.zIndex - layer1.zIndex);\n  }\n\n  toggleShowAllLegends(toggle: boolean) {\n      this.showAllLegendsValue = toggle;\n      this.next();\n      this.allLegendsShown.emit(toggle);\n  }\n}\n","<button *ngIf=\"options.trackFeature\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.layer.trackFeature' | translate\"\n  [color]=\"color\"\n  (click)=\"toggleTrackFeature()\">\n  <mat-icon svgIcon=\"crosshairs-gps\"></mat-icon>\n</button>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { VectorLayer } from '../shared/layers';\nimport { VectorLayerOptions } from '../shared/layers/vector-layer.interface';\n\n@Component({\n  selector: 'igo-track-feature-button',\n  templateUrl: './track-feature-button.component.html',\n  styleUrls: ['./track-feature-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TrackFeatureButtonComponent implements OnInit {\n\n  @Input() layer: VectorLayer;\n\n  @Input() trackFeature = false;\n\n  get options(): VectorLayerOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.options;\n  }\n\n  public color: string = 'primary';\n\n  constructor() {}\n\n  ngOnInit() {\n    this.color = this.trackFeature ? 'primary' : 'basic';\n  }\n\n  toggleTrackFeature() {\n    if (this.trackFeature) {\n      this.layer.disableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'basic';\n    } else {\n      this.layer.enableTrackFeature(this.layer.options.trackFeature);\n      this.color = 'primary';\n    }\n    this.trackFeature = !this.trackFeature;\n  }\n}\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { MetadataLayerOptions } from '../../metadata/shared/metadata.interface';\nimport { Layer, TooltipType } from '../shared/layers';\nimport { NetworkService, ConnectionState } from '@igo2/core';\n\n@Component({\n  selector: 'igo-layer-legend-item',\n  templateUrl: './layer-legend-item.component.html',\n  styleUrls: ['./layer-legend-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class LayerLegendItemComponent implements OnInit, OnDestroy {\n\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  tooltipText: string;\n\n  state: ConnectionState;\n\n  private resolution$$: Subscription;\n  private network$$: Subscription;\n\n  @Input() layer: Layer;\n\n  @Input() updateLegendOnResolutionChange: boolean = false;\n\n  constructor(private networkService: NetworkService) {}\n\n  ngOnInit() {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.onResolutionChange();\n    });\n    this.tooltipText = this.computeTooltip();\n\n    this.network$$ = this.networkService.currentState().subscribe((state: ConnectionState) => {\n      this.state = state;\n      this.onResolutionChange();\n    });\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.network$$.unsubscribe();\n  }\n\n  computeTooltip(): string {\n    const layerOptions = this.layer.options;\n    if (!layerOptions.tooltip) {\n      return this.layer.title;\n    }\n    const layerTooltip = layerOptions.tooltip;\n    const layerMetadata = (layerOptions as MetadataLayerOptions).metadata;\n    switch (layerOptions.tooltip.type) {\n      case TooltipType.TITLE:\n        return this.layer.title;\n      case TooltipType.ABSTRACT:\n        if (layerMetadata && layerMetadata.abstract) {\n          return layerMetadata.abstract;\n        } else {\n          return this.layer.title;\n        }\n      case TooltipType.CUSTOM:\n        if (layerTooltip && layerTooltip.text) {\n          return layerTooltip.text;\n        } else {\n          return this.layer.title;\n        }\n      default:\n        return this.layer.title;\n    }\n  }\n\n  private onResolutionChange() {\n    const inResolutionRange = this.layer.isInResolutionsRange;\n    this.inResolutionRange$.next(inResolutionRange);\n  }\n}\n","<mat-list-item class= \"igo-layer-list-item\">\n  <h4 matLine class=\"igo-layer-title\" [matTooltip]=\"tooltipText\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n</mat-list-item>\n\n<div #legend class=\"igo-layer-legend-container\">\n  <igo-layer-legend\n    [layer]=\"layer\"\n    [updateLegendOnResolutionChange]=\"updateLegendOnResolutionChange\">\n  </igo-layer-legend>\n</div>\n","export enum GeometryType {\n    Point = 'Point',\n    LineString = 'LineString',\n    Polygon = 'Polygon',\n    Circle = 'Circle'\n}\n\nexport enum FontType {\n    Arial = 'Arial',\n    ArialBlack = 'Arial Black',\n    Verdana = 'Verdana',\n    Tahoma = 'Tahoma',\n    TrebuchetMS = 'Trebuchet MS',\n    Impact = 'Impact',\n    TimesNewRoman = 'Times New Roman',\n    Georgia = 'Georgia',\n    AmericanTypewriter = 'American Typewriter',\n    Courier = 'Courier',\n    LucidaConsole = 'Lucida Console',\n    BrushScriptMT = 'Brush Script MT',\n    ComicSansMS = 'Comic Sans MS'\n}\n\nexport enum LabelType{\n    Coordinates = 'Coordinates',\n    Length = 'Length',\n    Area = 'Area',\n    Predefined = 'Predefined',\n    Custom = 'Custom'\n}\n\nexport enum CoordinatesUnit {\n    DecimalDegree = 'DD',\n    DegreesMinutesSeconds = 'DMS'\n\n}\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\n\n@Injectable({\n    providedIn: 'root'\n  })\nexport class DrawIconService {\n\n    protected icons: Array<string>;\n\n    constructor(\n      protected config: ConfigService\n    ) {\n        this.getIconsList();\n    }\n\n    getIcons() {\n        return this.icons;\n    }\n\n    getPath(): any {\n      return this.config.getConfig('drawingTool.icons') || [];\n    }\n\n    getIconsList() {\n      this.icons = this.getPath();\n    }\n}\n","\nexport const MEASURE_UNIT_AUTO = 'auto';\n\nexport enum MeasureType {\n  Length = 'length',\n  Area = 'area'\n}\n\nexport enum MeasureLengthUnit {\n  Meters = 'meters',\n  Kilometers = 'kilometers',\n  Miles = 'miles',\n  Feet = 'feet'\n}\n\nexport const MeasureLengthUnitAbbreviation = {\n  [MeasureLengthUnit.Meters]: 'm',\n  [MeasureLengthUnit.Kilometers]: 'km',\n  [MeasureLengthUnit.Miles]: 'mi',\n  [MeasureLengthUnit.Feet]: 'ft'\n};\n\nexport enum MeasureAreaUnit {\n  SquareMeters = 'squareMeters',\n  SquareKilometers = 'squareKilometers',\n  SquareMiles = 'squareMiles',\n  SquareFeet = 'squareFeet',\n  Hectares = 'hectares',\n  Acres = 'acres'\n}\n\nexport const MeasureAreaUnitAbbreviation = {\n  [MeasureAreaUnit.SquareMeters]: 'm',\n  [MeasureAreaUnit.SquareKilometers]: 'km',\n  [MeasureAreaUnit.SquareMiles]: 'mi',\n  [MeasureAreaUnit.SquareFeet]: 'ft',\n  [MeasureAreaUnit.Hectares]: 'ha',\n  [MeasureAreaUnit.Acres]: 'ac'\n};\n","import { LanguageService } from '@igo2/core';\nimport * as olstyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport OlOverlay from 'ol/Overlay';\nimport { getCenter as olGetCenter } from 'ol/extent';\nimport {\n  getLength as olGetLength,\n  getArea as olGetArea\n} from 'ol/sphere';\n\nimport { Measure } from './measure.interfaces';\nimport {\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation\n} from './measure.enum';\n\n/**\n * Convert value from meters to kilometers\n * @param value Value in meters\n * @returns Value in kilometers\n */\nexport function metersToKilometers(value: number): number {\n  return value * 0.001;\n}\n\n/**\n * Convert value from meters to feet\n * @param value Value in meters\n * @returns Value in feet\n */\nexport function metersToFeet(value: number): number {\n  return value * 3.2808;\n}\n\n/**\n * Convert value from meters to miles\n * @param value Value in meters\n * @returns Value in miles\n */\nexport function metersToMiles(value: number): number {\n  return value * 0.000621;\n}\n\n/**\n * Convert value from square meters to square kilometers\n * @param value Value in square meters\n * @returns Value in square kilometers\n */\nexport function squareMetersToSquareKilometers(value: number): number {\n  return value * 0.000001;\n}\n\n/**\n * Convert value from square meters to square miles\n * @param value Value in square meters\n * @returns Value in square miles\n */\nexport function squareMetersToSquareMiles(value: number): number {\n  return value * 0.0000003861;\n}\n\n/**\n * Convert value from square meters to square feet\n * @param value Value in square meters\n * @returns Value in square feet\n */\nexport function squareMetersToSquareFeet(value: number): number {\n  return value * 10.764;\n}\n\n/**\n * Convert value from square meters to hectares\n * @param value Value in square meters\n * @returns Value in hectares\n */\nexport function squareMetersToHectares(value: number): number {\n  return value * 0.0001;\n}\n\n/**\n * Convert value from square meters to acres\n * @param value Value in square meters\n * @returns Value in acres\n */\nexport function squareMetersToAcres(value: number): number {\n  return value * 0.00024711;\n}\n\n/**\n * Convert value from meters to the specified length unit\n * @param value Value in meters\n * @param unit Length unit\n * @returns Value in unit\n */\nexport function metersToUnit(value: number, unit: MeasureLengthUnit): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureLengthUnit.Meters, (val: number) => val],\n    [MeasureLengthUnit.Kilometers, metersToKilometers],\n    [MeasureLengthUnit.Miles, metersToMiles],\n    [MeasureLengthUnit.Feet, metersToFeet],\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * Convert value from square meters to the specified area unit\n * @param value Value in meters\n * @param unit Area unit\n * @returns Value in unit\n */\nexport function squareMetersToUnit(value: number, unit: MeasureAreaUnit): number | undefined {\n  const conversionMapper = new Map([\n    [MeasureAreaUnit.SquareMeters, (val: number) => val],\n    [MeasureAreaUnit.SquareKilometers, squareMetersToSquareKilometers],\n    [MeasureAreaUnit.SquareMiles, squareMetersToSquareMiles],\n    [MeasureAreaUnit.SquareFeet, squareMetersToSquareFeet],\n    [MeasureAreaUnit.Hectares, squareMetersToHectares],\n    [MeasureAreaUnit.Acres, squareMetersToAcres],\n  ]);\n  const conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n/**\n * This method format a measure to a readable format\n * @param measure Measure\n * @param options Formatting options\n * @returns Formatted measure\n */\nexport function formatMeasure(\n  measure: number,\n  options?: {\n    decimal?: number;\n    unit?: MeasureAreaUnit | MeasureLengthUnit;\n    unitAbbr?: boolean;\n    locale?: string;\n  },\n  languageService?: LanguageService) {\n  let decimal = options.decimal;\n  if (decimal === undefined || decimal < 0) {\n    decimal = 1;\n  }\n\n  const parts = [];\n  if (options.locale !== undefined) {\n    parts.push(measure.toLocaleString(options.locale, {\n      minimumFractionDigits: decimal,\n      maximumFractionDigits: decimal\n    }));\n  } else {\n    parts.push(measure.toFixed(decimal).toString());\n  }\n\n  if (options.unit !== undefined && options.unitAbbr === true) {\n    if (languageService) {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit] ?\n          languageService.translate.instant('igo.geo.measure.' + MeasureLengthUnitAbbreviation[options.unit]) :\n          languageService.translate.instant('igo.geo.measure.' + MeasureAreaUnitAbbreviation[options.unit])\n      );\n    } else {\n      parts.push(\n        MeasureLengthUnitAbbreviation[options.unit] || MeasureAreaUnitAbbreviation[options.unit]\n      );\n    }\n  }\n\n  return parts.filter(p => p !== undefined).join(' ');\n}\n\n/**\n * Compute best length measure unit for a given measure in meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestLengthUnit(value: number): MeasureLengthUnit {\n  let unit = MeasureLengthUnit.Meters;\n  let converted = value;\n  const possibleUnits = [MeasureLengthUnit.Kilometers];\n  while (converted > 1000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = metersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Compute best length measure unit for a given measure in square meters\n * @param value Value in meters\n * @returns Measure unit\n */\nexport function computeBestAreaUnit(value: number): MeasureAreaUnit {\n  let unit = MeasureAreaUnit.SquareMeters;\n  let converted = value;\n  const possibleUnits = [MeasureAreaUnit.SquareKilometers];\n  while (converted > 1000000 && possibleUnits.length > 0) {\n    unit = possibleUnits.pop();\n    converted = squareMetersToUnit(value, unit);\n  }\n  return unit;\n}\n\n/**\n * Create a default style for a measure interaction\n * @returns OL style\n */\nexport function createMeasureInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      lineDash: [10, 10],\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    }),\n    image: new olstyle.Circle({\n      radius: 5,\n      stroke: new olstyle.Stroke({\n        color: '#ffcc33',\n      }),\n      fill: new olstyle.Fill({\n        color: 'rgba(255, 255, 255, 0.2)'\n      })\n    })\n  });\n}\n\n/**\n * Create a default style for a measure layer\n * @returns OL style\n */\nexport function createMeasureLayerStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color: '#ffcc33',\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: 'rgba(255, 255, 255, 0.2)'\n    })\n  });\n}\n\n/**\n * Compute the length in meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Length in meters\n */\nexport function measureOlGeometryLength(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): number | undefined {\n  if (olGeometry instanceof OlPoint) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetLength(olGeometry, {projection});\n}\n\n/**\n * Compute the area in square meters of an OL geometry with a given projection\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Area in square meters\n */\nexport function measureOlGeometryArea(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): number | undefined {\n  if (olGeometry instanceof OlPoint || olGeometry instanceof OlLineString) {\n    return undefined;\n  }\n  if (olGeometry.getFlatCoordinates().length === 0) {\n    return undefined;\n  }\n  return olGetArea(olGeometry, {projection});\n}\n\n/**\n * Compute the area (square meters), length (meters) and last length (meters)\n * of an OL geometry with a given projection.\n * @param olGeometry Ol geometry\n * @param projection olGeometry's projection\n * @returns Computed measure\n */\nexport function measureOlGeometry(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle, projection: string): Measure {\n  const length = measureOlGeometryLength(olGeometry, projection);\n  const area = measureOlGeometryArea(olGeometry, projection);\n\n  const lengths = [];\n  const coordinates = olGeometry.getFlatCoordinates();\n  const coordinatesLength = coordinates.length;\n  for (let i = 0; i <= coordinatesLength - 4; i += 2) {\n    const olSegment = new OlLineString([\n      [coordinates[i], coordinates[i + 1]],\n      [coordinates[i + 2], coordinates[i + 3]]\n    ]);\n\n    lengths.push(measureOlGeometryLength(olSegment, projection));\n  }\n\n  return {\n    area,\n    length,\n    lengths\n  };\n}\n\n/**\n * Update an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nexport function updateOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n  } else {\n    olMidpoints = getOlGeometryMidpoints(olGeometry);\n    // TODO: handle multi geometries\n    const coordinates = olGeometry.getFlatCoordinates();\n    const midpointsLength = olMidpoints.length;\n    for (let i = 0; i < midpointsLength; i++) {\n      const j = i * 2;\n      const olSegment = new OlLineString([\n        [coordinates[j], coordinates[j + 1]],\n        [coordinates[j + 2], coordinates[j + 3]]\n      ]);\n\n      const midpointCoordinate = olSegment.getCoordinateAt(0.5);\n      const olMidpoint = olMidpoints[i];\n      if (olMidpoint !== undefined) {\n        olMidpoint.setCoordinates(midpointCoordinate);\n      } else {\n        olMidpoints[i] = new OlPoint(midpointCoordinate);\n      }\n    }\n  }\n  return olMidpoints;\n}\n\n/**\n * Clear an OL geometry midpoints and return an array of those points\n * @param olGeometry OL Geometry\n */\nexport function clearOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle) {\n  const olMidpoints = olGeometry.get('_midpoints') || [];\n  const midpointsLength = olMidpoints.length;\n  for (let i = 0; i < midpointsLength; i++) {\n    const olMidpoint = olMidpoints[i];\n    if (olMidpoint !== undefined) {\n      if (olMidpoint !== undefined) {\n        clearOlMidpointTooltip(olMidpoint);\n      }\n    }\n  }\n\n  olGeometry.set('_midpoints', undefined, true);\n\n  return olMidpoints;\n}\n\n/**\n * Return an array of  OL geometry midpoints, if any\n * @param olGeometry OL Geometry\n * @returns OL points\n */\nfunction getOlGeometryMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint[] {\n  let expectedNumber;\n  if (olGeometry instanceof OlCircle) {\n    expectedNumber = 0;\n  } else {\n    expectedNumber = Math.max((olGeometry.getFlatCoordinates().length / 2) - 1, 0);\n  }\n  // TODO: This works but it's quite messy. If time permits,\n  // clean this. Maybe a Tooltip class could handle that\n  let olMidpoints = olGeometry.get('_midpoints');\n\n  if (olMidpoints === undefined) {\n    if (olGeometry instanceof OlPoint) {\n      olMidpoints = new Array(1);\n    } else {\n      olMidpoints = new Array(expectedNumber);\n    }\n    olGeometry.set('_midpoints', olMidpoints, true);\n    return olMidpoints;\n  }\n\n  if (expectedNumber === 0) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber === olMidpoints.length) {\n    return olMidpoints;\n  }\n\n  if (expectedNumber > olMidpoints.length) {\n    olMidpoints.push(...new Array(expectedNumber - olMidpoints.length));\n    return olMidpoints;\n  }\n\n  for (let i = expectedNumber; i < olMidpoints.length; i++) {\n    const olMidpoint = olMidpoints[expectedNumber];\n    if (olMidpoint !== undefined) {\n      clearOlMidpointTooltip(olMidpoint);\n    }\n  }\n  olMidpoints.splice(expectedNumber);\n\n  return olMidpoints;\n}\n\n/**\n * Remove an OL midpoint's tooltip from the map\n * @param olMidpoint OL Point\n */\nfunction clearOlMidpointTooltip(olMidpoint: OlPoint) {\n  const olTooltip = olMidpoint.get('_tooltip');\n  if (olTooltip !== undefined) {\n    const olMap = olTooltip.getMap();\n    if (olMap !== undefined) {\n      olMap.removeOverlay(olTooltip);\n    }\n  }\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  let typeGeom = '';\n  if (olGeometry instanceof OlLineString) {\n  typeGeom = 'line-';\n  } else if (olGeometry instanceof OlPolygon) {\n    typeGeom = 'polygone-';\n    }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipAtPoint(olMidpoint, false, typeGeom);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipsAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olMidpoints = getOlGeometryMidpoints(olGeometry);\n  return olMidpoints.map((olMidpoint: OlPoint) => {\n    return olMidpoint ? olMidpoint.get('_tooltip') : undefined;\n  });\n}\n\n/**\n * Update an OL geometry center and return it\n * @param olGeometry OL Geometry\n * @returns OL point\n */\nexport function updateOlGeometryCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlPoint {\n  let olCenter = olGeometry.get('_center');\n  const centerCoordinate = olGetCenter(olGeometry.getExtent());\n  if (olCenter !== undefined) {\n    olCenter.setCoordinates(centerCoordinate);\n  } else {\n    olCenter = new OlPoint(centerCoordinate);\n    olGeometry.set('_center', olCenter);\n  }\n\n  return olCenter;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipAtCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipAtPoint(olCenter, true);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Return an array of OL overlay at midspoints, if any\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getOlTooltipAtCenter(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay {\n  const olCenter = olGeometry.get('_center');\n  return olCenter ? olCenter.get('_tooltip') : undefined;\n}\n\n/**\n * Get all the tooltips of an OL geometry\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function getTooltipsOfOlGeometry(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  const olTooltips = [].concat(getOlTooltipsAtMidpoints(olGeometry) || []);\n  const olCenterTooltip = getOlTooltipAtCenter(olGeometry);\n  if (olCenterTooltip !== undefined) {\n    olTooltips.push(olCenterTooltip);\n  }\n  return olTooltips;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipAtPoint(olPoint: OlPoint, center: boolean = false, srcGeomType: string= ''): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: (center ?\n    [ 'igo-map-tooltip',\n      'igo-map-tooltip-measure', 'igo-map-tooltip-measure-area'] : ['igo-map-tooltip', 'igo-map-tooltip-measure',\n      `igo-map-tooltip-measure-${srcGeomType}segments`]).join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n","import * as Olstyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport OlOverlay from 'ol/Overlay';\nimport {\n  updateOlGeometryMidpoints,\n  updateOlGeometryCenter\n} from '../../measure/shared/measure.utils';\nimport { CoordinatesUnit } from './draw.enum';\nimport { convertDDToDMS, roundCoordToString } from '../../map/shared/map.utils';\n\n\n/**\n * Create a default style\n * @param fillColor the fill color\n * @param strokeColor the stroke color\n * @param strokeWidth the stroke width\n * @param label a label\n * @returns OL style\n */\nexport function createInteractionStyle(fillColor?: string, strokeColor?: string, strokeWidth?: number, label?: string): Olstyle.Style {\n  return new Olstyle.Style({\n    stroke: new Olstyle.Stroke({\n      color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n      width: strokeWidth ? strokeWidth : 1\n    }),\n    fill: new Olstyle.Fill({\n      color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n    }),\n    image: new Olstyle.Circle({\n      radius: 5,\n      stroke: new Olstyle.Stroke({\n        color: strokeColor ? strokeColor : 'rgba(143,7,7,1)',\n        width: strokeWidth ? strokeWidth : 1\n      }),\n      fill: new Olstyle.Fill({\n        color: fillColor ? fillColor : 'rgba(255,255,255,0.4)'\n      })\n    })\n  });\n}\n\n/**\n * Add an OL overlay at each midpoint and return an array of those overlays\n * @param olGeometry OL Geometry\n * @returns OL overlays\n */\nexport function updateOlTooltipsDrawAtMidpoints(olGeometry: OlPoint | OlLineString | OlPolygon | OlCircle): OlOverlay[] {\n  let olMidpoints;\n  if (olGeometry instanceof OlPoint) {\n    const olMidpointPoint = new OlPoint(olGeometry.getFlatCoordinates());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({_midpoints: olMidpoints}, true);\n  } else if (olGeometry instanceof OlCircle) {\n    const olMidpointPoint = new OlPoint(olGeometry.getCenter());\n    olMidpoints = new Array(1);\n    olMidpoints[0] = olMidpointPoint;\n    olGeometry.setProperties({_midpoints: olMidpoints}, true);\n  } else {\n    olMidpoints = updateOlGeometryMidpoints(olGeometry);\n  }\n  const olTooltips = olMidpoints.map((olMidpoint: OlPoint) => {\n    let olTooltip = olMidpoint.get('_tooltip');\n    if (olTooltip === undefined) {\n      olTooltip = createOlTooltipDrawAtPoint(olMidpoint);\n    } else {\n      olTooltip.setPosition(olMidpoint.getFlatCoordinates());\n    }\n    return olTooltip;\n  });\n  return olTooltips;\n}\n\n/**\n * Add an OL overlay at the center of a geometry and return that overlay\n * @param olGeometry OL Geometry\n * @returns OL overlay\n */\nexport function updateOlTooltipDrawAtCenter(olGeometry: OlLineString | OlPolygon): OlOverlay {\n  const olCenter = updateOlGeometryCenter(olGeometry);\n  let olTooltip = olCenter.get('_tooltip');\n  if (olTooltip === undefined) {\n    olTooltip = createOlTooltipDrawAtPoint(olCenter);\n  } else {\n    olTooltip.setPosition(olCenter.getFlatCoordinates());\n  }\n  return olTooltip;\n}\n\n/**\n * Create an OL overlay at a point and bind the overlay to the point\n * @param olPoint OL Point\n * @returns OL overlay\n */\nexport function createOlTooltipDrawAtPoint(olPoint: OlPoint): OlOverlay {\n  const olTooltip = new OlOverlay({\n    element: document.createElement('div'),\n    offset: [-30, -10],\n    className: [\n      'igo-map-tooltip',\n      'igo-map-tooltip-draw'\n    ].join(' '),\n    stopEvent: false\n  });\n  olTooltip.setPosition(olPoint.getFlatCoordinates());\n  olPoint.set('_tooltip', olTooltip);\n\n  return olTooltip;\n}\n\n\nexport function DDtoDMS(value: [number, number], unit: CoordinatesUnit): string[] | undefined {\n  const conversionMapper = new Map([\n    [CoordinatesUnit.DecimalDegree, (val: [number, number]) => {\n      if (typeof val[0] === 'number') {\n        return roundCoordToString(val, 5) as string[];\n      } else {\n        const numVal: [number, number] = [Number(val[0]), Number(val[1])];\n        return roundCoordToString(numVal, 5) as string[];\n      }\n    }],\n    [CoordinatesUnit.DegreesMinutesSeconds, (val: [number, number]) => convertDDToDMS(val, 2)]\n  ]);\n  let conversion = conversionMapper.get(unit);\n\n  return conversion ? conversion(value) : undefined;\n}\n\n\n","import { Injectable } from '@angular/core';\n\nimport * as OlStyle from 'ol/style';\nimport OlPoint from 'ol/geom/Point';\nimport { transform } from 'ol/proj';\nimport { MapService } from '../../map/shared/map.service';\nimport { FontType } from './draw.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DrawStyleService {\n  private fillColor = 'rgba(255,255,255,0.4)';\n  private strokeColor = 'rgba(143,7,7,1)';\n  private strokeWidth: number = 1;\n  private labelsAreShown = true;\n  private icon: string;\n  private fontSize: string = '15';\n  private fontStyle: string = FontType.Arial.toString();\n  private offsetX: number = 0;\n  private offsetY: number = 0;\n\n  constructor(\n    private mapService: MapService\n  ) {}\n\n  getFillColor(): string {\n    return this.fillColor;\n  }\n\n  setFillColor(fillColor: string) {\n    this.fillColor = fillColor;\n  }\n\n  getStrokeColor(): string {\n    return this.strokeColor;\n  }\n\n  setStrokeColor(strokeColor: string) {\n    this.strokeColor = strokeColor;\n  }\n\n  getStrokeWidth(): number {\n    return this.strokeWidth;\n  }\n\n  getLabelsAreShown() {\n    return this.labelsAreShown;\n  }\n\n  toggleLabelsAreShown() {\n    this.labelsAreShown = !this.labelsAreShown;\n  }\n\n  setIcon(icon: string) {\n    this.icon = icon;\n  }\n\n  getIcon() {\n    return this.icon;\n  }\n\n  // To edit the label of drawing\n  getFontSize() {\n    return this.fontSize;\n  }\n\n  setFontSize(fontSize: string) {\n    this.fontSize = fontSize;\n  }\n\n  getFontStyle() {\n    return this.fontStyle;\n  }\n\n  setFontStyle(fontStyle: string) {\n    this.fontStyle = fontStyle;\n  }\n\n  getOffsetX(): number {\n    return this.offsetX;\n  }\n\n  setOffsetX(offsetX: number) {\n    this.offsetX = offsetX;\n  }\n\n  getOffsetY(): number {\n    return this.offsetY;\n  }\n\n  setOffsetY(offsetY: number) {\n    this.offsetY = offsetY;\n  }\n\n  createIndividualElementStyle(\n    feature,\n    resolution,\n    labelsAreShown: boolean,\n    fontSizeAndStyle: string,\n    fillColor: string,\n    strokeColor: string,\n    offsetX: number,\n    offsetY: number,\n    icon?: string\n  ): OlStyle.Style {\n    let style;\n    let labelsAreOffset: boolean = false;\n    const proj = this.mapService.getMap().projection;\n    const geom = feature.getGeometry();\n\n    if (geom instanceof OlPoint) {\n      labelsAreOffset = !labelsAreOffset;\n    }\n\n    // if feature is a circle\n    if (feature.get('rad')) {\n      const coordinates = transform(feature.getGeometry().flatCoordinates, proj, 'EPSG:4326');\n\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n\n          font: fontSizeAndStyle,\n          overflow: true,\n          offsetX: offsetX,\n          offsetY: offsetY\n        }),\n\n        image: new OlStyle.Circle({\n          radius: feature.get('rad') / Math.cos((Math.PI / 180) * coordinates[1]) / resolution,\n          stroke: new OlStyle.Stroke({\n            color: strokeColor ? strokeColor : this.strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: fillColor\n          })\n        })\n      });\n      return style;\n\n      // if feature is an icon\n    } else if (icon) {\n      this.offsetY = -26;\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: fontSizeAndStyle,\n          overflow: true,\n          offsetX: offsetX,\n          offsetY: offsetY\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill: new OlStyle.Fill({\n          color: fillColor\n        }),\n\n        image: new OlStyle.Icon({\n          src: icon\n        })\n      });\n      return style;\n\n      // if feature is a point, a linestring or a polygon\n    } else {\n      this.offsetY = labelsAreOffset ? -15 : 0;\n      style = new OlStyle.Style({\n        text: new OlStyle.Text({\n          text: labelsAreShown ? feature.get('draw') : '',\n          stroke: new OlStyle.Stroke({\n            color: 'white',\n            width: 0.75\n          }),\n          fill: new OlStyle.Fill({\n            color: 'black'\n          }),\n          font: fontSizeAndStyle,\n          overflow: true,\n\n          offsetX: offsetX,\n          offsetY: offsetY\n        }),\n\n        stroke: new OlStyle.Stroke({\n          color: strokeColor,\n          width: this.strokeWidth\n        }),\n\n        fill: new OlStyle.Fill({\n          color: fillColor\n        }),\n\n        image: new OlStyle.Circle({\n          radius: 5,\n          stroke: new OlStyle.Stroke({\n            color: strokeColor,\n            width: this.strokeWidth\n          }),\n          fill: new OlStyle.Fill({\n            color: fillColor\n          })\n        })\n      });\n      return style;\n    }\n  }\n}\n","<table class=\"igo-striped mat-typography\" *ngIf=\"ready && feature && isObject(feature.properties) && feature.properties.target !== 'iframe'\">\n  <tbody>\n    <tr *ngFor=\"let property of filterFeatureProperties(feature) | keyvalue\">\n\n      <td *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\">\n        <mat-icon mat-list-avatar svgIcon=\"{{icon}}\"></mat-icon>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === '_blank' && property.key === 'url'\">\n        <a href=\"{{property.value}}\" target='_blank' rel=\"noopener noreferrer\"> {{ 'igo.geo.targetHtmlUrl' | translate }} {{title}}</a>\n        <button class=\"copyClipboard\" mat-icon-button (click)=\"copyTextToClipboard(property.value)\">\n          <mat-icon svgIcon=\"content-copy\"></mat-icon>\n        </button>\n      </td>\n\n      <td id=\"keyValue\" *ngIf=\"feature.properties.target === undefined\">\n        {{property.key}}\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && !isUrl(property.value) && !isEmbeddedLink(property.value)\" [innerHTML]=\"property.value\">\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && isEmbeddedLink(property.value)\">\n        <u [ngStyle]=\"{'cursor': 'pointer', 'color': 'blue'}\" (click)=\"openSecureUrl(property.value)\">{{ getEmbeddedLinkText(property.value) }}</u>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && (isDoc(property.value) || isUrl(property.value)) && !isImg(property.value)\">\n        <u [ngStyle]=\"{'cursor': 'pointer', 'color': 'blue'}\" (click)=\"openSecureUrl(property.value)\">{{ 'igo.geo.targetHtmlUrl' | translate }}</u>\n        <button class=\"copyClipboard\" mat-icon-button (click)=\"copyTextToClipboard(property.value)\">\n          <mat-icon svgIcon=\"content-copy\"></mat-icon>\n        </button>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && !isObject(property.value) && isUrl(property.value) && isImg(property.value)\">\n        <a href=\"{{property.value}}\" target='_blank' (click)=\"openSecureUrl(property.value)\" rel=\"noopener noreferrer\">\n          <img igoImageError src=\"{{(property.value | secureImage) |async}}\" width=\"225\" height=\"auto\">\n        </a>\n      </td>\n\n      <td *ngIf=\"feature.properties.target === undefined && isObject(property.value)\" [innerHTML]=\"property.value | json\">\n      </td>\n\n    </tr>\n  </tbody>\n</table>\n\n<iframe *ngIf=\"isHtmlDisplay()\" [srcdoc]=\"htmlSanitizer(feature.properties)\" [src]=\"urlSanitizer(feature.properties.url)\"></iframe>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Output,\n  EventEmitter,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\nimport { Subject } from 'rxjs';\nimport { takeUntil } from 'rxjs/operators';\n\nimport { userAgent } from '@igo2/utils';\nimport { NetworkService, ConnectionState, MessageService } from '@igo2/core';\nimport { ConfigService } from '@igo2/core';\nimport { getEntityTitle, getEntityIcon } from '@igo2/common';\nimport type { Toolbox } from '@igo2/common';\n\nimport { Feature } from '../shared';\nimport { SearchSource } from '../../search/shared/sources/source';\nimport { IgoMap } from '../../map/shared/map';\nimport { HttpClient } from '@angular/common/http';\nimport { Clipboard } from '@igo2/utils';\n@Component({\n  selector: 'igo-feature-details',\n  templateUrl: './feature-details.component.html',\n  styleUrls: ['./feature-details.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\n\nexport class FeatureDetailsComponent implements OnInit, OnDestroy {\n  private state: ConnectionState;\n  private unsubscribe$ = new Subject<void>();\n  ready = false;\n\n  @Input()\n  get source(): SearchSource {\n    return this._source;\n  }\n  set source(value: SearchSource) {\n    this._source = value;\n    this.cdRef.detectChanges();\n  }\n\n  @Input() map: IgoMap;\n\n  @Input() toolbox: Toolbox;\n\n  @Input()\n  get feature(): Feature {\n    return this._feature;\n  }\n  set feature(value: Feature) {\n    this._feature = value;\n    this.cdRef.detectChanges();\n    this.selectFeature.emit();\n  }\n\n  private _feature: Feature;\n  private _source: SearchSource;\n\n  @Output() routeEvent = new EventEmitter<boolean>();\n  @Output() selectFeature = new EventEmitter<boolean>();\n  @Output() htmlDisplayEvent = new EventEmitter<boolean>();\n\n  /**\n   * @internal\n   */\n  get title(): string {\n    return getEntityTitle(this.feature);\n  }\n\n  /**\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.feature) || 'link';\n  }\n\n\n  constructor(\n    private http: HttpClient,\n    private cdRef: ChangeDetectorRef,\n    private sanitizer: DomSanitizer,\n    private networkService: NetworkService,\n    private messageService: MessageService,\n    private configService: ConfigService\n  ) {\n    this.networkService.currentState().pipe(takeUntil(this.unsubscribe$)).subscribe((state: ConnectionState) => {\n      this.state = state;\n    });\n  }\n\n  ngOnInit() {\n    this.ready = true;\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  urlSanitizer(value): SafeResourceUrl {\n    return this.sanitizer.bypassSecurityTrustResourceUrl(value);\n  }\n\n\n  isHtmlDisplay(): boolean {\n    if (this.feature && this.isObject(this.feature.properties) && this.feature.properties.target === 'iframe') {\n      this.htmlDisplayEvent.emit(true);\n      return true;\n    } else {\n      this.htmlDisplayEvent.emit(false);\n      return false;\n    }\n  }\n\n  htmlSanitizer(value): SafeResourceUrl {\n    if (!value.body || userAgent.getBrowserName() === 'Internet Explorer') {\n      return;\n    }\n    const regexBase = /<base href=\"[\\w:\\/\\.]+\">/;\n    if (!regexBase.test(value.body)) {\n      const url = new URL(value.url, window.location.origin);\n      value.body = value.body.replace('<head>', `<head><base href=\"${url.origin}\">`);\n    }\n\n    return this.sanitizer.bypassSecurityTrustHtml(value.body);\n  }\n\n  isObject(value) {\n    return typeof value === 'object';\n  }\n\n  openSecureUrl(value) {\n    let url: string;\n    const regexDepot = new RegExp(this.configService?.getConfig('depot.url') + '.*?(?=\"|$)');\n\n    if (regexDepot.test(value)) {\n      url = value.match(regexDepot)[0];\n\n      this.http.get(url, {\n        responseType: 'blob'\n      })\n      .subscribe((docOrImage) => {\n        const fileUrl = URL.createObjectURL(docOrImage);\n        window.open(fileUrl, '_blank');\n        this.cdRef.detectChanges();\n      },\n      (error: Error) => {\n        this.messageService.error('igo.geo.targetHtmlUrlUnauthorized', 'igo.geo.targetHtmlUrlUnauthorizedTitle');\n      });\n    } else {\n      let url = value;\n      if (this.isEmbeddedLink(value)) {\n        var div = document.createElement('div');\n        div.innerHTML = value;\n        url = div.children[0].getAttribute('href');\n      }\n      window.open(url, '_blank');\n    }\n  }\n\n  isUrl(value) {\n    if (typeof value === 'string') {\n      const regex = /^https?:\\/\\//;\n      return regex.test(value);\n    }\n  }\n\n  isDoc(value) {\n    if (typeof value === 'string') {\n      if (this.isUrl(value)) {\n        const regex = /(pdf|docx?|xlsx?)$/;\n        return regex.test(value.toLowerCase());\n      } else {\n        return false;\n      }\n    }\n  }\n\n  isImg(value) {\n    if (typeof value ==='string') {\n      if (this.isUrl(value)) {\n        const regex = /(jpe?g|png|gif)$/;\n        return regex.test(value.toLowerCase());\n      } else {\n        return false;\n      }\n    }\n  }\n\n  isEmbeddedLink(value) {\n    if (typeof value === 'string') {\n        const matchRegex = /<a/g;\n        const match = value.match(matchRegex) || [];\n        const count = match.length;\n        if (count === 1) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n    return false;\n}\n\n  getEmbeddedLinkText(value) {\n    const regex = /(?:>).*?(?=<|$)/;\n    let text = value.match(regex)[0] as string;\n    text = text.replace(/>/g, '');\n    return text;\n  }\n\n  filterFeatureProperties(feature) {\n    const allowedFieldsAndAlias = feature.meta ? feature.meta.alias : undefined;\n    const properties = {};\n    let offlineButtonState;\n\n    if (this.map) {\n      this.map.offlineButtonToggle$.pipe(takeUntil(this.unsubscribe$)).subscribe(state => {\n        offlineButtonState = state;\n      });\n    }\n\n    if (feature.properties && feature.properties.Route && this.toolbox && !this.toolbox.getTool('directions')) {\n      delete feature.properties.Route;\n    }\n\n    if (allowedFieldsAndAlias) {\n      Object.keys(allowedFieldsAndAlias).forEach(field => {\n        properties[allowedFieldsAndAlias[field]] = feature.properties[field];\n      });\n      return properties;\n    } else if (offlineButtonState !== undefined) {\n      if (!offlineButtonState) {\n        if (this.state.connection && feature.meta && feature.meta.excludeAttribute) {\n          const excludeAttribute = feature.meta.excludeAttribute;\n          excludeAttribute.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        } else if (!this.state.connection && feature.meta && feature.meta.excludeAttributeOffline) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        }\n      } else {\n        if (feature.meta && feature.meta.excludeAttributeOffline) {\n          const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n          excludeAttributeOffline.forEach(attribute => {\n            delete feature.properties[attribute];\n          });\n        }\n      }\n    } else {\n      if (this.state.connection && feature.meta && feature.meta.excludeAttribute) {\n        const excludeAttribute = feature.meta.excludeAttribute;\n        excludeAttribute.forEach(attribute => {\n          delete feature.properties[attribute];\n        });\n      } else if (!this.state.connection && feature.meta && feature.meta.excludeAttributeOffline) {\n        const excludeAttributeOffline = feature.meta.excludeAttributeOffline;\n        excludeAttributeOffline.forEach(attribute => {\n          delete feature.properties[attribute];\n        });\n      }\n    }\n    return feature.properties;\n  }\n\n  /**\n   * Copy the url to a clipboard\n   */\n  copyTextToClipboard(value: string): void {\n    const successful = Clipboard.copy(value);\n    if (successful) {\n      this.messageService.success('igo.geo.query.link.message');\n    }\n  }\n}\n","import OlCircle from 'ol/geom/Circle';\nimport OlPoint from 'ol/geom/Point';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olstyle from 'ol/style';\nimport OlLineString from 'ol/geom/LineString';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlPolygon from 'ol/geom/Polygon';\nimport BasicEvent from 'ol/events/Event';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport lineIntersect from '@turf/line-intersect';\nimport { lineString } from '@turf/helpers';\n\nimport {\n  GeometrySliceMultiPolygonError,\n  GeometrySliceLineStringError,\n  GeometrySliceTooManyIntersectionError\n } from './geometry.errors';\n\n/**\n * Create a default style for draw and modify interactions\n * @param color Style color (R, G, B)\n * @returns OL style\n */\nexport function createDrawInteractionStyle(color?: [number, number, number]): olstyle.Circle {\n  color = color || [0, 153, 255];\n  return new olstyle.Circle({\n    stroke: new olstyle.Stroke({\n      color: color.concat([1]),\n      width: 2\n    }),\n    fill:  new olstyle.Fill({\n      color: color.concat([0.2])\n    }),\n    radius: 8\n  });\n}\n\n/**\n * Create a default style for drawing a hole\n * @returns OL style\n */\nexport function createDrawHoleInteractionStyle(): olstyle.Style {\n  return new olstyle.Style({\n    stroke: new olstyle.Stroke({\n      color:  [0, 153, 255, 1],\n      width: 2\n    })\n  });\n}\n\n/**\n * Slice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function sliceOlGeometry(\n  olGeometry: OlLineString | OlPolygon,\n  olSlicer: OlLineString\n): Array<OlLineString | OlPolygon> {\n  if (olGeometry instanceof OlPolygon) {\n    return sliceOlPolygon(olGeometry, olSlicer);\n  } else if (olGeometry instanceof OlLineString) {\n    return sliceOlLineString(olGeometry, olSlicer);\n  }\n  return [];\n}\n\n/**\n * Slice OL LineString into one or more lines\n * @param olLineString OL line string\n * @param olSlicer Slicing line\n * @returns New OL line strings\n */\nexport function sliceOlLineString(olLineString: OlLineString, olSlicer: OlLineString): OlLineString[] {\n  return [];\n}\n\n/**\n * Slice OL Polygon into one or more polygons\n * @param olPolygon OL polygon\n * @param olSlicer Slicing line\n * @returns New OL polygons\n */\nexport function sliceOlPolygon(olPolygon: OlPolygon, olSlicer: OlLineString): OlPolygon[] {\n  if (olPolygon.getLinearRingCount() > 1) {\n    throw new GeometrySliceMultiPolygonError();\n  }\n\n  if (olSlicer.getCoordinates().length > 2) {\n    throw new GeometrySliceLineStringError();\n  }\n\n  const olGeoJSON = new OlGeoJSON();\n  const slicer = olGeoJSON.writeGeometryObject(olSlicer) as any;\n  const outerCoordinates = olPolygon.getLinearRing(0).getCoordinates();\n\n  const parts = [[], []];\n  let totalIntersectionCount = 0;\n  for (let i = 0, ii = outerCoordinates.length - 1; i < ii; i++) {\n    const segmentCoordinates = [outerCoordinates[i], outerCoordinates[i + 1]];\n    const segment = lineString(segmentCoordinates);\n    const intersections = lineIntersect(segment, slicer).features;\n\n    const intersectionCount = intersections.length;\n    totalIntersectionCount += intersectionCount;\n    if (intersectionCount > 1 || totalIntersectionCount > 2) {\n      throw new GeometrySliceTooManyIntersectionError();\n    }\n\n    parts[0].push(segmentCoordinates[0]);\n    if (intersectionCount === 1) {\n      const intersection = intersections[0].geometry.coordinates;\n      parts[0].push(intersection);\n      parts[1].push(intersection);\n      parts.reverse();\n    }\n  }\n\n  if (totalIntersectionCount <= 1) {\n    return [];\n  }\n\n  parts[0].push(parts[0][0]);\n  parts[1].push(parts[1][0]);\n\n  return [new OlPolygon([parts[0]]), new OlPolygon([parts[1]])];\n}\n\n/**\n * Splice geometry into two parts\n * @param olGeometry OL geometry\n * @param olSlicer Slicing line\n * @returns New OL geometries\n */\nexport function addLinearRingToOlPolygon(olPolygon: OlPolygon, olLinearRing: OlLinearRing ) {\n  // TODO: make some validation and support updating an existing linear ring\n  olPolygon.appendLinearRing(olLinearRing);\n}\n\nexport function getMousePositionFromOlGeometryEvent(\n  olEvent: BasicEvent\n) {\n  const olGeometry = olEvent.target as OlGeometry;\n  if (olGeometry instanceof OlPolygon) {\n    return olGeometry.getFlatCoordinates().slice(-4, -2) as [number, number];\n  }\n  const olGeometryCast = olGeometry as OlPoint | OlLineString | OlCircle;\n  return olGeometryCast.getFlatCoordinates().slice(-2) as [number, number];\n}\n","/* eslint-disable */\n// See this issue: https://github.com/Microsoft/TypeScript/issues/13965\n// And the solution: https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\n// for an explanation as to why the prototype is set manually\n/* eslint-enable */\n\nexport class GeometrySliceError extends Error {}\n\nexport class GeometrySliceMultiPolygonError extends GeometrySliceError {\n  constructor() {\n    super('Can\\'t slice a MultiPolygon.');\n    Object.setPrototypeOf(this, GeometrySliceMultiPolygonError.prototype);\n  }\n}\n\nexport class GeometrySliceLineStringError extends GeometrySliceError {\n  constructor() {\n    super('Can\\'t slice with a line that has more than 2 points.');\n    Object.setPrototypeOf(this, GeometrySliceLineStringError.prototype);\n  }\n}\n\nexport class GeometrySliceTooManyIntersectionError extends GeometrySliceError {\n  constructor() {\n    super('More than 2 intersections found between the target polygon and the slicing line.');\n    Object.setPrototypeOf(this, GeometrySliceTooManyIntersectionError.prototype);\n  }\n}\n","import { EventsKey } from 'ol/events';\nimport OlMap from 'ol/Map';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport type { Type } from 'ol/geom/Geometry';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlDraw from 'ol/interaction/Draw';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlModify from 'ol/interaction/Modify';\nimport OlSelect from 'ol/interaction/Select';\nimport BasicEvent from 'ol/events/Event';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport { SelectEvent as OlSelectEvent } from 'ol/interaction/Select';\nimport { unByKey } from 'ol/Observable';\nimport { doubleClick } from 'ol/events/condition';\n\nimport { Subject, Subscription, fromEvent, BehaviorSubject } from 'rxjs';\n\nimport { getMousePositionFromOlGeometryEvent } from '../geometry.utils';\n\nexport interface DrawControlOptions {\n  geometryType: Type | string;\n  drawingLayerSource?: OlVectorSource<OlGeometry>;\n  drawingLayer?: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  drawingLayerStyle?: OlStyleLike;\n  interactionStyle?: OlStyleLike;\n  maxPoints?: number;\n}\n\n/**\n * Control to draw entities\n */\nexport class DrawControl {\n  /**\n   * Draw start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw changes observable (while drawing)\n   */\n  public changes$: Subject<any> = new Subject();\n\n  /**\n   * Draw modify observable (modify drawn features)\n   */\n  public modify$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Draw select observable (modify drawn features)\n   */\n  public select$: Subject<any> = new Subject();\n\n  /**\n   * Draw abort observable (abort drawn features)\n   */\n  public abort$: Subject<any> = new Subject();\n\n  /**\n   * Freehand mode observable (defaults to false)\n   */\n  freehand$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  /**\n   * Observables from predefined radius (defaults to false and undefined)\n   */\n  ispredefinedRadius$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  predefinedRadius$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n  radiusDrawEnd$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n\n  private keyDown$$: Subscription;\n\n  private olGeometryType: typeof OlGeometry | undefined | string;\n  private olInteractionStyle: OlStyleLike;\n  private olMap: OlMap;\n  private olDrawingLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  private olDrawInteraction: OlDraw;\n  private olSelectInteraction: OlSelect;\n  private olModifyInteraction: OlModify;\n  private onDrawStartKey: EventsKey;\n  private onDrawEndKey: EventsKey;\n  private onDrawAbortKey: EventsKey;\n  private onDrawKey: EventsKey;\n  public radius: number;\n\n  private mousePosition: [number, number];\n\n  /**\n   * take the value of radius\n   */\n  get radiusVal(): number {\n    return this.predefinedRadius$.getValue();\n  }\n  set radiusValData(radiusCercle: number) {\n    this.predefinedRadius$.next(radiusCercle);\n  }\n\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olDrawingLayerSource(): OlVectorSource<OlGeometry> {\n    return this.olDrawingLayer.getSource();\n  }\n\n  constructor(private options: DrawControlOptions) {\n    this.olDrawingLayer = options.drawingLayer ? options.drawingLayer : this.createOlInnerOverlayLayer();\n    this.olGeometryType = this.options.geometryType;\n    this.olInteractionStyle = this.options.interactionStyle;\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined, activateModifyAndSelect?: boolean) {\n    if (!olMap) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlInteractions();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n    this.addOlInteractions(activateModifyAndSelect);\n  }\n\n  /**\n   * Return the drawing layer source\n   */\n  getSource(): OlVectorSource<OlGeometry> {\n    return this.olDrawingLayerSource;\n\n  }\n\n  setOlInteractionStyle(style) {\n    this.olInteractionStyle = style;\n  }\n\n  /**\n   * Set the current geometry type\n   * @param geometryType the geometry type\n   */\n  setGeometryType(geometryType: Type) {\n    this.olGeometryType = geometryType;\n  }\n\n  /**\n   * Get the current geometry type\n   */\n  getGeometryType() {\n    return this.olGeometryType;\n  }\n\n  /**\n   * Create a drawing source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<OlVectorSource<OlGeometry>> {\n    return new OlVectorLayer({\n      source: this.options.drawingLayerSource ? this.options.drawingLayerSource : new OlVectorSource(),\n      style: this.options.drawingLayerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Clear the drawing layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer && this.olMap) {\n      this.olMap.removeLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Add the drawing layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (!this.options.drawingLayer) {\n      this.olMap.addLayer(this.olDrawingLayer);\n    }\n  }\n\n  /**\n   * Clear the drawing layer source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (!this.options.drawingLayer && !this.options.drawingLayerSource) {\n      this.olDrawingLayerSource.clear(true);\n    }\n  }\n\n  /**\n   * Add interactions to the map an set up some listeners\n   */\n  addOlInteractions(activateModifyAndSelect?: boolean) {\n    // Create Draw interaction\n    let olDrawInteraction;\n    if (!this.freehand$.getValue()) {\n      if (!this.ispredefinedRadius$.getValue()) {\n        olDrawInteraction = new OlDraw({\n          type: this.olGeometryType as Type,\n          source: this.getSource(),\n          stopClick: true,\n          style: this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: false,\n          freehandCondition: () => false\n        });\n      } else {\n        olDrawInteraction = new OlDraw({\n          type: 'Point',\n          source: this.getSource(),\n          stopClick: true,\n          style: this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: false,\n          freehandCondition: () => false\n        });\n      }\n\n    } else {\n      if (this.olGeometryType === 'Point') {\n        olDrawInteraction = new OlDraw({\n          type: 'Circle',\n          source: this.getSource(),\n          style: typeof this.olInteractionStyle === 'function' ? undefined : this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n      } else {\n        olDrawInteraction = new OlDraw({\n          type: this.olGeometryType as Type,\n          source: this.getSource(),\n          style: this.olInteractionStyle,\n          maxPoints: this.options.maxPoints,\n          freehand: true\n        });\n      }\n    }\n\n    // Add Draw interaction to map and create listeners\n    this.olMap.addInteraction(olDrawInteraction);\n    this.olDrawInteraction = olDrawInteraction;\n    this.onDrawStartKey = olDrawInteraction.on('drawstart', (event: OlDrawEvent) => this.onDrawStart(event));\n    this.onDrawEndKey = olDrawInteraction.on('drawend', (event: OlDrawEvent) => this.onDrawEnd(event));\n    this.onDrawAbortKey = olDrawInteraction.on('drawabort', (event: OlDrawEvent) => this.abort$.next(event.feature.getGeometry()));\n\n    if (activateModifyAndSelect) {\n      // Create a Modify interaction, add it to map and create a listener\n      const olModifyInteraction = new OlModify({\n        source: this.getSource()\n      });\n\n      this.olMap.addInteraction(olModifyInteraction);\n      this.olModifyInteraction = olModifyInteraction;\n\n      // Create a select interaction and add it to map\n      if (!this.olSelectInteraction) {\n        const olSelectInteraction = new OlSelect({\n          condition: doubleClick,\n          style: undefined\n        });\n        this.olMap.addInteraction(olSelectInteraction);\n        this.olSelectInteraction = olSelectInteraction;\n\n        this.olSelectInteraction.on('select', (event: OlSelectEvent) => this.onSelect(event));\n      }\n    }\n  }\n\n  /**\n   * Remove interactions\n   */\n  private removeOlInteractions() {\n    this.unsubscribeKeyDown();\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey, this.onDrawAbortKey]);\n\n    if (this.olMap) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n\n    this.olDrawInteraction = undefined;\n    this.olModifyInteraction = undefined;\n  }\n\n  /**\n   * When drawing starts, clear the overlay and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.start$.next(olGeometry);\n    this.clearOlInnerOverlaySource();\n    this.onDrawKey = olGeometry.on('change', (olGeometryEvent: BasicEvent) => {\n      this.mousePosition = getMousePositionFromOlGeometryEvent(olGeometryEvent);\n      this.changes$.next(olGeometryEvent.target);\n    });\n    this.subscribeKeyDown();\n  }\n\n  /**\n   * When drawing ends, update the drawing (feature) geometry observable and add\n   * @param event Draw event (drawend)\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    if (event.feature.getGeometry().getType() === 'Point') {\n      this.radiusDrawEnd$.next(this.predefinedRadius$.getValue());\n    }\n    this.unsubscribeKeyDown();\n    unByKey(this.onDrawKey);\n    const olGeometry = event.feature.getGeometry();\n    olGeometry.on('change', () => {\n      this.modify$.next(olGeometry);\n    });\n    this.end$.next(olGeometry);\n  }\n\n  /**\n   * When a feature is selected, update the selected feature observable\n   * @param event Modify event (modifyend)\n   */\n  private onSelect(event: OlSelectEvent) {\n    if (event.selected.length === 1) {\n      this.select$.next(event.selected[0]);\n    }\n  }\n\n  /**\n   * Subscribe to key downs used as drawing interaction shorcuts\n   */\n  private subscribeKeyDown() {\n    this.unsubscribeKeyDown();\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe((event: KeyboardEvent) => {\n      // On Escape or 'c' keydowns, abort the current drawing\n      if (event.key === 'Escape') {\n        this.olDrawInteraction.abortDrawing();\n        return;\n      }\n\n      // On Backspace or 'u' keydowns, remove last vertex of current drawing\n      if (event.key === 'Backspace') {\n        this.olDrawInteraction.removeLastPoint();\n      }\n\n      // On Enter or 'f' keydowns, finish current drawing\n      if (event.key === 'Enter') {\n        this.olDrawInteraction.finishDrawing();\n      }\n\n      // On space bar key down, pan to the current mouse position\n      if (event.key === ' ') {\n        this.olMap.getView().animate({\n          center: this.mousePosition,\n          duration: 100\n        });\n        return;\n      }\n    });\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeKeyDown() {\n    if (this.keyDown$$) {\n      this.keyDown$$.unsubscribe();\n      this.keyDown$$ = undefined;\n    }\n  }\n}\n","<div>\n  <h2 mat-dialog-title>\n    {{ 'igo.geo.draw.popupTitle' | translate }}\n  </h2>\n</div>\n\n\n<div class=\"geometry-type-toggle mat-typography\">\n  <mat-button-toggle-group\n    (change)=\"onLabelTypeChange($event.value)\" [value]=\"customOrPredefined\">\n    <mat-button-toggle [value]=\"labelType.Custom\" >\n      {{ 'igo.geo.draw.labelType.custom' | translate }}\n    </mat-button-toggle>\n    <mat-button-toggle [value]=\"labelType.Predefined\">\n      {{ 'igo.geo.draw.labelType.predefined' | translate }}\n    </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<div *ngIf=\"labelFlag !== labelType.Custom\">\n  <div>\n    <p class=\"mat-typography\">{{ 'igo.geo.draw.builtInInstructions' | translate }}</p>\n    <mat-radio-group *ngIf=\"olGeometryType !== 'Polygon'\" class=\"mat-typography\">\n      <mat-radio-button *ngFor=\"let option of arrayBuiltInType\" [value]=\"option.value\" [disabled]=\"optionAvailable(option.value)\" \n      (change)=\"onLabelTypeChange($event.value)\" [checked]=\"option.checked\">\n        {{getProperLengthLabel(option.value)}}\n      </mat-radio-button>\n    </mat-radio-group>\n    <ng-container class=\"mat-typography\" *ngIf=\"olGeometryType === 'Polygon'\">\n      <mat-checkbox\n        *ngFor=\"let option of arrayBuiltInType\"\n        class=\"mat-typography\"\n        [value]=\"option.value\"\n        [disabled]=\"optionAvailable(option.value)\"\n        (change)=\"onLabelTypeChange($event.source.value, $event.checked)\"\n        [checked]=\"option.checked\">\n        {{getProperLengthLabel(option.value)}}\n      </mat-checkbox>\n    </ng-container>\n    <div *ngIf=\"labelFlag === labelType.Coordinates\">\n      <mat-form-field class=\"readOnly-Input\">\n        <input\n          #input\n          matInput\n          placeholder=\"(Latitude, Longitude)\"\n          value=\"{{currentCoordinates}}\" readonly>\n      </mat-form-field>\n      <mat-form-field class=\"unit-field\">\n        <mat-select [value]=\"coordinatesMeasureUnit\" (selectionChange)=\"onChangeCoordinateUnit($event.value)\">\n          <mat-option *ngFor=\"let unit of allCoordinatesUnits\" [value]=\"unit\">\n            {{unit}}\n          </mat-option>\n        </mat-select>  \n      </mat-form-field>\n    </div>\n    <div *ngIf=\"labelFlag === labelType.Length || polygonCheck === 2\">\n      <mat-form-field class=\"readOnly-Input\">\n        <input\n          #input\n          matInput\n          placeholder={{lengthLabelT}}\n          value=\"{{currentLength}}\" readonly>\n      </mat-form-field>\n      <mat-form-field class=\"unit-field\">\n        <mat-select [value]=\"lengthMeasureUnit\" (selectionChange)=\"onChangeLengthUnit($event.value)\">\n          <mat-option *ngFor=\"let unit of allLengthUnits\" [value]=\"unit\">\n            {{getLengthUnitEnum(unit)}}\n          </mat-option>\n        </mat-select>  \n      </mat-form-field>\n    </div>\n    <div *ngIf=\"labelFlag === labelType.Area || polygonCheck === 2\">\n      <mat-form-field class=\"readOnly-Input\">\n        <input\n          #input\n          matInput\n          placeholder=\"{{ 'igo.geo.draw.labelType.Area' | translate }}\"\n          value=\"{{currentArea}}\" readonly>\n      </mat-form-field>\n      <mat-form-field class=\"unit-field\">\n        <mat-select [value]=\"areaMeasureUnit\" (selectionChange)=\"onChangeAreaUnit($event.value)\">\n          <mat-option *ngFor=\"let unit of allAreaUnits\" [value]=\"unit\">\n            {{getAreaUnitEnum(unit)}}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n\n\n  <div mat-dialog-actions>\n    <button mat-raised-button (click)=\"cancelDrawing()\" >\n      {{'igo.geo.draw.cancel' | translate}}\n    </button>\n    <button \n      mat-raised-button \n      color=\"primary\" \n      (click)=\"confirm()\"> \n      {{noLabelButton()}} \n    </button>\n  </div>\n</div>\n\n<div *ngIf=\"labelFlag === labelType.Custom\">\n  <div>\n    <p class=\"mat-typography\">{{ 'igo.geo.draw.dialogInstruction' | translate }}</p>\n    <mat-form-field class=\"input\">\n      <input\n        #input\n        matInput\n        (select)=\"true\"\n        (input)=\"getLabelLength($event.target.value)\"\n        placeholder=\"{{'igo.geo.draw.dialogTitle' | translate}}\"\n        value=\"{{ currentLabel }}\"\n        cdkFocusInitial/>\n    </mat-form-field>\n  </div>\n  \n  <div mat-dialog-actions>\n    <button mat-raised-button (click)=\"cancelDrawing()\" >\n      {{'igo.geo.draw.cancel' | translate}}\n    </button>\n    <button \n      mat-raised-button \n      color=\"primary\" \n      (click)=\"confirm(input.value)\">\n      {{noLabelButton()}}\n    </button>\n  </div>\n</div>\n","import { Component, Inject, Input } from '@angular/core';\nimport { LanguageService } from '@igo2/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { CoordinatesUnit, GeometryType, LabelType } from '../shared/draw.enum';\nimport { transform } from 'ol/proj';\nimport { IgoMap, roundCoordTo } from '../../map/shared';\nimport OlFeature from 'ol/Feature';\nimport {\n  measureOlGeometryLength,\n  measureOlGeometryArea,\n  metersToUnit,\n  squareMetersToUnit\n} from '../../measure/shared/measure.utils';\nimport {\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation,\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n} from '../../measure/shared/measure.enum';\n\nimport {fromCircle} from 'ol/geom/Polygon';\nimport { getLength } from 'ol/sphere';\nimport Circle from 'ol/geom/Circle';\nimport { DDtoDMS } from '../shared/draw.utils';\n\n\n@Component({\n  selector: 'igo-draw-popup-component',\n  templateUrl: './draw-popup.component.html',\n  styleUrls: ['./draw-popup.component.scss']\n  })\nexport class DrawPopupComponent {\n  @Input() confirmFlag: boolean = false;\n  @Input() labelFlag: LabelType | [LabelType, LabelType] = LabelType.Custom;\n  @Input() coordinatesMeasureUnit: CoordinatesUnit;\n  @Input() lengthMeasureUnit: MeasureLengthUnit;\n  @Input() areaMeasureUnit: MeasureAreaUnit;\n\n  public geometryType = GeometryType;\n  public labelType = LabelType;\n  public arrayBuiltInType: any[] = [];\n\n  public currentLabel: string;\n  public currentCoordinates: string;\n  public currentArea: string;\n  public currentLength: string;\n\n  public olGeometryType: GeometryType = undefined;\n  public lengthInMeters: string;\n  public areaInMetersSquare: string;\n  public coordinatesInDD: string;\n  public currentCoordinatesUnit: string;\n\n  private longlatDD: [number, number];\n  private labelLength: number;\n\n  public polygonCheck = 0; // Count for polygon label types checkboxes\n\n  constructor(\n    private languageService: LanguageService,\n    public dialogRef: MatDialogRef<DrawPopupComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: { olGeometry: any, map: IgoMap }\n    ) {\n      this.currentLabel = this.data.olGeometry.get('draw');\n      this.labelLength = this.currentLabel ? this.currentLabel.length: 0;\n      let olGeometry;\n\n      const projection = this.data.map.ol.getView().getProjection();\n\n      if(this.data.olGeometry instanceof OlFeature) {\n        if (this.data.olGeometry.get('rad')){\n          const longitudeLatitude = [this.data.olGeometry.get('longitude'), this.data.olGeometry.get('latitude')];\n          this.olGeometryType = GeometryType.Circle;\n          olGeometry = new Circle(longitudeLatitude, this.data.olGeometry.get('rad'));\n        }\n        else{\n          this.olGeometryType = this.data.olGeometry.getGeometry().getType();\n          olGeometry = this.data.olGeometry.get('geometry');\n        }\n      }\n      else{\n        this.olGeometryType = this.data.olGeometry.getType();\n        olGeometry = this.data.olGeometry;\n      }\n\n      if (this.olGeometryType === GeometryType.Point || this.olGeometryType === GeometryType.Circle){\n        if(this.data.olGeometry instanceof OlFeature){\n          let longitude = this.data.olGeometry.get('longitude');\n          let latitude = this.data.olGeometry.get('latitude');\n          this.longlatDD = roundCoordTo([longitude, latitude], 5);\n          this.coordinatesInDD = '(' + latitude + ', '\n          + longitude + ')';\n        }\n        else {\n          let point4326 = transform(\n            this.data.olGeometry.getFlatCoordinates(),\n            projection,\n            'EPSG:4326'\n          );\n          this.longlatDD = roundCoordTo([point4326[0], point4326[1]], 5);\n          this.coordinatesInDD =\n            '(' + this.longlatDD[1] + ', ' + this.longlatDD[0] + ')';\n        }\n        this.currentCoordinates = this.coordinatesInDD;\n      }\n      if (this.olGeometryType === GeometryType.LineString){\n        this.lengthInMeters = measureOlGeometryLength(olGeometry, projection.getCode()).toFixed(2);\n        this.currentLength = this.lengthInMeters;\n      }\n      else if (this.olGeometryType === GeometryType.Polygon){\n        this.lengthInMeters = measureOlGeometryLength(olGeometry, projection.getCode()).toFixed(2);\n        this.currentLength = this.lengthInMeters;\n        this.areaInMetersSquare = measureOlGeometryArea(olGeometry,projection.getCode()).toFixed(2);\n        this.currentArea = this.areaInMetersSquare;\n      }\n      else if(this.olGeometryType === GeometryType.Circle){\n        let circularPolygon = fromCircle(olGeometry, 10000);\n        const radius = this.getRadius(circularPolygon);\n        this.lengthInMeters = radius.toFixed(2);\n        this.currentLength = this.lengthInMeters;\n        this.areaInMetersSquare = measureOlGeometryArea(circularPolygon,projection.getCode()).toFixed(2);\n        this.currentArea = this.areaInMetersSquare;\n      }\n\n      if (data.olGeometry.get('labelType') === LabelType.Coordinates) {\n        this.onLabelTypeChange(LabelType.Predefined);\n        this.onLabelTypeChange(LabelType.Coordinates, true);\n        this.coordinatesMeasureUnit = data.olGeometry.get('measureUnit');\n      } else if (data.olGeometry.get('labelType') === LabelType.Length) {\n        this.onLabelTypeChange(LabelType.Predefined);\n        this.onLabelTypeChange(LabelType.Length, true);\n        this.lengthMeasureUnit = data.olGeometry.get('measureUnit');\n      } else if (data.olGeometry.get('labelType') === LabelType.Area) {\n        this.onLabelTypeChange(LabelType.Predefined);\n        this.onLabelTypeChange(LabelType.Area, true);\n        this.areaMeasureUnit = data.olGeometry.get('measureUnit');\n      } else if (data.olGeometry.get('labelType')?.length === 2) {\n        this.onLabelTypeChange(LabelType.Predefined);\n        this.onLabelTypeChange(LabelType.Length, true);\n        this.onLabelTypeChange(LabelType.Area, true);\n        this.lengthMeasureUnit = data.olGeometry.get('measureUnit')[0];\n        this.areaMeasureUnit = data.olGeometry.get('measureUnit')[1];\n      }\n      this.buildArrayType();\n    }\n\n  /**\n   * HTML Interactions\n   */\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n\n  confirm(input?: string) {\n    this.confirmFlag = true;\n    if(this.labelFlag === LabelType.Predefined){\n      this.dialogRef.close();\n    }\n    else if (this.labelFlag === LabelType.Custom){\n      this.dialogRef.close({\n        label: input\n      });\n    }\n    else if(this.labelFlag === LabelType.Coordinates){\n      this.dialogRef.close({\n        label: this.currentCoordinates,\n        measureUnit: this.coordinatesMeasureUnit\n      });\n    }\n    else if (this.olGeometryType === GeometryType.Polygon) {\n      if (this.polygonCheck === 2) {\n        this.labelFlag = [LabelType.Length, LabelType.Area];\n        this.dialogRef.close({\n          label: 'P: ' + this.currentLength + ' ' + MeasureLengthUnitAbbreviation[MeasureLengthUnit.Meters] + '\\n'\n          + this.languageService.translate.instant('igo.geo.draw.labelType.A') + this.currentArea + ' ' +\n          MeasureAreaUnitAbbreviation[MeasureAreaUnit.SquareMeters], measureUnit: [this.lengthMeasureUnit, this.areaMeasureUnit]\n        });\n      } else {\n        this.labelFlag === LabelType.Length ?\n        this.dialogRef.close({\n          label: 'P: ' + this.currentLength + ' ' + MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\n          measureUnit: this.lengthMeasureUnit\n        }) :\n        this.dialogRef.close({\n          label: this.currentArea + ' ' + MeasureAreaUnitAbbreviation[this.areaMeasureUnit],\n          measureUnit: this.areaMeasureUnit\n        });\n      }\n    }\n    else if (this.labelFlag === LabelType.Length){\n      if (this.olGeometryType === GeometryType.Circle){\n        this.dialogRef.close({\n          label: 'R: ' + this.currentLength + ' ' + MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\n          measureUnit: this.lengthMeasureUnit\n        });\n      }\n      else if (this.olGeometryType === GeometryType.LineString) {\n        this.dialogRef.close({\n          label: this.currentLength + ' ' + MeasureLengthUnitAbbreviation[this.lengthMeasureUnit],\n          measureUnit: this.lengthMeasureUnit\n        });\n      }\n    }\n    else if (this.labelFlag === LabelType.Area){\n      this.dialogRef.close({\n        label: this.currentArea + ' ' + MeasureAreaUnitAbbreviation[this.areaMeasureUnit],\n        measureUnit: this.areaMeasureUnit\n      });\n    }\n  }\n\n  onLabelTypeChange(labelType: LabelType, checked?: boolean){\n    if (labelType !== LabelType.Predefined &&\n      labelType !== LabelType.Custom &&\n      this.olGeometryType === GeometryType.Polygon) {\n        this.arrayBuiltInType.find(type => type.value === labelType) ?\n          this.arrayBuiltInType.find(type => type.value === labelType).checked = checked : this.labelFlag = undefined;\n        checked ? this.labelFlag = labelType : this.labelFlag = this.arrayBuiltInType.find(type => type.checked)?.value;\n    } else {\n      this.labelFlag = labelType;\n    }\n\n    if (labelType === LabelType.Predefined){\n      if (this.olGeometryType === GeometryType.Point ){\n        this.labelFlag = LabelType.Coordinates;\n        this.currentCoordinates = this.coordinatesInDD;\n        this.coordinatesMeasureUnit = CoordinatesUnit.DecimalDegree;\n      }\n      else if (this.olGeometryType === GeometryType.LineString){\n        this.labelFlag = LabelType.Length;\n        this.currentLength = this.lengthInMeters;\n        this.lengthMeasureUnit = MeasureLengthUnit.Meters;\n      }\n    }\n    else if (labelType === LabelType.Area){\n      this.currentArea = this.areaInMetersSquare;\n      this.areaMeasureUnit = MeasureAreaUnit.SquareMeters;\n    }\n    else if (labelType === LabelType.Length){\n      this.currentLength = this.lengthInMeters;\n      this.lengthMeasureUnit = MeasureLengthUnit.Meters;\n    }\n    else if (this.labelFlag === LabelType.Coordinates){\n      this.currentCoordinates = this.coordinatesInDD;\n      this.coordinatesMeasureUnit = CoordinatesUnit.DecimalDegree;\n    }\n\n    const labeltypes = [this.labelType.Length, this.labelType.Area];\n    if (\n      this.olGeometryType === GeometryType.Polygon &&\n      labeltypes.includes(labelType)) {\n      checked ? this.polygonCheck += 1 : this.polygonCheck -= 1;;\n    } else {\n      this.polygonCheck = 0;\n    }\n  }\n\n  onChangeLengthUnit(lengthUnit: MeasureLengthUnit){\n    this.lengthMeasureUnit = lengthUnit;\n    this.currentLength = metersToUnit(Number(this.lengthInMeters), lengthUnit).toFixed(2);\n  }\n\n  onChangeAreaUnit(areaUnit: MeasureAreaUnit){\n    this.areaMeasureUnit = areaUnit;\n    this.currentArea = squareMetersToUnit(Number(this.areaInMetersSquare), areaUnit).toFixed(2);\n  }\n\n  onChangeCoordinateUnit(coordinatesUnit: CoordinatesUnit){\n    this.coordinatesMeasureUnit = coordinatesUnit;\n    let coordinates = DDtoDMS(this.longlatDD, coordinatesUnit);\n    this.currentCoordinates = '(' + coordinates[1] + ', ' + coordinates[0] + ')';\n  }\n\n  buildArrayType() {\n    for (const labelType of Object.values(LabelType)){\n      if (labelType !== LabelType.Custom && labelType !== LabelType.Predefined){\n        this.arrayBuiltInType.push({\n          value: labelType,\n          checked:\n            this.selectOptions(labelType) ||\n            this.labelFlag === labelType ||\n            (this.polygonCheck === 2 && labelType !== LabelType.Coordinates)\n        });\n      }\n    }\n  }\n\n  noLabelButton(){\n    if (this.labelFlag === LabelType.Predefined || (this.labelFlag === LabelType.Custom && this.labelLength === 0)){\n      return this.languageService.translate.instant('igo.geo.draw.noLabel');\n    }\n\n    return 'OK';\n  }\n\n  get customOrPredefined(){\n    if (this.labelFlag === LabelType.Custom){\n      return LabelType.Custom;\n    }\n    return LabelType.Predefined;\n  }\n\n  optionAvailable(currentOption: LabelType){\n    switch(this.olGeometryType){\n      case GeometryType.Point:\n        if (currentOption === LabelType.Coordinates){\n          return false;\n        }\n        return true;\n      case GeometryType.LineString:\n        if (currentOption === LabelType.Length){\n          return false;\n        }\n        return true;\n      case GeometryType.Polygon:\n        if (currentOption === LabelType.Coordinates){\n          return true;\n        }\n        return false;\n      default:\n        return false;\n    }\n  }\n\n  get allLengthUnits(): string[]{\n    return Object.values(MeasureLengthUnit);\n  }\n\n  getLengthUnitEnum(lengthUnit: MeasureLengthUnit){\n    return MeasureLengthUnitAbbreviation[lengthUnit];\n  }\n\n  get allAreaUnits(): string[]{\n    return Object.values(MeasureAreaUnit);\n  }\n\n  get allCoordinatesUnits(): string[]{\n    return Object.values(CoordinatesUnit);\n  }\n\n  getAreaUnitEnum(areaUnit: MeasureAreaUnit){\n    return MeasureAreaUnitAbbreviation[areaUnit];\n  }\n\n  private getRadius(olGeometry): number{\n    const length = getLength(olGeometry);\n    return Number(length / (2 * Math.PI));\n  }\n\n  get lengthLabelT(){\n    if (this.olGeometryType === GeometryType.Polygon){\n      return this.languageService.translate.instant('igo.geo.measure.perimeter');\n    }\n    if (this.olGeometryType === GeometryType.Circle){\n      return this.languageService.translate.instant('igo.geo.search.coordinates.radius');\n    }\n    return this.languageService.translate.instant('igo.geo.draw.labelType.Length');\n  }\n\n  getLabelLength(event?){\n    this.labelLength = event.length;\n  }\n\n  selectOptions(option){\n    if (this.olGeometryType === GeometryType.Point){\n      return option === LabelType.Coordinates;\n    }\n    else if (this.olGeometryType === GeometryType.LineString){\n      return option === LabelType.Length;\n    }\n  }\n\n  getProperLengthLabel(option){\n    if (option === LabelType.Length){\n      if (this.olGeometryType === GeometryType.Polygon){\n        return this.languageService.translate.instant('igo.geo.measure.perimeter');\n      }\n      if (this.olGeometryType === GeometryType.Circle){\n        return this.languageService.translate.instant('igo.geo.search.coordinates.radius');\n      }\n      return this.languageService.translate.instant('igo.geo.draw.labelType.Length');\n    }\n    return this.languageService.translate.instant('igo.geo.draw.labelType.' + option);\n  }\n\n\n}\n","import { Component } from '@angular/core';\n\n@Component({\n  selector: 'igo-draw-shorcuts',\n  templateUrl: './draw-shorcuts.component.html',\n  styleUrls: ['./draw-shorcuts.component.scss']\n})\n\nexport class DrawShorcutsComponent {}\n","<mat-dialog-content>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-return\"></mat-icon>{{'igo.geo.draw.finish' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"backspace-outline\"></mat-icon>{{'igo.geo.draw.undo' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-esc\"></mat-icon>{{'igo.geo.draw.abort' | translate}}</span>\n  </div>\n  <div>\n    <span class=\"shortcut mat-typography\">\n      <mat-icon class=\"shortcut-icon\" svgIcon=\"keyboard-space\"></mat-icon>{{'igo.geo.draw.move' | translate}}</span>\n  </div>\n</mat-dialog-content>\n<mat-dialog-actions class=\"shortcuts-close\">\n  <button mat-raised-button mat-dialog-close color=\"primary\">OK</button>\n</mat-dialog-actions>","import { Component, Input } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\nexport interface DialogData {\n  label: string;\n}\n\n@Component({\n  selector: 'igo-draw-popup-component',\n  templateUrl: './draw-layer-popup.component.html',\n  styleUrls: ['./draw-layer-popup.component.scss']\n})\nexport class DrawLayerPopupComponent {\n  @Input() confirmFlag: boolean = false;\n\n  constructor(\n    public dialogRef: MatDialogRef<DrawLayerPopupComponent>,\n    // @Inject(MAT_DIALOG_DATA) public data: { currentLabel: string }\n  ) {}\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n  confirm(labelString: string) {\n    this.confirmFlag = true;\n    this.dialogRef.close(labelString);\n  }\n}\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">\n    {{ 'igo.geo.draw.layer.layerDialogInstruction' | translate }}\n  </p>\n  <mat-form-field class=\"example-full-width\">\n    <input\n      #input\n      matInput\n      placeholder=\"{{ 'igo.geo.draw.layer.title' | translate }}\"\n      />\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button mat-raised-button (click)=\"cancelDrawing()\">\n    {{ 'igo.geo.draw.cancel' | translate }}\n  </button>\n  <button mat-raised-button color=\"primary\" (click)=\"confirm(input.value)\">\n    OK\n  </button>\n</div>\n","<div>\n  <div class=\"geometry-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      (change)=\"onGeometryTypeChange($event.value)\" [value]=\"geometryType.Point\">\n      <mat-button-toggle [value]=\"geometryType.Point\">\n        {{'igo.geo.draw.' + geometryType.Point | translate}}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.LineString\">\n        {{'igo.geo.draw.' + geometryType.LineString | translate}}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Polygon\">\n        {{'igo.geo.draw.' + geometryType.Polygon | translate}}\n      </mat-button-toggle>\n\n      <mat-button-toggle [value]=\"geometryType.Circle\">\n        {{'igo.geo.draw.' + geometryType.Circle | translate}}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"draw-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\">\n      {{'igo.geo.spatialFilter.drawControl' | translate}}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      [checked]=\"labelsAreShown\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleLabels()\">\n      {{ 'igo.geo.draw.toggleMapTooltips' | translate }}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle\n      *ngIf=\"!isPoint()\"\n      [checked]=\"freehandMode\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleFreehandMode($event)\">\n      {{ 'igo.geo.draw.freehandMode' | translate }}\n    </mat-slide-toggle>\n\n    <div class=\"radius-unit\" *ngIf=\"isCircle()\">\n      <form class=\"radius-form\">\n        <mat-form-field class=\"radius\">\n          <input\n            matInput type=\"number\"\n            min=\"0\"\n            placeholder=\"{{ 'igo.geo.spatialFilter.radius' | translate }}\"\n            [formControl]=\"radiusFormControl\"\n            [readonly]=\"this.freehandMode\">\n        </mat-form-field>\n      </form>\n\n      <mat-form-field class=\"unit-field\">\n        <mat-select\n          [value]=\"measureUnit\"\n          (selectionChange)=\"onMeasureUnitChange($event.value)\">\n          <mat-option\n            *ngFor=\"let measureUnit of measureUnits\"\n            [value]=\"measureUnit\">\n            {{('igo.geo.measure.' + measureUnit) | translate}}\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n\n  <mat-divider></mat-divider>\n\n  <div>\n    <mat-form-field appearance=\"outline\" class=\"layer-select\">\n      <mat-label>{{'igo.geo.draw.layer.title' | translate}}</mat-label>\n      <mat-select #selectedLayer (selectionChange)=\"onLayerChange(selectedLayer.value)\" [value]=\"updateActiveLayer()\">\n        <mat-option *ngFor=\"let layer of allLayers\" [value]=\"layer\">\n          {{ layer.title }}\n        </mat-option>\n        <mat-option id=\"createNewLayer\" >\n          {{'igo.geo.draw.layer.createNewLayer' | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <button\n      *ngIf=\"activeDrawingLayer\"\n      mat-icon-button\n      [color]=\"activeDrawingLayer.visible ? 'primary' : 'default'\"\n      collapsibleButton\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"activeDrawingLayer.visible ?\n                    ('igo.geo.layer.hideLayer' | translate) :\n                    ('igo.geo.layer.showLayer' | translate)\"\n      (click)=\"activeDrawingLayer.visible = !activeDrawingLayer.visible\">\n      <mat-icon\n        [svgIcon]=\"activeDrawingLayer.visible ? 'eye' : 'eye-off'\">\n      </mat-icon>\n    </button>\n  </div>\n  <mat-divider></mat-divider>\n  <div>\n    <button\n      *ngIf=\"activeStore.count$.getValue() > 0\"\n      class=\"deleteBtn\"\n      mat-icon-button\n      color=\"warn\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.draw.delete' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      (click)=\"deleteDrawings()\"\n    >\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <div>\n      <igo-entity-table\n        #table\n        class=\"table-compact\"\n        [store]=\"activeStore\"\n        [template]=\"tableTemplate\">\n      </igo-entity-table>\n    </div>\n  </div>\n\n  <div class=\"icon-options\">\n    <mat-form-field *ngIf=\"icons.length >= 1\">\n      <mat-label>{{ 'igo.geo.draw.icon' | translate }}</mat-label>\n      <mat-select>\n        <mat-select-trigger>\n          <div *ngIf=\"icon\" class=\"box\">\n            <img src=\"{{ icon }}\">\n          </div>\n        </mat-select-trigger>\n        <mat-option value=\"\" (click)=\"onIconChange()\">{{ 'igo.geo.draw.noIcon' | translate }}</mat-option>\n        <mat-option\n          *ngFor=\"let icon_html of icons\"\n          [value]=\"icon_html\"\n          (click)=\"onIconChange(icon_html)\">\n          <div class=\"box\">\n            <img src=\"{{ icon_html }}\">\n          </div>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <button\n    mat-icon-button\n    color=\"accent\"\n    disableRipple=\"true\"\n    (click)=\"openShorcutsDialog()\"\n  >\n    <mat-icon\n      class=\"shortcuts-icon\"\n      svgIcon=\"keyboard-outline\"\n      tooltip-position=\"below\"\n      matTooltipShowDelay=\"500\"\n      [matTooltip]=\"'igo.geo.draw.shortcuts' | translate\"\n    >\n    </mat-icon>\n  </button>\n\n  <button\n    *ngIf=\"selectedFeatures$.value.length\"\n    mat-raised-button\n    color=\"primary\"\n    (click)=\"openStyleModalDialog()\"\n    [matTooltip]=\"'igo.geo.layer.style.styleModalTooltip' | translate\">\n    {{'igo.geo.layer.style.styleModal' | translate}}\n    <mat-icon\n      class=\"style-icon\"\n      svgIcon=\"palette\"\n      [matBadge]=\"selectedFeatures$.value.length\"\n      matBadgeColor=\"warn\"\n      matBadgeSize=\"medium\">\n    </mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter,\n  ViewChild\n} from '@angular/core';\n\nimport {\n  FEATURE,\n  FeatureStore,\n  FeatureStoreSelectionStrategy,\n  tryBindStoreLayer,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy,\n  FeatureMotion,\n  FeatureStoreLoadingStrategy,\n  featureToOl\n} from '../../feature';\n\nimport { LanguageService } from '@igo2/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { CoordinatesUnit, FontType, GeometryType, LabelType } from '../shared/draw.enum';\nimport { IgoMap } from '../../map/shared/map';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { Draw, FeatureWithDraw } from '../shared/draw.interface';\nimport { UntypedFormGroup, UntypedFormBuilder, UntypedFormControl } from '@angular/forms';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { DrawControl } from '../../geometry/shared/controls/draw';\nimport {\n  EntityRecord,\n  EntityTableButton,\n  EntityTableColumnRenderer,\n  EntityTableTemplate\n} from '@igo2/common';\n\nimport * as OlStyle from 'ol/style';\nimport * as olproj from 'ol/proj';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlCircle from 'ol/geom/Circle';\nimport OlPoint from 'ol/geom/Point';\nimport OlFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlOverlay from 'ol/Overlay';\nimport type { Type } from 'ol/geom/Geometry';\nimport { default as OlGeometry } from 'ol/geom/Geometry';\nimport { getDistance, getLength } from 'ol/sphere';\nimport { DrawStyleService } from '../shared/draw-style.service';\nimport { first, skip } from 'rxjs/operators';\nimport { DrawPopupComponent } from './draw-popup.component';\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\nimport { getTooltipsOfOlGeometry } from '../../measure/shared/measure.utils';\nimport { createInteractionStyle, DDtoDMS } from '../shared/draw.utils';\nimport { transform } from 'ol/proj';\nimport { DrawIconService } from '../shared/draw-icon.service';\nimport { StyleModalComponent, StyleModalData } from '../../layer/style-modal/style-modal.component';\n\nimport {\n  trigger,\n  state,\n  style,\n  animate,\n  transition\n} from '@angular/animations';\n\nimport { DrawLayerPopupComponent } from './draw-layer-popup.component';\n\nimport {\n  measureOlGeometryLength,\n  measureOlGeometryArea,\n  metersToUnit,\n  squareMetersToUnit\n} from '../../measure/shared/measure.utils';\n\nimport {\n  MeasureLengthUnit,\n  MeasureLengthUnitAbbreviation,\n  MeasureAreaUnit,\n  MeasureAreaUnitAbbreviation,\n} from '../../measure/shared/measure.enum';\nimport Polygon, { fromCircle } from 'ol/geom/Polygon';\n\n\n@Component({\n  selector: 'igo-draw',\n  animations: [\n    trigger('openClose', [\n      state(\n        'open',\n        style({\n          opacity: 1\n        })\n      ),\n      state(\n        'closed',\n        style({\n          opacity: 0\n        })\n      ),\n      transition('open => closed', [animate('600ms ease')]),\n      transition('closed => open', [animate('800ms ease')])\n    ])\n  ],\n  templateUrl: './draw.component.html',\n  styleUrls: ['./draw.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DrawComponent implements OnInit, OnDestroy {\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate = {\n    selection: true,\n    selectMany: true,\n    selectionCheckbox: true,\n    sort: true,\n    fixedHeader: true,\n    tableHeight: 'auto',\n    columns: [\n      {\n        name: 'Drawing',\n        title: this.languageService.translate.instant('igo.geo.draw.labels'),\n        valueAccessor: (feature: FeatureWithDraw) => {\n          return feature.properties.draw;\n        }\n      },\n      {\n        name: 'Edition',\n        title: '',\n        sort: false,\n        valueAccessor: (feature: FeatureWithDraw) => {\n          return [{\n            editMode: false,\n            icon: 'pencil',\n            color: 'primary',\n            click: () => { this.editLabelDrawing(feature);},\n            style: 'mat-icon-button'\n          }] as EntityTableButton[];\n        },\n        renderer: EntityTableColumnRenderer.ButtonGroup,\n      }\n    ]\n  };\n\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n  @Input() map: IgoMap; // Map to draw on\n\n  @Input()\n  get stores(): FeatureStore<FeatureWithDraw>[] {\n    return this._stores;\n  }\n  set stores(value: FeatureStore<FeatureWithDraw>[]) {\n    this._stores = value;\n  }\n  private _stores:FeatureStore<FeatureWithDraw>[] = [];\n\n  @Input()\n  get drawControls(): [string, DrawControl][]{\n    return this._drawControls;\n  }\n  set drawControls(value: [string, DrawControl][]){\n    this._drawControls = value;\n  }\n  private _drawControls = [];\n\n  @Input()\n  get activeDrawingLayer(): VectorLayer {\n    return this._activeDrawingLayer;\n  }\n  set activeDrawingLayer(value: VectorLayer) {\n    this._activeDrawingLayer = value;\n  }\n  private _activeDrawingLayer: VectorLayer;\n\n  @Output() activeLayerChange = new EventEmitter<VectorLayer>();\n  @Output() drawControlsEvent = new EventEmitter<[string, DrawControl][]>();\n  @Output() layersIDEvent = new EventEmitter<string>();\n\n  @Output() fillColor: string;\n  @Output() strokeColor: string;\n  @Output() strokeWidth: number;\n\n  @Output() fontSize: string;\n  @Output() fontStyle: string;\n\n  public activeStore: FeatureStore<FeatureWithDraw>;\n  private layerCounterID: number = 0;\n  public draw$: BehaviorSubject<Draw> = new BehaviorSubject({}); // Observable of draw\n  private activeDrawingLayerSource = new OlVectorSource();\n  private activeDrawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private drawSelect$$: Subscription;\n  public selectedFeatures$: BehaviorSubject<FeatureWithDraw[]> =\n    new BehaviorSubject([]);\n  public fillForm: string;\n  public strokeForm: string;\n  public drawControlIsDisabled: boolean = true;\n  public drawControlIsActive: boolean = false;\n  public labelsAreShown: boolean;\n  public freehandMode = false;\n  private subscriptions$$: Subscription[] = [];\n\n  public position: string = 'bottom';\n  public form: UntypedFormGroup;\n  public icons: Array<string>;\n  public icon: string;\n\n  public radiusFormControl = new UntypedFormControl(1000);\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  public radiusFormControlChange$$: Subscription = new Subscription();\n  public predefinedRadius$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n  public radiusDrawEnd$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n  private numberOfDrawings: number;\n  public isCreatingNewLayer: boolean = false;\n  private currGeometryType = this.geometryType.Point as any;\n\n  @ViewChild('selectedLayer') select;\n\n  constructor(\n    private languageService: LanguageService,\n    private formBuilder: UntypedFormBuilder,\n    private drawStyleService: DrawStyleService,\n    private dialog: MatDialog,\n    private drawIconService: DrawIconService\n\n  ) {\n    this.buildForm();\n    this.fillColor = this.drawStyleService.getFillColor();\n    this.strokeColor = this.drawStyleService.getStrokeColor();\n    this.strokeWidth = this.drawStyleService.getStrokeWidth();\n    this.labelsAreShown = this.drawStyleService.getLabelsAreShown();\n    this.icons = this.drawIconService.getIcons();\n    this.icon = this.drawStyleService.getIcon();\n\n    this.fontSize = this.drawStyleService.getFontSize();\n    this.fontStyle = this.drawStyleService.getFontStyle();\n  }\n\n  // Initialize the store that will contain the entities and create the Draw control\n  ngOnInit() {\n    if (!this.stores.length) {\n      this.activeStore = new FeatureStore<FeatureWithDraw>([], {\n        map: this.map\n      });\n      this.initStore();\n      this.activeDrawControl = this.createDrawControl(\n        this.fillColor,\n        this.strokeColor,\n        this.strokeWidth\n      );\n      this.activeDrawControl.setGeometryType(this.geometryType.Point as any);\n      this.toggleDrawControl();\n      this.stores.push(this.activeStore);\n      this.drawControls.push([this.activeDrawingLayer.id, this.activeDrawControl]);\n      this.drawControlsEvent.emit(this.drawControls);\n      this.layersIDEvent.emit(this.activeDrawingLayer.id);\n      this.onLayerChange(this.activeDrawingLayer);\n    } else {\n      this.activeStore = this.stores.find(store => store.layer.id === this.activeDrawingLayer.id);\n      this.activeDrawControl = this.drawControls.find(dc => dc[0] === this.activeDrawingLayer.id)[1];\n      this.deactivateDrawControl();\n      this.allLayers.forEach(layer => {\n        if (layer.id !== this.activeDrawingLayer.id) {\n          layer.opacity = 0;\n        }\n        let store = this.stores.find(s => s.layer.id === layer.id);\n\n        this.subscriptions$$.push(\n          store.stateView\n            .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n              return record.state.selected === true;\n            })\n            .pipe(\n              first()\n            )\n            .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n              records.forEach((record) => {\n                record.state.selected = false;\n              });\n            })\n        );\n\n        this.subscriptions$$.push(\n          store.stateView\n            .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n              return record.state.selected === true;\n            })\n            .pipe(\n              skip(1) // Skip initial emission\n            )\n            .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n              this.selectedFeatures$.next(records.map((record) => record.entity));\n            })\n        );\n\n        this.subscriptions$$.push(\n          store.count$.subscribe((cnt) => {\n            cnt >= 1\n              ? (this.activeStore.layer.options.showInLayerList = true)\n              : (this.activeStore.layer.options.showInLayerList = false);\n          })\n        );\n      });\n      this.onLayerChange(this.activeDrawingLayer);\n    }\n\n    this.radiusFormControlChange$$ = this.radiusFormControl.valueChanges.subscribe(value => {\n      if (this.activeDrawControl.ispredefinedRadius$.getValue()) {\n        this.changeRadius(value);\n      }\n    });\n  }\n\n  /**\n   * Remove the drawing layer and the interactions\n   * @internal\n   */\n  ngOnDestroy() {\n    this.allLayers.forEach(layer => layer.opacity = 1);\n    this.activeStore.state.updateAll({selected: false});\n    this.deactivateDrawControl();\n    this.subscriptions$$.map((s) => s.unsubscribe());\n    this.radiusFormControlChange$$.unsubscribe();\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(\n    fillColor?: string,\n    strokeColor?: string,\n    strokeWidth?: number\n  ) {\n    const activeDrawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.activeDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(\n        fillColor,\n        strokeColor,\n        strokeWidth\n      )\n    });\n    return activeDrawControl;\n  }\n\n  /**\n   * Store initialization, including drawing layer creation\n   */\n\n  private initStore(newTitle?: string, isNewLayer?: boolean) {\n    this.createLayer(newTitle, isNewLayer);\n    this.subscriptions$$.push(\n      this.activeStore.stateView\n        .manyBy$((record: EntityRecord<FeatureWithDraw>) => {\n          return record.state.selected === true;\n        })\n        .pipe(\n          skip(1) // Skip initial emission\n        )\n        .subscribe((records: EntityRecord<FeatureWithDraw>[]) => {\n          this.selectedFeatures$.next(records.map((record) => record.entity));\n        })\n    );\n\n    this.subscriptions$$.push(\n      this.activeStore.count$.subscribe((cnt) => {\n        cnt >= 1\n          ? (this.activeStore.layer.options.showInLayerList = true)\n          : (this.activeStore.layer.options.showInLayerList = false);\n      })\n    );\n  }\n\n/**\n * Open the style modal dialog box\n */\n  openStyleModalDialog() {\n    setTimeout(() => {\n      // open the dialog box used to style features\n      const dialogRef = this.dialog.open(StyleModalComponent, {\n        disableClose: false,\n        data: {\n          features: this.selectedFeatures$.getValue(),\n          icons: this.icons,\n          icon: this.icon\n        },\n        autoFocus: false\n      });\n\n      // when dialog box is closed, get label and set it to geometry\n      dialogRef.afterClosed().subscribe((data: StyleModalData) => {\n        // checks if the user clicked ok\n        if (dialogRef.componentInstance.confirmFlag) {\n          this.onFontChange(this.labelsAreShown, data.fontSize, data.fontStyle);\n          this.onColorChange(this.labelsAreShown, this.icon ? true : false, data.fillColor, data.strokeColor);\n          this.onOffsetLabelChange(this.labelsAreShown, data.offsetX, data.offsetY);\n        }\n      });\n    }, 250);\n  }\n\n  /**\n   * Open a dialog box to enter label and do something\n   * @param olGeometry geometry at draw end or selected geometry\n   * @param drawEnd event fired at drawEnd?\n   */\n  private openDrawDialog(olGeometry, isDrawEnd: boolean) {\n    setTimeout(() => {\n      // open the dialog box used to enter label\n      const dialogRef = this.dialog.open(DrawPopupComponent, {\n        disableClose: false,\n        data: {olGeometry: olGeometry, map: this.map}\n      });\n\n      // when dialog box is closed, get label and set it to geometry\n      dialogRef.afterClosed().subscribe((result) => {\n        // checks if the user clicked ok\n        if (dialogRef.componentInstance.confirmFlag) {\n\n          this.updateLabelOfOlGeometry(olGeometry, result.label);\n          this.updateLabelType(olGeometry, dialogRef.componentInstance.labelFlag);\n          this.updateMeasureUnit(olGeometry, result.measureUnit);\n\n          if (!(olGeometry instanceof OlFeature)){\n            this.updateFontSizeAndStyle(olGeometry, '15', FontType.Arial);\n            this.updateFillAndStrokeColor(\n              olGeometry,\n              'rgba(255,255,255,0.4)',\n              'rgba(143,7,7,1)'\n            );\n            this.updateOffset(\n              olGeometry,\n              0,\n              (olGeometry instanceof OlPoint) ? -15 : 0\n            );\n          }\n\n          isDrawEnd ? this.onDrawEnd(olGeometry): this.onSelectDraw(olGeometry, result.label,\n            [dialogRef.componentInstance.labelFlag, result.measureUnit]);\n          this.updateHeightTable();\n        }\n        // deletes the feature\n        else {\n          this.activeDrawingLayerSource\n            .getFeatures()\n            .forEach((drawingLayerFeature) => {\n              const geometry = drawingLayerFeature.getGeometry() as any;\n              if (olGeometry === geometry) {\n                this.activeDrawingLayerSource.removeFeature(\n                  drawingLayerFeature\n                );\n              }\n            });\n        }\n      });\n    }, 250);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlGeometry, radius?: number) {\n    this.addFeatureToStore(olGeometry, radius);\n    this.clearLabelsOfOlGeometry(olGeometry);\n    this.activeStore.layer.ol.getSource().refresh();\n  }\n\n  private onModifyDraw(olGeometry) {\n    const entities = this.activeStore.all();\n\n    entities.forEach((entity) => {\n      const entityId = entity.properties.id;\n      const olGeometryId = olGeometry.ol_uid;\n\n      if (entityId === olGeometryId) {\n        if (entity.properties.labelType === LabelType.Coordinates){\n          let longLat = DDtoDMS([entity.properties.longitude, entity.properties.latitude],\n            entity.properties.measureUnit as CoordinatesUnit);\n          this.updateLabelOfOlGeometry(olGeometry, '(' + longLat[1] + ', ' + longLat[0] + ')');\n        }\n        else if (entity.properties.labelType === LabelType.Length){\n          if (olGeometry instanceof OlCircle){\n            let circularPolygon = fromCircle(olGeometry, 10000);\n            const radius = metersToUnit(this.getRadius(circularPolygon), entity.properties.measureUnit as MeasureLengthUnit);\n            const unit = MeasureLengthUnitAbbreviation[entity.properties.measureUnit];\n            const radiusLabel = 'R: ' + radius.toFixed(2).toString() + ' ' + unit;\n            this.updateLabelOfOlGeometry(olGeometry, radiusLabel);\n          }\n          else {\n            let olGeometryLength = measureOlGeometryLength(olGeometry, this.map.ol.getView().getProjection().getCode());\n            let measureUnit: any;\n            const temp: MeasureLengthUnit = entity.properties.measureUnit as MeasureLengthUnit;\n            measureUnit = MeasureLengthUnitAbbreviation[entity.properties.measureUnit];\n            olGeometryLength = metersToUnit(olGeometryLength, temp);\n            let lengthLabel = olGeometry instanceof Polygon ?\n              'P: ' + olGeometryLength.toFixed(2).toString() + ' ' + measureUnit\n              : olGeometryLength.toFixed(2).toString() + ' ' + measureUnit;\n            this.updateLabelOfOlGeometry(olGeometry, lengthLabel);\n          }\n        }\n        else if (entity.properties.labelType === LabelType.Area){\n          if (olGeometry instanceof OlCircle){\n            let circularPolygon = fromCircle(olGeometry, 10000);\n            let circleArea = measureOlGeometryArea(circularPolygon, this.map.ol.getView().getProjection().getCode());\n            const unit = MeasureAreaUnitAbbreviation[entity.properties.measureUnit];\n            const temp: MeasureAreaUnit = entity.properties.measureUnit as MeasureAreaUnit;\n            circleArea = squareMetersToUnit(circleArea, temp);\n            const areaLabel = circleArea.toFixed(2).toString() + ' ' + unit;\n            this.updateLabelOfOlGeometry(olGeometry, areaLabel);\n          }\n          else {\n            let olGeometryArea = measureOlGeometryArea(olGeometry, this.map.ol.getView().getProjection().getCode());\n            let measureUnit: any;\n            const temp: MeasureAreaUnit = entity.properties.measureUnit as MeasureAreaUnit;\n            measureUnit = MeasureAreaUnitAbbreviation[entity.properties.measureUnit];\n            olGeometryArea = squareMetersToUnit(olGeometryArea, temp);\n            const lengthLabel = olGeometryArea.toFixed(2).toString() + ' ' + measureUnit;\n            this.updateLabelOfOlGeometry(olGeometry, lengthLabel);\n          }\n        }\n        else {\n          this.updateLabelOfOlGeometry(olGeometry, entity.properties.draw);\n        }\n\n        this.updateLabelType(\n          olGeometry,\n          entity.properties.labelType\n        );\n        this.updateMeasureUnit(olGeometry, entity.properties.measureUnit);\n        this.updateFontSizeAndStyle(\n          olGeometry,\n          entity.properties.fontStyle.split(' ')[0].replace('px', ''),\n          entity.properties.fontStyle.substring(\n            entity.properties.fontStyle.indexOf(' ') + 1\n          )\n        );\n        this.updateFillAndStrokeColor(\n          olGeometry,\n          entity.properties.drawingStyle.fill,\n          entity.properties.drawingStyle.stroke\n        );\n        this.updateOffset(\n          olGeometry,\n          entity.properties.offsetX,\n          entity.properties.offsetY\n        );\n        this.replaceFeatureInStore(entity, olGeometry);\n      }\n    });\n  }\n\n  private onSelectDraw(olFeature: OlFeature<OlGeometry>, label: string, labelTypeAndUnit?) {\n    const entities = this.activeStore.all();\n\n    const olGeometry = olFeature.getGeometry() as any;\n    olGeometry.ol_uid = olFeature.get('id');\n\n    const olGeometryCoordinates = JSON.stringify(\n      olGeometry.getCoordinates()[0]\n    );\n\n    entities.forEach((entity) => {\n      const entityCoordinates = JSON.stringify(entity.geometry.coordinates[0]);\n      if (olGeometryCoordinates === entityCoordinates) {\n        const fontSize = olFeature\n          .get('fontStyle')\n          .split(' ')[0]\n          .replace('px', '');\n        const fontStyle = olFeature\n          .get('fontStyle')\n          .substring(olFeature.get('fontStyle').indexOf(' ') + 1);\n\n        const fillColor = olFeature.get('drawingStyle').fill;\n        const strokeColor = olFeature.get('drawingStyle').stroke;\n\n        const offsetX = olFeature.get('offsetX');\n        const offsetY = olFeature.get('offsetY');\n\n        const rad: number = entity.properties.rad\n          ? entity.properties.rad\n          : undefined;\n        this.updateLabelOfOlGeometry(olGeometry, label);\n        this.updateFontSizeAndStyle(olGeometry, fontSize, fontStyle);\n        this.updateFillAndStrokeColor(olGeometry, fillColor, strokeColor);\n        this.updateOffset(olGeometry, offsetX, offsetY);\n        this.updateLabelType(olGeometry, labelTypeAndUnit[0]);\n        this.updateMeasureUnit(olGeometry, labelTypeAndUnit[1]);\n        this.replaceFeatureInStore(entity, olGeometry, rad);\n      }\n    });\n  }\n\n  /**\n   * Add a feature with draw label to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(\n    olGeometry,\n    radius?: number,\n    feature?: FeatureWithDraw,\n  ) {\n    let rad: number;\n    let center4326: Array<number>;\n    let point4326: Array<number>;\n    let lon4326: number;\n    let lat4326: number;\n\n    const featureId = feature ? feature.properties.id : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n\n    if (olGeometry instanceof OlCircle || radius) {\n      if (radius) {\n        rad = radius;\n      } else {\n        geometry.type = 'Point';\n        geometry.coordinates = olGeometry.getCenter();\n        const extent4326 = transform(\n          [\n            olGeometry.getFlatCoordinates()[2],\n            olGeometry.getFlatCoordinates()[3]\n          ],\n          projection,\n          'EPSG:4326'\n        );\n        center4326 = transform(\n          [\n            olGeometry.getFlatCoordinates()[0],\n            olGeometry.getFlatCoordinates()[1]\n          ],\n          projection,\n          'EPSG:4326'\n        );\n        lon4326 = center4326[0];\n        lat4326 = center4326[1];\n        rad = getDistance(center4326, extent4326);\n        this.radiusFormControl.setValue(Math.round(rad));\n      }\n\n    }\n    if (this.activeDrawControl.radiusDrawEnd$.getValue()) {\n      rad = this.activeDrawControl.radiusDrawEnd$.getValue();\n    }\n\n    if (olGeometry instanceof OlPoint) {\n      point4326 = transform(\n        olGeometry.getFlatCoordinates(),\n        projection,\n        'EPSG:4326'\n      );\n      lon4326 = point4326[0];\n      lat4326 = point4326[1];\n    }\n\n    this.activeStore.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        draw: olGeometry.get('_label'),\n        longitude: lon4326 ? lon4326 : null,\n        latitude: lat4326 ? lat4326 : null,\n        rad: rad ? rad : null,\n        fontStyle: olGeometry.get('fontStyle_'),\n        drawingStyle: {\n          fill: olGeometry.get('fillColor_'),\n          stroke: olGeometry.get('strokeColor_')\n        },\n        offsetX: olGeometry.get('offsetX_'),\n        offsetY: olGeometry.get('offsetY_'),\n        labelType: olGeometry.get('labelType_'),\n        measureUnit: olGeometry.get('measureUnit_')\n      },\n      meta: {\n        id: featureId\n      }\n    });\n    this.activeStore.setLayerExtent();\n    this.activeDrawControl.predefinedRadius$.next(undefined);\n    this.activeDrawControl.radiusDrawEnd$.next(undefined);\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [''],\n      stroke: ['']\n    });\n  }\n\n  public setupLayer(isNewLayer?: boolean) {\n    setTimeout(() => {\n      const dialogRef = this.dialog.open(DrawLayerPopupComponent, {\n        disableClose: false,\n      });\n      dialogRef.afterClosed().subscribe((label: string) => {\n        if (dialogRef.componentInstance.confirmFlag) {\n          this.activeStore.state.updateAll({selected: false});\n          this.activeStore = new FeatureStore<FeatureWithDraw>([], { map: this.map });\n          this.activeDrawingLayerSource = new OlVectorSource();\n          this.activeDrawingLayer.opacity = 0;\n          this.deactivateDrawControl();\n          this.initStore(label, isNewLayer);\n          this.activeDrawControl = this.createDrawControl(\n            this.fillColor,\n            this.strokeColor,\n            this.strokeWidth\n          );\n          this.activeDrawControl.setGeometryType(this.currGeometryType);\n          this.toggleDrawControl();\n          this.stores.push(this.activeStore);\n          this.drawControls.push([this.activeDrawingLayer.id, this.activeDrawControl]);\n          this.drawControlsEvent.emit(this.drawControls);\n          this.layersIDEvent.emit(this.activeDrawingLayer.id);\n          this.isCreatingNewLayer = false;\n          if (!this.labelsAreShown){\n            this.onToggleLabels();\n          }\n          this.activeLayerChange.emit(this.activeDrawingLayer);\n        } else {\n          this.select.value = this.activeDrawingLayer;\n          this.select.selectionChange.emit(this.activeDrawingLayer);\n        }\n      });\n    }, 250);\n  }\n\n  // HTML user interactions\n\n  /**\n   * Called when the user double-clicks the selected drawing\n   */\n  editLabelDrawing(feature) {\n    const olGeometryFeature = featureToOl(\n      feature,\n      this.map.ol.getView().getProjection().getCode()\n    );\n    this.openDrawDialog(olGeometryFeature, false);\n\n  }\n\n  openShorcutsDialog() {\n    this.dialog.open(DrawShorcutsComponent);\n  }\n\n  deleteDrawings() {\n    this.activeStore.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach((selectedFeature) => {\n      this.activeDrawingLayerSource\n        .getFeatures()\n        .forEach((drawingLayerFeature) => {\n          const geometry = drawingLayerFeature.getGeometry() as any;\n          if (selectedFeature.properties.id === geometry.ol_uid) {\n            this.activeDrawingLayerSource.removeFeature(drawingLayerFeature);\n          }\n        });\n    });\n    this.updateHeightTable();\n    this.activeStore.setLayerExtent();\n  }\n\n  /**\n   * Called when the user toggles the labels toggle\n   */\n  onToggleLabels() {\n    this.drawStyleService.toggleLabelsAreShown();\n    this.labelsAreShown = !this.labelsAreShown;\n    this.icon\n      ? this.elementStyle(\n          this.labelsAreShown,\n          true\n        )\n      : this.elementStyle(\n          this.labelsAreShown,\n          false\n        );\n    this.createDrawControl();\n  }\n\n  /**\n   * Called when the user toggles the Draw control is toggled\n   * @internal\n   */\n  onToggleDrawControl(toggleIsChecked: boolean) {\n    toggleIsChecked ? this.toggleDrawControl() : this.deactivateDrawControl();\n  }\n\n  onToggleFreehandMode(event: any) {\n    if (this.isCircle() && !event.checked) {\n      this.activeDrawControl.ispredefinedRadius$.next(true);\n      this.changeRadius(this.radiusFormControl.value);\n    } else {\n      this.activeDrawControl.setOlInteractionStyle(createInteractionStyle(this.fillColor, this.strokeColor, this.strokeWidth));\n      this.activeDrawControl.ispredefinedRadius$.next(false);\n    }\n    this.freehandMode = event.checked;\n    this.activeDrawControl.freehand$.next(event.checked);\n    this.toggleDrawControl();\n  }\n\n  // User changes properties of a drawing element\n\n  /**\n   * Display the current layer with the current store and the current layerSource\n   */\n\n  public onLayerChange(currLayer?: VectorLayer) {\n    if (currLayer) {\n      this.activeStore.state.updateAll({selected: false});\n      this.isCreatingNewLayer = false;\n      this.activeDrawingLayer.opacity = 0;\n      this.activeDrawingLayer = currLayer;\n      this.activeDrawingLayer.opacity = 1;\n      this.deactivateDrawControl();\n      if (!this.labelsAreShown){\n        this.onToggleLabels();\n      }\n      this.activeStore = this.stores.find(store => store.layer.id === this.activeDrawingLayer.id);\n      this.activeDrawControl = this.drawControls.find(dc => dc[0] === this.activeDrawingLayer.id)[1];\n      this.activeDrawingLayerSource = this.activeDrawControl.olDrawingLayerSource;\n      this.activeDrawControl.setGeometryType(this.currGeometryType);\n      this.toggleDrawControl();\n    } else {\n      this.setupLayer(true);\n    }\n    this.activeLayerChange.emit(this.activeDrawingLayer);\n  }\n\n  public createLayer(newTitle?, isNewLayer?) {\n    for (const layer of this.allLayers){\n      let numberId = Number(layer.id.replace('igo-draw-layer',''));\n      this.layerCounterID = Math.max(numberId,this.layerCounterID);\n    }\n    this.activeDrawingLayer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id: 'igo-draw-layer' + ++this.layerCounterID,\n      title: isNewLayer\n        ? newTitle\n        : this.languageService.translate.instant('igo.geo.draw.drawing'),\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: (feature, resolution) => {\n        return this.drawStyleService.createIndividualElementStyle(\n          feature,\n          resolution,\n          this.labelsAreShown,\n          feature.get('fontStyle'),\n          feature.get('drawingStyle').fill,\n          feature.get('drawingStyle').stroke,\n          feature.get('offsetX'),\n          feature.get('offsetY'),\n          this.icon\n        );\n      },\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: {\n        enabled: false\n      }\n    });\n\n    tryBindStoreLayer(this.activeStore, this.activeDrawingLayer);\n\n    tryAddLoadingStrategy(\n      this.activeStore,\n      new FeatureStoreLoadingStrategy({\n        motion: FeatureMotion.None\n      })\n    );\n\n    tryAddSelectionStrategy(\n      this.activeStore,\n      new FeatureStoreSelectionStrategy({\n        map: this.map,\n        motion: FeatureMotion.None,\n        many: true\n      })\n    );\n    this.activeStore.layer.visible = true;\n    this.activeStore.source.ol.on(\n      'removefeature',\n      (event: OlVectorSourceEvent<OlGeometry>) => {\n        const olGeometry = event.feature.getGeometry();\n        this.clearLabelsOfOlGeometry(olGeometry);\n      }\n    );\n  }\n\n  /**\n   * Called when the user changes the color in a color picker\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param isAnIcon wheter the feature is an icon or not\n   * @param fillColor which is the filling color\n   * @param strokeColor which is the stroke color\n   */\n  onColorChange(\n    labelsAreShown: boolean,\n    isAnIcon: boolean,\n    fillColor: string,\n    strokeColor: string\n  ) {\n    if (this.selectedFeatures$.value.length > 0 && !isAnIcon) {\n      this.selectedFeatures$.value.forEach((feature) => {\n        let olFeature = featureToOl(\n          feature,\n          this.map.ol.getView().getProjection().getCode()\n        );\n        this.updateFillAndStrokeColor(olFeature, fillColor, strokeColor);\n\n        const entity = this.activeStore\n          .all()\n          .find((e) => e.meta.id === olFeature.getId());\n        entity.properties.drawingStyle.fill = olFeature.get('fillColor_');\n        entity.properties.drawingStyle.stroke = olFeature.get('strokeColor_');\n        this.activeStore.update(entity);\n      });\n    }\n\n    this.elementStyle(labelsAreShown, isAnIcon);\n    this.createDrawControl();\n  }\n\n  /**\n   * Called when the user changes the font size or/and style\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param size the size of the font\n   * @param style the style of the font\n   */\n\n  onFontChange(labelsAreShown: boolean, size: string, style: FontType) {\n    if (this.selectedFeatures$.value.length > 0) {\n      this.selectedFeatures$.value.forEach((feature) => {\n        let olFeature = featureToOl(\n          feature,\n          this.map.ol.getView().getProjection().getCode()\n        );\n        this.updateFontSizeAndStyle(olFeature, size, style);\n        const entity = this.activeStore\n          .all()\n          .find((e) => e.meta.id === olFeature.getId());\n        entity.properties.fontStyle = olFeature.get('fontStyle_');\n        this.activeStore.update(entity);\n        olFeature = this.activeStore.layer.ol.getSource().getFeatures().find(f => f.getId() === entity.meta.id);\n        olFeature.setProperties({ fontStyle: entity.properties.fontStyle });\n        olFeature.changed();\n      });\n\n      this.fontSize = size;\n      this.fontStyle = style;\n\n      this.drawStyleService.setFontSize(size);\n      this.drawStyleService.setFontStyle(style);\n\n      this.elementStyle(labelsAreShown);\n    }\n  }\n\n  /**\n   * Called when the user changes the value of the horizontal/vertical offset\n   * @param labelsAreShown wheter the labels are shown or not\n   * @param offsetX horizontal offset of the label\n   * @param offsetY vertical offset of the label\n   */\n\n  onOffsetLabelChange(\n    labelsAreShown: boolean,\n    offsetX: number,\n    offsetY: number\n  ) {\n    if (this.selectedFeatures$.value.length > 0) {\n      this.selectedFeatures$.value.forEach((feature) => {\n        let olFeature = featureToOl(\n          feature,\n          this.map.ol.getView().getProjection().getCode()\n        );\n        this.updateOffset(olFeature, offsetX, offsetY);\n        const entity = this.activeStore\n          .all()\n          .find((e) => e.meta.id === olFeature.getId());\n        entity.properties.offsetX = olFeature.get('offsetX_');\n        entity.properties.offsetY = olFeature.get('offsetY_');\n        this.activeStore.update(entity);\n        olFeature = this.activeStore.layer.ol.getSource().getFeatures().find(f => f.getId() === entity.meta.id);\n        olFeature.setProperties({ offsetX: entity.properties.offsetX, offsetY: entity.properties.offsetY });\n        olFeature.changed();\n      });\n      this.elementStyle(labelsAreShown);\n    }\n  }\n\n  onIconChange(event?) {\n    this.icon = event;\n    this.drawStyleService.setIcon(this.icon);\n    this.elementStyle(true, this.icon);\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(geometryType: Type) {\n    this.currGeometryType = geometryType;\n    this.activeDrawControl.setGeometryType(geometryType);\n    this.freehandMode ?\n      this.onToggleFreehandMode({ checked: true }) :\n      this.onToggleFreehandMode({ checked: false });\n    this.toggleDrawControl();\n  }\n\n  // Updates the properties of olFeature inputted\n\n  /**\n   * Update the label of a geometry when a label is entered in a dialog box\n   * @param OlFeature the feature\n   * @param label the label\n   */\n  private updateLabelOfOlGeometry(OlFeature, label: string) {\n    OlFeature.setProperties(\n      {\n        _label: label\n      },\n      true\n    );\n  }\n\n  private updateFontSizeAndStyle(\n    olFeature: OlFeature<OlGeometry>,\n    fontSize: string,\n    fontStyle: string\n  ) {\n    olFeature.setProperties(\n      {\n        fontStyle_: `${fontSize}px ${fontStyle}`\n      },\n      true\n    );\n  }\n\n  private updateFillAndStrokeColor(\n    olFeature: OlFeature<OlGeometry>,\n    fillColor: string,\n    strokeColor: string\n  ) {\n    olFeature.setProperties(\n      {\n        fillColor_: fillColor,\n        strokeColor_: strokeColor\n      },\n      true\n    );\n  }\n\n  private updateOffset(\n    olFeature: OlFeature<OlGeometry>,\n    offsetX: number,\n    offsetY: number\n  ) {\n    olFeature.setProperties(\n      {\n        offsetX_: offsetX,\n        offsetY_: offsetY\n      },\n      true\n    );\n  }\n\n  private updateLabelType(\n    olFeature: OlFeature<OlGeometry>,\n    typeOfLabel: LabelType | [LabelType, LabelType]\n  ){\n    olFeature.setProperties(\n      {\n        labelType_:typeOfLabel\n      },\n      true\n    );\n  }\n\n  private updateMeasureUnit(\n    olFeature: OlFeature<OlGeometry>,\n    measureUnit: MeasureLengthUnit | MeasureAreaUnit | CoordinatesUnit | []\n  ){\n    olFeature.setProperties(\n      {\n        measureUnit_: measureUnit\n      },\n      true\n    );\n\n  }\n\n  // Updates values of the selected element on the HTML view\n\n  getFeatureFontSize(): string {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.fontStyle\n          .split(' ')[0]\n          .replace('px', '')\n      : '15';\n  }\n\n  getFeatureFontStyle() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.fontStyle.substring(\n          this.selectedFeatures$.value[0].properties.fontStyle.indexOf(' ') + 1\n        )\n      : FontType.Arial;\n  }\n\n  getFeatureFillColor() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.drawingStyle.fill\n      : 'rgba(255,255,255,0.4)';\n  }\n\n  getFeatureStrokeColor() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.drawingStyle.stroke\n      : 'rgba(143,7,7,1)';\n  }\n\n  getFeatureOffsetX() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.offsetX\n      : this.drawStyleService.getOffsetX();\n  }\n\n  getFeatureOffsetY() {\n    return this.selectedFeatures$.value.length > 0\n      ? this.selectedFeatures$.value[0].properties.offsetY\n      : '0';\n  }\n\n  get allFontStyles(): string[] {\n    return Object.values(FontType);\n  }\n\n  get allLayers() {\n    return this.map.layers.filter((layer) =>\n      layer.id.includes('igo-draw-layer')\n    );\n  }\n\n  updateHeightTable() {\n    // Check the amount of rows as a possible alternative\n    this.numberOfDrawings = this.activeStore.count$.getValue();\n    this.numberOfDrawings > 10\n      ? (this.tableTemplate.tableHeight = '35vh')\n      : (this.tableTemplate.tableHeight = 'auto');\n  }\n\n  updateActiveLayer() {\n    let currLayer = this.allLayers.find(layer => layer.title === this.activeDrawingLayer.title);\n    return currLayer ? currLayer : this.allLayers[0];\n  }\n\n  // Helper methods\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    this.activateDrawControl();\n  }\n\n  /**\n   * Clear the tooltips of an OL geometry\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearLabelsOfOlGeometry(olGeometry) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (olTooltip && olTooltip.getMap()) {\n          this.map.ol.removeOverlay(olTooltip);\n        }\n      }\n    );\n  }\n  /**\n   * Replace the feature in the store\n   * @param entity the entity to replace\n   * @param olGeometry the new geometry to insert in the store\n   */\n  private replaceFeatureInStore(\n    entity,\n    olGeometry: OlGeometry,\n    radius?: number\n  ) {\n    this.activeStore.delete(entity);\n    this.onDrawEnd(olGeometry, radius);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (!this.activeDrawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.activeDrawControl.setOlMap(undefined);\n    this.drawControlIsActive = false;\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl() {\n    this.drawControlIsDisabled = false;\n    this.drawControlIsActive = true;\n    this.drawEnd$$ = this.activeDrawControl.end$.subscribe(\n      (olGeometry: OlGeometry) => {\n        this.openDrawDialog(olGeometry, true);\n      }\n    );\n\n    this.activeDrawControl.modify$.subscribe((olGeometry: OlGeometry) => {\n      this.onModifyDraw(olGeometry);\n    });\n\n    if (!this.drawSelect$$) {\n      this.drawSelect$$ = this.activeDrawControl.select$.subscribe(\n        (olFeature: OlFeature<OlGeometry>) => {\n          this.openDrawDialog(olFeature, false);\n        }\n      );\n    }\n    this.activeDrawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * get the geometry of design\n   *\n   */\n\n  isPoint() {\n    return this.activeDrawControl.getGeometryType() === this.geometryType.Point;\n  }\n\n  isLineString() {\n    return this.activeDrawControl.getGeometryType() === this.geometryType.LineString;\n  }\n\n  isPolygon() {\n    return this.activeDrawControl.getGeometryType() === this.geometryType.Polygon;\n  }\n\n  isCircle() {\n    return this.activeDrawControl.getGeometryType() === this.geometryType.Circle;\n  }\n\n  /**\n   * The fonction to predefine the radius of the user\n   *\n   */\n\n  changeRadius(radius: number) {\n    let radiusMeters: number;\n\n    if (radius) {\n      this.measureUnit === MeasureLengthUnit.Meters ? radiusMeters = radius :\n        radiusMeters = radius * 1000;\n    } else {\n      radiusMeters = undefined;\n    }\n\n    const pointStyle = (feature: OlFeature<OlGeometry>, resolution: number) => {\n      const geom = feature.getGeometry() as OlPoint;\n      const coordinates = olproj.transform(geom.getCoordinates(), this.map.projection, 'EPSG:4326');\n\n      const radius = radiusMeters / (Math.cos((Math.PI / 180) * coordinates[1])) / resolution;\n      this.activeDrawControl.predefinedRadius$.next(radiusMeters);\n      return new OlStyle.Style({\n        image: new OlStyle.Circle({\n          radius: radius,\n          stroke: new OlStyle.Stroke({\n            width: 1,\n            color: 'rgba(143,7,7,1)'\n          }),\n          fill: new OlStyle.Fill({\n            color: 'rgba(255,255,255,0.4)'\n          })\n        })\n      });\n    };\n\n    this.activeDrawControl.setOlInteractionStyle(pointStyle);\n    this.toggleDrawControl();\n  }\n\n  onMeasureUnitChange(selectedMeasureUnit: MeasureLengthUnit) {\n    if (selectedMeasureUnit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = selectedMeasureUnit;\n      this.measureUnit === MeasureLengthUnit.Meters ? this.radiusFormControl.setValue(this.radiusFormControl.value * 1000) :\n        this.radiusFormControl.setValue(this.radiusFormControl.value / 1000);\n    }\n  }\n\n  /**\n   * Recreates the style of the feature stored\n   */\n  private elementStyle(labelsAreShown: boolean, isAnIcon?) {\n    if (isAnIcon) {\n      this.activeStore.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createIndividualElementStyle(\n          feature,\n          resolution,\n          labelsAreShown,\n          feature.get('fontStyle'),\n          feature.get('drawingStyle').fill,\n          feature.get('drawingStyle').stroke,\n          feature.get('offsetX'),\n          feature.get('offsetY'),\n          this.icon\n        );\n      });\n    } else {\n      this.activeStore.layer.ol.setStyle((feature, resolution) => {\n        return this.drawStyleService.createIndividualElementStyle(\n          feature,\n          resolution,\n          labelsAreShown,\n          feature.get('fontStyle'),\n          feature.get('drawingStyle').fill,\n          feature.get('drawingStyle').stroke,\n          feature.get('offsetX'),\n          feature.get('offsetY')\n        );\n      });\n    }\n  }\n\n  private getRadius(olGeometry): number{\n    const length = getLength(olGeometry);\n    return Number(length / (2 * Math.PI));\n  }\n\n}\n","<div mat-dialog-content>\n  <h2 mat-dialog-title class=\"mat-typography\">{{ 'igo.geo.layer.style.styleModal' | translate }}</h2>\n  <div\n  class=\"edition-drawing mat-typography\"\n  [hidden]=\"data.features.length === 0\">\n    <form\n      class=\"igo-form\"\n      [formGroup]=\"form\">\n      <div class=\"fill-color-picker mat-typography\" *ngIf=\"linestringOnly !== true\">\n        <span>\n          <mat-icon class=\"stroke-palette-icon\" svgIcon=\"square\"></mat-icon>\n          {{ 'igo.geo.draw.fill' | translate }}\n        </span>\n\n        <mat-form-field\n          class=\"fill-field\"\n          appearance=\"outline\"\n          floatLabel=\"always\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"'igo.geo.draw.colorPicker' | translate\">\n          <mat-label>{{ getFeatureFillColor() }}</mat-label>\n          <input\n            #fillColorInput\n            formControlName=\"fill\"\n            matInput\n            type=\"text\"\n            [style.background]=\"getFeatureFillColor()\"\n            [readonly]=\"true\"\n            [colorPicker]=\"getFeatureFillColor()\"\n            [cpWidth]=\"'200px'\"\n            [cpOutputFormat]=\"'rgba'\"\n            [cpPosition]=\"'bottom'\"\n            [cpPositionOffset]=\"'-75%'\"\n            [cpCancelButton]=\"true\"\n            [cpCancelButtonText]=\"'igo.geo.draw.cancel' | translate\"\n            [cpOKButton]=\"true\"\n            (colorPickerChange)=\"styleModalData.fillColor = $event\">\n        </mat-form-field>\n      </div>\n\n      <div class=\"stroke-color-picker mat-typography\">\n        <span>\n          <mat-icon\n            class=\"stroke-palette-icon\"\n            svgIcon=\"square-outline\">\n          </mat-icon>\n          {{'igo.geo.draw.stroke' | translate}}\n        </span>\n\n        <mat-form-field\n          class=\"stroke-field\"\n          appearance=\"outline\"\n          floatLabel=\"always\"\n          tooltip-position=\"below\"\n          matTooltipShowDelay=\"500\"\n          [matTooltip]=\"'igo.geo.draw.colorPicker' | translate\">\n          <mat-label>{{ getFeatureStrokeColor() }}</mat-label>\n          <input\n            #strokeColorInput\n            formControlName=\"stroke\"\n            matInput\n            type=\"text\"\n            [style.background]=\"getFeatureStrokeColor()\"\n            [readonly]=\"true\"\n            [colorPicker]=\"getFeatureStrokeColor()\"\n            [cpWidth]=\"'200px'\"\n            [cpPosition]=\"'bottom'\"\n            [cpPositionOffset]=\"'-75%'\"\n            [cpOutputFormat]=\"'rgba'\"\n            [cpCancelButton]=\"true\"\n            [cpCancelButtonText]=\"'igo.geo.draw.cancel' | translate\"\n            [cpOKButton]=\"true\"\n            (colorPickerChange)=\"styleModalData.strokeColor = $event\">\n        </mat-form-field>\n      </div>\n\n      <div class=\"igo-input-container\">\n        <mat-form-field appearance=\"outline\" class=\"igo-form-input-box\">\n          <mat-label>{{ 'igo.geo.draw.fontSize' | translate }}</mat-label>\n          <input\n            matInput\n            #testFontSize\n            type=\"number\"\n            placeholder=\"10\"\n            min=\"10\"\n            onkeydown=\"return event.keyCode !== 69\"\n            [value]=\"getFeatureFontSize()\"\n            (input)=\"styleModalData.fontSize = $event.target.value\">\n          <span matSuffix>px</span>\n        </mat-form-field>\n        <mat-form-field appearance=\"outline\" class=\"igo-form-input-box\">\n          <mat-label>{{ 'igo.geo.draw.fontStyle' | translate }}</mat-label>\n          <mat-select\n            #testFontStyle\n            [value]=\"getFeatureFontStyle()\"\n            (selectionChange)=\"styleModalData.fontStyle = $event.value\">\n            <mat-option\n              *ngFor=\"let fontSelect of allFontStyles\"\n              [value]=\"fontSelect\">\n              {{ fontSelect }}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n\n      <div class=\"igo-input-container\">\n        <mat-form-field appearance=\"outline\" class=\"igo-form-input-box\">\n          <mat-label>{{ 'igo.geo.draw.offsetX' | translate }}</mat-label>\n          <input\n            matInput\n            #offsetXInput\n            type=\"number\"\n            onkeydown=\"return event.keyCode !== 69\"\n            [value]=\"getFeatureOffsetX()\"\n            (input)=\"styleModalData.offsetX = $event.target.value\">\n        </mat-form-field>\n        <mat-form-field appearance=\"outline\" class=\"igo-form-input-box\">\n          <mat-label>{{ 'igo.geo.draw.offsetY' | translate }}</mat-label>\n          <input\n            matInput\n            #offsetYInput\n            type=\"number\"\n            onkeydown=\"return event.keyCode !== 69\"\n            [value]=\"getFeatureOffsetY()\"\n            (input)=\"styleModalData.offsetY= $event.target.value\">\n        </mat-form-field>\n      </div>\n    </form>\n  </div>\n</div>\n<div mat-dialog-actions>\n  <button \n    mat-raised-button \n    (click)=\"cancelDrawing()\">{{'igo.geo.draw.cancel' | translate}}\n  </button>\n  <button \n    mat-raised-button \n    color=\"primary\" \n    (click)=\"confirm()\">OK\n  </button>\n</div>\n","import { Component, Inject, Input, OnInit } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { UntypedFormGroup, UntypedFormBuilder } from '@angular/forms';\n\nimport { DrawStyleService, FontType } from '../../draw';\n\nexport interface StyleModalData {\n  fillColor: string;\n  strokeColor: string;\n  fontSize: string;\n  fontStyle: FontType;\n  offsetX: number;\n  offsetY: number;\n}\n\n@Component({\n  selector: 'igo-style-modal-component',\n  templateUrl: './style-modal.component.html',\n  styleUrls: ['./style-modal.component.scss']\n})\nexport class StyleModalComponent implements OnInit {\n  @Input() confirmFlag: boolean = false;\n\n  public form: UntypedFormGroup;\n\n  public styleModalData: StyleModalData;\n  public linestringOnly: boolean;\n\n  constructor(\n    public dialogRef: MatDialogRef<StyleModalComponent>,\n    private formBuilder: UntypedFormBuilder,\n    private drawStyleService: DrawStyleService,\n    @Inject(MAT_DIALOG_DATA) public data: { features }) {\n      this.buildForm();\n    }\n\n  ngOnInit() {\n    this.linestringOnly = true;\n    for (const feature of this.data.features) {\n      if (feature.geometry.type !== 'LineString') {\n        this.linestringOnly = false;\n      }\n    }\n    this.buildStyleData();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      fill: [''],\n      stroke: ['']\n    });\n  }\n\n  private buildStyleData() {\n    this.styleModalData = {\n      fillColor:\n        this.data.features.length > 0\n        ? this.data.features[0].properties.drawingStyle.fill\n        : 'rgba(255,255,255,0.4)',\n      strokeColor:\n        this.data.features.length > 0\n        ? this.data.features[0].properties.drawingStyle.stroke\n        : 'rgba(143,7,7,1)',\n      fontSize:\n        this.data.features.length > 0\n        ? this.data.features[0].properties.fontStyle\n            .split(' ')[0]\n            .replace('px', '')\n        : '20',\n      fontStyle:\n        this.data.features.length > 0\n        ? this.data.features[0].properties.fontStyle.substring(\n            this.data.features[0].properties.fontStyle.indexOf(' ') + 1)\n        : FontType.Arial,\n      offsetX:\n        this.data.features.length > 0\n        ? this.data.features[0].properties.offsetX\n        : this.drawStyleService.getOffsetX(),\n      offsetY:\n        this.data.features.length > 0\n        ? this.data.features[0].properties.offsetY\n        : this.drawStyleService.getOffsetY()\n    };\n  }\n\n  get allFontStyles(): string[] {\n    return Object.values(FontType);\n  }\n\n  getFeatureFontSize(): string {\n    if (!this.styleModalData.fontSize) {\n      return this.data.features.length > 0\n      ? this.data.features[0].properties.fontStyle\n          .split(' ')[0]\n          .replace('px', '')\n      : '20';\n    } else {\n      return this.styleModalData.fontSize;\n    }\n  }\n\n  getFeatureFontStyle() {\n    if (!this.styleModalData.fontStyle) {\n      return this.data.features.length > 0\n      ? this.data.features[0].properties.fontStyle.substring(\n        this.data.features[0].properties.fontStyle.indexOf(' ') + 1\n        )\n      : FontType.Arial;\n    } else {\n      return this.styleModalData.fontStyle;\n    }\n  }\n\n  getFeatureFillColor() {\n    if (!this.styleModalData.fillColor) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.drawingStyle.fill\n        : 'rgba(255,255,255,0.4)';\n    } else {\n      return this.styleModalData.fillColor;\n    }\n  }\n\n  getFeatureStrokeColor() {\n    if (!this.styleModalData.strokeColor) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.drawingStyle.stroke\n        : 'rgba(143,7,7,1)';\n    } else {\n      return this.styleModalData.strokeColor;\n    }\n  }\n\n  getFeatureOffsetX() {\n    if (!this.styleModalData.offsetX) {\n      return this.data.features.length > 0\n        ? this.data.features[0].properties.offsetX\n        : this.drawStyleService.getOffsetX();\n    } else {\n      return this.styleModalData.offsetX;\n    }\n  }\n\n  getFeatureOffsetY() {\n    if (!this.styleModalData.offsetY) {\n      return this.data.features.length > 0\n      ? this.data.features[0].properties.offsetY\n      : this.drawStyleService.getOffsetY();\n    } else {\n      return this.styleModalData.offsetY;\n    }\n  }\n\n  cancelDrawing() {\n    this.dialogRef.close();\n  }\n\n  confirm() {\n    this.confirmFlag = true;\n    this.dialogRef.close(this.styleModalData);\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatSliderModule } from '@angular/material/slider';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ColorPickerModule } from 'ngx-color-picker';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoListModule,\n  IgoCollapsibleModule,\n  IgoImageModule,\n  IgoPanelModule,\n  IgoMatBadgeIconModule,\n  IgoCustomHtmlModule\n} from '@igo2/common';\n\nimport { LayerService } from './shared/layer.service';\nimport { StyleService } from './shared/style.service';\nimport { LayerListToolService } from './layer-list-tool/layer-list-tool.service';\nimport { LayerItemComponent } from './layer-item/layer-item.component';\nimport { LayerLegendComponent } from './layer-legend/layer-legend.component';\nimport { LayerListComponent } from './layer-list/layer-list.component';\nimport { LayerListToolComponent } from './layer-list-tool/layer-list-tool.component';\nimport { LayerListBindingDirective } from './layer-list/layer-list-binding.directive';\nimport { LayerLegendListBindingDirective } from './layer-legend-list/layer-legend-list-binding.directive';\nimport { TrackFeatureButtonComponent } from './track-feature-button/track-feature-button.component';\nimport { LayerLegendListComponent } from './layer-legend-list/layer-legend-list.component';\nimport { LayerLegendItemComponent } from './layer-legend-item/layer-legend-item.component';\nimport { StyleModalComponent } from './style-modal/style-modal.component';\n\n@NgModule({\n  imports: [\n    MatInputModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    CommonModule,\n    FormsModule,\n    MatDividerModule,\n    MatMenuModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSlideToggleModule,\n    MatSelectModule,\n    MatTooltipModule,\n    MatListModule,\n    MatSliderModule,\n    MatBadgeModule,\n    MatCheckboxModule,\n    ColorPickerModule,\n    IgoLanguageModule,\n    IgoListModule,\n    IgoCollapsibleModule,\n    IgoImageModule,\n    IgoPanelModule,\n    IgoMatBadgeIconModule,\n    IgoCustomHtmlModule\n  ],\n  exports: [\n    LayerItemComponent,\n    LayerLegendItemComponent,\n    LayerLegendComponent,\n    LayerListComponent,\n    LayerListToolComponent,\n    LayerLegendListComponent,\n    LayerListBindingDirective,\n    LayerLegendListBindingDirective,\n    TrackFeatureButtonComponent,\n    StyleModalComponent\n  ],\n  declarations: [\n    LayerItemComponent,\n    LayerLegendItemComponent,\n    LayerLegendComponent,\n    LayerListComponent,\n    LayerListToolComponent,\n    LayerLegendListComponent,\n    LayerListBindingDirective,\n    LayerLegendListBindingDirective,\n    TrackFeatureButtonComponent,\n    StyleModalComponent\n  ]\n})\nexport class IgoLayerModule {\n  static forRoot(): ModuleWithProviders<IgoLayerModule> {\n    return {\n      ngModule: IgoLayerModule,\n      providers: [LayerService, StyleService, LayerListToolService]\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoMatBadgeIconModule,\n  IgoCollapsibleModule,\n  IgoListModule\n} from '@igo2/common';\n\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\nimport { CatalogBrowserComponent } from './catalog-browser.component';\nimport { CatalogBrowserLayerComponent } from './catalog-browser-layer.component';\nimport { CatalogBrowserGroupComponent } from './catalog-browser-group.component';\nimport { IgoLayerModule } from '../../layer/layer.module';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatButtonModule,\n    MatIconModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoMatBadgeIconModule,\n    IgoLanguageModule,\n    IgoListModule,\n    IgoCollapsibleModule,\n    IgoMetadataModule,\n    IgoLayerModule\n  ],\n  exports: [\n    CatalogBrowserComponent\n  ],\n  declarations: [\n    CatalogBrowserComponent,\n    CatalogBrowserGroupComponent,\n    CatalogBrowserLayerComponent\n  ]\n})\nexport class IgoCatalogBrowserModule {}\n","<h1 mat-dialog-title class=\"mat-typography\">{{'igo.geo.catalog.library.addTitle' | translate}}</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input type=\"text\" formControlName=\"title\" placeholder=\"{{'igo.geo.printForm.title' | translate}}\" matInput [matAutocomplete]=\"auto2\">\n        <mat-autocomplete #auto2=\"matAutocomplete\" (optionSelected)='changeUrlOrTitle($event.option.value)'>\n          <mat-option *ngFor=\"let predefinedCatalog of (predefinedCatalogsList$ | async)\" matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.title\" [value]=\"predefinedCatalog\">\n            {{predefinedCatalog.title}}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input type=\"text\" formControlName=\"url\" placeholder=\"URL\" matInput [matAutocomplete]=\"auto\">\n        <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)='changeUrlOrTitle($event.option.value)'>\n          <mat-option *ngFor=\"let predefinedCatalog of (predefinedCatalogsList$ | async)\" matTooltipShowDelay=\"500\"\n            [matTooltip]=\"predefinedCatalog.url\" [value]=\"predefinedCatalog\">\n            {{predefinedCatalog.url}}\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <mat-select\n          formControlName=\"type\"\n          placeholder=\"Type\">\n          <mat-option\n            *ngFor=\"let type of typeCapabilities\"\n            [value]=\"type\"\n            (click)=\"$event.stopPropagation()\">\n              <p mat-line>{{type}}</p>\n          </mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </form>\n  <span *ngIf=\"error && addedCatalog && emailAddress\">\n    <p class=\"error\">{{languageService.translate.instant('igo.geo.catalog.externalProvider.unavailableWithEmail', { value: addedCatalog.url, email: emailAddress })}}</p>\n  </span>\n  <span *ngIf=\"error && addedCatalog && !emailAddress\">\n    <p class=\"error\">{{languageService.translate.instant('igo.geo.catalog.unavailable', { value: addedCatalog.url })}}</p>\n  </span>\n</div>\n<div mat-dialog-actions style=\"justify-content: center\">\n  <div class=\"igo-form-button-group add-catalog-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      (click)=\"cancel()\">\n      {{'igo.geo.catalog.library.cancel' | translate}}\n    </button>\n    <button\n      id=\"addCatalogBtnDialog\"\n      mat-raised-button\n      type=\"button\"\n      color=\"primary\"\n      [disabled]=\"!form.valid\"\n      (click)=\"addCatalog(form.value)\">\n      {{'igo.geo.catalog.library.add' | translate}}\n    </button>\n  </div>\n</div>","import { LanguageService, ConfigService } from '@igo2/core';\nimport { Component, OnInit, OnDestroy, Optional, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { UntypedFormBuilder, UntypedFormGroup, Validators } from '@angular/forms';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport { EntityStore } from '@igo2/common';\nimport { TypeCapabilities } from '../../datasource';\nimport { Catalog } from '../shared/catalog.abstract';\n\n@Component({\n  selector: 'igo-add-catalog-dialog',\n  templateUrl: './add-catalog-dialog.component.html',\n  styleUrls: ['./add-catalog-dialog.component.scss']\n})\nexport class AddCatalogDialogComponent implements OnInit, OnDestroy {\n  public form: UntypedFormGroup;\n  private defaultAddedCatalogType = 'wms';\n  private addedCatalogType$$: Subscription;\n  public predefinedCatalogsList$ = new BehaviorSubject<Catalog[]>([]);\n  typeCapabilities: string[];\n  predefinedCatalogs: Catalog[] = [];\n  store: EntityStore<Catalog>;\n  error = false;\n  addedCatalog: Catalog;\n  emailAddress: string;\n  private storeViewAll$$: Subscription;\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    public languageService: LanguageService,\n    private configService: ConfigService,\n    public dialogRef: MatDialogRef<AddCatalogDialogComponent>,\n    @Optional()\n    @Inject(MAT_DIALOG_DATA)\n    public data: { predefinedCatalogs: Catalog[]; store: EntityStore<Catalog>; error: boolean; addedCatalog: Catalog }\n  ) {\n    this.store = data.store;\n    this.predefinedCatalogs = data.predefinedCatalogs;\n    this.error = data.error;\n    this.addedCatalog = data.addedCatalog;\n    this.form = this.formBuilder.group({\n      id: ['', []],\n      title: ['', []],\n      url: ['', [Validators.required]],\n      type: [this.defaultAddedCatalogType, [Validators.required]]\n    });\n  }\n\n  ngOnInit() {\n    this.store.state.clear();\n    this.typeCapabilities = Object.keys(TypeCapabilities);\n\n    this.addedCatalogType$$ = this.form\n      .get('type')\n      .valueChanges.subscribe((value) => {\n        if (value === 'wmts') {\n          this.form.get('title').setValidators(Validators.required);\n        } else {\n          this.form.get('title').setValidators([]);\n        }\n        this.form.get('title').updateValueAndValidity();\n      });\n\n    this.computePredefinedCatalogList();\n    this.storeViewAll$$ = this.store.view\n      .all$()\n      .subscribe(() => this.computePredefinedCatalogList());\n\n    this.emailAddress = this.configService.getConfig('emailAddress');\n  }\n\n  ngOnDestroy() {\n    this.addedCatalogType$$.unsubscribe();\n    this.storeViewAll$$.unsubscribe();\n  }\n\n  changeUrlOrTitle(catalog: Catalog) {\n    this.form.patchValue(catalog);\n    this.error = false;\n    this.computePredefinedCatalogList();\n  }\n\n  computePredefinedCatalogList() {\n    this.predefinedCatalogsList$.next(\n      this.predefinedCatalogs.filter((c) => !this.store.get(c.id))\n    );\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    this.error = false;\n    this.dialogRef.close(addedCatalog);\n  }\n\n  cancel() {\n    this.error = false;\n    this.dialogRef.close();\n  }\n}\n","<igo-list [navigation]=\"false\">\n  <ng-template ngFor let-catalog [ngForOf]=\"getCatalogs() | async\">\n    <igo-catalog-library-item\n      igoListItem\n      color=\"accent\"\n      [map]=\"map\"\n      [catalog]=\"catalog\"\n      (catalogRemove)=\"onCatalogRemove(catalog)\"\n      (select)=\"onCatalogSelect(catalog)\">\n    </igo-catalog-library-item>\n  </ng-template>\n</igo-list>\n\n<div *ngIf=\"addCatalogAllowed\" class=btnAddCatalog>\n  <button\n    mat-raised-button\n    [matTooltip]=\"'igo.geo.catalog.library.addBtn' | translate\"\n    matTooltipPosition=\"above\"\n    color=\"primary\"\n    (click)=\"addCatalogDialog()\">\n    {{'igo.geo.catalog.library.addBtn' | translate}}\n    <mat-icon svgIcon=\"earth-plus\"></mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { EntityStore } from '@igo2/common';\nimport { LanguageService, MessageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\nimport { Observable, Subscription } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\nimport { Md5 } from 'ts-md5';\nimport { CapabilitiesService } from '../../datasource';\nimport { IgoMap } from '../../map';\nimport { standardizeUrl } from '../../utils/id-generator';\nimport { Catalog } from '../shared/catalog.abstract';\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\n\n/**\n * Component to browse a list of available catalogs\n */\n@Component({\n  selector: 'igo-catalog-library',\n  templateUrl: './catalog-library.component.html',\n  styleUrls: ['./catalog-library.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogLibaryComponent implements OnInit, OnDestroy {\n  /**\n   * Store holding the catalogs\n   */\n  @Input() store: EntityStore<Catalog>;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() addCatalogAllowed: boolean = false;\n\n  /**\n   * Determine if the form to add a catalog is allowed\n   */\n  @Input() predefinedCatalogs: Catalog[] = [];\n\n  /**\n   * Event emitted a catalog is selected or unselected\n   */\n  @Output() catalogSelectChange = new EventEmitter<{\n    selected: boolean;\n    catalog: Catalog;\n  }>();\n\n  submitDisabled = true;\n  private addingCatalog$$: Subscription;\n\n  get addedCatalogs(): Catalog[] {\n    return (this.storageService.get('addedCatalogs') || []) as Catalog[];\n  }\n  set addedCatalogs(catalogs: Catalog[]) {\n    this.storageService.set('addedCatalogs', catalogs);\n  }\n\n  constructor(\n    private capabilitiesService: CapabilitiesService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private storageService: StorageService,\n    private dialog: MatDialog\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.store.state.clear();\n\n    this.predefinedCatalogs = this.predefinedCatalogs.map(c => {\n      c.id = Md5.hashStr(\n        (c.type || 'wms') + standardizeUrl(c.url)\n      ) as string;\n      c.title = c.title === '' || !c.title ? c.url : c.title;\n      return c;\n    });\n  }\n\n  getCatalogs(): Observable<Catalog[]> {\n    return this.store.view.all$();\n  }\n\n  /**\n   * When a catalog is selected, update it's state in the store\n   * and emit the catalog select change event\n   * @internal\n   */\n  onCatalogSelect(catalog: Catalog) {\n    this.store.state.update(\n      catalog,\n      {\n        selected: true,\n        focused: true\n      },\n      true\n    );\n    this.catalogSelectChange.emit({ selected: true, catalog });\n  }\n\n  private unsubscribeAddingCatalog() {\n    if (this.addingCatalog$$) {\n      this.addingCatalog$$.unsubscribe();\n    }\n  }\n\n  addCatalog(addedCatalog: Catalog) {\n    if (!addedCatalog) {\n      return;\n    }\n    let id = Md5.hashStr(\n      addedCatalog.type + standardizeUrl(addedCatalog.url)\n    ) as string;\n    const predefinedCatalog = this.predefinedCatalogs.find(\n      (c) => c.id === addedCatalog.id\n    );\n\n    if (predefinedCatalog) {\n      addedCatalog.version = predefinedCatalog.version;\n      addedCatalog.externalProvider = predefinedCatalog.externalProvider;\n      id = predefinedCatalog.id;\n    }\n\n    if (this.store.get(id)) {\n      const title = this.languageService.translate.instant(\n        'igo.geo.catalog.library.inlist.title'\n      );\n      const message = this.languageService.translate.instant(\n        'igo.geo.catalog.library.inlist.message'\n      );\n      this.messageService.alert(message, title);\n      return;\n    }\n    this.unsubscribeAddingCatalog();\n\n    this.addingCatalog$$ = this.capabilitiesService\n    .getCapabilities(addedCatalog.type as any, addedCatalog.url, addedCatalog.version)\n      .pipe(\n        catchError((e) => {\n          const title = this.languageService.translate.instant('igo.geo.catalog.unavailableTitle');\n          if (e.error) {\n            this.addCatalogDialog(true, addedCatalog);\n            e.error.caught = true;\n            return e;\n          }\n          const message = this.languageService.translate.instant('igo.geo.catalog.unavailable', { value: addedCatalog.url });\n          this.messageService.error(message, title);\n          throw e;\n        })\n      )\n      .subscribe((capabilities) => {\n        let title;\n        let version;\n        switch (addedCatalog.type) {\n          case 'wms':\n            title = addedCatalog.title || capabilities.Service.Title;\n            version = addedCatalog.version || capabilities.version;\n            break;\n          case 'arcgisrest':\n          case 'imagearcgisrest':\n          case 'tilearcgisrest':\n            title = addedCatalog.title || capabilities.mapName;\n            break;\n          case 'wmts':\n            title =\n              addedCatalog.title ||\n              capabilities.ServiceIdentification.ServiceType;\n            break;\n          default:\n            title = addedCatalog.title;\n        }\n\n        const catalogToAdd = ObjectUtils.removeUndefined(\n          Object.assign({},\n            predefinedCatalog,\n            ObjectUtils.removeUndefined({\n              id,\n              title,\n              url: addedCatalog.url,\n              type: addedCatalog.type || 'wms',\n              externalProvider: addedCatalog.externalProvider || false,\n              removable: true,\n              version\n            })) as Catalog);\n        this.store.insert(catalogToAdd);\n        const newCatalogs = this.addedCatalogs.slice(0);\n        newCatalogs.push(catalogToAdd);\n        this.addedCatalogs = newCatalogs;\n        this.unsubscribeAddingCatalog();\n      });\n  }\n\n  ngOnDestroy() {\n    this.unsubscribeAddingCatalog();\n  }\n\n  onCatalogRemove(catalog) {\n    this.store.delete(catalog);\n    this.addedCatalogs = this.addedCatalogs\n      .slice(0)\n      .filter((c) => c.id !== catalog.id);\n  }\n\n  addCatalogDialog(error?, addedCatalog?: Catalog) {\n    const dialogRef = this.dialog.open(AddCatalogDialogComponent, {\n      width: '700px',\n      data: {\n        predefinedCatalogs: this.predefinedCatalogs,\n        store: this.store,\n        error,\n        addedCatalog\n      }\n    });\n\n    dialogRef.afterClosed().subscribe((catalog) => {\n      this.addCatalog(catalog);\n    });\n  }\n}\n","<mat-list-item>\n  <h4 mat-line>\n    {{title}}\n  </h4>\n  <mat-icon\n    class=\"igo-external-provider\"\n    *ngIf=\"catalog.externalProvider\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.catalog.externalProvider.catalog' | translate\"\n    color=\"primary\"\n    (click)=\"$event.stopPropagation()\"\n    svgIcon=\"earth-arrow-right\">\n  </mat-icon>\n\n  <button\n  *ngIf=\"catalog.removable\"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.catalog.library.remove' | translate\"\n  color=\"warn\"\n  (click)=\"removeCatalogFromLibrary($event)\">\n  <mat-icon svgIcon=\"delete\"></mat-icon>\n</button>\n\n<button\n  class=\"igo-blank\"\n  *ngIf=\"!catalog.removable\"\n  disabled=\"true\"\n  mat-icon-button>\n  <mat-icon svgIcon=\"blank\"></mat-icon>\n</button>\n</mat-list-item>\n","import { Component, Input, ChangeDetectionStrategy, Output, EventEmitter } from '@angular/core';\n\nimport { getEntityTitle } from '@igo2/common';\nimport { IgoMap } from '../../map';\nimport { Catalog } from '../shared/catalog.abstract';\n\n/**\n * Catalog library item\n */\n@Component({\n  selector: 'igo-catalog-library-item',\n  templateUrl: './catalog-library-item.component.html',\n  styleUrls: ['./catalog-library-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class CatalogLibaryItemComponent {\n\n  /**\n   * Catalog\n   */\n  @Input() catalog: Catalog;\n\n  /**\n   * Map to add the catalog items to\n   */\n  @Input() map: IgoMap;\n\n  @Output() catalogRemove = new EventEmitter();\n\n  /**\n   * @internal\n   */\n  get title(): string { return getEntityTitle(this.catalog); }\n\n  removeCatalogFromLibrary(event) {\n    event.stopPropagation();\n    this.catalogRemove.emit();\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoListModule } from '@igo2/common';\n\nimport { CatalogLibaryComponent, } from './catalog-library.component';\nimport { CatalogLibaryItemComponent } from './catalog-library-item.component';\nimport { AddCatalogDialogComponent } from './add-catalog-dialog.component';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatDialogModule } from '@angular/material/dialog';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatBadgeModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoListModule,\n    IgoLanguageModule,\n    MatButtonModule,\n    MatFormFieldModule,\n    ReactiveFormsModule,\n    MatInputModule,\n    MatSelectModule,\n    MatAutocompleteModule,\n    MatDialogModule\n  ],\n  exports: [\n    CatalogLibaryComponent,\n    AddCatalogDialogComponent\n  ],\n  declarations: [\n    CatalogLibaryComponent,\n    CatalogLibaryItemComponent,\n    AddCatalogDialogComponent\n  ]\n})\nexport class IgoCatalogLibraryModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoListModule, IgoCollapsibleModule, IgoMatBadgeIconModule } from '@igo2/common';\n\nimport { IgoCatalogBrowserModule } from './catalog-browser/catalog-browser.module';\nimport { IgoCatalogLibraryModule } from './catalog-library/catalog-library.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatIconModule,\n    MatListModule,\n    MatTooltipModule,\n    IgoMatBadgeIconModule,\n    IgoListModule,\n    IgoCollapsibleModule\n  ],\n  exports: [\n    IgoCatalogBrowserModule,\n    IgoCatalogLibraryModule\n  ],\n  declarations: []\n})\nexport class IgoCatalogModule {}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\nimport { TimeFilterableDataSource } from './time-filter.interface';\n\n@Pipe({\n  name: 'filterableDataSource'\n})\nexport class FilterableDataSourcePipe implements PipeTransform {\n  transform(value: Layer[], arg: string): Layer[] {\n    let layers;\n\n    if (arg === 'time') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as TimeFilterableDataSource;\n        return (\n          this.isTimeFilterable(datasource) &&\n          datasource.options.timeFilter !== undefined &&\n          Object.keys(datasource.options.timeFilter).length\n        );\n      });\n    }\n    if (arg === 'ogc') {\n      layers = value.filter((layer: Layer) => {\n        const datasource = layer.dataSource as OgcFilterableDataSource;\n        return this.isOgcFilterable(datasource);\n      });\n    }\n    return layers;\n  }\n\n  private isTimeFilterable(dataSource: TimeFilterableDataSource) {\n    if (dataSource.options.type !== 'wms') {\n      return false;\n    }\n    return dataSource.options.timeFilterable;\n  }\n\n  private isOgcFilterable(dataSource: OgcFilterableDataSource): boolean {\n    let isOgcFilterable = false;\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      dataSource.options.ogcFilters.editable\n    ) {\n      isOgcFilterable = true;\n    }\n    if (\n      dataSource.options.ogcFilters &&\n      dataSource.options.ogcFilters.enabled &&\n      (\n        dataSource.options.ogcFilters.pushButtons ||\n        dataSource.options.ogcFilters.checkboxes ||\n        dataSource.options.ogcFilters.radioButtons ||\n        dataSource.options.ogcFilters.select ||\n        dataSource.options.ogcFilters.autocomplete)) {\n        isOgcFilterable = true;\n    }\n    return isOgcFilterable;\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { TileArcGISRestDataSource } from '../../datasource/shared/datasources/tilearcgisrest-datasource';\n\n@Injectable()\nexport class TimeFilterService {\n  constructor() {}\n\n  filterByDate(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    date: Date | [Date, Date]\n  ) {\n    let time;\n    let newdateform;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(date)) {\n      const dates = [];\n      if (date[0]) {\n        newdateformStart = this.reformatDateTime(date[0]);\n        dates.push(date[0]);\n      }\n      if (date[1]) {\n        newdateformEnd = this.reformatDateTime(date[1]);\n        dates.push(date[1]);\n      }\n      if (dates.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else if (date) {\n      newdateform = this.reformatDateTime(date);\n      time = newdateform;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  filterByYear(\n    datasource: WMSDataSource | TileArcGISRestDataSource,\n    year: string | [string, string]\n  ) {\n    let time;\n    let newdateformStart;\n    let newdateformEnd;\n\n    if (Array.isArray(year)) {\n      const years = [];\n      if (year[0]) {\n        newdateformStart = year[0];\n        years.push(year[0]);\n      }\n      if (year[1]) {\n        newdateformEnd = year[1];\n        years.push(year[1]);\n      }\n      if (years.length === 2 && newdateformStart !== newdateformEnd) {\n        if (datasource instanceof TileArcGISRestDataSource) {\n          time = newdateformStart + ',' + newdateformEnd;\n        } else {\n          time = newdateformStart + '/' + newdateformEnd;\n        }\n      }\n      if (newdateformStart === newdateformEnd) {\n        time = newdateformStart;\n      }\n    } else { // to reset filter.\n      time = year;\n    }\n\n    const params = { TIME: time };\n    datasource.ol.updateParams(params);\n    if (datasource instanceof WMSDataSource) {\n      const wmsDataSource = datasource as WMSDataSource;\n      wmsDataSource.setTimeFilter(wmsDataSource.timeFilter, true);\n    }\n  }\n\n  private reformatDateTime(value) {\n    const year = value.getFullYear();\n    let month = value.getMonth() + 1;\n    let day = value.getUTCDate();\n    let hour = value.getUTCHours();\n    let minute = value.getUTCMinutes();\n\n    if (Number(month) < 10) {\n      month = '0' + month;\n    }\n\n    if (Number(day) < 10) {\n      day = '0' + day;\n    }\n\n    if (Number(hour) < 10) {\n      hour = '0' + hour;\n    }\n\n    if (Number(minute) < 10) {\n      minute = '0' + minute;\n    }\n\n    return year + '-' + month + '-' + day + 'T' + hour + ':' + minute + ':00Z';\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\n\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { OgcFilterWriter } from './ogc-filter';\nimport { OgcFilterableDataSource } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterService {\n  constructor() {}\n\n  public filterByOgc(wmsDatasource: WMSDataSource, filterString: string) {\n    const appliedFilter = new OgcFilterWriter().formatProcessedOgcFilter(filterString, wmsDatasource.options.params.LAYERS);\n    wmsDatasource.ol.updateParams({ FILTER: appliedFilter });\n  }\n\n  public setOgcWFSFiltersOptions(wfsDatasource: OgcFilterableDataSource) {\n    const options: any = wfsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.paramsWFS.fieldNameGeometry,\n        new olProjection({ code: options.paramsWFS.srsName }),\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters = ogcFilterWriter.defineInterfaceFilterSequence(\n          options.ogcFilters.filters,\n          options.paramsWFS.fieldNameGeometry\n        );\n      }\n    }\n  }\n\n  public setOgcWMSFiltersOptions(wmsDatasource: OgcFilterableDataSource) {\n    const options: any = wmsDatasource.options;\n    const ogcFilterWriter = new OgcFilterWriter();\n\n    if (options.ogcFilters.enabled && options.ogcFilters.filters) {\n      options.ogcFilters.filters = ogcFilterWriter.checkIgoFiltersProperties(\n        options.ogcFilters.filters,\n        options.fieldNameGeometry,\n        undefined,\n        true\n      );\n      if (!options.ogcFilters.interfaceOgcFilters) {\n        options.ogcFilters.interfaceOgcFilters = ogcFilterWriter.defineInterfaceFilterSequence(\n          // With some wms server, this param must be set to make spatials call.\n          options.ogcFilters.filters,\n          options.fieldNameGeometry\n        );\n      }\n      this.filterByOgc(\n        wmsDatasource as WMSDataSource,\n        ogcFilterWriter.buildFilter(options.ogcFilters.filters,\n        undefined,\n        undefined,\n        undefined,\n        wmsDatasource.options\n        )\n      );\n      options.filtered = true;\n    } else {\n      options.ogcFilters.filters = undefined;\n      options.ogcFilters.interfaceOgcFilters = [];\n      options.filtered = false;\n    }\n  }\n}\n","export enum SpatialFilterQueryType {\n    AdmRegion = 'AdmRegion',\n    Mun = 'Mun',\n    Arrond = 'Arrond',\n    CircFed = 'CircFed',\n    CircProv = 'CircProv',\n    DirReg = 'DirReg',\n    MRC = 'MRC',\n    RegTour = 'RegTour'\n}\n\nexport enum SpatialFilterType {\n    Predefined = 'Predefined',\n    Polygon = 'Polygon',\n    Point = 'Point'\n}\n\nexport enum SpatialFilterItemType {\n    Address = 'Address',\n    Thematics = 'Thematics'\n}\n","import { Injectable } from '@angular/core';\n\nimport { HttpClient } from '@angular/common/http';\nimport { ConfigService, LanguageService } from '@igo2/core';\nimport { map } from 'rxjs/operators';\nimport { Observable } from 'rxjs';\nimport { Feature } from '../../feature/shared';\nimport {\n  SpatialFilterQueryType,\n  SpatialFilterItemType,\n  SpatialFilterType\n} from './spatial-filter.enum';\nimport { SpatialFilterThematic } from './spatial-filter.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SpatialFilterService {\n  public baseUrl: string = 'https://geoegl.msp.gouv.qc.ca/apis/terrapi/';\n\n  /*\n   * Type association with URL\n   */\n  public urlFilterList = {\n    AdmRegion: 'regadmin',\n    Arrond: 'arrondissements',\n    CircFed: 'circ-fed',\n    CircProv: 'circ-prov',\n    DirReg: 'dir-reg',\n    MRC: 'mrc',\n    Mun: 'municipalites',\n    RegTour: 'tourisme',\n    bornes: 'bornes-sumi',\n    hydro: 'hydro',\n    routes: 'routes'\n  };\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    private configService: ConfigService\n  ) {\n    this.baseUrl =\n      this.configService.getConfig('spatialFilter.url') || this.baseUrl;\n  }\n\n  getKeyByValue(object, value) {\n    return Object.keys(object).find(key => object[key] === value);\n  }\n\n  /*\n   * Loading data for spatial filter list component (NO GEOMETRY)\n   */\n  loadFilterList(type: SpatialFilterQueryType): Observable<Feature[]> {\n    const urlPath = type as string;\n    if (urlPath) {\n      return this.http\n        .get<{ features: Feature[] }>(\n          this.baseUrl + this.urlFilterList[urlPath]\n        )\n        .pipe(\n          map(featureCollection =>\n            featureCollection.features.map(f => {\n              f.meta = {\n                id: f.properties.code\n              };\n              return f;\n            })\n          )\n        );\n    }\n  }\n\n  /*\n   * Loading item list (STRING)\n   */\n  loadThematicsList() {\n    const url = 'types';\n    const items: SpatialFilterThematic[] = [];\n    return this.http.get(this.baseUrl + url).pipe(\n      map((types: string[]) => {\n        types.forEach(type => {\n          if (type.startsWith('lieux')) {\n            const item: SpatialFilterThematic = {\n              name: undefined,\n              source: type\n            };\n            let substr = type.substring(6, type.length);\n            let name = substr;\n            if (substr.includes('.')) {\n              const index = substr.indexOf('.');\n              name = substr.substring(index + 1, substr.length);\n              substr = substr.substring(0, index);\n            }\n            try {\n              item.name = this.languageService.translate.instant(\n                'igo.geo.terrapi.' + name\n              );\n            } catch (e) {\n              item.name = name.substring(0, 1).toUpperCase() + name.substring(1, name.length - 1);\n            }\n\n            try {\n              item.group = this.languageService.translate.instant(\n                'igo.geo.spatialFilter.group.' + substr\n              );\n            } catch (e) {\n              item.group = substr.substring(0, 1).toUpperCase() + substr.substring(1, name.length - 1);\n            }\n\n            items.push(item);\n          } else {\n            if (this.getKeyByValue(this.urlFilterList, type)) {\n              const item: SpatialFilterThematic = {\n                name: undefined,\n                source: type\n              };\n              const name = this.getKeyByValue(this.urlFilterList, type);\n              try {\n                item.name = this.languageService.translate.instant(\n                  'igo.geo.terrapi.' + name\n                );\n              } catch (e) {\n                item.name = name.substring(0, 1).toUpperCase() + name.substring(1, name.length - 1);\n              }\n              item.source = type;\n\n              items.push(item);\n            }\n          }\n        });\n        return items;\n      })\n    );\n  }\n\n  /*\n   * Loading data for spatial filter item component (Address or Thematics) depends on predefined zone or draw zone (feature)\n   */\n  loadFilterItem(\n    feature,\n    itemType: SpatialFilterItemType,\n    type?: SpatialFilterQueryType,\n    thematic?: SpatialFilterThematic,\n    buffer?: number\n  ) {\n    if (type) {\n      // Predefined type\n      const urlType = type as string;\n      const url = this.baseUrl + this.urlFilterList[urlType];\n      let urlItem = '';\n      if (itemType === SpatialFilterItemType.Address) {\n        urlItem = 'adresses';\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        urlItem = thematic.source;\n        return this.http\n          .get<{ features: Feature[] }>(\n            url + '/' + feature.properties.code + '/' + urlItem,\n            {\n              params: {\n                geometry: 'true',\n                icon: 'true',\n                bufferInput: buffer.toString(),\n                simplified: '100'\n              }\n            }\n          )\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    } else {\n      // Draw type\n      const url = this.baseUrl + 'locate';\n      if (itemType === SpatialFilterItemType.Address) {\n        const urlItem = '?type=adresses';\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.Address'\n                  ),\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      } else {\n        // If thematics search\n        const urlItem = '?type=' + thematic.source;\n        return this.http\n          .post<{ features: Feature[] }>(url + urlItem, {\n            geometry: 'true',\n            icon: 'true',\n            loc: JSON.stringify(feature),\n            bufferInput: buffer.toString(),\n            simplified: '100'\n          })\n          .pipe(\n            map(featureCollection =>\n              featureCollection.features.map(f => {\n                f.meta = {\n                  id: f.properties.code,\n                  title: thematic.name,\n                  icon: (f as any).icon\n                };\n                return f;\n              })\n            )\n          );\n      }\n    }\n  }\n\n  /*\n   * Get one territory by id (WITH GEOMETRY)\n   */\n  loadItemById(\n    feature: Feature,\n    type: SpatialFilterQueryType\n  ): Observable<Feature> {\n    const featureType = this.urlFilterList[type];\n    const featureCode = '/' + feature.properties.code;\n    if (featureType && featureCode) {\n      return this.http\n        .get<Feature>(this.baseUrl + featureType + featureCode, {\n          params: {\n            geometry: 'true'\n          }\n        })\n        .pipe(\n          map(f => {\n            f.meta = {\n              id: f.properties.code,\n              alias: f.properties.nom,\n              title: f.properties.nom\n            };\n            return f;\n          })\n        );\n    }\n  }\n\n  /*\n   * Get buffer geometry\n   */\n  loadBufferGeometry(\n    feature: Feature,\n    filterType: SpatialFilterType,\n    buffer?: number,\n    type?: SpatialFilterQueryType,\n  ): Observable<Feature> {\n    if (filterType === SpatialFilterType.Predefined) {\n      const featureType = this.urlFilterList[type];\n      const featureCode = '/' + feature.properties.code;\n      if (featureType && featureCode) {\n        return this.http\n          .get<Feature>(this.baseUrl + featureType + featureCode,\n            {\n              params: {\n                geometry: '100',\n                bufferOutput: buffer.toString()\n              }\n            }\n          )\n          .pipe(\n            map(f => {\n              f.meta = {\n                id: f.properties.code,\n                alias: f.properties.nom,\n                title: f.properties.nom\n              };\n              return f;\n            })\n          );\n      }\n    } else {\n      return this.http\n        .post<Feature>(this.baseUrl + 'geospatial/buffer?', {\n          buffer,\n          loc: JSON.stringify(feature)\n        })\n        .pipe(\n          map(f => {\n            return f;\n          })\n        );\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport olProjection from 'ol/proj/Projection';\nimport * as olproj from 'ol/proj';\n\nimport { MessageService, LanguageService } from '@igo2/core';\n\nimport { Layer } from '../../layer/shared';\nimport { OgcFilterWriter, OgcFilterableDataSourceOptions } from '../../filter/shared';\n\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DownloadService {\n\n  constructor(\n    private messageService: MessageService,\n    private languageService: LanguageService\n  ) {}\n\n  open(layer: Layer) {\n    const translate = this.languageService.translate;\n    const title = translate.instant('igo.geo.download.title');\n    this.messageService.success(\n      translate.instant('igo.geo.download.start'),\n      title\n    );\n\n    const DSOptions: DataSourceOptions = layer.dataSource.options;\n    if (Object.keys(DSOptions.download).length > 0) {\n      if (\n        DSOptions.download.dynamicUrl &&\n        DSOptions.download.url === undefined\n      ) {\n        let wfsOptions;\n        let currentProj = new olProjection({ code: layer.map.projection });\n        const paramsWFS = (layer.dataSource.options as any).paramsWFS;\n        if (paramsWFS && Object.keys(paramsWFS).length > 0\n        ) {\n          currentProj = paramsWFS.srsName ? new olProjection({ code: paramsWFS.srsName }) : currentProj;\n          wfsOptions = (layer.dataSource.options as any).paramsWFS;\n        } else {\n          wfsOptions = (layer.dataSource.options as any).params;\n        }\n\n        const currentExtent = olproj.transformExtent(\n          layer.map.viewController.getExtent(),\n          new olProjection({ code: layer.map.projection }),\n          currentProj\n        );\n        const outputFormatDownload =\n          wfsOptions.outputFormatDownload === undefined\n            ? wfsOptions.outputFormat === undefined ? '' : 'outputformat=' + wfsOptions.outputFormat\n            : 'outputformat=' + wfsOptions.outputFormatDownload;\n\n        const baseurl = DSOptions.download.dynamicUrl\n          .replace(/&?outputformat=[^&]*/gi, '')\n          .replace(/&?filter=[^&]*/gi, '')\n          .replace(/&?bbox=[^&]*/gi, '');\n\n        const ogcFilters = (layer.dataSource.options as OgcFilterableDataSourceOptions).ogcFilters;\n\n        let filterQueryString;\n        filterQueryString = new OgcFilterWriter()\n        .handleOgcFiltersAppliedValue(\n          layer.dataSource.options,\n          ogcFilters.geometryName,\n          currentExtent as [number, number, number, number],\n          currentProj);\n        if (!filterQueryString) {\n          // Prevent getting all the features for empty filter\n            filterQueryString = new OgcFilterWriter().buildFilter(\n            undefined,\n            currentExtent as [number, number, number, number],\n            currentProj,\n            ogcFilters.geometryName\n          );\n        } else {\n          filterQueryString = 'filter=' + encodeURIComponent(filterQueryString);\n        }\n        window.open(\n          `${baseurl}&${filterQueryString}&${outputFormatDownload}`,\n          '_blank'\n        );\n      } else if (DSOptions.download) {\n        window.open(DSOptions.download.url, '_blank');\n      }\n    }\n  }\n}\n","<button\n  *ngIf=\"options && options.download && (options.download['dynamicUrl'] || options.download['url']) \"\n  mat-icon-button\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.download.action' | translate\"\n  [color]=\"color\"\n  (click)=\"openDownload(layer)\">\n  <mat-icon svgIcon=\"download\"></mat-icon>\n</button>\n","import { Component, Input, ChangeDetectionStrategy } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\nimport { DownloadDataSourceOptions } from '../shared/download.interface';\nimport { DownloadService } from '../shared/download.service';\n\n@Component({\n  selector: 'igo-download-button',\n  templateUrl: './download-button.component.html',\n  styleUrls: ['./download-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class DownloadButtonComponent {\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n  }\n  private _layer: Layer;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  constructor(private downloadService: DownloadService) {}\n\n  openDownload(layer: Layer) {\n    this.downloadService.open(layer);\n  }\n\n  get options(): DownloadDataSourceOptions {\n    if (!this.layer) {\n      return;\n    }\n    return this.layer.dataSource.options;\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { DownloadButtonComponent } from './download-button/download-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    IgoLanguageModule\n  ],\n  exports: [DownloadButtonComponent],\n  declarations: [DownloadButtonComponent]\n})\nexport class IgoDownloadModule {\n  static forRoot(): ModuleWithProviders<IgoDownloadModule> {\n    return {\n      ngModule: IgoDownloadModule\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { ColorPickerModule } from 'ngx-color-picker';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoEntityTableModule } from '@igo2/common';\nimport { DrawComponent } from './draw.component';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { DrawPopupComponent } from './draw-popup.component';\nimport { DrawShorcutsComponent } from './draw-shorcuts.component';\nimport { DrawLayerPopupComponent } from './draw-layer-popup.component';\n\nimport { BrowserModule } from '@angular/platform-browser';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\n\nimport {MatRadioModule} from '@angular/material/radio';\n\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatIconModule,\n    MatBadgeModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatListModule,\n    MatSelectModule,\n    MatSlideToggleModule,\n    MatDialogModule,\n    IgoLanguageModule,\n    IgoEntityTableModule,\n    ColorPickerModule,\n    BrowserModule,\n    BrowserAnimationsModule,\n    MatRadioModule,\n    MatCheckboxModule\n  ],\n  declarations: [DrawComponent, DrawPopupComponent, DrawLayerPopupComponent, DrawShorcutsComponent],\n  exports: [DrawComponent]\n})\nexport class IgoDrawModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule, IgoImageModule } from '@igo2/common';\n\nimport { FeatureDetailsComponent } from './feature-details.component';\nimport { FeatureDetailsDirective } from './feature-details.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    IgoLanguageModule,\n    IgoKeyValueModule,\n    IgoImageModule\n  ],\n  exports: [\n    FeatureDetailsComponent,\n    FeatureDetailsDirective],\n  declarations: [\n    FeatureDetailsComponent,\n    FeatureDetailsDirective]\n})\nexport class IgoFeatureDetailsModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFormModule } from '@igo2/common';\n\nimport { FeatureFormComponent } from './feature-form.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoFormModule\n  ],\n  exports: [\n    IgoFormModule,\n    FeatureFormComponent\n  ],\n  declarations: [\n    FeatureFormComponent\n  ]\n})\nexport class IgoFeatureFormModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoFeatureDetailsModule } from './feature-details/feature-details.module';\nimport { IgoFeatureFormModule } from './feature-form/feature-form.module';\n\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    IgoFeatureDetailsModule,\n    IgoFeatureFormModule\n  ],\n  declarations: [],\n  providers: []\n})\nexport class IgoFeatureModule {}\n","import OlMap from 'ol/Map';\nimport OlFeature from 'ol/Feature';\nimport * as OlStyle from 'ol/style';\nimport { StyleLike as OlStyleLike } from 'ol/style/Style';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlModify from 'ol/interaction/Modify';\nimport OlTranslate from 'ol/interaction/Translate';\nimport OlDraw from 'ol/interaction/Draw';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlLineString from 'ol/geom/LineString';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLinearRing from 'ol/geom/LinearRing';\nimport OlInteraction from 'ol/interaction/Interaction';\nimport OlDragBoxInteraction from 'ol/interaction/DragBox';\nimport MapBrowserEvent from 'ol/MapBrowserEvent';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport BasicEvent from 'ol/events/Event';\nimport { ModifyEvent as OlModifyEvent } from 'ol/interaction/Modify';\nimport { TranslateEvent as OlTranslateEvent } from 'ol/interaction/Translate';\nimport { DrawEvent as OlDrawEvent } from 'ol/interaction/Draw';\nimport { unByKey } from 'ol/Observable';\n\nimport { Subject, Subscription, fromEvent } from 'rxjs';\n\nimport {\n  addLinearRingToOlPolygon,\n  createDrawHoleInteractionStyle,\n  getMousePositionFromOlGeometryEvent\n} from '../geometry.utils';\n\nexport interface ModifyControlOptions {\n  source?: OlVectorSource<any>;\n  layer?: OlVectorLayer<any>;\n  layerStyle?: OlStyleLike;\n  drawStyle?: OlStyleLike;\n  modify?: boolean;\n  translate?: boolean;\n}\n\n/**\n * Control to modify geometries\n */\nexport class ModifyControl {\n  /**\n   * Modify start observable\n   */\n  public start$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Modify end observable\n   */\n  public end$: Subject<OlGeometry> = new Subject();\n\n  /**\n   * Geometry changes observable\n   */\n  public changes$: Subject<OlGeometry> = new Subject();\n\n  private olMap: OlMap;\n  private olOverlayLayer: OlVectorLayer<any>;\n  public olModifyInteraction: OlModify;\n  private onModifyStartKey: any;\n  private onModifyEndKey: any;\n  private onModifyKey: any;\n  private olModifyInteractionIsActive: boolean = false;\n  private olTranslateInteraction: OlTranslate;\n  private onTranslateStartKey: any;\n  private onTranslateEndKey: any;\n  private onTranslateKey: any;\n  private olTranslateInteractionIsActive: boolean = false;\n  private olDrawInteraction: OlDraw;\n  private onDrawStartKey: any;\n  private onDrawEndKey: any;\n  private onDrawKey: any;\n  private olDrawInteractionIsActive: boolean = false;\n\n  private mousePosition: [number, number];\n\n  private keyDown$$: Subscription;\n  private drawKeyUp$$: Subscription;\n  private drawKeyDown$$: Subscription;\n\n  private removedOlInteractions: OlInteraction[] = [];\n  private olLinearRingsLayer: OlVectorLayer<any>;\n\n  // This is the geometry to test against when drawing holes\n  private olOuterGeometry: OlGeometry;\n\n  /**\n   * Wheter the control is active\n   */\n  get active(): boolean {\n    return this.olMap !== undefined;\n  }\n\n  /**\n   * OL overlay source\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<any> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  /**\n   * OL linear rings source\n   * @internal\n   */\n  get olLinearRingsSource(): OlVectorSource<any> {\n    return this.olLinearRingsLayer.getSource();\n  }\n\n  /**\n   * Whether a modify control should be available\n   */\n  private modify: boolean = true;\n\n  /**\n   * Whether a translate control should be available\n   */\n  private translate: boolean = true;\n\n  constructor(private options: ModifyControlOptions) {\n    if (options.modify !== undefined) {\n      this.modify = options.modify;\n    }\n    if (options.translate !== undefined) {\n      this.translate = options.translate;\n    }\n\n    if (options.layer !== undefined) {\n      this.olOverlayLayer = options.layer;\n    } else {\n      this.olOverlayLayer = this.createOlInnerOverlayLayer();\n    }\n    this.olLinearRingsLayer = this.createOlLinearRingsLayer();\n  }\n\n  /**\n   * Add or remove this control to/from a map.\n   * @param map OL Map\n   */\n  setOlMap(olMap: OlMap | undefined) {\n    if (olMap === undefined) {\n      this.clearOlInnerOverlaySource();\n      this.removeOlInnerOverlayLayer();\n      this.removeOlModifyInteraction();\n      this.removeOlTranslateInteraction();\n      this.removeOlDrawInteraction();\n      this.olMap = olMap;\n      return;\n    }\n\n    this.olMap = olMap;\n    this.addOlInnerOverlayLayer();\n\n    // The order in which these interactions\n    // are added is important\n    if (this.modify === true) {\n      this.addOlDrawInteraction();\n    }\n\n    if (this.translate === true) {\n      this.addOlTranslateInteraction();\n      this.activateTranslateInteraction();\n    }\n\n    if (this.modify === true) {\n      this.addOlModifyInteraction();\n      this.activateModifyInteraction();\n    }\n  }\n\n  /**\n   * Return the overlay source\n   */\n  getSource(): OlVectorSource<any> {\n    return this.olOverlaySource;\n  }\n\n  /**\n   * Add an OL geometry to the overlay and start modifying it\n   * @param olGeometry Ol Geometry\n   */\n  setOlGeometry(olGeometry: OlGeometry) {\n    const olFeature = new OlFeature({ geometry: olGeometry });\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create an overlay source if none is defined in the options\n   */\n  private createOlInnerOverlayLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: this.options.source ? this.options.source : new OlVectorSource(),\n      style: this.options.layerStyle,\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the overlay layer if it wasn't defined in the options\n   */\n  private addOlInnerOverlayLayer() {\n    if (this.options.layer === undefined) {\n      this.olMap.addLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay layer if it wasn't defined in the options\n   */\n  private removeOlInnerOverlayLayer() {\n    if (this.options.layer === undefined && this.olMap !== undefined) {\n      this.olMap.removeLayer(this.olOverlayLayer);\n    }\n  }\n\n  /**\n   * Clear the overlay source if it wasn't defined in the options\n   */\n  private clearOlInnerOverlaySource() {\n    if (this.options.layer === undefined && this.options.source === undefined) {\n      this.olOverlaySource.clear(true);\n    }\n  }\n\n  private createOlLinearRingsLayer(): OlVectorLayer<any> {\n    return new OlVectorLayer({\n      source: new OlVectorSource(),\n      style: createDrawHoleInteractionStyle(),\n      zIndex: 500\n    });\n  }\n\n  /**\n   * Add the linear rings layer\n   */\n  private addOlLinearRingsLayer() {\n    this.olMap.addLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings layer\n   */\n  private removeOlLinearRingsLayer() {\n    this.olMap.removeLayer(this.olLinearRingsLayer);\n  }\n\n  /**\n   * Clear the linear rings source\n   */\n  private clearOlLinearRingsSource() {\n    this.olLinearRingsSource.clear(true);\n  }\n\n  /**\n   * Add a modify interaction to the map an set up some listeners\n   */\n  private addOlModifyInteraction() {\n    const olModifyInteraction = new OlModify({\n      source: this.olOverlaySource,\n      style: this.options.drawStyle as OlStyle.Style\n    });\n    this.olModifyInteraction = olModifyInteraction;\n  }\n\n  /**\n   * Remove the modify interaction\n   */\n  private removeOlModifyInteraction() {\n    if (this.olModifyInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateModifyInteraction();\n    this.olModifyInteraction = undefined;\n  }\n\n  private activateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === true) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = true;\n    this.onModifyStartKey = this.olModifyInteraction.on(\n      'modifystart',\n      (event: OlModifyEvent) => this.onModifyStart(event)\n    );\n    this.onModifyEndKey = this.olModifyInteraction.on(\n      'modifyend',\n      (event: OlModifyEvent) => this.onModifyEnd(event)\n    );\n    this.olMap.addInteraction(this.olModifyInteraction);\n  }\n\n  private deactivateModifyInteraction() {\n    if (this.olModifyInteractionIsActive === false) {\n      return;\n    }\n\n    this.olModifyInteractionIsActive = false;\n\n    unByKey([this.onModifyStartKey, this.onModifyEndKey, this.onModifyKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olModifyInteraction);\n    }\n  }\n\n  /**\n   * When modifying starts, clear the overlay and start watching for changes\n   * @param event Modify start event\n   */\n  private onModifyStart(event: OlModifyEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onModifyKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        this.mousePosition = getMousePositionFromOlGeometryEvent(\n          olGeometryEvent\n        );\n        this.changes$.next(olGeometryEvent.target as OlLineString | OlCircle | OlPolygon);\n      }\n    );\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When modifying ends, update the geometry observable and stop watching for changes\n   * @param event Modify end event\n   */\n  private onModifyEnd(event: OlModifyEvent) {\n    unByKey(this.onModifyKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Subscribe to space key down to pan the map\n   */\n  private subscribeToKeyDown() {\n    this.keyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key === ' ') {\n          // On space bar, pan to the current mouse position\n          this.olMap.getView().animate({\n            center: this.mousePosition,\n            duration: 0\n          });\n          return;\n        }\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to key down\n   */\n  private unsubscribeToKeyDown() {\n    if (this.keyDown$$ !== undefined) {\n      this.keyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Add a translate interaction to the map an set up some listeners\n   */\n  private addOlTranslateInteraction() {\n    const olTranslateInteraction = new OlTranslate({\n      layers: [this.olOverlayLayer]\n    });\n    this.olTranslateInteraction = olTranslateInteraction;\n  }\n\n  /**\n   * Remove the translate interaction\n   */\n  private removeOlTranslateInteraction() {\n    if (this.olTranslateInteraction === undefined) {\n      return;\n    }\n\n    this.deactivateTranslateInteraction();\n    this.olTranslateInteraction = undefined;\n  }\n\n  private activateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === true) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = true;\n    this.onTranslateStartKey = this.olTranslateInteraction.on(\n      'translatestart',\n      (event: OlTranslateEvent) => this.onTranslateStart(event)\n    );\n    this.onTranslateEndKey = this.olTranslateInteraction.on(\n      'translateend',\n      (event: OlTranslateEvent) => this.onTranslateEnd(event)\n    );\n    this.olMap.addInteraction(this.olTranslateInteraction);\n  }\n\n  private deactivateTranslateInteraction() {\n    if (this.olTranslateInteractionIsActive === false) {\n      return;\n    }\n\n    this.olTranslateInteractionIsActive = false;\n    unByKey([\n      this.onTranslateStartKey,\n      this.onTranslateEndKey,\n      this.onTranslateKey\n    ]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olTranslateInteraction);\n    }\n  }\n\n  /**\n   * When translation starts, clear the overlay and start watching for changes\n   * @param event Translate start event\n   */\n  private onTranslateStart(event: OlTranslateEvent) {\n    const olGeometry = event.features.item(0).getGeometry() as OlGeometry;\n    this.start$.next(olGeometry);\n    this.onTranslateKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        // this.changes$.next(olGeometryEvent.target);\n      }\n    );\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Translate end event\n   */\n  private onTranslateEnd(event: OlTranslateEvent) {\n    unByKey(this.onTranslateKey);\n    this.end$.next(event.features.item(0).getGeometry() as OlGeometry);\n  }\n\n  /**\n   * Add a draw interaction to the map an set up some listeners\n   */\n  private addOlDrawInteraction() {\n    const olDrawInteraction = new OlDraw({\n      type: 'Polygon',\n      source: this.olLinearRingsSource,\n      stopClick: true,\n      style: createDrawHoleInteractionStyle(),\n      condition: (event: MapBrowserEvent<any>) => {\n        const olOuterGeometry = this.olOuterGeometry || this.getOlGeometry();\n        const intersects = olOuterGeometry.intersectsCoordinate(\n          event.coordinate\n        );\n        return intersects;\n      }\n    });\n\n    this.olDrawInteraction = olDrawInteraction;\n    this.subscribeToDrawKeyDown();\n  }\n\n  /**\n   * Subscribe to CTRL key down to activate the draw control\n   */\n  private subscribeToDrawKeyDown() {\n    this.drawKeyDown$$ = fromEvent(document, 'keydown').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyDown();\n\n        const olGeometry = this.getOlGeometry();\n        if (!olGeometry || !(olGeometry instanceof OlPolygon)) {\n          return;\n        }\n\n        this.subscribeToDrawKeyUp();\n\n        this.deactivateModifyInteraction();\n        this.deactivateTranslateInteraction();\n        this.activateDrawInteraction();\n      }\n    );\n  }\n\n  /**\n   * Subscribe to CTRL key up to deactivate the draw control\n   */\n  private subscribeToDrawKeyUp() {\n    this.drawKeyUp$$ = fromEvent(document, 'keyup').subscribe(\n      (event: KeyboardEvent) => {\n        if (event.key !== 'Control') {\n          return;\n        }\n\n        this.unsubscribeToDrawKeyUp();\n        this.unsubscribeToKeyDown();\n        this.deactivateDrawInteraction();\n\n        this.activateModifyInteraction();\n        if (this.translate === true) {\n          this.activateTranslateInteraction();\n        }\n        this.subscribeToDrawKeyDown();\n\n        this.olOuterGeometry = undefined;\n        this.clearOlLinearRingsSource();\n        this.end$.next(this.getOlGeometry());\n      }\n    );\n  }\n\n  /**\n   * Unsubscribe to draw key down\n   */\n  private unsubscribeToDrawKeyDown() {\n    if (this.drawKeyDown$$ !== undefined) {\n      this.drawKeyDown$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Unsubscribe to key up\n   */\n  private unsubscribeToDrawKeyUp() {\n    if (this.drawKeyUp$$ !== undefined) {\n      this.drawKeyUp$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Remove the draw interaction\n   */\n  private removeOlDrawInteraction() {\n    if (this.olDrawInteraction === undefined) {\n      return;\n    }\n\n    this.unsubscribeToKeyDown();\n    this.unsubscribeToDrawKeyUp();\n    this.unsubscribeToDrawKeyDown();\n    this.deactivateDrawInteraction();\n    this.clearOlLinearRingsSource();\n    this.olDrawInteraction = undefined;\n  }\n\n  /**\n   * Activate the draw interaction\n   */\n  private activateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === true) {\n      return;\n    }\n\n    this.clearOlLinearRingsSource();\n    this.addOlLinearRingsLayer();\n\n    this.olMap.getInteractions().forEach((olInteraction: OlInteraction) => {\n      if (olInteraction instanceof OlDragBoxInteraction) {\n        this.olMap.removeInteraction(olInteraction);\n        this.removedOlInteractions.push(olInteraction);\n      }\n    });\n\n    this.olDrawInteractionIsActive = true;\n    this.onDrawStartKey = this.olDrawInteraction.on(\n      'drawstart',\n      (event: OlDrawEvent) => this.onDrawStart(event)\n    );\n    this.onDrawEndKey = this.olDrawInteraction.on(\n      'drawend',\n      (event: OlDrawEvent) => this.onDrawEnd(event)\n    );\n    this.olMap.addInteraction(this.olDrawInteraction);\n  }\n\n  /**\n   * Deactivate the draw interaction\n   */\n  private deactivateDrawInteraction() {\n    if (this.olDrawInteractionIsActive === false) {\n      return;\n    }\n\n    this.removeOlLinearRingsLayer();\n\n    this.removedOlInteractions.forEach((olInteraction: OlInteraction) => {\n      this.olMap.addInteraction(olInteraction);\n    });\n    this.removedOlInteractions = [];\n\n    this.olDrawInteractionIsActive = false;\n    unByKey([this.onDrawStartKey, this.onDrawEndKey, this.onDrawKey]);\n    if (this.olMap !== undefined) {\n      this.olMap.removeInteraction(this.olDrawInteraction);\n    }\n  }\n\n  /**\n   * When draw start, add a new linerar ring to the geometry and start watching for changes\n   * @param event Draw start event\n   */\n  private onDrawStart(event: OlDrawEvent) {\n    const olGeometry = event.feature.getGeometry();\n    this.olOuterGeometry = this.getOlGeometry().clone();\n\n    const linearRingCoordinates = ((olGeometry as any).getLinearRing() as any).getCoordinates();\n    this.addLinearRingToOlGeometry(linearRingCoordinates);\n    this.start$.next(this.getOlGeometry());\n\n    this.onDrawKey = olGeometry.on(\n      'change',\n      (olGeometryEvent: BasicEvent) => {\n        this.mousePosition = getMousePositionFromOlGeometryEvent(\n          olGeometryEvent\n        );\n        const olGeometryTarget = olGeometryEvent.target as OlPolygon;\n        const _linearRingCoordinates = olGeometryTarget\n          .getLinearRing(0)\n          .getCoordinates();\n        this.updateLinearRingOfOlGeometry(_linearRingCoordinates);\n        this.changes$.next(this.getOlGeometry());\n      }\n    );\n    this.subscribeToKeyDown();\n  }\n\n  /**\n   * When translation ends, update the geometry observable and stop watchign for changes\n   * @param event Draw end event\n   */\n  private onDrawEnd(event: OlDrawEvent) {\n    unByKey(this.onDrawKey);\n    this.olOuterGeometry = undefined;\n\n    const linearRingCoordinates = ((event.feature\n      .getGeometry() as any)\n      .getLinearRing() as any)\n      .getCoordinates();\n    this.updateLinearRingOfOlGeometry(linearRingCoordinates);\n    this.clearOlLinearRingsSource();\n    this.end$.next(this.getOlGeometry());\n    this.unsubscribeToKeyDown();\n  }\n\n  /**\n   * Add a linear ring to the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private addLinearRingToOlGeometry(coordinates: number[]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    const olLinearRing = new OlLinearRing(coordinates);\n    addLinearRingToOlPolygon(olGeometry, olLinearRing);\n  }\n\n  /**\n   * Update the last linear ring of the geometry being modified\n   * @param coordinates Linear ring coordinates\n   */\n  private updateLinearRingOfOlGeometry(coordinates: number[][]) {\n    const olGeometry = this.getOlGeometry() as OlPolygon;\n    // Remove the last linear ring (the one we are updating)\n    const olLinearRings = olGeometry.getLinearRings().slice(0, -1);\n    const newCoordinates = olLinearRings.map((olLinearRing: OlLinearRing) => {\n      return olLinearRing.getCoordinates();\n    });\n    newCoordinates.push(coordinates);\n    olGeometry.setCoordinates(newCoordinates);\n  }\n\n  /**\n   * Get the geometry being modified\n   * @returns OL Geometry\n   */\n  private getOlGeometry(): OlGeometry {\n    const olFeatures = this.olOverlaySource.getFeatures();\n    return olFeatures.length > 0 ? olFeatures[0].getGeometry() : undefined;\n  }\n}\n","export const LAYER = 'Layer';\n","<h3 mat-dialog-title>{{'igo.geo.measure.dialog.title' | translate}}</h3>\n\n<table *ngIf=\"data.length > 0\"\n  class=\"mat-typography\">\n  <thead>\n    <tr>\n      <th colspan=\"2\">{{'igo.geo.measure.dialog.length.title' | translate}}</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Meters}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInMeters' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Kilometers}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInKilometers' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Miles}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInMiles' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.length | measureFormat: measureLengthUnit.Feet}}</td>\n      <td>{{'igo.geo.measure.dialog.lengthInFeet' | translate}}</td>\n    </tr>\n  </tbody>\n</table>\n\n<table *ngIf=\"data.area > 0\"\n  class=\"mat-typography\">\n  <thead>\n    <tr>\n      <th colspan=\"2\">{{'igo.geo.measure.dialog.area.title' | translate}}</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.SquareMeters}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareMeters' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat:measureAreaUnit.SquareKilometers}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareKilometers' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.SquareMiles}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInSquareMiles' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.Acres}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInAcres' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{data.area | measureFormat: measureAreaUnit.Hectares}}</td>\n      <td>{{'igo.geo.measure.dialog.areaInHectares' | translate}}</td>\n    </tr>\n    <tr>\n      <td>{{'igo.geo.measure.dialog.perimeterInMeters' | translate}}</td>\n      <td>{{data.perimeter | measureFormat: measureLengthUnit.Meters}}</td>\n    </tr>\n  </tbody>\n</table>\n","import { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { MeasurerDialogData } from '../shared/measure.interfaces';\n\nimport { MeasureAreaUnit, MeasureLengthUnit} from '../shared/measure.enum';\n\n@Component({\n  selector: 'igo-measurer-dialog',\n  templateUrl: 'measurer-dialog.component.html',\n  styleUrls: ['./measurer-dialog.component.scss']\n})\nexport class MeasurerDialogComponent {\n\n  measureAreaUnit = MeasureAreaUnit;\n\n  measureLengthUnit = MeasureLengthUnit;\n\n  constructor(\n    public dialogRef: MatDialogRef<MeasurerDialogComponent>,\n    @Inject(MAT_DIALOG_DATA) public data: MeasurerDialogData\n  ) {}\n\n  onNoClick(): void {\n    this.dialogRef.close();\n  }\n\n}\n","<div>\n  <div class=\"measure-type-toggle mat-typography\">\n    <mat-button-toggle-group\n      [value]=\"activeMeasureType\"\n      (change)=\"onMeasureTypeChange($event.value)\">\n      <mat-button-toggle [value]=\"measureType.Length\">\n        {{('igo.geo.measure.' + measureType.Length) | translate}}\n      </mat-button-toggle>\n      <mat-button-toggle [value]=\"measureType.Area\">\n        {{('igo.geo.measure.' + measureType.Area) | translate}}\n      </mat-button-toggle>\n    </mat-button-toggle-group>\n  </div>\n\n  <div class=\"measure-options mat-typography\">\n    <mat-slide-toggle\n      [disabled]=\"drawControlIsDisabled\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDrawControl($event.checked)\">\n      {{'igo.geo.measure.toggleActive' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasLine$ | async)\"></mat-divider>\n\n    <mat-slide-toggle *ngIf=\"(hasLine$ | async)\"\n      [checked]=\"displayLines\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayLines($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayLines' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n    <mat-slide-toggle *ngIf=\"(hasArea$ | async)\"\n      [checked]=\"displayDistance\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayDistance($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayDistance' | translate}}\n    </mat-slide-toggle>\n\n    <mat-slide-toggle *ngIf=\"(hasArea$ | async)\"\n      [checked]=\"displayAreas\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleDisplayAreas($event.checked)\">\n      {{'igo.geo.measure.toggleDisplayAreas' | translate}}\n    </mat-slide-toggle>\n\n    <mat-divider *ngIf=\"(hasArea$ | async)\"></mat-divider>\n\n    <mat-slide-toggle\n      [checked]=\"measureUnitsAuto\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onToggleMeasureUnitsAuto($event.checked)\">\n      {{'igo.geo.measure.toggleAutoUnits' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <ng-container *ngIf=\"measure$ | async as measure\">\n    <igo-measurer-item *ngIf=\"activeMeasureType === measureType.Length || activeMeasureType === measureType.Area\"\n      [measureType]=\"measureType.Length\"\n      [measureUnit]=\"measureLengthUnit.Meters\"\n      [measure]=\"measure.length\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"(activeMeasureType === measureType.Area ? 'igo.geo.measure.perimeter' : 'igo.geo.measure.length') | translate\"\n      (measureUnitChange)=\"onLengthUnitChange($event)\">\n    </igo-measurer-item>\n\n    <igo-measurer-item *ngIf=\"activeMeasureType === measureType.Area\"\n      [measureType]=\"measureType.Area\"\n      [measureUnit]=\"measureAreaUnit.SquareMeters\"\n      [measure]=\"measure.area\"\n      [auto]=\"measureUnitsAuto\"\n      [placeholder]=\"'igo.geo.measure.area' | translate\"\n      (measureUnitChange)=\"onAreaUnitChange($event)\">\n    </igo-measurer-item>\n  </ng-container>\n\n  <mat-divider *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"></mat-divider>\n\n  <div class=\"measure-store-buttons\">\n    <button *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.calculate.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"accent\"\n      (click)=\"onCalculateClick()\">\n      <mat-icon svgIcon=\"calculator\"></mat-icon>\n    </button>\n\n    <button *ngIf=\"(hasLine$ | async) || (hasArea$ | async)\"\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.delete.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length === 0\"\n      color=\"warn\"\n      (click)=\"onDeleteClick()\">\n      <mat-icon svgIcon=\"delete\"></mat-icon>\n    </button>\n\n    <!--button\n      mat-icon-button\n      [matTooltip]=\"'igo.geo.measure.actionbar.modify.tooltip' | translate\"\n      [disabled]=\"(selectedFeatures$ | async).length !== 1\"\n      (click)=\"onModifyClick()\">\n      <mat-icon svgIcon=\"edit\"></mat-icon>\n    </button-->\n  </div>\n\n  <igo-entity-table\n    #table\n    class=\"table-compact\"\n    [store]=\"store\"\n    [template]=\"tableTemplate\">\n  </igo-entity-table>\n</div>\n","import {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  ViewChild\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { skip } from 'rxjs/operators';\n\nimport OlStyle from 'ol/style/Style';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlVectorSource from 'ol/source/Vector';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPolygon from 'ol/geom/Polygon';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlOverlay from 'ol/Overlay';\nimport { unByKey } from 'ol/Observable';\n\nimport { LanguageService, StorageScope, StorageService } from '@igo2/core';\nimport { EntityRecord, EntityTableTemplate } from '@igo2/common';\nimport type { EntityTableComponent } from '@igo2/common';\nimport { uuid } from '@igo2/utils';\n\nimport { FeatureDataSource } from '../../datasource';\nimport {\n  FEATURE,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  tryBindStoreLayer,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy\n} from '../../feature';\nimport { DrawControl, ModifyControl } from '../../geometry/shared';\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nimport { Measure, MeasurerDialogData, FeatureWithMeasure } from '../shared/measure.interfaces';\nimport {\n  MeasureType,\n  MeasureAreaUnit,\n  MeasureLengthUnit,\n} from '../shared/measure.enum';\nimport {\n  measureOlGeometry,\n  createMeasureInteractionStyle,\n  createMeasureLayerStyle,\n  updateOlTooltipsAtMidpoints,\n  updateOlTooltipAtCenter,\n  getTooltipsOfOlGeometry,\n  squareMetersToUnit,\n  metersToUnit,\n  formatMeasure\n} from '../shared/measure.utils';\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\n\n/**\n * Tool to measure lengths and areas\n */\n@Component({\n  selector: 'igo-measurer',\n  templateUrl: './measurer.component.html',\n  styleUrls: ['./measurer.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MeasurerComponent implements OnInit, OnDestroy {\n\n  /**\n   * Table template\n   * @internal\n   */\n  public tableTemplate: EntityTableTemplate = {\n    selection: true,\n    selectMany: true,\n    selectionCheckbox: true,\n    sort: true,\n    columns: [\n      {\n        name: 'length',\n        title: this.languageService.translate.instant('igo.geo.measure.lengthHeader'),\n        valueAccessor: (localFeature: FeatureWithMeasure) => {\n          const unit = this.activeLengthUnit;\n          const measure = metersToUnit(localFeature.properties.measure.length, unit);\n          return formatMeasure(measure, {\n            decimal: 1,\n            unit,\n            unitAbbr: false,\n            locale: 'fr'\n          });\n        }\n      },\n      {\n        name: 'area',\n        title: this.languageService.translate.instant('igo.geo.measure.areaHeader'),\n        valueAccessor: (localFeature: FeatureWithMeasure) => {\n          const unit = this.activeAreaUnit;\n          const measure = squareMetersToUnit(localFeature.properties.measure.area, unit);\n          return measure ? formatMeasure(measure, {\n            decimal: 1,\n            unit,\n            unitAbbr: false,\n            locale: 'fr'\n          }) : '';\n        }\n      }\n    ]\n  };\n\n  private subscriptions$$: Subscription[] = [];\n\n  /**\n   * Reference to the MeasureType enum\n   * @internal\n   */\n  public measureType = MeasureType;\n\n  /**\n   * Reference to the AreaMeasureUnit enum\n   * @internal\n   */\n  public measureAreaUnit = MeasureAreaUnit;\n\n  /**\n   * Reference to the LengthMeasureUnit enum\n   * @internal\n   */\n  public measureLengthUnit = MeasureLengthUnit;\n\n  /**\n   * Whether measure units should be automatically determined\n   * @internal\n   */\n  public measureUnitsAuto: boolean = false;\n\n  /**\n   * Whether display of distances of areas\n   * @internal\n   */\n  public displayDistance: boolean = true;\n\n  /**\n   * Whether display of distances of lines\n   * @internal\n   */\n  public displayLines: boolean = true;\n\n  /**\n   * Whether display of areas\n   * @internal\n   */\n  public displayAreas: boolean = true;\n\n  /**\n   * Observable of line boolean\n   * @internal\n   */\n   public hasLine$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area boolean\n   * @internal\n   */\n  public hasArea$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  /**\n   * Observable of area\n   * @internal\n   */\n  public measure$: BehaviorSubject<Measure> = new BehaviorSubject({});\n\n  /**\n   * Observable of selected features\n   * @internal\n   */\n  public selectedFeatures$: BehaviorSubject<FeatureWithMeasure[]> = new BehaviorSubject([]);\n\n  /**\n   * OL draw source\n   * @internal\n   */\n  public showTooltips: boolean = true;\n\n  /**\n   * Whether draw control toggle is disabled or not\n   * @internal\n   */\n  public drawControlIsDisabled: boolean = true;\n\n  /**\n   * Draw line control\n   */\n  private drawLineControl: DrawControl;\n\n  /**\n   * Draw polygon control\n   */\n  private drawPolygonControl: DrawControl;\n\n  /**\n   * Modify control\n   */\n  private modifyControl: ModifyControl;\n\n  /**\n   * Active OL geometry\n   */\n  private activeOlGeometry: OlLineString | OlPolygon;\n\n  /**\n   * Active mlength unit\n   */\n  private activeLengthUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  /**\n   * Active area unit\n   */\n  private activeAreaUnit: MeasureAreaUnit = MeasureAreaUnit.SquareMeters;\n\n  /**\n   * Feature added listener key\n   */\n  private onFeatureAddedKey;\n\n  /**\n   * Feature removed listener key\n   */\n  private onFeatureRemovedKey;\n\n  /**\n   * Active draw control\n   * @internal\n   */\n  private activeDrawControl: DrawControl;\n\n  /**\n   * Subscription to draw start\n   */\n  private drawStart$$: Subscription;\n\n  /**\n   * Subscription to draw end\n   */\n  private drawEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private drawChanges$$: Subscription;\n\n  /**\n   * Subscription to modify start\n   */\n  private modifyStart$$: Subscription;\n\n  /**\n   * Subscription to modify end\n   */\n  private modifyEnd$$: Subscription;\n\n  /**\n   * Subscription to controls changes\n   */\n  private modifyChanges$$: Subscription;\n\n  /**\n   * Subscription to measures selection\n   */\n  private selectedFeatures$$: Subscription;\n\n  /**\n   * OL draw source\n   */\n  private olDrawSource = new OlVectorSource();\n\n  /**\n   * The map to measure on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The measures store\n   */\n  @Input() store: FeatureStore<FeatureWithMeasure>;\n\n  /**\n   * Measure type\n   * @internal\n   */\n  @Input()\n  set activeMeasureType(value: MeasureType) { this.setActiveMeasureType(value); }\n  get activeMeasureType(): MeasureType { return this._activeMeasureType; }\n  private _activeMeasureType: MeasureType;\n\n  /**\n   * The minimum length a segment must have to display a tooltip.\n   * It also applies to area tooltips.\n   */\n  @Input() minSegmentLength: number = 10;\n\n  @ViewChild('table', { static: true }) table: EntityTableComponent;\n\n  /**\n   * Wheter one of the draw control is active\n   * @internal\n   */\n  get drawControlIsActive(): boolean {\n    return this.activeDrawControl !== undefined;\n  }\n\n  get projection(): string {\n    return this.map.ol.getView().getProjection().getCode();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dialog: MatDialog,\n    private storageService: StorageService\n  ) {}\n\n  /**\n   * Add draw controls and activate one\n   * @internal\n   */\n  ngOnInit() {\n    this.initStore();\n    this.createDrawLineControl();\n    this.createDrawPolygonControl();\n    this.createModifyControl();\n    this.toggleDrawControl();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    this.checkDistanceAreaToggle();\n    this.setActiveMeasureType(MeasureType.Length);\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.setActiveMeasureType(undefined);\n    this.deactivateModifyControl();\n    this.freezeStore();\n    this.subscriptions$$.map(s => s.unsubscribe());\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onMeasureTypeChange(measureType: MeasureType) {\n    this.activeMeasureType = measureType;\n  }\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n  onToggleDrawControl(toggle: boolean) {\n    if (toggle === true) {\n      this.toggleDrawControl();\n    } else {\n      this.deactivateDrawControl();\n    }\n  }\n\n\n  /**\n   * Activate or deactivate the current draw control\n   * @internal\n   */\n   onToggleMeasureUnitsAuto(toggle: boolean) {\n    this.measureUnitsAuto = toggle;\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the areas\n   * @internal\n   */\n  onToggleDisplayDistance(toggle: boolean) {\n    this.displayDistance = toggle;\n    this.onDisplayDistance();\n    toggle ? (this.storageService.set('distanceToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('distanceToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of the lines\n   * @internal\n   */\n  onToggleDisplayLines(toggle: boolean) {\n    this.displayLines = toggle;\n    this.onDisplayLines();\n    toggle ? (this.storageService.set('linesToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('linesToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onToggleDisplayAreas(toggle: boolean) {\n    this.displayAreas = toggle;\n    this.onDisplayAreas();\n    toggle ? (this.storageService.set('areasToggle', true, StorageScope.SESSION)) :\n     (this.storageService.set('areasToggle', false, StorageScope.SESSION));\n  }\n\n  /**\n   * Set display parametres in current values\n   * @internal\n   */\n  checkDistanceAreaToggle(){\n    if (this.storageService.get('distanceToggle') === false){\n      this.displayDistance = false;\n    }\n    if (this.storageService.get('linesToggle') === false){\n      this.displayLines = false;\n    }\n    if (this.storageService.get('areasToggle') === false){\n      this.displayAreas = false;\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of areas\n   * @internal\n   */\n  onDisplayDistance() {\n    if (this.displayDistance) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-polygone-segments')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-polygone-segments')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of distances of lines\n   * @internal\n   */\n  onDisplayLines() {\n    if (this.displayLines) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-line-segments')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-line-segments')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Activate or deactivate the current display of areas\n   * @internal\n   */\n  onDisplayAreas() {\n    if (this.displayAreas) {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-area')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-hidden'));\n    } else {\n      Array.from(document.getElementsByClassName('igo-map-tooltip-measure-area')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-hidden'));\n    }\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onLengthUnitChange(unit: MeasureLengthUnit) {\n    this.activeLengthUnit = unit;\n    this.table.refresh();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    if (this.activeOlGeometry !== undefined) {\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n  }\n\n  /**\n   * Set the measure type\n   * @internal\n   */\n  onAreaUnitChange(unit: MeasureAreaUnit) {\n    this.activeAreaUnit = unit;\n    this.table.refresh();\n    this.updateTooltipsOfOlSource(this.store.source.ol);\n    if (this.activeOlGeometry !== undefined) {\n      this.updateTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n  }\n\n  onCalculateClick() {\n    const features = this.selectedFeatures$.value;\n    const area = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      return sum + localFeature.properties.measure.area || 0;\n    }, 0);\n    const length = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      if (localFeature.geometry.type === 'Polygon') {\n        return sum;\n      }\n      return sum + localFeature.properties.measure.length || 0;\n    }, 0);\n    const perimeter = features.reduce((sum: number, localFeature: FeatureWithMeasure) => {\n      if (localFeature.geometry.type === 'LineString') {\n        return sum;\n      }\n      return sum + localFeature.properties.measure.length || 0;\n    }, 0);\n\n    this.openDialog({\n      area,\n      length,\n      perimeter\n    });\n  }\n\n  onDeleteClick() {\n    this.store.deleteMany(this.selectedFeatures$.value);\n    this.selectedFeatures$.value.forEach(selectedFeature => {\n      this.olDrawSource.getFeatures().forEach(drawingLayerFeature => {\n        const geometry = drawingLayerFeature.getGeometry() as any;\n        if (selectedFeature.properties.id === geometry.ol_uid) {\n          this.olDrawSource.removeFeature(drawingLayerFeature);\n        }\n      });\n    });\n  }\n\n  onModifyClick() {\n    if (this.selectedFeatures$.value.length !== 1) { return; }\n\n    if (this.modifyControl.active === true) {\n      this.deactivateModifyControl();\n      this.toggleDrawControl();\n    } else {\n      const localFeature = this.selectedFeatures$.value[0];\n      const olFeatures = this.store.layer.ol.getSource().getFeatures();\n      const olFeature = olFeatures.find((_olFeature: OlFeature<OlGeometry>) => {\n        return _olFeature.get('id') === localFeature.properties.id;\n      });\n\n      if (olFeature !== undefined) {\n        this.deactivateDrawControl();\n        this.activateModifyControl();\n\n        const olGeometry = olFeature.getGeometry();\n        this.clearTooltipsOfOlGeometry(olGeometry as (OlLineString | OlPolygon));\n        this.modifyControl.setOlGeometry(olGeometry);\n      }\n    }\n  }\n\n  private openDialog(data: MeasurerDialogData): void {\n    this.dialog.open(MeasurerDialogComponent, {data});\n  }\n\n  /**\n   * Initialize the measure store and set up some listeners\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      title: this.languageService.translate.instant('igo.geo.measure.layerTitle'),\n      isIgoInternalLayer: true,\n      id: `igo-measures-${uuid()}`,\n      zIndex: 200,\n      source: new FeatureDataSource(),\n      style: createMeasureLayerStyle(),\n      showInLayerList: true,\n      exportable: true,\n      browsable: false,\n      workspace: { enabled: false }\n    });\n    tryBindStoreLayer(store, layer);\n    store.layer.visible = true;\n    layer.visible$.subscribe(visible => {\n      if (visible) {\n        Array.from(document.getElementsByClassName('igo-map-tooltip-measure')).map((value: Element) =>\n        value.classList.remove('igo-map-tooltip-measure-by-display'));\n      }\n      else {\n        Array.from(document.getElementsByClassName('igo-map-tooltip-measure')).map((value: Element) =>\n        value.classList.add('igo-map-tooltip-measure-by-display'));\n      }\n    });\n\n    tryAddLoadingStrategy(store);\n\n    tryAddSelectionStrategy(store, new FeatureStoreSelectionStrategy({\n      map: this.map,\n      many: true\n    }));\n\n    this.onFeatureAddedKey = store.source.ol.on('addfeature', (event: OlVectorSourceEvent<OlGeometry>) => {\n      const localFeature = event.feature;\n      const olGeometry = localFeature.getGeometry() as any;\n      this.updateMeasureOfOlGeometry(olGeometry, localFeature.get('measure'));\n      this.onDisplayDistance();\n    });\n\n    this.onFeatureRemovedKey = store.source.ol.on('removefeature', (event: OlVectorSourceEvent<OlGeometry>) => {\n      const olGeometry = event.feature.getGeometry() as any;\n      this.clearTooltipsOfOlGeometry(olGeometry);\n    });\n\n    this.selectedFeatures$$ = store.stateView.manyBy$((record: EntityRecord<FeatureWithMeasure>) => {\n      return record.state.selected === true;\n    }).pipe(\n      skip(1) // Skip initial emission\n    )\n    .subscribe((records: EntityRecord<FeatureWithMeasure>[]) => {\n      if (this.modifyControl.active === true) {\n        this.deactivateModifyControl();\n      }\n      this.selectedFeatures$.next(records.map(record => record.entity));\n    });\n\n    this.subscriptions$$.push(this.store.entities$.subscribe(objectsExists => {\n      if (objectsExists.find(objectExist => objectExist.geometry.type === 'Polygon')){\n        this.hasArea$.next(true);\n      } else {\n        this.hasArea$.next(false);\n      }\n\n      if (objectsExists.find(objectExist => objectExist.geometry.type === 'LineString')){\n        this.hasLine$.next(true);\n      } else {\n        this.hasLine$.next(false);\n      }\n    }));\n\n    this.subscriptions$$.push(this.store.count$.subscribe(cnt => {\n      cnt >= 1 ?\n        this.store.layer.options.showInLayerList = true :\n        this.store.layer.options.showInLayerList = false;\n    }));\n  }\n\n  /**\n   * Freeze any store, meaning the layer is removed, strategies are deactivated\n   * and some listener removed\n   * @internal\n   */\n  private freezeStore() {\n    const store = this.store;\n    this.selectedFeatures$$.unsubscribe();\n    unByKey(this.onFeatureAddedKey);\n    unByKey(this.onFeatureRemovedKey);\n    store.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    store.deactivateStrategyOfType(FeatureStoreSelectionStrategy);\n  }\n\n  /**\n   * Create a draw line control\n   */\n  private createDrawLineControl() {\n    this.drawLineControl = new DrawControl({\n      geometryType: 'LineString',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createDrawPolygonControl() {\n    this.drawPolygonControl = new DrawControl({\n      geometryType: 'Polygon',\n      drawingLayerSource: this.olDrawSource,\n      interactionStyle: createMeasureInteractionStyle(),\n      drawingLayerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Create a draw polygon control\n   */\n  private createModifyControl() {\n    this.modifyControl = new ModifyControl({\n      source: this.olDrawSource,\n      drawStyle: createMeasureInteractionStyle(),\n      layerStyle: new OlStyle({})\n    });\n  }\n\n  /**\n   * Activate the right control\n   */\n  private toggleDrawControl() {\n    this.deactivateDrawControl();\n    // this.deactivateModifyControl();\n    if (this.activeMeasureType === MeasureType.Length) {\n      this.activateDrawControl(this.drawLineControl);\n    } else if (this.activeMeasureType === MeasureType.Area) {\n      this.activateDrawControl(this.drawPolygonControl);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param drawControl Draw control\n   */\n  private activateDrawControl(drawControl: DrawControl) {\n    this.drawControlIsDisabled = false;\n    this.activeDrawControl = drawControl;\n    this.drawStart$$ = drawControl.start$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawStart(olGeometry));\n    this.drawEnd$$ = drawControl.end$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawEnd(olGeometry));\n    this.drawChanges$$ = drawControl.changes$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onDrawChanges(olGeometry));\n    this.drawChanges$$ = drawControl.abort$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => {\n        this.clearTooltipsOfOlGeometry(olGeometry);\n        this.clearMeasures();\n      });\n    drawControl.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  private deactivateDrawControl() {\n    if (this.activeDrawControl === undefined) {\n      return;\n    }\n\n    this.olDrawSource.clear();\n    if (this.drawStart$$ !== undefined ) { this.drawStart$$.unsubscribe(); }\n    if (this.drawEnd$$ !== undefined ) { this.drawEnd$$.unsubscribe(); }\n    if (this.drawChanges$$ !== undefined ) { this.drawChanges$$.unsubscribe(); }\n\n    this.clearTooltipsOfOlSource(this.olDrawSource);\n    if (this.activeOlGeometry !== undefined) {\n      this.clearTooltipsOfOlGeometry(this.activeOlGeometry);\n    }\n    this.activeDrawControl.setOlMap(undefined);\n    this.activeDrawControl = undefined;\n    this.activeOlGeometry = undefined;\n  }\n\n  private setActiveMeasureType(measureType: MeasureType) {\n    this._activeMeasureType = measureType;\n    this.clearMeasures();\n    this.toggleDrawControl();\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawStart(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = olGeometry;\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawEnd(olGeometry: OlLineString | OlPolygon) {\n    this.activeOlGeometry = undefined;\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n    this.addFeatureToStore(olGeometry);\n    this.clearTooltipsOfOlGeometry(olGeometry);\n    this.olDrawSource.clear(true);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onDrawChanges(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(olGeometry, Object.assign({}, measure, {\n      area: undefined // We don't want to display an area tooltip while drawing.\n    }));\n    this.measure$.next(measure);\n  }\n\n  /**\n   * Activate a given control\n   * @param modifyControl Modify control\n   */\n  private activateModifyControl() {\n    const selection = this.store.getStrategyOfType(FeatureStoreSelectionStrategy) as FeatureStoreSelectionStrategy;\n    selection.deactivate();\n    selection.clear();\n\n    this.modifyStart$$ = this.modifyControl.start$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyStart(olGeometry));\n    this.modifyEnd$$ = this.modifyControl.end$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyEnd(olGeometry));\n    this.modifyChanges$$ = this.modifyControl.changes$\n      .subscribe((olGeometry: OlLineString | OlPolygon) => this.onModifyChanges(olGeometry));\n    this.modifyControl.setOlMap(this.map.ol);\n  }\n\n  /**\n   * Deactivate the active modify control\n   */\n  private deactivateModifyControl() {\n    if (this.modifyStart$$ !== undefined ) { this.modifyStart$$.unsubscribe(); }\n    if (this.modifyEnd$$ !== undefined ) { this.modifyEnd$$.unsubscribe(); }\n    if (this.modifyChanges$$ !== undefined ) { this.modifyChanges$$.unsubscribe(); }\n\n    if (this.activeOlGeometry !== undefined) {\n      if (this.selectedFeatures$.value.length === 1) {\n        const localFeature = this.selectedFeatures$.value[0];\n        this.addFeatureToStore(this.activeOlGeometry, localFeature);\n      }\n      this.finalizeMeasureOfOlGeometry(this.activeOlGeometry);\n    }\n\n    this.olDrawSource.clear();\n\n    this.store.activateStrategyOfType(FeatureStoreSelectionStrategy);\n\n    this.activeOlGeometry = undefined;\n    this.modifyControl.setOlMap(undefined);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being drawn\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyStart(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawStart(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyChanges(olGeometry: OlLineString | OlPolygon) {\n    this.onDrawChanges(olGeometry);\n  }\n\n  /**\n   * Clear the draw source and track the geometry being draw\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onModifyEnd(olGeometry: OlLineString | OlPolygon) {\n    this.finalizeMeasureOfOlGeometry(olGeometry);\n  }\n\n  private finalizeMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = measureOlGeometry(olGeometry, this.projection);\n    this.updateMeasureOfOlGeometry(olGeometry, measure);\n  }\n\n  /**\n   * Update measures observables\n   * @param olGeometry Ol linestring or polygon\n   * @param measure Measure\n   */\n  private updateMeasureOfOlGeometry(olGeometry: OlLineString | OlPolygon, measure: Measure) {\n    olGeometry.setProperties({_measure: measure}, true);\n    this.updateTooltipsOfOlGeometry(olGeometry);\n  }\n\n  /**\n   * Clear the measures observables\n   */\n  private clearMeasures() {\n    this.measure$.next({});\n  }\n\n  /**\n   * Add a feature with measures to the store. The loading stragegy of the store\n   * will trigger and add the feature to the map.\n   * @internal\n   */\n  private addFeatureToStore(olGeometry, localFeature?: FeatureWithMeasure) {\n    const featureId = localFeature ? localFeature.properties.id : olGeometry.ol_uid;\n    const projection = this.map.ol.getView().getProjection();\n    const geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n      featureProjection: projection,\n      dataProjection: projection\n    }) as any;\n    this.store.update({\n      type: FEATURE,\n      geometry,\n      projection: projection.getCode(),\n      properties: {\n        id: featureId,\n        measure: olGeometry.get('_measure')\n      },\n      meta: {\n        id: featureId\n      }\n    });\n  }\n\n  /**\n   * Update all the tooltips of an OL geometry\n   * @param olGeometry OL Geometry\n   * @param lengths Lengths of the OL geometry's segments\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    const measure = olGeometry.get('_measure');\n    const lengths = measure.lengths;\n    const area = measure.area;\n\n    const olMidpointsTooltips = updateOlTooltipsAtMidpoints(olGeometry);\n    if (lengths.length === olMidpointsTooltips.length) {\n      for (let i = 0; i < olMidpointsTooltips.length; i++) {\n        const length = lengths[i];\n        if (length !== undefined) {\n          this.updateOlTooltip(\n            olMidpointsTooltips[i],\n            metersToUnit(length, this.activeLengthUnit),\n            this.activeLengthUnit,\n            MeasureType.Length\n          );\n        }\n      }\n    }\n\n    if (area !== undefined) {\n      this.updateOlTooltip(\n        updateOlTooltipAtCenter(olGeometry),\n        squareMetersToUnit(area, this.activeAreaUnit),\n        this.activeAreaUnit,\n        MeasureType.Area\n      );\n    }\n  }\n\n  /**\n   * Show the map tooltips of a geoemtry\n   */\n  private showTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\n      if (this.shouldShowTooltip(olTooltip)) {\n        this.map.ol.addOverlay(olTooltip);\n      }\n    });\n  }\n\n  /**\n   * Clear the tooltips of an OL geometrys\n   * @param olGeometry OL geometry with tooltips\n   */\n  private clearTooltipsOfOlGeometry(olGeometry: OlLineString | OlPolygon) {\n    getTooltipsOfOlGeometry(olGeometry).forEach((olTooltip: OlOverlay | undefined) => {\n      if (olTooltip !== undefined && olTooltip.getMap() !== undefined) {\n        this.map.ol.removeOverlay(olTooltip);\n      }\n    });\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private updateTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      this.updateTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Show the map tooltips of all the geometries of a source\n   */\n  private showTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      this.showTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n    });\n  }\n\n  /**\n   * Clear the map tooltips\n   * @param olDrawSource OL vector source\n   */\n  private clearTooltipsOfOlSource(olSource: OlVectorSource<OlGeometry>) {\n    olSource.forEachFeature((olFeature: OlFeature<OlGeometry>) => {\n      const olGeometry = olFeature.getGeometry();\n      if (olGeometry !== undefined) {\n        this.clearTooltipsOfOlGeometry(olFeature.getGeometry() as any);\n      }\n    });\n  }\n\n  /**\n   * Update an OL tooltip properties and inner HTML and add it to the map if possible\n   * @param olTooltip OL tooltip\n   * @param measure The measure valeu ti display\n   * @param measureUnit Display tooltip measure in those units\n   */\n  private updateOlTooltip(\n    olTooltip: OlOverlay,\n    measure: number,\n    unit: MeasureAreaUnit | MeasureLengthUnit,\n    type: MeasureType\n  ) {\n    olTooltip.setProperties({_measure: measure, _unit: unit, _type: type}, true);\n    olTooltip.getElement().innerHTML = this.computeTooltipInnerHTML(olTooltip);\n    if (this.shouldShowTooltip(olTooltip)) {\n      this.map.ol.addOverlay(olTooltip);\n    }\n  }\n\n  /**\n   * Compute a tooltip's content\n   * @param olTooltip OL overlay\n   * @returns Inner HTML\n   */\n  private computeTooltipInnerHTML(olTooltip: OlOverlay): string {\n    const properties = olTooltip.getProperties() as any;\n    return formatMeasure(properties._measure, {\n      decimal: 1,\n      unit: properties._unit,\n      unitAbbr: true,\n      locale: 'fr'\n    }, this.languageService);\n  }\n\n  /**\n   * Whether a tooltip should be showned based on the length\n   * of the segment it is bound to.\n   * @param olTooltip OL overlay\n   * @returns True if the tooltip should be shown\n   */\n  private shouldShowTooltip(olTooltip: OlOverlay): boolean {\n    if (this.showTooltips === false) {\n      return false;\n    }\n\n    const properties = olTooltip.getProperties() as any;\n    const measure = properties._measure;\n    if (measure === undefined) {\n      return false;\n    }\n\n    if (properties._unit === MeasureType.Length) {\n      const minSegmentLength = metersToUnit(this.minSegmentLength, properties._unit) || 0;\n      return measure > Math.max(minSegmentLength, 0);\n    }\n\n    return true;\n  }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\nimport { MeasureAreaUnit, MeasureLengthUnit } from '../shared/measure.enum';\nimport { metersToUnit, squareMetersToUnit, formatMeasure } from '../shared/measure.utils';\n\n/**\n * This pipe returns a measure converted from meters (or square meters)\n * to the specified unit. It also keeps a certain number of decimals.\n */\n@Pipe({\n  name: 'measureFormat'\n})\nexport class MeasureFormatPipe implements PipeTransform {\n\n  /**\n   * @ignore\n   */\n  transform(\n    value: number, unit: MeasureAreaUnit | MeasureLengthUnit,\n    unitAbbr: boolean = false,\n    decimal: number = 1\n  ): number {\n    let out;\n    if (Object.values(MeasureAreaUnit).indexOf(unit as MeasureAreaUnit) >= 0) {\n      out = squareMetersToUnit(value, unit as MeasureAreaUnit);\n    } else if (Object.values(MeasureLengthUnit).indexOf(unit as MeasureLengthUnit) >= 0) {\n      out = metersToUnit(value, unit as MeasureLengthUnit);\n    }\n\n    return out ? formatMeasure(out, {\n      decimal: 1,\n      unit,\n      unitAbbr,\n      locale: 'fr'\n    }) : out;\n  }\n}\n","import { DrawControlOptions } from './../shared/controls/draw';\nimport {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  Optional,\n  Self,\n  ChangeDetectorRef,\n  ChangeDetectionStrategy\n} from '@angular/core';\nimport { NgControl, ControlValueAccessor } from '@angular/forms';\n\nimport { Subscription } from 'rxjs';\n\nimport * as OlStyle from 'ol/style';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlGeometry from 'ol/geom/Geometry';\nimport type { Type } from 'ol/geom/Geometry';\nimport OlFeature from 'ol/Feature';\nimport OlVectorSource from 'ol/source/Vector';\nimport OlVectorLayer from 'ol/layer/Vector';\nimport OlOverlay from 'ol/Overlay';\nimport * as olproj from 'ol/proj';\nimport Point from 'ol/geom/Point';\n\nimport { IgoMap } from '../../map';\nimport {\n  MeasureLengthUnit,\n  updateOlGeometryMidpoints,\n  formatMeasure,\n  measureOlGeometry\n} from '../../measure';\nimport { DrawControl, ModifyControl, ModifyControlOptions } from '../shared/controls';\nimport { createDrawInteractionStyle } from '../shared/geometry.utils';\nimport { GeoJSONGeometry } from '../shared/geometry.interfaces';\nimport OlCircle from 'ol/geom/Circle';\nimport OlLineString from 'ol/geom/LineString';\nimport OlPoint from 'ol/geom/Point';\nimport OlPolygon from 'ol/geom/Polygon';\n\n/**\n * This input allows a user to draw a new geometry or to edit\n * an existing one on a map. A text input is also displayed in the\n * form with some instructions.\n * This is still WIP.\n */\n@Component({\n  selector: 'igo-geometry-form-field-input',\n  templateUrl: './geometry-form-field-input.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class GeometryFormFieldInputComponent implements OnInit, OnDestroy, ControlValueAccessor {\n\n  private olOverlayLayer: OlVectorLayer<OlVectorSource<OlGeometry>>;\n  private olGeoJSON = new OlGeoJSON();\n  private ready = false;\n\n  private drawControl: DrawControl;\n  private modifyControl: ModifyControl;\n  private defaultDrawStyleRadius: number;\n  private olGeometryEnds$$: Subscription;\n  private olGeometryChanges$$: Subscription;\n  private olTooltip = this.createMeasureTooltip();\n\n  /**\n   * Active control\n   * @internal\n   */\n  public activeControl: DrawControl | ModifyControl;\n\n  /**\n   * The map to draw the geometry on\n   */\n  @Input() map: IgoMap;\n\n  /**\n   * The geometry type\n   */\n  @Input()\n  set geometryType(value: Type) {\n    this._geometryType = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get geometryType(): Type { return this._geometryType; }\n  private _geometryType: Type;\n\n  /**\n   * The drawGuide around the mouse pointer to help drawing\n   */\n  @Input() drawGuide: number = null;\n\n  /**\n   * Whether a measure tooltip should be displayed\n   */\n  @Input() measure: boolean = false;\n\n  /**\n   * Whether draw control should be active or not\n   */\n  @Input()\n  get drawControlIsActive(): boolean { return this._drawControlIsActive; }\n  set drawControlIsActive(value: boolean) {\n    this._drawControlIsActive = value;\n    if (this.ready === false) {\n      return;\n    }\n    this.deactivateControl();\n    if (!this._drawControlIsActive) {\n      return;\n    } else {\n      this.toggleControl();\n    }\n  }\n  private _drawControlIsActive: boolean = true;\n\n  /**\n   * Whether freehand draw control should be active or not\n   */\n  @Input()\n  get freehandDrawIsActive(): boolean { return this._freehandDrawIsActive; }\n  set freehandDrawIsActive(value: boolean) {\n    this._freehandDrawIsActive = value;\n    this.deactivateControl();\n\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n\n    if (this.ready === false) {\n      return;\n    }\n\n    if (!this.drawControlIsActive) {\n      return;\n    }\n    this.toggleControl();\n  }\n  private _freehandDrawIsActive: boolean;\n\n  /**\n   * Whether freehand draw control should be active or not\n   */\n  @Input()\n  get predefinedRadius(): boolean { return this._predefinedRadius; }\n  set predefinedRadius(value: boolean) {\n    this._predefinedRadius = value;\n    this.drawControl.ispredefinedRadius$.next(value);\n  }\n  private _predefinedRadius: boolean;\n\n  /**\n   * Control options\n   */\n  @Input() controlOptions: {[key: string]: any} = {};\n\n  /**\n   * Style for the draw control (applies while the geometry is being drawn)\n   */\n  @Input()\n  set drawStyle(value: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle) {\n    if (value === undefined) {\n      value = createDrawInteractionStyle();\n    }\n    this._drawStyle = value;\n\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(value) as OlStyle.Circle;\n    if (olGuideStyle !== undefined) {\n      this.defaultDrawStyleRadius = olGuideStyle.getRadius();\n    } else {\n      this.defaultDrawStyleRadius = null;\n    }\n\n    if (this.ready === false) {\n      return;\n    }\n\n    this.deactivateControl();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    this.drawControl.freehand$.next(this.freehandDrawIsActive);\n    this.toggleControl();\n  }\n  get drawStyle(): OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle { return this._drawStyle; }\n  private _drawStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle;\n\n  /**\n   * Style for the overlay layer (applies once the geometry is added to the map)\n   * If not specified, drawStyle applies\n   */\n  @Input()\n  set overlayStyle(value: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle) { this._overlayStyle = value; }\n  get overlayStyle(): OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle { return this._overlayStyle; }\n  private _overlayStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle;\n\n  /**\n   * The geometry value (GeoJSON)\n   * Implemented as part of ControlValueAccessor.\n   */\n  @Input()\n  set value(value: GeoJSONGeometry) {\n    this._value = value;\n    if (this.ready === false) {\n      return;\n    }\n\n    if (value) {\n      this.addGeoJSONToOverlay(value);\n    } else {\n      this.olOverlaySource.clear(true);\n    }\n    this.onChange(value);\n    this.toggleControl();\n    this.cdRef.detectChanges();\n  }\n  get value(): GeoJSONGeometry { return this._value; }\n  private _value: GeoJSONGeometry;\n\n  /**\n   * The vector source to add the geometry to\n   * @internal\n   */\n  get olOverlaySource(): OlVectorSource<OlGeometry> {\n    return this.olOverlayLayer.getSource();\n  }\n\n  @Input()\n  set radius(value: any) {\n    if (this.ready === false) {\n      return;\n    }\n    if (this.modifyControl.getSource()) {\n      this.modifyControl.getSource().refresh();\n    }\n    if (this.freehandDrawIsActive) {\n      let olModify;\n      setTimeout(() => {\n        olModify = this.modifyControl.olModifyInteraction;\n        if (olModify) {\n          if (olModify.features_) {\n            olModify.features_.clear();\n            this.addGeoJSONToOverlay(this.value);\n          }\n        }\n      }, 0);\n    }\n  }\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    @Optional() @Self() public ngControl: NgControl\n  ) {\n    if (this.ngControl !== undefined) {\n      // Setting the value accessor directly (instead of using\n      // the providers) to avoid running into a circular import.\n      this.ngControl.valueAccessor = this;\n    }\n  }\n\n  /**\n   * Create an overlay layer, add the initial geometry to it (if any)\n   * and toggle the right interaction.\n   * @internal\n   */\n  ngOnInit() {\n    if (this.drawStyle === undefined) {\n      this.drawStyle = createDrawInteractionStyle();\n    }\n\n    if (this.overlayStyle === undefined) {\n      this.overlayStyle = this.drawStyle;\n    }\n\n    this.addOlOverlayLayer();\n    this.createDrawControl();\n    this.createModifyControl();\n\n    if (this.value) {\n      this.addGeoJSONToOverlay(this.value);\n    }\n    this.toggleControl();\n\n    this.ready = true;\n  }\n\n  /**\n   * Clear the overlay layer and any interaction added by this component.\n   * @internal\n   */\n  ngOnDestroy() {\n    // This is mandatory when the form control is reused after\n    // this component has been destroyed. It seems like the control\n    // keeps a reference to this component even after it's destroyed\n    // and it attempts to set it's value\n    this.ready = false;\n\n    this.deactivateControl();\n    this.olOverlaySource.clear();\n    this.map.ol.removeLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  registerOnChange(fn: Function) {\n    this.onChange = fn;\n  }\n  private onChange: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  // eslint-disable-next-line @typescript-eslint/ban-types\n  registerOnTouched(fn: Function) {\n    this.onTouched = fn;\n  }\n  private onTouched: any = () => {};\n\n  /**\n   * Implemented as part of ControlValueAccessor.\n   */\n  writeValue(value: GeoJSONGeometry) {\n    this.value = value;\n  }\n\n  /**\n   * Add an overlay layer to the map\n   */\n  private addOlOverlayLayer() {\n    this.olOverlayLayer = new OlVectorLayer({\n      source: new OlVectorSource(),\n      zIndex: 500,\n      style: null\n    });\n    this.map.ol.addLayer(this.olOverlayLayer);\n  }\n\n  /**\n   * Create a draw control and subscribe to it's geometry\n   */\n  private createDrawControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      geometryType: this.geometryType || 'Point',\n      drawingLayer: this.olOverlayLayer,\n      interactionStyle: typeof this.drawStyle === 'function' ? this.drawStyle : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n        const style = this.drawStyle;\n        this.updateDrawStyleWithDrawGuide(style, resolution);\n        return style;\n      }\n    }) as DrawControlOptions;\n    this.drawControl = new DrawControl(controlOptions);\n  }\n\n  /**\n   * Create a modify control and subscribe to it's geometry\n   */\n  private createModifyControl() {\n    const controlOptions = Object.assign({}, this.controlOptions, {\n      layer: this.olOverlayLayer,\n      drawStyle: typeof this.drawStyle === 'function' ? this.drawStyle : (olFeature: OlFeature<OlGeometry>, resolution: number) => {\n        const style = this.drawStyle;\n        this.updateDrawStyleWithDrawGuide(style, resolution);\n        return style;\n      }\n    }) as ModifyControlOptions;\n    this.modifyControl = new ModifyControl(controlOptions);\n  }\n\n  /**\n   * Toggle the proper control (draw or modify)\n   */\n  private toggleControl() {\n    let activate;\n    if (!this.value && this.geometryType) {\n      activate = this.drawControl;\n    } else {\n      activate = this.modifyControl;\n    }\n\n    // If the control that should be activated\n    // is not the same as the current active control,\n    // deactivate the current control and activate the new one\n    // Otherwise, do nothing and keep the current control active\n    if (activate !== this.activeControl) {\n      this.deactivateControl();\n      this.activateControl(activate);\n    }\n  }\n\n  /**\n   * Activate a given control\n   * @param control Control\n   */\n  private activateControl(control: DrawControl | ModifyControl) {\n    this.activeControl = control;\n    this.olGeometryEnds$$ = control.end$\n      .subscribe((olGeometry: OlGeometry) => this.onOlGeometryEnds(olGeometry));\n    if (this.measure === true && control === this.drawControl) {\n      this.olGeometryChanges$$ = control.changes$\n        .subscribe((olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) => this.onOlGeometryChanges(olGeometry));\n    }\n    control.setOlMap(this.map.ol, false);\n  }\n\n  /**\n   * Deactivate the active control\n   */\n  private deactivateControl() {\n    this.removeMeasureTooltip();\n    if (this.activeControl !== undefined) {\n      this.activeControl.setOlMap(undefined);\n    }\n    if (this.olGeometryEnds$$ !== undefined) {\n      this.olGeometryEnds$$.unsubscribe();\n    }\n    if (this.olGeometryChanges$$ !== undefined) {\n      this.olGeometryChanges$$.unsubscribe();\n    }\n    this.activeControl = undefined;\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryEnds(olGeometry: OlGeometry | undefined) {\n    this.removeMeasureTooltip();\n    this.setOlGeometry(olGeometry);\n  }\n\n  /**\n   * Update measures observables and map tooltips\n   * @param olGeometry Ol linestring or polygon\n   */\n  private onOlGeometryChanges(olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) {\n    if (olGeometry.getType() !== 'Point') {\n      this.updateMeasureTooltip(olGeometry);\n    }\n  }\n\n  /**\n   * When drawing ends, convert the output value to GeoJSON and keep it.\n   * Restore the double click interaction.\n   * @param olGeometry OL geometry\n   */\n  private setOlGeometry(olGeometry: OlGeometry | undefined) {\n    let value;\n    if (olGeometry === undefined) {\n      return;\n    }\n\n    if (olGeometry.getType() === 'Circle') { // Because Circle doesn't exist as a GeoJSON object\n      olGeometry = this.circleToPoint(olGeometry);\n    }\n\n    value = this.olGeoJSON.writeGeometryObject(olGeometry, {\n      featureProjection: this.map.projection,\n      dataProjection: 'EPSG:4326'\n    });\n    if (olGeometry.get('radius')) {\n      value.radius = olGeometry.get('radius');\n      olGeometry.set('radius', value.radius);\n    }\n    this.writeValue(value);\n  }\n\n  private circleToPoint(olGeometry) {\n    const center = olGeometry.getCenter();\n    const coordinates = olproj.transform(center, this.map.projection, 'EPSG:4326');\n    const radius = Math.round(olGeometry.getRadius() * (Math.cos((Math.PI / 180) * coordinates[1])));\n\n    // Convert it to a point object\n    olGeometry = new Point(center);\n    olGeometry.set('radius', radius, true);\n    return olGeometry;\n  }\n\n  /**\n   * Add a GeoJSON geometry to the overlay\n   * @param geometry GeoJSON geometry\n   */\n  private addGeoJSONToOverlay(geometry: GeoJSONGeometry) {\n    const olGeometry = this.olGeoJSON.readGeometry(geometry, {\n      dataProjection: 'EPSG:4326',\n      featureProjection: this.map.projection\n    });\n    const olFeature = new OlFeature({\n      geometry: olGeometry\n    });\n    olFeature.setStyle(this.overlayStyle as OlStyle.Style);\n    this.olOverlaySource.clear();\n    this.olOverlaySource.addFeature(olFeature);\n  }\n\n  /**\n   * Create the measure tooltip\n   */\n  private createMeasureTooltip() {\n    return new OlOverlay({\n      element: document.createElement('div'),\n      offset: [-30, -10],\n      className: [\n        'igo-map-tooltip',\n        'igo-map-tooltip-measure'\n      ].join(' '),\n      stopEvent: false\n    });\n  }\n\n  /**\n   * Update the measure tooltip of an OL geometry\n   * @param olGeometry OL Geometry\n   */\n  private updateMeasureTooltip(olGeometry: OlPolygon | OlPoint | OlLineString | OlCircle) {\n    const measure = measureOlGeometry(olGeometry, this.map.projection);\n    const lengths = measure.lengths;\n    const lastIndex = olGeometry.getType() === 'Polygon' ? lengths.length - 2 : lengths.length - 1;\n    const lastLength = lengths[lastIndex];\n\n    const olMidpoints = updateOlGeometryMidpoints(olGeometry);\n    const olLastMidpoint = olMidpoints[lastIndex];\n    if (olMidpoints.length === 0 || olLastMidpoint === undefined) {\n      this.removeMeasureTooltip();\n      return;\n    }\n\n    this.olTooltip.setPosition(olLastMidpoint.getFlatCoordinates());\n\n    const innerHtml = formatMeasure(lastLength, {\n      decimal: 1,\n      unit: MeasureLengthUnit.Meters,\n      unitAbbr: true,\n      locale: 'fr'\n    });\n    this.olTooltip.getElement().innerHTML = innerHtml;\n    if (this.olTooltip.getMap() === undefined) {\n      this.map.ol.addOverlay(this.olTooltip);\n    }\n  }\n\n  /**\n   * Remove the measure tooltip from the map\n   */\n  private removeMeasureTooltip() {\n    if (this.olTooltip.getMap && this.olTooltip.getMap() !== undefined) {\n      this.map.ol.removeOverlay(this.olTooltip);\n      this.olTooltip.setMap(undefined);\n    }\n  }\n\n  /**\n   * Adjust the draw style with the specified draw guide distance, if possible\n   * @param olStyle Draw style to update\n   * @param resolution Resolution (to make the screen size of symbol fit the drawGuide value)\n   */\n  private updateDrawStyleWithDrawGuide(\n    olStyle: OlStyle.Style |\n    ((feature, resolution) => OlStyle.Style) |\n    OlStyle.Circle,\n    resolution: number) {\n    const olGuideStyle = this.getGuideStyleFromDrawStyle(olStyle) as OlStyle.Circle;\n    if (olGuideStyle === undefined) {\n      return;\n    }\n\n    const drawGuide = this.drawGuide;\n    let radius;\n    if (!drawGuide || drawGuide < 0) {\n      radius = this.defaultDrawStyleRadius;\n    } else {\n      radius = drawGuide > 0 ? drawGuide / resolution : drawGuide;\n    }\n    olGuideStyle.setRadius(radius);\n  }\n\n  /**\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\n   * @param olStyle The style on which to perform the check\n   */\n  private isStyleWithRadius(olStyle) {\n    return typeof olStyle !== 'function' && olStyle.setRadius;\n  }\n\n  /**\n   * Returns wether a given Open Layers style has a radius property that can be set (used to set draw guide)\n   * @param olStyle The style on which to perform the check\n   */\n  private getGuideStyleFromDrawStyle(\n    olStyle: OlStyle.Style | ((feature, resolution) => OlStyle.Style) | OlStyle.Circle |\n    OlStyle.Style[] | ((feature, resolution) => OlStyle.Style)[] | OlStyle.Circle[]\n  ) {\n    if (Array.isArray(olStyle)) {\n      olStyle = olStyle[0];\n    }\n    if (this.isStyleWithRadius(olStyle)) {\n      return olStyle;\n    }\n    return undefined;\n  }\n}\n","<ng-template></ng-template>","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { GeometryFormFieldComponent } from './geometry-form-field.component';\nimport { GeometryFormFieldInputComponent } from './geometry-form-field-input.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    IgoLanguageModule\n  ],\n  exports: [\n    GeometryFormFieldComponent,\n    GeometryFormFieldInputComponent\n  ],\n  declarations: [\n    GeometryFormFieldComponent,\n    GeometryFormFieldInputComponent\n  ]\n})\nexport class IgoGeometryFormFieldModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoGeometryFormFieldModule } from './geometry-form-field/geometry-form-field.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoGeometryFormFieldModule\n  ],\n  exports: [\n    IgoGeometryFormFieldModule\n  ],\n  declarations: [],\n  providers: []\n})\nexport class IgoGeometryModule {}\n","<button *ngIf=\"header && options.timeFilterable && options.timeFilter\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\">\n  <mat-icon [matBadge]=\"badge\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" svgIcon=\"history\"></mat-icon>\n</button>\n\n<div #ogcFilter class=\"igo-layer-actions-container\"\n*ngIf=\"header && options.timeFilterable && options.timeFilter\">\n  <igo-time-filter-item\n    *ngIf=\"timeFilterCollapse && options.timeFilter\"\n    igoListItem\n    [header]=\"false\"\n    [layer]=\"layer\">\n  </igo-time-filter-item>\n</div>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\nimport { TimeFilterableDataSourceOptions } from '../shared/time-filter.interface';\nimport { WMSDataSourceOptions } from '../../datasource/shared/datasources/wms-datasource.interface';\n\n@Component({\n  selector: 'igo-time-filter-button',\n  templateUrl: './time-filter-button.component.html',\n  styleUrls: ['./time-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TimeFilterButtonComponent implements OnInit {\n\n  public options: TimeFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.timeFilter as any;\n    if (filter && filter.enabled) {\n      return 1;\n    } else {\n      return;\n    }\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: IgoMap;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean = true;\n\n  public timeFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource.options as WMSDataSourceOptions;\n  }\n}\n","<div *ngIf=\"style === 'calendar' && type !=='year'\">\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n    <mat-form-field>\n      <mat-datetimepicker-toggle class=\"time-filter-mat-datetimepicker-toggle\" [for]=\"datetimePicker\" matSuffix></mat-datetimepicker-toggle>\n      <mat-datetimepicker #datetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n      <input matInput autocomplete=\"false\"\n        placeholder=\"{{'igo.geo.timeFilter.date' | translate}}\"\n        [matDatetimepicker]=\"datetimePicker\"\n        [(ngModel)]=\"date\"\n        [min]=\"min\"\n        [max]=\"max\"\n        readonly=\"readonly\"\n        (dateChange)=\"handleDateChange($event)\">\n    </mat-form-field>\n\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle class=\"time-filter-mat-datetimepicker-toggle\" [for]=\"minDatetimePicker\" matSuffix></mat-datetimepicker-toggle>\n        <mat-datetimepicker #minDatetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n        <input matInput autocomplete=\"false\"\n          placeholder=\"{{'igo.geo.timeFilter.startDate' | translate}}\"\n          [matDatetimepicker]=\"minDatetimePicker\"\n          [(ngModel)]=\"startDate\"\n          [min]=\"min\"\n          [max]=\"getRangeMaxDate()\"\n          readonly=\"readonly\"\n          (input)=\"startDate\"\n          (dateChange)=\"handleDateChange($event)\">\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n      <mat-form-field>\n        <mat-datetimepicker-toggle class=\"time-filter-mat-datetimepicker-toggle\" [for]=\"maxDatetimePicker\" matSuffix></mat-datetimepicker-toggle>\n        <mat-datetimepicker #maxDatetimePicker type=\"{{type}}\" openOnFocus=\"true\" timeInterval=\"5\"></mat-datetimepicker>\n        <input matInput autocomplete=\"false\"\n          placeholder=\"{{'igo.geo.timeFilter.endDate' | translate}}\"\n          [matDatetimepicker]=\"maxDatetimePicker\"\n          [(ngModel)]=\"endDate\"\n          [min]=\"getRangeMinDate()\"\n          [max]=\"max\"\n          readonly=\"readonly\"\n          (dateChange)=\"handleDateChange($event)\">\n      </mat-form-field>\n    </div>\n  </div>\n</div>\n\n<div *ngIf=\"style === 'calendar' && type ==='year'\">\n\n  <div *ngIf=\"!isRange\" class=\"igo-col igo-col-100 igo-col-100-m\">\n        <mat-form-field>\n            <mat-select placeholder=\"{{'igo.geo.timeFilter.date' | translate}}\" [(ngModel)]=\"year\" (selectionChange)=\"handleYearChange($event)\">\n                  <mat-option [value]=\"year\" *ngFor=\"let year of listYears\">{{year}}</mat-option>\n            </mat-select>\n        </mat-form-field>\n  </div>\n\n  <div *ngIf=\"isRange\">\n    <div class=\"igo-col igo-col-100\">\n        <mat-form-field>\n            <mat-select placeholder=\"{{'igo.geo.timeFilter.startDate' | translate}}\" [(ngModel)]=\"startYear\" (selectionChange)=\"handleYearChange($event)\">\n              <mat-option [value]=\"startYear\" *ngFor=\"let startYear of startListYears\">{{startYear}}</mat-option>\n            </mat-select>\n      </mat-form-field>\n    </div>\n\n    <div class=\"igo-col igo-col-100\">\n    <mat-form-field>\n        <mat-select placeholder=\"{{'igo.geo.timeFilter.endDate' | translate}}\" [(ngModel)]=\"endYear\" (selectionChange)=\"handleYearChange($event)\">\n              <mat-option [value]=\"endYear\" *ngFor=\"let endYear of endListYears\">{{endYear}}</mat-option>\n        </mat-select>\n      </mat-form-field>\n    </div>\n  </div>\n\n</div>\n\n\n  <br>\n  <div *ngIf=\"!isRange && style === 'slider' && type === 'year'\" class=\"igo-col igo-col-100 igo-col-100-m mat-typography\">\n    <span>{{startYear}}</span>\n    <mat-slider\n        id=\"time-slider\"\n        tickInterval=\"auto\"\n        step=\"{{step}}\"\n        [min]=\"startYear\"\n        [max]=\"endYear\"\n        [value]=\"handleSliderValue()\"\n        [color]=\"color\"\n        thumbLabel\n        (input)=\"handleSliderYearChange($event)\"\n        (change)=\"handleSliderYearChange($event)\"\n        [disabled]= \"!options.enabled || !layer.visible\">\n    </mat-slider>\n    <span>{{endYear}}</span>\n    <p *ngIf= \"options.enabled\" class=\"date-below\">{{year}}</p>\n    <div #actions class=\"igo-layer-actions-container\">\n      <mat-slide-toggle (change)=\"toggleFilterState()\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" [color]=\"color\" [checked]=\"options.enabled\"\n        [disabled]=\"!layer.visible\">\n      </mat-slide-toggle>\n      <button [disabled]= \"!options.enabled  || !layer.visible\" mat-icon-button color=\"primary\" (click)=\"playYear($event)\">\n        <mat-icon svgIcon=\"{{playIcon}}\"></mat-icon>\n       </button>\n      <button [disabled]=\"!options.enabled  || !layer.visible\" mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n      </button>\n    </div>\n  </div>\n\n<div *ngIf=\"style === 'slider' && type !== 'year'\" class=\"igo-col igo-col-100 igo-col-100-m\">\n  <mat-slider\n      id=\"time-slider\"\n      tickInterval=\"auto\"\n      step=\"{{step}}\"\n      [min]=\"dateToNumber(min)\"\n      [max]=\"dateToNumber(max)\"\n      [value]=\"handleSliderValue()\"\n      thumbLabel\n      (input)=\"handleSliderDateChange($event)\"\n      (selectionChange)=\"handleSliderDateChange($event)\">\n  </mat-slider>\n  <p class=\"date-below\">{{handleSliderTooltip()}}</p>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n   <mat-icon svgIcon=\"{{playIcon}}\"></mat-icon>\n  </button>\n</div>\n","import {\n  Component,\n  OnInit,\n  Input,\n  Output,\n  EventEmitter,\n  ViewChild\n} from '@angular/core';\nimport { DateAdapter } from '@angular/material/core';\nimport { MatSlider } from '@angular/material/slider';\nimport { default as moment } from 'moment';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterOptions } from '../shared/time-filter.interface';\nimport { TimeFilterType, TimeFilterStyle } from '../shared/time-filter.enum';\n\n@Component({\n  selector: 'igo-time-filter-form',\n  templateUrl: './time-filter-form.component.html',\n  styleUrls: ['./time-filter-form.component.scss']\n})\nexport class TimeFilterFormComponent implements OnInit {\n  @Input() layer: Layer;\n\n  @Input() options: TimeFilterOptions;\n\n  public color = 'primary';\n  public date: Date;\n  public startDate: Date;\n  public endDate: Date;\n  public year: any;\n  public startYear: any;\n  public endYear: any;\n  public initStartYear: any;\n  public initEndYear: any;\n  public listYears: Array<string> = [];\n  public startListYears: Array<string> = [];\n  public endListYears: Array<string> = [];\n\n  @Input()\n  set currentValue(value: string) {\n    if (value) {\n      if (this.type !== TimeFilterType.YEAR) {\n        const valueArray = value.split('/');\n        if (valueArray.length > 0) {\n          const startDate = new Date(valueArray[0]);\n          const endDate = new Date(valueArray[1]);\n          if (!isNaN(startDate.valueOf())) {\n            this.startDate = startDate;\n          }\n          if (!isNaN(endDate.valueOf())) {\n            this.endDate = endDate;\n          }\n        }\n      }\n    }\n  }\n\n  public interval: any;\n  public playIcon = 'play-circle';\n  public resetIcon = 'replay';\n\n  @Output() change: EventEmitter<Date | [Date, Date]> = new EventEmitter();\n  @Output()\n  yearChange: EventEmitter<string | [string, string]> = new EventEmitter();\n  @ViewChild(MatSlider) mySlider;\n\n  get type(): TimeFilterType {\n    return this.options.type === undefined\n      ? TimeFilterType.DATE\n      : this.options.type;\n  }\n\n  get isRange(): boolean {\n    return this.options.range === undefined ||\n      this.options.style === TimeFilterStyle.SLIDER\n      ? false\n      : this.options.range;\n  }\n\n  get style(): TimeFilterStyle {\n    return this.options.style === undefined\n      ? TimeFilterStyle.SLIDER\n      : this.options.style;\n  }\n\n  get step(): number {\n    let step = 10800000;\n    if (this.options.step === undefined) {\n      switch (this.type) {\n        case TimeFilterType.DATE:\n        case TimeFilterType.DATETIME:\n          step = 10800000;\n          break;\n        case TimeFilterType.TIME:\n          step = 3600000;\n          break;\n        case TimeFilterType.YEAR:\n          step = 31536000000;\n          break;\n        default:\n          step = 10800000;\n      }\n    } else {\n      step = this.getStepDefinition(this.options.step);\n    }\n\n    return step;\n  }\n\n  get timeInterval(): number {\n    return this.options.timeInterval === undefined\n      ? 2000\n      : this.options.timeInterval;\n  }\n\n  get min(): Date {\n    if (this.options.min) {\n      const min = new Date(this.options.min);\n      return new Date(min.getTime() + min.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get max(): Date {\n    if (this.options.max) {\n      const max = new Date(this.options.max);\n      return new Date(max.getTime() + max.getTimezoneOffset() * 60000);\n    } else {\n      return undefined;\n    }\n  }\n\n  get is(): boolean {\n    return this.options.range === undefined ? false : this.options.range;\n  }\n\n  constructor(private dateAdapter: DateAdapter<Date>) {\n    this.dateAdapter.setLocale('fr');\n  }\n\n  ngOnInit() {\n    if (this.startDate === undefined) {\n      this.startDate = new Date(this.min);\n    }\n    if (this.endDate === undefined) {\n      this.endDate = new Date(this.max);\n    }\n    if (this.startYear === undefined) {\n      this.startYear = new Date(this.startDate).getFullYear();\n      this.initStartYear = this.startYear;\n    }\n    if (this.endYear === undefined) {\n      this.endYear = new Date(this.endDate).getFullYear();\n      this.initEndYear = this.endYear;\n    }\n\n    if (!this.isRange) {\n      for (let i = this.startYear; i <= this.endYear + 1; i++) {\n        this.listYears.push(i);\n      }\n    } else {\n      for (let i = this.startYear; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      for (let i = this.startYear + 1; i <= this.endYear; i++) {\n        this.endListYears.push(i);\n      }\n    }\n    this.options.enabled =\n      this.options.enabled === undefined ? true : this.options.enabled;\n    this.checkFilterValue();\n    if (this.options.enabled) {\n      if (!this.isRange && this.style === 'slider' && this.type === 'year') {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.storeCurrentFilterValue();\n      this.yearChange.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  storeCurrentFilterValue() {\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.options.value = this.year.toString();\n    }\n  }\n\n  checkFilterValue() {\n    const olSource = this.layer.dataSource.ol as olSourceImageWMS;\n    const timeFromWms = olSource.getParams().TIME;\n    if (\n      !this.isRange &&\n      this.style === TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.year = new Date(timeFromWms.toString()).getFullYear() + 1;\n      } else if (this.options.value) {\n        this.year = new Date(this.options.value.toString()).getFullYear() + 1;\n      } else {\n        this.year = new Date(this.min).getFullYear() + 1;\n      }\n    } else if (\n      this.isRange &&\n      this.style === TimeFilterStyle.CALENDAR &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      if (timeFromWms) {\n        this.startYear = parseInt(timeFromWms.substr(0, 4), 10);\n        this.endYear = parseInt(timeFromWms.substr(5, 4), 10);\n        const newStartListYears: any[] = [];\n        const newEndListYears: any[] = [];\n        for (let i = this.initStartYear; i < this.endYear; i++) {\n          newStartListYears.push(i);\n        }\n        for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n          newEndListYears.push(i);\n        }\n        this.startListYears = newStartListYears;\n        this.endListYears = newEndListYears;\n      }\n    }\n    // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n  }\n\n  handleDateChange(event: any) {\n    this.setupDateOutput();\n    this.applyTypeChange();\n\n    // Only if is range, use 2 dates to make the range\n    if (this.isRange) {\n      this.change.emit([this.startDate, this.endDate]);\n    } else {\n      this.change.emit(this.startDate);\n    }\n  }\n\n  handleYearChange(event: any) {\n    if (this.isRange) {\n      this.endListYears = [];\n      for (let i = this.startYear + 1; i <= this.initEndYear; i++) {\n        this.endListYears.push(i);\n      }\n      this.startListYears = [];\n      for (let i = this.initStartYear + 1; i < this.endYear; i++) {\n        this.startListYears.push(i);\n      }\n      this.yearChange.emit([this.startYear, this.endYear]);\n    } else {\n      this.yearChange.emit(this.year);\n    }\n  }\n\n  handleListYearChange(event: any) {\n    this.handleYearChange([this.startYear, this.endYear]);\n  }\n\n  handleListYearStartChange(event: any) {\n    this.change.emit([this.startDate, this.endDate]);\n  }\n\n  dateToNumber(date: Date): number {\n    let newDate;\n    if (date) {\n      newDate = new Date(date);\n    } else {\n      newDate = new Date(this.min);\n    }\n\n    return newDate.getTime();\n  }\n\n  setSliderThumbLabel(label: string) {\n    const thumbLabel = this.findThumbLabel(\n      this.mySlider._elementRef.nativeElement.childNodes\n    );\n    if (thumbLabel) {\n      thumbLabel.textContent = label;\n    }\n  }\n\n  findThumbLabel(test: any[]): any {\n    let thumbLabel;\n\n    test.forEach(value => {\n      if (value.className === 'mat-slider-thumb-label-text') {\n        thumbLabel = value;\n      }\n\n      if (value.children.length > 0 && !thumbLabel) {\n        thumbLabel = this.findThumbLabel(value.childNodes);\n      }\n    }, this);\n    return thumbLabel;\n  }\n\n  toggleFilterState() {\n    this.options.enabled = !this.options.enabled;\n\n    if (this.options.enabled) {\n      if (\n        !this.isRange &&\n        TimeFilterStyle.SLIDER &&\n        this.type === TimeFilterType.YEAR\n      ) {\n        this.yearChange.emit(this.year);\n      }\n    } else {\n      this.stopFilter();\n      this.storeCurrentFilterValue();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  resetFilter(event: any) {\n    this.date = new Date(this.min);\n    this.year = this.date.getFullYear();\n    if (\n      !this.isRange &&\n      TimeFilterStyle.SLIDER &&\n      this.type === TimeFilterType.YEAR\n    ) {\n      this.yearChange.emit(this.year);\n    } else {\n      this.setupDateOutput();\n      this.change.emit(undefined); // TODO: FIX THIS for ALL OTHER TYPES STYLES OR RANGE.\n    }\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(\n        that => {\n          let newMinDateNumber;\n          const maxDateNumber = new Date(that.max);\n\n          newMinDateNumber =\n            that.date === undefined ? that.min.getTime() : that.date.getTime();\n          newMinDateNumber += that.mySlider.step;\n          that.date = new Date(newMinDateNumber);\n\n          if (newMinDateNumber > maxDateNumber.getTime()) {\n            that.stopFilter();\n          }\n\n          that.handleDateChange({ value: that.date, date: that.date });\n        },\n        this.timeInterval,\n        this\n      );\n    }\n  }\n\n  playYear(event: any) {\n    if (\n      this.year + this.mySlider.step >\n      this.max.getFullYear() + this.mySlider.step\n    ) {\n      this.stopFilter();\n      this.resetFilter(event);\n    }\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(() => {\n        if (\n          (this.year + this.mySlider.step) > this.max.getFullYear()) {\n          this.stopFilter();\n        } else {\n          this.year = this.year + this.mySlider.step;\n        }\n        this.yearChange.emit(this.year);\n\n      }, this.timeInterval, this);\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n  }\n\n  handleSliderDateChange(event: any) {\n    this.date = new Date(event.value);\n    this.setSliderThumbLabel(this.handleSliderTooltip());\n    this.handleDateChange(event);\n  }\n\n  handleSliderYearChange(event: any) {\n    this.year = event.value;\n    this.yearChange.emit(this.year);\n  }\n\n  handleSliderValue(): number {\n    if (this.options.current === true || !this.min) {\n      const currentDate = new Date();\n      this.date = this.getRoundedDate(currentDate);\n    }\n    if (this.type === TimeFilterType.YEAR) {\n      return this.year;\n    } else {\n      return this.date === undefined ? this.min.getTime() : this.date.getTime();\n    }\n  }\n\n  handleSliderTooltip() {\n    let label: string;\n\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        label =\n          this.date === undefined\n            ? this.min.toDateString()\n            : this.date.toDateString();\n        break;\n      case TimeFilterType.TIME:\n        label =\n          this.date === undefined\n            ? this.min.toTimeString()\n            : this.date.toTimeString();\n        break;\n      // datetime\n      default:\n        label =\n          this.date === undefined\n            ? this.min.toUTCString()\n            : this.date.toUTCString();\n        break;\n    }\n\n    return label;\n  }\n\n  setupDateOutput() {\n    if (this.style === TimeFilterStyle.SLIDER) {\n      this.startDate = new Date(this.date);\n      this.startDate.setSeconds(-(this.step / 1000));\n      this.endDate = new Date(this.startDate);\n      this.endDate.setSeconds(this.step / 1000);\n    } else if (!this.isRange && !!this.date) {\n      this.endDate = new Date(this.date);\n      this.startDate = new Date(this.date);\n    } else if (this.isRange && (!!this.date || !this.date)) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    } else if (!this.date) {\n      this.startDate =\n        this.startDate === undefined ? new Date(this.min) : this.startDate;\n      this.endDate =\n        this.endDate === undefined ? new Date(this.max) : this.endDate;\n    }\n  }\n\n  applyTypeChange() {\n    switch (this.type) {\n      case TimeFilterType.DATE:\n        if (this.startDate !== undefined || this.endDate !== undefined) {\n          this.startDate.setHours(0);\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setHours(23);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      case TimeFilterType.TIME:\n        if (this.style === TimeFilterStyle.CALENDAR) {\n          if (this.startDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.startDate.getHours();\n            const selectedMinute = this.startDate.getMinutes();\n            this.startDate = this.min;\n            this.startDate.setHours(selectedHour);\n            this.startDate.setMinutes(selectedMinute);\n          }\n\n          if (this.endDate.getDay() !== this.min.getDay()) {\n            const selectedHour = this.endDate.getHours();\n            const selectedMinute = this.endDate.getMinutes();\n            this.endDate = this.min;\n            this.endDate.setHours(selectedHour);\n            this.endDate.setMinutes(selectedMinute);\n          }\n        }\n\n        if (!this.isRange && this.step > 60 * 60 * 1000) {\n          this.startDate.setMinutes(0);\n          this.startDate.setSeconds(0);\n          this.endDate.setMinutes(59);\n          this.endDate.setSeconds(59);\n        }\n        break;\n      // datetime\n      default:\n      // do nothing\n    }\n  }\n\n  getRangeMinDate(): Date {\n    return this.startDate === undefined ? this.min : this.startDate;\n  }\n\n  getRangeMaxDate(): Date {\n    return this.endDate === undefined ? this.max : this.endDate;\n  }\n\n  /**\n   * Round date at a certain time, 10 minutes by Default\n   * @param date - Date to Round\n   * @param atMinute - round to closest 'atMinute' minute, rounded 10 by default\n   * @return the rounded date\n   */\n  getRoundedDate(date, atMinute = 10) {\n    const coeff = 1000 * 60 * atMinute;\n    return new Date(Math.round(date.getTime() / coeff) * coeff);\n  }\n\n  /**\n   * Get the step (period) definition from the layer dimension tag\n   * @param step The step as ISO 8601 example: PT10M for 10 Minutes\n   * @return the duration in milliseconds\n   */\n  getStepDefinition(step) {\n    return moment.duration(step).asMilliseconds();\n  }\n}\n","<mat-list-item *ngIf=\"header\">\n  <mat-icon\n    class=\"igo-chevron\"\n    mat-list-avatar\n    igoCollapse\n    [target]=\"filters\"\n    [collapsed]=\"filtersCollapsed\"\n    (click)=\"toggleFiltersCollapsed()\"\n    svgIcon=\"chevron-up\" >\n  </mat-icon>\n  <h4 (click)=\"toggleLegendOnClick()\" [ngStyle]=\"{'cursor': filtersCollapsed ? 'default' : 'pointer'}\"  matLine>{{layer.title}}</h4>\n  \n  <button *ngIf=\"header\"\n    mat-icon-button\n    [color]=\"layer.visible ? 'primary' : 'default'\"\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"layer.visible ?\n                  ('igo.geo.layer.hideLayer' | translate) :\n                  ('igo.geo.layer.showLayer' | translate)\"\n    (click)=\"layer.visible = !layer.visible\">\n    <mat-icon\n      [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n      [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n    </mat-icon>\n  </button>\n\n</mat-list-item>\n\n<div #filters class=\"igo-datasource-filters-container\">\n  <div #legend class=\"igo-layer-legend-container\">\n    <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n    </igo-layer-legend>\n  </div>\n  <igo-time-filter-form\n    [layer]= \"layer\"\n    [options]=\"datasource.options.timeFilter\"\n    [currentValue]=\"datasource.options.params.TIME\"\n    (change)=\"handleDateChange($event)\"\n    (yearChange)=\"handleYearChange($event)\">\n  </igo-time-filter-form>\n</div>\n","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { TimeFilterableDataSource } from '../shared/time-filter.interface';\nimport { TimeFilterService } from '../shared/time-filter.service';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n@Component({\n  selector: 'igo-time-filter-item',\n  templateUrl: './time-filter-item.component.html',\n  styleUrls: ['./time-filter-item.component.scss']\n})\nexport class TimeFilterItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n\n  filtersCollapsed: boolean = false;\n\n  @Input() header: boolean = true;\n\n  @Input() layer: Layer;\n\n  get datasource(): TimeFilterableDataSource {\n    return this.layer.dataSource as TimeFilterableDataSource;\n  }\n  constructor(private timeFilterService: TimeFilterService) {}\n\n  ngOnInit(): void {\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  handleYearChange(year: string | [string, string]) {\n    this.timeFilterService.filterByYear(this.datasource, year);\n  }\n\n  handleDateChange(date: Date | [Date, Date]) {\n    this.timeFilterService.filterByDate(this.datasource, date);\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'time'\">\n    <igo-time-filter-item [header]=\"true\" igoListItem [layer]=\"layer\"></igo-time-filter-item>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\n\n@Component({\n  selector: 'igo-time-filter-list',\n  templateUrl: './time-filter-list.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class TimeFilterListComponent {\n  @Input()\n  get layers(): Layer[] {\n    return this._layers;\n  }\n  set layers(value: Layer[]) {\n    this._layers = value;\n    this.cdRef.detectChanges();\n  }\n  private _layers: Layer[] = [];\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n}\n","import { Injectable } from '@angular/core';\n\nimport * as olproj from 'ol/proj';\nimport olWKT from 'ol/format/WKT';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WktService {\n  constructor() {}\n\n  public wktToFeature(wkt, wktProj, featureProj) {\n    return new olWKT().readFeature(wkt, {\n      dataProjection: wktProj,\n      featureProjection: featureProj\n    });\n  }\n  public extentToWkt(epsgTO, extent, extentProj) {\n    let currentExtent = olproj.transformExtent(extent, extentProj, epsgTO);\n    currentExtent = this.roundCoordinateArray(currentExtent, epsgTO, 0);\n    const wktPoly = `POLYGON((\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]}))`;\n    const wktLine = `LINESTRING(\n      ${extent[0]} ${extent[1]},\n      ${extent[0]} ${extent[3]},\n      ${extent[2]} ${extent[3]},\n      ${extent[2]} ${extent[1]},\n      ${extent[0]} ${extent[1]})`;\n    const wktMultiPoints = `MULTIPOINT(\n        ${extent[0]} ${extent[1]},\n        ${extent[0]} ${extent[3]},\n        ${extent[2]} ${extent[3]},\n        ${extent[2]} ${extent[1]})`;\n    return {\n      wktPoly,\n      wktLine,\n      wktMultiPoints\n    };\n  }\n\n  private roundCoordinateArray(coordinateArray, projection, decimal = 0) {\n    const lproj = olproj.get(projection);\n    const units = lproj.getUnits();\n    const olUnits = ['ft', 'm', 'us-ft'];\n    if (olUnits.indexOf(units) !== -1) {\n      coordinateArray = this.roundArray(coordinateArray, decimal);\n    }\n    return coordinateArray;\n  }\n\n  private roundArray(array, decimal = 0) {\n    let x = 0;\n    while (x < array.length) {\n      array[x] = array[x].toFixed(decimal);\n      x++;\n    }\n    return array;\n  }\n\n  public snrcToWkt(snrc, epsgTO) {\n    snrc = snrc.toLowerCase();\n    let wktPoly;\n    const ew = {\n      1: { from: -56, to: -64 },\n      2: { from: -64, to: -72 },\n      3: { from: -72, to: -80 },\n      4: { from: -80, to: -88 },\n      5: { from: -88, to: -96 },\n      6: { from: -96, to: -104 },\n      7: { from: -104, to: -112 },\n      8: { from: -112, to: -120 },\n      9: { from: -120, to: -128 },\n      10: { from: -128, to: -136 }\n    };\n    const sn = {\n      1: { from: 44, to: 48 },\n      2: { from: 48, to: 52 },\n      3: { from: 52, to: 56 },\n      4: { from: 56, to: 60 },\n      5: { from: 60, to: 64 },\n      6: { from: 64, to: 68 },\n      7: { from: 68, to: 72 },\n      8: { from: 72, to: 76 },\n      9: { from: 76, to: -128 }\n    };\n    const snrc250kIndex = [\n      ['m', 'n', 'o', 'p'],\n      ['l', 'k', 'j', 'i'],\n      ['e', 'f', 'g', 'h'],\n      ['d', 'c', 'b', 'a']\n    ];\n\n    const snrc50kIndex = [\n      ['13', '14', '15', '16'],\n      ['12', '11', '10', '09'],\n      ['05', '06', '07', '08'],\n      ['04', '03', '02', '01']\n    ];\n    const checkSNRC50k = /\\d{2,3}[a-p][0,1][0-9]/gi;\n    const checkSNRC250k = /\\d{2,3}[a-p]/gi;\n    const checkSNRC1m = /\\d{2,3}/gi;\n\n    let snrc1m = false;\n    let snrc250k = false;\n    let snrc50k = false;\n\n    if (checkSNRC50k.test(snrc)) {\n      snrc50k = true;\n    } else {\n      if (checkSNRC250k.test(snrc)) {\n        snrc250k = true;\n      } else {\n        if (checkSNRC1m.test(snrc)) {\n          snrc1m = true;\n        }\n      }\n    }\n\n    if (snrc1m) {\n      snrc += 'a01';\n    } else if (snrc250k) {\n      snrc += '01';\n    }\n    if (/\\d{2,3}[a-p][0,1][0-9]/gi.test(snrc)) {\n      const regex1m = /(?=[a-p])/gi;\n      const ar1m = snrc.split(regex1m);\n      const part1m = ar1m[0];\n      const part250k = ar1m[1][0];\n      const part50k = ar1m[1].split(part250k)[1];\n      let separator = 1;\n      if (part1m.length === 3) {\n        separator = 2;\n      }\n      const partEW = part1m.substring(0, separator);\n      const partSN = part1m.substring(separator);\n      const unit1mEW = 8;\n      const unit1mSN = 4;\n      const unit250kEW = 2;\n      const unit250kSN = 1;\n      const unit50kEW = 0.5;\n      const unit50kSN = 0.25;\n      let index250kEW = 0;\n      let index250kSN = 0;\n      let index50kEW = 0;\n      let index50kSN = 0;\n      snrc250kIndex.forEach(element => {\n        if (element.indexOf(part250k) !== -1) {\n          index250kSN = snrc250kIndex.indexOf(element);\n          index250kEW = element.indexOf(part250k);\n        }\n      });\n      snrc50kIndex.forEach(element => {\n        if (element.indexOf(part50k) !== -1) {\n          index50kSN = snrc50kIndex.indexOf(element);\n          index50kEW = element.indexOf(part50k);\n        }\n      });\n\n      let increment250kEW = 0;\n      let increment250kSN = 0;\n      let increment50kEW = 0;\n      let increment50kSN = 0;\n      let unitPerTypeEW = unit1mEW;\n      let unitPerTypeSN = unit1mSN;\n      if (snrc250k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = 0;\n        increment50kSN = 0;\n        unitPerTypeEW = unit250kEW;\n        unitPerTypeSN = unit250kSN;\n      } else if (snrc50k) {\n        increment250kEW = index250kEW * unit250kEW;\n        increment250kSN = index250kSN * unit250kSN;\n        increment50kEW = index50kEW * unit50kEW;\n        increment50kSN = index50kSN * unit50kSN;\n        unitPerTypeEW = unit50kEW;\n        unitPerTypeSN = unit50kSN;\n      }\n\n      const coord: {ul?: any, lr?: any, ur?: any, ll?: any} = {\n        ul: [\n          ew[partEW].to + increment250kEW + increment50kEW,\n          sn[partSN].to - increment250kSN - increment50kSN\n        ]\n      };\n\n      coord.lr = [\n        coord.ul[0] + unitPerTypeEW,\n        coord.ul[1] - unitPerTypeSN\n      ];\n      coord.ur = [coord.ul[0], coord.ul[1] - unitPerTypeSN];\n      coord.ll = [coord.ul[0] + unitPerTypeEW, coord.ul[1]];\n\n      coord.ul = olproj.transform(\n        [coord.ul[0], coord.ul[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.lr = olproj.transform(\n        [coord.lr[0], coord.lr[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ur = olproj.transform(\n        [coord.ur[0], coord.ur[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n      coord.ll = olproj.transform(\n        [coord.ll[0], coord.ll[1]],\n        'EPSG:4326',\n        epsgTO\n      );\n\n      // Rounded coordinate to shorten url in get\n      coord.ul = this.roundCoordinateArray(coord.ul, epsgTO, 0);\n      coord.lr = this.roundCoordinateArray(coord.lr, epsgTO, 0);\n      coord.ur = this.roundCoordinateArray(coord.ur, epsgTO, 0);\n      coord.ll = this.roundCoordinateArray(coord.ll, epsgTO, 0);\n\n      wktPoly =\n        'POLYGON((' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        '))';\n      const wktLine =\n        'LINESTRING(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' '),\n          coord.ul.join(' ')\n        ].join(',') +\n        ')';\n\n      const wktMultiPoints =\n        'MULTIPOINT(' +\n        [\n          coord.ul.join(' '),\n          coord.ur.join(' '),\n          coord.lr.join(' '),\n          coord.ll.join(' ')\n        ].join(',') +\n        ')';\n      return {\n        wktPoly,\n        wktLine,\n        wktMultiPoints\n      };\n    }\n  }\n}\n","<mat-checkbox\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\"\n  (click)=\"$event.stopPropagation()\"\n  (change)=\"toggleFilterState($event)\"\n  [checked]=\"currentFilter.active\">\n</mat-checkbox>\n\n<mat-form-field\n  [ngClass]=\"{'logical': activeFilters.indexOf(currentFilter) !== 0 && currentFilter.active===true, 'logicalHidden': activeFilters.indexOf(currentFilter) === 0 || currentFilter.active!==true}\">\n  <mat-select\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.parentLogical\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.parentLogical ? (('igo.geo.operators.tooltip.'+ currentFilter.parentLogical) | translate) : ''\"\n    (selectionChange)=\"changeLogical($event.value)\">\n      <mat-option\n        [value]=ogcFilterOperator.And\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.And' | translate\">\n          {{'igo.geo.operators.And' | translate}}\n      </mat-option>\n      <mat-option\n        [value]=ogcFilterOperator.Or\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.operators.tooltip.Or' | translate\">\n          {{'igo.geo.operators.Or' | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\n  class=\"field\"\n  *ngIf=\"(currentFilterIsSpatial$ | async)===false && (fields$ | async) && (fields$| async).length > 0 && (fields$| async)[0].name !== ''\"\n  (mouseenter)=\"inputClearable = 'selectField'\"\n  (mouseleave)=\"inputClearable = undefined\"\n  [floatLabel]=\"floatLabel\">\n  <input\n  matInput\n  [placeholder]=\"'igo.geo.sourceFields.selectField' | translate\"\n  [disabled]=\"!currentFilter.active\"\n  [matAutocomplete]=\"autoCompleteField\"\n  [value]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ''\"\n  tooltip-position=\"above\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"(selectedField$ | async) ? (selectedField$ | async).alias : ('igo.geo.sourceFields.selectField' | translate)\"\n  (input)=\"updateFieldsList($event.target.value)\">\n  <mat-autocomplete #autoCompleteField=\"matAutocomplete\"\n  (optionSelected)='changeField($event.option.id)'>\n    <mat-option\n      *ngFor=\"let field of filteredFields$ | async\"\n      matTooltipShowDelay=\"500\"\n      [value]=\"field.alias\"\n      [id]=\"field.name\"\n      [matTooltip]=\"field.alias\">\n      {{field.alias}}\n    </mat-option>\n  </mat-autocomplete>\n  <button mat-button\n    *ngIf=\"currentFilter.propertyName && inputClearable === 'selectField' && currentFilter.active\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"clearSelectedField()\">\n        <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n</mat-form-field>\n\n\n<mat-form-field\n  [ngClass]=\"{'operator': (currentFilterIsSpatial$ | async)===false , 'dualInput': (currentFilterIsSpatial$ | async)}\"\n  [floatLabel]=\"floatLabel\">\n  <mat-select\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.operator ? (('igo.geo.operators.tooltip.'+ currentFilter.operator) | translate) : ('igo.geo.filter.selectOperator' | translate)\"\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.operator\"\n    (selectionChange)=\"changeOperator($event.value)\">\n      <mat-option\n        *ngFor=\"let operator of (ogcFilterOperators$ | async) | keyvalue\"\n        tooltip-position=\"above\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"operator.key\"\n        [matTooltip]=\"('igo.geo.operators.tooltip.'+ operator.key) | translate\">\n          {{('igo.geo.operators.'+ operator.key) | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\nclass=\"spatialSelector\"\n*ngIf=\"currentFilterIsSpatial$ | async\">\n  <mat-select\n    [disabled]=\"!currentFilter.active\"\n    [value]=\"currentFilter.igoSpatialSelector\"\n    (selectionChange)=\"changeSpatialSelector($event.value)\">\n      <mat-option\n        *ngFor=\"let igoSpatialSelector of igoSpatialSelectors\"\n        [value]=\"igoSpatialSelector.type\">\n          {{('igo.geo.spatialSelector.'+ igoSpatialSelector.type) | translate}}\n      </mat-option>\n  </mat-select>\n</mat-form-field>\n\n<mat-form-field\nclass=\"singleInput\"\n*ngIf=\"['expression','pattern'].indexOf(detectProperty()) !== -1\"\n(mouseenter)=\"inputClearable = 'selectProperty'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n    [disabled]=\"!currentFilter.active\"\n    [matAutocomplete]=\"autoCompleteValues\"\n    [value]=\"detectProperty() === 'expression' ? currentFilter.expression : currentFilter.pattern\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"detectProperty() === 'expression' ? currentFilter.expression || '' : currentFilter.pattern || ''\"\n    (input)=\"updateValuesList($event.target.value)\">\n  <mat-autocomplete #autoCompleteValues=\"matAutocomplete\"\n    (optionSelected)=\"changeProperty($event.option.value)\">\n    <mat-option\n      *ngFor=\"let value of filteredValues$ | async\"\n      matTooltipShowDelay=\"500\"\n      [value]=\"value\"\n      [matTooltip]=\"value\">\n      {{value}}\n    </mat-option>\n  </mat-autocomplete>\n  <button mat-button\n    *ngIf=\"isClearable() && inputClearable === 'selectProperty' && currentFilter.active\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"clearProperty()\">\n        <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n</mat-form-field>\n\n<div class=\"igo-layer-button-group\">\n  <button\n    mat-icon-button\n    collapsibleButton\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.filter.removeFilter' | translate\"\n    color=\"warn\"\n    (click)=\"deleteFilter()\">\n    <mat-icon svgIcon=\"delete\"></mat-icon>\n  </button>\n</div>\n\n<mat-form-field\nclass=\"snrc\"\n*ngIf=\"(currentFilterIsSpatial$ | async) && currentFilter.igoSpatialSelector === 'snrc'\"\n(mouseenter)=\"inputClearable = 'selectSNRC'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n  <input\n    matInput\n    [placeholder]=\"'igo.geo.filter.placeholderSnrc' | translate\"\n    [value]=\"currentFilter.igoSNRC\"\n    tooltip-position=\"above\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"currentFilter.igoSNRC ? currentFilter.igoSNRC : ''\"\n    (input)=\"changeSNRC($event.target.value)\">\n  <button\n    mat-button\n    *ngIf=\"currentFilter.igoSNRC\"\n    matSuffix\n    mat-icon-button\n    aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active && inputClearable === 'selectSNRC' && currentFilter.active\"\n    (click)=\"currentFilter.igoSNRC=''\">\n      <mat-icon svgIcon=\"close\"></mat-icon>\n  </button>\n  </mat-form-field>\n\n  <ng-container *ngIf=\"(currentFilterIsSpatial$ | async) && currentFilter.igoSpatialSelector === 'fixedExtent'\">\n    <button\n    mat-button\n    [disabled]=\"!currentFilter.active\"\n    *ngIf=\"currentFilter.igoSpatialSelector === 'fixedExtent'\"\n    matSuffix\n    mat-icon-button\n    [disabled]=\"!currentFilter.active\"\n    (click)=\"changeMapExtentGeometry()\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.spatialSelector.btnSetExtent' | translate\">\n      <mat-icon svgIcon=\"arrow-expand-all\"></mat-icon>\n  </button>\n</ng-container>\n\n<br/>\n\n<mat-form-field\nclass=\"dualInput\"\n*ngIf=\"!isTemporalOperator() && ['lowerBoundary','begin'].indexOf(detectProperty(1)) !== -1\"\n(mouseenter)=\"inputClearable = 'selectProperty1'\"\n(mouseleave)=\"inputClearable = undefined\"\n[floatLabel]=\"floatLabel\">\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator1\"\n      type=\"number\"\n      [value]=\"detectProperty(1) === 'lowerBoundary' ? currentFilter.lowerBoundary : currentFilter.begin\"\n      (input)=\"updateValuesList($event.target.value,1)\">\n    <mat-autocomplete #autoDualValueOperator1=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value,1)\">\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\">\n        {{value}}\n      </mat-option>\n    </mat-autocomplete>\n    <button mat-button\n      *ngIf=\"isClearable(1) && inputClearable === 'selectProperty1' && currentFilter.active\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n    [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(1)\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n</mat-form-field>\n\n<mat-form-field\n  class=\"dualInput\"\n  *ngIf=\"!isTemporalOperator() && ['upperBoundary','end'].indexOf(detectProperty(2)) !== -1\"\n  (mouseenter)=\"inputClearable = 'selectProperty2'\"\n  (mouseleave)=\"inputClearable = undefined\"\n  [floatLabel]=\"floatLabel\">\n    <input\n      matInput\n      [placeholder]=\"'igo.geo.filter.placeholder' | translate\"\n      [disabled]=\"!currentFilter.active\"\n      [matAutocomplete]=\"autoDualValueOperator2\"\n      type=\"number\"\n      [value]=\"detectProperty(2) === 'upperBoundary' ? currentFilter.upperBoundary : currentFilter.end\"\n      (input)=\"updateValuesList($event.target.value,2)\">\n    <mat-autocomplete #autoDualValueOperator2=\"matAutocomplete\"\n      (optionSelected)=\"changeNumericProperty($event.option.value,2)\">\n      <mat-option\n        *ngFor=\"let value of filteredValues$ | async\"\n        matTooltipShowDelay=\"500\"\n        [value]=\"value\"\n        [matTooltip]=\"value\">\n        {{value}}\n      </mat-option>\n    </mat-autocomplete>\n    <button mat-button\n      *ngIf=\"isClearable(2) && inputClearable === 'selectProperty2' && currentFilter.active\"\n      matSuffix\n      mat-icon-button\n      aria-label=\"Clear\"\n      [disabled]=\"!currentFilter.active\"\n      (click)=\"clearProperty(2)\">\n          <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n</mat-form-field>\n\n<igo-ogc-filter-time *ngIf=\"isTemporalOperator()\"\n  [(datasource)]=\"datasource\"\n  [(currentFilter)]=\"currentFilter\"\n  (changeProperty)=\"changeProperty($event.value, $event.pos)\">\n</igo-ogc-filter-time>\n\n<!--\nTODO C'EST PERTINENT je crois\n<mat-form-field class=\"field\" *ngIf=\"!(currentFilterIsSpatial$ | async) && (fields$| async) && (fields$| async).length === 1 &&  (fields$| async)[0].name === ''\">\n<input [disabled]=\"!currentFilter.active\" matInput #fieldPerUser (keyup)=\"changeProperty(currentFilter,'propertyName',fieldPerUser.value)\"\n  (blur)=\"changeProperty(currentFilter,'propertyName',fieldPerUser.value)\" [(ngModel)]=\"currentFilter.propertyName\">\n<button mat-button *ngIf=\"currentFilter.propertyName\" matSuffix mat-icon-button aria-label=\"Clear\" (click)=\"currentFilter.propertyName=''\">\n  <mat-icon svgIcon=\"close\"></mat-icon>\n</button>\n</mat-form-field>\n\n\n\n<mat-checkbox labelPosition='before' (change)=\"changeCaseSensitive($event)\" [(ngModel)]=\"currentFilter.matchCase\">\n  {{('igo.geo.operators.caseSensitive') | translate}}\n</mat-checkbox>\n\n</mat-list-item> -->\n","import { Component, Input, OnInit } from '@angular/core';\nimport { FloatLabelType } from '@angular/material/form-field';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\n\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions\n} from '../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { WktService } from '../../wkt/shared/wkt.service';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams } from '../../datasource/shared/datasources/datasource.interface';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\n\n@Component({\n  selector: 'igo-ogc-filter-form',\n  templateUrl: './ogc-filter-form.component.html',\n  styleUrls: ['./ogc-filter-form.component.scss']\n})\nexport class OgcFilterFormComponent implements OnInit {\n  ogcFilterOperator = OgcFilterOperator;\n  filteredValues$: Observable<string[]>;\n  filteredFields$: Observable<SourceFieldsOptionsParams[]>;\n  public allOgcFilterOperators;\n  public ogcFilterOperators$ = new BehaviorSubject<{ [key: string]: any }>(\n    undefined\n  );\n  public igoSpatialSelectors;\n  public value = '';\n  public inputOperator;\n  public selectedField$ = new BehaviorSubject<SourceFieldsOptionsParams>(\n    undefined\n  );\n  public fields$ = new BehaviorSubject<SourceFieldsOptionsParams[]>([]);\n  public color = 'primary';\n  public disabled;\n  public currentFilterIsSpatial$ = new BehaviorSubject<boolean>(false);\n  public defaultStepMillisecond = 6000;\n  public inputClearable: string;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() currentFilter: any;\n\n  set snrc(value: any) {\n    const checkSNRC50k = /^\\d{2}[a-l][0,1][0-9]$/gi;\n    const checkSNRC250k = /^\\d{2}[a-p]$/gi;\n    const checkSNRC1m = /^\\d{2}$/gi;\n    if (\n      checkSNRC1m.test(value) ||\n      checkSNRC250k.test(value) ||\n      checkSNRC50k.test(value)\n    ) {\n      this._snrc = value;\n      this.currentFilter.igoSNRC = value;\n    }\n  }\n\n  get snrc(): any {\n    return this._snrc;\n  }\n\n  private _snrc = '';\n\n  @Input() floatLabel: FloatLabelType = 'never';\n\n  get activeFilters() {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.active === true\n    );\n  }\n\n  get allowedOperators() {\n    return new OgcFilterWriter().computeAllowedOperators(\n      this.fields$.value,\n      this.currentFilter.propertyName,\n      this.datasource.options.ogcFilters.allowedOperatorsType\n    );\n  }\n\n  constructor(private wktService: WktService) {\n    // TODO: Filter permitted operator based on wfscapabilities\n    // Need to work on regex on XML capabilities because\n    // comaparison operator's name varies between WFS servers...\n    // Ex: IsNull vs PropertyIsNull vs IsNil ...\n    this.allOgcFilterOperators = new OgcFilterWriter().operators;\n    this.ogcFilterOperators$.next(this.allOgcFilterOperators);\n    this.igoSpatialSelectors = [\n      {\n        type: 'fixedExtent'\n      },\n      {\n        type: 'snrc'\n      }\n    ];\n    // TODO: selectFeature & drawFeature\n  }\n\n  ngOnInit() {\n\n    if ( this.datasource.options.sourceFields) {\n      const sFields = this.datasource.options.sourceFields.filter(\n        (sf) =>\n          sf.excludeFromOgcFilters === undefined || !sf.excludeFromOgcFilters\n      );\n      sFields.map((sfs) => {\n        if (sfs.values) {\n          sfs.values.sort();\n        }\n      });\n      this.fields$.next(sFields);\n    }\n\n    this.updateFieldsList();\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.updateValuesList();\n    this.selectedField$.subscribe((f) => {\n      this.ogcFilterOperators$.next(this.allowedOperators);\n      if (\n        Object.keys(this.allowedOperators).indexOf(\n          this.currentFilter.operator\n        ) === -1\n      ) {\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n        this.currentFilter.operator = Object.keys(this.allowedOperators)[0];\n      }\n      this.updateValuesList();\n    });\n    this.currentFilterIsSpatial();\n  }\n\n  updateFieldsList(value?: string) {\n    this.filteredFields$ =\n      value && value.length > 0 ? of(this._filterFields(value)) : this.fields$;\n    if (this.fields$.value.find((f) => f.name === value)) {\n      this.changeField(value);\n    }\n  }\n\n  updateValuesList(value?: string, pos?: number) {\n    this.filteredValues$ =\n      value && value.length > 0\n        ? of(this._filterValues(value))\n        : this.selectedField$.value\n        ? of(this.selectedField$.value.values)\n        : of([]);\n    if (value && value.length >= 1) {\n      this.changeProperty(value, pos);\n    }\n  }\n\n  private _filterFields(value: string): SourceFieldsOptionsParams[] {\n    const keywordRegex = new RegExp(\n      value.normalize('NFD').replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n    return this.fields$.value.filter((val) =>\n      keywordRegex.test(\n        val.alias.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '')\n      )\n    );\n  }\n\n  private _filterValues(value: string): string[] {\n    const keywordRegex = new RegExp(\n      value\n        .toString()\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, ''),\n      'gi'\n    );\n    return this.selectedField$.value.values.filter((val) =>\n      val && keywordRegex.test(\n        val\n          .toString()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '')\n      )\n    );\n  }\n\n  clearSelectedField() {\n    this.currentFilter.propertyName = '';\n    this.selectedField$.next(undefined);\n    this.clearProperty();\n  }\n\n  isClearable(pos?: number) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return this.currentFilter[detectedProperty];\n    }\n  }\n  clearProperty(pos?: number) {\n    // this.autoCompleteInputValues.closePanel();\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      return (this.currentFilter[detectedProperty] = '');\n    }\n  }\n\n  toggleFilterState(event) {\n    this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    ).active = event.checked;\n    this.refreshFilters();\n  }\n\n  deleteFilter() {\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    ogcFilters.interfaceOgcFilters = ogcFilters.interfaceOgcFilters.filter(\n      (f) => f.filterid !== this.currentFilter.filterid\n    );\n    this.refreshFilters();\n  }\n\n  changeLogical(logical: string) {\n    this.currentFilter.parentLogical = logical;\n    this.refreshFilters();\n  }\n\n  changeOperator(operator: string) {\n    this.currentFilter.operator = operator;\n    this.currentFilterIsSpatial();\n\n    if (\n      this.currentFilterIsSpatial$.value &&\n      this.currentFilter.wkt_geometry.length === 0\n    ) {\n      this.changeSpatialSelector(this.currentFilter.igoSpatialSelector);\n    } else {\n      this.refreshFilters();\n    }\n  }\n\n  changeField(field: string) {\n    this.currentFilter.propertyName = field;\n    this.selectedField$.next(\n      this.fields$.value.find((f) => f.name === this.currentFilter.propertyName)\n    );\n    this.refreshFilters();\n  }\n\n  // Issue with mapserver 7.2 and Postgis layers. Fixed in 7.4\n  // Due to this issue, the checkbox is hide.\n  changeCaseSensitive(matchCase) {\n    this.currentFilter.matchCase = matchCase.checked;\n    this.refreshFilters();\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        (f) => f.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if ( refreshFilter ) {\n        this.refreshFilters();\n      }\n    }\n  }\n\n  changeNumericProperty(value, pos: number) {\n    this.changeProperty(parseFloat(value), pos);\n  }\n\n  changeSpatialSelector(value: any) {\n    this.currentFilter.igoSpatialSelector = value;\n\n    if (value === 'fixedExtent') {\n      this.changeMapExtentGeometry(false);\n    }\n    this.currentFilterIsSpatial();\n    this.refreshFilters();\n  }\n\n  changeSNRC(value: any) {\n    this.snrc = value;\n    this.changeSNRCGeometry();\n  }\n\n  changeSNRCGeometry() {\n    const interfaceOgcFilter = this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.snrc && this.currentFilter.igoSpatialSelector === 'snrc') {\n      this.currentFilter.wkt_geometry = this.wktService.snrcToWkt(\n        this.snrc,\n        this.map.projection\n      ).wktPoly;\n    }\n    this.refreshFilters();\n  }\n\n  changeMapExtentGeometry(refresh: boolean = true) {\n    const interfaceOgcFilter = this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n      (f) => f.filterid === this.currentFilter.filterid\n    );\n    if (!interfaceOgcFilter) {\n      return;\n    }\n\n    if (this.currentFilter.igoSpatialSelector === 'fixedExtent') {\n      this.currentFilter.wkt_geometry = this.wktService.extentToWkt(\n        this.map.projection,\n        this.map.viewController.getExtent(),\n        this.map.projection\n      ).wktPoly;\n    }\n    if (refresh) {\n      this.refreshFilters();\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n          ? 'upperBoundary'\n          : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n          ? 'end'\n          : undefined;\n      default:\n        return;\n    }\n  }\n\n  private currentFilterIsSpatial() {\n    let isSpatial = false;\n    if (this.currentFilter) {\n      isSpatial =\n        [\n          OgcFilterOperator.Contains,\n          OgcFilterOperator.Intersects,\n          OgcFilterOperator.Within\n        ].indexOf(this.currentFilter.operator) !== -1;\n    }\n    this.currentFilterIsSpatial$.next(isSpatial);\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter.operator.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n}\n","<igo-ogc-filter-selection\n  *ngIf=\"!advancedOgcFilters\"\n  igoListItem\n  [refreshFilters]=\"refreshFunc\"\n  [datasource]=\"datasource\"\n  [map]=\"map\"\n  [currentFilter]=\"currentFilter\">\n</igo-ogc-filter-selection>\n\n<ng-template \n*ngIf=\"advancedOgcFilters && datasource.options.ogcFilters.editable\"\nngFor let-currentFilter \n[ngForOf]=\"datasource.options.ogcFilters.interfaceOgcFilters\">\n<igo-ogc-filter-form\n  [currentFilter]=\"currentFilter\"\n  [refreshFilters]=\"refreshFunc\"\n  [datasource]=\"datasource\"\n  [map]=\"map\">\n</igo-ogc-filter-form>\n</ng-template>","import { Component, Input } from '@angular/core';\nimport { OgcFilterableDataSource } from '../shared/ogc-filter.interface';\nimport { IgoMap } from '../../map';\n\n@Component({\n  selector: 'igo-ogc-filterable-form',\n  templateUrl: './ogc-filterable-form.component.html'\n})\nexport class OgcFilterableFormComponent {\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() refreshFilters: () => void;\n\n  get refreshFunc() {\n    return this.refreshFilters;\n  }\n\n  get advancedOgcFilters(): boolean {\n    if (this.datasource.options.ogcFilters) {\n      return this.datasource.options.ogcFilters.advancedOgcFilters;\n    }\n    return;\n  }\n\n  get currentFilter(): any {\n    return this.datasource.options.ogcFilters.interfaceOgcFilters ?\n    this.datasource.options.ogcFilters.interfaceOgcFilters[0] : undefined;\n  }\n\n  public color = 'primary';\n\n  constructor() {}\n}\n","<div [ngClass]=\"{'separate-item' : header === true}\" >\n  <mat-list-item>\n    <mat-icon\n      *ngIf=\"header\"\n      class=\"igo-chevron\"\n      mat-list-avatar\n      igoCollapse [target]=\"ogcFilters\"\n      [collapsed]=\"filtersCollapsed\"\n      (click)=\"toggleFiltersCollapsed()\"\n      svgIcon=\"chevron-up\">\n    </mat-icon>\n    <h4 (click)=\"toggleLegendOnClick()\" *ngIf=\"header\" [ngStyle]=\"{'cursor': filtersCollapsed ? 'default' : 'pointer'}\" matLine [matTooltip]=\"layer.title\" matTooltipShowDelay=\"500\">{{layer.title}}</h4>\n      <button *ngIf=\"isAdvancedOgcFilters() && filtersAreEditable\" [disabled]=\"addFilterDisabled()\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.addFilter' | translate\" [color]=\"color\" (click)=\"addFilterToSequence()\">\n        <mat-icon svgIcon=\"plus\"></mat-icon>\n      </button>\n      <button *ngIf=\"header\"\n        mat-icon-button\n        [color]=\"layer.visible ? 'primary' : 'default'\"\n        collapsibleButton\n        tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"layer.visible ?\n                      ('igo.geo.layer.hideLayer' | translate) :\n                      ('igo.geo.layer.showLayer' | translate)\"\n        (click)=\"layer.visible = !layer.visible\">\n        <mat-icon\n          [ngClass]=\"{disabled: (inResolutionRange$ | async)===false}\"\n          [svgIcon]=\"layer.visible ? 'eye' : 'eye-off'\">\n        </mat-icon>\n      </button>\n  </mat-list-item>\n\n  <div #ogcFilters>\n      <div *ngIf=\"header\" #legend class=\"igo-layer-legend-container\">\n        <igo-layer-legend *ngIf=\"showLegend$ | async\" [layer]=\"layer\">\n        </igo-layer-legend>\n      </div>\n    <igo-ogc-filterable-form [datasource]=\"datasource\" [map]=\"map\" [refreshFilters]=\"refreshFunc\">\n    </igo-ogc-filterable-form>\n\n    <section *ngIf=\"hasSelector && filtersAreEditable\" class=\"mat-typography advancedOgcFilters\">\n      <mat-divider></mat-divider>\n      <mat-checkbox labelPosition='before' (change)=\"changeOgcFilterType($event)\"\n        [(ngModel)]=\"datasource.options.ogcFilters.advancedOgcFilters\">\n        {{'igo.geo.filter.advancedOgcFilters' | translate}}\n      </mat-checkbox>\n    </section>\n  </div>\n</div>","import { Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { WFSDataSourceOptionsParams } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\n\nimport {\n  OgcFilterableDataSource,\n  OgcFiltersOptions,\n  OgcInterfaceFilterOptions\n} from '../shared/ogc-filter.interface';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\nimport { IgoMap } from '../../map';\nimport { OgcFilterWriter } from '../shared/ogc-filter';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n@Component({\n  selector: 'igo-ogc-filterable-item',\n  templateUrl: './ogc-filterable-item.component.html',\n  styleUrls: ['./ogc-filterable-item.component.scss']\n})\nexport class OgcFilterableItemComponent implements OnInit, OnDestroy {\n  public color = 'primary';\n  private lastRunOgcFilter;\n  private defaultLogicalParent = OgcFilterOperator.And;\n  public hasActiveSpatialFilter = false;\n  public filtersAreEditable = true;\n  public filtersCollapsed = true;\n  public hasSelector: boolean = false;\n  showLegend$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  private resolution$$: Subscription;\n  private ogcFilterWriter;\n\n  @Input() layer: Layer;\n\n  @Input() map: IgoMap;\n\n  @Input() header: boolean = true;\n\n  get refreshFunc() {\n    return this.refreshFilters.bind(this);\n  }\n\n  get datasource(): OgcFilterableDataSource {\n    return this.layer.dataSource as OgcFilterableDataSource;\n  }\n\n  constructor(private ogcFilterService: OGCFilterService) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n  }\n\n  ngOnInit() {\n    if (this.layer.visible) {\n      this.filtersCollapsed = false;\n    }\n\n    const ogcFilters = this.datasource.options.ogcFilters;\n    if (\n      (ogcFilters.pushButtons && ogcFilters.pushButtons.bundles.length > 0) ||\n      (ogcFilters.checkboxes && ogcFilters.checkboxes.bundles.length > 0) ||\n      (ogcFilters.radioButtons && ogcFilters.radioButtons.bundles.length > 0) ||\n      (ogcFilters.select && ogcFilters.select.bundles.length > 0) ||\n      (ogcFilters.autocomplete && ogcFilters.autocomplete.bundles.length > 0)) {\n      if (ogcFilters.advancedOgcFilters === undefined) {\n        ogcFilters.advancedOgcFilters = false;\n      }\n      this.hasSelector = true;\n    }\n\n    switch (this.datasource.options.type) {\n      case 'wms':\n        this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);\n        break;\n      case 'wfs':\n        this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource);\n        break;\n      default:\n        break;\n    }\n\n    if (ogcFilters) {\n      if (ogcFilters.interfaceOgcFilters) {\n        this.lastRunOgcFilter = JSON.parse(\n          JSON.stringify(ogcFilters.interfaceOgcFilters)\n        );\n        if (\n          ogcFilters.interfaceOgcFilters.filter(f => f.wkt_geometry).length >= 1\n        ) {\n          this.hasActiveSpatialFilter = true;\n        }\n      }\n\n      this.filtersAreEditable = ogcFilters.editable\n        ? ogcFilters.editable\n        : false;\n    }\n\n    const resolution$ = this.layer.map.viewController.resolution$;\n    this.resolution$$ = resolution$.subscribe(() => {\n      this.inResolutionRange$.next(this.layer.isInResolutionsRange);\n    });\n  }\n\n  ngOnDestroy(): void {\n    this.resolution$$.unsubscribe();\n  }\n\n  addFilterToSequence() {\n    this.filtersCollapsed = false;\n    const interfaceOgcFilters: OgcInterfaceFilterOptions[] = this.datasource\n      .options.ogcFilters.interfaceOgcFilters;\n    const arr = interfaceOgcFilters || [];\n    const lastLevel = arr.length === 0 ? 0 : arr[arr.length - 1].level;\n    let firstFieldName = '';\n    const includedFields = this.datasource.options.sourceFields.filter(f => !f.excludeFromOgcFilters);\n    if (includedFields.length > 0) {\n      firstFieldName =\n        includedFields[0].name === undefined ? '' : includedFields[0].name;\n    }\n    let fieldNameGeometry;\n    const datasourceOptions = this.datasource\n      .options as WFSDataSourceOptionsParams;\n    if (datasourceOptions.fieldNameGeometry) {\n      fieldNameGeometry = datasourceOptions.fieldNameGeometry;\n    } else if (\n      (this.datasource.options as any).paramsWFS &&\n      (this.datasource.options as any).paramsWFS.fieldNameGeometry\n    ) {\n      fieldNameGeometry = (this.datasource.options as any).paramsWFS\n        .fieldNameGeometry;\n    }\n    const allowedOperators = this.ogcFilterWriter.computeAllowedOperators(\n      this.datasource.options.sourceFields,\n      firstFieldName,\n      this.datasource.options.ogcFilters.allowedOperatorsType);\n    const firstOperatorName = Object.keys(allowedOperators)[0];\n\n    arr.push(\n      this.ogcFilterWriter.addInterfaceFilter(\n        {\n          propertyName: firstFieldName,\n          operator: firstOperatorName,\n          active: true,\n          igoSpatialSelector: 'fixedExtent',\n          srsName: this.map.projection,\n        } as OgcInterfaceFilterOptions,\n        fieldNameGeometry,\n        lastLevel,\n        this.defaultLogicalParent\n      )\n    );\n    this.datasource.options.ogcFilters.interfaceOgcFilters = arr;\n  }\n\n  refreshFilters(force?: boolean) {\n    if (force === true) {\n      this.lastRunOgcFilter = undefined;\n    }\n    const ogcFilters: OgcFiltersOptions = this.datasource.options.ogcFilters;\n    const activeFilters = ogcFilters.interfaceOgcFilters ?\n      ogcFilters.interfaceOgcFilters.filter(f => f.active === true) : [];\n    if (activeFilters.length === 0) {\n      ogcFilters.filters = undefined;\n      ogcFilters.filtered = false;\n    }\n    if (activeFilters.length > 1) {\n      activeFilters[0].parentLogical = activeFilters[1].parentLogical;\n    }\n    if (\n      activeFilters.filter(\n        af => ['Contains', 'Intersects', 'Within'].indexOf(af.operator) !== -1\n      ).length === 0\n    ) {\n      this.hasActiveSpatialFilter = false;\n    } else {\n      this.hasActiveSpatialFilter = true;\n    }\n\n    if (\n      !(JSON.stringify(this.lastRunOgcFilter) === JSON.stringify(activeFilters))\n    ) {\n      if (this.layer.dataSource.options.type === 'wfs') {\n        const ogcDataSource: any = this.layer.dataSource;\n        const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n        ogcLayer.filters = this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n          activeFilters\n        );\n        this.layer.dataSource.ol.refresh();\n      } else if (\n        this.layer.dataSource.options.type === 'wms' &&\n        ogcFilters.enabled\n      ) {\n        let rebuildFilter = '';\n        if (activeFilters.length >= 1) {\n          const ogcDataSource: any = this.layer.dataSource;\n          const ogcLayer: OgcFiltersOptions = ogcDataSource.options.ogcFilters;\n          ogcLayer.filters = this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(\n            activeFilters\n          );\n          rebuildFilter = this.ogcFilterWriter.buildFilter(\n            ogcLayer.filters,\n            undefined,\n            undefined,\n            (this.layer.dataSource.options as any).fieldNameGeometry,\n            ogcDataSource.options\n          );\n        }\n        this.ogcFilterService.filterByOgc(\n          this.datasource as WMSDataSource,\n          rebuildFilter\n        );\n        this.datasource.options.ogcFilters.filtered =\n          activeFilters.length === 0 ? false : true;\n      }\n\n      this.lastRunOgcFilter = JSON.parse(JSON.stringify(activeFilters));\n    } else {\n      // identical filter. Nothing triggered\n    }\n    (this.layer.dataSource as OgcFilterableDataSource).setOgcFilters(ogcFilters, true);\n  }\n\n  public setVisible() {\n    this.layer.visible = true;\n  }\n\n  public isAdvancedOgcFilters(): boolean {\n    return this.datasource.options.ogcFilters.advancedOgcFilters;\n  }\n\n  public addFilterDisabled(): boolean {\n    return (\n      !this.datasource.options.sourceFields ||\n      this.datasource.options.sourceFields.length === 0\n    );\n  }\n\n  private changeOgcFiltersAdvancedOgcFilters(value: boolean) {\n    this.datasource.options.ogcFilters.advancedOgcFilters = value;\n  }\n\n  changeOgcFilterType(isAdvancedOgcFilters) {\n    this.changeOgcFiltersAdvancedOgcFilters(isAdvancedOgcFilters.checked);\n    if (isAdvancedOgcFilters.checked) {\n      this.refreshFilters(true);\n    }\n  }\n\n  private toggleLegend(collapsed: boolean) {\n    this.layer.legendCollapsed = collapsed;\n    this.showLegend$.next(!collapsed);\n  }\n\n  toggleLegendOnClick() {\n    if (!this.filtersCollapsed) {\n      this.toggleLegend(this.showLegend$.value);\n    }\n  }\n\n  toggleFiltersCollapsed() {\n    this.filtersCollapsed = !this.filtersCollapsed;\n  }\n}\n","\n<igo-list [navigation]=\"false\" [selection]=\"false\">\n  <div  id=\"no-layer-message\" *ngIf=\"(layers | filterableDataSource : 'ogc').length === 0\">{{'igo.geo.filter.noFilterableLayer' | translate}}</div>\n  <ng-template ngFor let-layer [ngForOf]=\"layers | filterableDataSource: 'ogc'\">\n    <igo-ogc-filterable-item igoListItem [header]=\"true\" [layer]=\"layer\" \n    [map]=\"layer.map\" ></igo-ogc-filterable-item>\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\n\n@Component({\n  selector: 'igo-ogc-filterable-list',\n  templateUrl: './ogc-filterable-list.component.html',\n  styleUrls: ['./ogc-filterable-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterableListComponent {\n\n  @Input() layers: Layer[];\n\n  @Input() map: IgoMap;\n\n  constructor() {}\n}\n","<button\n  *ngIf=\"header && options.ogcFilters && options.ogcFilters.enabled &&\n  (options.ogcFilters.pushButtons || options.ogcFilters.checkboxes || options.ogcFilters.radioButtons || options.ogcFilters.select || options.ogcFilters.autocomplete\n    || options.ogcFilters.editable)\"\n  mat-icon-button\n  collapsibleButton\n  tooltip-position=\"below\"\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.filter.filterBy' | translate\"\n  [color]=\"color\">\n  <mat-icon [matBadge]=\"badge\" matBadgeColor=\"warn\" matBadgeSize=\"medium\" svgIcon=\"filter\"></mat-icon>\n</button>\n\n<div #ogcFilter class=\"igo-layer-actions-container\"\n*ngIf=\"options.ogcFilters && options.ogcFilters.enabled &&\n(options.ogcFilters.pushButtons || options.ogcFilters.checkboxes || options.ogcFilters.radioButtons || options.ogcFilters.select || options.ogcFilters.autocomplete\n  || options.ogcFilters.editable)\">\n  <igo-ogc-filterable-item\n    *ngIf=\"ogcFilterCollapse && options.ogcFilters.enabled\"\n    igoListItem\n    [header]=\"false\"\n    [map]=\"layer.map\"\n    [layer]=\"layer\">\n  </igo-ogc-filterable-item>\n</div>\n","import { Component, Input, ChangeDetectionStrategy, OnInit } from '@angular/core';\n\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { IgoMap } from '../../map';\nimport { OgcFilterableDataSourceOptions, IgoOgcSelector } from '../shared/ogc-filter.interface';\n\n@Component({\n  selector: 'igo-ogc-filter-button',\n  templateUrl: './ogc-filter-button.component.html',\n  styleUrls: ['./ogc-filter-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterButtonComponent implements OnInit {\n\n  public options: OgcFilterableDataSourceOptions;\n\n  get badge() {\n    const filter = this.options.ogcFilters as any;\n    let cnt = 0;\n    if (filter && !filter.advancedOgcFilters) {\n      if (filter.pushButtons) {\n        const pushButtons = filter.pushButtons as IgoOgcSelector;\n        const currentPushButtonGroup = pushButtons.groups.find(gr => gr.enabled);\n        let cntPushButtons = 0;\n        if (currentPushButtonGroup) {\n          currentPushButtonGroup.computedSelectors?.map(cb => cntPushButtons += (cb.selectors as any)?.filter(\n            button => button.enabled).length);\n        }\n        cnt += cntPushButtons;\n      }\n      if (filter.checkboxes) {\n        const checkboxes = filter.checkboxes as IgoOgcSelector;\n        const currentCheckboxGroup = checkboxes.groups.find(gr => gr.enabled);\n        let cntCheckboxes = 0;\n        if (currentCheckboxGroup) {\n          currentCheckboxGroup.computedSelectors?.map(cb => cntCheckboxes += (cb.selectors as any)?.filter(\n            checkbox => checkbox.enabled).length);\n        }\n        cnt += cntCheckboxes;\n      }\n      if (filter.radioButtons) {\n        const radioButtons = filter.radioButtons as IgoOgcSelector;\n        const currentRadioButtonsGroup = radioButtons.groups.find(gr => gr.enabled);\n        let cntRadioButtons = 0;\n        if (currentRadioButtonsGroup) {\n          currentRadioButtonsGroup.computedSelectors?.map(cb => cntRadioButtons += (cb.selectors as any)?.filter(\n            radio => radio.enabled).length);\n        }\n        cnt += cntRadioButtons;\n      }\n      if (filter.select) {\n        const select = filter.select as IgoOgcSelector;\n        const currentSelectGroup = select.groups.find(gr => gr.enabled);\n        let cntSelect = 0;\n        if (currentSelectGroup) {\n          currentSelectGroup.computedSelectors?.map(cb => cntSelect += (cb.selectors as any)?.filter(\n            multi => multi.enabled).length);\n        }\n        cnt += cntSelect;\n      }\n      if (filter.autocomplete) {\n        const autocomplete = filter.autocomplete as IgoOgcSelector;\n        const currentAutocompleteGroup = autocomplete.groups.find(gr => gr.enabled);\n        let cntAutocomplete = 0;\n        if (currentAutocompleteGroup) {\n          currentAutocompleteGroup.computedSelectors?.map(cb => cntAutocomplete += (cb.selectors as any)?.filter(\n            autocomplete => autocomplete.enabled).length);\n        }\n        cnt += cntAutocomplete;\n      }\n    } else if (filter && filter.filters && !filter.filters.filters) {\n      return 1;\n    } else if (filter && filter.filters && filter.filters.filters) {\n      return filter.filters.filters.length;\n    }\n    if (filter.filters && filter.filters.operator === 'During' && filter.filters.active &&\n      filter.interfaceOgcFilters && filter.interfaceOgcFilters[0].active) {\n      const filterActiveValue = filter.interfaceOgcFilters[0];\n      if (filter.filters.calendarModeYear) {\n        // year mode check just year\n        if ((filterActiveValue.begin.substring(0,4) !== this.options.minDate.substring(0,4) ) ||\n        (filterActiveValue.end.substring(0,4) !== this.options.maxDate.substring(0,4) )) {\n          cnt += 1;\n        }\n      } else if ((filterActiveValue.begin !== this.options.minDate) || (filterActiveValue.end !== this.options.maxDate)) {\n        cnt += 1;\n      }\n    }\n    return cnt > 0 ? cnt : undefined;\n  }\n\n  @Input()\n  get layer(): Layer {\n    return this._layer;\n  }\n  set layer(value: Layer) {\n    this._layer = value;\n    if (value) {\n      this.options = this.layer.dataSource.options as OgcFilterableDataSourceOptions;\n    }\n  }\n  private _layer;\n\n  @Input() map: IgoMap;\n\n  @Input() color: string = 'primary';\n\n  @Input() header: boolean;\n\n  public ogcFilterCollapse = false;\n\n  constructor() {}\n\n  ngOnInit() {\n    this.options = this.layer.dataSource.options as OgcFilterableDataSourceOptions;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { default as moment } from 'moment';\n\nimport {\n    OgcFilterableDataSource\n  } from './ogc-filter.interface';\n\n@Injectable()\nexport class OGCFilterTimeService {\n\n    readonly defaultStepMillisecond = 60000;\n\n    constructor() {}\n\n    step(datasource: OgcFilterableDataSource, currentFilter): string {\n    return datasource.options.stepDate\n      ? datasource.options.stepDate\n      : currentFilter.step;\n    }\n\n    stepMillisecond(dataSource: OgcFilterableDataSource, currentFilter): number {\n        const step = moment.duration(this.step(dataSource, currentFilter)).asMilliseconds();\n        return step === 0 ? this.defaultStepMillisecond : step;\n    }\n\n    stepIsYearDuration(step: string) {\n        const year = moment.duration(step);\n        return (\n            year.years() !== 0 &&\n            year.months() === 0 &&\n            year.weeks() === 0 &&\n            year.days() === 0 &&\n            year.hours() === 0 &&\n            year.minutes() === 0\n        );\n    }\n\n    stepIsMonthDuration(step: string) {\n        const month = moment.duration(step);\n        return (\n            month.months() !== 0 &&\n            month.weeks() === 0 &&\n            month.days() === 0 &&\n            month.hours() === 0 &&\n            month.minutes() === 0\n        );\n    }\n\n    stepIsWeekDuration(step: string) {\n        const week = moment.duration(step);\n        return (\n            week.weeks() !== 0 &&\n            week.days() === 7 &&\n            week.hours() === 0 &&\n            week.minutes() === 0\n        );\n    }\n\n    stepIsDayDuration(step: string) {\n        const day = moment.duration(step);\n        return day.days() !== 0 && day.hours() === 0 && day.minutes() === 0;\n    }\n\n    stepIsHourDuration(step: string) {\n        const hour = moment.duration(step);\n        return hour.hours() !== 0 && hour.minutes() === 0;\n    }\n\n    stepIsMinuteDuration(step: string) {\n        const minute = moment.duration(step);\n        return minute.minutes() !== 0;\n    }\n\n    dateToNumber(date: Date): number {\n        let newDate = new Date();\n        if (date) {\n          newDate = new Date(date);\n        }\n        return newDate.getTime();\n    }\n\n    public addStep(value, stepMillisecond) {\n        return moment(value).add(stepMillisecond, 'milliseconds').toDate();\n    }\n\n    public subtractStep(value, stepMillisecond) {\n        return moment(value).subtract(stepMillisecond, 'milliseconds').toDate();\n    }\n}\n","<form [formGroup]=\"form\">\n  <div *ngFor=\"let selector of ogcFiltersSelectors\">\n    <div class=\"pushButtonGroups\" *ngIf=\"selector.selectorType === 'pushButton'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getPushButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"pushButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentPushButtonsGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getPushButtonsGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentPushButtonsGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <mat-button-toggle-group\n          formControlName=\"pushButtons\" class=\"mat-typography\" appearance=\"legacy\" vertical={{bundleIsVertical(bundle)}} multiple=\"true\">\n          <mat-button-toggle *ngFor=\"let ogcPushButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcPushButton)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\" matTooltipClass=\"material-tooltip\"\n            [ngStyle]=\"getButtonColor(ogcPushButton)\"\n            [checked]=\"ogcPushButton.enabled\" (change)=\"onSelectionChange(ogcPushButton, selector.selectorType)\"\n            [value]=\"ogcPushButton\">{{ogcPushButton.title}}\n          </mat-button-toggle>\n        </mat-button-toggle-group>\n      </ng-container>\n    </div>\n\n    <div class=\"checkboxGroups\" *ngIf=\"selector.selectorType === 'checkbox'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getCheckboxesGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"checkboxesGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentCheckboxesGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getCheckboxesGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentCheckboxesGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <div class=\"checkboxes mat-typography\">\n          <mat-checkbox *ngFor=\"let ogcCheckbox of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcCheckbox)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcCheckbox.enabled\" (change)=\"onSelectionChange(ogcCheckbox, selector.selectorType)\"\n            [value]=\"ogcCheckbox\">{{ogcCheckbox.title}}\n          </mat-checkbox>\n        </div>\n        <p *ngIf=\"isLessResults(bundle, 'checkbox') || isMoreResults(bundle, 'checkbox')\">\n          <u *ngIf=\"isLessResults(bundle, 'checkbox')\"\n            class=\"lessResults mat-typography\"\n            (click)=\"displayLessResults('checkbox')\">{{ 'igo.geo.filter.displayLessResults' | translate }}\n          </u>\n          <u *ngIf=\"isMoreResults(bundle, 'checkbox')\"\n            class=\"moreResults mat-typography\"\n            (click)=\"displayMoreResults('checkbox')\">{{ 'igo.geo.filter.displayMoreResults' | translate }}\n          </u>\n        </p>\n      </ng-container>\n    </div>\n\n    <div class=\"radioButtonGroups\" *ngIf=\"selector.selectorType === 'radioButton'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getRadioButtonsGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"radioButtonsGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentRadioButtonsGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getRadioButtonsGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentRadioButtonsGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <mat-radio-group\n          formControlName=\"radioButtons\" class=\"mat-typography\">\n          <mat-radio-button *ngIf=\"bundle.unfiltered\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            (change)=\"emptyRadioButtons()\">{{ 'igo.geo.filter.resetFilters' | translate }}\n          </mat-radio-button>\n          <mat-radio-button *ngFor=\"let ogcRadioButton of bundle.selectors\"\n            [matTooltip]=\"getToolTip(ogcRadioButton)\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            [checked]=\"ogcRadioButton.enabled\" (change)=\"onSelectionChange(ogcRadioButton, selector.selectorType)\"\n            [value]=\"ogcRadioButton\">{{ogcRadioButton.title}}\n          </mat-radio-button>\n          <p *ngIf=\"isLessResults(bundle, 'radio') || isMoreResults(bundle, 'radio')\">\n            <u *ngIf=\"isLessResults(bundle, 'radio')\"\n              class=\"lessResults mat-typography\"\n              (click)=\"displayLessResults('radio')\">{{ 'igo.geo.filter.displayLessResults' | translate }}\n            </u>\n            <u *ngIf=\"isMoreResults(bundle, 'radio')\"\n              class=\"moreResults mat-typography\"\n              (click)=\"displayMoreResults('radio')\">{{ 'igo.geo.filter.displayMoreResults' | translate }}\n            </u>\n          </p>\n        </mat-radio-group>\n      </ng-container>\n    </div>\n\n    <div class=\"selectGroups\" *ngIf=\"selector.selectorType === 'select'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getSelectGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"selectGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentSelectGroup\">\n            <mat-option *ngFor=\"let selectorGroup of getSelectGroups()\"\n              [value]=\"selectorGroup\">{{selectorGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentSelectGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <div class=\"groupsSelector\">\n          <mat-button *ngIf=\"bundle.unfiltered && !bundle.multiple\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            (click)=\"emptySelect()\">\n            <mat-icon svgIcon=\"filter-remove\"></mat-icon>\n          </mat-button>\n          <mat-form-field [style.width.%]=\"bundle.width ? bundle.width : undefined\">\n            <div *ngIf=\"bundle.multiple; else notMulti\">\n              <mat-select\n                #selection [multiple]=\"bundle.multiple\" [placeholder]=\"bundle.title\" formControlName=\"selectMulti\">\n                <div class=\"checkboxes mat-typography\">\n                  <mat-checkbox *ngIf=\"bundle.multiple\"\n                    [(ngModel)]=\"selectAllSelected\" [ngModelOptions]=\"{standalone: true}\"\n                    (change)=\"toggleAllSelection()\">Tous\n                  </mat-checkbox>\n                </div>\n                <mat-option *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\" tooltip-position=\"below\" matTooltipDelay=\"500\" matTooltipClass=\"material-tooltip\"\n                  (onSelectionChange)=\"selectOptionClick($event.source.value, bundle, $event)\"\n                  [value]=\"ogcSelect\">{{ogcSelect.title}}\n                </mat-option>\n              </mat-select>\n            </div>\n            <ng-template #notMulti>\n              <mat-select\n                [placeholder]=\"bundle.title\" formControlName=\"select\">\n                <mat-option *ngFor=\"let ogcSelect of bundle.selectors\"\n                  [matTooltip]=\"getToolTip(ogcSelect)\" tooltip-position=\"below\" matTooltipDelay=\"500\" matTooltipClass=\"material-tooltip\"\n                  [value]=\"ogcSelect\" (onSelectionChange)=\"selectOptionClick($event.source.value, bundle)\">{{ogcSelect.title}}\n                </mat-option>\n              </mat-select>\n            </ng-template>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n\n    <div class=\"autocompleteGroups\" *ngIf=\"selector.selectorType === 'autocomplete'\">\n      <mat-divider></mat-divider>\n      <div class=\"groupsSelector\" *ngIf=\"getAutocompleteGroups().length > 1\">\n        <mat-form-field>\n          <mat-select\n            formControlName=\"autocompleteGroup\"\n            [matTooltip]=\"'igo.geo.layer.legend.selectStyle' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n            [(value)]=\"currentAutocompleteGroup\">\n            <mat-option *ngFor=\"let autocompleteGroup of getAutocompleteGroups()\"\n              [value]=\"autocompleteGroup\">{{autocompleteGroup.title}}\n            </mat-option>\n          </mat-select>\n        </mat-form-field>\n      </div>\n      <ng-container *ngFor=\"let bundle of currentAutocompleteGroup.computedSelectors\">\n        <h4>{{bundle.title}}</h4>\n        <div class=\"groupsSelector\">\n          <mat-button *ngIf=\"bundle.unfiltered\"\n            mat-icon-button\n            color=\"warn\"\n            [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" tooltip-position=\"below\" matTooltipShowDelay=\"500\"  matTooltipClass=\"material-tooltip\"\n            (click)=\"emptyAutocomplete()\">\n            <mat-icon svgIcon=\"filter-remove\"></mat-icon>\n          </mat-button>\n          <mat-form-field *ngIf=\"filteredOgcAutocomplete[bundle.id]\" [style.width.%]=\"bundle.width ? bundle.width : undefined\">\n            <input matInput type=\"text\" formControlName=\"autocomplete\" #autocomplete class=\"autocomplete\"\n              [matAutocomplete]=\"auto\" [placeholder]=\"bundle.title\">\n              <mat-autocomplete #auto=\"matAutocomplete\" #autocomplete (optionSelected)=\"autocompleteOptionClick($event.option.value)\"\n              [displayWith]=\"displayFn\">\n                <mat-option *ngFor=\"let ogcAutocomplete of filteredOgcAutocomplete[bundle.id] | async\" [value]=\"ogcAutocomplete\">\n                  {{ ogcAutocomplete.value }}\n                </mat-option>\n              </mat-autocomplete>\n          </mat-form-field>\n        </div>\n      </ng-container>\n    </div>\n  </div>\n</form>\n\n<div *ngIf=\"isTemporalOperator()\">\n  <mat-divider></mat-divider>\n  <h4 *ngIf=\"!currentFilter.title\">{{ 'igo.geo.filter.reportingDate' | translate }}</h4>\n  <h4 *ngIf=\"currentFilter.title\">{{ currentFilter.title }}</h4>\n  <igo-ogc-filter-time\n    [(datasource)]=\"datasource\"\n    [(currentFilter)]=\"currentFilter\"\n    (changeProperty)=\"changeProperty($event.value, $event.pos)\">\n  </igo-ogc-filter-time>\n</div>","import {\n  ChangeDetectorRef,\n  Component,\n  Input,\n  OnInit,\n  ViewChild\n} from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport { DOMService, DOMValue } from '@igo2/common';\n\nimport {\n  OgcFilterableDataSource,\n  IgoOgcFilterObject,\n  OgcPushButton,\n  OgcSelectorBundle,\n  SelectorGroup\n\n} from '../../filter/shared/ogc-filter.interface';\nimport { OgcFilterWriter } from '../../filter/shared/ogc-filter';\nimport { IgoMap } from '../../map';\nimport { OGCFilterService } from '../shared/ogc-filter.service';\nimport { WMSDataSource } from '../../datasource/shared/datasources/wms-datasource';\nimport { UntypedFormBuilder, UntypedFormGroup, Validators } from '@angular/forms';\nimport { debounceTime, map } from 'rxjs/operators';\nimport { OgcFilterOperator } from '../shared/ogc-filter.enum';\nimport { MatSelect } from '@angular/material/select';\nimport { MatOption } from '@angular/material/core';\nimport { BehaviorSubject, Observable } from 'rxjs';\n\n@Component({\n  selector: 'igo-ogc-filter-selection',\n  templateUrl: './ogc-filter-selection.component.html',\n  styleUrls: ['./ogc-filter-selection.component.scss'],\n  providers: [ DOMService ]\n})\nexport class OgcFilterSelectionComponent implements OnInit {\n\n  @ViewChild('selection') sel: MatSelect;\n\n  @Input() refreshFilters: () => void;\n\n  @Input() datasource: OgcFilterableDataSource;\n\n  @Input() map: IgoMap;\n\n  @Input() checkboxesIndex = 5;\n  @Input() radioButtonsIndex = 5;\n  @Input() baseIndex = 5;\n\n  @Input()\n  get currentFilter(): any {\n    return this._currentFilter;\n  }\n  set currentFilter(value) {\n    this._currentFilter = value;\n    if (this._currentFilter?.sliderOptions) {\n      this._currentFilter.sliderOptions.enabled = false; // remove slider toggle (animation temporelle)\n    }\n  }\n  private _currentFilter: any;\n\n  public ogcFilterOperator = OgcFilterOperator;\n\n  public form: UntypedFormGroup;\n  private ogcFilterWriter: OgcFilterWriter;\n  public color = 'primary';\n  public selectAllSelected = false;\n  public selectEnabled$ = new BehaviorSubject(undefined);\n  public selectEnableds$ = new BehaviorSubject([]);\n  public autocompleteEnabled$ = new BehaviorSubject(undefined);\n  public filteredOgcAutocomplete = {};\n\n  public applyFiltersTimeout;\n\n  get ogcFiltersSelectors() {\n    const ogcSelector = [];\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.pushButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.checkboxes);\n    }\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.radioButtons);\n    }\n    if (this.datasource?.options?.ogcFilters?.select) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.select);\n    }\n    if (this.datasource?.options?.ogcFilters?.autocomplete) {\n      ogcSelector.push(this.datasource?.options?.ogcFilters?.autocomplete);\n    }\n    ogcSelector.sort((a, b) => {\n      if (a.order < b.order) {\n        return -1;\n      }\n      if (a.order > b.order) {\n        return 1;\n      }\n      return 0;\n    });\n    return ogcSelector;\n  }\n\n  get currentPushButtonsGroup() {\n    return this.form.get('pushButtonsGroup').value;\n  }\n  set currentPushButtonsGroup(value) {\n    this.form.patchValue({ pushButtonsGroup: value });\n  }\n\n  get currentCheckboxesGroup() {\n    return this.form.get('checkboxesGroup').value;\n  }\n  set currentCheckboxesGroup(value) {\n    this.form.patchValue({ checkboxesGroup: value });\n  }\n\n  get currentRadioButtonsGroup() {\n    return this.form.get('radioButtonsGroup').value;\n  }\n  set currentRadioButtonsGroup(value) {\n    this.form.patchValue({ radioButtonsGroup: value });\n  }\n\n  get currentSelectGroup() {\n    return this.form.get('selectGroup').value;\n  }\n  set currentSelectGroup(value) {\n    this.form.patchValue({ selectGroup: value });\n    this.cdRef.detectChanges();\n  }\n\n  get currentAutocompleteGroup() {\n    return this.form.get('autocompleteGroup').value;\n  }\n  set currentAutocompleteGroup(value) {\n    this.form.patchValue({ autocompleteGroup: value });\n    this.cdRef.detectChanges();\n  }\n\n  get selectEnabled() {\n    return this.selectEnabled$.value;\n  }\n\n  set selectEnabled(value) {\n    this.selectEnabled$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors?.forEach(selector => {\n        value === selector ? selector.enabled = true : selector.enabled = false;\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  get selectEnableds() {\n    return this.selectEnableds$.value;\n  }\n\n  set selectEnableds(value) {\n    this.selectEnableds$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors?.forEach(selector => {\n        value.includes(selector) ? selector.enabled = true : selector.enabled = false;\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  get autocompleteEnabled() {\n    return this.autocompleteEnabled$.value;\n  }\n\n  set autocompleteEnabled(value) {\n    this.autocompleteEnabled$.next(value);\n    clearTimeout(this.applyFiltersTimeout);\n    this.currentAutocompleteGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors?.forEach(selector => {\n        value === selector.title ? selector.enabled = true : selector.enabled = false;\n      });\n    });\n\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  constructor(\n    private ogcFilterService: OGCFilterService,\n    private formBuilder: UntypedFormBuilder,\n    private domService: DOMService,\n    private configService: ConfigService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.ogcFilterWriter = new OgcFilterWriter();\n    this.buildForm();\n  }\n\n  private buildForm() {\n    this.form = this.formBuilder.group({\n      pushButtons: ['', [Validators.required]],\n      radioButtons: ['', [Validators.required]],\n      pushButtonsGroup: ['', [Validators.required]],\n      checkboxesGroup: ['', [Validators.required]],\n      radioButtonsGroup: ['', [Validators.required]],\n      selectGroup: ['', [Validators.required]],\n      select: ['', [Validators.required]],\n      selectMulti: ['', [Validators.required]],\n      autocompleteGroup: ['', [Validators.required]],\n      autocomplete: ['', [Validators.required]]\n    });\n  }\n\n  getPushButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.pushButtons) {\n      return this.datasource.options.ogcFilters.pushButtons.groups;\n    }\n  }\n\n  getCheckboxesGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.checkboxes) {\n      return this.datasource.options.ogcFilters.checkboxes.groups;\n    }\n  }\n\n  getRadioButtonsGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.radioButtons) {\n      return this.datasource.options.ogcFilters.radioButtons.groups;\n    }\n  }\n\n  getSelectGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.select) {\n      return this.datasource.options.ogcFilters.select.groups;\n    }\n  }\n\n  getAutocompleteGroups(): SelectorGroup[] {\n    if (this.datasource?.options?.ogcFilters?.autocomplete) {\n      return this.datasource.options.ogcFilters.autocomplete.groups;\n    }\n  }\n\n  async ngOnInit() {\n    if (this.datasource.options.ogcFilters) {\n      if (this.datasource.options.ogcFilters.pushButtons) {\n        this.currentPushButtonsGroup =\n          this.datasource.options.ogcFilters.pushButtons.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.pushButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.checkboxes) {\n        this.currentCheckboxesGroup =\n          this.datasource.options.ogcFilters.checkboxes.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.checkboxes.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.radioButtons) {\n        this.currentRadioButtonsGroup =\n          this.datasource.options.ogcFilters.radioButtons.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.radioButtons.groups[0];\n      }\n      if (this.datasource.options.ogcFilters.select) {\n        this.currentSelectGroup =\n          this.datasource.options.ogcFilters.select.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.select.groups[0];\n        this.getSelectEnabled();\n        await this.getSelectDomValues();\n      }\n      if (this.datasource.options.ogcFilters.autocomplete) {\n        this.currentAutocompleteGroup =\n          this.datasource.options.ogcFilters.autocomplete.groups.find(group => group.enabled) ||\n          this.datasource.options.ogcFilters.autocomplete.groups[0];\n        this.getAutocompleteEnabled();\n        await this.getAutocompleteDomValues();\n      }\n      this.applyFilters();\n    }\n\n    this.form\n    .get('pushButtonsGroup')\n    .valueChanges\n    .pipe(debounceTime(750))\n    .subscribe(() => {\n      this.onPushButtonsChangeGroup();\n      this.applyFilters();\n      });\n    this.form\n    .get('checkboxesGroup')\n    .valueChanges\n    .pipe(debounceTime(750))\n    .subscribe(() => {\n      this.onCheckboxesChangeGroup();\n      this.applyFilters();\n      });\n    this.form\n      .get('radioButtonsGroup')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onRadioButtonsChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('selectGroup')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onSelectChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('autocompleteGroup')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.onAutocompleteChangeGroup();\n        this.applyFilters();\n      });\n    this.form\n      .get('pushButtons')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n    this.form\n      .get('radioButtons')\n      .valueChanges\n      .pipe(debounceTime(750))\n      .subscribe(() => {\n        this.applyFilters();\n      });\n  }\n\n  private getSelectEnabled() {\n    const enableds = [];\n    let enabled;\n    this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n      if (compSelect.multiple) {\n        compSelect.selectors?.forEach(selector => {\n          if (selector.enabled) {\n            enableds.push(selector);\n          }\n        });\n        this.selectEnableds = enableds;\n        this.form.controls['selectMulti'].setValue(enableds);\n      } else {\n        compSelect.selectors?.forEach(selector => {\n          if (selector.enabled) {\n            enabled = selector;\n          }\n        });\n        this.form.controls['select'].reset(enabled);\n        this.selectEnabled$.subscribe((value) => {\n          if (this.form.controls['select'].value !== value) {\n            this.form.controls['select'].setValue(value);\n          }\n        });\n        this.selectEnabled = enabled;\n      }\n    });\n  }\n\n  private getAutocompleteEnabled() {\n    let enabled;\n    this.currentAutocompleteGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors?.forEach(selector => {\n        if (selector.enabled) {\n          const dom = {\n            id: selector.filters.expression,\n            value: selector.title\n          };\n          enabled = selector.title;\n          this.form.controls['autocomplete'].setValue(dom);\n        }\n      });\n      this.autocompleteEnabled = enabled;\n    });\n  }\n\n  getToolTip(selector): string {\n    let toolTip;\n    if (selector.tooltip) {\n      if (Array.isArray(selector.tooltip)) {\n        toolTip = selector.tooltip.join('\\n');\n      } else {\n        toolTip = selector.tooltip;\n      }\n    }\n    return toolTip || '';\n  }\n\n  async getSelectDomValues() {\n    for (const bundle of this.datasource.options.ogcFilters.select.bundles) {\n      if (bundle.domSelectors) {\n        let domValues;\n        for (const domSelector of bundle.domSelectors) {\n          let filterDOM;\n          for (const domOptions of this.configService.getConfig('dom')) {\n            if (domSelector.id === domOptions.id || domSelector.name === domOptions.name) {\n              filterDOM = {\n                id: domOptions.id,\n                url: domOptions.url,\n                name: domOptions.name,\n                values: domOptions.values\n              };\n            }\n          }\n          filterDOM.url ? domValues = await this.domService.getDom(filterDOM) as DOMValue[] :\n            domValues = filterDOM.values;\n\n          if (domValues) {\n            let newBundle = bundle;\n            newBundle.selectors = [];\n            let selector;\n            for (const value of domValues) {\n              if (bundle.multiple) {\n                let enabled;\n                this.selectEnableds?.find(sel => sel.title === value.value) ? enabled = true : enabled = false;\n                selector = {\n                  title: value.value,\n                  enabled,\n                  filters: {\n                    operator: domSelector.operator,\n                    propertyName: domSelector.propertyName,\n                    expression: value.id,\n                  }\n                };\n              } else {\n                selector = {\n                  title: value.value,\n                  enabled: this.selectEnabled?.title === value.value ?\n                    true : false,\n                  filters: {\n                    operator: domSelector.operator,\n                    propertyName: domSelector.propertyName,\n                    expression: value.id,\n                  }\n                };\n              }\n              newBundle.selectors.push(selector);\n            }\n            this.getSelectGroups().find(group => group.ids.includes(newBundle.id)).computedSelectors\n              .find(comp => comp.title === newBundle.title).selectors = newBundle.selectors;\n          }\n        }\n        this.getSelectEnabled();\n      }\n    }\n  }\n\n  async getAutocompleteDomValues() {\n    for (const bundle of this.datasource.options.ogcFilters.autocomplete.bundles) {\n      if (bundle.domSelectors) {\n        let domValues;\n        for (const domSelector of bundle.domSelectors) {\n          let filterDOM;\n          for (const domOptions of this.configService.getConfig('dom')) {\n            if (domSelector.id === domOptions.id || domSelector.name === domOptions.name) {\n              filterDOM = {\n                id: domOptions.id,\n                url: domOptions.url,\n                name: domOptions.name,\n                values: domOptions.values\n              };\n            }\n          }\n          filterDOM.url ? domValues = await this.domService.getDom(filterDOM) as DOMValue[] :\n            domValues = filterDOM.values;\n\n          if (domValues) {\n            let newBundle = bundle;\n            newBundle.selectors = [];\n            let selector;\n            for (const value of domValues) {\n              selector = {\n                title: value.value,\n                enabled: this.autocompleteEnabled && this.autocompleteEnabled === value.value ?\n                  true : false,\n                filters: {\n                  operator: domSelector.operator,\n                  propertyName: domSelector.propertyName,\n                  expression: value.id,\n                }\n              };\n              newBundle.selectors.push(selector);\n            }\n            this.getAutocompleteGroups().find(group => group.ids.includes(newBundle.id)).computedSelectors\n              .find(comp => comp.title === newBundle.title).selectors = newBundle.selectors;\n          }\n        }\n\n        this.filteredOgcAutocomplete[bundle.id] = new Observable<any[]>();\n        this.cdRef.detectChanges();\n        this.filteredOgcAutocomplete[bundle.id] = this.form.controls['autocomplete'].valueChanges.pipe(\n          map(value => {\n            if (value.length) {\n              return domValues?.filter((option) => {\n                const filterNormalized = value ? value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '') : '';\n                const featureNameNormalized = option.value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n                return featureNameNormalized.includes(filterNormalized);\n              });\n            }\n          })\n        );\n      }\n    }\n  }\n\n  // getButtonStyle(pb: OgcPushButton): {} {\n\n  //   let styles;\n  //   if (pb.color) {\n  //     styles = {\n  //       'background-color': pb.enabled ? `rgba(${pb.color})` : `rgba(255,255,255,0)`\n  //     };\n  //   } else {\n  //     styles = {\n  //       'background-color': pb.enabled ? 'accent': `rgba(255,255,255,0)`,\n  //       'color': pb.enabled ? `rgba(0,0,0,0.9)` : `rgba(33,33,33,0.38)`\n  //     }\n  //   }\n  //   return styles;\n  // }\n\n  getButtonColor(pushButton: OgcPushButton): {} {\n    let styles;\n    if (pushButton.color && pushButton.enabled) {\n      styles = {\n        'background-color': `rgba(${pushButton.color})`\n      };\n    }\n    return styles;\n  }\n\n  bundleIsVertical(bundle: OgcSelectorBundle): boolean {\n    return bundle.vertical ? bundle.vertical : false;\n  }\n\n  private onPushButtonsChangeGroup() {\n    this.getPushButtonsGroups().map(group => group.enabled = false);\n    this.getPushButtonsGroups().find(group => group === this.currentPushButtonsGroup).enabled = true;\n  }\n\n  private onCheckboxesChangeGroup() {\n    this.getCheckboxesGroups().map(group => group.enabled = false);\n    this.getCheckboxesGroups().find(group => group === this.currentCheckboxesGroup).enabled = true;\n  }\n\n  private onRadioButtonsChangeGroup() {\n    this.getRadioButtonsGroups().map(group => group.enabled = false);\n    this.getRadioButtonsGroups().find(group => group === this.currentRadioButtonsGroup).enabled = true;\n  }\n\n  private onSelectChangeGroup() {\n    this.getSelectGroups().map(group => group.enabled = false);\n    this.getSelectGroups().find(group => group === this.currentSelectGroup).enabled = true;\n  }\n\n  private onAutocompleteChangeGroup() {\n    this.getAutocompleteGroups().map(group => group.enabled = false);\n    this.getAutocompleteGroups().find(group => group === this.currentAutocompleteGroup).enabled = true;\n  }\n\n  onSelectionChange(currentOgcSelection?, selectorType?) {\n    clearTimeout(this.applyFiltersTimeout);\n    if (selectorType === 'radioButton') {\n      this.emptyRadioButtons();\n    }\n\n    if (currentOgcSelection) {\n      currentOgcSelection.enabled = !currentOgcSelection.enabled;\n    }\n    this.applyFiltersTimeout = setTimeout(() => {\n      this.applyFilters();\n    }, 750);\n  }\n\n  emptyRadioButtons() {\n    this.currentRadioButtonsGroup.computedSelectors.forEach(compSelect => {\n      compSelect.selectors.map(selector => selector.enabled = false);\n\n      this.applyFiltersTimeout = setTimeout(() => {\n        this.applyFilters();\n      }, 750);\n   });\n  }\n\n  emptySelect() {\n    this.selectEnabled = undefined;\n  }\n\n  emptyAutocomplete() {\n    this.autocompleteEnabled = undefined;\n    this.form.controls['autocomplete'].setValue('');\n    this.form.controls['autocomplete'].markAsUntouched();\n  }\n\n  toggleAllSelection() {\n    if (this.selectAllSelected) {\n      const enableds = [];\n      this.currentSelectGroup.computedSelectors.forEach(compSelect => {\n        compSelect.selectors?.forEach(selector => {\n          enableds.push(selector);\n        });\n      });\n      this.sel.options.forEach((item: MatOption) => item.select());\n      this.selectEnableds = enableds;\n    } else {\n      this.sel.options.forEach((item: MatOption) => item.deselect());\n      this.selectEnableds = [];\n    }\n  }\n\n  selectOptionClick(value, bundle, event?) {\n    if (bundle.multiple) {\n      const enableds = this.selectEnableds;\n      let newStatus = true;\n      this.sel.options.forEach((item: MatOption) => {\n        if (!item.selected) {\n          newStatus = false;\n        }\n      });\n      this.selectAllSelected = newStatus;\n      if (event.isUserInput) {\n        if (enableds.length) {\n          for (const enabled of enableds) {\n            if (enabled.title === value.title) {\n              if (enabled.enabled && value.enabled) {\n                enableds.splice(enableds.indexOf(enabled), 1);\n                this.selectEnableds = enableds;\n                break;\n              }\n            } else if (enableds.indexOf(enabled) === enableds.length - 1) {\n              enableds.push(value);\n              this.selectEnableds = enableds;\n              break;\n            }\n          }\n        } else {\n          enableds.push(value);\n          this.selectEnableds = enableds;\n        }\n      }\n    } else {\n      this.selectEnabled = value;\n    }\n  }\n\n  autocompleteOptionClick(value) {\n    this.autocompleteEnabled = value.value;\n  }\n\n  displayFn(dom): string {\n    return dom ? dom.value : undefined;\n  }\n\n  private applyFilters() {\n    let filterQueryString = '';\n    const conditions = [];\n    const currentGroups = [this.currentPushButtonsGroup, this.currentCheckboxesGroup,\n      this.currentRadioButtonsGroup, this.currentSelectGroup, this.currentAutocompleteGroup];\n    for (const currentGroup of currentGroups) {\n      if (currentGroup.computedSelectors) {\n        currentGroup.computedSelectors.map(selectorBundle => {\n          const bundleCondition = [];\n          selectorBundle.selectors?.filter(ogcSelector => ogcSelector.enabled === true)\n          .forEach(enabledSelector => bundleCondition.push(enabledSelector.filters));\n          if (bundleCondition.length >= 1 ) {\n            if (bundleCondition.length === 1) {\n              conditions.push(bundleCondition[0]);\n            } else {\n              conditions.push({logical: selectorBundle.logical, filters: bundleCondition});\n            }\n          }\n        });\n      }\n    }\n    if (this.isTemporalOperator() && this._currentFilter.active) {\n      conditions.push(this.datasource.options.ogcFilters.interfaceOgcFilters[0]);\n    }\n    if (conditions.length >= 1) {\n      filterQueryString = this.ogcFilterWriter\n        .buildFilter(conditions.length === 1 ?\n          conditions[0] : {logical: 'And', filters: conditions } as IgoOgcFilterObject);\n    }\n    if (this.datasource.options.type === 'wms') {\n      this.ogcFilterService.filterByOgc(this.datasource as WMSDataSource, filterQueryString );\n    }\n    if (this.datasource.options.type === 'wfs') {\n      // TODO: Check how to prevent wfs to refresh when filter icon is pushed...\n      this.datasource.ol.refresh();\n    }\n    this.datasource.setOgcFilters(this.datasource.options.ogcFilters, true);\n  }\n\n  isMoreResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index = type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return selectorsLength > index;\n  }\n\n  displayMoreResults(type) {\n    type === 'radio' ? this.radioButtonsIndex += 5 : this.checkboxesIndex += 5;\n    return;\n  }\n\n  isLessResults(bundle, type) {\n    let selectorsLength = 0;\n    for (const selectors of bundle.selectors) {\n      selectorsLength++;\n    }\n    const index = type === 'radio' ? this.radioButtonsIndex : this.checkboxesIndex;\n    return this.baseIndex !== index && selectorsLength > this.baseIndex;\n  }\n\n  displayLessResults(type) {\n    type === 'radio' ? this.radioButtonsIndex = this.baseIndex : this.checkboxesIndex = this.baseIndex;\n    return;\n  }\n\n  isTemporalOperator() {\n    return (\n      this.currentFilter?.operator?.toLowerCase() ===\n      this.ogcFilterOperator.During.toLowerCase()\n    );\n  }\n\n  changeProperty(value: any, pos?: number, refreshFilter = true) {\n    const detectedProperty = this.detectProperty(pos);\n    if (detectedProperty) {\n      this.datasource.options.ogcFilters.interfaceOgcFilters.find(\n        filter => filter.filterid === this.currentFilter.filterid\n      )[detectedProperty] = value;\n\n      if ( refreshFilter ) {\n        this.applyFilters();\n      }\n    }\n  }\n\n  detectProperty(pos?: number): string {\n    switch (this.currentFilter.operator) {\n      case OgcFilterOperator.PropertyIsNotEqualTo:\n      case OgcFilterOperator.PropertyIsEqualTo:\n      case OgcFilterOperator.PropertyIsGreaterThan:\n      case OgcFilterOperator.PropertyIsGreaterThanOrEqualTo:\n      case OgcFilterOperator.PropertyIsLessThan:\n      case OgcFilterOperator.PropertyIsLessThanOrEqualTo:\n        return 'expression';\n      case OgcFilterOperator.PropertyIsLike:\n        return 'pattern';\n      case OgcFilterOperator.PropertyIsBetween:\n        return pos && pos === 1\n          ? 'lowerBoundary'\n          : pos && pos === 2\n          ? 'upperBoundary'\n          : undefined;\n      case OgcFilterOperator.During:\n        return pos && pos === 1\n          ? 'begin'\n          : pos && pos === 2\n          ? 'end'\n          : undefined;\n      default:\n        return;\n    }\n  }\n}\n","<mat-tab-group\n  [selectedIndex]=\"selectedTypeIndex.value\"\n  (selectedIndexChange)=\"selectedTypeIndex.setValue($event)\"\n  (selectedTabChange)=\"onTypeChange($event)\">\n\n  <mat-tab [label]=\"'igo.geo.spatialFilter.predefined' |translate\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.spatialFilter.searchLabel' | translate}}</mat-label>\n      <mat-select (selectionChange)=\"onSelectionChange()\" [(value)]=\"selectedQueryType\">\n        <mat-option *ngFor=\"let queryType of queryType\" [value]=\"queryType\">\n          {{('igo.geo.terrapi.' + queryType) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n    <igo-spatial-filter-list\n      [store]=\"store\"\n      [queryType]=\"selectedQueryType\"\n      [zone]=\"zone\"\n      [layers]=\"layers\"\n      (zoneChange)=\"zoneChange.emit($event)\"\n      (zoneWithBufferChange)=\"zoneWithBufferChange.emit($event)\"\n      (bufferChange)=\"bufferChange.emit($event)\"\n      (measureUnitChange)=\"measureUnitChange.emit($event)\">\n    </igo-spatial-filter-list>\n  </mat-tab>\n\n  <mat-tab [label]=\"'igo.geo.spatialFilter.draw' |translate\">\n    <div class=\"spatial-type-toggle\">\n      <mat-button-toggle-group\n        [value]=\"activeDrawType\"\n        (change)=\"onDrawTypeChange($event.value)\">\n        <mat-button-toggle [value]=\"spatialType.Polygon\" [matTooltip]=\"'igo.geo.spatialFilter.drawPolygon' |translate\">\n            <mat-icon svgIcon=\"pentagon-outline\"></mat-icon>\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"spatialType.Point\" [matTooltip]=\"'igo.geo.spatialFilter.drawCircle' |translate\">\n            <mat-icon svgIcon=\"record-circle-outline\"></mat-icon>\n        </mat-button-toggle>\n      </mat-button-toggle-group>\n    </div>\n  </mat-tab>\n\n</mat-tab-group>\n","import {\n  Component,\n  Input,\n  OnInit,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { SpatialFilterQueryType, SpatialFilterType } from '../../shared/spatial-filter.enum';\nimport { UntypedFormControl } from '@angular/forms';\nimport { EntityStore } from '@igo2/common';\nimport { Feature } from '../../../feature';\nimport { MeasureLengthUnit } from '../../../measure';\nimport { Layer } from '../../../layer';\n\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'igo-spatial-filter-type',\n  templateUrl: './spatial-filter-type.component.html',\n  styleUrls: ['./spatial-filter-type.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterTypeComponent implements OnInit {\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  public queryType: string[] = ['Arrond', 'CircFed', 'CircProv', 'DirReg', 'Mun', 'MRC', 'AdmRegion', 'RegTour'];\n  public selectedTypeIndex = new UntypedFormControl(0);\n\n  /**\n   * Reference to the SpatialFIlterType enum\n   * @internal\n   */\n  public spatialType = SpatialFilterType;\n\n  public activeDrawType: SpatialFilterType = this.spatialType.Polygon;\n\n  @Input() selectedQueryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() layers: Layer[] = [];\n\n  public type: SpatialFilterType;\n\n  @Output() eventType = new EventEmitter<SpatialFilterType>();\n\n  @Output() eventQueryType = new EventEmitter<SpatialFilterQueryType>();\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  constructor() {}\n\n  ngOnInit() {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = this.spatialType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onTypeChange(event) {\n    if (this.selectedTypeIndex.value === 0) {\n      this.type = SpatialFilterType.Predefined;\n    }\n    if (this.selectedTypeIndex.value === 1) {\n      this.type = this.activeDrawType;\n    }\n    this.eventType.emit(this.type);\n  }\n\n  onDrawTypeChange(spatialType: SpatialFilterType) {\n    this.activeDrawType = spatialType;\n    this.eventType.emit(this.activeDrawType);\n  }\n\n  onSelectionChange() {\n    this.eventQueryType.emit(this.selectedQueryType);\n    this.zoneChange.emit(undefined);\n  }\n}\n","<form class=\"form-list\">\n    <mat-form-field class=\"zone-list\">\n        <input #input type=\"text\" placeholder=\"{{'igo.geo.spatialFilter.listLabel' |translate}}\" matInput\n        [formControl]=\"formControl\" [matAutocomplete]=\"auto\">\n        <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)=\"onZoneChange($event.option.value)\"\n        [displayWith]=\"displayFn\">\n            <mat-option *ngFor=\"let entities of this.store.view.all$() | async\" [value]=\"entities\">\n                {{entities.properties.nom}}\n            </mat-option>\n        </mat-autocomplete>\n    </mat-form-field>\n<form>\n\n<div class=\"buffer-div\">\n    <form class=\"buffer-form\">\n        <mat-form-field class=\"buffer\">\n            <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.buffer' | translate}}\" [formControl]=\"bufferFormControl\"\n            [value]=\"0\" [readonly]=\"!zone\">\n        </mat-form-field>\n    </form>\n\n    <mat-form-field class=\"unit-field\">\n        <mat-select\n        [value]=\"measureUnit\"\n        (selectionChange)=\"onMeasureUnitChange($event.value)\">\n        <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n            {{('igo.geo.measure.' + measureUnit) | translate}}\n        </mat-option>\n        </mat-select>\n    </mat-form-field>\n</div>\n","import { debounceTime, distinctUntilChanged } from 'rxjs/operators';\nimport { EntityStore } from '@igo2/common';\nimport { SpatialFilterService } from './../../shared/spatial-filter.service';\nimport { SpatialFilterQueryType, SpatialFilterType } from './../../shared/spatial-filter.enum';\nimport {\n  Component,\n  Input,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Output,\n  EventEmitter\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { UntypedFormControl } from '@angular/forms';\nimport { Feature } from '../../../feature';\nimport { MeasureLengthUnit } from '../../../measure/shared';\nimport { LanguageService, MessageService } from '@igo2/core';\nimport { Layer } from '../../../layer';\n\n@Component({\n  selector: 'igo-spatial-filter-list',\n  templateUrl: './spatial-filter-list.component.html',\n  styleUrls: ['./spatial-filter-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterListComponent implements OnInit, OnDestroy {\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n  }\n  private _store: EntityStore<Feature>;\n\n  @Input()\n  get queryType(): SpatialFilterQueryType {\n    return this._queryType;\n  }\n  set queryType(queryType: SpatialFilterQueryType) {\n    this.formControl.setValue('');\n    this._queryType = queryType;\n  }\n  private _queryType: SpatialFilterQueryType;\n\n  @Input()\n  get zone() {\n    return this._zone;\n  }\n  set zone(value) {\n    this._zone = value;\n    if (!value) {\n      this.zoneWithBuffer = undefined;\n      this.bufferFormControl.setValue(0);\n    }\n  }\n  private _zone;\n\n  @Input() layers: Layer[] = [];\n\n  public zoneWithBuffer;\n  public selectedZone: any;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n\n  public formControl = new UntypedFormControl();\n\n  public bufferFormControl = new UntypedFormControl();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Output() zoneChange = new EventEmitter<Feature>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() bufferChange = new EventEmitter<number>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  formValueChanges$$: Subscription;\n  bufferValueChanges$$: Subscription;\n\n  constructor(\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService,\n    private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.formValueChanges$$ = this.formControl.valueChanges.subscribe((value) => {\n      if (value.length) {\n        this.store.view.filter((feature) => {\n          const filterNormalized = value.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n          const featureNameNormalized = feature.properties.nom.toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');\n          return featureNameNormalized.includes(filterNormalized);\n        });\n      }\n    });\n\n    this.bufferValueChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(\n        debounceTime(500),\n        distinctUntilChanged()\n      )\n      .subscribe((value) => {\n        if (this.measureUnit === MeasureLengthUnit.Meters && value > 0 && value <= 100000) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.selectedZone,\n            SpatialFilterType.Predefined,\n            value,\n            this.queryType\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (this.measureUnit === MeasureLengthUnit.Kilometers && value > 0 && value <= 100) {\n          this.bufferChange.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.selectedZone,\n            SpatialFilterType.Predefined,\n            value * 1000,\n            this.queryType\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (value === 0 && this.layers.length > 0) {\n          this.bufferChange.emit(value);\n          this.zoneWithBufferChange.emit(this.selectedZone);\n        } else if (\n            value < 0 ||\n            (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n            (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)) {\n            this.bufferFormControl.setValue(0);\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.bufferAlert'),\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n        }\n    });\n  }\n\n  ngOnDestroy() {\n    this.formValueChanges$$.unsubscribe();\n  }\n\n  displayFn(feature?: Feature): string | undefined {\n    return feature ? feature.properties.nom : undefined;\n  }\n\n  onZoneChange(feature) {\n    if (feature && this.queryType) {\n      this.spatialFilterService.loadItemById(feature, this.queryType)\n      .subscribe((featureGeom: Feature) => {\n        this.selectedZone = featureGeom;\n        this.zoneChange.emit(featureGeom);\n      });\n    }\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      this.measureUnit === MeasureLengthUnit.Meters ?\n        this.bufferFormControl.setValue(this.bufferFormControl.value * 1000) :\n        this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\n    }\n  }\n}\n","<igo-geometry-form-field-input\n  [formControl]=\"formControl\"\n  [map]=\"map\"\n  [geometryType]=\"geometryType\"\n  [drawGuide]=\"drawGuide$ | async\"\n  [measure]=\"measure\"\n  [drawControlIsActive]=\"drawControlIsActive\"\n  [freehandDrawIsActive]=\"freehandDrawIsActive\"\n  [drawStyle]=\"drawStyle$ | async\"\n  [overlayStyle]=\"overlayStyle$ | async\"\n  [radius]=\"radius\"\n  [predefinedRadius]=\"predefinedRadius\">\n</igo-geometry-form-field-input>\n\n<div class=\"header\">\n    <mat-slide-toggle *ngIf=\"!isPredefined()\"\n      [checked]=\"drawControlIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onDrawControlChange()\">\n      {{'igo.geo.spatialFilter.drawControl' | translate}}\n    </mat-slide-toggle>\n    <mat-slide-toggle *ngIf=\"!isPredefined()\"\n      [checked]=\"freehandDrawIsActive\"\n      [labelPosition]=\"'before'\"\n      (change)=\"onfreehandControlChange()\">\n      {{'igo.geo.spatialFilter.freehandControl' | translate}}\n    </mat-slide-toggle>\n</div>\n\n<div class=\"buffer-unit\" *ngIf=\"isPolygon()\">\n  <form class=\"buffer-form\">\n    <mat-form-field class=\"buffer\">\n      <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.buffer' | translate}}\" [formControl]=\"bufferFormControl\"\n      [value]=\"0\" [readonly]=\"this.formControl.value === null\">\n    </mat-form-field>\n  </form>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n    [value]=\"measureUnit\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n        {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<div class=\"radius-unit\" *ngIf=\"isPoint()\">\n  <form class=\"radius-form\">\n    <mat-form-field class=\"radius\">\n      <input type=\"number\" matInput placeholder=\"{{'igo.geo.spatialFilter.radius' | translate}}\" [formControl]=\"radiusFormControl\"\n      [value]=\"1000\" (input)=\"getRadius()\" [readonly]=\"this.freehandDrawIsActive && this.formControl.value === null\">\n    </mat-form-field>\n  </form>\n\n  <mat-form-field class=\"unit-field\">\n    <mat-select\n    [value]=\"measureUnit\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n        {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n    </mat-select>\n  </mat-form-field>\n</div>\n\n<mat-label class=\"title mat-typography\">{{'igo.geo.spatialFilter.search' | translate}} : </mat-label>\n<mat-radio-group [value]=\"selectedItemType\">\n    <mat-radio-button *ngFor=\"let item of itemType\"\n      [value]=\"item\"\n      (change)=\"onItemTypeChange($event)\">\n      {{'igo.geo.spatialFilter.' + item | translate}}\n    </mat-radio-button>\n</mat-radio-group>\n\n<div class=\"thematics\" *ngIf=\"(selectedItemType==='Thematics' && !tableTemplate) || (selectedItemType==='Thematics' && tableTemplate && !listIsVisible)\">\n  <mat-table>\n      <!-- Name Column -->\n      <ng-container matColumnDef=\"name\">\n        <mat-header-cell *matHeaderCellDef class=\"thematics-header\">{{'igo.geo.spatialFilter.Thematics' | translate}}</mat-header-cell>\n      </ng-container>\n\n      <!-- Select Column -->\n      <ng-container matColumnDef=\"select\">\n        <mat-header-cell *matHeaderCellDef class=\"checks-header\">\n          <mat-checkbox (change)=\"$event ? masterToggle() : null\"\n                        [checked]=\"isAllSelected()\"\n                        [indeterminate]=\"selectedThematics.hasValue() && !isAllSelected()\">\n          </mat-checkbox>\n        </mat-header-cell>\n    </ng-container>\n\n    <mat-header-row *matHeaderRowDef=\"displayedColumns\"></mat-header-row>\n    <mat-row *matRowDef=\"let row; columns: displayedColumns;\"></mat-row>\n\n  </mat-table>\n\n  <mat-tree [dataSource]=\"dataSource\" [treeControl]=\"treeControl\">\n    <!-- This is the tree node template for leaf nodes -->\n    <mat-tree-node *matTreeNodeDef=\"let node\" matTreeNodeToggle>\n      <li class=\"mat-tree-node\">\n        <!-- use a disabled button to provide padding for tree leaf -->\n        <button mat-icon-button disabled></button>\n        {{node.name}}\n        <mat-checkbox class=\"tree-check\" (click)=\"$event.stopPropagation()\"\n                      (change)=\"$event ? onToggleChange(node) : null\"\n                      [checked]=\"selectedThematics.isSelected(node)\">\n        </mat-checkbox>\n      </li>\n    </mat-tree-node>\n\n    <!-- This is the tree node template for expandable nodes -->\n    <mat-nested-tree-node *matTreeNodeDef=\"let node; when: hasChild\">\n        <div class=\"mat-tree-node\">\n          <button mat-icon-button\n            (click)=\"onToggleClick(node)\">\n            <mat-icon [svgIcon]=\"treeControl.isExpanded(node) ? 'chevron-down' : 'chevron-right'\"></mat-icon>\n          </button>\n          {{node.name}}\n          <mat-checkbox class=\"tree-check-2\" (change)=\"$event ? childrensToggle(node) : null\"\n                        [checked]=\"isAllSelected(node)\"\n                        [indeterminate]=\"hasChildrenSelected(node) && !isAllSelected(node)\">\n          </mat-checkbox>\n        </div>\n        <ul class=\"tree-ul\" [class.example-tree-invisible]=\"!treeControl.isExpanded(node)\">\n          <ng-container matTreeNodeOutlet></ng-container>\n        </ul>\n    </mat-nested-tree-node>\n\n  </mat-tree>\n</div>\n\n<div class=\"buttons\">\n\n  <button *ngIf=\"isPredefined()\" mat-raised-button class=\"clear-search-button\" [disabled]=\"disabledClearSearch()\"\n    (click)=\"clearSearch()\">\n      {{'igo.geo.spatialFilter.clearSearch' | translate}}\n  </button>\n\n  <button *ngIf=\"isPolygon() || isPoint()\" mat-raised-button class=\"clear-form-button\" [disabled]=\"this.formControl.value === null\"\n    (click)=\"clearDrawZone()\">\n    {{'igo.geo.spatialFilter.clearForm' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"search-button\" [disabled]=\"disableSearchButton()\" color=\"primary\"\n    (click)=\"toggleSearchButton()\">\n    {{'igo.geo.spatialFilter.goSearch' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"remove-button\" [disabled]=\"allLayers.length === 0\" (click)=\"clearButton()\">\n    {{'igo.geo.spatialFilter.removeLayer' | translate}}\n  </button>\n\n  <button mat-raised-button class=\"export-button\" [disabled]=\"!store.entities$.getValue().length\" (click)=\"export.emit()\">\n    {{'igo.geo.spatialFilter.exportLayer' | translate}}\n  </button>\n\n</div>\n\n<button\n  class=\"chevron-down\"\n  *ngIf=\"store.all().length && tableTemplate && !listIsVisible\"\n  mat-icon-button\n  matTooltipShowDelay=\"500\"\n  [matTooltip]=\"'igo.geo.spatialFilter.showSearchResults' | translate\"\n  (click)=\"toggleVisibleList()\">\n  <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n</button>\n\n<div class=\"results\" *ngIf=\"store.all().length && tableTemplate && listIsVisible\">\n  <button\n    *ngIf=\"listIsVisible\"\n    mat-icon-button\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.spatialFilter.hideSearchResults' | translate\"\n    (click)=\"toggleVisibleList()\">\n  <mat-icon svgIcon=\"chevron-up\"></mat-icon>\n  </button>\n  <igo-entity-table\n    class=\"results-list\"\n    [template]=\"tableTemplate\"\n    [store]=\"store\"\n    (entitySelectChange)=\"entityChange.emit($event)\">\n  </igo-entity-table>\n</div>\n","import OlFeature from 'ol/Feature';\nimport {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  OnInit\n} from '@angular/core';\nimport { SpatialFilterQueryType, SpatialFilterType } from '../../shared/spatial-filter.enum';\nimport { SelectionModel } from '@angular/cdk/collections';\nimport { IgoMap } from '../../../map';\nimport { SpatialFilterItemType } from './../../shared/spatial-filter.enum';\nimport { Feature } from './../../../feature/shared/feature.interfaces';\nimport { UntypedFormControl } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport type { Type } from 'ol/geom/Geometry';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { GeoJSONGeometry } from '../../../geometry/shared/geometry.interfaces';\nimport * as olStyle from 'ol/style';\nimport * as olproj from 'ol/proj';\nimport OlPoint from 'ol/geom/Point';\nimport { MatTreeNestedDataSource } from '@angular/material/tree';\nimport { SpatialFilterService } from '../../shared/spatial-filter.service';\nimport { MeasureLengthUnit } from '../../../measure';\nimport { EntityStore, EntityStoreFilterSelectionStrategy, EntityTableColumnRenderer, EntityTableTemplate } from '@igo2/common';\nimport { Layer, VectorLayer } from '../../../layer/shared';\nimport { NestedTreeControl } from '@angular/cdk/tree';\nimport { SpatialFilterThematic } from './../../shared/spatial-filter.interface';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { FeatureMotion, FeatureStoreSelectionStrategy } from '../../../feature';\nimport { FeatureDataSource } from '../../../datasource/shared';\n\n/**\n * Spatial-Filter-Item (search parameters)\n */\n@Component({\n  selector: 'igo-spatial-filter-item',\n  templateUrl: './spatial-filter-item.component.html',\n  styleUrls: ['./spatial-filter-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SpatialFilterItemComponent implements OnDestroy, OnInit {\n\n  @Input() map: IgoMap;\n\n  @Input()\n  get type(): SpatialFilterType {\n    return this._type;\n  }\n  set type(type: SpatialFilterType) {\n    this._type = type;\n    const index = this.geometryTypes.findIndex(geom => geom === this.type);\n    this.geometryType = this.geometryTypes[index];\n    this.formControl.reset();\n    this.radius = undefined;\n    this.drawGuide$.next(null);\n    this.drawStyle$.next(undefined);\n\n    // Necessary to keep reference to the geometry form field input\n    if (this.type === SpatialFilterType.Predefined) {\n      const geojson: GeoJSONGeometry = {\n        type: 'Point',\n        coordinates: ''\n      };\n      this.formControl.setValue(geojson);\n    }\n\n    // Necessary to apply the right style when geometry type is Point\n    if (this.type === SpatialFilterType.Point) {\n      this.radius = 1000; // Base radius\n      this.radiusFormControl.setValue(this.radius);\n      this.PointStyle = (feature: OlFeature<OlGeometry>, resolution: number) => {\n        const geom = feature.getGeometry() as OlPoint;\n        const coordinates = olproj.transform(geom.getCoordinates(), this.map.projection, 'EPSG:4326');\n        return new olStyle.Style ({\n          image: new olStyle.Circle ({\n            radius: this.radius / (Math.cos((Math.PI / 180) * coordinates[1])) / resolution, // Latitude correction\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          })\n        });\n      };\n      this.overlayStyle = this.PointStyle;\n      this.drawStyle$.next(this.overlayStyle);\n    } else {\n      // If geometry types is Polygon\n      this.radius = undefined;\n      this.PolyStyle = () => {\n        return new olStyle.Style ({\n          stroke: new olStyle.Stroke({\n            width: 2,\n            color: 'rgba(0, 153, 255)'\n          }),\n          fill: new olStyle.Fill({\n            color: 'rgba(0, 153, 255, 0.2)'\n          })\n        });\n      };\n      const color = [0, 153, 255];\n      const drawStyle = () => {\n        return new olStyle.Style({\n          image: new olStyle.Circle ({\n            radius: 8,\n            stroke: new olStyle.Stroke({\n              width: 2,\n              color: 'rgba(0, 153, 255)'\n            }),\n            fill: new olStyle.Fill({\n              color: 'rgba(0, 153, 255, 0.2)'\n            })\n          }),\n          stroke: new olStyle.Stroke({\n            color: color.concat([1]),\n            width: 2\n          }),\n          fill:  new olStyle.Fill({\n            color: color.concat([0.2])\n          })\n        });\n      };\n      this.overlayStyle = this.PolyStyle;\n      this.drawStyle$.next(drawStyle);\n    }\n    this.overlayStyle$.next(this.overlayStyle);\n  }\n  private _type: SpatialFilterType;\n\n  @Input() queryType: SpatialFilterQueryType;\n\n  @Input() zone: Feature;\n\n  @Input() loading;\n\n  @Input()\n  get store(): EntityStore<Feature> {\n    return this._store;\n  }\n  set store(store: EntityStore<Feature>) {\n    this._store = store;\n    this._store.entities$.subscribe(() => { this.cdRef.detectChanges(); });\n  }\n  private _store: EntityStore<Feature>;\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    return [MeasureLengthUnit.Meters, MeasureLengthUnit.Kilometers];\n  }\n\n  @Input() layers: Layer[] = [];\n\n  @Input() allLayers: Layer[] = [];\n\n  @Input()\n  get thematicLength(): number {\n    return this._thematicLength;\n  }\n  set thematicLength(value: number) {\n    this._thematicLength = value;\n  }\n  private _thematicLength: number;\n\n  @Output() toggleSearch = new EventEmitter();\n\n  @Output() itemTypeChange = new EventEmitter<SpatialFilterItemType>();\n\n  @Output() thematicChange = new EventEmitter<SpatialFilterThematic[]>();\n\n  @Output() drawZoneEvent = new EventEmitter<Feature>();\n\n  @Output() bufferEvent = new EventEmitter<number>();\n  @Output() zoneWithBufferChange = new EventEmitter<Feature>();\n  @Output() measureUnitChange = new EventEmitter<MeasureLengthUnit>();\n\n  @Output() radiusEvent = new EventEmitter<number>();\n  @Output() freehandControl = new EventEmitter<boolean>();\n  @Output() predefinedRadius = new EventEmitter<boolean>();\n\n  @Output() clearButtonEvent = new EventEmitter();\n\n  @Output() clearSearchEvent = new EventEmitter();\n\n  @Output() export = new EventEmitter();\n\n  @Output() openWorkspace = new EventEmitter();\n  @Output() entityChange = new EventEmitter<any>();\n\n  public itemType: SpatialFilterItemType[] = [SpatialFilterItemType.Address, SpatialFilterItemType.Thematics];\n  public selectedItemType: SpatialFilterItemType = SpatialFilterItemType.Address;\n  public selectedSourceAddress;\n\n  treeControl: NestedTreeControl<SpatialFilterThematic> = new NestedTreeControl<SpatialFilterThematic>(node => node.children);\n\n  // For thematics and results tables\n  public displayedColumns: string[] = ['name', 'select'];\n  public childrens: SpatialFilterThematic[] = [];\n  public groups: string[] = [];\n  public thematics: SpatialFilterThematic[] = [];\n  public dataSource = new MatTreeNestedDataSource<SpatialFilterThematic>();\n  public selectedThematics = new SelectionModel<SpatialFilterThematic>(true, []);\n\n  // For geometry form field input\n  value$: BehaviorSubject<GeoJSONGeometry> = new BehaviorSubject(undefined);\n  drawGuide$: BehaviorSubject<number> = new BehaviorSubject(null);\n  overlayStyle$: BehaviorSubject<olStyle.Style | ((feature, resolution) => olStyle.Style)> = new BehaviorSubject(undefined);\n  drawStyle$: BehaviorSubject<olStyle.Style | ((feature, resolution) => olStyle.Style)> = new BehaviorSubject(undefined);\n\n  private value$$: Subscription;\n  private radiusChanges$$: Subscription;\n  private bufferChanges$$: Subscription;\n\n  public formControl = new UntypedFormControl();\n  public geometryType: Type | string;\n  public geometryTypeField = false;\n  public geometryTypes: string[] = ['Point', 'Polygon'];\n  public drawGuideField = false;\n  public drawGuide: number = null;\n  public drawGuidePlaceholder = '';\n  public measure = false;\n  public drawControlIsActive = true;\n  public freehandDrawIsActive = false;\n  public drawStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public drawZone;\n  public overlayStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PointStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n  public PolyStyle: olStyle.Style | ((feature, resolution) => olStyle.Style);\n\n  public radius: number;\n  public buffer: number = 0;\n  public radiusFormControl = new UntypedFormControl();\n  public bufferFormControl = new UntypedFormControl();\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  public zoneWithBuffer;\n\n  public listIsVisible = true;\n  public tableTemplate: EntityTableTemplate;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private spatialFilterService: SpatialFilterService,\n    private messageService: MessageService,\n    private languageService: LanguageService) {}\n\n  ngOnInit() {\n    this.spatialFilterService.loadThematicsList()\n    .subscribe((items: SpatialFilterThematic[]) => {\n      for (const item of items) {\n        this.childrens.push(item);\n        this.childrens.sort((a, b) => {\n          return a.name.localeCompare(b.name);\n        });\n      }\n      this.groups.push(this.languageService.translate.instant('igo.geo.terrapi.limites'));\n      const limits: SpatialFilterThematic = {\n        name: this.groups[0],\n        children: []\n      };\n      this.thematics.push(limits);\n      this.childrens.forEach(child => {\n        if (child.group && (this.groups.indexOf(child.group) === -1)) {\n          this.groups.push(child.group);\n          const thematic: SpatialFilterThematic = {\n            name: child.group,\n            children: []\n          };\n          this.thematics.push(thematic);\n        }\n\n        if (!child.group) {\n          if (\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.AdmRegion') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.Mun') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.Arrond') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.CircFed') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.CircProv') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.DirReg') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.MRC') ||\n            child.name === this.languageService.translate.instant('igo.geo.terrapi.RegTour')) {\n              child.group = limits.name;\n          } else if (child.name === this.languageService.translate.instant('igo.geo.terrapi.routes')) {\n            child.group = this.languageService.translate.instant('igo.geo.spatialFilter.group.transport');\n          } else {\n            const thematic: SpatialFilterThematic = {\n              name: child.name,\n              children: [],\n              source: child.source\n            };\n            this.thematics.push(thematic);\n          }\n        }\n        this.thematics.sort((a, b) => {\n          return a.name.localeCompare(b.name);\n        });\n      });\n      this.thematics.forEach(thematic => {\n        for (const child of this.childrens) {\n          if (child.group === thematic.name) {\n            thematic.children.push(child);\n          }\n        }\n      });\n    });\n\n    this.dataSource.data = this.thematics;\n\n    this.drawGuide$.next(null);\n    this.value$.next(this.formControl.value ? this.formControl.value : undefined);\n    this.value$$ = this.formControl.valueChanges.subscribe((value: GeoJSONGeometry) => {\n      if (value) {\n        this.value$.next(value);\n        this.drawZone = this.formControl.value as Feature;\n        if (this.buffer !== 0) {\n          this.drawZoneEvent.emit(this.drawZone);\n          this.bufferFormControl.setValue(this.buffer);\n        }\n      } else {\n        this.value$.next(undefined);\n        this.drawZone = undefined;\n      }\n    });\n\n    this.value$.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.radiusChanges$$ = this.radiusFormControl.valueChanges.subscribe(() => {\n      this.getRadius();\n      this.cdRef.detectChanges();\n    });\n\n    this.bufferChanges$$ = this.bufferFormControl.valueChanges\n      .pipe(\n        debounceTime(500)\n      )\n      .subscribe((value) => {\n        if (this.measureUnit === MeasureLengthUnit.Meters && value > 0 && value <= 100000) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.drawZone,\n            SpatialFilterType.Polygon,\n            value\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (this.measureUnit === MeasureLengthUnit.Kilometers && value > 0 && value <= 100) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.spatialFilterService.loadBufferGeometry(\n            this.drawZone,\n            SpatialFilterType.Polygon,\n            value * 1000\n          ).subscribe((featureGeom: Feature) => {\n            this.zoneWithBuffer = featureGeom;\n            this.zoneWithBufferChange.emit(this.zoneWithBuffer);\n          });\n        } else if (value === 0) {\n          this.buffer = value;\n          this.bufferEvent.emit(value);\n          this.drawZoneEvent.emit(this.drawZone);\n        } else if (\n          value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && value > 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && value > 100)) {\n            this.bufferFormControl.setValue(0);\n            this.buffer = 0;\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.bufferAlert'),\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n        }\n    });\n\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map: this.map,\n      hitTolerance: 15,\n      motion: FeatureMotion.Default,\n      many: true,\n      dragBox: true\n    });\n\n    this.store.addStrategy(selectionStrategy, true);\n    this.store.addStrategy(selectedRecordStrategy, false);\n  }\n\n  /**\n   * Unsubscribe to the value stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.value$$.unsubscribe();\n    this.radiusChanges$$.unsubscribe();\n    this.bufferChanges$$.unsubscribe();\n    this.cdRef.detach();\n    if (this.radiusChanges$$) {\n      this.radiusChanges$$.unsubscribe();\n    }\n    if (this.value$$) {\n      this.value$$.unsubscribe();\n    }\n  }\n\n  onItemTypeChange(event) {\n    this.selectedItemType = event.value;\n    this.itemTypeChange.emit(this.selectedItemType);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureLengthUnit) {\n    if (unit === this.measureUnit) {\n      return;\n    } else {\n      this.measureUnit = unit;\n      this.measureUnitChange.emit(this.measureUnit);\n      if (this.isPolygon()) {\n        this.measureUnit === MeasureLengthUnit.Meters ?\n          this.bufferFormControl.setValue(this.bufferFormControl.value * 1000) :\n          this.bufferFormControl.setValue(this.bufferFormControl.value / 1000);\n      } else if (this.isPoint()) {\n        this.measureUnit === MeasureLengthUnit.Meters ?\n          this.radiusFormControl.setValue(this.radiusFormControl.value * 1000) :\n          this.radiusFormControl.setValue(this.radiusFormControl.value / 1000);\n      }\n    }\n  }\n\n  isPredefined() {\n    return this.type === SpatialFilterType.Predefined;\n  }\n\n  isPolygon() {\n    return this.type === SpatialFilterType.Polygon;\n  }\n\n  isPoint() {\n    return this.type === SpatialFilterType.Point;\n  }\n\n  hasChild(_: number, node: SpatialFilterThematic) {\n    if (node.children) {\n      return node.children.length;\n    }\n    return false;\n  }\n\n  onToggleClick(node: SpatialFilterThematic) {\n    this.treeControl.isExpanded(node) ? this.treeControl.collapse(node) : this.treeControl.expand(node);\n  }\n\n  isAllSelected(node?: SpatialFilterThematic) {\n    let numSelected;\n    let numNodes = 0;\n    if (!node) {\n      numSelected = this.selectedThematics.selected.length;\n      this.thematics.forEach(thematic => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          numNodes++;\n        }\n      });\n      this.childrens.forEach(children => {\n        if (!this.thematics.find(thematic => thematic.source === children.source)) {\n          numNodes++;\n        }\n      });\n    } else {\n      numSelected = node.children.length;\n      node.children.forEach(children => {\n        if (this.selectedThematics.selected.find(thematic => thematic === children)) {\n          numNodes++;\n        }\n      });\n    }\n\n    if (numNodes >= 1) {\n      return numSelected === numNodes;\n    } else {\n      return false;\n    }\n  }\n\n  hasChildrenSelected(node: SpatialFilterThematic) {\n    let bool = false;\n    node.children.forEach(child => {\n      if (this.selectedThematics.selected.find(thematic => thematic.source === child.source)) {\n        bool = true;\n      }\n    });\n    return bool;\n  }\n\n  /**\n   * Apply header checkbox\n   */\n  masterToggle() {\n    this.isAllSelected() ?\n      this.selectedThematics.clear() :\n      this.selectAll();\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n\n    if (this.isAllSelected()) {\n      this.thematics.forEach(thematic => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.expand(thematic);\n        }\n      });\n    } else {\n      this.thematics.forEach(thematic => {\n        if (this.hasChild(0, thematic)) {\n          this.treeControl.collapse(thematic);\n        }\n      });\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  selectAll(node?: SpatialFilterThematic) {\n    if (!node) {\n      this.thematics.forEach(thematic => {\n        if (this.groups.indexOf(thematic.name) === -1) {\n          this.selectedThematics.select(thematic);\n        }\n      });\n      this.childrens.forEach(children => {\n        if (!this.selectedThematics.selected.find(thematic => thematic.source === children.source)) {\n          this.selectedThematics.select(children);\n        }\n      });\n    } else {\n      if (this.hasChild(0, node)) {\n        node.children.forEach(children => this.selectedThematics.select(children));\n      }\n    }\n  }\n\n  childrensToggle(node: SpatialFilterThematic) {\n    this.isAllSelected(node) ?\n    node.children.forEach(child => this.selectedThematics.deselect(child)) :\n    this.selectAll(node);\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.treeControl.expand(node);\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  /**\n   * Apply changes to the thematics selected tree and emit event\n   */\n  onToggleChange(nodeSelected: SpatialFilterThematic) {\n    let selected = false;\n    if (this.selectedThematics.selected.find(thematic => thematic.source === nodeSelected.source) !== undefined) {\n      selected = true;\n    }\n\n    this.childrens.forEach(children => {\n      if (children === nodeSelected && selected === false) {\n        this.selectedThematics.select(children);\n      }\n      if (children === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(children);\n      }\n    });\n    this.thematics.forEach(thematic => {\n      if (thematic === nodeSelected && selected === false) {\n        this.selectedThematics.select(thematic);\n      }\n      if (thematic === nodeSelected && selected === true) {\n        this.selectedThematics.deselect(thematic);\n      }\n    });\n\n    const selectedThematicsName: SpatialFilterThematic[] = [];\n    for (const thematic of this.selectedThematics.selected) {\n      selectedThematicsName.push(thematic);\n    }\n    this.thematicChange.emit(selectedThematicsName);\n  }\n\n  onDrawControlChange() {\n    this.drawControlIsActive = !this.drawControlIsActive;\n  }\n\n  onfreehandControlChange() {\n    this.freehandDrawIsActive = !this.freehandDrawIsActive;\n    this.freehandControl.emit(this.freehandDrawIsActive);\n    if (this.isPoint()) {\n      this.predefinedRadius.emit(!this.freehandDrawIsActive);\n      if (this.freehandDrawIsActive) {\n        this.overlayStyle$.next(undefined);\n        this.drawStyle$.next(undefined);\n      }\n    } else {\n      this.predefinedRadius.emit(false);\n    }\n  }\n\n  /**\n   * Launch search button\n   */\n  toggleSearchButton() {\n    if (!this.isPredefined()) {\n      if (this.buffer > 0) {\n        this.zoneWithBuffer.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.zoneWithBuffer.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.zoneWithBuffer);\n      } else {\n        this.drawZone.meta = {\n          id: undefined,\n          title: 'Zone'\n        };\n        this.drawZone.properties = {\n          nom: 'Zone',\n          type: this.type as string\n        };\n        this.drawZoneEvent.emit(this.drawZone);\n      }\n    }\n    if (this.isPoint()) {\n      this.radiusEvent.emit(this.radius);\n    } else if (this.isPolygon()) {\n      this.bufferEvent.emit(this.buffer);\n    }\n    this.toggleSearch.emit();\n    this.store.entities$.pipe(\n      debounceTime(500)\n    ).subscribe((value) => {\n      if (value.length && this.layers.length === this.thematicLength + 1) {\n        this.openWorkspace.emit();\n        this.createTableTemplate();\n      }\n    });\n  }\n\n  /**\n   * Launch clear button (clear store and map layers)\n   */\n  clearButton() {\n    this.loading = true;\n    if (this.store) {\n      this.store.clear();\n    }\n    if (this.isPoint() || this.isPolygon()) {\n      this.drawZone = undefined;\n      this.formControl.reset();\n    }\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.clearButtonEvent.emit();\n    this.loading = false;\n    this.tableTemplate = undefined;\n  }\n\n  clearDrawZone() {\n    this.formControl.reset();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n  }\n\n  /**\n   * Launch clear search (clear field if type is predefined)\n   */\n  clearSearch() {\n    this.selectedThematics.clear();\n    this.bufferFormControl.setValue(0);\n    this.buffer = 0;\n    this.bufferEvent.emit(0);\n    this.thematicChange.emit([]);\n    this.clearSearchEvent.emit();\n  }\n\n  /**\n   * Verify conditions of incomplete fields or busy service\n   */\n  disableSearchButton(): boolean {\n    if (this.type === SpatialFilterType.Predefined) {\n      if (this.selectedItemType === SpatialFilterItemType.Address) {\n        if (this.queryType !== undefined && this.zone !== undefined) {\n          return this.loading;\n        }\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (this.queryType !== undefined && this.zone !== undefined && this.selectedThematics.selected.length > 0) {\n          return this.loading;\n        }\n      }\n    }\n    if (this.type === SpatialFilterType.Polygon || this.type === SpatialFilterType.Point) {\n      if (this.selectedItemType === SpatialFilterItemType.Address && this.formControl.value !== null) {\n        return this.loading;\n      }\n      if (this.selectedItemType === SpatialFilterItemType.Thematics) {\n        if (this.selectedThematics.selected.length > 0 && this.formControl.value !== null) {\n          return this.loading;\n        }\n      }\n    }\n    return true;\n  }\n\n  disabledClearSearch() {\n    let disable = true;\n    this.selectedItemType === SpatialFilterItemType.Address ?\n      disable = this.queryType === undefined :\n      disable = this.queryType === undefined && this.selectedThematics.selected.length === 0;\n\n    return disable;\n  }\n\n  /**\n   * Manage radius value at user change\n   */\n  getRadius() {\n    let formValue;\n    if (this.formControl.value !== null) {\n      this.measureUnit === MeasureLengthUnit.Meters ?\n        formValue = this.formControl.value.radius :\n        formValue = this.formControl.value.radius / 1000;\n    } else {\n      formValue = undefined;\n    }\n\n    if (this.type === SpatialFilterType.Point) {\n      if (!this.freehandDrawIsActive) {\n        if (\n          this.radiusFormControl.value < 0 ||\n          (this.measureUnit === MeasureLengthUnit.Meters && this.radiusFormControl.value >= 100000) ||\n          (this.measureUnit === MeasureLengthUnit.Kilometers && this.radiusFormControl.value >= 100)) {\n          this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.radiusAlert'),\n            this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n          this.radius = 1000;\n          this.measureUnit === MeasureLengthUnit.Meters ?\n            this.radiusFormControl.setValue(this.radius) :\n            this.radiusFormControl.setValue(this.radius / 1000);\n          this.drawGuide$.next(this.radius);\n          return;\n        }\n      } else {\n        if (formValue) {\n          if (formValue >= 100000) {\n            this.messageService.alert(this.languageService.translate.instant('igo.geo.spatialFilter.radiusAlert'),\n              this.languageService.translate.instant('igo.geo.spatialFilter.warning'));\n            this.formControl.reset();\n            return;\n          }\n          if (formValue !== this.radiusFormControl.value) {\n            this.radiusFormControl.setValue(formValue);\n            return;\n          }\n        }\n      }\n      if (this.measureUnit === MeasureLengthUnit.Meters) {\n        this.radius = this.radiusFormControl.value;\n        this.drawGuide$.next(this.radius);\n      } else {\n        this.radius = this.radiusFormControl.value * 1000;\n        this.drawGuide$.next(this.radius * 1000);\n      }\n      this.overlayStyle$.next(this.PointStyle);\n      this.drawStyle$.next(this.PointStyle);\n    }\n  }\n\n  toggleVisibleList() {\n    this.listIsVisible = !this.listIsVisible;\n  }\n\n  private createTableTemplate() {\n    const typeColumn = {\n      name: 'meta.title',\n      title: this.languageService.translate.instant('igo.geo.spatialFilter.type'),\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\n    };\n    const nameColumn = {\n      name: 'properties.nom',\n      title: this.languageService.translate.instant('igo.geo.spatialFilter.searchResults'),\n      renderer: EntityTableColumnRenderer.UnsanitizedHTML\n    };\n    const columns = [typeColumn, nameColumn];\n\n    this.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n}\n","<div class=\"datetime-container\">\n  <mat-slide-toggle \n    *ngIf=\"this.currentFilter.sliderOptions?.enabled\"\n    [(ngModel)]=\"sliderMode\"\n    (change)=\"modeChange($event)\">\n    {{'igo.geo.filter.sliderModeTitle' | translate}}\n  </mat-slide-toggle>\n\n  <div class=\"slider-container\" *ngIf=\"sliderMode\">\n    <igo-ogc-filter-time-slider\n      [begin]=\"beginValue\"\n      [max]=\"this.restrictedToStep() ? this.maxDate : this.endValue\"\n      [currentFilter]=\"currentFilter\" \n      [datasource]=\"datasource\"\n      (changeProperty)=\"changePropertyByPass($event)\"\n    >\n    </igo-ogc-filter-time-slider>\n    \n  </div>\n\n  <div *ngIf=\"!sliderMode\">\n\n    <div class=\"year-input-container\" *ngIf=\"calendarTypeYear\">\n      <!-- to emulate a year-picker, 2 input: first input to show user just year and second input hiden and bind \n        with the datepicker  -->\n      <mat-form-field  class=\"year-input\">\n        <mat-label>{{'igo.geo.timeFilter.startYear'| translate}}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{onlyYearBegin}}\"\n          (change)= \"yearOnlyInputChange($event, beginDatepicker, 'begin')\"\n          [disabled]= \"filterStateDisable\"\n          >\n        <mat-datepicker-toggle matSuffix [for]=\"beginDatepicker\" [disabled]=\"filterStateDisable\"></mat-datepicker-toggle>\n  \n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #beginDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"beginValue\"\n          (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n          >\n        </mat-datepicker>\n\n        <input #beginYear\n          class= \"year-input-hide\"\n          matInput\n          [matDatepicker]=\"beginDatepicker\"\n          enabled= false\n          readonly= true\n          [value]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n          [min]=\"handleDate(datasource.options.minDate)\"\n          [max]=\"(endValue && (!restrictedToStep()))?endValue:handleDate(datasource.options.maxDate)\"\n          >\n      </mat-form-field>\n\n      <mat-form-field  class=\"year-input\">\n        <mat-label>{{'igo.geo.timeFilter.endYear'| translate}}</mat-label>\n        <input\n          matInput\n          class=\"year-input-only-year\"\n          value=\"{{onlyYearEnd}}\"\n          (change)= \"yearOnlyInputChange($event, endDatepicker, 'end')\"\n          [disabled] = \"filterStateDisable\">\n        <mat-datepicker-toggle matSuffix [for]=\"endDatepicker\" [disabled]=\"filterStateDisable\"></mat-datepicker-toggle>\n        <mat-datepicker\n          panelClass=\"datepicker-year\"\n          #endDatepicker\n          [startView]=\"calendarView()\"\n          [startAt]=\"endValue\"\n          (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n          >\n        </mat-datepicker>\n\n        <input #endYear\n          class= \"year-input-hide\"\n          matInput\n          [matDatepicker]=\"endDatepicker\"\n          enabled= false\n          readonly= true\n          [value]=\"endValue?endValue:handleDate(datasource.options.maxDate)\"\n          [min]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n          [max]=\"handleDate(datasource.options.maxDate)\"\n          >\n      </mat-form-field>\n      <button class=\"reset-button\" \n        mat-icon-button\n        color=\"primary\" \n        (click)=\"resetFilter()\" \n        [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" \n        [disabled]= \"filterStateDisable\">\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n      </button>\n      <mat-slide-toggle \n        class='toggle-filter-state' \n        (change)=\"toggleFilterState()\" \n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" \n        tooltip-position=\"below\" \n        matTooltipShowDelay=\"500\"\n        [checked]=\"!filterStateDisable\">\n      </mat-slide-toggle>\n\n    </div>\n\n    <div class=\"datetime-input-container\" *ngIf=\"calendarType()!=='year'\">\n      <div class=\"datetime-input\">\n        <mat-form-field class=\"date-input\">\n          <mat-datepicker-toggle matSuffix [for]=\"beginDatepicker\" [disabled]= \"filterStateDisable\"></mat-datepicker-toggle>\n          <input #begin\n            matInput\n            [matDatepicker]=\"beginDatepicker\"\n            [placeholder]=\"'igo.geo.timeFilter.startDate' | translate\"\n            [attr.disabled]=\"!currentFilter.active\"\n            (dateChange)=\"changeTemporalProperty(begin.value, 1)\"\n            [matDatepickerFilter]=\"filterBeginFunction\"\n            [value]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n            [min]=\"handleDate(datasource.options.minDate)\"\n            [max]=\"(endValue && (!restrictedToStep()))?endValue:handleDate(datasource.options.maxDate)\" \n            [disabled]= \"filterStateDisable\">\n          <span class=\"filler\"></span>\n          <mat-datepicker\n            #beginDatepicker\n            [startView]=\"calendarView()\"\n            [startAt]=\"beginValue\"\n            (yearSelected)=\"yearSelected($event, beginDatepicker, 'begin')\"\n            (monthSelected)=\"monthSelected($event, beginDatepicker, 'begin')\">\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div class=\"time-input\">\n          <mat-form-field class=\"hour-input\" *ngIf=\"calendarType()==='datetime'\">\n            <mat-label>{{'igo.geo.timeFilter.hour' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"beginHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\">\n              <mat-option *ngFor=\"let hour of beginHours\" [value]=\"hour\">{{hour}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" *ngIf=\"calendarType()==='datetime'\">\n            <mat-label>{{'igo.geo.timeFilter.minute' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"beginMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(begin.value, 1)\">\n              <mat-option *ngFor=\"let minute of beginMinutes\" [value]=\"minute\">{{minute}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <div class=\"datetime-input\" *ngIf=\"!restrictedToStep()\">\n        <mat-form-field class=\"date-input\">\n          <mat-datepicker-toggle matSuffix [for]=\"endDatepicker\" [disabled]= \"filterStateDisable\"></mat-datepicker-toggle>\n            <input #end\n              matInput\n              [matDatepicker]=\"endDatepicker\"\n              [placeholder]=\"'igo.geo.timeFilter.endDate' | translate\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (dateChange)=\"changeTemporalProperty(end.value, 2)\"\n              [matDatepickerFilter]=\"filterEndFunction\"\n              [value]=\"endValue?endValue:handleDate(datasource.options.maxDate)\"\n              [min]=\"beginValue?beginValue:handleDate(datasource.options.minDate)\"\n              [max]=\"handleDate(datasource.options.maxDate)\" \n              [disabled]= \"filterStateDisable\">\n            <span class=\"filler\"></span>\n            <mat-datepicker #endDatepicker\n              [startView]=\"calendarView()\"\n              [startAt]=\"endValue\"\n              (yearSelected)=\"yearSelected($event, endDatepicker, 'end')\"\n              (monthSelected)=\"monthSelected($event, endDatepicker, 'end')\">\n          </mat-datepicker>\n        </mat-form-field>\n\n        <div class=\"time-input\">\n          <mat-form-field class=\"hour-input\" *ngIf=\"calendarType()==='datetime'\" >\n            <mat-label>{{'igo.geo.timeFilter.hour' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"endHourFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\">\n              <mat-option *ngFor=\"let hour of endHours\" [value]=\"hour\">{{hour}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n          <mat-form-field class=\"minute-input\" *ngIf=\"calendarType()==='datetime'\">\n            <mat-label>{{'igo.geo.timeFilter.minute' | translate}}</mat-label>\n            <mat-select\n              [formControl]=\"endMinuteFormControl\"\n              [attr.disabled]=\"!currentFilter.active\"\n              (selectionChange)=\"changeTemporalProperty(end.value, 2)\">\n              <mat-option *ngFor=\"let minute of endMinutes\" [value]=\"minute\">{{minute}}</mat-option>\n            </mat-select>\n          </mat-form-field>\n        </div>\n      </div>\n\n      <button class=\"reset-button\" \n        mat-icon-button color=\"primary\"\n        (click)=\"resetFilter()\" \n        [matTooltip]=\"'igo.geo.filter.resetFilters' | translate\" \n        [disabled]= \"filterStateDisable\">\n        <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n      </button>\n      <mat-slide-toggle \n        class=\"toggle-filter-state\" \n        (change)=\"toggleFilterState()\" \n        tooltip-position=\"below\" \n        matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.filter.toggleFilterState' | translate\" \n        [checked]= \"!filterStateDisable\">\n      </mat-slide-toggle>\n    </div>\n  </div>\n</div>\n","import {\n  Component,\n  Input,\n  ViewChild,\n  ElementRef,\n  Output,\n  EventEmitter,\n  OnInit\n} from '@angular/core';\nimport { UntypedFormControl } from '@angular/forms';\nimport { OgcFilterOperator } from '../../filter/shared/ogc-filter.enum';\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\nimport {\n  OgcFilterableDataSourceOptions,\n  OgcFilterableDataSource,\n  OgcFilterDuringOptions\n} from '../shared/ogc-filter.interface';\n\nimport { default as moment } from 'moment';\n\n@Component({\n  selector: 'igo-ogc-filter-time',\n  templateUrl: './ogc-filter-time.component.html',\n  styleUrls: ['./ogc-filter-time.component.scss']\n})\nexport class OgcFilterTimeComponent implements OnInit {\n  @Input() datasource: OgcFilterableDataSource;\n  @Input() currentFilter: any;\n  @Output() changeProperty: EventEmitter<{\n    value: string;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n\n  beginHours: number[];\n  endHours: number[];\n  beginMinutes: number[];\n  endMinutes: number[];\n  beginHourFormControl = new UntypedFormControl();\n  beginMinuteFormControl = new UntypedFormControl();\n  endHourFormControl = new UntypedFormControl();\n  endMinuteFormControl = new UntypedFormControl();\n  _beginValue: Date;\n  _endValue: Date;\n  readonly _defaultMin: string = '1900-01-01';\n  readonly _defaultMax: string = '2052-01-06';\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderModeEnabled: boolean = true;\n  ogcFilterOperator = OgcFilterOperator;\n  public sliderMode = false;\n\n  readonly defaultStepMillisecond = 60000;\n  public options: OgcFilterableDataSourceOptions;\n\n  public onlyYearBegin: number;\n  public onlyYearEnd: number;\n  public calendarTypeYear = false;\n  public resetIcon = 'replay';\n  public filterStateDisable: boolean;\n\n  @ViewChild('endDatepickerTime') endDatepickerTime: ElementRef;\n  @ViewChild('beginDatepickerTime') beginDatepickerTime: ElementRef;\n  @ViewChild('beginTime') beginTime: HTMLInputElement;\n  @ViewChild('endTime') endTime: HTMLInputElement;\n\n  get step(): string {\n    return this.datasource.options.stepDate\n      ? this.datasource.options.stepDate\n      : this.currentFilter.step;\n  }\n\n  get stepMilliseconds(): number {\n    const step = moment.duration(this.step).asMilliseconds();\n    return step === 0 ? this.defaultStepMillisecond : step;\n  }\n\n  set beginValue(begin: Date) {\n    this._beginValue = begin;\n  }\n\n  get beginValue(): Date {\n    return this._beginValue;\n  }\n\n  set endValue(end: Date) {\n    this._endValue = end;\n  }\n\n  get endValue(): Date {\n    return this._endValue;\n  }\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? 2000\n      : this.currentFilter.sliderInterval;\n  }\n\n  get maxDate(): string {\n    return this.datasource.options.maxDate ? this.datasource.options.maxDate : this._defaultMax;\n  }\n\n  get displayFormat(): string {\n    return this.currentFilter.displayFormat ? this.currentFilter.displayFormat : this._defaultDisplayFormat;\n  }\n\n  public filterBeginFunction;\n  public filterEndFunction;\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {}\n\n  ngOnInit(){\n    if (this.currentFilter.sliderOptions) {\n      this.currentFilter.sliderOptions.enabled = this.currentFilter.sliderOptions.enabled !== undefined ?\n        this.currentFilter.sliderOptions.enabled : this._defaultSliderModeEnabled;\n    }\n    this.beginValue = this.parseFilter(this.handleMin());\n    this.endValue = this.parseFilter(this.handleMax());\n\n    this.onlyYearBegin = this.beginValue.getUTCFullYear();\n    this.onlyYearEnd = this.endValue.getUTCFullYear();\n    this.calendarTypeYear = this.isCalendarYearMode();\n    this.setFilterStateDisable();\n    this.updateHoursMinutesArray();\n    // update value for now value\n    this.updateValues();\n    this.dateFilter(this.filterBeginFunction, 'begin');\n    this.dateFilter(this.filterEndFunction, 'end');\n  }\n\n  parseFilter(filter): Date {\n    if (!filter){\n      return new Date();\n    } else if ( isNaN( new Date(filter).getTime() ) ){\n      if (filter.search('now') >= 0 ){\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if (filter.match(/\\+/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.search('+') + 1, interval.index),\n            10\n          );\n          return moment().add(intervalInt, interval[0]).toDate();\n        }\n        if (filter.match(/\\-/)) {\n          const intervalInt = parseInt(\n            filter.substring(filter.search('-') + 1, interval.index),\n            10\n          );\n          return moment().subtract(intervalInt, interval[0]).toDate();\n        }\n        return new Date();\n      }\n      if (filter.search('today') >= 0){\n        const _now = moment().endOf('day').toDate();\n        const interval = filter.match(/years|months|weeks|days|hours|seconds/);\n        if ( filter.match(/\\+/) ) {\n          const intervalInt = parseInt( filter.substring(filter.search('+') + 1, interval.index), 10 );\n          return moment(_now).add(intervalInt, interval[0]).toDate();\n        }\n        if ( filter.match(/\\-/) ) {\n          const intervalInt = parseInt(filter.substring(filter.search('-') + 1, interval.index), 10);\n          return moment(_now).subtract(intervalInt, interval[0]).toDate();\n        }\n        return _now;\n      }\n      return new Date();\n    }\n    if (this.currentFilter.calendarModeYear) {\n      const date = this.getDateFromStringWithoutTime(filter);\n      return date;\n    } else {\n      return filter ? new Date(filter) : new Date();\n    }\n  }\n\n  changeTemporalProperty(value, position?, refreshFilter = true) {\n    let valueTmp = this.getDateTime(value, position);\n    if (this.isCalendarYearMode()) {\n      let dateStringFromYearNotime;\n      if (position === 1) {\n        this.beginValue = value;\n        this.onlyYearBegin = this.beginValue.getFullYear();\n        dateStringFromYearNotime = `${this.onlyYearBegin}-01-01`;\n      } else {\n        this.endValue = value;\n        this.onlyYearEnd = this.endValue.getFullYear();\n        dateStringFromYearNotime = `${this.onlyYearEnd}-01-01`;\n      }\n      // call service with string date without time\n      this.changeProperty.next({ value: dateStringFromYearNotime, pos: position, refreshFilter });\n      return;\n    }\n    if (position === 2 && this.calendarType() === 'date' && !this.sliderMode) {\n      /* Above month: see yearSelected or monthSelected */\n      valueTmp = moment(valueTmp).endOf('day').toDate();\n    }\n\n    if (position === 1) {\n      this.beginValue = valueTmp;\n      if (this.restrictedToStep()) {\n        this.changeTemporalProperty(this.ogcFilterTimeService.addStep(valueTmp, this.stepMilliseconds), 2, refreshFilter);\n      }\n    } else {\n      this.endValue = valueTmp;\n    }\n    this.updateHoursMinutesArray();\n    this.changeProperty.next({ value: valueTmp.toISOString(), pos: position, refreshFilter });\n  }\n\n  handleDate(value): Date {\n    if (!value || value === '') {\n      return undefined;\n    }\n    if (typeof(value) === 'string' && this.currentFilter.calendarModeYear) {\n      return this.getDateFromStringWithoutTime(value);\n    }\n    return new Date(value);\n  }\n\n  calendarType() {\n    if (this.currentFilter.calendarModeYear) {\n      return 'year';\n    }\n    if (this.stepMilliseconds < 86400000) {\n      return 'datetime';\n    }\n    return 'date';\n  }\n\n  isCalendarYearMode(): boolean {\n    if (this.calendarType() === 'year') {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  yearOnlyInputChange(changeEvent, datePicker?: any, property?: string) {\n    const year = changeEvent.target.value;\n    const date = this.getDateFromStringWithoutTime(year);\n    this.yearSelected(date, datePicker, property);\n  }\n\n  yearSelected(year, datePicker?: any, property?: string, refreshFilter = true) {\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        // change value 01 jan to 31 dec same year\n        year = moment(year).endOf('year').toDate();\n      } else if (property === 'begin' && this.restrictedToStep() && !this.calendarTypeYear) {\n        this.yearSelected(year, undefined, 'end');\n      }\n      this.changeTemporalProperty(year, property === 'begin' ? 1 : 2, refreshFilter);\n    }\n  }\n\n  monthSelected(month, datePicker?: any, property?: string, refreshFilter = true) {\n    if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      if (datePicker) {\n        datePicker.close();\n      }\n      if (property === 'end') {\n        month = moment(month).endOf('month').toDate();\n      } else if (property === 'begin' && this.restrictedToStep()) {\n        this.monthSelected(month, undefined, 'end');\n      }\n      this.changeTemporalProperty(month, property === 'begin' ? 1 : 2, refreshFilter);\n    }\n  }\n\n  calendarView() {\n    const test = this.stepMilliseconds;\n    const diff = Math.abs(\n      this.parseFilter(this.currentFilter.end).getTime() -\n        this.parseFilter(this.currentFilter.begin).getTime()\n    );\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      return 'multi-year';\n    } else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      return 'year';\n    } else if (test < 86400000 && diff < 86400000) {\n      return 'clock';\n    } else {\n      return 'month';\n    }\n  }\n\n  dateFilter(type: string, date: string) {\n    const dateValue = new Date(date);\n    const diff = dateValue.getTime() - new Date(this.handleMin()).getTime();\n\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(moment(this.handleMin()), 'years', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'years', true);\n        this.filterEndFunction = (monthDiffPlus1 % moment.duration(this.step).asYears()) === 0;\n        return;\n      } else if ( type === 'begin' ) {\n        this.filterBeginFunction = (monthDiff % moment.duration(this.step).asYears()) === 0;\n        return;\n      }\n    }\n    else if (this.ogcFilterTimeService.stepIsMonthDuration(this.step)) {\n      const monthDiff = moment(dateValue).diff(moment(this.handleMin()), 'months', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const monthDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'months', true);\n        this.filterEndFunction = (monthDiffPlus1 % moment.duration(this.step).asMonths()) === 0;\n        return;\n      } else if ( type === 'begin' ) {\n        this.filterBeginFunction = (monthDiff % moment.duration(this.step).asMonths()) === 0;\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsWeekDuration(this.step)) {\n      const weekDiff = moment(dateValue).diff(moment(this.handleMin()), 'weeks', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const weekDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'weeks', true);\n        this.filterEndFunction = (weekDiffPlus1 % moment.duration(this.step).asWeeks()) === 0;\n        return;\n      } else if ( type === 'begin' ) {\n        this.filterBeginFunction = (weekDiff % moment.duration(this.step).asWeeks()) === 0;\n        return;\n      }\n    } else if (this.ogcFilterTimeService.stepIsDayDuration(this.step)) {\n      const dayDiff = moment(dateValue).diff(moment(this.handleMin()), 'days', true);\n      if ( type === 'end' ) {\n        const dateValuePlus1 = moment(dateValue).add(1, 'd');\n        const dayDiffPlus1 = moment(dateValuePlus1).diff(moment(this.handleMin()), 'days', true);\n        const _mod = (dayDiffPlus1 % moment.duration(this.step).asDays());\n        this.filterEndFunction = (_mod < 0.0000001 && _mod > -0.0000001) || _mod === 0 ; // 1 millisecond = 1.1574074074074076e-8\n        return;\n      } else if ( type === 'begin' ) {\n        const _mod = ((dayDiff % moment.duration(this.step).asDays()) + 1);\n        this.filterBeginFunction = (_mod < 0.0000001 && _mod > -0.0000001 && _mod !== 0) || _mod === 1 ; // 1 millisecond = 1.1574074074074076e-8\n        return;\n      }\n    } else if ( this.ogcFilterTimeService.stepIsHourDuration(this.step) ) {\n      if ( type === 'end' ) {\n        const hourDiff = moment(dateValue).diff(moment(this.handleMin()), 'hours', true);\n        this.filterEndFunction = (hourDiff % moment.duration(this.step).asHours()) === 0;\n        return;\n      } else if (type === 'begin') {\n        const hourDiff = moment(dateValue).diff(moment(this.handleMin()), 'hours', true);\n        this.filterBeginFunction = (hourDiff % moment.duration(this.step).asHours()) === 0;\n        return;\n      }\n    } else if ( this.ogcFilterTimeService.stepIsMinuteDuration(this.step) ) {\n      if ( type === 'end' ) {\n        this.filterEndFunction = true;\n        return;\n      } else if (type === 'begin') {\n        this.filterBeginFunction = true;\n        return;\n      }\n    }\n\n    this.filterEndFunction = diff % this.stepMilliseconds === 0;\n    this.filterBeginFunction = diff % this.stepMilliseconds === 0;\n    return;\n  }\n\n  getDateTime(date, pos) {\n    const valuetmp = new Date(date);\n    let valuetmp2;\n    if (!this.sliderMode) {\n      switch (pos) {\n        case 1: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n            this.beginHourFormControl.value,\n            this.beginMinuteFormControl.value\n            );\n            break;\n          }\n        }\n        case 2: {\n          if (this.currentFilter.calendarModeYear) {\n            valuetmp2 = valuetmp.setHours(0, 0);\n            break;\n          } else {\n            valuetmp2 = valuetmp.setHours(\n              this.endHourFormControl.value,\n              this.endMinuteFormControl.value\n            );\n            break;\n          }\n        }\n      }\n    }\n    return new Date(valuetmp2 ? valuetmp2 : valuetmp);\n  }\n\n  handleMinuteIncrement() {\n    if (this.ogcFilterTimeService.stepIsMinuteDuration(this.step)) {\n      if (this.stepMilliseconds < 3600000) {\n        return this.stepMilliseconds / 1000 === 60 ? 1 : this.stepMilliseconds / 1000;\n      } else {\n        return (this.stepMilliseconds % 3600000) / 60;\n      }\n    } else if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return 60;\n    }\n    return 1;\n  }\n\n  handleHourIncrement() {\n    if (this.ogcFilterTimeService.stepIsHourDuration(this.step)) {\n      return this.stepMilliseconds / 1000 / 60 / 60;\n    }\n    return 1;\n  }\n\n  fullBeginHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginHours = Array.from(\n        {\n          length:\n            (this.endHourFormControl.value - 0) / this.handleHourIncrement() + 1\n        },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    } else {\n      this.beginHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.beginHourFormControl.setValue(this.beginValue.getHours());\n  }\n\n  fullEndHoursArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endHours = Array.from(\n        {\n          length:\n            (23 - this.beginHourFormControl.value) /\n              this.handleHourIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginHourFormControl.value + i * this.handleHourIncrement()\n      );\n    } else {\n      this.endHours = Array.from(\n        { length: (23 - 0) / this.handleHourIncrement() + 1 },\n        (_, i) => 0 + i * this.handleHourIncrement()\n      );\n    }\n    this.endHourFormControl.setValue(this.endValue.getHours());\n  }\n\n  fullBeginMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.beginMinutes = Array.from(\n        {\n          length:\n            (this.endMinuteFormControl.value - 0) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.beginMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.beginMinuteFormControl.setValue(this.beginValue.getMinutes());\n  }\n\n  fullEndMinutesArray(checkEndValue?) {\n    if (checkEndValue) {\n      this.endMinutes = Array.from(\n        {\n          length:\n            (59 - this.beginMinuteFormControl.value) /\n              this.handleMinuteIncrement() +\n            1\n        },\n        (_, i) =>\n          this.beginMinuteFormControl.value + i * this.handleMinuteIncrement()\n      );\n    } else {\n      this.endMinutes = Array.from(\n        { length: (59 - 0) / this.handleMinuteIncrement() + 1 },\n        (_, i) => 0 + i * this.handleMinuteIncrement()\n      );\n    }\n    this.endMinuteFormControl.setValue(this.endValue.getMinutes());\n  }\n\n  updateHoursMinutesArray() {\n    const beginTmp = new Date(this.beginValue);\n    const endTmp = new Date(this.endValue);\n    if (beginTmp.setHours(0, 0) === endTmp.setHours(0, 0)) {\n      this.fullBeginHoursArray(true);\n      this.fullEndHoursArray(true);\n      if (this.beginValue.getHours() === this.endValue.getHours()) {\n        this.fullBeginMinutesArray(true);\n        this.fullEndMinutesArray(true);\n      }\n    } else {\n      this.fullBeginHoursArray();\n      this.fullEndHoursArray();\n      this.fullBeginMinutesArray();\n      this.fullEndMinutesArray();\n    }\n  }\n\n  private updateValues() {\n    this.changeTemporalProperty(this.beginValue, 1, false);\n    this.changeTemporalProperty(this.endValue, 2, true);\n  }\n\n  public restrictedToStep(): boolean {\n    return this.currentFilter.restrictToStep\n      ? this.currentFilter.restrictToStep : false;\n  }\n\n  public handleMin() {\n    return this.currentFilter.begin ? this.currentFilter.begin :\n              (this.datasource.options.minDate ? this.datasource.options.minDate : this._defaultMin);\n  }\n\n  public handleMax() {\n    return this.currentFilter.end ? this.currentFilter.end :\n              (this.datasource.options.maxDate ? this.datasource.options.maxDate : this._defaultMax);\n  }\n\n  changePropertyByPass(event) {\n    this.changeProperty.next(event);\n  }\n\n  modeChange(event) {\n    if (!event.checked) {\n      this.updateValues();\n    }\n  }\n\n  setFilterStateDisable() {\n    if (this.currentFilter) {\n      this.filterStateDisable = !this.currentFilter.active;\n    } else {\n      this.filterStateDisable = false;\n    }\n    if(this.calendarType() === 'datetime') {\n      if (this.filterStateDisable === true) {\n        this.beginHourFormControl.disable();\n        this.beginMinuteFormControl.disable();\n        this.endHourFormControl.disable();\n        this.endMinuteFormControl.disable();\n      } else {\n        this.beginHourFormControl.enable();\n        this.beginMinuteFormControl.enable();\n        this.endHourFormControl.enable();\n        this.endMinuteFormControl.enable();\n      }\n    }\n  }\n  getDateFromStringWithoutTime(stringDate: string): Date {\n    // warning create date with no time make a date UTC with TZ and the date create maybe not the same year, month and day\n    // exemple:\n    // new Date('2022-01-01') -> Fri Dec 31 2021 19:00:00 GMT-0500 (heure normale de lEst nord-amricain)\n    // to create same date as string, add time 00 in the creation\n    // new Date('2022-01-01 00:00:00') -> Sat Jan 01 2022 00:00:00 GMT-0500 (heure normale de lEst nord-amricain)\n    let year;\n    let month = '01';\n    let day = '01';\n    if (stringDate.length === 10) {\n       const dateItems = stringDate.split('-');\n        if (dateItems.length !== 3) {\n          throw new Error('Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY');\n        } else {\n          year = dateItems[0];\n          month = dateItems[1];\n          day = dateItems[2];\n        }\n    } else if (stringDate.length === 4) {\n      year = stringDate;\n    } else {\n      return new Date(stringDate);\n    }\n    return new Date(`${year}-${month}-${day} 00:00:00`);\n  }\n\n  resetFilter() {\n    let filterOriginConfig = this.datasource.options.ogcFilters.filters as OgcFilterDuringOptions;\n\n    let minDefaultDate;\n    let maxDefaultDate;\n    let minDefaultISOString;\n    let maxDefaultISOString;\n\n    if (this.calendarTypeYear) {\n      if (filterOriginConfig.end === 'today') {\n        let todayDateStringNoTime = new Date().toLocaleDateString('en-CA'); // '2022-02-13'\n        maxDefaultISOString = `${todayDateStringNoTime.substring(0,4)}-01-01`;\n      } else {\n        maxDefaultISOString = `${filterOriginConfig.end.substring(0,4)}-01-01`;\n      }\n      minDefaultISOString = `${filterOriginConfig.begin.substring(0,4)}-01-01`;\n      minDefaultDate = this.getDateFromStringWithoutTime(minDefaultISOString);\n      maxDefaultDate = this.getDateFromStringWithoutTime(maxDefaultISOString);\n    } else {\n      minDefaultDate = this.parseFilter(filterOriginConfig.begin);\n      maxDefaultDate = this.parseFilter(filterOriginConfig.end);\n      minDefaultISOString = minDefaultDate.toISOString();\n      maxDefaultISOString = maxDefaultDate.toISOString();\n    }\n\n    if ((this.currentFilter.begin !== minDefaultISOString ) ||\n    (this.currentFilter.end !== maxDefaultISOString)) {\n      this.beginValue = minDefaultDate;\n      this.endValue = maxDefaultDate;\n      this.updateValues();\n    }\n  }\n\n  toggleFilterState() {\n    if (this.currentFilter.active === true) {\n      this.currentFilter.active = false;\n    } else {\n      this.currentFilter.active = true;\n    }\n    this.setFilterStateDisable();\n    this.updateValues();\n  }\n}\n","import {\n  Component,\n  Input,\n  ViewChild,\n  Output,\n  EventEmitter,\n  OnInit\n} from '@angular/core';\nimport { OGCFilterTimeService } from '../shared/ogc-filter-time.service';\n\nimport { default as moment } from 'moment';\nimport { MatSlider } from '@angular/material/slider';\n\n@Component({\n  selector: 'igo-ogc-filter-time-slider',\n  templateUrl: './ogc-filter-time-slider.component.html',\n  styleUrls: ['./ogc-filter-time-slider.component.scss']\n})\nexport class OgcFilterTimeSliderComponent implements OnInit {\n  @Input() currentFilter: any;\n  @Input() begin: any;\n  @Input() max: any;\n  @Input() datasource: any;\n  @Output() changeProperty: EventEmitter<{\n    value: any;\n    pos: number;\n    refreshFilter: boolean;\n  }> = new EventEmitter<any>();\n  @ViewChild(MatSlider) slider: MatSlider;\n\n  interval;\n  sliderValue: number = 1;\n  calculatedStep: number = 0;\n  readonly _defaultDisplayFormat: string = 'DD/MM/YYYY HH:mm A';\n  readonly _defaultSliderInterval: number = 2000;\n  public playIcon = 'play-circle';\n  public resetIcon = 'replay';\n\n  get sliderInterval(): number {\n    return this.currentFilter.sliderInterval === undefined\n      ? this._defaultSliderInterval\n      : this.currentFilter.sliderInterval;\n  }\n\n  get displayFormat(): string {\n    if (this.currentFilter.sliderOptions?.displayFormat){\n      return this.currentFilter.sliderOptions.displayFormat;\n    }\n    if (this.currentFilter.displayFormat) {\n      return this.currentFilter.displayFormat;\n    }\n    return this._defaultDisplayFormat;\n  }\n\n  get beginMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.begin);\n  }\n\n  get maxMillisecond(): number {\n    return this.ogcFilterTimeService.dateToNumber(this.max);\n  }\n\n  get stepMillisecond(): number {\n    return this.ogcFilterTimeService.stepMillisecond(this.datasource, this.currentFilter);\n  }\n\n  constructor(public ogcFilterTimeService: OGCFilterTimeService) {\n    this.sliderDisplayWith = this.sliderDisplayWith.bind(this);\n  }\n\n  ngOnInit(){\n    this.calculateStep();\n    this.handleSliderInput({value: 1});\n  }\n\n  sliderDisplayWith(value) {\n    let dateTmp = new Date(this.beginMillisecond + ((value - 1) * this.stepMillisecond));\n\n    if (this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter))) {\n      const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).years();\n      dateTmp = moment(this.beginMillisecond).add((value - 1) * toAdd, 'year').toDate();\n    } else if ( this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter))) {\n      const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).months();\n      dateTmp = moment(this.beginMillisecond).add((value - 1) * toAdd, 'month').toDate();\n    }\n\n    return moment(dateTmp).format(this.displayFormat);\n  }\n\n  playFilter(event: any) {\n    if (this.interval) {\n      this.stopFilter();\n    } else {\n      this.playIcon = 'pause-circle';\n      this.interval = setInterval(\n        that => {\n\n          if (this.slider.value < this.calculatedStep) {\n            const _increment = '_increment';\n            const _emitInputEvent = '_emitInputEvent';\n            this.slider[_increment](1);\n            this.slider[_emitInputEvent]();\n          } else {\n            this.stopFilter();\n          }\n        },\n        this.sliderInterval,\n        this\n      );\n    }\n  }\n\n  stopFilter() {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n  }\n\n  resetFilter(event: any) {\n    if (this.interval) {\n      clearInterval(this.interval);\n    }\n    this.interval = undefined;\n    this.playIcon = 'play-circle';\n    this.slider.value = 1;\n    const _increment = '_increment';\n    const _emitInputEvent = '_emitInputEvent';\n    this.slider[_emitInputEvent]();\n  }\n\n  handleSliderInput(matSliderChange) {\n    if (matSliderChange) {\n\n      if ( this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n        const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).years();\n        const dateBeginTmp = moment(this.beginMillisecond).add((matSliderChange.value - 1) * toAdd, 'year').toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'year').toDate();\n        this.changeProperty.next({value: moment(dateBeginTmp).toDate().toISOString(),\n                                    pos: 1, refreshFilter: false});\n        this.changeProperty.next({value: moment(dateEndTmp).toDate().toISOString(),\n                                    pos: 2, refreshFilter: true});\n\n      } else if ( this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n        const toAdd = moment.duration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)).months();\n        const dateBeginTmp = moment(this.beginMillisecond).add((matSliderChange.value - 1) * toAdd, 'month').toDate();\n        const dateEndTmp = moment(dateBeginTmp).add(toAdd, 'month').toDate();\n        this.changeProperty.next({value: moment(dateBeginTmp).startOf('month').toDate().toISOString(),\n                                    pos: 1, refreshFilter: false});\n        this.changeProperty.next({value: moment(dateEndTmp).toDate().toISOString(),\n                                    pos: 2, refreshFilter: true});\n\n      } else if ( this.ogcFilterTimeService.stepIsDayDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ||\n          this.ogcFilterTimeService.stepIsHourDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ||\n          this.ogcFilterTimeService.stepIsMinuteDuration(this.ogcFilterTimeService.step(this.datasource, this.currentFilter)) ) {\n            const dateTmp = new Date(this.beginMillisecond + (this.stepMillisecond * (matSliderChange.value - 1)));\n            this.changeProperty.next({value: dateTmp.toISOString(), pos: 1, refreshFilter: false});\n            this.changeProperty.next({value: new Date(this.ogcFilterTimeService.addStep(dateTmp.toISOString(),\n                                        this.stepMillisecond)).toISOString(),\n                                        pos: 2, refreshFilter: true});\n      }\n    }\n  }\n\n  calculateStep(){\n    for (let i = 1; (this.maxMillisecond - (this.beginMillisecond + (i * this.stepMillisecond))) >= -1; i++) {\n      this.calculatedStep = i;\n    }\n  }\n\n}\n","<div class=\"slider-container\">\n  <mat-slider\n    id=\"time-slider\"\n    [step]=\"1\"\n    [min]=\"1\"\n    [max]=\"calculatedStep\"\n    [(ngModel)]=\"sliderValue\"\n    [displayWith]=\"sliderDisplayWith\"\n    (input)=\"handleSliderInput($event)\"\n    thumbLabel\n    >\n  </mat-slider>\n  <button mat-icon-button color=\"primary\" (click)=\"playFilter($event)\">\n    <mat-icon [svgIcon]=\"playIcon\"></mat-icon>\n  </button>\n  <button mat-icon-button color=\"primary\" (click)=\"resetFilter($event)\">\n    <mat-icon svgIcon=\"{{resetIcon}}\"></mat-icon>\n  </button>\n  \n</div>","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule, MatNativeDateModule, MAT_DATE_LOCALE } from '@angular/material/core';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatSliderModule } from '@angular/material/slider';\nimport { MatTableModule } from '@angular/material/table';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatTreeModule } from '@angular/material/tree';\n\nimport {\n  MatDatetimepickerModule,\n  MatNativeDatetimeModule\n} from '@mat-datetimepicker/core';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoCollapsibleModule,\n  IgoListModule,\n  IgoKeyValueModule,\n  IgoEntityModule,\n  IgoDOMModule\n} from '@igo2/common';\nimport { IgoGeometryModule } from './../geometry/geometry.module';\n\nimport { FilterableDataSourcePipe } from './shared/filterable-datasource.pipe';\nimport { IgoLayerModule } from '../layer/layer.module';\nimport { TimeFilterButtonComponent } from './time-filter-button/time-filter-button.component';\nimport { TimeFilterFormComponent } from './time-filter-form/time-filter-form.component';\nimport { TimeFilterItemComponent } from './time-filter-item/time-filter-item.component';\nimport { TimeFilterListBindingDirective } from './time-filter-list/time-filter-list-binding.directive';\nimport { TimeFilterListComponent } from './time-filter-list/time-filter-list.component';\nimport { TimeFilterService } from './shared/time-filter.service';\n\nimport { OgcFilterFormComponent } from './ogc-filter-form/ogc-filter-form.component';\nimport { OgcFilterableFormComponent } from './ogc-filterable-form/ogc-filterable-form.component';\nimport { OgcFilterableItemComponent } from './ogc-filterable-item/ogc-filterable-item.component';\nimport { OgcFilterableListBindingDirective } from './ogc-filterable-list/ogc-filterable-list-binding.directive';\nimport { OgcFilterableListComponent } from './ogc-filterable-list/ogc-filterable-list.component';\nimport { OgcFilterButtonComponent } from './ogc-filter-button/ogc-filter-button.component';\nimport { OGCFilterService } from './shared/ogc-filter.service';\nimport { OGCFilterTimeService } from './shared/ogc-filter-time.service';\nimport { OgcFilterSelectionComponent } from './ogc-filter-selection/ogc-filter-selection.component';\n\nimport { SpatialFilterTypeComponent } from './spatial-filter/spatial-filter-type/spatial-filter-type.component';\nimport { SpatialFilterListComponent } from './spatial-filter/spatial-filter-list/spatial-filter-list.component';\nimport { SpatialFilterItemComponent } from './spatial-filter/spatial-filter-item/spatial-filter-item.component';\nimport { SpatialFilterService } from './shared/spatial-filter.service';\nimport { OgcFilterTimeComponent } from './ogc-filter-time/ogc-filter-time.component';\nimport { OgcFilterTimeSliderComponent } from './ogc-filter-time/ogc-filter-time-slider.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatAutocompleteModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTabsModule,\n    MatRadioModule,\n    MatMenuModule,\n    MatTableModule,\n    MatTreeModule,\n    MatButtonToggleModule,\n    MatCheckboxModule,\n    MatSliderModule,\n    MatSlideToggleModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatOptionModule,\n    MatSelectModule,\n    MatListModule,\n    MatTooltipModule,\n    MatDatepickerModule,\n    MatNativeDateModule,\n    MatDatetimepickerModule,\n    MatNativeDatetimeModule,\n    IgoLanguageModule,\n    IgoLayerModule,\n    IgoCollapsibleModule,\n    IgoListModule,\n    IgoEntityModule,\n    IgoDOMModule,\n    IgoKeyValueModule,\n    IgoGeometryModule,\n    MatBadgeModule\n  ],\n  exports: [\n    FilterableDataSourcePipe,\n    TimeFilterButtonComponent,\n    TimeFilterFormComponent,\n    TimeFilterItemComponent,\n    TimeFilterListComponent,\n    TimeFilterListBindingDirective,\n    OgcFilterFormComponent,\n    OgcFilterButtonComponent,\n    OgcFilterSelectionComponent,\n    OgcFilterableFormComponent,\n    OgcFilterableItemComponent,\n    OgcFilterableListComponent,\n    OgcFilterableListBindingDirective,\n    SpatialFilterTypeComponent,\n    SpatialFilterListComponent,\n    SpatialFilterItemComponent,\n    OgcFilterTimeComponent,\n    OgcFilterTimeSliderComponent\n  ],\n  declarations: [\n    FilterableDataSourcePipe,\n    TimeFilterButtonComponent,\n    TimeFilterFormComponent,\n    TimeFilterItemComponent,\n    TimeFilterListComponent,\n    TimeFilterListBindingDirective,\n    OgcFilterFormComponent,\n    OgcFilterButtonComponent,\n    OgcFilterSelectionComponent,\n    OgcFilterableFormComponent,\n    OgcFilterableItemComponent,\n    OgcFilterableListComponent,\n    OgcFilterableListBindingDirective,\n    SpatialFilterTypeComponent,\n    SpatialFilterListComponent,\n    SpatialFilterItemComponent,\n    OgcFilterTimeComponent,\n    OgcFilterTimeSliderComponent\n  ],\n  providers: [TimeFilterService, OGCFilterService, OGCFilterTimeService, SpatialFilterService]\n})\nexport class IgoFilterModule {\n  static forRoot(): ModuleWithProviders<IgoFilterModule> {\n    return {\n      ngModule: IgoFilterModule,\n      providers: [\n        {\n          provide: MAT_DATE_LOCALE,\n          useValue: 'fr-FR'\n        }\n      ]\n    };\n  }\n}\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const ExportFormat = strEnum(['URL', 'GeoJSON', 'GML', 'GPX', 'KML', 'Shapefile', 'CSVcomma', 'CSVsemicolon']);\nexport type ExportFormat = keyof typeof ExportFormat;\n\nexport const EncodingFormat = strEnum(['UTF8', 'LATIN1']);\nexport type EncodingFormat = keyof typeof EncodingFormat;\n","import { Injectable } from '@angular/core';\n\nimport { ConfigService } from '@igo2/core';\nimport { downloadContent } from '@igo2/utils';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport * as olformat from 'ol/format';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport {encode} from 'windows-1252';\n\nimport { ExportFormat, EncodingFormat } from './export.type';\n\nimport {\n  ExportInvalidFileError,\n  ExportNothingToExportError\n} from './export.errors';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ExportService {\n  static ogreFormats = {\n    GML: 'gml',\n    GPX: 'gpx',\n    KML: 'kml',\n    Shapefile: 'ESRI Shapefile',\n    CSVcomma: 'CSVcomma',\n    CSVsemicolon: 'CSVsemicolon'\n  };\n\n  static noOgreFallbacks = ['GML', 'GPX', 'KML'];\n\n  private ogreUrl: string;\n  private aggregateInComment: boolean = true;\n\n  constructor(private config: ConfigService) {\n    this.ogreUrl = this.config.getConfig('importExport.url');\n    const gpxAggregateInComment = this.config.getConfig(\n      'importExport.gpxAggregateInComment'\n    );\n    if (gpxAggregateInComment !== undefined) {\n      this.aggregateInComment = gpxAggregateInComment;\n    }\n  }\n\n  export(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<void> {\n    const exportOlFeatures = this.generateFeature(olFeatures, format);\n\n    return this.exportAsync(exportOlFeatures, format, title, encoding, projectionIn, projectionOut);\n  }\n\n  public generateFeature(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    excludePrefix: string = '_'\n  ): OlFeature<OlGeometry>[] {\n    if (format === ExportFormat.GPX && this.aggregateInComment) {\n      return this.generateAggregatedFeature(olFeatures);\n    }\n\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      const keys = olFeature\n        .getKeys()\n        .filter((key: string) => !key.startsWith(excludePrefix));\n      const properties = keys.reduce(\n        (acc: object, key: string) => {\n          acc[key] = olFeature.get(key);\n          return acc;\n        },\n        { geometry: olFeature.getGeometry() }\n      );\n      return new OlFeature(properties);\n    });\n  }\n\n  private generateAggregatedFeature(olFeatures: OlFeature<OlGeometry>[]): OlFeature<OlGeometry>[] {\n    return olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      const keys = olFeature.getKeys().filter((key: string) => !key.startsWith('_'));\n      let comment: string = '';\n      const properties = keys.reduce((acc: object, key: string) => {\n        if (key && key !== 'geometry') {\n          key === 'id' && olFeature.get('draw') ? comment += key + ':' + olFeature.get('draw') + '   \\r\\n'\n          : comment += key + ':' + olFeature.get(key) + '   \\r\\n';\n        }\n        acc[key] = olFeature.get(key);\n        return acc;\n      },\n      {\n        geometry: olFeature.getGeometry()\n      });\n      const newFeature = new OlFeature(properties);\n      newFeature.set('name', olFeature.getId());\n      newFeature.set('cmt', comment);\n\n      return newFeature;\n    });\n  }\n\n  private exportAsync(\n    olFeatures: OlFeature<OlGeometry>[],\n    format: ExportFormat,\n    title: string,\n    encoding: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<void> {\n    const doExport = (observer: Observer<void>) => {\n      const nothingToExport = this.nothingToExport(olFeatures, format);\n      if (nothingToExport) {\n        observer.error(new ExportNothingToExportError());\n        return;\n      }\n\n      const ogreFormats = Object.keys(ExportService.ogreFormats);\n      if (ogreFormats.indexOf(format) >= 0) {\n        if (!this.ogreUrl) {\n          if (ExportService.noOgreFallbacks.indexOf(format) >= 0) {\n            this.exportToFile(olFeatures, observer, format, title, projectionIn, projectionOut);\n          } else {\n            observer.error(new ExportInvalidFileError());\n          }\n          return;\n        }\n        this.exportWithOgre(olFeatures, observer, format, title, encoding, projectionIn, projectionOut);\n      } else {\n        this.exportToFile(olFeatures, observer, format, title, projectionIn, projectionOut);\n      }\n    };\n\n    return new Observable(doExport);\n  }\n\n  protected exportToFile(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: ExportFormat,\n    title: string,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const olFormat = new olformat[format]();\n    const featuresText = olFormat.writeFeatures(olFeatures, {\n      dataProjection: projectionOut,\n      featureProjection: projectionIn,\n      featureType: 'feature',\n      featureNS: 'http://example.com/feature'\n    });\n\n    const fileName = `${title}.${format.toLowerCase()}`;\n\n    downloadContent(featuresText, 'text/plain;charset=utf-8', fileName);\n    observer.complete();\n  }\n\n  private exportWithOgre(\n    olFeatures: OlFeature<OlGeometry>[],\n    observer: Observer<void>,\n    format: string,\n    title: string,\n    encodingType: EncodingFormat,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    let featuresText: string = new olformat.GeoJSON().writeFeatures(\n      olFeatures,\n      {\n        dataProjection: projectionOut,\n        featureProjection: projectionIn\n      }\n    );\n\n    const url = `${this.ogreUrl}/convertJson`;\n    const form = document.createElement('form');\n    form.style.display = 'none';\n    document.body.appendChild(form);\n    form.setAttribute('method', 'post');\n    form.setAttribute('target', '_blank');\n    form.setAttribute('action', url);\n\n    if (encodingType === EncodingFormat.UTF8) {\n      form.acceptCharset = 'UTF-8';\n      form.enctype = 'application/x-www-form-urlencoded; charset=utf-8;';\n    } else if (encodingType === EncodingFormat.LATIN1) {\n      const enctype = 'ISO-8859-1';\n      const featuresJson = JSON.parse(featuresText);\n      featuresJson.features.map(f => {\n        const encodedProperties = String.fromCharCode\n          .apply(null, encode(JSON.stringify(f.properties), { mode: 'replacement' }));\n        f.properties = JSON.parse(encodedProperties);\n      });\n      featuresText = JSON.stringify(featuresJson);\n      const encoding = document.createElement('input');\n      encoding.setAttribute('type', 'hidden');\n      encoding.setAttribute('name', 'encoding');\n      encoding.setAttribute('value', enctype);\n      form.appendChild(encoding);\n    }\n\n    if (format === 'CSVsemicolon') {\n      const options = document.createElement('input');\n      options.setAttribute('type', 'hidden');\n      options.setAttribute('name', 'lco');\n      options.setAttribute('value', 'SEPARATOR=SEMICOLON');\n      form.appendChild(options);\n    }\n\n    const geojsonField = document.createElement('input');\n    geojsonField.setAttribute('type', 'hidden');\n    geojsonField.setAttribute('name', 'json');\n    geojsonField.setAttribute('value', featuresText);\n    form.appendChild(geojsonField);\n\n    const outputNameField = document.createElement('input');\n    let outputName = format === 'Shapefile' ? `${title}.zip` : `${title}.${format.toLowerCase()}`;\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      outputName = `${title}.csv`;\n    }\n    outputName = outputName.replace(' ', '_');\n    outputName = outputName.normalize('NFD').replace(/[\\u0300-\\u036f]/g, '').replace(//g, \"'\");\n    outputNameField.setAttribute('type', 'hidden');\n    outputNameField.setAttribute('name', 'outputName');\n    outputNameField.setAttribute('value', outputName);\n    form.appendChild(outputNameField);\n\n    let ogreFormat = ExportService.ogreFormats[format];\n    if (format === 'CSVcomma' || format === 'CSVsemicolon') {\n      ogreFormat = 'CSV';\n    }\n    const outputFormatField = document.createElement('input');\n    outputFormatField.setAttribute('type', 'hidden');\n    outputFormatField.setAttribute('name', 'format');\n    outputFormatField.setAttribute('value', ogreFormat);\n    form.appendChild(outputFormatField);\n\n    form.submit();\n    document.body.removeChild(form);\n\n    observer.complete();\n  }\n\n  private nothingToExport(olFeatures: OlFeature<OlGeometry>[], format: string): boolean {\n    if (olFeatures.length === 0) {\n      return true;\n    }\n    if (format === 'GPX') {\n      const pointOrLine = olFeatures.find(olFeature => {\n        return (\n          ['Point', 'LineString', 'MultiLineString'].indexOf(olFeature.getGeometry().getType()) >= 0\n        );\n      });\n      return pointOrLine === undefined;\n    }\n    return false;\n  }\n}\n","/**\n * Trigger download of a file\n *\n * @param content File content\n * @param mimeType File mime type\n * @param fileName File name\n */\nexport function downloadContent(content: string, mimeType: string, fileName: string) {\n  const uri = `data:${mimeType},${encodeURIComponent(content)}`;\n  downloadFromUri(uri, fileName);\n}\n\n/**\n * Trigger download of a file\n *\n * @param content File content\n * @param mimeType File mime type\n * @param fileName File name\n */\nexport function downloadFromUri(uri: string, fileName: string) {\n  const element = document.createElement('a');\n  element.setAttribute('href', uri);\n  element.setAttribute('download', fileName);\n  element.style.display = 'none';\n  document.body.appendChild(element);\n\n  element.click();\n\n  document.body.removeChild(element);\n}\n","import * as olStyle from 'ol/style';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { MessageService, LanguageService } from '@igo2/core';\n\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { FeatureDataSourceOptions } from '../../datasource/shared/datasources/feature-datasource.interface';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  featureToOl,\n  moveToOlFeatures,\n  computeOlFeaturesExtent\n} from '../../feature/shared/feature.utils';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { IgoMap } from '../../map/shared/map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { StyleByAttribute } from '../../layer/shared/vector-style.interface';\nimport { StyleListService } from '../style-list/style-list.service';\nimport { ClusterParam } from '../../layer/shared/clusterParam';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { ClusterDataSourceOptions } from '../../datasource/shared/datasources/cluster-datasource.interface';\nimport { uuid } from '@igo2/utils';\n\nexport function addLayerAndFeaturesToMap(\n  features: Feature[],\n  map: IgoMap,\n  layerTitle: string\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n    type: 'vector',\n    queryable: true\n  };\n  const source = new FeatureDataSource(sourceOptions);\n  source.ol.addFeatures(olFeatures);\n  const layer = new VectorLayer({\n    title: layerTitle,\n    isIgoInternalLayer: true,\n    source,\n    style: createImportedLayerRandomStyle()\n  });\n  layer.setExtent(computeOlFeaturesExtent(map, olFeatures));\n  map.addLayer(layer);\n  moveToOlFeatures(map, olFeatures);\n\n  return layer;\n}\n\nexport function addLayerAndFeaturesStyledToMap(\n  features: Feature[],\n  map: IgoMap,\n  layerTitle: string,\n  styleListService: StyleListService,\n  styleService: StyleService,\n  layerId?: string,\n  imposedSourceOptions?,\n  imposedLayerOptions?,\n  zoomTo: boolean = true\n\n): VectorLayer {\n  const olFeatures = features.map((feature: Feature) =>\n    featureToOl(feature, map.projection)\n  );\n  let style;\n  let distance: number;\n\n  if (\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\n  ) {\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\n      layerTitle.toString() + '.styleByAttribute'\n    );\n\n    style = (feature, resolution) => {\n      return styleService.createStyleByAttribute(feature, styleByAttribute, resolution);\n    };\n  } else if (\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      layerTitle.toString() + '.clusterParam'\n    );\n    distance = styleListService.getStyleList(\n      layerTitle.toString() + '.distance'\n    );\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList(layerTitle.toString() + '.clusterStyle'), feature, resolution\n      );\n      return styleService.createClusterStyle(feature, resolution, clusterParam, baseStyle);\n    };\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\n    style = (feature, resolution) => styleService.createStyle(\n      styleListService.getStyleList(layerTitle.toString() + '.style'), feature, resolution\n    );\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      'default.clusterParam'\n    );\n    distance = styleListService.getStyleList('default.distance');\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList('default.clusterStyle'), feature, resolution\n      );\n      return styleService.createClusterStyle(feature, resolution, clusterParam, baseStyle);\n    };\n  } else {\n    style = (feature, resolution) => styleService.createStyle(\n      styleListService.getStyleList('default.style'), feature, resolution\n    );\n  }\n\n  let source;\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\n    const sourceOptions: ClusterDataSourceOptions &\n      QueryableDataSourceOptions = {\n      distance,\n      type: 'cluster',\n      queryable: true\n    };\n    source = new ClusterDataSource(Object.assign(sourceOptions, imposedSourceOptions));\n    source.ol.source.addFeatures(olFeatures);\n  } else if (styleListService.getStyleList(layerTitle.toString())) {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n      type: 'vector',\n      queryable: true\n    };\n    source = new FeatureDataSource(Object.assign(sourceOptions, imposedSourceOptions));\n    source.ol.addFeatures(olFeatures);\n  } else if (\n    styleListService.getStyleList('default.clusterStyle') &&\n    features[0].geometry.type === 'Point'\n  ) {\n    const sourceOptions: ClusterDataSourceOptions &\n      QueryableDataSourceOptions = {\n      distance,\n      type: 'cluster',\n      queryable: true\n    };\n    source = new ClusterDataSource(Object.assign(sourceOptions, imposedSourceOptions));\n    source.ol.source.addFeatures(olFeatures);\n  } else {\n    const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n      type: 'vector',\n      queryable: true\n    };\n    source = new FeatureDataSource(Object.assign(sourceOptions, imposedSourceOptions));\n    source.ol.addFeatures(olFeatures);\n  }\n\n  const layer = new VectorLayer(\n    Object.assign({\n      title: layerTitle,\n      id: layerId || uuid(),\n      isIgoInternalLayer: true,\n      source,\n      style\n    }, imposedLayerOptions));\n  map.addLayer(layer);\n  if (zoomTo){\n    moveToOlFeatures(map, olFeatures);\n  }\n  return layer;\n}\n\nexport function handleFileImportSuccess(\n  file: File,\n  features: Feature[],\n  map: IgoMap,\n  messageService: MessageService,\n  languageService: LanguageService,\n  styleListService?: StyleListService,\n  styleService?: StyleService\n) {\n  if (features.length === 0) {\n    handleNothingToImportError(file, messageService, languageService);\n    return;\n  }\n\n  const layerTitle = computeLayerTitleFromFile(file);\n\n  if (!styleListService) {\n    addLayerAndFeaturesToMap(features, map, layerTitle);\n  } else {\n    addLayerAndFeaturesStyledToMap(\n      features,\n      map,\n      layerTitle,\n      styleListService,\n      styleService\n    );\n  }\n\n  const translate = languageService.translate;\n  const messageTitle = translate.instant('igo.geo.dropGeoFile.success.title');\n  const message = translate.instant('igo.geo.dropGeoFile.success.text', {\n    value: layerTitle\n  });\n  messageService.success(message, messageTitle);\n}\n\nexport function handleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService,\n  sizeMb?: number\n) {\n  sizeMb = sizeMb ? sizeMb : 30;\n  const errMapping = {\n    'Invalid file': handleInvalidFileImportError,\n    'File is too large': handleSizeFileImportError,\n    'Failed to read file': handleUnreadbleFileImportError,\n    'Invalid SRS definition': handleSRSImportError,\n    'Error 500 with OGRE': handleOgreServerImportError\n  };\n  errMapping[error.message](\n    file,\n    error,\n    messageService,\n    languageService,\n    sizeMb\n  );\n}\n\nexport function handleInvalidFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.invalid.title');\n  const message = translate.instant('igo.geo.dropGeoFile.invalid.text', {\n    value: file.name,\n    mimeType: file.type\n  });\n  messageService.error(message, title);\n}\n\nexport function handleUnreadbleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.unreadable.title');\n  const message = translate.instant('igo.geo.dropGeoFile.unreadable.text', {\n    value: file.name\n  });\n  messageService.error(message, title);\n}\n\nexport function handleSizeFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService,\n  sizeMb: number\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.tooLarge.title');\n  const message = translate.instant('igo.geo.dropGeoFile.tooLarge.text', {\n    value: file.name,\n    size: sizeMb\n  });\n  messageService.error(message, title);\n}\n\nexport function handleNothingToImportError(\n  file: File,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.empty.title');\n  const message = translate.instant('igo.geo.dropGeoFile.empty.text', {\n    value: file.name,\n    mimeType: file.type\n  });\n  messageService.error(message, title);\n}\n\nexport function handleSRSImportError(\n  file: File,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.dropGeoFile.invalidSRS.title');\n  const message = translate.instant('igo.geo.dropGeoFile.invalidSRS.text', {\n    value: file.name,\n    mimeType: file.type\n  });\n  messageService.error(message, title);\n}\n\nexport function handleOgreServerImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const title = languageService.translate.instant('igo.geo.dropGeoFile.ogreServer.title');\n  const message = languageService.translate.instant('igo.geo.dropGeoFile.ogreServer.text');\n  messageService.error(message, title);\n}\n\nexport function getFileExtension(file: File): string {\n  return file.name\n    .split('.')\n    .pop()\n    .toLowerCase();\n}\n\nexport function computeLayerTitleFromFile(file: File): string {\n  return file.name.substr(0, file.name.lastIndexOf('.'));\n}\nfunction createImportedLayerRandomStyle(): (olFeature: OlFeature<OlGeometry>) => olStyle.Style {\n  const r = Math.floor(Math.random() * 255);\n  const g = Math.floor(Math.random() * 255);\n  const b = Math.floor(Math.random() * 255);\n  const stroke = new olStyle.Stroke({\n    color: [r, g, b, 1],\n    width: 2\n  });\n  const fill = new olStyle.Fill({\n    color: [r, g, b, 0.4]\n  });\n\n  return (olFeature: OlFeature<OlGeometry>) => {\n      const customStyle = olFeature.get('_style');\n      if (customStyle) {\n        const styleService = new StyleService();\n        return styleService.createStyle(customStyle);\n      }\n\n      const style = new olStyle.Style({\n        stroke,\n        fill,\n        image: new olStyle.Circle({\n          radius: 5,\n          stroke,\n          fill\n        }),\n        text: olFeature.get('_mapTitle') ? new olStyle.Text({\n          text: olFeature.get('_mapTitle').toString(),\n          offsetX: 5,\n          offsetY: -5,\n          font: '12px Calibri,sans-serif',\n          fill: new olStyle.Fill({ color: '#000' }),\n          stroke: new olStyle.Stroke({ color: '#fff', width: 3 }),\n          overflow: true\n        }): undefined\n      });\n      return style;\n  };\n}\n\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n      super('Failed to read file');\n      Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n      super('Nothing to import');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n      super('File is too large');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n      super('Invalid SRS definition');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportOgreServerError extends ImportError {\n  constructor() {\n      super('Error 500 with OGRE');\n      Object.setPrototypeOf(this, ImportOgreServerError.prototype);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\nimport { uuid } from '@igo2/utils';\n\nimport { Observable, Observer } from 'rxjs';\n\nimport * as olformat from 'ol/format';\nimport OlFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport {\n  ImportInvalidFileError,\n  ImportUnreadableFileError,\n  ImportSizeError,\n  ImportSRSError,\n  ImportOgreServerError\n} from './import.errors';\nimport { computeLayerTitleFromFile, getFileExtension } from './import.utils';\nimport { ImportExportServiceOptions } from './import.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ImportService {\n\n  static formatExtensionAssociation = {\n    GeoJSON: 'geojson',\n    GML: 'gml',\n    GPX: 'gpx',\n    KML: 'kml',\n    Shapefile: 'zip'\n  };\n\n  static allowedMimeTypes = [\n    'application/gml+xml',\n    'application/vnd.google-earth.kml+xml',\n    'application/gpx+xml',\n    'application/json'\n  ];\n\n  static allowedZipMimeTypes = [\n    'application/zip',\n    'application/x-zip-compressed',\n    'application/x-zip'\n  ];\n\n  static allowedExtensions = ['geojson', 'kml', 'gpx', 'json', 'gml', 'zip'];\n\n  private ogreUrl: string;\n  private clientSideFileSizeMax: number;\n\n  constructor(private http: HttpClient, private config: ConfigService) {\n    const importConfig = this.config.getConfig('importExport') as ImportExportServiceOptions;\n    this.ogreUrl = importConfig.url;\n    const configFileSizeMb = importConfig.clientSideFileSizeMaxMb;\n    this.clientSideFileSizeMax = (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    if (importConfig.formats) {\n      ImportService.allowedExtensions = importConfig.formats\n        .map(format => ImportService.formatExtensionAssociation[format])\n        .filter(e => e);\n      if (ImportService.allowedExtensions.includes('geojson')) {\n        ImportService.allowedExtensions.push('json');\n      }\n    }\n  }\n\n  import(\n    file: File,\n    projectionIn = 'EPSG:4326',\n    projectionOut = 'EPSG:4326'\n  ): Observable<Feature[]> {\n    return this.importAsync(file, projectionIn, projectionOut);\n  }\n\n  private getFileImporter(\n    file: File\n  ): (\n      file: File,\n      observer: Observer<Feature[]>,\n      projectionIn: string,\n      projectionOut: string\n    ) => void {\n    const extension = getFileExtension(file);\n    const allowedExtensions = ImportService.allowedExtensions;\n    let zipMimeTypes = [];\n    if (allowedExtensions.includes('zip')) {\n      zipMimeTypes = ImportService.allowedZipMimeTypes;\n    }\n    const mimeType = file.type;\n    const allowedMimeTypes = [\n      ...ImportService.allowedMimeTypes,\n      ...zipMimeTypes\n    ];\n\n    if (\n      allowedMimeTypes.indexOf(mimeType) < 0 &&\n      allowedExtensions.indexOf(extension) < 0\n    ) {\n      return undefined;\n    } else if (\n      mimeType === 'application/json' ||\n      ['json', 'geojson', 'kml', 'gpx'].indexOf(extension) >= 0\n    ) {\n      return this.importFile;\n    } else if (this.ogreUrl !== undefined) {\n      return this.importFileWithOgre;\n    }\n\n    return undefined;\n  }\n\n  private importAsync(\n    file: File,\n    projectionIn: string,\n    projectionOut: string\n  ): Observable<Feature[]> {\n    const doImport = (observer: Observer<Feature[]>) => {\n      if (file.size >= this.clientSideFileSizeMax) {\n        observer.error(new ImportSizeError());\n        return;\n      }\n      const importer = this.getFileImporter(file);\n      if (importer === undefined) {\n        observer.error(new ImportInvalidFileError());\n        return;\n      }\n\n      importer.call(this, file, observer, projectionIn, projectionOut);\n    };\n\n    return new Observable(doImport);\n  }\n\n  private importFile(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const reader = new FileReader();\n\n    reader.onload = (event: any) => {\n      try {\n        const features = this.parseFeaturesFromFile(\n          file,\n          event.target.result,\n          projectionIn,\n          projectionOut\n        );\n        observer.next(features);\n      } catch (e) {\n        observer.error(new ImportUnreadableFileError());\n      }\n\n      observer.complete();\n    };\n\n    reader.onerror = evt => {\n      observer.error(new ImportUnreadableFileError());\n    };\n\n    reader.readAsText(file, 'UTF-8');\n  }\n\n  private importFileWithOgre(\n    file: File,\n    observer: Observer<Feature[]>,\n    projectionIn: string,\n    projectionOut: string\n  ) {\n    const url = `${this.ogreUrl}/convert`;\n    const formData = new FormData();\n    formData.append('upload', file);\n    formData.append('sourceSrs', projectionIn);\n    formData.append('targetSrs', projectionOut);\n    formData.append('formatOutput', 'GEOJSON');\n    formData.append('skipFailures', '');\n\n    this.http.post(url, formData, { headers: new HttpHeaders() })\n      .subscribe(\n        (response: { errors?: string[] } | object | null) => {\n          if (response === null) {\n            observer.error(new ImportUnreadableFileError());\n            return;\n          }\n\n          const errors = (response as any).errors || [];\n          if (errors.length > 0) {\n            observer.error(new ImportUnreadableFileError());\n          } else {\n            const features = this.parseFeaturesFromGeoJSON(\n              file,\n              response,\n              projectionOut\n            );\n            observer.next(features);\n            observer.complete();\n          }\n        },\n        (error: any) => {\n          error.error.caught = true;\n          const errMsg = error.error.msg || '';\n          if (errMsg === 'No valid files found') {\n            observer.error(new ImportInvalidFileError());\n          } else if (errMsg && errMsg.startWith('ERROR 1: Failed to process SRS definition')\n          ) {\n            observer.error(new ImportSRSError());\n          } else if (error.status === 500) {\n            observer.error(new ImportOgreServerError());\n          } else {\n            observer.error(new ImportUnreadableFileError());\n          }\n        }\n      );\n  }\n\n  private parseFeaturesFromFile(\n    file: File,\n    data: string,\n    projectionIn: string,\n    projectionOut: string\n  ): Feature[] {\n    const extension = getFileExtension(file);\n    const mimeType = file.type;\n\n    const GeoJSON = new olformat.GeoJSON();\n\n    let format;\n    if (mimeType === 'application/vnd.google-earth.kml+xml') {\n      format = new olformat.KML();\n    } else if (mimeType === 'application/gml+xml') {\n      format = new olformat.GML();\n    } else if (mimeType === 'application/gpx+xml') {\n      format = new olformat.GPX();\n    } else {\n      switch (extension) {\n        case 'kml':\n          format = new olformat.KML();\n          break;\n        case 'gpx':\n          format = new olformat.GPX();\n          break;\n        case 'gml':\n          format = new olformat.GML();\n          break;\n        default:\n          format = GeoJSON;\n          break;\n      }\n    }\n\n    const olFeatures = format.readFeatures(data, {\n      dataProjection: projectionIn,\n      featureProjection: projectionOut\n    });\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(GeoJSON.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features;\n  }\n\n  private parseFeaturesFromGeoJSON(\n    file: File,\n    data: object,\n    projectionOut: string\n  ): Feature[] {\n    const olFormat = new olformat.GeoJSON();\n    const olFeatures = olFormat.readFeatures(data);\n    const features = olFeatures.map((olFeature: OlFeature<OlGeometry>) => {\n      return Object.assign(olFormat.writeFeatureObject(olFeature), {\n        projection: projectionOut,\n        meta: {\n          id: uuid(),\n          title: computeLayerTitleFromFile(file)\n        }\n      });\n    });\n\n    return features as Feature[];\n  }\n}\n","import { Injectable, Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { throwError } from 'rxjs';\nimport { catchError } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { StyleListOptions } from './style-list.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StyleListService {\n  private styleList: object = {};\n\n  constructor(private injector: Injector) {}\n\n  /**\n   * Use to get the data found in styleList file\n   */\n  public getStyleList(key: string): any {\n    return ObjectUtils.resolve(this.styleList, key);\n  }\n\n  /**\n   * This method loads \"[path]\" to get all styleList's variables\n   */\n  public load(options: StyleListOptions) {\n    const baseStyleList = options.default || {};\n    if (!options.path) {\n      this.styleList = baseStyleList;\n      return true;\n    }\n\n    const http = this.injector.get(HttpClient);\n\n    return new Promise((resolve, _reject) => {\n      http\n        .get(options.path)\n        .pipe(\n          catchError((error: any): any => {\n            console.log(`StyleList file ${options.path} could not be read`);\n            resolve(true);\n            return throwError(error.error || 'Server error');\n          })\n        )\n        .subscribe((styleListResponse: object) => {\n          this.styleList = ObjectUtils.mergeDeep(baseStyleList, styleListResponse);\n          resolve(true);\n        });\n    });\n  }\n}\n","<div class=\"import-export-toggle mat-typography\">\n  <mat-button-toggle-group\n        [value]=\"selectedMode\"\n        (change)=\"onImportExportChange($event)\">\n        <mat-button-toggle [value]=\"'import'\">\n          {{'igo.geo.importExportForm.importTabTitle' | translate}}\n        </mat-button-toggle>\n        <mat-button-toggle [value]=\"'export'\">\n          {{'igo.geo.importExportForm.exportTabTitle' | translate}}\n        </mat-button-toggle>\n  </mat-button-toggle-group>\n</div>\n\n<form class=\"igo-form\" [formGroup]=\"importForm\" *ngIf=\"selectedMode === 'import'\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.importProjPlaceholder' | translate}}</mat-label>\n      <mat-select\n        [(value)]=\"inputProj\">\n        <mat-option\n          *ngFor=\"let projection of (projections$ | async)\"\n          [value]=\"projection\"\n          (click)=\"$event.stopPropagation()\">\n          <p mat-line *ngIf=\"projection.translateKey\">{{('igo.geo.importExportForm.projections.' + projection.translateKey) | translate: projection}}</p>\n          <p mat-line *ngIf=\"!projection.translateKey\">{{projection.alias}}</p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"importForm.invalid ? ('igo.geo.importExportForm.projections.choose' | translate) : ('igo.geo.importExportForm.importButton' | translate)\"\n    class=\"igo-form-button-group\">\n    <button\n      [disabled]=\"importForm.invalid || (loading$ | async)\"\n      mat-raised-button\n      type=\"button\"\n      (click)=\"fileInput.click()\">\n        {{'igo.geo.importExportForm.importButton' | translate}}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n    <input\n      hidden\n      #fileInput\n      type=\"file\"\n      [style.display]=\"'none'\"\n      (click)=\"fileInput.value = null\"\n      (change)=\"importFiles($event.target.files)\">\n  </div>\n</form>\n<section class=\"mat-typography\" *ngIf=\"selectedMode === 'import'\">\n  <div *ngIf=\"importHtmlClarifications === ''\">\n    <h4>{{'igo.geo.importExportForm.importClarifications' | translate}}</h4>\n    <ul>\n      <li>{{'igo.geo.importExportForm.importSizeMax' | translate: {size: fileSizeMb} }}</li>\n      <li>{{'igo.geo.importExportForm.importFormatAuthorized' | translate}}</li>\n      <li>{{'igo.geo.importExportForm.importShpZip' | translate}}</li>\n    </ul>\n  </div>\n  <igo-custom-html *ngIf=\"importHtmlClarifications !== ''\" class=\"mat-typography\"\n    [html]=\"importHtmlClarifications\">\n  </igo-custom-html>\n</section>\n\n<section class=\"mat-typography\" *ngIf=\"(exportableLayers$ | async).length === 0 && selectedMode === 'export'\">\n  <h4>{{'igo.geo.importExportForm.exportNoLayersExportable' | translate}}</h4>\n</section>\n\n<form class=\"igo-form\" [formGroup]=\"form\" *ngIf=\"(exportableLayers$ | async).length > 0 && selectedMode === 'export'\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.exportLayerPlaceholder' | translate}}</mat-label>\n      <mat-select\n        [(value)]=\"layers\" multiple>\n        <mat-select-trigger>\n          {{layers.length ? getLayerTitleById(layers[0]) : ''}}\n          <span *ngIf=\"layers.length > 1\" class=\"export-select-trigger\">\n            (+{{layers.length - 1}} {{(layers?.length === 2 ? 'igo.geo.importExportForm.other' : 'igo.geo.importExportForm.others') | translate }})\n          </span>\n        </mat-select-trigger>\n        <mat-option\n          *ngFor=\"let layer of (exportableLayers$ | async)\"\n          [ngClass]=\"{'igo-export-layer-mat-option': layerHasSelectedFeatures(layer)}\"\n          [value]=\"layer.id\"\n          (click)=\"$event.stopPropagation()\">\n          <p mat-line>{{layer.title}}</p>\n          <p mat-line>\n            <mat-slide-toggle *ngIf=\"layerHasSelectedFeatures(layer)\"\n              [labelPosition]=\"'after'\"\n              (click)=\"onlySelectedClick($event,layer.id)\"\n              (checked)=\"inLayersIdToExportSelectionOnly(layer)\"\n              (change)=\"onlySelected($event,layer.id)\">\n              <small>{{'igo.geo.importExportForm.exportSelectedFeature' | translate}}</small>\n            </mat-slide-toggle>\n          </p>\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.exportFormatPlaceholder' | translate}}</mat-label>\n      <mat-select\n        formControlName=\"format\">\n        <ng-container *ngIf=\"(formats$ | async).length !== 0\">\n          <mat-option *ngFor=\"let format of (formats$ | async) | keyvalue\" [value]=\"format.key\">\n            {{'igo.geo.export.format.' + format.value | translate}}\n          </mat-option>\n        </ng-container>\n        <mat-option *ngIf=\"(formats$ | async).length === 0\" disabled=\"true\">\n          {{'igo.geo.export.noFormat.title' | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" *ngIf=\"forceNaming && form.value.format !== 'URL'\">\n    <mat-form-field>\n        <input matInput formControlName=\"name\" placeholder=\"{{'igo.geo.importExportForm.exportFileNamePlaceholder' | translate}}\">\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" *ngIf=\"form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon'\">\n    <mat-form-field>\n      <mat-label>{{'igo.geo.importExportForm.encodingPlaceholder' | translate}}</mat-label>\n      <mat-select\n        formControlName=\"encoding\">\n        <ng-container *ngIf=\"(encodings$ | async).length !== 0\">\n          <mat-option *ngFor=\"let encoding of (encodings$ | async) | keyvalue\" [value]=\"encoding.key\">\n            {{'igo.geo.export.encoding.' + encoding.value | translate}}\n          </mat-option>\n        </ng-container>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"export-combine-layers mat-typography\" *ngIf=\"layers.length > 1 && (form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon')\">\n    <mat-slide-toggle\n        formControlName=\"combineLayers\"\n        [labelPosition]=\"'before'\">\n          {{'igo.geo.importExportForm.exportCombineResults' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"export-separator mat-typography\" *ngIf=\"layers.length > 1 && (form.value.format === 'CSVcomma' || form.value.format === 'CSVsemicolon') && form.value.combineLayers\">\n    <mat-slide-toggle\n        formControlName=\"separator\"\n        [labelPosition]=\"'before'\">\n          {{'igo.geo.importExportForm.exportSeparator' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"export-options mat-typography\" *ngIf=\"form.value.format !== 'URL'\">\n    <mat-slide-toggle\n        formControlName=\"featureInMapExtent\"\n        [labelPosition]=\"'before'\">\n          {{'igo.geo.importExportForm.exportFeatureInExtent' | translate}}\n    </mat-slide-toggle>\n  </div>\n\n  <div class=\"igo-form-button-group\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (loading$ | async)\"\n      (click)=\"handleExportFormSubmit(form.value)\">\n      {{form.value.format !== 'URL'  ? ('igo.geo.importExportForm.exportButton' | translate): (form.value.layers.length > 1  ? ('igo.geo.importExportForm.exportButtonLinks' | translate): ('igo.geo.importExportForm.exportButtonLink' | translate))}}\n    </button>\n    <igo-spinner [shown]=\"loading$ | async\"></igo-spinner>\n  </div>\n\n  <igo-custom-html *ngIf=\"exportHtmlClarifications !== ''\" class=\"mat-typography\"\n    [html]=\"exportHtmlClarifications\">\n  </igo-custom-html>\n\n</form>\n","import {\n  Component,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  EventEmitter,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { UntypedFormGroup, UntypedFormBuilder, Validators } from '@angular/forms';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\nimport {\n  MessageService,\n  LanguageService,\n  ConfigService,\n  StorageService\n} from '@igo2/core';\nimport { strEnum } from '@igo2/utils';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { IgoMap } from '../../map/shared/map';\nimport { ClusterDataSource } from '../../datasource/shared/datasources/cluster-datasource';\nimport { Layer } from '../../layer/shared/layers/layer';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { AnyLayer } from '../../layer/shared/layers/any-layer';\nimport { DataSourceOptions } from '../../datasource/shared/datasources/datasource.interface';\nimport olPoint from 'ol/geom/Point';\nimport { circular } from 'ol/geom/Polygon';\n\nimport {\n  handleFileExportError,\n  handleFileExportSuccess\n} from '../shared/export.utils';\nimport { ExportOptions } from '../shared/export.interface';\nimport { ExportFormat, EncodingFormat } from '../shared/export.type';\nimport { ExportService } from '../shared/export.service';\nimport { ImportService } from '../shared/import.service';\nimport {\n  handleFileImportSuccess,\n  handleFileImportError\n} from '../shared/import.utils';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { StyleListService } from '../style-list/style-list.service';\nimport { skipWhile } from 'rxjs/operators';\nimport { EntityRecord, Workspace } from '@igo2/common';\nimport type { WorkspaceStore } from '@igo2/common';\nimport { WfsWorkspace } from '../../workspace/shared/wfs-workspace';\nimport { EditionWorkspace } from '../../workspace/shared/edition-workspace';\nimport { FeatureWorkspace } from '../../workspace/shared/feature-workspace';\nimport { MatSlideToggleChange } from '@angular/material/slide-toggle';\nimport { InputProjections, ProjectionsLimitationsOptions } from '../../map/';\nimport { DownloadService } from '../../download/shared/download.service';\nimport { computeProjectionsConstraints } from '../../map';\n\nimport olVectorSource from 'ol/source/Vector';\nimport olClusterSource from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Component({\n  selector: 'igo-import-export',\n  templateUrl: './import-export.component.html',\n  styleUrls: ['./import-export.component.scss']\n})\nexport class ImportExportComponent implements OnDestroy, OnInit {\n  public form: UntypedFormGroup;\n  public importForm: UntypedFormGroup;\n  public formats$ = new BehaviorSubject(undefined);\n  public encodings$ = new BehaviorSubject(undefined);\n  public exportableLayers$: BehaviorSubject<AnyLayer[]> = new BehaviorSubject(\n    []\n  );\n  public loading$ = new BehaviorSubject(false);\n  public forceNaming = false;\n  public controlFormat = 'format';\n\n  private layers$$: Subscription;\n  private exportableLayers$$: Subscription;\n  private formats$$: Subscription;\n  private encodings$$: Subscription;\n  private formLayer$$: Subscription;\n  private exportOptions$$: Subscription;\n\n  public importHtmlClarifications: string;\n  public exportHtmlClarifications: string;\n\n  private espgCodeRegex = new RegExp('^\\\\d{4,6}');\n  private clientSideFileSizeMax: number;\n  public fileSizeMb: number;\n\n  public projections$: BehaviorSubject<InputProjections[]> = new BehaviorSubject([]);\n  private projectionsConstraints: ProjectionsLimitationsOptions;\n\n  public popupChecked: boolean = false;\n\n  private previousLayerSpecs$: BehaviorSubject<\n    {\n      id: string;\n      visible: boolean;\n      opacity: number;\n      queryable: boolean;\n    }[]\n  > = new BehaviorSubject(undefined);\n\n  @Input() selectFirstProj: boolean = false;\n\n  @Input() map: IgoMap;\n\n  private _projectionsLimitations: ProjectionsLimitationsOptions = {};\n  @Input()\n  set projectionsLimitations(value: ProjectionsLimitationsOptions) {\n    this._projectionsLimitations = value;\n    this.computeProjections();\n  }\n  get projectionsLimitations(): ProjectionsLimitationsOptions {\n    return this._projectionsLimitations || {};\n  }\n\n  /**\n   * Store that holds the available workspaces.\n   */\n  @Input() store: WorkspaceStore;\n\n  @Input() selectedMode = 'import';\n\n  @Output() selectMode = new EventEmitter<string>();\n\n  @Input() exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(\n    undefined\n  );\n\n  @Output() exportOptionsChange = new EventEmitter<ExportOptions>();\n\n  get layers() {\n    return this.form.get('layers').value;\n  }\n  set layers(value) {\n    this.form.patchValue({ layers: value });\n  }\n\n  get inputProj() {\n    return this.importForm.get('inputProj').value;\n  }\n  set inputProj(value) {\n    this.importForm.patchValue({ inputProj: value });\n  }\n\n  get popupAllowed(): boolean {\n    return this.storageService.get('importExportPopupAllowed') as boolean || false;\n  }\n\n  set popupAllowed(value: boolean) {\n    this.storageService.set('importExportPopupAllowed', value);\n  }\n\n  constructor(\n    private importService: ImportService,\n    private exportService: ExportService,\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    private formBuilder: UntypedFormBuilder,\n    private config: ConfigService,\n    private cdRef: ChangeDetectorRef,\n    private storageService: StorageService,\n    private downloadService: DownloadService\n  ) {\n    this.loadConfig();\n    this.buildForm();\n    this.computeProjections();\n    this.importHtmlClarifications = this.languageService.translate.instant('igo.geo.importExportForm.importHtmlClarifications');\n    this.exportHtmlClarifications = this.languageService.translate.instant('igo.geo.importExportForm.exportHtmlClarifications');\n  }\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      this.exportableLayers$.next(\n        layers.filter((layer: Layer) => {\n          return (\n            (layer instanceof VectorLayer && layer.exportable === true) ||\n            (layer.dataSource.options.download &&\n              layer.dataSource.options.download.url)\n          );\n        }) as AnyLayer[]\n      );\n    });\n    const configFileSizeMb = this.config.getConfig(\n      'importExport.clientSideFileSizeMaxMb'\n    );\n    this.clientSideFileSizeMax =\n      (configFileSizeMb ? configFileSizeMb : 30) * Math.pow(1024, 2);\n    this.fileSizeMb = this.clientSideFileSizeMax / Math.pow(1024, 2);\n\n    this.exportOptions$$ = this.exportOptions$\n      .pipe(skipWhile((exportOptions) => !exportOptions))\n      .subscribe((exportOptions) => {\n        this.form.patchValue(exportOptions, { emitEvent: true });\n        if (exportOptions.layers) {\n          this.computeFormats(\n            exportOptions.layers.map((l) => this.map.getLayerById(l))\n          );\n        }\n      });\n    this.formLayer$$ = this.form\n      .get('format')\n      .valueChanges\n      .subscribe((format) => {\n        const ogreFormats = Object.keys(ExportService.ogreFormats);\n        if (\n          !this.popupChecked &&\n          this.form.get('layers').value?.length > 1 &&\n          (ogreFormats.indexOf(format) >= 0 || format === ExportFormat.URL)) {\n          if (!this.handlePopup(true)) {\n            this.form.patchValue({ format: undefined }, { emitEvent: false });\n          }\n        }\n      });\n\n    this.formLayer$$ = this.form\n      .get('layers')\n      .valueChanges.subscribe((layersId) => {\n        this.handlePreviousLayerSpecs();\n        const selectedLayers = layersId instanceof Array ? layersId : [layersId];\n        this.form.patchValue({ layers: selectedLayers }, { emitEvent: false });\n        const layers = selectedLayers.map((l) => this.map.getLayerById(l));\n        this.computeFormats(layers);\n\n        if (\n          Object.keys(this.formats$.value).indexOf(this.form.value.format) ===\n          -1\n        ) {\n          this.form.patchValue({ format: undefined });\n        }\n\n        this.loading$.next(true);\n        const previousSpecs: {\n          id: string;\n          visible: boolean;\n          opacity: number;\n          queryable: boolean;\n        }[] = [];\n        layers.forEach((layer) => {\n          if (\n            layer instanceof VectorLayer &&\n            layer.dataSource.ol.getFeatures().length === 0\n          ) {\n            previousSpecs.push({\n              id: layer.id,\n              visible: layer.visible,\n              opacity: layer.opacity,\n              queryable: (layer as any).queryable\n            });\n            layer.opacity = 0;\n            layer.visible = true;\n          }\n        });\n\n        this.previousLayerSpecs$.next(previousSpecs);\n        setTimeout(() => {\n          this.loading$.next(false);\n        }, 500);\n      });\n\n    this.formats$$ = this.formats$\n      .pipe(skipWhile((formats) => !formats))\n      .subscribe((formats) => {\n        if (Object.keys(formats).length === 1) {\n          this.form.patchValue({ format: formats[Object.keys(formats)[0]] });\n        }\n      });\n\n    this.encodings$$ = this.encodings$\n      .pipe(skipWhile((encodings) => !encodings))\n      .subscribe((encodings) => {\n        if (Object.keys(encodings).length === 1) {\n          this.form.patchValue({ encoding: encodings[Object.keys(encodings)[0]] });\n        }\n      });\n\n    this.exportableLayers$$ = this.exportableLayers$\n      .pipe(skipWhile((layers) => !layers))\n      .subscribe((layers) => {\n        if (layers.length === 1) {\n          this.form.patchValue({ layers: layers[0].id });\n        }\n      });\n\n    this.form.controls[this.controlFormat].valueChanges.subscribe((format) => {\n      if (format === ExportFormat.CSVcomma || format === ExportFormat.CSVsemicolon) {\n        this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      } else {\n        this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      }\n      this.cdRef.detectChanges();\n    });\n\n    if (this.selectFirstProj) {\n      if (this.projections$.value.length === 0) {\n        this.importForm.patchValue({ inputProj: { translateKey: 'nad83', alias: 'NAD83', code: 'EPSG:4326', zone: '' } });\n      } else {\n        this.importForm.patchValue({ inputProj: this.projections$.value[0] });\n      }\n    } else {\n      this.importForm.patchValue({ inputProj: undefined });\n    }\n  }\n\n  private computeProjections() {\n    this.projectionsConstraints = computeProjectionsConstraints(this.projectionsLimitations);\n    const projections: InputProjections[] = [];\n\n    if (this.projectionsConstraints.nad83) {\n      projections.push({ translateKey: 'nad83', alias: 'NAD83', code: 'EPSG:4269', zone: '' });\n    }\n    if (this.projectionsConstraints.wgs84) {\n      projections.push({ translateKey: 'wgs84', alias: 'WGS84', code: 'EPSG:4326', zone: '' });\n    }\n    if (this.projectionsConstraints.webMercator) {\n      projections.push({ translateKey: 'webMercator', alias: 'Web Mercator', code: 'EPSG:3857', zone: '' });\n    }\n\n    if (this.projectionsConstraints.mtm) {\n      // all mtm zones\n      const minZone = this.projectionsConstraints.mtmZone.minZone;\n      const maxZone = this.projectionsConstraints.mtmZone.maxZone;\n\n      for (let mtmZone = minZone; mtmZone <= maxZone; mtmZone++) {\n        const code = mtmZone < 10 ? `EPSG:3218${mtmZone}` : `EPSG:321${80 + mtmZone}`;\n        projections.push({ translateKey: 'mtm', alias: `MTM ${mtmZone}`, code, zone: `${mtmZone}` });\n      }\n    }\n\n    if (this.projectionsConstraints.utm) {\n      // all utm zones\n      const minZone = this.projectionsConstraints.utmZone.minZone;\n      const maxZone = this.projectionsConstraints.utmZone.maxZone;\n\n      for (let utmZone = minZone; utmZone <= maxZone; utmZone++) {\n        const code = utmZone < 10 ? `EPSG:3260${utmZone}` : `EPSG:326${utmZone}`;\n        projections.push({ translateKey: 'utm', alias: `UTM ${utmZone}`, code, zone: `${utmZone}` });\n      }\n    }\n\n    let configProjection = [];\n    if (this.projectionsConstraints.projFromConfig) {\n      configProjection = this.config.getConfig('projections') || [];\n    }\n\n    this.projections$.next(configProjection.concat(projections));\n  }\n\n  private getWorkspaceByLayerId(id: string): Workspace {\n    const wksFromLayerId = this.store\n      .all()\n      .find(workspace => (workspace as WfsWorkspace | FeatureWorkspace | EditionWorkspace).layer.id === id);\n    if (wksFromLayerId) {\n      return wksFromLayerId;\n    }\n    return;\n  }\n\n  public getLayerTitleById(id): string {\n    return this.map.getLayerById(id)?.title;\n  }\n\n\n  layerHasSelectedFeatures(layer: Layer): boolean {\n    const wksFromLayer = this.getWorkspaceByLayerId(layer.id);\n    if (wksFromLayer) {\n      const recs = wksFromLayer.entityStore.stateView\n        .firstBy((record: EntityRecord<Feature>) => {\n          return record.state.selected === true;\n        });\n      return recs ? true : false;\n    }\n  }\n\n  public onlySelected(event: MatSlideToggleChange, id: string) {\n    let layersWithSelection = this.form.value.layersWithSelection;\n    if (event.checked) {\n      layersWithSelection.push(id);\n    } else {\n      layersWithSelection = layersWithSelection.filter(layerId => layerId !== id);\n    }\n    this.form.patchValue({ layersWithSelection });\n  }\n\n  public onlySelectedClick(event, id: string) {\n    if (this.form.value.layers.find(layerId => layerId === id)) {\n      event.stopPropagation();\n    }\n  }\n\n  public inLayersIdToExportSelectionOnly(layer: Layer): boolean {\n    return this.form.value.layersWithSelection.find(layerId => layerId === layer.id) ? true : false;\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.exportableLayers$$.unsubscribe();\n    this.formats$$.unsubscribe();\n    this.encodings$$.unsubscribe();\n    this.formLayer$$.unsubscribe();\n    if (this.exportOptions$$) {\n      this.exportOptions$$.unsubscribe();\n    }\n    this.exportOptionsChange.emit(this.form.value);\n    this.handlePreviousLayerSpecs();\n  }\n\n  private handlePreviousLayerSpecs() {\n    const previousSpecs = this.previousLayerSpecs$.value;\n    if (previousSpecs && previousSpecs.length) {\n      previousSpecs.forEach((specs) => {\n        const previousLayer = this.map.getLayerById(specs.id);\n        previousLayer.visible = specs.visible;\n        previousLayer.opacity = specs.opacity;\n        (previousLayer as any).queryable = specs.queryable;\n      });\n    }\n    this.previousLayerSpecs$.next(undefined);\n  }\n\n  importFiles(files: File[]) {\n    let inputProj = this.inputProj.code;\n    if (this.espgCodeRegex.test(inputProj)) {\n      inputProj = `EPSG:${inputProj}`;\n    }\n\n    this.loading$.next(true);\n    for (const file of files) {\n      this.importService.import(file, inputProj).subscribe(\n        (features: Feature[]) => this.onFileImportSuccess(file, features),\n        (error: Error) => this.onFileImportError(file, error),\n        () => {\n          this.loading$.next(false);\n        }\n      );\n    }\n  }\n\n  handlePopup(preCheck: boolean = true): boolean {\n    const p1 = window.open('', 'popup', 'width=1, height=1');\n    p1.close();\n    const p2 = window.open('', 'popup', 'width=1, height=1');\n    if (!p2 || p2.closed || typeof p2.closed === 'undefined' || p2 === null) {\n      this.onPopupBlockedError(preCheck);\n      this.popupAllowed = false;\n    } else {\n      p2.close();\n      this.popupAllowed = true;\n      this.popupChecked = true;\n    }\n    return this.popupAllowed;\n  }\n\n  handleExportFormSubmit(data: ExportOptions) {\n    this.loading$.next(true);\n\n    const ogreFormats = Object.keys(ExportService.ogreFormats);\n    if (!this.popupChecked && data.layers.length > 1 &&\n      (ogreFormats.indexOf(data.format) >= 0 || data.format === ExportFormat.URL) && !this.popupAllowed) {\n      this.handlePopup();\n    }\n\n    let geomTypesCSV: { geometryType: string, features: any[] }[] = [];\n    let featuresCSV: any[] = [];\n    let filename: string = \"\";\n\n    for (const [layerIndex, layer] of data.layers.entries()) {\n      const lay = this.map.getLayerById(layer);\n      if (!(data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma)\n      || !data.combineLayers || data.layers.length === 1) {\n        filename = lay.title;\n        if (data.name) {\n          filename = data.name;\n        }\n      } else {\n        filename = this.languageService.translate.instant('igo.geo.export.combinedLayers');\n      }\n      const dSOptions: DataSourceOptions = lay.dataSource.options;\n      if (data.format === ExportFormat.URL && dSOptions.download && (dSOptions.download.url || dSOptions.download.dynamicUrl)) {\n        setTimeout(() => {\n          // better look an feel\n          const url = dSOptions.download.url || dSOptions.download.dynamicUrl;\n          url.match(/service=wfs/gi) ? this.downloadService.open(lay) : window.open(url , '_blank');\n          this.loading$.next(false);\n        }, 500);\n        return;\n      }\n      const wks = this.getWorkspaceByLayerId(layer);\n      let olFeatures;\n      if (wks && wks.entityStore && wks.entityStore.stateView.all().length) {\n\n        if (data.layersWithSelection.indexOf(layer) !== -1 && data.featureInMapExtent) {\n          // Only export selected feature && into map extent\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent && e.state.selected).map(e => (e.entity as Feature).ol);\n        } else if (data.layersWithSelection.indexOf(layer) !== -1 && !data.featureInMapExtent) {\n          // Only export selected feature &&  (into map extent OR not)\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.selected).map(e => (e.entity as Feature).ol);\n        } else if (data.featureInMapExtent) {\n          // Only into map extent\n          olFeatures = wks.entityStore.stateView.all()\n            .filter((e: EntityRecord<object>) => e.state.inMapExtent).map(e => (e.entity as Feature).ol);\n        } else {\n          // All features\n          olFeatures = wks.entityStore.stateView.all().map(e => (e.entity as Feature).ol);\n        }\n      }\n      else {\n        const ol = lay.dataSource.ol as olVectorSource<OlGeometry> | olClusterSource ;\n        if (data.featureInMapExtent) {\n          olFeatures = ol.getFeaturesInExtent(\n            lay.map.viewController.getExtent()\n          );\n        } else {\n          olFeatures = ol.getFeatures();\n        }\n        if (lay.dataSource instanceof ClusterDataSource) {\n          olFeatures = olFeatures.flatMap((cluster: any) =>\n            cluster.get('features')\n          );\n        }\n      }\n\n      const translate = this.languageService.translate;\n      let geomTypes: { geometryType: string, features: any[] }[] = [];\n      if (data.format === ExportFormat.Shapefile || data.format === ExportFormat.GPX) {\n        olFeatures.forEach((olFeature) => {\n          const featureGeomType = olFeature.getGeometry().getType();\n          const currentGeomType = geomTypes.find(geomType => geomType.geometryType === featureGeomType);\n          if (currentGeomType) {\n            currentGeomType.features.push(olFeature);\n          } else {\n            geomTypes.push({ geometryType: featureGeomType, features: [olFeature] });\n          }\n        });\n      } else {\n        geomTypes = [{ geometryType: '', features: olFeatures }];\n      }\n\n      geomTypes.forEach(geomType => {\n        geomType.features.forEach(feature => {\n          const radius: number = feature.get('rad');\n          if (radius) {\n            const center4326: Array<number> = [feature.get('longitude'), feature.get('latitude')];\n            const circle = circular(center4326, radius, 500);\n            circle.transform('EPSG:4326', feature.get('_projection'));\n            feature.setGeometry(circle);\n          }\n        });\n      });\n\n      if (data.format === ExportFormat.GPX) {\n        const gpxFeatureCnt = geomTypes.length;\n        geomTypes = geomTypes.filter(geomType => ['LineString', 'Point'].includes(geomType.geometryType));\n        const gpxFeatureCntPointOrPoly = geomTypes.length;\n        if (gpxFeatureCnt > gpxFeatureCntPointOrPoly) {\n          const title = translate.instant('igo.geo.export.gpx.error.poly.title');\n          const message = translate.instant('igo.geo.export.gpx.error.poly.text');\n          this.messageService.error(message, title, { timeOut: 20000 });\n        }\n      } else if ((data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma) && data.combineLayers) {\n        geomTypes.forEach(geomType => geomTypesCSV.push(geomType));\n\n        if (layerIndex !== data.layers.length - 1) {\n          continue;\n        } else {\n          let previousFeature = undefined;\n          geomTypesCSV.forEach(geomType => {\n            geomType.features.forEach(currentFeature => {\n              if (data.separator) {\n                if (previousFeature) {\n                  if (currentFeature.get('_featureStore').layer.options.title !==\n                  previousFeature.get('_featureStore').layer.options.title) {\n                    const titleEmptyRows = this.createTitleEmptyRows(previousFeature, currentFeature);\n                    featuresCSV.push(titleEmptyRows[2]);\n                    featuresCSV.push(titleEmptyRows[0]);\n                    featuresCSV.push(titleEmptyRows[1]);\n                  }\n                } else {\n                  const titleEmptyRows = this.createTitleEmptyRows(currentFeature, currentFeature);\n                  featuresCSV.push(titleEmptyRows[0]);\n                }\n              }\n              featuresCSV.push(currentFeature);\n              previousFeature = currentFeature;\n            });\n          });\n        }\n      }\n\n      if (geomTypes.length === 0) {\n        this.loading$.next(false);\n        const title = translate.instant('igo.geo.export.nothing.title');\n        const message = translate.instant('igo.geo.export.nothing.text');\n        this.messageService.error(message, title, { timeOut: 20000 });\n\n      } else {\n        if (!(data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma) || !data.combineLayers) {\n          geomTypes.map(geomType =>\n            this.exportService.export(geomType.features, data.format, filename + geomType.geometryType, data.encoding, this.map.projection)\n            .subscribe(\n              () => {},\n              (error: Error) => this.onFileExportError(error),\n              () => {\n                this.onFileExportSuccess();\n\n                geomType.features.forEach(feature => {\n                  this.circleToPoint(feature);\n                });\n\n                this.loading$.next(false);\n            }\n          ));\n        }\n      }\n    };\n    if ((data.format === ExportFormat.CSVsemicolon || data.format === ExportFormat.CSVcomma) && data.combineLayers) {\n      this.exportService.export(featuresCSV, data.format, filename, data.encoding, this.map.projection)\n      .subscribe(\n        () => {},\n        (error: Error) => this.onFileExportError(error),\n        () => {\n          this.onFileExportSuccess();\n\n          featuresCSV.forEach(feature => {\n            this.circleToPoint(feature);\n          });\n\n          this.loading$.next(false);\n        }\n      );\n    }\n  }\n\n  private createTitleEmptyRows(previousFeature, currentFeature) {\n    const titleRow = currentFeature.clone();\n    const headerRow = currentFeature.clone();\n    const emptyRow = currentFeature.clone();\n    const previousFeatureKeys: Array<string> = previousFeature.getKeys();\n    let firstKeyPrevious: string = '';\n    for (const key in previousFeatureKeys) {\n      if (previousFeatureKeys[key] !== 'geometry') {\n        firstKeyPrevious = previousFeatureKeys[key];\n        break;\n      }\n    }\n\n    const currentFeatureKeys: Array<string> = currentFeature.getKeys();\n    let firstKeyCurrent: string = '';\n    for (const key in currentFeatureKeys) {\n      if (currentFeatureKeys[key] !== 'geometry') {\n        firstKeyCurrent = currentFeatureKeys[key];\n        break;\n      }\n    }\n    const allKeys: Array<string> = currentFeature.getKeys();\n    previousFeatureKeys.forEach(previousKey => {\n      if (allKeys.includes(previousKey) && previousKey !== firstKeyPrevious) {\n        allKeys.push(previousKey);\n      }\n    });\n    allKeys.unshift(firstKeyPrevious);\n\n    let firstKeyAll: string = '';\n    for (const key in allKeys) {\n      if (allKeys[key] !== 'geometry') {\n        firstKeyAll = allKeys[key];\n        break;\n      }\n    }\n    allKeys.forEach(key => {\n      const sameKeys: boolean = previousFeatureKeys.length === currentFeatureKeys.length &&\n      previousFeatureKeys.every((value, index) => value === currentFeatureKeys[index]);\n      if (key === firstKeyAll && !sameKeys) {\n        titleRow.set(key, currentFeature.get('_featureStore').layer.options.title + \" ===============>\", true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key === firstKeyAll && sameKeys) {\n        titleRow.set(key, currentFeature.get('_featureStore').layer.options.title, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key === firstKeyCurrent) {\n        titleRow.set(key, currentFeature.get('_featureStore').layer.options.title, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else if (key !== 'geometry') {\n        titleRow.unset(key, true);\n        headerRow.set(key, key, true);\n        emptyRow.unset(key, true);\n      } else {\n        titleRow.unset(key, true);\n        emptyRow.unset(key, true);\n      }\n\n      if (!(currentFeatureKeys.includes(key))) {\n        headerRow.unset(key, true);\n      }\n    });\n    const titleEmptyRows = [titleRow, headerRow, emptyRow];\n    return titleEmptyRows;\n  }\n\n  private circleToPoint(feature) {\n    const radius: number = feature.get('rad');\n\n    if (radius) {\n      const point = new olPoint([feature.get('longitude'), feature.get('latitude')]);\n      point.transform('EPSG:4326', feature.get('_projection'));\n      feature.setGeometry(point);\n    }\n  }\n\n  private buildForm() {\n    this.importForm = this.formBuilder.group({\n      inputProj: ['', [Validators.required]]\n    });\n\n    if (this.forceNaming) {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        combineLayers: [true, [Validators.required]],\n        separator: [false, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]],\n        name: ['', [Validators.required]]\n      });\n    } else {\n      this.form = this.formBuilder.group({\n        format: ['', [Validators.required]],\n        layers: [[], [Validators.required]],\n        layersWithSelection: [[]],\n        encoding: [EncodingFormat.UTF8, [Validators.required]],\n        combineLayers: [true, [Validators.required]],\n        separator: [false, [Validators.required]],\n        featureInMapExtent: [false, [Validators.required]],\n      });\n    }\n  }\n\n  private onFileImportSuccess(file: File, features: Feature[]) {\n    if (!this.config.getConfig('importWithStyle')) {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.messageService,\n        this.languageService\n      );\n    } else {\n      handleFileImportSuccess(\n        file,\n        features,\n        this.map,\n        this.messageService,\n        this.languageService,\n        this.styleListService,\n        this.styleService\n      );\n    }\n  }\n\n  private onFileImportError(file: File, error: Error) {\n    this.loading$.next(false);\n    handleFileImportError(\n      file,\n      error,\n      this.messageService,\n      this.languageService,\n      this.fileSizeMb\n    );\n  }\n\n  private onPopupBlockedError(preCheck: boolean = true) {\n    this.loading$.next(false);\n    const translate = this.languageService.translate;\n    const title = translate.instant('igo.geo.export.popupBlocked.title');\n    const extraMessage = preCheck ?\n      translate.instant('igo.geo.export.popupBlocked.selectAgain') :\n      translate.instant('igo.geo.export.popupBlocked.retry');\n    const message = translate.instant('igo.geo.export.popupBlocked.text', { extraMessage });\n    this.messageService.error(message, title, { timeOut: 20000 });\n  }\n\n  private onFileExportError(error: Error) {\n    this.loading$.next(false);\n    handleFileExportError(error, this.messageService, this.languageService);\n  }\n\n  private loadConfig() {\n    if (this.config.getConfig('importExport.forceNaming') !== undefined) {\n      this.forceNaming = this.config.getConfig('importExport.forceNaming');\n    }\n    this.computeFormats();\n    this.loadEncodings();\n  }\n\n  public encodingDefaultValue(format: ExportFormat) {\n    if (format === ExportFormat.CSVcomma || format === ExportFormat.CSVsemicolon) {\n      this.form.patchValue({ encoding: EncodingFormat.LATIN1 });\n      return EncodingFormat.LATIN1;\n    } else {\n      this.form.patchValue({ encoding: EncodingFormat.UTF8 });\n      return EncodingFormat.UTF8;\n    }\n  }\n\n  private loadEncodings() {\n    this.encodings$.next(EncodingFormat);\n  }\n\n  private computeFormats(layers?: AnyLayer[]) {\n    let appliedformats: string[] = Object.keys(ExportFormat);\n    const formatsType = {\n      onlyUrl: false,\n      onlyVector: false,\n      vectorAndUrl: false,\n      customList: false\n    };\n    const customList = [];\n    if (layers && layers.length) {\n      layers.forEach((layer) => {\n        if (!layer) {\n          return;\n        }\n        if (layer.dataSource.options.download?.allowedFormats) {\n          formatsType.customList = true;\n          customList.push({layer: layer.title, formats: this.validateListFormat(layer.dataSource.options.download.allowedFormats)});\n        } else if (\n          !(layer instanceof VectorLayer) &&\n          layer.dataSource.options.download &&\n          layer.dataSource.options.download.url\n        ) {\n          formatsType.onlyUrl = true;\n        } else if (\n          layer.dataSource.options.download &&\n          (layer.dataSource.options.download.url || layer.dataSource.options.download.dynamicUrl)\n        ) {\n          formatsType.vectorAndUrl = true;\n        } else if (layer instanceof VectorLayer) {\n          formatsType.onlyVector = true;\n        }\n      });\n\n      if (formatsType.onlyUrl === true && formatsType.onlyVector === false) {\n        appliedformats = ['URL'];\n      } else if (\n        formatsType.onlyVector === true &&\n        formatsType.onlyUrl === false\n      ) {\n        this.computeFormats(); // reset\n        if (ExportFormat.URL in this.formats$.value) {\n          const keys = Object.keys(this.formats$.value).filter(\n            (key) => key !== 'URL'\n          );\n          appliedformats = keys;\n        }\n      } else if (\n        formatsType.vectorAndUrl === true &&\n        formatsType.onlyUrl === false &&\n        formatsType.onlyVector === false\n      ) {\n        this.computeFormats(); // reset\n        if (!(ExportFormat.URL in this.formats$.value)) {\n          const keys = Object.keys(this.formats$.value);\n          keys.push('URL');\n          appliedformats = keys;\n        }\n      }\n    }\n    if (this.config.getConfig('importExport.formats') !== undefined) {\n      const validatedListFormat = this.validateListFormat(\n        this.config.getConfig('importExport.formats')\n      );\n      appliedformats = validatedListFormat;\n    }\n    if (formatsType.customList) {\n      let commonFormats;\n      const layersWithCustomFormats = [];\n      let previousCustomListFormats = customList[0].formats;\n      customList.map(list => {\n        layersWithCustomFormats.push(list.layer);\n        commonFormats = list.formats.filter(value => previousCustomListFormats.includes(value));\n        previousCustomListFormats = list.formats;\n      });\n      const finalFormats = commonFormats.filter(value => appliedformats.includes(value));\n      if (finalFormats.length > 0) {\n        this.formats$.next(strEnum(finalFormats));\n\n        if (layers && layers.length) {\n          if (layers.length > 1) {\n            this.messageService.alert(\n              this.languageService.translate.instant('igo.geo.export.customList.text', { value: layersWithCustomFormats.join() }),\n              this.languageService.translate.instant('igo.geo.export.customList.title')\n            );\n          }\n        }\n      } else {\n        this.formats$.next([]);\n        this.messageService.alert(\n          this.languageService.translate.instant('igo.geo.export.noFormat.text'),\n          this.languageService.translate.instant('igo.geo.export.noFormat.title')\n        );\n      }\n      return;\n    } else {\n      this.formats$.next(strEnum(appliedformats));\n    }\n  }\n\n  private validateListFormat(formats: string[]): string[] {\n    return formats\n      .filter((format) => {\n        if (\n          format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GPX.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.KML.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.Shapefile.toUpperCase() ||\n          format.toUpperCase() === ExportFormat.URL.toUpperCase()\n        ) {\n          return format;\n        }\n      })\n      .map((format) => {\n        if (format.toUpperCase() === ExportFormat.CSVcomma.toUpperCase()) {\n          format = ExportFormat.CSVcomma;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.CSVsemicolon.toUpperCase()) {\n          format = ExportFormat.CSVsemicolon;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GML.toUpperCase()) {\n          format = ExportFormat.GML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GPX.toUpperCase()) {\n          format = ExportFormat.GPX;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.GeoJSON.toUpperCase()) {\n          format = ExportFormat.GeoJSON;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.KML.toUpperCase()) {\n          format = ExportFormat.KML;\n          return format;\n        }\n        if (format.toUpperCase() === ExportFormat.Shapefile.toUpperCase()) {\n          format = ExportFormat.Shapefile;\n          return format;\n        }\n\n        if (format.toUpperCase() === ExportFormat.URL.toUpperCase()) {\n          format = ExportFormat.URL;\n          return format;\n        }\n      });\n  }\n\n  public modeChanged(mode) {\n    this.selectMode.emit(mode);\n  }\n\n  private onFileExportSuccess() {\n    handleFileExportSuccess(this.messageService, this.languageService);\n  }\n\n  onImportExportChange(event) {\n    this.selectedMode = event.value;\n  }\n}\n","import { ProjectionsLimitationsOptions } from './projection.interfaces';\n\n/**\n * Return a number of zone MTM for a longitude for province of Quebec only\n * @param lon number\n * @returns zone\n */\nexport function zoneMtm(lon: number): number {\n    let lonMin = -54;\n    const lonMax = -81;\n    if (lon < lonMax || lon > lonMin) {\n      return 0;\n    }\n    else {\n      const deltaLon = 3;\n      let zone = 2;\n      while (Math.abs(lon - lonMin) > deltaLon) {\n        lonMin = lonMin - deltaLon;\n        zone++;\n      }\n      return zone;\n    }\n  }\n/**\n * Return a number of zone UTM for a longitude\n * @param lon number\n * @returns zone\n */\nexport function zoneUtm(lon: number): number {\n  let lonMin = -180;\n  const lonMax = 180;\n  const deltaLon = 6;\n  let zone = 1;\n  while (Math.abs(lon - lonMin) > deltaLon) {\n    lonMin = lonMin + deltaLon;\n    zone++;\n  }\n  return zone;\n}\n\n/**\n * Compute the contraints of projections\n * @param projectionsLimitations: ProjectionsLimitationsOptions\n * @returns projectionsContraints: ProjectionsLimitationsOptions\n */\nexport function computeProjectionsConstraints(\n    projectionsLimitations: ProjectionsLimitationsOptions):\n    ProjectionsLimitationsOptions {\n    const mtmZone = projectionsLimitations.mtmZone;\n    const utmZone = projectionsLimitations.utmZone;\n    const projectionsConstraints = {\n        projFromConfig: projectionsLimitations.projFromConfig === false ? false : true,\n        nad83: projectionsLimitations.nad83 === false ? false : true,\n        wgs84: projectionsLimitations.wgs84 === false ? false : true,\n        webMercator: projectionsLimitations.webMercator === false ? false : true,\n        utm: projectionsLimitations.utm === false ? false : true,\n        mtm: projectionsLimitations.mtm === false ? false : true,\n        utmZone: {\n        minZone: utmZone && utmZone.minZone ? utmZone.minZone : 17,\n        maxZone: utmZone && utmZone.maxZone ? utmZone.maxZone : 21,\n        },\n        mtmZone: {\n        minZone: mtmZone && mtmZone.minZone ? mtmZone.minZone : 2,\n        maxZone: mtmZone && mtmZone.maxZone ? mtmZone.maxZone : 10,\n        }\n    };\n    return projectionsConstraints;\n  }\n","import {\n  getEntityProperty,\n  EntityTableColumn,\n  EntityTableColumnRenderer\n} from '@igo2/common';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { downloadContent } from '@igo2/utils';\n\nimport { ExportNothingToExportError } from './export.errors';\n\nexport function handleFileExportError(\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  if (error instanceof ExportNothingToExportError) {\n    handleNothingToExportError(messageService, languageService);\n    return;\n  }\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.export.failed.title');\n  const message = translate.instant('igo.geo.export.failed.text');\n  messageService.error(message, title);\n}\n\nexport function handleFileExportSuccess(\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.export.success.title');\n  const message = translate.instant('igo.geo.export.success.text');\n  messageService.success(message, title);\n}\n\nexport function handleNothingToExportError(\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant('igo.geo.export.nothing.title');\n  const message = translate.instant('igo.geo.export.nothing.text');\n  messageService.error(message, title);\n}\n\n/**\n * Export array to CSV\n *\n * @param rows Array of arrays to export as CSV\n * @param separator Cell separator\n */\nexport function exportToCSV(rows: any[][], fileName: string, separator: string = ';') {\n  const lines = rows.map((row: any[][], index: number) => row.join(separator));\n  const csvContent = lines.join('\\n');\n  downloadContent(csvContent, 'text/csv;charset=utf-8', fileName);\n}\n\n/**\n * Return an array of values from an array of entities.\n *\n * @param entities Array of entities\n * @param scolumns Columns definition of the output data\n */\nexport function entitiesToRowData(entities: object[], columns: EntityTableColumn[]) {\n  return entities.map((entity: object) => {\n    return columns.map((column: EntityTableColumn) => {\n      let valueAccessor;\n      if (column.renderer === undefined || column.renderer === EntityTableColumnRenderer.Default) {\n        valueAccessor = column.valueAccessor;\n      }\n      valueAccessor = valueAccessor ? valueAccessor : getEntityProperty;\n      return valueAccessor(entity, column.name);\n    });\n  });\n}\n","import { APP_INITIALIZER, InjectionToken } from '@angular/core';\n\nimport { StyleListService } from './style-list.service';\nimport { StyleListOptions } from './style-list.interface';\n\nexport let STYLELIST_OPTIONS = new InjectionToken<StyleListOptions>('styleListOptions');\n\nexport function provideStyleListOptions(options: StyleListOptions) {\n  return {\n    provide: STYLELIST_OPTIONS,\n    useValue: options\n  };\n}\n\nexport function styleListFactory(\n  styleListService: StyleListService,\n  options: StyleListOptions\n) {\n  return () => styleListService.load(options);\n}\n\nexport function provideStyleListLoader() {\n  return {\n    provide: APP_INITIALIZER,\n    useFactory: styleListFactory,\n    multi: true,\n    deps: [StyleListService, STYLELIST_OPTIONS]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { provideStyleListOptions, provideStyleListLoader } from './style-list.provider';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: []\n})\nexport class IgoStyleListModule {\n  static forRoot(): ModuleWithProviders<IgoStyleListModule> {\n    return {\n      ngModule: IgoStyleListModule,\n      providers: [provideStyleListOptions({}), provideStyleListLoader()]\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule, IgoDrapDropModule, IgoSpinnerModule, IgoCustomHtmlModule } from '@igo2/common';\n\nimport { ExportButtonComponent } from './export-button/export-button.component';\nimport { ImportExportComponent } from './import-export/import-export.component';\nimport { DropGeoFileDirective } from './shared/drop-geo-file.directive';\nimport { IgoStyleListModule } from './style-list/style-list.module';\n\n@NgModule({\n  imports: [\n    MatIconModule,\n    MatTooltipModule,\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatTabsModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSlideToggleModule,\n    IgoLanguageModule,\n    IgoSpinnerModule,\n    IgoKeyValueModule,\n    IgoDrapDropModule,\n    IgoCustomHtmlModule,\n    IgoStyleListModule.forRoot()\n  ],\n  exports: [ImportExportComponent, DropGeoFileDirective, IgoStyleListModule, ExportButtonComponent],\n  declarations: [ImportExportComponent, DropGeoFileDirective, ExportButtonComponent]\n})\nexport class IgoImportExportModule {\n  static forRoot(): ModuleWithProviders<IgoImportExportModule> {\n    return {\n      ngModule: IgoImportExportModule\n    };\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoConfirmDialogModule } from '@igo2/common';\nimport { MapBrowserComponent } from './map-browser/map-browser.component';\nimport { ZoomButtonComponent } from './zoom-button/zoom-button.component';\nimport { GeolocateButtonComponent } from './geolocate-button/geolocate-button.component';\nimport { HomeExtentButtonComponent } from './home-extent-button/home-extent-button.component';\nimport { RotationButtonComponent } from './rotation-button/rotation-button.component';\nimport { BaseLayersSwitcherComponent } from './baselayers-switcher/baselayers-switcher.component';\nimport { MiniBaseMapComponent } from './baselayers-switcher/mini-basemap.component';\nimport { MapOfflineDirective } from './shared/mapOffline.directive';\nimport { OfflineButtonComponent } from './offline-button/offline-button.component';\nimport { WakeLockButtonComponent } from './wake-lock-button/wake-lock-button.component';\nimport { PointerPositionDirective } from './shared/map-pointer-position.directive';\nimport { HoverFeatureDirective } from './shared/hover-feature.directive';\nimport { SwipeControlComponent } from './swipe-control/swipe-control.component';\nimport { MapCenterComponent } from './map-center/map-center.component';\nimport { MenuButtonComponent } from './menu-button/menu-button.component';\nimport { InfoSectionComponent } from './info-section/info-section.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoConfirmDialogModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule\n  ],\n  exports: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    GeolocateButtonComponent,\n    HomeExtentButtonComponent,\n    RotationButtonComponent,\n    InfoSectionComponent,\n    BaseLayersSwitcherComponent,\n    MiniBaseMapComponent,\n    MapOfflineDirective,\n    OfflineButtonComponent,\n    WakeLockButtonComponent,\n    PointerPositionDirective,\n    HoverFeatureDirective,\n    SwipeControlComponent,\n    MapCenterComponent,\n    MenuButtonComponent\n  ],\n  declarations: [\n    MapBrowserComponent,\n    ZoomButtonComponent,\n    GeolocateButtonComponent,\n    HomeExtentButtonComponent,\n    RotationButtonComponent,\n    InfoSectionComponent,\n    BaseLayersSwitcherComponent,\n    MiniBaseMapComponent,\n    MapOfflineDirective,\n    OfflineButtonComponent,\n    WakeLockButtonComponent,\n    PointerPositionDirective,\n    HoverFeatureDirective,\n    SwipeControlComponent,\n    MapCenterComponent,\n    MenuButtonComponent\n  ]\n})\nexport class IgoMapModule {}\n","<mat-form-field\n  class=\"measure-field\"\n  appearance=\"outline\"\n  floatLabel=\"always\">\n  <mat-label>{{placeholder}}</mat-label>\n  <input\n    matInput\n    [readonly]=\"true\"\n    [value]=\"((measure$ | async) || 0) | measureFormat: measureUnit\">\n</mat-form-field>\n<mat-form-field class=\"unit-field\">\n  <mat-select\n    [value]=\"measureUnit\"\n    [disabled]=\"auto\"\n    (selectionChange)=\"onMeasureUnitChange($event.value)\">\n    <mat-option *ngFor=\"let measureUnit of measureUnits\" [value]=\"measureUnit\">\n      {{('igo.geo.measure.' + measureUnit) | translate}}\n    </mat-option>\n  </mat-select>\n</mat-form-field>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  OnDestroy,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport {\n  MeasureType,\n  MeasureAreaUnit,\n  MeasureLengthUnit\n} from '../shared/measure.enum';\nimport { computeBestAreaUnit, computeBestLengthUnit } from '../shared/measure.utils';\n\n/**\n * Measurer item\n */\n@Component({\n  selector: 'igo-measurer-item',\n  templateUrl: './measurer-item.component.html',\n  styleUrls: ['./measurer-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MeasurerItemComponent implements OnDestroy {\n\n  /**\n   * Measure observable\n   * @internal\n   */\n  public measure$: BehaviorSubject<number> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the measure observable when the auto mode is on\n   * @internal\n   */\n  public measure$$: Subscription;\n\n  /**\n   * Measure type\n   */\n  @Input() measureType: MeasureType;\n\n  /**\n   * Measure unit\n   */\n  @Input() measureUnit: MeasureAreaUnit | MeasureLengthUnit;\n\n  /**\n   * Measure\n   */\n  @Input()\n  set measure(value: number) {\n    this.measure$.next(value);\n  }\n  get measure(): number { return this.measure$.value; }\n\n  /**\n   * Whther measure units should be automatically determined\n   */\n  @Input()\n  set auto(value: boolean) { this.toggleAutoUnit(value); }\n  get auto(): boolean { return this._auto; }\n  private _auto: boolean = false;\n\n  /**\n   * Placeholder\n   */\n  @Input() placeholder: string;\n\n  /**\n   * Event emitted when the measure unit changes\n   */\n  @Output() measureUnitChange = new EventEmitter<MeasureAreaUnit | MeasureLengthUnit>();\n\n  /**\n   * Available measure units for the measure type given\n   * @internal\n   */\n  get measureUnits(): string[] {\n    if (this.measureType === MeasureType.Area) {\n      return Object.values(MeasureAreaUnit);\n    }\n    return Object.values(MeasureLengthUnit);\n  }\n\n  constructor() {}\n\n  /**\n   * Toggle the auto unit off\n   * @internal\n   */\n  ngOnDestroy() {\n    this.toggleAutoUnit(false);\n  }\n\n  /**\n   * Set the measure unit\n   * @internal\n   */\n  onMeasureUnitChange(unit: MeasureAreaUnit | MeasureLengthUnit) {\n    this.measureUnit = unit;\n    this.measureUnitChange.emit(unit);\n  }\n\n  private toggleAutoUnit(toggle: boolean) {\n    if (this.measure$$ !== undefined) {\n      this.measure$$.unsubscribe();\n    }\n    if (toggle === true) {\n      this.measure$$ = this.measure$.subscribe((measure: number) => {\n        this.computeBestMeasureUnit(measure);\n      });\n    }\n    this._auto = toggle;\n  }\n\n  private computeBestMeasureUnit(measure: number) {\n    let measureUnit = this.measureUnit;\n    if (this.measureType === MeasureType.Area) {\n      measureUnit = computeBestAreaUnit(measure);\n    } else if (this.measureType === MeasureType.Length) {\n      measureUnit = computeBestLengthUnit(measure);\n    }\n    if (measureUnit !== this.measureUnit) {\n      this.onMeasureUnitChange(measureUnit);\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatDividerModule } from '@angular/material/divider';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoEntityTableModule } from '@igo2/common';\n\nimport { MeasureFormatPipe } from './measure-format.pipe';\nimport { MeasurerItemComponent } from './measurer-item.component';\nimport { MeasurerComponent } from './measurer.component';\nimport { MeasurerDialogComponent } from './measurer-dialog.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatIconModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatSelectModule,\n    MatSlideToggleModule,\n    MatDividerModule,\n    IgoLanguageModule,\n    IgoEntityTableModule\n  ],\n  declarations: [\n    MeasureFormatPipe,\n    MeasurerItemComponent,\n    MeasurerComponent,\n    MeasurerDialogComponent\n  ],\n  exports: [\n    MeasureFormatPipe,\n    MeasurerComponent\n  ]\n})\nexport class IgoMeasurerModule {}\n","import { NgModule } from '@angular/core';\n\nimport { IgoMeasurerModule } from './measurer/measurer.module';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [\n    IgoMeasurerModule\n  ]\n})\nexport class IgoMeasureModule {}\n","export enum OverlayAction {\n    None,\n    Move,\n    Zoom,\n    ZoomIfOutMapExtent\n  }\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport { OverlayAction } from './overlay.enum';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class OverlayService {\n  public features$ = new BehaviorSubject<[Feature[], OverlayAction]>([\n    [],\n    undefined\n  ]);\n\n  constructor() {}\n\n  setFeatures(features: Feature[], action: OverlayAction = OverlayAction.None) {\n    this.features$.next([features, action]);\n  }\n\n  clear() {\n    this.features$.next([[], OverlayAction.None]);\n  }\n}\n","import { Directive, Self, OnInit, OnDestroy } from '@angular/core';\nimport { Subscription } from 'rxjs';\n\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\n\nimport { OverlayService } from '../shared/overlay.service';\nimport { OverlayAction } from '../shared/overlay.enum';\n\n@Directive({\n  selector: '[igoOverlay]'\n})\nexport class OverlayDirective implements OnInit, OnDestroy {\n  private features$$: Subscription;\n  private format = new olFormatGeoJSON();\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private overlayService: OverlayService\n  ) {}\n\n  ngOnInit() {\n    this.features$$ = this.overlayService.features$.subscribe(res =>\n      this.handleFeatures(res[0], res[1])\n    );\n  }\n\n  ngOnDestroy() {\n    this.features$$.unsubscribe();\n  }\n\n  private handleFeatures(features: Feature[], action: OverlayAction) {}\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\n\nimport { OverlayDirective } from './shared/overlay.directive';\n\n@NgModule({\n  imports: [],\n  exports: [OverlayDirective],\n  declarations: [OverlayDirective]\n})\nexport class IgoOverlayModule {\n  static forRoot(): ModuleWithProviders<IgoOverlayModule> {\n    return {\n      ngModule: IgoOverlayModule\n    };\n  }\n}\n","/*\n * The MIT License (MIT)\n *\n * Copyright (c) 2016-2017 Dan \"Ducky\" Little\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport default function jsGeoPdfPlugin(jsPDFAPI) {\n\n    const setGeoArea = function(pdfExt, geoExt) {\n        const bbox = pdfExt.join(' ');\n        // the ordering may seem odd here but PDF\n        //  flips the Y axis upside down and this accounts for that\n        //  change.\n        const minx = geoExt[0];\n        const maxx = geoExt[2];\n        const maxy = geoExt[1];\n        const miny = geoExt[3];\n        const bounds = [miny, minx, maxy, minx, maxy, maxx, miny, maxx].join(' ');\n        const bbox_obj = this.internal.newAdditionalObject();\n        const bounds_obj = this.internal.newAdditionalObject();\n        const proj_obj = this.internal.newAdditionalObject();\n\n        proj_obj.content = '<< /EPSG 3857 /Type /PROJCS /WKT (PROJCS[\"WGS_1984_Web_Mercator_Auxiliary_Sphere\"'+\n        ',GEOGCS[\"GCS_WGS_1984\",DATUM[\"D_WGS_1984\",SPHEROID[\"WGS_1984\",6378137.0,298.257223563]],PRIMEM[\"Greenwich\",0.0]'+\n        ',UNIT[\"Degree\",0.017453292519943295]],PROJECTION[\"Mercator_Auxiliary_Sphere\"],PARAMETER[\"False_Easting\",0.0]'+\n        ',PARAMETER[\"False_Northing\",0.0],PARAMETER[\"Central_Meridian\",0.0],PARAMETER[\"Standard_Parallel_1\",0.0]'+\n        ',PARAMETER[\"Auxiliary_Sphere_Type\",0.0],UNIT[\"Meter\",1.0]]) >>';\n\n        bounds_obj.content = '<< /Bounds [ 0 1 0 0 1 0 1 1 ] /GCS ' +\n        proj_obj.objId + ' 0 R /GPTS [ ' + bounds + ' ] /LPTS [ 0 1 0 0 1 0 1 1 ] /Subtype /GEO /Type /Measure >>';\n\n        bbox_obj.content = '<< /BBox [ ' + bbox + ' ] /Measure ' + bounds_obj.objId + ' 0 R /Name (Layer) /Type /Viewport >>';\n\n        const title_obj = this.internal.newAdditionalObject();\n        const date = new Date().toLocaleDateString('en-CA');\n        title_obj.content = '<< /Name IGO2 /Type /OCG /Date '+ date +' >>';\n\n        return bbox_obj.objId;\n    };\n\n    jsPDFAPI.setGeoArea = function(pdfExt, geoExt) {\n        this.internal.events.subscribe('putPage', function() {\n            const bbox_id = setGeoArea.call(this, pdfExt, geoExt);\n            this.internal.write('/VP [ ' + bbox_id + ' 0 R ]');\n        });\n    };\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { Observable, Subject, forkJoin } from 'rxjs';\nimport { map as rxMap } from 'rxjs/operators';\n\nimport { saveAs } from 'file-saver';\nimport jsPDF from 'jspdf';\nimport html2canvas from 'html2canvas';\nimport { default as JSZip } from 'jszip';\n\nimport { SubjectStatus } from '@igo2/utils';\nimport { SecureImagePipe } from '@igo2/common';\nimport { MessageService, ActivityService, LanguageService, ConfigService } from '@igo2/core';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { formatScale } from '../../map/shared/map.utils';\nimport { LegendMapViewOptions } from '../../layer/shared/layers/layer.interface';\nimport { getLayersLegends } from '../../layer/utils/outputLegend';\n\nimport { PrintOptions, TextPdfSizeAndMargin } from './print.interface';\nimport GeoPdfPlugin from './geopdf';\n\ndeclare global {\n  interface Navigator {\n    msSaveBlob?: (blob: any, defaultName?: string) => boolean\n  }\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class PrintService {\n  zipFile: JSZip;\n  nbFileToProcess: number;\n  activityId: string;\n  imgSizeAdded: Array<number>;\n\n  TEXTPDFFONT = {\n    titleFont: 'Times',\n    titleFontStyle: 'bold',\n    subtitleFont: 'Times',\n    subtitleFontStyle: 'bold',\n    commentFont: 'courier',\n    commentFontStyle: 'normal',\n    commentFontSize: 16\n  };\n\n  constructor(\n    private http: HttpClient,\n    private messageService: MessageService,\n    private activityService: ActivityService,\n    private languageService: LanguageService,\n    private configService: ConfigService\n  ) {}\n\n  print(map: IgoMap, options: PrintOptions): Subject<any> {\n    const status$ = new Subject();\n    const paperFormat: string = options.paperFormat;\n    const resolution = +options.resolution; // Default is 96\n    const orientation = options.orientation;\n    const legendPostion = options.legendPosition;\n    this.activityId = this.activityService.register();\n\n    GeoPdfPlugin(jsPDF.API);\n\n    const doc = new jsPDF({\n      orientation,\n      format: paperFormat.toLowerCase(),\n      unit: 'mm' // default\n    });\n\n    const dimensions = [\n      doc.internal.pageSize.width,\n      doc.internal.pageSize.height\n    ];\n\n    const margins = [10, 10, 10, 10];\n    const width = dimensions[0] - margins[3] - margins[1];\n    const height = dimensions[1] - margins[0] - margins[2];\n    const size = [width, height];\n    let titleSizes: TextPdfSizeAndMargin;\n    let subtitleSizes: TextPdfSizeAndMargin;\n\n    // PDF title\n    if (options.title !== undefined ) {\n      const fontSizeInPt = Math.round(2 * (height + 145) * 0.05) / 2; //calculate the fontSize title from the page height.\n      titleSizes = this.getTextPdfObjectSizeAndMarg(options.title,\n        margins,\n        this.TEXTPDFFONT.titleFont,\n        fontSizeInPt,\n        this.TEXTPDFFONT.titleFontStyle,\n        doc);\n\n      this.addTextInPdfDoc(doc,\n        options.title,\n        this.TEXTPDFFONT.titleFont,\n        this.TEXTPDFFONT.titleFontStyle,\n        titleSizes.fontSize,\n        titleSizes.marginLeft + margins[3],\n        margins[0]);\n\n      margins[0] = titleSizes.height + margins[0]; // cumulative margin top for next elem to place in pdf doc\n\n    }\n\n    // PDF subtitle\n    if (options.subtitle !== undefined) {\n      subtitleSizes = this.getTextPdfObjectSizeAndMarg(options.subtitle,\n        margins,\n        this.TEXTPDFFONT.subtitleFont,\n        titleSizes.fontSize * 0.7, // 70% size of title\n        this.TEXTPDFFONT.subtitleFontStyle,\n        doc);\n\n       this.addTextInPdfDoc(doc,\n        options.subtitle,\n        this.TEXTPDFFONT.subtitleFont,\n        this.TEXTPDFFONT.subtitleFontStyle,\n        subtitleSizes.fontSize,\n        subtitleSizes.marginLeft + margins[3],\n        margins[0]\n      );\n\n      margins[0] += 5; // cumulative marg top for next elem to place in pdf doc. 5 is a fix it could be adjust\n    }\n\n    if (options.showProjection === true || options.showScale === true) {\n      this.addProjScale(\n        doc,\n        map,\n        resolution,\n        options.showProjection,\n        options.showScale\n        );\n    }\n    if (options.comment !== '') {\n      this.addComment(doc, options.comment);\n    }\n\n    this.addMap(doc, map, resolution, size, margins).subscribe(\n      async (status: SubjectStatus) => {\n        if (status === SubjectStatus.Done) {\n          await this.addScale(doc, map, margins);\n          await this.handleMeasureLayer(doc, map, margins);\n\n          const width = this.imgSizeAdded[0];\n          const height = this.imgSizeAdded[1];\n          const res = 1;\n          this.addGeoRef(doc, map, width, height, res, margins);\n\n          if (options.legendPosition !== 'none') {\n            if (['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(options.legendPosition) > -1 ) {\n              await this.addLegendSamePage(doc, map, margins, resolution, options.legendPosition);\n            } else if (options.legendPosition === 'newpage') {\n              await this.addLegend(doc, map, margins, resolution);\n            }\n          } else {\n            await this.saveDoc(doc);\n          }\n        }\n\n        if (status === SubjectStatus.Done || status === SubjectStatus.Error) {\n          this.activityService.unregister(this.activityId);\n          status$.next(SubjectStatus.Done);\n        }\n      }\n    );\n\n    return status$;\n  }\n  // ref GeoMoose https://github.com/geomoose/gm3/tree/main/src/gm3/components/print\n  addGeoRef(doc, map, width, height, resolution, margins) {\n    const unit = 'mm';\n    const docHeight = doc.internal.pageSize.getHeight();\n\n    // x,y = margin left-bottom corner for img in pdf doc\n    const x = margins[3];\n    const y = docHeight - margins[0] - height;\n\n    let pdf_extents = [x, y, x + width, y + height];\n    for(let i = 0; i < pdf_extents.length; i++) {\n      pdf_extents[i] = this.pdf_units2points(pdf_extents[i], unit);\n    }\n\n    const mapExtent = map.viewController.getExtent('EPSG:3857');\n    doc.setGeoArea(pdf_extents, mapExtent);\n\n  }\n\n  /**\n   * Add measure overlay on the map on the document when the measure layer is present\n   * @param  doc - Pdf document where measure tooltip will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async handleMeasureLayer(\n    doc: jsPDF,\n    map: IgoMap,\n    margins: Array<number>\n  ) {\n    if (map.layers.find(layer => layer.visible && layer.id.startsWith('igo-measures-'))) {\n      let canvasOverlayHTMLMeasures;\n      const mapOverlayMeasuresHTML = map.ol.getOverlayContainer();\n      await html2canvas(mapOverlayMeasuresHTML, {\n        scale: 1,\n        backgroundColor: null\n      }).then(e => {\n        canvasOverlayHTMLMeasures = e;\n      });\n      this.addCanvas(doc, canvasOverlayHTMLMeasures, margins); // this adds measure overlays\n    }\n  }\n\n  /**\n   * Get html code for all layers legend\n   * @param  map IgoMap\n   * @param  width The width that the legend need to be\n   * @return Html code for the legend\n   */\n  getLayersLegendHtml(\n    map: IgoMap,\n    width: number,\n    resolution: number\n  ): Observable<string> {\n    return new Observable((observer) => {\n      let html = '';\n      const legends = getLayersLegends(\n        map.layers,\n        {\n          resolution: map.viewController.getResolution(),\n          extent: map.viewController.getExtent(),\n          projection: map.viewController.getOlProjection().getCode(),\n          // scale: map.viewController.getScale(resolution),\n          size: map.ol.getSize()\n        } as LegendMapViewOptions\n      );\n      if (legends.filter(l => l.display === true).length === 0) {\n        observer.next(html);\n        observer.complete();\n        return;\n      }\n      // Define important style to be sure that all container is convert\n      // to image not just visible part\n      html += '<style media=\"screen\" type=\"text/css\">';\n      html += '.html2canvas-container { width: ' + width + 'mm !important; height: 2000px !important; }';\n      html += 'table.tableLegend {table-layout: auto;}';\n      html += 'div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}';\n      html += '</style>';\n      // The font size will also be lowered afterwards (globally along the legend size)\n      // this allows having a good relative font size here and to keep ajusting the legend size\n      // while keeping good relative font size\n      html += '<font size=\"3\" face=\"Times\" >';\n      html += '<div class=\"styleLegend\">';\n      html += '<table class=\"tableLegend\" >';\n\n      // For each legend, define an html table cell\n      const images$ = legends.filter(l => l.display).map((legend) =>\n        this.getDataImage(legend.url).pipe(\n          rxMap((dataImage) => {\n            let htmlImg = '<tr><td>' + legend.title.toUpperCase() + '</td></tr>';\n            htmlImg += '<tr><td><img src=\"' + dataImage + '\"></td></tr>';\n            return htmlImg;\n          })\n        )\n      );\n      forkJoin(images$).subscribe((dataImages) => {\n        html = dataImages.reduce((acc, current) => (acc += current), html);\n        html += '</table>';\n        html += '</div>';\n        observer.next(html);\n        observer.complete();\n      });\n    });\n  }\n\n  getDataImage(url: string): Observable<string> {\n    const secureIMG = new SecureImagePipe(this.http, this.configService);\n    return secureIMG.transform(url);\n  }\n\n  /**\n   * Get all the legend in a single image\n   * * @param  format - Image format. default value to \"png\"\n   * @return The image of the legend\n   */\n  async getLayersLegendImage(\n    map,\n    format: string = 'png',\n    doZipFile: boolean,\n    resolution: number\n  ) {\n    const status$ = new Subject();\n    // Get html code for the legend\n    const width = 200; // milimeters unit, originally define for document pdf\n    let html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    format = format.toLowerCase();\n\n    // If no legend show No LEGEND in an image\n    if (html.length === 0) {\n      html = '<font size=\"12\" face=\"Courier New\" >';\n      html += '<div align=\"center\"><b>NO LEGEND</b></div>';\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n\n    if (canvas) {\n      let status = SubjectStatus.Done;\n      try {\n        if (!doZipFile) {\n          // Save the canvas as file\n          this.saveCanvasImageAsFile(canvas, 'legendImage', format);\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(canvas, 'legendImage' + '.' + format);\n        }\n        div.parentNode.removeChild(div); // remove temp div (IE)\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n      status$.next(status);\n    }\n\n    return status$;\n  }\n\n\n  getTextPdfObjectSizeAndMarg(text: string, margins, font:string, fontSizeInPt: number, fontStyle:string, doc: jsPDF)\n  : TextPdfSizeAndMargin {\n    const pdfResolution = 96;\n    const docWidth = doc.internal.pageSize.getWidth();\n    const pageWidth = docWidth - margins[1] - margins[3];\n\n    // important to set it first, the textDimension change when font change!\n    doc.setFont(font, fontStyle);\n    doc.setFontSize(fontSizeInPt);\n\n    let textDimensions = doc.getTextDimensions(text);\n    let textMarginLeft: number;\n\n    if (textDimensions.w > pageWidth) {\n      // if the text is to long, reduce fontSize 70% and the overflow with be cut in print...\n      textMarginLeft = 0;\n      fontSizeInPt = fontSizeInPt * 0.7;\n      doc.setFontSize(fontSizeInPt);\n      textDimensions = doc.getTextDimensions(text);\n\n    } else {\n      textMarginLeft = (pageWidth - textDimensions.w ) / 2 ;\n    }\n\n    return {\n      'fontSize': fontSizeInPt,\n      'marginLeft': textMarginLeft,\n      'height': textDimensions.h\n    };\n  }\n\n  /**\n   * Add comment to the document\n   * * @param  doc - pdf document\n   * * @param  comment - Comment to add in the document\n   */\n  private addComment(doc: jsPDF, comment: string) {\n    const commentMarginLeft = 20; //margin left and bottom is fix\n    const commentMarginBottom = 5;\n    const marginTop = doc.internal.pageSize.height - commentMarginBottom;\n    this. addTextInPdfDoc(doc,comment,\n      this.TEXTPDFFONT.commentFont,\n      this.TEXTPDFFONT.commentFontStyle,\n      this.TEXTPDFFONT.commentFontSize,\n      commentMarginLeft,\n      marginTop\n    );\n  }\n\n  private addTextInPdfDoc(doc: jsPDF,\n    textToAdd: string,\n    textFont: string,\n    textFontStyle: string,\n    textFontSize: number,\n    textMarginLeft: number,\n    textMarginTop: number)\n    {\n      doc.setFont(textFont, textFontStyle);\n      doc.setFontSize(textFontSize);\n      doc.text(textToAdd, textMarginLeft, textMarginTop);\n    }\n\n  /**\n   * Add projection and/or scale to the document\n   * @param  doc - pdf document\n   * @param  map - Map of the app\n   * @param  dpi - DPI resolution of the document\n   * @param  projection - Bool to indicate if projection need to be added\n   * @param  scale - Bool to indicate if scale need to be added\n   */\n  private addProjScale(\n    doc: jsPDF,\n    map: IgoMap,\n    dpi: number,\n    projection: boolean,\n    scale: boolean\n  ) {\n    const translate = this.languageService.translate;\n    const projScaleSize = 16;\n    const projScaleMarginLeft = 20;\n    const marginBottom = 15;\n    const heightPixels = doc.internal.pageSize.height - marginBottom;\n\n    let textProjScale: string = '';\n    if (projection === true) {\n      const projText = translate.instant('igo.geo.printForm.projection');\n      textProjScale += projText + ': ' + map.projection;\n    }\n    if (scale === true) {\n      if (projection === true) {\n        textProjScale += '   ';\n      }\n      const scaleText = translate.instant('igo.geo.printForm.scale');\n      const mapScale = map.viewController.getScale(dpi);\n      textProjScale += scaleText + ': ~ 1 / ' + formatScale(mapScale);\n    }\n    doc.setFont('courier');\n    doc.setFontSize(projScaleSize);\n    doc.text(textProjScale, projScaleMarginLeft, heightPixels);\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async addLegend(\n    doc: jsPDF,\n    map: IgoMap,\n    margins: Array<number>,\n    resolution: number\n  ) {\n    // Get html code for the legend\n    const width = doc.internal.pageSize.width;\n    const html = await this.getLayersLegendHtml(\n      map,\n      width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveDoc(doc);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n\n    await this.timeout(1);\n    const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n\n    if (canvas) {\n      const pourcentageReduction = 0.85;\n      const imageSize = [pourcentageReduction * (25.4 * canvas.width) / resolution, pourcentageReduction\n        * (25.4 * canvas.height) / resolution];\n      let imgData;\n      doc.addPage();\n      imgData = canvas.toDataURL('image/png');\n      doc.addImage(imgData, 'PNG', 10, 10, imageSize[0], imageSize[1]);\n      div.parentNode.removeChild(div); // remove temp div (IE style)\n    }\n\n    await this.saveDoc(doc);\n\n  }\n\n  /**\n   * Add the legend to the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n     private async addLegendSamePage(\n      doc: jsPDF,\n      map: IgoMap,\n      margins: Array<number>,\n      resolution: number,\n      legendPosition: string\n    ) {\n      // Get html code for the legend\n      const width = doc.internal.pageSize.width;\n      const html = await this.getLayersLegendHtml(\n        map,\n        width,\n        resolution\n      ).toPromise();\n      // If no legend, save the map directly\n      if (html === '') {\n        await this.saveDoc(doc);\n        return true;\n      }\n      // Create div to contain html code for legend\n      const div = window.document.createElement('div');\n      div.style.position = 'absolute';\n      div.style.top = '0';\n      // Add html code to convert in the new window\n      window.document.body.appendChild(div);\n      div.innerHTML = html;\n      await this.timeout(1);\n      const canvas = await html2canvas(div, { useCORS: true }).catch((e) => {\n        console.log(e);\n      });\n      let marginsLegend;\n      if (canvas) {\n        const pourcentageReduction = 0.85;\n        const imageSize = [pourcentageReduction * (25.4 * canvas.width) / resolution,\n           pourcentageReduction * (25.4 * canvas.height) / resolution];\n        // Move the legend to the correct position on the page\n        if ( legendPosition === 'bottomright') {\n          marginsLegend = [doc.internal.pageSize.height - margins[2] - imageSize[1], margins[1],\n           margins[2], doc.internal.pageSize.width - margins[1] - imageSize[0]];\n        } else if (legendPosition === 'topright') {\n          marginsLegend = [margins[0], margins[1], doc.internal.pageSize.height - margins[0] - imageSize[1],\n          doc.internal.pageSize.width - margins[1] - imageSize[0] ];\n        } else if (legendPosition === 'bottomleft') {\n          // When the legend is in the bottom left, raise the legend slightly upward so that attributions are visible\n          marginsLegend = [doc.internal.pageSize.height - margins[2] - imageSize[1] - 15,\n          doc.internal.pageSize.width - margins[3] - imageSize[0], margins[2] + 15, margins[3] ];\n        } else if (legendPosition === 'topleft') {\n          marginsLegend = [margins[0], doc.internal.pageSize.width - margins[3] - imageSize[0],\n           doc.internal.pageSize.height - margins[0] - imageSize[1], margins[3] ];\n        }\n        this.addCanvas(doc, canvas, marginsLegend); // this adds the legend\n        div.parentNode.removeChild(div); // remove temp div (IE style)\n        await this.saveDoc(doc);\n      }\n    }\n\n  /**\n   * Add scale and attributions on the map on the document\n   * @param  doc - Pdf document where legend will be added\n   * @param  map - Map of the app\n   * @param  margins - Page margins\n   */\n  private async addScale(\n    doc: jsPDF,\n    map: IgoMap,\n    margins: Array<number>\n    ) {\n      const mapSize = map.ol.getSize();\n      const extent = map.ol.getView().calculateExtent(mapSize);\n      // Get the scale and attribution\n      // we use cloneNode to modify the nodes to print without modifying it on the page, using deep:true to get children\n      let canvasOverlayHTML;\n      const mapOverlayHTML = map.ol.getOverlayContainerStopEvent();\n      // Remove the UI buttons from the nodes\n      const OverlayHTMLButtons = mapOverlayHTML.getElementsByTagName('button');\n      const OverlayHTMLButtonsarr = Array.from(OverlayHTMLButtons);\n      for (const OverlayHTMLButton of OverlayHTMLButtonsarr) {\n        OverlayHTMLButton.setAttribute('data-html2canvas-ignore', 'true');\n      }\n      // Change the styles of hyperlink in the printed version\n      // Transform the Overlay into a canvas\n      // scale is necessary to make it in google chrome\n      // background as null because otherwise it is white and cover the map\n      // allowtaint is to allow rendering images in the attributions\n      // useCORS: true pour permettre de renderer les images (ne marche pas en local)\n      const canvas = await html2canvas(mapOverlayHTML, {\n        scale: 1,\n        backgroundColor: null,\n        allowTaint: true,\n        useCORS: true,\n      }).then( e => {\n        canvasOverlayHTML = e;\n      });\n      this.addCanvas(doc, canvasOverlayHTML, margins); // this adds scales and attributions\n }\n\n  defineNbFileToProcess(nbFileToProcess) {\n    this.nbFileToProcess = nbFileToProcess;\n  }\n\n  private timeout(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n\n  private addCanvas(\n    doc: jsPDF,\n    canvas: HTMLCanvasElement,\n    margins: Array<number>\n  ) {\n    let image;\n    if (canvas) {\n      image = canvas.toDataURL('image/png');\n    }\n\n    if (image !== undefined) {\n      if (image.length < 20 ) { //  img is corrupt    todo: fix addScale in mobile make a corrupt img\n        console.log('Warning: An image cannot be print in pdf file');\n        return;\n      }\n      const imageSize = this.getImageSizeToFitPdf(doc, canvas, margins);\n      doc.addImage(\n        image,\n        'PNG',\n        margins[3],\n        margins[0],\n        imageSize[0],\n        imageSize[1]\n      );\n      doc.rect(margins[3], margins[0], imageSize[0], imageSize[1]);\n      this.imgSizeAdded = imageSize; // keep img size for georef later\n    }\n  }\n\n  // TODO fix printing with image resolution\n  private addMap(\n    doc: jsPDF,\n    map: IgoMap,\n    resolution: number,\n    size: Array<number>,\n    margins: Array<number>\n  ) {\n    const status$ = new Subject();\n\n    const mapSize = map.ol.getSize();\n    const extent = map.ol.getView().calculateExtent(mapSize);\n\n    const widthPixels = Math.round((size[0] * resolution) / 25.4);\n    const heightPixels = Math.round((size[1] * resolution) / 25.4);\n\n    let timeout;\n\n    map.ol.once('rendercomplete', (event: any) => {\n      const canvases = event.target.getViewport().getElementsByTagName('canvas');\n      const mapStatus$$ = map.status$.subscribe((mapStatus: SubjectStatus) => {\n        clearTimeout(timeout);\n\n        if (mapStatus !== SubjectStatus.Done) {\n          return;\n        }\n\n        mapStatus$$.unsubscribe();\n\n        let status = SubjectStatus.Done;\n        try {\n          for (const canvas of canvases) {\n            if (canvas.width !== 0) {\n              this.addCanvas(doc, canvas, margins);\n            }\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error(\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageBody'\n            ),\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageHeader'\n            )\n          );\n        }\n        this.renderMap(map, mapSize, extent);\n        status$.next(status);\n      });\n\n      // If no loading as started after 200ms, then probably no loading\n      // is required.\n      timeout = window.setTimeout(() => {\n        mapStatus$$.unsubscribe();\n\n        let status = SubjectStatus.Done;\n        try {\n          for (const canvas of canvases) {\n            if (canvas.width !== 0) {\n              this.addCanvas(doc, canvas, margins);\n            }\n          }\n        } catch (err) {\n          status = SubjectStatus.Error;\n          this.messageService.error(\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageBody'\n            ),\n            this.languageService.translate.instant(\n              'igo.geo.printForm.corsErrorMessageHeader'\n            )\n          );\n        }\n        this.renderMap(map, mapSize, extent);\n        status$.next(status);\n      }, 200);\n    });\n\n    this.renderMap(map, [widthPixels, heightPixels], extent);\n\n    return status$;\n  }\n\n  /**\n   * Download an image of the map with addition of informations\n   * @param  map - Map of the app\n   * @param  format - Image format. default value to \"png\"\n   * @param  projection - Indicate if projection need to be add. Default to false\n   * @param  scale - Indicate if scale need to be add. Default to false\n   * @param  legend - Indicate if the legend of layers need to be download. Default to false\n   * @param  title - Title to add for the map - Default to blank\n   * @param  subtitle - Subtitle to add for the map - Default to blank\n   * @param  comment - Comment to add for the map - Default to blank\n   * @param  doZipFile - Indicate if we do a zip with the file\n   * @return Image file of the map with extension format given as parameter\n   */\n  downloadMapImage(\n    map: IgoMap,\n    resolution: number,\n    format = 'png',\n    projection = false,\n    scale = false,\n    title = '',\n    subtitle = '',\n    comment = '',\n    doZipFile = true,\n    legendPosition: string\n  ) {\n    const status$ = new Subject();\n    // const resolution = map.ol.getView().getResolution();\n    this.activityId = this.activityService.register();\n    const translate = this.languageService.translate;\n    map.ol.once('rendercomplete', async (event: any) => {\n      format = format.toLowerCase();\n      const oldCanvas = event.target\n        .getViewport()\n        .getElementsByTagName('canvas')[0];\n      const newCanvas = document.createElement('canvas');\n      const newContext = newCanvas.getContext('2d');\n      // Postion in height to set the canvas in new canvas\n      let positionHCanvas = 0;\n      // Get height/width of map canvas\n      const width = oldCanvas.width;\n      let height = oldCanvas.height;\n      // Set Font to calculate comment width\n      newContext.font = '20px Calibri';\n      const commentWidth = newContext.measureText(comment).width;\n      // Add height for title if defined\n      height = title !== '' ? height + 30 : height;\n      // Add height for title if defined\n      height = subtitle !== '' ? height + 30 : height;\n      // Add height for projection or scale (same line) if defined\n      height = projection !== false || scale !== false ? height + 30 : height;\n      const positionHProjScale = height - 10;\n      // Define number of line depending of the comment length\n      const commentNbLine = Math.ceil(commentWidth / width);\n      // Add height for multiline comment if defined\n      height = comment !== '' ? height + commentNbLine * 30 : height;\n      let positionHComment = height - commentNbLine * 20 + 5;\n      // Set the new canvas with the new calculated size\n      newCanvas.width = width;\n      newCanvas.height = height;\n      if (['bmp','gif', 'jpeg', 'png', 'tiff'].indexOf(format) > -1) {\n        // Patch Jpeg default black background to white\n        if (format === 'jpeg') {\n          newContext.fillStyle = '#ffffff';\n          newContext.fillRect(0, 0, width, height);\n          newContext.fillStyle = '#000000';\n        } else if (title !== '' || subtitle !== '' || comment !== '' ||\n            projection !== false || scale !== false) {\n              newContext.fillStyle = '#ffffff';\n              newContext.fillRect(0, 0, width, height);\n              newContext.fillStyle = '#000000';\n        }\n      }\n\n      // If a title need to be added to canvas\n      if (title !== '') {\n        // Set font for title\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 30;\n        newContext.textAlign = 'center';\n        newContext.fillText(title, width / 2, 20, width * 0.9);\n      }\n      if (subtitle !== '') {\n        // Set font for subtitle\n        // Adjust according to title length\n        newContext.font = '26px Calibri';\n        positionHCanvas = 60;\n        newContext.textAlign = 'center';\n        newContext.fillText(subtitle, width / 2, 50, width * 0.9);\n      }\n      // Set font for next section\n      newContext.font = '20px Calibri';\n      // If projection or/end scale need to be added to canvas\n      if((projection !== false) || (scale !== false)) {\n        let projectionScaleText = '';\n        if (projection !== false) {\n          const projText = translate.instant('igo.geo.printForm.projection');\n          projectionScaleText = projText + ': ' + map.projection + '         ';\n        }\n\n        if (scale !== false) {\n          const scaleText = translate.instant('igo.geo.printForm.scale');\n          const mapScale = map.viewController.getScale(resolution);\n          projectionScaleText += scaleText + ': ~ 1 / ' + formatScale(mapScale);\n        }\n        newContext.textAlign = 'center';\n        newContext.fillText(projectionScaleText, width / 2, positionHProjScale, width * 0.9);\n      }\n\n      // If a comment need to be added to canvas\n      if (comment !== '') {\n        newContext.textAlign = 'center';\n        // If only one line, no need to multiline the comment\n        if (commentNbLine === 1) {\n          newContext.fillText(comment, width / 2, positionHComment);\n        } else {\n          // Separate the setenses to be approx. the same length\n          const nbCommentChar = comment.length;\n          const CommentLengthToCut = Math.floor(nbCommentChar / commentNbLine);\n          let commentCurrentLine = '';\n          let positionFirstCutChar = 0;\n          let positionLastBlank;\n          // Loop for the number of line calculated\n          for (let i = 0; i < commentNbLine; i++) {\n            // For all line except last\n            if (commentNbLine - 1 > i) {\n              // Get comment current line to find the right place tu cut comment\n              commentCurrentLine = comment.substr(\n                positionFirstCutChar,\n                CommentLengthToCut\n              );\n              // Cut the setence at blank\n              positionLastBlank = commentCurrentLine.lastIndexOf(' ');\n              newContext.fillText(\n                commentCurrentLine.substr(0, positionLastBlank),\n                width / 2,\n                positionHComment\n              );\n              positionFirstCutChar += positionLastBlank;\n              // Go to next line for insertion\n              positionHComment += 20;\n            } else {\n              // Don't cut last part\n              newContext.fillText(\n                comment.substr(positionFirstCutChar),\n                width / 2,\n                positionHComment\n              );\n            }\n          }\n        }\n      }\n\n      // Add map to new canvas\n      newContext.drawImage(oldCanvas, 0, positionHCanvas);\n\n      // Check the legendPosition\n      if (legendPosition !== 'none') {\n        if (['topleft', 'topright', 'bottomleft', 'bottomright'].indexOf(legendPosition) > -1) {\n          await this.addLegendToImage(\n            newCanvas,\n            map,\n            resolution,\n            legendPosition,\n            format\n          );\n        }\n      }\n\n      let status = SubjectStatus.Done;\n      let fileNameWithExt = 'map.' + format;\n      if (format.toLowerCase() === 'tiff') {\n        fileNameWithExt = 'map' + map.projection.replace(':', '_') + '.' + format;\n      }\n\n      try {\n        // Save the canvas as file\n        if (!doZipFile) {\n          this.saveCanvasImageAsFile(newCanvas, fileNameWithExt, format);\n        } else if (format.toLowerCase() === 'tiff') {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(newCanvas, fileNameWithExt);\n        } else {\n          // Add the canvas to zip\n          this.generateCanvaFileToZip(newCanvas, fileNameWithExt);\n        }\n      } catch (err) {\n        status = SubjectStatus.Error;\n      }\n\n      status$.next(status);\n\n      if (format.toLowerCase() === 'tiff') {\n        const tfwFileNameWithExt = fileNameWithExt.substring(0, fileNameWithExt.toLowerCase().indexOf('.tiff')) + '.tfw';\n        const tiwContent = this.getWorldFileInformation(map);\n        const blob = new Blob([tiwContent], {\n          type: 'text/plain;charset=utf-8'\n        });\n        if (!doZipFile) {\n          // saveAs automaticly replace ':' for '_'\n          saveAs(blob, tfwFileNameWithExt);\n          this.saveFileProcessing();\n        } else {\n          // Add the canvas to zip\n          this.addFileToZip(tfwFileNameWithExt,blob);\n        }\n      }\n    });\n    map.ol.renderSync();\n\n    return status$;\n  }\n\n  /**\n   * Create and Add Legend to the map canvas\n   * @param  canvas Canvas of the map\n   * @param  map Map of the app\n   * @param  resolution Resolution of map\n   * @param  legendPosition Legend position\n   * @param  format Image format\n   */\n  private async addLegendToImage(\n      canvas: HTMLCanvasElement,\n      map: IgoMap,\n      resolution: number,\n      legendPosition: string,\n      format: string\n  ) {\n    const fileNameWithExt = 'map.' + format;\n    const context = canvas.getContext('2d');\n\n    // Get html code for the legend\n    const html = await this.getLayersLegendHtml(\n      map,\n      canvas.width,\n      resolution\n    ).toPromise();\n    // If no legend, save the map directly\n    if (html === '') {\n      await this.saveCanvasImageAsFile(canvas, fileNameWithExt, format);\n      return true;\n    }\n    // Create div to contain html code for legend\n    const div = window.document.createElement('div');\n    div.style.position = 'absolute';\n    div.style.top = '0';\n    // Add html code to convert in the new window\n    window.document.body.appendChild(div);\n    div.innerHTML = html;\n    await this.timeout(1);\n    const canvasLegend = await html2canvas(div, { useCORS: true }).catch((e) => {\n      console.log(e);\n    });\n\n    if (canvasLegend) {\n      const canvasHeight = canvas.height;\n      const canvasWidth = canvas.width;\n      const legendHeight = canvasLegend.height;\n      const legendWidth = canvasLegend.width;\n      // Move the legend to the correct position on the page\n      const offset = canvasHeight * 0.01;\n      let legendX: number;\n      let legendY: number;\n\n      if (legendPosition === 'bottomright') {\n        legendX = canvasWidth - legendWidth - offset;\n        legendY = canvasHeight - legendHeight - offset;\n      } else if (legendPosition === 'topright') {\n        legendX = canvasWidth - legendWidth - offset;\n        legendY = offset;\n      } else if (legendPosition === 'bottomleft') {\n        legendX = offset;\n        legendY = canvasHeight - legendHeight - offset;\n      } else if (legendPosition === 'topleft') {\n        legendX = offset;\n        legendY = offset;\n      }\n\n      context.drawImage(canvasLegend, legendX, legendY, legendWidth, legendHeight);\n      context.strokeRect(legendX, legendY, legendWidth, legendHeight);\n      div.parentNode.removeChild(div); // remove temp div (IE style)\n      return true;\n    }\n  }\n\n  private renderMap(map, size, extent) {\n    map.ol.updateSize();\n    map.ol.renderSync();\n  }\n\n  /**\n   * Save document\n   * @param  doc - Document to save\n   */\n  protected async saveDoc(doc: jsPDF) {\n    await doc.save('map_georef.pdf', { returnPromise: true });\n  }\n\n  /**\n   * Calculate the best Image size to fit in pdf\n   * @param doc - Pdf Document\n   * @param canvas - Canvas of image\n   * @param margins - Page margins\n   */\n  private getImageSizeToFitPdf(doc, canvas, margins) {\n    // Define variable to calculate best size to fit in one page\n    const pageHeight = doc.internal.pageSize.getHeight() - (margins[0] + margins[2]);\n    const pageWidth = doc.internal.pageSize.getWidth() - (margins[1] + margins[3]);\n    const canHeight = this.pdf_units2points(canvas.height, 'mm');\n    const canWidth = this.pdf_units2points(canvas.width, 'mm');\n\n    const heightRatio = canHeight / pageHeight;\n    const widthRatio = canWidth / pageWidth;\n    const maxRatio = heightRatio > widthRatio ? heightRatio : widthRatio;\n    const imgHeigh = maxRatio > 1 ? canHeight / maxRatio : canHeight;\n    const imgWidth = maxRatio > 1 ? canWidth / maxRatio : canWidth;\n\n    return [imgWidth, imgHeigh];\n  }\n\n  /**\n   * Get a world file information for tiff\n   * @param  map - Map of the app\n   */\n  private getWorldFileInformation(map) {\n    const currentResolution = map.viewController.getResolution();\n    const currentExtent = map.viewController.getExtent(); // Return [minx, miny, maxx, maxy]\n    return [\n      currentResolution,\n      0,\n      0,\n      -currentResolution,\n      currentExtent[0] + currentResolution / 0.5,\n      currentExtent[3] - currentResolution / 0.5\n    ].join('\\n');\n  }\n\n  /**\n   * Save canvas image as file\n   * @param canvas - Canvas to save\n   * @param name - Name of the file\n   * @param format - file format\n   */\n  private saveCanvasImageAsFile(canvas, nameWithExt, format) {\n    const blobFormat = 'image/' + format;\n    const that = this;\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      // If navigator is Internet Explorer\n      if (navigator.msSaveBlob) {\n        navigator.msSaveBlob(canvas.msToBlob(), nameWithExt);\n        this.saveFileProcessing();\n      } else {\n        canvas.toBlob((blob) => {\n          // download image\n          saveAs(blob, nameWithExt);\n          that.saveFileProcessing();\n        }, blobFormat);\n      }\n    } catch (err) {\n      this.messageService.error(\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageBody'\n        ),\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageHeader'\n        )\n      );\n    }\n  }\n\n  /**\n   * Add file to a zip\n   * @param canvas - File to add to the zip\n   * @param  name -Name of the fileoverview\n   */\n  private generateCanvaFileToZip(canvas, name) {\n    const blobFormat = 'image/' + 'jpeg';\n    const that = this;\n    if (\n      !this.hasOwnProperty('zipFile') ||\n      typeof this.zipFile === 'undefined'\n    ) {\n      this.zipFile = new JSZip();\n    }\n\n    try {\n      canvas.toDataURL(); // Just to make the catch trigger wihtout toBlob Error throw not catched\n      if (navigator.msSaveBlob) {\n        this.addFileToZip(name, canvas.msToBlob());\n      } else {\n        canvas.toBlob((blob) => {\n          that.addFileToZip(name, blob);\n        }, blobFormat);\n      }\n    } catch (err) {\n      this.messageService.error(\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageBody'\n        ),\n        this.languageService.translate.instant(\n          'igo.geo.printForm.corsErrorMessageHeader'\n        )\n      );\n    }\n  }\n\n  /**\n   * Add file to zip, if all file are zipped, download\n   * @param name - Name of the files\n   * @param blob - Contain of file\n   */\n  private addFileToZip(name, blob) {\n    // add file to zip\n    this.zipFile.file(name, blob);\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Download zip file\n      this.getZipFile();\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  private saveFileProcessing() {\n    this.nbFileToProcess--;\n\n    // If all files are proccessed\n    if (this.nbFileToProcess === 0) {\n      // Stop loading\n      this.activityService.unregister(this.activityId);\n    }\n  }\n\n  /**\n   * Get the zipped file\n   * @return Retun a zip file\n   */\n  private getZipFile() {\n    const that = this;\n    this.zipFile.generateAsync({ type: 'blob' }).then((blob) => {\n      // 1) generate the zip file\n      saveAs(blob, 'map.zip');\n      delete that.zipFile;\n    });\n  }\n\n\n  private pdf_units2points(n, unit): number {\n    let k = 1;\n\n    // this code is borrowed from jsPDF\n    //  as it does not expose a public API\n    //  for converting units to points.\n    switch (unit) {\n        case 'pt':\n            k = 1;\n            break;\n        case 'mm':\n            k = 72 / 25.4;\n            break;\n        case 'cm':\n            k = 72 / 2.54;\n            break;\n        case 'in':\n            k = 72;\n            break;\n        case 'px':\n            k = 96 / 72;\n            break;\n        case 'pc':\n            k = 12;\n            break;\n        case 'em':\n            k = 12;\n            break;\n        case 'ex':\n            k = 6;\n            break;\n        default:\n            throw new Error('Invalid unit: ' + unit);\n    }\n\n    return n * k;\n  }\n\n}\n","import { Layer } from '../shared/layers/layer';\nimport { LegendMapViewOptions, OutputLayerLegend } from '../shared/layers/layer.interface';\n\n/**\n * Get all the layers legend\n * @return Array of legend\n */\nexport function getLayersLegends(layers: Layer[], view?: LegendMapViewOptions): OutputLayerLegend[] {\n  const legends = [];\n\n  for (const layer of layers) {\n    const legendOptions = layer.options.legendOptions;\n    if (layer.visible === false) { continue; }\n\n    const legendUrls = layer.dataSource.getLegend(undefined, view) || [];\n    for (const legendUrl of legendUrls) {\n      if (legendUrl.url === undefined) { continue; }\n\n      // Add legend info to the list\n      legends.push({\n        title: layer.title || '',\n        url: legendUrl.url,\n        display: legendOptions?.display === undefined ? true : legendOptions.display\n      });\n    }\n  }\n\n  return legends;\n}\n","import { strEnum } from '@igo2/utils';\n\nexport const PrintOutputFormat = strEnum(['Pdf', 'Image']);\n\nexport type PrintOutputFormat = keyof typeof PrintOutputFormat;\n\nexport const PrintPaperFormat = strEnum([\n  'A0',\n  'A1',\n  'A2',\n  'A3',\n  'A4',\n  'A5',\n  'Letter',\n  'Legal'\n]);\nexport type PrintPaperFormat = keyof typeof PrintPaperFormat;\n\nexport const PrintOrientation = strEnum(['landscape', 'portrait']);\nexport type PrintOrientation = keyof typeof PrintOrientation;\n\nexport const PrintResolution = strEnum(['72', '96', '150', '300']);\nexport type PrintResolution = keyof typeof PrintResolution;\n\nexport const PrintSaveImageFormat = strEnum([\n  'Bmp',\n  'Gif',\n  'Jpeg',\n  'Png',\n  'Tiff'\n]);\nexport type PrintSaveImageFormat = keyof typeof PrintSaveImageFormat;\n\nexport const PrintLegendPosition = strEnum([\n  'none',\n  'topright',\n  'topleft',\n  'bottomleft',\n  'bottomright',\n  'newpage'\n]);\nexport type PrintLegendPosition = keyof typeof PrintLegendPosition;\n","<form class=\"igo-form\" [formGroup]=\"form\">\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"title\"\n        placeholder=\"{{'igo.geo.printForm.title' | translate}}\">\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"subtitle\"\n        placeholder=\"{{'igo.geo.printForm.subtitle' | translate}}\">\n    </mat-form-field>\n  </div>\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <input\n        matInput\n        formControlName=\"comment\"\n        placeholder=\"{{'igo.geo.printForm.comment' | translate}}\">\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <div class=\"print-slide-toggle-container mat-typography\">\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showProjection\"\n        [labelPosition]=\"'before'\">\n        {{'igo.geo.printForm.showProjection' | translate}}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"showScale\"\n        [labelPosition]=\"'before'\">\n        {{'igo.geo.printForm.showScale' | translate}}\n      </mat-slide-toggle>\n      <mat-slide-toggle\n        class=\"print-option\"\n        formControlName=\"doZipFile\"\n        [labelPosition]=\"'before'\"\n        [style.display]=\"isPrintService ? 'none' : ''\">\n        {{'igo.geo.printForm.doZipFile' | translate}}\n      </mat-slide-toggle>\n    </div>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"legendPosition\"\n        placeholder=\"{{'igo.geo.printForm.legendPosition' | translate}}\">\n        <mat-option *ngFor=\"let legendPosition of legendPositions | keyvalue \" [value]=\"legendPosition.key\">\n          <ng-container *ngIf=\"!['newpage', 'newimage'].includes(legendPosition.value)\">\n            {{'igo.geo.printForm.legendPositions.' + legendPosition.value | translate}}\n          </ng-container>\n\n          <ng-container *ngIf=\"['newpage', 'newimage'].includes(legendPosition.value)\">\n            {{ ((outputFormat === 'Pdf') ? 'igo.geo.printForm.legendPositions.newpage' : \n            'igo.geo.printForm.legendPositions.newimage') | translate}}\n          </ng-container>\n        </mat-option>\n\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\">\n    <mat-form-field>\n      <mat-select (selectionChange)=\"toggleImageSaveProp()\"\n        formControlName=\"outputFormat\"\n        placeholder=\"{{'igo.geo.printForm.outputFormat' | translate}}\">\n        <mat-option *ngFor=\"let outputFormat of outputFormats | keyvalue \" [value]=\"outputFormat.key\">\n            {{outputFormat.value}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'block' : 'none'\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"paperFormat\"\n        placeholder=\"{{'igo.geo.printForm.paperFormat' | translate}}\">\n        <mat-option *ngFor=\"let paperFormat of paperFormats | keyvalue \" [value]=\"paperFormat.key\">\n          {{('igo.geo.printForm.paperFormats.' + paperFormat.value) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'none' : 'block'\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"imageFormat\"\n        placeholder=\"{{'igo.geo.printForm.imageFormat' | translate}}\">\n        <mat-option *ngFor=\"let imageFormat of imageFormats | keyvalue \" [value]=\"imageFormat.key\">\n          {{imageFormat.value}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" style=\"display: none;\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"resolution\"\n        placeholder=\"{{'igo.geo.printForm.resolution' | translate}}\">\n        <mat-option *ngFor=\"let resolution of resolutions | keyvalue \" [value]=\"resolution.key\">\n          {{resolution.value + ' PPI'}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-input-container\" [style.display]=\"isPrintService ? 'block' : 'none'\">\n    <mat-form-field>\n      <mat-select\n        formControlName=\"orientation\"\n        placeholder=\"{{'igo.geo.printForm.orientation' | translate}}\">\n        <mat-option *ngFor=\"let orientation of orientations | keyvalue \" [value]=\"orientation.key\">\n          {{('igo.geo.printForm.' + orientation.value) | translate}}\n        </mat-option>\n      </mat-select>\n    </mat-form-field>\n  </div>\n\n  <div class=\"igo-form-button-group print-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      [disabled]=\"!form.valid || (disabled$ | async)\"\n      (click)=\"handleFormSubmit(form.value, form.valid)\">\n      {{'igo.geo.printForm.saveBtn' | translate}}\n    </button>\n  </div>\n\n</form>\n","import { Component, Input, Output, EventEmitter, OnInit } from '@angular/core';\nimport {\n  UntypedFormGroup,\n  UntypedFormBuilder,\n  UntypedFormControl,\n  Validators\n} from '@angular/forms';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { PrintOptions } from '../shared/print.interface';\n\nimport {\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintOrientation,\n  PrintResolution,\n  PrintSaveImageFormat,\n  PrintLegendPosition\n} from '../shared/print.type';\n\n@Component({\n  selector: 'igo-print-form',\n  templateUrl: './print-form.component.html',\n  styleUrls: ['./print-form.component.scss']\n})\nexport class PrintFormComponent implements OnInit {\n  public form: UntypedFormGroup;\n  public outputFormats = PrintOutputFormat;\n  public paperFormats = PrintPaperFormat;\n  public orientations = PrintOrientation;\n  public resolutions = PrintResolution;\n  public imageFormats = PrintSaveImageFormat;\n  public legendPositions = PrintLegendPosition;\n  public isPrintService = true;\n\n  @Input() disabled$: BehaviorSubject<boolean>;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this.imageFormatField.value;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this.imageFormatField.setValue(value || PrintSaveImageFormat.Jpeg, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this.outputFormatField.value;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this.outputFormatField.setValue(value || PrintOutputFormat.Pdf, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this.paperFormatField.value;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this.paperFormatField.setValue(value || PrintPaperFormat.Letter, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this.orientationField.value;\n  }\n  set orientation(value: PrintOrientation) {\n    this.orientationField.setValue(value || PrintOrientation.landscape, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this.resolutionField.value;\n  }\n  set resolution(value: PrintResolution) {\n    this.resolutionField.setValue(value || PrintResolution['96'], {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this.legendPositionField.value;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this.legendPositionField.setValue(value || PrintLegendPosition.none, {\n      onlySelf: true\n    });\n  }\n\n  @Input()\n  get title(): string {\n    return this.titleField.value;\n  }\n  set title(value: string) {\n    this.titleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get subtitle(): string {\n    return this.subtitleField.value;\n  }\n  set subtitle(value: string) {\n    this.subtitleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get comment(): string {\n    return this.commentField.value;\n  }\n  set comment(value: string) {\n    this.commentField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showProjection(): boolean {\n    return this.showProjectionField.value;\n  }\n  set showProjection(value: boolean) {\n    this.showProjectionField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showScale(): boolean {\n    return this.showScaleField.value;\n  }\n  set showScale(value: boolean) {\n    this.showScaleField.setValue(value, { onlySelf: true });\n  }\n  @Input()\n  get showLegend(): boolean {\n    return this.showLegendField.value;\n  }\n  set showLegend(value: boolean) {\n    this.showLegendField.setValue(value, { onlySelf: true });\n  }\n\n  @Input()\n  get doZipFile(): boolean {\n    return this.doZipFileField.value;\n  }\n  set doZipFile(value: boolean) {\n    this.doZipFileField.setValue(value, { onlySelf: true });\n  }\n\n  get outputFormatField() {\n    return (this.form.controls as any).outputFormat as UntypedFormControl;\n  }\n\n  get paperFormatField() {\n    return (this.form.controls as any).paperFormat as UntypedFormControl;\n  }\n\n  get imageFormatField() {\n    return (this.form.controls as any).imageFormat as UntypedFormControl;\n  }\n\n  get orientationField() {\n    return (this.form.controls as any).orientation as UntypedFormControl;\n  }\n\n  get resolutionField() {\n    return (this.form.controls as any).resolution as UntypedFormControl;\n  }\n\n  get commentField() {\n    return (this.form.controls as any).comment as UntypedFormControl;\n  }\n\n  get showProjectionField() {\n    return (this.form.controls as any).showProjection as UntypedFormControl;\n  }\n\n  get showScaleField() {\n    return (this.form.controls as any).showScale as UntypedFormControl;\n  }\n\n  get showLegendField() {\n    return (this.form.controls as any).showLegend as UntypedFormControl;\n  }\n\n  get doZipFileField() {\n    return (this.form.controls as any).doZipFile as UntypedFormControl;\n  }\n\n  get titleField() {\n    return (this.form.controls as any).title as UntypedFormControl;\n  }\n\n  get subtitleField() {\n    return (this.form.controls as any).subtitle as UntypedFormControl;\n  }\n\n  get legendPositionField() {\n    return (this.form.controls as any).legendPosition as UntypedFormControl;\n  }\n\n  @Output() submit: EventEmitter<PrintOptions> = new EventEmitter();\n\n  constructor(private formBuilder: UntypedFormBuilder) {\n    this.form = this.formBuilder.group({\n      title: ['', []],\n      subtitle: ['', []],\n      comment: ['', []],\n      outputFormat: ['', [Validators.required]],\n      paperFormat: ['', [Validators.required]],\n      imageFormat: [ '', [Validators.required]],\n      resolution: ['', [Validators.required]],\n      orientation: ['', [Validators.required]],\n      legendPosition: ['', [Validators.required]],\n      showProjection: false,\n      showScale: false,\n      showLegend: false,\n      doZipFile: [{hidden: this.isPrintService }]\n    });\n  }\n\n  ngOnInit() {\n    this.doZipFileField.setValue(false);\n  }\n\n  handleFormSubmit(data: PrintOptions, isValid: boolean) {\n    data.isPrintService = this.isPrintService;\n    if (isValid) {\n      this.submit.emit(data);\n    }\n  }\n\n  toggleImageSaveProp() {\n    if (this.outputFormatField.value === 'Image') {\n      this.isPrintService = false;\n    } else {\n      this.isPrintService = true;\n    }\n  }\n}\n","import { Component, Input } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { PrintOptions } from '../shared/print.interface';\n\nimport {\n  PrintOutputFormat,\n  PrintPaperFormat,\n  PrintOrientation,\n  PrintResolution,\n  PrintSaveImageFormat,\n  PrintLegendPosition\n} from '../shared/print.type';\n\nimport { PrintService } from '../shared/print.service';\n\n@Component({\n  selector: 'igo-print',\n  templateUrl: './print.component.html'\n})\nexport class PrintComponent {\n  public disabled$ = new BehaviorSubject(false);\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get outputFormat(): PrintOutputFormat {\n    return this._outputFormat;\n  }\n  set outputFormat(value: PrintOutputFormat) {\n    this._outputFormat = value;\n  }\n  private _outputFormat: PrintOutputFormat;\n\n  @Input()\n  get paperFormat(): PrintPaperFormat {\n    return this._paperFormat;\n  }\n  set paperFormat(value: PrintPaperFormat) {\n    this._paperFormat = value;\n  }\n  private _paperFormat: PrintPaperFormat;\n\n  @Input()\n  get orientation(): PrintOrientation {\n    return this._orientation;\n  }\n  set orientation(value: PrintOrientation) {\n    this._orientation = value;\n  }\n  private _orientation: PrintOrientation;\n\n  @Input()\n  get imageFormat(): PrintSaveImageFormat {\n    return this._imageFormat;\n  }\n  set imageFormat(value: PrintSaveImageFormat) {\n    this._imageFormat = value;\n  }\n  private _imageFormat: PrintSaveImageFormat;\n\n  @Input()\n  get legendPosition(): PrintLegendPosition {\n    return this._legendPosition;\n  }\n  set legendPosition(value: PrintLegendPosition) {\n    this._legendPosition = value;\n  }\n  private _legendPosition: PrintLegendPosition;\n\n  @Input()\n  get resolution(): PrintResolution {\n    return this._resolution;\n  }\n  set resolution(value: PrintResolution) {\n    this._resolution = value;\n  }\n  private _resolution: PrintResolution;\n\n  constructor(private printService: PrintService) {}\n\n  handleFormSubmit(data: PrintOptions) {\n\n    this.disabled$.next(true);\n\n    if (data.isPrintService === true) {\n      this.printService\n        .print(this.map, data)\n        .pipe(take(1))\n        .subscribe(() => {\n          this.disabled$.next(false);\n        });\n    } else {\n      let nbFileToProcess = 1;\n\n      if (data.showLegend) {\n        nbFileToProcess++;\n      }\n      if (data.imageFormat.toLowerCase() === 'tiff') {\n        nbFileToProcess++;\n      }\n\n      this.printService.defineNbFileToProcess(nbFileToProcess);\n\n      const resolution = +data.resolution;\n\n      let nbRequests = data.showLegend ? 2 : 1;\n\n      if (data.legendPosition === 'newpage') {\n        nbRequests++;\n      }\n\n      this.printService\n        .downloadMapImage(\n          this.map,\n          resolution,\n          data.imageFormat,\n          data.showProjection,\n          data.showScale,\n          data.title,\n          data.subtitle,\n          data.comment,\n          data.doZipFile,\n          data.legendPosition\n        )\n        .pipe(take(1))\n        .subscribe(() => {\n          nbRequests--;\n          if(data.legendPosition === 'newpage') {\n            this.printService.getLayersLegendImage(\n              this.map,\n              data.imageFormat,\n              data.doZipFile,\n              resolution\n            ).then(() => {\n              nbRequests--;\n              if (!nbRequests) {\n                this.disabled$.next(false);\n              }\n            });\n          } else {\n            if (!nbRequests) {\n              this.disabled$.next(false);\n            }\n          }\n        });\n    }\n  }\n}\n","<igo-print-form\n  [outputFormat]=\"outputFormat\"\n  [paperFormat]=\"paperFormat\"\n  [orientation]=\"orientation\"\n  [imageFormat]=\"imageFormat\"\n  [resolution]=\"resolution\"\n  [legendPosition]=\"legendPosition\"\n  [disabled$]=\"disabled$\"\n  (submit)=\"handleFormSubmit($event)\">\n</igo-print-form>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoKeyValueModule } from '@igo2/common';\n\nimport { PrintComponent } from './print/print.component';\nimport { PrintFormComponent } from './print-form/print-form.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatInputModule,\n    MatFormFieldModule,\n    MatSlideToggleModule,\n    IgoLanguageModule,\n    IgoKeyValueModule\n  ],\n  exports: [PrintComponent, PrintFormComponent],\n  declarations: [PrintComponent, PrintFormComponent]\n})\nexport class IgoPrintModule {}\n","import { ConfigService } from '@igo2/core';\n\nimport { SearchSource } from '../../search/shared/sources/source';\n\nimport { QuerySearchSource } from './query-search-source';\n\n/**\n * Map search source factory\n * @ignore\n */\nexport function querySearchSourceFactory(config: ConfigService) {\n  return new QuerySearchSource(\n    config.getConfig(`searchSources.${QuerySearchSource.id}`) || {}\n  );\n}\n\n/**\n * Function that returns a provider for the map search source\n */\nexport function provideQuerySearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: querySearchSourceFactory,\n    multi: true,\n    deps: [ConfigService]\n  };\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { IgoLanguageModule, IgoMessageModule } from '@igo2/core';\n\nimport { QueryDirective } from './shared/query.directive';\nimport { QueryService } from './shared/query.service';\nimport { provideQuerySearchSource } from './shared/query-search-source.providers';\n\n@NgModule({\n  imports: [CommonModule, IgoLanguageModule, IgoMessageModule],\n  exports: [QueryDirective],\n  declarations: [QueryDirective],\n  providers: [QueryService]\n})\nexport class IgoQueryModule {\n  static forRoot(): ModuleWithProviders<IgoQueryModule> {\n    return {\n      ngModule: IgoQueryModule,\n      providers: [provideQuerySearchSource()]\n    };\n  }\n}\n","import { Observable } from 'rxjs';\n\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\n\nexport abstract class DirectionsSource {\n  abstract enabled: boolean;\n  abstract getName(): string;\n  abstract route(coordinates: [number, number][], directionsOptions: DirectionOptions): Observable<Direction[]>;\n}\n","import { DirectionsSource } from '../directions-sources/directions-source';\n\nexport class DirectionsSourceService {\n  constructor(public sources: DirectionsSource[]) {}\n}\n\nexport function directionsSourceServiceFactory(sources: DirectionsSource[]) {\n  return new DirectionsSourceService(sources);\n}\n\nexport function provideDirectionsSourceService() {\n  return {\n    provide: DirectionsSourceService,\n    useFactory: directionsSourceServiceFactory,\n    deps: [DirectionsSource]\n  };\n}\n","export enum DirectionsFormat {\n  GeoJSON,\n  JSON\n}\nexport enum SourceDirectionsType {\n  Route = 'route',\n  Trip = 'trip'\n}\n\nexport enum ProposalType {\n  Coord = 'coord',\n  Text = 'text'\n}\n\nexport enum DirectionType {\n  Stop = 'stop',\n  Route = 'route',\n  Vertex = 'vertex'\n}\n\nexport enum DirectionRelativePositionType {\n  Start = 'start',\n  Intermediate = 'intermediate',\n  End = 'end'\n}\n","import olFeature from 'ol/Feature';\nimport * as olStyle from 'ol/style';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport * as olGeom from 'ol/geom';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olProj from 'ol/proj';\n\nimport { uuid, NumberUtils } from '@igo2/utils';\n\nimport { Direction, FeatureWithDirection, FeatureWithStop, Stop } from './directions.interface';\nimport { createOverlayMarkerStyle } from '../../overlay/shared/overlay-marker-style.utils';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { tryAddLoadingStrategy } from '../../feature/shared/strategies.utils';\nimport { FeatureStoreLoadingStrategy } from '../../feature/shared/strategies/loading';\nimport { FEATURE, FeatureMotion } from '../../feature/shared/feature.enums';\nimport { LanguageService } from '@igo2/core';\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { DirectionRelativePositionType, DirectionType } from './directions.enum';\nimport { RoutesFeatureStore, StepFeatureStore, StopsFeatureStore, StopsStore } from './store';\n\n/**\n * Function that updat the sort of the list base on the provided field.\n * @param source stop store\n * @param direction asc / desc sort order\n * @param field the field to use to sort the view\n */\nexport function updateStoreSorting(stopsStore: StopsStore, direction: 'asc' | 'desc' = 'asc', field = 'position') {\n  stopsStore.view.sort({\n    direction,\n    valueAccessor: (entity: Stop) => entity[field]\n  });\n}\n\nexport function computeRelativePosition(index: number, totalLength): DirectionRelativePositionType {\n  let relativePosition = DirectionRelativePositionType.Intermediate;\n  if (index === 0) {\n    relativePosition = DirectionRelativePositionType.Start;\n  } else if (index === totalLength - 1) {\n    relativePosition = DirectionRelativePositionType.End;\n  }\n  return relativePosition;\n}\n\nexport function computeStopsPosition(stopsStore: StopsStore) {\n\n  const stopsToComputePosition = [...stopsStore.all()];\n  stopsToComputePosition.sort((a, b) => a.position - b.position);\n  stopsToComputePosition.map((stop, i) => {\n    stop.position = i;\n    stop.relativePosition = computeRelativePosition(stop.position, stopsToComputePosition.length);\n  });\n  if (stopsToComputePosition) {\n    stopsStore.updateMany(stopsToComputePosition);\n  }\n}\n\n/**\n * Function that add a stop to the stop store. Stop are always added before the last stop.\n * @param stopsStore stop store as an EntityStore\n */\nexport function addStopToStore(stopsStore: StopsStore): Stop {\n\n  const id = uuid();\n  const stops = stopsStore.all();\n  let positions: number[];\n  if (stopsStore.count === 0) {\n    positions = [0];\n  } else {\n    positions = stops.map(stop => stop.position);\n  }\n  const maxPosition: number = Math.max(...positions);\n  const insertPosition: number = maxPosition;\n  const lastPosition: number = maxPosition + 1;\n\n  const stopToUpdate = stopsStore.all().find(stop => stop.position === maxPosition);\n  if (stopToUpdate) {\n    stopToUpdate.position = lastPosition;\n    stopToUpdate.relativePosition = computeRelativePosition(lastPosition, stopsStore.count + 1);\n  }\n\n  stopsStore.insert({ id, position: insertPosition, relativePosition: computeRelativePosition(insertPosition, stopsStore.count + 1) });\n\n  updateStoreSorting(stopsStore);\n  return stopsStore.get(id);\n}\n\nexport function removeStopFromStore(stopsStore: StopsStore, stop: Stop) {\n  stopsStore.delete(stop);\n  computeStopsPosition(stopsStore);\n}\n\n/**\n * Create a style for the directions stops and routes\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function directionsStyle(\n  feature: olFeature<OlGeometry>,\n  resolution: number\n): olStyle.Style | olStyle.Style[] {\n  const vertexStyle = [\n    new olStyle.Style({\n      geometry: feature.getGeometry(),\n      image: new olStyle.Circle({\n        radius: 7,\n        stroke: new olStyle.Stroke({ color: '#FF0000', width: 3 })\n      })\n    })\n  ];\n\n  const stopStyle = createOverlayMarkerStyle({\n    text: feature.get('stopText'),\n    opacity: feature.get('stopOpacity'),\n    markerColor: feature.get('stopColor'),\n    markerOutlineColor: [255, 255, 255]\n  });\n\n  const routeStyle = [\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({ color: `rgba(106, 121, 130, ${feature.get('active') ? 0.75 : 0})`, width: 10 })\n    }),\n    new olStyle.Style({\n      stroke: new olStyle.Stroke({ color: `rgba(79, 169, 221, ${feature.get('active') ? 0.75 : 0})`, width: 6 })\n    })\n  ];\n\n  if (feature.get('type') === DirectionType.Stop) {\n    return stopStyle;\n  }\n  if (feature.get('type') === 'vertex') {\n    return vertexStyle;\n  }\n  if (feature.get('type') === DirectionType.Route) {\n    return routeStyle;\n  }\n}\n\nexport function initStopsFeatureStore(stopsFeatureStore: StopsFeatureStore, languageService: LanguageService) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stopsLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-stops-layer',\n    title: languageService.translate.instant('igo.geo.directionsForm.stopLayer'),\n    zIndex: 911,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-stops-layer',\n      links: [\n        {\n          syncedDelete: true,\n          linkedIds: ['igo-direction-route-layer'],\n          properties: []\n        }\n      ]\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stopsFeatureStore, stopsLayer);\n  stopsFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stopsFeatureStore, loadingStrategy);\n}\n\nexport function initRoutesFeatureStore(routesFeatureStore: RoutesFeatureStore, languageService: LanguageService) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const routeLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-route-layer',\n    title: languageService.translate.instant('igo.geo.directionsForm.routeLayer'),\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: true,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: true,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(routesFeatureStore, routeLayer);\n  routesFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(routesFeatureStore, loadingStrategy);\n}\n\nexport function initStepFeatureStore(stepFeatureStore: StepFeatureStore) {\n  const loadingStrategy = new FeatureStoreLoadingStrategy({\n    motion: FeatureMotion.None\n  });\n\n  const stepLayer = new VectorLayer({\n    isIgoInternalLayer: true,\n    id: 'igo-direction-step-layer',\n    title: '',\n    zIndex: 910,\n    source: new FeatureDataSource(),\n    showInLayerList: false,\n    workspace: {\n      enabled: false,\n    },\n    linkedLayers: {\n      linkId: 'igo-direction-route-layer'\n    },\n    exportable: false,\n    browsable: false,\n    style: directionsStyle\n  });\n  tryBindStoreLayer(stepFeatureStore, stepLayer);\n  stepFeatureStore.layer.visible = true;\n  tryAddLoadingStrategy(stepFeatureStore, loadingStrategy);\n}\n\n\nexport function addStopToStopsFeatureStore(\n  stop: Stop,\n  stopsStore: StopsStore,\n  stopsFeatureStore: StopsFeatureStore,\n  projection: string,\n  languageService: LanguageService) {\n  let stopColor;\n  let stopText;\n\n\n  switch (stop.relativePosition) {\n    case DirectionRelativePositionType.Start:\n      stopColor = '#008000';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.start');\n      break;\n    case DirectionRelativePositionType.End:\n      stopColor = '#f64139';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.end');\n      break;\n    default:\n      stopColor = '#ffd700';\n      stopText = languageService.translate.instant('igo.geo.directionsForm.intermediate') + ' #' + stop.position;\n      break;\n  }\n\n  const geometry = new olGeom.Point(\n    olProj.transform(stop.coordinates, projection, stopsFeatureStore.map.projection)\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: stopsFeatureStore.map.projection,\n    dataProjection: stopsFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n  const previousStop = stopsFeatureStore.get(stop.id);\n  const previousStopRevision = previousStop ? previousStop.meta.revision : 0;\n\n  const stopFeatureStore: FeatureWithStop = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: stopsFeatureStore.map.projection,\n    properties: {\n      id: stop.id,\n      type: DirectionType.Stop,\n      stopText,\n      stopColor,\n      stopOpacity: 1,\n      stop\n    },\n    meta: {\n      id: stop.id,\n      revision: previousStopRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  stopsFeatureStore.update(stopFeatureStore);\n}\n\nexport function addDirectionToRoutesFeatureStore(\n  routesFeatureStore: RoutesFeatureStore,\n  direction: Direction,\n  projection: string,\n  active: boolean = false,\n  moveToExtent = false) {\n  const geom = direction.geometry.coordinates;\n  const geometry4326 = new olGeom.LineString(geom);\n  const geometry = geometry4326.transform(\n    projection,\n    routesFeatureStore.map.projection\n  );\n\n  const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n    featureProjection: routesFeatureStore.map.projection,\n    dataProjection: routesFeatureStore.map.projection\n  }) as FeatureGeometry;\n\n\n  const previousRoute = routesFeatureStore.get(direction.id);\n  const previousRouteRevision = previousRoute\n    ? previousRoute.meta.revision\n    : 0;\n\n  const routeFeatureStore: FeatureWithDirection = {\n    type: FEATURE,\n    geometry: geojsonGeom,\n    projection: routesFeatureStore.map.projection,\n    properties: {\n      id: direction.id,\n      type: DirectionType.Route,\n      active,\n      direction\n    },\n    meta: {\n      id: direction.id,\n      revision: previousRouteRevision + 1\n    },\n    ol: new olFeature({ geometry })\n  };\n  routesFeatureStore.update(routeFeatureStore);\n}\n\nexport function formatDistance(distance: number): string {\n  if (distance === 0) {\n    return;\n  }\n  if (distance >= 100000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 1000, 1) + ' km';\n  }\n  if (distance >= 10000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km';\n  }\n  if (distance >= 1000) {\n    return NumberUtils.roundToNDecimal(Math.round(distance) / 100 / 10, 1) + ' km';\n  }\n  return NumberUtils.roundToNDecimal(distance, 0) + ' m';\n}\n\nexport function formatDuration(duration: number): string {\n  if (duration >= 3600) {\n    const hour = Math.floor(duration / 3600);\n    const minute = Math.round((duration / 3600 - hour) * 60);\n    if (minute === 60) {\n      return hour + 1 + ' h';\n    }\n    return hour + ' h ' + minute + ' min';\n  }\n\n  if (duration >= 60) {\n    return Math.round(duration / 60) + ' min';\n  }\n  return duration + ' s';\n}\n\nexport function formatInstruction(\n  type,\n  modifier,\n  route,\n  direction,\n  stepPosition,\n  exit,\n  languageService: LanguageService,\n  lastStep = false\n) {\n  const translate = languageService.translate;\n  let directive;\n  let image = 'forward';\n  let cssClass = 'rotate-270';\n  const translatedDirection = translateBearing(direction, languageService);\n  const translatedModifier = translateModifier(modifier, languageService);\n  const prefix = modifier === 'straight' ? '' : translate.instant('igo.geo.directions.modifier.prefix');\n\n  let aggregatedDirection = prefix + translatedModifier;\n\n\n  if (modifier?.search('slight') >= 0) {\n    aggregatedDirection = translatedModifier;\n  }\n\n  if (modifier === 'uturn') {\n    image = 'forward';\n    cssClass = 'rotate-90';\n  } else if (modifier === 'sharp right') {\n    image = 'subdirectory-arrow-right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'right') {\n    image = 'subdirectory-arrow-right';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'slight right') {\n    image = 'forward';\n    cssClass = 'rotate-290';\n  } else if (modifier === 'straight') {\n    image = 'forward';\n  } else if (modifier === 'slight left') {\n    image = 'forward';\n    cssClass = 'rotate-250';\n  } else if (modifier === 'left') {\n    image = 'subdirectory-arrow-left';\n    cssClass = 'icon-flipped';\n  } else if (modifier === 'sharp left') {\n    image = 'subdirectory-arrow-left';\n    cssClass = 'icon-flipped';\n  }\n\n  if (type === 'turn') {\n    if (modifier === 'straight') {\n      directive = translate.instant('igo.geo.directions.turn.straight', { route });\n    } else if (modifier === 'uturn') {\n      directive = translate.instant('igo.geo.directions.turn.uturn', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.turn.else', { route, aggregatedDirection, translatedModifier });\n    }\n  } else if (type === 'new name') {\n    directive = translate.instant('igo.geo.directions.new name', { route, translatedDirection });\n    image = 'compass';\n    cssClass = '';\n  } else if (type === 'depart') {\n    directive = translate.instant('igo.geo.directions.depart', { route, translatedDirection });\n    image = 'compass';\n    cssClass = '';\n  } else if (type === 'arrive') {\n    if (lastStep) {\n      const coma = !translatedModifier ? '' : ', ';\n      aggregatedDirection = !translatedModifier ? '' : aggregatedDirection;\n      directive = translate.instant('igo.geo.directions.arrive.lastStep', { coma, aggregatedDirection });\n    } else {\n      directive = translate.instant('igo.geo.directions.arrive.intermediate', { route });\n      image = 'map-marker';\n      cssClass = '';\n    }\n  } else if (type === 'merge') {\n    directive = translate.instant('igo.geo.directions.merge', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'on ramp') {\n    directive = translate.instant('igo.geo.directions.on ramp', { aggregatedDirection });\n  } else if (type === 'off ramp') {\n    directive = translate.instant('igo.geo.directions.off ramp', { aggregatedDirection });\n  } else if (type === 'fork') {\n    if (modifier.search('left') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.left', { route });\n    } else if (modifier.search('right') >= 0) {\n      directive = translate.instant('igo.geo.directions.fork.right', { route });\n    } else {\n      directive = translate.instant('igo.geo.directions.fork.else', { route });\n    }\n  } else if (type === 'end of road') {\n    directive = translate.instant('igo.geo.directions.end of road', { translatedModifier, route });\n  } else if (type === 'use lane') {\n    directive = translate.instant('igo.geo.directions.use lane');\n  } else if (type === 'continue' && modifier !== 'uturn') {\n    directive = translate.instant('igo.geo.directions.continue.notUturn', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'roundabout') {\n    const cntSuffix = exit === 1 ?\n      translate.instant('igo.geo.directions.cntSuffix.first') :\n      translate.instant('igo.geo.directions.cntSuffix.secondAndMore');\n    directive = translate.instant('igo.geo.directions.roundabout', { exit, cntSuffix, route });\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'rotary') {\n    directive = translate.instant('igo.geo.directions.rotary');\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'roundabout turn') {\n    directive = translate.instant('igo.geo.directions.roundabout turn');\n    image = 'chart-donut';\n    cssClass = '';\n  } else if (type === 'exit roundabout') {\n    directive = translate.instant('igo.geo.directions.exit roundabout', { route });\n    image = 'forward';\n    cssClass = 'rotate-270';\n  } else if (type === 'notification') {\n    directive = translate.instant('igo.geo.directions.notification');\n  } else if (modifier === 'uturn') {\n    directive = translate.instant('igo.geo.directions.uturnText', { translatedDirection, route });\n  } else {\n    directive = translate.instant('igo.geo.directions.unknown');\n  }\n\n  image = lastStep ? 'flag-variant' : image;\n  cssClass = lastStep ? '' : cssClass;\n  image = stepPosition === 0 ? 'compass' : image;\n  cssClass = stepPosition === 0 ? '' : cssClass;\n\n  return { instruction: directive, image, cssClass };\n}\n\nexport function translateModifier(modifier, languageService: LanguageService) {\n  const translate = languageService.translate;\n  if (modifier === 'uturn') {\n    return translate.instant('igo.geo.directions.uturn');\n  } else if (modifier === 'sharp right') {\n    return translate.instant('igo.geo.directions.sharp right');\n  } else if (modifier === 'right') {\n    return translate.instant('igo.geo.directions.right');\n  } else if (modifier === 'slight right') {\n    return translate.instant('igo.geo.directions.slight right');\n  } else if (modifier === 'sharp left') {\n    return languageService.translate.instant('igo.geo.directions.sharp left');\n  } else if (modifier === 'left') {\n    return languageService.translate.instant('igo.geo.directions.left');\n  } else if (modifier === 'slight left') {\n    return languageService.translate.instant('igo.geo.directions.slight left');\n  } else if (modifier === 'straight') {\n    return languageService.translate.instant('igo.geo.directions.straight');\n  } else {\n    return modifier;\n  }\n}\n\nexport function translateBearing(bearing: number, languageService: LanguageService) {\n  const translate = languageService.translate;\n  if (bearing >= 337 || bearing < 23) {\n    return translate.instant('igo.geo.cardinalPoints.n');\n  } else if (bearing < 67) {\n    return translate.instant('igo.geo.cardinalPoints.ne');\n  } else if (bearing < 113) {\n    return translate.instant('igo.geo.cardinalPoints.e');\n  } else if (bearing < 157) {\n    return translate.instant('igo.geo.cardinalPoints.se');\n  } else if (bearing < 203) {\n    return translate.instant('igo.geo.cardinalPoints.s');\n  } else if (bearing < 247) {\n    return translate.instant('igo.geo.cardinalPoints.sw');\n  } else if (bearing < 293) {\n    return translate.instant('igo.geo.cardinalPoints.w');\n  } else if (bearing < 337) {\n    return translate.instant('igo.geo.cardinalPoints.nw');\n  } else {\n    return;\n  }\n}\n\n\n","<div cdkDropList class=\"stops-list\" (cdkDropListDropped)=\"drop($event)\">\n  <div touchleave  \n  (touchenter)=\"onStopEnter(stop)\"\n  (touchleave)=\"onStopLeave()\"\n  (mouseover)=\"onStopEnter(stop)\"\n  (mouseleave)=\"onStopLeave()\"\n  (cdkDragStarted)=\"stopIsDragged=true\"\n  (cdkDragEnded)=\"stopIsDragged=false\"\n  cdkDragLockAxis=\"y\" class=\"stop-box mat-typography\" *ngFor=\"let stop of stopsStore.view.all$() | async; let i = index;\" cdkDrag>\n    <div [ngClass]=\"getNgClass(stop)\">\n      <mat-form-field>\n        <input id=\"{{stop.id}}\" type=\"text\"\n            [placeholder]=\"getPlaceholder(stop)\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"stop.text\"\n            aria-label=\"Number\"\n            matInput\n            (focus)=\"onInputFocus(stop)\"\n            [(ngModel)]=\"stop.text\"\n            (keyup)=\"setStopText($event,stop)\"\n            (keydown.enter)=\"$event.preventDefault()\"\n            [matAutocomplete]=\"auto\">\n        <button \n            mat-button \n            *ngIf=\"(stop.text || stop.coordinates) && stopWithHover && stop.id===stopWithHover.id\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"'igo.geo.directionsForm.clearStop' | translate\"\n            matSuffix mat-icon-button color=\"warn\" aria-label=\"Clear\" (click)=\"clearStop(stop)\">\n            <mat-icon svgIcon=\"close\"></mat-icon>\n        </button>\n      \n        <mat-autocomplete [displayWith]=\"getOptionText\" #auto=\"matAutocomplete\" (optionSelected)=\"chooseProposal($event,stop)\">\n          <mat-optgroup *ngFor=\"let source of stop.searchProposals\" [label]=\"source.source.title\" [disabled]=\"source.source.enabled === false\">\n          <mat-option *ngFor=\"let result of source.results\" [value]=\"result\" \n          matTooltipShowDelay=\"500\" [matTooltip]=\"result.meta ? result.meta.title : ''\">\n            {{ result.meta ? result.meta.title : '' }}\n          </mat-option>\n          </mat-optgroup>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n\n\n\n\n    <div class=\"igo-form-button-group\" *ngIf=\"!stopIsDragged && stopWithHover && stop.id === stopWithHover.id\">\n      <button class=\"swipe-vertical\" cdkDragHandle mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.moveStop' | translate\" color=\"primary\">\n        <mat-icon svgIcon=\"gesture-swipe-vertical\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"(stopsStore.count$ | async)> 2\" mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n        [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\" color=\"warn\" (click)=\"removeStop(stop)\">\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n      <button *ngIf=\"(stopsStore.count$ | async)<= 2\" disabled=\"true\" mat-icon-button tooltip-position=\"below\"\n        matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.directionsForm.removeStop' | translate\" color=\"warn\">\n        <mat-icon svgIcon=\"blank\"></mat-icon>\n      </button>\n    </div>\n  </div>\n</div>","import { Component, EventEmitter, Input, OnDestroy, Output } from '@angular/core';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\n\nimport * as olProj from 'ol/proj';\nimport * as olObservable from 'ol/Observable';\n\nimport { Stop } from '../shared/directions.interface';\n\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport pointOnFeature from '@turf/point-on-feature';\nimport { computeRelativePosition, removeStopFromStore, updateStoreSorting } from '../shared/directions.utils';\nimport { MatAutocomplete } from '@angular/material/autocomplete';\nimport { MatOption } from '@angular/material/core';\nimport { StopsFeatureStore, StopsStore } from '../shared/store';\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { LanguageService } from '@igo2/core';\nimport { DirectionRelativePositionType } from '../shared/directions.enum';\n\n@Component({\n  selector: 'igo-directions-inputs',\n  templateUrl: './directions-inputs.component.html',\n  styleUrls: ['./directions-inputs.component.scss']\n})\nexport class DirectionsInputsComponent implements OnDestroy {\n\n  private readonly invalidKeys = ['Control', 'Shift', 'Alt'];\n  private onMapClickEventKeys = [];\n  public stopWithHover: Stop;\n  public stopIsDragged: boolean = false;\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() projection: string;\n  @Input() coordRoundedDecimals: number = 6;\n\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n\n  @Output() stopInputHasFocus: EventEmitter<boolean> = new EventEmitter<boolean>(false);\n  constructor(private languageService: LanguageService) { }\n\n  ngOnDestroy(): void {\n    this.unlistenMapSingleClick();\n  }\n  onStopEnter(stop: Stop) {\n    this.stopWithHover = stop;\n  }\n  onStopLeave() {\n    this.stopWithHover = undefined;\n  }\n\n  getOptionText(option) {\n    if (option instanceof Object) {\n      return option?.meta ? option.meta.title : '';\n    }\n    return option;\n  }\n\n  chooseProposal(event: { source: MatAutocomplete, option: MatOption }, stop: Stop) {\n    const result: Feature = event.option.value;\n    if (result) {\n      let geomCoord;\n      const geom = result.geometry;\n      if (geom.type === 'Point') {\n        geomCoord = geom.coordinates;\n      } else {\n        const point = pointOnFeature(result.geometry);\n        geomCoord = [\n          point.geometry.coordinates[0],\n          point.geometry.coordinates[1]\n        ];\n      }\n      if (geomCoord) {\n        stop.coordinates = geomCoord;\n        stop.text = result.meta.title;\n        this.stopsStore.update(stop);\n      }\n    }\n  }\n\n  setStopText(event: KeyboardEvent, stop: Stop) {\n    this.unlistenMapSingleClick();\n    const term = (event.target as HTMLInputElement).value;\n    if (term.length === 0) {\n      this.clearStop(stop);\n    } else if (this.validateTerm(term)) {\n      stop.text = term;\n      this.stopsStore.update(stop);\n    }\n  }\n\n  validateTerm(term: string) {\n    if (\n      this.keyIsValid(term) &&\n      (term.length >= this.length || term.length === 0)\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  private keyIsValid(key: string) {\n    return this.invalidKeys.find(value => value === key) === undefined;\n  }\n\n  getNgClass(stop: Stop): string {\n    if (!this.stopWithHover) {\n      return 'igo-input-container';\n    } else if (stop.id === this.stopWithHover.id) {\n      return 'igo-input-container reduce';\n    } else {\n      return 'igo-input-container';\n    }\n  }\n\n  getPlaceholder(stop: Stop): string {\n    let extra = '';\n    if (stop.relativePosition) {\n      if (stop.relativePosition === DirectionRelativePositionType.Intermediate) {\n        extra = ' #' + stop.position;\n      }\n      return this.languageService.translate.instant('igo.geo.directionsForm.' + stop.relativePosition) + extra;\n    } else {\n      return '';\n    }\n  }\n\n  removeStop(stop: Stop) {\n    removeStopFromStore(this.stopsStore, stop);\n  }\n\n  clearStop(stop: Stop) {\n    this.stopsStore.update({ id: stop.id, relativePosition: stop.relativePosition, position: stop.position });\n  }\n\n  drop(event: CdkDragDrop<string[]>) {\n    this.moveStops(event.previousIndex, event.currentIndex);\n  }\n\n  private moveStops(fromIndex, toIndex) {\n    if (fromIndex !== toIndex) {\n      const stops = [...this.stopsStore.view.all()];\n      moveItemInArray(stops, fromIndex, toIndex);\n      stops.map((stop, i) => {\n        stop.relativePosition = computeRelativePosition(i, stops.length);\n        stop.position = i;\n      });\n      this.stopsStore.updateMany(stops);\n      updateStoreSorting(this.stopsStore);\n    }\n  }\n\n  onInputFocus(stop: Stop) {\n    if (!stop.text || stop.text?.length === 0) {\n      this.unlistenMapSingleClick();\n      this.stopInputHasFocus.emit(true);\n      this.listenMapSingleClick(stop);\n    }\n  }\n\n  private listenMapSingleClick(stop: Stop) {\n    const key = this.stopsFeatureStore.layer.map.ol.once('singleclick', event => {\n      const clickCoordinates = olProj.transform(\n        event.coordinate,\n        this.stopsFeatureStore.layer.map.projection,\n        this.projection\n      );\n      const roundedCoord = roundCoordTo(clickCoordinates as [number, number], this.coordRoundedDecimals);\n      stop.text = roundedCoord.join(',');\n      stop.coordinates = roundedCoord;\n      this.stopsStore.update(stop);\n      setTimeout(() => {\n        this.stopInputHasFocus.emit(false);\n      }, 500);\n    });\n    this.onMapClickEventKeys.push(key);\n  }\n\n  private unlistenMapSingleClick() {\n    this.onMapClickEventKeys.map(key => {\n      olObservable.unByKey(key);\n    });\n    this.onMapClickEventKeys = [];\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\n\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsSource } from '../directions-sources/directions-source';\nimport { DirectionsSourceService } from './directions-source.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DirectionsService {\n  constructor(private directionsSourceService: DirectionsSourceService) {}\n\n  route(coordinates: [number, number][], directionsOptions: DirectionOptions = {}): Observable<Direction[]>[] {\n    if (coordinates.length === 0) {\n      return;\n    }\n    return this.directionsSourceService.sources\n      .filter((source: DirectionsSource) => source.enabled)\n      .map((source: DirectionsSource) => this.routeSource(source, coordinates, directionsOptions));\n  }\n\n  routeSource(\n    source: DirectionsSource,\n    coordinates: [number, number][],\n    directionsOptions: DirectionOptions = {}\n  ): Observable<Direction[]> {\n    const request = source.route(coordinates, directionsOptions );\n    return request;\n  }\n}\n","import { FEATURE } from '../../feature/shared/feature.enums';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { SearchSource } from './sources/source';\nimport { SearchResult } from './search.interfaces';\n\n/**\n * Function that checks whether a search source implements TextSearch\n * @param source Search source\n * @returns True if the search source implements TextSearch\n */\nexport function sourceCanSearch(source: SearchSource): boolean {\n  return (source as any).search !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch\n * @param source Search source\n * @returns True if the search source implements ReverseSearch\n */\nexport function sourceCanReverseSearch(source: SearchSource): boolean {\n  return (source as any).reverseSearch !== undefined;\n}\n\n/**\n * Function that checks whether a search source implements ReverseSearch AND is shown in the pointer summary\n * @param source Search source\n * @returns True if the search source implements ReverseSearch AND is shown in the pointer summary\n */\nexport function sourceCanReverseSearchAsSummary(source: SearchSource): boolean {\n  return (source as any).reverseSearch !== undefined && source.showInPointerSummary === true;\n}\n\n/**\n * Return a search result out of an Feature. This is used to adapt\n * the IGO query module to the new Feature/SearchResult interfaces\n * @param feature feature\n * @param source Search source\n * @returns SearchResult\n */\nexport function featureToSearchResult(\n  feature: Feature,\n  source: SearchSource\n): SearchResult<Feature> {\n  if (feature.properties) {\n    delete feature.properties.geometry;\n    delete feature.properties.GEOMETRIE;\n    delete feature.properties.boundedBy;\n    delete feature.properties.shape;\n    delete feature.properties.SHAPE;\n    delete feature.properties.SHAPE_S;\n    delete feature.properties.SHAPE_L;\n    delete feature.properties.SHAPE_P;\n    delete feature.properties.the_geom;\n    delete feature.properties.geom;\n    delete feature.properties.geom32198;\n  }\n  feature.sourceId = source.getId();\n  return {\n    source,\n    data: feature,\n    meta: {\n      dataType: FEATURE,\n      id: feature.meta.id as string,\n      title: feature.meta.title,\n      icon: feature.meta.icon || 'map-marker'\n    }\n  };\n}\n\nexport function findDiff(str1: string, str2: string){\n  let diff = '';\n  str2.split('').forEach((val, i) => {\n    if (val !== str1.charAt(i)) {\n      diff += val;\n    }\n  });\n  return diff;\n}\n\n\n/**\n * Return a score calculation based on \"from\" term with the \"to\" term,\n * where the perfect match is 100 and a total difference is 0 or under.\n * @param from string\n * @param to string\n * @param caseSensitive boolean\n * @returns number\n */\nexport function computeTermSimilarity(from, to, caseSensitive: boolean = false): number {\n  if (!from || !to) {\n    return 0;\n  }\n  const termFrom = caseSensitive ? from : from.toLowerCase();\n  const termTo = caseSensitive ? to : to.toLowerCase();\n  const fromToDiff = findDiff(termFrom, termTo);\n  const toFromDiff = findDiff(termTo, termFrom);\n  const totalDiff = fromToDiff + toFromDiff;\n\n  let delta = 0;\n  if (totalDiff.length) {\n    delta = totalDiff.length / termFrom.length * 100;\n  }\n\n  return 100 - Math.floor(delta);\n}\n","import { SearchSource } from './sources/source';\nimport { SearchSourceSettings } from './sources/source.interfaces';\n\n/**\n * Service where all available search sources are registered.\n */\nexport class SearchSourceService {\n\n  constructor(private sources: SearchSource[]) {}\n\n  /**\n   * Return available search sources\n   * @returns Search sources\n   */\n  getSources(): SearchSource[] {\n    return this.sources;\n  }\n\n  /**\n   * Return enabled search sources\n   * @returns Search sources\n   */\n  getEnabledSources(): SearchSource[] {\n    return this.getSources().filter(\n      (source: SearchSource) => source.enabled === true\n    );\n  }\n\n  /**\n   * Enable search sources of given type\n   * @param type Search type\n   * @todo It would be better to track the enabled search sources\n   *  without updating their 'enabled' property.\n   */\n  enableSourcesByType(type: string) {\n    this.getSources().forEach((source: SearchSource) => {\n      if ((source.constructor as typeof SearchSource).type === type) {\n        source.enabled = true;\n      } else {\n        source.enabled = false;\n      }\n    });\n  }\n\n  /**\n   * Set Param from the selected settings\n   * @param source search-source\n   * @param setting settings\n   */\n  setParamFromSetting(source: SearchSource, setting: SearchSourceSettings) {\n    source.setParamFromSetting(setting);\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { stringToLonLat } from '../../map';\nimport { MapService } from '../../map/shared/map.service';\n\nimport { SearchSource, TextSearch, ReverseSearch } from './sources/source';\nimport {\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './sources/source.interfaces';\nimport { SearchSourceService } from './search-source.service';\nimport { Research } from './search.interfaces';\nimport {\n  sourceCanSearch,\n  sourceCanReverseSearch,\n  sourceCanReverseSearchAsSummary\n} from './search.utils';\nimport { StorageService } from '@igo2/core';\n\n/**\n * This service perform researches in all the search sources enabled.\n * It returns Research objects who's 'request' property needs to be\n * subscribed to in order to trigger the research. This services has\n * keeps internal state of the researches it performed\n * and the results they yielded.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class SearchService {\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mapService: MapService,\n    private storageService: StorageService\n  ) {}\n\n  /**\n   * Perform a research by text\n   * @param term Any text\n   * @returns Researches\n   */\n  search(term: string, options: TextSearchOptions = {}): Research[] {\n    if (!this.termIsValid(term)) {\n      return [];\n    }\n\n    const proj = this.mapService.getMap()?.projection || 'EPSG:3857';\n    const response = stringToLonLat(term, proj, {\n      forceNA: options.forceNA\n    });\n    if (response.lonLat) {\n      return this.reverseSearch(response.lonLat, { distance: response.radius, conf: response.conf });\n    } else if (response.message) {\n      console.log(response.message);\n    }\n\n    options.extent = this.mapService\n      .getMap()\n      ?.viewController.getExtent('EPSG:4326');\n\n    let sources;\n\n    if (options.getEnabledOnly || options.getEnabledOnly === undefined) {\n      sources = this.searchSourceService.getEnabledSources();\n    } else {\n      sources = this.searchSourceService.getSources();\n    }\n\n    if (options.sourceId) {\n      sources = sources.filter((source) => source.getId() === options.sourceId);\n    } else if (options.searchType) {\n      sources = sources.filter(\n        (source) => source.getType() === options.searchType\n      );\n    }\n\n    sources = sources.filter(sourceCanSearch);\n    return this.searchSources(sources, term, options);\n  }\n\n  /**\n   * Perform a research by lon/lat\n   * @param lonLat Any lon/lat coordinates\n   * @returns Researches\n   */\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions,\n    asPointerSummary: boolean = false\n  ) {\n    const reverseSourceFonction = asPointerSummary\n      ? sourceCanReverseSearchAsSummary\n      : sourceCanReverseSearch;\n    const sources = this.searchSourceService\n      .getEnabledSources()\n      .filter(reverseSourceFonction);\n    const reverseSearchCoordsFormat = this.storageService.get('reverseSearchCoordsFormatEnabled') as boolean || false;\n\n    return this.reverseSearchSources(sources, lonLat, options || {}, reverseSearchCoordsFormat);\n  }\n\n  /**\n   * Create a text research out of all given search sources\n   * @param sources Search sources that implement TextSearch\n   * @param term Search term\n   * @returns Observable of Researches\n   */\n  private searchSources(\n    sources: SearchSource[],\n    term: string,\n    options: TextSearchOptions\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: ((source as any) as TextSearch).search(term, options),\n        reverse: false,\n        source\n      };\n    });\n  }\n\n  /**\n   * Create a reverse research out of all given search sources\n   * @param sources Search sources that implement ReverseSearch\n   * @param lonLat Any lon/lat coordinates\n   * @returns Observable of Researches\n   */\n  private reverseSearchSources(\n    sources: SearchSource[],\n    lonLat: [number, number],\n    options: ReverseSearchOptions,\n    reverseSearchCoordsFormat: boolean\n  ): Research[] {\n    return sources.map((source: SearchSource) => {\n      return {\n        request: ((source as any) as ReverseSearch).reverseSearch(\n          lonLat,\n          options,\n          reverseSearchCoordsFormat\n        ),\n        reverse: true,\n        source\n      };\n    });\n  }\n\n  /**\n   * Validate that a search term is valid\n   * @param term Search term\n   * @returns True if the search term is valid\n   */\n  private termIsValid(term: string): boolean {\n    return typeof term === 'string' && term !== '';\n  }\n}\n","<div class=\"igo-form-button-group\">\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.directionsForm.addStop' | translate\" color=\"primary\" (click)=\"addStop()\">\n    <mat-icon svgIcon=\"map-marker-plus\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1 || (stopsStore.count$ | async)>=1\"\n    [matTooltip]=\"'igo.geo.directionsForm.resetDirectionsBtn' | translate\" color=\"warn\" (click)=\"resetStops()\">\n    <mat-icon svgIcon=\"file-restore\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"zoomRoute()\"\n    [matTooltip]=\"'igo.geo.directionsForm.zoomRoute' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"magnify-plus-outline\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"copyDirectionsToClipboard()\"\n    [matTooltip]=\"'igo.geo.directionsForm.copy' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"content-copy\"></mat-icon>\n  </button>\n  <button mat-icon-button tooltip-position=\"below\" matTooltipShowDelay=\"500\"\n    *ngIf=\"(routesFeatureStore.count$ | async)>=1\" (click)=\"copyLinkToClipboard()\" \n    [matTooltip]=\"'igo.geo.directionsForm.link' | translate\" color=\"primary\">\n    <mat-icon svgIcon=\"link\"></mat-icon>\n  </button>\n</div>","import { Component, Input, Optional } from '@angular/core';\nimport { LanguageService, MessageService, RouteService } from '@igo2/core';\nimport { Clipboard } from '@igo2/utils';\nimport { Subject } from 'rxjs';\nimport { roundCoordTo } from '../../map/shared/map.utils';\nimport { FeatureWithDirection } from '../shared/directions.interface';\n\nimport { addStopToStore, formatDistance, formatDuration, formatInstruction } from '../shared/directions.utils';\nimport { RoutesFeatureStore, StopsStore } from '../shared/store';\n\n@Component({\n  selector: 'igo-directions-buttons',\n  templateUrl: './directions-buttons.component.html',\n  styleUrls: ['./directions-buttons.component.scss']\n})\nexport class DirectionsButtonsComponent {\n\n  get activeRoute() {\n    return this.routesFeatureStore.all().find(route => route.properties.active);\n  }\n  @Input() contextUri: string;\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n  @Input() stopsStore: StopsStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  constructor(\n    private languageService: LanguageService,\n    private messageService: MessageService,\n    @Optional() private route: RouteService) { }\n\n  resetStops() {\n    this.stopsStore.clearStops();\n  }\n\n  // stop are always added before the last stop.\n  addStop(): void {\n    addStopToStore(this.stopsStore);\n  }\n\n\n  copyLinkToClipboard() {\n    const successful = Clipboard.copy(this.getUrl());\n    if (successful) {\n      const translate = this.languageService.translate;\n      const title = translate.instant(\n        'igo.geo.directionsForm.dialog.copyTitle'\n      );\n      const msg = translate.instant(\n        'igo.geo.directionsForm.dialog.copyMsgLink'\n      );\n      this.messageService.success(msg, title);\n    }\n  }\n\n  zoomRoute() {\n    this.zoomToActiveRoute$.next();\n  }\n\n  copyDirectionsToClipboard() {\n    const directionsBody = this.directionsToText();\n    const successful = Clipboard.copy(directionsBody);\n    if (successful) {\n      const translate = this.languageService.translate;\n      const title = translate.instant(\n        'igo.geo.directionsForm.dialog.copyTitle'\n      );\n      const msg = translate.instant('igo.geo.directionsForm.dialog.copyMsg');\n      this.messageService.success(msg, title);\n    }\n  }\n\n  private directionsToText() {\n    const indent = '\\t';\n    let activeRouteDirective =\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.instructions'\n      ) + ':\\n';\n    let wayPointList = '';\n    const summary =\n      this.languageService.translate.instant('igo.geo.directionsForm.summary') +\n      ': \\n' +\n      indent +\n      this.activeRoute.properties.direction.title +\n      '\\n' +\n      indent +\n      formatDistance(this.activeRoute.properties.direction.distance) +\n      '\\n' +\n      indent +\n      formatDuration(this.activeRoute.properties.direction.duration) +\n      '\\n\\n' +\n      this.languageService.translate.instant(\n        'igo.geo.directionsForm.stopsList'\n      ) +\n      ':\\n';\n\n    const url =\n      this.languageService.translate.instant('igo.geo.directionsForm.link') +\n      ':\\n' +\n      indent +\n      this.getUrl();\n\n    let wayPointsCnt = 1;\n    this.stopsStore.view.all().forEach(stop => {\n      let coord = '';\n      let stopText = '';\n      if (stop.text !== roundCoordTo(stop.coordinates).join(',')) {\n        stopText = stop.text;\n        coord = ` ( ${roundCoordTo(stop.coordinates).join(',')} )`;\n      } else {\n        stopText = roundCoordTo(stop.coordinates).join(\n          ','\n        );\n      }\n\n      wayPointList =\n        wayPointList +\n        indent +\n        wayPointsCnt.toLocaleString() +\n        '. ' +\n        stopText +\n        coord +\n        '\\n';\n      wayPointsCnt++;\n    });\n\n    let localCnt = 0;\n    this.activeRoute.properties.direction.steps.forEach(step => {\n      const instruction = this.formatStep(step, localCnt).instruction;\n      const distance =\n        formatDistance(step.distance) === undefined\n          ? ''\n          : ' (' + formatDistance(step.distance) + ')';\n      activeRouteDirective =\n        activeRouteDirective +\n        indent +\n        (localCnt + 1).toLocaleString() +\n        '. ' +\n        instruction +\n        distance +\n        '\\n';\n      localCnt++;\n    });\n\n    const directionsBody =\n      summary + wayPointList + '\\n' + url + '\\n\\n' + activeRouteDirective;\n\n    return directionsBody;\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeRoute.properties.direction.steps.length - 1\n    );\n  }\n\n  private getUrl() {\n    if (!this.route) {\n      return;\n    }\n    let context = '';\n    if (this.contextUri) {\n      context = `context=${this.contextUri}&`;\n    }\n\n    const pos = this.routesFeatureStore.all()\n    .map((direction: FeatureWithDirection) => direction.properties.id).indexOf(this.activeRoute.properties.id);\n    let routingOptions = '';\n    if (pos !== 0) {\n      const routingOptionsKey = this.route.options.directionsOptionsKey;\n      routingOptions = `&${routingOptionsKey}=result:${pos}`;\n    }\n    const directionsKey = this.route.options.directionsCoordKey;\n    const stopsCoordinates = this.stopsStore.view.all().map(stop => roundCoordTo(stop.coordinates, 6));\n    let directionsUrl = '';\n    if (stopsCoordinates.length >= 2) {\n      directionsUrl = `${directionsKey}=${stopsCoordinates.join(';')}`;\n      return `${location.origin}${location.pathname}?${context}tool=directions&sidenav=1&${directionsUrl}${routingOptions}`;\n    }\n    return;\n  }\n}\n","<div class=\"igo-input-container\" *ngIf=\"directions && activeDirection\">\n    <mat-form-field *ngIf=\"directions && directions.length > 1\">\n        <mat-select placeholder=\"{{'igo.geo.directionsForm.drivingOptions' | translate}}\"\n            (selectionChange)=\"changeRoute()\" [(ngModel)]=\"activeDirection\">\n            <mat-option *ngFor=\"let direction of directions; let cnt = index;\" [value]=\"direction\">\n                Option {{cnt + 1}} : {{formatDistance(direction.distance)}}\n                ({{formatDuration(direction.duration)}})\n            </mat-option>\n        </mat-select>\n    </mat-form-field>\n\n    <mat-divider *ngIf=\"directions && directions.length === 0\"></mat-divider>\n\n    <mat-list (mouseleave)=\"onStepsListBlur()\">\n        <h2 mat-header class=\"igo-route-title mat-typography\">{{activeDirection.title}}</h2>\n        <h2 mat-subheader>{{formatDistance(activeDirection.distance)}}, {{formatDuration(activeDirection.duration)}}</h2>\n        <mat-list-item class=\"igo-steps\" \n            (mouseenter)=\"showSegment(step)\" \n            (click)=\"showSegment(step,true)\" \n            *ngFor=\"let step of activeDirection.steps; let cnt = index;\" igoListItem>\n            <mat-icon [ngClass]=\"formatStep(step,cnt).cssClass\" mat-list-icon svgIcon=\"{{formatStep(step,cnt).image}}\">\n            </mat-icon>\n\n            <h4 mat-line>{{cnt +1}}. {{formatStep(step,cnt).instruction}}</h4>\n            <h4 mat-line class=\"right\">{{formatDistance(step.distance)}}</h4>\n        </mat-list-item>\n\n        <mat-divider></mat-divider>\n\n    </mat-list>\n\n</div>","import { ChangeDetectorRef, Component, Input, OnDestroy, OnInit } from '@angular/core';\nimport { LanguageService } from '@igo2/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { Direction, FeatureWithStep, IgoStep } from '../shared/directions.interface';\nimport { formatDistance, formatDuration, formatInstruction } from '../shared/directions.utils';\nimport { RoutesFeatureStore, StepFeatureStore } from '../shared/store';\n\nimport olFeature from 'ol/Feature';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport * as olGeom from 'ol/geom';\n\nimport { FeatureGeometry } from '../../feature/shared/feature.interfaces';\nimport { FEATURE } from '../../feature/shared/feature.enums';\nimport { DirectionType } from '../shared/directions.enum';\n\n@Component({\n  selector: 'igo-directions-results',\n  templateUrl: './directions-results.component.html',\n  styleUrls: ['./directions-results.component.scss']\n})\nexport class DirectionsResultsComponent implements OnInit, OnDestroy {\n\n  public activeDirection: Direction;\n  public directions: Direction[];\n\n  private entities$$: Subscription;\n\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n\n  constructor(\n    private languageService: LanguageService,\n    private cdRef: ChangeDetectorRef\n  ) { }\n\n  ngOnInit(): void {\n    this.entities$$ = this.routesFeatureStore.entities$\n      .pipe(debounceTime(200))\n      .subscribe(entities => {\n        const activeFeatureWithDirection = entities.find(entity => entity.properties.active);\n        this.directions = entities.map(entity => entity.properties.direction);\n        if (activeFeatureWithDirection) {\n          this.activeDirection = activeFeatureWithDirection.properties.direction;\n        } else {\n          this.activeDirection = undefined;\n        }\n        this.cdRef.detectChanges();\n      });\n  }\n\n  ngOnDestroy(): void {\n    this.entities$$.unsubscribe();\n  }\n\n  changeRoute() {\n    this.routesFeatureStore.entities$.value.map(entity =>\n      entity.properties.active = !entity.properties.active\n    );\n    this.routesFeatureStore.layer.ol.getSource().getFeatures().map(feature =>\n      feature.set('active', !feature.get('active'))\n    );\n  }\n\n  formatDistance(distance: number): string {\n    return formatDistance(distance);\n  }\n\n  formatDuration(duration: number): string {\n    return formatDuration(duration);\n  }\n\n  formatStep(step, cnt) {\n    return formatInstruction(\n      step.maneuver.type,\n      step.maneuver.modifier,\n      step.name,\n      step.maneuver.bearing_after,\n      cnt,\n      step.maneuver.exit,\n      this.languageService,\n      cnt === this.activeDirection.steps.length - 1\n    );\n  }\n\n  onStepsListBlur() {\n    this.stepFeatureStore.clear();\n  }\n\n  showSegment(step: IgoStep, zoomToExtent = false) {\n    this.showRouteSegmentGeometry(step, zoomToExtent);\n  }\n\n  showRouteSegmentGeometry(step: IgoStep, zoomToExtent = false) {\n\n    const coordinates = step.geometry.coordinates;\n    const vertexId = 'vertex';\n    const geometry4326 = new olGeom.LineString(coordinates);\n    const geometryMapProjection = geometry4326.transform(\n      'EPSG:4326',\n      this.stepFeatureStore.layer.map.projection\n    );\n    const routeSegmentCoordinates = (geometryMapProjection as any).getCoordinates();\n    const lastPoint = routeSegmentCoordinates[0];\n\n    const geometry = new olGeom.Point(lastPoint);\n    const feature = new olFeature({ geometry });\n\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.stepFeatureStore.layer.map.projection,\n      dataProjection: this.stepFeatureStore.layer.map.projection\n    }) as FeatureGeometry;\n\n    const previousVertex = this.stepFeatureStore.get(vertexId);\n    const previousVertexRevision = previousVertex\n      ? previousVertex.meta.revision\n      : 0;\n\n    const stepFeature: FeatureWithStep = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.stepFeatureStore.layer.map.projection,\n      properties: {\n        id: vertexId,\n        step,\n        type: DirectionType.Vertex\n      },\n      meta: {\n        id: vertexId,\n        revision: previousVertexRevision + 1\n      },\n      ol: feature\n    };\n    this.stepFeatureStore.update(stepFeature);\n    if (zoomToExtent) {\n      this.stepFeatureStore.layer.map.viewController.zoomToExtent(feature.getGeometry().getExtent() as [number, number, number, number]);\n    }\n  }\n\n}\n","import { ChangeDetectorRef, Component, Input, OnDestroy, OnInit } from '@angular/core';\n\nimport { debounceTime, distinctUntilChanged, map } from 'rxjs/operators';\n\nimport { LanguageService } from '@igo2/core';\nimport { EntityStoreWatcher } from '@igo2/common';\n\nimport * as olCondition from 'ol/events/condition';\nimport * as olInteraction from 'ol/interaction';\nimport * as olProj from 'ol/proj';\nimport { TranslateEvent } from 'ol/interaction/Translate';\nimport Collection from 'ol/Collection';\nimport { SelectEvent } from 'ol/interaction/Select';\n\nimport { DirectionOptions, FeatureWithStopProperties, Stop } from './shared/directions.interface';\nimport { Subject, Subscription } from 'rxjs';\nimport { addDirectionToRoutesFeatureStore, addStopToStopsFeatureStore, addStopToStore,\n  initRoutesFeatureStore, initStepFeatureStore, initStopsFeatureStore, updateStoreSorting } from './shared/directions.utils';\nimport { Feature } from '../feature/shared/feature.interfaces';\nimport { DirectionsService } from './shared/directions.service';\nimport { DirectionType, ProposalType } from './shared/directions.enum';\nimport { roundCoordTo, stringToLonLat } from '../map';\nimport { SearchService } from '../search/shared/search.service';\nimport { ChangeUtils, ObjectUtils } from '@igo2/utils';\nimport { RoutesFeatureStore, StepFeatureStore, StopsFeatureStore, StopsStore } from './shared/store';\nimport { FeatureStoreLoadingStrategy } from '../feature/shared/strategies/loading';\nimport { Research, SearchResult } from '../search/shared/search.interfaces';\nimport { QueryService } from '../query/shared/query.service';\n\n@Component({\n  selector: 'igo-directions',\n  templateUrl: './directions.component.html',\n  styleUrls: ['./directions.component.scss']\n})\nexport class DirectionsComponent implements OnInit, OnDestroy {\n\n  private watcher: EntityStoreWatcher<Stop>;\n\n  public projection: string = 'EPSG:4326';\n\n  private zoomRoute$$: Subscription;\n  private storeEmpty$$: Subscription;\n  private storeChange$$: Subscription;\n  private routesQueries$$: Subscription[] = [];\n\n  private selectStopInteraction: olInteraction.Select;\n  private translateStop: olInteraction.Translate;\n  private selectedRoute;\n  private focusOnStop: boolean = false;\n  private isTranslating: boolean = false;\n\n  public previousStops: Stop[] = [];\n\n  private searchs$$: Subscription[] = [];\n\n  @Input() contextUri: string;\n  @Input() stopsStore: StopsStore;\n  @Input() stopsFeatureStore: StopsFeatureStore;\n  @Input() routesFeatureStore: RoutesFeatureStore;\n  @Input() stepFeatureStore: StepFeatureStore;\n  @Input() debounce: number = 200;\n  @Input() length: number = 2;\n  @Input() coordRoundedDecimals: number = 6;\n  @Input() zoomToActiveRoute$: Subject<void> = new Subject();\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    private languageService: LanguageService,\n    private directionsService: DirectionsService,\n    private searchService: SearchService,\n    private queryService: QueryService\n  ) { }\n\n\n  ngOnInit(): void {\n    this.queryService.queryEnabled = false;\n    this.initEntityStores();\n    setTimeout(() => {\n      initStopsFeatureStore(this.stopsFeatureStore, this.languageService);\n      initRoutesFeatureStore(this.routesFeatureStore, this.languageService);\n      initStepFeatureStore(this.stepFeatureStore);\n      this.initOlInteraction();\n    }, 1);\n\n  }\n\n  ngOnDestroy(): void {\n    this.queryService.queryEnabled = true;\n    this.storeEmpty$$.unsubscribe();\n    this.storeChange$$.unsubscribe();\n    this.routesQueries$$.map((u) => u.unsubscribe());\n    this.zoomRoute$$.unsubscribe();\n    this.freezeStores();\n  }\n\n  private freezeStores() {\n    this.stopsFeatureStore.layer.map.ol.removeInteraction(this.selectStopInteraction);\n    this.stopsFeatureStore.layer.map.ol.removeInteraction(this.translateStop);\n    this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute);\n    this.stopsFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    this.routesFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n    this.stepFeatureStore.deactivateStrategyOfType(FeatureStoreLoadingStrategy);\n  }\n\n  private initEntityStores() {\n    this.watcher = new EntityStoreWatcher(this.stopsStore, this.cdRef);\n    this.monitorEmptyEntityStore();\n    this.monitorEntityStoreChange();\n    this.monitorActiveRouteZoom();\n  }\n\n  private monitorActiveRouteZoom() {\n    this.zoomRoute$$ = this.zoomToActiveRoute$.subscribe(() => {\n      if (this.routesFeatureStore.count >= 1) {\n        const activeRoute = this.routesFeatureStore.all().find(route => route.properties.active);\n\n        if (activeRoute) {\n          activeRoute.ol.getGeometry();\n          const routeExtent = activeRoute.ol.getGeometry().getExtent();\n          this.routesFeatureStore.layer.map.viewController.zoomToExtent(routeExtent as [number, number, number, number]);\n        }\n      }\n    });\n  }\n\n  private initOlInteraction() {\n    this.selectStopInteraction = new olInteraction.Select({\n      layers: [this.stopsFeatureStore.layer.ol],\n      hitTolerance: 7,\n      condition: (event) => {\n        return event.type === 'pointermove' && !event.dragging;\n      }\n    });\n\n    this.translateStop = new olInteraction.Translate({\n      features: this.selectStopInteraction.getFeatures()\n    });\n    this.translateStop.on('translating', (evt: TranslateEvent) => {\n      this.isTranslating = true;\n      this.executeStopTranslation(evt.features);\n    });\n    this.translateStop.on('translateend', (evt: TranslateEvent) => {\n      this.isTranslating = false;\n      this.executeStopTranslation(evt.features);\n    });\n\n    this.selectedRoute = new olInteraction.Select({\n      layers: [this.routesFeatureStore.layer.ol],\n      condition: olCondition.click,\n      hitTolerance: 7,\n      filter: feature => {\n        return feature.get('type') === DirectionType.Route &&\n          feature.get('active') &&\n          !this.isTranslating;\n      }\n    });\n    this.selectedRoute.on('select', (evt: SelectEvent) => {\n      if (this.focusOnStop === false) {\n        const selectCoordinates = roundCoordTo(\n          olProj.transform(\n            (evt as any).mapBrowserEvent.coordinate,\n            this.routesFeatureStore.layer.map.projection,\n            this.projection\n          ) as [number, number], this.coordRoundedDecimals);\n        const addedStop = addStopToStore(this.stopsStore);\n        addedStop.text = selectCoordinates.join(',');\n        addedStop.coordinates = [selectCoordinates[0], selectCoordinates[1]];\n      }\n    });\n\n    this.stopsFeatureStore.layer.map.ol.addInteraction(this.selectStopInteraction);\n    this.stopsFeatureStore.layer.map.ol.addInteraction(this.translateStop);\n    this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\n  }\n\n  onStopInputHasFocusChange(stopInputHasFocus: boolean) {\n    stopInputHasFocus ?\n      this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute) :\n      this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute);\n  }\n\n  private executeStopTranslation(\n    features: Collection<any>\n  ) {\n    if (features.getLength() === 0) {\n      return;\n    }\n    const firstFeature = features.getArray()[0];\n    const translatedStopId = firstFeature.getId();\n\n    const translationCoordinates = olProj.transform(\n      firstFeature.getGeometry().getCoordinates(),\n      this.stopsFeatureStore.layer.map.projection,\n      this.projection\n    );\n    const translatedStop = this.stopsStore.get(translatedStopId);\n    const roundedCoord = roundCoordTo(translationCoordinates as [number, number], this.coordRoundedDecimals);\n    translatedStop.coordinates = roundedCoord;\n    translatedStop.text = roundedCoord.join(',');\n    this.stopsStore.update(translatedStop);\n  }\n\n\n  private monitorEmptyEntityStore() {\n    // Watch if the store is empty to reset it\n    this.storeEmpty$$ = this.stopsStore.count$\n      .pipe(\n        distinctUntilChanged()\n      ).subscribe((count) => {\n        if (count < 2) {\n          addStopToStore(this.stopsStore);\n          if (this.stopsStore.count === 2) {\n            this.stopsStore.storeInitialized$.next(true);\n            return;\n          }\n          this.stopsStore.storeInitialized$.next(false);\n        }\n        this.routesQueries$$.map((u) => u.unsubscribe());\n      });\n  }\n\n  private monitorEntityStoreChange() {\n    this.storeChange$$ = this.stopsStore.entities$\n      .pipe(debounceTime(this.debounce))\n      .subscribe((stops: Stop[]) => {\n        this.handleStopDiff(stops);\n        updateStoreSorting(this.stopsStore);\n        this.handleStopsFeature();\n        this.getRoutes(this.isTranslating);\n      });\n  }\n\n  cancelSearch() {\n    this.searchs$$.map(s => s.unsubscribe());\n  }\n\n  private handleStopDiff(stops: Stop[]) {\n    const simplifiedStops = stops.map((stop: Stop) => {\n      return ObjectUtils.removeUndefined({ ...{ id: stop.id, text: stop.text, coordinates: stop.coordinates } });\n    });\n    const diff = ChangeUtils.findChanges(this.previousStops, simplifiedStops, ['coordinates']);\n    const stopIdToProcess = diff.added.concat(diff.modified);\n    if (stopIdToProcess) {\n      stopIdToProcess.map((change) => {\n        const changedStop = (change.newValue as Stop);\n        if (changedStop) {\n          const stop: Stop = this.stopsStore.get(changedStop.id);\n          const term = stop.text;\n          if (!term || term.length === 0) {\n            return;\n          }\n          const response = stringToLonLat(term, this.stopsFeatureStore.layer.map.projection);\n          let researches: Research[];\n          let isCoord = false;\n          if (response.lonLat) {\n            isCoord = true;\n          }\n          researches = this.searchService.search(term, { searchType: 'Feature' });\n          this.cancelSearch();\n          const requests$ = researches.map(res => res.request\n            .pipe(map((results: SearchResult[]) => results.filter(r =>\n              isCoord ? r.data.geometry.type === 'Point' && r.data.geometry : r.data.geometry)))\n\n          );\n          this.searchs$$ = requests$.map((request) => {\n            return request.pipe(map((results: SearchResult[]) => results.filter(r =>\n              isCoord ? r.data.geometry.type === 'Point' && r.data.geometry : r.data.geometry)))\n              .subscribe((res: SearchResult[]) => {\n                if (res.length > 0) {\n                  const source = res[0].source;\n                  const meta = res[0].meta;\n                  const results = res.map(r => r.data);\n                  if (!stop.searchProposals) {\n                    stop.searchProposals = [];\n                  }\n                  stop.searchProposals = stop.searchProposals.filter(sp => sp.type === (isCoord ? ProposalType.Coord : ProposalType.Text));\n                  let storedSource = stop.searchProposals.find(sp => sp.source === source);\n                  if (storedSource) {\n                    storedSource.results = results;\n                  } else {\n                    stop.searchProposals.push({\n                      type: isCoord ? ProposalType.Coord : ProposalType.Text,\n                      source,\n                      meta,\n                      results\n                    });\n                  }\n                }\n                this.cdRef.detectChanges();\n              });\n          });\n        }\n      });\n    }\n    this.previousStops = simplifiedStops;\n  }\n\n  private handleStopsFeature() {\n    const stops = this.stopsStore.all();\n    const stopsWithCoordinates = stops.filter(stop => stop.coordinates);\n    stopsWithCoordinates.map(stop => this.addStopOverlay(stop));\n    this.stopsFeatureStore.all().map(\n      (stopFeature: Feature<FeatureWithStopProperties>) => {\n        if (!this.stopsStore.get(stopFeature.properties.id)) {\n          this.stopsFeatureStore.delete(stopFeature);\n        }\n      });\n    const stopsWithoutCoordinates = stops.filter(stop => !stop.coordinates);\n    stopsWithoutCoordinates.map(stop => {\n      const stopFeature = this.stopsFeatureStore.get(stop.id);\n      if (stopFeature) {\n        this.stopsFeatureStore.delete(stopFeature);\n      }\n    });\n  }\n\n  private getRoutes(isOverview: boolean = false) {\n    const stopsWithCoordinates = this.stopsStore.view\n      .all()\n      .filter(stop => stop.coordinates);\n    if (stopsWithCoordinates.length < 2) {\n      this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n      return;\n    }\n\n    const roundedCoordinates = stopsWithCoordinates.map((stop) => {\n      const roundedCoord = roundCoordTo(stop.coordinates, this.coordRoundedDecimals);\n      return roundedCoord;\n    });\n    const overviewDirectionsOptions: DirectionOptions = {\n      overview: true,\n      steps: false,\n      alternatives: false,\n      continue_straight: false\n    };\n    this.routesQueries$$.map((u) => u.unsubscribe());\n    const routeResponse = this.directionsService.route(\n      roundedCoordinates,\n      isOverview ? overviewDirectionsOptions : undefined\n    );\n    if (routeResponse) {\n      routeResponse.map(res =>\n        this.routesQueries$$.push(\n          res.subscribe(directions => {\n            this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());\n            directions.map(direction =>\n              addDirectionToRoutesFeatureStore(\n                this.routesFeatureStore,\n                direction,\n                this.projection,\n                direction === directions[0] ? true : false)\n            );\n          })\n        )\n      );\n    }\n  }\n\n  public addStopOverlay(stop: Stop) {\n    addStopToStopsFeatureStore(stop, this.stopsStore, this.stopsFeatureStore, this.projection, this.languageService);\n  }\n}\n","<igo-directions-buttons [contextUri]=\"contextUri\" [zoomToActiveRoute$]=\"zoomToActiveRoute$\" [routesFeatureStore]=\"routesFeatureStore\" [stopsStore]=\"stopsStore\"></igo-directions-buttons>\n\n<igo-directions-inputs (stopInputHasFocus)=\"onStopInputHasFocusChange($event)\" [coordRoundedDecimals]=\"coordRoundedDecimals\" [projection]=\"projection\" [stopsFeatureStore]=\"stopsFeatureStore\" [stopsStore]=\"stopsStore\" [debounce]=\"debounce\" [length]=\"length\"></igo-directions-inputs>\n<br>\n<igo-directions-results [stepFeatureStore]=\"stepFeatureStore\" [routesFeatureStore]=\"routesFeatureStore\"></igo-directions-results>","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { provideDirectionsSourceService } from './shared/directions-source.service';\nimport { DragDropModule } from '@angular/cdk/drag-drop';\nimport { DirectionsInputsComponent } from './directions-inputs/directions-inputs.component';\nimport { DirectionsComponent } from './directions.component';\nimport { DirectionsButtonsComponent } from './directions-buttons/directions-buttons.component';\nimport { DirectionsResultsComponent } from './directions-results/directions-results.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    DragDropModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatListModule,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatOptionModule,\n    MatSelectModule,\n    MatTooltipModule,\n    MatAutocompleteModule,\n    IgoLanguageModule\n  ],\n  exports: [\n    DirectionsComponent,\n    DirectionsInputsComponent,\n    DirectionsButtonsComponent,\n    DirectionsResultsComponent\n  ],\n  declarations: [\n     DirectionsComponent,\n    DirectionsInputsComponent,\n    DirectionsButtonsComponent,\n    DirectionsResultsComponent\n  ],\n  providers: [provideDirectionsSourceService()]\n})\nexport class IgoDirectionsModule {\n  static forRoot(): ModuleWithProviders<IgoDirectionsModule> {\n    return {\n      ngModule: IgoDirectionsModule\n    };\n  }\n}\n","import { SearchSource } from './sources/source';\nimport { SearchSourceService } from './search-source.service';\n\n/**\n * Search source factory\n * @ignore\n */\nexport function searchSourceServiceFactory(sources: SearchSource[]) {\n  return new SearchSourceService(sources);\n}\n\n/**\n * Function that returns a provider for the SearchSource service\n */\nexport function provideSearchSourceService() {\n  return {\n    provide: SearchSourceService,\n    useFactory: searchSourceServiceFactory,\n    deps: [SearchSource]\n  };\n}\n","import { Injectable, Inject, Injector } from '@angular/core';\nimport { HttpClient, HttpParams, HttpParameterCodec } from '@angular/common/http';\n\nimport { Observable, of, BehaviorSubject } from 'rxjs';\nimport { map, catchError } from 'rxjs/operators';\n\nimport { AuthService } from '@igo2/auth';\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport pointOnFeature from '@turf/point-on-feature';\n\nimport { FEATURE, Feature } from '../../../feature';\nimport { GoogleLinks } from './../../../utils/googleLinks';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch, ReverseSearch } from './source';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './source.interfaces';\nimport {\n  IChercheData,\n  IChercheResponse,\n  IChercheReverseData,\n  IChercheReverseResponse\n} from './icherche.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class IChercheSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n\n// Fix the \"+\" is replaced with space \" \" in a query string\n// https://github.com/angular/angular/issues/11058\nexport class IgoHttpParameterCodec implements HttpParameterCodec {\n  encodeKey(key: string): string {\n    return encodeURIComponent(key);\n  }\n\n  encodeValue(value: string): string {\n    return encodeURIComponent(value);\n  }\n\n  decodeKey(key: string): string {\n    return decodeURIComponent(key);\n  }\n\n  decodeValue(value: string): string {\n    return decodeURIComponent(value);\n  }\n}\n\n/**\n * ICherche search source\n */\n@Injectable()\nexport class IChercheSearchSource extends SearchSource implements TextSearch {\n  static id = 'icherche';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  private hashtagsLieuxToKeep = [];\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    @Inject(IChercheSearchResultFormatter)\n    private formatter: IChercheSearchResultFormatter,\n    injector: Injector\n  ) {\n    super(options, storageService);\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(this.languageService.translate.instant(this.options.title));\n    });\n  }\n\n  getId(): string {\n    return IChercheSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n\n    const types = this.options.params?.type\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n        : [\n            'adresses',\n            'codes-postaux',\n            'routes',\n            'intersections',\n            'municipalites',\n            'mrc',\n            'regadmin',\n            'lieux'\n          ];\n\n    return {\n      title: 'igo.geo.search.icherche.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/icherche',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1,\n              hashtags: ['adresse']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldAddress',\n              value: 'anciennes-adresses',\n              enabled: types.indexOf('anciennes-adresses') !== -1,\n              hashtags: ['anciennes-adresses']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.oldCity',\n              value: 'anciennes-municipalites',\n              enabled: types.indexOf('anciennes-municipalites') !== -1,\n              hashtags: ['anciennes-municipalites']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cn',\n              value: 'bornes-cn',\n              enabled: types.indexOf('bornes-cn') !== -1,\n              hashtags: ['borne', 'bornes', 'cn']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.sumi',\n              value: 'bornes-sumi',\n              enabled: types.indexOf('bornes-sumi') !== -1,\n              hashtags: ['borne', 'bornes', 'sumi']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cadastre',\n              value: 'cadastre',\n              enabled: types.indexOf('cadastre') !== -1,\n              hashtags: ['cadastre']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.postalCode',\n              value: 'codes-postaux',\n              enabled: types.indexOf('codes-postaux') !== -1,\n              hashtags: ['code-postal']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.entreprise',\n              value: 'entreprises',\n              enabled: types.indexOf('entreprises') !== -1,\n              available: false,\n              hashtags: ['entreprise']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.cycleStop',\n              value: 'haltes_cyclables',\n              enabled: types.indexOf('haltes_cyclables') !== -1,\n              hashtags: ['haltevelo','haltes_cyclables']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.restArea',\n              value: 'haltes_routieres',\n              enabled: types.indexOf('haltes_routieres') !== -1,\n              hashtags: ['halteroute','haltes_routieres']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.hq',\n              value: 'hq',\n              enabled: types.indexOf('hq') !== -1,\n              hashtags: ['hq']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.intersection',\n              value: 'intersections',\n              enabled: types.indexOf('intersections') !== -1,\n              hashtags: ['intersection', '+']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.place',\n              value: 'lieux',\n              enabled: types.indexOf('lieux') !== -1,\n              hashtags: ['lieu']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1,\n              hashtags: ['mrc']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1,\n              hashtags: ['municipalit', 'mun']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1,\n              hashtags: ['rgion-administrative', 'regadmin']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.gcc',\n              value: 'bornes-gcc',\n              enabled: types.indexOf('bornes-gcc') !== -1,\n              hashtags: ['borne', 'bornes', 'repre', 'gcc', 'ccg']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.km',\n              value: 'bornes-km',\n              enabled: types.indexOf('bornes-km') !== -1,\n              hashtags: ['borne', 'bornes', 'repre', 'km']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              hashtags: ['route']\n            },\n            {\n              title: 'igo.geo.search.icherche.type.exit',\n              value: 'sorties-autoroute',\n              enabled: types.indexOf('sorties-autoroute') !== -1,\n              hashtags: ['sortie', 'sorties', 'exit']\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'ecmax',\n          name: 'ecmax',\n          values: [\n            {\n              title: '10 %',\n              value: 10,\n              enabled: ecmax === 10\n            },\n            {\n              title: '30 %',\n              value: 30,\n              enabled: ecmax === 30 || !ecmax\n            },\n            {\n              title: '50 %',\n              value: 50,\n              enabled: ecmax === 50\n            },\n            {\n              title: '75 %',\n              value: 75,\n              enabled: ecmax === 75\n            },\n            {\n              title: '100 %',\n              value: 100,\n              enabled: ecmax === 100\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'loc',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.map',\n              value: 'true',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.icherche.restrictExtent.quebec',\n              value: 'false',\n              enabled: true\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(term, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n\n    return this.http.get(`${this.searchUrl}/geocode`, { params }).pipe(\n      map((response: IChercheResponse) => this.extractResults(response, term)),\n      catchError((err) => {\n        err.error.toDisplay = true;\n        err.error.title = this.languageService.translate.instant(\n          this.getDefaultOptions().title\n        );\n        throw err;\n      })\n    );\n  }\n\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          const regex = new RegExp(`^${v.value}(\\\\.|$)`);\n          const typesMatched = types.filter((value) => regex.test(value));\n          v.available = typesMatched.length > 0;\n          if (v.value === 'lieux') {\n            this.hashtagsLieuxToKeep = [\n              ...(new Set(\n                typesMatched\n                  .map((t) => t.split('.'))\n                  .reduce((a, b) => a.concat(b))\n                  .filter((t) => t !== 'lieux')\n              ) as any)\n            ];\n          }\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    const queryParams: any = Object.assign(\n      {\n        geometry: true,\n        bbox: true,\n        icon: true,\n        type:\n          'adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi'\n      },\n      this.params,\n      this.computeOptionsParam(term, options || {}).params,\n      {\n        q: this.computeTerm(term),\n        page: options.page\n      }\n    );\n\n    if (queryParams.loc === 'true') {\n      const [xMin, yMin, xMax, yMax] = options.extent;\n      queryParams.loc = `${xMin},${yMin};${xMax},${yMin};${xMax},${yMax};${xMin},${yMax};${xMin},${yMin}`;\n    } else if (queryParams.loc === 'false') {\n      delete queryParams.loc;\n    }\n\n    if (/#[A-Za-z]+/.test(queryParams.q)) {\n      queryParams.type = 'lieux';\n    }\n\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(queryParams),\n      encoder: new IgoHttpParameterCodec()\n    });\n  }\n\n  private extractResults(response: IChercheResponse, term: string): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheData) => {\n      return this.formatter.formatResult(this.dataToResult(data, term, response));\n    });\n  }\n\n  private dataToResult(\n    data: IChercheData,\n    term: string,\n    response?: IChercheResponse\n  ): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.highlight.title || data.properties.nom;\n    const subtitleHtml = data.highlight.title2\n      ? ' <small> ' + data.highlight.title2 + '</small>'\n      : '';\n    const subtitleHtml2 = data.highlight.title3\n      ? '<br><small> ' + data.highlight.title3 + '</small>'\n      : '';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml + subtitleHtml2,\n        icon: data.icon || 'map-marker',\n        score: data.score || computeTermSimilarity(term.trim(), data.properties.nom),\n        nextPage:\n          response.features.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheSearchSource.propertiesBlacklist\n    );\n\n    if (!data.geometry) {\n      return Object.assign({ type: data.index }, properties);\n    }\n\n    const googleLinksProperties: {\n      GoogleMaps: string;\n      GoogleStreetView?: string;\n    } = {\n      GoogleMaps: ''\n    };\n\n    let googleMaps;\n    if (data.geometry.type === 'Point') {\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        data.geometry.coordinates[0],\n        data.geometry.coordinates[1]\n      );\n    } else {\n      const point = pointOnFeature(data.geometry);\n      googleMaps = GoogleLinks.getGoogleMapsCoordLink(\n        point.geometry.coordinates[0],\n        point.geometry.coordinates[1]\n      );\n    }\n\n    let googleMapsNom;\n    if (data.index === 'routes') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + data.properties.municipalite\n      );\n    } else if (data.index === 'municipalites') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ', ' + 'ville'\n      );\n    } else if (data.index === 'mrc') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        'mrc+' + data.properties.nom\n      );\n    } else if (data.index === 'regadmin') {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom + ',+QC'\n      );\n    } else {\n      googleMapsNom = GoogleLinks.getGoogleMapsNameLink(\n        data.properties.nom || data.highlight.title\n      );\n    }\n\n    googleLinksProperties.GoogleMaps =\n      '<a href=' +\n      googleMaps +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByCoord') +\n      '</a> <br /> <a href=' +\n      googleMapsNom +\n      ' target=\"_blank\">' +\n      this.languageService.translate.instant('igo.geo.searchByName') +\n      '</a>';\n\n    if (data.geometry.type === 'Point') {\n      googleLinksProperties.GoogleStreetView = GoogleLinks.getGoogleStreetViewLink(\n        data.geometry.coordinates[0],\n        data.geometry.coordinates[1]\n      );\n    }\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(\n      { type: data.index },\n      properties,\n      googleLinksProperties,\n      routing\n    );\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    // Keep hashtags for \"lieux\"\n    const hashtags = term.match(/(#[A-Za-z]+)/g) || [];\n    let keep = false;\n    keep = hashtags.some((hashtag) => {\n      const hashtagKey = hashtag.substring(1);\n      return this.hashtagsLieuxToKeep.some(\n        (h) =>\n          h\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '') ===\n          hashtagKey\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '')\n      );\n    });\n\n    if (!keep) {\n      term = term.replace(/(#[A-Za-z]+)/g, '');\n    }\n\n    return term.replace(/[^\\w- !\\-\\+\\(\\)\\.\\/,'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n}\n\n/**\n * IChercheReverse search source\n */\n@Injectable()\nexport class IChercheReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'icherchereverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions,\n    injector: Injector,\n  ) {\n    super(options, storageService);\n\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(this.languageService.translate.instant(this.options.title));\n    });\n\n    const authService = injector.get(AuthService);\n    if (this.settings.length) {\n      if (!authService) {\n        this.getAllowedTypes();\n      } else {\n        authService.authenticate$.subscribe(() => {\n          this.getAllowedTypes();\n        });\n      }\n    }\n  }\n\n  getId(): string {\n    return IChercheReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return IChercheReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    const types =\n      this.options.params && this.options.params.type\n        ? this.options.params.type.replace(/\\s/g, '').toLowerCase().split(',')\n        : ['adresses', 'municipalites', 'mrc', 'regadmin'];\n\n    return {\n      title: 'igo.geo.search.ichercheReverse.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/terrapi',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.icherche.type.address',\n              value: 'adresses',\n              enabled: types.indexOf('adresses') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.road',\n              value: 'routes',\n              enabled: types.indexOf('routes') !== -1,\n              available: false\n            },\n            {\n              title: 'igo.geo.search.icherche.type.district',\n              value: 'arrondissements',\n              enabled: types.indexOf('arrondissements') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.city',\n              value: 'municipalites',\n              enabled: types.indexOf('municipalites') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.mrc',\n              value: 'mrc',\n              enabled: types.indexOf('mrc') !== -1\n            },\n            {\n              title: 'igo.geo.search.icherche.type.regadmin',\n              value: 'regadmin',\n              enabled: types.indexOf('regadmin') !== -1\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'radius',\n          name: 'bufferInput',\n          values: [\n            {\n              title: '100 m',\n              value: 100,\n              enabled: !this.options.distance || this.options.distance === 100\n            },\n            {\n              title: '500 m',\n              value: 500,\n              enabled: this.options.distance === 500\n            },\n            {\n              title: '1 km',\n              value: 1000,\n              enabled: this.options.distance === 1000\n            },\n            {\n              title: '2 km',\n              value: 2000,\n              enabled: this.options.distance === 2000\n            },\n            {\n              title: '5 km',\n              value: 5000,\n              enabled: this.options.distance === 5000\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n    if (!params.get('type').length) {\n      return of([]);\n    }\n    return this.http.get(`${this.searchUrl}/locate`, { params }).pipe(\n      map((response: IChercheReverseResponse) => {\n        return this.extractResults(response);\n      })\n    );\n  }\n\n  private getAllowedTypes() {\n    return this.http\n      .get(`${this.searchUrl}/types`)\n      .subscribe((types: string[]) => {\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        typeSetting.values.forEach((v) => {\n          v.available = types.indexOf(v.value as string) > -1;\n        });\n        this.setParamFromSetting(typeSetting, false);\n      });\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    if (options.distance || this.options.distance) {\n      options.params = Object.assign(options.params || {}, {\n        bufferInput: options.distance || this.options.distance\n      });\n    }\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          loc: lonLat.join(','),\n          sort: 'distance',\n          geometry: true,\n          icon: true\n        },\n        options.params || {},\n        this.params\n      )\n    });\n  }\n\n  private extractResults(\n    response: IChercheReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: IChercheReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private getSubtitle(data: IChercheReverseData) {\n    if (!this.settings.length) {\n      return '';\n    }\n    let subtitle = '';\n    switch (data.properties.type) {\n      case 'arrondissements':\n        subtitle = data.properties.municipalite + ' (Arrondissement)';\n        break;\n      default:\n        const typeSetting = this.settings.find((s) => s.name === 'type');\n        const type = typeSetting.values.find(\n          (t) => t.value === data.properties.type\n        );\n        if (type) {\n          subtitle = this.languageService.translate.instant(type.title);\n        }\n    }\n    return subtitle;\n  }\n\n  private dataToResult(data: IChercheReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), properties.type, properties.code].join('.');\n\n    const titleHtml = data.properties.nom;\n    const subtitleHtml = ' <small> ' + this.getSubtitle(data) + '</small>';\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.properties.nom\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.nom,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.icon || 'map-marker',\n        pointerSummaryTitle: this.getSubtitle(data)+ ': ' + data.properties.nom\n      }\n    };\n  }\n\n  private computeProperties(data: IChercheReverseData): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      IChercheReverseSearchSource.propertiesBlacklist\n    );\n\n    const routing: {\n      Route: string;\n    } = {\n      Route:\n        '<span class=\"routing\"> <u>' +\n        this.languageService.translate.instant('igo.geo.seeRouting') +\n        '</u> </span>'\n    };\n\n    return Object.assign(properties, routing);\n  }\n\n  private computeExtent(\n    data: IChercheReverseData\n  ): [number, number, number, number] | undefined {\n    return data.bbox\n      ? [data.bbox[0], data.bbox[2], data.bbox[1], data.bbox[3]]\n      : undefined;\n  }\n}\n","import { Injector } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  IChercheSearchSource,\n  IChercheSearchResultFormatter,\n  IChercheReverseSearchSource\n} from './icherche';\n\n/**\n * ICherche search result formatter factory\n * @ignore\n */\nexport function defaultIChercheSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new IChercheSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ICherche search result formatter\n */\nexport function provideDefaultIChercheSearchResultFormatter() {\n  return {\n    provide: IChercheSearchResultFormatter,\n    useFactory: defaultIChercheSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ICherche search source factory\n * @ignore\n */\nexport function ichercheSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: IChercheSearchResultFormatter,\n  injector: Injector\n) {\n  return new IChercheSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheSearchSource.id}`),\n    formatter,\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the ICherche search source\n */\nexport function provideIChercheSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheSearchSourceFactory,\n    multi: true,\n    deps: [\n      HttpClient,\n      LanguageService,\n      StorageService,\n      ConfigService,\n      IChercheSearchResultFormatter,\n      Injector\n    ]\n  };\n}\n\n/**\n * IChercheReverse search source factory\n * @ignore\n */\nexport function ichercheReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  injector: Injector\n) {\n  return new IChercheReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${IChercheReverseSearchSource.id}`),\n    injector\n  );\n}\n\n/**\n * Function that returns a provider for the IChercheReverse search source\n */\nexport function provideIChercheReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ichercheReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, Injector]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport * as olproj from 'ol/proj';\nimport { fromCircle } from 'ol/geom/Polygon';\nimport OlCircle from 'ol/geom/Circle';\nimport * as olformat from 'ol/format';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, ReverseSearch } from './source';\nimport { SearchSourceOptions, ReverseSearchOptions } from './source.interfaces';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { GoogleLinks } from '../../../utils/googleLinks';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { lonLatConversion, roundCoordTo, convertDDToDMS } from '../../../map/shared/map.utils';\nimport { OsmLinks } from '../../../utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class CoordinatesSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(result: SearchResult<Feature>): SearchResult<Feature> {\n    return result;\n  }\n}\n/**\n * CoordinatesReverse search source\n */\n@Injectable()\nexport class CoordinatesReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'coordinatesreverse';\n  static type = FEATURE;\n\n  private projections;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    @Inject('options') options: SearchSourceOptions,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('projections') projections: Projection[]\n  ) {\n    super(options, storageService);\n    this.projections = projections;\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(this.languageService.translate.instant(this.options.title));\n    });\n  }\n\n  getId(): string {\n    return CoordinatesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return CoordinatesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'igo.geo.search.coordinates.name',\n      order: 1,\n      showInSettings: false\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param options options of ReverseSearchOptions (distance, conf, zoom, params)\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions,\n    reverseSearchCoordsFormatEnabled?: boolean\n  ): Observable<SearchResult<Feature>[]> {\n    return of([this.dataToResult(lonLat, options, reverseSearchCoordsFormatEnabled)]);\n  }\n\n  private dataToResult(data: [number, number], options: ReverseSearchOptions,\n    reverseSearchCoordsFormatEnabled: boolean): SearchResult<Feature> {\n\n    const dataDMS = convertDDToDMS(data);\n    const convertedCoord = lonLatConversion(data, this.projections);\n    const coords = convertedCoord.reduce((obj, item) => (\n      obj[item.alias] = item.igo2CoordFormat, obj), {});\n\n    const roundedCoordString = (!reverseSearchCoordsFormatEnabled) ?\n      roundCoordTo(data, 6).join(', ') : roundCoordTo(data, 6).reverse().join(', ');\n\n    const roundedCoordStringDMS = (!reverseSearchCoordsFormatEnabled) ?\n      dataDMS.join(', ') : dataDMS.reverse().join(', ');\n\n    let geometry: FeatureGeometry = {\n      type: 'Point',\n      coordinates: [data[0], data[1]]\n    };\n\n    const properties = {};\n    let subtitleHtml = '';\n    if (options.distance) {\n      const radiusKey = this.languageService.translate.instant('igo.geo.search.coordinates.radius');\n      properties[radiusKey] = options.distance;\n      subtitleHtml = '<br><small>Rayon: ' + options.distance + ' m</small>';\n\n      // Create polygon\n      const center = olproj.transform([data[0], data[1]], 'EPSG:4326', 'EPSG:3857');\n      const circleGeometry = new OlCircle(center, options.distance);\n      const polygonGeometry = fromCircle(circleGeometry);\n      const writer = new olformat.GeoJSON();\n      geometry = JSON.parse(writer.writeGeometry(polygonGeometry.transform('EPSG:3857', 'EPSG:4326')));\n    }\n\n    if (options.conf) {\n      const confKey = this.languageService.translate.instant('igo.geo.search.coordinates.conf');\n      properties[confKey] = options.conf;\n      subtitleHtml += subtitleHtml === '' ? '<br>' : '<small> - </small>';\n      subtitleHtml += '<small>Confiance: ' + options.conf + '%</small>';\n    }\n\n    const coordKey = (!reverseSearchCoordsFormatEnabled) ?\n      this.languageService.translate.instant('igo.geo.search.coordinates.coord'):\n      this.languageService.translate.instant('igo.geo.search.coordinates.reversedCoord');\n    properties[coordKey] = roundedCoordString;\n\n    const coordKeyDMS = (!reverseSearchCoordsFormatEnabled) ?\n     this.languageService.translate.instant('igo.geo.search.coordinates.coordDMS'):\n     this.languageService.translate.instant('igo.geo.search.coordinates.reversedCoordDMS');\n    properties[coordKeyDMS] = roundedCoordStringDMS;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent: undefined,\n        properties: Object.assign(\n          properties,\n          coords,\n          {\n            GoogleMaps: GoogleLinks.getGoogleMapsCoordLink(data[0], data[1]),\n            GoogleStreetView: GoogleLinks.getGoogleStreetViewLink(\n              data[0],\n              data[1]\n            ),\n            OpenStreetMap: OsmLinks.getOpenStreetMapLink(data[0], data[1], 14),\n            Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n          }\n        ),\n        meta: {\n          id: data[0].toString() + ',' + data[1].toString(),\n          title: roundedCoordString\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id: data[0].toString() + ',' + data[1].toString(),\n        title: roundedCoordString,\n        titleHtml: roundedCoordString + subtitleHtml,\n        icon: 'map-marker',\n        score: 100, // every coord exists\n      }\n    };\n  }\n}\n","import { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  CoordinatesReverseSearchSource,\n  CoordinatesSearchResultFormatter\n} from './coordinates';\nimport { Projection } from '../../../map/shared/projection.interfaces';\nimport { ProjectionService } from '../../../map/shared/projection.service';\n\n/**\n * ICherche search result formatter factory\n * @ignore\n */\nexport function defaultCoordinatesSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new CoordinatesSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ICherche search result formatter\n */\nexport function provideDefaultCoordinatesSearchResultFormatter() {\n  return {\n    provide: CoordinatesSearchResultFormatter,\n    useFactory: defaultCoordinatesSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * CoordinatesReverse search source factory\n * @ignore\n */\nexport function CoordinatesReverseSearchSourceFactory(\n  config: ConfigService,\n  languageService: LanguageService,\n  storageService: StorageService,\n  _projectionService: ProjectionService\n) {\n  return new CoordinatesReverseSearchSource(\n    config.getConfig(`searchSources.${CoordinatesReverseSearchSource.id}`),\n    languageService,\n    storageService,\n    (config.getConfig('projections') as Projection[]) || []\n  );\n}\n\n/**\n * Function that returns a provider for the IChercheReverse search source\n */\nexport function provideCoordinatesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: CoordinatesReverseSearchSourceFactory,\n    multi: true,\n    deps: [ConfigService, LanguageService, StorageService, ProjectionService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, BehaviorSubject, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { ObjectUtils } from '@igo2/utils';\n\nimport { getResolutionFromScale } from '../../../map/shared/map.utils';\nimport { LAYER } from '../../../layer';\nimport { QueryableDataSourceOptions, QueryFormat } from '../../../query';\nimport { QueryHtmlTarget } from './../../../query/shared/query.enums';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { TextSearchOptions } from './source.interfaces';\nimport {\n  ILayerSearchSourceOptions,\n  ILayerData,\n  ILayerItemResponse,\n  ILayerServiceResponse,\n  ILayerDataSource\n} from './ilayer.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n@Injectable()\nexport class ILayerSearchResultFormatter {\n  constructor(private languageService: LanguageService) {}\n\n  formatResult(data: ILayerData): ILayerData {\n    const allowedKey = [\n      'title',\n      'abstract',\n      'groupTitle',\n      'metadataUrl',\n      'downloadUrl',\n      'urlInfo',\n      'name'\n    ];\n\n    const property = Object.entries(data.properties)\n      .filter(([key]) => allowedKey.indexOf(key) !== -1)\n      .reduce((out: { [key: string]: any }, entries: [string, any]) => {\n        const [key, value] = entries;\n        let newKey;\n        try {\n          newKey = this.languageService.translate.instant(\n            'igo.geo.search.ilayer.properties.' + key\n          );\n        } catch (e) {\n          newKey = key;\n        }\n        out[newKey] = value ? value : '';\n        return out;\n      }, {});\n\n    const dataR = Object.assign({}, data);\n    dataR.properties = property as ILayerDataSource;\n\n    return dataR;\n  }\n}\n\n/**\n * ILayer search source\n */\n@Injectable()\nexport class ILayerSearchSource extends SearchSource implements TextSearch {\n  static id = 'ilayer';\n  static type = LAYER;\n\n  title$: BehaviorSubject<string> = new BehaviorSubject<string>('');\n\n  get title(): string {\n    return this.title$.getValue();\n  }\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: ILayerSearchSourceOptions,\n    @Inject(ILayerSearchResultFormatter)\n    private formatter: ILayerSearchResultFormatter\n  ) {\n    super(options, storageService);\n    this.languageService.language$.subscribe(() => {\n      this.title$.next(this.languageService.translate.instant(this.options.title));\n    });\n  }\n\n  getId(): string {\n    return ILayerSearchSource.id;\n  }\n\n  getType(): string {\n    return ILayerSearchSource.type;\n  }\n\n  protected getDefaultOptions(): ILayerSearchSourceOptions {\n    const limit =\n      this.options.params && this.options.params.limit\n        ? Number(this.options.params.limit)\n        : undefined;\n    const ecmax =\n      this.options.params && this.options.params.ecmax\n        ? Number(this.options.params.ecmax)\n        : undefined;\n    return {\n      title: 'igo.geo.search.ilayer.name',\n      searchUrl: 'https://geoegl.msp.gouv.qc.ca/apis/layers/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'type',\n          values: [\n            {\n              title: 'igo.geo.search.ilayer.type.layer',\n              value: 'layer',\n              enabled: true,\n              hashtags: ['layer', 'layers', 'couche', 'couches']\n            },\n            {\n              title: 'igo.geo.search.ilayer.type.groupLayer',\n              value: 'group',\n              enabled: false,\n              hashtags: ['gr-layer', 'gr-layers', 'gr-couche', 'gr-couches']\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '1',\n              value: 1,\n              enabled: limit === 1\n            },\n            {\n              title: '5',\n              value: 5,\n              enabled: limit === 5 || !limit\n            },\n            {\n              title: '10',\n              value: 10,\n              enabled: limit === 10\n            },\n            {\n              title: '25',\n              value: 25,\n              enabled: limit === 25\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: limit === 50\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'ecmax',\n          name: 'ecmax',\n          values: [\n            {\n              title: '10 %',\n              value: 10,\n              enabled: ecmax === 10\n            },\n            {\n              title: '30 %',\n              value: 30,\n              enabled: ecmax === 30\n            },\n            {\n              title: '50 %',\n              value: 50,\n              enabled: ecmax === 50 || !ecmax\n            },\n            {\n              title: '75 %',\n              value: 75,\n              enabled: ecmax === 75\n            },\n            {\n              title: '100 %',\n              value: 100,\n              enabled: ecmax === 100\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a layer by name or keyword\n   * @param term Layer name or keyword\n   * @returns Observable of <SearchResult<LayerOptions>[]\n   */\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<ILayerItemResponse>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q') || !params.get('type')) {\n      return of([]);\n    }\n    this.options.params.page = params.get('page') || '1';\n\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(\n        map((response: ILayerServiceResponse) => this.extractResults(response, term))\n      );\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: ObjectUtils.removeUndefined(\n        Object.assign(\n          {\n            q: this.computeTerm(term)\n          },\n          this.params,\n          this.computeOptionsParam(term, options || {}).params,\n          {\n            page: options.page\n          }\n        )\n      )\n    });\n  }\n\n  /**\n   * Remove hashtag from query\n   * @param term Query with hashtag\n   */\n  private computeTerm(term: string): string {\n    return term.replace(/(#[^\\s]*)/g, '').replace(/[^\\w- !\\-\\(\\),'#]+/g, '');\n  }\n\n  /**\n   * Add hashtag to param if valid\n   * @param term Query with hashtag\n   * @param options TextSearchOptions\n   */\n  private computeOptionsParam(\n    term: string,\n    options: TextSearchOptions\n  ): TextSearchOptions {\n    const hashtags = super.getHashtagsValid(term, 'type');\n    if (hashtags) {\n      options.params = Object.assign(options.params || {}, {\n        type: hashtags.join(',')\n      });\n    }\n\n    return options;\n  }\n\n  private extractResults(\n    response: ILayerServiceResponse, term: string\n  ): SearchResult<ILayerItemResponse>[] {\n    return response.items.map((data: ILayerData) =>\n    this.dataToResult(data, term, response)\n    );\n  }\n\n  private dataToResult(\n    data: ILayerData,\n    term: string,\n    response?: ILayerServiceResponse\n  ): SearchResult<ILayerItemResponse> {\n    const layerOptions = this.computeLayerOptions(data);\n\n    const titleHtml = data.highlight.title || data.properties.title;\n    const groupTitle = data.highlight.groupTitle || data.properties.groupTitle;\n    const subtitleHtml = groupTitle\n      ? ' <small style=\"color: #6f6969\"> ' + groupTitle + '</small>'\n      : '';\n\n    return {\n      source: this,\n      meta: {\n        dataType: LAYER,\n        id: [this.getId(), data.properties.id].join('.'),\n        title: data.properties.title,\n        titleHtml: titleHtml + subtitleHtml,\n        icon: data.properties.type === 'Layer' ? 'layers' : 'map',\n        score: data.score || computeTermSimilarity(term.trim(), data.properties.name),\n        nextPage:\n          response.items.length % +this.options.params.limit === 0 &&\n          +this.options.params.page < 10\n      },\n      data: layerOptions\n    };\n  }\n\n  private computeLayerOptions(data: ILayerData): ILayerItemResponse {\n    const url = data.properties.url;\n    const queryParams: QueryableDataSourceOptions = this.extractQueryParamsFromSourceUrl(\n      url\n    );\n    return ObjectUtils.removeUndefined({\n      sourceOptions: {\n        id: data.properties.id,\n        type: data.properties.format,\n        url,\n        queryFormat: queryParams.queryFormat,\n        queryHtmlTarget: queryParams.queryHtmlTarget,\n        params: data.properties.format === 'wms' ? {LAYERS: data.properties.name} : undefined,\n        layer: data.properties.format === 'wms' ? undefined : data.properties.name,\n        optionsFromCapabilities: true,\n        crossOrigin: 'anonymous'\n      },\n      title: data.properties.title,\n      maxResolution: getResolutionFromScale(\n        Number(data.properties.maxScaleDenom)\n      ),\n      minResolution: getResolutionFromScale(\n        Number(data.properties.minScaleDenom)\n      ),\n      metadata: {\n        url: data.properties.metadataUrl,\n        extern: data.properties.metadataUrl ? true : undefined,\n        abstract: data.properties.abstract || undefined\n      },\n      properties: this.formatter.formatResult(data).properties\n    });\n  }\n\n  private extractQueryParamsFromSourceUrl(\n    url: string\n  ): { queryFormat: QueryFormat; queryHtmlTarget: QueryHtmlTarget } {\n    let queryFormat;\n    let queryHtmlTarget;\n    const formatOpt = (this.options as ILayerSearchSourceOptions).queryFormat;\n    if (formatOpt) {\n      for (const key of Object.keys(formatOpt)) {\n        const value = formatOpt[key];\n        if (value === '*') {\n          queryFormat = QueryFormat[key.toUpperCase()];\n          break;\n        }\n\n        const urls = ((value as any) as { urls: string[] }).urls;\n        if (Array.isArray(urls)) {\n          urls.forEach(urlOpt => {\n            if (url.indexOf(urlOpt) !== -1) {\n              queryFormat = QueryFormat[key.toUpperCase()];\n            }\n          });\n          break;\n        }\n      }\n\n      if (\n        queryFormat === QueryFormat.HTML ||\n        queryFormat === QueryFormat.HTMLGML2\n      ) {\n        queryHtmlTarget = 'iframe';\n      }\n    }\n\n    return {\n      queryFormat,\n      queryHtmlTarget\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { ILayerSearchSource, ILayerSearchResultFormatter } from './ilayer';\n\n/**\n * ILayer search result formatter factory\n * @ignore\n */\nexport function ilayerSearchResultFormatterFactory(\n  languageService: LanguageService\n) {\n  return new ILayerSearchResultFormatter(languageService);\n}\n\n/**\n * Function that returns a provider for the ILayer search result formatter\n */\nexport function provideILayerSearchResultFormatter() {\n  return {\n    provide: ILayerSearchResultFormatter,\n    useFactory: ilayerSearchResultFormatterFactory,\n    deps: [LanguageService]\n  };\n}\n\n/**\n * ILayer search source factory\n * @ignore\n */\nexport function ilayerSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService,\n  formatter: ILayerSearchResultFormatter\n) {\n  return new ILayerSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${ILayerSearchSource.id}`),\n    formatter\n  );\n}\n\n/**\n * Function that returns a provider for the ILayer search source\n */\nexport function provideILayerSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: ilayerSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService, ILayerSearchResultFormatter]\n  };\n}\n","import { FEATURE } from '../../feature';\nimport { LAYER } from '../../layer';\n\nexport const SEARCH_TYPES = [FEATURE, LAYER];\n","<div class=\"igo-search-selector\">\n  <button\n    mat-icon-button\n    class=\"igo-search-selector-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSelectorMenu\">\n    <mat-icon svgIcon=\"menu-down\"></mat-icon>\n  </button>\n\n  <mat-menu\n    #searchSelectorMenu=\"matMenu\"\n    class=\"no-border-radius\"\n    xPosition=\"before\"\n    yPosition=\"above\">\n    <mat-radio-group\n      class=\"igo-search-selector-radio-group\"\n      [value]=\"searchType$ | async\"\n      (change)=\"onSearchTypeChange($event.value)\">\n      <mat-radio-button *ngFor=\"let searchType of searchTypes\" [value]=\"searchType\">\n        {{getSearchTypeTitle(searchType) | translate}}\n      </mat-radio-button>\n    </mat-radio-group>\n  </mat-menu>\n\n</div>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\n\nimport { SEARCH_TYPES } from '../shared/search.enums';\nimport { SearchSourceService } from '../shared/search-source.service';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-selector',\n  templateUrl: './search-selector.component.html',\n  styleUrls: ['./search-selector.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchSelectorComponent implements OnInit, OnDestroy {\n\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  /**\n   * The search type enabled\n   */\n  @Input()\n  set searchType(value: string) { this.setSearchType(value); }\n  get searchType(): string { return this.searchType$.value; }\n\n  /**\n   * Event emitted when the enabled search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  constructor(private searchSourceService: SearchSourceService) {}\n\n  ngOnInit() {\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n  }\n\n  ngOnDestroy() {\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * Enable the selected search type\n   * @param searchType Search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Get a search type's title. The title\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Search type\n   * @internal\n   */\n  getSearchTypeTitle(searchType: string) {\n    return `igo.geo.search.${searchType.toLowerCase()}.title`;\n  }\n\n  /**\n   * Emit an event and enable the search sources of the given type.\n   * @param searchType Search type\n   */\n  private setSearchType(searchType: string | undefined) {\n    this.searchType$.next(searchType);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchSourceService.enableSourcesByType(searchType);\n    this.searchTypeChange.emit(searchType);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { SearchSelectorComponent } from './search-selector.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatTabsModule,\n    MatCheckboxModule,\n    IgoLanguageModule\n  ],\n  exports: [SearchSelectorComponent],\n  declarations: [SearchSelectorComponent]\n})\nexport class IgoSearchSelectorModule {}\n","<div class=\"igo-search-settings\">\n\n  <button\n    mat-icon-button\n    class=\"igo-search-settings-button\"\n    color=\"primary\"\n    tooltip-position=\"below\"\n    matTooltipShowDelay=\"500\"\n    [matTooltip]=\"'igo.geo.search.menu.tooltip' | translate\"\n    [matMenuTriggerFor]=\"searchSettingsMenu\">\n    <mat-icon svgIcon=\"chevron-down\"></mat-icon>\n  </button>\n  <mat-menu\n    #searchSettingsMenu=\"matMenu\"\n    class=\"no-border-radius\">\n    <div class=\"checkAllButton\" *ngIf=\"getSearchSources().length>4\">\n      <button mat-raised-button\n        (click)=\"checkUncheckAllSources($event)\">{{!searchSourcesAllEnabled  ? ('igo.geo.search.searchSources.unselectAll' | translate): ('igo.geo.search.searchSources.selectAll' | translate)}}</button>\n    </div>\n      <ng-container *ngFor=\"let source of getSearchSources()\">\n        <span class=\"igo-search-settings-search-source\">\n          <mat-checkbox\n            class=\"igo-search-settings-checkbox\"\n            [checked]=\"source.enabled\"\n            [value]=\"source\"\n            (click)=\"$event.stopPropagation()\"\n            (change)=\"onCheckSearchSource($event, source)\">\n          </mat-checkbox>\n          <button *ngIf=\"source.settings.length>0\"\n            [matMenuTriggerFor]=\"sub_menu\"\n            mat-menu-item>{{source.title}}\n          </button>\n          <button\n            mat-menu-item\n            *ngIf=\"source.settings.length===0\">\n            {{source.title}}\n          </button>\n        </span>\n          <mat-menu #sub_menu=\"matMenu\">\n            <ng-container *ngFor=\"let setting of source.settings\">\n              <button\n                  mat-menu-item\n                  [matMenuTriggerFor]=\"test_sub_menu\">\n                {{'igo.geo.search.searchSources.settings.'+ setting.title | translate}}\n              </button>\n              <mat-menu #test_sub_menu=\"matMenu\"\n                [ngSwitch]=\"setting.type\"\n                yPosition=\"above\">\n                <span *ngSwitchCase=\"'radiobutton'\">\n                  <mat-radio-group\n                    class=\"igo-search-settings-radio-group\"\n                    [value]=\"setting\">\n                    <mat-radio-button *ngFor=\"let settingValue of setting.values\"\n                      class=\"mat-typography\"\n                      [value]=\"settingValue\"\n                      [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                      [checked]=\"settingValue.enabled\"\n                      (click)=\"$event.stopPropagation()\"\n                      (change)=\"settingsValueCheckedRadioButton($event, source, setting, settingValue)\">\n                      {{settingValue.title | translate}}\n                    </mat-radio-button>\n                  </mat-radio-group>\n                </span>\n                <span *ngSwitchCase=\"'checkbox'\">\n                  <div class=\"checkAllButton\" *ngIf=\"setting.values.length>3\">\n                    <button mat-raised-button\n                      (click)=\"checkUncheckAll($event, source, setting)\">{{setting.allEnabled || setting.allEnabled === undefined  ? ('igo.geo.search.searchSources.settings.unselectAll' | translate): ('igo.geo.search.searchSources.settings.selectAll' | translate)}}</button>\n                  </div>\n                  <mat-checkbox *ngFor=\"let settingValue of getAvailableValues(setting)\"\n                    class=\"mat-menu-item\"\n                    [style.display]=\"displayBlock\"\n                    [checked]=\"settingValue.enabled\"\n                    [value]=\"setting\"\n                    [matTooltip]=\"getAvailableHashtagsValues(settingValue)\"\n                    (click)=\"$event.stopPropagation()\"\n                    (change)=\"settingsValueCheckedCheckbox($event, source, setting, settingValue)\">\n                    {{settingValue.title | translate}}\n                  </mat-checkbox>\n                </span>\n              </mat-menu>\n            </ng-container>\n          </mat-menu>\n      </ng-container>\n      <span *ngIf=\"hasPointerReverseSearchSource && !isTouchScreen\">\n        <mat-divider></mat-divider>\n        <span class=\"pointer-summary-slide-toggle-container mat-typography\">\n          <mat-slide-toggle class=\"search-option\" (change)=\"changePointerReverseSearch($event)\" tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.search.pointerSearchSummary.tooltip' | translate\"\n            (click)=\"$event.stopPropagation()\" [checked]=\"pointerSummaryEnabled\" [labelPosition]=\"'after'\">\n            {{'igo.geo.search.pointerSearchSummary.title' | translate}}\n          </mat-slide-toggle>\n          <mat-slide-toggle class=\"search-option\" (change)=\"changeSearchResultsGeometry($event)\" tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\" [matTooltip]=\"'igo.geo.search.searchResultsGeometry.tooltip' | translate\"\n            (click)=\"$event.stopPropagation()\" [checked]=\"searchResultsGeometryEnabled\" [labelPosition]=\"'after'\">\n            {{'igo.geo.search.searchResultsGeometry.title' | translate}}\n          </mat-slide-toggle>\n          <mat-slide-toggle class=\"search-option\" (change)=\"reverseSearchCoordsFormat($event)\" tooltip-position=\"below\"\n            matTooltipShowDelay=\"500\"\n            [matTooltip]=\"reverseSearchCoordsFormatEnabled ? ('igo.geo.search.reverseCoordFormat.tooltipLatLon' | translate)\n            : ('igo.geo.search.reverseCoordFormat.tooltipLonLat' | translate)\"\n            (click)=\"$event.stopPropagation()\" [checked]=\"reverseSearchCoordsFormatEnabled\" [labelPosition]=\"'after'\">\n            {{'igo.geo.search.reverseCoordFormat.title' | translate}}\n          </mat-slide-toggle>\n        </span>\n      </span>\n  </mat-menu>\n</div>\n","import { MatCheckboxChange } from '@angular/material/checkbox';\nimport { MatRadioChange } from '@angular/material/radio';\n\nimport {\n  Component,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  OnInit,\n  HostListener,\n  Input\n} from '@angular/core';\n\nimport { SearchSourceService } from '../shared/search-source.service';\nimport { SearchSource } from '../shared/sources/source';\nimport {\n  SearchSourceSettings,\n  SettingOptions\n} from '../shared/sources/source.interfaces';\nimport {\n  sourceCanReverseSearchAsSummary,\n  sourceCanSearch,\n  sourceCanReverseSearch\n} from '../shared/search.utils';\nimport { MediaService, StorageService } from '@igo2/core';\n\n/**\n * This component allows a user to select a search type yo enable. In it's\n * current version, only one search type can be selected at once (radio). If\n * this component were to support more than one search source enabled (checkbox),\n * the searchbar component would require a small change to it's\n * placeholder getter. The search source service already supports having\n * more than one search source enabled.\n */\n@Component({\n  selector: 'igo-search-settings',\n  templateUrl: './search-settings.component.html',\n  styleUrls: ['./search-settings.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchSettingsComponent implements OnInit {\n  public hasPointerReverseSearchSource: boolean = false;\n  public searchSourcesAllEnabled: boolean = false;\n\n  public buffer = [];\n  public lastKeyTime = Date.now();\n\n  public displayBlock = 'block';\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n  @Input() reverseSearchCoordsFormatEnabled: boolean = false;\n\n  /**\n   * Event emitted when the enabled search source changes\n   */\n  @Output() searchSourceChange = new EventEmitter<SearchSource>();\n\n  /**\n   * Event emitted when the pointer summary is activated\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry summary is changed\n   */\n  @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the coords format is changed\n   */\n  @Output() reverseSearchCoordsFormatStatus = new EventEmitter<boolean>();\n\n  @HostListener('document:keydown', ['$event'])\n  handleKeyboardEvent(event: KeyboardEvent) {\n    if (event.key === 'F2') {\n      this.pointerSummaryEnabled = !this.pointerSummaryEnabled;\n      this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n    }\n  }\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService,\n    private storageService: StorageService\n  ) {}\n\n  ngOnInit(): void {\n    this.hasPointerReverseSearchSource = this.hasReverseSearchSourcesForPointerSummary();\n  }\n\n  /**\n   * Get all search sources\n   * @internal\n   */\n  getSearchSources(): SearchSource[] {\n    const textSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n\n    const reverseSearchSources = this.searchSourceService\n      .getSources()\n      .filter(sourceCanReverseSearch)\n      .filter((s) => s.available && s.getId() !== 'map' && s.showInSettings);\n    const sources = textSearchSources.concat(reverseSearchSources);\n    this.computeSourcesCheckAllBehavior(sources);\n    return sources;\n  }\n\n  /**\n   * Get all search sources usable for pointer summary\n   * @internal\n   */\n  hasReverseSearchSourcesForPointerSummary(): boolean {\n    if (\n      this.searchSourceService\n        .getEnabledSources()\n        .filter(sourceCanReverseSearchAsSummary).length\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Triggered when a setting is checked (checkbox style)\n   * @internal\n   */\n  settingsValueCheckedCheckbox(\n    event: MatCheckboxChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    settingValue.enabled = event.checked;\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (settings)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSettingCheckAllBehavior(setting: SearchSourceSettings) {\n    if (setting.allEnabled === undefined) {\n      if (setting.values.find((settingValue) => settingValue.enabled)) {\n        setting.allEnabled = false;\n      } else {\n        setting.allEnabled = true;\n      }\n    } else {\n      setting.allEnabled = !setting.allEnabled;\n    }\n  }\n\n  /**\n   * Defining the action to do for check/uncheck checkboxes (sources)\n   * return true if all checkbox must be checked\n   * return false if all checkbox must be unchecked\n   * @internal\n   */\n  computeSourcesCheckAllBehavior(sources: SearchSource[]) {\n    const enabledSourcesCnt = sources.filter((source) => source.enabled).length;\n    const disabledSourcesCnt = sources.filter((source) => !source.enabled)\n      .length;\n    this.searchSourcesAllEnabled =\n      enabledSourcesCnt >= disabledSourcesCnt ? false : true;\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAll(event, source: SearchSource, setting: SearchSourceSettings) {\n    event.stopPropagation();\n    this.computeSettingCheckAllBehavior(setting);\n    setting.values.forEach((settingValue) => {\n      settingValue.enabled = setting.allEnabled;\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  /**\n   * Triggered when the check all / uncheck all type is clicked,\n   * @internal\n   */\n  checkUncheckAllSources(event) {\n    event.stopPropagation();\n    this.getSearchSources().map((source) => {\n      source.enabled = this.searchSourcesAllEnabled;\n      this.searchSourceChange.emit(source);\n    });\n  }\n\n  /**\n   * Triggered when a setting is checked (radiobutton style)\n   * @internal\n   */\n  settingsValueCheckedRadioButton(\n    event: MatRadioChange,\n    source: SearchSource,\n    setting: SearchSourceSettings,\n    settingValue: SettingOptions\n  ) {\n    setting.values.forEach((conf) => {\n      if (conf.value !== settingValue.value) {\n        conf.enabled = !event.source.checked;\n      } else {\n        conf.enabled = event.source.checked;\n      }\n    });\n    source.setParamFromSetting(setting);\n    this.searchSourceChange.emit(source);\n  }\n\n  onCheckSearchSource(event: MatCheckboxChange, source: SearchSource) {\n    source.enabled = event.checked;\n    const storage = (this.storageService.get(source.getId() + '.options') || {}) as SettingOptions;\n    storage.enabled = source.enabled;\n    this.storageService.set(\n      source.getId() + '.options',\n      storage\n    );\n    this.searchSourceChange.emit(source);\n  }\n\n  getAvailableValues(setting: SearchSourceSettings) {\n    return setting.values.filter((s) => s.available !== false);\n  }\n\n  getAvailableHashtagsValues(setting: SettingOptions) {\n    if (setting.hashtags) {\n      return setting.hashtags.map((h) => '#' + h).join(', ');\n    }\n    return;\n  }\n\n  stopPropagation(event) {\n    event.stopPropagation();\n  }\n\n  changePointerReverseSearch(event) {\n    this.pointerSummaryEnabled = event.checked;\n    this.pointerSummaryStatus.emit(this.pointerSummaryEnabled);\n  }\n\n  changeSearchResultsGeometry(event) {\n    this.searchResultsGeometryEnabled = event.checked;\n    this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled);\n  }\n\n  reverseSearchCoordsFormat(event) {\n    this.reverseSearchCoordsFormatEnabled = event.checked;\n    this.reverseSearchCoordsFormatStatus.emit(this.reverseSearchCoordsFormatEnabled);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { SearchSettingsComponent } from './search-settings.component';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\n/**\n * @ignore\n */\n@NgModule({\n  declarations: [SearchSettingsComponent],\n  imports: [\n    CommonModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatCheckboxModule,\n    MatDividerModule,\n    MatSlideToggleModule,\n    IgoLanguageModule\n  ],\n  exports: [SearchSettingsComponent]\n})\nexport class IgoSearchSettingsModule { }\n","<div class=\"igo-search-bar-container\" [ngClass]=\"{empty: empty$ | async}\">\n  <mat-form-field [floatLabel]=\"floatLabel\" [appearance]=\"appearance\">\n    <mat-label *ngIf=\"label\">{{label}}</mat-label>\n    <input\n      #input\n      matInput\n      autocomplete=\"off\"\n      [ngClass]=\"{'hasSearchIcon': showSearchButton}\"\n      [disabled]=\"disabled$ | async\"\n      [placeholder]=\"placeholder ? placeholder : (placeholder$ | async) ? (placeholder$.value | translate) : undefined\"\n      [value]=\"term$ | async\"\n      (keyup)=\"onKeyup($event)\"\n      (touchend)=\"onKeyup($event)\">\n  </mat-form-field>\n\n  <div class=\"search-bar-buttons\">\n    <button *ngIf=\"(empty$ | async)===false\"\n      mat-icon-button\n      [color]=\"color\"\n      (click)=\"onClearButtonClick()\"\n      [matTooltip]=\"'igo.geo.search.clearSearch' | translate\">\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n    \n    <button *ngIf=\"showSearchButton\"\n      mat-icon-button\n      [color]=\"color\">\n      <mat-icon svgIcon=\"magnify\"></mat-icon>\n    </button>\n\n    <igo-search-selector\n      *ngIf=\"searchSelector\"\n      [searchTypes]=\"searchTypes\"\n      [searchType]=\"searchType$ | async\"\n      (searchTypeChange)=\"onSearchTypeChange($event)\">\n    </igo-search-selector>\n\n    <igo-search-settings\n      *ngIf=\"searchSettings\"\n      [pointerSummaryEnabled]=\"pointerSummaryEnabled\"\n      (pointerSummaryStatus)=\"pointerSummaryStatus.emit($event)\"\n      [searchResultsGeometryEnabled]=\"searchResultsGeometryEnabled\"\n      (searchResultsGeometryStatus)=\"searchResultsGeometryStatus.emit($event)\"\n      [reverseSearchCoordsFormatEnabled]=\"reverseSearchCoordsFormatEnabled\"\n      (reverseSearchCoordsFormatStatus)=\"reverseSearchCoordsFormatStatus.emit($event)\"\n      (searchSourceChange)=\"onSearchSettingsChange()\">\n    </igo-search-settings>\n  </div>\n</div>\n","import {\n  Component,\n  OnInit,\n  OnDestroy,\n  ChangeDetectionStrategy,\n  Input,\n  Output,\n  EventEmitter,\n  ViewChild,\n  ElementRef\n} from '@angular/core';\nimport {\n  FloatLabelType,\n  MatFormFieldAppearance\n} from '@angular/material/form-field';\nimport { BehaviorSubject, Subscription, timer } from 'rxjs';\nimport { debounce, distinctUntilChanged } from 'rxjs/operators';\n\nimport { ConfigService } from '@igo2/core';\nimport { EntityStore } from '@igo2/common';\n\nimport { SEARCH_TYPES } from '../shared/search.enums';\nimport { SearchResult, Research } from '../shared/search.interfaces';\nimport { SearchService } from '../shared/search.service';\nimport { SearchSourceService } from '../shared/search-source.service';\n\n/**\n * Searchbar that triggers a research in all search sources enabled.\n * If the store input is defined, the search results will be loaded\n * into that store. An event is always emitted when a research is completed.\n */\n@Component({\n  selector: 'igo-search-bar',\n  templateUrl: './search-bar.component.html',\n  styleUrls: ['./search-bar.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchBarComponent implements OnInit, OnDestroy {\n  /**\n   * Invalid keys\n   */\n  static invalidKeys = [\n    'Control',\n    'Shift',\n    'Alt',\n    'ArrowDown',\n    'ArrowUp',\n    'ArrowRight',\n    'ArrowLeft'\n  ];\n\n  readonly placeholder$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.search.placeholder'\n  );\n\n  readonly empty$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  /**\n   * Subscription to the ssearch bar term\n   */\n  private term$$: Subscription;\n\n  /**\n   * Search term stream\n   */\n  private stream$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Subscription to the search term stream\n   */\n  private stream$$: Subscription;\n\n  /**\n   * Subscription to the search type\n   */\n  private searchType$$: Subscription;\n\n  private researches$$: Subscription[];\n\n  /**\n   * whether to show search button or not\n   */\n\n  public showSearchButton: boolean = false;\n\n  /**\n   * List of available search types\n   */\n  @Input() searchTypes: string[] = SEARCH_TYPES;\n\n  /**\n   * Search term\n   */\n  @Input()\n  set searchType(value: string) {\n    this.setSearchType(value);\n  }\n  get searchType(): string {\n    return this.searchType$.value;\n  }\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(\n    undefined\n  );\n\n  /**\n   * Event emitted when the pointer summary is activated by the searchbar setting\n   */\n  @Output() pointerSummaryStatus = new EventEmitter<boolean>();\n\n  /**\n   * Event emitted when the show geometry setting is changed\n   */\n   @Output() searchResultsGeometryStatus = new EventEmitter<boolean>();\n\n   /**\n   * Event emitted when the coords format setting is changed\n   */\n   @Output() reverseSearchCoordsFormatStatus = new EventEmitter<boolean>();\n\n  /**\n   * Search term\n   */\n  @Input()\n  set term(value: string) {\n    this.setTerm(value);\n  }\n  get term(): string {\n    return this.term$.value;\n  }\n  readonly term$: BehaviorSubject<string> = new BehaviorSubject('');\n\n  /**\n   * Whether this component is disabled\n   */\n  @Input()\n  set disabled(value: boolean) {\n    this.disabled$.next(value);\n  }\n  get disabled(): boolean {\n    return this.disabled$.value;\n  }\n  readonly disabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  @Input() pointerSummaryEnabled: boolean = false;\n  @Input() searchResultsGeometryEnabled: boolean = false;\n\n  /**\n   * When reverse coordinates status change\n   */\n  @Input()\n  get reverseSearchCoordsFormatEnabled(): boolean {\n    return this._reverseSearchCoordsFormatEnabled;\n  }\n  set reverseSearchCoordsFormatEnabled(value: boolean) {\n    this._reverseSearchCoordsFormatEnabled = value;\n    this.setTerm(this.term, true);\n  }\n  private _reverseSearchCoordsFormatEnabled = false;\n\n  /**\n   * Whether a float label should be displayed\n   */\n  @Input() floatLabel: FloatLabelType = 'never';\n\n  @Input() appearance: MatFormFieldAppearance = 'legacy';\n\n  @Input() placeholder: string;\n\n  @Input() label: string;\n\n  /**\n   * Icons color (search and clear)\n   */\n  @Input() color = 'primary';\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Debounce time between each keystroke\n   */\n  @Input() debounce = 200;\n\n  /**\n   * Minimum term length required to trigger a research\n   */\n  @Input() minLength = 2;\n\n  /**\n   * Search Selector\n   */\n  @Input() searchSelector = false;\n\n  /**\n   * Search Settings\n   */\n  @Input() searchSettings = false;\n\n  /**\n   * Force coordinates in north america\n   */\n  @Input() forceNA = false;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * Event emitted when the search term changes\n   */\n  @Output() searchTermChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when a research is completed\n   */\n  @Output() search = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() searchTypeChange = new EventEmitter<string>();\n\n  /**\n   * Event emitted when the search type changes\n   */\n  @Output() clearFeature = new EventEmitter();\n\n  /**\n   * Event emitted when the search settings changes\n   */\n  @Output() searchSettingsChange = new EventEmitter();\n\n  /**\n   * Input element\n   * @internal\n   */\n  @ViewChild('input', { static: true }) input: ElementRef;\n\n  /**\n   * Whether the search bar is empty\n   * @internal\n   */\n  get empty(): boolean {\n    return this.term.length === 0;\n  }\n\n  constructor(\n    private configService: ConfigService,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService\n  ) {}\n\n  /**\n   * Subscribe to the search term stream and trigger researches\n   * @internal\n   */\n  ngOnInit(): void {\n    this.term$$ = this.term$.subscribe((term: string) => {\n      this.empty$.next(term === undefined || term.length === 0);\n    });\n\n    this.stream$$ = this.stream$\n      .pipe(\n        debounce(() => timer(this.debounce))\n      )\n      .subscribe((term: string) => this.onSetTerm(term));\n\n    this.handlePlaceholder();\n\n    this.searchType$$ = this.searchType$\n      .pipe(distinctUntilChanged())\n      .subscribe((searchType: string) => this.onSetSearchType(searchType));\n\n    const configValue = this.configService.getConfig(\"searchBar.showSearchButton\");\n    this.showSearchButton = configValue !== undefined ? configValue : false;\n  }\n\n  /**\n   * Unsubscribe to the search term stream\n   * @internal\n   */\n  ngOnDestroy() {\n    this.term$$.unsubscribe();\n    this.stream$$.unsubscribe();\n    this.searchType$$.unsubscribe();\n  }\n\n  /**\n   * When a user types, validates the key and send it into the\n   * stream if it's valid\n   * @param event Keyboard event\n   * @internal\n   */\n  onKeyup(event: KeyboardEvent) {\n    const key = event.key;\n    if (!this.keyIsValid(key)) {\n      return;\n    }\n    const term = (event.target as HTMLInputElement).value;\n    this.setTerm(term);\n  }\n\n  /**\n   * Clear the stream and the input\n   * @internal\n   */\n  onClearButtonClick() {\n    this.clear();\n    this.clearFeature.emit();\n  }\n\n  /**\n   * Update search type\n   * @param searchType Enabled search type\n   * @internal\n   */\n  onSearchTypeChange(searchType: string) {\n    this.setSearchType(searchType);\n  }\n\n  /**\n   * Update the placeholder with the enabled search type. The placeholder\n   * for all availables search typers needs to be defined in the locale\n   * files or an error will be thrown.\n   * @param searchType Enabled search type\n   * @internal\n   */\n  setSearchType(searchType: string) {\n    this.searchType$.next(searchType);\n  }\n\n  onSearchSettingsChange() {\n    this.doSearch(this.term);\n    this.searchSettingsChange.emit();\n    this.handlePlaceholder();\n  }\n\n  /**\n   * Send the term into the stream only if this component is not disabled\n   * @param term Search term\n   */\n  setTerm(term: string, reverseCoordEvent?: boolean) {\n\n    if (this.disabled) {\n      return;\n    }\n\n    term = term || '';\n\n    if (term !== this.term && !reverseCoordEvent) {\n      this.term$.next(term);\n    }\n\n    const slug = term.replace(/(#[^\\s]*)/g, '').trim();\n    if (slug.length >= this.minLength || slug.length === 0) {\n      this.stream$.next(term);\n    }\n  }\n\n  /**\n   * Clear the stream and the input\n   */\n  private clear() {\n    this.term$.next('');\n    this.stream$.next('');\n    this.input.nativeElement.focus();\n  }\n\n  /**\n   * Validate if a given key stroke is a valid input\n   */\n  private keyIsValid(key: string) {\n    return SearchBarComponent.invalidKeys.indexOf(key) === -1;\n  }\n\n  /**\n   * When the search term changes, emit an event and trigger a\n   * research in every enabled search sources.\n   * @param term Search term\n   */\n  private onSetTerm(term: string | undefined) {\n    this.searchTermChange.emit(term);\n    this.doSearch(term);\n  }\n\n  private handlePlaceholder() {\n    const searchTypes = [\n      ...new Set(\n        this.searchSourceService\n          .getEnabledSources()\n          .filter((ss) => !['map', 'coordinatesreverse'].includes(ss.getId()))\n          .map((ss) => ss.getType())\n      )\n    ];\n\n    let placeholder = `igo.geo.search.placeholder`;\n    if (searchTypes.length === 1) {\n      placeholder = `igo.geo.search.${searchTypes[0].toLowerCase()}.placeholder`;\n    } else if (searchTypes.length === 0) {\n      placeholder = `igo.geo.search.emptyType.placeholder`;\n    }\n    this.placeholder$.next(placeholder);\n  }\n\n  private onSetSearchType(searchType: string) {\n    if (searchType === undefined || searchType === null) {\n      return;\n    }\n\n    this.searchTypeChange.emit(searchType);\n\n    const placeholder = `igo.geo.search.${searchType.toLowerCase()}.placeholder`;\n    this.placeholder$.next(placeholder);\n\n    this.setTerm(this.term);\n  }\n\n  /**\n   * Execute the search\n   * @param term Search term\n   */\n  private doSearch(rawTerm: string | undefined) {\n    if (this.researches$$) {\n      this.researches$$.map((research) => research.unsubscribe());\n      this.researches$$ = undefined;\n    }\n\n    let terms;\n    if (this.termSplitter && rawTerm.match(new RegExp(this.termSplitter, 'g'))) {\n      terms = rawTerm.split(this.termSplitter).filter((t) => t.length >= this.minLength);\n      if (this.store) {\n        this.store.clear();\n      }\n    } else {\n      terms = [rawTerm];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      const slug = term ? term.replace(/(#[^\\s]*)/g, '').trim() : '';\n      if (slug === '') {\n        if (this.store !== undefined) {\n          this.store.clear();\n        }\n        return;\n      }\n\n      researches = researches.concat(this.searchService.search(term, {\n        forceNA: this.forceNA\n      }));\n    });\n    this.researches$$ = researches.map((research) => {\n      return research.request.subscribe((results: SearchResult[]) => {\n        this.onResearchCompleted(research, results);\n      });\n    });\n  }\n\n  /**\n   * When a research  is completed, emit an event and update\n   * the store's items.\n   * @param research Research\n   * @param results Research results\n   */\n  private onResearchCompleted(research: Research, results: SearchResult[]) {\n    this.search.emit({ research, results });\n\n    if (this.store !== undefined) {\n      const newResults = this.store\n        .all()\n        .filter((result) => result.source !== research.source)\n        .concat(results);\n      this.store.updateMany(newResults);\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoSearchSelectorModule } from '../search-selector/search-selector.module';\nimport { IgoSearchSettingsModule } from '../search-settings/search-settings.module';\nimport { SearchBarComponent } from './search-bar.component';\nimport { SearchUrlParamDirective } from './search-url-param.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatButtonModule,\n    MatMenuModule,\n    MatRadioModule,\n    MatFormFieldModule,\n    MatInputModule,\n    IgoLanguageModule,\n    IgoSearchSelectorModule,\n    IgoSearchSettingsModule\n  ],\n  exports: [\n    SearchBarComponent,\n  ],\n  declarations: [\n    SearchBarComponent,\n    SearchUrlParamDirective\n  ]\n})\nexport class IgoSearchBarModule {}\n","<mat-list-item>\n  <mat-icon *ngIf=\"icon\" mat-list-avatar svgIcon=\"{{showIcons ? icon : 'blank'}}\"></mat-icon>\n\n  <h4 matLine *ngIf=\"titleHtml\" [innerHtml]=\"titleHtml\" matTooltipShowDelay=\"500\" [matTooltip]=\"tooltipHtml\" matTooltipClass=\"search-result-tooltip\"></h4>\n  <h4 matLine *ngIf=\"!titleHtml\" matTooltipShowDelay=\"500\" [matTooltip]=\"title\">{{title}}</h4>\n\n  <button *ngIf=\"withZoomButton\"\n    igoStopPropagation\n    mat-icon-button\n    (click)=\"onZoomHandler()\">\n    <mat-icon svgIcon=\"magnify\"></mat-icon>\n  </button>\n\n  <ng-content\n    select=[igoSearchItemToolbar]>\n  </ng-content>\n\n</mat-list-item>\n","import { Component, Input, ChangeDetectionStrategy, EventEmitter, Output } from '@angular/core';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\n\nimport {\n  getEntityTitle,\n  getEntityTitleHtml,\n  getEntityIcon\n} from '@igo2/common';\n\nimport { SearchResult } from '../shared/search.interfaces';\nimport { FeatureMotion, moveToOlFeatures } from '../../feature';\nimport { IgoMap } from '../../map';\n\n/**\n * Search results list item\n */\n@Component({\n  selector: 'igo-search-results-item',\n  templateUrl: './search-results-item.component.html',\n  styleUrls: ['./search-results-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultsItemComponent {\n  /**\n   * Search result item\n   */\n  @Input() result: SearchResult;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search result title\n   * @internal\n   */\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  @Output() zoomEvent = new EventEmitter<boolean>();\n\n  private format = new olFormatGeoJSON();\n\n  get title(): string {\n    return getEntityTitle(this.result);\n  }\n\n  /**\n   * Search result HTML title\n   * @internal\n   */\n  get titleHtml(): string {\n    return getEntityTitleHtml(this.result);\n  }\n\n  /**\n   * Search result tooltip\n   * @internal\n   */\n  get tooltipHtml(): string {\n    return this.titleHtml\n      .replace(/<small?[^>]+(>|$)/g, '\\n')\n      .replace(/<\\/?[^>]+(>|$)/g, '');\n  }\n\n  /**\n   * Search result icon\n   * @internal\n   */\n  get icon(): string {\n    return getEntityIcon(this.result);\n  }\n\n  onZoomHandler() {\n    const olFeature = this.format.readFeature(this.result.data, {\n      dataProjection: this.result.data.projection,\n      featureProjection: this.map.projection\n    });\n    moveToOlFeatures(this.map, [olFeature], FeatureMotion.Default);\n  }\n}\n","<igo-list [navigation]=\"true\">\n  <ng-template\n    #groupTemplate\n    ngFor let-group\n    [ngForOf]=\"results$ | async\">\n\n    <igo-collapsible [class]=\"group.source.getId()\"\n      *ngIf=\"mode === searchResultMode.Grouped; else flatTemplate\"\n      [title]=\"computeGroupTitle(group)\"\n      [collapsed]=\"collapsed[group.source.title]\"\n      (toggle)=\"collapsed[group.source.title] = $event\">\n      <ng-container *ngTemplateOutlet=\"storeItemTemplate; context: {results: group.results}\"></ng-container>\n    </igo-collapsible>\n\n    <ng-template #flatTemplate>\n      <ng-container *ngTemplateOutlet=\"storeItemTemplate; context: {results: group.results}\"></ng-container>\n    </ng-template>\n\n    <ng-template #storeItemTemplate let-results=\"results\">\n      <ng-template ngFor let-result [ngForOf]=\"results\">\n        <igo-search-results-item\n          igoListItem\n          color=\"accent\"\n          [map]=\"map\"\n          [result]=\"result\"\n          [showIcons]=\"showIcons\"\n          [withZoomButton]=\"withZoomButton\"\n          [focused]=\"store.state.get(result).focused\"\n          [selected]=\"store.state.get(result).selected\"\n          (focus)=\"resultFocus.emit(result)\"\n          (unfocus)=\"resultUnfocus.emit(result)\"\n          (select)=\"onResultSelect(result)\"\n          (mouseenter)=\"resultFocus.emit(result)\"\n          (mouseleave)=\"resultUnfocus.emit(result)\">\n\n          <ng-container igoSearchItemToolbar\n            [ngTemplateOutlet]=\"templateSearchToolbar\"\n            [ngTemplateOutletContext]=\"{result: result}\">\n          </ng-container>\n\n        </igo-search-results-item>\n      </ng-template>\n      <span class=\"moreResults mat-typography\" *ngIf=\"isMoreResults(group)\" (click)=\"displayMoreResults(group)\">\n        <u>{{ 'igo.geo.search.displayMoreResults' | translate }}</u>\n      </span>\n    </ng-template>\n\n  </ng-template>\n\n</igo-list>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ContentChild,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  OnInit,\n  OnDestroy\n} from '@angular/core';\nimport type { TemplateRef } from '@angular/core';\n\nimport { Observable, EMPTY, timer, BehaviorSubject, Subscription } from 'rxjs';\nimport { debounce, map } from 'rxjs/operators';\n\nimport { ConfigService } from '@igo2/core';\nimport { EntityState, EntityStore, EntityStoreFilterCustomFuncStrategy, EntityStoreWatcher } from '@igo2/common';\n\nimport { IgoMap } from '../../map';\n\nimport { TextSearchOptions } from '../shared/sources/source.interfaces';\nimport { SearchService } from '../shared/search.service';\nimport { SearchResult, Research } from '../shared/search.interfaces';\nimport { SearchSource } from '../shared/sources/source';\n\nexport enum SearchResultMode {\n  Grouped = 'grouped',\n  Flat = 'flat'\n}\n\n/**\n * List of search results with focus and selection capabilities.\n * This component is dumb and only emits events.\n */\n@Component({\n  selector: 'igo-search-results',\n  templateUrl: './search-results.component.html',\n  styleUrls: ['./search-results.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultsComponent implements OnInit, OnDestroy {\n\n  private showResultsCount: boolean = true;\n\n  /**\n   * Reference to the SearchResultMode enum\n   * @internal\n   */\n  public searchResultMode = SearchResultMode;\n\n  /**\n   * Search results store watcher\n   */\n  private watcher: EntityStoreWatcher<SearchResult>;\n\n  private settingsChange$$: Subscription;\n\n  public pageIterator: {sourceId: string}[] = [];\n\n  public collapsed: {sourceId: string}[] = [];\n\n  @Input() map: IgoMap;\n\n  /**\n   * Search results store\n   */\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * to show hide results icons\n   */\n  @Input() showIcons: boolean;\n\n  /**\n   * Search results display mode\n   */\n  @Input() mode: SearchResultMode = SearchResultMode.Grouped;\n\n  /**\n   * Whether there should be a zoom button\n   */\n  @Input() withZoomButton = false;\n\n  /**\n   * Search term\n   */\n  @Input()\n  get term(): string {\n    return this._term;\n  }\n  set term(value: string) {\n    this._term = value;\n    this.pageIterator = [];\n  }\n  public _term: string;\n\n  @Input() settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  @Input() termSplitter: string = '|';\n\n  /**\n   * Event emitted when a result is focused\n   */\n  @Output() resultFocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is unfocused\n   */\n  @Output() resultUnfocus = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a result is selected\n   */\n  @Output() resultSelect = new EventEmitter<SearchResult>();\n\n  /**\n   * Event emitted when a research is completed after displaying more results is clicked\n   */\n  @Output() moreResults = new EventEmitter<{\n    research: Research;\n    results: SearchResult[];\n  }>();\n\n  /**\n   * Events emitted when a result is focus or unfocus by mouse event\n   */\n  @Output() resultMouseenter = new EventEmitter<SearchResult>();\n  @Output() resultMouseleave = new EventEmitter<SearchResult>();\n\n  @ContentChild('igoSearchItemToolbar', /* TODO: add static flag */ {}) templateSearchToolbar: TemplateRef<any>;\n\n  get results$(): Observable<{source: SearchSource; results: SearchResult[]}[]> {\n    if (this._results$ === undefined) {\n      this._results$ = this.liftResults();\n    }\n    return this._results$;\n  }\n  private _results$: Observable<\n    {source: SearchSource; results: SearchResult[]}[]\n  >;\n\n  constructor(private cdRef: ChangeDetectorRef,\n              private searchService: SearchService,\n              private configService: ConfigService,\n              ) {}\n\n  /**\n   * Bind the search results store to the watcher\n   * @internal\n   */\n  ngOnInit() {\n    this.watcher = new EntityStoreWatcher(this.store, this.cdRef);\n\n    this.settingsChange$$ = this.settingsChange$.subscribe(() => {\n      this.pageIterator = [];\n    });\n\n    if (this.configService.getConfig('searchSources.showResultsCount') === false) {\n      this.showResultsCount = false;\n    }\n  }\n\n  /**\n   * Unbind the search results store from the watcher\n   * @internal\n   */\n  ngOnDestroy() {\n    this.watcher.destroy();\n    this.settingsChange$$.unsubscribe();\n  }\n\n  /**\n   * Compute a group title\n   * @param group Search results group\n   * @returns Group title\n   * @internal\n   */\n  computeGroupTitle(group: {source: SearchSource; results: SearchResult[]}): string {\n    const parts = [group.source.title];\n    const count = group.results.length;\n    if (count > 1 && this.showResultsCount) {\n      parts.push(`(${count})`);\n    }\n    return parts.join(' ');\n  }\n\n  /**\n   * When a result is selected, update it's state in the store and emit\n   * an event. A selected result is also considered focused\n   * @param result Search result\n   * @internal\n   */\n  onResultSelect(result: SearchResult) {\n    if (this.store.state.get(result)) {\n      if (this.store.state.get(result).selected === true) {\n        return;\n      }\n    }\n    this.store.state.update(result, {focused: true, selected: true}, true);\n    this.resultSelect.emit(result);\n  }\n\n  /**\n   * Return an observable of the search results, grouped by search source\n   * @returns Observable of grouped search results\n   * @internal\n   */\n   private liftResults(): Observable<{source: SearchSource; results: SearchResult[]}[]> {\n    return this.store.stateView.all$().pipe(\n      debounce((results: {entity: SearchResult, state: EntityState}[]) => {\n        return results.length === 0 ? EMPTY : timer(200);\n      }),\n      map((results: {entity: SearchResult, state: EntityState}[]) => {\n        return this.groupResults(results.map(r => r.entity).sort(this.sortByOrder));\n      })\n    );\n  }\n\n  /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n  private sortByOrder(r1: SearchResult, r2: SearchResult) {\n    return r1.source.displayOrder - r2.source.displayOrder;\n  }\n\n  /**\n   * Group results by search source\n   * @param results Search results from all sources\n   * @returns Search results grouped by source\n   */\n  private groupResults(results: SearchResult[]): {source: SearchSource; results: SearchResult[]}[] {\n    const grouped = new Map<SearchSource, SearchResult[]>();\n    results.forEach((result: SearchResult) => {\n      const source = result.source;\n      let sourceResults = grouped.get(source);\n      if (sourceResults === undefined) {\n        sourceResults = [];\n        grouped.set(source, sourceResults);\n      }\n      sourceResults.push(result);\n    });\n\n    return Array.from(grouped.keys()).map((source: SearchSource) => {\n      if (this.pageIterator[source.getId()] === undefined) {\n        this.pageIterator[source.getId()] = 1;\n      }\n      return {source, results: grouped.get(source)};\n    });\n  }\n\n  isMoreResults(group: { source: SearchSource; results: SearchResult[] }) {\n    const stategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n    const active = stategy?.active || false;\n    if (!active) {\n      return group.results && group.results[group.results.length - 1].meta.nextPage === true;\n    } else {\n      return group.results?.length % +group.source.params.limit === 0 && + group.source.params.page < 30;\n    }\n\n  }\n\n  displayMoreResults(group: {source: SearchSource; results: SearchResult[]}) {\n    const options: TextSearchOptions = {\n      sourceId: group.source.getId(),\n      page: ++this.pageIterator[group.source.getId()]\n    };\n\n    let terms;\n    if (this.termSplitter && this.term.match(new RegExp(this.termSplitter, 'g'))) {\n      terms = this.term.split(this.termSplitter);\n    } else {\n      terms = [this.term];\n    }\n\n    let researches: Research[] = [];\n    terms.map((term: string) => {\n      researches = researches.concat(this.searchService.search(term, options));\n    });\n\n    researches.map(research => {\n      research.request.subscribe((results: SearchResult[]) => {\n        const newResults = group.results.concat(results);\n        if (!results.length) {\n          newResults[newResults.length - 1].meta.nextPage = false;\n        }\n        this.moreResults.emit({research, results: newResults});\n      });\n    });\n    return;\n  }\n}\n","<h1 mat-dialog-title class=\"mat-typography\">{{'igo.geo.layer.saveFeatureInLayer' | translate}}</h1>\n\n<div mat-dialog-content class=\"mat-typography\">\n  <form class=\"igo-form\" [formGroup]=\"form\">\n    <igo-list [navigation]=\"false\" [selection]=\"false\">\n      <igo-search-results-item\n        igoListItem\n        color=\"accent\"\n        [result]=\"feature\"\n        showIcons=\"true\">\n      </igo-search-results-item>\n    </igo-list>\n    \n    <div class=\"igo-input-container\">\n      <mat-form-field>\n        <input type=\"text\"\n          placeholder=\"{{'igo.geo.layer.chooseOrSet' | translate}}\"\n          matInput\n          [matAutocomplete]=\"auto\"\n          formControlName=\"layerName\">\n        <mat-autocomplete [displayWith]=\"displayFn\" #auto=\"matAutocomplete\">\n          <mat-option *ngFor=\"let layer of filteredLayers | async\" [value]=\"layer\">\n            <p mat-line>{{layer.title}}</p>\n          </mat-option>\n        </mat-autocomplete>\n      </mat-form-field>\n    </div>\n  </form>\n</div>\n\n<div mat-dialog-actions style=\"justify-content: center\">\n  <div class=\"igo-form-button-group create-layer-button-top-padding\">\n    <button\n      mat-raised-button\n      type=\"button\"\n      (click)=\"cancel()\">\n      {{'igo.geo.layer.cancelBtn' | translate}}\n    </button>\n    <button\n      id=\"createLayerBtnDialog\"\n      mat-raised-button\n      type=\"button\"\n      color=\"primary\"\n      (click)=\"save()\">\n      {{'igo.geo.layer.saveBtn' | translate}}\n    </button>\n  </div>\n</div>","import { LanguageService } from '@igo2/core';\nimport { Component, OnInit, Optional, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { UntypedFormBuilder, UntypedFormGroup, Validators } from '@angular/forms';\nimport { Layer } from '../../layer';\nimport { SearchResult } from '../shared';\nimport { Observable } from 'rxjs';\nimport { map, startWith } from 'rxjs/operators';\n\n@Component({\n  selector: 'igo-save-feature-dialog',\n  templateUrl: './save-feature-dialog.component.html',\n  styleUrls: ['./save-feature-dialog.component.scss']\n})\nexport class SaveFeatureDialogComponent implements OnInit {\n\n  public form: UntypedFormGroup;\n  feature: SearchResult;\n  layers: Layer[] = [];\n  filteredLayers: Observable<Layer[]>;\n\n  constructor(\n    private formBuilder: UntypedFormBuilder,\n    public languageService: LanguageService,\n    public dialogRef: MatDialogRef<SaveFeatureDialogComponent>,\n    @Optional()\n    @Inject(MAT_DIALOG_DATA)\n    public data: { feature: SearchResult; layers: Layer[]}\n  ) {\n    this.form = this.formBuilder.group({\n      layerName: ['', [Validators.required]],\n    });\n  }\n\n  ngOnInit() {\n    this.feature = this.data.feature;\n    this.layers = this.data.layers;\n    this.filteredLayers = this.form.controls['layerName'].valueChanges.pipe(\n      startWith(''),\n      map(val => this.filter(val))\n    );\n  }\n\n  private filter(val): Layer[] {\n    if(typeof val !== 'string'){\n      return;\n    }\n    return this.layers.map(l => l).filter(layer =>\n      layer?.title?.toLowerCase().includes(val.toLowerCase()));\n  }\n\n  displayFn(layer: Layer): string {\n    return layer && layer.title ? layer.title: '';\n  }\n\n  save() {\n    const data: {layer: string | Layer, feature: SearchResult} = {layer: this.form.value.layerName, feature: this.feature};\n    this.dialogRef.close(data);\n  }\n\n  cancel() {\n    this.dialogRef.close();\n  }\n}\n","<button\nigoStopPropagation\n(mouseenter)=\"onMouseEvent($event)\" (mouseleave)=\"onMouseEvent($event)\"\n*ngIf=\"layer.meta.dataType === 'Layer'\"\nmat-icon-button\ntooltip-position=\"below\"\nmatTooltipShowDelay=\"500\"\n[matTooltip]=\"computeTooltip() | translate\"\n[color]=\"(isPreview$ | async) ? '' : added ? 'warn' : ''\"\n(click)=\"onToggleClick($event)\">\n<mat-icon\n  matBadge=\"icon\"\n  [igoMatBadgeIcon]=\"getBadgeIcon()\"\n  igoMatBadgeColor=\"rgba(0,0,0,0.87)\"\n  igoMatBadgeBackgroundColor=\"none\"\n  igoMatBadgeInverseColor=\"true\"\n  [matBadgeHidden]=\"((inRange$ | async) && (isVisible$ | async) === true) || ((inRange$ | async) && !added) || ((inRange$ | async) && (isPreview$ | async))\"\n  [matBadgeDisabled]=\"(inRange$ | async) === false\"\n  matBadgeSize=\"small\"\n  matBadgePosition=\"after\"\n  [svgIcon]=\"(isPreview$ | async) ? 'plus' : added ? 'delete' : 'plus'\">\n</mat-icon>\n</button>\n\n<button\nigoStopPropagation\n*ngIf=\"layer.meta.dataType === 'Feature'\"\nmat-icon-button\ntooltip-position=\"below\"\nmatTooltipShowDelay=\"500\"\n[matTooltip]=\"(addFeatureToLayerTooltip$ | async) | translate\"\n(click)=\"addFeatureToLayer()\">\n<mat-icon\n  matBadge=\"icon\"\n  igoMatBadgeIcon=\"eye-off\"\n  igoMatBadgeInverseColor=\"true\"\n  [matBadgeHidden]=\"(inRange$ | async)\"\n  matBadgeDisabled=\"true\"\n  matBadgeSize=\"small\"\n  matBadgePosition=\"after\"\n  svgIcon=\"file-plus-outline\">\n</mat-icon>\n</button>\n","import {\n  Component,\n  Input,\n  ChangeDetectionStrategy,\n  OnInit,\n  OnDestroy,\n} from '@angular/core';\n\nimport { SearchResult } from '../shared/search.interfaces';\nimport { IgoMap } from '../../map/shared/map';\nimport { LayerOptions } from '../../layer/shared/layers/layer.interface';\nimport { LayerService } from '../../layer/shared/layer.service';\nimport { LAYER } from '../../layer/shared/layer.enums';\nimport { Subscription, BehaviorSubject, take } from 'rxjs';\nimport { SaveFeatureDialogComponent } from './save-feature-dialog.component';\nimport { MatDialog } from '@angular/material/dialog';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { DataSourceService, FeatureDataSource } from '../../datasource';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  tryAddLoadingStrategy,\n  tryAddSelectionStrategy,\n  tryBindStoreLayer\n} from '../../feature';\nimport { EntityStore } from '@igo2/common';\nimport { getTooltipsOfOlGeometry } from '../../measure';\nimport OlOverlay from 'ol/Overlay';\nimport { VectorSourceEvent as OlVectorSourceEvent } from 'ol/source/Vector';\nimport { default as OlGeometry } from 'ol/geom/Geometry';\nimport { QueryableDataSourceOptions } from '../../query';\nimport { createOverlayDefaultStyle } from '../../overlay';\n\n\n@Component({\n  selector: 'igo-search-add-button',\n  templateUrl: './search-results-add-button.component.html',\n  styleUrls: ['./search-results-add-button.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class SearchResultAddButtonComponent implements OnInit, OnDestroy{\n  public tooltip$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.catalog.layer.addToMap'\n  );\n\n  public addFeatureToLayerTooltip$: BehaviorSubject<string> = new BehaviorSubject(\n    'igo.geo.search.addToLayer'\n  );\n\n  private resolution$$: Subscription;\n  private layers$$: Subscription;\n\n  public inRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  public isVisible$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  public isPreview$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  private layersSubcriptions = [];\n\n  private lastTimeoutRequest;\n\n  private mouseInsideAdd: boolean = false;\n\n  @Input() layer: SearchResult;\n\n  @Input() store: EntityStore<SearchResult>;\n\n  /**\n   * Whether the layer is already added to the map\n   */\n  @Input() added: boolean;\n\n  /**\n   * The map to add the search result layer to\n   */\n  @Input() map: IgoMap;\n\n  @Input()\n  get color() {\n    return this._color;\n  }\n  set color(value: string) {\n    this._color = value;\n  }\n  private _color = 'primary';\n\n  @Input() stores: FeatureStore<Feature>[] = [];\n\n  get allLayers() {\n    return this.map.layers.filter((layer) =>\n      layer.id.includes('igo-search-layer')\n    );\n  }\n\n  constructor(\n    private layerService: LayerService,\n    private dialog: MatDialog,\n    private dataSourceService: DataSourceService) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit(): void {\n    if (this.layer.meta.dataType === 'Layer') {\n      this.added =\n        this.map.layers.findIndex(\n          lay => lay.id === this.layer.data.sourceOptions.id\n        ) !== -1;\n    }\n    this.layers$$ = this.map.layers$.subscribe(() => {\n      this.isVisible();\n    });\n    this.resolution$$ = this.map.viewController.resolution$.subscribe(value => {\n      this.isInResolutionsRange(value);\n      this.isVisible();\n    });\n  }\n\n  ngOnDestroy() {\n    this.resolution$$.unsubscribe();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * On mouse event, mouseenter /mouseleave\n   * @internal\n   */\n  onMouseEvent(event) {\n    this.onToggleClick(event);\n  }\n\n  /**\n   * On toggle button click, emit the added change event\n   * @internal\n   */\n  onToggleClick(event) {\n    if (typeof this.lastTimeoutRequest !== 'undefined') {\n      clearTimeout(this.lastTimeoutRequest);\n    }\n\n    if (event.type === 'mouseenter' && this.mouseInsideAdd ) {\n      return;\n    }\n    switch (event.type) {\n      case 'click':\n        if (!this.isPreview$.value) {\n          if (this.added) {\n            this.remove();\n          } else {\n            this.add();\n          }\n        }\n        this.isPreview$.next(false);\n        break;\n      case 'mouseenter':\n        if (!this.isPreview$.value && !this.added) {\n          this.lastTimeoutRequest = setTimeout(() => {\n            this.add();\n            this.isPreview$.next(true);\n          }, 500);\n        }\n        this.mouseInsideAdd = true;\n        break;\n      case 'mouseleave':\n        if (this.isPreview$.value) {\n          this.remove();\n          this.isPreview$.next(false);\n        }\n        this.mouseInsideAdd = false;\n        break;\n      default:\n        break;\n    }\n  }\n\n  private add() {\n    if (!this.added) {\n      this.added = true;\n      this.addLayerToMap();\n    }\n  }\n\n  private remove() {\n    if (this.added) {\n      this.added = false;\n      this.removeLayerFromMap();\n      this.layersSubcriptions.map(s => s.unsubscribe());\n      this.layersSubcriptions = [];\n    }\n  }\n\n  /**\n   * Emit added change event with added = true\n   */\n  private addLayerToMap() {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const layerOptions = (this.layer as SearchResult<LayerOptions>).data;\n    if (layerOptions.sourceOptions.optionsFromApi === undefined) {\n      layerOptions.sourceOptions.optionsFromApi = true;\n    }\n    this.layersSubcriptions.push(\n      this.layerService\n        .createAsyncLayer(layerOptions)\n        .subscribe(layer => this.map.addLayer(layer))\n    );\n  }\n\n  /**\n   * Emit added change event with added = false\n   */\n  private removeLayerFromMap() {\n    if (this.map === undefined) {\n      return;\n    }\n\n    if (this.layer.meta.dataType !== LAYER) {\n      return undefined;\n    }\n\n    const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\n    this.map.removeLayer(oLayer);\n  }\n\n  isInResolutionsRange(resolution: number) {\n    const minResolution = this.layer.data.minResolution || 0;\n    const maxResolution = this.layer.data.maxResolution || Infinity;\n    this.inRange$.next(\n      resolution >= minResolution && resolution <= maxResolution\n    );\n  }\n\n  isVisible() {\n    if (this.layer?.data?.sourceOptions?.id) {\n      const oLayer = this.map.getLayerById(this.layer.data.sourceOptions.id);\n      oLayer ? this.isVisible$.next(oLayer.visible) : this.isVisible$.next(false);\n    }\n  }\n\n  getBadgeIcon() {\n    if (this.inRange$.value) {\n      return this.isVisible$.value ? '' : 'eye-off';\n    } else {\n      return 'eye-off';\n    }\n  }\n\n  computeTooltip(): string {\n    if (this.added) {\n      if (this.isPreview$.value) {\n        return 'igo.geo.catalog.layer.addToMap';\n      } else if (this.inRange$.value) {\n        return this.isVisible$.value\n        ? 'igo.geo.catalog.layer.removeFromMap'\n        : 'igo.geo.catalog.layer.removeFromMapNotVisible';\n      } else {\n        return 'igo.geo.catalog.layer.removeFromMapOutRange';\n      }\n    } else {\n      return this.inRange$.value\n        ? 'igo.geo.catalog.layer.addToMap'\n        : 'igo.geo.catalog.layer.addToMapOutRange';\n    }\n  }\n\n  addFeatureToLayer() {\n    if (this.layer.meta.dataType !== 'Feature') {\n      return;\n    }\n\n    const selectedFeature = this.layer;\n    const dialogRef = this.dialog.open(SaveFeatureDialogComponent, {\n      width: '700px',\n      data: {\n        feature: selectedFeature,\n        layers: this.allLayers\n      }\n    });\n\n    dialogRef.afterClosed().subscribe((data: {layer: string | any, feature: SearchResult}) => {\n      if (data) {\n        if(this.stores.length > 0) {\n          this.stores.map((store) => {\n            store.state.updateAll({selected: false});\n            (store?.layer).visible = false;\n            return store;\n          });\n        }\n        // check if is new layer\n        if (typeof data.layer === 'string') {\n          this.createLayer(data.layer, data.feature);\n        } else {\n          const activeStore = this.stores.find(store => store.layer.id === data.layer.id);\n          activeStore.layer.visible = true;\n          activeStore.layer.opacity = 1;\n          this.addFeature(data.feature, activeStore);\n        }\n      }\n    });\n  }\n\n  createLayer(layerTitle: string, selectedFeature: SearchResult) {\n\n    const activeStore: FeatureStore<Feature> = new FeatureStore<Feature>([], {\n      map: this.map\n    });\n\n    // set layer id\n    let layerCounterID: number = 0;\n    for (const layer of this.allLayers) {\n      let numberId = Number(layer.id.replace('igo-search-layer',''));\n      layerCounterID = Math.max(numberId,layerCounterID);\n    }\n\n    this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: FeatureDataSource) => {\n          let searchLayer: VectorLayer = new VectorLayer({\n            isIgoInternalLayer: true,\n            id: 'igo-search-layer' + ++layerCounterID,\n            title: layerTitle,\n            source: dataSource,\n            style: createOverlayDefaultStyle({\n              text: '',\n              strokeWidth: 1,\n              fillColor: 'rgba(255,255,255,0.4)',\n              strokeColor: 'rgba(143,7,7,1)'\n            }),\n            showInLayerList: true,\n            exportable: true,\n            workspace: {\n              enabled: true\n            }\n          });\n\n          tryBindStoreLayer(activeStore, searchLayer);\n          tryAddLoadingStrategy(\n            activeStore,\n            new FeatureStoreLoadingStrategy({\n              motion: FeatureMotion.None\n            })\n          );\n\n          tryAddSelectionStrategy(\n            activeStore,\n            new FeatureStoreSelectionStrategy({\n              map: this.map,\n              motion: FeatureMotion.None,\n              many: true\n            })\n          );\n\n          activeStore.layer.visible = true;\n          activeStore.source.ol.on(\n            'removefeature',\n            (event: OlVectorSourceEvent<OlGeometry>) => {\n              const olGeometry = event.feature.getGeometry();\n              this.clearLabelsOfOlGeometry(olGeometry);\n            }\n          );\n\n          this.addFeature(selectedFeature, activeStore);\n          this.stores.push(activeStore);\n        });\n  }\n\n  addFeature(feature: SearchResult, activeStore: FeatureStore<Feature>) {\n    const newFeature = {\n      type: feature.data.type,\n      geometry: {\n        coordinates: feature.data.geometry.coordinates,\n        type: feature.data.geometry.type\n      },\n      projection: feature.data.projection,\n      properties: feature.data.properties,\n      meta: {\n        id: feature.meta.id\n      }\n    };\n    delete newFeature.properties.Route;\n    activeStore.update(newFeature);\n    activeStore.setLayerExtent();\n    activeStore.layer.ol.getSource().refresh();\n  }\n\n  private clearLabelsOfOlGeometry(olGeometry) {\n    getTooltipsOfOlGeometry(olGeometry).forEach(\n      (olTooltip: OlOverlay | undefined) => {\n        if (olTooltip && olTooltip.getMap()) {\n          this.map.ol.removeOverlay(olTooltip);\n        }\n      }\n    );\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\n\nimport {\n  IgoCollapsibleModule,\n  IgoListModule,\n  IgoMatBadgeIconModule,\n  IgoStopPropagationModule\n} from '@igo2/common';\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoMetadataModule } from './../../metadata/metadata.module';\nimport { SearchResultsComponent } from './search-results.component';\nimport { SearchResultsItemComponent } from './search-results-item.component';\nimport { SearchResultAddButtonComponent } from './search-results-add-button.component';\nimport { SaveFeatureDialogComponent } from './save-feature-dialog.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatBadgeModule,\n    MatTooltipModule,\n    MatIconModule,\n    MatListModule,\n    MatButtonModule,\n    MatDialogModule,\n    IgoCollapsibleModule,\n    IgoListModule,\n    IgoStopPropagationModule,\n    IgoLanguageModule,\n    IgoMatBadgeIconModule,\n    IgoMetadataModule,\n    MatFormFieldModule,\n    ReactiveFormsModule,\n    MatInputModule,\n    MatSelectModule,\n    MatAutocompleteModule,\n  ],\n  exports: [\n    SearchResultsComponent,\n    SearchResultAddButtonComponent\n  ],\n  declarations: [\n    SearchResultsComponent,\n    SearchResultsItemComponent,\n    SearchResultAddButtonComponent,\n    SaveFeatureDialogComponent\n  ]\n})\nexport class IgoSearchResultsModule {}\n","import { FeatureGeometry } from './../../feature/shared/feature.interfaces';\nimport {\n  Directive,\n  Input,\n  OnDestroy,\n  Self,\n  OnInit,\n  AfterContentChecked\n} from '@angular/core';\n\nimport { Subscription } from 'rxjs';\n\nimport MapBrowserPointerEvent from 'ol/MapBrowserEvent';\n\nimport { IgoMap } from '../../map/shared/map';\nimport { MapBrowserComponent } from '../../map/map-browser/map-browser.component';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { SearchService } from './search.service';\n\nimport olFeature from 'ol/Feature';\nimport { transform } from 'ol/proj';\nimport * as olstyle from 'ol/style';\nimport * as olgeom from 'ol/geom';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport { SearchResult, Research } from './search.interfaces';\nimport { EntityStore } from '@igo2/common';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { VectorLayer } from '../../layer/shared/layers/vector-layer';\nimport { take } from 'rxjs/operators';\nimport { tryBindStoreLayer } from '../../feature/shared/feature.utils';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureMotion, FEATURE } from '../../feature/shared/feature.enums';\nimport { SearchSourceService } from './search-source.service';\nimport { sourceCanReverseSearchAsSummary } from './search.utils';\nimport { MediaService } from '@igo2/core';\nimport { unByKey } from 'ol/Observable';\n\n/**\n * This directive makes the mouse coordinate trigger a reverse search on available search sources.\n * The search results are placed into a label, on a cross icon, representing the mouse coordinate.\n * By default, no search sources. Config in config file must be defined.\n * the layer level.\n */\n@Directive({\n  selector: '[igoSearchPointerSummary]'\n})\nexport class SearchPointerSummaryDirective implements OnInit, OnDestroy, AfterContentChecked {\n\n  public store: FeatureStore<Feature>;\n  private lonLat: [number, number];\n  private pointerSearchStore: EntityStore<SearchResult> = new EntityStore<SearchResult>([]);\n  private lastTimeoutRequest;\n  private store$$: Subscription;\n  private layers$$: Subscription;\n  private reverseSearch$$: Subscription[] = [];\n  private hasPointerReverseSearchSource: boolean = false;\n\n  /**\n   * Listener to the pointer move event\n   */\n  private pointerMoveListener;\n\n  private searchPointerSummaryFeatureId: string = 'searchPointerSummaryFeatureId';\n  /**\n   * The delay where the mouse must be motionless before trigger the reverse search\n   */\n  @Input() igoSearchPointerSummaryDelay: number = 1000;\n\n  /**\n   * If the user has enabled or not the directive\n   */\n  @Input() igoSearchPointerSummaryEnabled: boolean = false;\n\n  /**\n   * IGO map\n   * @internal\n   */\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  get mapProjection(): string {\n    return (this.component.map as IgoMap).projection;\n  }\n\n  constructor(\n    @Self() private component: MapBrowserComponent,\n    private searchService: SearchService,\n    private searchSourceService: SearchSourceService,\n    private mediaService: MediaService\n  ) { }\n\n  /**\n   * Start listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnInit() {\n    this.listenToMapPointerMove();\n    this.subscribeToPointerStore();\n\n    this.map.status$.pipe(take(1)).subscribe(() => {\n      this.store = new FeatureStore<Feature>([], {map: this.map});\n      this.initStore();\n    });\n\n    // To handle context change without using the contextService.\n    this.layers$$ = this.map.layers$.subscribe((layers) => {\n      if (this.store && !layers.find(l => l.id === 'searchPointerSummaryId')) {\n        this.initStore();\n      }\n    });\n\n  }\n\n  /**\n   * Initialize the pointer position store\n   * @internal\n   */\n  private initStore() {\n    const store = this.store;\n\n    const layer = new VectorLayer({\n      isIgoInternalLayer: true,\n      id : 'searchPointerSummaryId',\n      title: 'searchPointerSummary',\n      zIndex: 900,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      style: pointerPositionSummaryMarker\n    });\n    tryBindStoreLayer(store, layer);\n  }\n\n  ngAfterContentChecked(): void {\n      if (!this.searchSourceService.getEnabledSources().filter(sourceCanReverseSearchAsSummary).length) {\n        this.hasPointerReverseSearchSource = false;\n      } else {\n        this.hasPointerReverseSearchSource = true;\n      }\n    }\n\n  /**\n   * Stop listening to pointermove and reverse search results.\n   * @internal\n   */\n  ngOnDestroy() {\n    this.unlistenToMapPointerMove();\n    this.unsubscribeToPointerStore();\n    this.unsubscribeReverseSearch();\n    this.layers$$.unsubscribe();\n  }\n\n  /**\n   * Subscribe to pointermove result store\n   * @internal\n   */\n  subscribeToPointerStore() {\n    this.store$$ = this.pointerSearchStore.entities$.subscribe(resultsUnderPointerPosition => {\n      this.entitiesToPointerOverlay(resultsUnderPointerPosition);\n    });\n  }\n\n  /**\n   * Build an object based on the closest feature by type (base on type and distance properties )\n   * @param results SearchResult[]\n   * @returns OL style function\n   */\n  private computeSummaryClosestFeature(results: SearchResult[]): {} {\n    const closestResultByType = {};\n\n    results.map(result => {\n      if (result.data.properties.type && result.data.properties.distance >= 0) {\n        if (closestResultByType.hasOwnProperty(result.data.properties.type)) {\n          const prevDistance = closestResultByType[result.data.properties.type].distance;\n          if (result.data.properties.distance < prevDistance) {\n            const title = result.meta.pointerSummaryTitle || result.meta.title;\n            closestResultByType[result.data.properties.type] = { distance: result.data.properties.distance, title };\n          }\n        } else {\n          const title = result.meta.pointerSummaryTitle || result.meta.title;\n          closestResultByType[result.data.properties.type] = { distance: result.data.properties.distance, title };\n        }\n      }\n    });\n\n    return closestResultByType;\n  }\n\n  /**\n   * convert store entities to a pointer position overlay with label summary on.\n   * @param event OL map browser pointer event\n   */\n  private entitiesToPointerOverlay(resultsUnderPointerPosition: SearchResult[]) {\n    const closestResultByType = this.computeSummaryClosestFeature(resultsUnderPointerPosition);\n    const summarizedClosestType = Object.keys(closestResultByType);\n    const processedSummarizedClosestType = [];\n    const summary = [];\n    resultsUnderPointerPosition.map(result => {\n      const typeIndex = summarizedClosestType.indexOf(result.data.properties.type);\n      if (typeIndex !== -1) {\n        summary.push(closestResultByType[result.data.properties.type].title);\n        summarizedClosestType.splice(typeIndex, 1);\n        processedSummarizedClosestType.push(result.data.properties.type);\n      } else {\n        if (processedSummarizedClosestType.indexOf(result.data.properties.type) === -1) {\n          summary.push(result.meta.pointerSummaryTitle || result.meta.title);\n        }\n      }\n    });\n    if (summary.length) {\n      this.addPointerOverlay(summary.join('\\n'));\n    }\n  }\n\n  /**\n   * On map pointermove\n   */\n  private listenToMapPointerMove() {\n    this.pointerMoveListener = this.map.ol.on(\n      'pointermove',\n      (event: MapBrowserPointerEvent<any>) => this.onMapEvent(event)\n    );\n  }\n\n  /**\n   * Unsubscribe to pointer store.\n   * @internal\n   */\n  unsubscribeToPointerStore() {\n    this.store$$.unsubscribe();\n  }\n  /**\n   * Unsubscribe to reverse seatch store.\n   * @internal\n   */\n  unsubscribeReverseSearch() {\n    this.reverseSearch$$.map(s => s.unsubscribe());\n    this.reverseSearch$$ = [];\n  }\n\n  /**\n   * Stop listening for map pointermove\n   * @internal\n   */\n  private unlistenToMapPointerMove() {\n    unByKey(this.pointerMoveListener);\n    this.pointerMoveListener = undefined;\n  }\n\n  /**\n   * Trigger reverse search when the mouse is motionless during the defined delay (pointerMoveDelay).\n   * @param event OL map browser pointer event\n   */\n  private onMapEvent(event: MapBrowserPointerEvent<any>) {\n    if (\n      event.dragging || !this.igoSearchPointerSummaryEnabled ||\n      !this.hasPointerReverseSearchSource || this.mediaService.isTouchScreen()) {\n      this.clearLayer();\n      return;\n    }\n    if (typeof this.lastTimeoutRequest !== 'undefined') { // cancel timeout when the mouse moves\n      clearTimeout(this.lastTimeoutRequest);\n      this.clearLayer();\n      this.unsubscribeReverseSearch();\n    }\n\n    this.lonLat = transform(event.coordinate, this.mapProjection, 'EPSG:4326') as [number, number];\n\n    this.lastTimeoutRequest = setTimeout(() => {\n      this.onSearchCoordinate();\n    }, this.igoSearchPointerSummaryDelay);\n  }\n\n    /**\n   * Sort the results by display order.\n   * @param r1 First result\n   * @param r2 Second result\n   */\n     private sortByOrder(r1: SearchResult, r2: SearchResult) {\n      return r1.source.displayOrder - r2.source.displayOrder;\n    }\n\n  private onSearchCoordinate() {\n    this.pointerSearchStore.clear();\n    const results = this.searchService.reverseSearch(this.lonLat, { params: { geometry: 'false', icon: 'false' } }, true);\n\n    for (const i in results) {\n      if (results.length > 0) {\n        this.reverseSearch$$.push(\n          results[i].request.subscribe((_results: SearchResult<Feature>[]) => {\n            this.onSearch({ research: results[i], results: _results });\n          }));\n      }\n    }\n  }\n\n  private onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    const newResults = this.pointerSearchStore.all()\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n    this.pointerSearchStore.load(newResults.sort(this.sortByOrder));\n  }\n\n  /**\n   * Add a feature to the pointer store\n   * @param text string\n   */\n  private addPointerOverlay(text: string) {\n    this.clearLayer();\n\n    const geometry = new olgeom.Point(\n      transform(this.lonLat, 'EPSG:4326', this.mapProjection)\n    );\n    const feature = new olFeature({ geometry });\n    const geojsonGeom = new OlGeoJSON().writeGeometryObject(geometry, {\n      featureProjection: this.mapProjection,\n      dataProjection: this.mapProjection\n    }) as FeatureGeometry;\n\n    const f: Feature = {\n      type: FEATURE,\n      geometry: geojsonGeom,\n      projection: this.mapProjection,\n      properties: {\n        id: this.searchPointerSummaryFeatureId,\n        pointerSummary: text\n      },\n      meta: {\n        id: this.searchPointerSummaryFeatureId\n      },\n      ol: feature\n    };\n    this.store.setLayerFeatures([f], FeatureMotion.None);\n  }\n\n/**\n * Clear the pointer store features\n */\nprivate clearLayer() {\n  if (this.store) {\n    this.store.clearLayer();\n  }\n}\n\n}\n\n/**\n * Create a default style for the pointer position and it's label summary.\n * @param feature OlFeature\n * @returns OL style function\n */\nexport function pointerPositionSummaryMarker(feature: olFeature<OlGeometry>, resolution: number): olstyle.Style {\n  return new olstyle.Style({\n    image: new olstyle.Icon({\n      src: './assets/igo2/geo/icons/cross_black_18px.svg',\n      imgSize: [18, 18], // for ie\n    }),\n\n    text: new olstyle.Text({\n      text: feature.get('pointerSummary'),\n      textAlign: 'left',\n      textBaseline: 'bottom',\n      font: '12px Calibri,sans-serif',\n      fill: new olstyle.Fill({ color: '#000' }),\n      backgroundFill: new olstyle.Fill({ color: 'rgba(255, 255, 255, 0.5)' }),\n      backgroundStroke: new olstyle.Stroke({ color: 'rgba(200, 200, 200, 0.75)', width: 2 }),\n      stroke: new olstyle.Stroke({ color: '#fff', width: 3 }),\n      overflow: true,\n      offsetX: 10,\n      offsetY: -10,\n      padding: [2.5, 2.5, 2.5, 2.5]\n    })\n  });\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { SearchService } from './shared/search.service';\nimport { provideSearchSourceService } from './shared/search-source-service.providers';\nimport { provideDefaultIChercheSearchResultFormatter } from './shared/sources/icherche.providers';\nimport { provideDefaultCoordinatesSearchResultFormatter } from './shared/sources/coordinates.providers';\nimport { provideILayerSearchResultFormatter } from './shared/sources/ilayer.providers';\n\nimport { IgoSearchBarModule } from './search-bar/search-bar.module';\nimport { IgoSearchSelectorModule } from './search-selector/search-selector.module';\nimport { IgoSearchResultsModule } from './search-results/search-results.module';\nimport { IgoSearchSettingsModule } from './search-settings/search-settings.module';\nimport { SearchPointerSummaryDirective } from './shared/search-pointer-summary.directive';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule\n  ],\n  exports: [\n    IgoSearchBarModule,\n    IgoSearchSelectorModule,\n    IgoSearchResultsModule,\n    IgoSearchSettingsModule,\n    SearchPointerSummaryDirective\n  ],\n  declarations: [SearchPointerSummaryDirective]\n})\nexport class IgoSearchModule {\n  static forRoot(): ModuleWithProviders<IgoSearchModule> {\n    return {\n      ngModule: IgoSearchModule,\n      providers: [\n        SearchService,\n        provideSearchSourceService(),\n        provideDefaultIChercheSearchResultFormatter(),\n        provideDefaultCoordinatesSearchResultFormatter(),\n        provideILayerSearchResultFormatter()\n      ]\n    };\n  }\n}\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy,\n  ChangeDetectorRef\n} from '@angular/core';\n\nimport { OnUpdateInputs, WidgetComponent } from '@igo2/common';\n\nimport { Layer } from '../../../layer/shared/layers/layer';\nimport { IgoMap } from '../../../map/shared/map';\n\n@Component({\n  selector: 'igo-ogc-filter',\n  templateUrl: './ogc-filter.component.html',\n  styleUrls: ['./ogc-filter.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class OgcFilterComponent implements OnUpdateInputs, WidgetComponent {\n\n  @Input() layer: Layer;\n\n  @Input() map: IgoMap;\n\n  /**\n   * Event emitted on complete\n   */\n  @Output() complete = new EventEmitter<void>();\n\n  /**\n   * Event emitted on cancel\n   */\n  @Output() cancel = new EventEmitter<void>();\n\n  constructor(private cdRef: ChangeDetectorRef) {}\n\n  /**\n   * Implemented as part of OnUpdateInputs\n   */\n  onUpdateInputs() {\n    this.cdRef.detectChanges();\n  }\n\n  /**\n   * On close, emit the cancel event\n   */\n  onClose() {\n    this.cancel.emit();\n  }\n\n}\n","<igo-ogc-filterable-item\n  igoListItem\n  [layer]=\"layer\"\n  [header]=\"false\" \n  [map]=\"map\" >\n</igo-ogc-filterable-item>","import { InjectionToken } from '@angular/core';\n\nimport { Widget, WidgetService } from '@igo2/common';\n\nimport { OgcFilterComponent } from './ogc-filter/ogc-filter.component';\n\nexport const OgcFilterWidget = new InjectionToken<Widget>('OgcFilterWidget');\n\nexport function ogcFilterWidgetFactory(widgetService: WidgetService): Widget {\n  return widgetService.create(OgcFilterComponent);\n}\n\nexport function provideOgcFilterWidget() {\n  return {\n    provide: OgcFilterWidget,\n    useFactory: ogcFilterWidgetFactory,\n    deps: [WidgetService]\n  };\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { IgoLanguageModule } from '@igo2/core';\n\nimport { IgoFilterModule } from '../../../filter/filter.module';\nimport { OgcFilterComponent } from './ogc-filter.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    IgoFilterModule\n  ],\n  exports: [OgcFilterComponent],\n  declarations: [OgcFilterComponent]\n})\nexport class IgoOgcFilterModule {}\n","import {\n  Workspace,\n  WorkspaceOptions\n} from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nexport interface WfsWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class WfsWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  constructor(protected options: WfsWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n\n  public getLayerWksOptionTabQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\n      return this.layer.options.workspace.queryOptions.tabQuery;\n    }\n    return true;\n  }\n\n  public getLayerWksOptionMapQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined) {\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\n    }\n    return true;\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport {\n  ActionStore,\n  EntityTableTemplate,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityRecord,\n  EntityStoreStrategyFuncOptions,\n  EntityStoreFilterSelectionStrategy,\n  EntityTableColumnRenderer\n} from '@igo2/common';\n\nimport {\n  FeatureStore,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureStoreInMapExtentStrategy,\n  Feature,\n  FeatureMotion,\n  FeatureStoreInMapResolutionStrategy\n} from '../../feature';\nimport { VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams, FeatureDataSource, RelationOptions } from '../../datasource';\nimport { getCommonVectorSelectedStyle} from '../../utils';\n\nimport { WfsWorkspace } from './wfs-workspace';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { StorageService, ConfigService } from '@igo2/core';\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n@Injectable({\n  providedIn: 'root'\n})\nexport class WfsWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(private storageService: StorageService, private configService: ConfigService) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): WfsWorkspace {\n    if (layer.options.workspace?.enabled === false || layer.dataSource.options.edition) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace,\n      {\n        srcId: layer.id,\n        workspaceId: layer.id,\n        enabled: true\n      } as GeoWorkspaceOptions);\n\n    const wks = new WfsWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    this.createTableTemplate(wks, layer);\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], {map});\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle= this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(Object.assign({}, {feature}, confQueryOverlayStyle.selection || {}));\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: WfsWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n        .filter(\n          col => !col.startsWith('_') &&\n          col !== 'geometry' &&\n          col !== ol.getGeometryName() &&\n          !col.match(/boundedby/gi))\n        .map(key => {\n          return {\n            name: `properties.${key}`,\n            title: key,\n            renderer: EntityTableColumnRenderer.UnsanitizedHTML\n          };\n        });\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n        tooltip: field.tooltip\n      };\n    });\n\n    const relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n            this.ws$.next(relation.title);\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport {\n  ActionStore,\n  EntityRecord,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  EntityStoreStrategyFuncOptions,\n  EntityTableColumnRenderer,\n  EntityTableTemplate } from '@igo2/common';\nimport { StorageService, ConfigService } from '@igo2/core';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { RelationOptions, SourceFieldsOptionsParams, WMSDataSource } from '../../datasource';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy } from '../../feature';\n\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport { ImageLayer, LayerService, LayersLinkProperties, LinkedProperties, VectorLayer } from '../../layer';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { WfsWorkspace } from './wfs-workspace';\nimport { getCommonVectorSelectedStyle} from '../../utils';\n\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WmsWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(\n    private layerService: LayerService,\n    private storageService: StorageService,\n    private styleService: StyleService,\n    private configService: ConfigService) { }\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): WfsWorkspace {\n    if (\n      !layer.options.workspace ||\n      map.layers.find(lay => lay.id === layer.id + '.WfsWorkspaceTableDest') ||\n      layer.dataSource.options.edition) {\n      return;\n    }\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource ;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [\n        LinkedProperties.ZINDEX,\n        LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n       linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if ((dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(JSON.stringify(layer.options.linkedLayers.links));\n    }\n    clonedLinks.push(linkProperties);\n\n    layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId ? layer.options.linkedLayers.linkId : wmsLinkId,\n      layer.options.linkedLayers.links = clonedLinks;\n    interface WFSoptions extends WFSDataSourceOptions, OgcFilterableDataSourceOptions { }\n\n    let wks;\n    let wksLayerOption = {\n      srcId: layer.id,\n      workspaceId: undefined,\n      enabled: false,\n      queryOptions: {\n        mapQueryOnOpenTab: layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n        tabQuery: layer.options.workspace?.queryOptions?.tabQuery\n      },\n      pageSize: layer.options.workspace?.pageSize,\n      pageSizeOptions: layer.options.workspace?.pageSizeOptions\n    };\n\n    this.layerService\n      .createAsyncLayer({\n        isIgoInternalLayer: true,\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: wksLayerOption,\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution: layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution: layer.options.workspace?.maxResolution || layer.maxResolution || Infinity,\n        style: this.styleService.createStyle(\n          {\n            fill: {\n              \"color\": \"rgba(255, 255, 255, 0.01)\"\n            },\n            stroke: {\n              \"color\": \"rgba(255, 255, 255, 0.01)\"\n            },\n            circle: {\n              fill: {\n                color: \"rgba(255, 255, 255, 0.01)\"\n              },\n              stroke: {\n                color: \"rgba(255, 255, 255, 0.01)\"\n              },\n              radius: 5\n            }\n          }),\n        sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          relations: dataSource.options.relations,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions).queryTitle,\n          queryFormatAsWms: layer.options.workspace?.enabled ? (dataSource.options as QueryableDataSourceOptions).queryFormatAsWms : true,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters, {enabled: hasOgcFilters}),\n          sourceFields: dataSource.options.sourceFields || undefined\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties({ linkedLayers: { linkId: layer.options.linkedLayers.linkId, links: clonedLinks } }, false);\n        workspaceLayer.dataSource.ol.refresh();\n\n        if (!layer.options.workspace?.enabled) {\n          return;\n        }\n        wks = new WfsWorkspace({\n          id: layer.id,\n          title: layer.title,\n          layer: workspaceLayer,\n          map,\n          entityStore: this.createFeatureStore(workspaceLayer, map),\n          actionStore: new ActionStore([]),\n          meta: {\n            tableTemplate: undefined\n          }\n        });\n        this.createTableTemplate(wks, workspaceLayer);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace,\n          {\n            enabled: true,\n            srcId: layer.id,\n            workspaceId: workspaceLayer.id,\n            queryOptions: {\n              mapQueryOnOpenTab: layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n              tabQuery: layer.options.workspace?.queryOptions?.tabQuery\n            },\n            pageSize: layer.options.workspace?.pageSize,\n            pageSizeOptions: layer.options.workspace?.pageSizeOptions\n          } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle= this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(Object.assign({}, {feature}, confQueryOverlayStyle.selection || {}));\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: WfsWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n          .filter(\n            col => !col.startsWith('_') &&\n              col !== 'geometry' &&\n              col !== ol.getGeometryName() &&\n              !col.match(/boundedby/gi))\n          .map(key => {\n            return {\n              name: `properties.${key}`,\n              title: key,\n              renderer: EntityTableColumnRenderer.UnsanitizedHTML\n            };\n          });\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n        tooltip: field.tooltip\n      };\n    });\n\n    const relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n            this.ws$.next(relation.title);\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { LanguageService } from '@igo2/core';\nimport { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nexport interface DialogData {\n  type: string;\n  cancel: boolean;\n}\n\n@Component({\n    selector: 'igo-confirmation-popup-component',\n    templateUrl: './confirmation-popup.component.html',\n    styleUrls: ['./confirmation-popup.component.scss']\n  })\n  export class ConfirmationPopupComponent {\n\n    constructor(\n      public dialogRef: MatDialogRef<ConfirmationPopupComponent>,\n      public languageService: LanguageService,\n      @Inject(MAT_DIALOG_DATA) public data: {type: string, cancel: boolean}) {}\n\n    cancelAction() {\n      this.data.cancel = true;\n      this.dialogRef.close(this.data.cancel);\n    }\n\n    confirmedAction() {\n      this.data.cancel = false;\n      this.dialogRef.close(this.data.cancel);\n    }\n  }\n","<div mat-dialog-content>\n  <p class=\"mat-typography\">{{data.type === 'add' ?\n    languageService.translate.instant('igo.geo.workspace.addConfirmation') :\n    languageService.translate.instant('igo.geo.workspace.deleteConfirmation')}}</p>\n</div>\n<div mat-dialog-actions>\n  <button\n    mat-raised-button\n    color=\"primary\"\n    (click)=\"confirmedAction()\">Ok\n  </button>\n  <button\n    mat-raised-button\n    (click)=\"cancelAction()\">{{languageService.translate.instant('igo.geo.workspace.cancel')}}\n  </button>\n</div>","import { MatDialog } from '@angular/material/dialog';\nimport {\n  Workspace,\n  WorkspaceOptions,\n  EntityRecord\n} from '@igo2/common';\nimport { ConfigService } from '@igo2/core';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\nimport { ImageLayer, VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\nimport { EditionWorkspaceService } from './edition-workspace.service';\nimport { ConfirmationPopupComponent } from '../confirmation-popup/confirmation-popup.component';\nimport { DrawControl } from '../../geometry';\nimport { createInteractionStyle, GeometryType } from '../../draw';\nimport { featureToOl } from '../../feature';\n\nimport type { Type } from 'ol/geom/Geometry';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport OlGeoJSON from 'ol/format/GeoJSON';\nimport OlVectorSource from 'ol/source/Vector';\nimport * as OlStyle from 'ol/style';\nimport OlModify from 'ol/interaction/Modify';\nimport Collection from 'ol/Collection';\nimport OlFeature from 'ol/Feature';\nimport { FeatureDataSource } from '../../datasource/shared';\n\nexport interface EditionWorkspaceOptions extends WorkspaceOptions {\n  layer: ImageLayer | VectorLayer;\n  map: IgoMap;\n}\n\nexport class EditionWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): ImageLayer | VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  private drawControl: DrawControl;\n  private drawEnd$$: Subscription;\n  private olDrawingLayerSource = new OlVectorSource();\n  private olDrawingLayer: VectorLayer;\n  public geometryType = GeometryType; // Reference to the GeometryType enum\n  public modify; // Reference to the ol interaction\n\n  public modifyStyle = new OlStyle.Style({\n    stroke: new OlStyle.Stroke({\n      color: 'rgba(255,255,255,1)',\n      width: 1\n    }),\n    fill: new OlStyle.Fill({\n      color: 'rgba(0,161,222,1)'\n    }),\n    image: new OlStyle.Circle({\n      radius: 7,\n      stroke: new OlStyle.Stroke({\n        color: 'rgba(255,255,255,1)',\n        width: 1\n      }),\n      fill: new OlStyle.Fill({\n        color: 'rgba(0,161,222,1)'\n      })\n    })\n  });\n\n  private newFeaturefilterClauseFunc = (record: EntityRecord<object>) => {\n    return record.state.newFeature === true;\n  };\n\n  private editFeaturefilterClauseFunc = (record: EntityRecord<object>) => {\n    return record.state.edit === true;\n  };\n\n  public fillColor: string;\n  public strokeColor: string;\n  public strokeWidth: number;\n\n  constructor(\n    protected options: EditionWorkspaceOptions,\n    private editionWorkspaceService: EditionWorkspaceService,\n    private dialog: MatDialog,\n    private configService: ConfigService) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n\n    this.drawControl = this.createDrawControl();\n    this.drawControl.setGeometryType(this.geometryType.Point as any);\n\n    this.map.removeLayer(this.olDrawingLayer);\n\n    this.olDrawingLayer = new VectorLayer({\n      id: 'igo-draw-layer',\n      title: 'edition',\n      zIndex: 300,\n      source: new FeatureDataSource(),\n      showInLayerList: false,\n      exportable: false,\n      browsable: false,\n      workspace: {\n        enabled: false\n      },\n    });\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n\n  deleteFeature(feature, workspace) {\n    setTimeout(() => {\n      const dialogRef = this.dialog.open(ConfirmationPopupComponent, {\n        disableClose: false,\n        data: {type: 'delete'}\n    });\n\n      dialogRef.afterClosed().subscribe(result => {\n        if (result === false) {\n          let id, url;\n          const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\n          const deleteUrl = workspace.layer.dataSource.options.edition.deleteUrl;\n          if (baseUrl.length) {\n            url = this.configService.getConfig('edition.url') ?\n              this.configService.getConfig('edition.url') + baseUrl + '?' + deleteUrl :\n              baseUrl + '?' + deleteUrl;\n          } else {\n            url = this.configService.getConfig('edition.url') ?\n              this.configService.getConfig('edition.url') + deleteUrl : deleteUrl;\n          }\n\n          for (const column of workspace.meta.tableTemplate.columns) {\n            for (const property in feature.properties) {\n              let columnName = column.name;\n              if (columnName.includes('properties.')) {\n                columnName = columnName.split('.')[1];\n              }\n              if (columnName === property && column.primary === true) {\n                id = feature.properties[property];\n              }\n            }\n          }\n          if (url) {\n            url += id;\n            this.editionWorkspaceService.deleteFeature(workspace, url);\n          }\n        }\n      });\n    }, 250);\n  }\n\n  editFeature(feature, workspace: EditionWorkspace) {\n    feature.edition = true;\n    let id;\n    let find = false;\n    const editionOpt = workspace.layer.dataSource.options.edition;\n    for (const column of workspace.meta.tableTemplate.columns ) {\n\n      // Update domain list\n      if (column.type === 'list' || column.type === 'autocomplete') {\n        this.editionWorkspaceService.getDomainValues(column.relation).subscribe(result => {\n          column.domainValues = result;\n        });\n      }\n      if (find === false) {\n        for (const property in feature.properties) {\n          let columnName = column.name;\n          if (columnName.includes('properties.')) {\n            columnName = columnName.split('.')[1];\n          }\n          if (columnName === property && column.primary === true) {\n            id = feature.properties[property];\n            find = true;\n            break;\n          }\n        }\n      }\n    }\n    if (id) {\n      feature.original_properties = JSON.parse(JSON.stringify(feature.properties));\n      feature.original_geometry = feature.geometry;\n      feature.idkey = id;\n      workspace.entityStore.state.updateAll({ edit: false });\n      workspace.entityStore.stateView.filter(this.editFeaturefilterClauseFunc);\n      this.addFeatureToStore(feature, workspace);\n    } else {\n      // Only for edition with it's own geometry\n      if (!feature.newFeature && editionOpt.geomType) {\n        feature.newFeature = true;\n        this.editionWorkspaceService.adding$.next(true);\n        workspace.entityStore.state.updateAll({ newFeature: false });\n        workspace.entityStore.stateView.filter(this.newFeaturefilterClauseFunc);\n        if (editionOpt.addWithDraw) {\n          const geometryType = editionOpt.geomType;\n          this.onGeometryTypeChange(geometryType, feature, workspace);\n        } else {\n          workspace.entityStore.insert(feature);\n          workspace.entityStore.state.update(feature, { newFeature: true }, true);\n        }\n      }\n    }\n  }\n\n  /**\n   * Create a Draw Control\n   * @param fillColor the fill color\n   * @param strokeColor the stroke color\n   * @param strokeWidth the stroke width\n   * @returns a Draw Control\n   */\n  createDrawControl(fillColor?: string, strokeColor?: string, strokeWidth?: number) {\n    const drawControl = new DrawControl({\n      geometryType: undefined,\n      drawingLayerSource: this.olDrawingLayerSource,\n      drawingLayerStyle: new OlStyle.Style({}),\n      interactionStyle: createInteractionStyle(fillColor, strokeColor, strokeWidth),\n    });\n\n    return drawControl;\n  }\n\n  /**\n   * Called when the user selects a new geometry type\n   * @param geometryType the geometry type selected by the user\n   */\n  onGeometryTypeChange(geometryType: Type, feature, workspace: EditionWorkspace) {\n      this.drawControl.setGeometryType(geometryType);\n      this.toggleDrawControl(feature, workspace);\n    }\n\n  /**\n   * Activate the correct control\n   */\n  private toggleDrawControl(feature, workspace: EditionWorkspace) {\n    this.deactivateDrawControl();\n    this.activateDrawControl(feature, workspace);\n  }\n\n  /**\n   * Deactivate the active draw control\n   */\n  public deactivateDrawControl() {\n    if (!this.drawControl) {\n      return;\n    }\n\n    if (this.drawEnd$$) {\n      this.drawEnd$$.unsubscribe();\n    }\n\n    this.drawControl.setOlMap(undefined);\n  }\n\n  /**\n   * Activate a given control\n   */\n  private activateDrawControl(feature, workspace: EditionWorkspace) {\n    this.drawEnd$$ = this.drawControl.end$.subscribe((olGeometry: OlGeometry) => {\n      this.addFeatureToStore(feature, workspace, olGeometry);\n    });\n\n    this.drawControl.setOlMap(this.map.ol, true);\n  }\n\n  /**\n   * Add a feature to layer. The loading strategy of the layer\n   * will trigger and add the feature to the workspace store.\n   * @internal\n   */\n  private addFeatureToStore(feature, workspace: EditionWorkspace, olGeometry?: OlGeometry) {\n    const projection = this.map.ol.getView().getProjection();\n    let geometry = feature.geometry;\n\n    // If an olGeometry is passed, it means that it is a new feature\n    if (olGeometry) {\n      workspace.entityStore.insert(feature);\n      workspace.entityStore.state.update(feature, { newFeature: true }, true);\n      geometry = new OlGeoJSON().writeGeometryObject(olGeometry, {\n        featureProjection: projection,\n        dataProjection: 'EPSG:4326'\n      }) as any;\n\n      feature.geometry = geometry;\n    } else {\n      workspace.entityStore.state.update(feature, { edit: true }, true);\n    }\n\n    feature.projection = 'EPSG:4326';\n\n    const featureOl = featureToOl(feature, projection.getCode());\n\n    this.olDrawingLayer.dataSource.ol.clear();\n    this.olDrawingLayer.dataSource.ol.addFeature(featureOl);\n    this.map.addLayer(this.olDrawingLayer);\n\n    this.deactivateDrawControl();\n    this.createModifyInteraction(featureOl, feature, workspace);\n  }\n\n  /**\n   * Delete drawings layer and source from the map AND feature from the entity store.\n   * Layer refresh will automatically add the new feature into the store.\n   */\n  deleteDrawings() {\n    this.map.removeLayer(this.olDrawingLayer);\n    this.olDrawingLayerSource.clear();\n    this.map.ol.removeInteraction(this.modify);\n  }\n\n  /**\n   * Create a modify interaction to allow a geometry change one feature at the time (drag and drop)\n   */\n  createModifyInteraction(olFeature: OlFeature<OlGeometry>, feature, workspace: EditionWorkspace) {\n    this.map.ol.removeInteraction(this.modify);\n    const olCollection = new Collection([olFeature], { unique: true });\n    this.modify = new OlModify({\n      features: olCollection\n    });\n\n    this.map.ol.addInteraction(this.modify);\n    olCollection.forEach(feature => {\n      feature.setStyle(this.modifyStyle);\n    });\n\n    this.modify.on('modifyend', (event) => {\n      const olGeometry = event.features.getArray()[0]?.getGeometry();\n      if (olGeometry) {\n        this.addFeatureToStore(feature, workspace, olGeometry);\n      }\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpErrorResponse, HttpHeaders } from '@angular/common/http';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport {\n  ActionStore,\n  EntityRecord,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  EntityStoreStrategyFuncOptions,\n  EntityTableColumnRenderer,\n  EntityTableTemplate,\n  EntityTableButton} from '@igo2/common';\nimport { ConfigService, LanguageService, MessageService, StorageService } from '@igo2/core';\nimport { AuthInterceptor } from '@igo2/auth';\nimport { catchError, map, skipWhile, take } from 'rxjs/operators';\nimport { RelationOptions, SourceFieldsOptionsParams, WMSDataSource } from '../../datasource';\nimport { FeatureDataSource } from '../../datasource/shared/datasources/feature-datasource';\nimport { WFSDataSourceOptions } from '../../datasource/shared/datasources/wfs-datasource.interface';\nimport {\n  Feature,\n  FeatureMotion,\n  FeatureStore,\n  FeatureStoreInMapExtentStrategy,\n  FeatureStoreInMapResolutionStrategy,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy} from '../../feature';\n\nimport { OgcFilterableDataSourceOptions } from '../../filter/shared/ogc-filter.interface';\nimport { ImageLayer, LayerService, LayersLinkProperties, LinkedProperties, VectorLayer } from '../../layer';\nimport { StyleService } from '../../layer/shared/style.service';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\nimport { EditionWorkspace } from './edition-workspace';\n\nimport WKT from 'ol/format/WKT';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport olFeature from 'ol/Feature';\nimport olSourceImageWMS from 'ol/source/ImageWMS';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { BehaviorSubject, Observable, throwError } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EditionWorkspaceService {\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n  public adding$ = new BehaviorSubject<boolean>(false);\n  public relationLayers$ = new BehaviorSubject<ImageLayer[] | VectorLayer[]>(undefined);\n  public rowsInMapExtentCheckCondition$ = new BehaviorSubject<boolean>(true);\n  public loading = false;\n  public wktFormat = new WKT();\n  public geoJsonFormat = new GeoJSON();\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    private layerService: LayerService,\n    private storageService: StorageService,\n    private configService: ConfigService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private http: HttpClient,\n    private dialog: MatDialog,\n    private styleService: StyleService,\n    public authInterceptor?: AuthInterceptor) { }\n\n  createWorkspace(layer: ImageLayer, map: IgoMap): EditionWorkspace {\n    if (layer.options.workspace?.enabled !== true || layer.dataSource.options.edition.enabled !== true) {\n      return;\n    }\n    let wksConfig;\n    if (layer.options.workspace) {\n      wksConfig = layer.options.workspace;\n    } else {\n      wksConfig = {};\n    }\n    wksConfig.srcId = layer.id;\n    wksConfig.workspaceId = layer.id;\n    wksConfig.enabled = true;\n    wksConfig.pageSize = layer.options.workspace?.pageSize;\n    wksConfig.pageSizeOptions = layer.options.workspace?.pageSizeOptions;\n\n    const dataSource: WMSDataSource = layer.dataSource as WMSDataSource ;\n    const wmsLinkId = layer.id + '.WmsWorkspaceTableSrc';\n    const wfsLinkId = layer.id + '.WfsWorkspaceTableDest';\n    if (!layer.options.linkedLayers) {\n      layer.options.linkedLayers = { linkId: wmsLinkId, links: [] };\n    }\n    const linkProperties = {\n      syncedDelete: true,\n      linkedIds: [wfsLinkId],\n      properties: [\n        LinkedProperties.ZINDEX,\n        LinkedProperties.VISIBLE]\n    } as LayersLinkProperties;\n\n    if (!layer.options.workspace?.minResolution) {\n       linkProperties.properties.push(LinkedProperties.MINRESOLUTION);\n    }\n    let hasOgcFilters = false;\n    if ((dataSource.options as OgcFilterableDataSourceOptions).ogcFilters?.enabled) {\n      linkProperties.properties.push(LinkedProperties.OGCFILTERS);\n      hasOgcFilters = true;\n    }\n    if (!layer.options.workspace?.maxResolution) {\n      linkProperties.properties.push(LinkedProperties.MAXRESOLUTION);\n    }\n\n    let clonedLinks: LayersLinkProperties[] = [];\n    if (layer.options.linkedLayers.links) {\n      clonedLinks = JSON.parse(JSON.stringify(layer.options.linkedLayers.links));\n    }\n    clonedLinks.push(linkProperties);\n\n    layer.options.linkedLayers.linkId = layer.options.linkedLayers.linkId ? layer.options.linkedLayers.linkId : wmsLinkId,\n      layer.options.linkedLayers.links = clonedLinks;\n    interface WFSoptions extends WFSDataSourceOptions, OgcFilterableDataSourceOptions { }\n    let wks;\n    this.layerService\n      .createAsyncLayer({\n        id: wfsLinkId,\n        linkedLayers: {\n          linkId: wfsLinkId\n        },\n        workspace: {\n          srcId: layer.id,\n          workspaceId: undefined,\n          enabled: false,\n          queryOptions: {\n            mapQueryOnOpenTab: layer.options.workspace?.queryOptions?.mapQueryOnOpenTab,\n            tabQuery: false\n          },\n          pageSize: layer.options.workspace?.pageSize,\n          pageSizeOptions: layer.options.workspace?.pageSizeOptions\n        },\n        showInLayerList: false,\n        opacity: 0,\n        title: layer.title,\n        minResolution: layer.options.workspace?.minResolution || layer.minResolution || 0,\n        maxResolution: layer.options.workspace?.maxResolution || layer.maxResolution || Infinity,\n        style: this.styleService.createStyle(\n          {\n            fill: {\n              \"color\": \"rgba(255, 255, 255, 0.01)\"\n            },\n            stroke: {\n              \"color\": \"rgba(255, 255, 255, 0.01)\"\n            },\n            circle: {\n              fill: {\n                color: \"rgba(255, 255, 255, 0.01)\"\n              },\n              stroke: {\n                color: \"rgba(255, 255, 255, 0.01)\"\n              },\n              radius: 5\n            }\n          }),\n          sourceOptions: {\n          download: dataSource.options.download,\n          type: 'wfs',\n          url: dataSource.options.urlWfs || dataSource.options.url,\n          queryable: true,\n          relations: dataSource.options.relations,\n          queryTitle: (dataSource.options as QueryableDataSourceOptions).queryTitle,\n          params: dataSource.options.paramsWFS,\n          ogcFilters: Object.assign({}, dataSource.ogcFilters, {enabled: hasOgcFilters}),\n          sourceFields: dataSource.options.sourceFields || undefined,\n          edition: dataSource.options.edition\n        } as WFSoptions\n      })\n      .subscribe((workspaceLayer: VectorLayer) => {\n        map.addLayer(workspaceLayer);\n        layer.ol.setProperties({ linkedLayers: { linkId: layer.options.linkedLayers.linkId, links: clonedLinks } }, false);\n        workspaceLayer.dataSource.ol.refresh();\n\n        wks = new EditionWorkspace({\n          id: layer.id,\n          title: layer.title,\n          layer: workspaceLayer,\n          map,\n          entityStore: this.createFeatureStore(workspaceLayer, map),\n          actionStore: new ActionStore([]),\n          meta: {\n            tableTemplate: undefined\n          }\n        }, this, this.dialog, this.configService);\n        this.createTableTemplate(wks, workspaceLayer);\n\n        workspaceLayer.options.workspace.workspaceId = workspaceLayer.id;\n        layer.options.workspace = Object.assign({}, layer.options.workspace,\n          {\n            wksConfig\n          } as GeoWorkspaceOptions);\n\n        delete dataSource.options.download;\n        return wks;\n\n      });\n\n    return wks;\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], { map });\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: undefined,\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: EditionWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    let rendererType = EntityTableColumnRenderer.UnsanitizedHTML;\n    let buttons = [];\n    let columns = [];\n    let relationsColumn = [];\n\n    buttons = [{\n      name: 'edition',\n      title: undefined,\n      renderer: EntityTableColumnRenderer.ButtonGroup,\n      primary: false,\n      valueAccessor: () => {\n        return [{\n          editMode: false,\n          icon: 'pencil',\n          color: 'primary',\n          disabled: layer.dataSource.options.edition.modifyButton === false ? true : false,\n          click: (feature) => { workspace.editFeature(feature, workspace); }\n        },\n        {\n          editMode: false,\n          icon: 'delete',\n          color: 'warn',\n          disabled: layer.dataSource.options.edition.deleteButton === false ? true : false,\n          click: (feature) => { workspace.deleteFeature(feature, workspace); }\n        },\n        {\n          editMode: true,\n          icon: 'check',\n          color: 'primary',\n          disabled: this.loading,\n          click: (feature) => { this.saveFeature(feature, workspace); }\n        },\n        {\n          editMode: true,\n          icon: 'alpha-x',\n          color: 'primary',\n          disabled: this.loading,\n          click: (feature) => { this.cancelEdit(workspace, feature); }\n        }] as EntityTableButton[];\n      }\n    }];\n\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n          .filter(\n            col => !col.startsWith('_') &&\n              col !== 'geometry' &&\n              col !== ol.getGeometryName() &&\n              !col.match(/boundedby/gi))\n          .map(key => {\n            return {\n              name: `properties.${key}`,\n              title: key,\n              renderer: rendererType,\n            };\n          });\n        workspace.meta.tableTemplate = {\n          selection: false,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n\n    columns = fields.map((field: SourceFieldsOptionsParams) => {\n\n      let column = {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: rendererType,\n        valueAccessor: undefined,\n        cellClassFunc: () => {\n          const cellClass = {};\n          if (field.type) {\n            cellClass[`class_${field.type}`] = true;\n            return cellClass;\n          }\n        },\n        primary: field.primary === true ? true : false,\n        visible: field.visible,\n        validation: field.validation,\n        linkColumnForce: field.linkColumnForce,\n        type: field.type,\n        domainValues: undefined,\n        relation: undefined,\n        multiple: field.multiple,\n        step: field.step,\n        tooltip: field.tooltip\n      };\n\n      if (field.type === 'list' || field.type === 'autocomplete') {\n        this.getDomainValues(field.relation).subscribe(result => {\n          column.domainValues = result;\n          column.relation = field.relation;\n        });\n      }\n      return column;\n    });\n\n    relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n          if (this.adding$.getValue() === false) {\n            this.ws$.next(relation.title);\n          }\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    columns.push(...buttons);\n\n    workspace.meta.tableTemplate = {\n      selection: false,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n\n  public saveFeature(feature, workspace: EditionWorkspace) {\n    if (!this.validateFeature(feature, workspace)){\n      return false;\n    }\n\n    this.sanitizeParameter(feature, workspace);\n\n    const baseUrl = workspace.layer.dataSource.options.edition.baseUrl;\n    let url = this.configService.getConfig('edition.url');\n\n    if (!url) {\n      url = baseUrl;\n    } else {\n      url += baseUrl ? baseUrl : '';\n    }\n\n    if (feature.newFeature) {\n      url += workspace.layer.dataSource.options.edition.addUrl;\n\n      const addHeaders = workspace.layer.dataSource.options.edition.addHeaders;\n      const headers = new HttpHeaders(addHeaders);\n\n      this.addFeature(feature, workspace, url, headers);\n    } else {\n      if (workspace.layer.dataSource.options.edition.modifyProtocol !== \"post\") {\n        url += '?' + workspace.layer.dataSource.options.edition.modifyUrl + feature.idkey;\n      }\n      else {\n        url += workspace.layer.dataSource.options.edition.modifyUrl;\n      }\n\n      const protocole = workspace.layer.dataSource.options.edition.modifyProtocol;\n      const modifyHeaders = workspace.layer.dataSource.options.edition.modifyHeaders;\n      const headers = new HttpHeaders(modifyHeaders);\n\n      this.modifyFeature(feature, workspace, url, headers, protocole);\n    }\n  }\n\n  public addFeature(feature, workspace: EditionWorkspace, url: string, headers: {[key: string]: any}) {\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\n      const projDest = workspace.layer.options.sourceOptions.edition.geomDatabaseProj;\n      feature.properties[workspace.layer.dataSource.options.params.fieldNameGeometry] =\n      'SRID=' + projDest.replace(\"EPSG:\", \"\") + ';' + this.wktFormat.writeGeometry(\n        this.geoJsonFormat.readFeature(feature.geometry).getGeometry().transform('EPSG:4326', projDest),\n        { dataProjection: projDest });\n    }\n\n    for (const property in feature.properties) {\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\n        if ((sf.name === property && sf.validation?.readonly) || (sf.name === property && sf.validation?.send === false)) {\n          delete feature.properties[property];\n        }\n      }\n    }\n\n    this.loading = true;\n    this.http.post(`${url}`, feature.properties, { headers: headers }).subscribe(\n      () => {\n        this.loading = false;\n        workspace.entityStore.stateView.clear();\n        workspace.deleteDrawings();\n        workspace.entityStore.delete(feature);\n\n        const message = this.languageService.translate.instant(\n          'igo.geo.workspace.addSuccess'\n        );\n        this.messageService.success(message);\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n        this.adding$.next(false);\n        this.rowsInMapExtentCheckCondition$.next(true);\n      },\n      error => {\n        this.loading = false;\n        error.error.caught = true;\n        const genericErrorMessage = this.languageService.translate.instant(\n          'igo.geo.workspace.addError'\n        );\n        const messages = workspace.layer.dataSource.options.edition.messages;\n        if (messages) {\n          let text;\n          messages.forEach(message => {\n            const key = Object.keys(message)[0];\n            if (error.error.message.includes(key)) {\n              text = message[key];\n              this.messageService.error(text);\n            }\n          });\n          if (!text) {\n            this.messageService.error(genericErrorMessage);\n          }\n        } else {\n          this.messageService.error(genericErrorMessage);\n        }\n      }\n    );\n  }\n\n  public deleteFeature(workspace: EditionWorkspace, url: string) {\n    this.loading = true;\n    this.http.delete(`${url}`, {}).subscribe(\n      () => {\n        this.loading = false;\n        const message = this.languageService.translate.instant(\n          'igo.geo.workspace.deleteSuccess'\n        );\n        this.messageService.success(message);\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n        for (const relation of workspace.layer.options.sourceOptions.relations) {\n          workspace.map.layers.forEach((layer) => {\n            if (layer.title === relation.title) {\n              layer.dataSource.ol.refresh();\n            }\n          });\n        }\n      },\n      error => {\n        this.loading = false;\n        error.error.caught = true;\n          const genericErrorMessage = this.languageService.translate.instant(\n            'igo.geo.workspace.addError'\n          );\n          const messages = workspace.layer.dataSource.options.edition.messages;\n          if (messages) {\n            let text;\n            messages.forEach(message => {\n              const key = Object.keys(message)[0];\n              if (error.error.message.includes(key)) {\n                text = message[key];\n                this.messageService.error(text);\n              }\n            });\n            if (!text) {\n              this.messageService.error(genericErrorMessage);\n            }\n          } else {\n            this.messageService.error(genericErrorMessage);\n          }\n      }\n    );\n  }\n\n  public modifyFeature(feature, workspace: EditionWorkspace, url: string, headers: {[key: string]: any}, protocole = 'patch' ) {\n    if (workspace.layer.dataSource.options.edition.hasGeometry) {\n      const projDest = workspace.layer.options.sourceOptions.edition.geomDatabaseProj;\n      // Remove 3e dimension\n      feature.geometry.coordinates = removeZ(feature.geometry.coordinates);\n      feature.properties[workspace.layer.dataSource.options.params.fieldNameGeometry] =\n        'SRID=' + projDest.replace(\"EPSG:\", \"\") + ';' + this.wktFormat.writeGeometry(\n          this.geoJsonFormat.readFeature(feature.geometry).getGeometry().transform('EPSG:4326', projDest),\n          { dataProjection: projDest });\n    }\n\n    for (const property in feature.properties) {\n      for (const sf of workspace.layer.dataSource.options.sourceFields) {\n        if ((sf.name === property && sf.validation?.readonly) || (sf.name === property && sf.validation?.send === false)\n          || property === 'boundedBy') {\n          delete feature.properties[property];\n        }\n      }\n    }\n\n    this.loading = true;\n    this.http[protocole](`${url}`, feature.properties, { headers: headers }).subscribe(\n      () => {\n        this.loading = false;\n        this.cancelEdit(workspace, feature, true);\n\n        const message = this.languageService.translate.instant(\n          'igo.geo.workspace.modifySuccess'\n        );\n        this.messageService.success(message);\n\n        this.refreshMap(workspace.layer as VectorLayer, workspace.layer.map);\n\n        let relationLayers = [];\n        for (const relation of workspace.layer.options.sourceOptions.relations) {\n          workspace.map.layers.forEach((layer) => {\n            if (layer.title === relation.title) {\n              relationLayers.push(layer);\n              layer.dataSource.ol.refresh();\n            }\n          });\n        }\n        this.relationLayers$.next(relationLayers);\n      },\n      error => {\n        this.loading = false;\n        error.error.caught = true;\n        const genericErrorMessage = this.languageService.translate.instant(\n          'igo.geo.workspace.addError'\n        );\n        const messages = workspace.layer.dataSource.options.edition.messages;\n        if (messages) {\n          let text;\n          messages.forEach(message => {\n            const key = Object.keys(message)[0];\n            if (error.error.message.includes(key)) {\n              text = message[key];\n              this.messageService.error(text);\n            }\n          });\n          if (!text) {\n            this.messageService.error(genericErrorMessage);\n          }\n        } else {\n          this.messageService.error(genericErrorMessage);\n        }\n      }\n    );\n  }\n\n  cancelEdit(workspace: EditionWorkspace, feature, fromSave = false) {\n    feature.edition = false;\n    this.adding$.next(false);\n    workspace.deleteDrawings();\n    workspace.entityStore.stateView.clear();\n\n    if (feature.newFeature) {\n      workspace.entityStore.delete(feature);\n      workspace.deactivateDrawControl();\n\n      this.rowsInMapExtentCheckCondition$.next(true);\n    } else {\n      if (!fromSave) {\n        feature.properties = feature.original_properties;\n        feature.geometry = feature.original_geometry;\n      }\n      delete feature.original_properties;\n      delete feature.original_geometry;\n    }\n  }\n\n  getDomainValues(relation: RelationOptions): Observable<any> {\n    let url = relation.url;\n    if (!url) {\n      url = this.configService.getConfig('edition.url') ?\n        this.configService.getConfig('edition.url') + relation.table : relation.table;\n    }\n\n    return this.http.get<any>(url).pipe(\n      map(result => {\n        return result;\n      }),\n      catchError((err: HttpErrorResponse) => {\n        err.error.caught = true;\n        return throwError(err);\n      })\n    );\n  }\n\n  /*\n   * Refresh both wms and wfs layer\n   * A new wfs loader is used to ensure cache is not retrieving old data\n   * WMS params are updated to ensure layer is correctly refreshed\n   */\n  refreshMap(layer: VectorLayer, map: IgoMap) {\n    const wfsOlLayer = layer.dataSource.ol;\n    const loader = (extent, resolution, proj, success, failure) => {\n      layer.customWFSLoader(\n        layer.ol.getSource(),\n        layer.options.sourceOptions,\n        this.authInterceptor,\n        extent,\n        resolution,\n        proj,\n        success,\n        failure,\n        true\n      );\n    };\n    wfsOlLayer.setLoader(loader);\n    wfsOlLayer.refresh();\n\n    for (const lay of map.layers) {\n      if (\n        lay.id !== layer.id &&\n        lay.options.linkedLayers?.linkId.includes(layer.id.substr(0, layer.id.indexOf('.') - 1)) &&\n        lay.options.linkedLayers?.linkId.includes('WmsWorkspaceTableSrc')\n      )\n        {\n          const wmsOlLayer = lay.dataSource.ol as olSourceImageWMS;\n          let params = wmsOlLayer.getParams();\n          params._t = new Date().getTime();\n          wmsOlLayer.updateParams(params);\n        }\n    }\n  }\n\n  validateFeature(feature, workspace: EditionWorkspace) {\n    const translate = this.languageService.translate;\n    let message ;\n    let key;\n    let valid = true;\n    workspace.meta.tableTemplate.columns.forEach(column => {\n      if (column.hasOwnProperty('validation') && column.validation) {\n        key = getColumnKeyWithoutPropertiesTag(column.name);\n        Object.keys( column.validation).forEach((type) => {\n          switch (type) {\n            case 'mandatory': {\n              if (column.validation[type] && (!feature.properties.hasOwnProperty(key) || !feature.properties[key])) {\n                valid = false;\n                  message = translate.instant('igo.geo.formValidation.mandatory',\n                  {\n                    column: column.title\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            case 'minValue': {\n              if (feature.properties.hasOwnProperty(key) && feature.properties[key] && feature.properties[key] < column.validation[type]) {\n                valid = false;\n                message = translate.instant('igo.geo.formValidation.minValue',\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            case 'maxValue': {\n              if (feature.properties.hasOwnProperty(key) && feature.properties[key] && feature.properties[key] > column.validation[type]) {\n                valid = false;\n                message = translate.instant('igo.geo.formValidation.maxValue',\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            case 'minLength': {\n              if (\n                feature.properties.hasOwnProperty(key) && feature.properties[key] &&\n                feature.properties[key].length < column.validation[type])\n              {\n                valid = false;\n                message = translate.instant('igo.geo.formValidation.minLength',\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            case 'maxLength': {\n              if (\n                feature.properties.hasOwnProperty(key) && feature.properties[key] &&\n                feature.properties[key].length > column.validation[type])\n              {\n                valid = false;\n                message = translate.instant('igo.geo.formValidation.maxLength',\n                  {\n                    column: column.title,\n                    value: column.validation[type]\n                  }\n                );\n                this.messageService.error(message);\n              }\n              break;\n            }\n            }\n          });\n      }\n    });\n    return valid;\n  }\n\n  sanitizeParameter(feature, workspace: EditionWorkspace) {\n    workspace.meta.tableTemplate.columns.forEach(column => {\n      if (column.type === 'list' && feature.properties[getColumnKeyWithoutPropertiesTag(column.name)]) {\n        feature.properties[getColumnKeyWithoutPropertiesTag(column.name)] =\n          feature.properties[getColumnKeyWithoutPropertiesTag(column.name)].toString();\n      }\n\n    });\n  }\n\n}\n\nfunction getColumnKeyWithoutPropertiesTag(column: string) {\n  if (column.includes('properties.')) {\n    return column.split('.')[1];\n  }\n  return column;\n}\n\nfunction removeZ(coords: any) {\n  if (coords.length === 0) return coords;\n  if (typeof coords[0] === 'number') return coords.slice(0, 2);\n  return coords.map(removeZ);\n}\n","import {\n  Workspace,\n  WorkspaceOptions\n} from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\n\nexport interface FeatureWorkspaceOptions extends WorkspaceOptions {\n  layer: VectorLayer;\n  map: IgoMap;\n}\n\nexport class FeatureWorkspace extends Workspace {\n\n  readonly inResolutionRange$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n\n  get layer(): VectorLayer { return this.options.layer; }\n\n  get map(): IgoMap { return this.options.map; }\n\n  constructor(protected options: FeatureWorkspaceOptions) {\n    super(options);\n    this.map.viewController.resolution$.subscribe((mapResolution) => {\n      if (mapResolution > this.layer.minResolution && mapResolution < this.layer.maxResolution) {\n        this.inResolutionRange$.next(true);\n      } else {\n        this.inResolutionRange$.next(false);\n      }\n    });\n  }\n\n  public getLayerWksOptionTabQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.tabQuery !== undefined) {\n      return this.layer.options.workspace.queryOptions.tabQuery;\n    }\n    return true;\n  }\n\n  public getLayerWksOptionMapQuery(): boolean {\n    if (this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab !== undefined) {\n      return this.layer.options.workspace.queryOptions.mapQueryOnOpenTab;\n    }\n    return true;\n  }\n\n  private getInResolutionRange(): boolean {\n    return this.inResolutionRange$.value;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport {\n  ActionStore,\n  EntityTableTemplate,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityRecord,\n  EntityStoreStrategyFuncOptions,\n  EntityStoreFilterSelectionStrategy,\n  EntityTableColumnRenderer\n} from '@igo2/common';\n\nimport {\n  FeatureStore,\n  FeatureStoreLoadingLayerStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureStoreInMapExtentStrategy,\n  Feature,\n  FeatureMotion,\n  FeatureStoreInMapResolutionStrategy\n} from '../../feature';\nimport { VectorLayer } from '../../layer';\nimport { GeoWorkspaceOptions } from '../../layer/shared/layers/layer.interface';\nimport { IgoMap } from '../../map';\nimport { SourceFieldsOptionsParams, FeatureDataSource, RelationOptions } from '../../datasource';\nimport { getCommonVectorSelectedStyle} from '../../utils';\n\nimport { FeatureWorkspace } from './feature-workspace';\nimport { skipWhile, take } from 'rxjs/operators';\nimport { ConfigService, StorageService } from '@igo2/core';\n\nimport olFeature from 'ol/Feature';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FeatureWorkspaceService {\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  public ws$ = new BehaviorSubject<string>(undefined);\n\n  constructor(private storageService: StorageService, private configService: ConfigService) {}\n\n  createWorkspace(layer: VectorLayer, map: IgoMap): FeatureWorkspace {\n    if (layer.options.workspace?.enabled === false || layer.dataSource.options.edition) {\n      return;\n    }\n\n    layer.options.workspace = Object.assign({}, layer.options.workspace,\n      {\n        srcId: layer.id,\n        workspaceId: layer.id,\n        enabled: true\n      } as GeoWorkspaceOptions);\n\n\n    const wks = new FeatureWorkspace({\n      id: layer.id,\n      title: layer.title,\n      layer,\n      map,\n      entityStore: this.createFeatureStore(layer, map),\n      actionStore: new ActionStore([]),\n      meta: {\n        tableTemplate: undefined\n      }\n    });\n    this.createTableTemplate(wks, layer);\n    return wks;\n\n  }\n\n  private createFeatureStore(layer: VectorLayer, map: IgoMap): FeatureStore {\n    const store = new FeatureStore([], {map});\n    store.bindLayer(layer);\n\n    const loadingStrategy = new FeatureStoreLoadingLayerStrategy({});\n    const inMapExtentStrategy = new FeatureStoreInMapExtentStrategy({});\n    const inMapResolutionStrategy = new FeatureStoreInMapResolutionStrategy({});\n    const selectedRecordStrategy = new EntityStoreFilterSelectionStrategy({});\n    const confQueryOverlayStyle= this.configService.getConfig('queryOverlayStyle');\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      layer: new VectorLayer({\n        zIndex: 300,\n        source: new FeatureDataSource(),\n        style: (feature) => {\n          return getCommonVectorSelectedStyle(Object.assign({}, {feature}, confQueryOverlayStyle.selection || {}));\n        },\n        showInLayerList: false,\n        exportable: false,\n        browsable: false\n      }),\n      map,\n      hitTolerance: 15,\n      motion: this.zoomAuto ? FeatureMotion.Default : FeatureMotion.None,\n      many: true,\n      dragBox: true\n    });\n    store.addStrategy(loadingStrategy, true);\n    store.addStrategy(inMapExtentStrategy, true);\n    store.addStrategy(inMapResolutionStrategy, true);\n    store.addStrategy(selectionStrategy, true);\n    store.addStrategy(selectedRecordStrategy, false);\n    store.addStrategy(this.createFilterInMapExtentOrResolutionStrategy(), true);\n    return store;\n  }\n\n  private createTableTemplate(workspace: FeatureWorkspace, layer: VectorLayer): EntityTableTemplate {\n    const fields = layer.dataSource.options.sourceFields || [];\n\n    const relations = layer.dataSource.options.relations || [];\n\n    if (fields.length === 0) {\n      workspace.entityStore.entities$.pipe(\n        skipWhile(val => val.length === 0),\n        take(1)\n      ).subscribe(entities => {\n        const ol = (entities[0] as Feature).ol as olFeature<OlGeometry>;\n        const columnsFromFeatures = ol.getKeys()\n        .filter(\n          col => !col.startsWith('_') &&\n          col !== 'geometry' &&\n          col !== ol.getGeometryName() &&\n          !col.match(/boundedby/gi))\n        .map(key => {\n          return {\n            name: `properties.${key}`,\n            title: key,\n            renderer: EntityTableColumnRenderer.UnsanitizedHTML\n          };\n        });\n        workspace.meta.tableTemplate = {\n          selection: true,\n          sort: true,\n          columns: columnsFromFeatures\n        };\n      });\n      return;\n    }\n    const columns = fields.map((field: SourceFieldsOptionsParams) => {\n      return {\n        name: `properties.${field.name}`,\n        title: field.alias ? field.alias : field.name,\n        renderer: EntityTableColumnRenderer.UnsanitizedHTML,\n        tooltip: field.tooltip\n      };\n    });\n\n    const relationsColumn = relations.map((relation: RelationOptions) => {\n      return {\n        name: `properties.${relation.name}`,\n        title: relation.alias ? relation.alias : relation.name,\n        renderer: EntityTableColumnRenderer.Icon,\n        icon: relation.icon,\n        parent: relation.parent,\n        type: 'relation',\n        tooltip: relation.tooltip,\n        onClick: () => {\n            this.ws$.next(relation.title);\n        },\n        cellClassFunc: () => {\n          return { 'class_icon': true };\n        }\n      };\n    });\n\n    columns.push(...relationsColumn);\n    workspace.meta.tableTemplate = {\n      selection: true,\n      sort: true,\n      columns\n    };\n  }\n\n  private createFilterInMapExtentOrResolutionStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<object>) => {\n      return record.state.inMapExtent === true && record.state.inMapResolution === true;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n}\n","import { Directive, Input, OnInit, OnDestroy, Output, EventEmitter } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { Workspace, WorkspaceStore, WorkspaceSelectorComponent } from '@igo2/common';\n\nimport { Layer, ImageLayer, VectorLayer } from '../../layer';\nimport { IgoMap } from '../../map';\nimport { WFSDataSource, WMSDataSource, FeatureDataSource } from '../../datasource';\nimport { OgcFilterableDataSourceOptions } from '../../filter';\n\nimport { WfsWorkspaceService } from '../shared/wfs-workspace.service';\nimport { WmsWorkspaceService } from '../shared/wms-workspace.service';\nimport { EditionWorkspaceService } from '../shared/edition-workspace.service';\nimport { FeatureWorkspaceService } from '../shared/feature-workspace.service';\nimport { FeatureStoreInMapExtentStrategy } from '../../feature/shared/strategies/in-map-extent';\nimport { QueryableDataSourceOptions } from '../../query/shared/query.interfaces';\n\n@Directive({\n  selector: '[igoWorkspaceSelector]'\n})\nexport class WorkspaceSelectorDirective implements OnInit, OnDestroy {\n\n  private layers$$: Subscription;\n  private entities$$: Subscription[] = [];\n\n  @Input() map: IgoMap;\n\n  @Output() changeWorkspace = new EventEmitter<string>();\n  @Output() disableSwitch = new EventEmitter<boolean>();\n  @Output() relationLayers = new EventEmitter<ImageLayer[] | VectorLayer[]>();\n  @Output() rowsInMapExtentCheckCondition = new EventEmitter<boolean>();\n\n  get workspaceStore(): WorkspaceStore {\n    return this.component.store;\n  }\n\n  constructor(\n    private component: WorkspaceSelectorComponent,\n    private wfsWorkspaceService: WfsWorkspaceService,\n    private wmsWorkspaceService: WmsWorkspaceService,\n    private editionWorkspaceService: EditionWorkspaceService,\n    private featureWorkspaceService: FeatureWorkspaceService\n  ) {}\n\n  ngOnInit() {\n    this.layers$$ = this.map.layers$\n      .pipe(debounceTime(50))\n      .subscribe((layers: Layer[]) =>\n        this.onLayersChange(layers)\n      );\n\n    this.featureWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.wmsWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.wfsWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.editionWorkspaceService.ws$.subscribe((ws) => { this.changeWorkspace.emit(ws); });\n    this.editionWorkspaceService.adding$.subscribe((adding) => { this.disableSwitch.emit(adding); });\n    this.editionWorkspaceService.relationLayers$.subscribe((layers) => { this.relationLayers.emit(layers); });\n    this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe((condition) => {\n      this.rowsInMapExtentCheckCondition.emit(condition);\n    });\n  }\n\n  ngOnDestroy() {\n    this.layers$$.unsubscribe();\n    this.entities$$.map(entities => entities.unsubscribe());\n  }\n\n  private onLayersChange(layers: Layer[]) {\n    const editableLayers = layers.filter((layer: Layer) =>\n      this.layerIsEditable(layer)\n    );\n    const editableLayersIds = editableLayers.map((layer: Layer) => layer.id);\n\n    const workspacesToAdd = editableLayers\n      .map((layer: VectorLayer) => this.getOrCreateWorkspace(layer))\n      .filter((workspace: Workspace | undefined) => workspace !== undefined);\n\n    const workspacesToRemove = this.workspaceStore.all()\n      .filter((workspace: Workspace) => {\n        return editableLayersIds.indexOf(workspace.id) < 0;\n      });\n\n    if (workspacesToRemove.length > 0) {\n      workspacesToRemove.forEach((workspace: Workspace) => {\n        workspace.entityStore.deactivateStrategyOfType(FeatureStoreInMapExtentStrategy);\n        workspace.deactivate();\n      });\n      this.workspaceStore.state.updateMany(workspacesToRemove, {active: false, selected: false});\n      this.workspaceStore.deleteMany(workspacesToRemove);\n    }\n\n    if (workspacesToAdd.length > 0) {\n      this.workspaceStore.insertMany(workspacesToAdd);\n    }\n  }\n\n  private getOrCreateWorkspace(layer: VectorLayer | ImageLayer): Workspace | undefined {\n    const workspace = this.workspaceStore.get(layer.id);\n    if (workspace !== undefined) {\n      return;\n    }\n    if (layer.dataSource instanceof WFSDataSource && layer.dataSource.options.edition?.enabled !== true) {\n      const wfsWks = this.wfsWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\n      return wfsWks;\n    } else if (layer.dataSource instanceof WMSDataSource && layer.dataSource.options.edition?.enabled !== true) {\n      if (!layer.dataSource.options.paramsWFS) { return; }\n      const wmsWks = this.wmsWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\n      wmsWks?.inResolutionRange$.subscribe((inResolutionRange) => {\n        (layer.dataSource.options as QueryableDataSourceOptions).queryable = !inResolutionRange;\n        (wmsWks.layer.dataSource.options as QueryableDataSourceOptions).queryable = inResolutionRange;\n      });\n      return wmsWks;\n    } else if (\n        layer.dataSource instanceof FeatureDataSource &&\n        (layer as VectorLayer).exportable === true &&\n        layer.dataSource.options.edition?.enabled !== true) {\n      const featureWks = this.featureWorkspaceService.createWorkspace(layer as VectorLayer, this.map);\n      return featureWks;\n    } else if (layer.dataSource instanceof WMSDataSource && layer.dataSource.options.edition?.enabled === true) {\n      const editionWks = this.editionWorkspaceService.createWorkspace(layer as ImageLayer, this.map);\n      return editionWks;\n    }\n\n    return;\n  }\n\n  private layerIsEditable(layer: Layer): boolean {\n    const dataSource = layer.dataSource;\n    if (dataSource instanceof WFSDataSource) {\n      return true;\n    }\n    if (dataSource instanceof FeatureDataSource) {\n      return true;\n    }\n    if (dataSource instanceof WMSDataSource) {\n      const dataSourceOptions = (dataSource.options ||\n        {}) as OgcFilterableDataSourceOptions;\n      return (dataSourceOptions.ogcFilters?.enabled || dataSource.options.paramsWFS?.featureTypes !== undefined);\n    }\n\n    return false;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { WorkspaceSelectorDirective } from './workspace-selector.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n   WorkspaceSelectorDirective\n  ],\n  declarations: [\n    WorkspaceSelectorDirective\n  ]\n})\nexport class IgoWorkspaceSelectorModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { WorkspaceUpdatorDirective } from './workspace-updator.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule\n  ],\n  exports: [\n   WorkspaceUpdatorDirective\n  ],\n  declarations: [\n    WorkspaceUpdatorDirective\n  ]\n})\nexport class IgoWorkspaceUpdatorModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { ConfirmationPopupComponent } from './confirmation-popup.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatButtonModule,\n    MatDialogModule,\n    MatButtonToggleModule\n  ],\n  exports: [ConfirmationPopupComponent],\n  declarations: [ConfirmationPopupComponent]\n})\nexport class IgoConfirmationPopupModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { IgoWidgetModule } from '@igo2/common';\n\nimport { provideOgcFilterWidget } from './widgets/widgets';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoOgcFilterModule } from './widgets/ogc-filter/ogc-filter.module';\nimport { IgoWorkspaceSelectorModule } from './workspace-selector/workspace-selector.module';\nimport { IgoWorkspaceUpdatorModule } from './workspace-updator/workspace-updator.module';\nimport { IgoConfirmationPopupModule } from './confirmation-popup/confirmation-popup.module';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoWidgetModule,\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceUpdatorModule,\n    IgoOgcFilterModule,\n    MatDialogModule\n  ],\n  exports: [\n    IgoWorkspaceSelectorModule,\n    IgoWorkspaceUpdatorModule,\n    IgoOgcFilterModule,\n    IgoConfirmationPopupModule\n  ],\n  declarations: [],\n  providers: [\n    provideOgcFilterWidget()\n  ]\n})\nexport class IgoGeoWorkspaceModule {}\n","import { EntityStore } from '@igo2/common';\nimport { BehaviorSubject } from 'rxjs';\nimport { FeatureStore } from '../../feature/shared/store';\nimport { FeatureWithDirection, FeatureWithStep, FeatureWithStop, Stop } from './directions.interface';\n\n/**\n * The class is a specialized version of an EntityStore that stores\n * stops.\n */\nexport class StopsStore extends EntityStore<Stop> {\n\n    public storeInitialized$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n    public clearStops() {\n        this.storeInitialized$.next(false);\n        this.clear();\n    }\n\n}\n\nexport class StopsFeatureStore extends FeatureStore<FeatureWithStop> {\n\n}\nexport class RoutesFeatureStore extends FeatureStore<FeatureWithDirection> {\n\n}\nexport class StepFeatureStore extends FeatureStore<FeatureWithStep> {\n\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { Cacheable } from 'ts-cacheable';\n\nimport { uuid } from '@igo2/utils';\nimport { ConfigService } from '@igo2/core';\n\nimport { Direction, DirectionOptions } from '../shared/directions.interface';\nimport { DirectionsFormat, SourceDirectionsType } from '../shared/directions.enum';\n\nimport { DirectionsSource } from './directions-source';\nimport { DirectionsSourceOptions } from './directions-source.interface';\n\n@Injectable()\nexport class OsrmDirectionsSource extends DirectionsSource {\n  get enabled(): boolean {\n    return this.options.enabled !== false;\n  }\n  set enabled(value: boolean) {\n    this.options.enabled = value;\n  }\n  static _name = 'OSRM Qubec';\n  private directionsUrl =\n    'https://geoegl.msp.gouv.qc.ca/services/itineraire/route/v1/driving/';\n  private options: DirectionsSourceOptions;\n\n  constructor(private http: HttpClient, private config: ConfigService) {\n    super();\n    this.options = this.config.getConfig('directionsSources.osrm') || {};\n    this.directionsUrl = this.options.url || this.directionsUrl;\n  }\n\n  getName(): string {\n    return OsrmDirectionsSource._name;\n  }\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  route(coordinates: [number, number][], directionsOptions: DirectionOptions = {}): Observable<Direction[]> {\n    const directionsParams = this.getRouteParams(directionsOptions);\n    return this.http\n      .get<JSON[]>(this.directionsUrl + coordinates.join(';'), {\n        params: directionsParams\n      })\n      .pipe(map(res => this.extractRoutesData(res)));\n  }\n\n  private extractRoutesData(response): Direction[] {\n    const routeResponse = [];\n    response.routes.forEach(route => {\n      routeResponse.push(this.formatRoute(route, response.waypoints));\n    });\n    return routeResponse;\n  }\n\n  private getRouteParams(directionsOptions: DirectionOptions = {}): HttpParams {\n\n    directionsOptions.alternatives = directionsOptions.alternatives !== undefined ? directionsOptions.alternatives : true;\n    directionsOptions.steps = directionsOptions.steps !== undefined ? directionsOptions.steps : true;\n    directionsOptions.geometries = directionsOptions.geometries !== undefined ? directionsOptions.geometries : 'geojson';\n    directionsOptions.overview = directionsOptions.overview !== undefined ? directionsOptions.overview : false;\n    directionsOptions.continue_straight = directionsOptions.continue_straight !== undefined ? directionsOptions.continue_straight : false;\n\n    return new HttpParams({\n      fromObject: {\n        alternatives: directionsOptions.alternatives ? 'true' : 'false',\n        overview: directionsOptions.overview ? 'simplified' : 'full',\n        steps: directionsOptions.steps ? 'true' : 'false',\n        geometries: directionsOptions.geometries ? directionsOptions.geometries : 'geojson',\n        continue_straight: directionsOptions.continue_straight ? 'true' : 'false',\n      }\n    });\n  }\n\n  private formatRoute(roadNetworkRoute: any, waypoints: any): Direction {\n    const stepsUI = [];\n    roadNetworkRoute.legs.forEach(leg => {\n      leg.steps.forEach(step => {\n        stepsUI.push(step);\n      });\n    });\n    return {\n      id: uuid(),\n      title: roadNetworkRoute.legs[0].summary,\n      source: OsrmDirectionsSource._name,\n      sourceType: SourceDirectionsType.Route,\n      order: 1,\n      format: DirectionsFormat.GeoJSON,\n      icon: 'directions',\n      projection: 'EPSG:4326',\n      waypoints,\n      distance: roadNetworkRoute.distance,\n      duration: roadNetworkRoute.duration,\n      geometry: roadNetworkRoute.geometry,\n      legs: roadNetworkRoute.legs,\n      steps: stepsUI,\n      weight: roadNetworkRoute.weight,\n      weight_name: roadNetworkRoute.weight_name\n    };\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService } from '@igo2/core';\n\nimport { DirectionsSource } from './directions-source';\nimport { OsrmDirectionsSource } from './osrm-directions-source';\n\nexport function osrmDirectionsSourcesFactory(\n  http: HttpClient,\n  config: ConfigService\n) {\n  return new OsrmDirectionsSource(http, config);\n}\n\nexport function provideOsrmDirectionsSource() {\n  return {\n    provide: DirectionsSource,\n    useFactory: osrmDirectionsSourcesFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable, of } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { FEATURE, Feature, FeatureGeometry } from '../../../feature';\n\nimport { StorageService } from '@igo2/core';\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch } from './source';\nimport { SearchSourceOptions, TextSearchOptions } from './source.interfaces';\nimport { NominatimData } from './nominatim.interfaces';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n/**\n * Nominatim search source\n */\n@Injectable()\nexport class NominatimSearchSource extends SearchSource implements TextSearch {\n  static id = 'nominatim';\n  static type = FEATURE;\n\n  constructor(\n    private http: HttpClient,\n    @Inject('options') options: SearchSourceOptions,\n    storageService: StorageService\n  ) {\n    super(options, storageService);\n  }\n\n  getId(): string {\n    return NominatimSearchSource.id;\n  }\n\n  getType(): string {\n    return NominatimSearchSource.type;\n  }\n\n  /*\n   * Source : https://wiki.openstreetmap.org/wiki/Key:amenity\n   */\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Nominatim (OSM)',\n      searchUrl: 'https://nominatim.openstreetmap.org/search',\n      settings: [\n        {\n          type: 'checkbox',\n          title: 'results type',\n          name: 'amenity',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.type.food',\n              value:\n                'bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.health',\n              value:\n                'baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.entertainment',\n              value:\n                'arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium \\\n                          ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe',\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.nominatim.type.finance',\n              value: 'atm,bank,bureau_de_change',\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'results limit',\n          name: 'limit',\n          values: [\n            {\n              title: '10',\n              value: 10,\n              enabled: true\n            },\n            {\n              title: '20',\n              value: 20,\n              enabled: false\n            },\n            {\n              title: '50',\n              value: 50,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'restrictExtent',\n          name: 'countrycodes',\n          values: [\n            {\n              title: 'igo.geo.search.nominatim.country.canada',\n              value: 'CA',\n              enabled: true\n            },\n            {\n              title: 'igo.geo.search.nominatim.country.all',\n              value: null,\n              enabled: false\n            }\n          ]\n        },\n        {\n          type: 'radiobutton',\n          title: 'multiple object',\n          name: 'dedupe',\n          values: [\n            {\n              title: 'igo.geo.search.searchSources.settings.true',\n              value: 0,\n              enabled: false\n            },\n            {\n              title: 'igo.geo.search.searchSources.settings.false',\n              value: 1,\n              enabled: true\n            }\n          ]\n        }\n      ]\n    };\n  }\n\n  /**\n   * Search a place by name\n   * @param term Place name\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string | undefined,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeSearchRequestParams(term, options || {});\n    if (!params.get('q')) {\n      return of([]);\n    }\n    return this.http\n      .get(this.searchUrl, { params })\n      .pipe(map((response: NominatimData[]) => this.extractResults(response, term)));\n  }\n\n  private computeSearchRequestParams(\n    term: string,\n    options: TextSearchOptions\n  ): HttpParams {\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          q: this.computeTerm(term),\n          format: 'json'\n        },\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(response: NominatimData[], term: string): SearchResult<Feature>[] {\n    return response.map((data: NominatimData) => this.dataToResult(data, term));\n  }\n\n  private dataToResult(data: NominatimData, term: string): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const geometry = this.computeGeometry(data);\n    const extent = this.computeExtent(data);\n    const id = [this.getId(), 'place', data.place_id].join('.');\n\n    return {\n      source: this,\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.display_name,\n        icon: 'map-marker',\n        score: computeTermSimilarity(term.trim(), data.display_name)\n      },\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry,\n        extent,\n        properties,\n        meta: {\n          id,\n          title: data.display_name\n        }\n      }\n    };\n  }\n\n  private computeProperties(data: NominatimData): { [key: string]: any } {\n    return {\n      display_name: data.display_name,\n      place_id: data.place_id,\n      osm_type: data.osm_type,\n      class: data.class,\n      type: data.type\n    };\n  }\n\n  private computeGeometry(data: NominatimData): FeatureGeometry {\n    return {\n      type: 'Point',\n      coordinates: [parseFloat(data.lon), parseFloat(data.lat)]\n    };\n  }\n\n  private computeExtent(data: NominatimData): [number, number, number, number] {\n    return [\n      parseFloat(data.boundingbox[2]),\n      parseFloat(data.boundingbox[0]),\n      parseFloat(data.boundingbox[3]),\n      parseFloat(data.boundingbox[1])\n    ];\n  }\n\n  private computeTerm(term: string): string {\n    return this.computeTermTags(term);\n  }\n\n  /**\n   * Add hashtag from query in Nominatim's format (+[])\n   * @param term Query with hashtag\n   */\n  private computeTermTags(term: string): string {\n    const hashtags = super.getHashtagsValid(term, 'amenity');\n    if (!hashtags) {\n      return this.computeTermSettings(term);\n    }\n\n    if (!hashtags.length) {\n      return null;\n    }\n\n    term = term.replace(/(#[^\\s]*)/g, '');\n    hashtags.forEach(tag => {\n      term += '+[' + tag + ']';\n    });\n\n    return term;\n  }\n\n  /**\n   * Add hashtag from settings in Nominatim's format (+[])\n   * @param term Query\n   */\n  private computeTermSettings(term: string): string {\n    this.options.settings.forEach(settings => {\n      if (settings.name === 'amenity') {\n        settings.values.forEach(conf => {\n          if (conf.enabled && typeof conf.value === 'string') {\n            const splitted = conf.value.split(',');\n            splitted.forEach(value => {\n              term += '+[' + value + ']';\n            });\n          }\n        });\n      }\n    });\n    return term;\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport { NominatimSearchSource } from './nominatim';\n\n/**\n * Nominatim search source factory\n * @ignore\n */\nexport function nominatimSearchSourceFactory(\n  http: HttpClient,\n  config: ConfigService,\n  storageService: StorageService\n) {\n  return new NominatimSearchSource(\n    http,\n    config.getConfig(`searchSources.${NominatimSearchSource.id}`),\n    storageService\n  );\n}\n\n/**\n * Function that returns a provider for the Nominatim search source\n */\nexport function provideNominatimSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: nominatimSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, ConfigService, StorageService]\n  };\n}\n","import { Injectable, Inject } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\n\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { ObjectUtils } from '@igo2/utils';\nimport { FEATURE, Feature } from '../../../feature';\n\nimport { SearchResult } from '../search.interfaces';\nimport { SearchSource, TextSearch, ReverseSearch } from './source';\nimport {\n  SearchSourceOptions,\n  TextSearchOptions,\n  ReverseSearchOptions\n} from './source.interfaces';\nimport {\n  StoredQueriesData,\n  StoredQueriesResponse,\n  StoredQueriesReverseData,\n  StoredQueriesReverseResponse,\n  StoredQueriesSearchSourceOptions,\n  StoredQueriesFields,\n  StoredQueriesReverseSearchSourceOptions\n} from './storedqueries.interfaces';\n\nimport * as olformat from 'ol/format';\nimport { LanguageService, StorageService } from '@igo2/core';\nimport { computeTermSimilarity } from '../search.utils';\nimport { Cacheable } from 'ts-cacheable';\n\n/**\n * StoredQueries search source\n */\n@Injectable()\nexport class StoredQueriesSearchSource extends SearchSource\n  implements TextSearch {\n  static id = 'storedqueries';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [\n    'boundedBy',\n    'id',\n    'coord_x',\n    'coord_y'\n  ];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions = options as StoredQueriesSearchSourceOptions;\n    if (this.storedQueriesOptions && !this.storedQueriesOptions.available) {\n      return;\n    }\n\n    const defaultStoredqueryId = 'rtss';\n    const defaultFieldSplitter: StoredQueriesFields[] = [\n      { name: 'rtss', defaultValue: '-99' },\n      { name: 'chainage', defaultValue: '0', splitPrefix: '\\\\+' }\n    ];\n    const defaultOutputformat = 'text/xml; subtype=gml/3.1.1';\n    const defaultSrsname = 'EPSG:4326';\n    const defaultResultTitle = 'title';\n\n    if (!this.storedQueriesOptions) {\n      console.log(\n        ' No configuration for this search source (storedqueries). You will use the default values'\n      );\n      this.storedQueriesOptions = {\n        storedquery_id: defaultStoredqueryId,\n        fields: defaultFieldSplitter,\n        outputformat: defaultOutputformat,\n        srsname: defaultSrsname,\n        resultTitle: defaultResultTitle\n      };\n      this.resultTitle = defaultResultTitle;\n      console.log('Default values', this.storedQueriesOptions);\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.fields) {\n      throw new Error(\n        'Stored Queries :You have to set \"fields\" into options. ex: fields: {\"name\": \"rtss\", \"defaultValue\": \"-99\"}'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n\n    const storedQueryId = this.storedQueriesOptions.storedquery_id.toLowerCase();\n    if (\n      storedQueryId.includes('getfeaturebyid') &&\n      this.storedQueriesOptions.outputformat\n        .toLowerCase()\n        .includes('getfeaturebyid')\n    ) {\n      let err =\n        'You must set a geojson format for your stored query. This is due to an openlayers issue)';\n      err += ' (wfs 1.1.0 & gml 3.1.1 limitation)';\n      throw new Error(err);\n    }\n\n    if (!(this.storedQueriesOptions.fields instanceof Array)) {\n      this.storedQueriesOptions.fields = [this.storedQueriesOptions.fields];\n    }\n\n    this.multipleFieldsQuery =\n      this.storedQueriesOptions.fields.length > 1 ? true : false;\n\n    this.storedQueriesOptions.fields.forEach((field, index) => {\n      if (this.multipleFieldsQuery && !field.splitPrefix && index !== 0) {\n        throw new Error(\n          'Stored Queries :You must set a field spliter into your field definition (optional for the first one!)'\n        );\n      }\n      if (!field.defaultValue) {\n        throw new Error(\n          'Stored Queries :You must set a field default value into your field definition'\n        );\n      }\n    });\n\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  // URL CALL EXAMPLES:\n  //  GetFeatureById (mandatory storedquery for wfs server) (outputformat must be in geojson)\n /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=2.0.0&request=GetFeature&storedquery_id=urn:ogc:def:query:OGC-WFS::GetFeatureById&srsname=epsg:4326&outputformat=geojson&ID=a_num_route.132\n  //  Custom StoredQuery\n /* eslint-disable max-len */\n  //  https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=rtss&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&rtss=0013801110000c&chainage=12\n\n  /**\n   * Search a location by name or keyword\n   * @param term Location name or keyword\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  search(\n    term: string,\n    options?: TextSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const storedqueriesParams = this.termSplitter(\n      term,\n      this.storedQueriesOptions.fields\n    );\n    const params = this.computeRequestParams(\n      options || {},\n      storedqueriesParams\n    );\n    this.options.params = this.options.params ? this.options.params : {};\n    this.options.params.page = options.page ? String(options.page) : '1';\n\n    if (\n      new RegExp('.*?gml.*?', 'i').test(this.storedQueriesOptions.outputformat)\n    ) {\n      return this.http\n        .get(this.searchUrl, { params, responseType: 'text' })\n        .pipe(\n          map(response => {\n            let resultArray = this.extractResults(this.extractWFSData(response), term);\n            resultArray.sort((a, b) =>\n              (a.meta.score > b.meta.score) ? 1 :\n              (a.meta.score === b.meta.score) ? ((a.meta.titleHtml < b.meta.titleHtml) ? 1 : -1) : -1);\n            resultArray.reverse();\n            if (resultArray.length > Number(this.options.params.limit)) {\n              const idxEnd = Number(this.options.params.limit) * Number(this.options.params.page);\n              const resultTotLenght = resultArray.length;\n              resultArray = resultArray.slice(0, idxEnd);\n              if (idxEnd < resultTotLenght) {\n                resultArray[resultArray.length - 1 ].meta.nextPage = true;\n              } else {\n                resultArray[resultArray.length - 1 ].meta.nextPage = false;\n              }\n            }\n            return resultArray;\n          })\n        );\n    } else {\n      return this.http.get(this.searchUrl, { params }).pipe(\n        map(response => {\n          return this.extractResults(this.extractWFSData(response), term);\n        })\n      );\n    }\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private termSplitter(term: string, fields: StoredQueriesFields[]): {} {\n    const splittedTerm = {};\n    let remainingTerm = term;\n    let cnt = 0;\n\n    // Used to build the default values\n    fields.forEach(field => {\n      splittedTerm[field.name] = field.defaultValue;\n      const splitterRegex = new RegExp(field.splitPrefix + '(.+)', 'i');\n      if (splitterRegex.test(remainingTerm)) {\n        cnt = field.splitPrefix ? (cnt += 1) : cnt;\n        remainingTerm = remainingTerm.split(splitterRegex)[1];\n      }\n    });\n    if (cnt === 0) {\n      splittedTerm[fields[0].name] = term;\n      return splittedTerm;\n    }\n    remainingTerm = term;\n    const localFields = [...fields].reverse();\n    localFields.forEach(field => {\n      const splitterRegex = new RegExp(field.splitPrefix || '' + '(.+)', 'i');\n      if (remainingTerm || remainingTerm !== '') {\n        const values = remainingTerm.split(splitterRegex);\n        remainingTerm = values[0];\n        if (values[1]) {\n          splittedTerm[field.name] = values[1].trim();\n        }\n      }\n    });\n    return splittedTerm;\n  }\n\n  private computeRequestParams(\n    options: TextSearchOptions,\n    queryParams\n  ): HttpParams {\n    const wfsversion = this.storedQueriesOptions.storedquery_id\n      .toLowerCase()\n      .includes('getfeaturebyid')\n      ? '2.0.0'\n      : '1.1.0';\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'wfs',\n          version: wfsversion,\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        queryParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesResponse, term: string\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesData) => {\n      return this.dataToResult(data, term);\n    });\n  }\n\n  private dataToResult(data: StoredQueriesData, term: string): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        // extent: data.bbox,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties.title,\n        titleHtml: data.properties[title],\n        icon: 'map-marker',\n        score: (data.properties.title) ?\n        computeTermSimilarity(term.trim(), data.properties.title) :\n        computeTermSimilarity(term.trim(), data.properties[title]),\n\n      }\n    };\n  }\n\n  private computeProperties(data: StoredQueriesData): { [key: string]: any } {\n    const properties = Object.assign(\n      {},\n      ObjectUtils.removeKeys(\n        data.properties,\n        StoredQueriesSearchSource.propertiesBlacklist\n      ),\n      { Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>' }\n    );\n    return properties;\n  }\n}\n\n/**\n * StoredQueriesReverse search source\n */\n\n// EXAMPLE CALLS\n /* eslint-disable max-len */\n// https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wfs&version=1.1.0&request=GetFeature&storedquery_id=lim_adm&srsname=epsg:4326&outputformat=text/xml;%20subtype=gml/3.1.1&long=-71.292469&lat=46.748107\n//\n\n@Injectable()\nexport class StoredQueriesReverseSearchSource extends SearchSource\n  implements ReverseSearch {\n  static id = 'storedqueriesreverse';\n  static type = FEATURE;\n  static propertiesBlacklist: string[] = [];\n  public resultTitle: 'title';\n  public storedQueriesOptions: StoredQueriesReverseSearchSourceOptions;\n  public multipleFieldsQuery: boolean;\n\n  constructor(\n    private http: HttpClient,\n    private languageService: LanguageService,\n    storageService: StorageService,\n    @Inject('options') options: SearchSourceOptions\n  ) {\n    super(options, storageService);\n    this.storedQueriesOptions = options as StoredQueriesReverseSearchSourceOptions;\n\n    if (!this.storedQueriesOptions || (this.storedQueriesOptions && !this.storedQueriesOptions.available) ) {\n      return;\n    }\n\n    if (!this.storedQueriesOptions.storedquery_id) {\n      const err =\n        'Stored Queries :You have to set \"storedquery_id\" into StoredQueries options. ex: storedquery_id: \"nameofstoredquerie\"';\n      throw new Error(err);\n    }\n    if (!this.storedQueriesOptions.longField) {\n      throw new Error(\n        'Stored Queries :You have to set \"longField\" to map the longitude coordinate to the query params.'\n      );\n    }\n    if (!this.storedQueriesOptions.latField) {\n      throw new Error(\n        'Stored Queries :You have to set \"latField\" to map the latitude coordinate to the query params.'\n      );\n    }\n\n    this.storedQueriesOptions.outputformat =\n      this.storedQueriesOptions.outputformat || 'text/xml; subtype=gml/3.1.1';\n    this.storedQueriesOptions.srsname =\n      this.storedQueriesOptions.srsname || 'EPSG:4326';\n    this.storedQueriesOptions.resultTitle =\n      this.storedQueriesOptions.resultTitle || this.resultTitle;\n  }\n\n  getId(): string {\n    return StoredQueriesReverseSearchSource.id;\n  }\n\n  getType(): string {\n    return StoredQueriesReverseSearchSource.type;\n  }\n\n  protected getDefaultOptions(): SearchSourceOptions {\n    return {\n      title: 'Stored Queries (reverse)',\n      searchUrl: 'https://ws.mapserver.transports.gouv.qc.ca/swtq'\n    };\n  }\n\n  /**\n   * Search a location by coordinates\n   * @param lonLat Location coordinates\n   * @param distance Search raidus around lonLat\n   * @returns Observable of <SearchResult<Feature>[]\n   */\n  @Cacheable({\n    maxCacheCount: 20\n  })\n  reverseSearch(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): Observable<SearchResult<Feature>[]> {\n    const params = this.computeRequestParams(lonLat, options || {});\n\n    if (\n      new RegExp('.*?gml.*?', 'i').test(this.storedQueriesOptions.outputformat)\n    ) {\n      return this.http\n        .get(this.searchUrl, { params, responseType: 'text' })\n        .pipe(\n          map(response => {\n            return this.extractResults(this.extractWFSData(response));\n          })\n        );\n    } else {\n      return this.http.get(this.searchUrl, { params }).pipe(\n        map(response => {\n          return this.extractResults(this.extractWFSData(response));\n        })\n      );\n    }\n  }\n\n  private getFormatFromOptions() {\n    let olFormatCls;\n\n    const outputFormat = this.storedQueriesOptions.outputformat;\n    const patternGml3 = new RegExp('.*?gml.*?', 'i');\n    const patternGeojson = new RegExp('.*?json.*?', 'i');\n\n    if (patternGeojson.test(outputFormat)) {\n      olFormatCls = olformat.GeoJSON;\n    }\n    if (patternGml3.test(outputFormat)) {\n      olFormatCls = olformat.WFS;\n    }\n\n    return new olFormatCls();\n  }\n\n  private extractWFSData(res) {\n    const olFormat = this.getFormatFromOptions();\n    const geojson = olformat.GeoJSON;\n    const wfsfeatures = olFormat.readFeatures(res);\n    const features = JSON.parse(new geojson().writeFeatures(wfsfeatures));\n    return features;\n  }\n\n  private computeRequestParams(\n    lonLat: [number, number],\n    options?: ReverseSearchOptions\n  ): HttpParams {\n    const longLatParams = {};\n    longLatParams[this.storedQueriesOptions.longField] = lonLat[0];\n    longLatParams[this.storedQueriesOptions.latField] = lonLat[1];\n\n    return new HttpParams({\n      fromObject: Object.assign(\n        {\n          service: 'WFS',\n          version: '1.1.0',\n          request: 'GetFeature',\n          storedquery_id: this.storedQueriesOptions.storedquery_id,\n          srsname: this.storedQueriesOptions.srsname,\n          outputformat: this.storedQueriesOptions.outputformat\n        },\n        longLatParams,\n        this.params,\n        options.params || {}\n      )\n    });\n  }\n\n  private extractResults(\n    response: StoredQueriesReverseResponse\n  ): SearchResult<Feature>[] {\n    return response.features.map((data: StoredQueriesReverseData) => {\n      return this.dataToResult(data);\n    });\n  }\n\n  private dataToResult(data: StoredQueriesReverseData): SearchResult<Feature> {\n    const properties = this.computeProperties(data);\n    const id = [this.getId(), properties.type, data.id].join('.');\n    const title = data.properties[this.storedQueriesOptions.resultTitle]\n      ? this.storedQueriesOptions.resultTitle\n      : this.resultTitle;\n\n    return {\n      source: this,\n      data: {\n        type: FEATURE,\n        projection: 'EPSG:4326',\n        geometry: data.geometry,\n        properties,\n        meta: {\n          id,\n          title: data.properties[title]\n        }\n      },\n      meta: {\n        dataType: FEATURE,\n        id,\n        title: data.properties[title],\n        icon: 'map-marker'\n      }\n    };\n  }\n\n  private computeProperties(\n    data: StoredQueriesReverseData\n  ): { [key: string]: any } {\n    const properties = ObjectUtils.removeKeys(\n      data.properties,\n      StoredQueriesReverseSearchSource.propertiesBlacklist\n    );\n    const routing = {\n      Route: '<span class=\"routing\"> <u>' + this.languageService.translate.instant('igo.geo.seeRouting') + '</u> </span>'\n    };\n    return Object.assign(properties, { type: data.properties.doc_type }, routing);\n  }\n}\n","import { HttpClient } from '@angular/common/http';\n\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\n\nimport { SearchSource } from './source';\nimport {\n  StoredQueriesSearchSource,\n  StoredQueriesReverseSearchSource\n} from './storedqueries';\n\n/**\n * StoredQueries search source factory\n * @ignore\n */\nexport function storedqueriesSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new StoredQueriesSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${StoredQueriesSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the StoredQueries search source\n */\nexport function provideStoredQueriesSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: storedqueriesSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n\n/**\n * StoredQueriesReverse search source factory\n * @ignore\n */\n\nexport function storedqueriesReverseSearchSourceFactory(\n  http: HttpClient,\n  languageService: LanguageService,\n  storageService: StorageService,\n  config: ConfigService\n) {\n  return new StoredQueriesReverseSearchSource(\n    http,\n    languageService,\n    storageService,\n    config.getConfig(`searchSources.${StoredQueriesReverseSearchSource.id}`)\n  );\n}\n\n/**\n * Function that returns a provider for the StoredQueriesReverse search source\n */\nexport function provideStoredQueriesReverseSearchSource() {\n  return {\n    provide: SearchSource,\n    useFactory: storedqueriesReverseSearchSourceFactory,\n    multi: true,\n    deps: [HttpClient, LanguageService, StorageService, ConfigService]\n  };\n}\n","import { WfsWorkspace } from './wfs-workspace';\nimport { FeatureWorkspace } from './feature-workspace';\nimport { EditionWorkspace } from './edition-workspace';\nimport { Observable } from 'rxjs';\nimport { EntityStoreFilterCustomFuncStrategy, EntityRecord } from '@igo2/common';\nimport { map } from 'rxjs/operators';\nimport { Feature } from '../../feature/shared/feature.interfaces';\nimport { StorageScope } from '@igo2/core';\n\n\nexport function getRowsInMapExtent(layerId, storageService): boolean {\n  return storageService.get(`workspace.rowsInMapExtent.${layerId}`) as boolean || true;\n}\n\nexport function setRowsInMapExtent(value, layerId, storageService) {\n  storageService.set(`workspace.rowsInMapExtent.${layerId}`, value, StorageScope.SESSION);\n}\n\nexport function getSelectedOnly(layerId, storageService): boolean {\n  return storageService.get(`workspace.selectedOnly.${layerId}`) as boolean || false;\n}\n\nexport function setSelectedOnly(value, layerId, storageService) {\n  storageService.set(`workspace.selectedOnly.${layerId}`, value, StorageScope.SESSION);\n}\n\nexport function mapExtentStrategyActiveToolTip(ws: WfsWorkspace | FeatureWorkspace | EditionWorkspace): Observable<string> {\n  return ws.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy).active$.pipe(\n    map((active: boolean) => active ? 'igo.geo.workspace.inMapExtent.active.tooltip' : 'igo.geo.workspace.inMapExtent.inactive.tooltip')\n  );\n}\n\nexport function noElementSelected(ws: WfsWorkspace | FeatureWorkspace | EditionWorkspace): Observable<boolean> {\n  return ws.entityStore.stateView.manyBy$((record: EntityRecord<Feature>) => {\n    return record.state.selected === true;\n  }).pipe(\n    map((entities: EntityRecord<Feature>[]) => entities.length >= 1)\n  );\n}\n\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/simple-map\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\"\n  igoPointerPosition\n  [pointerPositionDelay]=\"pointerCoordDelay\"\n  (pointerPositionCoord)=\"onPointerMove($event)\">\n    <igo-info-section [infoContent]=\"pointerCoord\"></igo-info-section>\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-home-extent-button [map]=\"map\" color=\"primary\"></igo-home-extent-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"true\" color=\"primary\"></igo-rotation-button>\n    <igo-wake-lock-button [map]=\"map\" color=\"primary\"></igo-wake-lock-button>\n  </igo-map-browser>\n\n</mat-card>\n\n<p *ngIf=\"!isTouchScreen\">{{pointerCoord}}</p>","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppSimpleMapComponent } from './simple-map.component';\n\nconst routes: Routes = [\n  {\n    path: 'simple-map',\n    component: AppSimpleMapComponent\n  }\n];\n\nexport const AppSimpleMapRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService, MediaService } from '@igo2/core';\nimport { IgoMap, DataSourceService, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-simple-map',\n  templateUrl: './simple-map.component.html',\n  styleUrls: ['./simple-map.component.scss']\n})\nexport class AppSimpleMapComponent {\n  public pointerCoord;\n  public pointerCoordDelay: number = 0;\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6,\n    rotation: 0.75\n  };\n\n  get media() {\n    return this.mediaService.getMedia();\n  }\n\n  get isTouchScreen() {\n    return this.mediaService.isTouchScreen();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mediaService: MediaService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n\n  onPointerMove(event) {\n    this.pointerCoord = event;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule } from '@igo2/geo';\n\nimport { AppSimpleMapComponent } from './simple-map.component';\nimport { AppSimpleMapRoutingModule } from './simple-map-routing.module';\nimport { CommonModule } from '@angular/common';\n\n@NgModule({\n  declarations: [AppSimpleMapComponent],\n  imports: [\n    CommonModule,\n    AppSimpleMapRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMapModule\n  ],\n  exports: [AppSimpleMapComponent]\n})\nexport class AppSimpleMapModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/layer\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Layers\">\n    <igo-layer-list\n    [map]=\"map\"\n    [layers]=\"map.layers\"\n    [expandLegendOfVisibleLayers]=\"false\"\n    floatLabel=\"never\"\n    [queryBadge]=\"true\">\n\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n        <igo-download-button [layer]=\"layer\"></igo-download-button>\n        <igo-ogc-filter-button [header]=\"true\" [layer]=\"layer\"></igo-ogc-filter-button>\n        <igo-time-filter-button [header]=\"true\" [layer]=\"layer\"></igo-time-filter-button>\n        <igo-track-feature-button [layer]=\"layer\" [trackFeature]=\"true\"></igo-track-feature-button>\n      </ng-template>\n\n    </igo-layer-list>\n  </igo-panel>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppLayerComponent } from './layer.component';\n\nconst routes: Routes = [\n  {\n    path: 'layer',\n    component: AppLayerComponent\n  }\n];\n\nexport const AppLayerRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WMSDataSourceOptions,\n  LayerOptions,\n  WFSDataSourceOptions,\n  OgcFilterableDataSourceOptions,\n  MetadataLayerOptions\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-layer',\n  templateUrl: './layer.component.html',\n  styleUrls: ['./layer.component.scss']\n})\nexport class AppLayerComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    maxLayerZoomExtent: [-11000000, 4500000, -4500000, 10000000],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            visible: true,\n            baseLayer: true,\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const wfsDatasource: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '10043'\n        }\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasource)\n      .subscribe(dataSource => {\n        const layer: LayerOptions = {\n          title: 'WFS ',\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    const wfsDatasourceCustomEPSG: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: 'geojson_utf8',\n        srsName: 'EPSG:32198',\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '12072'\n        }\n      },\n      formatOptions: {\n        dataProjection: 'EPSG:32198'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourceCustomEPSG)\n      .subscribe(dataSource => {\n        const layer: LayerOptions = {\n          title: 'WFS (Custom EPSG)',\n          visible: true,\n          source: dataSource,\n          removable: false\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'parc_routier',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Rseau routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'lieu habit',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'lieuhabite',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'sh_dis_eco',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'sh_dis_eco',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'nurc:Arc_Sample_Parent',\n        visible: false,\n        legendOptions: {\n          // collapsed: false,\n          display: true,\n          // url: 'https://v.seloger.com/s/width/1144/visuels/0/m/l/4/0ml42xbt1n3itaboek3qec5dtskdgw6nlscu7j69k.jpg',\n          stylesAvailable: [\n            { name: 'rain', title: 'Pluie' },\n            { name: 'raster', title: 'Dfaut' }\n          ] //\n        },\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://demo.geo-solutions.it/geoserver/ows',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'nurc:Arc_Sample', // , test:Linea_costa\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Avertissements routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'evenements',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    const datasource: WMSDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      refreshIntervalSec: 15,\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      }\n    };\n\n    interface LayerOptionsWithMetadata\n      extends LayerOptions,\n        MetadataLayerOptions {}\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe(dataSource => {\n        const layer: LayerOptionsWithMetadata = {\n          title: 'Embcle',\n          source: dataSource,\n          metadata: {\n            url:\n              'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\n            extern: true\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoFilterModule,\n  IgoMetadataModule,\n  IgoDownloadModule\n} from '@igo2/geo';\n\nimport { AppLayerComponent } from './layer.component';\nimport { AppLayerRoutingModule } from './layer-routing.module';\n\n@NgModule({\n  declarations: [AppLayerComponent],\n  imports: [\n    AppLayerRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoFilterModule,\n    IgoMetadataModule,\n    IgoDownloadModule\n  ],\n  exports: [AppLayerComponent]\n})\nexport class AppLayerModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppLegendComponent } from './legend.component';\n\nconst routes: Routes = [\n  {\n    path: 'legend',\n    component: AppLegendComponent\n  }\n];\n\nexport const AppLegendRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WMSDataSourceOptions,\n  LayerOptions,\n  WFSDataSourceOptions,\n  OgcFilterableDataSourceOptions,\n  MetadataLayerOptions\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-legend',\n  templateUrl: './legend.component.html',\n  styleUrls: ['./legend.component.scss']\n})\nexport class AppLegendComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            visible: true,\n            baseLayer: true,\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const wfsDatasource: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        filters: {\n          operator: 'PropertyIsEqualTo',\n          propertyName: 'code_municipalite',\n          expression: '10043'\n        }\n      }\n    };\n\n    this.layerService\n    .createAsyncLayer({\n      title: 'legend with display:false',\n      visible: true,\n      legendOptions: {\n        display: false,\n        html: 'test html'\n      },\n      sourceOptions: {\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n        optionsFromCapabilities: true,\n        params: {\n          LAYERS: 'sh_dis_eco',\n          VERSION: '1.3.0'\n        }\n      }\n    })\n    .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n    .createAsyncLayer({\n      title: 'legend in html',\n      visible: true,\n      legendOptions: {\n        display: true,\n        html: '<h2 style=\"background-color: blue;\">HTML lgende</h2>'\n      },\n      sourceOptions: {\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n        optionsFromCapabilities: false,\n        params: {\n          LAYERS: 'sh_sreg_eco',\n          VERSION: '1.3.0'\n        }\n      }\n    })\n    .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n    .createAsyncLayer({\n      title: 'legend with url param',\n      visible: true,\n      legendOptions: {\n        url: `data:image/jpeg;base64,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`\n\n      },\n      sourceOptions: {\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/mffpecofor.fcgi',\n        optionsFromCapabilities: true,\n        params: {\n          LAYERS: 'sh_reg_eco',\n          VERSION: '1.3.0'\n        }\n      }\n    })\n    .subscribe(l => this.map.addLayer(l));\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasource)\n      .subscribe(dataSource => {\n        const layer: LayerOptions = {\n          title: 'WFS ',\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Commission scolaire anglophone',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\n          params: {\n            LAYERS: 'WMS_MEQ_CS_ANGLO',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Rseau routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'bgr_v_sous_route_res_sup_act',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'lieu habit',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          optionsFromCapabilities: true,\n          params: {\n            LAYERS: 'lieuhabite',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Avertissements routier',\n        visible: false,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n          params: {\n            LAYERS: 'evenements',\n            VERSION: '1.3.0'\n          }\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    const datasource: WMSDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      refreshIntervalSec: 15,\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      }\n    };\n\n    interface LayerOptionsWithMetadata\n      extends LayerOptions,\n        MetadataLayerOptions {}\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe(dataSource => {\n        const layer: LayerOptionsWithMetadata = {\n          title: 'Embcle',\n          visible: true,\n          source: dataSource,\n          metadata: {\n            url:\n              'https://www.donneesquebec.ca/recherche/fr/dataset/historique-publique-d-embacles-repertories-au-msp',\n            extern: true\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map with a legend list</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/layer\">code of this\n      example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Legends\">\n    <igo-layer-legend-list [layers]=\"map.layers\"\n    [excludeBaseLayers]=\"true\"\n    [allowShowAllLegends]=\"true\"\n    [updateLegendOnResolutionChange]=\"false\"\n    [showAllLegendsValue]=\"false\">\n  </igo-layer-legend-list>\n\n  </igo-panel>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoFilterModule,\n  IgoMetadataModule,\n  IgoDownloadModule\n} from '@igo2/geo';\n\nimport { AppLegendComponent } from './legend.component';\nimport { AppLegendRoutingModule } from './legend-routing.module';\n\n@NgModule({\n  declarations: [AppLegendComponent],\n  imports: [\n    AppLegendRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoFilterModule,\n    IgoMetadataModule,\n    IgoDownloadModule\n  ],\n  exports: [AppLegendComponent]\n})\nexport class AppLegendModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppOverlayComponent } from './overlay.component';\n\nconst routes: Routes = [\n  {\n    path: 'overlay',\n    component: AppOverlayComponent\n  }\n];\n\nexport const AppOverlayRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, AfterViewInit } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  FEATURE,\n  Feature,\n  FeatureMotion\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-overlay',\n  templateUrl: './overlay.component.html',\n  styleUrls: ['./overlay.component.scss']\n})\nexport class AppOverlayComponent implements OnInit, AfterViewInit {\n  public map = new IgoMap({\n    overlay: true,\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit() {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n\n  ngAfterViewInit() {\n    const feature1: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 1\n      },\n      properties: {},\n      geometry: {\n        type: 'Point',\n        coordinates: [-73, 46.6]\n      }\n    };\n\n    const feature2: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 2\n      },\n      properties: {},\n      geometry: {\n        type: 'LineString',\n        coordinates: [[-72, 47.8], [-73.5, 47.4], [-72.4, 48.6]]\n      }\n    };\n\n    const feature3: Feature = {\n      type: FEATURE,\n      projection: 'EPSG:4326',\n      meta: {\n        id: 3\n      },\n      properties: {},\n      geometry: {\n        type: 'Polygon',\n        coordinates: [[[-71, 46.8], [-73, 47], [-71.2, 46.6]]]\n      }\n    };\n\n    this.map.overlay.setFeatures(\n      [feature1, feature2, feature3],\n      FeatureMotion.None\n    );\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Overlay</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/overlay\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule, IgoOverlayModule } from '@igo2/geo';\n\nimport { AppOverlayComponent } from './overlay.component';\nimport { AppOverlayRoutingModule } from './overlay-routing.module';\n\n@NgModule({\n  declarations: [AppOverlayComponent],\n  imports: [\n    AppOverlayRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMapModule,\n    IgoOverlayModule\n  ],\n  exports: [AppOverlayComponent]\n})\nexport class AppOverlayModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Geometry Form</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/common/form\">code of this example</a>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-form\n    *ngIf=\"form$ | async as form\"\n    [form]=\"form\"\n    [formData]=\"data$ | async\"\n    (submitForm)=\"onSubmit($event)\">\n\n    <igo-form-group [group]=\"form.groups[0]\"></igo-form-group>\n\n    <div formButtons>\n      <button\n        mat-stroked-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"fillForm()\">\n        Fill Form\n      </button>\n      <button\n        mat-stroked-button\n        type=\"button\"\n        color=\"primary\"\n        (click)=\"clearForm()\">\n        Clear Form\n      </button>\n      <button\n        mat-flat-button\n        type=\"submit\"\n        color=\"primary\"\n        [disabled]=\"submitDisabled\">\n        Submit\n      </button>\n    </div>\n  </igo-form>\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppGeometryComponent } from './geometry.component';\n\nconst routes: Routes = [\n  {\n    path: 'geometry',\n    component: AppGeometryComponent\n  }\n];\n\nexport const AppGeometryRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport * as olstyle from 'ol/style';\n\nimport { LanguageService } from '@igo2/core';\nimport { Form, FormService } from '@igo2/common';\nimport { IgoMap, DataSourceService, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-geometry',\n  templateUrl: './geometry.component.html',\n  styleUrls: ['./geometry.component.scss']\n})\nexport class AppGeometryComponent implements OnInit, OnDestroy {\n\n  map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  view = {\n    center: [-73, 47.2],\n    zoom: 15\n  };\n\n  form$ = new BehaviorSubject<Form>(undefined);\n\n  data$ = new BehaviorSubject<{[key: string]: any}>(undefined);\n\n  submitDisabled = true;\n\n  private valueChanges$$: Subscription;\n\n  constructor(\n    private languageService: LanguageService,\n    private formService: FormService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit() {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    const fieldConfigs = [\n      {\n        name: 'geometry',\n        title: 'Geometry',\n        options: {\n          validator: Validators.required\n        },\n        type: 'geometry',\n        inputs: {\n          map: this.map,\n          geometryTypeField: true,\n          geometryType: 'Polygon',\n          drawGuideField: true,\n          drawGuide: 50,\n          drawGuidePlaceholder: 'Draw Guide',\n          drawStyle: new olstyle.Style({\n            stroke: new olstyle.Stroke({\n              color: [255, 0, 0, 1],\n              width: 2\n            }),\n            fill:  new olstyle.Fill({\n              color: [255, 0, 0, 0.2]\n            }),\n            image: new olstyle.Circle({\n              radius: 8,\n              stroke: new olstyle.Stroke({\n                color: [255, 0, 0, 1]\n              }),\n              fill: new olstyle.Fill({\n                color: [255, 0, 0, 0.2]\n              })\n            })\n          })\n        }\n      },\n      {\n        name: 'name',\n        title: 'Name',\n        options: {\n          validator: Validators.required\n        }\n      }\n    ];\n\n    const fields = fieldConfigs.map((config) => this.formService.field(config));\n    const form = this.formService.form([], [this.formService.group({name: 'info'}, fields)]);\n\n    this.valueChanges$$ = form.control.valueChanges.subscribe(() => {\n      this.submitDisabled = !form.control.valid;\n    });\n\n    this.form$.next(form);\n  }\n\n  ngOnDestroy() {\n    this.valueChanges$$.unsubscribe();\n  }\n\n  fillForm() {\n    this.data$.next({\n      name: 'Place',\n      geometry: JSON.stringify({type: 'Polygon', coordinates: [[\n        [-106, 42],\n        [-107, 31],\n        [-81, 32],\n        [-82, 42],\n        [-106, 42]\n      ]]})\n    });\n  }\n\n  clearForm() {\n    this.form$.value.control.reset();\n  }\n\n  onSubmit(data: {[key: string]: any}) {\n    alert(JSON.stringify(data));\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoFormModule } from '@igo2/common';\nimport { IgoGeometryModule, IgoMapModule } from '@igo2/geo';\n\nimport { AppGeometryComponent } from './geometry.component';\nimport { AppGeometryRoutingModule } from './geometry-routing.module';\n\n@NgModule({\n  declarations: [AppGeometryComponent],\n  imports: [\n    CommonModule,\n    AppGeometryRoutingModule,\n    MatButtonModule,\n    MatCardModule,\n    IgoFormModule,\n    IgoGeometryModule,\n    IgoMapModule\n  ],\n  exports: [AppGeometryComponent]\n})\nexport class AppGeometryModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppFeatureComponent } from './feature.component';\n\nconst routes: Routes = [\n  {\n    path: 'feature',\n    component: AppFeatureComponent\n  }\n];\n\nexport const AppFeatureRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit, OnDestroy } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  VectorLayer,\n  FeatureStore,\n  FeatureStoreLoadingStrategy,\n  FeatureStoreSelectionStrategy,\n  FeatureMotion\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-feature',\n  templateUrl: './feature.component.html',\n  styleUrls: ['./feature.component.scss']\n})\nexport class AppFeatureComponent implements OnInit, OnDestroy {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  public tableTemplate = {\n    selection: true,\n    selectMany: true,\n    sort: true,\n    columns: [\n      {\n        name: 'properties.id',\n        title: 'ID'\n      },\n      {\n        name: 'properties.name',\n        title: 'Name'\n      },\n      {\n        name: 'properties.description',\n        title: 'Description'\n      }\n    ]\n  };\n\n  public store = new FeatureStore([], { map: this.map });\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {}\n\n  ngOnInit() {\n    const loadingStrategy = new FeatureStoreLoadingStrategy({});\n    this.store.addStrategy(loadingStrategy);\n\n    const selectionStrategy = new FeatureStoreSelectionStrategy({\n      map: this.map,\n      motion: FeatureMotion.Default\n    });\n    this.store.addStrategy(selectionStrategy);\n\n    this.store.load([\n      {\n        meta: { id: 1 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-72, 47.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 1,\n          name: 'Name 1',\n          description: 'Description 1'\n        }\n      },\n      {\n        meta: { id: 4 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-71, 46.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 4,\n          name: 'Name 4',\n          description: 'Description 4'\n        }\n      },{\n        meta: { id: 5 },\n        type: 'Feature',\n        geometry: {\n          type: 'Point',\n          coordinates: [-73, 45.8]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 5,\n          name: 'Name 5',\n          description: 'Description 5'\n        }\n      },\n      {\n        meta: { id: 2 },\n        type: 'Feature',\n        geometry: {\n          type: 'LineString',\n          coordinates: [[-72, 47.8], [-73.5, 47.4], [-72.4, 48.6]]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 2,\n          name: 'Name 2',\n          description: 'Description 2'\n        }\n      },\n      {\n        meta: { id: 3 },\n        type: 'Feature',\n        geometry: {\n          type: 'Polygon',\n          coordinates: [[[-71, 46.8], [-73, 47], [-71.2, 46.6]]]\n        },\n        projection: 'EPSG:4326',\n        properties: {\n          id: 3,\n          name: 'Name 3',\n          description: 'Description 3'\n        }\n      }\n    ]);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'MVT test',\n        visible: true,\n        sourceOptions: {\n          type: 'mvt',\n          url:\n            'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\n          queryable: true\n        },\n        mapboxStyle: {\n          url: 'assets/mapboxStyleExample-vectortile.json',\n          source: 'ahocevar'\n        }\n      } as any)\n      .subscribe(l => this.map.addLayer(l));\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector'\n      })\n      .subscribe(dataSource => {\n        const layer = this.layerService.createLayer({\n          title: 'Vector Layer',\n          source: dataSource,\n          animation: {\n            duration: 2000\n          },\n          mapboxStyle: {\n            url: 'assets/mapboxStyleExample-feature.json',\n            source: 'source_nameX'\n          }\n        }) as VectorLayer;\n        this.map.addLayer(layer);\n        this.store.bindLayer(layer);\n        loadingStrategy.activate();\n        selectionStrategy.activate();\n      });\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Feature</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geom/feature\">code of this example</a>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-entity-table\n    [store]=\"store\"\n    [template]=\"tableTemplate\">\n  </igo-entity-table>\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule, IgoEntityTableModule } from '@igo2/common';\nimport { IgoMapModule, IgoFeatureModule } from '@igo2/geo';\n\nimport { AppFeatureComponent } from './feature.component';\nimport { AppFeatureRoutingModule } from './feature-routing.module';\n\n@NgModule({\n  declarations: [AppFeatureComponent],\n  imports: [\n    AppFeatureRoutingModule,\n    CommonModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoEntityTableModule,\n    IgoMapModule,\n    IgoFeatureModule\n  ],\n  exports: [AppFeatureComponent]\n})\nexport class AppFeatureModule {}\n","import { Routes, RouterModule } from '@angular/router';\nimport { AppHoverComponent } from './hover.component';\n\nconst routes: Routes = [\n  {\n    path: 'hover',\n    component: AppHoverComponent\n  }\n];\n\nexport const AppHoverRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService, MediaService } from '@igo2/core';\nimport { IgoMap, DataSourceService, LayerService, WFSDataSourceOptions, VectorLayerOptions, WFSDataSource } from '@igo2/geo';\n\n@Component({\n  selector: 'app-hover',\n  templateUrl: './hover.component.html',\n  styleUrls: ['./hover.component.scss']\n})\nexport class AppHoverComponent {\n  public selected;\n  public pointerCoord;\n  public pointerCoordDelay: number = 0;\n  public pointerHoverFeatureDelay: number = 0;\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 8,\n    projection: 'EPSG:3857'\n  };\n\n\n  get media() {\n    return this.mediaService.getMedia();\n  }\n\n  get isTouchScreen() {\n    return this.mediaService.isTouchScreen();\n  }\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mediaService: MediaService\n  ) {\n\n    this.dataSourceService\n    .createAsyncDataSource({\n      type: 'wmts',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts',\n      layer: 'carte_gouv_qc_public',\n      matrixSet: 'EPSG_3857',\n      version: '1.3.0'\n    })\n    .subscribe(dataSource => {\n      this.map.addLayer(\n        this.layerService.createLayer({\n          title: 'Quebec',\n          visible: true,\n          baseLayer: true,\n          source: dataSource\n        })\n      );\n    });\n\n    interface WFSDataOptions\n      extends WFSDataSourceOptions {}\n\n    const wfsDatasourcePolygon: WFSDataOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'adn_bassin_n1_public_v',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '3.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourcePolygon)\n      .subscribe((dataSource: WFSDataSource) => {\n        const layer: VectorLayerOptions = {\n          title: 'WFS (polygon)',\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n    const wfsDatasourcePoint: WFSDataOptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\n      params: {\n        featureTypes: 'MSP_CASERNE_PUBLIC',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'shp'\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDatasourcePoint)\n      .subscribe((dataSource: WFSDataSource) => {\n        const layer: VectorLayerOptions = {\n          title: 'WFS (point)',\n          visible: true,\n          source: dataSource,\n          styleByAttribute: {\n            attribute: 'en_caserne',\n            data: ['true', 'false'],\n            stroke: ['red', 'blue'],\n            fill: ['#ffffff', '#ffffff'],\n            radius: [7, 7],\n            width: [2, 2]\n          },\n          hoverStyle: {\n            label: {\n              attribute: 'Caserne: ${no_caserne}\\n Mun: ${nom_ssi}',\n              style: {\n                textAlign: 'left',\n                textBaseline: 'top',\n                font: '12px Calibri,sans-serif',\n                fill: { color: '#000' },\n                backgroundFill: { color: 'rgba(255, 255, 255, 0.5)' },\n                backgroundStroke: { color: 'rgba(200, 200, 200, 0.75)', width: 2 },\n                stroke: { color: '#fff', width: 3 },\n                overflow: true,\n                offsetX: 20,\n                offsetY: 10,\n                padding: [2.5, 2.5, 2.5, 2.5]\n              }\n            },\n            baseStyle: {\n              circle: {\n                stroke: {\n                  color: 'orange',\n                  width: 5\n                },\n                width: [5],\n                radius: 15\n              }\n            }\n          }\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Hover</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/hover\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\"\n  igoHoverFeature\n  [igoHoverFeatureDelay]=\"pointerHoverFeatureDelay\"\n  [igoHoverFeatureEnabled]=\"true\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-home-extent-button [map]=\"map\" color=\"primary\"></igo-home-extent-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"true\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule } from '@igo2/geo';\n\nimport { AppHoverComponent } from './hover.component';\nimport { AppHoverRoutingModule } from './hover-routing.module';\nimport { CommonModule } from '@angular/common';\n\n@NgModule({\n  declarations: [AppHoverComponent],\n  imports: [\n    CommonModule,\n    AppHoverRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMapModule\n  ],\n  exports: [AppHoverComponent]\n})\nexport class AppHoverModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppMeasureComponent } from './measure.component';\n\nconst routes: Routes = [\n  {\n    path: 'measure',\n    component: AppMeasureComponent\n  }\n];\n\nexport const AppMeasureRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  FeatureStore,\n  FeatureWithMeasure\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-measure',\n  templateUrl: './measure.component.html',\n  styleUrls: ['./measure.component.scss']\n})\nexport class AppMeasureComponent {\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6,\n    projection: 'EPSG:3857'\n  };\n\n  public store = new FeatureStore<FeatureWithMeasure>([], {map: this.map});\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/measure\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-measurer [store]=\"store\" [map]=\"map\"></igo-measurer>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule, IgoMeasureModule } from '@igo2/geo';\n\nimport { AppMeasureComponent } from './measure.component';\nimport { AppMeasureRoutingModule } from './measure-routing.module';\n\n@NgModule({\n  declarations: [AppMeasureComponent],\n  imports: [\n    AppMeasureRoutingModule,\n    MatCardModule,\n    IgoMapModule,\n    IgoMeasureModule\n  ],\n  exports: [AppMeasureComponent]\n})\nexport class AppMeasureModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\nimport { AppDrawComponent } from './draw.component';\n\nconst routes: Routes = [\n  {\n    path: 'draw',\n    component: AppDrawComponent\n  }\n];\n\nexport const AppDrawRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  FeatureStore,\n  FeatureWithDraw,\n  MapService\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-draw',\n  templateUrl: './draw.component.html',\n  styleUrls: ['./draw.component.scss']\n})\nexport class AppDrawComponent {\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      },\n      scaleLine: true\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6,\n    projection: 'EPSG:3857'\n  };\n\n  public stores: FeatureStore<FeatureWithDraw>[] = [];\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private mapService: MapService\n  ) {\n    this.mapService.setMap(this.map);\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Simple Map</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/draw\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-draw [stores]=\"stores\" [map]=\"map\"></igo-draw>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMapModule, IgoDrawModule } from '@igo2/geo';\n\nimport { AppDrawComponent } from './draw.component';\nimport { AppDrawRoutingModule } from './draw-routing.module';\n\n@NgModule({\n  declarations: [AppDrawComponent],\n  imports: [\n    AppDrawRoutingModule,\n    MatCardModule,\n    IgoMapModule,\n    IgoDrawModule\n  ],\n  exports: [AppDrawComponent]\n})\nexport class AppDrawModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Query</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/query\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser\n    [map]=\"map\"\n    [view]=\"view\"\n    igoOverlay\n    igoQuery\n    [queryFeatures]=\"true\"\n    (query)=\"handleQueryResults($event)\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Details\">\n    <ng-container *ngIf=\"features$ | async as features\">\n      <div *ngFor=\"let feature of features\">\n        <h1>Query Title : <span style=\"background-color: #e0e0e0;\">{{getTitle(feature)}}</span></h1>\n        <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n      </div>\n    </ng-container>\n  </igo-panel>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppQueryComponent } from './query.component';\n\nconst routes: Routes = [\n  {\n    path: 'query',\n    component: AppQueryComponent\n  }\n];\n\nexport const AppQueryRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\n\nimport olFeature from 'ol/Feature';\nimport olPoint from 'ol/geom/Point';\nimport olPolygon from 'ol/geom/Polygon';\nimport olLineString from 'ol/geom/LineString';\nimport * as olproj from 'ol/proj';\n\nimport {\n  IgoMap,\n  FeatureDataSource,\n  DataSourceService,\n  LayerService,\n  Feature,\n  QueryableDataSourceOptions,\n  QueryFormat,\n  QueryHtmlTarget,\n  SearchResult,\n  FeatureMotion\n} from '@igo2/geo';\n\nimport { getEntityTitle } from '@igo2/common';\n\n@Component({\n  selector: 'app-query',\n  templateUrl: './query.component.html',\n  styleUrls: ['./query.component.scss']\n})\nexport class AppQueryComponent {\n  public features$ = new BehaviorSubject<Feature[]>([]);\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n        queryable: true,\n        queryTitle: 'num_rts',\n        params: {\n          layers: 'bgr_v_sous_route_res_sup_act',\n          version: '1.3.0'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n      });\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n        queryable: true,\n        queryFormat: QueryFormat.HTMLGML2,\n        queryHtmlTarget: QueryHtmlTarget.IFRAME,\n        params: {\n          layers: 'bgr_v_sous_route_res_sup_act',\n          version: '1.3.0'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS html with a pre call in GML',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n      });\n\n      this.layerService\n      .createAsyncLayer({\n        title: 'Query url test',\n        visible: true,\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/all.fcgi',\n          queryable: true,\n          queryUrls: [{url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=wms_mern_reg_admin&LAYERS=wms_mern_reg_admin&INFO_FORMAT=application/geojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}'}],\n          queryLayerFeatures: false,\n          queryFormat: 'geojson',\n          params: {\n            layers: 'SDA_MUNIC_S_20K',\n            version: '1.3.0'\n          }\n        }\n      } as any).subscribe(l => this.map.addLayer(l));\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'vector',\n        queryable: true,\n        queryTitle: 'So beautiful ${name}',\n        sourceFields: [\n          { name: 'name', alias: 'Alias name' },\n          { name: 'description', alias: 'Alias description' }\n        ]\n      } as QueryableDataSourceOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Vector Layer',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n        this.addFeatures(dataSource as FeatureDataSource);\n      });\n  }\n\n  addFeatures(dataSource: FeatureDataSource) {\n    const feature1 = new olFeature({\n      name: 'feature1',\n      geometry: new olLineString([\n        olproj.transform([-72, 47.8], 'EPSG:4326', 'EPSG:3857'),\n        olproj.transform([-73.5, 47.4], 'EPSG:4326', 'EPSG:3857'),\n        olproj.transform([-72.4, 48.6], 'EPSG:4326', 'EPSG:3857')\n      ]),\n    });\n\n    const feature2 = new olFeature({\n      name: 'feature2',\n      geometry: new olPoint(\n        olproj.transform([-73, 46.6], 'EPSG:4326', 'EPSG:3857')\n      ),\n    });\n\n    const feature3 = new olFeature({\n      name: 'feature3',\n      geometry: new olPolygon([\n        [\n          olproj.transform([-71, 46.8], 'EPSG:4326', 'EPSG:3857'),\n          olproj.transform([-73, 47], 'EPSG:4326', 'EPSG:3857'),\n          olproj.transform([-71.2, 46.6], 'EPSG:4326', 'EPSG:3857')\n        ]\n      ]),\n    });\n\n    dataSource.ol.addFeatures([feature1, feature2, feature3]);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'Vector tile with custom getfeatureinfo url',\n        visible: true,\n        sourceOptions: {\n          type: 'mvt',\n          url: 'https://ahocevar.com/geoserver/gwc/service/tms/1.0.0/ne:ne_10m_admin_0_countries@EPSG:900913@pbf/{z}/{x}/{-y}.pbf',\n          queryable: true,\n          queryUrls: [\n            { url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=wms_mern_reg_admin&LAYERS=wms_mern_reg_admin&INFO_FORMAT=application%2Fgeojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}'}\n          ],\n          queryLayerFeatures: false,\n          // queryFormat: 'geojson'\n        },\n        mapboxStyle: {\n          url: 'assets/mapboxStyleExample-vectortile.json',\n          source: 'ahocevar'\n        }\n      } as any)\n      .subscribe(l => this.map.addLayer(l));\n\n      this.dataSourceService\n      .createAsyncDataSource({\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/wss/incendie.fcgi',\n        queryable: true,\n        queryUrls: [\n          {\n            url:'https://geoegl.msp.gouv.qc.ca/apis/wss/amenagement.fcgi?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetFeatureInfo&FORMAT=image%2Fpng&TRANSPARENT=true&QUERY_LAYERS=SDA_MUNIC_S_20K&LAYERS=SDA_MUNIC_S_20K&INFO_FORMAT=geojson&FEATURE_COUNT=20&I=50&J=50&CRS=EPSG%3A3857&STYLES=&WIDTH=101&HEIGHT=101&BBOX={bbox}',\n            // minScale: 20000,\n            // maxScale: 9000000,\n            minResolution: 0,\n            maxResolution: 400\n          }\n        ],\n        queryFormat: 'geojson',\n        params: {\n          version: '1.3.0',\n          layers: 'MSP_CASERNE_PUBLIC'\n        }\n      } as QueryableDataSourceOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'WMS with custom getfeatureinfo url',\n            source: dataSource,\n            sourceOptions: dataSource.options\n          })\n        );\n      });\n  }\n\n  handleQueryResults(results) {\n    const features: Feature[] = results.features;\n    if (features.length && features[0]) {\n      this.features$.next(features);\n      this.map.queryResultsOverlay.setFeatures(features, FeatureMotion.None);\n    }\n  }\n\n  getTitle(result: SearchResult) {\n    return getEntityTitle(result);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoOverlayModule,\n  IgoQueryModule,\n  IgoFeatureModule\n} from '@igo2/geo';\n\nimport { AppQueryComponent } from './query.component';\nimport { AppQueryRoutingModule } from './query-routing.module';\n\n@NgModule({\n  declarations: [AppQueryComponent],\n  imports: [\n    AppQueryRoutingModule,\n    CommonModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoOverlayModule,\n    IgoQueryModule,\n    IgoFeatureModule\n  ],\n  exports: [AppQueryComponent]\n})\nexport class AppQueryModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppCatalogComponent } from './catalog.component';\n\nconst routes: Routes = [\n  {\n    path: 'catalog',\n    component: AppCatalogComponent\n  }\n];\n\nexport const AppCatalogRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit } from '@angular/core';\n\nimport { LanguageService, ConfigService, StorageService } from '@igo2/core';\nimport { IgoMap, LayerService, Catalog, CatalogItem, CatalogService, MapService } from '@igo2/geo';\nimport { EntityRecord, EntityStore } from '@igo2/common';\n\n@Component({\n  selector: 'app-catalog',\n  templateUrl: './catalog.component.html',\n  styleUrls: ['./catalog.component.scss']\n})\nexport class AppCatalogComponent implements OnInit {\n  catalog: Catalog;\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  public catalogStore = new EntityStore<Catalog>([]);\n\n  public catalogItemStore = new EntityStore<CatalogItem>([]);\n\n  constructor(\n    private configService: ConfigService,\n    private languageService: LanguageService,\n    private layerService: LayerService,\n    private catalogService: CatalogService,\n    private storageService: StorageService,\n    private mapService: MapService\n  ) {}\n\n  /**\n   * @internal\n   */\n  ngOnInit() {\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe(layer => this.map.addLayer(layer));\n\n    this.loadCatalogs();\n\n    this.mapService.setMap(this.map);\n    this.catalogStore.stateView\n      .firstBy$(\n        (record: EntityRecord<Catalog>) => record.state.selected === true\n      )\n      .subscribe((record: EntityRecord<Catalog>) => {\n        if (record && record.entity) {\n          const catalog = record.entity;\n          this.catalog = catalog;\n        }\n      });\n  }\n\n  /**\n   * When the selected catalog changes, toggle the the CatalogBrowser tool.\n   * @internal\n   * @param event Select event\n   */\n  onCatalogSelectChange(event: {selected: boolean; catalog: Catalog}) {\n    this.loadCatalogItems(event.catalog);\n  }\n\n  /**\n   * Get all the available catalogs from the CatalogService and\n   * load them into the store.\n   */\n  private loadCatalogs() {\n    this.catalogService.loadCatalogs()\n      .subscribe((catalogs: Catalog[]) => {\n        this.catalogStore.clear();\n        this.catalogStore.load(catalogs.concat((this.storageService.get('addedCatalogs') || []) as Catalog[]));\n      });\n  }\n\n  /**\n   * Get the selected catalog's items from the CatalogService and\n   * load them into the store.\n   * @param catalog Selected catalog\n   */\n  private loadCatalogItems(catalog: Catalog) {\n    this.catalogService.loadCatalogItems(catalog)\n      .subscribe((items: CatalogItem[]) => {\n        this.catalogItemStore.clear();\n        this.catalogItemStore.load(items);\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Catalog</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: ConfigService, LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/catalog\">code of this example</a><br>\n    See catalog section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Catalog Library\">\n    <igo-catalog-library\n      [store]=\"catalogStore\"\n      (catalogSelectChange)=\"onCatalogSelectChange($event)\">\n    </igo-catalog-library>\n  </igo-panel>\n\n  <igo-panel title=\"Catalog Browser\">\n    <igo-catalog-browser\n      [catalog]=\"catalog\"\n      [store]=\"catalogItemStore\"\n      [map]=\"map\">\n    </igo-catalog-browser>\n  </igo-panel>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoConfigModule, provideConfigOptions } from '@igo2/core';\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoCatalogModule } from '@igo2/geo';\n\nimport { environment } from '../../../environments/environment';\nimport { AppCatalogComponent } from './catalog.component';\nimport { AppCatalogRoutingModule } from './catalog-routing.module';\n\n@NgModule({\n  declarations: [AppCatalogComponent],\n  imports: [\n    CommonModule,\n    AppCatalogRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    IgoConfigModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoCatalogModule\n  ],\n  exports: [AppCatalogComponent],\n  providers: [\n    provideConfigOptions({\n      default: environment.igo\n    })\n  ]\n})\nexport class AppCatalogModule {}\n","export class ExportError extends Error {}\n\nexport class ExportInvalidFileError extends ExportError {\n  constructor() {\n    super('Invalid context');\n    Object.setPrototypeOf(this, ExportInvalidFileError.prototype);\n  }\n}\n\nexport class ExportNothingToExportError extends ExportError {\n  constructor() {\n    super('Nothing to export');\n    Object.setPrototypeOf(this, ExportNothingToExportError.prototype);\n  }\n}\n","export class ImportError extends Error {}\n\nexport class ImportInvalidFileError extends ImportError {\n  constructor() {\n    super('Invalid file');\n    Object.setPrototypeOf(this, ImportInvalidFileError.prototype);\n  }\n}\n\nexport class ImportUnreadableFileError extends ImportError {\n  constructor() {\n      super('Failed to read file');\n      Object.setPrototypeOf(this, ImportUnreadableFileError.prototype);\n  }\n}\n\nexport class ImportNothingToImportError extends ImportError {\n  constructor() {\n      super('Nothing to import');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSizeError extends ImportError {\n  constructor() {\n      super('File is too large');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n\nexport class ImportSRSError extends ImportError {\n  constructor() {\n      super('Invalid SRS definition');\n      Object.setPrototypeOf(this, ImportNothingToImportError.prototype);\n  }\n}\n","export enum TypePermission {\n  null,\n  read,\n  write\n}\n\nexport enum Scope {\n  public,\n  protected,\n  private\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { HttpClient, HttpErrorResponse } from '@angular/common/http';\n\nimport { BehaviorSubject, Observable, of, Subject } from 'rxjs';\nimport {\n  map,\n  tap,\n  catchError,\n  debounceTime,\n  mergeMap,\n  first,\n  skip\n} from 'rxjs/operators';\n\nimport olPoint from 'ol/geom/Point';\nimport GeoJSON from 'ol/format/GeoJSON';\nimport Cluster from 'ol/source/Cluster';\nimport olVectorSource from 'ol/source/Vector';\n\nimport { Tool } from '@igo2/common';\nimport { uuid, ObjectUtils } from '@igo2/utils';\nimport {\n  ConfigService,\n  RouteService,\n  Message,\n  MessageService,\n  LanguageService,\n  StorageService\n} from '@igo2/core';\n\nimport { AuthService } from '@igo2/auth';\nimport type { IgoMap, Layer, LayerOptions } from '@igo2/geo';\nimport { ExportService } from '@igo2/geo';\n\nimport { TypePermission } from './context.enum';\nimport {\n  ContextsList,\n  ContextServiceOptions,\n  Context,\n  DetailedContext,\n  ContextMapView,\n  ContextPermission,\n  ContextProfils\n} from './context.interface';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ContextService {\n  public context$ = new BehaviorSubject<DetailedContext>(undefined);\n  public contexts$ = new BehaviorSubject<ContextsList>({ ours: [] });\n  public defaultContextId$ = new BehaviorSubject<string>(undefined);\n  public editedContext$ = new BehaviorSubject<DetailedContext>(undefined);\n  public importedContext: Array<DetailedContext> = [];\n  public toolsChanged$ = new Subject<DetailedContext>();\n  private mapViewFromRoute: ContextMapView = {};\n  private options: ContextServiceOptions;\n  private baseUrl: string;\n\n  // Until the ContextService is completely refactored, this is needed\n  // to track the current tools\n  private tools: Tool[];\n  private toolbar: string[];\n\n  get defaultContextUri(): string {\n    return this.storageService.get('favorite.context.uri') as string || this._defaultContextUri || this.options.defaultContextUri;\n  }\n  set defaultContextUri(uri: string) {\n    this._defaultContextUri = uri;\n  }\n  private _defaultContextUri: string;\n\n  constructor(\n    private http: HttpClient,\n    private authService: AuthService,\n    private languageService: LanguageService,\n    private config: ConfigService,\n    private messageService: MessageService,\n    private storageService: StorageService,\n    private exportService: ExportService,\n    @Optional() private route: RouteService\n  ) {\n    this.options = Object.assign(\n      {\n        basePath: 'contexts',\n        contextListFile: '_contexts.json',\n        defaultContextUri: '_default'\n      },\n      this.config.getConfig('context')\n    );\n\n    this.baseUrl = this.options.url;\n\n    this.readParamsFromRoute();\n\n    if (this.authService.hasAuthService) {\n      this.authService.logged$.subscribe((logged) => {\n        if (logged) {\n          this.contexts$.pipe(skip(1), first()).subscribe((c) => {\n            this.handleContextsChange();\n          });\n          this.loadContexts();\n        }\n      });\n    } else {\n      this.loadContexts();\n      this.handleContextsChange(false);\n    }\n  }\n\n  get(permissions?: string[], hidden?: boolean): Observable<ContextsList> {\n    let url = this.baseUrl + '/contexts';\n    if (permissions && this.authService.authenticated) {\n      url += '?permission=' + permissions.join();\n      if (hidden) {\n        url += '&hidden=true';\n      }\n    }\n    return this.http.get<ContextsList>(url);\n  }\n\n  getById(id: string): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.get<Context>(url);\n  }\n\n  getDetails(id: string): Observable<DetailedContext> {\n    const url = `${this.baseUrl}/contexts/${id}/details`;\n    return this.http.get<DetailedContext>(url).pipe(\n      catchError((res) => {\n        this.handleError(res, id);\n        throw res;\n      })\n    );\n  }\n\n  getDefault(): Observable<DetailedContext> {\n    if (this.authService.authenticated) {\n      const url = this.baseUrl + '/contexts/default';\n      return this.http.get<DetailedContext>(url).pipe(\n        tap((context) => {\n          this.defaultContextId$.next(context.id);\n        })\n      );\n    } else {\n      const uri = this.storageService.get('favorite.context.uri') as string;\n      this.defaultContextId$.next(uri);\n      return this.getContextByUri(uri);\n    }\n\n  }\n\n  getProfilByUser(): Observable<ContextProfils[]> {\n    if (this.baseUrl) {\n      const url = this.baseUrl + '/profils?';\n      return this.http.get<ContextProfils[]>(url);\n    }\n    return of([]);\n  }\n\n  setDefault(id: string): Observable<any> {\n    if (this.authService.authenticated) {\n      const url = this.baseUrl + '/contexts/default';\n      return this.http.post(url, { defaultContextId: id });\n    } else {\n      this.storageService.set('favorite.context.uri', id);\n      return of(undefined);\n    }\n  }\n\n  hideContext(id: string) {\n    const url = this.baseUrl + '/contexts/' + id + '/hide';\n    return this.http.post(url, {});\n  }\n\n  showContext(id: string) {\n    const url = this.baseUrl + '/contexts/' + id + '/show';\n    return this.http.post(url, {});\n  }\n\n  delete(id: string, imported = false): Observable<void> {\n    const contexts: ContextsList = { ours: [] };\n    Object.keys(this.contexts$.value).forEach(\n      (key) =>\n        (contexts[key] = this.contexts$.value[key].filter((c) => c.id !== id))\n    );\n\n    if (imported) {\n      this.importedContext = this.importedContext.filter((c) => c.id !== id);\n      return of(this.contexts$.next(contexts));\n    }\n\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.delete<void>(url).pipe(\n      tap((res) => {\n        this.contexts$.next(contexts);\n      })\n    );\n  }\n\n  create(context: DetailedContext): Observable<Context> {\n    const url = this.baseUrl + '/contexts';\n    return this.http.post<Context>(url, context).pipe(\n      map((contextCreated) => {\n        if (this.authService.authenticated) {\n          contextCreated.permission = TypePermission[TypePermission.write];\n        } else {\n          contextCreated.permission = TypePermission[TypePermission.read];\n        }\n        this.contexts$.value.ours.unshift(contextCreated);\n        this.contexts$.next(this.contexts$.value);\n        return contextCreated;\n      })\n    );\n  }\n\n  clone(id: string, properties = {}): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id + '/clone';\n    return this.http.post<Context>(url, properties).pipe(\n      map((contextCloned) => {\n        contextCloned.permission = TypePermission[TypePermission.write];\n        this.contexts$.value.ours.unshift(contextCloned);\n        this.contexts$.next(this.contexts$.value);\n        return contextCloned;\n      })\n    );\n  }\n\n  update(id: string, context: Context): Observable<Context> {\n    const url = this.baseUrl + '/contexts/' + id;\n    return this.http.patch<Context>(url, context);\n  }\n\n  // =================================================================\n\n  addToolAssociation(contextId: string, toolId: string): Observable<void> {\n    const url = `${this.baseUrl}/contexts/${contextId}/tools`;\n    const association = {\n      toolId\n    };\n    return this.http.post<void>(url, association);\n  }\n\n  deleteToolAssociation(contextId: string, toolId: string): Observable<any> {\n    const url = `${this.baseUrl}/contexts/${contextId}/tools/${toolId}`;\n    return this.http.delete(url);\n  }\n\n  getPermissions(id: string): Observable<ContextPermission[]> {\n    const url = this.baseUrl + '/contexts/' + id + '/permissions';\n    return this.http.get<ContextPermission[]>(url);\n  }\n\n  addPermissionAssociation(\n    contextId: string,\n    profil: string,\n    type: TypePermission\n  ): Observable<ContextPermission[]> {\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions`;\n    const association = {\n      profil,\n      typePermission: type\n    };\n\n    return this.http.post<ContextPermission[]>(url, association).pipe(\n      catchError((res) => {\n        this.handleError(res, undefined, true);\n        throw [res]; // TODO Not sure about this.\n      })\n    );\n  }\n\n  deletePermissionAssociation(\n    contextId: string,\n    permissionId: string\n  ): Observable<void> {\n    const url = `${this.baseUrl}/contexts/${contextId}/permissions/${permissionId}`;\n    return this.http.delete<void>(url);\n  }\n\n  // ======================================================================\n\n  getLocalContexts(): Observable<ContextsList> {\n    const url = this.getPath(this.options.contextListFile);\n    return this.http.get<ContextsList>(url).pipe(\n      map((res: any) => {\n        return { ours: res };\n      })\n    );\n  }\n\n  getLocalContext(uri: string): Observable<DetailedContext> {\n    const url = this.getPath(`${uri}.json`);\n    return this.http.get<DetailedContext>(url).pipe(\n      mergeMap((res) => {\n        if (!res.base) {\n          return of(res);\n        }\n        const urlBase = this.getPath(`${res.base}.json`);\n        return this.http.get<DetailedContext>(urlBase).pipe(\n          map((resBase: DetailedContext) => {\n            const resMerge = res;\n            resMerge.map = ObjectUtils.mergeDeep(resBase.map, res.map);\n            resMerge.layers = (resBase.layers || [])\n              .concat(res.layers || [])\n              .reverse()\n              .filter(\n                (l, index, self) =>\n                  !l.id || self.findIndex((l2) => l2.id === l.id) === index\n              )\n              .reverse();\n            resMerge.toolbar = res.toolbar || resBase.toolbar;\n            resMerge.message = res.message || resBase.message;\n            resMerge.messages = res.messages || resBase.messages;\n            resMerge.tools = (res.tools || [])\n              .concat(resBase.tools || [])\n              .filter(\n                (t, index, self) =>\n                  self.findIndex((t2) => t2.name === t.name) === index\n              );\n            return resMerge;\n          }),\n          catchError((err) => {\n            this.handleError(err, uri);\n            throw err;\n          })\n        );\n      }),\n      catchError((err2) => {\n        this.handleError(err2, uri);\n        throw err2;\n      })\n    );\n  }\n\n  loadContexts(permissions?: string[], hidden?: boolean) {\n    let request;\n    if (this.baseUrl) {\n      request = this.get(permissions, hidden);\n    } else {\n      request = this.getLocalContexts();\n    }\n    request.subscribe((contexts) => {\n      contexts.ours = this.importedContext.concat(contexts.ours);\n      this.contexts$.next(contexts);\n    });\n  }\n\n  loadDefaultContext() {\n    const loadFct = (direct = false) => {\n      if (!direct && this.baseUrl && this.authService.authenticated) {\n        this.getDefault().subscribe(\n          (_context: DetailedContext) => {\n            this.defaultContextUri = _context.uri;\n            this.addContextToList(_context);\n            this.setContext(_context);\n          },\n          () => {\n            this.defaultContextId$.next(undefined);\n            this.loadContext(this.defaultContextUri);\n          }\n        );\n      } else {\n        this.loadContext(this.defaultContextUri);\n      }\n    };\n\n    if (this.route && this.route.options.contextKey) {\n      this.route.queryParams.pipe(debounceTime(100)).subscribe((params) => {\n        const contextParam = params[this.route.options.contextKey as string];\n        let direct = false;\n        if (contextParam) {\n          this.defaultContextUri = contextParam;\n          direct = true;\n        }\n        loadFct(direct);\n      });\n    } else {\n      loadFct();\n    }\n  }\n\n  loadContext(uri: string) {\n    const context = this.context$.value;\n\n    if (context && context.uri === uri) {\n      return;\n    }\n\n    this.getContextByUri(uri)\n      .pipe(first())\n      .subscribe(\n        (_context: DetailedContext) => {\n          this.addContextToList(_context);\n          this.setContext(_context);\n        },\n        (err) => {\n          if (uri !== this.options.defaultContextUri) {\n            this.loadContext(this.options.defaultContextUri);\n          }\n        }\n      );\n  }\n\n  setContext(context: DetailedContext) {\n    this.handleContextMessage(context);\n    const currentContext = this.context$.value;\n    if (currentContext && context && context.id === currentContext.id) {\n      if (context.map.view.keepCurrentView === undefined) {\n        context.map.view.keepCurrentView = true;\n      }\n      this.context$.next(context);\n      return;\n    }\n\n    if (!context.map) {\n      context.map = { view: {} };\n    }\n\n    Object.assign(context.map.view, this.mapViewFromRoute);\n\n    this.context$.next(context);\n  }\n\n  loadEditedContext(uri: string) {\n    this.getContextByUri(uri).subscribe((_context: DetailedContext) => {\n      this.setEditedContext(_context);\n    });\n  }\n\n  setEditedContext(context: DetailedContext) {\n    this.editedContext$.next(context);\n  }\n\n  getContextFromMap(igoMap: IgoMap, empty?: boolean): DetailedContext {\n    const view = igoMap.ol.getView();\n    const proj = view.getProjection().getCode();\n    const center: any = new olPoint(view.getCenter()).transform(\n      proj,\n      'EPSG:4326'\n    );\n\n    const context = {\n      uri: uuid(),\n      title: '',\n      scope: 'private',\n      map: {\n        view: {\n          center: center.getCoordinates(),\n          zoom: view.getZoom(),\n          projection: proj,\n          maxZoomOnExtent: igoMap.viewController.maxZoomOnExtent\n        }\n      },\n      layers: [],\n      tools: []\n    };\n\n    let layers = [];\n    if (empty === true) {\n      layers = igoMap.layers$\n        .getValue()\n        .filter(\n          (lay) =>\n            lay.baseLayer === true ||\n            lay.options.id === 'searchPointerSummaryId'\n        )\n        .sort((a, b) => a.zIndex - b.zIndex);\n    } else {\n      layers = igoMap.layers$.getValue().filter(lay => !lay.id.includes('WfsWorkspaceTableDest')).sort((a, b) => a.zIndex - b.zIndex);\n    }\n\n    let i = 0;\n    for (const l of layers) {\n      const layer: any = l;\n      const opts = {\n        id: layer.options.id ? String(layer.options.id) : undefined,\n        layerOptions: {\n          title: layer.options.title,\n          zIndex: ++i,\n          visible: layer.visible,\n          security: layer.security\n        } as LayerOptions,\n        sourceOptions: {\n          type: layer.dataSource.options.type,\n          params: layer.dataSource.options.params,\n          url: layer.dataSource.options.url,\n          queryable: layer.queryable\n        }\n      };\n      if (opts.sourceOptions.type) {\n        context.layers.push(opts);\n      }\n    }\n\n    context.tools = this.tools.map((tool) => {\n      return { id: String(tool.id), global: tool.global };\n    });\n\n    return context;\n  }\n\n  getContextFromLayers(\n    igoMap: IgoMap,\n    layers: Layer[],\n    name: string\n  ): DetailedContext {\n    const currentContext = this.context$.getValue();\n    const view = igoMap.ol.getView();\n    const proj = view.getProjection().getCode();\n    const center: any = new olPoint(view.getCenter()).transform(\n      proj,\n      'EPSG:4326'\n    );\n\n    const context = {\n      uri: name,\n      title: name,\n      map: {\n        view: {\n          center: center.getCoordinates(),\n          zoom: view.getZoom(),\n          projection: proj\n        }\n      },\n      layers: [],\n      toolbar: [],\n      tools: [],\n      extraFeatures: []\n    };\n\n    const currentLayers = igoMap.layers$.getValue();\n    context.layers = currentLayers\n      .filter((l) => l.baseLayer)\n      .map((l) => {\n        return {\n          baseLayer: true,\n          sourceOptions: l.options.sourceOptions,\n          title: l.options.title,\n          visible: l.visible\n        };\n      });\n\n    layers.forEach((layer) => {\n      const layerFound = currentContext.layers.find(\n        (contextLayer) => {\n          const source = contextLayer.source;\n          return source && layer.id === source.id && !contextLayer.baseLayer;\n        });\n\n      if (layerFound) {\n        let layerStyle = layerFound[`style`];\n        if (layerFound[`styleByAttribute`]) {\n          layerStyle = undefined;\n        } else if (layerFound[`clusterBaseStyle`]) {\n          layerStyle = undefined;\n          delete layerFound.sourceOptions[`source`];\n          delete layerFound.sourceOptions[`format`];\n        }\n        const opts = {\n          baseLayer: layerFound.baseLayer,\n          title: layer.options.title,\n          zIndex: layer.zIndex,\n          styleByAttribute: layerFound[`styleByAttribute`],\n          clusterBaseStyle: layerFound[`clusterBaseStyle`],\n          style: layerStyle,\n          clusterParam: layerFound[`clusterParam`],\n          visible: layer.visible,\n          opacity: layer.opacity,\n          sourceOptions: layerFound.sourceOptions\n        };\n        context.layers.push(opts);\n      } else {\n        if (!(layer.ol.getSource() instanceof olVectorSource)) {\n          const catalogLayer = layer.options;\n          catalogLayer.zIndex = layer.zIndex;\n          delete catalogLayer.source;\n          context.layers.push(catalogLayer);\n        } else {\n          let features;\n          const writer = new GeoJSON();\n          if (layer.ol.getSource() instanceof Cluster) {\n            const clusterSource = layer.ol.getSource() as Cluster;\n            let olFeatures = clusterSource.getFeatures();\n            olFeatures = (olFeatures as any).flatMap((cluster: any) => cluster.get('features'));\n            const cleanedOlFeatures = this.exportService.generateFeature(olFeatures, 'GeoJSON', '_featureStore');\n            features = writer.writeFeatures(\n              cleanedOlFeatures,\n              {\n                dataProjection: 'EPSG:4326',\n                featureProjection: 'EPSG:3857'\n              }\n            );\n          } else {\n            const source = layer.ol.getSource() as olVectorSource;\n            const olFeatures = source.getFeatures();\n            const cleanedOlFeatures = this.exportService.generateFeature(olFeatures, 'GeoJSON', '_featureStore');\n            features = writer.writeFeatures(\n              cleanedOlFeatures,\n              {\n                dataProjection: 'EPSG:4326',\n                featureProjection: 'EPSG:3857'\n              }\n            );\n          }\n          features = JSON.parse(features);\n          features.name = layer.options.title;\n          context.extraFeatures.push(features);\n        }\n      }\n    });\n\n    context.toolbar = this.toolbar;\n    context.tools = this.tools;\n\n    return context;\n  }\n\n  setTools(tools: Tool[]) {\n    this.tools = tools;\n  }\n\n  setToolbar(toolbar: string[]) {\n    this.toolbar = toolbar;\n  }\n\n  private handleContextMessage(context: DetailedContext) {\n    if (this.context$.value && context.uri && this.context$.value.uri !== context.uri) {\n      this.messageService.removeAllAreNotError();\n    }\n\n    context.messages = context.messages ? context.messages : [];\n    context.messages.push(context.message);\n    context.messages.map(message => {\n      if (message) {\n        this.messageService.message(message as Message);\n      }\n    });\n  }\n\n  private getContextByUri(uri: string): Observable<DetailedContext> {\n    if (this.baseUrl) {\n      let contextToLoad;\n      for (const key of Object.keys(this.contexts$.value)) {\n        contextToLoad = this.contexts$.value[key].find((c) => {\n          return c.uri === uri;\n        });\n        if (contextToLoad) {\n          break;\n        }\n      }\n\n      if (contextToLoad && contextToLoad.imported) {\n        return of(contextToLoad);\n      }\n\n      // TODO : use always id or uri\n      const id = contextToLoad ? contextToLoad.id : uri;\n      return this.getDetails(id);\n    }\n\n    const importedContext = this.contexts$.value.ours.find((currentContext) => {\n      return currentContext.uri === uri && currentContext.imported === true;\n    });\n\n    if (importedContext) {\n      return of(importedContext);\n    } else {\n      return this.getLocalContext(uri);\n    }\n  }\n\n  getContextLayers(igoMap: IgoMap) {\n    const layers: Layer[] = [];\n    const mapLayers = igoMap.layers$.getValue();\n    mapLayers.forEach((layer) => {\n      if (!layer.baseLayer && layer.options.id !== 'searchPointerSummaryId') {\n        layers.push(layer);\n      }\n    });\n    return layers;\n  }\n\n  private readParamsFromRoute() {\n    if (!this.route) {\n      return;\n    }\n\n    this.route.queryParams.subscribe((params) => {\n      const centerKey = this.route.options.centerKey;\n      if (centerKey && params[centerKey as string]) {\n        const centerParams = params[centerKey as string];\n        this.mapViewFromRoute.center = centerParams.split(',').map(Number);\n      }\n\n      const projectionKey = this.route.options.projectionKey;\n      if (projectionKey && params[projectionKey as string]) {\n        const projectionParam = params[projectionKey as string];\n        this.mapViewFromRoute.projection = projectionParam;\n      }\n\n      const zoomKey = this.route.options.zoomKey;\n      if (zoomKey && params[zoomKey as string]) {\n        const zoomParam = params[zoomKey as string];\n        this.mapViewFromRoute.zoom = Number(zoomParam);\n      }\n    });\n  }\n\n  private getPath(file: string) {\n    const basePath = this.options.basePath.replace(/\\/$/, '');\n\n    return `${basePath}/${file}`;\n  }\n\n  private handleError(\n    error: HttpErrorResponse,\n    uri: string,\n    permissionError?: boolean\n  ) {\n    const context = this.contexts$.value.ours.find((obj) => obj.uri === uri);\n    const titleContext = context ? context.title : uri;\n    error.error.title = this.languageService.translate.instant(\n      'igo.context.contextManager.invalid.title'\n    );\n\n    error.error.message = this.languageService.translate.instant(\n      'igo.context.contextManager.invalid.text',\n      { value: titleContext }\n    );\n\n    error.error.toDisplay = true;\n\n    if (permissionError) {\n      error.error.title = this.languageService.translate.instant(\n        'igo.context.contextManager.errors.addPermissionTitle'\n      );\n      error.error.message = this.languageService.translate.instant(\n        'igo.context.contextManager.errors.addPermission'\n      );\n    }\n    this.messageService.error(error.error.message, error.error.title);\n  }\n\n  private handleContextsChange(\n    keepCurrentContext = true\n  ) {\n    const context = this.context$.value;\n    const editedContext = this.editedContext$.value;\n    if (!context || context.uri === this.options.defaultContextUri) {\n      keepCurrentContext = false;\n    }\n    if (!keepCurrentContext || !this.findContext(context)) {\n      this.defaultContextUri = undefined;\n      this.loadDefaultContext();\n    } else {\n      this.getContextByUri(context.uri)\n        .pipe(first())\n        .subscribe(\n          (newContext: DetailedContext) => {\n            this.toolsChanged$.next(newContext);\n          }\n        );\n\n      if (this.baseUrl && this.authService.authenticated) {\n        this.getDefault().subscribe();\n      }\n    }\n    const editedFound = this.findContext(editedContext);\n    if (!editedFound || editedFound.permission !== 'write') {\n      this.setEditedContext(undefined);\n    }\n  }\n\n  private addContextToList(context: Context) {\n    const contextFound = this.findContext(context);\n    if (!contextFound) {\n      const contextSimplifie = {\n        id: context.id,\n        uri: context.uri,\n        title: context.title,\n        scope: context.scope,\n        permission: TypePermission[TypePermission.read]\n      };\n\n      if (this.contexts$.value && this.contexts$.value.public) {\n        this.contexts$.value.public.push(contextSimplifie);\n        this.contexts$.next(this.contexts$.value);\n      }\n    }\n  }\n\n  private findContext(context: Context) {\n    if (!context) {\n      return false;\n    }\n\n    const contexts = this.contexts$.value;\n    let found;\n    for (const key of Object.keys(contexts)) {\n      const value = contexts[key];\n      found = value.find(\n        (c) =>\n          (context.id && c.id === context.id) ||\n          (context.uri && c.uri === context.uri)\n      );\n      if (found) {\n        break;\n      }\n    }\n\n    return found;\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { ContextImportExportComponent } from './context-import-export/context-import-export.component';\nimport { IgoSpinnerModule } from '@igo2/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\n@NgModule({\n  imports: [\n    FormsModule,\n    ReactiveFormsModule,\n    CommonModule,\n    MatButtonModule,\n    MatButtonToggleModule,\n    MatDividerModule,\n    MatTabsModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatCheckboxModule,\n    IgoLanguageModule,\n    IgoSpinnerModule,\n    MatTooltipModule,\n  ],\n  exports: [\n    ContextImportExportComponent\n  ],\n  declarations: [\n    ContextImportExportComponent\n  ]\n})\nexport class IgoContextImportExportModule {\n  static forRoot(): ModuleWithProviders<IgoContextImportExportModule> {\n    return {\n      ngModule: IgoContextImportExportModule\n    };\n  }\n}\n","import { Directive, OnInit, OnDestroy } from '@angular/core';\n\nimport { Subscription } from 'rxjs';\nimport { filter } from 'rxjs/operators';\n\nimport { MapViewOptions, MapBrowserComponent, MapControlsOptions, MapScaleLineOptions } from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { ContextService } from './context.service';\nimport { DetailedContext, ContextMapView } from './context.interface';\nimport { MediaService } from '@igo2/core';\n\n@Directive({\n  selector: '[igoMapContext]'\n})\nexport class MapContextDirective implements OnInit, OnDestroy {\n  private component: MapBrowserComponent;\n  private context$$: Subscription;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    component: MapBrowserComponent,\n    private contextService: ContextService,\n    private mediaService: MediaService\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    this.context$$ = this.contextService.context$\n      .pipe(filter(context => context !== undefined))\n      .subscribe(context => this.handleContextChange(context));\n  }\n\n  ngOnDestroy() {\n    this.context$$.unsubscribe();\n  }\n\n  private handleContextChange(context: DetailedContext) {\n    if (context.map === undefined) {\n      return;\n    }\n\n    // This creates a new ol.Map when the context changes. Doing that\n    // allows the print tool to work properly even when the map's canvas\n    // has been tainted (CORS) with the layers of another context. This could\n    // have some side effects such as unbinding all listeners on the first map.\n    // A better solution would be to create a new map (preview) before\n    // printing and avoid the tainted canvas issue. This will come later so\n    // this snippet of code is kept here in case it takes too long becomes\n    // an issue\n\n    // const target = this.component.map.ol.getTarget();\n    // this.component.map.ol.setTarget(undefined);\n    // this.component.map.init();\n    // this.component.map.ol.setTarget(target);\n\n    const viewContext: ContextMapView = context.map.view;\n    if (!this.component.view || viewContext.keepCurrentView !== true || context.map.view.projection !== this.map.projection) {\n      this.component.view = viewContext as MapViewOptions;\n    }\n    if (this.component.map.geolocationController) {\n      this.component.map.geolocationController.updateGeolocationOptions(viewContext);\n    }\n\n    const controlsContext: MapControlsOptions = context.map.controls;\n    if (!this.component.controls && controlsContext) {\n      if (this.mediaService.isMobile()) {\n        if (typeof(controlsContext.scaleLine) !== 'boolean') {\n          const scaleLineOption = controlsContext.scaleLine as MapScaleLineOptions;\n          if (!scaleLineOption.minWidth) {\n            scaleLineOption.minWidth = Math.min(64, scaleLineOption.minWidth);\n            controlsContext.scaleLine = scaleLineOption;\n          }\n        }\n      }\n      this.component.controls = controlsContext;\n    }\n  }\n}\n","import { Directive, OnInit, OnDestroy, Optional, Input } from '@angular/core';\n\nimport { Subscription, merge } from 'rxjs';\nimport { buffer, debounceTime, filter } from 'rxjs/operators';\n\nimport { RouteService, ConfigService } from '@igo2/core';\nimport {\n  MapBrowserComponent,\n  Layer,\n  LayerService,\n  LayerOptions,\n  StyleListService,\n  StyleService\n} from '@igo2/geo';\nimport type { IgoMap } from '@igo2/geo';\n\nimport { ContextService } from './context.service';\nimport { DetailedContext } from './context.interface';\nimport {\n  addImportedFeaturesToMap,\n  addImportedFeaturesStyledToMap\n} from '../../context-import-export/shared/context-import.utils';\nimport GeoJSON from 'ol/format/GeoJSON';\n\n@Directive({\n  selector: '[igoLayerContext]'\n})\nexport class LayerContextDirective implements OnInit, OnDestroy {\n  private context$$: Subscription;\n  private queryParams: any;\n\n  private contextLayers: Layer[] = [];\n\n  @Input() removeLayersOnContextChange: boolean = true;\n\n  get map(): IgoMap {\n    return this.component.map;\n  }\n\n  constructor(\n    private component: MapBrowserComponent,\n    private contextService: ContextService,\n    private layerService: LayerService,\n    private configService: ConfigService,\n    private styleListService: StyleListService,\n    private styleService: StyleService,\n    @Optional() private route: RouteService\n  ) {}\n\n  ngOnInit() {\n    this.context$$ = this.contextService.context$\n      .pipe(filter((context) => context !== undefined))\n      .subscribe((context) => this.handleContextChange(context));\n\n    if (\n      this.route &&\n      this.route.options.visibleOnLayersKey &&\n      this.route.options.visibleOffLayersKey &&\n      this.route.options.contextKey\n    ) {\n      const queryParams$$ = this.route.queryParams.subscribe((params) => {\n        if (Object.keys(params).length > 0) {\n          this.queryParams = params;\n          queryParams$$.unsubscribe();\n        }\n      });\n    }\n  }\n\n  ngOnDestroy() {\n    this.context$$.unsubscribe();\n  }\n\n  private handleContextChange(context: DetailedContext) {\n    if (context.layers === undefined) {\n      return;\n    }\n    if (this.removeLayersOnContextChange === true) {\n      this.map.removeAllLayers();\n    } else {\n      this.map.removeLayers(this.contextLayers);\n    }\n    this.contextLayers = [];\n\n    const layersAndIndex$ = merge(\n      ...context.layers.map((layerOptions: LayerOptions, index: number) => {\n        return this.layerService.createAsyncLayer(layerOptions, context.uri);\n      })\n    );\n\n    layersAndIndex$\n      .pipe(buffer(layersAndIndex$.pipe(debounceTime(500))))\n      .subscribe((layers: Layer[]) => {\n        layers = layers\n          .filter((layer: Layer) => layer !== undefined)\n          .map((layer) => {\n            layer.visible = this.computeLayerVisibilityFromUrl(layer);\n            layer.zIndex = layer.zIndex;\n\n            return layer;\n          });\n\n        this.contextLayers.concat(layers);\n        this.map.addLayers(layers);\n\n        if (context.extraFeatures) {\n          context.extraFeatures.forEach((featureCollection) => {\n            const format = new GeoJSON();\n            const title = featureCollection.name;\n            featureCollection = JSON.stringify(featureCollection);\n            featureCollection = format.readFeatures(featureCollection, {\n              dataProjection: 'EPSG:4326',\n              featureProjection: 'EPSG:3857'\n            });\n            if (!this.configService.getConfig('importWithStyle')) {\n              addImportedFeaturesToMap(featureCollection, this.map, title);\n            } else {\n              addImportedFeaturesStyledToMap(\n                featureCollection,\n                this.map,\n                title,\n                this.styleListService,\n                this.styleService\n              );\n            }\n          });\n        }\n      });\n  }\n\n  private computeLayerVisibilityFromUrl(layer: Layer): boolean {\n    const params = this.queryParams;\n    const currentContext = this.contextService.context$.value.uri;\n    const currentLayerid: string = layer.id;\n\n    let visible = layer.visible;\n    if (!params || !currentLayerid) {\n      return visible;\n    }\n\n    const contextParams = params[this.route.options.contextKey as string];\n    if (contextParams === currentContext || !contextParams) {\n      let visibleOnLayersParams = '';\n      let visibleOffLayersParams = '';\n      let visiblelayers: string[] = [];\n      let invisiblelayers: string[] = [];\n\n      if (\n        this.route.options.visibleOnLayersKey &&\n        params[this.route.options.visibleOnLayersKey as string]\n      ) {\n        visibleOnLayersParams =\n          params[this.route.options.visibleOnLayersKey as string];\n      }\n      if (\n        this.route.options.visibleOffLayersKey &&\n        params[this.route.options.visibleOffLayersKey as string]\n      ) {\n        visibleOffLayersParams =\n          params[this.route.options.visibleOffLayersKey as string];\n      }\n\n      /* This order is important because to control whichever\n       the order of * param. First whe open and close everything.*/\n      if (visibleOnLayersParams === '*') {\n        visible = true;\n      }\n      if (visibleOffLayersParams === '*') {\n        visible = false;\n      }\n\n      // After, managing named layer by id (context.json OR id from datasource)\n      visiblelayers = visibleOnLayersParams.split(',');\n      invisiblelayers = visibleOffLayersParams.split(',');\n      if (visiblelayers.indexOf(currentLayerid) > -1 || visiblelayers.indexOf(currentLayerid.toString()) > -1) {\n        visible = true;\n      }\n      if (invisiblelayers.indexOf(currentLayerid) > -1 || invisiblelayers.indexOf(currentLayerid.toString()) > -1) {\n        visible = false;\n      }\n    }\n\n    return visible;\n  }\n}\n","import * as olStyle from 'ol/style';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\n\nimport {\n  FeatureDataSource,\n  FeatureDataSourceOptions,\n  IgoMap,\n  VectorLayer,\n  QueryableDataSourceOptions,\n  StyleService,\n  StyleListService,\n  StyleByAttribute,\n  ClusterParam,\n  ClusterDataSourceOptions,\n  ClusterDataSource\n} from '@igo2/geo';\nimport { MessageService, LanguageService } from '@igo2/core';\nimport { DetailedContext } from '../../context-manager/shared/context.interface';\nimport { ContextService } from '../../context-manager/shared/context.service';\nimport OlFeature from 'ol/Feature';\n\nexport function handleFileImportSuccess(\n  file: File,\n  context: DetailedContext,\n  messageService: MessageService,\n  languageService: LanguageService,\n  contextService: ContextService\n) {\n  if (Object.keys(context).length <= 0) {\n    handleNothingToImportError(file, messageService, languageService);\n    return;\n  }\n\n  const contextTitle = computeLayerTitleFromFile(file);\n\n  addContextToContextList(context, contextTitle, contextService);\n\n  const translate = languageService.translate;\n  const messageTitle = translate.instant(\n    'igo.context.contextImportExport.import.success.title'\n  );\n  const message = translate.instant(\n    'igo.context.contextImportExport.import.success.text',\n    {\n      value: contextTitle\n    }\n  );\n  messageService.success(message, messageTitle);\n}\n\nexport function handleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService,\n  sizeMb?: number\n) {\n  sizeMb = sizeMb ? sizeMb : 30;\n  const errMapping = {\n    'Invalid file': handleInvalidFileImportError,\n    'File is too large': handleSizeFileImportError,\n    'Failed to read file': handleUnreadbleFileImportError\n  };\n  errMapping[error.message](\n    file,\n    error,\n    messageService,\n    languageService,\n    sizeMb\n  );\n}\n\nexport function handleInvalidFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant(\n    'igo.context.contextImportExport.import.invalid.title'\n  );\n  const message = translate.instant(\n    'igo.context.contextImportExport.import.invalid.text',\n    {\n      value: file.name,\n      mimeType: file.type\n    }\n  );\n  messageService.error(message, title);\n}\n\nexport function handleSizeFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService,\n  sizeMb: number\n) {\n  const translate = languageService.translate;\n  const title = translate.instant(\n    'igo.context.contextImportExport.import.tooLarge.title'\n  );\n  const message = translate.instant(\n    'igo.context.contextImportExport.import.tooLarge.text',\n    {\n      value: file.name,\n      size: sizeMb\n    }\n  );\n  messageService.error(message, title);\n}\n\nexport function handleUnreadbleFileImportError(\n  file: File,\n  error: Error,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant(\n    'igo.context.contextImportExport.import.unreadable.title'\n  );\n  const message = translate.instant(\n    'igo.context.contextImportExport.import.unreadable.text',\n    {\n      value: file.name\n    }\n  );\n  messageService.error(message, title);\n}\n\nexport function handleNothingToImportError(\n  file: File,\n  messageService: MessageService,\n  languageService: LanguageService\n) {\n  const translate = languageService.translate;\n  const title = translate.instant(\n    'igo.context.contextImportExport.import.empty.title'\n  );\n  const message = translate.instant(\n    'igo.context.contextImportExport.import.empty.text',\n    {\n      value: file.name\n    }\n  );\n  messageService.error(message, title);\n}\n\nexport function addContextToContextList(\n  context: DetailedContext,\n  contextTitle: string,\n  contextService: ContextService\n) {\n  context.title = contextTitle;\n  context.imported = true;\n  contextService.contexts$.value.ours.unshift(context);\n  contextService.contexts$.next(contextService.contexts$.value);\n  contextService.importedContext.unshift(context);\n  contextService.loadContext(context.uri);\n}\n\nexport function getFileExtension(file: File): string {\n  return file.name.split('.').pop().toLowerCase();\n}\n\nexport function computeLayerTitleFromFile(file: File): string {\n  return file.name.substr(0, file.name.lastIndexOf('.'));\n}\n\nexport function addImportedFeaturesToMap(\n  olFeatures: OlFeature<OlGeometry>[],\n  map: IgoMap,\n  layerTitle: string\n): VectorLayer {\n  const r = Math.floor(Math.random() * 255);\n  const g = Math.floor(Math.random() * 255);\n  const b = Math.floor(Math.random() * 255);\n  const stroke = new olStyle.Stroke({\n    color: [r, g, b, 1],\n    width: 2\n  });\n\n  const fill = new olStyle.Fill({\n    color: [r, g, b, 0.4]\n  });\n  const sourceOptions: FeatureDataSourceOptions & QueryableDataSourceOptions = {\n    type: 'vector',\n    queryable: true\n  };\n  const source = new FeatureDataSource(sourceOptions);\n  source.ol.addFeatures(olFeatures);\n  const layer = new VectorLayer({\n    title: layerTitle,\n    isIgoInternalLayer: true,\n    source,\n    style: new olStyle.Style({\n      stroke,\n      fill,\n      image: new olStyle.Circle({\n        radius: 5,\n        stroke,\n        fill\n      })\n    })\n  });\n  map.addLayer(layer);\n\n  return layer;\n}\n\nexport function addImportedFeaturesStyledToMap(\n  olFeatures: OlFeature<OlGeometry>[],\n  map: IgoMap,\n  layerTitle: string,\n  styleListService: StyleListService,\n  styleService: StyleService\n): VectorLayer {\n  let style;\n  let distance: number;\n\n  if (\n    styleListService.getStyleList(layerTitle.toString() + '.styleByAttribute')\n  ) {\n    const styleByAttribute: StyleByAttribute = styleListService.getStyleList(\n      layerTitle.toString() + '.styleByAttribute'\n    );\n\n    style = (feature, resolution) => {\n      return styleService.createStyleByAttribute(feature, styleByAttribute, resolution);\n    };\n  } else if (\n    styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')\n  ) {\n    const clusterParam: ClusterParam = styleListService.getStyleList(\n      layerTitle.toString() + '.clusterParam'\n    );\n    distance = styleListService.getStyleList(\n      layerTitle.toString() + '.distance'\n    );\n\n    style = (feature, resolution) => {\n      const baseStyle = styleService.createStyle(\n        styleListService.getStyleList(layerTitle.toString() + '.clusterStyle'), feature, resolution\n      );\n      return styleService.createClusterStyle(feature, resolution, clusterParam, baseStyle);\n    };\n  } else if (styleListService.getStyleList(layerTitle.toString() + '.style')) {\n    style = (feature, resolution) => styleService.createStyle(\n      styleListService.getStyleList(layerTitle.toString() + '.style'), feature, resolution\n    );\n  } else {\n    style = (feature, resolution) => styleService.createStyle(\n      styleListService.getStyleList('default.style'), feature, resolution\n    );\n  }\n  let source;\n\n  if (styleListService.getStyleList(layerTitle.toString() + '.clusterStyle')) {\n    const sourceOptions: ClusterDataSourceOptions &\n      QueryableDataSourceOptions = {\n      distance,\n      type: 'cluster',\n      queryable: true\n    };\n    source = new ClusterDataSource(sourceOptions);\n    source.ol.source.addFeatures(olFeatures);\n  } else {\n    const sourceOptions: FeatureDataSourceOptions &\n      QueryableDataSourceOptions = {\n      type: 'vector',\n      queryable: true\n    };\n    source = new FeatureDataSource(sourceOptions);\n    source.ol.addFeatures(olFeatures);\n  }\n\n  const layer = new VectorLayer({\n    title: layerTitle,\n    isIgoInternalLayer: true,\n    source,\n    style\n  });\n  map.addLayer(layer);\n\n  return layer;\n}\n","export enum ContextListControlsEnum {\n  always = 'always',\n  never = 'never',\n  default = 'default'\n}\n","import { Component } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\n\n@Component({\n  selector: 'igo-bookmark-dialog',\n  templateUrl: './bookmark-dialog.component.html'\n})\nexport class BookmarkDialogComponent {\n  public title: string;\n\n  constructor(public dialogRef: MatDialogRef<BookmarkDialogComponent>) {}\n}\n","<h1 mat-dialog-title class=\"mat-typography\">{{ 'igo.context.bookmarkButton.dialog.title' |translate }}</h1>\n<div mat-dialog-content class=\"mat-typography\">\n  <mat-form-field>\n    <input matInput required autocomplete=\"off\"\n      maxlength=\"128\"\n      [placeholder]=\"'igo.context.bookmarkButton.dialog.placeholder' |translate\"\n      [(ngModel)]=\"title\">\n  </mat-form-field>\n</div>\n<div mat-dialog-actions>\n  <button mat-button color=\"primary\"\n         [disabled]=\"!title\"\n         (click)=\"dialogRef.close(title)\">\n    {{'igo.common.confirmDialog.confirmBtn' | translate}}\n  </button>\n  <button mat-button\n          (click)=\"dialogRef.close(false)\">\n    {{'igo.common.confirmDialog.cancelBtn' |translate}}\n  </button>\n</div>\n","<mat-list-item\n  class=\"mat-list-item\"\n  [ngClass]=\"{'mat-list-item-light': hidden}\">\n  <button mat-list-avatar\n    *ngIf=\"auth.authenticated\"\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"auth.authenticated ? ('igo.context.contextManager.favorite' | translate) : ''\"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\">\n    <mat-icon *ngIf=\"!context.iconImage\" svgIcon=\"{{context.icon ? context.icon : context.scope === 'public' ? 'earth' : 'star'}}\"></mat-icon>\n    <img *ngIf=\"context.iconImage\" [src]=\"context.iconImage\">\n  </button>\n  <button mat-list-avatar\n    *ngIf=\"!auth.authenticated && showFavorite\"\n    mat-icon-button\n    igoStopPropagation\n    [matTooltip]=\"'igo.context.contextManager.favorite' | translate\"\n    matTooltipShowDelay=\"500\"\n    [color]=\"default ? 'primary' : 'default'\"\n    (click)=\"favoriteClick(context)\">\n    <mat-icon svgIcon=\"star\"></mat-icon>\n  </button>\n  <h4 matLine>{{context.title}}</h4>\n\n  <div *ngIf=\"auth.authenticated\"\n       igoStopPropagation\n       class=\"igo-actions-container\">\n\n     <button *ngIf=\"collapsed && selected && (context.permission === typePermission[typePermission.write] || context.imported)\"\n       class=\"save-button\"\n       mat-icon-button\n       [matTooltip]=\"'igo.context.contextManager.save' | translate\"\n       matTooltipShowDelay=\"500\"\n       [color]=\"color\"\n       (click)=\"save.emit(context)\">\n       <mat-icon svgIcon=\"content-save\"></mat-icon>\n     </button>\n\n    <div #actions class=\"igo-actions-expand-container\">\n\n      <button *ngIf=\"canShare && !context.imported\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.managePermissions' | translate\"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"managePermissions.emit(context)\">\n        <mat-icon svgIcon=\"account-arrow-right\"></mat-icon>\n      </button>\n\n      <!--button\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.manageTools' | translate\"\n        [color]=\"color\"\n        (click)=\"manageTools.emit(context)\">\n        <mat-icon svgIcon=\"widgets\"></mat-icon>\n      </button-->\n\n      <button *ngIf=\"!context.imported\"\n        class=\"clone-button\"\n        mat-icon-button\n        [matTooltip]=\"'igo.context.contextManager.clone' | translate\"\n        matTooltipShowDelay=\"500\"\n        [color]=\"color\"\n        (click)=\"clone.emit(context)\">\n        <mat-icon svgIcon=\"content-copy\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"context.permission === typePermission[typePermission.write] && !context.imported\"\n        class=\"edit-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.edit' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"edit.emit(context)\">\n        <mat-icon svgIcon=\"pencil\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"!context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.hide' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"hide.emit(context)\">\n        <mat-icon svgIcon=\"eye\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"context.hidden && !context.imported\"\n        class=\"hide-button\"\n        mat-icon-button\n        [color]=\"color\"\n        [matTooltip]=\"'igo.context.contextManager.show' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"show.emit(context)\">\n        <mat-icon svgIcon=\"eye-off\"></mat-icon>\n      </button>\n\n      <button *ngIf=\"context.permission === typePermission[typePermission.write] || context.imported\"\n        class=\"delete-button\"\n        mat-icon-button\n        color=\"warn\"\n        [matTooltip]=\"'igo.context.contextManager.delete' | translate\"\n        matTooltipShowDelay=\"500\"\n        (click)=\"delete.emit(context)\">\n        <mat-icon svgIcon=\"delete\"></mat-icon>\n      </button>\n    </div>\n\n    <button\n      class=\"actions-button\"\n      mat-icon-button\n      igoCollapse\n      [color]=\"color\"\n      [target]=\"actions\"\n      [collapsed]=collapsed\n      (click)=\"collapsed = !collapsed\">\n      <mat-icon svgIcon=\"dots-horizontal\"></mat-icon>\n    </button>\n\n  </div>\n\n</mat-list-item>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { StorageService } from '@igo2/core';\nimport { AuthService } from '@igo2/auth';\nimport { TypePermission } from '../shared/context.enum';\nimport { DetailedContext } from '../shared/context.interface';\n\n@Component({\n  selector: 'igo-context-item',\n  templateUrl: './context-item.component.html',\n  styleUrls: ['./context-item.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ContextItemComponent {\n  public typePermission = TypePermission;\n  public color = 'primary';\n  public collapsed = true;\n\n  @Input() showFavorite: boolean = true;\n  @Input() context: DetailedContext;\n  @Input() default: boolean;\n  @Input() selected: boolean;\n\n  @Output() edit = new EventEmitter<DetailedContext>();\n  @Output() delete = new EventEmitter<DetailedContext>();\n  @Output() save = new EventEmitter<DetailedContext>();\n  @Output() clone = new EventEmitter<DetailedContext>();\n  @Output() hide = new EventEmitter<DetailedContext>();\n  @Output() show = new EventEmitter<DetailedContext>();\n  @Output() favorite = new EventEmitter<DetailedContext>();\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\n  @Output() manageTools = new EventEmitter<DetailedContext>();\n\n  get hidden(): boolean {\n    return this.context.hidden;\n  }\n\n  get canShare(): boolean {\n    return this.storageService.get('canShare') === true;\n  }\n\n  constructor(\n    public auth: AuthService,\n    private storageService: StorageService\n  ) {}\n\n  favoriteClick(context: DetailedContext) {\n    this.favorite.emit(context);\n  }\n}\n","<igo-list [navigation]=\"true\">\n  <mat-form-field *ngIf=\"showFilter()\" [ngClass]=\"auth.authenticated && configService.getConfig('context') ? 'context-filter-min-width' : 'context-filter-max-width'\">\n    <input\n      matInput\n      type=\"text\"\n      [placeholder]=\"'igo.context.contextManager.filterPlaceHolder' | translate\"\n      [(ngModel)]=\"term\">\n    <button\n      mat-button\n      mat-icon-button\n      matSuffix\n      class=\"clear-button\"\n      *ngIf=\"term.length\"\n      aria-label=\"Clear\"\n      color=\"warn\"\n      (click)=\"clearFilter()\">\n      <mat-icon svgIcon=\"close\"></mat-icon>\n    </button>\n  </mat-form-field>\n\n  <button\n  *ngIf=\"!sortedAlpha\"\n  class=\"sort-alpha\"\n  mat-icon-button\n  [matTooltip]=\"'igo.context.contextManager.sortAlphabetically' | translate\"\n  matTooltipShowDelay=\"500\"\n  (click)=\"toggleSort(true)\">\n  <mat-icon color=\"primary\" svgIcon=\"sort-alphabetical-variant\"></mat-icon>\n  </button>\n  <button\n    *ngIf=\"sortedAlpha\"\n    class=\"sort-alpha\"\n    mat-icon-button\n    [matTooltip]=\"'igo.context.contextManager.sortContextOrder' | translate\"\n    matTooltipShowDelay=\"500\"\n    (click)=\"toggleSort(false)\">\n    <mat-icon color=\"warn\" svgIcon=\"sort-variant-remove\"></mat-icon>\n  </button>\n\n  <igo-actionbar *ngIf=\"auth.authenticated && configService.getConfig('context')\"\n    class=\"add-context-button\"\n    [iconColor]=\"color\"\n    [store]=\"actionStore\"\n    [withIcon]=\"true\"\n    icon=\"plus\"\n    [withTitle]=\"actionbarMode === 'overlay'\"\n    [horizontal]=\"false\"\n    [mode]=\"actionbarMode\">\n  </igo-actionbar>\n\n  <button *ngIf=\"auth.authenticated && configService.getConfig('context')\"\n    class=\"users-filter\"\n    mat-icon-button\n    [matTooltip]=\"'igo.context.contextManager.filterUser' | translate\"\n    matTooltipShowDelay=\"500\"\n    [matMenuTriggerFor]=\"accountMenu\">\n    <mat-icon color=\"primary\" svgIcon=\"filter-menu\"></mat-icon>\n  </button>\n\n  <mat-menu #accountMenu=\"matMenu\">\n    <ng-container *ngFor=\"let user of users\">\n      <span class=\"profilsMenu\">\n        <mat-checkbox\n          class=\"mat-menu-item\"\n          [checked]=\"getPermission(user).checked\"\n          [indeterminate]=\"getPermission(user).indeterminate\"\n          (click)=\"$event.stopPropagation()\"\n          (change)=\"userSelection(user)\">\n        </mat-checkbox>\n        <button *ngIf=\"user.childs\"\n          [matMenuTriggerFor]=\"subAccountMenu\"\n          mat-menu-item>\n          {{user.title}}\n        </button>\n        <button\n          mat-menu-item\n          *ngIf=\"!user.childs\">\n          {{user.title}}\n        </button>\n      </span>\n\n      <mat-menu #subAccountMenu=\"matMenu\">\n        <mat-checkbox *ngFor=\"let child of user.childs\"\n          class=\"mat-menu-item\"\n          [checked]=\"getPermission(child).checked\"\n          (click)=\"$event.stopPropagation()\"\n          (change)=\"userSelection(child, user)\">\n          {{child.title}}\n        </mat-checkbox>\n      </mat-menu>\n    </ng-container>\n\n    <span class=\"profilsMenu\">\n      <mat-checkbox\n        class=\"mat-menu-item\"\n        [checked]=\"showHidden\"\n        (click)=\"$event.stopPropagation()\"\n        (change)=\"showHiddenContexts.emit()\">\n      </mat-checkbox>\n      <button mat-menu-item>\n        {{ 'igo.context.contextManager.showHidden' | translate }}\n      </button>\n    </span>\n  </mat-menu>\n\n  <ng-template ngFor let-groupContexts [ngForOf]=\"contexts$ | async | keyvalue\">\n\n    <igo-collapsible *ngIf=\"groupContexts.value.length && auth.authenticated\" [title]=\"titleMapping[groupContexts.key] | translate\"\n      [collapsed]=\"collapsed[titleMapping[groupContexts.key]]\" (toggle)=\"collapsed[titleMapping[groupContexts.key]] = $event\">\n\n      <ng-template ngFor let-context [ngForOf]=\"groupContexts.value\">\n        <igo-context-item\n          igoListItem\n          color=\"accent\"\n          [selected]=\"selectedContext && selectedContext.uri === context.uri\"\n          [context]=\"context\"\n          [default]=\"context.id && this.defaultContextId && this.defaultContextId === context.id\"\n          (edit)=\"edit.emit(context)\"\n          (delete)=\"delete.emit(context)\"\n          (clone)=\"clone.emit(context)\"\n          (save)=\"save.emit(context)\"\n          (hide)=\"hideContext(context)\"\n          (show)=\"showContext(context)\"\n          (favorite)=\"favorite.emit(context)\"\n          (manageTools)=\"manageTools.emit(context)\"\n          (managePermissions)=\"managePermissions.emit(context)\"\n          (select)=\"select.emit(context)\"\n          (unselect)=\"unselect.emit(context)\">\n        </igo-context-item>\n      </ng-template>\n\n    </igo-collapsible>\n\n    <ng-template *ngIf=\"groupContexts.value.length && !auth.authenticated\" ngFor let-context [ngForOf]=\"groupContexts.value\">\n      <igo-context-item\n        igoListItem\n        color=\"accent\"\n        [showFavorite]=\"configService.getConfig('favoriteContext4NonAuthenticated')\"\n        [selected]=\"selectedContext && selectedContext.uri === context.uri\"\n        [context]=\"context\"\n        [default]=\"configService.getConfig('context') ? defaultContextId === context.id : defaultContextId === context.uri\"\n        (favorite)=\"favorite.emit(context)\"\n        (select)=\"select.emit(context)\"\n        (unselect)=\"unselect.emit(context)\">\n      </igo-context-item>\n    </ng-template>\n\n  </ng-template>\n</igo-list>\n","import {\n  Component,\n  Input,\n  Output,\n  EventEmitter,\n  ChangeDetectorRef,\n  OnInit,\n  ChangeDetectionStrategy,\n  OnDestroy\n} from '@angular/core';\n\nimport { AuthService } from '@igo2/auth';\nimport { ConfigService, LanguageService, StorageService } from '@igo2/core';\nimport type { IgoMap } from '@igo2/geo';\n\nimport {\n  DetailedContext,\n  ContextsList,\n  ContextUserPermission,\n  ContextProfils\n} from '../shared/context.interface';\nimport { ContextListControlsEnum } from './context-list.enum';\nimport {\n  Subscription,\n  BehaviorSubject,\n  ReplaySubject,\n  EMPTY,\n  timer\n} from 'rxjs';\nimport { take } from 'rxjs/operators';\n\nimport { MatDialog } from '@angular/material/dialog';\nimport { BookmarkDialogComponent } from '../../context-map-button/bookmark-button/bookmark-dialog.component';\nimport { debounce } from 'rxjs/operators';\nimport { ActionStore, ActionbarMode } from '@igo2/common';\n\n@Component({\n  selector: 'igo-context-list',\n  templateUrl: './context-list.component.html',\n  styleUrls: ['./context-list.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ContextListComponent implements OnInit, OnDestroy {\n  private contextsInitial: ContextsList = { ours: [] };\n  contexts$: BehaviorSubject<ContextsList> = new BehaviorSubject(\n    this.contextsInitial\n  );\n\n  change$ = new ReplaySubject<void>(1);\n\n  private change$$: Subscription;\n\n  @Input()\n  get contexts(): ContextsList {\n    return this._contexts;\n  }\n  set contexts(value: ContextsList) {\n    this._contexts = value;\n    this.cdRef.detectChanges();\n    this.next();\n  }\n  private _contexts: ContextsList = { ours: [] };\n\n  @Input()\n  get selectedContext(): DetailedContext {\n    return this._selectedContext;\n  }\n  set selectedContext(value: DetailedContext) {\n    this._selectedContext = value;\n    this.cdRef.detectChanges();\n  }\n  private _selectedContext: DetailedContext;\n\n  @Input()\n  get map(): IgoMap {\n    return this._map;\n  }\n  set map(value: IgoMap) {\n    this._map = value;\n  }\n  private _map: IgoMap;\n\n  @Input()\n  get defaultContextId(): string {\n    return this.configService.getConfig('context') ? this._defaultContextId :\n      this.storageService.get('favorite.context.uri') as string || this._defaultContextId;\n  }\n  set defaultContextId(value: string) {\n    this._defaultContextId = value;\n  }\n  private _defaultContextId: string;\n\n  public collapsed: { contextScope }[] = [];\n\n  @Output() select = new EventEmitter<DetailedContext>();\n  @Output() unselect = new EventEmitter<DetailedContext>();\n  @Output() edit = new EventEmitter<DetailedContext>();\n  @Output() delete = new EventEmitter<DetailedContext>();\n  @Output() save = new EventEmitter<DetailedContext>();\n  @Output() clone = new EventEmitter<DetailedContext>();\n  @Output() create = new EventEmitter<{ title: string; empty: boolean }>();\n  @Output() hide = new EventEmitter<DetailedContext>();\n  @Output() show = new EventEmitter<DetailedContext>();\n  @Output() showHiddenContexts = new EventEmitter<boolean>();\n  @Output() favorite = new EventEmitter<DetailedContext>();\n  @Output() managePermissions = new EventEmitter<DetailedContext>();\n  @Output() manageTools = new EventEmitter<DetailedContext>();\n  @Output() filterPermissionsChanged = new EventEmitter<\n    ContextUserPermission[]\n  >();\n\n  public titleMapping = {\n    ours: 'igo.context.contextManager.ourContexts',\n    shared: 'igo.context.contextManager.sharedContexts',\n    public: 'igo.context.contextManager.publicContexts'\n  };\n\n  public users: ContextProfils[];\n  public permissions: ContextUserPermission[] = [];\n\n  public actionStore = new ActionStore([]);\n  public actionbarMode = ActionbarMode.Overlay;\n\n  public color = 'primary';\n\n  public showHidden = false;\n\n  /**\n   * Context filter term\n   */\n  @Input()\n  set term(value: string) {\n    this._term = value;\n    this.next();\n  }\n  get term(): string {\n    return this._term;\n  }\n  public _term: string = '';\n\n  get sortedAlpha(): boolean {\n    return this._sortedAlpha;\n  }\n  set sortedAlpha(value: boolean) {\n    this._sortedAlpha = value;\n    this.next();\n  }\n  private _sortedAlpha: boolean = undefined;\n\n  public showContextFilter = ContextListControlsEnum.always;\n\n  public thresholdToFilter = 5;\n\n  constructor(\n    private cdRef: ChangeDetectorRef,\n    public configService: ConfigService,\n    public auth: AuthService,\n    private dialog: MatDialog,\n    private languageService: LanguageService,\n    private storageService: StorageService\n  ) {}\n\n  ngOnInit() {\n    this.change$$ = this.change$\n      .pipe(\n        debounce(() => {\n          return this.contexts.ours.length === 0 &&\n            this.contexts.public?.length === 0 &&\n            this.contexts.shared?.length === 0 ? EMPTY : timer(50);\n        })\n      )\n      .subscribe(() => {\n        this.contexts$.next(this.filterContextsList(this.contexts));\n      });\n\n    this.actionStore.load([\n      {\n        id: 'emptyContext',\n        title: this.languageService.translate.instant(\n          'igo.context.contextManager.emptyContext'\n        ),\n        icon: 'map-outline',\n        tooltip: this.languageService.translate.instant(\n          'igo.context.contextManager.emptyContextTooltip'\n        ),\n        handler: () => {\n          this.createContext(true);\n        }\n      },\n      {\n        id: 'contextFromMap',\n        title: this.languageService.translate.instant(\n          'igo.context.contextManager.contextMap'\n        ),\n        icon: 'map-check',\n        tooltip: this.languageService.translate.instant(\n          'igo.context.contextManager.contextMapTooltip'\n        ),\n        handler: () => {\n          this.createContext(false);\n        }\n      }\n    ]);\n  }\n\n  private next() {\n    this.change$.next();\n  }\n\n  private filterContextsList(contexts: ContextsList) {\n    if (this.term === '') {\n      if (this.sortedAlpha) {\n        contexts = this.sortContextsList(contexts);\n      }\n      return contexts;\n    } else {\n      const ours = contexts.ours.filter((context) => {\n        const filterNormalized = this.term\n          .toLowerCase()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        const contextTitleNormalized = context.title\n          .toLowerCase()\n          .normalize('NFD')\n          .replace(/[\\u0300-\\u036f]/g, '');\n        return contextTitleNormalized.includes(filterNormalized);\n      });\n\n      let updateContexts: ContextsList = {\n        ours\n      };\n\n      if (this.contexts.public) {\n        const publics = contexts.public.filter((context) => {\n          const filterNormalized = this.term\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          const contextTitleNormalized = context.title\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          return contextTitleNormalized.includes(filterNormalized);\n        });\n        updateContexts.public = publics;\n      }\n\n      if (this.contexts.shared) {\n        const shared = contexts.shared.filter((context) => {\n          const filterNormalized = this.term\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          const contextTitleNormalized = context.title\n            .toLowerCase()\n            .normalize('NFD')\n            .replace(/[\\u0300-\\u036f]/g, '');\n          return contextTitleNormalized.includes(filterNormalized);\n        });\n        updateContexts.shared = shared;\n      }\n\n      if (this.sortedAlpha) {\n        updateContexts = this.sortContextsList(updateContexts);\n      }\n      return updateContexts;\n    }\n  }\n\n  ngOnDestroy() {\n    this.change$$.unsubscribe();\n  }\n\n  public showFilter() {\n    switch (this.showContextFilter) {\n      case ContextListControlsEnum.always:\n        return true;\n      case ContextListControlsEnum.never:\n        return false;\n      default:\n        let totalLength = this.contexts.ours.length;\n        this.contexts.public\n          ? (totalLength += this.contexts.public.length)\n          : (totalLength += 0);\n        this.contexts.shared\n          ? (totalLength += this.contexts.shared.length)\n          : (totalLength += 0);\n        if (totalLength >= this.thresholdToFilter) {\n          return true;\n        }\n        return false;\n    }\n  }\n\n  sortContextsList(contexts: ContextsList) {\n    if (contexts) {\n      const contextsList = JSON.parse(JSON.stringify(contexts));\n      contextsList.ours.sort((a, b) => {\n        if (this.normalize(a.title) < this.normalize(b.title)) {\n          return -1;\n        }\n        if (this.normalize(a.title) > this.normalize(b.title)) {\n          return 1;\n        }\n        return 0;\n      });\n\n      if (contextsList.shared) {\n        contextsList.shared.sort((a, b) => {\n          if (this.normalize(a.title) < this.normalize(b.title)) {\n            return -1;\n          }\n          if (this.normalize(a.title) > this.normalize(b.title)) {\n            return 1;\n          }\n          return 0;\n        });\n      } else if (contextsList.public) {\n        contextsList.public.sort((a, b) => {\n          if (this.normalize(a.title) < this.normalize(b.title)) {\n            return -1;\n          }\n          if (this.normalize(a.title) > this.normalize(b.title)) {\n            return 1;\n          }\n          return 0;\n        });\n      }\n      return contextsList;\n    }\n  }\n\n  normalize(str: string) {\n    return str\n      .normalize('NFD')\n      .replace(/[\\u0300-\\u036f]/g, '')\n      .toLowerCase();\n  }\n\n  toggleSort(sortAlpha: boolean) {\n    this.sortedAlpha = sortAlpha;\n  }\n\n  clearFilter() {\n    this.term = '';\n  }\n\n  createContext(empty?: boolean) {\n    this.dialog\n      .open(BookmarkDialogComponent, { disableClose: false })\n      .afterClosed()\n      .pipe(take(1))\n      .subscribe((title: string) => {\n        if (title) {\n          this.create.emit({ title, empty });\n        }\n      });\n  }\n\n  getPermission(user?): ContextUserPermission {\n    if (user) {\n      const permission = this.permissions.find((p) => p.name === user.name);\n      return permission;\n    }\n  }\n\n  userSelection(user, parent?) {\n    const permission = this.getPermission(user);\n    if (permission) {\n      permission.checked = !permission.checked;\n      this.storageService.set(\n        'contexts.permissions.' + permission.name,\n        permission.checked\n      );\n      permission.indeterminate = false;\n    }\n\n    if (parent) {\n      let indeterminate = false;\n\n      for (const c of parent.childs) {\n        const cPermission = this.getPermission(c);\n        if (cPermission.checked !== permission.checked) {\n          indeterminate = true;\n          break;\n        }\n      }\n      const parentPermission = this.getPermission(parent);\n      if (parentPermission) {\n        parentPermission.checked = permission.checked;\n        this.storageService.set(\n          'contexts.permissions.' + parentPermission.name,\n          permission.checked\n        );\n        parentPermission.indeterminate = indeterminate;\n      }\n    }\n\n    if (user.childs) {\n      for (const c of user.childs) {\n        const childrenPermission = this.getPermission(c);\n        if (\n          childrenPermission &&\n          childrenPermission.checked !== permission.checked\n        ) {\n          childrenPermission.checked = permission.checked;\n          this.storageService.set(\n            'contexts.permissions.' + childrenPermission.name,\n            permission.checked\n          );\n        }\n      }\n    }\n\n    this.filterPermissionsChanged.emit(this.permissions);\n  }\n\n  hideContext(context: DetailedContext) {\n    context.hidden = true;\n    if (!this.showHidden) {\n      const contexts: ContextsList = { ours: [], shared: [], public: [] };\n      contexts.ours = this.contexts.ours.filter((c) => c.id !== context.id);\n      contexts.shared = this.contexts.shared.filter((c) => c.id !== context.id);\n      contexts.public = this.contexts.public.filter((c) => c.id !== context.id);\n      this.contexts = contexts;\n    }\n    this.hide.emit(context);\n  }\n\n  showContext(context: DetailedContext) {\n    context.hidden = false;\n    this.show.emit(context);\n  }\n}\n","import {\n  Directive,\n  Self,\n  OnInit,\n  OnDestroy,\n  HostListener,\n  ChangeDetectorRef\n} from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport { debounceTime } from 'rxjs/operators';\n\nimport { MessageService, LanguageService, StorageService } from '@igo2/core';\nimport { AuthService } from '@igo2/auth';\nimport { ConfirmDialogService } from '@igo2/common';\nimport { MapService } from '@igo2/geo';\n\nimport {\n  Context,\n  DetailedContext,\n  ContextsList,\n  ContextUserPermission\n} from '../shared/context.interface';\nimport { ContextService } from '../shared/context.service';\nimport { ContextListComponent } from './context-list.component';\n\n@Directive({\n  selector: '[igoContextListBinding]'\n})\nexport class ContextListBindingDirective implements OnInit, OnDestroy {\n  private component: ContextListComponent;\n  private contexts$$: Subscription;\n  private selectedContext$$: Subscription;\n  private defaultContextId$$: Subscription;\n  private previousMessageId;\n\n  @HostListener('select', ['$event'])\n  onSelect(context: Context) {\n    this.contextService.loadContext(context.uri);\n  }\n\n  @HostListener('edit', ['$event'])\n  onEdit(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('save', ['$event'])\n  onSave(context: Context) {\n    const map = this.mapService.getMap();\n    const contextFromMap = this.contextService.getContextFromMap(map);\n\n    const msgSuccess = () => {\n      const translate = this.languageService.translate;\n      const message = translate.instant(\n        'igo.context.contextManager.dialog.saveMsg',\n        {\n          value: context.title\n        }\n      );\n      const title = translate.instant(\n        'igo.context.contextManager.dialog.saveTitle'\n      );\n      this.messageService.success(message, title);\n    };\n\n    if (context.imported) {\n      contextFromMap.title = context.title;\n      this.contextService.delete(context.id, true);\n      this.contextService.create(contextFromMap).subscribe((contextCreated) => {\n        this.contextService.loadContext(contextCreated.uri);\n        msgSuccess();\n      });\n      return;\n    }\n\n    const changes: any = {\n      layers: contextFromMap.layers,\n      map: {\n        view: contextFromMap.map.view\n      }\n    };\n\n    this.contextService.update(context.id, changes).subscribe(() => {\n      msgSuccess();\n    });\n  }\n\n  @HostListener('favorite', ['$event'])\n  onFavorite(context: Context) {\n    if (!context.id) {\n      context.id = context.uri;\n    }\n    this.contextService.setDefault(context.id).subscribe(() => {\n      if (this.previousMessageId) {\n        this.messageService.remove(this.previousMessageId);\n      }\n      this.contextService.defaultContextId$.next(context.id);\n      const translate = this.languageService.translate;\n      const message = translate.instant(\n        'igo.context.contextManager.dialog.favoriteMsg',\n        {\n          value: context.title\n        }\n      );\n      const title = translate.instant(\n        'igo.context.contextManager.dialog.favoriteTitle'\n      );\n      const messageObj = this.messageService.success(message, title);\n      this.previousMessageId = messageObj.toastId;\n      this.cdRef.detectChanges();\n    });\n  }\n\n  @HostListener('manageTools', ['$event'])\n  onManageTools(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('managePermissions', ['$event'])\n  onManagePermissions(context: Context) {\n    this.contextService.loadEditedContext(context.uri);\n  }\n\n  @HostListener('delete', ['$event'])\n  onDelete(context: Context) {\n    const translate = this.languageService.translate;\n    this.confirmDialogService\n      .open(\n        translate.instant('igo.context.contextManager.dialog.confirmDelete')\n      )\n      .subscribe((confirm) => {\n        if (confirm) {\n          this.contextService\n            .delete(context.id, context.imported)\n            .subscribe(() => {\n              const message = translate.instant(\n                'igo.context.contextManager.dialog.deleteMsg',\n                {\n                  value: context.title\n                }\n              );\n              const title = translate.instant(\n                'igo.context.contextManager.dialog.deleteTitle'\n              );\n              this.messageService.info(message, title);\n            });\n        }\n      });\n  }\n\n  @HostListener('clone', ['$event'])\n  onClone(context: DetailedContext) {\n    const properties = {\n      title: context.title + '-copy',\n      uri: context.uri + '-copy'\n    };\n    this.contextService.clone(context.id, properties).subscribe(() => {\n      const translate = this.languageService.translate;\n      const message = translate.instant(\n        'igo.context.contextManager.dialog.cloneMsg',\n        {\n          value: context.title\n        }\n      );\n      const title = translate.instant(\n        'igo.context.contextManager.dialog.cloneTitle'\n      );\n      this.messageService.success(message, title);\n    });\n  }\n\n  @HostListener('create', ['$event'])\n  onCreate(opts: { title: string; empty: boolean }) {\n    const { title, empty } = opts;\n    const context = this.contextService.getContextFromMap(\n      this.component.map,\n      empty\n    );\n    context.title = title;\n    this.contextService.create(context).subscribe(() => {\n      const translate = this.languageService.translate;\n      const titleD = translate.instant(\n        'igo.context.bookmarkButton.dialog.createTitle'\n      );\n      const message = translate.instant(\n        'igo.context.bookmarkButton.dialog.createMsg',\n        {\n          value: context.title\n        }\n      );\n      this.messageService.success(message, titleD);\n      this.contextService.loadContext(context.uri);\n    });\n  }\n\n  @HostListener('filterPermissionsChanged')\n  loadContexts() {\n    const permissions = ['none'];\n    for (const p of this.component.permissions) {\n      if (p.checked === true || p.indeterminate === true) {\n        permissions.push(p.name);\n      }\n    }\n    this.component.showHidden\n      ? this.contextService.loadContexts(permissions, true)\n      : this.contextService.loadContexts(permissions, false);\n  }\n\n  @HostListener('showHiddenContexts')\n  showHiddenContexts() {\n    this.component.showHidden = !this.component.showHidden;\n    this.storageService.set('contexts.showHidden', this.component.showHidden);\n    this.loadContexts();\n  }\n\n  @HostListener('show', ['$event'])\n  onShowContext(context: DetailedContext) {\n    this.contextService.showContext(context.id).subscribe();\n  }\n\n  @HostListener('hide', ['$event'])\n  onHideContext(context: DetailedContext) {\n    this.contextService.hideContext(context.id).subscribe();\n  }\n\n  constructor(\n    @Self() component: ContextListComponent,\n    private contextService: ContextService,\n    private mapService: MapService,\n    private languageService: LanguageService,\n    private confirmDialogService: ConfirmDialogService,\n    private messageService: MessageService,\n    private auth: AuthService,\n    private storageService: StorageService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.component = component;\n  }\n\n  ngOnInit() {\n    // Override input contexts\n    this.component.contexts = { ours: [] };\n    this.component.showHidden = this.storageService.get(\n      'contexts.showHidden'\n    ) as boolean;\n\n    this.contexts$$ = this.contextService.contexts$.subscribe((contexts) =>\n      this.handleContextsChange(contexts)\n    );\n\n    this.defaultContextId$$ = this.contextService.defaultContextId$.subscribe(\n      (id) => {\n        this.component.defaultContextId = id;\n      }\n    );\n    const storedContextUri = this.storageService.get('favorite.context.uri') as string;\n    if (storedContextUri && !this.auth.authenticated) {\n      this.contextService.defaultContextId$.next(storedContextUri);\n    }\n\n    // See feature-list.component for an explanation about the debounce time\n    this.selectedContext$$ = this.contextService.context$\n      .pipe(debounceTime(100))\n      .subscribe((context) => (this.component.selectedContext = context));\n\n    this.auth.authenticate$.subscribe((authenticate) => {\n      if (authenticate) {\n        this.contextService.getProfilByUser().subscribe((profils) => {\n          this.component.users = profils;\n          this.component.permissions = [];\n          const profilsAcc = this.component.users.reduce((acc, cur) => {\n            acc = acc.concat(cur);\n            acc = cur.childs ? acc.concat(cur.childs) : acc;\n            return acc;\n          }, []);\n\n          for (const user of profilsAcc) {\n            const permission: ContextUserPermission = {\n              name: user.name,\n              checked: this.storageService.get(\n                'contexts.permissions.' + user.name\n              ) as boolean\n            };\n            if (permission.checked === null) {\n              permission.checked = true;\n            }\n            this.component.permissions.push(permission);\n          }\n\n          const permissions = ['none'];\n          for (const p of this.component.permissions) {\n            if (p.checked === true || p.indeterminate === true) {\n              permissions.push(p.name);\n            }\n          }\n\n          this.component.showHidden\n            ? this.contextService.loadContexts(permissions, true)\n            : this.contextService.loadContexts(permissions, false);\n        });\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.contexts$$.unsubscribe();\n    this.selectedContext$$.unsubscribe();\n    this.defaultContextId$$.unsubscribe();\n  }\n\n  private handleContextsChange(contexts: ContextsList) {\n    this.component.contexts = contexts;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, EMPTY } from 'rxjs';\n\nimport { ConfigService } from '@igo2/core';\nimport { Poi } from './poi.interface';\n\n@Injectable()\nexport class PoiService {\n  private baseUrl: string;\n\n  constructor(private http: HttpClient, private config: ConfigService) {\n    this.baseUrl = this.config.getConfig('context.url');\n  }\n\n  get(): Observable<Poi[]> {\n    if (!this.baseUrl) {\n      return EMPTY;\n    }\n\n    const url = this.baseUrl + '/pois';\n    return this.http.get<Poi[]>(url);\n  }\n\n  delete(id: string): Observable<void> {\n    const url = this.baseUrl + '/pois/' + id;\n    return this.http.delete<void>(url);\n  }\n\n  create(context: Poi): Observable<Poi> {\n    const url = this.baseUrl + '/pois';\n    return this.http.post<Poi>(url, context);\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoConfirmDialogModule, IgoStopPropagationModule } from '@igo2/common';\nimport { IgoAuthModule } from '@igo2/auth';\n\nimport { BookmarkButtonComponent } from './bookmark-button/bookmark-button.component';\nimport { BookmarkDialogComponent } from './bookmark-button/bookmark-dialog.component';\nimport { PoiButtonComponent } from './poi-button/poi-button.component';\nimport { PoiDialogComponent } from './poi-button/poi-dialog.component';\nimport { PoiService } from './poi-button/shared/poi.service';\nimport { UserDialogComponent } from './user-button/user-dialog.component';\nimport { UserButtonComponent } from './user-button/user-button.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    IgoLanguageModule,\n    IgoConfirmDialogModule,\n    IgoStopPropagationModule,\n    IgoAuthModule,\n    FormsModule,\n    MatIconModule,\n    MatButtonModule,\n    MatSelectModule,\n    MatOptionModule,\n    MatTooltipModule,\n    MatFormFieldModule,\n    MatDialogModule,\n    MatInputModule\n  ],\n  exports: [BookmarkButtonComponent, PoiButtonComponent, UserButtonComponent, BookmarkDialogComponent],\n  declarations: [\n    BookmarkButtonComponent,\n    BookmarkDialogComponent,\n    PoiButtonComponent,\n    PoiDialogComponent,\n    UserButtonComponent,\n    UserDialogComponent\n  ],\n  providers: [PoiService]\n})\nexport class IgoContextMapButtonModule {\n  static forRoot(): ModuleWithProviders<IgoContextMapButtonModule> {\n    return {\n      ngModule: IgoContextMapButtonModule\n    };\n  }\n}\n","import { NgModule, ModuleWithProviders } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatOptionModule } from '@angular/material/core';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatListModule } from '@angular/material/list';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoAuthModule } from '@igo2/auth';\nimport { IgoLanguageModule } from '@igo2/core';\nimport {\n  IgoListModule,\n  IgoKeyValueModule,\n  IgoCollapsibleModule,\n  IgoStopPropagationModule,\n  IgoActionbarModule\n} from '@igo2/common';\n\nimport { MapContextDirective } from './shared/map-context.directive';\nimport { LayerContextDirective } from './shared/layer-context.directive';\nimport { ContextListComponent } from './context-list/context-list.component';\nimport { ContextListBindingDirective } from './context-list/context-list-binding.directive';\nimport { ContextItemComponent } from './context-item/context-item.component';\nimport { ContextFormComponent } from './context-form/context-form.component';\nimport { ContextEditComponent } from './context-edit/context-edit.component';\nimport { ContextEditBindingDirective } from './context-edit/context-edit-binding.directive';\nimport { ContextPermissionsComponent } from './context-permissions/context-permissions.component';\nimport { ContextPermissionsBindingDirective } from './context-permissions/context-permissions-binding.directive';\nimport { IgoContextMapButtonModule } from '../context-map-button/context-map-button.module';\nimport { IgoContextImportExportModule } from '../context-import-export/context-import-export.module';\n\nconst CONTEXT_DIRECTIVES = [\n  MapContextDirective,\n  LayerContextDirective\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatIconModule,\n    MatButtonModule,\n    MatTooltipModule,\n    MatListModule,\n    MatCheckboxModule,\n    MatRadioModule,\n    MatDialogModule,\n    MatMenuModule,\n    MatOptionModule,\n    MatAutocompleteModule,\n    IgoAuthModule,\n    IgoListModule,\n    IgoKeyValueModule,\n    IgoCollapsibleModule,\n    IgoStopPropagationModule,\n    IgoLanguageModule,\n    IgoContextImportExportModule,\n    IgoContextMapButtonModule,\n    IgoActionbarModule\n  ],\n  exports: [\n    ContextListComponent,\n    ContextListBindingDirective,\n    ContextItemComponent,\n    ContextFormComponent,\n    ContextEditComponent,\n    ContextEditBindingDirective,\n    ContextPermissionsComponent,\n    ContextPermissionsBindingDirective,\n\n    ...CONTEXT_DIRECTIVES\n  ],\n  declarations: [\n    ContextListComponent,\n    ContextListBindingDirective,\n    ContextItemComponent,\n    ContextFormComponent,\n    ContextEditComponent,\n    ContextEditBindingDirective,\n    ContextPermissionsComponent,\n    ContextPermissionsBindingDirective,\n\n    ...CONTEXT_DIRECTIVES\n  ]\n})\nexport class IgoContextManagerModule {\n  static forRoot(): ModuleWithProviders<IgoContextManagerModule> {\n    return {\n      ngModule: IgoContextManagerModule\n    };\n  }\n}\n","import { Injectable } from '@angular/core';\n\nimport { BehaviorSubject } from 'rxjs';\nimport { ExportOptions } from '@igo2/geo';\n\nexport enum ImportExportType {\n  layer = 'layer',\n  context = 'context'\n}\n\nexport enum ImportExportMode {\n  import = 'import',\n  export = 'export'\n}\n\n/**\n * Service that holds the state of the importExport module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ImportExportState {\n\n  readonly importExportType$: BehaviorSubject<ImportExportType> = new BehaviorSubject(ImportExportType.layer);\n  readonly selectedMode$: BehaviorSubject<ImportExportMode> = new BehaviorSubject(ImportExportMode.import);\n  readonly exportOptions$: BehaviorSubject<ExportOptions> = new BehaviorSubject(undefined);\n\n  setImportExportType(type: ImportExportType) {\n    this.importExportType$.next(type);\n  }\n\n  setMode(mode: ImportExportMode) {\n    this.selectedMode$.next(mode);\n  }\n\n  setsExportOptions(exportOptions: ExportOptions) {\n      this.exportOptions$.next(exportOptions);\n    }\n\n}\n","import { Injectable } from '@angular/core';\n\nimport { Toolbox, ToolService } from '@igo2/common';\n\nimport { ExportOptions } from '@igo2/geo';\nimport { BehaviorSubject } from 'rxjs';\nimport { ImportExportMode, ImportExportState } from '../import-export/import-export.state';\n\n/**\n * Service that holds the state of the search module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class ToolState {\n  get toolbox(): Toolbox {\n    return this.toolService.toolbox;\n  }\n\n  public openSidenav$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  constructor(\n    private toolService: ToolService,\n    private importExportState: ImportExportState\n    ) {}\n\n    toolToActivateFromOptions(toolToActivate: { tool: string; options: {[key: string]: any} }) {\n    if (!toolToActivate) { return; }\n    if (toolToActivate.tool === 'importExport') {\n      let exportOptions: ExportOptions = this.importExportState.exportOptions$.value;\n      if (!exportOptions) {\n        exportOptions = {\n          layers: toolToActivate.options.layers,\n          featureInMapExtent: toolToActivate.options.featureInMapExtent\n        };\n      } else {\n        exportOptions.layers = toolToActivate.options.layers;\n        exportOptions.featureInMapExtent = toolToActivate.options.featureInMapExtent;\n      }\n      this.importExportState.setsExportOptions(exportOptions);\n      this.importExportState.setMode(ImportExportMode.export);\n    }\n\n    if (this.toolbox.getTool(toolToActivate.tool)) {\n      this.toolbox.activateTool(toolToActivate.tool);\n      this.openSidenav$.next(true);\n    }\n  }\n}\n","import {\n    FeatureMotion,\n    FeatureStoreSelectionStrategy,\n    FeatureWorkspace,\n    WfsWorkspace,\n    EditionWorkspace\n} from '@igo2/geo';\n\n\nexport function handleZoomAuto(workspace: FeatureWorkspace | WfsWorkspace | EditionWorkspace, storageService) {\n    const zoomStrategy = workspace.entityStore\n        .getStrategyOfType(FeatureStoreSelectionStrategy) as FeatureStoreSelectionStrategy;\n    zoomStrategy.setMotion(storageService.get('zoomAuto') as boolean ? FeatureMotion.Default : FeatureMotion.None);\n}\n\n\n","import { Injectable } from '@angular/core';\n\nimport { StorageService } from '@igo2/core';\n\n/**\n * Service that holds the state of storage service\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageState {\n  get storageService(): StorageService {\n    return this.igoStorageService;\n  }\n\n  constructor(private igoStorageService: StorageService) {}\n}\n","import { Injectable, OnDestroy } from '@angular/core';\n\nimport {\n  Action,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy\n} from '@igo2/common';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport {\n  FeatureWorkspace,\n  mapExtentStrategyActiveToolTip,\n  noElementSelected,\n  ExportOptions\n} from '@igo2/geo';\nimport { StorageService, StorageServiceEvent, StorageServiceEventEnum, LanguageService, MediaService} from '@igo2/core';\nimport { StorageState } from '../../storage/storage.state';\nimport { map, skipWhile } from 'rxjs/operators';\nimport { ToolState } from '../../tool/tool.state';\nimport { handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class FeatureActionsService implements OnDestroy {\n\n  public maximize$: BehaviorSubject<boolean> = new BehaviorSubject(\n    this.storageService.get('workspaceMaximize') as boolean\n  );\n\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private toolState: ToolState,\n    private mediaService: MediaService\n  ) {}\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: FeatureWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n      );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: FeatureWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(\n        skipWhile(\n          (storageChange: StorageServiceEvent) =>\n            storageChange.key !== 'zoomAuto' || storageChange.event === StorageServiceEventEnum.CLEARED\n        )\n      )\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    return [\n      {\n        id: 'zoomAuto',\n        checkbox: true,\n        title: 'igo.integration.workspace.zoomAuto.title',\n        tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\n        checkCondition: this.zoomAuto$,\n        handler: () => {\n          handleZoomAuto(workspace, this.storageService);\n          this.storageService.set(\n            'zoomAuto',\n            !this.storageService.get('zoomAuto') as boolean\n          );\n        }\n      },\n      {\n        id: 'filterInMapExtent',\n        checkbox: true,\n        title: 'igo.integration.workspace.inMapExtent.title',\n        tooltip: mapExtentStrategyActiveToolTip(workspace),\n        checkCondition: rowsInMapExtentCheckCondition$,\n        handler: () => rowsInMapExtentCheckCondition$.next(!rowsInMapExtentCheckCondition$.value)\n      },\n      {\n        id: 'selectedOnly',\n        checkbox: true,\n        title: 'igo.integration.workspace.selected.title',\n        tooltip: 'igo.integration.workspace.selected.tooltip',\n        checkCondition: selectOnlyCheckCondition$,\n        handler: () => selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\n      },\n      {\n        id: 'clearselection',\n        icon: 'select-off',\n        title: 'igo.integration.workspace.clearSelection.title',\n        tooltip: 'igo.integration.workspace.clearSelection.tooltip',\n        handler: (ws: FeatureWorkspace) => {\n          ws.entityStore.state.updateMany(ws.entityStore.view.all(), {\n            selected: false\n          });\n        },\n        args: [workspace],\n        availability: (ws: FeatureWorkspace) => noElementSelected(ws)\n      },\n      {\n        id: 'featureDownload',\n        icon: 'file-export',\n        title: 'igo.integration.workspace.download.title',\n        tooltip: 'igo.integration.workspace.download.tooltip',\n        handler: (ws: FeatureWorkspace) => {\n          const filterStrategy = ws.entityStore.getStrategyOfType(\n            EntityStoreFilterCustomFuncStrategy\n          );\n          const filterSelectionStrategy = ws.entityStore.getStrategyOfType(\n            EntityStoreFilterSelectionStrategy\n          );\n          const layersWithSelection = filterSelectionStrategy.active\n            ? [ws.layer.id]\n            : [];\n          this.toolState.toolToActivateFromOptions({\n            tool: 'importExport',\n            options: {\n              layers: [ws.layer.id],\n              featureInMapExtent: filterStrategy.active,\n              layersWithSelection\n            } as ExportOptions\n          });\n        },\n        args: [workspace]\n      },\n      {\n        id: 'maximize',\n        title: this.languageService.translate.instant('igo.integration.workspace.maximize'),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.maximizeTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => !v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          if (!this.mediaService.isMobile()) {\n            this.maximize$.next(true);\n          }\n        },\n      },\n      {\n        id: 'standardExtent',\n        title: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtent'\n        ),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtentTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          this.maximize$.next(false);\n        }\n      }\n    ];\n  }\n}\n","import { Inject, Injectable, OnDestroy } from '@angular/core';\n\nimport {\n  Action,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  Widget\n} from '@igo2/common';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport {\n  WfsWorkspace,\n  mapExtentStrategyActiveToolTip,\n  noElementSelected,\n  ExportOptions,\n  OgcFilterWidget,\n  OgcFilterableDataSource,\n} from '@igo2/geo';\nimport { StorageService, StorageServiceEvent, StorageServiceEventEnum, LanguageService, MediaService} from '@igo2/core';\nimport { StorageState } from '../../storage/storage.state';\nimport { map, skipWhile } from 'rxjs/operators';\nimport { ToolState } from '../../tool/tool.state';\nimport { handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WfsActionsService implements OnDestroy {\n\n  public maximize$: BehaviorSubject<boolean> = new BehaviorSubject(\n    this.storageService.get('workspaceMaximize') as boolean\n  );\n\n  selectOnlyCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  // rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject(true);\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    @Inject(OgcFilterWidget) private ogcFilterWidget: Widget,\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private mediaService: MediaService,\n    private toolState: ToolState) {}\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: WfsWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n      );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: WfsWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(skipWhile((storageChange: StorageServiceEvent) =>\n        storageChange?.key !== 'zoomAuto' || storageChange?.event === StorageServiceEventEnum.CLEARED))\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    const actions = [\n      {\n        id: 'zoomAuto',\n        checkbox: true,\n        title: 'igo.integration.workspace.zoomAuto.title',\n        tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\n        checkCondition: this.zoomAuto$,\n        handler: () => {\n          handleZoomAuto(workspace, this.storageService);\n          this.storageService.set('zoomAuto', !this.storageService.get('zoomAuto') as boolean);\n        }\n      },\n      {\n        id: 'filterInMapExtent',\n        checkbox: true,\n        title: 'igo.integration.workspace.inMapExtent.title',\n        tooltip: mapExtentStrategyActiveToolTip(workspace),\n        checkCondition: rowsInMapExtentCheckCondition$,\n        handler: () => rowsInMapExtentCheckCondition$.next(!rowsInMapExtentCheckCondition$.value)\n      },\n      {\n        id: 'selectedOnly',\n        checkbox: true,\n        title: 'igo.integration.workspace.selected.title',\n        tooltip: 'igo.integration.workspace.selected.title',\n        checkCondition: selectOnlyCheckCondition$,\n        handler: () => selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\n      },\n      {\n        id: 'clearselection',\n        icon: 'select-off',\n        title: 'igo.integration.workspace.clearSelection.title',\n        tooltip: 'igo.integration.workspace.clearSelection.tooltip',\n        handler: (ws: WfsWorkspace) => {\n          ws.entityStore.state.updateMany(ws.entityStore.view.all(), { selected: false });\n        },\n        args: [workspace],\n        availability: (ws: WfsWorkspace) => noElementSelected(ws)\n      },\n      {\n        id: 'wfsDownload',\n        icon: 'file-export',\n        title: 'igo.integration.workspace.download.title',\n        tooltip: 'igo.integration.workspace.download.tooltip',\n        handler: (ws: WfsWorkspace) => {\n          const filterStrategy = ws.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n          const filterSelectionStrategy = ws.entityStore.getStrategyOfType(EntityStoreFilterSelectionStrategy);\n          const layersWithSelection = filterSelectionStrategy.active ? [ws.layer.id] : [];\n          this.toolState.toolToActivateFromOptions({\n            tool: 'importExport',\n            options: { layers: [ws.layer.id], featureInMapExtent: filterStrategy.active, layersWithSelection } as ExportOptions\n          });\n        },\n        args: [workspace]\n      },\n      {\n        id: 'ogcFilter',\n        icon: 'filter',\n        title: 'igo.integration.workspace.ogcFilter.title',\n        tooltip: 'igo.integration.workspace.ogcFilter.tooltip',\n        handler: (widget: Widget, ws: WfsWorkspace) => {\n          ws.activateWidget(widget, {\n            map: ws.map,\n            layer: ws.layer\n          });\n        },\n        args: [this.ogcFilterWidget, workspace]\n      },\n      {\n        id: 'maximize',\n        title: this.languageService.translate.instant('igo.integration.workspace.maximize'),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.maximizeTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => !v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          if (!this.mediaService.isMobile()) {\n            this.maximize$.next(true);\n          }\n        },\n      },\n      {\n        id: 'standardExtent',\n        title: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtent'\n        ),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtentTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          this.maximize$.next(false);\n        }\n      }\n    ];\n    return (workspace.layer.dataSource as OgcFilterableDataSource).options.ogcFilters?.enabled ?\n    actions : actions.filter(action => action.id !== 'ogcFilter');\n  }\n}\n","import { Inject, Injectable, OnDestroy } from '@angular/core';\n\nimport {\n  Action,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  Widget\n} from '@igo2/common';\n\nimport { BehaviorSubject, Subscription } from 'rxjs';\nimport {\n  EditionWorkspace,\n  mapExtentStrategyActiveToolTip,\n  noElementSelected,\n  ExportOptions,\n  OgcFilterWidget,\n  OgcFilterableDataSource,\n} from '@igo2/geo';\nimport { StorageService, StorageServiceEvent, StorageServiceEventEnum, LanguageService, MediaService} from '@igo2/core';\nimport { StorageState } from '../../storage/storage.state';\nimport { map, skipWhile } from 'rxjs/operators';\nimport { ToolState } from '../../tool/tool.state';\nimport { handleZoomAuto } from './workspace.utils';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EditionActionsService implements OnDestroy {\n\n  public maximize$: BehaviorSubject<boolean> = new BehaviorSubject(\n    this.storageService.get('workspaceMaximize') as boolean\n  );\n\n  zoomAuto$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  private storageChange$$: Subscription;\n\n  get storageService(): StorageService {\n    return this.storageState.storageService;\n  }\n\n  get zoomAuto(): boolean {\n    return this.storageService.get('zoomAuto') as boolean;\n  }\n\n  constructor(\n    @Inject(OgcFilterWidget) private ogcFilterWidget: Widget,\n    private storageState: StorageState,\n    public languageService: LanguageService,\n    private mediaService: MediaService,\n    private toolState: ToolState) {}\n\n  ngOnDestroy(): void {\n    if (this.storageChange$$) {\n      this.storageChange$$.unsubscribe();\n    }\n  }\n\n  loadActions(\n    workspace: EditionWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ) {\n    const actions = this.buildActions(\n      workspace,\n      rowsInMapExtentCheckCondition$,\n      selectOnlyCheckCondition$\n      );\n    workspace.actionStore.load(actions);\n  }\n\n  buildActions(\n    workspace: EditionWorkspace,\n    rowsInMapExtentCheckCondition$: BehaviorSubject<boolean>,\n    selectOnlyCheckCondition$: BehaviorSubject<boolean>\n    ): Action[] {\n    this.zoomAuto$.next(this.zoomAuto);\n    this.storageChange$$ = this.storageService.storageChange$\n      .pipe(skipWhile((storageChange: StorageServiceEvent) =>\n        storageChange?.key !== 'zoomAuto' || storageChange?.event === StorageServiceEventEnum.CLEARED))\n      .subscribe(() => {\n        this.zoomAuto$.next(this.zoomAuto);\n        handleZoomAuto(workspace, this.storageService);\n      });\n    const actions = [\n      {\n        id: 'zoomAuto',\n        checkbox: true,\n        title: 'igo.integration.workspace.zoomAuto.title',\n        tooltip: 'igo.integration.workspace.zoomAuto.tooltip',\n        checkCondition: this.zoomAuto$,\n        handler: () => {\n          handleZoomAuto(workspace, this.storageService);\n          this.storageService.set('zoomAuto', !this.storageService.get('zoomAuto') as boolean);\n        }\n      },\n      {\n        id: 'filterInMapExtent',\n        checkbox: true,\n        title: 'igo.integration.workspace.inMapExtent.title',\n        tooltip: mapExtentStrategyActiveToolTip(workspace),\n        checkCondition: rowsInMapExtentCheckCondition$,\n        handler: () => rowsInMapExtentCheckCondition$.next(!rowsInMapExtentCheckCondition$.value)\n      },\n      {\n        id: 'selectedOnly',\n        checkbox: true,\n        title: 'igo.integration.workspace.selected.title',\n        tooltip: 'igo.integration.workspace.selected.title',\n        checkCondition: selectOnlyCheckCondition$,\n        handler: () => selectOnlyCheckCondition$.next(!selectOnlyCheckCondition$.value)\n      },\n      {\n        id: 'clearselection',\n        icon: 'select-off',\n        title: 'igo.integration.workspace.clearSelection.title',\n        tooltip: 'igo.integration.workspace.clearSelection.tooltip',\n        handler: (ws: EditionWorkspace) => {\n          ws.entityStore.state.updateMany(ws.entityStore.view.all(), { selected: false });\n        },\n        args: [workspace],\n        availability: (ws: EditionWorkspace) => noElementSelected(ws)\n      },\n      {\n        id: 'wfsDownload',\n        icon: 'file-export',\n        title: 'igo.integration.workspace.download.title',\n        tooltip: 'igo.integration.workspace.download.tooltip',\n        handler: (ws: EditionWorkspace) => {\n          const filterStrategy = ws.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n          const filterSelectionStrategy = ws.entityStore.getStrategyOfType(EntityStoreFilterSelectionStrategy);\n          const layersWithSelection = filterSelectionStrategy.active ? [ws.layer.id] : [];\n          this.toolState.toolToActivateFromOptions({\n            tool: 'importExport',\n            options: { layers: [ws.layer.id], featureInMapExtent: filterStrategy.active, layersWithSelection } as ExportOptions\n          });\n        },\n        args: [workspace]\n      },\n      {\n        id: 'ogcFilter',\n        icon: 'filter',\n        title: 'igo.integration.workspace.ogcFilter.title',\n        tooltip: 'igo.integration.workspace.ogcFilter.tooltip',\n        handler: (widget: Widget, ws: EditionWorkspace) => {\n          ws.activateWidget(widget, {\n            map: ws.map,\n            layer: ws.layer\n          });\n        },\n        args: [this.ogcFilterWidget, workspace]\n      },\n      {\n        id: 'maximize',\n        title: this.languageService.translate.instant('igo.integration.workspace.maximize'),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.maximizeTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => !v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          if (!this.mediaService.isMobile()) {\n            this.maximize$.next(true);\n          }\n        },\n      },\n      {\n        id: 'standardExtent',\n        title: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtent'\n        ),\n        tooltip: this.languageService.translate.instant(\n          'igo.integration.workspace.standardExtentTooltip'\n        ),\n        icon: 'resize',\n        display: () => {\n          return this.maximize$.pipe(map((v) => v && !this.mediaService.isMobile()));\n        },\n        handler: () => {\n          this.maximize$.next(false);\n        }\n      }\n    ];\n    return (workspace.layer.dataSource as OgcFilterableDataSource).options.ogcFilters?.enabled ?\n    actions : actions.filter(action => action.id !== 'ogcFilter');\n  }\n}\n","import { Injectable, OnDestroy } from '@angular/core';\n\nimport { BehaviorSubject, Subscription, Observable, of } from 'rxjs';\n\nimport {\n  EntityRecord,\n  Workspace,\n  WorkspaceStore,\n  Widget,\n  EntityStoreFilterCustomFuncStrategy,\n  EntityStoreFilterSelectionStrategy,\n  EntityState } from '@igo2/common';\nimport { WfsWorkspace, FeatureWorkspace, EditionWorkspace } from '@igo2/geo';\nimport { FeatureActionsService } from './shared/feature-actions.service';\nimport { WfsActionsService } from './shared/wfs-actions.service';\nimport { StorageService } from '@igo2/core';\nimport { EditionActionsService } from './shared/edition-actions.service';\n\n/**\n * Service that holds the state of the workspace module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class WorkspaceState implements OnDestroy {\n\n  public workspacePanelExpanded: boolean = false;\n\n  readonly workspaceEnabled$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n  readonly rowsInMapExtentCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(true);\n  readonly selectOnlyCheckCondition$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n\n  readonly workspaceMaximize$: BehaviorSubject<boolean> = new BehaviorSubject(\n    this.storageService.get('workspaceMaximize') as boolean\n  );\n  private actionMaximize$$: Subscription[] = [];\n\n  private rowsInMapExtentCheckCondition$$: Subscription;\n  private selectOnlyCheckCondition$$: Subscription;\n\n  /** Subscription to the active workspace */\n  private activeWorkspace$$: Subscription;\n\n  /** Subscription to the active workspace widget */\n  private activeWorkspaceWidget$$: Subscription;\n\n  /** Active widget observable. Only one may be active for all available workspaces */\n  readonly activeWorkspaceWidget$: BehaviorSubject<Widget> = new BehaviorSubject<Widget>(undefined);\n\n  /**\n   * Observable of the active workspace\n   */\n  public workspace$ = new BehaviorSubject<Workspace>(undefined);\n\n  /**\n   * Store that holds all the available workspaces\n   */\n  get store(): WorkspaceStore { return this._store; }\n  private _store: WorkspaceStore;\n\n  get workspaceSelection() {\n    if (this.workspace$.value) {\n    return this.workspace$.value?.entityStore.stateView.manyBy((r) => r.state.selected === true);\n    } else {\n      return [];\n    }\n  }\n\n  get workspaceSelection$(): Observable<EntityRecord<object, EntityState>[]> {\n    if (this.workspace$.value) {\n      return this.workspace$.value?.entityStore?.stateView.manyBy$((r) => r.state.selected === true);\n    } else {\n      return of([]);\n    }\n  }\n\n  constructor(\n    private featureActionsService: FeatureActionsService,\n    private wfsActionsService: WfsActionsService,\n    private editionActionsService: EditionActionsService,\n    private storageService: StorageService\n  ) {\n    this.initWorkspaces();\n  }\n\n  /**\n   * Initialize the workspace store. Each time a workspace is activated,\n   * subscribe to it's active widget. Tracking the active widget is useful\n   * to make sure only one widget is active at a time.\n   */\n  private initWorkspaces() {\n    this._store = new WorkspaceStore([]);\n    this._store.stateView\n      .firstBy$((record: EntityRecord<Workspace>) => record.state.active === true)\n      .subscribe((record: EntityRecord<Workspace>) => {\n        const workspace = record ? record.entity : undefined;\n        this.workspace$.next(workspace);\n      });\n\n    this._store.stateView.all$()\n    .subscribe((workspaces: EntityRecord<Workspace>[]) => {\n      workspaces.map((wks: EntityRecord<Workspace>) => {\n        if (wks.entity.actionStore.empty) {\n          if (wks.entity instanceof WfsWorkspace) {\n            this.wfsActionsService.loadActions(\n              wks.entity,\n              this.rowsInMapExtentCheckCondition$,\n              this.selectOnlyCheckCondition$);\n          } else if (wks.entity instanceof FeatureWorkspace) {\n            this.featureActionsService.loadActions(\n              wks.entity,\n              this.rowsInMapExtentCheckCondition$,\n              this.selectOnlyCheckCondition$);\n          } else if (wks.entity instanceof EditionWorkspace) {\n            this.editionActionsService.loadActions(\n              wks.entity,\n              this.rowsInMapExtentCheckCondition$,\n              this.selectOnlyCheckCondition$);\n          }\n        }\n\n      });\n    });\n\n    this.actionMaximize$$.push(this.featureActionsService.maximize$.subscribe(maximized => {\n      this.setWorkspaceIsMaximized(maximized);\n    }));\n\n    this.actionMaximize$$.push(this.wfsActionsService.maximize$.subscribe(maximized => {\n      this.setWorkspaceIsMaximized(maximized);\n    }));\n\n    this.actionMaximize$$.push(this.editionActionsService.maximize$.subscribe(maximized => {\n      this.setWorkspaceIsMaximized(maximized);\n    }));\n\n    this.activeWorkspace$$ = this.workspace$\n      .subscribe((workspace: Workspace) => {\n        if (this.activeWorkspaceWidget$$ !== undefined) {\n          this.activeWorkspaceWidget$$.unsubscribe();\n          this.activeWorkspaceWidget$$ = undefined;\n        }\n\n        if (workspace !== undefined) {\n          this.activeWorkspaceWidget$$ = workspace.widget$\n            .subscribe((widget: Widget) => this.activeWorkspaceWidget$.next(widget));\n        }\n      });\n\n    this.rowsInMapExtentCheckCondition$$ = this.rowsInMapExtentCheckCondition$.subscribe((rowsInMapExtent) => {\n      this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\n        if (!wks.entity.actionStore.empty) {\n          const filterStrategy = wks.entity.entityStore.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n          if (filterStrategy) {\n            if (rowsInMapExtent) {\n              filterStrategy.activate();\n            } else {\n              filterStrategy.deactivate();\n            }\n          }\n        }\n      });\n    });\n\n    this.selectOnlyCheckCondition$$ = this.selectOnlyCheckCondition$.subscribe((selectOnly) => {\n      this._store.stateView.all().map((wks: EntityRecord<Workspace>) => {\n        if (!wks.entity.actionStore.empty) {\n          const filterStrategy = wks.entity.entityStore.getStrategyOfType(EntityStoreFilterSelectionStrategy);\n          if (filterStrategy) {\n            if (selectOnly) {\n              filterStrategy.activate();\n            } else {\n              filterStrategy.deactivate();\n            }\n          }\n        }\n      });\n    });\n  }\n\n  private setWorkspaceIsMaximized(maximized: boolean) {\n    this.storageService.set('workspaceMaximize', maximized);\n    this.workspaceMaximize$.next(maximized);\n  }\n\n  public setActiveWorkspaceById(id: string) {\n    const wksFromId = this.store\n    .all()\n    .find(workspace => workspace.id === id);\n    if (wksFromId) {\n      this.store.activateWorkspace(wksFromId);\n    }\n  }\n\n  public setActiveWorkspaceByTitle(title: string) {\n    const wksFromTitle = this.store\n      .all()\n      .find(workspace => workspace.title === title);\n    if (wksFromTitle) {\n      this.store.activateWorkspace(wksFromTitle);\n    }\n  }\n\n  /**\n   * Teardown all the workspaces\n   * @internal\n   */\n  ngOnDestroy() {\n    this.teardownWorkspaces();\n    this.actionMaximize$$.map(a => a.unsubscribe());\n    if (this.rowsInMapExtentCheckCondition$$) {\n      this.selectOnlyCheckCondition$$.unsubscribe();\n    }\n    if (this.selectOnlyCheckCondition$$) {\n      this.selectOnlyCheckCondition$$.unsubscribe();\n    }\n  }\n\n  /**\n   * Teardown the workspace store and any subscribers\n   */\n  private teardownWorkspaces() {\n    this.store.clear();\n    if (this.activeWorkspaceWidget$$ !== undefined) {\n      this.activeWorkspaceWidget$$.unsubscribe();\n    }\n    if (this.activeWorkspace$$ !== undefined) {\n      this.activeWorkspace$$.unsubscribe();\n    }\n  }\n\n}\n","import { Injectable } from '@angular/core';\n\nimport { EntityRecord, EntityStore, EntityStoreFilterCustomFuncStrategy, EntityStoreStrategyFuncOptions } from '@igo2/common';\nimport { ConfigService, StorageService } from '@igo2/core';\nimport { SearchResult, SearchSourceService, SearchSource, CommonVectorStyleOptions } from '@igo2/geo';\nimport { BehaviorSubject, Subscription } from 'rxjs';\n\n/**\n * Service that holds the state of the search module\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class SearchState {\n  public searchOverlayStyle: CommonVectorStyleOptions = {};\n  public searchOverlayStyleSelection: CommonVectorStyleOptions = {};\n  public searchOverlayStyleFocus: CommonVectorStyleOptions = {};\n\n  public focusedOrResolution$$: Subscription;\n  public selectedOrResolution$$: Subscription;\n\n  readonly searchTermSplitter$: BehaviorSubject<string> = new BehaviorSubject('|');\n\n  readonly searchTerm$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly searchType$: BehaviorSubject<string> = new BehaviorSubject(undefined);\n\n  readonly searchDisabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly searchResultsGeometryEnabled$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n\n  readonly searchSettingsChange$: BehaviorSubject<boolean> = new BehaviorSubject(undefined);\n\n  readonly selectedResult$: BehaviorSubject<SearchResult> = new BehaviorSubject(undefined);\n\n  /**\n   * Store that holds the search results\n   */\n  readonly store: EntityStore<SearchResult> = new EntityStore<SearchResult>([]);\n\n  /**\n   * Search types currently enabled in the search source service\n   */\n  get searchTypes(): string[] {\n    return this.searchSourceService\n      .getEnabledSources()\n      .map((source: SearchSource) => (source.constructor as any).type);\n  }\n\n  constructor(\n    private searchSourceService: SearchSourceService,\n    private storageService: StorageService,\n    private configService: ConfigService) {\n    const searchOverlayStyle = this.configService.getConfig('searchOverlayStyle') as {\n      base?: CommonVectorStyleOptions,\n      selection?: CommonVectorStyleOptions,\n      focus?: CommonVectorStyleOptions\n    };\n    if (searchOverlayStyle) {\n      this.searchOverlayStyle = searchOverlayStyle.base;\n      this.searchOverlayStyleSelection = searchOverlayStyle.selection;\n      this.searchOverlayStyleFocus = searchOverlayStyle.focus;\n    }\n\n    const searchResultsGeometryEnabled = this.storageService.get('searchResultsGeometryEnabled') as boolean;\n    if (searchResultsGeometryEnabled) {\n      this.searchResultsGeometryEnabled$.next(searchResultsGeometryEnabled);\n    }\n    this.store.addStrategy(this.createCustomFilterTermStrategy(), false);\n  }\n\n  private createCustomFilterTermStrategy(): EntityStoreFilterCustomFuncStrategy {\n    const filterClauseFunc = (record: EntityRecord<SearchResult>) => {\n      return record.entity.meta.score === 100;\n    };\n    return new EntityStoreFilterCustomFuncStrategy({filterClauseFunc} as EntityStoreStrategyFuncOptions);\n  }\n\n  /**\n   * Activate custom strategy\n   *\n   */\n  activateCustomFilterTermStrategy() {\n    const strategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n    if (strategy !== undefined) {\n      strategy.activate();\n    }\n  }\n\n  /**\n   * Deactivate custom strategy\n   *\n   */\n  deactivateCustomFilterTermStrategy() {\n    const strategy = this.store.getStrategyOfType(EntityStoreFilterCustomFuncStrategy);\n    if (strategy !== undefined) {\n      strategy.deactivate();\n    }\n  }\n\n  enableSearch() {\n    this.searchDisabled$.next(false);\n  }\n\n  disableSearch() {\n    this.searchDisabled$.next(true);\n  }\n\n  setSearchTerm(searchTerm: string) {\n    this.searchTerm$.next(searchTerm);\n  }\n\n  setSearchType(searchType: string) {\n    this.searchSourceService.enableSourcesByType(searchType);\n    this.searchType$.next(searchType);\n  }\n\n  setSearchSettingsChange() {\n    this.searchSettingsChange$.next(true);\n  }\n\n  setSelectedResult(result: SearchResult) {\n    this.selectedResult$.next(result);\n  }\n\n  setSearchResultsGeometryStatus(value) {\n    this.storageService.set('searchResultsGeometryEnabled', value);\n    this.searchResultsGeometryEnabled$.next(value);\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { IgoSearchModule } from '@igo2/geo';\n\nimport { SearchBarBindingDirective } from './search-bar-binding.directive';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [IgoSearchModule],\n  declarations: [SearchBarBindingDirective],\n  exports: [SearchBarBindingDirective],\n})\nexport class IgoAppSearchBarModule {}\n","import { NgModule, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoLanguageModule } from '@igo2/core';\nimport { IgoFlexibleModule, IgoCustomHtmlModule, IgoPanelModule } from '@igo2/common';\nimport {\n  IgoFeatureModule,\n  IgoSearchModule,\n  IgoFeatureDetailsModule\n} from '@igo2/geo';\n\nimport { SearchResultsToolComponent } from './search-results-tool.component';\n\n/**\n * @ignore\n */\n@NgModule({\n  imports: [\n    CommonModule,\n    MatIconModule,\n    MatBadgeModule,\n    MatTooltipModule,\n    MatButtonModule,\n    IgoLanguageModule,\n    IgoFeatureModule,\n    IgoSearchModule,\n    IgoFlexibleModule,\n    IgoPanelModule,\n    IgoFeatureDetailsModule,\n    IgoCustomHtmlModule\n  ],\n  declarations: [SearchResultsToolComponent],\n  exports: [SearchResultsToolComponent],\n  schemas: [CUSTOM_ELEMENTS_SCHEMA]\n})\nexport class IgoAppSearchResultsToolModule {}\n","import { NgModule } from '@angular/core';\n\nimport { IgoAppSearchBarModule } from './search-bar/search-bar.module';\nimport { IgoAppSearchResultsToolModule } from './search-results-tool/search-results-tool.module';\n\n@NgModule({\n  imports: [],\n  declarations: [],\n  exports: [\n   IgoAppSearchBarModule,\n   IgoAppSearchResultsToolModule\n  ],\n})\nexport class IgoAppSearchModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Search</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: ConfigService, LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/search\">code of this example</a><br>\n    See search section of the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/environments\"> environment config</a>\n    <hr>\n    <br>\n    <span *ngIf=\"!isTouchScreen\" title=\"Details\">\n      F2 activate/deactivate the pointer location.\n    </span>\n  </mat-card-content>\n\n  <igo-map-browser #mapBrowser [map]=\"map\" [view]=\"view\" igoOverlay [igoContextMenu]=actionbarMenu igoLongPress\n\n    igoSearchPointerSummary\n    [igoSearchPointerSummaryDelay]=\"500\"\n    [igoSearchPointerSummaryEnabled]=\"igoSearchPointerSummaryEnabled\"\n    (menuPosition)=\"onContextMenuOpen($event)\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Search\">\n    <igo-search-bar\n      [term]=\"term\"\n      (pointerSummaryStatus)=\"onPointerSummaryStatusChange($event)\"\n      [searchSettings]=\"true\"\n      [store]=\"searchStore\"\n      [termSplitter]=\"termSplitter\"\n      (searchTermChange)=\"onSearchTermChange($event)\"\n      (search)=\"onSearch($event)\"\n      (clearFeature)=\"removeFeatureFromMap()\"\n      (searchSettingsChange)=\"onSearchSettingsChange()\"\n      [reverseSearchCoordsFormatEnabled]=\"igoReverseSearchCoordsFormatEnabled\"\n      (reverseSearchCoordsFormatStatus)=\"onReverseCoordsFormatStatusChange($event)\">\n    </igo-search-bar>\n\n    <igo-search-results\n      [store]=\"searchStore\"\n      [term]=\"term\"\n      [termSplitter]=\"termSplitter\"\n      placeholder=\"false\"\n      [settingsChange$]=\"settingsChange$\"\n      (resultFocus)=\"onResultFocus($event)\"\n      (resultSelect)=\"onResultFocus($event)\"\n      (moreResults)=\"onSearch($event)\">\n        <ng-template #igoSearchItemToolbar let-result=\"result\">\n          <igo-search-add-button\n            [map]=\"map\"\n            [layer]=\"result\">\n          </igo-search-add-button>\n        </ng-template>\n    </igo-search-results>\n\n  </igo-panel>\n\n  <igo-panel *ngIf=\"selectedFeature\" title=\"Details\">\n    <igo-feature-details [feature]=\"selectedFeature\"></igo-feature-details>\n  </igo-panel>\n\n</mat-card>\n\n<ng-template #actionbarMenu>\n  <igo-actionbar\n    [store]=\"store\"\n    [withIcon]=\"false\"\n    [horizontal]=\"true\"\n    [mode]=\"'context'\">\n  </igo-actionbar>\n</ng-template>\n\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppSearchComponent } from './search.component';\n\nconst routes: Routes = [\n  {\n    path: 'search',\n    component: AppSearchComponent\n  }\n];\n\nexport const AppSearchRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { BehaviorSubject } from 'rxjs';\nimport {\n  Component,\n  ElementRef,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport * as proj from 'ol/proj';\n\nimport { LanguageService, MediaService, StorageService } from '@igo2/core';\nimport { EntityStore, ActionStore } from '@igo2/common';\nimport {\n  FEATURE,\n  Feature,\n  FeatureMotion,\n  GoogleLinks,\n  IgoMap,\n  LayerService,\n  MapService,\n  Layer,\n  ProjectionService,\n  Research,\n  SearchResult\n} from '@igo2/geo';\n\nimport { SearchState } from '@igo2/integration';\n\n@Component({\n  selector: 'app-search',\n  templateUrl: './search.component.html',\n  styleUrls: ['./search.component.scss']\n})\nexport class AppSearchComponent implements OnInit, OnDestroy {\n  public store = new ActionStore([]);\n\n  public igoSearchPointerSummaryEnabled: boolean = false;\n\n  public termSplitter: string = '|';\n\n  public map = new IgoMap({\n    overlay: true,\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  public osmLayer: Layer;\n\n  @ViewChild('mapBrowser', { read: ElementRef, static: true }) mapBrowser: ElementRef;\n\n  public lonlat;\n  public mapProjection: string;\n  public term: string;\n\n  public settingsChange$ = new BehaviorSubject<boolean>(undefined);\n\n  get searchStore(): EntityStore<SearchResult> {\n    return this.searchState.store;\n  }\n\n  get isTouchScreen(): boolean {\n    return this.mediaService.isTouchScreen();\n  }\n\n  public selectedFeature: Feature;\n  public igoReverseSearchCoordsFormatEnabled: boolean;\n\n  constructor(\n    private languageService: LanguageService,\n    private projectionService: ProjectionService,\n    private mapService: MapService,\n    private layerService: LayerService,\n    private searchState: SearchState,\n    private mediaService: MediaService,\n    private storageService: StorageService,\n  ) {\n    this.mapService.setMap(this.map);\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe(layer => {\n        this.osmLayer = layer;\n        this.map.addLayer(layer);\n      });\n\n      this.igoReverseSearchCoordsFormatEnabled =\n      this.storageService.get('reverseSearchCoordsFormatEnabled') as boolean || false;\n  }\n\n  onPointerSummaryStatusChange(value) {\n    this.igoSearchPointerSummaryEnabled = value;\n  }\n\n  onSearchTermChange(term?: string) {\n    this.term = term;\n    this.searchState.setSearchTerm(term);\n    const termWithoutHashtag = term.replace(/(#[^\\s]*)/g, '').trim();\n    if (termWithoutHashtag.length < 2) {\n      this.searchStore.clear();\n      this.selectedFeature = undefined;\n    }\n  }\n\n  onSearch(event: { research: Research; results: SearchResult[] }) {\n    const results = event.results;\n    this.searchStore.state.updateAll({ focused: false, selected: false });\n    const newResults = this.searchStore.entities$.value\n      .filter((result: SearchResult) => result.source !== event.research.source)\n      .concat(results);\n    this.searchStore.updateMany(newResults);\n  }\n\n  onReverseCoordsFormatStatusChange(value) {\n    this.storageService.set('reverseSearchCoordsFormatEnabled', value);\n    this.igoReverseSearchCoordsFormatEnabled = value;\n  }\n\n  onSearchSettingsChange() {\n    this.settingsChange$.next(true);\n  }\n\n  /**\n   * Try to add a feature to the map when it's being focused\n   * @internal\n   * @param result A search result that could be a feature\n   */\n  onResultFocus(result: SearchResult) {\n    this.tryAddFeatureToMap(result);\n    this.selectedFeature = (result as SearchResult<Feature>).data;\n  }\n\n  /**\n   * Try to add a feature to the map overlay\n   * @param layer A search result that could be a feature\n   */\n  private tryAddFeatureToMap(layer: SearchResult) {\n    if (layer.meta.dataType !== FEATURE) {\n      return undefined;\n    }\n\n    // Somethimes features have no geometry. It happens with some GetFeatureInfo\n    if (layer.data.geometry === undefined) {\n      return;\n    }\n\n    this.map.searchResultsOverlay.setFeatures(\n      [layer.data] as Feature[],\n      FeatureMotion.Default\n    );\n  }\n\n  ngOnInit() {\n    this.store.load([\n      {\n        id: 'coordinates',\n        title: 'coordinates',\n        handler: () => this.searchCoordinate(this.lonlat)\n      },\n      {\n        id: 'googleMaps',\n        title: 'googleMap',\n        handler: () => this.openGoogleMaps(this.lonlat),\n      },\n      {\n        id: 'googleStreetView',\n        title: 'googleStreetView',\n        handler: () => this.openGoogleStreetView(this.lonlat)\n      }\n    ]);\n  }\n\n  ngOnDestroy() {\n    this.store.destroy();\n  }\n\n  /*\n   * Remove a feature to the map overlay\n   */\n  removeFeatureFromMap() {\n    this.map.searchResultsOverlay.clear();\n  }\n\n  onContextMenuOpen(event: { x: number; y: number }) {\n    const position = this.mapPosition(event);\n    const coord = this.mapService.getMap().ol.getCoordinateFromPixel(position);\n    this.mapProjection = this.mapService.getMap().projection;\n    this.lonlat = proj.transform(coord, this.mapProjection, 'EPSG:4326');\n  }\n\n  mapPosition(event: { x: number; y: number }) {\n    const contextmenuPoint = event;\n    contextmenuPoint.y =\n      contextmenuPoint.y -\n      this.mapBrowser.nativeElement.getBoundingClientRect().top +\n      window.scrollY;\n    contextmenuPoint.x =\n      contextmenuPoint.x -\n      this.mapBrowser.nativeElement.getBoundingClientRect().left +\n      window.scrollX;\n    const position = [contextmenuPoint.x, contextmenuPoint.y];\n    return position;\n  }\n\n  searchCoordinate(lonlat) {\n    this.searchStore.clear();\n    this.term = (!this.igoReverseSearchCoordsFormatEnabled) ?\n    lonlat.map((c) => c.toFixed(6)).join(', ') : lonlat.reverse().map((c) => c.toFixed(6)).join(', ');\n  }\n\n  openGoogleMaps(lonlat) {\n    window.open(GoogleLinks.getGoogleMapsCoordLink(lonlat[0], lonlat[1]));\n  }\n\n  openGoogleStreetView(lonlat) {\n    window.open(\n      GoogleLinks.getGoogleStreetViewLink(lonlat[0], lonlat[1])\n    );\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { IgoMessageModule } from '@igo2/core';\n\nimport {\n  IgoPanelModule,\n  IgoActionbarModule,\n  IgoContextMenuModule\n} from '@igo2/common';\n\nimport {\n  IgoFeatureModule,\n  IgoMapModule,\n  IgoSearchModule,\n  provideIChercheSearchSource,\n  provideILayerSearchSource,\n  provideNominatimSearchSource,\n  provideIChercheReverseSearchSource,\n  provideCoordinatesReverseSearchSource,\n  provideStoredQueriesSearchSource,\n  provideStoredQueriesReverseSearchSource\n} from '@igo2/geo';\n\nimport { IgoAppSearchModule } from '@igo2/integration';\n\nimport { AppSearchComponent } from './search.component';\nimport { AppSearchRoutingModule } from './search-routing.module';\n\n@NgModule({\n  declarations: [AppSearchComponent],\n  imports: [\n    CommonModule,\n    AppSearchRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    MatTooltipModule,\n    IgoMessageModule.forRoot(),\n    IgoPanelModule,\n    IgoMapModule,\n    IgoSearchModule.forRoot(),\n    IgoAppSearchModule,\n    IgoActionbarModule,\n    IgoContextMenuModule,\n    IgoFeatureModule\n  ],\n  exports: [AppSearchComponent],\n  providers: [\n    provideCoordinatesReverseSearchSource(),\n    provideIChercheSearchSource(),\n    provideILayerSearchSource(),\n    provideNominatimSearchSource(),\n    provideIChercheReverseSearchSource(),\n    provideStoredQueriesSearchSource(),\n    provideStoredQueriesReverseSearchSource()\n  ]\n})\nexport class AppSearchModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppPrintComponent } from './print.component';\n\nconst routes: Routes = [\n  {\n    path: 'print',\n    component: AppPrintComponent\n  }\n];\n\nexport const AppPrintRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { IgoMap, LayerService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-print',\n  templateUrl: './print.component.html',\n  styleUrls: ['./print.component.scss']\n})\nexport class AppPrintComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: false\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 9\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private layerService: LayerService\n  ) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'Quebec Base Map',\n        sourceOptions: {\n          type: 'wmts',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/carto/wmts/1.0.0/wmts',\n          layer: 'carte_gouv_qc_ro',\n          matrixSet: 'EPSG_3857',\n          version: '1.3.0',\n          crossOrigin: 'anonymous',\n          attributions: \" <a href='http://www.droitauteur.gouv.qc.ca/copyright.php' target='_blank'><img src='https://geoegl.msp.gouv.qc.ca/gouvouvert/public/images/quebec/gouv_qc_logo.png' width='64' height='14'>Gouvernement du Qubec</a> / <a href='https://www.igouverte.org/' target='_blank'>IGO2</a>\"\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    this.layerService\n      .createAsyncLayer({\n        title: 'School board',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          params: {\n            LAYERS: 'MELS_CS_ANGLO_S',\n            VERSION: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n    //\n    this.layerService\n      .createAsyncLayer({\n        title: 'Embacle',\n        sourceOptions: {\n          type: 'wms',\n          url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n          params: {\n            LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n            VERSION: '1.3.0'\n          },\n          crossOrigin: 'anonymous'\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n\n    // this.layerService\n    //   .createAsyncLayer({\n    //     title: 'Geomet',\n    //     sourceOptions: {\n    //       type: 'wms',\n    //       url: 'http://geo.weather.gc.ca/geomet/?lang=fr',\n    //       params: {\n    //         LAYERS: 'RADAR_1KM_RDBR',\n    //         VERSION: '1.3.0'\n    //       },\n    //       crossOrigin: 'anonymous'\n    //     }\n    //   })\n    //   .subscribe(l => this.map.addLayer(l));\n\n    /*\n        //CORS error if activate (for test)\n        this.layerService\n          .createAsyncLayer({\n            title: 'Geomet',\n            sourceOptions: {\n              type: 'wms',\n              url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq?service=wms',\n              params: {\n                layers: 'swtq',\n                version: '1.3.0',\n              }\n            }\n          })\n          .subscribe(l => this.map.addLayer(l));\n    */\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Print</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/print\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-home-extent-button [map]=\"map\" color=\"primary\"></igo-home-extent-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"false\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n  <igo-print [map]=\"map\"></igo-print>\n\n</mat-card>\n\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport { IgoMapModule, IgoPrintModule } from '@igo2/geo';\n\nimport { AppPrintComponent } from './print.component';\nimport { AppPrintRoutingModule } from './print-routing.module';\n\n@NgModule({\n  declarations: [AppPrintComponent],\n  imports: [\n    AppPrintRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoPrintModule\n  ],\n  exports: [AppPrintComponent]\n})\nexport class AppPrintModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppImportExportComponent } from './import-export.component';\n\nconst routes: Routes = [\n  {\n    path: 'import-export',\n    component: AppImportExportComponent\n  }\n];\n\nexport const AppImportExportRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { IgoMap, LayerService } from '@igo2/geo';\nimport { WorkspaceStore } from '@igo2/common';\n\n@Component({\n  selector: 'app-import-export',\n  templateUrl: './import-export.component.html',\n  styleUrls: ['./import-export.component.scss']\n})\nexport class AppImportExportComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 9\n  };\n\n  public store = new WorkspaceStore([]);\n\n  constructor(\n    private languageService: LanguageService,\n    private layerService: LayerService\n  ) {\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Import / Export</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/import-export\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-import-export [store]=\"store\" [map]=\"map\"></igo-import-export>\n\n</mat-card>\n\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport {\n  IgoMapModule,\n  IgoImportExportModule,\n  provideStyleListOptions\n} from '@igo2/geo';\n\nimport { AppImportExportComponent } from './import-export.component';\nimport { AppImportExportRoutingModule } from './import-export-routing.module';\n\n@NgModule({\n  declarations: [AppImportExportComponent],\n  imports: [\n    AppImportExportRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoImportExportModule\n  ],\n  exports: [AppImportExportComponent],\n  providers: [\n    provideStyleListOptions({\n      path: './assets/import-style.json'\n    })\n  ]\n})\nexport class AppImportExport {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppDirectionsComponent } from './directions.component';\n\nconst routes: Routes = [\n  {\n    path: 'directions',\n    component: AppDirectionsComponent\n  }\n];\n\nexport const AppDirectionsRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  LayerService,\n  MapService,\n  ProjectionService,\n  StopsStore,\n  StopsFeatureStore,\n  RoutesFeatureStore,\n  StepFeatureStore\n} from '@igo2/geo';\nimport { Subject } from 'rxjs';\n\n@Component({\n  selector: 'app-directions',\n  templateUrl: './directions.component.html',\n  styleUrls: ['./directions.component.scss']\n})\nexport class AppDirectionsComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 9,\n    geolocate: false\n  };\n\n  public stopsStore: StopsStore = new StopsStore([]);\n  public stopsFeatureStore: StopsFeatureStore = new StopsFeatureStore([], { map: this.map });\n  public stepFeatureStore: StepFeatureStore = new StepFeatureStore([], { map: this.map });\n  public routesFeatureStore: RoutesFeatureStore = new RoutesFeatureStore([], { map: this.map });\n  public zoomToActiveRoute$: Subject<void> = new Subject();\n\n  constructor(\n    private projectionService: ProjectionService,\n    private languageService: LanguageService,\n    private layerService: LayerService,\n    private mapService: MapService\n  ) {\n    this.mapService.setMap(this.map);\n    this.layerService\n      .createAsyncLayer({\n        title: 'OSM',\n        sourceOptions: {\n          type: 'osm'\n        }\n      })\n      .subscribe(l => this.map.addLayer(l));\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Directions</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/directions\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-home-extent-button [map]=\"map\" color=\"primary\"></igo-home-extent-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"false\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n  <igo-directions\n    [stopsStore]=\"stopsStore\"\n    [stopsFeatureStore]=\"stopsFeatureStore\"\n    [stepFeatureStore]=\"stepFeatureStore\"\n    [routesFeatureStore]=\"routesFeatureStore\"\n    [zoomToActiveRoute$]=\"zoomToActiveRoute$\">  \n  </igo-directions>\n\n\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\n\nimport { IgoMessageModule } from '@igo2/core';\nimport {\n  IgoMapModule,\n  IgoDirectionsModule,\n  provideOsrmDirectionsSource\n} from '@igo2/geo';\n\nimport { AppDirectionsComponent } from './directions.component';\nimport { AppDirectionsRoutingModule } from './directions-routing.module';\n\n@NgModule({\n  declarations: [AppDirectionsComponent],\n  imports: [\n    AppDirectionsRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    IgoMessageModule,\n    IgoMapModule,\n    IgoDirectionsModule\n  ],\n  exports: [AppDirectionsComponent],\n  providers: [provideOsrmDirectionsSource()]\n})\nexport class AppDirectionsModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppTimeFilterComponent } from './time-filter.component';\n\nconst routes: Routes = [\n  {\n    path: 'time-filter',\n    component: AppTimeFilterComponent\n  }\n];\n\nexport const AppTimeFilterRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  TimeFilterableDataSourceOptions,\n  TimeFilterType,\n  TimeFilterStyle\n} from '@igo2/geo';\n\n@Component({\n  selector: 'app-time-filter',\n  templateUrl: './time-filter.component.html',\n  styleUrls: ['./time-filter.component.scss']\n})\nexport class AppTimeFilterComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    // const datasource: TimeFilterableDataSourceOptions = {\n    //   type: 'wms',\n    //   url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\n    //   params: {\n    //     layers: 'vg_observation_v_inondation_embacle_wmst',\n    //     version: '1.3.0'\n    //   },\n    //   timeFilterable: true,\n    //   timeFilter: {\n    //     min: '2017-01-01',\n    //     max: '2018-01-01',\n    //     range: true,\n    //     type: TimeFilterType.DATETIME,\n    //     style: TimeFilterStyle.SLIDER,\n    //     step: 86400000,\n    //     timeInterval: 2000\n    //   }\n    // };\n\n    const datasourceYear: TimeFilterableDataSourceOptions = {\n      type: 'wms',\n      url: 'https://geoegl.msp.gouv.qc.ca/ws/igo_gouvouvert.fcgi',\n      params: {\n        LAYERS: 'vg_observation_v_inondation_embacle_wmst',\n        VERSION: '1.3.0'\n      },\n      timeFilterable: true,\n      timeFilter: {\n        min: '2013',\n        max: '2019',\n        range: false,\n        type: TimeFilterType.YEAR,\n        style: TimeFilterStyle.SLIDER,\n        step: 1,\n        timeInterval: 2000\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceYear)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embcle YEAR',\n            visible: true,\n            source: dataSource\n          })\n        );\n      });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Time filter</mat-card-title>\n  <mat-card-content>\n    <li>npm install --save moment@2.22.2</li>\n    <li>npm install --save @mat-datetimepicker/core@3.0.0-beta.0</li>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/time-filter\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Layers\">\n    <igo-time-filter-list [layers]=\"map.layers\"></igo-time-filter-list>\n  </igo-panel>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoFilterModule } from '@igo2/geo';\n\nimport { AppTimeFilterComponent } from './time-filter.component';\nimport { AppTimeFilterRoutingModule } from './time-filter-routing.module';\n\n@NgModule({\n  declarations: [AppTimeFilterComponent],\n  imports: [\n    AppTimeFilterRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoFilterModule\n  ],\n  exports: [AppTimeFilterComponent]\n})\nexport class AppTimeFilterModule {}\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppOgcFilterComponent } from './ogc-filter.component';\n\nconst routes: Routes = [\n  {\n    path: 'ogc-filter',\n    component: AppOgcFilterComponent\n  }\n];\n\nexport const AppOgcFilterRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WMSDataSourceOptions,\n  WFSDataSourceOptions,\n  WFSDataSourceOptionsParams,\n  OgcFilterableDataSourceOptions,\n  AnyBaseOgcFilterOptions,\n  OgcFilterOperatorType,\n  OgcFilterDuringOptions\n} from '@igo2/geo';\n\nimport {Fill, Stroke, Circle, Style} from 'ol/style';\n\n@Component({\n  selector: 'app-ogc-filter',\n  templateUrl: './ogc-filter.component.html',\n  styleUrls: ['./ogc-filter.component.scss']\n})\nexport class AppOgcFilterComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 7\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    interface WFSoptions\n      extends WFSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const datasource: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'code_municipalite', alias: '# de la municipalite' },\n        { name: 'date_observation', excludeFromOgcFilters: true },\n        { name: 'urgence', values: ['immdiate', 'inconnue'] }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters: {\n          logical: 'Or',\n          filters: [\n            {\n              operator: 'PropertyIsEqualTo',\n              propertyName: 'code_municipalite',\n              expression: '10043'\n            },\n            {\n              operator: 'Intersects',\n              geometryName: 'the_geom',\n              wkt_geometry: `MULTIPOLYGON(((\n              -8379441.158019895 5844447.897707146,\n              -8379441.158019895 5936172.331649357,\n              -8134842.66750733 5936172.331649357,\n              -8134842.66750733 5844447.897707146,\n              -8379441.158019895 5844447.897707146\n            ), (\n              -8015003 5942074,\n              -8015003 5780349,\n              -7792364 5780349,\n              -7792364 5942074,\n              -8015003 5942074\n            )))`\n            }\n          ] as AnyBaseOgcFilterOptions[]\n        }\n      }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasource)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embcle (PropertyIsEqualTo OR Intersects)',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'orange',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilter: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2016-01-21T00:00:00-05:00',\n            end: '2016-01-26T00:00:00-05:00'\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2016-02-10T00:00:00-05:00',\n      stepDate: 'P2D'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilter)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embcle (During, Step: P2D)',\n            id: '1',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'red',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n\n    const datasourceDuringFilterTime: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2016-01-01T04:00:00-05:00',\n            end: '2016-01-12T16:00:00-05:00'\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2016-02-14T20:00:00-05:00',\n      stepDate: 'PT4H'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTime)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embcle (During, Step: PT4H)',\n            id: '2',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'blue',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeMonth: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2016-01-01T00:00:00-05:00',\n            end: '2016-03-31T00:00:00-05:00',\n            displayFormat: 'MMMM'\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2018-12-31T00:00:00-05:00',\n      stepDate: 'P1M'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeMonth)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embcle (During, Step: P1M)',\n            id: '3',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'yellow',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeYear: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2014-01-01T00:00:00-05:00',\n            end: '2019-12-31T00:00:00-05:00',\n            sliderOptions: {\n              interval: 2000,\n              displayFormat: 'YY'\n            },\n            displayFormat: 'YYYY'\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2014-01-01T00:00:00-05:00',\n      maxDate: '2019-12-31T00:00:00-05:00',\n      stepDate: 'P1Y'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeYear)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embcle (During, Step: P1Y)',\n            id: '4',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'green',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeInterval: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: 'today - 2 days', // \"now\" can also be used. Instead of midnight, the current time will be used\n            end: 'today', // \"now\" can also be used. Instead of midnight, the current time will be used\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2025-12-31T00:00:00-05:00',\n      stepDate: 'P1D'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeInterval)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embcle (During, Interval from Now, Step: P1D)',\n            id: '5',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'white'\n                }),\n                stroke: new Stroke({\n                  color: 'black',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const datasourceDuringFilterTimeRestrictedToStep: WFSoptions = {\n      type: 'wfs',\n      url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n      params: {\n        featureTypes: 'vg_observation_v_autre_wmst',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '2.0.0',\n        outputFormat: undefined,\n        outputFormatDownload: 'SHP' // based on service capabilities\n      },\n      sourceFields: [\n        { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n      ],\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        allowedOperatorsType: OgcFilterOperatorType.All,\n        filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation',\n            begin: '2019-01-01 00:00:00',\n            restrictToStep: true\n          } as OgcFilterDuringOptions\n      },\n      minDate: '2016-01-01T00:00:00-05:00',\n      maxDate: '2025-12-31T00:00:00-05:00',\n      stepDate: 'P1M'\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(datasourceDuringFilterTimeRestrictedToStep)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Embcle (During, RestrictToStep, Step: P1M)',\n            id: '6',\n            source: dataSource,\n            style: new Style({\n              image: new Circle({\n                radius: 5,\n                fill: new Fill({\n                  color: 'black'\n                }),\n                stroke: new Stroke({\n                  color: 'red',\n                  width: 1\n                })\n              })\n            })\n          })\n        );\n      });\n\n    const wmsOgcFilterOptions: WMSoptions = {\n        type: 'wms',\n        url: 'https://geoegl.msp.gouv.qc.ca/apis/ws/igo_gouvouvert.fcgi',\n        optionsFromCapabilities: true,\n        params: {\n          LAYERS: 'vg_observation_v_inondation23avril2017_wmst',\n          VERSION: '1.3.0'\n        },\n        sourceFields: [\n          { name: 'date_observation', alias: 'Date de l\\'observation', allowedOperatorsType: 'Time' as OgcFilterOperatorType }\n        ],\n        ogcFilters: {\n          enabled: true,\n          editable: true,\n          filters:\n          {\n            operator: 'During',\n            propertyName: 'date_observation'\n          } as OgcFilterDuringOptions,\n          allowedOperatorsType: OgcFilterOperatorType.Time\n        }\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wmsOgcFilterOptions)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Inondation (During, optionsFromCapabilities)',\n            source: dataSource\n          })\n        );\n      });\n\n    interface WMSoptions\n      extends WMSDataSourceOptions,\n        OgcFilterableDataSourceOptions {}\n\n    const filterableWMSwithPushButtons: WMSoptions = {\n      type: 'wms',\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      params: {\n        LAYERS: 'radars_photos',\n        VERSION: '1.3.0'\n      },\n      ogcFilters: {\n        enabled: true,\n        editable: true,\n        pushButtons: {\n          selectorType: 'pushButton',\n          order: 2,\n          groups : [\n            {title: 'Nom du group1 - push', name: '1 - push', ids : ['id1']},\n          ],\n          bundles: [\n            {\n              id: 'id1',\n              title: 'Rgions',\n              logical: 'Or',\n              vertical: true,\n              selectors: [\n                {\n                  title: 'Montral & Laval',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    logical: 'Or',\n                    filters: [\n                      {\n                        operator: 'PropertyIsEqualTo',\n                        propertyName: 'region',\n                        expression: 'Montral'\n                      },\n                      {\n                        operator: 'PropertyIsEqualTo',\n                        propertyName: 'region',\n                        expression: 'Laval'\n                      }\n                    ]\n                  }\n                },\n                {\n                  title: 'Outside Montral & Laval',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    logical: 'And',\n                    filters: [\n                      {\n                        operator: 'PropertyIsNotEqualTo',\n                        propertyName: 'region',\n                        expression: 'Montral'\n                      },\n                      {\n                        operator: 'PropertyIsNotEqualTo',\n                        propertyName: 'region',\n                        expression: 'Laval'\n                      }\n                    ]\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        checkboxes: {\n          selectorType: 'checkbox',\n          order: 1,\n          groups : [\n            {title: 'Nom du group1 - checkbox', name: '1 - checkbox', ids : ['id1']},\n          ],\n          bundles: [\n            {\n              id: 'id1',\n              title: 'Type de radar photo',\n              logical: 'Or',\n              selectors: [\n                {\n                  title: 'Radar photo fixe',\n                  enabled: true,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo fixe'\n                  }\n                },\n                {\n                  title: 'Radar photo mobile',\n                  enabled: false,\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo mobile'\n                  }\n                },\n                {\n                  title: 'Radar photo fixe + feu rouge',\n                  enabled: false,\n                  color: '0,200,0',\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Radar photo fixe et surveillance au feu rouge'\n                  }\n                },\n                {\n                  title: 'Radar feu rouge',\n                  enabled: false,\n                  color: '255,0,0',\n                  tooltip: 'Here a tooltip explaning ...',\n                  filters: {\n                    operator: 'PropertyIsEqualTo',\n                    propertyName: 'typeAppareil',\n                    expression: 'Appareil de surveillance au feu rouge'\n                  }\n                }\n              ]\n            }\n          ]\n        },\n        allowedOperatorsType: OgcFilterOperatorType.Basic\n        },\n      paramsWFS: {\n        featureTypes: 'radars_photos',\n        fieldNameGeometry: 'geometry',\n        maxFeatures: 10000,\n        version: '1.1.0',\n        outputFormat: 'geojson',\n        outputFormatDownload: 'shp'\n      } as WFSDataSourceOptionsParams\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(filterableWMSwithPushButtons)\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'Filterable WMS layers with predefined filters (push buttons)',\n            source: dataSource\n          })\n        );\n      });\n\n    // const datasourceWmsWith2Layers: WMSoptions = {\n    //   type: 'wms',\n    //   url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n    //   urlWfs: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n    //   params: {\n    //     layers: 'stations_meteoroutieres,histo_stations_meteoroutieres',\n    //     version: '1.3.0'\n    //   },\n    //   ogcFilters: {\n    //     enabled: true,\n    //     editable: true\n    //   },\n    //   paramsWFS: {\n    //     featureTypes: 'histo_stations_meteoroutieres',\n    //     fieldNameGeometry: 'geometry',\n    //     maxFeatures: 10000,\n    //     version: '1.1.0',\n    //     outputFormat: 'geojson',\n    //     outputFormatDownload: 'shp'\n    //   } as WFSDataSourceOptionsParams\n    // };\n    //\n    // this.dataSourceService\n    //   .createAsyncDataSource(datasourceWmsWith2Layers)\n    //   .subscribe(dataSource => {\n    //     this.map.addLayer(\n    //       this.layerService.createLayer({\n    //         title: 'Layer build from 2 WMS layers',\n    //         source: dataSource\n    //       })\n    //     );\n    //   });\n\n    // const datasourceWms: WMSoptions = {\n    //   type: 'wms',\n    //   url: '/geoserver/wms',\n    //   urlWfs: '/geoserver/wfs',\n    //   params: {\n    //     LAYERS: 'water_areas',\n    //     VERSION: '1.3.0'\n    //   },\n    //   ogcFilters: {\n    //     enabled: true,\n    //     editable: true,\n    //     filters: {\n    //       operator: 'PropertyIsEqualTo',\n    //       propertyName: 'waterway',\n    //       expression: 'riverbank'\n    //     }\n    //   },\n    //   sourceFields: [\n    //     { name: 'waterway', alias: 'Chemin d eau' },\n    //     { name: 'osm_id' },\n    //     { name: 'landuse', values: ['yes', 'no'] }\n    //   ],\n    //   paramsWFS: {\n    //     featureTypes: 'water_areas',\n    //     fieldNameGeometry: 'the_geom',\n    //     maxFeatures: 10000,\n    //     version: '1.1.0',\n    //     outputFormat: 'application/json',\n    //     outputFormatDownload: 'application/vnd.google-earth.kml+xml'\n    //   } as WFSDataSourceOptionsParams\n    // };\n    //\n    // this.dataSourceService\n    //   .createAsyncDataSource(datasourceWms)\n    //   .subscribe(dataSource => {\n    //     this.map.addLayer(\n    //       this.layerService.createLayer({\n    //         title: 'Geoserver water_areas',\n    //         source: dataSource\n    //       })\n    //     );\n    //   });\n  }\n}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Ogc filter</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/ogc-filter\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Layers\">\n    <igo-ogc-filterable-list [map]=\"map\" [layers]=\"map.layers\">\n\n    </igo-ogc-filterable-list>\n  </igo-panel>\n\n</mat-card>\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule } from '@igo2/common';\nimport { IgoMapModule, IgoFilterModule } from '@igo2/geo';\n\nimport { AppOgcFilterComponent } from './ogc-filter.component';\nimport { AppOgcFilterRoutingModule } from './ogc-filter-routing.module';\n\n@NgModule({\n  declarations: [AppOgcFilterComponent],\n  imports: [\n    AppOgcFilterRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoFilterModule\n  ],\n  exports: [AppOgcFilterComponent]\n})\nexport class AppOgcFilterModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Query</mat-card-title>\n  <mat-card-content>\n    <li>Dependencies: LanguageService</li>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/query\">code of this example</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser\n    [map]=\"map\"\n    [view]=\"view\"\n    igoOverlay\n    igoQuery\n    [queryFeatures]=\"true\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-panel>\n    <igo-spatial-filter-type\n      [store]=\"spatialListStore\"\n      [selectedQueryType]=\"queryType\"\n      [zone]=\"zone\"\n      [layers]=\"activeLayers\"\n      (eventType)=\"getOutputType($event)\"\n      (eventQueryType)=\"getOutputQueryType($event)\"\n      (zoneChange)=\"onZoneChange($event)\"\n      (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n      (bufferChange)=\"buffer = $event\"\n      (measureUnitChange)=\"measureUnit = $event\">\n    </igo-spatial-filter-type>\n\n    <igo-spatial-filter-item\n      [type]=\"type\"\n      [queryType]=\"queryType\"\n      [map]=\"map\"\n      [zone]=\"zone\"\n      [loading]=\"loading\"\n      [store]=\"store\"\n      [layers]=\"activeLayers\"\n      [allLayers]=\"layers\"\n      [thematicLength]=\"thematicLength\"\n      (radiusEvent)=\"buffer = $event\"\n      (bufferEvent)=\"buffer = $event\"\n      (measureUnitChange)=\"measureUnit = $event\"\n      (freehandControl)=\"freehandDrawIsActive = $event\"\n      (drawZoneEvent)=\"zone = $event\"\n      (zoneWithBufferChange)=\"onZoneChange($event, true)\"\n      (itemTypeChange)=\"itemType = $event\"\n      (thematicChange)=\"thematics = $event\"\n      (toggleSearch)=\"getOutputToggleSearch()\"\n      (clearButtonEvent)=\"clearMap()\"\n      (clearSearchEvent)=\"getOutputClearSearch()\">\n    </igo-spatial-filter-item>\n  </igo-panel>\n\n  <igo-panel>\n    <ng-container *ngIf=\"selectedFeature$ | async as feature\">\n      <igo-feature-details [feature]=\"feature\"></igo-feature-details>\n    </ng-container>\n  </igo-panel>\n</mat-card>","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppSpatialFilterComponent } from './spatial-filter.component';\n\nconst routes: Routes = [\n  {\n    path: 'spatial-filter',\n    component: AppSpatialFilterComponent\n  }\n];\n\nexport const AppSpatialFilterRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, Input, ChangeDetectionStrategy, ChangeDetectorRef, OnDestroy, OnInit } from '@angular/core';\nimport { MatIconRegistry } from '@angular/material/icon';\nimport { Observable, forkJoin, Subject } from 'rxjs';\nimport { tap, take, takeUntil } from 'rxjs/operators';\n\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  Feature,\n  moveToOlFeatures,\n  FeatureMotion,\n  ClusterDataSource,\n  featureToOl,\n  DataSource,\n  QueryableDataSourceOptions,\n  SpatialFilterService,\n  SpatialFilterType,\n  SpatialFilterItemType,\n  SpatialFilterQueryType,\n  SpatialFilterThematic,\n  Layer,\n  VectorLayer,\n  createOverlayMarkerStyle,\n  MeasureLengthUnit\n} from '@igo2/geo';\nimport { EntityStore } from '@igo2/common';\nimport olFormatGeoJSON from 'ol/format/GeoJSON';\nimport olSourceVector from 'ol/source/Vector';\nimport olSourceCluster from 'ol/source/Cluster';\nimport type { default as OlGeometry } from 'ol/geom/Geometry';\nimport { BehaviorSubject } from 'rxjs';\nimport * as olstyle from 'ol/style';\nimport { MessageService, LanguageService } from '@igo2/core';\n\n/**\n * Spatial Filter Type\n */\n@Component({\n  selector: 'app-spatial-filter',\n  templateUrl: './spatial-filter.component.html',\n  styleUrls: ['./spatial-filter.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class AppSpatialFilterComponent implements OnInit, OnDestroy {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  @Input() type: SpatialFilterType;\n  @Input() itemType: SpatialFilterItemType = SpatialFilterItemType.Address;\n  @Input() freehandDrawIsActive: boolean;\n\n  public layers: Layer[] = [];\n  public activeLayers: Layer[] = [];\n\n  public queryType: SpatialFilterQueryType;\n  public thematics: SpatialFilterThematic[];\n  public zone: Feature;\n  public zoneWithBuffer: Feature;\n  public buffer = 0;\n\n  public iterator = 1;\n\n  public selectedFeature$: BehaviorSubject<Feature> = new BehaviorSubject(\n    undefined\n  );\n\n  private format = new olFormatGeoJSON();\n\n  public store: EntityStore<Feature> = new EntityStore<Feature>([]); // Store to print results at the end\n\n  public spatialListStore: EntityStore<Feature> = new EntityStore<Feature>([]);\n\n  public loading = false;\n\n  public thematicLength = 0;\n\n  public measureUnit: MeasureLengthUnit = MeasureLengthUnit.Meters;\n  private unsubscribe$ = new Subject<void>();\n\n  public defaultStyle: olstyle.Style | ((feature, resolution) => olstyle.Style);\n\n  constructor(\n    private matIconRegistry: MatIconRegistry,\n    private spatialFilterService: SpatialFilterService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    private messageService: MessageService,\n    private languageService: LanguageService,\n    private cdRef: ChangeDetectorRef\n  ) {\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n  }\n\n  ngOnInit() {\n    for (const layer of this.map.layers) {\n      if (layer.title && layer.title.includes(this.languageService.translate.instant('igo.geo.spatialFilter.spatialFilter'))) {\n        this.layers.push(layer);\n      }\n    }\n  }\n\n  ngOnDestroy() {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n\n  getOutputType(event: SpatialFilterType) {\n    this.type = event;\n    this.queryType = undefined;\n  }\n\n  getOutputQueryType(event: SpatialFilterQueryType) {\n    this.queryType = event;\n    if (this.queryType) {\n      this.loadFilterList();\n    }\n  }\n\n  private loadFilterList() {\n    this.spatialFilterService\n      .loadFilterList(this.queryType)\n      .pipe(takeUntil(this.unsubscribe$))\n      .subscribe((features: Feature[]) => {\n        features.sort((a, b) => {\n          if (a.properties.nom < b.properties.nom) {\n            return -1;\n          }\n          if (a.properties.nom > b.properties.nom) {\n            return 1;\n          }\n          return 0;\n        });\n        this.spatialListStore.clear();\n        this.spatialListStore.load(features);\n      });\n  }\n\n  getOutputToggleSearch() {\n    this.loadThematics();\n  }\n\n  getOutputClearSearch() {\n    this.zone = undefined;\n    this.queryType = undefined;\n  }\n\n  clearMap() {\n    this.map.removeLayers(this.layers);\n    this.layers = [];\n    this.activeLayers = [];\n    this.thematicLength = 0;\n    this.iterator = 1;\n    if (this.type === SpatialFilterType.Predefined) {\n      this.zone = undefined;\n      this.queryType = undefined;\n    }\n  }\n\n  private loadThematics() {\n    this.loading = true;\n    let zeroResults = true;\n    let thematics;\n    if (this.buffer === 0 || this.type === SpatialFilterType.Point) {\n      this.tryAddFeaturesToMap([this.zone]);\n    }\n    if (this.itemType !== SpatialFilterItemType.Thematics) {\n      const theme: SpatialFilterThematic = {\n        name: ''\n      };\n      thematics = [theme];\n    } else {\n      thematics = this.thematics;\n    }\n    if (this.measureUnit === MeasureLengthUnit.Kilometers && this.type !== SpatialFilterType.Point) {\n      this.buffer = this.buffer * 1000;\n    }\n    if (this.type === SpatialFilterType.Polygon) {\n      this.buffer = 0; // to avoid buffer enter a second time in terrAPI\n    }\n\n    const observables$: Observable<Feature[]>[] = [];\n    thematics.forEach(thematic => {\n      observables$.push(\n        this.spatialFilterService\n          .loadFilterItem(\n            this.zone,\n            this.itemType,\n            this.queryType,\n            thematic,\n            this.buffer\n          )\n          .pipe(\n            tap((features: Feature[]) => {\n              this.store.insertMany(features);\n              const featuresPoint: Feature[] = [];\n              const featuresLinePoly: Feature[] = [];\n              let idPoint;\n              let idLinePoly;\n              features.forEach(feature => {\n                if (feature.geometry.type === 'Point') {\n                  feature.properties.longitude = feature.geometry.coordinates[0];\n                  feature.properties.latitude = feature.geometry.coordinates[1];\n                  featuresPoint.push(feature);\n                  idPoint = feature.meta.id;\n                } else {\n                  featuresLinePoly.push(feature);\n                  idLinePoly = feature.meta.id;\n                }\n              });\n\n              this.tryAddPointToMap(featuresPoint, idPoint);\n              this.tryAddLayerToMap(featuresLinePoly, idLinePoly);\n              if (features.length) {\n                zeroResults = false;\n                this.thematicLength += 1;\n                thematic.zeroResults = false;\n                this.cdRef.detectChanges();\n              } else {\n                thematic.zeroResults = true;\n              }\n\n              if (features.length >= 10000) {\n                this.messageService.alert(\n                  this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.maxSizeAlert'\n                  ),\n                  this.languageService.translate.instant(\n                    'igo.geo.spatialFilter.warning'\n                  ),\n                  { timeOut: 10000 }\n                );\n              }\n            })\n          )\n      );\n    });\n\n    forkJoin(observables$).pipe(takeUntil(this.unsubscribe$)).subscribe(() => {\n      this.loading = false;\n      if (zeroResults) {\n        this.messageService.alert(\n          this.languageService.translate.instant(\n            'igo.geo.spatialFilter.zeroResults'\n          ),\n          this.languageService.translate.instant(\n            'igo.geo.spatialFilter.warning'\n          ),\n          { timeOut: 10000 }\n        );\n      }\n    });\n  }\n\n  onZoneChange(feature: Feature, buffer?: boolean) {\n    this.zone = feature;\n    if (feature) {\n      buffer ? this.tryAddFeaturesToMap([feature], true) : this.tryAddFeaturesToMap([feature]);\n      this.zoomToFeatureExtent(feature);\n    }\n  }\n\n  /**\n   * Try to add zone feature to the map overlay\n   */\n  public tryAddFeaturesToMap(features: Feature[], buffer?: boolean) {\n    let i = 1;\n    for (const feature of features) {\n      if (this.type === SpatialFilterType.Predefined) {\n        for (const layer of this.layers) {\n          if (\n            layer.options._internal &&\n            layer.options._internal.code === feature.properties.code &&\n            !buffer\n          ) {\n            if (!layer.title?.startsWith('Zone')) {\n              const index = this.layers.indexOf(layer);\n              this.layers.splice(index, 1);\n            }\n            return;\n          }\n          if (layer.title?.startsWith('Zone')) {\n            this.activeLayers = [];\n            const index = this.layers.indexOf(layer);\n            this.layers.splice(index, 1);\n            this.map.removeLayer(layer);\n          }\n        }\n      } else {\n        if (buffer) {\n          for (const layer of this.activeLayers) {\n            if (this.activeLayers.length === 1 && layer.title?.startsWith('Zone')) {\n              const index = this.layers.indexOf(layer);\n              this.layers.splice(index, 1);\n              this.map.removeLayer(layer);\n            }\n          }\n        }\n        this.activeLayers = [];\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith('Zone')) {\n          i++;\n        }\n      }\n      this.defaultStyle = (_feature, resolution) => {\n        const coordinates = (features[0] as any).coordinates;\n        return new olstyle.Style({\n          image: new olstyle.Circle({\n            radius: coordinates\n              ? this.buffer /\n                Math.cos((Math.PI / 180) * coordinates[1]) /\n                resolution\n              : undefined,\n            fill: new olstyle.Fill({\n              color: 'rgba(200, 200, 20, 0.2)'\n            }),\n            stroke: new olstyle.Stroke({\n              width: 1,\n              color: 'orange'\n            })\n          }),\n          stroke: new olstyle.Stroke({\n            width: 1,\n            color: 'orange'\n          }),\n          fill: new olstyle.Fill({\n            color: 'rgba(200, 200, 20, 0.2)'\n          })\n        });\n      };\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: DataSource) => {\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: ('Zone ' + i + ' - ' + this.languageService.translate.instant(\n              'igo.geo.spatialFilter.spatialFilter'\n            )) as string,\n            workspace: { enabled: true },\n            _internal: {\n              code:\n                this.type === SpatialFilterType.Predefined\n                  ? feature.properties.code\n                  : undefined\n            },\n            source: dataSource,\n            visible: true\n          }) as VectorLayer;\n          const featuresOl = features.map(f => {\n            return featureToOl(f, this.map.projection);\n          });\n          if (this.type !== SpatialFilterType.Predefined) {\n            const type = this.type === SpatialFilterType.Point ? 'Cercle' : 'Polygone';\n            featuresOl[0].set('nom', 'Zone', true);\n            featuresOl[0].set('type', type, true);\n          }\n          const ol = dataSource.ol as olSourceVector<OlGeometry> | olSourceCluster;\n          ol.addFeatures(featuresOl);\n          olLayer.ol.setStyle(this.defaultStyle);\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.activeLayers.push(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  /**\n   * Try to add point features to the map\n   * Necessary to create clusters\n   */\n  private tryAddPointToMap(features: Feature[], id) {\n    let i = 1;\n    if (features.length) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'cluster',\n          id,\n          queryable: true,\n          distance: 120,\n          meta: {\n            title: 'Cluster'\n          }\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: ClusterDataSource) => {\n          const icon = features[0].meta.icon;\n          let style: olstyle.Style;\n          if (!icon) {\n            style = createOverlayMarkerStyle();\n          } else {\n            style = this.createSvgIcon(icon) || createOverlayMarkerStyle();\n          }\n\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: (features[0].meta.title + ' ' + i + ' - ' + this.languageService.translate.instant(\n              'igo.geo.spatialFilter.spatialFilter'\n            )) as string,\n            source: dataSource,\n            visible: true,\n            style\n          });\n\n          const featuresOl = features.map(feature => {\n            return featureToOl(feature, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceCluster;\n          ol.getSource().addFeatures(featuresOl);\n          if (this.layers.find(layer => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.layers.find(layer => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title + ' ' + i + ' - ' + this.languageService.translate.instant(\n              'igo.geo.spatialFilter.spatialFilter'\n            )) as string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.iterator = i;\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.pushLayer(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  private createSvgIcon(icon): olstyle.Style {\n    let style: olstyle.Style;\n    this.matIconRegistry.getNamedSvgIcon(icon).subscribe(svgObj => {\n      const xmlSerializer = new XMLSerializer();\n      svgObj.setAttribute('width', '30');\n      svgObj.setAttribute('height', '30');\n      svgObj.setAttribute('fill', 'rgba(0, 128, 255)');\n      svgObj.setAttribute('stroke', 'white');\n      const svg = xmlSerializer.serializeToString(svgObj);\n      style = new olstyle.Style({\n        image: new olstyle.Icon({\n          src: 'data:image/svg+xml;utf8,' + svg\n        })\n      });\n    });\n    return style;\n  }\n  /**\n   * Try to add line or polygon features to the map\n   */\n  private tryAddLayerToMap(features: Feature[], id) {\n    let i = 1;\n    if (features.length) {\n      if (this.map === undefined) {\n        return;\n      }\n      for (const layer of this.layers) {\n        if (layer.title?.startsWith(features[0].meta.title)) {\n          i++;\n        }\n      }\n      this.dataSourceService\n        .createAsyncDataSource({\n          type: 'vector',\n          id,\n          queryable: true\n        } as QueryableDataSourceOptions)\n        .pipe(take(1))\n        .subscribe((dataSource: DataSource) => {\n          const olLayer = this.layerService.createLayer({\n            isIgoInternalLayer: true,\n            title: (features[0].meta.title + ' ' + i + ' - ' + this.languageService.translate.instant(\n              'igo.geo.spatialFilter.spatialFilter'\n            )) as string,\n            source: dataSource,\n            visible: true\n          });\n          const featuresOl = features.map(feature => {\n            return featureToOl(feature, this.map.projection);\n          });\n          const ol = dataSource.ol as olSourceVector<OlGeometry>;\n          ol.addFeatures(featuresOl);\n          if (this.layers.find(layer => layer.id === olLayer.id)) {\n            this.map.removeLayer(\n              this.layers.find(layer => layer.id === olLayer.id)\n            );\n            i = i - 1;\n            olLayer.title = (features[0].meta.title + ' ' + i + ' - ' + this.languageService.translate.instant(\n              'igo.geo.spatialFilter.spatialFilter'\n            )) as string;\n            olLayer.options.title = olLayer.title;\n          }\n          this.map.addLayer(olLayer);\n          this.layers.push(olLayer);\n          this.pushLayer(olLayer);\n          this.cdRef.detectChanges();\n        });\n    }\n  }\n\n  zoomToFeatureExtent(feature) {\n    if (feature) {\n      const olFeature = this.format.readFeature(feature, {\n        dataProjection: feature.projection,\n        featureProjection: this.map.projection\n      });\n      moveToOlFeatures(this.map, [olFeature], FeatureMotion.Zoom);\n    }\n  }\n\n  pushLayer(layer) {\n    for (const lay of this.activeLayers) {\n      if (lay.id === layer.id) {\n        return;\n      }\n    }\n\n    this.activeLayers.push(layer);\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport { IgoPanelModule, IgoFormModule } from '@igo2/common';\nimport { IgoMapModule, IgoFilterModule, IgoQueryModule, IgoFeatureModule, IgoFeatureDetailsModule } from '@igo2/geo';\nimport { IgoMessageModule } from '@igo2/core';\n\nimport { AppSpatialFilterComponent } from './spatial-filter.component';\nimport { AppSpatialFilterRoutingModule } from './spatial-filter-routing.module';\n\n@NgModule({\n  declarations: [AppSpatialFilterComponent],\n  imports: [\n    AppSpatialFilterRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoMessageModule,\n    IgoQueryModule,\n    IgoFeatureModule,\n    IgoFeatureDetailsModule,\n    IgoFilterModule,\n    IgoFormModule,\n    CommonModule\n  ],\n  exports: [AppSpatialFilterComponent]\n})\nexport class AppSpatialFilterModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Workspace</mat-card-title>\n  <mat-card-content>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/geo/workspace\">code of this example</a>\n  </mat-card-content>\n\n  <igo-map-browser [map]=\"map\" [view]=\"view\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n  </igo-map-browser>\n\n  <igo-workspace-selector\n    igoWorkspaceSelector\n    [store]=\"workspaceStore\"\n    [map]=\"map\">\n  </igo-workspace-selector>\n\n  <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\n    <igo-entity-table-paginator\n      *ngIf=\"workspace.inResolutionRange$ | async\"\n      [store]=\"workspace.entityStore\"\n      [paginatorOptions]=\"paginatorOptions\"\n      [entitySortChange$]=\"entitySortChange$\"\n      (paginatorChange)=\"paginatorChange($event)\">\n    </igo-entity-table-paginator>\n  </ng-container>\n\n  <ng-container *ngIf=\"selectedWorkspace$ | async as workspace\">\n    <igo-actionbar\n      *ngIf=\"workspace.actionStore\"\n      [store]=\"workspace.actionStore\"\n      [horizontal]=\"true\"\n      [withToggleButton]=\"true\"\n      [withTitle]=\"true\"\n      [mode]=\"actionbarMode\">\n    </igo-actionbar>\n\n    <igo-entity-table\n      *ngIf=\"workspace.entityStore && workspace.meta && workspace.meta.tableTemplate && (workspace.inResolutionRange$ | async)\"\n      class=\"table-compact table-centered\"\n      [paginator]=\"workspacePaginator\"\n      [scrollBehavior]=\"scrollBehavior\"\n      [store]=\"workspace.entityStore\"\n      [template]=\"workspace.meta.tableTemplate\">\n    </igo-entity-table>\n    <mat-card-content\n    *ngIf=\"(workspace.inResolutionRange$ | async) === false\">\n      No data available at this scale. Please zoom in. \n    </mat-card-content>\n\n    <igo-workspace-widget-outlet [workspace]=\"workspace\"></igo-workspace-widget-outlet>\n\n  </ng-container>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppWorkspaceComponent } from './workspace.component';\n\nconst routes: Routes = [\n  {\n    path: 'workspace',\n    component: AppWorkspaceComponent\n  }\n];\n\nexport const AppWorkspaceRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component, OnInit } from '@angular/core';\n\nimport { Observable, BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { LanguageService } from '@igo2/core';\nimport {\n  ActionbarMode,\n  EntityRecord,\n  EntityTableScrollBehavior,\n  Workspace,\n  WorkspaceStore,\n  EntityTablePaginatorOptions\n} from '@igo2/common';\nimport {\n  IgoMap,\n  DataSourceService,\n  LayerService,\n  WFSDataSourceOptions\n} from '@igo2/geo';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { WorkspaceState } from '@igo2/integration';\n\n@Component({\n  selector: 'app-workspace',\n  templateUrl: './workspace.component.html',\n  styleUrls: ['./workspace.component.scss']\n})\nexport class AppWorkspaceComponent implements OnInit {\n\n  public workspacePaginator: MatPaginator;\n  entitySortChange$: BehaviorSubject<boolean> = new BehaviorSubject(false);\n  public paginatorOptions: EntityTablePaginatorOptions = {\n    pageSize: 5, // Number of items to display on a page.\n    pageSizeOptions: [1, 5, 10, 15, 30, 50, 100], // The set of provided page size options to display to the user.\n    showFirstLastButtons: true // Whether to show the first/last buttons UI to the user.\n  };\n\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-72, 47.2],\n    zoom: 5\n  };\n\n  get workspaceStore(): WorkspaceStore {\n    return this.workspaceState.store;\n  }\n\n  public selectedWorkspace$: Observable<Workspace>;\n\n  public actionbarMode = ActionbarMode.Overlay;\n\n  public scrollBehavior = EntityTableScrollBehavior.Instant;\n\n  constructor(\n    private languageService: LanguageService,\n    private dataSourceService: DataSourceService,\n    private layerService: LayerService,\n    public workspaceState: WorkspaceState,\n  ) {}\n\n  ngOnInit() {\n    this.selectedWorkspace$ = this.workspaceStore.stateView\n      .firstBy$(\n        (record: EntityRecord<Workspace>) => record.state.selected === true\n      )\n      .pipe(\n        map((record: EntityRecord<Workspace>) => {\n          const entity = record === undefined ? undefined : record.entity;\n          if (entity) {\n            // In fact, the download action is not fully functionnal into the igo2-lib demo\n            // The reason why it's has been remove is that this button trigger a tool (importExport)\n            // and this tool is not available in the igo2-lib demo.\n            // This is why it's has been removed frome the actions's list.\n            // Refer to the igo2 demo at https://infra-geo-ouverte.github.io/igo2/\n            entity.actionStore.view.filter((action) => {\n              return action.id !== 'wfsDownload';\n            });\n          }\n          return entity;\n\n        })\n      );\n\n    this.dataSourceService\n      .createAsyncDataSource({\n        type: 'osm'\n      })\n      .subscribe(dataSource => {\n        this.map.addLayer(\n          this.layerService.createLayer({\n            title: 'OSM',\n            source: dataSource\n          })\n        );\n      });\n\n    // const wmsDataSourceOptions = {\n    //   type: 'wms',\n    //   url: 'https://ahocevar.com/geoserver/wms',\n    //   urlWfs: 'https://ahocevar.com/geoserver/wfs',\n    //   params: {\n    //     LAYERS: 'water_areas',\n    //     VERSION: '1.3.0'\n    //   },\n    //   paramsWFS: {\n    //     featureTypes: 'water_areas',\n    //     fieldNameGeometry: 'the_geom',\n    //     maxFeatures: 10000,\n    //     version: '1.1.0',\n    //     outputFormat: 'application/json',\n    //     outputFormatDownload: 'application/vnd.google-earth.kml+xml'\n    //   },\n    //   sourceFields: [\n    //     {name: 'waterway', alias: 'Chemin d eau'},\n    //     {name: 'osm_id'},\n    //     {name: 'landuse'}\n    //   ],\n    //   ogcFilters: {\n    //     enabled: true,\n    //     editable: true\n    //   },\n    //   serverType: 'geoserver'\n    // };\n    //\n    // this.dataSourceService\n    //   .createAsyncDataSource(wmsDataSourceOptions as OgcFilterableDataSourceOptions)\n    //   .subscribe(dataSource => {\n    //     const layer = {\n    //       optionsFromCapabilities: true,\n    //       title: 'WMS Geoserver filterable ',\n    //       visible: true,\n    //       source: dataSource\n    //     };\n    //     this.map.addLayer(this.layerService.createLayer(layer));\n    //   });\n\n    const wfsDataSourceOptions: WFSDataSourceOptions = {\n      type: 'wfs',\n      url: 'https://ws.mapserver.transports.gouv.qc.ca/swtq',\n      params: {\n        featureTypes: 'etablissement_mtq',\n        fieldNameGeometry: 'geometry',\n        version: '2.0.0',\n        outputFormat: 'geojson'\n      },\n      sourceFields: [\n        { name: 'idetablis', alias: 'ID' },\n        { name: 'nometablis', alias: 'Name' },\n        { name: 'typetablis', alias: 'Type' }\n      ]\n    };\n\n    this.dataSourceService\n      .createAsyncDataSource(wfsDataSourceOptions)\n      .subscribe(dataSource => {\n        const layer = {\n          title: 'Simple WFS ',\n          maxResolution: 3000,\n          visible: true,\n          source: dataSource\n        };\n        this.map.addLayer(this.layerService.createLayer(layer));\n      });\n  }\n\n  paginatorChange(event: MatPaginator) {\n    this.workspacePaginator = event;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\n\nimport {\n  IgoActionModule,\n  IgoEntityModule,\n  IgoWorkspaceModule,\n  IgoPanelModule\n} from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoGeoWorkspaceModule\n} from '@igo2/geo';\n\nimport { AppWorkspaceComponent } from './workspace.component';\nimport { AppWorkspaceRoutingModule } from './workspace-routing.module';\n\n@NgModule({\n  declarations: [AppWorkspaceComponent],\n  imports: [\n    CommonModule,\n    AppWorkspaceRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoActionModule,\n    IgoEntityModule,\n    IgoWorkspaceModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoGeoWorkspaceModule\n  ],\n  exports: [AppWorkspaceComponent]\n})\nexport class AppWorkspaceModule {}\n","<mat-card>\n  <mat-card-subtitle>Geo</mat-card-subtitle>\n  <mat-card-title>Context</mat-card-title>\n  <mat-card-content>\n    <p>* Dependencies: LanguageService</p>\n\n    <br>\n    See the <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/app/context/context\">code of this example</a><br>\n    See <a href=\"https://github.com/infra-geo-ouverte/igo2-lib/tree/master/demo/src/contexts\"> contexts</a>\n    <hr>\n  </mat-card-content>\n\n  <igo-map-browser\n    igoMapContext\n    igoLayerContext\n    [map]=\"map\">\n    <igo-zoom-button [map]=\"map\" color=\"primary\"></igo-zoom-button>\n    <igo-geolocate-button [map]=\"map\" color=\"primary\"></igo-geolocate-button>\n    <igo-home-extent-button [map]=\"map\" color=\"primary\"></igo-home-extent-button>\n    <igo-rotation-button [map]=\"map\" [showIfNoRotation]=\"true\" color=\"primary\"></igo-rotation-button>\n  </igo-map-browser>\n\n  <igo-panel title=\"Contexts list\">\n    <igo-context-list igoContextListBinding [map]=\"map\"></igo-context-list>\n  </igo-panel>\n\n  <igo-panel title=\"Layers\">\n    <igo-layer-list igoLayerListBinding [map]=\"map\">\n      <ng-template #igoLayerItemToolbar let-layer=\"layer\">\n        <igo-metadata-button [layer]=\"layer\"></igo-metadata-button>\n      </ng-template>\n    </igo-layer-list>\n  </igo-panel>\n\n</mat-card>\n","import { Routes, RouterModule } from '@angular/router';\n\n\nimport { AppContextComponent } from './context.component';\n\nconst routes: Routes = [\n  {\n    path: 'context',\n    component: AppContextComponent\n  }\n];\n\nexport const AppContextRoutingModule = RouterModule.forChild(\n  routes\n);\n","import { Component } from '@angular/core';\n\nimport { LanguageService } from '@igo2/core';\nimport { IgoMap, OverlayService, MapService } from '@igo2/geo';\n\n@Component({\n  selector: 'app-context',\n  templateUrl: './context.component.html',\n  styleUrls: ['./context.component.scss']\n})\nexport class AppContextComponent {\n  public map = new IgoMap({\n    controls: {\n      attribution: {\n        collapsed: true\n      }\n    }\n  });\n\n  public view = {\n    center: [-73, 47.2],\n    zoom: 6\n  };\n\n  constructor(\n    private languageService: LanguageService,\n    private mapService: MapService,\n    private overlayService: OverlayService\n  ) {\n    this.mapService.setMap(this.map);\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatIconModule } from '@angular/material/icon';\nimport { HttpClientJsonpModule } from '@angular/common/http';\nimport { IgoPanelModule } from '@igo2/common';\nimport {\n  IgoMapModule,\n  IgoLayerModule,\n  IgoMetadataModule,\n  IgoOverlayModule,\n  IgoQueryModule,\n  IgoFeatureModule\n} from '@igo2/geo';\nimport { IgoContextManagerModule } from '@igo2/context';\n\nimport { AppContextComponent } from './context.component';\nimport { AppContextRoutingModule } from './context-routing.module';\n\n@NgModule({\n  declarations: [AppContextComponent],\n  imports: [\n    HttpClientJsonpModule,\n    AppContextRoutingModule,\n    MatCardModule,\n    MatButtonModule,\n    MatIconModule,\n    IgoPanelModule,\n    IgoMapModule,\n    IgoLayerModule,\n    IgoMetadataModule,\n    IgoOverlayModule,\n    IgoQueryModule,\n    IgoFeatureModule,\n    IgoContextManagerModule\n  ],\n  exports: [AppContextComponent]\n})\nexport class AppContextModule {}\n","import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\n\nconst routes: Routes = [\n  { path: '', redirectTo: '/home', pathMatch: 'full' },\n  { path: '**', redirectTo: '/home' }\n];\n\n@NgModule({\n  imports: [RouterModule.forRoot(routes, { useHash: true })],\n  exports: [RouterModule]\n})\nexport class AppRoutingModule {}\n","import { MediaMatcher } from '@angular/cdk/layout';\nimport {\n  ChangeDetectorRef,\n  Component,\n  OnDestroy,\n  Renderer2\n} from '@angular/core';\n\nimport { userAgent } from '@igo2/utils';\nimport { version } from '@igo2/core';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.scss']\n})\nexport class AppComponent implements OnDestroy {\n  mobileQuery: MediaQueryList;\n\n  public title = 'IGO';\n  public version = version;\n  private themeClass = 'deeppurple-theme';\n  private _mobileQueryListener: () => void;\n\n  constructor(\n    private changeDetectorRef: ChangeDetectorRef,\n    private media: MediaMatcher,\n    private renderer: Renderer2\n  ) {\n    this.mobileQuery = media.matchMedia('(max-width: 600px)');\n    this._mobileQueryListener = () => changeDetectorRef.detectChanges();\n    this.mobileQuery.addEventListener('change', this._mobileQueryListener);\n\n    this.renderer.addClass(document.body, this.themeClass);\n\n    this.detectOldBrowser();\n  }\n\n  ngOnDestroy(): void {\n    this.mobileQuery.removeEventListener('change', this._mobileQueryListener);\n  }\n\n  private detectOldBrowser() {\n    const oldBrowser = userAgent.satisfies({\n      ie: '<11',\n      chrome: '<64',\n      firefox: '<60'\n    });\n\n    if (oldBrowser) {\n      console.log('Very old browser ! ', userAgent.getBrowser());\n    }\n  }\n}\n","<div class=\"example-container\" [class.example-is-mobile]=\"mobileQuery.matches\">\n  <mat-toolbar color=\"primary\" class=\"example-toolbar\">\n    <button mat-icon-button (click)=\"snav.toggle()\"><mat-icon svgIcon=\"menu\"></mat-icon></button>\n    <h1>{{title}}</h1>\n    <h5>{{version.lib}}</h5>\n  </mat-toolbar>\n\n  <mat-sidenav-container class=\"example-sidenav-container\" [style.marginTop.px]=\"mobileQuery.matches ? 56 : 0\">\n    <mat-sidenav #snav opened=\"true\" [mode]=\"mobileQuery.matches ? 'over' : 'side'\" [fixedInViewport]=\"mobileQuery.matches\" fixedTopGap=\"56\">\n      <mat-nav-list>\n        <a mat-list-item routerLink=\".\">Home</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"activity\">Activity</a>\n        <a mat-list-item routerLink=\"config\">Config</a>\n        <a mat-list-item routerLink=\"language\">Language</a>\n        <a mat-list-item routerLink=\"media\">Media</a>\n        <a mat-list-item routerLink=\"message\">Message</a>\n        <a mat-list-item routerLink=\"request\">Request</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"auth-form\">Authentification</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"action\">Action</a>\n        <a mat-list-item routerLink=\"dynamic-component\">Dynamic Component</a>\n        <a mat-list-item routerLink=\"entity-table\">Entity Table</a>\n        <a mat-list-item routerLink=\"entity-selector\">Entity Selector</a>\n        <a mat-list-item routerLink=\"form\">Form</a>\n        <a mat-list-item routerLink=\"table\">Table</a>\n        <a mat-list-item routerLink=\"tool\">Tool</a>\n        <a mat-list-item routerLink=\"widget\">Widget</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"simple-map\">Simple map</a>\n        <a mat-list-item routerLink=\"layer\">Layer</a>\n        <a mat-list-item routerLink=\"legend\">Legend</a>\n        <a mat-list-item routerLink=\"overlay\">Overlay</a>\n        <a mat-list-item routerLink=\"geometry\">Geometry</a>\n        <a mat-list-item routerLink=\"feature\">Feature</a>\n        <a mat-list-item routerLink=\"hover\">Hover</a>\n        <a mat-list-item routerLink=\"measure\">Measure</a>\n        <a mat-list-item routerLink=\"draw\">Draw</a>\n        <a mat-list-item routerLink=\"query\">Query</a>\n        <a mat-list-item routerLink=\"catalog\">Catalog</a>\n        <a mat-list-item routerLink=\"search\">Search</a>\n        <a mat-list-item routerLink=\"print\">Print</a>\n        <a mat-list-item routerLink=\"import-export\">Import/Export</a>\n        <a mat-list-item routerLink=\"directions\">Directions</a>\n        <a mat-list-item routerLink=\"time-filter\">Time filter</a>\n        <a mat-list-item routerLink=\"ogc-filter\">OGC filter</a>\n        <a mat-list-item routerLink=\"spatial-filter\">Spatial filter</a>\n        <a mat-list-item routerLink=\"workspace\">Workspace</a>\n\n        <hr>\n\n        <a mat-list-item routerLink=\"context\">Context</a>\n\n      </mat-nav-list>\n    </mat-sidenav>\n\n    <mat-sidenav-content>\n      <router-outlet></router-outlet>\n    </mat-sidenav-content>\n\n  </mat-sidenav-container>\n</div>\n","import { BrowserModule, DomSanitizer } from '@angular/platform-browser';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\nimport { APP_INITIALIZER, NgModule } from '@angular/core';\nimport { HammerModule } from '@angular/platform-browser';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconRegistry, MatIconModule } from '@angular/material/icon';\nimport { MatListModule } from '@angular/material/list';\nimport { MatSidenavModule } from '@angular/material/sidenav';\nimport { MatToolbarModule } from '@angular/material/toolbar';\nimport { AppHomeModule } from './core/home/home.module';\nimport { AppActivityModule } from './core/activity/activity.module';\nimport { AppConfigModule } from './core/config/config.module';\nimport { AppLanguageModule } from './core/language/language.module';\nimport { AppMediaModule } from './core/media/media.module';\nimport { AppMessageModule } from './core/message/message.module';\nimport { AppRequestModule } from './core/request/request.module';\n\nimport { AppActionModule } from './common/action/action.module';\nimport { AppDynamicComponentModule } from './common/dynamic-component/dynamic-component.module';\nimport { AppEntityTableModule } from './common/entity-table/entity-table.module';\nimport { AppEntitySelectorModule } from './common/entity-selector/entity-selector.module';\nimport { AppFormModule } from './common/form/form.module';\nimport { AppTableModule } from './common/table/table.module';\nimport { AppToolModule } from './common/tool/tool.module';\nimport { AppWidgetModule } from './common/widget/widget.module';\n\nimport { AppAuthFormModule } from './auth/auth-form/auth-form.module';\n\nimport { AppSimpleMapModule } from './geo/simple-map/simple-map.module';\nimport { AppLayerModule } from './geo/layer/layer.module';\nimport { AppLegendModule } from './geo/legend/legend.module';\nimport { AppOverlayModule } from './geo/overlay/overlay.module';\nimport { AppGeometryModule } from './geo/geometry/geometry.module';\nimport { AppFeatureModule } from './geo/feature/feature.module';\nimport { AppHoverModule } from './geo/hover/hover.module';\nimport { AppMeasureModule } from './geo/measure/measure.module';\nimport { AppDrawModule } from './geo/draw/draw.module';\nimport { AppQueryModule } from './geo/query/query.module';\nimport { AppCatalogModule } from './geo/catalog/catalog.module';\nimport { AppSearchModule } from './geo/search/search.module';\nimport { AppPrintModule } from './geo/print/print.module';\nimport { AppImportExport } from './geo/import-export/import-export.module';\nimport { AppDirectionsModule } from './geo/directions/directions.module';\nimport { AppTimeFilterModule } from './geo/time-filter/time-filter.module';\nimport { AppOgcFilterModule } from './geo/ogc-filter/ogc-filter.module';\nimport { AppSpatialFilterModule } from './geo/spatial-filter/spatial-filter.module';\nimport { AppWorkspaceModule } from './geo/workspace/workspace.module';\n\nimport { AppContextModule } from './context/context/context.module';\n\nimport { AppRoutingModule } from './app-routing.module';\nimport { AppComponent } from './app.component';\nimport { IgoCoreModule, LanguageService } from '@igo2/core';\nimport { MatTooltipDefaultOptions, MAT_TOOLTIP_DEFAULT_OPTIONS } from '@angular/material/tooltip';\n\nexport const defaultTooltipOptions: MatTooltipDefaultOptions = {\n  showDelay: 500,\n  hideDelay: 0,\n  touchendHideDelay: 0,\n  disableTooltipInteractivity: true\n};\n\n@NgModule({\n  declarations: [AppComponent],\n  imports: [\n    IgoCoreModule,\n    BrowserModule,\n    BrowserAnimationsModule,\n    MatSidenavModule,\n    MatToolbarModule,\n    MatButtonModule,\n    MatIconModule,\n    MatListModule,\n\n    AppHomeModule,\n    AppActivityModule,\n    AppConfigModule,\n    AppLanguageModule,\n    AppMediaModule,\n    AppMessageModule,\n    AppRequestModule,\n\n    AppActionModule,\n    AppDynamicComponentModule,\n    AppEntityTableModule,\n    AppEntitySelectorModule,\n    AppFormModule,\n    AppTableModule,\n    AppToolModule,\n    AppWidgetModule,\n\n    AppAuthFormModule,\n\n    AppSimpleMapModule,\n    AppLayerModule,\n    AppLegendModule,\n    AppOverlayModule,\n    AppGeometryModule,\n    AppFeatureModule,\n    AppHoverModule,\n    AppMeasureModule,\n    AppDrawModule,\n    AppQueryModule,\n    AppCatalogModule,\n    AppSearchModule,\n    AppPrintModule,\n    AppImportExport,\n    AppDirectionsModule,\n    AppTimeFilterModule,\n    AppOgcFilterModule,\n    AppSpatialFilterModule,\n    AppWorkspaceModule,\n\n    AppContextModule,\n\n    AppRoutingModule,\n\n    HammerModule\n  ],\n  providers: [\n    {provide: APP_INITIALIZER, useFactory: appInitializerFactory, deps: [LanguageService], multi: true},\n    { provide: MAT_TOOLTIP_DEFAULT_OPTIONS, useValue: defaultTooltipOptions }\n  ],\n  bootstrap: [AppComponent]\n})\nexport class AppModule {\n  constructor(matIconRegistry: MatIconRegistry, domSanitizer: DomSanitizer) {\n    matIconRegistry.addSvgIconSet(\n      domSanitizer.bypassSecurityTrustResourceUrl(\n        './assets/igo2/core/icons/mdi.svg'\n      )\n    );\n  }\n}\n\nexport function appInitializerFactory(languageService: LanguageService) {\n  return () => new Promise<any>((resolve: any) => {\n      languageService.translate.getTranslation(languageService.getLanguage()).subscribe(() => {\n        console.info(`Successfully initialized '${languageService.getLanguage()}' language.'`);\n      }, err => {\n        console.error(`Problem with '${languageService.getLanguage()}' language initialization.'`);\n      }, () => {\n        resolve(null);\n      });\n  });\n}\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nimport 'hammerjs';\n\nif (environment.production) {\n  enableProdMode();\n}\n\nplatformBrowserDynamic()\n  .bootstrapModule(AppModule)\n  .catch(err => console.log(err));\n","var map = {\n\t\"./af\": 58685,\n\t\"./af.js\": 58685,\n\t\"./ar\": 254,\n\t\"./ar-dz\": 4312,\n\t\"./ar-dz.js\": 4312,\n\t\"./ar-kw\": 32614,\n\t\"./ar-kw.js\": 32614,\n\t\"./ar-ly\": 18630,\n\t\"./ar-ly.js\": 18630,\n\t\"./ar-ma\": 28674,\n\t\"./ar-ma.js\": 28674,\n\t\"./ar-sa\": 49032,\n\t\"./ar-sa.js\": 49032,\n\t\"./ar-tn\": 24730,\n\t\"./ar-tn.js\": 24730,\n\t\"./ar.js\": 254,\n\t\"./az\": 53052,\n\t\"./az.js\": 53052,\n\t\"./be\": 60150,\n\t\"./be.js\": 60150,\n\t\"./bg\": 63069,\n\t\"./bg.js\": 63069,\n\t\"./bm\": 13466,\n\t\"./bm.js\": 13466,\n\t\"./bn\": 18516,\n\t\"./bn-bd\": 90557,\n\t\"./bn-bd.js\": 90557,\n\t\"./bn.js\": 18516,\n\t\"./bo\": 26273,\n\t\"./bo.js\": 26273,\n\t\"./br\": 9588,\n\t\"./br.js\": 9588,\n\t\"./bs\": 19815,\n\t\"./bs.js\": 19815,\n\t\"./ca\": 83331,\n\t\"./ca.js\": 83331,\n\t\"./cs\": 21320,\n\t\"./cs.js\": 21320,\n\t\"./cv\": 72219,\n\t\"./cv.js\": 72219,\n\t\"./cy\": 68266,\n\t\"./cy.js\": 68266,\n\t\"./da\": 66427,\n\t\"./da.js\": 66427,\n\t\"./de\": 67435,\n\t\"./de-at\": 52871,\n\t\"./de-at.js\": 52871,\n\t\"./de-ch\": 12994,\n\t\"./de-ch.js\": 12994,\n\t\"./de.js\": 67435,\n\t\"./dv\": 82357,\n\t\"./dv.js\": 82357,\n\t\"./el\": 95649,\n\t\"./el.js\": 95649,\n\t\"./en-au\": 59961,\n\t\"./en-au.js\": 59961,\n\t\"./en-ca\": 19878,\n\t\"./en-ca.js\": 19878,\n\t\"./en-gb\": 3924,\n\t\"./en-gb.js\": 3924,\n\t\"./en-ie\": 70864,\n\t\"./en-ie.js\": 70864,\n\t\"./en-il\": 91579,\n\t\"./en-il.js\": 91579,\n\t\"./en-in\": 30940,\n\t\"./en-in.js\": 30940,\n\t\"./en-nz\": 16181,\n\t\"./en-nz.js\": 16181,\n\t\"./en-sg\": 44301,\n\t\"./en-sg.js\": 44301,\n\t\"./eo\": 85291,\n\t\"./eo.js\": 85291,\n\t\"./es\": 54529,\n\t\"./es-do\": 53764,\n\t\"./es-do.js\": 53764,\n\t\"./es-mx\": 12584,\n\t\"./es-mx.js\": 12584,\n\t\"./es-us\": 63425,\n\t\"./es-us.js\": 63425,\n\t\"./es.js\": 54529,\n\t\"./et\": 35203,\n\t\"./et.js\": 35203,\n\t\"./eu\": 70678,\n\t\"./eu.js\": 70678,\n\t\"./fa\": 83483,\n\t\"./fa.js\": 83483,\n\t\"./fi\": 96262,\n\t\"./fi.js\": 96262,\n\t\"./fil\": 52521,\n\t\"./fil.js\": 52521,\n\t\"./fo\": 34555,\n\t\"./fo.js\": 34555,\n\t\"./fr\": 63131,\n\t\"./fr-ca\": 88239,\n\t\"./fr-ca.js\": 88239,\n\t\"./fr-ch\": 21702,\n\t\"./fr-ch.js\": 21702,\n\t\"./fr.js\": 63131,\n\t\"./fy\": 267,\n\t\"./fy.js\": 267,\n\t\"./ga\": 23821,\n\t\"./ga.js\": 23821,\n\t\"./gd\": 71753,\n\t\"./gd.js\": 71753,\n\t\"./gl\": 4074,\n\t\"./gl.js\": 4074,\n\t\"./gom-deva\": 92762,\n\t\"./gom-deva.js\": 92762,\n\t\"./gom-latn\": 5969,\n\t\"./gom-latn.js\": 5969,\n\t\"./gu\": 82809,\n\t\"./gu.js\": 82809,\n\t\"./he\": 45402,\n\t\"./he.js\": 45402,\n\t\"./hi\": 315,\n\t\"./hi.js\": 315,\n\t\"./hr\": 10410,\n\t\"./hr.js\": 10410,\n\t\"./hu\": 38288,\n\t\"./hu.js\": 38288,\n\t\"./hy-am\": 67928,\n\t\"./hy-am.js\": 67928,\n\t\"./id\": 71334,\n\t\"./id.js\": 71334,\n\t\"./is\": 86959,\n\t\"./is.js\": 86959,\n\t\"./it\": 34864,\n\t\"./it-ch\": 51124,\n\t\"./it-ch.js\": 51124,\n\t\"./it.js\": 34864,\n\t\"./ja\": 36141,\n\t\"./ja.js\": 36141,\n\t\"./jv\": 29187,\n\t\"./jv.js\": 29187,\n\t\"./ka\": 42136,\n\t\"./ka.js\": 42136,\n\t\"./kk\": 94332,\n\t\"./kk.js\": 94332,\n\t\"./km\": 18607,\n\t\"./km.js\": 18607,\n\t\"./kn\": 84305,\n\t\"./kn.js\": 84305,\n\t\"./ko\": 70234,\n\t\"./ko.js\": 70234,\n\t\"./ku\": 16003,\n\t\"./ku.js\": 16003,\n\t\"./ky\": 75061,\n\t\"./ky.js\": 75061,\n\t\"./lb\": 32786,\n\t\"./lb.js\": 32786,\n\t\"./lo\": 66183,\n\t\"./lo.js\": 66183,\n\t\"./lt\": 50029,\n\t\"./lt.js\": 50029,\n\t\"./lv\": 24169,\n\t\"./lv.js\": 24169,\n\t\"./me\": 68577,\n\t\"./me.js\": 68577,\n\t\"./mi\": 68177,\n\t\"./mi.js\": 68177,\n\t\"./mk\": 50337,\n\t\"./mk.js\": 50337,\n\t\"./ml\": 65260,\n\t\"./ml.js\": 65260,\n\t\"./mn\": 52325,\n\t\"./mn.js\": 52325,\n\t\"./mr\": 14695,\n\t\"./mr.js\": 14695,\n\t\"./ms\": 75334,\n\t\"./ms-my\": 37151,\n\t\"./ms-my.js\": 37151,\n\t\"./ms.js\": 75334,\n\t\"./mt\": 63570,\n\t\"./mt.js\": 63570,\n\t\"./my\": 97963,\n\t\"./my.js\": 97963,\n\t\"./nb\": 88028,\n\t\"./nb.js\": 88028,\n\t\"./ne\": 86638,\n\t\"./ne.js\": 86638,\n\t\"./nl\": 50302,\n\t\"./nl-be\": 66782,\n\t\"./nl-be.js\": 66782,\n\t\"./nl.js\": 50302,\n\t\"./nn\": 33501,\n\t\"./nn.js\": 33501,\n\t\"./oc-lnc\": 50563,\n\t\"./oc-lnc.js\": 50563,\n\t\"./pa-in\": 50869,\n\t\"./pa-in.js\": 50869,\n\t\"./pl\": 65302,\n\t\"./pl.js\": 65302,\n\t\"./pt\": 49687,\n\t\"./pt-br\": 74884,\n\t\"./pt-br.js\": 74884,\n\t\"./pt.js\": 49687,\n\t\"./ro\": 79107,\n\t\"./ro.js\": 79107,\n\t\"./ru\": 33627,\n\t\"./ru.js\": 33627,\n\t\"./sd\": 30355,\n\t\"./sd.js\": 30355,\n\t\"./se\": 83427,\n\t\"./se.js\": 83427,\n\t\"./si\": 11848,\n\t\"./si.js\": 11848,\n\t\"./sk\": 54590,\n\t\"./sk.js\": 54590,\n\t\"./sl\": 20184,\n\t\"./sl.js\": 20184,\n\t\"./sq\": 56361,\n\t\"./sq.js\": 56361,\n\t\"./sr\": 78965,\n\t\"./sr-cyrl\": 81287,\n\t\"./sr-cyrl.js\": 81287,\n\t\"./sr.js\": 78965,\n\t\"./ss\": 25456,\n\t\"./ss.js\": 25456,\n\t\"./sv\": 70451,\n\t\"./sv.js\": 70451,\n\t\"./sw\": 77558,\n\t\"./sw.js\": 77558,\n\t\"./ta\": 51356,\n\t\"./ta.js\": 51356,\n\t\"./te\": 73693,\n\t\"./te.js\": 73693,\n\t\"./tet\": 21243,\n\t\"./tet.js\": 21243,\n\t\"./tg\": 42500,\n\t\"./tg.js\": 42500,\n\t\"./th\": 55768,\n\t\"./th.js\": 55768,\n\t\"./tk\": 77761,\n\t\"./tk.js\": 77761,\n\t\"./tl-ph\": 35780,\n\t\"./tl-ph.js\": 35780,\n\t\"./tlh\": 29590,\n\t\"./tlh.js\": 29590,\n\t\"./tr\": 33807,\n\t\"./tr.js\": 33807,\n\t\"./tzl\": 93857,\n\t\"./tzl.js\": 93857,\n\t\"./tzm\": 60654,\n\t\"./tzm-latn\": 8806,\n\t\"./tzm-latn.js\": 8806,\n\t\"./tzm.js\": 60654,\n\t\"./ug-cn\": 30845,\n\t\"./ug-cn.js\": 30845,\n\t\"./uk\": 19232,\n\t\"./uk.js\": 19232,\n\t\"./ur\": 47052,\n\t\"./ur.js\": 47052,\n\t\"./uz\": 77967,\n\t\"./uz-latn\": 32233,\n\t\"./uz-latn.js\": 32233,\n\t\"./uz.js\": 77967,\n\t\"./vi\": 98615,\n\t\"./vi.js\": 98615,\n\t\"./x-pseudo\": 12320,\n\t\"./x-pseudo.js\": 12320,\n\t\"./yo\": 31313,\n\t\"./yo.js\": 31313,\n\t\"./zh-cn\": 64490,\n\t\"./zh-cn.js\": 64490,\n\t\"./zh-hk\": 55910,\n\t\"./zh-hk.js\": 55910,\n\t\"./zh-mo\": 98262,\n\t\"./zh-mo.js\": 98262,\n\t\"./zh-tw\": 44223,\n\t\"./zh-tw.js\": 44223\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 46700;"],"x_google_ignoreList":[677]}